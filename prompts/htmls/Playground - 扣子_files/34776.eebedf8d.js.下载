"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["34776"],{436888:function(e,o,r){r.d(o,{E:()=>c});var s=r("255721"),t=r("771232"),a=r("387294"),l=r("897538"),i=r("449001"),n=r("698363"),c=e=>{var o,r,{searchWord:c,pageSize:d=10,scopeType:u=l.pz.All,scrollerRef:p}=e,{enterprise_id:v,organization_id:_}=null!==(r=(0,n.HU)())&&void 0!==r?r:{},f=(0,n.y6)(),x=(0,t.Z)(c,{wait:500});return(0,a.Z)((o=(0,s._)(function*(e){if(!f&&(!v||!_))return{list:[],page:0,total:0};var o,r,s,t,a,l,n=(null!==(s=null==e?void 0:e.page)&&void 0!==s?s:0)+1,c=yield i.pr.GetSpaceListV2({organization_id:_,enterprise_id:v,scope_type:u,search_word:x,size:d,page:n});return{list:null!==(t=null===(o=c.data)||void 0===o?void 0:o.bot_space_list)&&void 0!==t?t:[],page:n,total:null!==(l=null!==(a=null===(r=c.data)||void 0===r?void 0:r.total)&&void 0!==a?a:null==e?void 0:e.total)&&void 0!==l?l:0}}),function(e){return o.apply(this,arguments)}),{reloadDeps:[v,_,x,f,u],isNoMore:e=>!!e&&e.list.length>=e.total,target:p})}},280018:function(e,o,r){r.d(o,{q:()=>X,j:()=>A});var s,t=r("938809"),a=r("16242"),l=r("988726"),i=r("182956"),n=r("280067"),c=r("753940"),d=r("255721"),u=r("723530"),p=r("856306"),v=r.n(p),_=r("559293"),f=r("168074"),x=r("646411"),m=r("436888"),g=r("341333"),y=r("265489"),h=r("151766"),k=r("498842"),j=r("179508"),b=r("702718"),T=r("801368"),w=e=>null!==e&&"object"==typeof e&&Object.entries(e).every(e=>{var[o,r]=e;return!!o&&"string"==typeof o&&r.every(e=>!!e&&"string"==typeof e)}),C=e=>{if(!e)return{};try{var o=JSON.parse(e);if(w(o))return o}catch(e){k.E7.errorEvent({namespace:"resource_copy_error",eventName:"parse_cached_task_ids",error:e})}return{}},I=(e,o)=>{var r,s=C(T.D.getValue("resourceCopyTaskIds")),t=null!==(r=s[o])&&void 0!==r?r:[];T.D.setValue("resourceCopyTaskIds",JSON.stringify((0,y._)((0,g._)({},s),{[o]:(0,h.Z)([...e,...t])})))},Z=(e,o)=>{var r=C(T.D.getValue("resourceCopyTaskIds")),s=r[o].filter(o=>!e.includes(o));s.length?r[o]=s:delete r[o],T.D.setValue("resourceCopyTaskIds",Object.keys(r).length?JSON.stringify(r):void 0)},N=e=>{var o=C(T.D.getValue("resourceCopyTaskIds"));delete o[e],T.D.setValue("resourceCopyTaskIds",Object.keys(o).length?JSON.stringify(o):void 0)},P={[b.ZH.Agent]:"bot",[b.ZH.Project]:"project-ide",[b.ZH.Chux]:"chux",[b.ZH.Plugin]:"plugin",[b.ZH.Workflow]:"workflow",[b.ZH.Knowledge]:"knowledge",[b.ZH.UI]:"widget",[b.ZH.Database]:"database",[b.ZH.Prompt]:"library",[b.ZH.Memorybase]:"memory",[b.ZH.Imageflow]:"",[b.ZH.Trigger]:"",[b.ZH.Shortcut]:"",[b.ZH.Variable]:""},S=e=>{var o,r,s,t,a,l=null===(o=e.task_info)||void 0===o?void 0:o.EntityType,i=null===(s=e.task_info)||void 0===s?void 0:null===(r=s.TargetLocationInfo)||void 0===r?void 0:r.SpaceId,n=null===(a=e.task_info)||void 0===a?void 0:null===(t=a.TargetLocationInfo)||void 0===t?void 0:t.ProjectId,c="/space/".concat(i);return void 0===l?c:l===b.ZH.Prompt?"".concat(c,"/library?type=").concat(j.b0.Prompt,"&name=").concat(null==e?void 0:e.name):"".concat(c,"/").concat(P[l],"/").concat(n)},H=r("449001"),z={[b.ZH.Plugin]:j.b0.Plugin,[b.ZH.Workflow]:j.b0.Workflow,[b.ZH.Imageflow]:j.b0.Imageflow,[b.ZH.Knowledge]:j.b0.Knowledge,[b.ZH.UI]:j.b0.UI,[b.ZH.Prompt]:j.b0.Prompt,[b.ZH.Database]:j.b0.Database,[b.ZH.Variable]:j.b0.Variable,[b.ZH.Memorybase]:j.b0.Memorybase};var D=(s=(0,d._)(function*(e){var o,r,{resourceType:s,resourceId:t,targetSpaceId:a,resourceName:l}=e;if(s===b.ZH.Agent){;return null===(o=(yield H.pr.DraftBotCrossSpaceCopy({bot_id:t,to_space_id:a})).data)||void 0===o?void 0:o.task_id}if(s===b.ZH.Project){;return null===(r=(yield H.sD.DraftProjectCrossSpaceCopy({project_id:t,to_space_id:a})).data)||void 0===r?void 0:r.task_id}var n=z[s],c=yield H.Js.ResourceCopyDispatch({scene:j.K2.CrossSpaceCopy,res_id:t,res_type:n,res_name:l,target_space_id:a});return!c.task_id&&c.failed_reasons&&i.Toast.error(c.failed_reasons.map(e=>e.reason).filter(e=>!!e).join(";")),c.task_id}),function(e){return s.apply(this,arguments)}),E=e=>{var o,r,s,{spaceId:n,onChange:c,disabled:d,sourceSpaceId:p}=e,[_,f]=(0,u.useState)(),g=(0,u.useRef)(null),y=(0,m.E)({scrollerRef:g,searchWord:_,scopeType:x.pz.Self}),[h,k]=(0,u.useState)(-1),j=null!==(s=null===(r=y.data)||void 0===r?void 0:null===(o=r.list)||void 0===o?void 0:o.filter(e=>e.id!==p))&&void 0!==s?s:[];return(0,t.jsxs)("div",{ref:g,className:"flex flex-col gap-[16px]",children:[(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(i.Search,{className:"!w-full",value:_,onSearch:f,placeholder:a.o.t("workspace_search_placeholder")})}),(0,t.jsx)("div",{className:"flex flex-col max-h-[389px] overflow-y-auto",onMouseLeave:()=>{k(-1)},children:(0,t.jsxs)(i.Skeleton,{loading:y.loading,active:!0,placeholder:(0,t.jsx)("div",{children:(0,t.jsx)(i.Skeleton.Paragraph,{})}),children:[y.loading||j.length?null:(0,t.jsxs)("div",{className:"w-full h-full flex flex-col items-center",children:[(0,t.jsx)(l.nL$,{className:"text-[48px] coz-fg-dim"}),(0,t.jsx)("div",{className:v()("mt-[8px] mb-[16px]","text-[16px] font-[500] leading-[22px] coz-fg-primary"),children:a.o.t(_?"library_empty_no_results_found_under":"search_not_found")}),_?(0,t.jsx)(i.Button,{color:"primary",icon:(0,t.jsx)(l.bGR,{}),onClick:()=>{f(void 0)},children:a.o.t("library_empty_clear_filters")}):null]}),j.map((e,o)=>(0,t.jsxs)("div",{onMouseEnter:()=>{k(o)},className:v()("flex items-center gap-[10px]","px-12px pt-[8px] pb-[10px] rounded-[8px]","hover:coz-mg-secondary-hovered","relative",n===e.id?"coz-mg-secondary-hovered":"",d?"cursor-not-allowed opacity-50":"cursor-pointer"),onClick:()=>{!d&&c(e.id)},children:[(0,t.jsx)(i.CozAvatar,{src:e.icon_url,type:"team",size:"plus",className:"shrink-0"}),(0,t.jsx)(i.Typography.Text,{ellipsis:{showTooltip:!0},className:"flex-1",children:e.name}),n!==e.id&&o<j.length-1&&h!==o&&h-1!==o?(0,t.jsx)(i.Divider,{className:"absolute right-[12px] bottom-0 w-[386px] my-0"}):null,n===e.id?(0,t.jsx)(l.maW,{className:"text-[20px] coz-fg-hglt shrink-0"}):null]},e.id))]})})]})},V=()=>{var[e,o]=(0,u.useState)(),[r,s]=(0,u.useState)(),l=()=>{o(void 0),s(void 0)},n=(0,_.Z)((0,d._)(function*(){if(e&&r){var o=yield D({resourceId:r.resourceId,resourceName:r.resourceName,resourceType:r.resourceType,targetSpaceId:e});o&&(I([o],r.sourceSpaceId),f.FN.success(a.o.t("cross_workspace_copy_task_create_success")),l())}}),{manual:!0});return{open:e=>{s(e)},node:(0,t.jsx)(i.Modal,{visible:!!r,title:(0,t.jsx)("div",{className:"flex items-center max-w-[392px]",children:a.o.t("cross_workspace_copy_task_pop_title",{name:(0,t.jsx)(i.Typography.Text,{ellipsis:{showTooltip:!0},className:"flex-1",style:{fontSize:"inherit",fontWeight:"inherit",color:"inherit"},children:null==r?void 0:r.resourceName})})}),width:480,okButtonProps:{disabled:!e,loading:n.loading},cancelButtonProps:{loading:n.loading},onOk:n.run,onCancel:l,cancelText:a.o.t("Cancel"),okText:a.o.t("Confirm"),children:(0,t.jsx)(E,{spaceId:e,onChange:o,disabled:n.loading,sourceSpaceId:null==r?void 0:r.sourceSpaceId})})}},M=e=>{var{isAccountLevelAvailable:o,isAvailable:r}=e;return r?void 0:o?a.o.t("coze_copy_to_tips_4"):a.o.t("coze_copy_to_tips_3")},A=()=>{var e=(0,c.CZ)({scene:c.ej.CopyResourceCrossSpace}),{node:o,open:r}=V(),{node:s,open:d}=(0,c.zv)({scene:c.ej.CopyResourceCrossSpace}),{accountPlan:u}=(0,n.th)(),p=void 0!==u.member_version&&[n.aZ.Team,n.aZ.Enterprise].includes(u.member_version);return{renderMenu:o=>{var s=!!o.disabled,n=o.disabled&&"string"==typeof o.disabled?o.disabled:M({isAccountLevelAvailable:p,isAvailable:e}),c=(0,t.jsx)(i.Menu.Item,{suffix:e?null:(0,t.jsx)("div",{className:"flex items-center ml-[12px]",children:(0,t.jsx)(l.sWZ,{className:"coz-fg-hglt"})}),disabled:s,onClick:()=>{e?r(o):d()},children:a.o.t("cross_workspace_copy_task_button1_copy")});return n?(0,t.jsx)(i.Tooltip,{content:n,children:c}):c},modal:(0,t.jsxs)(t.Fragment,{children:[o,s]})}},B=r("691369"),R=e=>e.sort().join(","),W=e=>{var o,r,s=(0,T.Z)("resourceCopyTaskIds"),t=(0,u.useMemo)(()=>{var o;return null!==(o=C(s)[e])&&void 0!==o?o:[]},[s,e]),a=(0,_.Z)((0,d._)(function*(){var o,r;if(!t.length)return[];return null===(r=(yield H.sD.EntityTaskList({space_id:e,task_id_list:t})).data)||void 0===r?void 0:null===(o=r.task_list)||void 0===o?void 0:o.filter(e=>{var o;return(null===(o=e.task_info)||void 0===o?void 0:o.Status)!==B.og.Canceled})}),{refreshDeps:[R(t)]}),l=null!==(r=null===(o=a.data)||void 0===o?void 0:o.filter(e=>{var o,r;return(null===(o=e.task_info)||void 0===o?void 0:o.Status)===B.og.Processing&&(null===(r=e.task_info)||void 0===r?void 0:r.TaskId)}).map(e=>{var o,r;return"".concat(null!==(r=null===(o=e.task_info)||void 0===o?void 0:o.TaskId)&&void 0!==r?r:"")}))&&void 0!==r?r:[];return(0,u.useEffect)(()=>{if(!!l.length){var o,r=setInterval((o=(0,d._)(function*(){var o=yield H.sD.EntityTaskList({task_id_list:l,space_id:e});a.mutate(e=>e?e.map(e=>{var r,s,t=null===(s=o.data)||void 0===s?void 0:null===(r=s.task_list)||void 0===r?void 0:r.find(o=>{var r,s;return(null===(r=o.task_info)||void 0===r?void 0:r.TaskId)===(null===(s=e.task_info)||void 0===s?void 0:s.TaskId)});return null!=t?t:e}):void 0)}),function(){return o.apply(this,arguments)}),3e4);return()=>{clearInterval(r)}}},[R(l)]),a},U={[B.og.Success]:["cross_workspace_copy_task_status_finish",(0,t.jsx)(l.nAC,{}),"green"],[B.og.Processing]:["cross_workspace_copy_task_status_copying",(0,t.jsx)(l.j2n,{className:"semi-icon-spinning"}),"primary"],[B.og.Failed]:["cross_workspace_copy_task_status_copy_failed",(0,t.jsx)(l.tdK,{}),"red"]},O=e=>{var{status:o,reason:r}=e;if(!o||!U[o])return null;var[s,l,n]=U[o],c=(0,t.jsx)(i.Tag,{prefixIcon:l,color:n,size:"mini",children:a.o.t(s)});return r?(0,t.jsx)(i.Tooltip,{content:(0,t.jsx)(i.Typography.Paragraph,{ellipsis:{rows:8,expandable:!0},style:{width:176},children:r}),children:c}):c},K={[b.ZH.Plugin]:["library_resource_type_plugin",(0,t.jsx)(l.QWX,{})],[b.ZH.Workflow]:["library_resource_type_workflow",(0,t.jsx)(l.eTH,{})],[b.ZH.Imageflow]:["library_resource_type_imageflow",(0,t.jsx)(l.eTH,{})],[b.ZH.Knowledge]:["library_resource_type_knowledge",null],[b.ZH.UI]:["library_resource_type_ui",null],[b.ZH.Database]:["resource_type_database",null],[b.ZH.Prompt]:["library_resource_type_prompt",null],[b.ZH.Agent]:["develop_list_card_tag_agent",(0,t.jsx)(l.Cr5,{})],[b.ZH.Project]:["develop_list_card_tag_project",(0,t.jsx)(l.wmN,{})]},F=e=>{var{type:o}=e;if(!o||!K[o])return null;var[r,s]=K[o];return(0,t.jsx)(i.Tag,{prefixIcon:s,size:"mini",color:"primary",children:a.o.t(r)})},L=v()("flex items-center gap-[8px]","rounded-[8px] border border-solid coz-stroke-primary","p-[8px] coz-bg-max","mb-[6px]"),J=e=>{var o,r,s,n,{task:c,onCancel:d,onRetry:u}=e,p=(0,_.Z)(e=>{var o,r;return H.sD.ProcessEntityTask({task_id_list:["".concat(null!==(r=null===(o=c.task_info)||void 0===o?void 0:o.TaskId)&&void 0!==r?r:"")],action:e})},{manual:!0,onSuccess:(e,o)=>{var[r]=o;({[B.Vv.ProjectCopyCancel]:d,[B.Vv.ProjectCopyRetry]:u})[r]()}}),v=null===(o=c.task_info)||void 0===o?void 0:o.Status,f=v===B.og.Success,x=v===B.og.Failed,m=v===B.og.Processing;return(0,t.jsxs)("div",{className:L,children:[(0,t.jsx)(i.CozAvatar,{type:"platform",size:"plus",src:c.icon_url}),(0,t.jsxs)("div",{className:"flex-1 overflow-x-hidden",children:[(0,t.jsx)(i.Typography.Title,{fontSize:"14px",className:"font-medium coz-fg-primary w-full",ellipsis:{showTooltip:!0},children:c.name}),(0,t.jsxs)("div",{className:"mt-[2px] flex items-center gap-[2px]",children:[(0,t.jsx)(F,{type:null===(r=c.task_info)||void 0===r?void 0:r.EntityType}),(0,t.jsx)(O,{status:v,reason:null===(n=c.task_info)||void 0===n?void 0:null===(s=n.FailedReasons)||void 0===s?void 0:s.map(e=>{var o;return null!==(o=e.FailedReason)&&void 0!==o?o:""}).filter(e=>!!e).join("\r\n")})]})]}),(0,t.jsxs)("div",{children:[f?(0,t.jsx)(i.Tooltip,{content:a.o.t("cross_workspace_copy_task_button2_view"),children:(0,t.jsx)(i.IconButton,{color:"secondary",size:"small",icon:(0,t.jsx)(l.taB,{}),onClick:()=>{window.open(S(c))}})}):null,x?(0,t.jsx)(i.Tooltip,{content:a.o.t("cross_workspace_copy_task_button3_retry"),children:(0,t.jsx)(i.IconButton,{color:"secondary",size:"small",icon:(0,t.jsx)(l.mxP,{}),loading:p.loading,onClick:()=>{p.run(B.Vv.ProjectCopyRetry)}})}):null,m?(0,t.jsx)(i.Tooltip,{content:a.o.t("cross_workspace_copy_task_button4_cancel"),children:(0,t.jsx)(i.IconButton,{color:"secondary",size:"small",icon:(0,t.jsx)(l.noE,{}),loading:p.loading,onClick:()=>{p.run(B.Vv.ProjectCopyCancel)}})}):null]})]})},q=v()("fixed top-[62px] right-[24px]","coz-bg-plus","w-[360px]","rounded-[12px] border border-solid coz-stroke-primary","coz-shadow-default"),G=v()("pl-[16px]","cursor-grab select-none","h-[48px]","flex items-center gap-[16px] flex-1"),$=v()("px-[16px]","max-h-[304px] overflow-y-auto","pb-[8px]"),Q=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return o.filter(o=>{var r;return(null===(r=o.task_info)||void 0===r?void 0:r.Status)===e}).length},X=e=>{var o,r,s,{spaceId:n="",className:c}=e,d=W(n),p=d.data&&d.data.length>0,[_,x]=(0,u.useState)(!1),m=(0,u.useRef)(null),g=(0,u.useRef)(null),{subscribeGrab:y}=(0,f.GC)({grabTarget:m,grabAnchor:g,isModifyStyle:!0});(0,u.useEffect)(()=>{if(p)return y()},[p]);var h=null!==(s=null===(o=d.data)||void 0===o?void 0:o.filter(e=>{var o,r;return(null===(o=e.task_info)||void 0===o?void 0:o.Status)===B.og.Processing&&!!(null===(r=e.task_info)||void 0===r?void 0:r.TaskId)}).map(e=>{var o;return null===(o=e.task_info)||void 0===o?void 0:o.TaskId}))&&void 0!==s?s:[];return p?(0,t.jsxs)("div",{ref:m,className:v()(q,c),children:[(0,t.jsxs)("div",{className:"flex items-center pr-[16px]",children:[(0,t.jsxs)("div",{ref:g,className:G,children:[(0,t.jsx)("div",{className:"coz-fg-plus text-[16px] leading-[22px] font-medium",children:a.o.t("cross_workspace_copy_task_status_resource_copy")}),(0,t.jsx)("div",{className:"text-[14px] leading-[20px] coz-fg-secondary",children:a.o.t("cross_workspace_copy_task_status_all",{success:(0,t.jsx)("span",{className:"coz-fg-hglt-green",children:Q(B.og.Success,d.data)}),running:(0,t.jsx)("span",{children:Q(B.og.Processing,d.data)}),fail:(0,t.jsx)("span",{className:"coz-fg-hglt-red",children:Q(B.og.Failed,d.data)})})})]}),(0,t.jsx)(i.IconButton,{color:"secondary",size:"small",icon:(0,t.jsx)(l.uDC,{className:v()("transition-transform",{"rotate-180":_})}),onClick:()=>{x(!_)}}),h.length?(0,t.jsx)(i.Popconfirm,{cancelText:a.o.t("Cancel"),title:a.o.t("cross_workspace_copy_task_status_quit"),content:a.o.t("cross_workspace_copy_task_status_quit_tips1"),okText:a.o.t("cross_workspace_copy_task_status_quit_button1"),onConfirm:()=>{h.length&&H.sD.ProcessEntityTask({task_id_list:h,action:B.Vv.ProjectCopyCancel},{__disableErrorToast:!0}),N(n)},children:(0,t.jsx)(i.IconButton,{size:"small",color:"secondary",icon:(0,t.jsx)(l.rmE,{})})}):(0,t.jsx)(i.IconButton,{size:"small",color:"secondary",icon:(0,t.jsx)(l.rmE,{}),onClick:()=>{N(n)}})]}),_?null:(0,t.jsx)("div",{className:$,children:null===(r=d.data)||void 0===r?void 0:r.map(e=>{var o;return(0,t.jsx)(J,{task:e,onRetry:d.run,onCancel:()=>{var o,r;Z(["".concat(null!==(r=null===(o=e.task_info)||void 0===o?void 0:o.TaskId)&&void 0!==r?r:"")],n)}},null===(o=e.task_info)||void 0===o?void 0:o.TaskId)})})]}):null}},427876:function(e,o,r){r.d(o,{$0:function(){return n},J6:function(){return l},d$:function(){return i}});var s,t,a,l=((s={})[s.UpdateTime=0]="UpdateTime",s[s.CreateTime=1]="CreateTime",s);var i=((t={})[t.UpdateTime=0]="UpdateTime",t[t.CreateTime=1]="CreateTime",t[t.PublishTime=2]="PublishTime",t[t.OpenTime=3]="OpenTime",t);var n=((a={})[a.All=0]="All",a[a.CreateByMe=1]="CreateByMe",a[a.AllWithCollaborator=2]="AllWithCollaborator",a)},702718:function(e,o,r){r.d(o,{ZH:function(){return t}});var s,t=((s={})[s.Plugin=1]="Plugin",s[s.Workflow=2]="Workflow",s[s.Imageflow=3]="Imageflow",s[s.Knowledge=4]="Knowledge",s[s.UI=5]="UI",s[s.Project=6]="Project",s[s.Database=7]="Database",s[s.Variable=8]="Variable",s[s.Trigger=9]="Trigger",s[s.Agent=10]="Agent",s[s.Prompt=11]="Prompt",s[s.Shortcut=12]="Shortcut",s[s.Chux=13]="Chux",s[s.Memorybase=14]="Memorybase",s)}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2239/34776.eebedf8d.js.map