"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["38665"],{852157:function(o,e,t){t.r(e),t.d(e,{CustomPlatformSettingModal:()=>k});var l=t("255721"),a=t("341333"),r=t("265489"),n=t("938809"),i=t("842197"),s=t("723530"),c=t("698363"),u=t("886073"),_=t("16242"),p=t("988726"),d=t("182956"),m=t("448082"),f=t("646411"),v=t("384149"),h=t.n(v),b=t("559293"),x=t("415692"),g=t("411960"),y=t("498842"),z=t("274372"),C=t("449001"),w=(o,e)=>{var t,n,i,u,p,m,v,{organization_id:w}=null!==(v=(0,c.HU)())&&void 0!==v?v:{},k=(0,c.y6)(),{loading:N,run:j,data:E}=(0,b.Z)((0,l._)(function*(){try{var o,e=yield C.pr.GetSpaceListV2();return null==e?void 0:null===(o=e.data)||void 0===o?void 0:o.bot_space_list}catch(o){return console.error(o),o instanceof Error&&y.E7.errorEvent({eventName:g.b.GetSpaceListFromCustomPlat,error:o,meta:{error:o}}),[]}}),{manual:!0}),T=(0,s.useMemo)(()=>null==E?void 0:E.map(o=>({label:o.name,value:o.id,disabled:(null==o?void 0:o.role_type)!==f.wA.Owner&&(null==o?void 0:o.role_type)!==f.wA.Admin})),[E]),{data:A,loading:Z,run:F}=(0,b.Z)((0,l._)(function*(){try{var o,e,t=yield C.f_.ListAppMeta(k?{}:{organization_id:w});return null!==(e=null==t?void 0:null===(o=t.data)||void 0===o?void 0:o.apps)&&void 0!==e?e:[]}catch(o){return console.error(o),o instanceof Error&&y.E7.errorEvent({eventName:g.b.GetOauthAppListFromCustomPlat,error:o,meta:{error:o}}),[]}}),{refreshDeps:[k,w]}),P=(0,s.useMemo)(()=>null==A?void 0:A.map(o=>{var e;return{label:"".concat(o.name,"(ID: ").concat(o.appid,")"),value:o.appid,disabled:!!(null==o?void 0:null===(e=o.connector)||void 0===e?void 0:e.connector_id)||(null==o?void 0:o.app_type)===z.pR.normal}}),[A]);var{loading:L,runAsync:S}=(0,b.Z)((t=(0,l._)(function*(o){return yield C.tm.CreateConnector((0,r._)((0,a._)({},o),{account_id:w}))}),function(o){return t.apply(this,arguments)}),{manual:!0});var{loading:I,runAsync:M}=(0,b.Z)((n=(0,l._)(function*(o){return yield C.tm.UpdateConnector(o)}),function(o){return n.apply(this,arguments)}),{manual:!0});var{loading:O,runAsync:B}=(0,b.Z)((i=(0,l._)(function*(o){yield C.tm.DeleteConnector(o)}),function(o){return i.apply(this,arguments)}),{manual:!0});var q=(0,x.Z)((u=(0,l._)(function*(t){try{var l=yield S(t);o(null==l?void 0:l.callback_token,t)}catch(o){console.error(o),o instanceof Error&&y.E7.errorEvent({eventName:g.b.CreateCustomPlat,error:o,meta:{error:o}}),null==e||e()}}),function(o){return u.apply(this,arguments)}));var D=(0,x.Z)((p=(0,l._)(function*(t){try{var l=yield M(t);o(null==l?void 0:l.callback_token,t)}catch(o){console.error(o),o instanceof Error&&y.E7.errorEvent({eventName:g.b.UpdateCustomPlat,error:o,meta:{error:o}}),null==e||e()}}),function(o){return p.apply(this,arguments)}));var R=(0,x.Z)((m=(0,l._)(function*(t){try{yield B(t),o(void 0,t)}catch(o){console.error(o),o instanceof Error&&y.E7.errorEvent({eventName:g.b.DeleteCustomPlat,error:o,meta:{error:o}}),null==e||e()}}),function(o){return m.apply(this,arguments)}));return(0,s.useEffect)(()=>{j()},[]),{oauthOptionsList:P,spaceOptionList:T,isLoadingSpace:N,isLoadingOauthDatasource:Z,isIdle:!L&&!O&&!I,doDel:R,doUpdate:D,doCreate:q,doAsyncGetOauthData:F,doAsyncGetSpaceList:j,doCopy:o=>{try{if(!h()(o))throw Error(_.o.t("copy_failed"));d.Toast.success({content:_.o.t("copy_success"),showClose:!1})}catch(o){o instanceof Error&&d.Toast.warning({content:o.message,showClose:!1})}}}},k=o=>{var e,t,{actionTarget:v,onCancel:h,onOk:b}=o,[x]=(0,m.V)(),{doCreate:g,doDel:y,doUpdate:z,doAsyncGetOauthData:C,spaceOptionList:k,oauthOptionsList:N,isLoadingOauthDatasource:j,isIdle:E,doCopy:T}=w(b),A=(0,c.y6)(),Z=(0,s.useRef)(null);var F=(e=(0,l._)(function*(){try{if("delete"===v.action){var o;y({id:null==v?void 0:null===(o=v.payload)||void 0===o?void 0:o.id})}else{yield null===(e=Z.current)||void 0===e?void 0:e.formApi.validate();var e,t,l,n,i,s=null===(t=Z.current)||void 0===t?void 0:t.formApi.getValues(),c=(0,r._)((0,a._)({},s),{connector_icon_uri:null==s?void 0:null===(n=s.avatar)||void 0===n?void 0:null===(l=n[0])||void 0===l?void 0:l.uid,id:null==v?void 0:null===(i=v.payload)||void 0===i?void 0:i.id});"create"===v.action?g(c):z(c)}}catch(o){console.error(o)}}),function(){return e.apply(this,arguments)}),P=(0,n.jsxs)(d.Space,{spacing:8,className:"p-[8px] cursor-pointer w-full",children:[(0,n.jsx)(p.PwN,{className:"text-[var(--coz-fg-hglt)]"}),(0,n.jsx)(i.NavLink,{className:"text-[var(--coz-fg-hglt)] text-[14px] font-normal leading-[20px] no-underline",to:"/open/oauth/apps",target:"_blank",children:_.o.t("coze_custom_publish_platform_21")})]});return"platform"===v.target&&"view"===v.action?(0,n.jsxs)(d.Modal,{visible:!0,width:480,title:_.o.t("coze_custom_publish_platform_55"),footer:null,onCancel:h,children:[(0,n.jsx)("p",{className:"px-[8px] py-[6px] text-[12px] not-italic text-[var(--coz-fg-secondary)]",children:_.o.t("coze_custom_publish_platform_57")}),(0,n.jsxs)(d.Space,{spacing:8,children:[(0,n.jsx)(d.Input,{disabled:!0,value:null===(t=v.payload)||void 0===t?void 0:t.token,className:"w-[360px]"}),(0,n.jsx)(d.Button,{color:"highlight",onClick:()=>{var o;return T(null===(o=v.payload)||void 0===o?void 0:o.token)},children:_.o.t("coze_custom_publish_platform_58")})]})]}):"platform"===v.target&&"delete"===v.action?(0,n.jsx)(d.Modal,{visible:!0,width:320,title:_.o.t("coze_custom_publish_platform_39"),okText:_.o.t("coze_custom_publish_platform_38"),okButtonColor:"red",cancelText:_.o.t("coze_custom_publish_platform_27"),onOk:F,onCancel:h,children:_.o.t("coze_custom_publish_platform_56")}):(0,n.jsx)(d.Modal,{width:480,title:"create"===v.action?_.o.t("coze_custom_publish_platform_3"):_.o.t("coze_custom_publish_platform_37"),okText:_.o.t("coze_custom_publish_platform_28"),cancelText:_.o.t("coze_custom_publish_platform_27"),visible:!0,onCancel:h,onOk:F,okButtonProps:{loading:!E},children:(0,n.jsxs)(d.Form,{ref:Z,initValues:null==v?void 0:v.payload,children:[(0,n.jsx)(u.s,{fileBizType:f.ym.BIZ_CONNECTOR_ICON,iconType:f.Tu.Connector,field:"avatar",noLabel:!0,uploadClassName:"flex justify-center items-center",triggerClassName:"!rounded-[20px] overflow-hidden"}),(0,n.jsx)(d.FormInput,{rules:[{required:!0,message:_.o.t("coze_custom_publish_platform_29")},{max:20,message:_.o.t("workflow_derail_node_detail_title_max",{max:"20"})},{pattern:/^[A-Za-z0-9\u4e00-\u9fa5_]+$/g,message:_.o.t("coze_custom_publish_platform_64")}],field:"connector_title",label:_.o.t("coze_custom_publish_platform_16"),placeholder:_.o.t("coze_custom_publish_platform_16")}),(0,n.jsx)(d.FormTextArea,{rules:[{required:!0,message:_.o.t("coze_custom_publish_platform_30")},{max:100,message:_.o.t("workflow_derail_node_detail_title_max",{max:"100"})}],field:"connector_desc",label:_.o.t("coze_custom_publish_platform_17"),placeholder:_.o.t("coze_custom_publish_platform_18"),required:!0,maxCount:100,rows:3}),(0,n.jsx)(d.FormSelect,{rules:[{required:!0,message:_.o.t("coze_custom_publish_platform_31")}],placeholder:(0,n.jsx)("span",{className:"text-[var(--coz-fg-dim)]",children:_.o.t("coze_custom_publish_platform_20")}),field:"oauth_app_id",label:_.o.t("coze_custom_publish_platform_19"),className:"w-full",innerBottomSlot:P,optionList:N,onFocus:()=>C(),loading:j}),x["bot.studio.openapi_callback_manage"]?null:(0,n.jsx)(d.FormInput,{placeholder:_.o.t("coze_custom_publish_platform_24"),field:"callback_url",label:_.o.t("coze_custom_publish_platform_23"),className:"w-full",rules:[{pattern:/^https?:\/\//g,message:_.o.t("coze_custom_publish_platform_32")}]}),A?(0,n.jsx)(d.FormSelect,{rules:[{required:!0,message:_.o.t("coze_custom_publish_platform_34")}],maxTagCount:2,multiple:!0,ellipsisTrigger:!0,optionList:k,field:"space_id_list",label:_.o.t("coze_custom_publish_platform_63"),className:"w-full",placeholder:(0,n.jsx)("span",{className:"text-[var(--coz-fg-dim)]",children:_.o.t("coze_custom_publish_platform_26")}),showRestTagsPopover:!0}):null]})})}}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2232/38665.5be91a58.js.map