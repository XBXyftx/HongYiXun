"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["7179"],{106773:function(e,t,a){a.d(t,{_:function(){return i}});var n=a(16242),o=a(719629),r=new(a(215896)).b({mark:"InputSlot"}),i=(e,t)=>{if(!!e){var{mode:a="input",placeholder:i=n.o.t("edit_block_guidance_text_placeholder")}=null!=t?t:{},{selection:l}=e.$view.state,s=e.$view.state.selection.main,c=e.$view.state.sliceDoc(s.from,s.to),d=r.extractTemplateContent(c),{open:u,template:m,textContent:f}=r.generateTemplateJson({content:d,data:{placeholder:i,mode:a}}),p=s.from+u.length,g=p+f.length;e.$view.dispatch({changes:{from:s.from,to:s.to,insert:m}}),setTimeout(()=>{e.$view.dispatch({selection:l.replaceRange(o.jT.range(p,g))})},100)}}},964066:function(e,t,a){a.d(t,{g7:()=>T,tQ:()=>I,eJ:()=>U,Vv:()=>J});var n=a("938809"),o=a("723530"),r=a("75591"),i=a("571375"),l=a("16242"),s=a("182956"),c=e=>{var[t,a]=(0,o.useState)(""),{direction:r,placeholder:c,value:d}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(s.Popover,{rePosKey:t,visible:e.visible,trigger:"custom",position:r,autoAdjustOverflow:!0,content:(0,n.jsxs)("div",{className:"flex flex-col gap-2 pt-3 pb-4 px-4 w-[320px]",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:l.o.t("edit_block_guidance_text_when_empty")}),(0,n.jsx)(s.Input,{value:c,placeholder:l.o.t("edit_block_guidance_text_placeholder"),onChange:t=>{var a;return null===(a=e.onPlaceholderChange)||void 0===a?void 0:a.call(e,t)},onBlur:()=>{if(!c){var t;null===(t=e.onPlaceholderChange)||void 0===t||t.call(e,l.o.t("edit_block_guidance_text_placeholder"))}}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:l.o.t("edit_block_prefilled_text")}),(0,n.jsx)(s.Input,{value:d,placeholder:l.o.t("edit_block_default_guidance_text"),onChange:t=>{var a;return null===(a=e.onValueChange)||void 0===a?void 0:a.call(e,t)}})]})]}),children:(0,n.jsx)(i.Iq,{position:e.positon,onChange:()=>a(String(Math.random()))})})})},d=e=>{var{direction:t,templateParser:a}=e,i=(0,r.jE)(),[l,s]=(0,o.useState)(""),[d,u]=(0,o.useState)(""),[m,f]=(0,o.useState)(!1),[p,g]=(0,o.useState)(-1);return(0,o.useEffect)(()=>{if(!!i){var e=e=>{if(e.docChanged){var{state:t}=e,n=a.getCursorInMarkNodeRange(t);if(!n)return;var o=t.sliceDoc(n.open.to,n.close.from);if(o===d)return;u(o)}if(e.selectionSet){var r,{state:l}=e,c=a.getCursorInMarkNodeRange(l);if(!c){g(-1),f(!1);return}var m=a.getCursorTemplateContent(i),{placeholder:p}=null!==(r=a.getCursorTemplateData(l))&&void 0!==r?r:{};s(p),u(null!=m?m:""),g(c.open.from),f(!0)}};return i.$on("viewUpdate",e),()=>{i.$off("viewUpdate",e)}}},[i,d]),(0,n.jsx)(c,{visible:m,positon:p,direction:t,placeholder:l,value:d,onPlaceholderChange:e=>{if(!!i&&!!m)s(e),a.updateCursorTemplateData(i,{placeholder:e})},onValueChange:e=>{if(!!i&&!!m)u(e),a.updateCursorTemplateContent(i,e)}})},u=a("866466"),m=a.n(u),f=a("462669"),p=a.n(f),g=a("318249"),v=a.n(g),h=a("294754"),j=a.n(h),w=a("13355"),x=a.n(w),k=a("876846"),b=a.n(k),N=a("690239"),S={};S.styleTagTransform=b(),S.setAttributes=j(),S.insert=v().bind(null,"head"),S.domAPI=p(),S.insertStyleElement=x(),m()(N.Z,S),N.Z&&N.Z.locals&&N.Z.locals;var C=a("112137"),y=a("659118"),_=a("215896"),E=a("404590"),$=new _.b({mark:"InputSlot"}),J=e=>{var{mode:t,onSelectionInInputSlot:a}=e,i=(0,r.G6)(),l=(0,r.jE)(),s=(0,E.j)();return((0,o.useLayoutEffect)(()=>{var{markInfoField:e}=$;return i.inject([C.Cj.whole.of((e,t)=>{if($.isOpenNode(e.node,t)){var a=e.node,n=$.findCloseNode(a,t);if(n){var o=t.sliceDoc(a.from,a.to),r=$.getData(o),i=a.to,l=n.from;return i===l?[{type:"replace",widget:new y.S9({className:"slot-side-left"}),atomicRange:!0,from:a.from,to:a.to},{type:"widget",widget:new y.S9({text:(null==r?void 0:r.placeholder)||"",className:"slot-placeholder"}),from:i,atomicRange:!0,side:1},{type:"replace",widget:new y.S9({className:"slot-side-right"}),atomicRange:!0,from:n.from,to:n.to}]:[{type:"replace",widget:new y.S9({className:"slot-side-left"}),atomicRange:!0,from:a.from,to:a.to},{type:"className",className:"slot-content",from:i,to:l},{type:"replace",widget:new y.S9({className:"slot-side-right"}),atomicRange:!0,from:n.from,to:n.to}]}}}),e,C.Pu.of(t=>t.field(e).contents),C._h.of(t=>t.field(e).specs),C.bi.of(t=>t.field(e).specs)])},[i]),(0,o.useEffect)(()=>{if(!!l){var e=e=>{if(!e.state.selection.main.empty){var t=$.getSelectionInMarkNodeRange(e.state.selection.main,e.state);if(t){null==a||a(t);return}null==a||a(void 0)}};return l.$on("viewUpdate",e),()=>{l.$off("viewUpdate",e)}}},[l]),"configurable"!==t||s)?null:(0,n.jsx)(d,{direction:"bottomLeft",templateParser:$})};a("106773");var R=new _.b({mark:"InputSlot"}),T=()=>{var e=(0,r.jE)(),[t,a]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{if(!!e){var t=e=>{if(e.selectionSet){if(R.getSelectionInMarkNodeRange(e.state.selection.main,e.state)){a(!0);return}a(!1)}};return e.$on("viewUpdate",t),()=>{e.$off("viewUpdate",t)}}},[e]),t},I=()=>{var e=(0,r.jE)(),[t,a]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{if(!!e){var t=e=>{if(!e.state.selection.main.empty){if(R.getSelectionInMarkNodeRange(e.state.selection.main,e.state)){a(!0);return}a(!1)}};return e.$on("viewUpdate",t),()=>{e.$off("viewUpdate",t)}}},[e]),t},M=a("319534"),U=()=>{var e=(0,r.jE)(),[t,a]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{if(!!e){var t=()=>{var t=e.getSelection();if(!t){a(!1);return}var{state:n}=e.$view,o=(0,M.qz)(n).cursor(),r=!1;do if("RawText"===o.name&&o.from<=t.from&&o.to>=t.to){r=!0;break}while(o.next());a(r)};return e.$on("viewUpdate",t),t(),()=>{e.$off("viewUpdate",t)}}},[e]),t}},936871:function(e,t,a){a.d(t,{hT:()=>j,jE:()=>i.jE,GH:()=>l.GH,gv:()=>h});var n=a("938809"),o=a("723530"),r=a("416304"),i=a("75591"),l=a("571375"),s=a("93752"),c=a("548649"),d=a("112137"),u=a("740471"),m="lowest",f="lowest",p={Markdown:function(){var e=(0,i.G6)();return(0,o.useLayoutEffect)(()=>e.inject([d.Cj.whole.of(e=>e.name.startsWith("ATXHeading")?{type:"className",className:"markdown-heading",prec:m}:"Emphasis"===e.name?{type:"className",className:"markdown-emphasis",prec:m}:"StrongEmphasis"===e.name?{type:"className",className:"markdown-strong-emphasis",prec:m}:"ListMark"===e.name||"QuoteMark"===e.name?{type:"className",className:"markdown-mark",prec:m}:void 0),u.tk.theme({".markdown-heading":{color:"#00818C",fontWeight:"500"},".markdown-emphasis":{fontStyle:"italic"},".markdown-strong-emphasis":{fontWeight:"bold"},".markdown-mark":{color:"#4E40E5"}})]),[e]),null},Jinja:function(){var e=(0,i.G6)();return(0,o.useLayoutEffect)(()=>e.inject([d.Cj.whole.of(e=>"JinjaStatement"===e.name||"JinjaRawOpenStatement"===e.name||"JinjaRawCloseStatement"===e.name?{type:"className",className:"jinja-statement",prec:f}:"JinjaStringLiteral"===e.name?{type:"className",className:"jinja-string",prec:f}:"JinjaComment"===e.name?{type:"className",className:"jinja-comment",prec:f}:"JinjaExpression"===e.name?{type:"className",className:"jinja-expression",prec:f}:"JinjaFilterName"===e.name||"JinjaStatementStart"===e.name||"JinjaStatementEnd"===e.name||"JinjaKeyword"===e.name||"JinjaFilterName"===e.name?{type:"className",className:"jinja-statement-keyword",prec:f}:void 0),u.tk.theme({".jinja-statement":{color:"#060709CC"},".jinja-statement-keyword":{color:"#D1009D"},".jinja-string":{color:"#060709CC"},".jinja-comment":{color:"#0607094D"},".jinja-expression":{color:"#4E40E5"}})]),[e]),null}};function g(){var e=(0,i.G6)();return(0,o.useLayoutEffect)(()=>e.inject([s.Q$]),[e]),null}var v=u.tk.theme({".cm-content":{color:"rgba(6, 7, 9, 0.80)"},".cm-line":{lineHeight:"24px",paddingLeft:"12px"},".cm-cursor":{height:"20px !important"}}),h=e=>{var{readonly:t,placeholder:a,defaultValue:d,className:u,dataTestID:m,value:f,onChange:h,onFocus:j,onBlur:w,options:x,isControlled:k,getEditor:b,enableJinja:N=!0}=e,S=(0,o.useRef)(null),C=(0,i.jE)();(0,o.useEffect)(()=>{if(!!C&&!!w)return C.$on("blur",w),()=>{C.$off("blur",w)}},[C,w]),(0,o.useEffect)(()=>{if(!!C&&!!j)return C.$on("focus",j),()=>{C.$off("focus",j)}},[C,j]),(0,o.useEffect)(()=>{var e=S.current;if(!!e&&!!k&&!!C){var t=e.getValue();"string"==typeof f&&f!==t&&C.$view.dispatch({changes:{from:0,to:C.$view.state.doc.length,insert:null!=f?f:""}})}},[k,f,C]);var y=(0,o.useCallback)(e=>{"function"==typeof h&&h(e.value)},[h]),_=(0,o.useMemo)(()=>({class:null!=u?u:"","data-testid":null!=m?m:""}),[u,m]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Th,{plugins:s.ZP,defaultValue:d,options:(0,r.Z)({fontSize:14,contentAttributes:_,editable:!t,readOnly:t},x),onChange:y,didMount:e=>{S.current=e,b&&b(e)}}),(0,n.jsx)(l.Vm,{children:a}),(0,n.jsx)(c.G,{themes:[v]}),(0,n.jsx)(g,{}),(0,n.jsx)(p.Markdown,{}),(0,n.jsx)(p.Jinja,{}),N?(0,n.jsx)(p.Jinja,{}):null]})},j=e=>{var{children:t}=e;return(0,n.jsx)(i.KU,{children:t})}},690239:function(e,t,a){var n=a(160052),o=a.n(n),r=a(570717),i=a.n(r)()(o());i.push([e.id,".cm-content .slot-content{background-color:rgba(186,192,255,.2);color:#4e40e5;word-break:break-all}.cm-content .slot-side-left{background-color:rgba(186,192,255,.2);border-radius:4px 0 0 4px;padding-left:5px}.cm-content .slot-side-right{background-color:rgba(186,192,255,.2);border-radius:0 5px 5px 0;margin-right:4px;padding-right:5px}.cm-content .slot-placeholder{background-color:rgba(186,192,255,.2);color:rgba(148,152,247,.7);word-break:break-all}",""]),t.Z=i}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2232/7179.f534b264.js.map