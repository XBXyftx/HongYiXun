"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["40964"],{77088:function(e,t,n){n.d(t,{OL:function(){return a}});var r,a=((r={})[r.PendingVectoring=0]="PendingVectoring",r[r.FinishVectoring=1]="FinishVectoring",r[r.Deactive=9]="Deactive",r[r.AuditFailed=1e3]="AuditFailed",r)},96888:function(e,t,n){n.d(t,{OR:function(){return o},YB:function(){return i}});var r=n(723530),a=n(320862),i=(0,a.Z)(),o=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];(0,r.useEffect)(()=>(i.on(e,t),()=>{i.off(e,t)}),n)}},371202:function(e,t,n){n.d(t,{Hu:()=>p,i1:()=>s,ye:()=>h,sL:()=>c,$j:()=>v});var r=n("938809");n("723530");var a=n("543473"),i=n("16242"),o=n("988726"),l=n("182956"),d=n("96888"),s=e=>{var{chunk:t,disabled:n}=e;return(0,r.jsx)(l.Tooltip,{content:i.o.t("datasets_segment_edit"),clickToHide:!0,autoAdjustOverflow:!0,children:(0,r.jsx)(l.IconButton,{"data-dtestid":"".concat(a.w.SegmentDetailContentItemEditIcon,".").concat(t.data_editor_chunk_uuid),size:"small",color:"secondary",disabled:n,icon:(0,r.jsx)(o.JAz,{className:"text-[14px]"}),iconPosition:"left",className:"coz-fg-secondary leading-none !w-6 !h-6",onClick:()=>{d.YB.emit("hoverEditBarAction",{type:"edit",targetChunk:t})}})})},u=n("363530"),c=e=>{var{chunk:t,chunks:n=[],disabled:a}=e,{deleteChunk:s}=(0,u.S)({chunks:n,onChunksChange:e=>{var{chunks:n}=e;d.YB.emit("hoverEditBarAction",{type:"delete",targetChunk:t,chunks:n})}});return(0,r.jsx)(l.Tooltip,{content:i.o.t("knowledge_level_028"),clickToHide:!0,autoAdjustOverflow:!0,children:(0,r.jsx)(l.IconButton,{size:"small",color:"secondary",disabled:a,icon:(0,r.jsx)(o.dVD,{className:"text-[14px]"}),iconPosition:"left",className:"coz-fg-secondary leading-none !w-6 !h-6",onClick:()=>s(t)})})},v=e=>{var{chunk:t,chunks:n=[],disabled:s}=e,{addEmptyChunkBefore:c}=(0,u.i)({chunks:n,onChunksChange:e=>{var{newChunk:n,chunks:r}=e;d.YB.emit("hoverEditBarAction",{type:"add-before",targetChunk:t,chunks:r,newChunk:n})}});return(0,r.jsx)(l.Tooltip,{content:i.o.t("knowledge_optimize_017"),clickToHide:!0,autoAdjustOverflow:!0,children:(0,r.jsx)(l.IconButton,{"data-dtestid":"".concat(a.w.SegmentDetailContentItemAddTopIcon,".").concat(t.data_editor_chunk_uuid),size:"small",color:"secondary",disabled:s,icon:(0,r.jsx)(o.wu0,{className:"text-[14px]"}),iconPosition:"left",className:"coz-fg-secondary leading-none !w-6 !h-6",onClick:()=>c(t)})})},h=e=>{var{chunk:t,chunks:n,disabled:s}=e,{addEmptyChunkAfter:c}=(0,u.i)({chunks:n||[],onChunksChange:e=>{var{newChunk:n,chunks:r}=e;d.YB.emit("hoverEditBarAction",{type:"add-after",targetChunk:t,chunks:r,newChunk:n})}});return(0,r.jsx)(l.Tooltip,{content:i.o.t("knowledge_optimize_016"),clickToHide:!0,autoAdjustOverflow:!0,children:(0,r.jsx)(l.IconButton,{"data-dtestid":"".concat(a.w.SegmentDetailContentItemAddBottomIcon,".").concat(t.data_editor_chunk_uuid),size:"small",color:"secondary",disabled:s,icon:(0,r.jsx)(o.BPm,{className:"text-[14px]"}),iconPosition:"left",className:"coz-fg-secondary leading-none !w-6 !h-6",onClick:()=>c(t)})})},m=n("607027"),p=e=>new m.j({name:e})},888779:function(e,t,n){n.d(t,{Cd:()=>_,i1:()=>u,ye:()=>m,sL:()=>v,$j:()=>h});var r=n("938809");n("723530");var a=n("856306"),i=n.n(a),o=n("16242"),l=n("988726"),d=n("182956"),s=n("96888"),u=e=>{let t,n;var{chunk:a,disabled:u}=e;return(0,r.jsx)(d.Menu.Item,{disabled:u,icon:(0,r.jsx)(l.JAz,{className:(t=!!u,i()("w-3.5 h-3.5",{"opacity-30":t}))}),onClick:()=>{s.YB.emit("previewContextMenuItemAction",{type:"edit",targetChunk:a})},className:(n=!!u,i()("h-8 px-2 py-2 text-xs rounded-lg",{"cursor-not-allowed":n})),children:o.o.t("Edit")})},c=n("363530"),v=e=>{let t,n;var{chunk:a,chunks:u=[],disabled:v}=e,{deleteChunk:h}=(0,c.S)({chunks:u,onChunksChange:e=>{var{chunks:t}=e;s.YB.emit("previewContextMenuItemAction",{type:"delete",targetChunk:a,chunks:t})}});return(0,r.jsx)(d.Menu.Item,{disabled:v,icon:(0,r.jsx)(l.dVD,{className:(t=!!v,i()("w-3.5 h-3.5",{"opacity-30":t}))}),onClick:()=>h(a),className:(n=!!v,i()("h-8 px-2 py-2 text-xs rounded-lg",{"cursor-not-allowed":n})),children:o.o.t("Delete")})},h=e=>{let t,n;var{chunk:a,chunks:u=[],disabled:v}=e,{addEmptyChunkBefore:h}=(0,c.i)({chunks:u,onChunksChange:e=>{var{newChunk:t,chunks:n}=e;s.YB.emit("previewContextMenuItemAction",{type:"add-before",targetChunk:a,newChunk:t,chunks:n})}});return(0,r.jsx)(d.Menu.Item,{disabled:v,icon:(0,r.jsx)(l.wu0,{className:(t=!!v,i()("w-3.5 h-3.5",{"opacity-30":t}))}),onClick:()=>h(a),className:(n=!!v,i()("h-8 px-2 py-2 text-xs rounded-lg",{"cursor-not-allowed":n})),children:o.o.t("knowledge_optimize_017")})},m=e=>{let t,n;var{chunk:a,chunks:u=[],disabled:v}=e,{addEmptyChunkAfter:h}=(0,c.i)({chunks:u,onChunksChange:e=>{var{newChunk:t,chunks:n}=e;s.YB.emit("previewContextMenuItemAction",{type:"add-after",newChunk:t,targetChunk:a,chunks:n})}});return(0,r.jsx)(d.Menu.Item,{disabled:v,icon:(0,r.jsx)(l.BPm,{className:(t=!!v,i()("w-3.5 h-3.5",{"opacity-30":t}))}),onClick:()=>h(a),className:(n=!!v,i()("h-8 px-2 py-2 text-xs rounded-lg",{"cursor-not-allowed":n})),children:o.o.t("knowledge_optimize_016")})},p=n("607027"),_=e=>new p.j({name:e})},415394:function(e,t,n){n.d(t,{z:function(){return l}});var r=n(255721),a=n(559293),i=n(618016),o=n(154022),l=()=>{var e,{runAsync:t}=(0,a.Z)((e=(0,r._)(function*(e){var t,{slice_id:n}=e;if(!n)throw new i.sH("normal_error","missing slice_id");var r=null===(t=o.J.getState().params.customRequest)||void 0===t?void 0:t.deleteRemoteChunk;if(!r)return null;yield null==r?void 0:r(e)}),function(t){return e.apply(this,arguments)}),{manual:!0});return{deleteSlice:t}}},363530:function(e,t,n){n.d(t,{S:()=>l,i:()=>i});var r=n("723530"),a=n("509061"),i=e=>{var{chunks:t,onChunksChange:n}=e,i=(0,r.useRef)(t);return(0,r.useEffect)(()=>{i.current=t},[t]),{addEmptyChunkAfter:e=>{var t,r,o=i.current,l=o.findIndex(t=>t.data_editor_chunk_uuid===e.data_editor_chunk_uuid);if(-1!==l){var d=null!==(r=null===(t=o.find(t=>t.data_editor_chunk_uuid===e.data_editor_chunk_uuid))||void 0===t?void 0:t.sequence)&&void 0!==r?r:"1",s=(0,a.k8)({sequence:String(Number(d)+1)}),u=[...o.slice(0,l+1),s,...o.slice(l+1)];null==n||n({newChunk:s,chunks:u})}},addEmptyChunkBefore:e=>{var t,r,o=i.current,l=o.findIndex(t=>t.data_editor_chunk_uuid===e.data_editor_chunk_uuid),d=null!==(r=null===(t=o.find(t=>t.data_editor_chunk_uuid===e.data_editor_chunk_uuid))||void 0===t?void 0:t.sequence)&&void 0!==r?r:"1";if(-1!==l){var s=(0,a.k8)({sequence:d}),u=[...o.slice(0,l),s,...o.slice(l)];null==n||n({newChunk:s,chunks:u})}}}},o=n("415394"),l=e=>{var{chunks:t,onChunksChange:n}=e,a=(0,r.useRef)(t),{deleteSlice:i}=(0,o.z)();return(0,r.useEffect)(()=>{a.current=t},[t]),{deleteChunk:(0,r.useCallback)(e=>{var t=a.current.filter(t=>t.data_editor_chunk_uuid!==e.data_editor_chunk_uuid);if(!!e.slice_id)i(e).then(()=>{null==n||n({chunks:t,targetChunk:e})})},[n,i])}}},312186:function(e,t,n){n.d(t,{R_:()=>x,go:()=>eo,Lh:()=>ew,IF:()=>ex,Fq:()=>eu,Cd:()=>eb.Cd,Pd:()=>P.Pd,hl:()=>es,iF:()=>A,nR:()=>ei,Bo:()=>G,E1:()=>ek,Hu:()=>el.Hu,OR:()=>ed.OR});var r,a=n("938809"),i=n("723530"),o=n("856306"),l=n.n(o),d=n("990488"),s=e=>e?u(e.isEmpty?"":e.getHTML()):"",u=e=>{if(!e)return"";var t=new DOMParser().parseFromString(e,"text/html");return t.querySelectorAll("p.text-knowledge-tiptap-editor-paragraph").forEach(e=>{var t=e.parentNode;if(t){for(var n=document.createDocumentFragment();e.firstChild;)n.appendChild(e.firstChild);t.replaceChild(n,e)}}),t.body.innerHTML},c=()=>l()("[&_p]:break-words [&_p]:whitespace-pre-wrap","[&_.ProseMirror_*]:break-words [&_.ProseMirror_*]:whitespace-pre-wrap","[&_.editor-paragraph]:min-h-[1.5em] [&_.editor-paragraph]:leading-normal","[&_.editor-paragraph:empty]:min-h-[1.5em] [&_.editor-paragraph:empty]:block"),v=()=>l()("[&_table]:border-collapse [&_table]:m-0 [&_table]:w-full [&_table]:table-fixed [&_table]:overflow-hidden [&_table]:text-[0.9em]","[&_table_td]:border [&_table_th]:border [&_table_td]:border-[#ddd] [&_table_th]:border-[#ddd]","[&_table_td]:p-2 [&_table_th]:p-2","[&_table_td]:relative [&_table_th]:relative","[&_table_td]:align-top [&_table_th]:align-top","[&_table_td]:box-border [&_table_th]:box-border","[&_table_td]:border-solid [&_table_th]:border-solid","[&_table_td]:min-w-[100px] [&_table_th]:min-w-[100px]"),h=()=>l()("[&_img]:relative [&_img]:block","[&_img]:my-3 [&_img]:bg-white [&_img]:rounded-md","[&_img]:max-w-[610px] [&_img]:max-h-[367px] [&_img]:w-auto","[&_img.ProseMirror-selectednode]:outline-2 [&_img.ProseMirror-selectednode]:outline [&_img.ProseMirror-selectednode]:outline-blue-500","[&_img.ProseMirror-selectednode]:shadow-md"),m=n("464266"),p=e=>{var{editorRef:t,exclude:n,onExitEditMode:r}=e,{run:a}=(0,m.Z)(()=>{null==r||r()},{wait:500});(0,i.useEffect)(()=>{var e=e=>{t.current&&!t.current.contains(e.target)&&!(null==n?void 0:n.some(t=>{var n;return null===(n=t.current)||void 0===n?void 0:n.contains(e.target)}))&&a()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[t,n,a])},_=e=>{var{contextMenuRef:t}=e,[n,r]=(0,i.useState)(null),a=()=>{r(null)};return(0,i.useEffect)(()=>{var e=e=>{t.current&&!t.current.contains(e.target)&&a()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[]),{contextMenuPosition:n,openContextMenu:e=>{e.preventDefault();var t=e.currentTarget.getBoundingClientRect();r({x:e.clientX-t.left,y:e.clientY-t.top})},closeContextMenu:a}},f=n("182956"),g=e=>{var{editorActionRegistry:t,readonly:n,contextMenuRef:r,x:i,y:o,editor:d}=e;return n?null:(0,a.jsx)("div",{ref:r,className:"absolute bg-white shadow-lg rounded-md py-1 z-50",style:{top:"".concat(o,"px"),left:"".concat(i,"px")},children:(0,a.jsx)(f.Menu,{visible:!0,clickToHide:!0,keepDOM:!0,position:"bottomLeft",spacing:-4,trigger:"custom",getPopupContainer:()=>{var e;return null!==(e=r.current)&&void 0!==e?e:document.body},className:l()("coz-shadow-large"),render:(0,a.jsx)(f.Menu.SubMenu,{className:l()("p-1"),mode:"menu",children:t.entries().map(e=>{var[t,{Component:n}]=e;return(0,a.jsx)(n,{editor:d},t)})})})})},x=e=>{var{editor:t,placeholder:n,editorContextMenuItemsRegistry:r,editorBottomSlot:o,onBlur:u}=e,m=(0,i.useRef)(null),f=(0,i.useRef)(null),{contextMenuPosition:x,openContextMenu:k}=_({contextMenuRef:f});return(p({editorRef:m,exclude:[f],onExitEditMode:()=>{var e=s(t);null==u||u(e)}}),t)?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{ref:m,className:l()("relative","mb-2 p-2","text-sm leading-5","coz-fg-primary coz-bg-max","border border-solid coz-stroke-hglt rounded-lg"),onContextMenu:k,children:(0,a.jsxs)("div",{className:l()(v(),h(),c()),children:[(0,a.jsx)(d.kg,{editor:t,placeholder:n}),o]})}),x&&r?(0,a.jsx)(g,{x:x.x,y:x.y,contextMenuRef:f,editor:t,editorActionRegistry:r}):null]}):null},k=()=>{var[e,t]=(0,i.useState)(null);return{hoveredChunk:e,handleMouseEnter:e=>{t(e)},handleMouseLeave:()=>{t(null)}}},y=n("964207"),w=n.n(y),b=["img","table","colgroup","col","tbody","thead","tfoot","tr","td","th","br","p"],j=e=>""===e?"":(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;if(!e)return"";var n=t.join("|"),r=RegExp("<(?!(".concat(n,")\\b[^>]*>|\\/(?:").concat(n,")>)"),"g");return e.replace(r,"&lt;")})(e).replace(/\n/g,"<br />"),C=n.p+"static/image/image-fail.9734ba0f.png",N=e=>{var t,n,{chunk:r,locateId:o,className:d,bottomSlot:s}=e,u=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(u.current){var e=u.current.getElementsByTagName("img");e&&Array.from(e).forEach(e=>{e.addEventListener("error",e=>{e.target&&(e.target.src=C)})})}},[r]),(0,a.jsxs)("div",{id:o,ref:u,className:l()("relative","mb-2 p-2","text-sm leading-5","coz-fg-primary hover:coz-mg-hglt-secondary-hovered coz-mg-secondary","border border-solid coz-stroke-primary rounded-lg",v(),h(),c(),d),children:[(0,a.jsx)("p",{dangerouslySetInnerHTML:{__html:null!==(n=w().sanitize(j(null!==(t=r.content)&&void 0!==t?t:""),{FORBID_TAGS:["style"]}))&&void 0!==n?n:""}}),s]})},z=e=>{var{previewContextMenuItemsRegistry:t,chunk:n,chunks:r,readonly:i,contextMenuRef:o,x:d,y:s}=e;return i?null:(0,a.jsx)("div",{ref:o,className:"absolute bg-white shadow-lg rounded-md py-1 z-50",style:{top:"".concat(s,"px"),left:"".concat(d,"px")},children:(0,a.jsx)(f.Menu,{visible:!0,position:"bottomLeft",spacing:-4,trigger:"custom",getPopupContainer:()=>{var e;return null!==(e=o.current)&&void 0!==e?e:document.body},className:l()("rounded-lg"),render:(0,a.jsx)(f.Menu.SubMenu,{className:l()("w-40 p-1"),mode:"menu",children:t.entries().map(e=>{var[t,{Component:i}]=e;return(0,a.jsx)(i,{chunk:n,chunks:r},t)})})})})},E=n("16242"),M=n("988726"),T=n("77088"),I=e=>{var{chunk:t,chunks:n,disabled:r,hoverEditBarActionsRegistry:i,onChunksChange:o}=e,d=t.status===T.OL.AuditFailed;return i?(0,a.jsxs)("div",{className:"absolute top-[2px] right-[2px] flex z-10",children:[r?null:(0,a.jsx)("div",{className:l()("p-1 coz-bg-plus rounded-lg","coz-shadow-default"),children:(0,a.jsx)(f.Space,{spacing:3,children:i.entries().map(e=>{var[r,{Component:i}]=e;return(0,a.jsx)(i,{chunk:t,chunks:n,onChunksChange:o},r)})})}),d?(0,a.jsx)("div",{className:l()("p-1 coz-bg-plus rounded-lg","coz-shadow-default","ml-1"),children:(0,a.jsx)(f.Tooltip,{content:E.o.t("community_This_is_a_toast_Machine_review_failed"),clickToHide:!0,autoAdjustOverflow:!0,children:(0,a.jsx)(f.IconButton,{icon:(0,a.jsx)(M.L03,{className:"text-[14px] coz-fg-hglt-red"}),size:"small",color:"secondary",className:"coz-fg-secondary leading-none !w-6 !h-6"})})}):null]}):null},A=i.memo(e=>{var{chunkClassName:t,chunk:n,chunks:r,readonly:o=!1,locateId:d,onActivateEditMode:s,hoverEditBarActionsRegistry:u,previewContextMenuItemsRegistry:c,bottomSlot:v}=e,h=(0,i.useRef)(null),{hoveredChunk:m,handleMouseEnter:p,handleMouseLeave:f}=k(),{contextMenuPosition:g,openContextMenu:x}=_({contextMenuRef:h});return(0,a.jsxs)("div",{className:l()("relative"),children:[(0,a.jsxs)("div",{className:l()("relative overflow-hidden"),onContextMenu:o?void 0:e=>x(e),onMouseEnter:o?void 0:()=>p(n.data_editor_chunk_uuid),onMouseLeave:o?void 0:f,onDoubleClick:o?void 0:()=>null==s?void 0:s(n),children:[m!==n.data_editor_chunk_uuid||o?null:(0,a.jsx)(I,{chunk:n,chunks:r,hoverEditBarActionsRegistry:u}),(0,a.jsx)(N,{chunk:n,locateId:d||"",className:t,bottomSlot:v})]}),g?(0,a.jsx)(z,{previewContextMenuItemsRegistry:c,x:g.x,y:g.y,chunk:n,chunks:r,readonly:o,contextMenuRef:h}):null]})},(e,t)=>e.chunk.content===t.chunk.content&&e.chunks===t.chunks&&!0),R=n("255721"),B=e=>{if(!e)return"";var t=e.match(RegExp("^<p>(.*?)<\\/p>$","s"));return t?t[1]:e},L=(e,t)=>{var n,r;return B(null!==(r=t.content)&&void 0!==r?r:"")!==(null===(n=e.find(e=>e.slice_id===t.slice_id))||void 0===n?void 0:n.content)},P=n("509061"),S=n("559293"),H=n("618016"),D=n("154022"),F=()=>{var e,{runAsync:t,loading:n}=(0,S.Z)((e=(0,R._)(function*(e){var t,{slice_id:n}=e;if(!n)throw new H.sH("normal_error","missing slice_id");var r=null===(t=D.J.getState().params.customRequest)||void 0===t?void 0:t.updateRemoteChunk;return r?(yield null==r?void 0:r(e),e):null}),function(t){return e.apply(this,arguments)}),{manual:!0});return{updateSlice:t,updateLoading:n}},O=e=>{var t,{chunks:n,onChunksChange:r,onUpdateChunk:a}=e,{updateSlice:i}=F();return{updateRemoteChunk:(t=(0,R._)(function*(e){if(!e.slice_id){f.Toast.error("The slice ID does not exist. Please refresh the page");return}if(!L(n,e)){null==r||r(n);return}yield i(e);var t=(0,P.PU)(n,e);null==a||a(e),null==r||r(t)}),function(e){return t.apply(this,arguments)})}},q=n("341333"),K=n("415394"),U=e=>{var t,{chunks:n,onChunksChange:r,onDeleteChunk:a}=e,{deleteSlice:i}=(0,K.z)();return{deleteRemoteChunk:(t=(0,R._)(function*(e){if(!!e.slice_id){yield i((0,q._)({slice_id:e.slice_id},e));var t=(0,P.Qe)(n,e.slice_id);null==r||r(t),null==a||a(e)}}),function(e){return t.apply(this,arguments)})}},Z=e=>{var{chunks:t,onChunksChange:n}=e;return{deleteLocalChunk:e=>{if(!!e.local_slice_id){var r=(0,P.wL)(t,e.local_slice_id);null==n||n(r)}}}},W=n("972344"),Y=n("411960"),J=e=>{var t,{documentId:n}=e;var{runAsync:r}=(0,S.Z)((t=(0,R._)(function*(e){if(!n)throw new H.sH("normal_error","missing doc_id");var t,r,a,i,o=null===(t=D.J.getState().params.customRequest)||void 0===t?void 0:t.createRemoteChunk;if(!o)return null;var l=yield null==o?void 0:o(e);return(0,P.bc)({slice_id:null!==(r=null==l?void 0:l.slice_id)&&void 0!==r?r:"",sequence:null!==(a=e.sequence)&&void 0!==a?a:"",content:null!==(i=e.content)&&void 0!==i?i:""})}),function(e){return t.apply(this,arguments)}),{manual:!0,onError:e=>{W.s5.errorEvent(W.xW.KNOWLEDGE,{eventName:Y.b.KnowledgeCreateSlice,error:e})}});return{createChunk:r}},V=e=>{var t,{chunks:n,documentId:r,onChunksChange:a,onAddChunk:i}=e,{createChunk:o}=J({documentId:r});return{createLocalChunk:(t=(0,R._)(function*(e){if(!e.local_slice_id)return;var t=yield o(e);if(!!t){var r=(0,P.Gf)({chunks:n,localChunkSliceId:e.local_slice_id,newChunk:t});null==i||i(t),null==a||a(r)}}),function(e){return t.apply(this,arguments)})}},G=e=>{var t,n,r,{chunks:a,documentId:i,onAddChunk:o,onUpdateChunk:l,onChunksChange:d,onDeleteChunk:s}=e,{createLocalChunk:u}=V({chunks:a,documentId:i,onChunksChange:d,onAddChunk:o}),{updateRemoteChunk:c}=O({chunks:a,onChunksChange:d,onUpdateChunk:l}),{deleteLocalChunk:v}=Z({chunks:a,onChunksChange:d}),{deleteRemoteChunk:h}=U({chunks:a,onChunksChange:d,onDeleteChunk:s});var m=(t=(0,R._)(function*(e){if(""===e.content){yield h(e);return}yield c(e)}),function(e){return t.apply(this,arguments)});var p=(n=(0,R._)(function*(e){""===e.content?v(e):yield u(e)}),function(e){return n.apply(this,arguments)});return{saveChunk:(r=(0,R._)(function*(e){if(!e.local_slice_id){yield m(e);return}yield p(e)}),function(e){return r.apply(this,arguments)})}},$=n("265489"),Q=n("579142"),X=n("300441"),ee=n("368629"),et=n("336153"),en=n("321143"),er=n("444698"),ea=n("611920").ZP.extend({addAttributes(){var e,t=(null===(e=this.parent)||void 0===e?void 0:e.call(this))||{};return(0,$._)((0,q._)({},t),{dataTosKey:{default:null,parseHTML:e=>e.getAttribute("data-tos-key"),renderHTML:e=>e.dataTosKey?{"data-tos-key":e.dataTosKey}:{}}})},addCommands(){return{setImageWithTosKey:e=>t=>{var n,{commands:r}=t;return r.insertContent({type:this.name,attrs:{src:e.src,alt:e.alt,title:e.title,dataTosKey:null!==(n=e.dataTosKey)&&void 0!==n?n:null}})}}}}),ei=e=>{var{chunk:t,editorProps:n,onChange:r,onInitFailed:a,customRequest:o}=e,l=(0,d.jE)({extensions:[Q.Z.configure({hardBreak:{keepMarks:!1},paragraph:{HTMLAttributes:{class:"text-knowledge-tiptap-editor-paragraph"}}}),en.ZP.configure({resizable:!0}),X.Z,et.Z,ee.Z,ea.configure({inline:!1,allowBase64:!0})],content:j((null==t?void 0:t.content)||""),parseOptions:{preserveWhitespace:"full"},onUpdate:e=>{var{editor:n}=e;if(!!t&&!!n){var a=s(n);null==r||r((0,$._)((0,q._)({},t),{content:a}))}},editorProps:(0,$._)((0,q._)({},n),{handlePaste(e,t,n){if(!l)return!1;var r,a=null===(r=t.clipboardData)||void 0===r?void 0:r.getData("text/plain");if(null==a?void 0:a.includes("\n")){t.preventDefault();var i=j(a);return l.chain().focus().insertContent(i).run(),!0}return!1}})}),u=(0,er.J)(e=>e.setCustomRequest);return(0,i.useEffect)(()=>{if(!!l&&!!t)try{var e=j(t.content||"");l.commands.setContent(e||"",!1,{preserveWhitespace:"full"})}catch(e){f.Toast.error(e.message||"init editor failed, return preview mode"),null==a||a()}},[t,l]),(0,i.useEffect)(()=>{if(!!o)u(o)},[o]),{editor:l}},eo=e=>{var{editor:t,actionRegistry:n}=e;return(0,a.jsx)("div",{className:"h-[32px] box-content px-2 pt-2",children:n.entries().map(e=>{var[n,{Component:r}]=e;return(0,a.jsx)(r,{editor:t},n)})})},el=n("371202"),ed=n("96888"),es=e=>{var{title:t,id:n}=e;return(0,a.jsx)("div",{id:n,className:l()("w-full text-[14px] font-[500] leading-[20px] coz-fg-plus"),children:t})},eu=e=>{var{base64:t,htmlText:n,link:r,caption:i,locateId:o,selected:d}=e;return(0,a.jsxs)("div",{id:o,className:l()("flex items-center flex-col gap-2","w-full p-2 coz-mg-secondary","border border-solid coz-stroke-primary rounded-[8px]",d&&"!coz-mg-hglt"),children:[t?(0,a.jsx)("img",{src:"data:image/jpeg;base64, ".concat(t),className:"w-full h-full"}):null,n?(0,a.jsx)("div",{className:"w-full h-full overflow-auto [&>*]:w-full [&>*]:h-full",dangerouslySetInnerHTML:{__html:w().sanitize(n)}}):null,r?(0,a.jsx)("div",{className:"coz-fg-primary text-[14px] leading-[20px] font-[400] break-all",children:r}):null,i?(0,a.jsx)("div",{className:"coz-fg-primary text-[14px] leading-[20px] font-[400] break-all",children:i}):null]})},ec=n("646411"),ev=n("449001"),eh=e=>0x1400000>e,em=e=>new Promise((t,n)=>{var r=new FileReader;r.onload=e=>{var r,a=null===(r=e.target)||void 0===r?void 0:r.result;if(!a||"string"!=typeof a){n(new H.sH("getBase64","file read invalid"));return}t(a.replace(/^.*?,/,""))},r.onerror=()=>{f.Toast.error(E.o.t("read_file_failed_please_retry")),n(new H.sH("getBase64","file read fail"))},r.onabort=()=>{n(new H.sH("getBase64","file read abort"))},r.readAsDataURL(e)}),ep=e=>{var t=e.lastIndexOf(".");return e.slice(t+1)},e_=e=>{var{customRequest:t,children:n}=e;return(0,a.jsx)(f.Upload,{accept:"image/*",maxSize:20480,fileList:[],customRequest:t,onChange:e=>{var t,{currentFile:n}=e;if(n){;!eh((null==n?void 0:null===(t=n.fileInstance)||void 0===t?void 0:t.size)||0)&&f.Toast.error(E.o.t("knowledge_insert_img_013"))}},children:n})};var ef=(r=(0,R._)(function*(e){var{object:t,options:n}=e,{onSuccess:r,onProgress:a,file:i}=t,{onFinish:o,onFinally:l,onBeforeUpload:d}=n;if("string"!=typeof i)try{null==d||d();var{name:s,fileInstance:u}=i;if(u){var c=ep(s),v=yield em(u),h=yield ev.nA.UploadFile({file_head:{file_type:c,biz_type:ec.ym.BIZ_BOT_DATASET},data:v},{onUploadProgress:e=>{var t;a({total:null!==(t=e.total)&&void 0!==t?t:u.size,loaded:e.loaded})}});r(h.data),h.data&&(null==o||o({url:h.data.upload_url,tosKey:h.data.upload_uri}))}else W.s5.errorEvent(W.xW.KNOWLEDGE,{eventName:Y.b.KnowledgeUploadFile,error:new H.sH(Y.b.KnowledgeUploadFile,"".concat(Y.b.KnowledgeUploadFile,": Failed to upload image"))})}catch(e){W.s5.errorEvent(W.xW.KNOWLEDGE,{eventName:Y.b.KnowledgeUploadFile,error:e})}finally{null==l||l()}}),function(e){return r.apply(this,arguments)}),eg=e=>{var{editor:t,disabled:n,showTooltip:r,renderUI:o}=e,l=r?f.Tooltip:i.Fragment;return(0,a.jsx)(e_,{customRequest:e=>{if(!t)return;var{fileInstance:n}=e;if(!!n)return ef({object:e,options:{onFinish:e=>{if(e.url&&t){var n;t.chain().focus().setImageWithTosKey({src:e.url,dataTosKey:null!==(n=e.tosKey)&&void 0!==n?n:null}).run()}}}})},children:(0,a.jsx)(l,{content:E.o.t("knowledge_insert_img_002"),clickToHide:!0,autoAdjustOverflow:!0,children:o({disabled:n,showTooltip:r})})})},ex=e=>(0,a.jsx)(eg,(0,$._)((0,q._)({},e),{renderUI:e=>{var{disabled:t}=e;return(0,a.jsx)(f.Button,{disabled:t,color:"primary",className:"coz-fg-primary leading-none",icon:(0,a.jsx)(M.Q2$,{className:"text-[14px]"}),children:E.o.t("knowledge_insert_img_002")})}})),ek=e=>(0,a.jsx)(eg,(0,$._)((0,q._)({},e),{renderUI:e=>{var{disabled:t}=e;return(0,a.jsx)(f.Menu.Item,{disabled:t,icon:(0,a.jsx)(M.Q2$,{className:l()("w-3.5 h-3.5",{"opacity-30":t})}),className:l()("h-8 p-2 text-xs rounded-lg",{"cursor-not-allowed":t}),children:E.o.t("knowledge_insert_img_002")})}})),ey=n("607027"),ew=e=>new ey.j({name:e}),eb=n("888779")},509061:function(e,t,n){n.d(t,{Gf:function(){return d},PU:function(){return v},Pd:function(){return u},Qe:function(){return c},bc:function(){return h},k8:function(){return l},wL:function(){return s}});var r=n(341333),a=n(265489),i=n(306769),o=n(77088),l=e=>{var t=(0,i.x0)();return{data_editor_chunk_uuid:(0,i.x0)(),local_slice_id:t,slice_id:t,sequence:e.sequence,content:""}},d=e=>{var{chunks:t,localChunkSliceId:n,newChunk:r}=e;return t.map(e=>e.local_slice_id===n?r:e)},s=(e,t)=>e.filter(e=>e.local_slice_id!==t),u=(e,t)=>(0,a._)((0,r._)({},e),{content:t}),c=(e,t)=>e.filter(e=>e.slice_id!==t),v=(e,t)=>e.map(e=>e.slice_id===t.slice_id?t:e),h=e=>{var t;return{data_editor_chunk_uuid:(0,i.x0)(),status:o.OL.FinishVectoring,content:e.content,sequence:e.sequence,slice_id:null!==(t=e.slice_id)&&void 0!==t?t:""}}},154022:function(e,t,n){n.d(t,{J:function(){return r.J}});var r=n(444698)},444698:function(e,t,n){n.d(t,{J:function(){return o}});var r=n(341333),a=n(265489),i=n(888953),o=(0,n(922321).Ue)()((0,i.mW)((0,i.XR)((e,t)=>({params:{customRequest:{}},setCustomRequest:n=>{if(!!n)e({params:(0,a._)((0,r._)({},t().params),{customRequest:n})})}})),{enabled:!1,name:"data-editor.params"}))}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2450/40964.44e14b4d.js.map