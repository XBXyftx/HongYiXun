"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["28248"],{583871:function(t,o,e){e.r(o),e.d(o,{checkAndGetMarkdown:function(){return x},delta2md:function(){return y},getBotDeltaSet:function(){return T},getCaretCoordinates:function(){return S},getEditorCursorPos:function(){return z},getInputCursorPos:function(){return M},getProxyClipboard:function(){return C},normalizeSchema:function(){return v}});var n,r=e(255721),i=e(341333),a=e(265489),l=e(161666),d=e(462458),c=e(498842),u=e(16242),s=e(182956),_=e(168074),m=e(961253),p=e(282695),b=e(541956),g=e(963036),h=e(926467),f="&#96;",v=t=>{var o,e,n,r;return{0:{zoneType:null===(o=t[0])||void 0===o?void 0:o.zoneType,zoneId:null===(e=t[0])||void 0===e?void 0:e.zoneId,ops:null===(r=t[0])||void 0===r?void 0:null===(n=r.ops)||void 0===n?void 0:n.map(t=>(0,l.Z)(t,d.Z))}}},k=function(t,o){var e,n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[],a="";if((null==t?void 0:t.bold)==="true"&&i.push("**"),(null==t?void 0:t.italic)==="true"&&i.push("*"),(null==t?void 0:t.strikethrough)==="true"&&i.push("~~"),(null==t?void 0:t.blockquote)&&(a+="> ",o=""),(null==t?void 0:t.heading)&&(a+=function(t){return t.replace(/h([1-9])/g,function(t,o){var e=parseInt(o);return"".concat("#".repeat(e)," ")})}(t.heading),o=""),null==t?void 0:null===(e=t.list)||void 0===e?void 0:e.startsWith("bullet")){var l=parseInt(null==t?void 0:t.list.substring(6),10);a+="".concat("	".repeat(l-1),"* "),o=""}if(null==t?void 0:null===(n=t.list)||void 0===n?void 0:n.startsWith("number")){var d=parseInt(null==t?void 0:t.list.substring(6),10);a+="".concat("	".repeat(d-1)).concat(null==t?void 0:t.start,". "),o=""}return r?"*"===o?"":o:"".concat(a).concat(i.join("")+o+i.join(""))},y=function(t,o){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={markdown:"",images:[],links:[],mentions:[],codeblocks:[]},r=t=>{var{insert:r,attributes:i}=t;if("*"===r){if(null==i?void 0:i.heading)return k(i,r,e);if(null==i?void 0:i.blockquote)return k(i,r,e);else{if(null==i?void 0:null===(a=i.list)||void 0===a?void 0:a.startsWith("bullet"))return k(i,r,e);if(null==i?void 0:null===(l=i.list)||void 0===l?void 0:l.startsWith("number"))return k(i,r,e);c.kg.info("\u4E0D\u652F\u6301\u7684\u683C\u5F0F ".concat(JSON.stringify(t)))}}else if((null==i?void 0:i.bold)==="true")return(null==i?void 0:i["clientside-highlight"])?r:k(i,r,e);else if(null==i?void 0:i.image)return null===(d=n.images)||void 0===d||d.push(null==i?void 0:i.src),"![".concat(null==i?void 0:i.alt,"](").concat(null==i?void 0:i.src,")");else if(null==i?void 0:i.italic)return k(i,r,e);else if(null==i?void 0:i.hyperlink){var a,l,d,u,s=JSON.parse(null==i?void 0:i.hyperlink);return null===(u=n.links)||void 0===u||u.push(s.href),"[".concat(r,"](").concat(s.href,")")}else if(null==i?void 0:i["clientside-auto-url"]){var _,m=null==i?void 0:i["clientside-auto-url"];return null===(_=n.links)||void 0===_||_.push(m),"[".concat(r,"](").concat(m,")")}else if((null==i?void 0:i.type)==="codeblock"){var p=y(o[i.zoneId],o,!0);return n.codeblocks.push(p.markdown),"```".concat(null==i?void 0:i.language.split(" ").join(""),"\n").concat(p.markdown.replace(/`/g,f),"\n```")}else if(null==i?void 0:i.dataMetaBlockProps){var b,{user:g}=JSON.parse(i.dataMetaBlockProps).props.data;return null===(b=n.mentions)||void 0===b||b.push(g),"<card-block data-content='".concat(i.dataMetaBlockProps,"'>@").concat(g.cn_name,"</card-block>")}else if((null==i?void 0:i.strikethrough)==="true")return k(i,r,e);else return r},i=null==t?void 0:t.ops.map(t=>{var{attributes:o}=t,n=r(t);return!n||e||(null==o?void 0:o.type)==="codeblock"||(null==o?void 0:o.dataMetaBlockProps)?n:(n=String(n)).startsWith("> ")?n.substring(0,2)+n.substring(2).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/`/g,f):n.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/`/g,f)});return n.markdown=i.join(""),n},w=t=>new Promise(o=>{setTimeout(o,t)});var x=(n=(0,r._)(function*(t){var{editor:o,onImageUploadProgress:e,validate:n=!0,validOptions:r={waitTime:6e4,imageWait:1e3,contentMaxCount:4e4,imageMaxCount:20}}=t;if(!o)return!1;var l=y(o.getContent().deltas[0],o.getContent().deltas),d=null==o?void 0:o.getText(),p=[],b={},g=0;if(l.markdown&&(g+=d.replaceAll("\n","").trim().length),l.images){if(g+=l.images.length,n&&l.images.length>r.imageMaxCount)return _.O$.error("\u6700\u591A\u53EA\u5141\u8BB8\u63D2\u516520\u5F20\u56FE\u7247"),!1;var h=0;for(var f of l.images)if(f.startsWith("blob:")&&h++,n&&f.startsWith("/"))return s.Toast.error(u.o.t("community_Image_upload_fail")),!1;for(var v of(null==e||e(l.images.length,h),l.images)){if(v.startsWith("blob:")&&r.waitTime>0)return yield w(r.imageWait),x({editor:o,onImageUploadProgress:e,validate:n,validOptions:(0,a._)((0,i._)({},r),{waitTime:r.waitTime-r.imageWait})});try{var k=new URL(v).pathname.split("~")[0].substring(1);b[k]={file_type:m.Tv.Image,image:{key:k,origin_url:v}}}catch(t){c.kg.error({error:t})}}}if(l.mentions)for(var T of(g+=l.mentions.length,l.mentions))!function(t){var{id:o,cn_name:e,avatar_url:n}=t;if(p.findIndex(t=>t.item_id===o)>-1)return;p.push({item_id:o,item_type:m.C1.Bot,name:e,avatar_url:decodeURIComponent(n)})}(T);return(l.codeblocks&&(g+=l.codeblocks.length),n&&g>r.contentMaxCount)?(_.O$.error("\u5185\u5BB9\u8FC7\u957F"),!1):{content:l.markdown.replace(/\n+$/,"\n").replace(/^\n+/,""),content_text:d,images:b,mention_list:p,content_count:g,content_pure:d.replaceAll("\n",""),code_blocks:l.codeblocks}}),function(t){return n.apply(this,arguments)}),T=t=>{var o=[{insert:" ",attributes:{dataMetaBlockProps:JSON.stringify({blockId:(0,p.z3)(),blockType:"AT_USER_BLOCK",initData:"%7B%7D",props:{data:{user:{avatar_url:t.bot_avatar_url,cn_name:t.bot_name,en_name:t.bot_name,id:t.bot_id,type:0}}}})}}],e=new b.I({ops:o});return new g.D({0:e})},C=()=>{var t=!1;return{getData(o,e){var n=o.getData(e),r=o.types.includes("Files");if("text/html"===e.toLowerCase()){var i=new DOMParser().parseFromString(n,"text/html"),a=i.querySelectorAll("img"),l=0;return a.forEach(t=>{t.dataset.bizKey!==h.u&&(t.remove(),l++)}),l&&!t&&!r&&(s.Toast.warning(u.o.t("community_This_is_a_toast_not_support_pasting_img")),t=!0),function(t){t.querySelectorAll("h4, h5, h6, h7, h8, h9").forEach(function(t){var o,e=document.createElement("h3");e.innerHTML=t.innerHTML,null===(o=t.parentNode)||void 0===o||o.replaceChild(e,t)})}(i),i.body.outerHTML}return n},getTypes:t=>t.types,setData(t,o,e){t.setData(o,e)}}},I=["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],S=(t,o)=>{var e,n=void 0!==window.mozInnerScreenX;!(e=document.getElementById("".concat(t.nodeName,"--mirror-div")))&&((e=document.createElement("div")).id="".concat(t.nodeName,"--mirror-div"),document.body.appendChild(e));var{style:r}=e,i=getComputedStyle(t);r.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(r.wordWrap="break-word"),r.position="absolute",r.top="".concat(t.offsetTop+parseInt(i.borderTopWidth),"px"),r.left="400px",r.zIndex="-9999",r.visibility="hidden",I.forEach(function(t){r[t]=i[t]}),n?(r.width="".concat(parseInt(i.width)-2,"px"),t.scrollHeight>parseInt(i.height)&&(r.overflowY="scroll")):r.overflow="hidden";var a="";t instanceof HTMLTextAreaElement?a=t.value:a=t.innerText,e.textContent=a.substring(0,o),"INPUT"===t.nodeName&&(e.textContent=e.textContent.replace(/\s/g,"\xa0"));var l=document.createElement("span");return l.textContent=a.substring(o)||"",l.style.backgroundColor="lightgrey",e.appendChild(l),{top:l.offsetTop+parseInt(i.borderTopWidth),left:l.offsetLeft+parseInt(i.borderLeftWidth)-parseInt(i.paddingLeft)}},z=(t,o)=>{for(var e,n=null===(e=t.getRootContainer())||void 0===e?void 0:e.querySelector(".ace-line"),r=n.innerText.length,i=0,a=0;a<r&&!(o<=S(n,a).left);a++){;i=a}return i},M=(t,o)=>{for(var e=0,n=t.value.length;n>=0;n--){var r=S(t,n).left;if(4>=Math.abs(o-r)||o>=r){e=n;break}}return e}},926467:function(t,o,e){e.d(o,{G:function(){return r},u:function(){return i}});var n=e(16242),r=()=>({language:"en","hyperlink.add-link":n.o.t("community_Please_enter_paste_or_enter_the",{},"Paste or enter a hyperlink"),"hyperlink.determine":n.o.t("community_Button_confirm",{},"confirm"),"hyperlink.enter-text":n.o.t("community_Please_enter_enter_link_title",{},"Please enter text"),"hyperlink.link":n.o.t("community_Group_Title_link",{},"Link"),"hyperlink.text":n.o.t("community_Group_Title_link_name",{},"Text"),"mention.mentioned":n.o.t("editor_mention_mentioned",{},"mention"),"mention.no-result-and-try-another":n.o.t("editor_mention_no_result",{},"No results, try another keyword"),"mention.notification":n.o.t("editor_mention_notification",{},"Notification"),"mention.recently":n.o.t("editor_mention_recents",{},"Recents"),"mention.last_update":n.o.t("editor_mention_last_update",{},"Last updated: "),"toolbar.align-center":n.o.t("editor_toolbar_align_center",{},"Center align"),"toolbar.align-left":n.o.t("editor_toolbar_align_left",{},"Left align"),"toolbar.align-right":n.o.t("editor_toolbar_align_right",{},"Right align"),"toolbar.blockquote":n.o.t("editor_toolbar_blockquote",{},"Reference"),"toolbar.bold":n.o.t("editor_toolbar_bold",{},"Bold"),"toolbar.checkbox":n.o.t("editor_toolbar_checkbox",{},"To-do list"),"toolbar.h1":n.o.t("community_Menu_item_menu_heading2",{},"Heading 1"),"toolbar.h2":n.o.t("community_Menu_item_menu_heading2",{},"Heading 2"),"toolbar.h3":n.o.t("community_Menu_item_menu_heading3",{},"Heading 3"),"toolbar.horizontal-line":n.o.t("editor_toolbar_horizontal_line",{},"Divider"),"toolbar.hyperlink":n.o.t("editor_toolbar_hyperlink",{},"Hyperlink"),"toolbar.image":n.o.t("editor_toolbar_image",{},"Image"),"toolbar.italic":n.o.t("editor_toolbar_italic",{},"Italic"),"toolbar.orderlist":n.o.t("editor_toolbar_orderlist",{},"Numbered list"),"toolbar.redo":n.o.t("editor_toolbar_redo",{},"Redo"),"toolbar.strikethrough":n.o.t("editor_toolbar_strikethrough",{},"Strikethrough"),"toolbar.table":n.o.t("editor_toolbar_table",{},"Table"),"toolbar.text-indent":n.o.t("editor_toolbar_text_indent",{},"Indent"),"toolbar.underline":n.o.t("editor_toolbar_underline",{},"Underline"),"toolbar.undo":n.o.t("editor_toolbar_undo",{},"Undo"),"toolbar.unorderlist":n.o.t("editor_toolbar_unorderlist",{},"Bulleted list"),"toolbar.font-size-small":n.o.t("editor_toolbar_font_size_small",{},"Small"),"toolbar.font-size-normal":n.o.t("editor_toolbar_font_size_normal",{},"Normal"),"toolbar.font-size-large":n.o.t("editor_toolbar_font_size_large",{},"Large"),"toolbar.font-size-max":n.o.t("editor_toolbar_font_size_max",{},"Maximum"),"toolbar.video":n.o.t("editor_toolbar_video",{},"Video"),"toolbar.codeblock":n.o.t("editor_toolbar_codeblock",{},"Code Block"),"toolbar.color.font":n.o.t("editor_toolbar_color_font",{},"Text color"),"toolbar.color.background":n.o.t("editor_toolbar_color_background",{},"Background color"),"codeblock.search":n.o.t("editor_codeblock_search",{},"search"),"codeblock.change_language":n.o.t("editor_codeblock_change_language",{},"Change langugage"),"codeblock.search_placeholder":n.o.t("editor_codeblock_search_placeholder",{},"No results found"),"codeblock.copy":n.o.t("editor_codeblock_copy",{},"Copy"),"codeblock.cancel_auto_wrap":n.o.t("editor_codeblock_cancel_auto_wrap",{},"Cancel auto wrap"),"codeblock.auto_wrap":n.o.t("editor_codeblock_auto_wrap",{},"Auto wrap"),"common.copied":n.o.t("editor_common_copied",{},"Copied")}),i="8a5eea62f06cee5de8136d05ff47507bb752d5e7"}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2232/28248.1fae2340.js.map