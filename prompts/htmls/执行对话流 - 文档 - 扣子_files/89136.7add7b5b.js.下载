"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["89136"],{780499:function(e,r,n){n.d(r,{GC:()=>$,jU:()=>x,b1:()=>l,y1:()=>I,hl:()=>q,KC:()=>O,y8:()=>c,mC:()=>b,Ry:()=>W,lp:()=>d,__:()=>_});var t,o,i=n("723530"),u=n("314640"),a=n("488360");function l(){return"ontouchend"in document}var d="data-grab-mark",c="data-grab-source",s=e=>{for(var r=[],n=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ALL,{acceptNode:r=>e.intersectsNode(r)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),t=n.currentNode;t;)r.push(t),t=n.nextNode();return r},v=(e,r)=>{for(var n=r.toUpperCase();e;){if(e.nodeType===Node.ELEMENT_NODE&&e.tagName===n)return e;e=e.parentNode}return null},f=(e,r)=>{for(;e&&e!==document;){var n,t=null;if(e instanceof Element&&(t=null===(n=e.attributes.getNamedItem(r))||void 0===n?void 0:n.value),e.nodeType===Node.ELEMENT_NODE&&t)return t;e=e.parentNode}return null},N=e=>{var r=s(e),n=0,t=!1;for(var o of r){var i=f(o,d);!t&&(t=!!v(o,"A")),i&&n++}var{endOffset:u}=e;return n!==r.length||t||0===u},p=e=>{for(var{node:r,scopeAncestorAttributeName:n,targetAttributeValue:t}=e,o=null;r;)n&&f(r,n)===t&&(o=r),r=r.nextSibling;return o},E=e=>{for(;e.lastChild;)e=e.lastChild;return e},m=(e,r)=>{var n=e.compareDocumentPosition(r);if(n&Node.DOCUMENT_POSITION_CONTAINED_BY)return"contains";if(n&Node.DOCUMENT_POSITION_CONTAINS)return"containedBy";if(n&Node.DOCUMENT_POSITION_FOLLOWING)return"before";else if(n&Node.DOCUMENT_POSITION_PRECEDING)return"after";return"none"},h=e=>{for(var{range:r,targetAttributeName:n,targetAttributeValue:t}=e,o=r.startContainer,{startOffset:i}=r;o&&f(o,n)!==t;)if(o.previousSibling)o=o.previousSibling,i=0;else if(o.parentNode&&o.parentNode!==document)o=o.parentNode,i=0;else{o=null;break}return{startNode:o,startOffset:i}},g=e=>{for(;e;){if(e.nodeType===Node.ELEMENT_NODE&&"A"===e.nodeName)return e;e=e.parentNode}return null},w=(e,r,n)=>{var t=g(r),o=g(n),i=!1;return t&&(e.setStartBefore(t),i=!0),o&&(e.setEndAfter(o),i=!0),i},T=e=>{for(var r,n,{range:t,targetAttributeName:o,targetAttributeValue:i}=e,u=t.endContainer,{endOffset:a}=t;u&&f(u,o)!==i;)if(u.nextSibling)u=u.nextSibling,a=0;else if(u.parentNode&&u.parentNode!==document)a=(u=u.parentNode)&&null!==(n=null===(r=E(u).textContent)||void 0===r?void 0:r.length)&&void 0!==n?n:0;else{u=null;break}return{endNode:u,endOffset:a}},C=e=>{for(var r=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ALL,{acceptNode:r=>e.contains(r)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),t=n.currentNode;t;)r.push(t),t=n.nextNode();return r},A=e=>{if(!e||e===document)return null;for(var r,n=null!==(r=e.previousSibling)&&void 0!==r?r:e.parentNode;n&&n!==document;){;if(!["containedBy","contains"].includes(m(n,e)))return n;n=n.previousSibling?n.previousSibling:n.parentNode}return null},L=e=>{var{range:r,startNode:n,endNode:t,endOffset:o}=e;if(n===t||0!==o)return!1;for(var i=A(t);i;){if(i.nodeType===Node.TEXT_NODE){;if((null===(u=i.textContent)||void 0===u?void 0:u.trim())&&(null===(a=i.textContent)||void 0===a?void 0:a.length))return r.setEnd(i,i.textContent.length),!0}else if(i.nodeType===Node.ELEMENT_NODE&&(null===(l=i.textContent)||void 0===l?void 0:l.trim())){var u,a,l,d,c=null;for(var s of C(i))s.nodeType===Node.TEXT_NODE&&(null===(d=s.textContent)||void 0===d?void 0:d.trim())&&(c=s);if(c&&c.textContent)return r.setEnd(c,c.textContent.length),!0}i=A(i)}return!1},y=e=>{var{range:r}=e,n=f(r.startContainer,d);if(!n)return!1;var{startNode:t,startOffset:o}=h({range:r,targetAttributeName:d,targetAttributeValue:n}),{endNode:i,endOffset:u}=T({range:r,targetAttributeName:d,targetAttributeValue:n});if(t&&!i){var a,l,{parentNode:c}=t,s=null,N=v(c,"LI"),g=N?v(N,"A"):v(c,"A"),C=v(c,"DIV");s=g?p({node:g,scopeAncestorAttributeName:d,targetAttributeValue:n}):N?p({node:N,scopeAncestorAttributeName:d,targetAttributeValue:n}):C?p({node:C,scopeAncestorAttributeName:d,targetAttributeValue:n}):p({node:t,scopeAncestorAttributeName:d,targetAttributeValue:n}),t===s&&(s=p({node:c,scopeAncestorAttributeName:d,targetAttributeValue:n})),s&&(u=(i=s).nodeType===Node.TEXT_NODE?i.length:null!==(l=null===(a=E(i).textContent)||void 0===a?void 0:a.length)&&void 0!==l?l:0)}if(t&&i){var A=m(t,i),y=!1;["before","none"].includes(A)&&(r.setStart(t,o),r.setEnd(i,u),y=!0);var b=w(r,t,i),I=L({range:r,startNode:t,endNode:i,endOffset:u});return y||b||I}return r.collapse(!1),!1},b=e=>e&&"text"in e;var I=((t={}).IMAGE="image",t.LINK="link",t),_=e=>e&&"url"in e&&"type"in e&&e.type===I.LINK,O=e=>e&&"src"in e&&"type"in e&&e.type===I.IMAGE,x=e=>{var r="";for(var n of e)b(n)?r+=n.text:_(n)?r+="[".concat(x(n.children),"](").concat(n.url,")"):O(n)?r+="![".concat(x(n.children),"](").concat(n.src,")"):r+=x(n.children);return r},k=e=>{if("src"in e&&"string"==typeof e.src)return e.src},R=e=>Array.from(e).filter(e=>k(e)).at(0),S=e=>{if("PICTURE"===e.nodeName.toUpperCase()){var r=R(e.childNodes);if(r)return r}if("A"===e.nodeName.toUpperCase()||["TH","TD"].includes(e.nodeName.toUpperCase()))return e},D=e=>{var r=[];if(!e.length)return r;for(var n of e){var t=S(n);if(t){var o=U(t);o&&r.push(o);continue}var i=U(n);i&&r.push(i);var u=D(n.childNodes);r.push(...u)}return r},U=e=>{if(!e)return null;var r=["TH","TD"].includes(e.nodeName.toUpperCase());return e.nodeType===e.TEXT_NODE||r?M(e,r):e.nodeType===e.ELEMENT_NODE&&e instanceof Element?F(e):void 0},M=(e,r)=>{if(!!e){var n,t=null!==(n=e.textContent)&&void 0!==n?n:"";return{text:r?" ".concat(t," "):t}}},F=e=>{if(!!e){if(["IMG","SOURCE"].includes(e.tagName.toUpperCase())){var r=M(e);return{type:I.IMAGE,src:"src"in e&&"string"==typeof e.src?e.src:"",children:r?[r]:[]}}if("A"===e.tagName.toUpperCase()){var n=M(e);return{type:I.LINK,url:"href"in e&&"string"==typeof e.href?e.href:"",children:n?[n]:[]}}}},B=e=>{var r="";for(var n of e)b(n)?r+=n.text:_(n)?r+="[".concat(B(n.children),"]"):O(n)?r+="![".concat(B(n.children),"]"):r+=B(n.children);return r},P=e=>{var r=e.cloneContents(),n=[];return!function e(r){r.nodeType===Node.TEXT_NODE?n.push(r):r.childNodes.forEach(e)}(r),n.some(e=>/\S/.test(e.textContent||""))};var G=((o={}).Forward="forward",o.Backward="backward",o.Unknown="unknown",o),K=e=>{if(!e||e.isCollapsed)return G.Unknown;var{anchorNode:r}=e,{focusNode:n}=e;if(!r||!n)return G.Unknown;var{anchorOffset:t}=e,{focusOffset:o}=e;if(r===n)return t<=o?G.Forward:G.Backward;var i=m(r,n);if("before"===i)return G.Forward;if("after"===i)return G.Backward;return G.Unknown},W=(e,r)=>{for(;e&&e!==document;){var n,t=null;if(e instanceof Element&&(t=null===(n=e.attributes.getNamedItem(r))||void 0===n?void 0:n.value))return e;e=e.parentNode}return null},X=e=>{var r,n,t,{selection:o,hasFix:i}=e;if(!o.rangeCount)return;var u=o.getRangeAt(0);if(!u)return;var a=u.cloneContents(),l=K(o),s=W(u.commonAncestorContainer.parentNode,d),v=null!==(t=null==s?void 0:null===(r=s.attributes.getNamedItem(d))||void 0===r?void 0:r.value)&&void 0!==t?t:null,f=null==s?void 0:null===(n=s.attributes.getNamedItem(c))||void 0===n?void 0:n.value;if(!i&&N(u)){if(!y({range:u}))return;return X({selection:o,hasFix:!0})}if(!P(u))return;var p=D(a.childNodes);if(!!p.length){var E=B(p);return{humanizedContentText:E,originContentText:x(p),normalizeSelectionNodeList:p,nodesAncestorIsMessageBox:!!v,ancestorAttributeValue:v,messageSource:Number(f),direction:l}}},H=e=>{var{selection:r}=e;if(!r.rangeCount)return;var n=r.getRangeAt(0);if(!!n)return{rangeRects:n.getClientRects()}},$=e=>{var{contentRef:r,floatMenuRef:n,onSelectChange:t,onPositionChange:o}=e,d=(0,i.useRef)(),c=(0,i.useRef)(null),s=(0,i.useRef)(null),[v,f]=(0,i.useState)(!1),N=(0,i.useRef)(null),p=(0,i.useRef)(!1),E=()=>{var e;t(null),o(null),null===(e=c.current)||void 0===e||e.removeAllRanges(),c.current=null,f(!1),p.current=!1,N.current&&clearTimeout(N.current)},m=()=>{var e,r=window.getSelection(),{direction:n=G.Unknown}=null!==(e=s.current)&&void 0!==e?e:{};if(!r){t(null);return}var i=H({selection:r});if(!i){o(null);return}var u=Array.from(i.rangeRects).at(n===G.Backward?0:-1);if(!u){o(null);return}var[a,l]=[0,0];n===G.Backward?(a=u.left,l=u.top+u.height):(a=u.x+u.width,l=u.y+u.height),o({x:a>screen.width-40?a-40:a,y:l>screen.height-40?l-40:u.y+u.height})},h=(0,a.$0)(()=>{N.current&&clearTimeout(N.current),f(!0),N.current=setTimeout(()=>{m(),f(!1)},100)}),g=()=>{if(!r.current){t(null);return}var e=window.getSelection();if(!e){t(null);return}c.current=e;var n=X({selection:e});if(!n||!n.nodesAncestorIsMessageBox){t(null);return}s.current=n,p.current=!!n,m(),t(n)},w=(0,a.$0)(()=>{clearTimeout(d.current),d.current=(0,u.Z)(g)}),T=(0,a.$0)(e=>{s.current&&((e.ctrlKey||e.metaKey)&&"a"===e.key&&t(null),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&g())}),C=(0,a.$0)(e=>{if(!r.current||!n||!(null==n?void 0:n.current))return;var{clientX:t,clientY:o}=e,i=n.current.getBoundingClientRect();if(!(o>=i.top)||!(o<=i.bottom)||!(t>=i.left)||!(t<=i.right))E()});return(0,i.useEffect)(()=>{if(!!p.current)return window.addEventListener("mousedown",C),()=>{window.removeEventListener("mousedown",C)}},[p.current]),(0,i.useEffect)(()=>{if(!!p.current)return window.addEventListener("resize",h),window.addEventListener("wheel",h),window.addEventListener("scroll",h),window.addEventListener("keydown",T),l()&&window.addEventListener("selectionchange",h),()=>{window.removeEventListener("resize",h),window.removeEventListener("wheel",h),window.removeEventListener("scroll",h),window.removeEventListener("keydown",T),window.removeEventListener("selectionchange",h)}},[p.current]),(0,i.useEffect)(()=>{var e=r.current;if(!!e)return e.addEventListener("pointerup",w),l()&&e.addEventListener("selectionchange",w),()=>{e.removeEventListener("pointerup",w),e.removeEventListener("selectionchange",w)}},[r.current]),{clearSelection:E,isScrolling:v,computePosition:h}},z=n("882979"),J=n("566184"),{isImage:V,isLink:j,isParent:Y,isText:Z}=z.zV,q=e=>Q((0,J.eL)(e)),Q=e=>{var r=[],n=e=>{if(Z(e))r.push({text:e.value});else if(j(e)){var t,o=e.children.map(Q).flat(1);r.push({type:I.LINK,url:e.url,children:o})}else V(e)?r.push({type:I.IMAGE,src:e.url,children:[{text:null!==(t=e.alt)&&void 0!==t?t:""}]}):Y(e)&&e.children.forEach(n)};return n(e),r}}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.1958/89136.7add7b5b.js.map