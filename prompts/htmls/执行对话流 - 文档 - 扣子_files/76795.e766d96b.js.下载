"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["76795"],{259844:function(e,t,n){n.d(t,{mN:()=>eh,sg:()=>l,vy:()=>ew,y1:()=>a.y1});var r,o,i=((r={}).OnViewScroll="onViewScroll",r.OnMessageUpdate="onMessageUpdate",r.OnLinkElementMouseEnter="onCardLinkElementMouseEnter",r.OnLinkElementMouseLeave="onCardLinkElementMouseLeave",r);var l=((o={}).UpdateQuote="updateQuote",o),a=n("780499"),u=n("723530"),s=n("306769"),c=n("320862"),d=n("888953"),p=n("922321"),v=e=>(0,p.Ue)()((0,d.mW)((e,t)=>({humanizedContentText:"",originContentText:"",normalizeSelectionNodeList:[],selectionData:null,isFloatMenuVisible:!1,floatMenuPosition:null,updateHumanizedContentText:t=>{e({humanizedContentText:t})},updateOriginContentText:t=>{e({originContentText:t})},updateNormalizeSelectionNodeList:t=>{e({normalizeSelectionNodeList:t})},updateIsFloatMenuVisible:t=>{e({isFloatMenuVisible:t})},updateSelectionData:t=>{e({selectionData:t})},updateFloatMenuPosition:t=>{e({floatMenuPosition:t})},clearStore:()=>{e({humanizedContentText:"",originContentText:"",normalizeSelectionNodeList:[],selectionData:null})}}),{name:"botStudio.ChatAreaGrabPlugin.SelectionStore.".concat(e),enabled:!1})),g=n("468745"),m=e=>(0,p.Ue)()((0,d.mW)((0,d.XR)(e=>({quoteContent:null,quoteVisible:!1,quoteContentMap:{},updateQuoteContent:t=>{e({quoteContent:t})},updateQuoteContentMapByImmer:t=>{e((0,g.Uy)(e=>t(e.quoteContentMap)))},updateQuoteVisible:t=>{e({quoteVisible:t})},clearStore:()=>{e({quoteContent:null,quoteVisible:!1})}})),{name:"botStudio.ChatAreaGrabPlugin.Quote.".concat(e),enabled:!1})),x=(e,t)=>{var{useQuoteStore:n}=e;return n.subscribe(e=>e.quoteContent,e=>{var{onQuoteChange:n}=t;null==n||n({isEmpty:!e})})},M=e=>(0,p.Ue)()((0,d.mW)((0,d.XR)(e=>({enableGrab:!1,updateEnableGrab:t=>{e({enableGrab:t})}})),{name:"botStudio.ChatAreaGrabPlugin.Preference.".concat(e),enabled:!1})),f=n("396842"),E=n("341333"),b=n("265489");class h extends f.i4{onBeforeAppendSenderMessageIntoStore(e){var{quoteContent:t,updateQuoteContentMapByImmer:n}=this.pluginInstance.pluginBizContext.storeSet.useQuoteStore.getState();if(!t||"shortcut"===e.from)return e;var r=e.message,o={item_list:[{type:"text",text:r.content}],refer_items:[]};o.refer_items.push({type:f.zc.Text,text:(0,a.jU)(t)});var i=(0,b._)((0,E._)({},r),{content_type:f.zc.Mix,content:JSON.stringify(o),content_obj:o});return n(e=>{var n=i.extra_info.local_message_id;!e[n]&&(e[n]=t)}),(0,b._)((0,E._)({},e),{message:i})}onAfterAppendSenderMessageIntoStore(e){if("shortcut"!==e.from){var{storeSet:t}=this.pluginInstance.pluginBizContext,{updateQuoteVisible:n,updateQuoteContent:r}=t.useQuoteStore.getState();n(!1),r(null)}}onAfterProcessReceiveMessage(){var{emit:e}=this.pluginInstance.pluginBizContext.eventCenter;e(i.OnMessageUpdate)}}class A extends f.Bw{onViewScroll(){var{emit:e}=this.pluginInstance.pluginBizContext.eventCenter;e(i.OnViewScroll)}onCardLinkElementMouseEnter(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(i.OnLinkElementMouseEnter,(0,b._)((0,E._)({},e),{type:"image"}))}onCardLinkElementMouseLeave(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(i.OnLinkElementMouseLeave,(0,b._)((0,E._)({},e),{type:"image"}))}onMdBoxImageElementMouseEnter(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(i.OnLinkElementMouseEnter,(0,b._)((0,E._)({},e),{type:"image"}))}onMdBoxImageElementMouseLeave(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(i.OnLinkElementMouseLeave,(0,b._)((0,E._)({},e),{type:"image"}))}onMdBoxLinkElementMouseEnter(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(i.OnLinkElementMouseEnter,(0,b._)((0,E._)({},e),{type:"link"}))}onMdBoxLinkElementMouseLeave(e){var{emit:t}=this.pluginInstance.pluginBizContext.eventCenter;t(i.OnLinkElementMouseLeave,(0,b._)((0,E._)({},e),{type:"link"}))}}class w extends f.r1{onBeforeDestroy(){var{unsubscribe:e,eventCenter:t,publicEventCenter:n,scene:r}=this.pluginInstance.pluginBizContext;if("store"!==r)e(),t.all.clear(),n.all.clear()}onBeforeInitial(){var{publicEventCenter:e,grabPluginId:t,storeSet:n}=this.pluginInstance.pluginBizContext,{useQuoteStore:r}=n,{updateQuoteContent:o,updateQuoteVisible:i}=r.getState();e.on(l.UpdateQuote,e=>{var{grabPluginId:n,quote:r}=e;if(t===n)o(r),i(!0)})}}var C=n("938809"),S=n("453341"),y=n("345305"),U=n("314640"),L=n("856306"),z=n.n(L),k=n("273268"),j=n("16242"),P=n("988726"),B=n("182956"),O=e=>{var{messageId:t,chatAreaPluginContext:n}=e;if(!!t)return n.readonlyAPI.message.findMessage(t)},I=e=>{var{onClose:t,onClick:n}=e,{pluginBizContext:r,chatAreaPluginContext:o}=(0,f.FL)(f.p7.MessageGrab),{onQuote:i}=r.eventCallbacks,{useQuoteStore:l,useSelectionStore:a,usePreferenceStore:u}=r.storeSet,{updateQuoteContent:s,updateQuoteVisible:c}=l((0,y.N)(e=>({updateQuoteVisible:e.updateQuoteVisible,updateQuoteContent:e.updateQuoteContent}))),d=u(e=>e.enableGrab),{useDeleteFile:p}=o.writeableHook.file,{getFileStoreInstantValues:v}=o.readonlyAPI.batchFile,g=p(),m=()=>{var{fileIdList:e}=v();e.forEach(e=>g(e))},x=()=>{var{selectionData:e}=a.getState(),t=null==e?void 0:e.ancestorAttributeValue;if(!!t)return O({messageId:t,chatAreaPluginContext:o})};return d?(0,C.jsx)(B.Tooltip,{content:j.o.t("quote_ask_in_chat"),clickToHide:!0,children:(0,C.jsx)(B.IconButton,{icon:(0,C.jsx)(P.Z57,{className:"text-lg coz-fg-secondary"}),color:"secondary",onClick:()=>{if(m(),n){n(),null==t||t();return}var e,{normalizeSelectionNodeList:r}=a.getState();s(r),c(!0);var o=x();null==i||i({botId:null!==(e=null==o?void 0:o.sender_id)&&void 0!==e?e:"",source:null==o?void 0:o.source}),null==t||t()},size:"small",wrapperClass:"flex justify-center items-center"})}):null},D=n("488360"),N=n("866466"),_=n.n(N),R=n("462669"),T=n.n(R),G=n("318249"),V=n.n(G),Q=n("294754"),Z=n.n(Q),F=n("13355"),q=n.n(F),H=n("876846"),X=n.n(H),K=n("766156"),W={};W.styleTagTransform=X(),W.setAttributes=Z(),W.insert=V().bind(null,"head"),W.domAPI=T(),W.insertStyleElement=q(),_()(K.Z,W);var Y=K.Z&&K.Z.locals?K.Z.locals:void 0,J=(0,u.forwardRef)((e,t)=>{var n=(0,f.FL)(f.p7.MessageGrab),{useGetScrollView:r}=n.chatAreaPluginContext.readonlyHook.scrollView,{on:o,off:l}=n.pluginBizContext.eventCenter,{style:a,children:s,onScroll:c,onMouseEnter:d,onMouseLeave:p,className:v}=e,g=r(),m=(0,u.useRef)(null),[x,M]=(0,u.useState)(1);(0,u.useImperativeHandle)(t,()=>({getRef:()=>m,refreshOpacity:h}));var h=(0,D.$0)(()=>{null==c||c();var e,t=null===(e=m.current)||void 0===e?void 0:e.getBoundingClientRect(),{rect:n}=g().getOriginScrollInfo();if(!!n&&!!t)if(t.y-100<=n.top){var r=(t.y-n.top)/100;M(r<0?0:r)}else if(t.y+100>=n.bottom){var o=(n.bottom-t.y)/100;M(o<0?0:o)}else M(1)});return(0,u.useEffect)(()=>(o(i.OnMessageUpdate,h),()=>{l(i.OnMessageUpdate,h)}),[]),(0,C.jsx)("div",{className:z()("fixed p-[2px] coz-bg-max coz-stroke-primary border-[0.5px] rounded-[8px] overflow-hidden grid grid-flow-col gap-[2px] h-[28px]",Y["container-box-shadow"],v),style:(0,b._)((0,E._)({},a),{opacity:x}),ref:m,onMouseEnter:d,onMouseLeave:p,children:s})}),$=[f.mZ.Notice],ee=e=>{var t,n,{contentRef:r}=e,o=(0,f.FL)(f.p7.MessageGrab),{pluginBizContext:l}=o,{eventCenter:s,storeSet:c,getPopContainer:d}=l,{usePreferenceStore:p,useSelectionStore:v}=c,{on:g,off:m}=s,x=(0,u.useRef)(null),{isFloatMenuVisible:M,position:E,updateFloatMenuPosition:b}=v((0,y.N)(e=>({isFloatMenuVisible:e.isFloatMenuVisible,position:e.floatMenuPosition,updateFloatMenuPosition:e.updateFloatMenuPosition}))),h=p(e=>e.enableGrab),{clearSelection:A,isScrolling:w,computePosition:L}=(0,a.GC)({contentRef:r,floatMenuRef:null===(t=x.current)||void 0===t?void 0:t.getRef(),onSelectChange:e=>{var t,n,r,i,{updateHumanizedContentText:l,updateNormalizeSelectionNodeList:a,updateOriginContentText:u,updateSelectionData:s,updateIsFloatMenuVisible:c}=o.pluginBizContext.storeSet.useSelectionStore.getState();if(e&&$.includes(e.messageSource))return;s(e),c(!!e);var d=null==e?void 0:e.ancestorAttributeValue,p=d===k.K8;if(!!d){var{is_finish:v}=null!==(t=o.chatAreaPluginContext.readonlyAPI.message.findMessage(d))&&void 0!==t?t:{};if(!v&&!p){c(!1);return}l(null!==(n=null==e?void 0:e.humanizedContentText)&&void 0!==n?n:""),a(null!==(r=null==e?void 0:e.normalizeSelectionNodeList)&&void 0!==r?r:[]),u(null!==(i=null==e?void 0:e.originContentText)&&void 0!==i?i:"")}},onPositionChange:e=>{b(e),(0,U.Z)(()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.refreshOpacity()})}}),j=!!E&&M;return((0,u.useEffect)(()=>(g(i.OnMessageUpdate,L),g(i.OnViewScroll,L),()=>{m(i.OnMessageUpdate,L),m(i.OnViewScroll,L)}),[]),h)?(0,S.createPortal)((0,C.jsx)(J,{ref:x,style:{top:null==E?void 0:E.y,left:null==E?void 0:E.x},className:z()({hidden:!j||w}),children:(0,C.jsx)(I,{onClose:A})}),null!==(n=null==d?void 0:d())&&void 0!==n?n:document.body):null},et=e=>{var t,n=(0,u.useRef)(null),r=(0,u.useRef)(null),o=(null==e?void 0:null===(t=e.containerRef)||void 0===t?void 0:t.current)?e.containerRef:n,[i,l]=(0,u.useState)(!1);return(0,u.useEffect)(()=>{var e,t=(0,a.Ry)(o.current,a.lp),n=null==t?void 0:null===(e=t.attributes.getNamedItem(a.y8))||void 0===e?void 0:e.value;return $.includes(Number(n))&&l(!0),r.current=t,()=>{l(!1),r.current=null}},[o.current]),{targetRef:r,containerRef:o,forceHidden:i}},en=n("239254"),er=(e,t)=>{var n=e.at(0);for(var r of e)t.x>=r.left-5&&t.x<=r.right+5&&t.y>=r.top-5&&t.y<=r.bottom+5&&(n=r);return n},eo=e=>{var{plugin:t}=e,n=(0,u.useRef)(null),[r,o]=(0,u.useState)(!1),l=(0,u.useRef)(null),s=(0,u.useRef)(null),[c,d]=(0,u.useState)(!1),p=(0,u.useRef)(null),{pluginBizContext:v}=t,{eventCenter:g}=v,{on:m,off:x}=g,M=(0,u.useRef)(!1),[f,E]=(0,u.useState)(null),b=(0,u.useRef)(null),h=(0,u.useRef)({x:0,y:0}),A=(0,D.$0)(()=>{M.current=!0,b.current&&clearTimeout(b.current)}),w=(0,D.$0)(()=>{M.current=!1,y()}),C=()=>{var e,n,r=(0,a.Ry)(l.current,a.lp),o=null==r?void 0:null===(e=r.attributes.getNamedItem(a.lp))||void 0===e?void 0:e.value;if(o===k.K8)return!0;if(!o)return!1;var{is_finish:i}=null!==(n=t.chatAreaPluginContext.readonlyAPI.message.findMessage(o))&&void 0!==n?n:{};return i},S=(0,D.$0)(e=>{var t;if(b.current&&(clearTimeout(b.current),b.current=null),l.current=e.element,s.current={source:e.link,type:e.type,text:null!==(t=e.element.textContent)&&void 0!==t?t:""},!!C())o(!0),L(),(0,U.Z)(()=>{var e;null===(e=n.current)||void 0===e||e.refreshOpacity()})}),y=(0,D.$0)(()=>{b.current=(0,en.Z)(()=>{if(!M.current)l.current=null,o(!1)},100)}),L=(0,D.$0)(()=>{var e=null===(u=n.current)||void 0===u?void 0:u.getRef();if(!!l.current&&!!e&&!!e.current&&!!s.current){var t=l.current,r=t.getBoundingClientRect(),o=e.current.getBoundingClientRect(),i=0,a=0;if("image"===s.current.type)i=r.right,a=r.bottom-r.height/2-o.height/2;else{var u,c,d=null!==(c=er(Array.from(t.getClientRects()),h.current))&&void 0!==c?c:r;i=h.current.x,a=d.bottom}E({x:i,y:a})}}),z=(0,D.$0)(e=>{var[t,n]=[e.clientX,e.clientY];h.current={x:t,y:n}}),j=(0,D.$0)(()=>{p.current&&clearTimeout(p.current),d(!0),p.current=setTimeout(()=>{L(),d(!1)},100)});return(0,u.useEffect)(()=>(m(i.OnLinkElementMouseEnter,S),m(i.OnLinkElementMouseLeave,y),m(i.OnViewScroll,j),m(i.OnMessageUpdate,j),window.addEventListener("mousemove",z),window.addEventListener("resize",j),window.addEventListener("wheel",j),window.addEventListener("scroll",j),()=>{x(i.OnLinkElementMouseEnter,S),x(i.OnLinkElementMouseLeave,y),x(i.OnViewScroll,j),x(i.OnMessageUpdate,j),window.removeEventListener("mousemove",z),window.removeEventListener("resize",j),window.removeEventListener("wheel",j),window.removeEventListener("scroll",j)}),[]),{handleMenuMouseEnter:A,handleMenuMouseLeave:w,targetElement:l,targetInfo:s,position:f,floatMenuRef:n,visible:r,setVisible:o,computePosition:j,isScrolling:c}},ei=e=>{var{position:t,messageRef:n,floatMenuRef:r}=e,[o,i]=(0,u.useState)(0);return(0,u.useEffect)(()=>{var e,t;i(null!==(t=null===(e=n.current)||void 0===e?void 0:e.getBoundingClientRect().right)&&void 0!==t?t:0),(0,U.Z)(()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.refreshOpacity()})},[t,n.current,r.current]),{maxPositionX:o}},el=()=>{var e,t,n=(0,f.FL)(f.p7.MessageGrab),{chatAreaPluginContext:r,pluginBizContext:o}=n,{eventCenter:l,getPopContainer:s}=o,{usePreferenceStore:c}=o.storeSet,d=c(e=>e.enableGrab),{on:p,off:v}=l,{useQuoteStore:g}=o.storeSet,{updateQuoteContent:m,updateQuoteVisible:x}=g((0,y.N)(e=>({updateQuoteVisible:e.updateQuoteVisible,updateQuoteContent:e.updateQuoteContent}))),{handleMenuMouseEnter:M,handleMenuMouseLeave:E,targetElement:b,targetInfo:h,position:A,floatMenuRef:w,visible:L,setVisible:k,computePosition:j,isScrolling:P}=eo({plugin:n}),{targetRef:B,forceHidden:D}=et({containerRef:b}),{maxPositionX:N}=ei({messageRef:B,position:A,floatMenuRef:w}),_=n.pluginBizContext.storeSet.useSelectionStore(e=>e.isFloatMenuVisible&&!!e.floatMenuPosition);if((0,u.useEffect)(()=>(p(i.OnMessageUpdate,j),p(i.OnViewScroll,j),()=>{v(i.OnMessageUpdate,j),v(i.OnViewScroll,j)}),[]),!d||(0,a.b1)())return null;var R=null==A?void 0:A.y,T=(null!==(e=null==A?void 0:A.x)&&void 0!==e?e:0)>(null!=N?N:0)?N:null==A?void 0:A.x;return(0,S.createPortal)((0,C.jsx)(J,{ref:w,className:z()({hidden:!L||D||_||P}),style:{top:R,left:T},onMouseEnter:M,onMouseLeave:E,children:(0,C.jsx)(I,{onClick:()=>{var e,t,n,i,l,{source:u="",type:s="link",text:c=""}=null!==(i=h.current)&&void 0!==i?i:{},d=B.current,p=null==d?void 0:null===(e=d.attributes.getNamedItem(a.lp))||void 0===e?void 0:e.value;if(!!p){var v=O({messageId:p,chatAreaPluginContext:r});m(["image"===s?{type:a.y1.IMAGE,src:u,children:[{text:u}]}:{type:a.y1.LINK,url:u,children:[{text:c}]}]),x(!0),null===(t=(n=o.eventCallbacks).onQuote)||void 0===t||t.call(n,{botId:null!==(l=null==v?void 0:v.sender_id)&&void 0!==l?l:"",source:null==v?void 0:v.source})}},onClose:()=>{(0,U.Z)(()=>k(!1))}})}),null!==(t=null==s?void 0:s())&&void 0!==t?t:document.body)},ea=e=>(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(ee,(0,E._)({},e)),(0,C.jsx)(el,(0,E._)({},e))]}),eu=(0,n("466883").j)([],{variants:{showBackground:{true:["text-[#FFFFFF/60]"],false:["coz-fg-secondary"]}}}),es=n("988376"),ec={};ec.styleTagTransform=X(),ec.setAttributes=Z(),ec.insert=V().bind(null,"head"),ec.domAPI=T(),ec.insertStyleElement=q(),_()(es.Z,ec);var ed=es.Z&&es.Z.locals?es.Z.locals:void 0,ep=e=>{var{nodeList:t,theme:n,handleClickImage:r,showBackground:o}=e;return t.map((e,t)=>(0,a.mC)(e)?(0,C.jsx)("span",{className:z()("text-[14px] align-middle","leading-[16px]",{"coz-fg-secondary":"black"===n,[eu({showBackground:o})]:"white"===n}),children:e.text},t):(0,a.KC)(e)?(0,C.jsx)(B.Image,{className:z()(ed.image,"w-[24px] h-[24px] leading-[24px] align-middle rounded-[4px] cursor-zoom-in",{"mx-[4px]":0!==t,"mr-[4px]":0===t}),src:e.src,onClick:()=>r(e.src),fallback:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAAB4CAYAAADMtn8nAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAO7SURBVHgB7dy9bhRXGMfhc8ZeQmEku4hkOt8BXEAg0IUqqVBK0wfwHaDcARbpSU+KFBGk4ysXQK4gLunWEoSv9e5kjiVHFkmFEfg/fh5ptbOz0/70ntmZnVreM30xuzS8fdvV/lKt/Wrpy2qtZbUAn1Tfl91Sh1dfd+Z9fVb2lrfX1urO4WPqwcZ0OsQ62bt1qltsLXXDF7UAx8jefHgt6u3FbPLjEPJu27ef6X68y7OHpyf9+U64cGwt+lLezNo0nlxuEXdtZzdMXvHC8dcaba2WyexW+1yn09cbp77o/lpeKkCItpx+9ba73C26pS3xQpalodnl5f67brJUzhUgSjvbHa4Ufd31pd8oQJx2ebcbToo3CpCnr6tdASK1G60EDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMEEDMGWC5EePPi93LnzU3n58mU5ivX19XLt2ma5cuWbQp764u+3/SkZx7l69fvy/Pnz8jGsrKyU+/d/K2R5t2cCxzqI98mTR+UoLl68dOQpzufjHBiCmcAj0SbpgaNOZXKYwBBMwBDMEnokLJtPJhP4hGm/Xt+8uVUYBxP4BGnx3rix9dGuH/P5mcAnhHjHScAjdO/eL+Xu3Z///Sze8bKEHpkW7uF42z3O4h0vAY/I+/G27TaN3So5XpbQI/F+vAfEO24CHoGnT//433gZP0voEbhw4Ss3cpxQJjAEM4FDtT/ht/Pbw/9C+lBnz64XMpnAoa5f/+GjhHfmzErZ3NwsZPJIHQjVHqljAkMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUMwAUOwru/LbgEidX0RMCQa2t0ZAq4ChkR93enm8/K4AHHmffmzWyzqr3vzAgTZb3Zvcrv7cm3y6M2sbi/6AgRorb6b1+21tbpT247ptF8ty7OHpyf9+a4W4Jhq8Q4D99kwfS8PAe/uXwduG23Hm7d123IajqfW5quh0YN4277/zNvp9PXGolvamiyVc6X2G8MBGwX45Pp+qK/2O8P77hDv4/Z7VTvlPXzMP0hBAZYIUs8OAAAAAElFTkSuQmCC",preview:!1},t):(0,a.__)(e)?(0,C.jsxs)("span",{className:z()("text-[14px] align-middle","leading-[16px]",{"coz-fg-secondary":"black"===n,[eu({showBackground:o})]:"white"===n}),children:["[",ep({nodeList:e.children,theme:n,handleClickImage:r,showBackground:o}),"]"]},t):null)},ev=e=>{var{nodeList:t,theme:n}=e,[r,o]=(0,u.useState)(""),i=(0,f.rz)();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(B.ImagePreview,{src:r,visible:!!r,onVisibleChange:()=>o("")}),ep({nodeList:t,theme:n,handleClickImage:e=>{o(e)},showBackground:i})]})},eg=e=>{if(e.content_type===f.zc.Mix){var{refer_items:t}=null!==(n=JSON.parse(e.content))&&void 0!==n?n:{};if(t){var n,r,o,i,l=null==t?void 0:t[0];if((null==l?void 0:l.type)==="text")return{type:f.zc.Text,text:null==l?void 0:l.text};if((null==l?void 0:l.type)==="image")return{type:f.zc.Image,uri:null==l?void 0:null===(r=l.image)||void 0===r?void 0:r.key,url:null==l?void 0:null===(i=l.image)||void 0===i?void 0:null===(o=i.image_thumb)||void 0===o?void 0:o.url}}}},em=e=>{var{children:t}=e,n=(0,f.rz)();return(0,C.jsxs)("div",{className:z()(["h-auto","py-4px"],"flex flex-row items-center select-none w-m-0"),children:[(0,C.jsx)(P.Z57,{className:z()(eu({showBackground:n}),"mr-[8px] shrink-0 w-[12px] h-[12px]")}),(0,C.jsx)("div",{className:z()("flex-1 min-w-0 truncate text-[12px]",["leading-[16px]",eu({showBackground:n})]),children:t})]})},ex=e=>{var{message:t}=e,n=eg(t);if(!n)return null;if(n.type===f.zc.Image)return(0,C.jsx)(em,{children:(0,C.jsx)("img",{className:"w-[24px] h-[24px] rounded-[4px]",src:n.url})});var r=(0,a.hl)(n.text);return(0,C.jsx)(em,{children:(0,C.jsx)(ev,{nodeList:r,theme:"white"})})},eM=e=>{var{message:t}=e,n=t.extra_info.local_message_id,{useQuoteStore:r}=(0,f.FL)(f.p7.MessageGrab).pluginBizContext.storeSet,o=r((0,y.N)(e=>e.quoteContentMap[n]));return o?(0,C.jsx)(em,{children:(0,C.jsx)(ev,{nodeList:o,theme:"white"})}):null},ef=e=>{var{message:t}=e,n=t.extra_info.local_message_id,{useQuoteStore:r}=(0,f.FL)(f.p7.MessageGrab).pluginBizContext.storeSet;return r((0,y.N)(e=>!!e.quoteContentMap[n]))?(0,C.jsx)(eM,{message:t}):(0,C.jsx)(ex,{message:t})},eE=()=>{var{pluginBizContext:e,chatAreaPluginContext:t}=(0,f.FL)(f.p7.MessageGrab),{useChatInputLayout:n}=t.readonlyHook.input,{useQuoteStore:r}=e.storeSet,{quoteVisible:o,quoteContent:i,updateQuoteVisible:l,updateQuoteContent:a}=r((0,y.N)(e=>({quoteVisible:e.quoteVisible,quoteContent:e.quoteContent,updateQuoteVisible:e.updateQuoteVisible,updateQuoteContent:e.updateQuoteContent}))),{layoutContainerRef:s}=n();return((0,u.useEffect)(()=>{if(!!(null==s?void 0:s.current)){var e=e=>e.stopPropagation();return s.current.addEventListener("pointerup",e),()=>{var t;null===(t=s.current)||void 0===t||t.removeEventListener("pointerup",e)}}},[null==s?void 0:s.current]),i&&o)?(0,C.jsxs)("div",{className:"w-full h-[32px] flex items-center px-[16px] coz-mg-primary",children:[(0,C.jsx)(P.Z57,{className:"coz-fg-secondary mr-[8px] w-[12px] h-[12px]"}),(0,C.jsxs)("div",{className:"flex flex-row items-center flex-1",children:[(0,C.jsx)("div",{className:"coz-fg-secondary flex-1 min-w-0 w-0 truncate text-[12px] leading-[16px]",children:(0,C.jsx)(ev,{nodeList:i,theme:"black"})}),(0,C.jsx)(B.IconButton,{icon:(0,C.jsx)(P.rmE,{className:"w-[14px] h-[14px]"}),onClick:()=>{a(null),l(!1)},color:"secondary",size:"small",className:"!rounded-[4px]",wrapperClass:"flex item-center justify-center"})]})]}):null};class eb extends f.x1{constructor(...e){super(...e),this.pluginMode=f.tf.Writeable,this.pluginName=f.p7.MessageGrab,this.customComponents=(0,f.S3)({MessageListFloatSlot:ea,TextMessageInnerTopSlot:ef,InputAddonTop:eE}),this.lifeCycleServices={appLifeCycleService:new w(this),messageLifeCycleService:new h(this),commandLifeCycleService:new A(this)},this.publicMethods={updateEnableGrab:e=>{if(!!this.pluginBizContext){var{updateEnableGrab:t}=this.pluginBizContext.storeSet.usePreferenceStore.getState();t(e)}}}}}var eh=(0,c.Z)(),eA=e=>{var{preference:t,onQuote:n,onQuoteChange:r,scene:o,getPopContainer:i}=e,l=(0,s.x0)();return{grabPlugin:{createPluginBizContext:()=>{var e={onQuote:n,onQuoteChange:r},a={useSelectionStore:v("plugin"),useQuoteStore:m("plugin"),usePreferenceStore:M("plugin")},u=(0,c.Z)();a.usePreferenceStore.getState().updateEnableGrab(t.enableGrab);var s=x({useQuoteStore:a.useQuoteStore},e);return{grabPluginId:l,storeSet:a,eventCallbacks:e,unsubscribe:()=>{s()},eventCenter:u,publicEventCenter:eh,scene:o,getPopContainer:i}},Plugin:eb},grabPluginId:l}},ew=e=>{var{onQuote:t,scene:n="other",getPopContainer:r}=null!=e?e:{},[o,i]=(0,u.useState)(!0),{grabPlugin:l,grabPluginId:a}=(0,u.useMemo)(()=>eA({preference:{enableGrab:!0},onQuote:t,onQuoteChange:e=>{var{isEmpty:t}=e;i(t)},scene:n,getPopContainer:r}),[]);return{grabEnableUpload:o,GrabPlugin:l,grabPluginId:a}}},766156:function(e,t,n){var r=n(160052),o=n.n(r),i=n(570717),l=n.n(i)()(o());l.push([e.id,".container-box-shadow--pSTRx9orT5YeqHLG{box-shadow:0 2px 6px 0 rgba(0,0,0,.08),0 4px 12px 0 rgba(0,0,0,.04);z-index:1}",""]),l.locals={"container-box-shadow":"container-box-shadow--pSTRx9orT5YeqHLG",containerBoxShadow:"container-box-shadow--pSTRx9orT5YeqHLG"},t.Z=l},988376:function(e,t,n){var r=n(160052),o=n.n(r),i=n(570717),l=n.n(i)()(o());l.push([e.id,".image--Oxrlk9ZYgc3jrxTP img{height:100%;object-fit:cover;width:100%}",""]),l.locals={image:"image--Oxrlk9ZYgc3jrxTP"},t.Z=l}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2232/76795.e766d96b.js.map