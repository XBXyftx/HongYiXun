/*! For license information please see 50860.331f59bb.js.LICENSE.txt */
(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["50860"],{43030:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var i,n=((i=n||{}).ALL="realtime.event",i.ALL_CLIENT="client.*",i.ALL_SERVER="server.*",i.ROOM_INFO="client.room.info",i.CONNECTED="client.connected",i.CONNECTING="client.connecting",i.INTERRUPTED="client.interrupted",i.DISCONNECTED="client.disconnected",i.AUDIO_UNMUTED="client.audio.unmuted",i.AUDIO_MUTED="client.audio.muted",i.VIDEO_ON="client.video.on",i.VIDEO_OFF="client.video.off",i.VIDEO_ERROR="client.video.error",i.PLAYER_EVENT="client.video.event",i.ERROR="client.error",i.SUPPRESS_STATIONARY_NOISE="client.suppress.stationary.noise",i.SUPPRESS_NON_STATIONARY_NOISE="client.suppress.non.stationary.noise",i.AUDIO_INPUT_DEVICE_CHANGED="client.input.device.changed",i.AUDIO_OUTPUT_DEVICE_CHANGED="client.output.device.changed",i.VIDEO_INPUT_DEVICE_CHANGED="client.video.input.device.changed",i.NETWORK_QUALITY="client.network.quality",i.BOT_JOIN="server.bot.join",i.BOT_LEAVE="server.bot.leave",i.AUDIO_AGENT_SPEECH_STARTED="server.audio.agent.speech_started",i.AUDIO_AGENT_SPEECH_STOPPED="server.audio.agent.speech_stopped",i.SERVER_ERROR="server.error",i.AUDIO_USER_SPEECH_STARTED="server.audio.user.speech_started",i.AUDIO_USER_SPEECH_STOPPED="server.audio.user.speech_stopped",i.SESSION_CREATED="server.session.created",i.SESSION_UPDATED="server.session.updated",i.CONVERSATION_CREATED="server.conversation.created",i.CONVERSATION_CHAT_CREATED="server.conversation.chat.created",i.CONVERSATION_CHAT_IN_PROGRESS="server.conversation.chat.in_progress",i.CONVERSATION_MESSAGE_DELTA="server.conversation.message.delta",i.CONVERSATION_MESSAGE_COMPLETED="server.conversation.message.completed",i.CONVERSATION_CHAT_COMPLETED="server.conversation.chat.completed",i.CONVERSATION_CHAT_REQUIRES_ACTION="server.conversation.chat.requires_action",i.CONVERSATION_CHAT_FAILED="server.conversation.chat.failed",i.SESSION_PRE_ANSWER_UPDATED="server.session.pre_answer.updated",i.CONVERSATION_AUDIO_TRANSCRIPT_DELTA="server.conversation.audio_transcript.delta",i.MODE_UPDATED="server.mode.updated",i);let o=n},486644:function(e,t,r){"use strict";r.d(t,{C$:function(){return po}});var i,n,o,a,s,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{};function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u={exports:{}},l=function(e){return e&&e.Math===Math&&e},h=l("object"==typeof globalThis&&globalThis)||l("object"==typeof window&&window)||l("object"==typeof self&&self)||l("object"==typeof c&&c)||function(){return this}()||c||Function("return this")(),p=function(e){try{return!!e()}catch(e){return!0}},f=!p(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),_=Function.prototype,A=_.apply,m=_.call,v="object"==typeof Reflect&&Reflect.apply||(f?m.bind(A):function(){return m.apply(A,arguments)}),E=Function.prototype,g=E.call,S=f&&E.bind.bind(g,g),b=f?S:function(e){return function(){return g.apply(e,arguments)}},T=b({}.toString),y=b("".slice),R=function(e){return y(T(e),8,-1)},I=function(e){if("Function"===R(e))return b(e)},C="object"==typeof document&&document.all,k={all:C,IS_HTMLDDA:void 0===C&&void 0!==C},w=k.all,O=k.IS_HTMLDDA?function(e){return"function"==typeof e||e===w}:function(e){return"function"==typeof e},N={},P=!p(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),D=Function.prototype.call,L=f?D.bind(D):function(){return D.apply(D,arguments)},M={},x={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,B=U&&!x.call({1:2},1);M.f=B?function(e){var t=U(this,e);return!!t&&t.enumerable}:x;var V,F,j=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},G=Object,W=b("".split),H=p(function(){return!G("z").propertyIsEnumerable(0)})?function(e){return"String"===R(e)?W(e,""):G(e)}:G,Y=function(e){return null==e},K=TypeError,Q=function(e){if(Y(e))throw K("Can't call method on "+e);return e},z=function(e){return H(Q(e))},X=k.all,J=k.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:O(e)||e===X}:function(e){return"object"==typeof e?null!==e:O(e)},q={},Z=function(e){return O(e)?e:void 0},$=function(e,t){return arguments.length<2?Z(q[e])||Z(h[e]):q[e]&&q[e][t]||h[e]&&h[e][t]},ee=b({}.isPrototypeOf),et="undefined"!=typeof navigator&&String(navigator.userAgent)||"",er=h.process,ei=h.Deno,en=er&&er.versions||ei&&ei.version,eo=en&&en.v8;eo&&(F=(V=eo.split("."))[0]>0&&V[0]<4?1:+(V[0]+V[1])),!F&&et&&(!(V=et.match(/Edge\/(\d+)/))||V[1]>=74)&&(V=et.match(/Chrome\/(\d+)/))&&(F=+V[1]);var ea=F,es=h.String,ec=!!Object.getOwnPropertySymbols&&!p(function(){var e=Symbol("symbol detection");return!es(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ea&&ea<41}),ed=ec&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,eu=Object,el=ed?function(e){return"symbol"==typeof e}:function(e){var t=$("Symbol");return O(t)&&ee(t.prototype,eu(e))},eh=String,ep=function(e){try{return eh(e)}catch(e){return"Object"}},ef=TypeError,e_=function(e){if(O(e))return e;throw ef(ep(e)+" is not a function")},eA=function(e,t){var r=e[t];return Y(r)?void 0:e_(r)},em=TypeError,ev={exports:{}},eE=Object.defineProperty,eg="__core-js_shared__",eS=h[eg]||function(e,t){try{eE(h,e,{value:t,configurable:!0,writable:!0})}catch(r){h[e]=t}return t}(eg,{});(ev.exports=function(e,t){return eS[e]||(eS[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.32.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.1/LICENSE",source:"https://github.com/zloirock/core-js"});var eb=ev.exports,eT=Object,ey=function(e){return eT(Q(e))},eR=b({}.hasOwnProperty),eI=Object.hasOwn||function(e,t){return eR(ey(e),t)},eC=0,ek=Math.random(),ew=b(1..toString),eO=function(e){return"Symbol("+(void 0===e?"":e)+")_"+ew(++eC+ek,36)},eN=h.Symbol,eP=eb("wks"),eD=ed?eN.for||eN:eN&&eN.withoutSetter||eO,eL=function(e){return eI(eP,e)||(eP[e]=ec&&eI(eN,e)?eN[e]:eD("Symbol."+e)),eP[e]},eM=function(e,t){var r,i;if("string"===t&&O(r=e.toString)&&!J(i=L(r,e))||O(r=e.valueOf)&&!J(i=L(r,e))||"string"!==t&&O(r=e.toString)&&!J(i=L(r,e)))return i;throw em("Can't convert object to primitive value")},ex=TypeError,eU=eL("toPrimitive"),eB=function(e,t){if(!J(e)||el(e))return e;var r,i=eA(e,eU);if(i){if(void 0===t&&(t="default"),!J(r=L(i,e,t))||el(r))return r;throw ex("Can't convert object to primitive value")}return void 0===t&&(t="number"),eM(e,t)},eV=function(e){var t=eB(e,"string");return el(t)?t:t+""},eF=h.document,ej=J(eF)&&J(eF.createElement),eG=function(e){return ej?eF.createElement(e):{}},eW=!P&&!p(function(){return 7!==Object.defineProperty(eG("div"),"a",{get:function(){return 7}}).a}),eH=Object.getOwnPropertyDescriptor;N.f=P?eH:function(e,t){if(e=z(e),t=eV(t),eW)try{return eH(e,t)}catch(e){}if(eI(e,t))return j(!L(M.f,e,t),e[t])};var eY=/#|\.prototype\./,eK=function(e,t){var r=ez[eQ(e)];return r===eJ||r!==eX&&(O(t)?p(t):!!t)},eQ=eK.normalize=function(e){return String(e).replace(eY,".").toLowerCase()},ez=eK.data={},eX=eK.NATIVE="N",eJ=eK.POLYFILL="P",eq=I(I.bind),eZ=function(e,t){return e_(e),void 0===t?e:f?eq(e,t):function(){return e.apply(t,arguments)}},e$={},e0=P&&p(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),e2=String,e1=TypeError,e4=function(e){if(J(e))return e;throw e1(e2(e)+" is not an object")},e6=TypeError,e3=Object.defineProperty,e8=Object.getOwnPropertyDescriptor,e5="enumerable",e9="configurable",e7="writable";e$.f=P?e0?function(e,t,r){if(e4(e),t=eV(t),e4(r),"function"==typeof e&&"prototype"===t&&"value"in r&&e7 in r&&!r[e7]){var i=e8(e,t);i&&i[e7]&&(e[t]=r.value,r={configurable:e9 in r?r[e9]:i[e9],enumerable:e5 in r?r[e5]:i[e5],writable:!1})}return e3(e,t,r)}:e3:function(e,t,r){if(e4(e),t=eV(t),e4(r),eW)try{return e3(e,t,r)}catch(e){}if("get"in r||"set"in r)throw e6("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var te=P?function(e,t,r){return e$.f(e,t,j(1,r))}:function(e,t,r){return e[t]=r,e},tt=N.f,tr=function(e){var t=function(r,i,n){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,n)}return v(e,this,arguments)};return t.prototype=e.prototype,t},ti=function(e,t){var r,i,n,o,a,s,c,d,u,l=e.target,p=e.global,f=e.stat,_=e.proto,A=p?h:f?h[l]:(h[l]||{}).prototype,m=p?q:q[l]||te(q,l,{})[l],v=m.prototype;for(o in t)i=!(r=eK(p?o:l+(f?".":"#")+o,e.forced))&&A&&eI(A,o),s=m[o],i&&(c=e.dontCallGetSet?(u=tt(A,o))&&u.value:A[o]),a=i&&c?c:t[o],i&&typeof s==typeof a||(d=e.bind&&i?eZ(a,h):e.wrap&&i?tr(a):_&&O(a)?I(a):a,(e.sham||a&&a.sham||s&&s.sham)&&te(d,"sham",!0),te(m,o,d),_&&(eI(q,n=l+"Prototype")||te(q,n,{}),te(q[n],o,a),e.real&&v&&(r||!v[o])&&te(v,o,a)))},tn=e$.f;ti({target:"Object",stat:!0,forced:Object.defineProperty!==tn,sham:!P},{defineProperty:tn});var to=q.Object,ta=u.exports=function(e,t,r){return to.defineProperty(e,t,r)};to.defineProperty.sham&&(ta.sham=!0);var ts=u.exports,tc=d(ts),td=Array.isArray||function(e){return"Array"===R(e)},tu=Math.ceil,tl=Math.floor,th=Math.trunc||function(e){var t=+e;return(t>0?tl:tu)(t)},tp=function(e){var t=+e;return t!=t||0===t?0:th(t)},tf=Math.min,t_=function(e){return e>0?tf(tp(e),0x1fffffffffffff):0},tA=function(e){return t_(e.length)},tm=TypeError,tv=function(e){if(e>0x1fffffffffffff)throw tm("Maximum allowed index exceeded");return e},tE=function(e,t,r){var i=eV(t);i in e?e$.f(e,i,j(0,r)):e[i]=r},tg=eL("toStringTag"),tS={};tS[tg]="z";var tb="[object z]"===String(tS),tT=eL("toStringTag"),ty=Object,tR="Arguments"===R(function(){return arguments}()),tI=function(e,t){try{return e[t]}catch(e){}},tC=tb?R:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tI(t=ty(e),tT))?r:tR?R(t):"Object"===(i=R(t))&&O(t.callee)?"Arguments":i},tk=b(Function.toString);O(eS.inspectSource)||(eS.inspectSource=function(e){return tk(e)});var tw=eS.inspectSource,tO=function(){},tN=[],tP=$("Reflect","construct"),tD=/^\s*(?:class|function)\b/,tL=b(tD.exec),tM=!tD.exec(tO),tx=function(e){if(!O(e))return!1;try{return tP(tO,tN,e),!0}catch(e){return!1}},tU=function(e){if(!O(e))return!1;switch(tC(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return tM||!!tL(tD,tw(e))}catch(e){return!0}};tU.sham=!0;var tB=!tP||p(function(){var e;return tx(tx.call)||!tx(Object)||!tx(function(){e=!0})||e})?tU:tx,tV=eL("species"),tF=Array,tj=function(e){var t;return td(e)&&(tB(t=e.constructor)&&(t===tF||td(t.prototype))||J(t)&&null===(t=t[tV]))&&(t=void 0),void 0===t?tF:t},tG=function(e,t){return new(tj(e))(0===t?0:t)},tW=eL("species"),tH=function(e){return ea>=51||!p(function(){var t=[];return(t.constructor={})[tW]=function(){return{foo:1}},1!==t[e](Boolean).foo})},tY=eL("isConcatSpreadable"),tK=ea>=51||!p(function(){var e=[];return e[tY]=!1,e.concat()[0]!==e}),tQ=function(e){if(!J(e))return!1;var t=e[tY];return void 0!==t?!!t:td(e)};ti({target:"Array",proto:!0,arity:1,forced:!tK||!tH("concat")},{concat:function(e){var t,r,i,n,o,a=ey(this),s=tG(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(tQ(o=-1===t?a:arguments[t]))for(tv(c+(n=tA(o))),r=0;r<n;r++,c++)r in o&&tE(s,c,o[r]);else tv(c+1),tE(s,c++,o);return s.length=c,s}});var tz=String,tX=function(e){if("Symbol"===tC(e))throw TypeError("Cannot convert a Symbol value to a string");return tz(e)},tJ={},tq=Math.max,tZ=Math.min,t$=function(e,t){var r=tp(e);return r<0?tq(r+t,0):tZ(r,t)},t0=function(e){return function(t,r,i){var n,o=z(t),a=tA(o),s=t$(i,a);if(e&&r!=r){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},t2={includes:t0(!0),indexOf:t0(!1)},t1={},t4=t2.indexOf,t6=b([].push),t3=function(e,t){var r,i=z(e),n=0,o=[];for(r in i)!eI(t1,r)&&eI(i,r)&&t6(o,r);for(;t.length>n;)eI(i,r=t[n++])&&(~t4(o,r)||t6(o,r));return o},t8=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],t5=Object.keys||function(e){return t3(e,t8)};tJ.f=P&&!e0?Object.defineProperties:function(e,t){e4(e);for(var r,i=z(t),n=t5(t),o=n.length,a=0;o>a;)e$.f(e,r=n[a++],i[r]);return e};var t9,t7=$("document","documentElement"),re=eb("keys"),rt=function(e){return re[e]||(re[e]=eO(e))},rr="prototype",ri="script",rn=rt("IE_PROTO"),ro=function(){},ra=function(e){return"<"+ri+">"+e+"</"+ri+">"},rs=function(e){e.write(ra("")),e.close();var t=e.parentWindow.Object;return e=null,t},rc=function(){var e,t=eG("iframe");return t.style.display="none",t7.appendChild(t),t.src=String("java"+ri+":"),(e=t.contentWindow.document).open(),e.write(ra("document.F=Object")),e.close(),e.F},rd=function(){try{t9=new ActiveXObject("htmlfile")}catch(e){}rd="undefined"!=typeof document?document.domain&&t9?rs(t9):rc():rs(t9);for(var e=t8.length;e--;)delete rd[rr][t8[e]];return rd()};t1[rn]=!0;var ru=Object.create||function(e,t){var r;return null!==e?(ro[rr]=e4(e),r=new ro,ro[rr]=null,r[rn]=e):r=rd(),void 0===t?r:tJ.f(r,t)},rl={},rh=t8.concat("length","prototype");rl.f=Object.getOwnPropertyNames||function(e){return t3(e,rh)};var rp={},rf=Array,r_=Math.max,rA=function(e,t,r){for(var i=tA(e),n=t$(t,i),o=t$(void 0===r?i:r,i),a=rf(r_(o-n,0)),s=0;n<o;n++,s++)tE(a,s,e[n]);return a.length=s,a},rm=rl.f,rv="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],rE=function(e){try{return rm(e)}catch(e){return rA(rv)}};rp.f=function(e){return rv&&"Window"===R(e)?rE(e):rm(z(e))};var rg={};rg.f=Object.getOwnPropertySymbols;var rS=function(e,t,r,i){return i&&i.enumerable?e[t]=r:te(e,t,r),e},rb=function(e,t,r){return e$.f(e,t,r)},rT={};rT.f=eL;var ry,rR,rI,rC=e$.f,rk=function(e){var t=q.Symbol||(q.Symbol={});eI(t,e)||rC(t,e,{value:rT.f(e)})},rw=function(){var e=$("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,i=eL("toPrimitive");t&&!t[i]&&rS(t,i,function(e){return L(r,this)},{arity:1})},rO=e$.f,rN=tb?({}).toString:function(){return"[object "+tC(this)+"]"},rP=eL("toStringTag"),rD=function(e,t,r,i){if(e){var n=r?e:e.prototype;eI(n,rP)||rO(n,rP,{configurable:!0,value:t}),i&&!tb&&te(n,"toString",rN)}},rL=h.WeakMap,rM=O(rL)&&/native code/.test(String(rL)),rx="Object already initialized",rU=h.TypeError,rB=h.WeakMap;if(rM||eS.state){var rV=eS.state||(eS.state=new rB);rV.get=rV.get,rV.has=rV.has,rV.set=rV.set,ry=function(e,t){if(rV.has(e))throw rU(rx);return t.facade=e,rV.set(e,t),t},rR=function(e){return rV.get(e)||{}},rI=function(e){return rV.has(e)}}else{var rF=rt("state");t1[rF]=!0,ry=function(e,t){if(eI(e,rF))throw rU(rx);return t.facade=e,te(e,rF,t),t},rR=function(e){return eI(e,rF)?e[rF]:{}},rI=function(e){return eI(e,rF)}}var rj={set:ry,get:rR,has:rI,enforce:function(e){return rI(e)?rR(e):ry(e,{})},getterFor:function(e){return function(t){var r;if(!J(t)||(r=rR(t)).type!==e)throw rU("Incompatible receiver, "+e+" required");return r}}},rG=b([].push),rW=function(e){var t=1===e,r=2===e,i=3===e,n=4===e,o=6===e,a=7===e,s=5===e||o;return function(c,d,u,l){for(var h,p,f=ey(c),_=H(f),A=eZ(d,u),m=tA(_),v=0,E=l||tG,g=t?E(c,m):r||a?E(c,0):void 0;m>v;v++)if((s||v in _)&&(p=A(h=_[v],v,f),e)){if(t)g[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:rG(g,h)}else switch(e){case 4:return!1;case 7:rG(g,h)}}return o?-1:i||n?n:g}},rH={forEach:rW(0),map:rW(1),filter:rW(2),some:rW(3),every:rW(4),find:rW(5),findIndex:rW(6),filterReject:rW(7)},rY=rH.forEach,rK=rt("hidden"),rQ="Symbol",rz="prototype",rX=rj.set,rJ=rj.getterFor(rQ),rq=Object[rz],rZ=h.Symbol,r$=rZ&&rZ[rz],r0=h.TypeError,r2=h.QObject,r1=N.f,r4=e$.f,r6=rp.f,r3=M.f,r8=b([].push),r5=eb("symbols"),r9=eb("op-symbols"),r7=eb("wks"),ie=!r2||!r2[rz]||!r2[rz].findChild,it=P&&p(function(){return 7!==ru(r4({},"a",{get:function(){return r4(this,"a",{value:7}).a}})).a})?function(e,t,r){var i=r1(rq,t);i&&delete rq[t],r4(e,t,r),i&&e!==rq&&r4(rq,t,i)}:r4,ir=function(e,t){var r=r5[e]=ru(r$);return rX(r,{type:rQ,tag:e,description:t}),P||(r.description=t),r},ii=function(e,t,r){e===rq&&ii(r9,t,r),e4(e);var i=eV(t);return e4(r),eI(r5,i)?(r.enumerable?(eI(e,rK)&&e[rK][i]&&(e[rK][i]=!1),r=ru(r,{enumerable:j(0,!1)})):(eI(e,rK)||r4(e,rK,j(1,{})),e[rK][i]=!0),it(e,i,r)):r4(e,i,r)},io=function(e,t){e4(e);var r=z(t);return rY(t5(r).concat(id(r)),function(t){P&&!L(ia,r,t)||ii(e,t,r[t])}),e},ia=function(e){var t=eV(e),r=L(r3,this,t);return!(this===rq&&eI(r5,t)&&!eI(r9,t))&&(!(r||!eI(this,t)||!eI(r5,t)||eI(this,rK)&&this[rK][t])||r)},is=function(e,t){var r=z(e),i=eV(t);if(r!==rq||!eI(r5,i)||eI(r9,i)){var n=r1(r,i);return!n||!eI(r5,i)||eI(r,rK)&&r[rK][i]||(n.enumerable=!0),n}},ic=function(e){var t=r6(z(e)),r=[];return rY(t,function(e){eI(r5,e)||eI(t1,e)||r8(r,e)}),r},id=function(e){var t=e===rq,r=r6(t?r9:z(e)),i=[];return rY(r,function(e){eI(r5,e)&&(!t||eI(rq,e))&&r8(i,r5[e])}),i};ec||(rS(r$=(rZ=function(){if(ee(r$,this))throw r0("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?tX(arguments[0]):void 0,t=eO(e),r=function(e){this===rq&&L(r,r9,e),eI(this,rK)&&eI(this[rK],t)&&(this[rK][t]=!1),it(this,t,j(1,e))};return P&&ie&&it(rq,t,{configurable:!0,set:r}),ir(t,e)})[rz],"toString",function(){return rJ(this).tag}),rS(rZ,"withoutSetter",function(e){return ir(eO(e),e)}),M.f=ia,e$.f=ii,tJ.f=io,N.f=is,rl.f=rp.f=ic,rg.f=id,rT.f=function(e){return ir(eL(e),e)},P&&rb(r$,"description",{configurable:!0,get:function(){return rJ(this).description}})),ti({global:!0,constructor:!0,wrap:!0,forced:!ec,sham:!ec},{Symbol:rZ}),rY(t5(r7),function(e){rk(e)}),ti({target:rQ,stat:!0,forced:!ec},{useSetter:function(){ie=!0},useSimple:function(){ie=!1}}),ti({target:"Object",stat:!0,forced:!ec,sham:!P},{create:function(e,t){return void 0===t?ru(e):io(ru(e),t)},defineProperty:ii,defineProperties:io,getOwnPropertyDescriptor:is}),ti({target:"Object",stat:!0,forced:!ec},{getOwnPropertyNames:ic}),rw(),rD(rZ,rQ),t1[rK]=!0;var iu=ec&&!!Symbol.for&&!!Symbol.keyFor,il=eb("string-to-symbol-registry"),ih=eb("symbol-to-string-registry");ti({target:"Symbol",stat:!0,forced:!iu},{for:function(e){var t=tX(e);if(eI(il,t))return il[t];var r=$("Symbol")(t);return il[t]=r,ih[r]=t,r}});var ip=eb("symbol-to-string-registry");ti({target:"Symbol",stat:!0,forced:!iu},{keyFor:function(e){if(!el(e))throw TypeError(ep(e)+" is not a symbol");if(eI(ip,e))return ip[e]}});var i_=b([].slice),iA=b([].push),im=function(e){if(O(e))return e;if(td(e)){for(var t=e.length,r=[],i=0;i<t;i++){var n=e[i];"string"==typeof n?iA(r,n):"number"!=typeof n&&"Number"!==R(n)&&"String"!==R(n)||iA(r,tX(n))}var o=r.length,a=!0;return function(e,t){if(a)return a=!1,t;if(td(this))return t;for(var i=0;i<o;i++)if(r[i]===e)return t}}},iv=String,iE=$("JSON","stringify"),ig=b(/./.exec),iS=b("".charAt),ib=b("".charCodeAt),iT=b("".replace),iy=b(1..toString),iR=/[\uD800-\uDFFF]/g,iI=/^[\uD800-\uDBFF]$/,iC=/^[\uDC00-\uDFFF]$/,ik=!ec||p(function(){var e=$("Symbol")("stringify detection");return"[null]"!==iE([e])||"{}"!==iE({a:e})||"{}"!==iE(Object(e))}),iw=p(function(){return'"\udf06\ud834"'!==iE("\udf06\ud834")||'"\udead"'!==iE("\udead")}),iO=function(e,t){var r=i_(arguments),i=im(t);if(O(i)||void 0!==e&&!el(e))return r[1]=function(e,t){if(O(i)&&(t=L(i,this,iv(e),t)),!el(t))return t},v(iE,null,r)},iN=function(e,t,r){var i=iS(r,t-1),n=iS(r,t+1);return ig(iI,e)&&!ig(iC,n)||ig(iC,e)&&!ig(iI,i)?"\\u"+iy(ib(e,0),16):e};iE&&ti({target:"JSON",stat:!0,arity:3,forced:ik||iw},{stringify:function(e,t,r){var i=i_(arguments),n=v(ik?iO:iE,null,i);return iw&&"string"==typeof n?iT(n,iR,iN):n}}),ti({target:"Object",stat:!0,forced:!ec||p(function(){rg.f(1)})},{getOwnPropertySymbols:function(e){var t=rg.f;return t?t(ey(e)):[]}});rk("asyncIterator");rk("hasInstance");rk("isConcatSpreadable");rk("iterator");rk("match");rk("matchAll");rk("replace");rk("search");rk("species");rk("split");rk("toPrimitive"),rw();rk("toStringTag"),rD($("Symbol"),"Symbol");rk("unscopables");rD(h.JSON,"JSON",!0);var iP,iD,iL,iM=q.Symbol,ix={},iU=Function.prototype,iB=P&&Object.getOwnPropertyDescriptor,iV=eI(iU,"name"),iF=iV&&(!P||P&&iB(iU,"name").configurable),ij={EXISTS:iV,PROPER:iV&&"something"===(function(){}).name,CONFIGURABLE:iF},iG=!p(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),iW=rt("IE_PROTO"),iH=Object,iY=iH.prototype,iK=iG?iH.getPrototypeOf:function(e){var t=ey(e);if(eI(t,iW))return t[iW];var r=t.constructor;return O(r)&&t instanceof r?r.prototype:t instanceof iH?iY:null},iQ=eL("iterator"),iz=!1;[].keys&&("next"in(iL=[].keys())?(iD=iK(iK(iL)))!==Object.prototype&&(iP=iD):iz=!0),O((iP=!J(iP)||p(function(){var e={};return iP[iQ].call(e)!==e})?{}:ru(iP))[iQ])||rS(iP,iQ,function(){return this});var iX={IteratorPrototype:iP,BUGGY_SAFARI_ITERATORS:iz},iJ=iX.IteratorPrototype,iq=function(){return this},iZ=function(e,t,r,i){var n=t+" Iterator";return e.prototype=ru(iJ,{next:j(+!i,r)}),rD(e,n,!1,!0),ix[n]=iq,e},i$=String,i0=TypeError,i2=function(e,t,r){try{return b(e_(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}},i1=function(e){if("object"==typeof e||O(e))return e;throw i0("Can't set "+i$(e)+" as a prototype")},i4=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=i2(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return e4(r),i1(i),t?e(r,i):r.__proto__=i,r}}():void 0),i6=ij.PROPER;ij.CONFIGURABLE,iX.IteratorPrototype;var i3=iX.BUGGY_SAFARI_ITERATORS,i8=eL("iterator"),i5="keys",i9="values",i7="entries",ne=function(){return this},nt=function(e,t,r,i,n,o,a){iZ(r,t,i);var s,c,d,u=function(e){if(e===n&&_)return _;if(!i3&&e in p)return p[e];switch(e){case i5:case i9:case i7:return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",h=!1,p=e.prototype,f=p[i8]||p["@@iterator"]||n&&p[n],_=!i3&&f||u(n),A="Array"===t&&p.entries||f;if(A&&(s=iK(A.call(new e)))!==Object.prototype&&s.next&&(rD(s,l,!0,!0),ix[l]=ne),i6&&n===i9&&f&&f.name!==i9&&(h=!0,_=function(){return L(f,this)}),n){if(c={values:u(i9),keys:o?_:u(i5),entries:u(i7)},a)for(d in c)!i3&&!h&&d in p||rS(p,d,c[d]);else ti({target:t,proto:!0,forced:i3||h},c)}return a&&p[i8]!==_&&rS(p,i8,_,{name:n}),ix[t]=_,c},nr=function(e,t){return{value:e,done:t}};e$.f;var ni="Array Iterator",nn=rj.set,no=rj.getterFor(ni);nt(Array,"Array",function(e,t){nn(this,{type:ni,target:z(e),index:0,kind:t})},function(){var e=no(this),t=e.target,r=e.kind,i=e.index++;if(!t||i>=t.length)return e.target=void 0,nr(void 0,!0);switch(r){case"keys":return nr(i,!1);case"values":return nr(t[i],!1)}return nr([i,t[i]],!1)},"values"),ix.Arguments=ix.Array;var na={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ns=eL("toStringTag");for(var nc in na){var nd=h[nc],nu=nd&&nd.prototype;nu&&tC(nu)!==ns&&te(nu,ns,nc),ix[nc]=ix.Array}var nl=e$.f,nh=eL("metadata"),np=Function.prototype;void 0===np[nh]&&nl(np,nh,{value:null});rk("asyncDispose");rk("dispose");rk("metadata");var nf=$("Symbol"),n_=nf.keyFor,nA=b(nf.prototype.valueOf),nm=nf.isRegisteredSymbol||function(e){try{return void 0!==n_(nA(e))}catch(e){return!1}};ti({target:"Symbol",stat:!0},{isRegisteredSymbol:nm});for(var nv=$("Symbol"),nE=nv.isWellKnownSymbol,ng=$("Object","getOwnPropertyNames"),nS=b(nv.prototype.valueOf),nb=eb("wks"),nT=0,ny=ng(nv),nR=ny.length;nT<nR;nT++)try{var nI=ny[nT];el(nv[nI])&&eL(nI)}catch(e){}var nC=function(e){if(nE&&nE(e))return!0;try{for(var t=nS(e),r=0,i=ng(nb),n=i.length;r<n;r++)if(nb[i[r]]==t)return!0}catch(e){}return!1};ti({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:nC});rk("matcher");rk("observable");ti({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:nm});ti({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:nC});rk("metadataKey");rk("patternMatch");rk("replaceAll");var nk=d(iM),nw=b("".charAt),nO=b("".charCodeAt),nN=b("".slice),nP=function(e){return function(t,r){var i,n,o=tX(Q(t)),a=tp(r),s=o.length;return a<0||a>=s?e?"":void 0:(i=nO(o,a))<55296||i>56319||a+1===s||(n=nO(o,a+1))<56320||n>57343?e?nw(o,a):i:e?nN(o,a,a+2):n-56320+(i-55296<<10)+65536}},nD={codeAt:nP(!1),charAt:nP(!0)},nL=nD.charAt,nM="String Iterator",nx=rj.set,nU=rj.getterFor(nM);nt(String,"String",function(e){nx(this,{type:nM,string:tX(e),index:0})},function(){var e,t=nU(this),r=t.string,i=t.index;return i>=r.length?nr(void 0,!0):(e=nL(r,i),t.index+=e.length,nr(e,!1))});var nB=rT.f("iterator"),nV=d(nB);function nF(e){return(nF="function"==typeof nk&&"symbol"==typeof nV?function(e){return typeof e}:function(e){return e&&"function"==typeof nk&&e.constructor===nk&&e!==nk.prototype?"symbol":typeof e})(e)}var nj=rT.f("toPrimitive"),nG=d(nj);function nW(e){var t=function(e,t){if("object"!==nF(e)||null===e)return e;var r=e[nG];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==nF(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===nF(t)?t:String(t)}function nH(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),tc(e,nW(i.key),i)}}function nY(e,t,r){return t&&nH(e.prototype,t),r&&nH(e,r),tc(e,"prototype",{writable:!1}),e}function nK(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function nQ(e,t,r){return(t=nW(t))in e?tc(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}ti({target:"Object",stat:!0,sham:!P},{create:ru});var nz=q.Object,nX=d(function(e,t){return nz.create(e,t)});ti({target:"Object",stat:!0,forced:p(function(){iK(1)}),sham:!iG},{getPrototypeOf:function(e){return iK(ey(e))}});var nJ=q.Object.getPrototypeOf,nq=d(nJ),nZ=function(e,t){var r=[][e];return!!r&&p(function(){r.call(null,t||function(){return 1},1)})},n$=rH.forEach,n0=nZ("forEach")?[].forEach:function(e){return n$(this,e,arguments.length>1?arguments[1]:void 0)};ti({target:"Array",proto:!0,forced:[].forEach!==n0},{forEach:n0});var n2=function(e){return q[e+"Prototype"]},n1=n2("Array").forEach,n4=Array.prototype,n6={DOMTokenList:!0,NodeList:!0},n3=d(function(e){var t=e.forEach;return e===n4||ee(n4,e)&&t===n4.forEach||eI(n6,tC(e))?n1:t}),n8=TypeError,n5=Object.getOwnPropertyDescriptor,n9=P&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}()?function(e,t){if(td(e)&&!n5(e,"length").writable)throw n8("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t};ti({target:"Array",proto:!0,arity:1,forced:p(function(){return 0x100000001!==[].push.call({length:0x100000000},1)})||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var t=ey(this),r=tA(t),i=arguments.length;tv(r+i);for(var n=0;n<i;n++)t[r]=arguments[n],r++;return n9(t,r),r}});var n7=n2("Array").push,oe=Array.prototype,ot=d(function(e){var t=e.push;return e===oe||ee(oe,e)&&t===oe.push?n7:t});ti({target:"Object",stat:!0},{setPrototypeOf:i4});var or=q.Object.setPrototypeOf,oi=d(or),on=b([].concat),oo=$("Reflect","ownKeys")||function(e){var t=rl.f(e4(e)),r=rg.f;return r?on(t,r(e)):t},oa=Error,os=b("".replace),oc=String(oa("zxcasd").stack),od=/\n\s*at [^:]*:[^\n]*/,ou=od.test(oc),ol=!p(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",j(1,7)),7!==e.stack)}),oh=function(e,t){if(ou&&"string"==typeof e&&!oa.prepareStackTrace)for(;t--;)e=os(e,od,"");return e},op=Error.captureStackTrace,of=eL("iterator"),o_=Array.prototype,oA=function(e){return void 0!==e&&(ix.Array===e||o_[of]===e)},om=eL("iterator"),ov=function(e){if(!Y(e))return eA(e,om)||eA(e,"@@iterator")||ix[tC(e)]},oE=TypeError,og=function(e,t){var r=arguments.length<2?ov(e):t;if(e_(r))return e4(L(r,e));throw oE(ep(e)+" is not iterable")},oS=function(e,t,r){var i,n;e4(e);try{if(!(i=eA(e,"return"))){if("throw"===t)throw r;return r}i=L(i,e)}catch(e){n=!0,i=e}if("throw"===t)throw r;if(n)throw i;return e4(i),r},ob=TypeError,oT=function(e,t){this.stopped=e,this.result=t},oy=oT.prototype,oR=function(e,t,r){var i,n,o,a,s,c,d,u=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),f=!(!r||!r.INTERRUPTED),_=eZ(t,u),A=function(e){return i&&oS(i,"normal",e),new oT(!0,e)},m=function(e){return l?(e4(e),f?_(e[0],e[1],A):_(e[0],e[1])):f?_(e,A):_(e)};if(h)i=e.iterator;else if(p)i=e;else{if(!(n=ov(e)))throw ob(ep(e)+" is not iterable");if(oA(n)){for(o=0,a=tA(e);a>o;o++)if((s=m(e[o]))&&ee(oy,s))return s;return new oT(!1)}i=og(e,n)}for(c=h?e.next:i.next;!(d=L(c,i)).done;){try{s=m(d.value)}catch(e){oS(i,"throw",e)}if("object"==typeof s&&s&&ee(oy,s))return s}return new oT(!1)},oI=function(e,t){J(t)&&"cause"in t&&te(e,"cause",t.cause)},oC=function(e,t,r,i){ol&&(op?op(e,t):te(e,"stack",oh(r,i)))},ok=eL("toStringTag"),ow=Error,oO=[].push,oN=function(e,t){var r,i=ee(oP,this);i4?r=i4(ow(),i?iK(this):oP):te(r=i?this:ru(oP),ok,"Error"),void 0!==t&&te(r,"message",function(e,t){return void 0===e?arguments.length<2?"":t:tX(e)}(t)),oC(r,oN,r.stack,1),arguments.length>2&&oI(r,arguments[2]);var n=[];return oR(e,oO,{that:n}),te(r,"errors",n),r};i4?i4(oN,ow):function(e,t,r){for(var i=oo(t),n=e$.f,o=N.f,a=0;a<i.length;a++){var s=i[a];eI(e,s)||r&&eI(r,s)||n(e,s,o(t,s))}}(oN,ow,{name:!0});var oP=oN.prototype=ru(ow.prototype,{constructor:j(1,oN),message:j(1,""),name:j(1,"AggregateError")});ti({global:!0,constructor:!0,arity:2},{AggregateError:oN});var oD,oL,oM,ox,oU="process"===R(h.process),oB=eL("species"),oV=function(e){var t=$(e);P&&t&&!t[oB]&&rb(t,oB,{configurable:!0,get:function(){return this}})},oF=TypeError,oj=function(e,t){if(ee(t,e))return e;throw oF("Incorrect invocation")},oG=TypeError,oW=function(e){if(tB(e))return e;throw oG(ep(e)+" is not a constructor")},oH=eL("species"),oY=function(e,t){var r,i=e4(e).constructor;return void 0===i||Y(r=e4(i)[oH])?t:oW(r)},oK=TypeError,oQ=function(e,t){if(e<t)throw oK("Not enough arguments");return e},oz=/(?:ipad|iphone|ipod).*applewebkit/i.test(et),oX=h.setImmediate,oJ=h.clearImmediate,oq=h.process,oZ=h.Dispatch,o$=h.Function,o0=h.MessageChannel,o2=h.String,o1=0,o4={},o6="onreadystatechange";p(function(){oD=h.location});var o3=function(e){if(eI(o4,e)){var t=o4[e];delete o4[e],t()}},o8=function(e){return function(){o3(e)}},o5=function(e){o3(e.data)},o9=function(e){h.postMessage(o2(e),oD.protocol+"//"+oD.host)};oX&&oJ||(oX=function(e){oQ(arguments.length,1);var t=O(e)?e:o$(e),r=i_(arguments,1);return o4[++o1]=function(){v(t,void 0,r)},oL(o1),o1},oJ=function(e){delete o4[e]},oU?oL=function(e){oq.nextTick(o8(e))}:oZ&&oZ.now?oL=function(e){oZ.now(o8(e))}:o0&&!oz?(ox=(oM=new o0).port2,oM.port1.onmessage=o5,oL=eZ(ox.postMessage,ox)):h.addEventListener&&O(h.postMessage)&&!h.importScripts&&oD&&"file:"!==oD.protocol&&!p(o9)?(oL=o9,h.addEventListener("message",o5,!1)):oL=o6 in eG("script")?function(e){t7.appendChild(eG("script"))[o6]=function(){t7.removeChild(this),o3(e)}}:function(e){setTimeout(o8(e),0)});var o7=oX,ae=function(){this.head=null,this.tail=null};ae.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var at,ar,ai,an,ao,aa=/ipad|iphone|ipod/i.test(et)&&"undefined"!=typeof Pebble,as=/web0s(?!.*chrome)/i.test(et),ac=N.f,ad=o7,au=h.MutationObserver||h.WebKitMutationObserver,al=h.document,ah=h.process,ap=h.Promise,af=ac(h,"queueMicrotask"),a_=af&&af.value;if(!a_){var aA=new ae,am=function(){var e,t;for(oU&&(e=ah.domain)&&e.exit();t=aA.get();)try{t()}catch(e){throw aA.head&&at(),e}e&&e.enter()};oz||oU||as||!au||!al?!aa&&ap&&ap.resolve?((an=ap.resolve(void 0)).constructor=ap,ao=eZ(an.then,an),at=function(){ao(am)}):oU?at=function(){ah.nextTick(am)}:(ad=eZ(ad,h),at=function(){ad(am)}):(ar=!0,ai=al.createTextNode(""),new au(am).observe(ai,{characterData:!0}),at=function(){ai.data=ar=!ar}),a_=function(e){aA.head||at(),aA.add(e)}}var av=a_,aE=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},ag=h.Promise,aS="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,ab=!aS&&!oU&&"object"==typeof window&&"object"==typeof document,aT=ag&&ag.prototype,ay=eL("species"),aR=!1,aI=O(h.PromiseRejectionEvent),aC={CONSTRUCTOR:eK("Promise",function(){var e=tw(ag),t=e!==String(ag);if(!t&&66===ea||!aT.catch||!aT.finally)return!0;if(!ea||ea<51||!/native code/.test(e)){var r=new ag(function(e){e(1)}),i=function(e){e(function(){},function(){})};if((r.constructor={})[ay]=i,!(aR=r.then(function(){})instanceof i))return!0}return!t&&(ab||aS)&&!aI}),REJECTION_EVENT:aI,SUBCLASSING:aR},ak={},aw=TypeError,aO=function(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw aw("Bad Promise constructor");t=e,r=i}),this.resolve=e_(t),this.reject=e_(r)};ak.f=function(e){return new aO(e)};var aN=o7,aP=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}},aD="Promise",aL=aC.CONSTRUCTOR,aM=aC.REJECTION_EVENT;aC.SUBCLASSING;var ax,aU,aB,aV=rj.getterFor(aD),aF=rj.set,aj=ag&&ag.prototype,aG=ag,aW=aj,aH=h.TypeError,aY=h.document,aK=h.process,aQ=ak.f,az=aQ,aX=!!(aY&&aY.createEvent&&h.dispatchEvent),aJ="unhandledrejection",aq=function(e){var t;return!(!J(e)||!O(t=e.then))&&t},aZ=function(e,t){var r,i,n,o=t.value,a=1===t.state,s=a?e.ok:e.fail,c=e.resolve,d=e.reject,u=e.domain;try{s?(a||(2===t.rejection&&a4(t),t.rejection=1),!0===s?r=o:(u&&u.enter(),r=s(o),u&&(u.exit(),n=!0)),r===e.promise?d(aH("Promise-chain cycle")):(i=aq(r))?L(i,r,c,d):c(r)):d(o)}catch(e){u&&!n&&u.exit(),d(e)}},a$=function(e,t){e.notified||(e.notified=!0,av(function(){for(var r,i=e.reactions;r=i.get();)aZ(r,e);e.notified=!1,t&&!e.rejection&&a2(e)}))},a0=function(e,t,r){var i,n;aX?((i=aY.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),h.dispatchEvent(i)):i={promise:t,reason:r},!aM&&(n=h["on"+e])?n(i):e===aJ&&aP("Unhandled promise rejection",r)},a2=function(e){L(aN,h,function(){var t,r=e.facade,i=e.value;if(a1(e)&&(t=aE(function(){oU?aK.emit("unhandledRejection",i,r):a0(aJ,r,i)}),e.rejection=oU||a1(e)?2:1,t.error))throw t.value})},a1=function(e){return 1!==e.rejection&&!e.parent},a4=function(e){L(aN,h,function(){var t=e.facade;oU?aK.emit("rejectionHandled",t):a0("rejectionhandled",t,e.value)})},a6=function(e,t,r){return function(i){e(t,i,r)}},a3=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,a$(e,!0))},a8=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw aH("Promise can't be resolved itself");var i=aq(t);i?av(function(){var r={done:!1};try{L(i,t,a6(a8,r,e),a6(a3,r,e))}catch(t){a3(r,t,e)}}):(e.value=t,e.state=1,a$(e,!1))}catch(t){a3({done:!1},t,e)}}};aL&&(aW=(aG=function(e){oj(this,aW),e_(e),L(ax,this);var t=aV(this);try{e(a6(a8,t),a6(a3,t))}catch(e){a3(t,e)}}).prototype,(ax=function(e){aF(this,{type:aD,done:!1,notified:!1,parent:!1,reactions:new ae,rejection:!1,state:0,value:void 0})}).prototype=rS(aW,"then",function(e,t){var r=aV(this),i=aQ(oY(this,aG));return r.parent=!0,i.ok=!O(e)||e,i.fail=O(t)&&t,i.domain=oU?aK.domain:void 0,0===r.state?r.reactions.add(i):av(function(){aZ(i,r)}),i.promise}),aU=function(){var e=new ax,t=aV(e);this.promise=e,this.resolve=a6(a8,t),this.reject=a6(a3,t)},ak.f=aQ=function(e){return e===aG||e===aB?new aU(e):az(e)}),ti({global:!0,constructor:!0,wrap:!0,forced:aL},{Promise:aG}),rD(aG,aD,!1,!0),oV(aD);var a5=eL("iterator"),a9=!1;try{var a7=0,se={next:function(){return{done:!!a7++}},return:function(){a9=!0}};se[a5]=function(){return this},Array.from(se,function(){throw 2})}catch(e){}var st=function(e,t){if(!t&&!a9)return!1;var r=!1;try{var i={};i[a5]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch(e){}return r},sr=aC.CONSTRUCTOR||!st(function(e){ag.all(e).then(void 0,function(){})});ti({target:"Promise",stat:!0,forced:sr},{all:function(e){var t=this,r=ak.f(t),i=r.resolve,n=r.reject,o=aE(function(){var r=e_(t.resolve),o=[],a=0,s=1;oR(e,function(e){var c=a++,d=!1;s++,L(r,t,e).then(function(e){d||(d=!0,o[c]=e,--s||i(o))},n)}),--s||i(o)});return o.error&&n(o.value),r.promise}});var si=aC.CONSTRUCTOR;ag&&ag.prototype,ti({target:"Promise",proto:!0,forced:si,real:!0},{catch:function(e){return this.then(void 0,e)}});ti({target:"Promise",stat:!0,forced:sr},{race:function(e){var t=this,r=ak.f(t),i=r.reject,n=aE(function(){var n=e_(t.resolve);oR(e,function(e){L(n,t,e).then(r.resolve,i)})});return n.error&&i(n.value),r.promise}}),ti({target:"Promise",stat:!0,forced:aC.CONSTRUCTOR},{reject:function(e){var t=ak.f(this);return L(t.reject,void 0,e),t.promise}});var sn=function(e,t){if(e4(e),J(t)&&t.constructor===e)return t;var r=ak.f(e);return(0,r.resolve)(t),r.promise},so=aC.CONSTRUCTOR,sa=$("Promise"),ss=!so;ti({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return sn(ss&&this===sa?ag:this,e)}});ti({target:"Promise",stat:!0,forced:sr},{allSettled:function(e){var t=this,r=ak.f(t),i=r.resolve,n=r.reject,o=aE(function(){var r=e_(t.resolve),n=[],o=0,a=1;oR(e,function(e){var s=o++,c=!1;a++,L(r,t,e).then(function(e){c||(c=!0,n[s]={status:"fulfilled",value:e},--a||i(n))},function(e){c||(c=!0,n[s]={status:"rejected",reason:e},--a||i(n))})}),--a||i(n)});return o.error&&n(o.value),r.promise}});var sc="No one promise resolved";ti({target:"Promise",stat:!0,forced:sr},{any:function(e){var t=this,r=$("AggregateError"),i=ak.f(t),n=i.resolve,o=i.reject,a=aE(function(){var i=e_(t.resolve),a=[],s=0,c=1,d=!1;oR(e,function(e){var u=s++,l=!1;c++,L(i,t,e).then(function(e){l||d||(d=!0,n(e))},function(e){l||d||(l=!0,a[u]=e,--c||o(new r(a,sc)))})}),--c||o(new r(a,sc))});return a.error&&o(a.value),i.promise}});var sd=ag&&ag.prototype;ti({target:"Promise",proto:!0,real:!0,forced:!!ag&&p(function(){sd.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=oY(this,$("Promise")),r=O(e);return this.then(r?function(r){return sn(t,e()).then(function(){return r})}:e,r?function(r){return sn(t,e()).then(function(){throw r})}:e)}});var su=q.Promise;ti({target:"Promise",stat:!0},{withResolvers:function(){var e=ak.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});ti({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=ak.f(this),r=aE(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var sl=d(su),sh=b([].reverse),sp=[1,2];ti({target:"Array",proto:!0,forced:String(sp)===String(sp.reverse())},{reverse:function(){return td(this)&&(this.length=this.length),sh(this)}});var sf=n2("Array").reverse,s_=Array.prototype,sA=function(e){var t=e.reverse;return e===s_||ee(s_,e)&&t===s_.reverse?sf:t},sm=d(sA),sv=tH("slice"),sE=eL("species"),sg=Array,sS=Math.max;ti({target:"Array",proto:!0,forced:!sv},{slice:function(e,t){var r,i,n,o=z(this),a=tA(o),s=t$(e,a),c=t$(void 0===t?a:t,a);if(td(o)&&((tB(r=o.constructor)&&(r===sg||td(r.prototype))||J(r)&&null===(r=r[sE]))&&(r=void 0),r===sg||void 0===r))return i_(o,s,c);for(i=new(void 0===r?sg:r)(sS(c-s,0)),n=0;s<c;s++,n++)s in o&&tE(i,n,o[s]);return i.length=n,i}});var sb=n2("Array").slice,sT=Array.prototype,sy=function(e){var t=e.slice;return e===sT||ee(sT,e)&&t===sT.slice?sb:t},sR=d(sy);function sI(){sI=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,n=tc||function(e,t,r){e[t]=r.value},o="function"==typeof nk?nk:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function d(e,t,r){return tc(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function u(t,r,i,o){var a=nX((r&&r.prototype instanceof A?r:A).prototype);return n(a,"_invoke",{value:function(t,r,i){var n=h;return function(o,a){if(n===p)throw Error("Generator is already running");if(n===f){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var c=function t(r,i){var n=i.method,o=r.iterator[n];if(o===e)return i.delegate=null,"throw"===n&&r.iterator.return&&(i.method="return",i.arg=e,t(r,i),"throw"===i.method)||"return"!==n&&(i.method="throw",i.arg=TypeError("The iterator does not provide a '"+n+"' method")),_;var a=l(o,r.iterator,i.arg);if("throw"===a.type)return i.method="throw",i.arg=a.arg,i.delegate=null,_;var s=a.arg;return s?s.done?(i[r.resultName]=s.value,i.next=r.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,_):s:(i.method="throw",i.arg=TypeError("iterator result is not an object"),i.delegate=null,_)}(s,i);if(c){if(c===_)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===h)throw n=f,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=p;var d=l(t,r,i);if("normal"===d.type){if(n=i.done?f:"suspendedYield",d.arg===_)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(n=f,i.method="throw",i.arg=d.arg)}}}(t,i,new I(o||[]))}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",p="executing",f="completed",_={};function A(){}function m(){}function v(){}var E={};d(E,a,function(){return this});var g=nq&&nq(nq(C([])));g&&g!==r&&i.call(g,a)&&(E=g);var S=v.prototype=A.prototype=nX(E);function b(e){var t;n3(t=["next","throw","return"]).call(t,function(t){d(e,t,function(e){return this._invoke(t,e)})})}function T(e,t){var r;n(this,"_invoke",{value:function(n,o){function a(){return new t(function(r,a){!function r(n,o,a,s){var c=l(e[n],e,o);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==nF(u)&&i.call(u,"__await")?t.resolve(u.__await).then(function(e){r("next",e,a,s)},function(e){r("throw",e,a,s)}):t.resolve(u).then(function(e){d.value=e,a(d)},function(e){return r("throw",e,a,s)})}s(c.arg)}(n,o,r,a)})}return r=r?r.then(a,a):a()}})}function y(e){var t,r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),ot(t=this.tryEntries).call(t,r)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],n3(e).call(e,y,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw TypeError(nF(t)+" is not iterable")}return m.prototype=v,n(S,"constructor",{value:v,configurable:!0}),n(v,"constructor",{value:m,configurable:!0}),m.displayName=d(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return oi?oi(e,v):(e.__proto__=v,d(e,c,"GeneratorFunction")),e.prototype=nX(S),e},t.awrap=function(e){return{__await:e}},b(T.prototype),d(T.prototype,s,function(){return this}),t.AsyncIterator=T,t.async=function(e,r,i,n,o){void 0===o&&(o=sl);var a=new T(u(e,r,i,n),o);return t.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},b(S),d(S,c,"Generator"),d(S,a,function(){return this}),d(S,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var i in t)ot(r).call(r,i);return sm(r).call(r),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=C,I.prototype={constructor:I,reset:function(t){var r;if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,n3(r=this.tryEntries).call(r,R),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+sR(n).call(n,1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(i,n){return s.type="throw",s.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),d=i.call(a,"finallyLoc");if(c&&d){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!d)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,_):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;R(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:C(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),_}},t}function sC(e,t,r,i,n,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):sl.resolve(c).then(i,n)}function sk(e){return function(){var t=this,r=arguments;return new sl(function(i,n){var o=e.apply(t,r);function a(e){sC(o,i,n,a,s,"next",e)}function s(e){sC(o,i,n,a,s,"throw",e)}a(void 0)})}}var sw=n2("Array").concat,sO=Array.prototype,sN=d(function(e){var t=e.concat;return e===sO||ee(sO,e)&&t===sO.concat?sw:t}),sP=d(su);q.JSON||(q.JSON={stringify:JSON.stringify});var sD=d(function(e,t,r){return v(q.JSON.stringify,null,arguments)}),sL=rH.map;ti({target:"Array",proto:!0,forced:!tH("map")},{map:function(e){return sL(this,e,arguments.length>1?arguments[1]:void 0)}});var sM=n2("Array").map,sx=Array.prototype,sU=d(function(e){var t=e.map;return e===sx||ee(sx,e)&&t===sx.map?sM:t}),sB=d(ov);ti({target:"Array",stat:!0},{isArray:td});var sV=q.Array.isArray,sF=d(sV),sj=function(e,t,r,i){try{return i?t(e4(r)[0],r[1]):t(r)}catch(t){oS(e,"throw",t)}},sG=Array,sW=function(e){var t=ey(e),r=tB(this),i=arguments.length,n=i>1?arguments[1]:void 0,o=void 0!==n;o&&(n=eZ(n,i>2?arguments[2]:void 0));var a,s,c,d,u,l,h=ov(t),p=0;if(!h||this===sG&&oA(h))for(a=tA(t),s=r?new this(a):sG(a);a>p;p++)l=o?n(t[p],p):t[p],tE(s,p,l);else for(u=(d=og(t,h)).next,s=r?new this:[];!(c=L(u,d)).done;p++)l=o?sj(d,n,[c.value,p],!0):c.value,tE(s,p,l);return s.length=p,s};ti({target:"Array",stat:!0,forced:!st(function(e){Array.from(e)})},{from:sW});var sH=q.Array.from,sY=d(sH);function sK(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function sQ(e,t){var r;if(e){if("string"==typeof e)return sK(e,t);var i=sR(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?sY(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?sK(e,t):void 0}}function sz(e,t){var r=void 0!==nk&&sB(e)||e["@@iterator"];if(!r){if(sF(e)||(r=sQ(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function sX(e){if(sF(e))return e}function sJ(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function sq(e,t){return sX(e)||function(e,t){var r=null==e?null:void 0!==nk&&sB(e)||e["@@iterator"];if(null!=r){var i,n,o,a,s=[],c=!0,d=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(i=o.call(r)).done)&&(ot(s).call(s,i.value),s.length!==t);c=!0);}catch(e){d=!0,n=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(d)throw n}}return s}}(e,t)||sQ(e,t)||sJ()}var sZ=rp.f;ti({target:"Object",stat:!0,forced:p(function(){return!Object.getOwnPropertyNames(1)})},{getOwnPropertyNames:sZ});var s$=q.Object,s0=d(function(e){return s$.getOwnPropertyNames(e)}),s2=rH.filter;ti({target:"Array",proto:!0,forced:!tH("filter")},{filter:function(e){return s2(this,e,arguments.length>1?arguments[1]:void 0)}});var s1=n2("Array").filter,s4=Array.prototype,s6=function(e){var t=e.filter;return e===s4||ee(s4,e)&&t===s4.filter?s1:t},s3=d(s6),s8=d(s6),s5=t2.includes;ti({target:"Array",proto:!0,forced:p(function(){return![,].includes()})},{includes:function(e){return s5(this,e,arguments.length>1?arguments[1]:void 0)}});var s9=n2("Array").includes,s7=eL("match"),ce=function(e){var t;return J(e)&&(void 0!==(t=e[s7])?!!t:"RegExp"===R(e))},ct=TypeError,cr=function(e){if(ce(e))throw ct("The method doesn't accept regular expressions");return e},ci=eL("match"),cn=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[ci]=!1,"/./"[e](t)}catch(e){}}return!1},co=b("".indexOf);ti({target:"String",proto:!0,forced:!cn("includes")},{includes:function(e){return!!~co(tX(Q(this)),tX(cr(e)),arguments.length>1?arguments[1]:void 0)}});var ca=n2("String").includes,cs=Array.prototype,cc=String.prototype,cd=d(function(e){var t=e.includes;return e===cs||ee(cs,e)&&t===cs.includes?s9:"string"==typeof e||e===cc||ee(cc,e)&&t===cc.includes?ca:t}),cu=TypeError,cl=function(e){return function(t,r,i,n){e_(r);var o=ey(t),a=H(o),s=tA(o),c=e?s-1:0,d=e?-1:1;if(i<2)for(;;){if(c in a){n=a[c],c+=d;break}if(c+=d,e?c<0:s<=c)throw cu("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=d)c in a&&(n=r(n,a[c],c,o));return n}},ch={left:cl(!1),right:cl(!0)}.left;ti({target:"Array",proto:!0,forced:!oU&&ea>79&&ea<83||!nZ("reduce")},{reduce:function(e){var t=arguments.length;return ch(this,e,t,t>1?arguments[1]:void 0)}});var cp=n2("Array").reduce,cf=Array.prototype,c_=d(function(e){var t=e.reduce;return e===cf||ee(cf,e)&&t===cf.reduce?cp:t}),cA=b(M.f),cm=b([].push),cv=P&&p(function(){var e=Object.create(null);return e[2]=2,!cA(e,2)}),cE=function(e){return function(t){for(var r,i=z(t),n=t5(i),o=cv&&null===iK(i),a=n.length,s=0,c=[];a>s;)r=n[s++],(!P||(o?r in i:cA(i,r)))&&cm(c,e?[r,i[r]]:i[r]);return c}},cg={entries:cE(!0),values:cE(!1)}.entries;ti({target:"Object",stat:!0},{entries:function(e){return cg(e)}});var cS=q.Object.entries,cb=d(cS);ti({target:"Object",stat:!0,forced:p(function(){t5(1)})},{keys:function(e){return t5(ey(e))}});var cT,cy,cR,cI,cC,ck,cw,cO,cN,cP,cD,cL,cM,cx,cU,cB,cV,cF=q.Object.keys,cj=d(cF),cG=d(cF),cW={},cH=c_(cT="undefined"!=typeof window?[[null===(cy=window.RTCPeerConnection)||void 0===cy?void 0:cy.prototype,"RTCPeerConnection.prototype"],[window.RTCPeerConnection,"RTCPeerConnection"],[null===(cR=window.RTCDataChannel)||void 0===cR?void 0:cR.prototype,"RTCDataChannel.prototype"],[window.RTCDataChannel,"RTCDataChannel"],[null===(cI=window.MediaStreamTrack)||void 0===cI?void 0:cI.prototype,"MediaStreamTrack.prototype"],[window.MediaStreamTrack,"MediaStreamTrack"],[null===(cC=window.MediaStream)||void 0===cC?void 0:cC.prototype,"MediaStream.prototype"],[window.MediaStream,"MediaStream"],[null===(ck=window.HTMLAudioElement)||void 0===ck?void 0:ck.prototype,"HTMLAudioElement.prototype"],[null===(cw=window.HTMLVideoElement)||void 0===cw?void 0:cw.prototype,"HTMLVideoElement.prototype"],[null===(cO=window.HTMLMediaElement)||void 0===cO?void 0:cO.prototype,"HTMLMediaElement.prototype"],[null!==(cN=null===(cP=window.AudioContext)||void 0===cP?void 0:cP.prototype)&&void 0!==cN?cN:null===(cD=window.webkitAudioContext)||void 0===cD?void 0:cD.prototype,"AudioContext.prototype"],[null===(cL=window.BaseAudioContext)||void 0===cL?void 0:cL.prototype,"BaseAudioContext.prototype"],[null===(cM=window.AudioNode)||void 0===cM?void 0:cM.prototype,"AudioNode.prototype"],[window.navigator.mediaDevices,"navigator.mediaDevices"],[window.console,"console"]]:[]).call(cT,function(e,t){var r=sq(t,2),i=r[0],n=r[1];return sN(e).call(e,function(e,t){if(!e)return[];var r,i=s0(e);return sU(r=s8(i).call(i,function(t){if("peerIdentity"===t)return!1;try{return"function"==typeof e[t]||void 0===e[t]}catch(e){return!1}})).call(r,function(r){return{obj:e,prefix:t,attr:r}})}(i,n))},[]);"undefined"!=typeof window&&cH.push({obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getUserMedia"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getDisplayMedia"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"enumerateDevices"},{obj:window.navigator.mediaDevices,prefix:"navigator.mediaDevices",attr:"getSupportedConstraints"});var cY,cK=sz(cH);try{for(cK.s();!(cY=cK.n()).done;){var cQ,cz=cY.value,cX=cz.obj,cJ=cz.prefix,cq=cz.attr;cW[sN(cQ="".concat(cJ,".")).call(cQ,cq)]=function(e,t){try{var r;return cd(r=e[t].toString()).call(r,"[native code]")?"native":"non-native"}catch(e){return"untouchable"}}(cX,cq)}}catch(e){cK.e(e)}finally{cK.f()}"undefined"!=typeof window&&(cd(cx=window.location.search).call(cx,"_rtc_debug_")||(null===(cU=window.localStorage)||void 0===cU?void 0:cU.getItem("_rtc_debug_")))&&console.log("RTC_AMBULANCE",cW);var cZ=sU(cB=s8(cV=cb(cW)).call(cV,function(e){var t=sq(e,2);return t[0],"non-native"===t[1]})).call(cB,function(e){var t=sq(e,2),r=t[0];return t[1],r});cG(cZ).length&&console.warn("RTC_AMBULANCE","have non-native code:\n",cZ.join("\n"));var c$="	\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF",c0=b("".replace),c2=RegExp("^["+c$+"]+"),c1=RegExp("(^|[^"+c$+"])["+c$+"]+$"),c4=function(e){return function(t){var r=tX(Q(t));return 1&e&&(r=c0(r,c2,"")),2&e&&(r=c0(r,c1,"$1")),r}},c6={start:c4(1),end:c4(2),trim:c4(3)},c3=c6.trim,c8=h.parseInt,c5=h.Symbol,c9=c5&&c5.iterator,c7=/^[+-]?0x/i,de=b(c7.exec),dt=8!==c8(c$+"08")||22!==c8(c$+"0x16")||c9&&!p(function(){c8(Object(c9))})?function(e,t){var r=c3(tX(e));return c8(r,t>>>0||(de(c7,r)?16:10))}:c8;ti({global:!0,forced:parseInt!==dt},{parseInt:dt});var dr=q.parseInt,di=d(dr),dn={exports:{}},da=p(function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}),ds=Object.isExtensible,dc=p(function(){ds(1)})||da?function(e){return!!J(e)&&(!da||"ArrayBuffer"!==R(e))&&(!ds||ds(e))}:ds,dd=!p(function(){return Object.isExtensible(Object.preventExtensions({}))}),du=e$.f,dl=!1,dh=eO("meta"),dp=0,df=function(e){du(e,dh,{value:{objectID:"O"+dp++,weakData:{}}})},d_=dn.exports={enable:function(){d_.enable=function(){},dl=!0;var e=rl.f,t=b([].splice),r={};r[dh]=1,e(r).length&&(rl.f=function(r){for(var i=e(r),n=0,o=i.length;n<o;n++)if(i[n]===dh){t(i,n,1);break}return i},ti({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:rp.f}))},fastKey:function(e,t){if(!J(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!eI(e,dh)){if(!dc(e))return"F";if(!t)return"E";df(e)}return e[dh].objectID},getWeakData:function(e,t){if(!eI(e,dh)){if(!dc(e))return!0;if(!t)return!1;df(e)}return e[dh].weakData},onFreeze:function(e){return dd&&dl&&dc(e)&&!eI(e,dh)&&df(e),e}};t1[dh]=!0;var dA=dn.exports,dm=e$.f,dv=rH.forEach,dE=rj.set,dg=rj.getterFor,dS=function(e,t,r){var i,n=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=n?"set":"add",s=h[e],c=s&&s.prototype,d={};if(P&&O(s)&&(o||c.forEach&&!p(function(){(new s).entries().next()}))){var u=(i=t(function(t,r){dE(oj(t,u),{type:e,collection:new s}),Y(r)||oR(r,t[a],{that:t,AS_ENTRIES:n})})).prototype,l=dg(e);dv(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(e){var t="add"===e||"set"===e;e in c&&(!o||"clear"!==e)&&te(u,e,function(r,i){var n=l(this).collection;if(!t&&o&&!J(r))return"get"===e&&void 0;var a=n[e](0===r?0:r,i);return t?this:a})}),o||dm(u,"size",{configurable:!0,get:function(){return l(this).collection.size}})}else i=r.getConstructor(t,e,n,a),dA.enable();return rD(i,e,!1,!0),d[e]=i,ti({global:!0,forced:!0},d),o||r.setStrong(i,e,n),i},db=function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:rS(e,i,t[i],r);return e},dT=dA.fastKey,dy=rj.set,dR=rj.getterFor,dI={getConstructor:function(e,t,r,i){var n=e(function(e,n){oj(e,o),dy(e,{type:t,index:ru(null),first:void 0,last:void 0,size:0}),P||(e.size=0),Y(n)||oR(n,e[i],{that:e,AS_ENTRIES:r})}),o=n.prototype,a=dR(t),s=function(e,t,r){var i,n,o=a(e),s=c(e,t);return s?s.value=r:(o.last=s={index:n=dT(t,!0),key:t,value:r,previous:i=o.last,next:void 0,removed:!1},o.first||(o.first=s),i&&(i.next=s),P?o.size++:e.size++,"F"!==n&&(o.index[n]=s)),e},c=function(e,t){var r,i=a(e),n=dT(t);if("F"!==n)return i.index[n];for(r=i.first;r;r=r.next)if(r.key===t)return r};return db(o,{clear:function(){for(var e=a(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,P?e.size=0:this.size=0},delete:function(e){var t=a(this),r=c(this,e);if(r){var i=r.next,n=r.previous;delete t.index[r.index],r.removed=!0,n&&(n.next=i),i&&(i.previous=n),t.first===r&&(t.first=i),t.last===r&&(t.last=n),P?t.size--:this.size--}return!!r},forEach:function(e){for(var t,r=a(this),i=eZ(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(i(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),db(o,r?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),P&&rb(o,"size",{configurable:!0,get:function(){return a(this).size}}),n},setStrong:function(e,t,r){var i=t+" Iterator",n=dR(t),o=dR(i);nt(e,t,function(e,t){dy(this,{type:i,target:e,state:n(e),kind:t,last:void 0})},function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?nr("keys"===t?r.key:"values"===t?r.value:[r.key,r.value],!1):(e.target=void 0,nr(void 0,!0))},r?"entries":"values",!r,!0),oV(t)}};dS("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},dI);var dC=q.Map,dk=function(e,t){return 1===t?function(t,r){return t[e](r)}:function(t,r,i){return t[e](r,i)}},dw=$("Map"),dO={Map:dw,set:dk("set",2),get:dk("get",1),has:dk("has",1),remove:dk("delete",1),proto:dw.prototype},dN=dO.Map,dP=dO.has,dD=dO.get,dL=dO.set,dM=b([].push);ti({target:"Map",stat:!0,forced:!0},{groupBy:function(e,t){Q(e),e_(t);var r=new dN,i=0;return oR(e,function(e){var n=t(e,i++);dP(r,n)?dM(dD(r,n),e):dL(r,n,[e])}),r}});var dx=[].push,dU=function(e){var t,r,i,n,o=arguments.length,a=o>1?arguments[1]:void 0;return oW(this),(t=void 0!==a)&&e_(a),Y(e)?new this:(r=[],t?(i=0,n=eZ(a,o>2?arguments[2]:void 0),oR(e,function(e){L(dx,r,n(e,i++))})):oR(e,dx,{that:r}),new this(r))};ti({target:"Map",stat:!0,forced:!0},{from:dU});var dB=function(){return new this(i_(arguments))};ti({target:"Map",stat:!0,forced:!0},{of:dB});var dV=function(e){if("object"==typeof e&&"size"in e&&"has"in e&&"get"in e&&"set"in e&&"delete"in e&&"entries"in e)return e;throw TypeError(ep(e)+" is not a map")},dF=dO.remove;ti({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=dV(this),r=!0,i=0,n=arguments.length;i<n;i++)e=dF(t,arguments[i]),r=r&&e;return!!r}});var dj=dO.get,dG=dO.has,dW=dO.set;ti({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var r,i,n=dV(this);return dG(n,e)?(r=dj(n,e),"update"in t&&(r=t.update(r,e,n),dW(n,e,r)),r):(i=t.insert(e,n),dW(n,e,i),i)}});var dH=function(e,t,r){for(var i,n,o=r?e:e.iterator,a=e.next;!(i=L(a,o)).done;)if(void 0!==(n=t(i.value)))return n},dY=function(e,t,r){return r?dH(e.entries(),function(e){return t(e[1],e[0])},!0):e.forEach(t)};ti({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=dV(this),r=eZ(e,arguments.length>1?arguments[1]:void 0);return!1!==dY(t,function(e,i){if(!r(e,i,t))return!1},!0)}});var dK=dO.Map,dQ=dO.set;ti({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=dV(this),r=eZ(e,arguments.length>1?arguments[1]:void 0),i=new dK;return dY(t,function(e,n){r(e,n,t)&&dQ(i,n,e)}),i}});ti({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=dV(this),r=eZ(e,arguments.length>1?arguments[1]:void 0),i=dY(t,function(e,i){if(r(e,i,t))return{value:e}},!0);return i&&i.value}});ti({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=dV(this),r=eZ(e,arguments.length>1?arguments[1]:void 0),i=dY(t,function(e,i){if(r(e,i,t))return{key:i}},!0);return i&&i.key}});ti({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return!0===dY(dV(this),function(t){var r,i;if((r=t)===(i=e)||r!=r&&i!=i)return!0},!0)}});var dz=dO.Map;ti({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var r=new(O(this)?this:dz);e_(t);var i=e_(r.set);return oR(e,function(e){L(i,r,t(e),e)}),r}});ti({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){var t=dY(dV(this),function(t,r){if(t===e)return{key:r}},!0);return t&&t.key}});var dX=dO.Map,dJ=dO.set;ti({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=dV(this),r=eZ(e,arguments.length>1?arguments[1]:void 0),i=new dX;return dY(t,function(e,n){dJ(i,r(e,n,t),e)}),i}});var dq=dO.Map,dZ=dO.set;ti({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=dV(this),r=eZ(e,arguments.length>1?arguments[1]:void 0),i=new dq;return dY(t,function(e,n){dZ(i,n,r(e,n,t))}),i}});var d$=dO.set;ti({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=dV(this),r=arguments.length,i=0;i<r;)oR(arguments[i++],function(e,r){d$(t,e,r)},{AS_ENTRIES:!0});return t}});var d0=TypeError;ti({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=dV(this),r=arguments.length<2,i=r?void 0:arguments[1];if(e_(e),dY(t,function(n,o){r?(r=!1,i=n):i=e(i,n,o,t)}),r)throw d0("Reduce of empty map with no initial value");return i}});ti({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=dV(this),r=eZ(e,arguments.length>1?arguments[1]:void 0);return!0===dY(t,function(e,i){if(r(e,i,t))return!0},!0)}});var d2=TypeError,d1=dO.get,d4=dO.has,d6=dO.set;ti({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=dV(this),i=arguments.length;e_(t);var n=d4(r,e);if(!n&&i<3)throw d2("Updating absent value");var o=n?d1(r,e):e_(i>2?arguments[2]:void 0)(e,r);return d6(r,e,t(o,e,r)),r}});var d3=TypeError,d8=function(e,t){var r,i=e4(this),n=e_(i.get),o=e_(i.has),a=e_(i.set),s=arguments.length>2?arguments[2]:void 0;if(!O(t)&&!O(s))throw d3("At least one callback required");return L(o,i,e)?(r=L(n,i,e),O(t)&&L(a,i,e,r=t(r))):O(s)&&L(a,i,e,r=s()),r};ti({target:"Map",proto:!0,real:!0,forced:!0},{upsert:d8});ti({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:d8});var d5=d(dC),d9=d(dC),d7=d(ts),ue=Object.assign,ut=Object.defineProperty,ur=b([].concat),ui=!ue||p(function(){if(P&&1!==ue({b:1},ue(ut({},"a",{enumerable:!0,get:function(){ut(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(e){t[e]=e}),7!==ue({},e)[r]||t5(ue({},t)).join("")!==i})?function(e,t){for(var r=ey(e),i=arguments.length,n=1,o=rg.f,a=M.f;i>n;)for(var s,c=H(arguments[n++]),d=o?ur(t5(c),o(c)):t5(c),u=d.length,l=0;u>l;)s=d[l++],P&&!L(a,c,s)||(r[s]=c[s]);return r}:ue;ti({target:"Object",stat:!0,arity:2,forced:Object.assign!==ui},{assign:ui});var un=q.Object.assign,uo=d(un);N.f;var ua=I("".endsWith),us=I("".slice),uc=Math.min;ti({target:"String",proto:!0,forced:!cn("endsWith")},{endsWith:function(e){var t=tX(Q(this));cr(e);var r=arguments.length>1?arguments[1]:void 0,i=t.length,n=void 0===r?i:uc(t_(r),i),o=tX(e);return ua?ua(t,o,n):us(t,n-o.length,n)===o}});var ud=n2("String").endsWith,uu=String.prototype,ul=d(function(e){var t=e.endsWith;return"string"==typeof e||e===uu||ee(uu,e)&&t===uu.endsWith?ud:t}),uh=!0,up=!0;function uf(e,t,r){var i=e.match(t);return i&&i.length>=r&&di(i[r],10)}function u_(e,t,r){if(e.RTCPeerConnection){var i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return n.apply(this,arguments);var o=function(e){var t=r(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new d9),this._eventMap[t].set(i,o),n.apply(this,[e,o])};var o=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(r))return o.apply(this,arguments);var i=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===cG(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},d7(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function uA(e){return"boolean"!=typeof e?Error("Argument type: "+nF(e)+". Please use a boolean."):(uh=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function um(e){return"boolean"!=typeof e?Error("Argument type: "+nF(e)+". Please use a boolean."):(up=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function uv(){"object"===("undefined"==typeof window?"undefined":nF(window))&&!uh&&"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}function uE(e,t){up&&console.warn(e+" is deprecated, please use "+t+" instead.")}function ug(e){return"[object Object]"===Object.prototype.toString.call(e)}function uS(e,t,r){var i=r?"outbound-rtp":"inbound-rtp",n=new d9;if(null===t)return n;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===i&&r.trackId===t.id&&function e(t,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),cG(r).forEach(function(n){ul(n).call(n,"Id")?e(t,t.get(r[n]),i):ul(n).call(n,"Ids")&&r[n].forEach(function(r){e(t,t.get(r),i)})}))}(e,r,n)})}),n}var ub=rH.find,uT="find",uy=!0;uT in[]&&[,][uT](function(){uy=!1}),ti({target:"Array",proto:!0,forced:uy},{find:function(e){return ub(this,e,arguments.length>1?arguments[1]:void 0)}});var uR=n2("Array").find,uI=Array.prototype,uC=d(function(e){var t=e.find;return e===uI||ee(uI,e)&&t===uI.find?uR:t}),uk=d(sy),uw=t2.indexOf,uO=I([].indexOf),uN=!!uO&&1/uO([1],1,-0)<0;ti({target:"Array",proto:!0,forced:uN||!nZ("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return uN?uO(this,e,t)||0:uw(this,e,t)}});var uP=n2("Array").indexOf,uD=Array.prototype,uL=function(e){var t=e.indexOf;return e===uD||ee(uD,e)&&t===uD.indexOf?uP:t},uM=d(uL),ux=d(uL),uU=TypeError,uB=function(e,t){if(!delete e[t])throw uU("Cannot delete property "+ep(t)+" of "+ep(e))},uV=tH("splice"),uF=Math.max,uj=Math.min;ti({target:"Array",proto:!0,forced:!uV},{splice:function(e,t){var r,i,n,o,a,s,c=ey(this),d=tA(c),u=t$(e,d),l=arguments.length;for(0===l?r=i=0:1===l?(r=0,i=d-u):(r=l-2,i=uj(uF(tp(t),0),d-u)),tv(d+r-i),n=tG(c,i),o=0;o<i;o++)(a=u+o)in c&&tE(n,o,c[a]);if(n.length=i,r<i){for(o=u;o<d-i;o++)s=o+r,(a=o+i)in c?c[s]=c[a]:uB(c,s);for(o=d;o>d-i+r;o--)uB(c,o-1)}else if(r>i)for(o=d-i;o>u;o--)s=o+r-1,(a=o+i-1)in c?c[s]=c[a]:uB(c,s);for(o=0;o<r;o++)c[o+u]=arguments[o+2];return n9(c,d-i+r),n}});var uG=n2("Array").splice,uW=Array.prototype,uH=d(function(e){var t=e.splice;return e===uW||ee(uW,e)&&t===uW.splice?uG:t}),uY={exports:{}},uK=N.f;ti({target:"Object",stat:!0,forced:!P||p(function(){uK(1)}),sham:!P},{getOwnPropertyDescriptor:function(e,t){return uK(z(e),t)}});var uQ=q.Object,uz=uY.exports=function(e,t){return uQ.getOwnPropertyDescriptor(e,t)};uQ.getOwnPropertyDescriptor.sham&&(uz.sham=!0);var uX=uY.exports,uJ=d(uX),uq=d(uX);function uZ(e,t){var r=e&&e.navigator;if(r.mediaDevices){var i=function(e){if("object"!==nF(e)||e.mandatory||e.optional)return e;var t,r={};return cG(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var i="object"===nF(e[t])?e[t]:{ideal:e[t]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+uk(t).call(t,1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){r.optional=r.optional||[];var o={};"number"==typeof i.ideal?(o[n("min",t)]=i.ideal,r.optional.push(o),(o={})[n("max",t)]=i.ideal):o[n("",t)]=i.ideal,r.optional.push(o)}void 0!==i.exact&&"number"!=typeof i.exact?(r.mandatory=r.mandatory||{},r.mandatory[n("",t)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(r.mandatory=r.mandatory||{},r.mandatory[n(e,t)]=i[e])})}}),e.advanced&&(r.optional=sN(t=r.optional||[]).call(t,e.advanced)),r},n=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(sD(e)))&&"object"===nF(e.audio)){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(sD(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===nF(e.video)){var a=e.video.facingMode;a=a&&("object"===nF(a)?a:{ideal:a});var s,c=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c)&&(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?s=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(s=["front"]),s))return r.mediaDevices.enumerateDevices().then(function(t){var r=uC(t=s8(t).call(t,function(e){return"videoinput"===e.kind})).call(t,function(e){return s.some(function(t){var r;return cd(r=e.label.toLowerCase()).call(r,t)})});return!r&&t.length&&cd(s).call(s,"back")&&(r=t[t.length-1]),r&&(e.video.deviceId=a.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=i(e.video),uv("chrome: "+sD(e)),n(e)});e.video=i(e.video)}return uv("chrome: "+sD(e)),n(e)},o=function(e){return t.version>=64?e:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(e,t,i){n(e,function(e){r.webkitGetUserMedia(e,t,function(e){i&&i(o(e))})})}).bind(r),r.mediaDevices.getUserMedia){var a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return n(e,function(e){return a(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return sP.reject(o(e))})})}}}}function u$(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function u0(e){if("object"!==nF(e)||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)u_(e,"track",function(e){return e.transceiver||d7(e,"transceiver",{value:{receiver:e.receiver}}),e});else{d7(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(i){n=e.RTCPeerConnection.prototype.getReceivers?uC(o=r.getReceivers()).call(o,function(e){return e.track&&e.track.id===i.track.id}):{track:i.track};var n,o,a=new Event("track");a.track=i.track,a.receiver=n,a.transceiver={receiver:n},a.streams=[t.stream],r.dispatchEvent(a)}),t.stream.getTracks().forEach(function(i){n=e.RTCPeerConnection.prototype.getReceivers?uC(o=r.getReceivers()).call(o,function(e){return e.track&&e.track.id===i.id}):{track:i};var n,o,a=new Event("track");a.track=i,a.receiver=n,a.transceiver={receiver:n},a.streams=[t.stream],r.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function u2(e){if("object"===nF(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){var e;return this._senders=this._senders||[],uk(e=this._senders).call(e)};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var n=r.apply(this,arguments);return n||(n=t(this,e),this._senders.push(n)),n};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t,r,n=ux(t=this._senders).call(t,e);-1!==n&&uH(r=this._senders).call(r,n,1)}}var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){var r,i,n,o=uC(r=t._senders).call(r,function(t){return t.track===e});o&&uH(i=t._senders).call(i,ux(n=t._senders).call(n,o),1)})}}else if("object"===nF(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},d7(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function u1(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=uk(Array.prototype).call(arguments),i=r[0],n=r[1],o=r[2];if(arguments.length>0&&"function"==typeof i)return t.apply(this,arguments);if(0===t.length&&(0==arguments.length||"function"!=typeof i))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){var t;return new d9(sU(t=cG(e)).call(t,function(t){return[t,e[t]]}))};return arguments.length>=2?t.apply(this,[function(e){n(s(a(e)))},i]):new sP(function(r,i){t.apply(e,[function(e){r(s(a(e)))},i])}).then(n,o)}}}function u4(e){if("object"===nF(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return uS(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),u_(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return uS(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,i,o=arguments[0];return this.getSenders().forEach(function(e){e.track===o&&(t?i=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===o&&(r?i=!0:r=e),e.track===o}),i||t&&r?sP.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():sP.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}}}function u6(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e,t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},sU(e=cG(this._shimmedLocalStreams)).call(e,function(e){return t._shimmedLocalStreams[e][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i,n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===ux(i=this._shimmedLocalStreams[r.id]).call(i,n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t,i,n=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){var t;if(uC(t=n.getSenders()).call(t,function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var o=this.getSenders();r.apply(this,arguments);var a=s8(t=this.getSenders()).call(t,function(e){return -1===ux(o).call(o,e)});this._shimmedLocalStreams[e.id]=sN(i=[e]).call(i,a)};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&cG(this._shimmedLocalStreams).forEach(function(r){var i,n,o=ux(i=t._shimmedLocalStreams[r]).call(i,e);-1!==o&&uH(n=t._shimmedLocalStreams[r]).call(n,o,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),n.apply(this,arguments)}}function u3(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return u6(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},sU(t).call(t,function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){var t;if(uC(t=r.getSenders()).call(t,function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var i,n,o,a=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var s=uk([]).call(arguments,1);if(1!==s.length||!uC(i=s[0].getTracks()).call(i,function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(uC(n=this.getSenders()).call(n,function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var c=this._streams[r.id];if(c)c.addTrack(t),sP.resolve().then(function(){a.dispatchEvent(new Event("negotiationneeded"))});else{var d=new e.MediaStream([t]);this._streams[r.id]=d,this._reverseStreams[d.id]=r,this.addStream(d)}return uC(o=this.getSenders()).call(o,function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],i=nQ({},t,function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var i=s(e,r);t[0].apply(null,[i])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(t){return s(e,t)})});e.RTCPeerConnection.prototype[t]=i[t]});var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t,r;return arguments.length&&arguments[0].type&&(arguments[0]=(e=this,r=(t=arguments[0]).sdp,cG(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r}))),o.apply(this,arguments)};var a=uq(e.RTCPeerConnection.prototype,"localDescription");d7(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},cG(this._streams).forEach(function(i){var n;uC(n=r._streams[i].getTracks()).call(n,function(t){return e.track===t})&&(t=r._streams[i])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var r=t.sdp;return cG(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}}function u8(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],i=nQ({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=i[t]})}function u5(e,t){u_(e,"negotiationneeded",function(e){var r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e})}var u9=Object.freeze({__proto__:null,fixNegotiationNeeded:u5,shimAddTrackRemoveTrack:u3,shimAddTrackRemoveTrackWithNative:u6,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var i=r.video&&r.video.width,n=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},i&&(r.video.mandatory.maxWidth=i),n&&(r.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:u2,shimGetStats:u1,shimGetUserMedia:uZ,shimMediaStream:u$,shimOnTrack:u0,shimPeerConnection:u8,shimSenderReceiverGetStats:u4});function u7(e){if(void 0!==nk&&null!=sB(e)||null!=e["@@iterator"])return sY(e)}function le(e){return function(e){if(sF(e))return sK(e)}(e)||u7(e)||sQ(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var lt=c6.trim,lr=b("".charAt),li=h.parseFloat,ln=h.Symbol,lo=ln&&ln.iterator,la=1/li(c$+"-0")!=-Infinity||lo&&!p(function(){li(Object(lo))})?function(e){var t=lt(tX(e)),r=li(t);return 0===r&&"-"===lr(t,0)?-0:r}:li;ti({global:!0,forced:parseFloat!==la},{parseFloat:la});var ls=q.parseFloat,lc=d(ls);function ld(e,t){var r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){uE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var n=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===nF(e)&&"object"===nF(e.audio)&&(n((e=JSON.parse(sD(e))).audio,"autoGainControl","mozAutoGainControl"),n(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},i&&i.prototype.getSettings){var a=i.prototype.getSettings;i.prototype.getSettings=function(){var e=a.apply(this,arguments);return n(e,"mozAutoGainControl","autoGainControl"),n(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var s=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===nF(e)&&(n(e=JSON.parse(sD(e)),"autoGainControl","mozAutoGainControl"),n(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}}function lu(e){"object"===nF(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&d7(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function ll(e,t){if("object"===nF(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],i=nQ({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=i[t]});var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=uk(Array.prototype).call(arguments),n=e[0],o=e[1],a=e[2];return i.apply(this,[n||null]).then(function(e){if(t.version<53&&!o)try{e.forEach(function(e){e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,i){e.set(i,uo({},t,{type:r[t.type]||t.type}))})}return e}).then(o,a)}}}function lh(e){if("object"===nF(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):sP.resolve(new d9)}}}function lp(e){if("object"===nF(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r}),u_(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function lf(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;uE("removeStream","removeTrack"),this.getSenders().forEach(function(r){var i;r.track&&cd(i=e.getTracks()).call(i,r.track)&&t.removeTrack(r)})})}function l_(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function lA(e){if("object"===nF(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var r=(e=le(e)).length>0;r&&e.forEach(function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(lc(e.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(lc(e.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});var i=t.apply(this,arguments);if(r){var n=i.sender,o=n.getParameters();"encodings"in o&&(1!==o.encodings.length||0!==cG(o.encodings[0]).length)||(o.encodings=e,n.sendEncodings=e,this.setParametersPromises.push(n.setParameters(o).then(function(){delete n.sendEncodings}).catch(function(){delete n.sendEncodings})))}return i})}}function lm(e){if("object"===nF(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e,r=t.apply(this,arguments);return"encodings"in r||(r.encodings=sN(e=[]).call(e,this.sendEncodings||[{}])),r})}}function lv(e){if("object"===nF(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?sP.all(this.setParametersPromises).then(function(){return t.apply(r,e)}).finally(function(){r.setParametersPromises=[]}):t.apply(this,arguments)}}}function lE(e){if("object"===nF(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?sP.all(this.setParametersPromises).then(function(){return t.apply(r,e)}).finally(function(){r.setParametersPromises=[]}):t.apply(this,arguments)}}}var lg=Object.freeze({__proto__:null,shimAddTransceiver:lA,shimCreateAnswer:lE,shimCreateOffer:lv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,sP.reject(i)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:lm,shimGetUserMedia:ld,shimOnTrack:lu,shimPeerConnection:ll,shimRTCDataChannel:l_,shimReceiverGetStats:lp,shimRemoveStream:lf,shimSenderGetStats:lh});function lS(e){if("object"===nF(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r,i=this;this._localStreams||(this._localStreams=[]),cd(r=this._localStreams).call(r,e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(r){return t.call(i,r,e)}),e.getVideoTracks().forEach(function(r){return t.call(i,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return n&&n.forEach(function(e){var t;r._localStreams?cd(t=r._localStreams).call(t,e)||r._localStreams.push(e):r._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t,r,i=this;this._localStreams||(this._localStreams=[]);var n=ux(t=this._localStreams).call(t,e);if(-1!==n){uH(r=this._localStreams).call(r,n,1);var o=e.getTracks();this.getSenders().forEach(function(e){cd(o).call(o,e.track)&&i.removeTrack(e)})}})}}function lb(e){if("object"===nF(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){d7(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var r;if(t._remoteStreams||(t._remoteStreams=[]),!cd(r=t._remoteStreams).call(r,e)){t._remoteStreams.push(e);var i=new Event("addstream");i.stream=e,t.dispatchEvent(i)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){var r;if(e._remoteStreams||(e._remoteStreams=[]),!(ux(r=e._remoteStreams).call(r,t)>=0)){e._remoteStreams.push(t);var i=new Event("addstream");i.stream=t,e.dispatchEvent(i)}})}),t.apply(e,arguments)}}}function lT(e){if("object"===nF(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),sP.resolve()):n},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),sP.resolve()):n};var s=function(e,t,r){var i=n.apply(this,[e]);return r?(i.then(t,r),sP.resolve()):i};t.setLocalDescription=s,s=function(e,t,r){var i=o.apply(this,[e]);return r?(i.then(t,r),sP.resolve()):i},t.setRemoteDescription=s,s=function(e,t,r){var i=a.apply(this,[e]);return r?(i.then(t,r),sP.resolve()):i},t.addIceCandidate=s}}function ly(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,i=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return i(lR(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}).bind(t))}function lR(e){return e&&void 0!==e.video?uo({},e,{video:function e(t){var r;return ug(t)?c_(r=cG(t)).call(r,function(r,i){var n=ug(t[i]),o=n?e(t[i]):t[i],a=n&&!cG(o).length;return void 0===o||a?r:uo(r,nQ({},i,o))},{}):t}(e.video)}):e}function lI(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var i=[],n=0;n<e.iceServers.length;n++){var o=e.iceServers[n];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(uE("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(sD(o))).urls=o.url,delete o.url,i.push(o)):i.push(e.iceServers[n])}e.iceServers=i}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&d7(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function lC(e){"object"===nF(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&d7(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function lk(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r,i,n=uC(r=this.getTransceivers()).call(r,function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=uC(i=this.getTransceivers()).call(i,function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function lw(e){"object"!==nF(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var lO=Object.freeze({__proto__:null,shimAudioContext:lw,shimCallbacksAPI:lT,shimConstraints:lR,shimCreateOfferLegacy:lk,shimGetUserMedia:ly,shimLocalStreamsAPI:lS,shimRTCIceServerUrls:lI,shimRemoteStreamsAPI:lb,shimTrackEventTransceiver:lC}),lN=ij.PROPER,lP="\u200B\x85\u180E",lD=c6.trim;ti({target:"String",proto:!0,forced:(p3="trim",p(function(){return!!c$[p3]()||lP[p3]()!==lP||lN&&c$[p3].name!==p3}))},{trim:function(){return lD(this)}});var lL=n2("String").trim,lM=String.prototype,lx=d(function(e){var t=e.trim;return"string"==typeof e||e===lM||ee(lM,e)&&t===lM.trim?lL:t}),lU={exports:{}};p8=lU,(p5={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}}).localCName=p5.generateIdentifier(),p5.splitLines=function(e){var t;return sU(t=lx(e).call(e).split("\n")).call(t,function(e){return lx(e).call(e)})},p5.splitSections=function(e){var t=e.split("\nm=");return sU(t).call(t,function(e,t){var r;return lx(r=t>0?"m="+e:e).call(r)+"\r\n"})},p5.getDescription=function(e){var t=p5.splitSections(e);return t&&t[0]},p5.getMediaSections=function(e){var t=p5.splitSections(e);return t.shift(),t},p5.matchPrefix=function(e,t){var r;return s8(r=p5.splitLines(e)).call(r,function(e){return 0===ux(e).call(e,t)})},p5.parseCandidate=function(e){for(var t,r={foundation:(t=0===ux(e).call(e,"a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:di(t[3],10),ip:t[4],address:t[4],port:di(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=di(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1],r.usernameFragment=t[i+1];break;default:void 0===r[t[i]]&&(r[t[i]]=t[i+1])}return r},p5.writeCandidate=function(e){var t=[];t.push(e.foundation);var r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},p5.parseIceOptions=function(e){return e.substr(14).split(" ")},p5.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:di(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=di(t[1],10),r.channels=3===t.length?di(t[2],10):1,r.numChannels=r.channels,r},p5.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},p5.parseExtmap=function(e){var t,r=e.substr(9).split(" ");return{id:di(r[0],10),direction:ux(t=r[0]).call(t,"/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},p5.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},p5.parseFmtp=function(e){for(var t,r,i,n={},o=e.substr(ux(e).call(e," ")+1).split(";"),a=0;a<o.length;a++)i=lx(t=o[a]).call(t).split("="),n[lx(r=i[0]).call(r)]=i[1];return n},p5.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&cG(e.parameters).length){var i=[];cG(e.parameters).forEach(function(t){void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},p5.parseRtcpFb=function(e){var t=e.substr(ux(e).call(e," ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},p5.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},p5.parseSsrcMedia=function(e){var t=ux(e).call(e," "),r={ssrc:di(e.substr(7,t-7),10)},i=ux(e).call(e,":",t);return i>-1?(r.attribute=e.substr(t+1,i-t-1),r.value=e.substr(i+1)):r.attribute=e.substr(t+1),r},p5.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:sU(t).call(t,function(e){return di(e,10)})}},p5.getMid=function(e){var t=p5.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},p5.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},p5.getDtlsParameters=function(e,t){var r=p5.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:sU(r).call(r,p5.parseFingerprint)}},p5.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},p5.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:di(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:uk(t).call(t,3)}},p5.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===nF(e.keyParams)?p5.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},p5.parseCryptoKeyParams=function(e){if(0!==ux(e).call(e,"inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},p5.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},p5.getCryptoParameters=function(e,t){var r=p5.matchPrefix(e+t,"a=crypto:");return sU(r).call(r,p5.parseCryptoLine)},p5.getIceParameters=function(e,t){var r=p5.matchPrefix(e+t,"a=ice-ufrag:")[0],i=p5.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},p5.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},p5.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=p5.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var n=r[i],o=p5.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(o){var a,s=p5.parseRtpMap(o),c=p5.matchPrefix(e,"a=fmtp:"+n+" ");switch(s.parameters=c.length?p5.parseFmtp(c[0]):{},s.rtcpFeedback=sU(a=p5.matchPrefix(e,"a=rtcp-fb:"+n+" ")).call(a,p5.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return p5.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(p5.parseExtmap(e))}),t},p5.writeRtpDescription=function(e,t){var r,i="";i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=sU(r=t.codecs).call(r,function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){i+=p5.writeRtpMap(e),i+=p5.writeFmtp(e),i+=p5.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),n>0&&(i+="a=maxptime:"+n+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(function(e){i+=p5.writeExtmap(e)}),i},p5.parseRtpEncodingParameters=function(e){var t,r,i,n,o,a,s=[],c=p5.parseRtpParameters(e),d=-1!==ux(t=c.fecMechanisms).call(t,"RED"),u=-1!==ux(r=c.fecMechanisms).call(r,"ULPFEC"),l=s8(i=sU(n=p5.matchPrefix(e,"a=ssrc:")).call(n,function(e){return p5.parseSsrcMedia(e)})).call(i,function(e){return"cname"===e.attribute}),h=l.length>0&&l[0].ssrc,p=sU(o=p5.matchPrefix(e,"a=ssrc-group:FID")).call(o,function(e){var t=e.substr(17).split(" ");return sU(t).call(t,function(e){return di(e,10)})});p.length>0&&p[0].length>1&&p[0][0]===h&&(a=p[0][1]),c.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:h,codecPayloadType:di(e.parameters.apt,10)};h&&a&&(t.rtx={ssrc:a}),s.push(t),d&&((t=JSON.parse(sD(t))).fec={ssrc:h,mechanism:u?"red+ulpfec":"red"},s.push(t))}}),0===s.length&&h&&s.push({ssrc:h});var f,_,A=p5.matchPrefix(e,"b=");return A.length&&(A=0===ux(f=A[0]).call(f,"b=TIAS:")?di(A[0].substr(7),10):0===ux(_=A[0]).call(_,"b=AS:")?1e3*di(A[0].substr(5),10)*.95-16e3:void 0,s.forEach(function(e){e.maxBitrate=A})),s},p5.parseRtcpParameters=function(e){var t,r,i={},n=s8(t=sU(r=p5.matchPrefix(e,"a=ssrc:")).call(r,function(e){return p5.parseSsrcMedia(e)})).call(t,function(e){return"cname"===e.attribute})[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);var o=p5.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=0===o.length;var a=p5.matchPrefix(e,"a=rtcp-mux");return i.mux=a.length>0,i},p5.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},p5.parseMsid=function(e){var t,r,i,n=p5.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(i=n[0].substr(7).split(" "))[0],track:i[1]};var o=s8(t=sU(r=p5.matchPrefix(e,"a=ssrc:")).call(r,function(e){return p5.parseSsrcMedia(e)})).call(t,function(e){return"msid"===e.attribute});return o.length>0?{stream:(i=o[0].value.split(" "))[0],track:i[1]}:void 0},p5.parseSctpDescription=function(e){var t,r=p5.parseMLine(e),i=p5.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=di(i[0].substr(19),10)),isNaN(t)&&(t=65536);var n=p5.matchPrefix(e,"a=sctp-port:");if(n.length>0)return{port:di(n[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};var o=p5.matchPrefix(e,"a=sctpmap:");if(o.length>0){var a=o[0].substr(10).split(" ");return{port:di(a[0],10),protocol:a[1],maxMessageSize:t}}},p5.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},p5.generateSessionId=function(){return Math.random().toString().substr(2,21)},p5.writeSessionBoilerplate=function(e,t,r){return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||p5.generateSessionId())+" "+(void 0!==t?t:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},p5.getDirection=function(e,t){for(var r=p5.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?p5.getDirection(t):"sendrecv"},p5.getKind=function(e){return p5.splitLines(e)[0].split(" ")[0].substr(2)},p5.isRejected=function(e){return"0"===e.split(" ",2)[1]},p5.parseMLine=function(e){var t=p5.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:di(t[1],10),protocol:t[2],fmt:uk(t).call(t,3).join(" ")}},p5.parseOLine=function(e){var t=p5.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:di(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},p5.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=p5.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},p8.exports=p5;var lB=lU.exports,lV=d(lB),lF=(p9={__proto__:null,default:lV},[lB].forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(t){if("default"!==t&&!(t in p9)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(p9,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}})}),Object.freeze(p9));function lj(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){var r;if("object"===nF(e)&&e.candidate&&0===ux(r=e.candidate).call(r,"a=")&&((e=JSON.parse(sD(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var i=uo(new t(e),lV.parseCandidate(e.candidate));return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,u_(e,"icecandidate",function(t){return t.candidate&&d7(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}}function lG(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||u_(e,"icecandidate",function(e){if(e.candidate){var t=lV.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[t.priority>>24])}return e})}function lW(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||d7(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e;if(this._sctp=null,"chrome"===t.browser&&t.version>=76&&"plan-b"===this.getConfiguration().sdpSemantics&&d7(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),function(e){if(!e||!e.sdp)return!1;var t=lV.splitSections(e.sdp);return t.shift(),t.some(function(e){var t,r=lV.parseMLine(e);return r&&"application"===r.kind&&-1!==ux(t=r.protocol).call(t,"SCTP")})}(arguments[0])){var i,n,o,a,s,c=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return -1;var r=di(t[1],10);return r!=r?-1:r}(arguments[0]),d=(e=65536,"firefox"===t.browser&&(e=t.version<57?-1===c?16384:0x7ffffff5:t.version<60?57===t.version?65535:65536:0x7ffffff5),e),u=(i=arguments[0],n=c,o=65536,"firefox"===t.browser&&57===t.version&&(o=65535),(a=lV.matchPrefix(i.sdp,"a=max-message-size:")).length>0?o=di(a[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(o=0x7ffffff5),o);s=0===d&&0===u?Number.POSITIVE_INFINITY:0===d||0===u?Math.max(d,u):Math.min(d,u);var l={};d7(l,"maxMessageSize",{get:function(){return s}}),this._sctp=l}return r.apply(this,arguments)}}}function lH(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e),e},u_(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){return r.apply(e,arguments)}}}function lY(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;d7(t,"connectionState",{get:function(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),d7(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}}function lK(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){var i;if(t&&t.sdp&&-1!==ux(i=t.sdp).call(i,"\na=extmap-allow-mixed")){var n,o=s8(n=t.sdp.split("\n")).call(n,function(e){return"a=extmap-allow-mixed"!==lx(e).call(e)}).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:o}):t.sdp=o}return r.apply(this,arguments)}}}function lQ(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?sP.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),sP.resolve())})}}function lz(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==nF(t)||t.type&&t.sdp)return r.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?r.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then(function(t){return r.apply(e,[t])})})}}var lX=Object.freeze({__proto__:null,removeExtmapAllowMixed:lK,shimAddIceCandidateNullOrEmpty:lQ,shimConnectionState:lY,shimMaxMessageSize:lW,shimParameterlessSetLocalDescription:lz,shimRTCIceCandidate:lj,shimRTCIceCandidateRelayProtocol:lG,shimSendThrowTypeError:lH});if(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=uf(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=uf(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=uf(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:lX,extractVersion:uf,disableLog:uA,disableWarnings:um,sdp:lF};switch(r.browser){case"chrome":if(!u9||!u8||!t.shimChrome)return uv("Chrome shim is not included in this adapter release.");if(null===r.version)return uv("Chrome shim can not determine version, not shimming.");uv("adapter.js shimming chrome."),i.browserShim=u9,lQ(e,r),lz(e),uZ(e,r),u$(e),u8(e,r),u0(e),u3(e,r),u2(e),u1(e),u4(e),u5(e,r),lj(e),lG(e),lY(e),lW(e,r),lH(e),lK(e,r);break;case"firefox":if(!lg||!ll||!t.shimFirefox)return uv("Firefox shim is not included in this adapter release.");uv("adapter.js shimming firefox."),i.browserShim=lg,lQ(e,r),lz(e),ld(e,r),ll(e,r),lu(e),lf(e),lh(e),lp(e),l_(e),lA(e),lm(e),lv(e),lE(e),lj(e),lY(e),lW(e,r),lH(e);break;case"safari":if(!lO||!t.shimSafari)return uv("Safari shim is not included in this adapter release.");uv("adapter.js shimming safari."),i.browserShim=lO,lQ(e,r),lz(e),lI(e),lk(e),lT(e),lS(e),lb(e),lC(e),ly(e),lw(e),lj(e),lG(e),lW(e,r),lH(e),lK(e,r);break;default:uv("Unsupported browser!")};}({window:"undefined"==typeof window?void 0:window}),"undefined"!=typeof MediaStreamTrack){var lJ=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){var e=lJ.call(this);return e.width&&(e.width=Math.floor(e.width)),e.height&&(e.height=Math.floor(e.height)),e.frameRate&&(e.frameRate=Math.floor(e.frameRate)),e}}var lq=q.Object.getOwnPropertySymbols,lZ=d(lq);ti({target:"Object",stat:!0,sham:!P},{getOwnPropertyDescriptors:function(e){for(var t,r,i=z(e),n=N.f,o=oo(i),a={},s=0;o.length>s;)void 0!==(r=n(i,t=o[s++]))&&tE(a,t,r);return a}});var l$=q.Object.getOwnPropertyDescriptors,l0=d(l$),l2={exports:{}},l1=tJ.f;ti({target:"Object",stat:!0,forced:Object.defineProperties!==l1,sham:!P},{defineProperties:l1});var l4=q.Object,l6=l2.exports=function(e,t){return l4.defineProperties(e,t)};l4.defineProperties.sham&&(l6.sham=!0);var l3=l2.exports,l8=d(l3);function l5(e,t){var r=cj(e);if(lZ){var i=lZ(e);t&&(i=s3(i).call(i,function(t){return uJ(e,t).enumerable})),ot(r).apply(r,i)}return r}function l9(e){for(var t=1;t<arguments.length;t++){var r,i,n=null!=arguments[t]?arguments[t]:{};t%2?n3(r=l5(Object(n),!0)).call(r,function(t){nQ(e,t,n[t])}):l0?l8(e,l0(n)):n3(i=l5(Object(n))).call(i,function(t){tc(e,t,uJ(n,t))})}return e}function l7(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},o=cj(e);for(i=0;i<o.length;i++)r=o[i],uM(t).call(t,r)>=0||(n[r]=e[r]);return n}(e,t);if(lZ){var o=lZ(e);for(i=0;i<o.length;i++)r=o[i],uM(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function he(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ht=function(e){return void 0!==e&&(eI(e,"value")||eI(e,"writable"))};ti({target:"Reflect",stat:!0},{get:function e(t,r){var i,n,o=arguments.length<3?t:arguments[2];return e4(t)===o?t[r]:(i=N.f(t,r))?ht(i)?i.value:void 0===i.get?void 0:L(i.get,o):J(n=iK(t))?e(n,r,o):void 0}});var hr=q.Reflect.get,hi=d(hr),hn=Function,ho=b([].concat),ha=b([].join),hs={},hc=function(e,t,r){if(!eI(hs,t)){for(var i=[],n=0;n<t;n++)i[n]="a["+n+"]";hs[t]=hn("C,a","return new C("+ha(i,",")+")")}return hs[t](e,r)},hd=f?hn.bind:function(e){var t=e_(this),r=t.prototype,i=i_(arguments,1),n=function(){var r=ho(i,i_(arguments));return this instanceof n?hc(t,r.length,r):t.apply(e,r)};return J(r)&&(n.prototype=r),n};ti({target:"Function",proto:!0,forced:Function.bind!==hd},{bind:hd});var hu=n2("Function").bind,hl=Function.prototype,hh=d(function(e){var t=e.bind;return e===hl||ee(hl,e)&&t===hl.bind?hu:t});function hp(e){return(hp=oi?hh(nq).call(nq):function(e){return e.__proto__||nq(e)})(e)}function hf(){return(hf="undefined"!=typeof Reflect&&hi?hh(hi).call(hi):function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hp(e)););return e}(e,t);if(i){var n=uJ(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}}).apply(this,arguments)}function h_(e,t){return(h_=oi?hh(oi).call(oi):function(e,t){return e.__proto__=t,e})(e,t)}function hA(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=nX(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),tc(e,"prototype",{writable:!1}),t&&h_(e,t)}var hm=$("Reflect","construct"),hv=Object.prototype,hE=[].push,hg=p(function(){function e(){}return!(hm(function(){},[],e)instanceof e)}),hS=!p(function(){hm(function(){})}),hb=hg||hS;ti({target:"Reflect",stat:!0,forced:hb,sham:hb},{construct:function(e,t){oW(e),e4(t);var r=arguments.length<3?e:oW(arguments[2]);if(hS&&!hg)return hm(e,t,r);if(e===r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var i=[null];return v(hE,i,t),new(v(hd,e,i))}var n=r.prototype,o=ru(J(n)?n:hv),a=v(e,o,t);return J(a)?a:o}});var hT=q.Reflect.construct,hy=d(hT);function hR(){if("undefined"==typeof Reflect||!hy||hy.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(hy(Boolean,[],function(){})),!0}catch(e){return!1}}function hI(e){var t=hR();return function(){var r,i=hp(e);return r=t?hy(i,arguments,hp(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===nF(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return he(e)}(this,r)}}var hC=Math.floor,hk=function(e,t){var r=e.length,i=hC(r/2);return r<8?hw(e,t):hO(e,hk(rA(e,0,i),t),hk(rA(e,i),t),t)},hw=function(e,t){for(var r,i,n=e.length,o=1;o<n;){for(i=o,r=e[o];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==o++&&(e[i]=r)}return e},hO=function(e,t,r,i){for(var n=t.length,o=r.length,a=0,s=0;a<n||s<o;)e[a+s]=a<n&&s<o?0>=i(t[a],r[s])?t[a++]:r[s++]:a<n?t[a++]:r[s++];return e},hN=et.match(/firefox\/(\d+)/i),hP=!!hN&&+hN[1],hD=/MSIE|Trident/.test(et),hL=et.match(/AppleWebKit\/(\d+)\./),hM=!!hL&&+hL[1],hx=[],hU=b(hx.sort),hB=b(hx.push),hV=p(function(){hx.sort(void 0)}),hF=p(function(){hx.sort(null)}),hj=nZ("sort"),hG=!p(function(){if(ea)return ea<70;if(!(hP&&hP>3)){if(hD)return!0;if(hM)return hM<603;var e,t,r,i,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)hx.push({k:t+i,v:r})}for(hx.sort(function(e,t){return t.v-e.v}),i=0;i<hx.length;i++)t=hx[i].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n}});ti({target:"Array",proto:!0,forced:hV||!hF||!hj||!hG},{sort:function(e){void 0!==e&&e_(e);var t,r=ey(this);if(hG)return void 0===e?hU(r):hU(r,e);var i,n,o=[],a=tA(r);for(n=0;n<a;n++)n in r&&hB(o,r[n]);for(hk(o,(t=e,function(e,r){return void 0===r?-1:void 0===e?1:void 0!==t?+t(e,r)||0:tX(e)>tX(r)?1:-1})),i=tA(o),n=0;n<i;)r[n]=o[n++];for(;n<a;)uB(r,n++);return r}});var hW=n2("Array").sort,hH=Array.prototype,hY=d(function(e){var t=e.sort;return e===hH||ee(hH,e)&&t===hH.sort?hW:t}),hK=rH.findIndex,hQ="findIndex",hz=!0;hQ in[]&&[,][hQ](function(){hz=!1}),ti({target:"Array",proto:!0,forced:hz},{findIndex:function(e){return hK(this,e,arguments.length>1?arguments[1]:void 0)}});var hX=n2("Array").findIndex,hJ=Array.prototype,hq=d(function(e){var t=e.findIndex;return e===hJ||ee(hJ,e)&&t===hJ.findIndex?hX:t});N.f;var hZ=I("".startsWith),h$=I("".slice),h0=Math.min;ti({target:"String",proto:!0,forced:!cn("startsWith")},{startsWith:function(e){var t=tX(Q(this));cr(e);var r=t_(h0(arguments.length>1?arguments[1]:void 0,t.length)),i=tX(e);return hZ?hZ(t,i,r):h$(t,r,r+i.length)===i}});var h2=n2("String").startsWith,h1=String.prototype,h4=d(function(e){var t=e.startsWith;return"string"==typeof e||e===h1||ee(h1,e)&&t===h1.startsWith?h2:t}),h6=((p7=h6||{}).INVALID_ENGINE="INVALID_ENGINE",p7.INVALID_PARAMS="INVALID_PARAMS",p7.INVOKED_BEFORE_JOIN_ROOM="INVOKED_BEFORE_JOIN_ROOM",p7.INVALID_TOKEN="INVALID_TOKEN",p7.JOIN_ROOM_FAILED="JOIN_ROOM_FAILED",p7.UPDATE_TOKEN_WITH_INVALID_TOKEN="UPDATE_TOKEN_WITH_INVALID_TOKEN",p7.UPDATE_TOKEN_BEFORE_JOIN="UPDATE_TOKEN_BEFORE_JOIN",p7.REPEAT_JOIN="REPEAT_JOIN",p7.REPEAT_PUBLISH="REPEAT_PUBLISH",p7.REPEAT_PUSH="REPEAT_PUSH",p7.REPEAT_PLAY="REPEAT_PLAY",p7.PUBLISH_BEFORE_JOIN="PUBLISH_BEFORE_JOIN",p7.UNPUBLISH_BEFORE_JOIN="UNPUBLISH_BEFORE_JOIN",p7.SUBSCRIBE_BEFORE_JOIN="SUBSCRIBE_BEFORE_JOIN",p7.UNSUBSCRIBE_BEFORE_JOIN="UNSUBSCRIBE_BEFORE_JOIN",p7.NO_PUBLISH_PERMISSION="NO_PUBLISH_PERMISSION",p7.STREAM_NOT_EXIST="STREAM_NOT_EXIST",p7.EMPTY_STREAM="EMPTY_STREAM",p7.NOT_CONNECTED_YET="NOT_CONNECTED_YET",p7.IM_BEFORE_JOIN="IM_BEFORE_JOIN",p7.USER_NOT_EXIST="USER_NOT_EXIST",p7.ALREADY_IN_ROOM="ALREADY_IN_ROOM",p7.KICKED_OUT="KICKED_OUT",p7.ROOM_DISMISS="ROOM_DISMISS",p7.TOKEN_EXPIRED="TOKEN_EXPIRED",p7.TOKEN_NO_PUBLISH_PERMISSION="TOKEN_NO_PUBLISH_PERMISSION",p7.TOKEN_NO_SUBSCRIBE_PERMISSION="TOKEN_NO_SUBSCRIBE_PERMISSION",p7.DUPLICATE_LOGIN="DUPLICATE_LOGIN",p7.INVOKED_BEFORE_CAPTURE="INVOKED_BEFORE_CAPTURE",p7.REPEAT_CAPTURE="REPEAT_CAPTURE",p7.GET_VIDEO_TRACK_FAILED="GET_VIDEO_TRACK_FAILED",p7.GET_AUDIO_TRACK_FAILED="GET_AUDIO_TRACK_FAILED",p7.GET_SCREEN_TRACK_FAILED="GET_SCREEN_TRACK_FAILED",p7.STREAM_TYPE_NOT_MATCH="STREAM_TYPE_NOT_MATCH",p7.CANT_FIND_DOM="CANT_FIND_DOM",p7.INVALID_DEVICE_ID="INVALID_DEVICE_ID",p7.NO_PERMISSION="NO_PERMISSION",p7.NOT_SUPPORTED="NOT_SUPPORTED",p7.INTERRUPT="INTERRUPT",p7.ICE_SERVER_WRONG="ICE_SERVER_WRONG",p7.ESTABLISH_DATACHANNEL_FAILED="ESTABLISH_DATACHANNEL_FAILED",p7.LOAD_RESOURCES_FAILED="LOAD_RESOURCES_FAILED",p7.SIGNALING_CHANNEL_NOT_OPEN="SIGNALING_CHANNEL_NOT_OPEN",p7.TIME_OUT="TIME_OUT",p7.REFUSE_OPERATION_IN_DISCONNECT="REFUSE_OPERATION_IN_DISCONNECT",p7.ADD_TRANSCEIVER_FAILED="ADD_TRANSCEIVER_FAILED",p7.UPDATE_TRACK_FAILED="UPDATE_TRACK_FAILED",p7.PUBLISH_FAILED="PUBLISH_FAILED",p7.UNPUBLISH_FAILED="UNPUBLISH_FAILED",p7.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",p7.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",p7.OPERATION_CANCEL="OPERATION_CANCEL",p7.START_CLOUD_PROXY_AFTER_JOIN="START_CLOUD_PROXY_AFTER_JOIN",p7.STOP_CLOUD_PROXY_BEFORE_LEAVE="STOP_CLOUD_PROXY_BEFORE_LEAVE",p7.UNEXPECTED_ERROR="UNEXPECTED_ERROR",p7.REPEAT_DEVICE_TEST="REPEAT_DEVICE_TEST",p7.AUDIO_DEVICE_TEST_FAILED="AUDIO_DEVICE_RECORD_FAILED",p7.ALREADY_LOGIN="ALREADY_LOGIN",p7.LOGIN_FAILED="LOGIN_FAILED",p7.NOT_LOGIN="NOT_LOGIN",p7.RTM_DUPLICATE_LOGIN="RTM_DUPLICATE_LOGIN",p7.RTM_TOKEN_ERROR="RTM_TOKEN_ERROR",p7.USER_MESSAGE_TIMEOUT="USER_MESSAGE_TIMEOUT",p7.USER_MESSAGE_BROKEN="USER_MESSAGE_BROKEN",p7.USER_MESSAGE_NO_RECEIVER="USER_MESSAGE_NO_RECEIVER",p7.USER_MESSAGE_NO_RELAYPATH="USER_MESSAGE_NO_RELAYPATH",p7.USER_MESSAGE_EXCEED_QPS="USER_MESSAGE_EXCEED_QPS",p7.USER_MESSAGE_SEND_TO_SERVER_ERROR="USER_MESSAGE_SEND_TO_SERVER_ERROR",p7.USER_MESSAGE_SERVER_RESPONSE_ERROR="USER_MESSAGE_SERVER_RESPONSE_ERROR",p7.USER_MESSAGE_NOT_JOIN="USER_MESSAGE_NOT_JOIN",p7.USER_MESSAGE_INIT="USER_MESSAGE_INIT",p7.USER_MESSAGE_NO_CONNECTION="USER_MESSAGE_NO_CONNECTION",p7.USER_MESSAGE_NOT_LOGIN="USER_MESSAGE_NOT_LOGIN",p7.USER_MESSAGE_SERVER_PARAMS_NOTSET="USER_MESSAGE_SERVER_PARAMS_NOTSET",p7.USER_MESSAGE_UNKNOWN="USER_MESSAGE_UNKNOWN",p7.START_PUBLIC_STREAM_BEFORE_JOIN="START_PUBLIC_STREAM_BEFORE_JOIN",p7.RECONNECT_FAILED="RECONNECT_FAILED",p7.SUBTITLE_ALREADY_ON="SUBTITLE_ALREADY_ON",p7.SUBTITLE_NOT_TURNED_ON="SUBTITLE_NOT_TURNED_ON",p7.SUBTITLE_ERR_POSTPROCESS="SUBTITLE_ERR_POSTPROCESS",p7.SUBTITLE_ERR_CONNECTION_ERROR="SUBTITLE_ERR_CONNECTION_ERROR",p7.SUBTITLE_ERR_PROCESS_ERROR="SUBTITLE_ERR_PROCESS_ERROR",p7.SUBTITLE_ERR_UNKNOWN="SUBTITLE_ERR_UNKNOWN",p7.UNEXPECTED_INVOKE_FORWARD_STREAM="UNEXPECTED_INVOKE_FORWARD_STREAM",p7.ROOM_FORBIDDEN="ROOM_FORBIDDEN",p7.USER_FORBIDDEN="USER_FORBIDDEN",p7.ERR_ELECTRON_IS_NULL="ERR_ELECTRON_IS_NULL",p7.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",p7.SET_SIMULCAST_FAILED="SET_SIMULCAST_FAILED",p7.MIXING_OLD_AND_NEW_APIS="MIXING_OLD_AND_NEW_APIS",p7.WTN_PUSH_FAILED="WTN_PUSH_FAILED",p7.WTN_PLAY_FAILED="WTN_PLAY_FAILED",p7),h3=((fe=h3||{})[fe.AUDIO_MIXING_ERROR_OK=0]="AUDIO_MIXING_ERROR_OK",fe[fe.AUDIO_MIXING_ERROR_PRELOAD_FAILED=1]="AUDIO_MIXING_ERROR_PRELOAD_FAILED",fe[fe.AUDIO_MIXING_ERROR_START_FAILED=2]="AUDIO_MIXING_ERROR_START_FAILED",fe[fe.AUDIO_MIXING_ERROR_ID_NOT_FOUND=3]="AUDIO_MIXING_ERROR_ID_NOT_FOUND",fe[fe.AUDIO_MIXING_ERROR_SET_POSITION_FAILED=4]="AUDIO_MIXING_ERROR_SET_POSITION_FAILED",fe[fe.AUDIO_MIXING_ERROR_INVALID_VOLUME=5]="AUDIO_MIXING_ERROR_INVALID_VOLUME",fe[fe.AUDIO_MIXING_ERROR_LOAD_CONFLICT=6]="AUDIO_MIXING_ERROR_LOAD_CONFLICT",fe[fe.AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH=7]="AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH",fe[fe.AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH=8]="AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH",fe[fe.AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK=9]="AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK",fe),h8=((ft=h8||{})[ft.VIDEO_SOURCE_TYPE_EXTERNAL=0]="VIDEO_SOURCE_TYPE_EXTERNAL",ft[ft.VIDEO_SOURCE_TYPE_INTERNAL=1]="VIDEO_SOURCE_TYPE_INTERNAL",ft),h5=((fr=h5||{})[fr.AUDIO_SOURCE_TYPE_EXTERNAL=0]="AUDIO_SOURCE_TYPE_EXTERNAL",fr[fr.AUDIO_SOURCE_TYPE_INTERNAL=1]="AUDIO_SOURCE_TYPE_INTERNAL",fr),h9=((fi=h9||{})[fi.QUIT=0]="QUIT",fi[fi.DROPPED=1]="DROPPED",fi[fi.SWITCH_TO_INVISIBLE=2]="SWITCH_TO_INVISIBLE",fi[fi.KICKED_BY_ADMIN=3]="KICKED_BY_ADMIN",fi),h7=((fn=h7||{})[fn.CHANNEL_PROFILE_COMMUNICATION=0]="CHANNEL_PROFILE_COMMUNICATION",fn[fn.CHANNEL_PROFILE_LIVE_BROADCASTING=1]="CHANNEL_PROFILE_LIVE_BROADCASTING",fn),pe=((fo=pe||{})[fo.AUTO_SUBSCRIBE_MODE=0]="AUTO_SUBSCRIBE_MODE",fo[fo.MANUAL_SUBSCRIBE_MODE=1]="MANUAL_SUBSCRIBE_MODE",fo),pt=((fa=pt||{})[fa.SUBSCRIBE_SUCC=0]="SUBSCRIBE_SUCC",fa[fa.SUBSCRIBE_FAIL=1]="SUBSCRIBE_FAIL",fa),pr=((fs=pr||{})[fs.PUBLISH_SUCC=0]="PUBLISH_SUCC",fs[fs.PUBLISH_FAIL=1]="PUBLISH_FAIL",fs),pi=((fc=pi||{})[fc.MIRROR_MODE_OFF=0]="MIRROR_MODE_OFF",fc[fc.MIRROR_MODE_ON=1]="MIRROR_MODE_ON",fc),pn=((fd=pn||{})[fd.RENDER_MODE_HIDDEN=0]="RENDER_MODE_HIDDEN",fd[fd.RENDER_MODE_FIT=1]="RENDER_MODE_FIT",fd[fd.RENDER_MODE_FILL=2]="RENDER_MODE_FILL",fd),po=((fu=po||{})[fu.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",fu[fu.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",fu),pa=((fl=pa||{})[fl.AUDIO=1]="AUDIO",fl[fl.VIDEO=2]="VIDEO",fl[fl.AUDIO_AND_VIDEO=3]="AUDIO_AND_VIDEO",fl),ps=((fh=ps||{})[fh.STREAM_REMOVE_REASON_UNPUBLISH=0]="STREAM_REMOVE_REASON_UNPUBLISH",fh[fh.STREAM_REMOVE_REASON_PUBLISH_FAILED=1]="STREAM_REMOVE_REASON_PUBLISH_FAILED",fh[fh.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED=2]="STREAM_REMOVE_REASON_KEEP_LIVE_FAILED",fh[fh.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED=3]="STREAM_REMOVE_REASON_CLIENT_DISCONNECTED",fh[fh.STREAM_REMOVE_REASON_REPUBLISH=4]="STREAM_REMOVE_REASON_REPUBLISH",fh[fh.STREAM_REMOVE_REASON_OTHER=5]="STREAM_REMOVE_REASON_OTHER",fh[fh.STREAM_REMOVE_REASON_TOKEN_PRIVILEGE_EXPIRED=6]="STREAM_REMOVE_REASON_TOKEN_PRIVILEGE_EXPIRED",fh),pc=((fp=pc||{})[fp.CONNECTION_START=0]="CONNECTION_START",fp[fp.CONNECTION_STATE_DISCONNECTED=1]="CONNECTION_STATE_DISCONNECTED",fp[fp.CONNECTION_STATE_CONNECTING=2]="CONNECTION_STATE_CONNECTING",fp[fp.CONNECTION_STATE_CONNECTED=3]="CONNECTION_STATE_CONNECTED",fp[fp.CONNECTION_STATE_RECONNECTING=4]="CONNECTION_STATE_RECONNECTING",fp[fp.CONNECTION_STATE_RECONNECTED=5]="CONNECTION_STATE_RECONNECTED",fp[fp.CONNECTION_STATE_LOST=6]="CONNECTION_STATE_LOST",fp),pd=((ff=pd||{}).ICE_FAILED="iceFailed",ff.NODE_CHANGE="nodeChange",ff.JOIN_TIMEOUT="joinTimeout",ff.NOTIFY_RECONNECT="notifyReconnect",ff),pu=((f_=pu||{}).AUTO="auto",f_.H264="h264",f_.VP8="vp8",f_.ByteVC1="ByteVC1",f_),pl=((fA=pl||{})[fA.MIRROR_TYPE_NONE=0]="MIRROR_TYPE_NONE",fA[fA.MIRROR_TYPE_RENDER=1]="MIRROR_TYPE_RENDER",fA),ph=((fm=ph||{})[fm.NORMAL=0]="NORMAL",fm[fm.DISCONNECT=1]="DISCONNECT",fm[fm.RESET=2]="RESET",fm),pp=((fv=pp||{})[fv.MICROPHONE=0]="MICROPHONE",fv[fv.AUDIOMIXING=1]="AUDIOMIXING",fv),pf=((fE=pf||{})[fE.domestic=0]="domestic",fE[fE.overseas=1]="overseas",fE),p_=((fg=p_||{})[fg.OFFLINE=0]="OFFLINE",fg[fg.ONLINE=1]="ONLINE",fg[fg.UNREACHABLE=2]="UNREACHABLE",fg),pA=((fS=pA||{})[fS.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",fS[fS.AUDIO_ONLY=1]="AUDIO_ONLY",fS[fS.VIDEO_ONLY=2]="VIDEO_ONLY",fS),pm=((fb=pm||{})[fb.PREV_FRAME=0]="PREV_FRAME",fb[fb.OTHER_FRAME=1]="OTHER_FRAME",fb),pv=((fT=pv||{})[fT.DISABLE=0]="DISABLE",fT[fT.VIDEO_STREAM_LOW=1]="VIDEO_STREAM_LOW",fT[fT.AUDIO_ONLY=2]="AUDIO_ONLY",fT),pE=((fy=pE||{})[fy.LOW=0]="LOW",fy[fy.MEDIUM=100]="MEDIUM",fy[fy.HIGH=200]="HIGH",fy),pg=((fR=pg||{})[fR.UNKNOWN=0]="UNKNOWN",fR[fR.EXCELLENT=1]="EXCELLENT",fR[fR.GOOD=2]="GOOD",fR[fR.POOR=3]="POOR",fR[fR.BAD=4]="BAD",fR[fR.VBAD=5]="VBAD",fR[fR.DOWN=6]="DOWN",fR),pS=((fI=pS||{})[fI.Unknown=-1]="Unknown",fI[fI.SubscribeFallbackByBandwidth=0]="SubscribeFallbackByBandwidth",fI[fI.SubscribeRecoverByBandwidth=2]="SubscribeRecoverByBandwidth",fI),pb=((fC=pb||{})[fC.communication=0]="communication",fC[fC.chat=5]="chat",fC[fC.chatRoom=6]="chatRoom",fC[fC.coHost=9]="coHost",fC[fC.meeting=16]="meeting",fC[fC.classRoom=18]="classRoom",fC),pT=((fk=pT||{})[fk.default=0]="default",fk[fk.fluent=1]="fluent",fk[fk.standard=2]="standard",fk[fk.hd=3]="hd",fk[fk.standardStereo=4]="standardStereo",fk[fk.hdMono=5]="hdMono",fk),py=((fw=py||{})[fw.AUTO_PLAY=0]="AUTO_PLAY",fw[fw.VIDEO_ONLY=1]="VIDEO_ONLY",fw[fw.PLAY_MANUALLY=2]="PLAY_MANUALLY",fw),pR=((fO=pR||{}).LC="LC",fO.HEv1="HEv1",fO.HEv2="HEv2",fO),pI=((fN=pI||{}).H264="H264",fN.H265="H265",fN),pC=((fP=pC||{})[fP.ASR_ONLY=0]="ASR_ONLY",fP[fP.ASR_AND_TRANSLATION=1]="ASR_AND_TRANSLATION",fP),pk=((fD=pk||{})[fD.STARTED=0]="STARTED",fD[fD.STOPPED=1]="STOPPED",fD[fD.ERROR=2]="ERROR",fD[fD.UPDATED=3]="UPDATED",fD),pw=((fL=pw||{})[fL.FORWARD_STREAM_STATE_SUCCESS=0]="FORWARD_STREAM_STATE_SUCCESS",fL[fL.FORWARD_STREAM_STATE_FAILURE=1]="FORWARD_STREAM_STATE_FAILURE",fL),pO=((fM=pO||{})[fM.FORWARD_STREAM_ERROR_OK=0]="FORWARD_STREAM_ERROR_OK",fM[fM.FORWARD_STREAM_ERROR_INVALID_TOKEN=1202]="FORWARD_STREAM_ERROR_INVALID_TOKEN",fM[fM.FORWARD_STREAM_ERROR_RESPONSE=1203]="FORWARD_STREAM_ERROR_RESPONSE",fM[fM.FORWARD_STREAM_ERROR_REMOTE_KICKED=1204]="FORWARD_STREAM_ERROR_REMOTE_KICKED",fM[fM.FORWARD_STREAM_ERROR_NOT_SUPPORT=1205]="FORWARD_STREAM_ERROR_NOT_SUPPORT",fM),pN=((fx=pN||{})[fx.DEFAULT=0]="DEFAULT",fx[fx.HIGH=1]="HIGH",fx),pP=((fU=pP||{})[fU.VIDEO_ONLY_ONE=0]="VIDEO_ONLY_ONE",fU[fU.VIDEO_ON_DEMAND=1]="VIDEO_ON_DEMAND",fU[fU.VIDEO_ALWAYS_SIMULCAST=2]="VIDEO_ALWAYS_SIMULCAST",fU),pD=((fB=pD||{}).VIDEO_STREAM_HIGH="high",fB.VIDEO_STREAM_MID="mid",fB.VIDEO_STREAM_LOW="low",fB),pL=((fV=pL||{})[fV.NONE=0]="NONE",fV[fV.AFTER_CAPTURE=1]="AFTER_CAPTURE",fV[fV.AFTER_PROCESS=2]="AFTER_PROCESS",fV);function pM(e,t,r){return(pM=hR()?hh(hy).call(hy):function(e,t,r){var i=[null];ot(i).apply(i,t);var n=new(hh(Function).apply(e,i));return r&&h_(n,r.prototype),n}).apply(null,arguments)}function px(e){var t="function"==typeof d5?new d5:void 0;return(px=function(e){var r,i;if(null===e||(r=e,-1===uM(i=Function.toString.call(r)).call(i,"[native code]")))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return pM(e,arguments,hp(this).constructor)}return n.prototype=nX(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),h_(n,e)})(e)}var pU=d(or),pB=function(e){hA(r,px(Error));var t=hI(r);function r(e,i,n){var o;return nK(this,r),nQ(he(o=t.call(this,i)),"code",void 0),nQ(he(o),"message",void 0),nQ(he(o),"error",void 0),o.code=e,o.message=i,o.error=n,pU(he(o),r.prototype),o}return nY(r,[{key:"toString",value:function(){var e;return sN(e="SDKError: ".concat(this.code," ")).call(e,this.message)}}]),r}(),pV=RangeError,pF=b(function(e){var t=tX(Q(this)),r="",i=tp(e);if(i<0||i===1/0)throw pV("Wrong number of repetitions");for(;i>0;(i>>>=1)&&(t+=t))1&i&&(r+=t);return r}),pj=b("".slice),pG=Math.ceil,pW=function(e){return function(t,r,i){var n,o,a=tX(Q(t)),s=t_(r),c=a.length,d=void 0===i?" ":tX(i);return s<=c||""===d?a:((o=pF(d,pG((n=s-c)/d.length))).length>n&&(o=pj(o,0,n)),e?a+o:o+a)}},pH={start:pW(!1),end:pW(!0)},pY=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(et),pK=pH.end;ti({target:"String",proto:!0,forced:pY},{padEnd:function(e){return pK(this,e,arguments.length>1?arguments[1]:void 0)}});var pQ=n2("String").padEnd,pz=String.prototype,pX=d(function(e){var t=e.padEnd;return"string"==typeof e||e===pz||ee(pz,e)&&t===pz.padEnd?pQ:t});ti({target:"Number",stat:!0,forced:Number.parseInt!==dt},{parseInt:dt});var pJ=q.Number.parseInt,pq=d(pJ),pZ=d(sH),p$=d(sA),p0=Math.log,p2=Math.LOG10E,p1=Math.log10||function(e){return p0(e)*p2};ti({target:"Math",stat:!0},{log10:p1});var p4=q.Math.log10,p6=d(p4);ti({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:0x1fffffffffffff});for(var p3,p8,p5,p9,p7,fe,ft,fr,fi,fn,fo,fa,fs,fc,fd,fu,fl,fh,fp,ff,f_,fA,fm,fv,fE,fg,fS,fb,fT,fy,fR,fI,fC,fk,fw,fO,fN,fP,fD,fL,fM,fx,fU,fB,fV,fF,fj=d(0x1fffffffffffff),fG=n2("Array").values,fW=Array.prototype,fH={DOMTokenList:!0,NodeList:!0},fY=d(function(e){var t=e.values;return e===fW||ee(fW,e)&&t===fW.values||eI(fH,tC(e))?fG:t}),fK=n2("Array").keys,fQ=Array.prototype,fz={DOMTokenList:!0,NodeList:!0},fX=d(function(e){var t=e.keys;return e===fQ||ee(fQ,e)&&t===fQ.keys||eI(fz,tC(e))?fK:t}),fJ=new Uint8Array(16),fq=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,fZ=[],f$=0;f$<256;++f$)fZ.push((f$+256).toString(16).substr(1));var f0=function(){return"undefined"==typeof window},f2=function(){return function(e,t,r){var i,n=(e=e||{}).random||(e.rng||function(){if(!fF&&!(fF="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return fF(fJ)})();n[6]=15&n[6]|64,n[8]=63&n[8]|128;return function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(fZ[e[r+0]]+fZ[e[r+1]]+fZ[e[r+2]]+fZ[e[r+3]]+"-"+fZ[e[r+4]]+fZ[e[r+5]]+"-"+fZ[e[r+6]]+fZ[e[r+7]]+"-"+fZ[e[r+8]]+fZ[e[r+9]]+"-"+fZ[e[r+10]]+fZ[e[r+11]]+fZ[e[r+12]]+fZ[e[r+13]]+fZ[e[r+14]]+fZ[e[r+15]]).toLowerCase();if(!("string"==typeof(t=i)&&fq.test(t)))throw TypeError("Stringified UUID is invalid");return i}(n)}()},f1=function(e){return"number"==typeof e},f4=function(e){var t;return cd(t=Function.prototype.toString.call(e)).call(t,"[native code]")};function f6(e){return null==e?"undefined | null":"string"==typeof e?e:sD({contentHint:e.contentHint,enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState})}function f3(e){return null==e?"undefined | null":"string"==typeof e?e:sD({id:e.id,active:e.active})}function f8(e){return null==e?"undefined | null":"string"==typeof e?e:sD({track:f6(e.track)})}function f5(e){return null==e?"undefined | null":"string"==typeof e?e:sD({track:f6(e.track)})}function f9(e){return null==e?"undefined | null":"string"==typeof e?e:sD({currentDirection:e.currentDirection,direction:e.direction,mid:e.mid,stopped:e.stopped,receiver:f5(e.receiver),sender:f8(e.sender)})}var f7="@byted/ve-rtc",_e="@byted/ve-rtc-cache-size",_t=new(function(){function e(){nK(this,e),nQ(this,"storeKey",void 0),nQ(this,"logLevel",void 0),nQ(this,"LogfileSize",void 0),nQ(this,"db",void 0),nQ(this,"logId",void 0),nQ(this,"cacheLog",void 0),nQ(this,"cachedSize",void 0),nQ(this,"preCacheTime",void 0),nQ(this,"timer",void 0),nQ(this,"_getSize",function(e){return new Blob(e).size/1048576}),this.storeKey="",this.logId=1,this.cacheLog="",this.logLevel="none",this.LogfileSize=100,this._createStore()}return nY(e,[{key:"_createStore",value:function(){var e=this;if(!f0()&&window.indexedDB){var t=indexedDB.open("@byted/ve-rtc");t.onupgradeneeded=function(){t.result.createObjectStore(f7);try{localStorage.removeItem(_e)}catch(e){}},t.onerror=function(e){},t.onsuccess=function(){e.db=t.result,e._getCachedSize()}}}},{key:"_getCachedSize",value:function(){var e=this;try{var t=localStorage.getItem(_e);t?this.cachedSize=Number(t):fY(this).call(this).then(function(t){e.cachedSize=e._getSize(t),e._setCachedSize()})}catch(e){}}},{key:"_setCachedSize",value:function(){try{localStorage.setItem(_e,"".concat(this.cachedSize))}catch(e){}}},{key:"_getStore",value:function(e){if(this.db)return this.db.transaction(f7,e).objectStore(f7)}},{key:"set",value:function(e){var t=this;return new sP(function(r,i){if("none"===t.logLevel)return r();if(e&&t.preCacheTime&&t.preCacheTime-Date.now()<1e3)return t.cacheLog+=sN(n="\n\n".concat(t.logId,": ")).call(n,e),t.logId++,t.timer||(t.timer=setTimeout(function(){t.set("")},1e3-(t.preCacheTime-Date.now()))),r();clearTimeout(t.timer),t.timer=null;var n,o=t._getStore("readwrite");if(!o)return i("get store fail");t.cachedSize&&t.cachedSize>t.LogfileSize&&t.keyEarliest().then(function(e){t.get(e).then(function(r){t.del(e).then(function(){t.cachedSize=t.cachedSize-t._getSize(["".concat(r)]),t._setCachedSize()})})});var a=o.get(t.storeKey);a.onsuccess=function(){try{var n,s,c,d,u,l,h=sN(s="".concat(a.result||"")).call(s,t.cacheLog),p=e?sN(c=sN(d="".concat(h?"\n\n":"")).call(d,t.logId,": ")).call(c,e):"";o.put(sN(u="".concat(h)).call(u,p),t.storeKey),e&&t.logId++,t.cacheLog="",t.cachedSize=(t.cachedSize||0)+t._getSize([sN(l="".concat(t.cacheLog)).call(l,p)]),t._setCachedSize(),t.preCacheTime=Date.now(),r()}catch(r){if(!e)return i(r);t.cacheLog+=sN(n="\n\n".concat(t.logId,": ")).call(n,e),t.logId++,i(r)}},a.onerror=function(r){var n;if(!e)return i(r);t.cacheLog+=sN(n="\n\n".concat(t.logId,": ")).call(n,e),t.logId++,i(r)}})}},{key:"get",value:function(e){var t=this;return new sP(function(r,i){var n=t._getStore("readonly");if(!n)return i();var o=n.get(e);o.onsuccess=function(){r(o.result)},o.onerror=function(e){i(e)}})}},{key:"del",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.storeKey;return new sP(function(r,i){var n=e._getStore("readwrite");if(!n)return i();var o=n.delete(t);o.onsuccess=function(){return r(o.result)},o.onerror=function(e){return i(e)}})}},{key:"keyEarliest",value:function(){return fX(this).call(this).then(function(e){var t,r=Date.now();return e.forEach(function(e){if(e&&e.length){var i=e.split("-")[0];Number(i)<r&&(r=Number(i),t=e)}}),t})}},{key:"keys",value:function(){var e=this;return new sP(function(t,r){var i=e._getStore("readonly");if(!i)return r();if(i.getAllKeys){var n=i.getAllKeys();return n.onsuccess=function(){t(n.result)},void(n.onerror=function(){r()})}var o=[];i.openCursor().onsuccess=function(){this.result&&(o.push(this.result.key),this.result.continue())},i.transaction.oncomplete=function(){return t(o)}})}},{key:"values",value:function(){var e=this;return new sP(function(t,r){var i=e._getStore("readonly");if(!i)return r();if(i.getAll){var n=i.getAll();return n.onsuccess=function(){t(n.result)},void(n.onerror=function(){r()})}var o=[];i.openCursor().onsuccess=function(){this.result&&(o.push(this.result.value),this.result.continue())},i.transaction.oncomplete=function(){return t(o)}})}},{key:"download",value:function(e){e=e||this.storeKey,this.get(e).then(function(t){var r=document.createElement("a");r.download="".concat(e,".txt"),r.href="data:text/paint;utf-8,".concat(t||""),r.click()})}}]),e}()),_r=pH.start;ti({target:"String",proto:!0,forced:pY},{padStart:function(e){return _r(this,e,arguments.length>1?arguments[1]:void 0)}});var _i=n2("String").padStart,_n=String.prototype,_o=d(function(e){var t=e.padStart;return"string"==typeof e||e===_n||ee(_n,e)&&t===_n.padStart?_i:t}),_a=function(){function e(){nK(this,e),nQ(this,"_all",{})}return nY(e,[{key:"on",value:function(e,t){var r=this._all[e];r?r.push(t):this._all[e]=[t]}},{key:"once",value:function(e,t){var r=this;this.on(e,function i(){t.apply(void 0,arguments),r.off(e,i)})}},{key:"off",value:function(e,t){var r=this._all[e];null==r||uH(r).call(r,ux(r).call(r,t)>>>0,1)}},{key:"emit",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var n=this._all[e];null==n||uk(n).call(n).forEach(function(e){return e.apply(void 0,r)})}},{key:"safeEmit",value:function(e){try{for(var t,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return this.emit.apply(this,sN(t=[e]).call(t,i))}catch(e){console.error(e)}}},{key:"destroy",value:function(){this._all={}}}]),e}(),_s=["UPLOAD_CONSOLE_LENGTH_CUT","UPLOAD_REPORT_LIMIT"],_c=new(function(e){hA(r,_a);var t=hI(r);function r(){var e,i;nK(this,r);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return nQ(he(i=t.call.apply(t,sN(e=[this]).call(e,o))),"config",{UPLOAD_CONSOLE_ON:!1,UPLOAD_CONSOLE_LENGTH_CUT:200,UPLOAD_REPORT_LIMIT:45e4,ENABLE_REPORT_IDB_BUFFER:!1}),i}return nY(r,[{key:"setParameter",value:function(e,t){var r;if(r=e,cd(_s).call(_s,r))try{var i,n=Number(t);if(Number.isNaN(n))return;this.config[e]=n}catch(r){return void console.warn(sN(i="Cannot convert core lib parameter ".concat(e,":")).call(i,t," into number"))}else this.config[e]=t;this.emit(e,this.config[e])}},{key:"getParameter",value:function(e){return this.config[e]}},{key:"getKeys",value:function(){return cG(this.config)}}]),r}()),_d=function(e,t,r,i,n,o,a,s){for(var c,d,u=n,l=0,h=!!a&&eZ(a,s);l<i;)l in r&&(c=h?h(r[l],l,t):r[l],o>0&&td(c)?(d=tA(c),u=_d(e,t,c,d,u,o-1)-1):(tv(u+1),e[u]=c),u++),l++;return u};ti({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=ey(this),r=tA(t),i=tG(t,0);return i.length=_d(i,t,t,r,0,void 0===e?1:tp(e)),i}});var _u=n2("Array").flat,_l=Array.prototype,_h=d(function(e){var t=e.flat;return e===_l||ee(_l,e)&&t===_l.flat?_u:t}),_p={};_w=_p,_O="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,_w.assign=function(e){for(var t=uk(Array.prototype).call(arguments,1);t.length;){var r,i,n=t.shift();if(n){if("object"!==nF(n))throw TypeError(n+"must be non-object");for(var o in n){;r=n,i=o,Object.prototype.hasOwnProperty.call(r,i)&&(e[o]=n[o])}}}return e},_w.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)},_N={arraySet:function(e,t,r,i,n){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+i),n);else for(var o=0;o<i;o++)e[n+o]=t[r+o]},flattenChunks:function(e){var t,r,i,n,o,a;for(i=0,t=0,r=e.length;t<r;t++)i+=e[t].length;for(a=new Uint8Array(i),n=0,t=0,r=e.length;t<r;t++)o=e[t],a.set(o,n),n+=o.length;return a}},_P={arraySet:function(e,t,r,i,n){for(var o=0;o<i;o++)e[n+o]=t[r+o]},flattenChunks:function(e){return sN([]).apply([],e)}},_w.setTyped=function(e){e?(_w.Buf8=Uint8Array,_w.Buf16=Uint16Array,_w.Buf32=Int32Array,_w.assign(_w,_N)):(_w.Buf8=Array,_w.Buf16=Array,_w.Buf32=Array,_w.assign(_w,_P))},_w.setTyped(_O);var _f={},__={},_A={};function _m(e){for(var t=e.length;--t>=0;)e[t]=0}var _v=286,_E=573,_g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],_S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],_T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_y=Array(576);_m(_y);var _R=Array(60);_m(_R);var _I=Array(512);_m(_I);var _C=Array(256);_m(_C);var _k=Array(29);_m(_k);var _w,_O,_N,_P,_D,_L,_M,_x=Array(30);function _U(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}function _B(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function _V(e){return e<256?_I[e]:_I[256+(e>>>7)]}function _F(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function _j(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,_F(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function _G(e,t,r){_j(e,r[2*t],r[2*t+1])}function _W(e,t){var r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1}function _H(e,t,r){var i,n,o=Array(16),a=0;for(i=1;i<=15;i++)o[i]=a=a+r[i-1]<<1;for(n=0;n<=t;n++){var s=e[2*n+1];0!==s&&(e[2*n]=_W(o[s]++,s))}}function _Y(e){var t;for(t=0;t<_v;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function _K(e){e.bi_valid>8?_F(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function _Q(e,t,r,i){var n=2*t,o=2*r;return e[n]<e[o]||e[n]===e[o]&&i[t]<=i[r]}function _z(e,t,r){for(var i=e.heap[r],n=r<<1;n<=e.heap_len&&(n<e.heap_len&&_Q(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!_Q(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i}function _X(e,t,r){var i,n,o,a,s=0;if(0!==e.last_lit)do i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],n=e.pending_buf[e.l_buf+s],s++,0===i?_G(e,n,t):(_G(e,(o=_C[n])+256+1,t),0!==(a=_g[o])&&_j(e,n-=_k[o],a),_G(e,o=_V(--i),r),0!==(a=_S[o])&&_j(e,i-=_x[o],a));while(s<e.last_lit);_G(e,256,t)}function _J(e,t){var r,i,n,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=_E,r=0;r<c;r++)0!==o[2*r]?(e.heap[++e.heap_len]=d=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(n=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[n]=0,e.opt_len--,s&&(e.static_len-=a[2*n+1]);for(t.max_code=d,r=e.heap_len>>1;r>=1;r--)_z(e,o,r);n=c;do r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],_z(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,o[2*n]=o[2*r]+o[2*i],e.depth[n]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,o[2*r+1]=o[2*i+1]=n,e.heap[1]=n++,_z(e,o,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,i,n,o,a,s,c=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,l=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,_=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<_E;r++)(o=c[2*c[2*(i=e.heap[r])+1]+1]+1)>f&&(o=f,_++),c[2*i+1]=o,i>d||(e.bl_count[o]++,a=0,i>=p&&(a=h[i-p]),s=c[2*i],e.opt_len+=s*(o+a),l&&(e.static_len+=s*(u[2*i+1]+a)));if(0!==_){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,_-=2}while(_>0);for(o=f;0!==o;o--)for(i=e.bl_count[o];0!==i;)(n=e.heap[--r])>d||(c[2*n+1]!==o&&(e.opt_len+=(o-c[2*n+1])*c[2*n],c[2*n+1]=o),i--)}}(e,t),_H(o,d,e.bl_count)}function _q(e,t,r){var i,n,o=-1,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=t[2*(i+1)+1],++s<c&&n===a||(s<d?e.bl_tree[2*n]+=s:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=n,0===a?(c=138,d=3):n===a?(c=6,d=3):(c=7,d=4))}function _Z(e,t,r){var i,n,o=-1,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),i=0;i<=r;i++)if(n=a,a=t[2*(i+1)+1],!(++s<c&&n===a)){if(s<d)do _G(e,n,e.bl_tree);while(0!=--s);else 0!==n?(n!==o&&(_G(e,n,e.bl_tree),s--),_G(e,16,e.bl_tree),_j(e,s-3,2)):s<=10?(_G(e,17,e.bl_tree),_j(e,s-3,3)):(_G(e,18,e.bl_tree),_j(e,s-11,7));s=0,o=n,0===a?(c=138,d=3):n===a?(c=6,d=3):(c=7,d=4)}}_m(_x);var _$=!1;function _0(e,t,r,i){var n,o,a,s;_j(e,0+(i?1:0),3),n=e,o=t,a=r,s=!0,_K(n),s&&(_F(n,a),_F(n,~a)),_p.arraySet(n.pending_buf,n.window,o,a,n.pending),n.pending+=a}_A._tr_init=function(e){_$||(function(){var e,t,r,i,n,o=Array(16);for(r=0,i=0;i<28;i++)for(_k[i]=r,e=0;e<1<<_g[i];e++)_C[r++]=i;for(_C[r-1]=i,n=0,i=0;i<16;i++)for(_x[i]=n,e=0;e<1<<_S[i];e++)_I[n++]=i;for(n>>=7;i<30;i++)for(_x[i]=n<<7,e=0;e<1<<_S[i]-7;e++)_I[256+n++]=i;for(t=0;t<=15;t++)o[t]=0;for(e=0;e<=143;)_y[2*e+1]=8,e++,o[8]++;for(;e<=255;)_y[2*e+1]=9,e++,o[9]++;for(;e<=279;)_y[2*e+1]=7,e++,o[7]++;for(;e<=287;)_y[2*e+1]=8,e++,o[8]++;for(_H(_y,_v+1,o),e=0;e<30;e++)_R[2*e+1]=5,_R[2*e]=_W(e,5);_D=new _U(_y,_g,257,_v,15),_L=new _U(_R,_S,0,30,15),_M=new _U([],_b,0,19,7)}(),_$=!0),e.l_desc=new _B(e.dyn_ltree,_D),e.d_desc=new _B(e.dyn_dtree,_L),e.bl_desc=new _B(e.bl_tree,_M),e.bi_buf=0,e.bi_valid=0,_Y(e)},_A._tr_stored_block=_0,_A._tr_flush_block=function(e,t,r,i){var n,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=0xf3ffc07f;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),_J(e,e.l_desc),_J(e,e.d_desc),a=function(e){var t;for(_q(e,e.dyn_ltree,e.l_desc.max_code),_q(e,e.dyn_dtree,e.d_desc.max_code),_J(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*_T[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=n&&(n=o)):n=o=r+5,r+4<=n&&-1!==t?_0(e,t,r,i):4===e.strategy||o===n?(_j(e,2+(i?1:0),3),_X(e,_y,_R)):(_j(e,4+(i?1:0),3),function(e,t,r,i){var n;for(_j(e,t-257,5),_j(e,r-1,5),_j(e,i-4,4),n=0;n<i;n++)_j(e,e.bl_tree[2*_T[n]+1],3);_Z(e,e.dyn_ltree,t-1),_Z(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),_X(e,e.dyn_ltree,e.dyn_dtree)),_Y(e),i&&_K(e)},_A._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(_C[r]+256+1)]++,e.dyn_dtree[2*_V(t)]++),e.last_lit===e.lit_bufsize-1},_A._tr_align=function(e){var t;_j(e,2,3),_G(e,256,_y),16===(t=e).bi_valid?(_F(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)};var _2=function(e,t,r,i){for(var n=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do o=o+(n=n+t[i++]|0)|0;while(--a);n%=65521,o%=65521}return n|o<<16|0},_1=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?0xedb88320^e>>>1:e>>>1;t[r]=e}return t}(),_4,_6=function(e,t,r,i){var n=i+r;e^=-1;for(var o=i;o<n;o++)e=e>>>8^_1[255&(e^t[o])];return -1^e},_3={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_8=286,_5=573,_9=262;function _7(e,t){return e.msg=_3[t],t}function Ae(e){return(e<<1)-(e>4?9:0)}function At(e){for(var t=e.length;--t>=0;)e[t]=0}function Ar(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(_p.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function Ai(e,t){_A._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ar(e.strm)}function An(e,t){e.pending_buf[e.pending++]=t}function Ao(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Aa(e,t){var r,i,n=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-_9?e.strstart-(e.w_size-_9):0,d=e.window,u=e.w_mask,l=e.prev,h=e.strstart+258,p=d[o+a-1],f=d[o+a];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do if(d[(r=t)+a]===f&&d[r+a-1]===p&&d[r]===d[o]&&d[++r]===d[o+1]){o+=2,r++;do;while(d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&o<h);if(i=258-(h-o),o=h-258,i>a){if(e.match_start=t,a=i,i>=s)break;p=d[o+a-1],f=d[o+a]}}while((t=l[t&u])>c&&0!=--n);return a<=e.lookahead?a:e.lookahead}function As(e){var t,r,i,n,o,a=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=a+(a-_9)){_p.arraySet(e.window,e.window,a,a,0),e.match_start-=a,e.strstart-=a,e.block_start-=a,t=r=e.hash_size;do i=e.head[--t],e.head[t]=i>=a?i-a:0;while(--r);t=r=a;do i=e.prev[--t],e.prev[t]=i>=a?i-a:0;while(--r);n+=a}if(0===e.strm.avail_in)break;if(r=function(e,t,r,i){var n=e.avail_in;return n>i&&(n=i),0===n?0:(e.avail_in-=n,_p.arraySet(t,e.input,e.next_in,n,r),1===e.state.wrap?e.adler=_2(e.adler,t,n,r):2===e.state.wrap&&(e.adler=_6(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)}(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+3-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<_9&&0!==e.strm.avail_in)}function Ac(e,t){for(var r,i;;){if(e.lookahead<_9){if(As(e),e.lookahead<_9&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-_9&&(e.match_length=Aa(e,r)),e.match_length>=3){if(i=_A._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}else i=_A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Ai(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(Ai(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ai(e,!1),0===e.strm.avail_out)?1:2}function Ad(e,t){for(var r,i,n;;){if(e.lookahead<_9){if(As(e),e.lookahead<_9&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-_9&&(e.match_length=Aa(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,i=_A._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Ai(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=_A._tr_tally(e,0,e.window[e.strstart-1]))&&Ai(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=_A._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(Ai(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ai(e,!1),0===e.strm.avail_out)?1:2}function Au(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}function Al(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new _p.Buf16(2*_5),this.dyn_dtree=new _p.Buf16(122),this.bl_tree=new _p.Buf16(78),At(this.dyn_ltree),At(this.dyn_dtree),At(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new _p.Buf16(16),this.heap=new _p.Buf16(2*_8+1),At(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new _p.Buf16(2*_8+1),At(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ah(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,_A._tr_init(t),0):_7(e,-2)}function Ap(e){var t,r=Ah(e);return 0===r&&((t=e.state).window_size=2*t.w_size,At(t.head),t.max_lazy_match=_4[t.level].max_lazy,t.good_match=_4[t.level].good_length,t.nice_match=_4[t.level].nice_length,t.max_chain_length=_4[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function Af(e,t,r,i,n,o){if(!e)return -2;var a=1;if(-1===t&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),n<1||n>9||8!==r||i<8||i>15||t<0||t>9||o<0||o>4)return _7(e,-2);8===i&&(i=9);var s=new Al;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new _p.Buf8(2*s.w_size),s.head=new _p.Buf16(s.hash_size),s.prev=new _p.Buf16(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new _p.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=r,Ap(e)}_4=[new Au(0,0,0,0,function(e,t){var r=65535;for(65535>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(As(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,Ai(e,!1),0===e.strm.avail_out)||e.strstart-e.block_start>=e.w_size-_9&&(Ai(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Ai(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Ai(e,!1),e.strm.avail_out),1)}),new Au(4,4,8,4,Ac),new Au(4,5,16,8,Ac),new Au(4,6,32,32,Ac),new Au(4,4,16,16,Ad),new Au(8,16,32,32,Ad),new Au(8,16,128,128,Ad),new Au(8,32,128,256,Ad),new Au(32,128,258,1024,Ad),new Au(32,258,258,4096,Ad)],__.deflateInit=function(e,t){return Af(e,t,8,15,8,0)},__.deflateInit2=Af,__.deflateReset=Ap,__.deflateResetKeep=Ah,__.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},__.deflate=function(e,t){var r,i,n,o;if(!e||!e.state||t>5||t<0)return e?_7(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return _7(e,0===e.avail_out?-5:-2);if(i.strm=e,r=i.last_flush,i.last_flush=t,42===i.status){if(2===i.wrap)e.adler=0,An(i,31),An(i,139),An(i,8),i.gzhead?(An(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),An(i,255&i.gzhead.time),An(i,i.gzhead.time>>8&255),An(i,i.gzhead.time>>16&255),An(i,i.gzhead.time>>24&255),An(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),An(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(An(i,255&i.gzhead.extra.length),An(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=_6(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(An(i,0),An(i,0),An(i,0),An(i,0),An(i,0),An(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),An(i,3),i.status=113);else{var a=8+(i.w_bits-8<<4)<<8;a|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=32),a+=31-a%31,i.status=113,Ao(i,a),0!==i.strstart&&(Ao(i,e.adler>>>16),Ao(i,65535&e.adler)),e.adler=1}}if(69===i.status){if(i.gzhead.extra){for(n=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>n&&(e.adler=_6(e.adler,i.pending_buf,i.pending-n,n)),Ar(e),n=i.pending,i.pending!==i.pending_buf_size));)An(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(e.adler=_6(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73}if(73===i.status){if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=_6(e.adler,i.pending_buf,i.pending-n,n)),Ar(e),n=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,An(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>n&&(e.adler=_6(e.adler,i.pending_buf,i.pending-n,n)),0===o&&(i.gzindex=0,i.status=91)}else i.status=91}if(91===i.status){if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=_6(e.adler,i.pending_buf,i.pending-n,n)),Ar(e),n=i.pending,i.pending===i.pending_buf_size)){o=1;break}o=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,An(i,o)}while(0!==o);i.gzhead.hcrc&&i.pending>n&&(e.adler=_6(e.adler,i.pending_buf,i.pending-n,n)),0===o&&(i.status=103)}else i.status=103}if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Ar(e),i.pending+2<=i.pending_buf_size&&(An(i,255&e.adler),An(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(Ar(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&Ae(t)<=Ae(r)&&4!==t)return _7(e,-5);if(666===i.status&&0!==e.avail_in)return _7(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var s=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(As(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=_A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Ai(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Ai(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ai(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,i,n,o,a=e.window;;){if(e.lookahead<=258){if(As(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=a[n=e.strstart-1])===a[++n]&&i===a[++n]&&i===a[++n]){o=e.strstart+258;do;while(i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&n<o);e.match_length=258-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=_A._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=_A._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Ai(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Ai(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ai(e,!1),0===e.strm.avail_out)?1:2}(i,t):_4[i.level].func(i,t);if(3!==s&&4!==s||(i.status=666),1===s||3===s)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===s&&(1===t?_A._tr_align(i):5!==t&&(_A._tr_stored_block(i,0,0,!1),3===t&&(At(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Ar(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(An(i,255&e.adler),An(i,e.adler>>8&255),An(i,e.adler>>16&255),An(i,e.adler>>24&255),An(i,255&e.total_in),An(i,e.total_in>>8&255),An(i,e.total_in>>16&255),An(i,e.total_in>>24&255)):(Ao(i,e.adler>>>16),Ao(i,65535&e.adler)),Ar(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},__.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?_7(e,-2):(e.state=null,113===t?_7(e,-3):0):-2},__.deflateSetDictionary=function(e,t){var r,i,n,o,a,s,c,d,u=t.length;if(!e||!e.state||2===(o=(r=e.state).wrap)||1===o&&42!==r.status||r.lookahead)return -2;for(1===o&&(e.adler=_2(e.adler,t,u,0)),r.wrap=0,u>=r.w_size&&(0===o&&(At(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new _p.Buf8(r.w_size),_p.arraySet(d,t,u-r.w_size,r.w_size,0),t=d,u=r.w_size),a=e.avail_in,s=e.next_in,c=e.input,e.avail_in=u,e.next_in=0,e.input=t,As(r);r.lookahead>=3;){i=r.strstart,n=r.lookahead-2;do r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+3-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++;while(--n);r.strstart=i,r.lookahead=2,As(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=a,r.wrap=o,0},__.deflateInfo="pako deflate (from Nodeca project)";var A_={},AA=!0,Am=!0;try{String.fromCharCode.apply(null,[0])}catch(e){AA=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Am=!1}for(var Av=new _p.Buf8(256),AE=0;AE<256;AE++)Av[AE]=AE>=252?6:AE>=248?5:AE>=240?4:AE>=224?3:AE>=192?2:1;function Ag(e,t){if(t<65534&&(e.subarray&&Am||!e.subarray&&AA))return String.fromCharCode.apply(null,_p.shrinkBuf(e,t));for(var r="",i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r}Av[254]=Av[254]=1,A_.string2buf=function(e){var t,r,i,n,o,a=e.length,s=0;for(n=0;n<a;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new _p.Buf8(s),o=0,n=0;o<s;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?t[o++]=r:(r<2048?t[o++]=192|r>>>6:(r<65536?t[o++]=224|r>>>12:(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63),t[o++]=128|r>>>6&63),t[o++]=128|63&r);return t},A_.buf2binstring=function(e){return Ag(e,e.length)},A_.binstring2buf=function(e){for(var t=new _p.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},A_.buf2string=function(e,t){var r,i,n,o,a=t||e.length,s=Array(2*a);for(i=0,r=0;r<a;)if((n=e[r++])<128)s[i++]=n;else if((o=Av[n])>4)s[i++]=65533,r+=o-1;else{for(n&=2===o?31:3===o?15:7;o>1&&r<a;)n=n<<6|63&e[r++],o--;o>1?s[i++]=65533:n<65536?s[i++]=n:(n-=65536,s[i++]=55296|n>>10&1023,s[i++]=56320|1023&n)}return Ag(s,i)},A_.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Av[e[r]]>t?r:t};var AS=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Ab=Object.prototype.toString;function AT(e){if(!(this instanceof AT))return new AT(e);this.options=_p.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t,r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new AS,this.strm.avail_out=0;var i=__.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(0!==i)throw Error(_3[i]);if(r.header&&__.deflateSetHeader(this.strm,r.header),r.dictionary){if(t="string"==typeof r.dictionary?A_.string2buf(r.dictionary):"[object ArrayBuffer]"===Ab.call(r.dictionary)?new Uint8Array(r.dictionary):r.dictionary,0!==(i=__.deflateSetDictionary(this.strm,t)))throw Error(_3[i]);this._dict_set=!0}}function Ay(e,t){var r=new AT(t);if(r.push(e,!0),r.err)throw r.msg||_3[r.err];return r.result}AT.prototype.push=function(e,t){var r,i,n=this.strm,o=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=A_.string2buf(e):"[object ArrayBuffer]"===Ab.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new _p.Buf8(o),n.next_out=0,n.avail_out=o),1!==(r=__.deflate(n,i))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(A_.buf2binstring(_p.shrinkBuf(n.output,n.next_out))):this.onData(_p.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&1!==r);return 4===i?(r=__.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==i||(this.onEnd(0),n.avail_out=0,!0)},AT.prototype.onData=function(e){this.chunks.push(e)},AT.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=_p.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},_f.Deflate=AT,_f.deflate=Ay,_f.deflateRaw=function(e,t){return(t=t||{}).raw=!0,Ay(e,t)},_f.gzip=function(e,t){return(t=t||{}).gzip=!0,Ay(e,t)};var AR={},AI=function(){var e=e4(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},AC=RegExp.prototype,Ak=function(e){var t=e.flags;return void 0!==t||"flags"in AC||eI(e,"flags")||!ee(AC,e)?t:L(AI,e)},Aw=RegExp.prototype,AO=d(function(e){return e===Aw||ee(Aw,e)?Ak(e):e.flags}),AN={},AP=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],AD=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],AL=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],AM=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Ax=function(e,t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I;r=e.state,i=e.next_in,R=e.input,n=i+(e.avail_in-5),o=e.next_out,I=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),c=r.dmax,d=r.wsize,u=r.whave,l=r.wnext,h=r.window,p=r.hold,f=r.bits,_=r.lencode,A=r.distcode,m=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do for(f<15&&(p+=R[i++]<<f,f+=8,p+=R[i++]<<f,f+=8),E=_[p&m];;){if(p>>>=g=E>>>24,f-=g,0==(g=E>>>16&255))I[o++]=65535&E;else{if(!(16&g)){if(0==(64&g)){E=_[(65535&E)+(p&(1<<g)-1)];continue}if(32&g){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}for(S=65535&E,(g&=15)&&(f<g&&(p+=R[i++]<<f,f+=8),S+=p&(1<<g)-1,p>>>=g,f-=g),f<15&&(p+=R[i++]<<f,f+=8,p+=R[i++]<<f,f+=8),E=A[p&v];;){if(p>>>=g=E>>>24,f-=g,!(16&(g=E>>>16&255))){if(0==(64&g)){E=A[(65535&E)+(p&(1<<g)-1)];continue}e.msg="invalid distance code",r.mode=30;break e}if(b=65535&E,f<(g&=15)&&(p+=R[i++]<<f,(f+=8)<g&&(p+=R[i++]<<f,f+=8)),(b+=p&(1<<g)-1)>c){e.msg="invalid distance too far back",r.mode=30;break e}if(p>>>=g,f-=g,b>(g=o-a)){if((g=b-g)>u&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(T=0,y=h,0===l){if(T+=d-g,g<S){S-=g;do I[o++]=h[T++];while(--g);T=o-b,y=I}}else if(l<g){if(T+=d+l-g,(g-=l)<S){S-=g;do I[o++]=h[T++];while(--g);if(T=0,l<S){S-=g=l;do I[o++]=h[T++];while(--g);T=o-b,y=I}}}else if(T+=l-g,g<S){S-=g;do I[o++]=h[T++];while(--g);T=o-b,y=I}for(;S>2;)I[o++]=y[T++],I[o++]=y[T++],I[o++]=y[T++],S-=3;S&&(I[o++]=y[T++],S>1&&(I[o++]=y[T++]))}else{T=o-b;do I[o++]=I[T++],I[o++]=I[T++],I[o++]=I[T++],S-=3;while(S>2);S&&(I[o++]=I[T++],S>1&&(I[o++]=I[T++]))}break}}break}while(i<n&&o<s);i-=S=f>>3,p&=(1<<(f-=S<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=p,r.bits=f},AU=function(e,t,r,i,n,o,a,s){var c,d,u,l,h,p,f,_,A,m=s.bits,v=0,E=0,g=0,S=0,b=0,T=0,y=0,R=0,I=0,C=0,k=null,w=0,O=new _p.Buf16(16),N=new _p.Buf16(16),P=null,D=0;for(v=0;v<=15;v++)O[v]=0;for(E=0;E<i;E++)O[t[r+E]]++;for(b=m,S=15;S>=1&&0===O[S];S--);if(b>S&&(b=S),0===S)return n[o++]=0x1400000,n[o++]=0x1400000,s.bits=1,0;for(g=1;g<S&&0===O[g];g++);for(b<g&&(b=g),R=1,v=1;v<=15;v++)if(R<<=1,(R-=O[v])<0)return -1;if(R>0&&(0===e||1!==S))return -1;for(N[1]=0,v=1;v<15;v++)N[v+1]=N[v]+O[v];for(E=0;E<i;E++)0!==t[r+E]&&(a[N[t[r+E]]++]=E);if(0===e?(k=P=a,p=19):1===e?(k=AP,w-=257,P=AD,D-=257,p=256):(k=AL,P=AM,p=-1),C=0,E=0,v=g,h=o,T=b,y=0,u=-1,l=(I=1<<b)-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){f=v-y,a[E]<p?(_=0,A=a[E]):a[E]>p?(_=P[D+a[E]],A=k[w+a[E]]):(_=96,A=0),c=1<<v-y,g=d=1<<T;do n[h+(C>>y)+(d-=c)]=f<<24|_<<16|A|0;while(0!==d);for(c=1<<v-1;C&c;)c>>=1;if(0!==c?(C&=c-1,C+=c):C=0,E++,0==--O[v]){if(v===S)break;v=t[r+a[E]]}if(v>b&&(C&l)!==u){for(0===y&&(y=b),h+=g,R=1<<(T=v-y);T+y<S&&!((R-=O[T+y])<=0);)T++,R<<=1;if(I+=1<<T,1===e&&I>852||2===e&&I>592)return 1;n[u=C&l]=b<<24|T<<16|h-o|0}}return 0!==C&&(n[h+C]=v-y<<24|4194304),s.bits=b,0};function AB(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function AV(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _p.Buf16(320),this.work=new _p.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function AF(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new _p.Buf32(852),t.distcode=t.distdyn=new _p.Buf32(592),t.sane=1,t.back=-1,0):-2}function Aj(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,AF(e)):-2}function AG(e,t){var r,i;return e&&e.state?(i=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,Aj(e))):-2}function AW(e,t){var r,i;return e?(i=new AV,e.state=i,i.window=null,0!==(r=AG(e,t))&&(e.state=null),r):-2}var AH,AY,AK=!0;function AQ(e,t,r,i){var n,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new _p.Buf8(o.wsize)),i>=o.wsize?(_p.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>i&&(n=i),_p.arraySet(o.window,t,r-i,n,o.wnext),(i-=n)?(_p.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0}AN.inflateReset=Aj,AN.inflateReset2=AG,AN.inflateResetKeep=AF,AN.inflateInit=function(e){return AW(e,15)},AN.inflateInit2=AW,AN.inflate=function(e,t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I=0,C=new _p.Buf8(4),k=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return -2;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,n=e.output,c=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,d=r.hold,u=r.bits,l=s,h=c,T=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;u<16;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(2&r.wrap&&35615===d){r.check=0,C[0]=255&d,C[1]=d>>>8&255,r.check=_6(r.check,C,2,0),d=0,u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=30;break}if((15&d)!=8){e.msg="unknown compression method",r.mode=30;break}if(u-=4,b=8+(15&(d>>>=4)),0===r.wbits)r.wbits=b;else if(b>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<b,e.adler=r.check=1,r.mode=512&d?10:12,d=0,u=0;break;case 2:for(;u<16;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(r.flags=d,(255&AO(r))!=8){e.msg="unknown compression method",r.mode=30;break}if(57344&AO(r)){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=d>>8&1),512&AO(r)&&(C[0]=255&d,C[1]=d>>>8&255,r.check=_6(r.check,C,2,0)),d=0,u=0,r.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}r.head&&(r.head.time=d),512&AO(r)&&(C[0]=255&d,C[1]=d>>>8&255,C[2]=d>>>16&255,C[3]=d>>>24&255,r.check=_6(r.check,C,4,0)),d=0,u=0,r.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}r.head&&(r.head.xflags=255&d,r.head.os=d>>8),512&AO(r)&&(C[0]=255&d,C[1]=d>>>8&255,r.check=_6(r.check,C,2,0)),d=0,u=0,r.mode=5;case 5:if(1024&AO(r)){for(;u<16;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}r.length=d,r.head&&(r.head.extra_len=d),512&AO(r)&&(C[0]=255&d,C[1]=d>>>8&255,r.check=_6(r.check,C,2,0)),d=0,u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&AO(r)&&((p=r.length)>s&&(p=s),p&&(r.head&&(b=r.head.extra_len-r.length,r.head.extra||(r.head.extra=Array(r.head.extra_len)),_p.arraySet(r.head.extra,i,o,p,b)),512&AO(r)&&(r.check=_6(r.check,i,p,o)),s-=p,o+=p,r.length-=p),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&AO(r)){if(0===s)break e;p=0;do b=i[o+p++],r.head&&b&&r.length<65536&&(r.head.name+=String.fromCharCode(b));while(b&&p<s);if(512&AO(r)&&(r.check=_6(r.check,i,p,o)),s-=p,o+=p,b)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&AO(r)){if(0===s)break e;p=0;do b=i[o+p++],r.head&&b&&r.length<65536&&(r.head.comment+=String.fromCharCode(b));while(b&&p<s);if(512&AO(r)&&(r.check=_6(r.check,i,p,o)),s-=p,o+=p,b)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&AO(r)){for(;u<16;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(d!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}d=0,u=0}r.head&&(r.head.hcrc=AO(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;u<32;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}e.adler=r.check=AB(d),d=0,u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=d,r.bits=u,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){d>>>=7&u,u-=7&u,r.mode=27;break}for(;u<3;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}switch(r.last=1&d,u-=1,3&(d>>>=1)){case 0:r.mode=14;break;case 1:if(function(e){if(AK){var t;for(AH=new _p.Buf32(512),AY=new _p.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(AU(1,e.lens,0,288,AH,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;AU(2,e.lens,0,32,AY,0,e.work,{bits:5}),AK=!1}e.lencode=AH,e.lenbits=9,e.distcode=AY,e.distbits=5}(r),r.mode=20,6===t){d>>>=2,u-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}d>>>=2,u-=2;break;case 14:for(d>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&d,d=0,u=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(p=r.length){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;_p.arraySet(n,i,o,p,a),s-=p,o+=p,c-=p,a+=p,r.length-=p;break}r.mode=12;break;case 17:for(;u<14;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(r.nlen=257+(31&d),d>>>=5,u-=5,r.ndist=1+(31&d),d>>>=5,u-=5,r.ncode=4+(15&d),d>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;u<3;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}r.lens[k[r.have++]]=7&d,d>>>=3,u-=3}for(;r.have<19;)r.lens[k[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,y={bits:r.lenbits},T=AU(0,r.lens,0,19,r.lencode,0,r.work,y),r.lenbits=y.bits,T){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;m=(I=r.lencode[d&(1<<r.lenbits)-1])>>>16&255,v=65535&I,!((A=I>>>24)<=u);){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(v<16)d>>>=A,u-=A,r.lens[r.have++]=v;else{if(16===v){for(R=A+2;u<R;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(d>>>=A,u-=A,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}b=r.lens[r.have-1],p=3+(3&d),d>>>=2,u-=2}else if(17===v){for(R=A+3;u<R;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}u-=A,b=0,p=3+(7&(d>>>=A)),d>>>=3,u-=3}else{for(R=A+7;u<R;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}u-=A,b=0,p=11+(127&(d>>>=A)),d>>>=7,u-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;p--;)r.lens[r.have++]=b}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,y={bits:r.lenbits},T=AU(1,r.lens,0,r.nlen,r.lencode,0,r.work,y),r.lenbits=y.bits,T){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,y={bits:r.distbits},T=AU(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,y),r.distbits=y.bits,T){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=d,r.bits=u,Ax(e,h),a=e.next_out,n=e.output,c=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,d=r.hold,u=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;m=(I=r.lencode[d&(1<<r.lenbits)-1])>>>16&255,v=65535&I,!((A=I>>>24)<=u);){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(m&&0==(240&m)){for(E=A,g=m,S=v;m=(I=r.lencode[S+((d&(1<<E+g)-1)>>E)])>>>16&255,v=65535&I,!(E+(A=I>>>24)<=u);){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}d>>>=E,u-=E,r.back+=E}if(d>>>=A,u-=A,r.back+=A,r.length=v,0===m){r.mode=26;break}if(32&m){r.back=-1,r.mode=12;break}if(64&m){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&m,r.mode=22;case 22:if(r.extra){for(R=r.extra;u<R;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;m=(I=r.distcode[d&(1<<r.distbits)-1])>>>16&255,v=65535&I,!((A=I>>>24)<=u);){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(0==(240&m)){for(E=A,g=m,S=v;m=(I=r.distcode[S+((d&(1<<E+g)-1)>>E)])>>>16&255,v=65535&I,!(E+(A=I>>>24)<=u);){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}d>>>=E,u-=E,r.back+=E}if(d>>>=A,u-=A,r.back+=A,64&m){e.msg="invalid distance code",r.mode=30;break}r.offset=v,r.extra=15&m,r.mode=24;case 24:if(r.extra){for(R=r.extra;u<R;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===c)break e;if(p=h-c,r.offset>p){if((p=r.offset-p)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}p>r.wnext?(p-=r.wnext,f=r.wsize-p):f=r.wnext-p,p>r.length&&(p=r.length),_=r.window}else _=n,f=a-r.offset,p=r.length;p>c&&(p=c),c-=p,r.length-=p;do n[a++]=_[f++];while(--p);0===r.length&&(r.mode=21);break;case 26:if(0===c)break e;n[a++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;u<32;){if(0===s)break e;s--,d|=i[o++]<<u,u+=8}if(h-=c,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=AO(r)?_6(r.check,n,h,a-h):_2(r.check,n,h,a-h)),h=c,(AO(r)?d:AB(d))!==r.check){e.msg="incorrect data check",r.mode=30;break}d=0,u=0}r.mode=28;case 28:if(r.wrap&&AO(r)){for(;u<32;){if(0===s)break e;s--,d+=i[o++]<<u,u+=8}if(d!==(0xffffffff&r.total)){e.msg="incorrect length check",r.mode=30;break}d=0,u=0}r.mode=29;case 29:T=1;break e;case 30:T=-3;break e;case 31:return -4;default:return -2}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,r.hold=d,r.bits=u,(r.wsize||h!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&AQ(e,e.output,e.next_out,h-e.avail_out),l-=e.avail_in,h-=e.avail_out,e.total_in+=l,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=AO(r)?_6(r.check,n,h,e.next_out-h):_2(r.check,n,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===l&&0===h||4===t)&&0===T&&(T=-5),T},AN.inflateEnd=function(e){if(!e||!e.state)return -2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},AN.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?-2:(r.head=t,t.done=!1,0):-2},AN.inflateSetDictionary=function(e,t){var r,i=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?-2:11===r.mode&&_2(1,t,i,0)!==r.check?-3:AQ(e,t,i,i)?(r.mode=31,-4):(r.havedict=1,0):-2},AN.inflateInfo="pako inflate (from Nodeca project)";var Az={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},AX=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},AJ=Object.prototype.toString;function Aq(e){if(!(this instanceof Aq))return new Aq(e);this.options=_p.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new AS,this.strm.avail_out=0;var r=AN.inflateInit2(this.strm,t.windowBits);if(r!==Az.Z_OK||(this.header=new AX,AN.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=A_.string2buf(t.dictionary):"[object ArrayBuffer]"===AJ.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=AN.inflateSetDictionary(this.strm,t.dictionary))!==Az.Z_OK)))throw Error(_3[r])}function AZ(e,t){var r=new Aq(t);if(r.push(e,!0),r.err)throw r.msg||_3[r.err];return r.result}Aq.prototype.push=function(e,t){var r,i,n,o,a,s=this.strm,c=this.options.chunkSize,d=this.options.dictionary,u=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?Az.Z_FINISH:Az.Z_NO_FLUSH,"string"==typeof e?s.input=A_.binstring2buf(e):"[object ArrayBuffer]"===AJ.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new _p.Buf8(c),s.next_out=0,s.avail_out=c),(r=AN.inflate(s,Az.Z_NO_FLUSH))===Az.Z_NEED_DICT&&d&&(r=AN.inflateSetDictionary(this.strm,d)),r===Az.Z_BUF_ERROR&&!0===u&&(r=Az.Z_OK,u=!1),r!==Az.Z_STREAM_END&&r!==Az.Z_OK)return this.onEnd(r),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&r!==Az.Z_STREAM_END&&(0!==s.avail_in||i!==Az.Z_FINISH&&i!==Az.Z_SYNC_FLUSH)||("string"===this.options.to?(n=A_.utf8border(s.output,s.next_out),o=s.next_out-n,a=A_.buf2string(s.output,n),s.next_out=o,s.avail_out=c-o,o&&_p.arraySet(s.output,s.output,n,o,0),this.onData(a)):this.onData(_p.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(u=!0)}while((s.avail_in>0||0===s.avail_out)&&r!==Az.Z_STREAM_END);return r===Az.Z_STREAM_END&&(i=Az.Z_FINISH),i===Az.Z_FINISH?(r=AN.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Az.Z_OK):i!==Az.Z_SYNC_FLUSH||(this.onEnd(Az.Z_OK),s.avail_out=0,!0)},Aq.prototype.onData=function(e){this.chunks.push(e)},Aq.prototype.onEnd=function(e){e===Az.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=_p.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},AR.Inflate=Aq,AR.inflate=AZ,AR.inflateRaw=function(e,t){return(t=t||{}).raw=!0,AZ(e,t)},AR.ungzip=AZ;var A$=_p.assign,A0={};A$(A0,_f,AR,Az);var A2=d(A0),A1=1,A4=function(){function e(t){nK(this,e),nQ(this,"lockingPromise",sP.resolve()),nQ(this,"locks",0),nQ(this,"name",""),nQ(this,"lockId",void 0),this.lockId=A1++,t&&(this.name=t)}return nY(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(){var e,t=this;this.locks+=1;var r=new sP(function(r){e=function(){t.locks-=1,r()}}),i=this.lockingPromise.then(function(){return e});return this.lockingPromise=this.lockingPromise.then(function(){return r}),i}}]),e}(),A6="VERTC",A3=function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},A8=function(){var e,t,r,i,n,o,a;function s(e){nK(this,s),nQ(this,"storeName",void 0),nQ(this,"pendingList",[]),this.storeName=e,!f0()&&A3()&&this._checkAndCreateStore(e)}return nY(s,[{key:"_checkAndCreateStore",value:(a=sk(sI().mark(function e(t,r){var i,n,o=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s._promiseLock.lock();case 2:if(i=e.sent,!A3().databases){e.next=6;break}return e.next=6,new sP(function(e){var t=function(){return A3().databases().finally(e)};n=setInterval(t,100),t()}).finally(function(){return clearInterval(n)});case 6:return e.abrupt("return",new sP(function(e){s.db&&(s.db.close(),delete s.db);var n=r?A3().open(A6,r):A3().open(A6);n.onupgradeneeded=function(){n.result.createObjectStore(t)},n.onerror=function(){console.error("IndexedDBInterface error",n.error)},n.onsuccess=function(){var r=n.result;s.db=r;try{s.db.transaction(o.storeName,"readonly"),o.pendingList.forEach(function(){var e=sk(sI().mark(function e(t){var r,i,n,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.txMode,i=t.pendResolve,n=t.pendReject,e.prev=1,e.next=4,o._getStore(r);case 4:a=e.sent,i(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),n();case 11:case"end":return e.stop()}},e,null,[[1,8]])}));return function(t){return e.apply(this,arguments)}}()),e()}catch(i){e(o._checkAndCreateStore(t,r.version+1))}finally{i()}}}));case 7:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)})},{key:"_getStore",value:(o=sk(sI().mark(function e(t){var r,i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s._promiseLock.lock();case 2:return r=e.sent,e.abrupt("return",new sP(function(e,n){if(!s.db)return i.pendingList.push({txMode:t,pendResolve:e,pendReject:n}),void r();try{e(s.db.transaction(i.storeName,t).objectStore(i.storeName))}catch(r){return void i.pendingList.push({txMode:t,pendResolve:e,pendReject:n})}finally{r()}}));case 4:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)})},{key:"put2String",value:(n=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{i=sD(t)}catch(e){i=t}return e.next=3,this.put(i,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"get4String",value:(i=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:r=e.sent;try{i=JSON.parse(r)}catch(e){i=r}return e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"put",value:(r=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readwrite");case 2:return i=e.sent,e.abrupt("return",new sP(function(e,n){var o=i.put(t,r);o.onsuccess=function(){e()},o.onerror=function(e){n(e)}}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"get",value:(t=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readonly");case 2:return r=e.sent,e.abrupt("return",new sP(function(e,i){var n=r.get(t);n.onsuccess=function(){e(n.result)},n.onerror=function(e){i(e)}}));case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"del",value:(e=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getStore("readwrite");case 2:return r=e.sent,e.abrupt("return",new sP(function(e,i){var n=r.delete(t);n.onsuccess=function(){e()},n.onerror=function(e){i(e)}}));case 4:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})}]),s}();nQ(A8,"db",void 0),nQ(A8,"state","init"),nQ(A8,"_promiseLock",new A4("iDB"));var A5=["message"],A9,A7,me,mt=new(function(){function e(){nK(this,e),nQ(this,"name","LongStringReportor"),nQ(this,"inBuffer",[]),nQ(this,"outBuffer",[])}return nY(e,[{key:"push",value:function(e){var t;e.message&&this.inBuffer.push(l9(l9({},e),{},{message:{id:uk(t=f2()).call(t,0,3),index:0,end:!0,msg:e.message}}))}},{key:"splice",value:function(e){for(var t=[],r=0;this.outBuffer.length;){var i=sD(this.outBuffer[0]).length;if(!(i<e))break;e-=i,r+=i,t.push(this.outBuffer.shift())}for(;this.inBuffer[0]&&e>0;){var n=this.inBuffer[0],o=n.message,a=l9(l9({},l7(n,A5)),{},{message:l9(l9({},o),{},{msg:""})}),s=sD(a).length,c=e-s,d=l9({},a);if(c>o.msg.length)d.message.msg=o.msg,this.inBuffer.shift();else{if(!(c>=10))break;var u,l,h=uk(u=o.msg).call(u,0,c);d.message.msg=h,d.message.end=!1,this.inBuffer[0].message.msg=uk(l=o.msg).call(l,c),this.inBuffer[0].message.index++}var p=sD(d.message),f=p.length;e-=f+s,r+=f+s,t.push(l9(l9({},d),{},{message:p}))}return{payload:t,payloadSize:r}}},{key:"unshift",value:function(e){this.outBuffer=sN(e).call(e,this.outBuffer)}},{key:"get",value:function(){var e,t;return sN(e=[]).call(e,le(this.outBuffer),le(sU(t=this.inBuffer).call(t,function(e){return l9(l9({},e),{},{message:sD(e.message)})})))}},{key:"set",value:function(e){var t=this,r=[],i=[];e.forEach(function(e){void 0!==e.report_id?t.outBuffer.push(e):(e.message||(e.message=""),t.inBuffer.push(l9(l9({},e),{},{message:JSON.parse(e.message)})))}),this.outBuffer=sN(r).call(r,this.outBuffer),this.inBuffer=sN(i).call(i,this.inBuffer)}},{key:"isEmpty",value:function(){return 0===this.inBuffer.length&&0===this.outBuffer.length}}]),e}()),mr={product_line:"rtc",report_version:"5",os:"web",user_agent:f0()?"":null===(A9=navigator)||void 0===A9?void 0:A9.userAgent,platform:"web",product:"webrtc",app_state:"active"},mi="LogReportor",mn="undefined"!=typeof window&&(cd(A7=window.location.search).call(A7,"_rtc_debug_")||(null===(me=window.localStorage)||void 0===me?void 0:me.getItem("_rtc_debug_"))),mo=function(){var e,t;function r(e){nK(this,r),nQ(this,"_buffer",void 0),this._buffer=new A8(e)}return nY(r,[{key:"set",value:(t=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._buffer.put2String(t,r);case 2:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"get",value:(e=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],e.prev=1,e.next=4,this._buffer.get4String(t);case 4:i=e.sent,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(1);case 9:return e.abrupt("return",null!==(r=i)&&void 0!==r?r:[]);case 10:case"end":return e.stop()}},e,this,[[1,7]])})),function(t){return e.apply(this,arguments)})}]),r}(),ma=function(){var e;function t(){var e=this;nK(this,t),nQ(this,"reportCommon",mr),nQ(this,"reportIds",new d9),nQ(this,"dataBuffer",[]),nQ(this,"reportorList",[]),nQ(this,"dbBuffer",void 0),nQ(this,"posting",!1),nQ(this,"sucSendTimer",void 0),nQ(this,"preSucTime",0),nQ(this,"errSendTimer",void 0),nQ(this,"errSendDelay",100),nQ(this,"_logServerUrl",void 0),nQ(this,"_retryCount",0),nQ(this,"_reportLimit",5e5),nQ(this,"_disableTimeout",!1),f0()||(window.addEventListener("beforeunload",function(){clearTimeout(e.errSendTimer),clearTimeout(e.sucSendTimer),e.send(void 0,!0)}),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState?e.setCommonStats({app_state:"active"}):"hidden"===document.visibilityState&&e.setCommonStats({app_state:"background"})}),mn&&(window.__rtc_debug_reportor__=this)),_c.on("UPLOAD_REPORT_LIMIT",function(t){e.setReportLimit(t)}),_c.on("ENABLE_REPORT_IDB_BUFFER",function(t){t&&e.enableIndexedDBBuffer()}),setTimeout(function(){e.reportorList.push(mY),e.reportorList.push(mt)})}return nY(t,[{key:"setUrl",value:function(e){this._logServerUrl=e}},{key:"setCommonStats",value:function(e){this.reportCommon=uo(this.reportCommon,e)}},{key:"getCommonStats",value:function(){return this.reportCommon}},{key:"setReportLimit",value:function(e){this._reportLimit=Math.max(e,5e4),this._reportLimit=Math.min(e,5e5)}},{key:"getReportId",value:function(e){e=null!==(t=e)&&void 0!==t?t:"__global__",this.reportIds.has(e)||this.reportIds.set(e,0);var t,r=this.reportIds.get(e);return void 0===r&&(mv("no reportId in reportId map with engine-session-id ".concat(e),0,{}),r=0),this.reportIds.set(e,r+1),r}},{key:"push",value:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])this.send(e);else{var t,r=null!==(t=e.engine_session_id)&&void 0!==t?t:"__global__";this.reportIds.has(r)||this.reportIds.set(r,0),this.dataBuffer.push(e),!this.posting&&!this.errSendTimer&&Date.now()-this.preSucTime>2e3&&(clearTimeout(this.sucSendTimer),this.send())}}},{key:"enableIndexedDBBuffer",value:function(){var e=this;this.dbBuffer||(this.dbBuffer=new mo("ReportorDBBuffer"),this.dbBuffer.get(mi).then(function(t){t.forEach(function(t){e.push(t)})}),this.reportorList.forEach(function(t){var r;null===(r=e.dbBuffer)||void 0===r||r.get(t.name).then(function(e){t.set(e)})}))}},{key:"backup",value:function(){var e,t=this;try{null===(e=this.dbBuffer)||void 0===e||e.set(le(this.dataBuffer),mi),this.reportorList.forEach(function(e){var r;null===(r=t.dbBuffer)||void 0===r||r.set(le(e.get()),e.name)})}catch(e){mv("Error when save log into IDB",-1,e)}}},{key:"unshift",value:function(e){var t;this.dataBuffer=sN(t=e[0]).call(t,this.dataBuffer),this.reportorList.forEach(function(t,r){var i;t.unshift(null!==(i=e[r+1])&&void 0!==i?i:[])})}},{key:"_splice",value:function(){var e,t=this,r=function(e,t){for(var r=0,i=0;i<e.length;i++)if((r+=sD(e[i]).length)>t)return i;return e.length}(this.dataBuffer,this._reportLimit);0===r&&this.dataBuffer.length>0&&(this._reportLimit=sD(this.dataBuffer[0]).length+10,r=1,mv("update report limit to ".concat(this._reportLimit),0,null));var i=uH(e=this.dataBuffer).call(e,0,r),n=sD(i).length,o=[i],a=this._reportLimit-n;return this.reportorList.forEach(function(e){var r=uH(e).call(e,a),i=r.payload,n=r.payloadSize;i.forEach(function(e){var r,i,n;void 0===e.report_id&&(e.report_id=t.getReportId(e.engine_session_id),!f0()&&window.__onRTCReport&&(null===(r=(i=window).__onRTCReport)||void 0===r||r.call(i,null!==(n=e.engine_session_id)&&void 0!==n?n:"global",e,t.getCommonStats())))}),o.push(i),a-=n}),o}},{key:"send",value:(e=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.backup(),n=c_(i=this.reportorList).call(i,function(e,t){return e&&t.isEmpty()},!0),(t||this.dataBuffer.length||!n)&&this._logServerUrl){e.next=4;break}return e.abrupt("return");case 4:if(t||(this.posting=!0),o=[],t||(o=this._splice()),a=mn,s={data:t||_h(o).call(o),header:l9(l9({},this.reportCommon),{},{http_retry_count:this._retryCount}),from:"web",os:"web",version:"1"},c={method:"POST",body:a?sD(s):A2.gzip(sD(s))},!this._disableTimeout)try{d=new AbortController,c.signal=d.signal,setTimeout(function(){d.abort()},1e4)}catch(e){console.warn("AbortController is not supported"),this._disableTimeout=!0}return a||(c.headers={"Content-Encoding":"gzip","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}),h=null,e.prev=13,e.next=16,fetch(this._logServerUrl,c);case 16:if(200!==(u=e.sent).status&&304!==u.status){e.next=23;break}return e.t0=JSON,e.next=21,u.text();case 21:e.t1=e.sent,h=e.t0.parse.call(e.t0,e.t1);case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(13),l=e.t2;case 28:t||(this.posting=!1),h&&0===h.StatusCode?t||r||this.sucSend():(setTimeout(function(){var e,t,r,i;mv(sN(e="reportor post error, resJSON:".concat(null===(t=h)||void 0===t?void 0:t.toString()," err:")).call(e,l),null!==(r=null===(i=u)||void 0===i?void 0:i.status)&&void 0!==r?r:-1,l)},0),t?this.send(t):(this.unshift(o),r?this.send():this.errSend()));case 30:case"end":return e.stop()}},e,this,[[13,25]])})),function(t,r){return e.apply(this,arguments)})},{key:"sucSend",value:function(){this.errSendDelay=100,this._retryCount=0,this.preSucTime=Date.now(),this.sucSendTimer=setTimeout(this.send.bind(this),2e3)}},{key:"errSend",value:function(){var e=this;this.errSendTimer=setTimeout(function(){e.send(),delete e.errSendTimer},this.errSendDelay),this.errSendDelay*=2,this._retryCount++}}]),t}(),ms=new ma,mc=function(){function e(t){nK(this,e),nQ(this,"modifyIds",{pre_connection:!1}),this.id=t}return nY(e,[{key:"report",value:function(e,t){var r,i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=l9(l9(l9({event_key:e,rtc_timestamp:Date.now()},this.modifyIds),t),{},{common_extra_info:sD(n),report_id:ms.getReportId(this.modifyIds.engine_session_id)});!f0()&&window.__onRTCReport&&(null===(r=(i=window).__onRTCReport)||void 0===r||r.call(i,this.modifyIds.engine_session_id,o,ms.getCommonStats())),ms.push(o)}},{key:"reportLog",value:function(e){var t=l9(l9({event_key:"rtc_invoke_status",sdk_api_name:"console_log",rtc_timestamp:Date.now()},this.modifyIds),{},{message:e});mY.push(t)}},{key:"reportLongString",value:function(e,t){var r=l9(l9({event_key:"rtc_invoke_status",sdk_api_name:"sdk_long_string_".concat(e),rtc_timestamp:Date.now()},this.modifyIds),{},{message:t});mt.push(r)}},{key:"set",value:function(e){this.modifyIds=uo(this.modifyIds,e)}},{key:"destroy",value:function(){}}]),e}(),md=function(){function e(t){nK(this,e),nQ(this,"_preTime",Date.now()),nQ(this,"_one2oneNum",0),nQ(this,"_one2manyNum",0),nQ(this,"_one2oneMsgCache",new d9),nQ(this,"_one2manyMsgCache",new d9),nQ(this,"roomId",""),nQ(this,"userId",""),nQ(this,"rtsSessionId",""),nQ(this,"logger",void 0),nQ(this,"serverUrl","server"),this.id=t,this.logger=new mJ("MessageReportor",1)}return nY(e,[{key:"needReport",value:function(t){return!!e.config&&(Date.now()-this._preTime>=36e5&&(this._preTime=Date.now(),this._one2oneNum=0,this._one2manyNum=0),"one2one"===t&&this._one2oneNum<e.config.max_one2one_fpt_per_hour&&Math.random()<=e.config.one2one_fpt_ratio/100||"one2many"===t&&this._one2manyNum<e.config.max_one2many_fpt_per_hour&&Math.random()<=e.config.one2many_fpt_ratio/100)}},{key:"cacheP2PMsg",value:function(t){var r;this._one2oneMsgCache.set(t.msg_id,l9({config_version:(null===(r=e.config)||void 0===r?void 0:r.version)||""},t))}},{key:"updateP2PMsg",value:function(e,t){var r=this._one2oneMsgCache.get(e);r&&this._one2oneMsgCache.set(e,l9(l9({},r),t))}},{key:"cacheCustomMsg",value:function(t){var r;this._one2manyMsgCache.set(t.msg_id,l9({config_version:(null===(r=e.config)||void 0===r?void 0:r.version)||""},t))}},{key:"updateOne2ManyMsg",value:function(e,t){var r=this._one2manyMsgCache.get(e);r&&this._one2manyMsgCache.set(e,l9(l9({},r),t))}},{key:"reportP2PMsg",value:function(e){var t,r=this._one2oneMsgCache.get(e);r&&(this.logger.info("reportP2PMsg",r.type,sD(r)),null===(t=mS(this.id))||void 0===t||t.report("rts_message",r))}},{key:"reportOne2ManyMsg",value:function(e){var t,r=this._one2manyMsgCache.get(e);r&&(this.logger.info("reportOne2ManyMsg",r.type,sD(r)),null===(t=mS(this.id))||void 0===t||t.report("rts_message",r))}},{key:"reportMsgRecv",value:function(t){var r,i;t.config_version=(null===(r=e.config)||void 0===r?void 0:r.version)||"",this.logger.info("reportMsgRecv",t.type,sD(t)),null===(i=mS(this.id))||void 0===i||i.report("rts_message",t)}},{key:"destroy",value:function(){this._one2manyNum=0,this._one2oneNum=0,this._one2manyMsgCache.clear(),this._one2oneMsgCache.clear(),this._preTime=Date.now(),this.roomId="",this.userId="",this.rtsSessionId=""}}]),e}();nQ(md,"config",void 0);var mu=new d9,ml={_cache:mu,setServerUrl:function(e,t){var r=mu.get(e);r&&(r.serverUrl=t)},setConfig:function(e){new mJ("MessageReportor",1).info("setConfig","get config: ".concat(sD(e))),md.config=e},setRtsSessionId:function(e,t){var r=mu.get(e);r&&(r.rtsSessionId=t)},createRTSMsgReportor:function(e){var t=mu.get(e)||new md(e);return mu.set(e,t),t},destroyRTSMsgReportor:function(e){var t=mu.get(e);t&&(t.destroy(),mu.delete(e))},setRoomId:function(e,t){var r=mu.get(e);r&&(r.roomId=t||"")},setUserId:function(e,t){var r=mu.get(e);r&&(r.userId=t||"")},samplingP2PMsg:function(e,t){var r=mu.get(e);if(null!=r&&r.needReport("one2one")){var i=t.to?"one2one":"one2server";t.enable_report=!0,t.report_msg_id=t.id,r.cacheP2PMsg({rts_session_id:r.rtsSessionId,msg_id:"".concat(t.id),node_role:"src_sdk",from:t.from,to:t.to||r.serverUrl,msg_type:i,type:i,rts_room_id:t.room,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})}return t},updateP2PMsgReq:function(e,t,r){var i;t.enable_report&&f1(t.report_msg_id)&&(null===(i=mu.get(e))||void 0===i||i.updateP2PMsg("".concat(t.report_msg_id),{send_ts:Date.now(),msg_size:r}))},updateP2PMsgAck:function(e,t,r){if(t.enable_report&&f1(t.report_msg_id)){var i=mu.get(e);null==i||i.updateP2PMsg("".concat(t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==i||i.reportP2PMsg("".concat(t.report_msg_id))}},samplingOne2ManyMsg:function(e,t,r){var i=mu.get(e);return null!=i&&i.needReport("one2many")&&(r.enable_report=!0,r.report_msg_id=t,i.cacheCustomMsg({rts_session_id:i.rtsSessionId,msg_id:"".concat(t),node_role:"src_sdk",from:r.clientId,to:i.roomId||r.roomId,msg_type:"one2many",type:"one2many",rts_room_id:i.roomId,req_ts:Date.now(),send_ts:Date.now(),ack_ts:Date.now(),msg_size:0,error_code:0,recv_msg_ts:0,fwd_msg_ts:0,reply_ack_ts:0,cur_dst_uid:""})),r},reportP2PMsgRecv:function(e,t,r){if(t.enable_report&&f1(t.report_msg_id)){var i=mu.get(e),n=t.to?"one2one":"one2many";null==i||i.reportMsgRecv({rts_session_id:i.rtsSessionId,msg_id:"".concat(t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",msg_type:n,type:n,rts_room_id:t.room,from:t.from,to:t.to||t.room,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:t.to?"":i.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}},updateOne2ManyMsgAck:function(e,t,r){if(t.enable_report&&f1(t.report_msg_id)){var i=mu.get(e);i&&(null==i||i.updateOne2ManyMsg("".concat(t.report_msg_id),{ack_ts:Date.now(),error_code:r}),null==i||i.reportOne2ManyMsg("".concat(t.report_msg_id)))}},updateOne2ManyMsgReq:function(e,t,r){if(t.enable_report&&f1(t.report_msg_id)){var i=mu.get(e);i&&i.updateOne2ManyMsg("".concat(t.report_msg_id),{send_ts:Date.now(),msg_size:r})}},reportOne2ManyMsgRecv:function(e,t,r){if(t.enable_report&&f1(t.report_msg_id)){var i=mu.get(e);null==i||i.reportMsgRecv({rts_session_id:i.rtsSessionId,msg_id:"".concat(t.report_msg_id),msg_size:r.msg_size,node_role:"dst_sdk",msg_type:"one2many",type:"one2many",rts_room_id:t.roomId,from:t.clientId,to:t.roomId,error_code:0,recv_msg_ts:r.recv_msg_ts,fwd_msg_ts:r.fwd_msg_ts,reply_ack_ts:Date.now(),cur_dst_uid:i.userId,config_version:"",req_ts:0,send_ts:0,ack_ts:0})}}},mh=function(){function e(t){nK(this,e),nQ(this,"_timer",void 0),nQ(this,"userMessage",{}),nQ(this,"roomMessage",{}),this.id=t,this._setTimer()}return nY(e,[{key:"_setTimer",value:function(){var e=this;!function t(){e._reportAndgReset(),clearTimeout(e._timer),e._timer=setTimeout(t,1e4)}()}},{key:"_reportAndgReset",value:function(){(cG(this.userMessage).length||cG(this.roomMessage).length)&&(this._report(),this._reset())}},{key:"_report",value:function(){var e,t,r,i=this;null===(e=mS(this.id))||void 0===e||e.report("rtc_message_statistics",{dc_user_message:sU(t=cG(this.userMessage)).call(t,function(e){return i.userMessage[e]}),dc_room_message:sU(r=cG(this.roomMessage)).call(r,function(e){return i.roomMessage[e]}),media_server_ip:""})}},{key:"_reset",value:function(){this.userMessage={},this.roomMessage={}}},{key:"_checkInitUserMessage",value:function(e,t){var r,i;this.userMessage[sN(r="".concat(t,"-")).call(r,e)]||(this.userMessage[sN(i="".concat(t,"-")).call(i,e)]={dc_peer_user_id:e,dc_send_total:0,dc_recv_total:0,dc_send_ack:0,dc_send_fail:0,dc_fail_timeout:0,dc_fail_no_receiver:0,dc_fail_no_relay_path:0,dc_cost_time:0,dc_cost_e2s:0,dc_cost_s2s:0,dc_least_time:Number(1/0),dc_most_time:0,dc_cost_peer_s2e:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_message_type:t,dc_send_binary:0})}},{key:"_sendUserMessage",value:function(e,t,r){var i,n;this._checkInitUserMessage(e,t),this.userMessage[sN(i="".concat(t,"-")).call(i,e)].dc_send_total++,r&&this.userMessage[sN(n="".concat(t,"-")).call(n,e)].dc_send_binary++}},{key:"_recvUserMessage",value:function(e,t){var r;this._checkInitUserMessage(e,t),this.userMessage[sN(r="".concat(t,"-")).call(r,e)].dc_recv_total++}},{key:"_sendUserFail",value:function(e,t,r){var i,n=this.userMessage[sN(i="".concat(t,"-")).call(i,e)];n&&(n.dc_send_fail++,this._handleUserFail(n,r))}},{key:"_handleUserFail",value:function(e,t){var r;t&&(t.code||t.err)&&(cd(r=["TIME_OUT","USER_MESSAGE_TIMEOUT"]).call(r,t.code)?e.dc_fail_timeout++:3===t.err?e.dc_fail_no_receiver++:4===t.err?e.dc_fail_no_relay_path++:1===t.err&&e.dc_fail_timeout++)}},{key:"_sendUserAck",value:function(e,t,r,i,n){var o,a=this.userMessage[sN(o="".concat(t,"-")).call(o,e)];a&&(a.dc_send_ack++,a.dc_cost_time+=r,a.dc_cost_s2s+=i||0,a.dc_cost_peer_s2e+=n,a.dc_cost_e2s+=r-(i||0)-n,r/2<=100?(a.dc_send_ack_100++,a.dc_send_ack_200++,a.dc_send_ack_400++,a.dc_send_ack_1s++):r/2<=200?(a.dc_send_ack_200++,a.dc_send_ack_400++,a.dc_send_ack_1s++):r/2<=400?(a.dc_send_ack_400++,a.dc_send_ack_1s++):r/2<=1e3&&a.dc_send_ack_1s++,r<a.dc_least_time&&(a.dc_least_time=r),r>a.dc_most_time&&(a.dc_most_time=r))}},{key:"sendRoomMessage",value:function(e,t){this.roomMessage[e]||(this.roomMessage[e]={dc_room_id:e,dc_send_total:0,dc_send_ack:0,dc_cost_time:0,dc_least_time:Number(1/0),dc_most_time:0,dc_send_fail:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_send_binary:0}),this.roomMessage[e].dc_send_total++,t&&this.roomMessage[e].dc_send_binary++}},{key:"sendRoomFail",value:function(e){var t=this.roomMessage[e];t&&t.dc_send_fail++}},{key:"sendRoomAck",value:function(e,t){var r=this.roomMessage[e];r&&(r.dc_send_ack++,r.dc_cost_time+=t,t<r.dc_least_time&&(r.dc_least_time=t),t>r.dc_most_time&&(r.dc_most_time=t),t/2<=100?(r.dc_send_ack_100++,r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t/2<=200?(r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t/2<=400?(r.dc_send_ack_400++,r.dc_send_ack_1s++):t/2<=1e3&&r.dc_send_ack_1s++)}},{key:"sendP2PMessage",value:function(e,t){this._sendUserMessage(e,"p2p",t)}},{key:"recvP2PMessage",value:function(e){this._recvUserMessage(e,"p2p")}},{key:"sendP2PFail",value:function(e,t){this._sendUserFail(e,"p2p",t)}},{key:"sendP2PAck",value:function(e,t,r,i){this._sendUserAck(e,"p2p",t,r,i)}},{key:"sendP2POutRoomMessage",value:function(e,t){this._sendUserMessage(e,"p2p_outside_room",t)}},{key:"recvP2POutRoomMessage",value:function(e){this._recvUserMessage(e,"p2p_outside_room")}},{key:"sendP2POutRoomFail",value:function(e,t){this._sendUserFail(e,"p2p_outside_room",t)}},{key:"sendP2POutRoomAck",value:function(e,t,r,i){this._sendUserAck(e,"p2p_outside_room",t,r,i)}},{key:"sendP2serverMessage",value:function(e){this._sendUserMessage("","p2server",e)}},{key:"sendP2serverFail",value:function(e){this._sendUserFail("","p2server",e)}},{key:"sendP2serveAck",value:function(e,t,r){this._sendUserAck("","p2server",e,t,r)}},{key:"countP2PMessage",value:function(e,t,r,i,n){this.sendP2PMessage(t,r),e?this.sendP2PAck(t,Date.now()-i,n.s2s_time||0,n.s2e_time||0):this.sendP2PFail(t,n)}},{key:"countRoomMessage",value:function(e,t,r,i){this.sendRoomMessage(t,r),e?this.sendRoomAck(t,Date.now()-i):this.sendRoomFail(t)}},{key:"countUserMessageOutsideRoom",value:function(e,t,r,i,n){this.sendP2POutRoomMessage(t,r),e?this.sendP2POutRoomAck(t,Date.now()-i,n.s2s_time,n.s2e_time):this.sendP2POutRoomFail(t,n)}},{key:"countServerMessage",value:function(e,t,r,i){this.sendP2serverMessage(t),e?(i=i||{},this.sendP2serveAck(Date.now()-r,i.s2s_time||0,i.s2e_time||0)):this.sendP2serverFail(i)}},{key:"destroy",value:function(){this._reset(),clearTimeout(this._timer)}}]),e}(),mp=function(e){ms.setCommonStats(e)},mf=function(e){ms.setUrl(e)},m_=new mc("global"),mA=function(e,t,r){m_.report("rtc_sdk_api_call",{sdk_api_name:e,error_code:t,message:r})},mm=function(e,t,r){m_.report("rtc_sdk_callback",{sdk_callback_name:e,error_code:t,message:r})},mv=function(e,t,r){m_.report("rtc_error",{message:e,error_code:t},r)},mE=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4?arguments[4]:void 0;m_.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:i,elapse:0},n)},mg=new d9,mS=function(e){return mg.get(e)},mb=function(e,t){var r=new mc(e);return r.set(l9(l9({},t),{},{engine_session_id:f2()})),r.report("sdk_init_engine",{start:Date.now(),type:"begin"}),mg.set(e,r),r},mT=function(e){e.report("sdk_init_engine",{start:Date.now(),type:"end"}),mg.delete(e.id)},my=new d9;function mR(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t=uo({debounce:0},t),i=r.debounce,n=r.debounceTag;function o(e,t,r,n){if(!i)return t.apply(void 0,le(r));var o,a=sN(o="".concat(n,"_")).call(o,e);clearTimeout(my.get(a));var s=setTimeout(function(){t.apply(void 0,le(r))},i);my.set(a,s)}return function(t,r,i){if("function"==typeof i.value){var a=i.value;i.value=function(){for(var t,i,s=arguments.length,c=Array(s),d=0;d<s;d++)c[d]=arguments[d];var u,l,h=this.engineId||this.id,p={};e.forEach(function(e,t){p[e]=c[t]}),"joinRoom"===r&&(null===(u=mS(h))||void 0===u||u.set({room_id:c[1],user_id:null===(l=c[2])||void 0===l?void 0:l.userId}));var f,_="";if(n)try{_=n.apply(void 0,c)}catch(e){}o(r,mC,[h,r,c,p],"start_".concat(_));try{f=a.apply(this,c)}catch(e){throw o(r,mk,[h,r,e.message,e.code||-1],"end_".concat(_)),e}return"function"==typeof(null===(t=f)||void 0===t?void 0:t.then)?f.then(function(e){return o(r,mk,[h,r,[null!=e?e:{}]],"end_".concat(_)),e}).catch(function(e){throw o(r,mk,[h,r,e.message,e.code],"end_".concat(_)),e}):(o(r,mk,[h,r,[null!==(i=f)&&void 0!==i?i:{}]],"end_".concat(_)),f)}}}}var mI,mC=function(e,t,r,i){var n,o={sdk_api_name:t,message:sD(mO(r)),error_code:0};null===(n=mS(e))||void 0===n||n.report("rtc_sdk_api_call",o,i)},mk=function(e,t,r){var i,n=arguments.length>4?arguments[4]:void 0,o={sdk_callback_name:t,error_code:arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,message:sD(Array.isArray(r)?mO(r):r)};n&&(o.room_id=n),null===(i=mS(e))||void 0===i||i.report("rtc_sdk_callback",o)},mw=function(e,t,r){var i,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;null===(i=mS(e))||void 0===i||i.report("rtc_invoke_status",{sdk_api_name:t,message:r,error_code:n,stream_id:o,elapse:0},a)};function mO(e){return sU(e).call(e,function e(t){var r;if(null!=t&&t._reportName)return t._reportName;if(t instanceof HTMLElement)return t.toString();if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var i,n,o=ArrayBuffer.isView(t)?t.buffer:t,a=o.byteLength,s=[];if(a>10){var c,d,u,l,h,p=new DataView(o),f=sU(c=pZ({length:5})).call(c,function(e,t){return p.getUint8(t)}),_=sU(d=p$(u=sU(l=pZ({length:5})).call(l,function(e,t){return a-1-t})).call(u)).call(d,function(e){return p.getUint8(e)});s=sN(h=[]).call(h,le(f),["..."],le(_))}else s=pZ(new Uint8Array(o));return sN(i=sN(n="".concat(t.constructor.name,"(")).call(n,a,") [")).call(i,s.join(", "),"]")}if(t instanceof ImageData)return"ImageData";if(Array.isArray(t))return sU(t).call(t,e);if(cd(r=["[object Object]","[object MediaStreamTrack]"]).call(r,Object.prototype.toString.call(t))){var A={};for(var m in t)A[m]=e(t[m]);return A}return t instanceof Function?"[User Function]":t})}var mN="undefined"!=typeof window&&cd(mI=window.location.search).call(mI,"_rtc_upload_console_"),mP=function(){function e(){var t=this;nK(this,e),nQ(this,"name","ConsoleReportor"),nQ(this,"_uuid","".concat(Math.floor(899*Math.random())+100)),nQ(this,"_consoleReportId",0),nQ(this,"_engineReportIdMap",new d9),nQ(this,"_enabled","NULL"),nQ(this,"_consoleCutLength",_c.getParameter("UPLOAD_CONSOLE_LENGTH_CUT")),nQ(this,"buffer",[]),mN&&setTimeout(function(){t.switchOn()},0),_c.on("UPLOAD_CONSOLE_ON",function(e){e?t.switchOn():t.turnOff()}),_c.on("UPLOAD_CONSOLE_LENGTH_CUT",function(e){t._consoleCutLength=e})}return nY(e,[{key:"enabled",get:function(){return"OFF"!==this._enabled}},{key:"switchOn",value:function(){"NULL"===this._enabled&&(console.log("[LoggerReportor.constructor] console upload switch ON"),this._enabled="ON")}},{key:"turnOff",value:function(){"NULL"===this._enabled&&(console.log("[LoggerReportor.constructor] console upload switch OFF"),this._enabled="OFF",this.buffer=[])}},{key:"getEngineConsoleId",value:function(e){var t,r=null!==(t=this._engineReportIdMap.get(e))&&void 0!==t?t:0;return this._engineReportIdMap.set(e,r+1),r}},{key:"report",value:function(e,t,r,i,n,o,a,s,c){var d,u,l,h,p,f,_,A,m,v,E,g=this;if("OFF"!==this._enabled){var S,b=mS(t),T=this._consoleReportId++,y=this.getEngineConsoleId(t),R=mD(c,this._consoleCutLength),I=le(c),C="".concat(s).replace(/%o|%s/gi,function(){return mD([I.shift()],g._consoleCutLength)}),k=sN(d=sN(u=sN(l=sN(h=sN(p=sN(f=sN(_=sN(A=sN(m=sN(v=sN(E="[".concat(this._uuid,"-")).call(E,T,"][")).call(v,t,"-")).call(m,y,"]-")).call(A,r,"-")).call(_,e,"[")).call(f,i,"]")).call(p,n,"[")).call(h,o,".")).call(l,a,"] ")).call(u,C," ")).call(d,R);b?b.reportLog(k):(S=k,m_.reportLog(S))}}},{key:"push",value:function(e){"OFF"!==this._enabled&&this.buffer.push(e)}},{key:"splice",value:function(e){if("ON"!==this._enabled)return{payload:[],payloadSize:0};var t,r=function(e,t){for(var r=0,i=0;i<e.length;i++){var n=sD(e[i]).length;if((r+=n)>t)return{index:i,size:r-n}}return{index:e.length,size:r}}(this.buffer,e),i=r.index,n=r.size;return{payload:uH(t=this.buffer).call(t,0,i),payloadSize:n}}},{key:"unshift",value:function(e){this.buffer=sN(e).call(e,this.buffer)}},{key:"get",value:function(){return this.buffer}},{key:"set",value:function(e){this.buffer=sN(e).call(e,this.buffer)}},{key:"isEmpty",value:function(){return"OFF"===this._enabled||0===this.buffer.length}}]),e}();function mD(e,t){return sU(e).call(e,function(e){var r="";try{if("string"==typeof e)return e;if(void 0===e)return"undefined";if(null===e)return"null";if(e instanceof MediaStreamTrack)return f6(e);if(e instanceof MediaStream)return f3(e);if(e instanceof RTCRtpSender)return f8(e);if(e instanceof RTCRtpReceiver)return f5(e);if(e instanceof RTCRtpTransceiver)return f9(e);r=sD(e)}catch(t){r=e.toString()}return r&&r.length>=t&&(r=uk(r).call(r,0,t)),r}).join(", ")}var mL,mM,mx,mU,mB,mV,mF,mj,mG,mW,mH,mY=new mP,mK="[VERTC]",mQ="#0050b3",mz=(nQ(mL={},"DEBUG","rgba(0, 0, 0, 0)"),nQ(mL," INFO","rgba(93, 173, 226, 0)"),nQ(mL," WARN","rgba(255, 119, 0, 0.3)"),nQ(mL,"ERROR","rgba(255, 0, 0, 0.3)"),nQ(mL," SUCC","rgba(0, 119, 0, 0.3)"),mL),mX="undefined"!=typeof window&&(cd(mM=window.location.search).call(mM,"_rtc_debug_")||(null===(mx=window.localStorage)||void 0===mx?void 0:mx.getItem("_rtc_debug_"))),mJ=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"global";nK(this,e),nQ(this,"indent",void 0),nQ(this,"module",void 0),nQ(this,"_engineId",void 0),this.module=t,this.indent=r,this._engineId=i}return nY(e,[{key:"_print",value:function(e,t){for(var r,i,n,o,a,s,c,d,u=arguments.length,l=Array(u>2?u-2:0),h=2;h<u;h++)l[h-2]=arguments[h];var p=l.shift();try{var f,_,A,m,v=sN(f=[]).call(f,l),E="".concat(p).replace(/%o/gi,function(){var e=v.shift();return sD(e)});_t.set(sN(_=sN(A=sN(m="".concat(mK,"[").concat(this.module,".")).call(m,t,"] ")).call(A,E," ")).call(_,sU(v).call(v,function(e){return sD(e)}).join(", ")))}catch(e){}for(var g="",S=0;S<this.indent;S++)g+="    ";var b=mq();mY.report(mK,this._engineId,b,e,g,this.module,t,p,l),mX&&(r=console).log.apply(r,sN(i=[sN(n=sN(o=sN(a=sN(s=sN(c=sN(d="%c".concat(b,"-")).call(d,mK,"%c[")).call(c,e,"]%c")).call(s,g,"[")).call(a,this.module,".")).call(o,t,"] ")).call(n,p),"color:".concat(mQ,";"),"background-color:".concat(mz[e],";"),"color:".concat(mQ,";")]).call(i,l))}},{key:"print",value:function(e){for(var t,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this._print.apply(this,sN(t=[" INFO",e]).call(t,i))}},{key:"debug",value:function(e){for(var t,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this._print.apply(this,sN(t=["DEBUG",e]).call(t,i))}},{key:"info",value:function(e){for(var t,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this._print.apply(this,sN(t=[" INFO",e]).call(t,i))}},{key:"warn",value:function(e){for(var t,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this._print.apply(this,sN(t=[" WARN",e]).call(t,i))}},{key:"error",value:function(e){for(var t,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this._print.apply(this,sN(t=["ERROR",e]).call(t,i))}},{key:"success",value:function(e){for(var t,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this._print.apply(this,sN(t=[" SUCC",e]).call(t,i))}}]),e}(),mq=function(){var e,t,r=new Date;return sN(e="".concat(r.toTimeString().split(" ")[0],":")).call(e,_o(t=r.getMilliseconds().toString()).call(t,3,"0"))},mZ=function(e){var t,r,i=mS(e.engineId),n={keys:fX(e),labelSelector:"",sdkVersion:e.sdkVersion,deviceType:"web",appId:e.appId,deviceId:e.deviceId},o=sU(r=e.requestDomains).call(r,function(e){return"https://".concat(e,"/decision/v1/multi")});null==i||i.report("rtc_get_config",{error_code:0,message:sD(n),elapse:0,host:o.join(","),type:"request",config_id:"",enable_cloud_proxy:!1});var a=sU(o).call(o,(t=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"POST",body:sD(n)}).then(function(e){return e.json()});case 2:return i=e.sent,e.abrupt("return",{result:i,index:r});case 4:case"end":return e.stop()}},e)})),function(e,r){return t.apply(this,arguments)}));return new sP(function(e){var t;(t=a,new sP(function(e,r){var i=(t=Array.isArray(t)?t:[]).length,n=[];0===i?r([]):t.forEach(function(t){t.then(function(t){e(t)},function(e){i--,n.push(e),0===i&&r(n)})})})).then(function(t){var r=t.result,n=t.index;null==i||i.report("rtc_get_config",{error_code:200,message:sD(r),elapse:0,host:o[n],type:"response",config_id:"",enable_cloud_proxy:!1}),e(r)}).catch(function(e){var t;null==i||i.report("rtc_get_config",{error_code:500,message:null===(t=e[0])||void 0===t?void 0:t.message,elapse:0,host:"",type:"response",config_id:"",enable_cloud_proxy:!1})})})},m$=function(){return"undefined"==typeof window},m0=m$()?"":window.navigator.userAgent;function m2(){var e="none";return m$()||(null!==m0.match("Firefox")?e="mozilla":null!==m0.match("Chrome")?(e="chrome-stable",null!==m0.match("Electron")&&(e="electron")):(null!==m0.match("Safari")||null!==m0.match("AppleWebKit"))&&(e="safari")),e}var m1,m4="mozilla"===m2(),m6="safari"===m2(),m3="chrome-stable"===m2(),m8=!m$()&&/CriOS/i.test(m0),m5=!m$()&&/Edg\//i.test(m0),m9=!m$()&&/EdgA/i.test(m0),m7=!m$()&&/EdgiOS/i.test(m0),ve=m5||m9||m7,vt=!m$()&&/DingTalk/i.test(navigator.userAgent),vr=!m$()&&/OPR\//.test(navigator.userAgent),vi=!m$()&&(!!/(iPad)/i.exec(m0)||/Macintosh/i.test(m0)&&"ontouchend"in document),vn=!m$()&&/Macintosh/i.test(m0),vo=!m$()&&/MicroMessenger/i.test(m0),va=!m$()&&cd(mU=m0.toLowerCase()).call(mU,"mobile"),vs=!m$()&&!!/(iPhone|iPad|iPod)/i.exec(m0),vc=!m$()&&/Android/i.test(m0),vd=!m$()&&/Windows/i.test(m0),vu=!m$()&&/OpenHarmony/i.test(m0),vl=0,vh="0",vp=!m$()&&(null===(mB=m0.match(/version\/(\d+)/i))||void 0===mB?void 0:mB[1]);m6&&vp&&(vl=Number(vp),vh=null===(m1=navigator.userAgent.match(/version\/(\d+\.\d+)/i))||void 0===m1?void 0:m1[1]);var vf=!m$()&&(null===(mV=m0.match(/Firefox\/(\d+)/i))||void 0===mV?void 0:mV[1]);m4&&vf&&(vl=Number(vf));var v_=vl,vA=vl,vm=vh,vv=null!==(mF=!m$()&&(null===(mj=m0.match(/ ([\d_]+) like Mac OS X/i))||void 0===mj||null===(mG=mj[1])||void 0===mG?void 0:sU(mW=mG.split("_")).call(mW,function(e){return di(e)})))&&void 0!==mF?mF:[],vE=0,vg=!m$()&&(null===(mH=m0.match(/Chrome\/(\d+)/i))||void 0===mH?void 0:mH[1]);vg&&(vE=Number(vg));var vS=vE,vb="VolcEngine",vT="RTC_DEVICE_ID",vy="RTC_ACCESS_NODE",vR="RTC_ACCESS_URLS",vI="ENGINE_WEB_CONFIG",vC="SERVER_CONFIG",vk=function(){function e(){nK(this,e)}return nY(e,[{key:"get",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{var r=JSON.parse(t);return r.ttl>0&&Date.now()-r.saveTime>r.ttl?(this.delete(e),null):r.message}catch(e){return null}}},{key:"set",value:function(e,t){var r={ttl:arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,saveTime:Date.now(),message:t};try{return localStorage.setItem(e,sD(r)),!0}catch(e){return!1}}},{key:"getTtl",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{return JSON.parse(t).ttl}catch(e){return null}}},{key:"delete",value:function(e){try{return localStorage.removeItem(e),!0}catch(e){return!1}}}]),e}(),vw=new(function(e){hA(r,vk);var t=hI(r);function r(){return nK(this,r),t.apply(this,arguments)}return nY(r,[{key:"getDeviceId",value:function(){if(m$())return"";var e=this.get(vT);return e&&!/^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$/.test(e)||(e=function(e){for(var t="",r=0;r<e;r++)t+=Math.floor(10*Math.random());return t}(16)),this.setDeviceId(e),e}},{key:"setDeviceId",value:function(e){return mp({device_id:e}),this.set(vT,e),e}},{key:"getAccessNode",value:function(e){var t;return this.get(sN(t="".concat(vy,"_").concat(e,"-")).call(t,vb))}},{key:"setAccessNode",value:function(e,t,r){var i;return this.set(sN(i="".concat(vy,"_").concat(e,"-")).call(i,vb),t,1e3*r)}},{key:"deleteAccessNode",value:function(e,t){var r,i=this.getAccessNode(e),n=this.getTtl(sN(r="".concat(vy,"_").concat(e,"-")).call(r,vb));Array.isArray(i)&&i.length>0&&((i=s8(i).call(i,function(e){return e.mediaID!==t.mediaID&&e.msgKey!==t.msgKey})).length>0?this.setAccessNode(e,i,n||0):this.clearAccessNode(e))}},{key:"clearAccessNode",value:function(e){var t;if(e)this.delete(sN(t="".concat(vy,"_").concat(e,"-")).call(t,vb));else for(var r in localStorage)h4(r).call(r,vy)&&localStorage.removeItem(r)}},{key:"getAccessUrls",value:function(){return this.get("".concat(vR,"-").concat(vb))}},{key:"setAccessUrls",value:function(e){var t=sU(e).call(e,function(e){var t,r=e.host,i=e.path;return sN(t="https://".concat(r)).call(t,i)});return this.set("".concat(vR,"-").concat(vb),t)}},{key:"clearAccessUrls",value:function(){this.delete("".concat(vR,"-").concat(vb))}},{key:"getEngineWebConfig",value:function(e,t){var r,i,n,o=sN(r=sN(i="".concat(e,"_")).call(i,t,"_")).call(r,this.getDeviceId()),a=this.get(vI);return(null==a||null===(n=uC(a).call(a,function(e){return e.key===o}))||void 0===n?void 0:n.config)||{}}},{key:"setEngineWebConfig",value:function(e,t,r){var i,n;if(r){var o=sN(i=sN(n="".concat(e,"_")).call(n,t,"_")).call(i,this.getDeviceId()),a=this.get(vI)||[];return(a=s8(a).call(a,function(e){return e.key!==o})).push({key:o,config:r}),this.set(vI,uk(a).call(a,-5))}}},{key:"getServerConfig",value:function(e){var t,r="".concat(e),i=this.get(vC);return(null==i||null===(t=uC(i).call(i,function(e){return e.key===r}))||void 0===t?void 0:t.config)||{}}},{key:"setServerConfig",value:function(e,t){if(t){var r="".concat(e),i=this.get(vC)||[];return(i=s8(i).call(i,function(e){return e.key!==r})).push({key:r,config:t}),this.set(vC,uk(i).call(i,-5))}}}]),r}()),vO=new mJ("JoinRoomConfig",0),vN=function(){function e(t){var r;nK(this,e),nQ(this,"_useTcpAfterJoinTimeout",e.DEFAULT_CONF.useTcpAfterJoinTimeout),nQ(this,"_joinWithTcpOnly",e.DEFAULT_CONF.joinWithTcpOnly),nQ(this,"_joinWithTcpOnlyDelay",e.DEFAULT_CONF.joinWithTcpOnlyDelay),nQ(this,"_blackBrowserRegexList",[]),this._engineId=t,ux(r=location.search).call(r,"__rtc_tcp_only__")>-1&&(this._joinWithTcpOnly=!0,this._joinWithTcpOnlyDelay=0),this._report()}return nY(e,[{key:"useTcpAfterJoinTimeout",get:function(){return this._useTcpAfterJoinTimeout}},{key:"useTcpJoin",get:function(){return this._joinWithTcpOnly}},{key:"useTcpJoinDelay",get:function(){return this._joinWithTcpOnlyDelay}},{key:"isBlackBrower",value:function(){var e;return uC(e=this._blackBrowserRegexList).call(e,function(e){return new RegExp(e).test(navigator.userAgent)})}},{key:"setServerConfig",value:function(e){var t,r,i,n=!1;"boolean"==typeof(null==e||null===(t=e.use_tcp_after_join_timeout)||void 0===t?void 0:t.enable)&&(this._useTcpAfterJoinTimeout=e.use_tcp_after_join_timeout.enable,n=!0),"boolean"==typeof(null==e||null===(r=e.join_with_tcp_only)||void 0===r?void 0:r.enable)&&(this._joinWithTcpOnly=e.join_with_tcp_only.enable,n=!0),"number"==typeof(null==e||null===(i=e.join_with_tcp_only)||void 0===i?void 0:i.delay_ms)&&(this._joinWithTcpOnlyDelay=e.join_with_tcp_only.delay_ms,n=!0),e&&Array.isArray(e.black_browser_regex_list)&&(this._blackBrowserRegexList=e.black_browser_regex_list,n=!0),n&&this._report()}},{key:"toString",value:function(){return sD({use_tcp_after_join_timeout:this._useTcpAfterJoinTimeout,join_with_tcp_only:this._joinWithTcpOnly,join_with_tcp_only_delay:this._joinWithTcpOnlyDelay,black_browser_regex_list:this._blackBrowserRegexList})}},{key:"_report",value:function(){vO.print("_report",this.toString()),mw(this._engineId,"web_join_room_config",this.toString())}}],[{key:"setDefaulConf",value:function(t){var r=t.useTcpAfterJoinTimeout,i=t.joinWithTcpOnly,n=t.joinWithTcpOnlyDelay;return"boolean"==typeof r&&(e.DEFAULT_CONF.useTcpAfterJoinTimeout=r),"boolean"==typeof i&&(e.DEFAULT_CONF.joinWithTcpOnly=i),"number"==typeof n&&(e.DEFAULT_CONF.joinWithTcpOnlyDelay=Math.max(0,n)),e.DEFAULT_CONF}}]),e}();nQ(vN,"DEFAULT_CONF",{useTcpAfterJoinTimeout:!0,joinWithTcpOnly:!1,joinWithTcpOnlyDelay:5e3});var vP=((vG=vP||{})[vG.NONE=0]="NONE",vG),vD="rtc-access-ag.bytedance.com,rtc-access.bytedance.com,rtc-access2-hl.bytedance.com,rtcg-access.bytevcloud.com".split(",");function vL(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://".concat(e)),"".concat(e,"/dispatch/v1/AccessInfo?Action=GetAccessInfo")}var vM="https://web-log-report.rtc.volcvideo.com/video/v1/webrtc_log/",vx={VERSION:"4.65.5",ICE_CONFIG_REQUEST_URLS_INTERNAL:sU(vD).call(vD,vL),ICE_CONFIG_REQUEST_URLS:[],EXPECTED_ADDR:"",LOG_SERVER_URL:vM,CONFIG_REQUEST_DOMAINS:"common.rtc.volcvideo.com,rtcg.volcvideos.com".split(","),DEVICE_ID:"",OVERSEA:!1,PLATFORM:"",PRODUCT:"",FORCE_ENABLED_REPORT_CALLBACKS:[],SKIP_WEB_AUDIO_IN_TRACK:!1,AUDIO_STALL:!0,VIDEO_STALL:!0,VIDEO_STALL_100MS:!1,STATS_SCALLBACK_SUPPORT:!0,JOIN_ROOM_CONFIG:vN.DEFAULT_CONF,SIGNAL_COMPRESSION:!0,SIGNAL_CROP_JOINROOM:!0,VIDEO_STALL_DATA:500,AUDIO_STALL_DATA:200,IOS_SAFARI_ORIENTATION:!1,BLACK_FRAME_LIFETIME:6e4,FALLBACK_ENCODE_CODEC:"",SEI_TIME_OUT:2e3,SEI_COUNT_FPS:1,PRE_ICE:!1,STATS_LOOP_INTERVAL:1e3,HIDDEN_STATS:!1,UPLOAD_REMOTE_STATS:vP.NONE,SDK_CODEC_NEGOTIATION:!0,AUDIO_CODEC:"OPUS",SKIP_SEI_FILTER:!1};function vU(e,t){var r;if(mA("setParameter",0,sN(r="key: ".concat(e,", value: ")).call(r,t)),"VERSION"!==e){if("JOIN_ROOM_CONFIG"===e)return vN.setDefaulConf(t);if("ICE_CONFIG_REQUEST_URLS"===e){var i="string"==typeof t?[t]:t;return vx.ICE_CONFIG_REQUEST_URLS=sU(i).call(i,vL),vw.clearAccessUrls(),void vw.clearAccessNode()}if("VIDEO_STALL_DATA"!==e){if("AUDIO_STALL_DATA"!==e){if("VIDEO_STALL_100MS"!==e){if("PLATFORM"!==e||"string"!=typeof t){if("PRODUCT"!==e||"string"!=typeof t){if("FORCE_ENABLED_REPORT_CALLBACKS"!==e){if("LOG_SERVER_URL"===e){var n=t===pf.overseas?"https://web-log-report.volcvideos.com/video/v1/webrtc_log/":t===pf.domestic?vM:"string"==typeof t?t:void 0;n&&(vx.LOG_SERVER_URL=n,mf(n))}else if("OVERSEA"===e)return mp({extra_is_oversea:t?"1":"0"}),void(vx.OVERSEA=t);if("CONFIG_REQUEST_DOMAINS"===e&&Array.isArray(t)&&t.length>0)vx.CONFIG_REQUEST_DOMAINS=t;else if(!("SEI_TIME_OUT"===e&&"number"!=typeof t||"SEI_COUNT_FPS"===e&&"number"!=typeof t)){if("UPLOAD_REMOTE_STATS"!==e||"string"!=typeof t){if("AINR_URLS"===e&&"string"==typeof t)try{var o=JSON.parse(t),a=o.gulpUrl,s=o.wasmUrl,c=o.type5ModelUrl,d=o.type6ModelUrl;return void(vx.AINR_URLS={gulpUrl:a,wasmUrl:s,type5ModelUrl:c,type6ModelUrl:d})}catch(e){console.error(e)}"DEVICE_ID"===e&&vw.setDeviceId(t);var u=_c.getKeys();cd(u).call(u,e)?_c.setParameter(e,t):vx[e]=t}else{var l,h,p=c_(l=sU(h=t.split(",")).call(h,function(e){return lx(e).call(e)})).call(l,function(e,t){return"video"===t?e|pa.VIDEO:"audio"===t?e|pa.AUDIO:e},vP.NONE);vx.UPLOAD_REMOTE_STATS=p}}}else{var f="string"==typeof t?[t]:t;vx.FORCE_ENABLED_REPORT_CALLBACKS=f}}else mp({product:t})}else mp({platform:t})}else vx.VIDEO_STALL_100MS=Eh()&&!!t}else vx.AUDIO_STALL_DATA=Math.max(200,Number(t))}else vx.VIDEO_STALL_DATA=Math.max(500,Number(t))}}function vB(e){return"DEVICE_ID"===e?vw.getDeviceId():vx[e]}function vV(e,t,r){var i,n,o,a,s,c,d,u,l;return{type:"publicstream",action:t,publicStreamID:e,publicStreamMeta:{audio:{},video:{fps:(null===(i=r.video)||void 0===i?void 0:i.fps)||15,bitrate:1e3*((null===(n=r.video)||void 0===n?void 0:n.kBitRate)||40),width:(null===(o=r.video)||void 0===o?void 0:o.width)||640,height:(null===(a=r.video)||void 0===a?void 0:a.height)||360},layout:{layoutMode:2,interpolationMode:(null===(s=r.layout)||void 0===s?void 0:s.interpolationMode)||pm.PREV_FRAME,canvas:{bgColor:(null===(c=r.layout)||void 0===c?void 0:c.backgroundColor)||"#000000",bgImage:(null===(d=r.layout)||void 0===d?void 0:d.backgroundImage)||""},regions:(null===(u=r.layout)||void 0===u||null===(l=u.regions)||void 0===l?void 0:sU(l).call(l,function(e){return{roomId:e.roomId,userId:e.userId,alterImage:e.alertImage||"",alpha:!e.alpha||Number(e.alpha)>1||0>=Number(e.alpha)?1:Number(e.alpha),x:!e.x||Number(e.x)>=1||0>Number(e.x)?0:Number(e.x),y:!e.y||Number(e.y)>=1||0>Number(e.y)?0:Number(e.y),w:!e.w||Number(e.w)>1||0>=Number(e.w)?1:Number(e.w),h:!e.h||Number(e.h)>1||0>=Number(e.h)?1:Number(e.h),zorder:!e.zorder||0>Number(e.zorder)||Number(e.zorder)>100?0:Number(e.zorder),renderMode:void 0===e.renderMode?1:e.renderMode,streamType:e.isScreenStream?1:0,mediaType:e.mediaType||0,sourceCrop:e.sourceCrop}}))||[]}}}}var vF=[];function vj(e){vF=e}for(var vG,vW,vH=function(e,t){var r=vF;if(r.length){var i=e[0],n=t.width||Ec(i.width),o=t.height||Ec(i.height),a=n*o;if(!(Ec(i.width)*Ec(i.height)<=a)){var s,c,d=r[0];r.forEach(function(e){var t=Ec(e.width)*Ec(e.height);s||(a<t?s=e:d=e)}),c=s&&Ec(s.width)*Ec(s.height)-a<a-Ec(d.width)*Ec(d.height)?uo({},s):uo({},d);var u=s8(e).call(e,function(e){return!(c&&Ec(e.width)*Ec(e.height)>=a)||(c.maxKbps=Math.min(e.maxKbps,c.maxKbps),!1)});return u.unshift({width:n,height:o,frameRate:t.frameRate?Math.round(t.frameRate):u[0].frameRate,maxKbps:c.maxKbps}),u}}},vY={width:640,height:480,frameRate:15,maxKbps:600},vK={width:1920,height:1080,frameRate:15,maxKbps:3e3},vQ=new Uint8Array(16),vz=[],vX=0;vX<256;++vX)vz.push(uk(v3=(vX+256).toString(16)).call(v3,1));var vJ={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},vq=new TextDecoder,vZ=new TextEncoder,v$=function(){return function(e,t,r){if(vJ.randomUUID&&!e)return vJ.randomUUID();var i=(e=e||{}).random||(e.rng||function(){if(!vW&&!(vW="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vW(vQ)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(vz[e[t+0]]+vz[e[t+1]]+vz[e[t+2]]+vz[e[t+3]]+"-"+vz[e[t+4]]+vz[e[t+5]]+"-"+vz[e[t+6]]+vz[e[t+7]]+"-"+vz[e[t+8]]+vz[e[t+9]]+"-"+vz[e[t+10]]+vz[e[t+11]]+vz[e[t+12]]+vz[e[t+13]]+vz[e[t+14]]+vz[e[t+15]]).toLowerCase()}(i)}()},v0=function(){return Date.now()};function v2(e){for(var t=0,r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(var o=0;o<i.length;o++)t+=i[o].length;for(var a=new e(t),s=0,c=0;c<i.length;c++){var d=i[c];a.set(d,s),s+=d.length}return a}var v1=function(){var e,t;function r(){nK(this,r)}return nY(r,null,[{key:"token2auth",value:function(e,t,i,n){return n?"Bearer ".concat(n):"Basic ".concat(r.createUnsafeToken(e,t,i))}},{key:"createUnsafeToken",value:function(e,t,r){var i;return window.btoa(s8(i=[e,t,r]).call(i,function(e){return null!==e}).join(":"))}},{key:"merge",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=0,n=cb(e);i<n.length;i++){var o=sq(n[i],2),a=o[0],s=o[1];null!==s&&"object"===nF(s)?r.merge(e[a],t[a]):void 0!==t[a]&&(e[a]=t[a])}}},{key:"ab2str",value:function(e){return vq.decode(e)}},{key:"ab2obj",value:function(e){try{var t=r.ab2str(e);return JSON.parse(t)}catch(e){return{}}}},{key:"str2ab",value:function(e){return vZ.encode(e).buffer}},{key:"ab2b64str",value:(t=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new sP(function(e){var r=new FileReader;r.onload=function(){return e(r.result)},r.readAsDataURL(new Blob([t]))});case 2:return r=e.sent,e.abrupt("return",r.split(",",2)[1]);case 4:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})},{key:"b64str2ab",value:(e=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("data:application/octet;base64,".concat(t)).then(function(e){return e.arrayBuffer()}).catch(function(e){var i;throw r&&r.report("rtc_error",{error_code:2001,message:sN(i="".concat(e.message," -> ")).call(i,t)}),e}));case 1:case"end":return e.stop()}},e)})),function(t,r){return e.apply(this,arguments)})}]),r}();function v4(e){return new sP(function(t){setTimeout(t,e)})}function v6(){for(var e,t,r=Number(pX(e=uk(t="".concat(Math.random())).call(t,-7)).call(e,7,"0")).toString(2),i=pX(r).call(r,28,"1").split(""),n=[];i.length;)n.push(uH(i).call(i,0,7));return sU(n).call(n,function(e,t){return pq((t===n.length-1?"0":"1")+e.join(""),2)})}var v3,v8,v5=function(){return Math.floor(65535*Math.random())};function v9(e){return"string"==typeof e&&ux(e).call(e,"__web__rtc__rtt__")>-1}var v7=(Si=sk(sI().mark(function e(){var t,r,i,n=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]&&n[0],!v8){e.next=3;break}return e.abrupt("return",v8);case 3:return(r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"})).createDataChannel("default"),r.addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),t&&(r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"sendonly"})),e.next=10,r.createOffer();case 10:return i=e.sent,r.close(),v8=i.sdp,e.abrupt("return",i.sdp);case 14:case"end":return e.stop()}},e)})),function(){return Si.apply(this,arguments)}),Ee=function(e){return new sP(function(t,r){var i=(e=Array.isArray(e)?e:[]).length,n=[];0===i?r([]):e.forEach(function(e){e.then(function(e){t(e)},function(e){i--,n.push(e),0===i&&r(n)})})})};function Et(e){return Number(Math.max(-127,10*p6(Math.pow(e/255,2))).toFixed(2))}function Er(e){return(e&pa.AUDIO)===pa.AUDIO}function Ei(e){return(e&pa.VIDEO)===pa.VIDEO}function En(e){var t={};return cG(e).forEach(function(r){"object"===nF(e[r])?t[r]=En(e[r]):h4(r).call(r,"_")&&!vB("HIDDEN_STATS")||(t[r]=e[r])}),t}function Eo(e){return void 0===e}function Ea(e){return function(t,r,i){var n=i.value;i.value=function(){var t;console.warn(sN(t="[RTC WebSDK]: Api: ".concat(r," has been abandoned from version ")).call(t,e));for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return n.apply(this,o)}}}function Es(e){console.warn("[RTC WebSDK]: ".concat(e))}function Ec(e){return"number"==typeof e?e:"number"==typeof(null==e?void 0:e.exact)?e.exact:"number"==typeof(null==e?void 0:e.ideal)?e.ideal:"number"==typeof(null==e?void 0:e.max)?e.max:"number"==typeof(null==e?void 0:e.min)?e.min:1}var Ed=function(){function e(){nK(this,e),nQ(this,"_id",void 0),this._id=Math.ceil(Math.random()*fj)}return nY(e,[{key:"getMessageId",value:function(){return++this._id>fj&&(this._id=0),this._id}}]),e}();var Eu=((Sn=Eu||{}).onTrackEnded="onTrackEnded",Sn.onTrackMute="onTrackMute",Sn.onTrackUnmute="onTrackUnmute",Sn.onPlayerEvent="onPlayerEvent",Sn.onAutoplayFailed="onAutoplayFailed",Sn.onUserJoined="onUserJoined",Sn.onUserLeave="onUserLeave",Sn.onConnectionStateChanged="onConnectionStateChanged",Sn.onUserPublishStream="onUserPublishStream",Sn.onUserUnpublishStream="onUserUnpublishStream",Sn.onUserPublishScreen="onUserPublishScreen",Sn.onUserUnpublishScreen="onUserUnpublishScreen",Sn.onRoomMessageReceived="onRoomMessageReceived",Sn.onRoomBinaryMessageReceived="onRoomBinaryMessageReceived",Sn.onUserMessageReceived="onUserMessageReceived",Sn.onUserBinaryMessageReceived="onUserBinaryMessageReceived",Sn.onVideoFirstFrameRendered="onVideoFirstFrameRendered",Sn.onVideoFirstFrameDecoded="onVideoFirstFrameDecoded",Sn.onRemoteVideoFirstFrame="onRemoteVideoFirstFrame",Sn.onAudioFirstFrameDecoded="onAudioFirstFrameDecoded",Sn.onRemoteAudioFirstFrame="onRemoteAudioFirstFrame",Sn.onFirstPublicStreamVideoFrameRendered="onFirstPublicStreamVideoFrameRendered",Sn.onFirstPublicStreamVideoFrameDecoded="onFirstPublicStreamVideoFrameDecoded",Sn.onFirstPublicStreamAudioFrameDecoded="onFirstPublicStreamAudioFrameDecoded",Sn.onVideoDeviceStateChanged="onVideoDeviceStateChanged",Sn.onAudioDeviceStateChanged="onAudioDeviceStateChanged",Sn.onRemoteStreamStats="onRemoteStreamStats",Sn.onPublicStreamStats="onPublicStreamStats",Sn.onLocalStreamStats="onLocalStreamStats",Sn.onAudioVolumeIndication="onAudioVolumeIndication",Sn.onLocalAudioPropertiesReport="onLocalAudioPropertiesReport",Sn.onRemoteAudioPropertiesReport="onRemoteAudioPropertiesReport",Sn.onActiveSpeaker="onActiveSpeaker",Sn.onAudioPlaybackDeviceChanged="onAudioPlaybackDeviceChanged",Sn.onUserStartVideoCapture="onUserStartVideoCapture",Sn.onUserStopVideoCapture="onUserStopVideoCapture",Sn.onUserStartAudioCapture="onUserStartAudioCapture",Sn.onUserStopAudioCapture="onUserStopAudioCapture",Sn.onAutoPublishResult="onAutoPublishResult",Sn.onAutoSubscribeResult="onAutoSubscribeResult",Sn.onLiveTranscodingResult="onLiveTranscodingResult",Sn.onStreamMixingEvent="onStreamMixingEvent",Sn.onAudioPlaybackDeviceTestVolume="onAudioPlaybackDeviceTestVolume",Sn.onSEIMessageReceived="onSEIMessageReceived",Sn.onError="onError",Sn.onAudioMixingStateChanged="onAudioMixingStateChanged",Sn.onUserMessageReceivedOutsideRoom="onUserMessageReceivedOutsideRoom",Sn.onUserBinaryMessageReceivedOutsideRoom="onUserBinaryMessageReceivedOutsideRoom",Sn.onTokenWillExpire="onTokenWillExpire",Sn.onTokenPublishPrivilegeWillExpire="onTokenPublishPrivilegeWillExpire",Sn.onTokenPublishPrivilegeDidExpired="onTokenPublishPrivilegeDidExpired",Sn.onTokenSubscribePrivilegeWillExpire="onTokenSubscribePrivilegeWillExpire",Sn.onTokenSubscribePrivilegeDidExpired="onTokenSubscribePrivilegeDidExpired",Sn.onCloudProxyConnected="onCloudProxyConnected",Sn.onPushPublicStreamResult="onPushPublicStreamResult",Sn.onPublicStreamSEIMessageReceived="onPublicStreamSEIMessageReceived",Sn.onNetworkQuality="onNetworkQuality",Sn.onSimulcastSubscribeFallback="onSimulcastSubscribeFallback",Sn.onRemoteVideoSizeChanged="onRemoteVideoSizeChanged",Sn.onVideoStreamBanned="onVideoStreamBanned",Sn.onAudioStreamBanned="onAudioStreamBanned",Sn.onLocalVideoSizeChanged="onLocalVideoSizeChanged",Sn.onSubtitleStateChanged="onSubtitleStateChanged",Sn.onSubtitleMessageReceived="onSubtitleMessageReceived",Sn.onServerParamsSetResult="onServerParamsSetResult",Sn.onLocalStreamTrackChangedByExtension="onLocalStreamTrackChangedByExtension",Sn.onVendorConnectionStateChanged="onVendorConnectionStateChanged",Sn.onForwardStreamError="onForwardStreamError",Sn.onRejoinWithTcp="onRejoinWithTcp",Sn.onIceConnectWithTcp="onIceConnectWithTcp",Sn.onPublishRetry="onPublishRetry",Sn.onSubscribeRetry="onSubscribeRetry",Sn.onPublishResult="onPublishResult",Sn.onSubscribeResult="onSubscribeResult",Sn.onSEIStreamUpdate="onSEIStreamUpdate",Sn);function El(e,t){if("boolean"!=typeof e)throw new pB(h6.INVALID_PARAMS,"Invalid ".concat(t,": The value should be boolean type."))}var Eh=function(){return!f0()&&"function"==typeof HTMLVideoElement.prototype.requestVideoFrameCallback};function Ep(e,t){var r,i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(e<n||e>o||"number"!=typeof e)throw new pB(h6.INVALID_PARAMS,sN(r=sN(i="Invalid ".concat(t,": the value range is [")).call(i,n,", ")).call(r,o,"]. integer only"))}function Ef(e,t){var r,i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(null==e)throw new pB(h6.INVALID_PARAMS,"".concat(t," cannot be empty"));if(!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"string"==typeof e&&e.length<=r&&e.length>=t}(e,n,o))throw new pB(h6.INVALID_PARAMS,sN(r=sN(i="Invalid ".concat(t,": The value should be string type. Length of the string: [")).call(i,n,",")).call(r,o,"]"))}function E_(e,t,r){var i;if(!cd(r).call(r,e))throw new pB(h6.INVALID_PARAMS,sN(i="Invalid ".concat(t,": The value can only be set as ")).call(i,sD(r)))}function EA(e){if(!(e instanceof MediaStreamTrack))throw new pB(h6.INVALID_PARAMS,"Invalid track, The value should be MediaStreamTrack type.")}function Em(e,t){if(Eg(e))throw new pB(h6.INVALID_PARAMS,"Invalid ".concat(t,", should not be empty"))}function Ev(e,t){if(!(e instanceof ArrayBuffer))throw new pB(h6.INVALID_PARAMS,"Invalid ".concat(t,", should be ArrayBuffer"))}function EE(e){try{for(var t=navigator.mediaDevices.getSupportedConstraints(),r=0,i=cG(e);r<i.length;r++){var n=i[r];t[n]||delete e[n]}}catch(e){}}function Eg(e){return null==e}function ES(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._-]{1,128}$/.test(e))throw new pB(h6.INVALID_PARAMS,"The RoomId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function Eb(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._-]{1,128}$/.test(e))throw new pB(h6.INVALID_PARAMS,"The userId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function ET(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._-]{1,128}$/.test(e))throw new pB(h6.INVALID_PARAMS,"The publicStreamId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function Ey(e){Em(e,"videoPlayerOption")}function ER(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;if(!e||0===(null==e?void 0:e.byteLength))throw new pB(h6.INVALID_PARAMS,"The message cannot be empty");if((null===(t=e instanceof ArrayBuffer?e:v1.str2ab(sD(e)))||void 0===t?void 0:t.byteLength)>1024*r)throw new pB(h6.INVALID_PARAMS,"The message length must be less than ".concat(r,"K"))}function EI(e,t){if(("number"!=typeof e||Number.isNaN(e)||!(e>=1))&&!(null!=e&&e.min||null!=e&&e.max||null!=e&&e.exact||null!=e&&e.ideal))throw new pB(h6.INVALID_PARAMS,"".concat(t," is not a valid ConstrainULong"))}function EC(e){!function(e,t){if(!Array.isArray(e))throw new pB(h6.INVALID_PARAMS,"Invalid ".concat(t,", should be array"))}(e,"videoEncoderConfig");var t,r=sz(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;Em(i,"videoEncoderConfigItem"),Ep(null==i?void 0:i.maxKbps,"maxKbps"),EI(null==i?void 0:i.width,"width"),EI(null==i?void 0:i.height,"height"),EI(null==i?void 0:i.frameRate,"frameRate")}}catch(e){r.e(e)}finally{r.f()}}function Ek(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.NEGATIVE_INFINITY,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;return Ep(e,t,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),e=(e=e>r?e:r)<i?e:i}var Ew=d(lq),EO={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw TypeError("The listener must be a function");var s=new n(i,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,i,n=[];if(0===this._eventsCount)return n;for(i in e=this._events)t.call(e,i)&&n.push(r?uk(i).call(i,1):i);return Ew?sN(n).call(n,Ew(e)):n},s.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,o=i.length,a=Array(o);n<o;n++)a[n]=i[n].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,n,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,d,u=this._events[s],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,n),!0;case 5:return u.fn.call(u.context,t,i,n,o),!0;case 6:return u.fn.call(u.context,t,i,n,o,a),!0}for(d=1,c=Array(l-1);d<l;d++)c[d-1]=arguments[d];u.fn.apply(u.context,c)}else{var h,p=u.length;for(d=0;d<p;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),l){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,i);break;case 4:u[d].fn.call(u[d].context,t,i,n);break;default:if(!c)for(h=1,c=Array(l-1);h<l;h++)c[h-1]=arguments[h];u[d].fn.apply(u[d].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,i,n){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||n&&!s.once||i&&s.context!==i||a(this,o);else{for(var c=0,d=[],u=s.length;c<u;c++)(s[c].fn!==t||n&&!s[c].once||i&&s[c].context!==i)&&d.push(s[c]);d.length?this._events[o]=1===d.length?d[0]:d:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(EO);var EN=EO.exports,EP=d(EN),ED=new mJ("VERTC",0),EL=function(e){hA(i,EN.EventEmitter);var t,r=hI(i);function i(){return nK(this,i),r.apply(this,arguments)}return nY(i,[{key:"safeEmit",value:function(e){var t=this.listenerCount(e);try{for(var r,n,o=arguments.length,a=Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return(r=hf(hp(i.prototype),"emit",this)).call.apply(r,sN(n=[this,e]).call(n,a))}catch(r){return ED.error("safeEmit","safeEmit() | event listener threw an error [event:%s]:%o",e,r),console.error(r),!!t}}},{key:"asyncEmit",value:(t=sk(sI().mark(function e(t){var r,n,o,a=this,s=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=Array((r=s.length)>1?r-1:0),o=1;o<r;o++)n[o-1]=s[o];return e.next=3,sP.resolve().then(function(){try{var e,r;(e=hf(hp(i.prototype),"emit",a)).call.apply(e,sN(r=[a,t]).call(r,n))}catch(e){ED.error("safeEmit","safeEmit() | event listener threw an error [event:%s]:%o",t,e),console.error(e)}});case 3:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}]),i}(),EM=((So=EM||{})[So.BLACK=0]="BLACK",So[So.NORMAL=1]="NORMAL",So),Ex=((Sa=Ex||{}).streamRemovedBySchedule308="stream removed",Sa.clientRePublish="client republish",Sa.publishStreamFaied="publish failed",Sa.clientUnPublish="client unpublished",Sa.clientDisconnected="client disconnected",Sa.videoMuted="video muted",Sa),EU=((Ss=EU||{}).PushLimitWarn="PushLimitWarn",Ss.OTHER="OTHER",Ss),EB=((Sc=EB||{}).CHANGE_CODEC="changeCodec",Sc),EV=((Sd=EV||{}).ON_ADD_STREAM="onAddStream",Sd.ON_ADD_STREAM_LIST="onAddStreamList",Sd.ON_REMOVE_STREAM="onRemoveStream",Sd.ON_REMOVE_STREAM_LIST="onRemoveStreamList",Sd.USER_DISCONNECTION="userDisconnection",Sd.USER_DISCONNECTION_LIST="userDisconnectionList",Sd.USER_CONNECTION="userConnection",Sd.USER_CONNECTION_LIST="userConnectionList",Sd.ON_UPDATE_STREAM_ATTRIBUTES="onUpdateStreamAttributes",Sd.ON_UPDATE_ROOM_ATTRIBUTES="onUpdateRoomAttributes",Sd.ON_UPDATE_USER_ATTRIBUTES="onUpdateUserAttributes",Sd.ON_PUSH_TRACK="onPushTrack",Sd.ON_REMOVE_TRACK="onRemoveTrack",Sd.ON_CUSTOM_MESSAGE="onCustomMessage",Sd.NODE_CHANGE="nodeChange",Sd.USER_MESSAGE_RECEIVED="userMessageReceived",Sd.USER_BINARY_MESSAGE_RECEIVED="userBinaryMessageReceived",Sd.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM="userMessageReceivedOutsideRoom",Sd.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM="userBinaryMessageReceivedOutsideRoom",Sd.POST_PROCESSING_MESSAGE="postProcessingMessage",Sd.ON_USER_TOKEN_WILL_EXPIRE="onUserTokenWillExpire",Sd.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE="onTokenPublishPrivilegeWillExpire",Sd.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED="onTokenPublishPrivilegeDidExpired",Sd.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE="onTokenSubscribePrivilegeWillExpire",Sd.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED="onTokenSubscribePrivilegeDidExpired",Sd.STREAM_CONTROL_MESSAGE="streamControlMessage",Sd.ON_SPEAKER_CHANGE="onSpeakerChange",Sd.ON_STREAM_FAILED="streamFailed",Sd.ON_NOTIFY_RECONNECT="notifyReconnect",Sd.ON_FORWARD_DST_ROOM_USER_KICK="onForwardDstRoomUserKick",Sd.ENGINE_CONTROL_MESSAGE="engineControlMessage",Sd.ON_STREAM_PUSHED_BY_OTHER="onStreamPushedByOther",Sd.ON_STREAM_PULL_STATE_CHANGED="onStreamPullStateChanged",Sd),EF=((Su=EF||{}).RSCP="RSCP",Su.RTT="RTT",Su.SSC="SSC",Su),Ej=((Sl=Ej||{}).ON_CONNECTION_STATE_CHANGE="onConnectionStateChange",Sl.ON_VENDOR_CONNECTION_STATE_CHANGE="onVendorConnectionStateChange",Sl.ABNORMAL_DISCONNECTION="normalConnection",Sl.ON_RECONNECT_FAILED="onReconnectFailed",Sl.CONNECT_WITH_TCP="onIceConnectWithTcp",Sl),EG=((Sh=EG||{}).userLeave="userLeave",Sh.connectionLost="connectionLost",Sh.userDuplicateLogin="userDuplicateLogin",Sh.kickedByAdmin="kickedByAdmin",Sh.roleChanged="roleChanged",Sh.onUserTokenDidExpire="onUserTokenDidExpire",Sh),EW=((Sp=EW||{})[Sp.roomDismissByAdmin=2]="roomDismissByAdmin",Sp),EH=((Sf=EH||{})[Sf.NORMAL=0]="NORMAL",Sf[Sf.BLACK=1]="BLACK",Sf),EY=((S_=EY||{})[S_.EXTERNAL=0]="EXTERNAL",S_[S_.INTERNAL=1]="INTERNAL",S_),EK=((SA=EK||{}).AUDIO="audio",SA.VIDEO="video",SA),EQ=((Sm=EQ||{}).MAIN="main",Sm.SCREEN="screen",Sm.PUBLIC="public",Sm.VIRTUAL="virtual",Sm),Ez=function(e){hA(r,EL);var t=hI(r);function r(e,i,n){var o;return nK(this,r),nQ(he(o=t.call(this)),"trackId",v$()),nQ(he(o),"_logger",void 0),nQ(he(o),"trackInfo",void 0),nQ(he(o),"_originTrack",void 0),nQ(he(o),"_channelCount",void 0),o._ctx=e,o._logger=new mJ("Track",4,e.id),o.trackInfo=n,o._originTrack=i,o._channelCount=i.getSettings().channelCount,o}return nY(r,[{key:"dummy",get:function(){return this.trackInfo.isDummy}},{key:"virtual",get:function(){return"virtual"===this.trackInfo.streamIndex}},{key:"isScreen",get:function(){return"screen"===this.trackInfo.streamIndex}},{key:"isPublic",get:function(){return"public"===this.trackInfo.streamIndex}},{key:"sourceType",get:function(){return this.trackInfo.sourceType}},{key:"mediaType",get:function(){return this.trackInfo.mediaType}},{key:"captureSessionId",get:function(){return this.trackInfo.captureSessionId}},{key:"streamIndex",get:function(){var e=this.trackInfo.streamIndex;return"main"===e?po.STREAM_INDEX_MAIN:"screen"===e?po.STREAM_INDEX_SCREEN:void 0}},{key:"channelCount",get:function(){var e;return null!==(e=this._channelCount)&&void 0!==e?e:0}},{key:"originTrack",get:function(){return this._originTrack},set:function(e){this._originTrack=e,this._channelCount=mediaTrack.getSettings().channelCount}},{key:"logger",get:function(){return this._logger.module=this.constructor.name,this._logger}},{key:"destroy",value:function(){this._originTrack.stop()}}]),r}(),EX=function(e){hA(i,Ez);var t,r=hI(i);function i(e,t,n){var o;return nK(this,i),nQ(he(o=r.call(this,e,t,n)),"_mediaTrack",void 0),nQ(he(o),"_preProcessingTrack",void 0),nQ(he(o),"isTrackReady",void 0),nQ(he(o),"handleTrackEnded",function(){o.emit("track-ended",he(o)),o.destroy()}),nQ(he(o),"handleMute",function(){o.emit("track-mute",he(o))}),nQ(he(o),"handleUnmute",function(){o.emit("track-unmute",he(o))}),o._initListeners(),o.isTrackReady=o.generatePreProcessingTrack(),o}return nY(i,[{key:"mediaTrack",get:function(){var e;return null!==(e=this._mediaTrack)&&void 0!==e?e:this._originTrack},set:function(e){this.mediaTrack.id!==e.id&&(this._mediaTrack=e,this.isTrackReady=this.generatePreProcessingTrack())}},{key:"preprocessingTrack",get:function(){var e;return null!==(e=this._preProcessingTrack)&&void 0!==e?e:this.mediaTrack}},{key:"generatePreProcessingTrack",value:(t=sk(sI().mark(function e(){var t,r,i,n=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=null===(t=this._preProcessingTrack)||void 0===t?void 0:t.id,this._preProcessingTrack=void 0,e.prev=2,e.next=5,this._ctx.extensionManager.getPreProcessingTrack(this);case 5:(i=e.sent)instanceof MediaStreamTrack&&(this._preProcessingTrack=i,r!==this._preProcessingTrack.id&&setTimeout(function(){n.emit("needReplaceTrack")})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:case"end":return e.stop()}},e,this,[[2,9]])})),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;this._originTrack.removeEventListener("ended",this.handleTrackEnded),this._originTrack.removeEventListener("mute",this.handleMute),this._originTrack.removeEventListener("unmute",this.handleUnmute),null===(e=this._preProcessingTrack)||void 0===e||e.stop(),null===(t=this._mediaTrack)||void 0===t||t.stop(),hf(hp(i.prototype),"destroy",this).call(this)}},{key:"_initListeners",value:function(){this._originTrack instanceof MediaStreamTrack&&(this._originTrack.addEventListener("ended",this.handleTrackEnded),this._originTrack.addEventListener("mute",this.handleMute),this._originTrack.addEventListener("unmute",this.handleUnmute))}}]),i}(),EJ=function(e){hA(r,Ez);var t=hI(r);function r(e,i,n){var o;return nK(this,r),nQ(he(o=t.call(this,e,i,n)),"_mediaTrack",void 0),o._originTrack=i,o}return nY(r,[{key:"mediaTrack",get:function(){var e;return null!==(e=this._mediaTrack)&&void 0!==e?e:this._originTrack},set:function(e){this.mediaTrack.id!==e.id&&(this._mediaTrack=e)}},{key:"preprocessingTrack",get:function(){return this.mediaTrack}}]),r}();ti({global:!0,forced:h.globalThis!==h},{globalThis:h});var Eq=d(h),EZ=((Sv=EZ||{}).H264="H264",Sv.VP8="VP8",Sv.ByteVC1="ByteVC1",Sv),E$=(SE=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!m$()&&window.RTCPeerConnection&&window.RTCPeerConnection.prototype.addTransceiver&&window.RTCPeerConnection.prototype.createDataChannel){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,E9();case 5:if(e.t0=e.sent,!e.t0){e.next=10;break}return e.next=9,E5();case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 13:return e.prev=13,e.t1=e.catch(0),e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,null,[[0,13]])})),function(){return SE.apply(this,arguments)}),E0=(Sg=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,gr();case 3:if(e.t0=e.sent,!e.t0){e.next=8;break}return e.next=7,gt();case 7:e.t0=e.sent;case 8:if(!e.t0){e.next=10;break}t.push(EZ.ByteVC1);case 10:return e.next=12,E9();case 12:if(e.t1=e.sent,!e.t1){e.next=17;break}return e.next=16,E5();case 16:e.t1=e.sent;case 17:if(!e.t1){e.next=19;break}t.push(EZ.H264);case 19:return e.next=21,ge();case 21:if(e.t2=e.sent,!e.t2){e.next=26;break}return e.next=25,E7();case 25:e.t2=e.sent;case 26:if(!e.t2){e.next=28;break}t.push(EZ.VP8);case 28:return e.abrupt("return",t);case 29:case"end":return e.stop()}},e)})),function(){return Sg.apply(this,arguments)}),E2=(SS=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E0();case 2:return t=e.sent,e.abrupt("return",sU(t).call(t,function(e){return e===EZ.ByteVC1?"H265":e.toUpperCase()}));case 4:case"end":return e.stop()}},e)})),function(){return SS.apply(this,arguments)}),E1={};function E4(e){var t,r=!1,i=sz(e.split("\n"));try{for(i.s();!(t=i.n()).done;){var n=t.value;if(cd(n).call(n,"level-asymmetry-allowed=1")&&cd(n).call(n,"packetization-mode=1")&&cd(n).call(n,"profile-level-id=42e0")){r=!0;break}}}catch(e){i.e(e)}finally{i.f()}if(r){for(var o=navigator.userAgent.toLowerCase(),a=!1,s=0,c=[/miuibrowser/,/70.*HeyTapBrowser/i];s<c.length;s++)c[s].test(o)&&(a=!0);return!a}return!1}var E6=(Sb=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new RTCPeerConnection({sdpSemantics:"unified-plan"})).addTransceiver("video",{direction:t}),e.next=4,r.createOffer();case 4:return i=e.sent,r.close(),e.abrupt("return",i.sdp.toLowerCase());case 7:case"end":return e.stop()}},e)})),function(e){return Sb.apply(this,arguments)}),E3=(ST=sk(sI().mark(function e(){var t,r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E6("sendonly");case 2:if(r=e.sent,!cd(t=navigator.userAgent).call(t,"VivoBrowser")){e.next=7;break}return e.next=6,E6("sendonly");case 6:r=e.sent;case 7:return E1.h264encode=E4(r),E1.vp8encode=ux(r).call(r,"vp8")>-1,E1.h265encode=ux(r).call(r,"h265")>-1,e.abrupt("return",E1);case 11:case"end":return e.stop()}},e)})),function(){return ST.apply(this,arguments)}),E8=(Sy=sk(sI().mark(function e(){var t,r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E6("recvonly");case 2:if(r=e.sent,!cd(t=navigator.userAgent).call(t,"VivoBrowser")){e.next=7;break}return e.next=6,E6("recvonly");case 6:r=e.sent;case 7:return E1.h264decode=E4(r),E1.vp8decode=ux(r).call(r,"vp8")>-1,E1.h265decode=ux(r).call(r,"h265")>-1,e.abrupt("return",E1);case 11:case"end":return e.stop()}},e)})),function(){return Sy.apply(this,arguments)}),E5=(SR=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==E1.h264encode){e.next=9;break}return e.prev=1,e.next=4,E3();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",E1.h264encode||!1);case 10:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return SR.apply(this,arguments)}),E9=(SI=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==E1.h264decode){e.next=9;break}return e.prev=1,e.next=4,E8();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",E1.h264decode||!1);case 10:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return SI.apply(this,arguments)}),E7=(SC=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==E1.vp8encode){e.next=9;break}return e.prev=1,e.next=4,E3();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",E1.vp8encode||!1);case 10:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return SC.apply(this,arguments)}),ge=(Sk=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==E1.vp8decode){e.next=9;break}return e.prev=1,e.next=4,E8();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",E1.vp8decode||!1);case 10:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return Sk.apply(this,arguments)}),gt=(Sw=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==E1.h265encode){e.next=9;break}return e.prev=1,e.next=4,E3();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",E1.h265encode||!1);case 10:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return Sw.apply(this,arguments)}),gr=(SO=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==E1.h265decode){e.next=9;break}return e.prev=1,e.next=4,E8();case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",E1.h265decode||!1);case 10:case"end":return e.stop()}},e,null,[[1,6]])})),function(){return SO.apply(this,arguments)}),gi=function(){return"undefined"!=typeof TransformStream&&"undefined"!=typeof RTCRtpSender&&"undefined"!=typeof RTCRtpReceiver&&void 0!==RTCRtpSender.prototype.createEncodedStreams&&void 0!==RTCRtpReceiver.prototype.createEncodedStreams},gn=function(){return vn?m3&&vS>=70||m4&&vA>=80||m6&&v_>=14:vd?m3&&vS>=70||m4&&vA>=80:vs?vv[0]>=14:!(!vc&&!vu)&&m3&&vS>=86},go=m3&&vS<=114,ga=!m4||vA>=96,gs=!(m6&&v_<=14),gc=vc&&m3||vs&&(17===vv[0]||16===vv[0]),gd=void 0!==Eq&&"PressureObserver"in Eq,gu="undefined"!=typeof window&&window.Worker,gl=!(m6&&v_<=14),gh={getNalunits:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.length-e.position<4)return[];var r=e.position;return 1===e.getInt32(r)||0===e.getInt16(r)&&1===e.getInt8(r+2)?gh.getAnnexbNals(e,t):gh.getAvccNals(e,t)},getAnnexbNals:function(e,t){for(var r=[],i=gh.getHeaderPositionAnnexB(e),n=i.pos,o=n;n<e.length-4;){var a,s,c=new Uint8Array(uk(a=e.buffer).call(a,n,n+i.headerLength));i.pos===e.position&&e.skip(i.headerLength),o=(i=gh.getHeaderPositionAnnexB(e)).pos;var d={header:c,body:new Uint8Array(uk(s=e.buffer).call(s,n+c.byteLength,o)),type:-1};t?gh.analyseH265Nal(d):gh.analyseNal(d),(d.type<=9||t&&d.type<=40)&&0!==d.type&&r.push(d),e.skip(o-e.position),n=o}return r},getAvccNals:function(e,t){for(var r=[];e.position<e.length-4;){var i=e.getInt32(e.position);if(!(e.length-e.position>=i))break;var n,o,a=new Uint8Array(uk(n=e.buffer).call(n,e.position,e.position+4));e.skip(4);var s=new Uint8Array(uk(o=e.buffer).call(o,e.position,e.position+i));e.skip(i);var c={header:a,body:s,type:-1};t?gh.analyseH265Nal(c):gh.analyseNal(c),c.type<=9&&0!==c.type&&r.push(c)}return r},analyseNal:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:e.sei=!0;break;case 7:e.sps=!0;break;case 8:e.pps=!0}},analyseH265Nal:function(e){var t=(126&e.body[0])>>1;switch(e.type=t,t){case 39:case 40:e.sei=!0}},getHeaderPositionAnnexB:function(e){for(var t=e.position,r=0,i=e.length;3!==r&&4!==r&&t<i-4;)0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:1===e.getInt8(t+2)?r=3:t++:t++;return t===i-4&&(0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:t=i:(t++,0===e.getInt16(t)&&1===e.getInt8(t)?r=3:t=i)),{pos:t,headerLength:r}}},gp=function(){function e(t){nK(this,e),nQ(this,"_position",0),nQ(this,"_dataview",void 0),this._dataview=new DataView(t)}return nY(e,[{key:"length",get:function(){return this.buffer.byteLength}},{key:"buffer",get:function(){return this._dataview.buffer}},{key:"position",get:function(){return this._position},set:function(e){this._position=e}},{key:"back",value:function(e){this.position-=e}},{key:"getUint8",value:function(e){return this._dataview.getUint8(e)}},{key:"getInt8",value:function(e){return this._dataview.getInt8(e)}},{key:"getInt16",value:function(e){return this._dataview.getInt16(e)}},{key:"getUint16",value:function(e){return this._dataview.getUint16(e)}},{key:"getUint32",value:function(e){return this._dataview.getUint32(e)}},{key:"getInt32",value:function(e){return this._dataview.getInt32(e)}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),i=t%4,n=0;n<r;n++)e.readByte(this,4);i>0&&e.readByte(this,i)}},{key:"readUint8",value:function(){return e.readByte(this,1)}},{key:"readUint16",value:function(){return e.readByte(this,2)}},{key:"readUint24",value:function(){return e.readByte(this,3)}},{key:"readUint32",value:function(){return e.readByte(this,4)}},{key:"readUint64",value:function(){return e.readByte(this,8)}},{key:"readInt8",value:function(){return e.readByte(this,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}],[{key:"readByte",value:function(e,t,r){var i;switch(t){case 1:i=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:i=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw Error("not supported for readByte 3");i=e.getUint8(e.position)<<16|e.getUint8(e.position+1)<<8|e.getUint8(e.position+2);break;case 4:i=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw Error("not supported for readBody 8");i=e.getUint32(e.position)<<32|e.getUint32(e.position+4);break;default:i=""}return e.position+=t,i}}]),e}(),gf=((SN=gf||{})[SN.internal=0]="internal",SN[SN.external=1]="external",SN[SN.bypass=2]="bypass",SN),g_=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,85]),gA=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,84]),gm=new Uint8Array([31,239,3,50,242,120,76,85,169,42,161,91,75,186,22]),gv=function(e){var t,r=[],i=0,n=sz(e);try{for(n.s();!(t=n.n()).done;){var o=t.value;i>=2&&o<=3&&(r.push(3),i=0),0===o?i++:i=0,r.push(o)}}catch(e){n.e(e)}finally{n.f()}return new Uint8Array(r)},gE=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]||t.push(e[r]);return new Uint8Array(t)};function gg(e){for(var t=[];e>=255;)e-=255,t.push(255);return t.push(e),new Uint8Array(t)}function gS(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;255===e[t]&&t<e.byteLength;)t++,r+=255;return t<e.byteLength&&(r+=e[t++]),[r,t]}var gb=new Uint8Array([80,1]),gT=function(){function e(){nK(this,e)}return nY(e,null,[{key:"generateSEI",value:function(t,r){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=new Uint8Array([0,0,0,1]),a=r?gb:new Uint8Array([6]),s=new Uint8Array([5]),c=e.__uuid||(n?g_:gA),d=gg(t.byteLength+c.byteLength),u=gv(t);return new Uint8Array(sN(i=[]).call(i,le(o),le(a),le(s),le(d),le(c),le(u),[128]))}},{key:"decodeSeiBody",value:function(e,t){var r=gE(e=uk(e).call(e,0,e.length-1));if(!(r.byteLength<2)){var i=0,n=t?2:1;if(5===r[n]||100===r[n]){var o=sq(gS(r,i+=1+n),2),a=o[0],s=2,c=(i=o[1])+a;return r.byteLength>=gA.byteLength&&a>=gA.byteLength&&(uk(r).call(r,i,i+gA.byteLength).toString()===gA.toString()||uk(r).call(r,i,i+gm.byteLength).toString()===gm.toString())?(i+=gA.byteLength,s=1):r.byteLength>=gA.byteLength&&a>=gA.byteLength&&uk(r).call(r,i,i+g_.byteLength).toString()===g_.toString()&&(i+=g_.byteLength,s=0),{type:s,payload:uk(r).call(r,i,c)}}}}},{key:"parseInternalSEI",value:function(e){var t=new d9,r=0;if(0===e.type){for(;e.payload.byteLength-r>=2;){var i=sq(gS(e.payload,r),2),n=i[0];r=i[1];var o,a=sq(gS(e.payload,r),2),s=a[0];if(r=a[1],t.get(n)||!(s<=e.payload.byteLength-r))break;t.set(n,uk(o=e.payload).call(o,r,r+s)),r+=s}return t}}},{key:"makeInternalSei",value:function(e){var t,r=[],i=sz(e);try{for(i.s();!(t=i.n()).done;){var n=sq(t.value,2),o=n[0],a=n[1],s=gg(o),c=gg(a.byteLength);r.push(s,c,a)}}catch(e){i.e(e)}finally{i.f()}var d=new Uint8Array(c_(r).call(r,function(e,t){return e+t.byteLength},0));return c_(r).call(r,function(e,t){return d.set(t,e),e+t.byteLength},0),d}}]),e}();nQ(gT,"__uuid",void 0);var gy=eL("iterator"),gR=!p(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach(function(e,r){t.delete("b"),i+=r+e}),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[gy]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==i||"x"!==new URL("http://x",void 0).host}),gI=eL("iterator"),gC="URLSearchParams",gk=gC+"Iterator",gw=rj.set,gO=rj.getterFor(gC),gN=rj.getterFor(gk),gP=Object.getOwnPropertyDescriptor,gD=function(e){if(!P)return h[e];var t=gP(h,e);return t&&t.value},gL=gD("fetch"),gM=gD("Request"),gx=gD("Headers"),gU=gM&&gM.prototype,gB=gx&&gx.prototype,gV=h.RegExp,gF=h.TypeError,gj=h.decodeURIComponent,gG=h.encodeURIComponent,gW=b("".charAt),gH=b([].join),gY=b([].push),gK=b("".replace),gQ=b([].shift),gz=b([].splice),gX=b("".split),gJ=b("".slice),gq=/\+/g,gZ=[,,,,],g$=function(e){try{return gj(e)}catch(t){return e}},g0=function(e){var t,r=gK(e,gq," "),i=4;try{return gj(r)}catch(e){for(;i;){;r=gK(r,gZ[(t=i--)-1]||(gZ[t-1]=gV("((?:%[\\da-f]{2}){"+t+"})","gi")),g$)}return r}},g2=/[!'()~]|%20/g,g1={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},g4=function(e){return g1[e]},g6=function(e){return gK(gG(e),g2,g4)},g3=iZ(function(e,t){gw(this,{type:gk,iterator:og(gO(e).entries),kind:t})},"Iterator",function(){var e=gN(this),t=e.kind,r=e.iterator.next(),i=r.value;return r.done||(r.value="keys"===t?i.key:"values"===t?i.value:[i.key,i.value]),r},!0),g8=function(e){this.entries=[],this.url=null,void 0!==e&&(J(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===gW(e,0)?gJ(e,1):e:tX(e)))};g8.prototype={type:gC,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,i,n,o,a,s,c=ov(e);if(c)for(r=(t=og(e,c)).next;!(i=L(r,t)).done;){if((a=L(o=(n=og(e4(i.value))).next,n)).done||(s=L(o,n)).done||!L(o,n).done)throw gF("Expected sequence with length 2");gY(this.entries,{key:tX(a.value),value:tX(s.value)})}else for(var d in e)eI(e,d)&&gY(this.entries,{key:d,value:tX(e[d])})},parseQuery:function(e){if(e)for(var t,r,i=gX(e,"&"),n=0;n<i.length;)(t=i[n++]).length&&(r=gX(t,"="),gY(this.entries,{key:g0(gQ(r)),value:g0(gH(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],i=0;i<t.length;)gY(r,g6((e=t[i++]).key)+"="+g6(e.value));return gH(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var g5=function(){oj(this,g9);var e=gw(this,new g8(arguments.length>0?arguments[0]:void 0));P||(this.size=e.entries.length)},g9=g5.prototype;if(db(g9,{append:function(e,t){var r=gO(this);oQ(arguments.length,2),gY(r.entries,{key:tX(e),value:tX(t)}),P||this.length++,r.updateURL()},delete:function(e){for(var t=gO(this),r=oQ(arguments.length,1),i=t.entries,n=tX(e),o=r<2?void 0:arguments[1],a=void 0===o?o:tX(o),s=0;s<i.length;){var c=i[s];if(c.key!==n||void 0!==a&&c.value!==a)s++;else if(gz(i,s,1),void 0!==a)break}P||(this.size=i.length),t.updateURL()},get:function(e){var t=gO(this).entries;oQ(arguments.length,1);for(var r=tX(e),i=0;i<t.length;i++)if(t[i].key===r)return t[i].value;return null},getAll:function(e){var t=gO(this).entries;oQ(arguments.length,1);for(var r=tX(e),i=[],n=0;n<t.length;n++)t[n].key===r&&gY(i,t[n].value);return i},has:function(e){for(var t=gO(this).entries,r=oQ(arguments.length,1),i=tX(e),n=r<2?void 0:arguments[1],o=void 0===n?n:tX(n),a=0;a<t.length;){var s=t[a++];if(s.key===i&&(void 0===o||s.value===o))return!0}return!1},set:function(e,t){var r=gO(this);oQ(arguments.length,1);for(var i,n=r.entries,o=!1,a=tX(e),s=tX(t),c=0;c<n.length;c++)(i=n[c]).key===a&&(o?gz(n,c--,1):(o=!0,i.value=s));o||gY(n,{key:a,value:s}),P||(this.size=n.length),r.updateURL()},sort:function(){var e=gO(this);hk(e.entries,function(e,t){return e.key>t.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=gO(this).entries,i=eZ(e,arguments.length>1?arguments[1]:void 0),n=0;n<r.length;)i((t=r[n++]).value,t.key,this)},keys:function(){return new g3(this,"keys")},values:function(){return new g3(this,"values")},entries:function(){return new g3(this,"entries")}},{enumerable:!0}),rS(g9,gI,g9.entries,{name:"entries"}),rS(g9,"toString",function(){return gO(this).serialize()},{enumerable:!0}),P&&rb(g9,"size",{get:function(){return gO(this).entries.length},configurable:!0,enumerable:!0}),rD(g5,gC),ti({global:!0,constructor:!0,forced:!gR},{URLSearchParams:g5}),!gR&&O(gx)){var g7=b(gB.has),Se=b(gB.set),St=function(e){if(J(e)){var t,r=e.body;if(tC(r)===gC)return g7(t=e.headers?new gx(e.headers):new gx,"content-type")||Se(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ru(e,{body:j(0,tX(r)),headers:j(0,t)})}return e};if(O(gL)&&ti({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return gL(e,arguments.length>1?St(arguments[1]):{})}}),O(gM)){var Sr=function(e){return oj(this,gU),new gM(e,arguments.length>1?St(arguments[1]):{})};gU.constructor=Sr,Sr.prototype=gU,ti({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Sr})}}var Si,Sn,So,Sa,Ss,Sc,Sd,Su,Sl,Sh,Sp,Sf,S_,SA,Sm,Sv,SE,Sg,SS,Sb,ST,Sy,SR,SI,SC,Sk,Sw,SO,SN,SP,SD=/[^\0-\u007E]/,SL=/[.\u3002\uFF0E\uFF61]/g,SM="Overflow: input needs wider integers to process",Sx=35,SU=RangeError,SB=b(SL.exec),SV=Math.floor,SF=String.fromCharCode,Sj=b("".charCodeAt),SG=b([].join),SW=b([].push),SH=b("".replace),SY=b("".split),SK=b("".toLowerCase),SQ=function(e){for(var t=[],r=0,i=e.length;r<i;){var n=Sj(e,r++);if(n>=55296&&n<=56319&&r<i){var o=Sj(e,r++);56320==(64512&o)?SW(t,((1023&n)<<10)+(1023&o)+65536):(SW(t,n),r--)}else SW(t,n)}return t},Sz=function(e){return e+22+75*(e<26)},SX=function(e,t,r){var i=0;for(e=r?SV(e/700):e>>1,e+=SV(e/t);e>26*Sx>>1;)e=SV(e/Sx),i+=36;return SV(i+(Sx+1)*e/(e+38))},SJ=function(e){var t,r,i=[],n=(e=SQ(e)).length,o=128,a=0,s=72;for(t=0;t<e.length;t++)(r=e[t])<128&&SW(i,SF(r));var c=i.length,d=c;for(c&&SW(i,"-");d<n;){var u=0x7fffffff;for(t=0;t<e.length;t++)(r=e[t])>=o&&r<u&&(u=r);var l=d+1;if(u-o>SV((0x7fffffff-a)/l))throw SU(SM);for(a+=(u-o)*l,o=u,t=0;t<e.length;t++){if((r=e[t])<o&&++a>0x7fffffff)throw SU(SM);if(r===o){for(var h=a,p=36;;){var f=p<=s?1:p>=s+26?26:p-s;if(h<f)break;var _=h-f,A=36-f;SW(i,SF(Sz(f+_%A))),h=SV(_/A),p+=36}SW(i,SF(Sz(h))),s=SX(a,l,d===c),a=0,d++}}a++,o++}return SG(i,"")},Sq=nD.codeAt,SZ=function(e){var t,r,i=[],n=SY(SH(SK(e),SL,"."),".");for(t=0;t<n.length;t++)SW(i,SB(SD,r=n[t])?"xn--"+SJ(r):r);return SG(i,".")},S$=g5,S0=gO,S2=rj.set,S1=rj.getterFor("URL"),S4=h.URL,S6=h.TypeError,S3=h.parseInt,S8=Math.floor,S5=Math.pow,S9=b("".charAt),S7=b(/./.exec),be=b([].join),bt=b(1..toString),br=b([].pop),bi=b([].push),bn=b("".replace),bo=b([].shift),ba=b("".split),bs=b("".slice),bc=b("".toLowerCase),bd=b([].unshift),bu="Invalid scheme",bl="Invalid host",bh="Invalid port",bp=/[a-z]/i,bf=/[\d+-.a-z]/i,b_=/\d/,bA=/^0x/i,bm=/^[0-7]+$/,bv=/^\d+$/,bE=/^[\da-f]+$/i,bg=/[\0\t\n\r #%/:<>?@[\\\]^|]/,bS=/[\0\t\n\r #/:<>?@[\\\]^|]/,bb=/^[\u0000-\u0020]+/,bT=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,by=/[\t\n\r]/g,bR=function(e){var t,r,i,n,o,a,s,c=ba(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(r=[],i=0;i<t;i++){if(""===(n=c[i]))return e;if(o=10,n.length>1&&"0"===S9(n,0)&&(o=S7(bA,n)?16:8,n=bs(n,8===o?1:2)),""===n)a=0;else{if(!S7(10===o?bv:8===o?bm:bE,n))return e;a=S3(n,o)}bi(r,a)}for(i=0;i<t;i++)if(a=r[i],i===t-1){if(a>=S5(256,5-t))return null}else if(a>255)return null;for(s=br(r),i=0;i<r.length;i++)s+=r[i]*S5(256,3-i);return s},bI=function(e){var t,r,i,n,o,a,s,c=[0,0,0,0,0,0,0,0],d=0,u=null,l=0,h=function(){return S9(e,l)};if(":"===h()){if(":"!==S9(e,1))return;l+=2,u=++d}for(;h();){if(8===d)return;if(":"!==h()){for(t=r=0;r<4&&S7(bE,h());)t=16*t+S3(h(),16),l++,r++;if("."===h()){if(0===r||(l-=r,d>6))return;for(i=0;h();){if(n=null,i>0){if(!("."===h()&&i<4))return;l++}if(!S7(b_,h()))return;for(;S7(b_,h());){if(o=S3(h(),10),null===n)n=o;else{if(0===n)return;n=10*n+o}if(n>255)return;l++}c[d]=256*c[d]+n,2!=++i&&4!==i||d++}if(4!==i)return;break}if(":"===h()){if(l++,!h())return}else if(h())return;c[d++]=t}else{if(null!==u)return;l++,u=++d}}if(null!==u)for(a=d-u,d=7;0!==d&&a>0;)s=c[d],c[d--]=c[u+a-1],c[u+--a]=s;else if(8!==d)return;return c},bC=function(e){for(var t=null,r=1,i=null,n=0,o=0;o<8;o++)0!==e[o]?(n>r&&(t=i,r=n),i=null,n=0):(null===i&&(i=o),++n);return n>r&&(t=i,r=n),t},bk=function(e){var t,r,i,n;if("number"==typeof e){for(t=[],r=0;r<4;r++)bd(t,e%256),e=S8(e/256);return be(t,".")}if("object"==typeof e){for(t="",i=bC(e),r=0;r<8;r++)n&&0===e[r]||(n&&(n=!1),i===r?(t+=r?":":"::",n=!0):(t+=bt(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},bw={},bO=ui({},bw,{" ":1,'"':1,"<":1,">":1,"`":1}),bN=ui({},bO,{"#":1,"?":1,"{":1,"}":1}),bP=ui({},bN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),bD=function(e,t){var r=Sq(e,0);return r>32&&r<127&&!eI(t,e)?e:encodeURIComponent(e)},bL={ftp:21,file:null,http:80,https:443,ws:80,wss:443},bM=function(e,t){var r;return 2===e.length&&S7(bp,S9(e,0))&&(":"===(r=S9(e,1))||!t&&"|"===r)},bx=function(e){var t;return e.length>1&&bM(bs(e,0,2))&&(2===e.length||"/"===(t=S9(e,2))||"\\"===t||"?"===t||"#"===t)},bU={},bB={},bV={},bF={},bj={},bG={},bW={},bH={},bY={},bK={},bQ={},bz={},bX={},bJ={},bq={},bZ={},b$={},b0={},b2={},b1={},b4={},b6=function(e,t,r){var i,n,o,a=tX(e);if(t){if(n=this.parse(a))throw S6(n);this.searchParams=null}else{if(void 0!==r&&(i=new b6(r,!0)),n=this.parse(a,null,i))throw S6(n);(o=S0(new S$)).bindURL(this),this.searchParams=o}};b6.prototype={type:"URL",parse:function(e,t,r){var i,n,o,a,s=t||bU,c=0,d="",u=!1,l=!1,h=!1;for(e=tX(e),t||(this.scheme="",this.username="",this.password="",this.host=null,this.port=null,this.path=[],this.query=null,this.fragment=null,this.cannotBeABaseURL=!1,e=bn(e,bb,""),e=bn(e,bT,"$1")),i=sW(e=bn(e,by,""));c<=i.length;){switch(n=i[c],s){case bU:if(!n||!S7(bp,n)){if(t)return bu;s=bV;continue}d+=bc(n),s=bB;break;case bB:if(n&&(S7(bf,n)||"+"===n||"-"===n||"."===n))d+=bc(n);else{if(":"!==n){if(t)return bu;d="",s=bV,c=0;continue}if(t&&(this.isSpecial()!==eI(bL,d)||"file"===d&&(this.includesCredentials()||null!==this.port)||"file"===this.scheme&&!this.host))return;if(this.scheme=d,t)return void(this.isSpecial()&&bL[this.scheme]===this.port&&(this.port=null));d="","file"===this.scheme?s=bJ:this.isSpecial()&&r&&r.scheme===this.scheme?s=bF:this.isSpecial()?s=bH:"/"===i[c+1]?(s=bj,c++):(this.cannotBeABaseURL=!0,bi(this.path,""),s=b2)}break;case bV:if(!r||r.cannotBeABaseURL&&"#"!==n)return bu;if(r.cannotBeABaseURL&&"#"===n){this.scheme=r.scheme,this.path=rA(r.path),this.query=r.query,this.fragment="",this.cannotBeABaseURL=!0,s=b4;break}s="file"===r.scheme?bJ:bG;continue;case bF:if("/"!==n||"/"!==i[c+1]){s=bG;continue}s=bY,c++;break;case bj:if("/"===n){s=bK;break}s=b0;continue;case bG:if(this.scheme=r.scheme,n===SP)this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=rA(r.path),this.query=r.query;else if("/"===n||"\\"===n&&this.isSpecial())s=bW;else if("?"===n)this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=rA(r.path),this.query="",s=b1;else{if("#"!==n){this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=rA(r.path),this.path.length--,s=b0;continue}this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=rA(r.path),this.query=r.query,this.fragment="",s=b4}break;case bW:if(this.isSpecial()&&("/"===n||"\\"===n))s=bY;else{if("/"!==n){this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,s=b0;continue}s=bK}break;case bH:if(s=bY,"/"!==n||"/"!==S9(d,c+1))continue;c++;break;case bY:if("/"!==n&&"\\"!==n){s=bK;continue}break;case bK:if("@"===n){u&&(d="%40"+d),u=!0,o=sW(d);for(var p,f,_=0;_<o.length;_++){var A=o[_];if(":"!==A||h){var m=bD(A,bP);h?this.password+=m:this.username+=m}else h=!0}d=""}else if(n===SP||"/"===n||"?"===n||"#"===n||"\\"===n&&this.isSpecial()){if(u&&""===d)return"Invalid authority";c-=sW(d).length+1,d="",s=bQ}else d+=n;break;case bQ:case bz:if(t&&"file"===this.scheme){s=bZ;continue}if(":"!==n||l){if(n===SP||"/"===n||"?"===n||"#"===n||"\\"===n&&this.isSpecial()){if(this.isSpecial()&&""===d)return bl;if(t&&""===d&&(this.includesCredentials()||null!==this.port))return;if(a=this.parseHost(d))return a;if(d="",s=b$,t)return;continue}"["===n?l=!0:"]"===n&&(l=!1),d+=n}else{if(""===d)return bl;if(a=this.parseHost(d))return a;if(d="",s=bX,t===bz)return}break;case bX:if(!S7(b_,n)){if(n===SP||"/"===n||"?"===n||"#"===n||"\\"===n&&this.isSpecial()||t){if(""!==d){var v=S3(d,10);if(v>65535)return bh;this.port=this.isSpecial()&&v===bL[this.scheme]?null:v,d=""}if(t)return;s=b$;continue}return bh}d+=n;break;case bJ:if(this.scheme="file","/"===n||"\\"===n)s=bq;else{if(!r||"file"!==r.scheme){s=b0;continue}switch(n){case SP:this.host=r.host,this.path=rA(r.path),this.query=r.query;break;case"?":this.host=r.host,this.path=rA(r.path),this.query="",s=b1;break;case"#":this.host=r.host,this.path=rA(r.path),this.query=r.query,this.fragment="",s=b4;break;default:bx(be(rA(i,c),""))||(this.host=r.host,this.path=rA(r.path),this.shortenPath()),s=b0;continue}}break;case bq:if("/"===n||"\\"===n){s=bZ;break}r&&"file"===r.scheme&&!bx(be(rA(i,c),""))&&(bM(r.path[0],!0)?bi(this.path,r.path[0]):this.host=r.host),s=b0;continue;case bZ:if(n===SP||"/"===n||"\\"===n||"?"===n||"#"===n){if(!t&&bM(d))s=b0;else if(""===d){if(this.host="",t)return;s=b$}else{if(a=this.parseHost(d))return a;if("localhost"===this.host&&(this.host=""),t)return;d="",s=b$}continue}d+=n;break;case b$:if(this.isSpecial()){if(s=b0,"/"!==n&&"\\"!==n)continue}else if(t||"?"!==n){if(t||"#"!==n){if(n!==SP&&(s=b0,"/"!==n))continue}else this.fragment="",s=b4}else this.query="",s=b1;break;case b0:if(n===SP||"/"===n||"\\"===n&&this.isSpecial()||!t&&("?"===n||"#"===n)){;if(".."===(p=bc(p=d))||"%2e."===p||".%2e"===p||"%2e%2e"===p?(this.shortenPath(),"/"===n||"\\"===n&&this.isSpecial()||bi(this.path,"")):"."===(f=d)||"%2e"===bc(f)?"/"===n||"\\"===n&&this.isSpecial()||bi(this.path,""):("file"===this.scheme&&!this.path.length&&bM(d)&&(this.host&&(this.host=""),d=S9(d,0)+":"),bi(this.path,d)),d="","file"===this.scheme&&(n===SP||"?"===n||"#"===n))for(;this.path.length>1&&""===this.path[0];)bo(this.path);"?"===n?(this.query="",s=b1):"#"===n&&(this.fragment="",s=b4)}else d+=bD(n,bN);break;case b2:"?"===n?(this.query="",s=b1):"#"===n?(this.fragment="",s=b4):n!==SP&&(this.path[0]+=bD(n,bw));break;case b1:t||"#"!==n?n!==SP&&("'"===n&&this.isSpecial()?this.query+="%27":this.query+="#"===n?"%23":bD(n,bw)):(this.fragment="",s=b4);break;case b4:n!==SP&&(this.fragment+=bD(n,bO))}c++}},parseHost:function(e){var t,r,i;if("["===S9(e,0)){if("]"!==S9(e,e.length-1)||!(t=bI(bs(e,1,-1))))return bl;this.host=t}else if(this.isSpecial()){if(S7(bg,e=SZ(e))||null===(t=bR(e)))return bl;this.host=t}else{if(S7(bS,e))return bl;for(t="",r=sW(e),i=0;i<r.length;i++)t+=bD(r[i],bw);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return eI(bL,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&bM(e[0],!0)||e.length--},serialize:function(){var e=this.scheme,t=this.username,r=this.password,i=this.host,n=this.port,o=this.path,a=this.query,s=this.fragment,c=e+":";return null!==i?(c+="//",this.includesCredentials()&&(c+=t+(r?":"+r:"")+"@"),c+=bk(i),null!==n&&(c+=":"+n)):"file"===e&&(c+="//"),c+=this.cannotBeABaseURL?o[0]:o.length?"/"+be(o,"/"):"",null!==a&&(c+="?"+a),null!==s&&(c+="#"+s),c},setHref:function(e){var t=this.parse(e);if(t)throw S6(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new b3(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+bk(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(tX(e)+":",bU)},getUsername:function(){return this.username},setUsername:function(e){var t=sW(tX(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=bD(t[r],bP)}},getPassword:function(){return this.password},setPassword:function(e){var t=sW(tX(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=bD(t[r],bP)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?bk(e):bk(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,bQ)},getHostname:function(){var e=this.host;return null===e?"":bk(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,bz)},getPort:function(){var e=this.port;return null===e?"":tX(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=tX(e))?this.port=null:this.parse(e,bX))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+be(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,b$))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=tX(e))?this.query=null:("?"===S9(e,0)&&(e=bs(e,1)),this.query="",this.parse(e,b1)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=tX(e))?("#"===S9(e,0)&&(e=bs(e,1)),this.fragment="",this.parse(e,b4)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var b3=function(e){var t=oj(this,b8),r=oQ(arguments.length,1)>1?arguments[1]:void 0,i=S2(t,new b6(e,!1,r));P||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},b8=b3.prototype,b5=function(e,t){return{get:function(){return S1(this)[e]()},set:t&&function(e){return S1(this)[t](e)},configurable:!0,enumerable:!0}};if(P&&(rb(b8,"href",b5("serialize","setHref")),rb(b8,"origin",b5("getOrigin")),rb(b8,"protocol",b5("getProtocol","setProtocol")),rb(b8,"username",b5("getUsername","setUsername")),rb(b8,"password",b5("getPassword","setPassword")),rb(b8,"host",b5("getHost","setHost")),rb(b8,"hostname",b5("getHostname","setHostname")),rb(b8,"port",b5("getPort","setPort")),rb(b8,"pathname",b5("getPathname","setPathname")),rb(b8,"search",b5("getSearch","setSearch")),rb(b8,"searchParams",b5("getSearchParams")),rb(b8,"hash",b5("getHash","setHash"))),rS(b8,"toJSON",function(){return S1(this).serialize()},{enumerable:!0}),rS(b8,"toString",function(){return S1(this).serialize()},{enumerable:!0}),S4){var b9=S4.createObjectURL,b7=S4.revokeObjectURL;b9&&rS(b3,"createObjectURL",eZ(b9,S4)),b7&&rS(b3,"revokeObjectURL",eZ(b7,S4))}rD(b3,"URL"),ti({global:!0,constructor:!0,forced:!gR,sham:!P},{URL:b3});var Te=$("URL");ti({target:"URL",stat:!0,forced:!(gR&&p(function(){Te.canParse()}))},{canParse:function(e){var t=oQ(arguments.length,1),r=tX(e),i=t<2||void 0===arguments[1]?void 0:tX(arguments[1]);try{return new Te(r,i),!0}catch(e){return!1}}});var Tt,Tr,Ti=q.URL,Tn=d(Ti),To="undefined"!=typeof window&&(cd(Tt=window.location.search).call(Tt,"_rtc_debug_")||(null===(Tr=window.localStorage)||void 0===Tr?void 0:Tr.getItem("_rtc_debug_")));function Ta(e){var t=PressureObserver.supportedSources,r="thermal";r=null!=t&&cd(t).call(t,"thermal")?"thermal":"cpu",new PressureObserver(function(t){t.forEach(function(t){t.source===r&&e(t.state)})}).observe(r,{sampleInterval:2e3})}var Ts=new(function(){function e(){var t=this;if(nK(this,e),nQ(this,"_state",void 0),gd)try{if(gu){var r=new Blob(["(".concat(Ta.toString(),")(self.postMessage)")],{type:"text/javascript"});new Worker(Tn.createObjectURL(r)).onmessage=function(e){t._state=e.data}}else Ta(function(e){t._state=e})}catch(e){}}return nY(e,[{key:"state",get:function(){return To&&!f0()&&(window.thermal_status=this._state),this._state}}]),e}());dS("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},dI);var Tc=q.Set,Td=function(e){if("object"==typeof e&&"size"in e&&"has"in e&&"add"in e&&"delete"in e&&"keys"in e)return e;throw TypeError(ep(e)+" is not a set")},Tu=$("Set"),Tl=Tu.prototype,Th={Set:Tu,add:dk("add",1),has:dk("has",1),remove:dk("delete",1),proto:Tl},Tp=function(e,t,r){return r?dH(e.keys(),t,!0):e.forEach(t)},Tf=Th.Set,T_=Th.add,TA=function(e){var t=new Tf;return Tp(e,function(e){T_(t,e)}),t},Tm=function(e){return e.size},Tv="Invalid size",TE=RangeError,Tg=TypeError,TS=Math.max,Tb=function(e,t,r,i){this.set=e,this.size=t,this.has=r,this.keys=i};Tb.prototype={getIterator:function(){var e;return{iterator:e=e4(L(this.keys,this.set)),next:e.next,done:!1}},includes:function(e){return L(this.has,this.set,e)}};var TT=function(e){e4(e);var t=+e.size;if(t!=t)throw Tg(Tv);var r=tp(t);if(r<0)throw TE(Tv);return new Tb(e,TS(r,0),e_(e.has),e_(e.keys))},Ty=Th.has,TR=Th.remove,TI=function(e){var t=Td(this),r=TT(e),i=TA(t);return Tm(t)<=r.size?Tp(t,function(e){r.includes(e)&&TR(i,e)}):dH(r.getIterator(),function(e){Ty(t,e)&&TR(i,e)}),i},TC=function(){return!1};ti({target:"Set",proto:!0,real:!0,forced:!TC()},{difference:TI});var Tk=Th.Set,Tw=Th.add,TO=Th.has,TN=function(e){var t=Td(this),r=TT(e),i=new Tk;return Tm(t)>r.size?dH(r.getIterator(),function(e){TO(t,e)&&Tw(i,e)}):Tp(t,function(e){r.includes(e)&&Tw(i,e)}),i};ti({target:"Set",proto:!0,real:!0,forced:!TC()},{intersection:TN});var TP=Th.has,TD=function(e){var t=Td(this),r=TT(e);if(Tm(t)<=r.size)return!1!==Tp(t,function(e){if(r.includes(e))return!1},!0);var i=r.getIterator();return!1!==dH(i,function(e){if(TP(t,e))return oS(i,"normal",!1)})};ti({target:"Set",proto:!0,real:!0,forced:!TC()},{isDisjointFrom:TD});var TL=function(e){var t=Td(this),r=TT(e);return!(Tm(t)>r.size)&&!1!==Tp(t,function(e){if(!r.includes(e))return!1},!0)};ti({target:"Set",proto:!0,real:!0,forced:!TC()},{isSubsetOf:TL});var TM=Th.has,Tx=function(e){var t=Td(this),r=TT(e);if(Tm(t)<r.size)return!1;var i=r.getIterator();return!1!==dH(i,function(e){if(!TM(t,e))return oS(i,"normal",!1)})};ti({target:"Set",proto:!0,real:!0,forced:!TC()},{isSupersetOf:Tx});var TU=Th.add,TB=Th.has,TV=Th.remove,TF=function(e){var t=Td(this),r=TT(e).getIterator(),i=TA(t);return dH(r,function(e){TB(t,e)?TV(i,e):TU(i,e)}),i};ti({target:"Set",proto:!0,real:!0,forced:!TC()},{symmetricDifference:TF});var Tj=Th.add,TG=function(e){var t=Td(this),r=TT(e).getIterator(),i=TA(t);return dH(r,function(e){Tj(i,e)}),i};ti({target:"Set",proto:!0,real:!0,forced:!TC()},{union:TG});ti({target:"Set",stat:!0,forced:!0},{from:dU});ti({target:"Set",stat:!0,forced:!0},{of:dB});var TW=Th.add;ti({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=Td(this),t=0,r=arguments.length;t<r;t++)TW(e,arguments[t]);return e}});var TH=Th.remove;ti({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=Td(this),r=!0,i=0,n=arguments.length;i<n;i++)e=TH(t,arguments[i]),r=r&&e;return!!r}});ti({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=Td(this),r=eZ(e,arguments.length>1?arguments[1]:void 0);return!1!==Tp(t,function(e){if(!r(e,e,t))return!1},!0)}});var TY=eL("iterator"),TK=Object,TQ=function(e){if(Y(e))return!1;var t=TK(e);return void 0!==t[TY]||"@@iterator"in t||eI(ix,tC(t))},Tz=$("Set"),TX=function(e){var t;return J(t=e)&&"number"==typeof t.size&&O(t.has)&&O(t.keys)?e:TQ(e)?new Tz(e):e};ti({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){return L(TI,this,TX(e))}});var TJ=Th.Set,Tq=Th.add;ti({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=Td(this),r=eZ(e,arguments.length>1?arguments[1]:void 0),i=new TJ;return Tp(t,function(e){r(e,e,t)&&Tq(i,e)}),i}});ti({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=Td(this),r=eZ(e,arguments.length>1?arguments[1]:void 0),i=Tp(t,function(e){if(r(e,e,t))return{value:e}},!0);return i&&i.value}});ti({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){return L(TN,this,TX(e))}});ti({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){return L(TD,this,TX(e))}});ti({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){return L(TL,this,TX(e))}});ti({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){return L(Tx,this,TX(e))}});var TZ=b([].join),T$=b([].push);ti({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=Td(this),r=void 0===e?",":tX(e),i=[];return Tp(t,function(e){T$(i,e)}),TZ(i,r)}});var T0=Th.Set,T2=Th.add;ti({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=Td(this),r=eZ(e,arguments.length>1?arguments[1]:void 0),i=new T0;return Tp(t,function(e){T2(i,r(e,e,t))}),i}});var T1=TypeError;ti({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=Td(this),r=arguments.length<2,i=r?void 0:arguments[1];if(e_(e),Tp(t,function(n){r?(r=!1,i=n):i=e(i,n,n,t)}),r)throw T1("Reduce of empty set with no initial value");return i}});ti({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=Td(this),r=eZ(e,arguments.length>1?arguments[1]:void 0);return!0===Tp(t,function(e){if(r(e,e,t))return!0},!0)}});ti({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){return L(TF,this,TX(e))}});ti({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){return L(TG,this,TX(e))}});var T4=d(Tc),T6=["codec","inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp","media-source","csrc","peer-connection","data-channel","stream","track","transceiver","sender","receiver","transport","sctp-transport","candidate-pair","local-candidate","remote-candidate","certificate","ice-server"],T3=new d9,T8=!0,T5=(yy=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new sP(function(e){var r,i,n,o,a={all:[],getTrackStats:function(){return[]}},s=vB("STATS_SCALLBACK_SUPPORT");if(T8&&m3&&void 0===window.InstallTrigger&&go&&s)try{null===(r=t.getStats(function(t){var r=[];t.result().forEach(function(e){if(!cd(T6).call(T6,e.type)){var t={};e.names().forEach(function(r){t[r]=e.stat(r)}),r.push(l9(l9({},t),{},{id:e.id,type:e.type,timestamp:e.timestamp}))}}),e({all:r,getTrackStats:function(e){return s8(r).call(r,function(t){return"ssrc"!==t.type||t.googTrackId===e})}})}))||void 0===r||null===(i=r.then)||void 0===i||null===(n=i.call(r,function(){e(a)}))||void 0===n||null===(o=n.catch)||void 0===o||o.call(n,function(){T8=!1,e(a)})}catch(t){T8=!1,e(a)}else e(a)}));case 1:case"end":return e.stop()}},e)})),function(e){return yy.apply(this,arguments)}),T9=(yR=sk(sI().mark(function e(t){var r,i,n,o,a,s,c;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getStats();case 2:return i=e.sent,n={all:[]},o=new d9,i.forEach(function(e){var t=o.get(e.type)||new d9;t.set(e.id,e),o.set(e.type,t),n.all.push(e)}),a=function(e,t){e.forEach(function(e){var r,i,n,a,s,c,d=e.codecId,u=e.transportId,l=e.trackId,h=e.playoutId;if(null===(r=o.get("codec"))||void 0===r||r.forEach(function(e){e.id===d&&t.add(e)}),null===(i=o.get("transport"))||void 0===i||i.forEach(function(e){e.id===u&&(s=e,t.add(e))}),null===(n=o.get("track"))||void 0===n||n.forEach(function(e){e.id===l&&t.add(e)}),null===(a=o.get("media-playout"))||void 0===a||a.forEach(function(e){e.id===h&&t.add(e)}),s){var p,f,_=s,A=_.localCertificateId,m=_.remoteCertificateId,v=_.selectedCandidatePairId;null===(p=o.get("certificate"))||void 0===p||p.forEach(function(e){(e.id===A||e.id===m)&&t.add(e)}),null===(f=o.get("candidate-pair"))||void 0===f||f.forEach(function(e){e.id===v&&(c=e,t.add(e))})}if(c){var E,g,S=c,b=S.localCandidateId,T=S.remoteCandidateId;null===(E=o.get("local-candidate"))||void 0===E||E.forEach(function(e){e.id===b&&t.add(e)}),null===(g=o.get("remote-candidate"))||void 0===g||g.forEach(function(e){e.id===T&&t.add(e)})}})},o.get("media-source")?null===(s=o.get("media-source"))||void 0===s||s.forEach(function(e){var t,r=new T4;r.add(e);var i=[];null===(t=o.get("outbound-rtp"))||void 0===t||t.forEach(function(t){var n;t.mediaSourceId===e.id&&(r.add(t),i.push(t),null===(n=o.get("remote-inbound-rtp"))||void 0===n||n.forEach(function(e){e.localId===t.id&&r.add(e)}))}),a(i,r),n[e.trackIdentifier]=pZ(r)}):o.get("track")&&(null===(c=o.get("track"))||void 0===c||c.forEach(function(e){var t,r=new T4;r.add(e);var i=[];null===(t=o.get("outbound-rtp"))||void 0===t||t.forEach(function(t){var n;t.trackId===e.id&&(r.add(t),i.push(t),null===(n=o.get("remote-inbound-rtp"))||void 0===n||n.forEach(function(e){e.localId===t.id&&r.add(e)}))}),a(i,r),n[e.trackIdentifier]=pZ(r)})),null===(r=o.get("inbound-rtp"))||void 0===r||r.forEach(function(e){var t,r=new T4;r.add(e),null===(t=o.get("remote-outbound-rtp"))||void 0===t||t.forEach(function(t){t.localId===e.id&&r.add(t)}),a([e],r);var i,s=e.trackIdentifier;s||null===(i=o.get("track"))||void 0===i||i.forEach(function(t){t.id===e.trackId&&(s=t.trackIdentifier)}),n[s]=pZ(r)}),e.abrupt("return",n);case 10:case"end":return e.stop()}},e)})),function(e){return yR.apply(this,arguments)}),T7=(yI=sk(sI().mark(function e(t,r,i,n){var o,a,s,c,d,u;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null==r?void 0:r.id,t instanceof RTCPeerConnection){e.next=3;break}return e.abrupt("return",[]);case 3:if(!m4&&!m6){e.next=22;break}if(a=[],e.prev=5,!n){e.next=12;break}return e.next=9,n.getStats();case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,t.getStats(r);case 14:e.t0=e.sent;case 15:e.t0.forEach(function(e){a.push(e)}),e.next=21;break;case 19:e.prev=19,e.t1=e.catch(5);case 21:return e.abrupt("return",a);case 22:return(!(s=T3.get(t))||Date.now()-s.timestamp>150)&&(s={timestamp:Date.now(),statsPromise:T9(t),extraStatsPromise:T5(t)},T3.set(t,s)),e.next=26,s.statsPromise;case 26:if(c=e.sent,d=(o?c[o]:c.all)||[],i){e.next=33;break}return e.next=31,s.extraStatsPromise;case 31:u=e.sent,d=sN(d).call(d,(o?u.getTrackStats(o):u.all)||[]);case 33:return e.abrupt("return",d);case 34:case"end":return e.stop()}},e,null,[[5,19]])})),function(e,t,r,i){return yI.apply(this,arguments)}),ye=function(e){T3.has(e)&&T3.delete(e)},yt=function(){function e(t){nK(this,e),nQ(this,"_timer",void 0),nQ(this,"_reportTimer",void 0),nQ(this,"handler",void 0),nQ(this,"_monitor",void 0),nQ(this,"logger",void 0),nQ(this,"_destroyed",!1),nQ(this,"_isReportStarted",!1),this._context=t,this._monitor=mS(t.id),this.logger=new mJ("Stats",3,t.id)}return nY(e,[{key:"setVar",value:function(e){this.handler=e}},{key:"stopReport",value:function(e){var t;this._isReportStarted&&(this.logger.info("stopReport","invoke"),this._isReportStarted=!1,clearTimeout(this._reportTimer),delete this._reportTimer,mw(this._context.id,"del_media_statistics_timer",sN(t="reason: ".concat(e,", stack: ")).call(t,Error().stack),0,this._stream.streamId||""))}},{key:"filterIllegal",value:function(e){var t={};return cG(e).forEach(function(r){null===e[r]||void 0===e[r]||Number.isNaN(e[r])||(t[r]=e[r])}),t}},{key:"destroy",value:function(){this.logger.info("destroy","invoke"),mw(this._context.id,"media_statistics_destroy","".concat(Error().stack),0,"".concat(this._stream.streamId)),this.stopReport("destroy"),clearTimeout(this._timer),this._destroyed=!0}}]),e}(),yr=function(e){hA(o,yt);var t,r,i,n=hI(o);function o(e,t){nK(this,o),nQ(he(i=n.call(this,e)),"_stats",{audioStats:{},videoStats:{}}),nQ(he(i),"_preReports",{audio:{},video:{}}),i._stream=t;var r,i,a=(r=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._getLocalStats(i._stream,i._preReports,!1);case 2:i._stats=e.sent,i._destroyed||(i._timer=setTimeout(a,vB("STATS_LOOP_INTERVAL")));case 4:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)});return a(),i}return nY(o,[{key:"setLocalStreamStatsEvtInterval",value:function(e,t){var r=this;if(!this._isReportStarted){this.logger.info("setLocalStreamStatsEvtInterval","invoke"),this._isReportStarted=!0,this.setVar(t),this._destroyed=!1;var i,n={audio:{},video:{}},o=(i=sk(sI().mark(function t(){return sI().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._getLocalStats(r._stream,n,!0);case 2:e(t.sent),r._destroyed||(r._reportTimer=setTimeout(o,2e3));case 5:case"end":return t.stop()}},t)})),function(){return i.apply(this,arguments)});o()}}},{key:"getLocalStats",value:function(){return this._stats}},{key:"_getLocalStats",value:(i=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null===(n=this._stream.audioTrack)||void 0===n?void 0:n.preprocessingTrack,c=null===(o=this._stream.videoTrack)||void 0===o?void 0:o.preprocessingTrack,0!==cG(r.audio).length||0!==cG(r.video).length){e.next=9;break}return e.next=5,this.getAudioStats(s,r,null===(d=t.audioTrack)||void 0===d?void 0:d.getAudioLevel(),i);case 5:return e.next=7,this.getVideoStats(c,r,i);case 7:return e.next=9,v4(150);case 9:return e.next=11,this.getAudioStats(s,r,null===(a=t.audioTrack)||void 0===a?void 0:a.getAudioLevel(),i);case 11:return u=e.sent,e.next=14,this.getVideoStats(c,r,i);case 14:return l=e.sent,e.abrupt("return",{audioStats:u,videoStats:l,isScreen:t.isScreen});case 16:case"end":return e.stop()}},e,this)})),function(e,t,r){return i.apply(this,arguments)})},{key:"getAudioStats",value:(r=sk(sI().mark(function e(t,r,i,n){var o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c={},d={timestamp:Date.now()},l=(u=this._stream).streamId,h=u.audioMid,p=u.isScreen,f=u.pubAttributes,_=u.pubAudio,A=u.audioTrack,m={media_type:"audio",is_screen:!!p,direction:"up",stream_id:l,vid:h,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:f.localaudio?"capture_state_on":"capture_state_off",mute_state:_?"mute_state_off":"mute_state_on",thermal_status:Ts.state},A&&(m.playback_volume=A.getVolume()),t&&this.handler){e.next=7;break}return e.abrupt("return",c);case 7:return e.next=9,null===(o=this.handler.peer)||void 0===o?void 0:o.getStatsWithLowFrequency(t,!1,null===(a=this._stream.audioTransceiver)||void 0===a?void 0:a.sender);case 9:if((v=e.sent).length){e.next=12;break}return e.abrupt("return",c);case 12:if(v.forEach(function(e){var t=e.type,r=e.packetsSent,i=e.packetsLost,n=e.bytesSent,o=e.clockRate,a=e.roundTripTime,s=e.channels,u=e.audioLevel,l=e.mimeType,h=e.availableIncomingBitrate,p=e.availableOutgoingBitrate,f=e.bytesReceived,_=e.nominated,A=e.id,v=e.currentRoundTripTime,E=e.state,g=e.writable,S=e.requestsReceived,b=e.responsesReceived,T=e.requestsSent,y=e.consentRequestsSent,R=e.responsesSent,I=e.jitter,C=e.candidateType,k=e.ip,w=e.address,O=e.networkType,N=e.port,P=e.protocol,D=e.nackCount,L=e.retransmittedBytesSent,M=e.retransmittedPacketsSent,x=e.audioInputLevel,U=e.ssrc,B=e.totalAudioEnergy,V=e.totalSamplesDuration,F=e.mediaType,j=e.fractionLost;"outbound-rtp"===t?(d.packetsSent=r,d.bytesSent=n,m.bytes=n,m.packetsSent=r,m.nackCount=D,m.ssrc=U,m.retransmitted_bytes_sent=L,m.retransmitted_packets_sent=M,d.retransmittedBytesSent=L,d.retransmittedPacketsSent=M):"remote-inbound-rtp"===t?(d.packetsLost=i,m.packetsLost=i,m.net_jitter=1e3*I,c.rtt=1e3*a,m.rtt=c.rtt,c._fractionLost=j||0):"codec"===t?(c.recordSampleRate=o,c.numChannels=s,m.codecName=l):"media-source"===t&&void 0!==u?(m.audio_level=u?-10*p6(Math.pow(u,2)):u,m.volume=255*u,m.total_audio_energy=B,m.totalInputDuration=V,m.send_level||(m.send_level=u)):"ssrc"===t&&"audio"===F?x&&(m.send_level=x):"candidate-pair"===t?(m.ice_available_incoming_bitrate=h,m.ice_available_outgoing_bitrate=p,m.ice_bytes_received=f,m.ice_bytes_sent=n,m.ice_nominated=Number(_),m.ice_pair_id=A,m.ice_pair_rtt=v,m.ice_pair_state=E,m.ice_pair_writable=g,m.recv_ping_requests=S,m.recv_ping_responses=b,m.sent_ping_requests_before_first_response=T,m.sent_ping_requests_total=T+(y||0),m.sent_ping_responses=R):"local-candidate"===t?(m.local_candidate_type=C,m.local_ip=k||w,m.local_network_type=O,m.local_port=N,m.protocol=P):"remote-candidate"===t&&(m.remote_candidate_type=C,m.remote_ip=k||w,m.remote_port=N)}),m.send_level?m.send_level<1?m._sendVolumeLevel=32767*m.send_level:m._sendVolumeLevel=m.send_level:(E=(null==A?void 0:A.getAudioLevel())||0,m._sendVolumeLevel=Math.round(E/255*32767)),void 0===m.volume&&void 0!==i&&(m.volume=i,m.audio_level=i?-10*p6(Math.pow(i/255,2)):i),(g=r.audio).timestamp){e.next=19;break}return r.audio=d,e.abrupt("return",this.filterIllegal(c));case 19:return void 0!==d.packetsLost&&(c.audioLossRate=Math.max(0,d.packetsLost-g.packetsLost)/(d.packetsSent-g.packetsSent),c.audioLossRate=Number.isNaN(c.audioLossRate)?0:c.audioLossRate,m.fraction_lost=c.audioLossRate),c.statsInterval=d.timestamp-g.timestamp,m.stats_interval=c.statsInterval,c.sendKBitrate=(d.bytesSent-g.bytesSent||0)/c.statsInterval*8,m.mediaBitratebps=Math.round(1e3*c.sendKBitrate),m.bandwidth=Math.round(m.mediaBitratebps/1024),void 0!==d.retransmittedBytesSent&&(m.retransmitBitratebps=(d.retransmittedBytesSent-g.retransmittedBytesSent||0)/c.statsInterval),r.audio=d,m.vendor_mode=this._stream.vendorCode||0,m.pc_session_id=null===(s=this.handler)||void 0===s?void 0:s.peerConnectionId,n&&(null===(S=this._monitor)||void 0===S||S.report("rtc_media_statistics",m)),c._retransmittedRate=(d.retransmittedPacketsSent-g.retransmittedPacketsSent)/(d.packetsSent-g.packetsSent),void 0===c.audioLossRate&&(c.audioLossRate=c._retransmittedRate,m.fraction_lost=c.audioLossRate),c._fractionLost=Math.max(c._fractionLost,c.audioLossRate),c._sendVolumeLevel=m._sendVolumeLevel,e.abrupt("return",this.filterIllegal(c));case 35:case"end":return e.stop()}},e,this)})),function(e,t,i,n){return r.apply(this,arguments)})},{key:"getVideoStats",value:(t=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c={},d={timestamp:Date.now(),simulcast:{}},l=(u=this._stream).streamId,h=u.videoMid,p=u.isScreen,f=u.pubAttributes,_=u.enableSimulcast,A=u.pubVideo,m={media_type:"video",is_screen:!!p,direction:"up",stream_id:l,vid:h,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,capture_state:f.localvideo?"capture_state_on":"capture_state_off",mute_state:A?"mute_state_off":"mute_state_on",thermal_status:Ts.state},t&&this.handler){e.next=6;break}return e.abrupt("return",c);case 6:return m.cap_frame_width=t.getSettings().width,m.cap_frame_height=t.getSettings().height,m.frameRateSent=t.getSettings().frameRate,c.isScreen=p,m.is_intersecting=sD(null===(n=this._stream)||void 0===n||null===(o=n.videoTrack)||void 0===o?void 0:o.intersection()),e.next=13,null===(a=this.handler.peer)||void 0===a?void 0:a.getStatsWithLowFrequency(t,!1,null===(s=this._stream.videoTransceiver)||void 0===s?void 0:s.sender);case 13:if((v=e.sent).length){e.next=16;break}return e.abrupt("return",c);case 16:if(E=0,v.forEach(function(e){var t=e.type,i=e.framesEncoded,n=e.packetsLost,o=e.bytesSent,a=e.framesSent,s=e.retransmittedBytesSent,u=e.totalPacketSendDelay,l=e.totalEncodeTime,h=e.firCount,p=e.targetBitrate,f=e.roundTripTime,A=e.mimeType,v=e.frameWidth,g=e.frameHeight,S=e.packetsSent,b=e.googActualEncBitrate,T=e.googAvailableReceiveBandwidth,y=e.googAvailableSendBandwidth,R=e.googAvgEncodeMs,I=e.googBucketDelay,C=e.googEncodeUsagePercent,k=e.googFrameRateInput,w=e.availableIncomingBitrate,O=e.availableOutgoingBitrate,N=e.bytesReceived,P=e.nominated,D=e.id,L=e.currentRoundTripTime,M=e.state,x=e.writable,U=e.candidateType,B=e.ip,V=e.address,F=e.networkType,j=e.port,G=e.nackCount,W=e.pliCount,H=e.protocol,Y=e.qpSum,K=e.requestsReceived,Q=e.responsesReceived,z=e.googRetransmitBitrate,X=e.requestsSent,J=e.consentRequestsSent,q=e.responsesSent,Z=e.ssrc,$=e.googTargetEncBitrate,ee=e.googTransmitBitrate,et=e.retransmittedPacketsSent,er=e.encoderImplementation,ei=e.jitter,en=e.rid,eo=e.fractionLost,ea=e.googAdaptationChanges,es=e.qualityLimitationReason,ec=e.qualityLimitationDurations,ed=e.googFirsReceived,eu=e.googFrameRateSent,el=e.keyFramesEncoded,eh=e.scalabilityMode,ep=e.framesPerSecond,ef=e.frames;"outbound-rtp"===t?(_&&(en?d.simulcast[en]=e:d.simulcast[E]=e,E++),d.framesEncoded=i||d.framesEncoded||0,m.key_frames_encoded=el||0,d.bytesSent=o||d.bytesSent||0,d.framesSent=a||d.framesSent,m.bytes=o||m.bytes||0,d.packetsSent=S||d.packetsSent||0,m.packetsSent=S||m.packetsSent||0,m.nackCount=G||m.nackCount||0,m.pli_count=W||m.pli_count||0,m.qp_sum=Y||m.qp_sum||0,m.ssrc=Z||m.ssrc||0,m.retransmitted_packets_sent=et,d.retransmittedPacketsSent=et,d.retransmittedBytesSent=s,m.encoder_implementation=er,m.qualityLimitationReason=es,m.qualityLimitationDurations=ec,m.scalabilityMode=eh,void 0!==v&&((!c.encodedFrameWidth||v>c.encodedFrameWidth)&&(c.encodedFrameWidth=v),(!c.encodedFrameHeight||g>c.encodedFrameHeight)&&(c.encodedFrameHeight=g),m.frame_size_height=g,m.frame_size_width=v)):"track"===t?(c.encodedFrameWidth=v,c.encodedFrameHeight=g,m.frame_size_height=g,m.frame_size_width=v):"remote-inbound-rtp"===t?(d.packetsLost=n,c.rtt=1e3*f,m.rtt=c.rtt,m.jitter=1e3*ei,m.packetsLost=n,c._fractionLost=eo||0):"codec"===t?(c.codecType=A,m.codecName=A):"candidate-pair"===t?(m.ice_available_incoming_bitrate=w,m.ice_available_outgoing_bitrate=O,m.ice_bytes_received=N,m.ice_bytes_sent=o,m.ice_nominated=Number(P),m.ice_pair_id=D,m.ice_pair_rtt=L,m.ice_pair_state=M,m.ice_pair_writable=x,m.recv_ping_requests=K,m.recv_ping_responses=Q,m.sent_ping_requests_before_first_response=X,m.sent_ping_requests_total=X+J,m.sent_ping_responses=q):"local-candidate"===t?(m.local_candidate_type=U,m.local_ip=B||V,m.local_network_type=F,m.local_port=j,m.protocol=H):"remote-candidate"===t?(m.remote_candidate_type=U,m.remote_ip=B||V,m.remote_port=j):"VideoBwe"===t?(m.encBitratebps=b,m.available_receive_bandwidth=T,m.available_send_bandwidth=y,m.bucket_delay=I,m.retransmitBitratebps=z,m.targetEncBitratebps=$,m.transmit_bitrate=ee,c._sendBandWidth=Number(y)):"ssrc"===t&&(m.avg_encode_ms=R,m.encodeUsage=C,m.frame_rate_input=k,m.orignal_input_Framerate=Number(k),m.ddaptationChanges=ea,m.firsReceived=ed,m.frameRateSent=eu);var e_=vB("STATS_SCALLBACK_SUPPORT");if(!go||!e_){var eA=r.video,em=d.timestamp-eA.timestamp;if("outbound-rtp"===t){var ev=o-eA.bytesSent,eE=s-eA.retransmittedBytesSent;m.encBitratebps=Math.round(8e3*(ev-eE)/em),m.bucket_delay=u/S,m.retransmitBitratebps=Math.round(8e3*eE/em),m.targetEncBitratebps=p,m.transmit_bitrate=Math.round(1e3*(o-eA.bytesSent)*8/em),m.avg_encode_ms=1e3*l/i,m.firsReceived=h+W}else"candidate-pair"===t?(m.available_send_bandwidth=O,c._sendBandWidth=O):"media-source"===t&&(m.frame_rate_input=ep,m.orignal_input_Framerate=Number(ep),m.frame_input=ef)}}),(g=r.video).timestamp){e.next=22;break}return r.video=d,e.abrupt("return",this.filterIllegal(c));case 22:return c.statsInterval=d.timestamp-g.timestamp,m.stats_interval=c.statsInterval,S=cG(d.simulcast),_?(m.sim_enc_width=[],m.sim_enc_height=[],m.sim_enc_bps=[],m.sim_enc_framerate=[],m.sim_enc_key_frames=[],m.sim_rids=[],m.sim_enc_bandwidth=[],m.sim_sent_framerate=[],m.sim_fraction_lost=[],m.sim_keyencoded=[],m.active_sim_streams=this._context.videoProfile.activeSimStreams||[],m.sim_retransmittedRate=[],T=!1,hY(S).call(S,function(e,t){return Number(e)-Number(t)}).forEach(function(e){var t=d.simulcast[e],r=t.frameWidth,i=t.frameHeight,n=t.bytesSent,o=t.framesEncoded,a=t.framesSent,s=t.packetsLost,u=t.packetsSent,l=t.qualityLimitationReason,h=t.qualityLimitationDurations,p=t.qualityLimitationResolutionChanges,f=t.retransmittedPacketsSent,_=t.pliCount,A=t.keyFramesEncoded;void 0!==l&&(m.sim_qualityLimitationReason||(m.sim_qualityLimitationReason=[],m.sim_qualityLimitationDurations=[],m.sim_qualityLimitationResolutionChanges=[]),m.sim_qualityLimitationReason.push(l),m.sim_qualityLimitationDurations.push(h),m.sim_qualityLimitationResolutionChanges.push(p));var v=g.simulcast[e];if(m.sim_enc_width.push(r||0),m.sim_enc_height.push(i||0),m.sim_enc_key_frames.push(A||0),v){var E=(n-v.bytesSent||0)/c.statsInterval;m.sim_enc_bps.push(Math.round(8e3*E)),m.sim_enc_bandwidth.push(Math.round(8e3*E/1024));var S=1e3*(o-v.framesEncoded)/c.statsInterval;m.sim_enc_framerate.push(Math.round(S)),m.sim_rids.push(e);var b=void 0!==a?a-v.framesSent:o-v.framesEncoded,y=1e3*b/c.statsInterval;m.sim_sent_framerate.push(Math.round(y));var R=(s-v.packetsLost)/(u-v.packetsSent);c._retransmittedRate=(f-v.retransmittedPacketsSent)/(u-v.packetsSent),R=Number.isNaN(R)?0:R,m.sim_fraction_lost.push(R),m.sim_keyencoded.push(_-v.pliCount>0),m.sim_retransmittedRate.push(c._retransmittedRate),r>0&&!T&&(c.rid=e,c.sentKBitrate=8*E,c.encoderOutputFrameRate=S,c.encodedFrameCount=b,c.sentFrameRate=y,c.videoLossRate=R,T=!0)}}),m.vendor_mode=this._stream.vendorCode||0,m.pc_session_id=null===(b=this.handler)||void 0===b?void 0:b.peerConnectionId,i&&(null===(y=this._monitor)||void 0===y||y.report("rtc_media_statistics",m))):(c.encodedFrameCount=void 0!==d.framesSent?d.framesSent-g.framesSent:d.framesEncoded-g.framesEncoded,c.sentKBitrate=(d.bytesSent-g.bytesSent||0)/c.statsInterval*8,m.bitrate=Math.round(1e3*c.sentKBitrate),m.bandwidth=Math.round(m.bitrate/1024),c.encoderOutputFrameRate=1e3*(d.framesEncoded-g.framesEncoded)/c.statsInterval,m.frame_rate_encoded=Math.round(c.encoderOutputFrameRate),c.sentFrameRate=1e3*c.encodedFrameCount/c.statsInterval,m.frame_rate_sent=Math.round(c.sentFrameRate),c.videoLossRate=Math.max(0,d.packetsLost-g.packetsLost)/(d.packetsSent-g.packetsSent),c.videoLossRate=Number.isNaN(c.videoLossRate)?0:c.videoLossRate,m.fraction_lost=c.videoLossRate,c._retransmittedRate=(d.retransmittedPacketsSent-g.retransmittedPacketsSent)/(d.packetsSent-g.packetsSent),m.vendor_mode=this._stream.vendorCode||0,m.pc_session_id=null===(R=this.handler)||void 0===R?void 0:R.peerConnectionId,i&&(null===(I=this._monitor)||void 0===I||I.report("rtc_media_statistics",m))),r.video=d,c._fractionLost=Math.max(c._fractionLost,c.videoLossRate),c._captureResolutionWidth=m.cap_frame_width,c._captureResolutionHeight=m.cap_frame_height,e.abrupt("return",this.filterIllegal(c));case 31:case"end":return e.stop()}},e,this)})),function(e,r,i){return t.apply(this,arguments)})}]),o}(),yi=function(e){hA(a,yt);var t,r,i,n,o=hI(a);function a(e,t){nK(this,a),nQ(he(i=o.call(this,e)),"_stats",{audioStats:{},videoStats:{}}),nQ(he(i),"_preReports",{audio:{},video:{}}),i._stream=t;var r,i,n=(r=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._getRemoteStreamStats(i._stream,i._preReports,!1);case 2:i._stats=e.sent,i._destroyed||(i._timer=setTimeout(n,vB("STATS_LOOP_INTERVAL")));case 4:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)});return n(),i}return nY(a,[{key:"setRemoteStreamStatsEvtInterval",value:(n=sk(sI().mark(function e(t,r){var i,n,o=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isReportStarted){e.next=2;break}return e.abrupt("return");case 2:this.logger.info("setRemoteStreamStatsEvtInterval","invoke"),this._isReportStarted=!0,this.setVar(r),this._destroyed=!1,i={audio:{},video:{}},n=function(){var e=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o._getRemoteStreamStats(o._stream,i,!0);case 2:t(e.sent),o._destroyed||(o._reportTimer=setTimeout(n,2e3));case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),this.stopReport("start a new timer."),n();case 10:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"getRemoteStreamStats",value:function(){return this._stats}},{key:"_getRemoteStreamStats",value:(i=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=null===(n=t.videoTrack)||void 0===n?void 0:n.originTrack,c=null===(o=t.audioTrack)||void 0===o?void 0:o.originTrack,0!==cG(r.audio).length||0!==cG(r.video).length){e.next=9;break}return e.next=5,this.getRemoteAudioStats(c,r,null===(d=this._stream.audioTrack)||void 0===d?void 0:d.getAudioLevel(),i);case 5:return e.next=7,this.getRemoteVideoStats(s,r,i);case 7:return e.next=9,v4(150);case 9:return e.next=11,this.getRemoteAudioStats(c,r,null===(a=this._stream.audioTrack)||void 0===a?void 0:a.getAudioLevel(),i);case 11:return u=e.sent,e.next=14,this.getRemoteVideoStats(s,r,i);case 14:return l=e.sent,e.abrupt("return",{audioStats:u,videoStats:l,isScreen:t.isScreen,userId:t.userId,streamId:t.streamId});case 16:case"end":return e.stop()}},e,this)})),function(e,t,r){return i.apply(this,arguments)})},{key:"unsubscribe",value:function(){this.logger.info("unsubscribe","invoke"),hf(hp(a.prototype),"stopReport",this).call(this,"unsubscribe"),this._stream.stopAudioStallObserve()}},{key:"getRemoteAudioStats",value:(r=sk(sI().mark(function e(t,r,i,n){var o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u={},l={},p=(h=this._stream).streamId,f=h.userId,_=h.isScreen,A=h.audioMid,m=h.subMediaType,v=h._attributes,E=h.virtual,g=h.audioTrack,S={media_type:"audio",is_screen:!!_,direction:"down",stream_id:p,stream_user_id:f,vid:A,audio_mux:E,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:Er(m)?"mute_state_off":"mute_state_on",remote_user_capture_state:v.localaudio?"capture_state_on":"capture_state_off",remote_user_mute_state:v.localaudio&&v.audiostream?"mute_state_off":"mute_state_on",thermal_status:Ts.state},g&&(S.playback_volume=g.getVolume()),t&&this.handler){e.next=7;break}return e.abrupt("return",u);case 7:return e.next=9,null===(o=this.handler.peer)||void 0===o?void 0:o.getStatsWithLowFrequency(t,!1,null===(a=this._stream.audioTransceiver)||void 0===a?void 0:a.receiver);case 9:if((b=e.sent).length){e.next=12;break}return e.abrupt("return",u);case 12:if(b.forEach(function(e){var t,r,n=e.type,o=e.packetsLost,a=e.packetsReceived,s=e.bytesReceived,c=e.jitterBufferDelay,d=e.jitterBufferEmittedCount,h=e.clockRate,f=e.channels,_=e.totalSamplesReceived,A=e.concealedSamples,m=e.silentConcealedSamples,v=e.concealmentEvents,E=e.totalRoundTripTime,g=e.packetsDiscarded,b=e.state,T=e.currentRoundTripTime,y=e.audioLevel,R=e.totalAudioEnergy,C=e.totalSamplesDuration,k=e.mimeType,w=e.googDecodingNormal,O=e.googDecodingMuted,N=e.availableIncomingBitrate,P=e.availableOutgoingBitrate,D=e.bytesSent,L=e.nominated,M=e.id,x=e.writable,U=e.jitter,B=e.candidateType,V=e.ip,F=e.address,j=e.networkType,G=e.port,W=e.protocol,H=e.audioOutputLevel,Y=e.requestsReceived,K=e.responsesReceived,Q=e.requestsSent,z=e.consentRequestsSent,X=e.responsesSent,J=e.ssrc,q=e.nackCount,Z=e.lastPacketReceivedTimestamp,$=e.concealmentevents,ee=e.fecPacketsReceived;"inbound-rtp"===n?(l.packetsLost=o,l.packetsReceived=a,S.packetsLost=o,S.packetsReceived=a,S.packetsDiscarded=g,S.nackCount=q,S.lastPacketReceivedTimestamp=Z,S.concealmentevents=$,l.bytesReceived=s,void 0!==c&&(u.jitterBufferDelay=c/d*1e3,S.average_jitter_buffer_delay_ms=u.jitterBufferDelay),void 0!==_&&(l.totalSamplesReceived=_,u.concealedSamples=A,l.concealedSamples=A,l.silentConcealedSamples=m,S.concealedSamples=A,u.concealmentEvents=v,S.totalSamplesReceived=_),void 0!==ee&&(S.fec_packets_received=ee,l.fecPacketsReceived=ee),S.jitter=1e3*U,S.ssrc=J,void 0!==y&&0!==y?(S.audio_level=y?-10*p6(Math.pow(y,2)):y,S.volume=255*y):(S.volume=null!=i?i:255*y,S.audio_level=i?-10*p6(Math.pow(i/255,2)):i),void 0!==R&&(S.total_audio_energy=R),void 0!==C&&(S.totalAudioDuration=C)):"codec"===n?(u.recordSampleRate=h,f&&(u.numChannels=f),S.codecName=k):"candidate-pair"===n?(S.ice_available_incoming_bitrate=N,S.ice_available_outgoing_bitrate=P,S.ice_bytes_received=s,S.ice_bytes_sent=D,S.ice_nominated=Number(L),S.ice_pair_id=M,S.ice_pair_rtt=T,S.rtt=1e3*T,S.rtt&&null!==(t=I._context.streamRTT)&&void 0!==t&&null!==(r=t[p])&&void 0!==r&&r.audio&&(S.total_rtt_ms=Math.round(S.rtt+I._context.streamRTT[p].audio)),S.ice_pair_state=b,S.ice_pair_writable=x,S.recv_ping_requests=Y,S.recv_ping_responses=K,S.sent_ping_requests_before_first_response=Q,S.sent_ping_requests_total=Q+(z||0),S.sent_ping_responses=X,"succeeded"===b&&(u.rtt=1e3*T,u.total_rtt=1e3*E)):"track"===n&&void 0!==y?(0===y&&0!==i?(S.volume=i,S.audio_level=i?-10*p6(Math.pow(i/255,2)):i):(S.audio_level=y?-10*p6(Math.pow(y,2)):y,S.volume=255*y),S.total_audio_energy=R,S.totalAudioDuration=C):"ssrc"===n?(S.decodingNormal=w,S.recvAudioLevel=H,S.decodingMuted=O):"local-candidate"===n?(S.local_candidate_type=B,S.local_ip=V||F,S.local_network_type=j,S.local_port=G,S.protocol=W):"remote-candidate"===n&&(S.remote_candidate_type=B,S.remote_ip=V||F,S.remote_port=G)}),(T=r.audio).timestamp){e.next=18;break}return l.timestamp=Date.now(),r.audio=l,e.abrupt("return",this.filterIllegal(u));case 18:if(void 0===l.concealedSamples){e.next=25;break}return S.interval_concealed_samples=l.concealedSamples-T.concealedSamples,S.interval_samples_received=l.totalSamplesReceived-T.totalSamplesReceived,S.interval_silent_concealed_samples=l.silentConcealedSamples-T.silentConcealedSamples,e.next=24,this._stream.updateAudioStallInfo(S,u,l);case 24:y=e.sent;case 25:return l.timestamp=Date.now(),u.audioLossRate=Math.max(0,l.packetsLost-T.packetsLost)/(l.packetsReceived-T.packetsReceived+(l.packetsLost-T.packetsLost)),u.audioLossRate=Number.isNaN(u.audioLossRate)?0:u.audioLossRate,S.fraction_lost=u.audioLossRate,u.statsInterval=l.timestamp-T.timestamp,S.stats_interval=u.statsInterval,u.receivedKBitrate=(l.bytesReceived-T.bytesReceived||0)/u.statsInterval*8,S.bandwidth=Math.round(1e3*u.receivedKBitrate/1024),void 0!==l.concealedSamples&&(u.receivedSampleRate=1e3*S.interval_samples_received/u.statsInterval),void 0!==l.fecPacketsReceived&&(S.fecBitratebps=(l.fecPacketsReceived-T.fecPacketsReceived||0)/u.statsInterval),S.average_jitter_buffer_delay_ms&&S.total_rtt_ms&&(u.e2eDelay=S.average_jitter_buffer_delay_ms+S.total_rtt_ms),null!==(s=this._context.streamRTT)&&void 0!==s&&null!==(c=s[p])&&void 0!==c&&c.audio&&(u.totalRtt=(S.rtt?S.rtt:0)+this._context.streamRTT[p].audio),r.audio=l,S.vendor_mode=this._stream.vendorCode||0,S.pc_session_id=null===(d=this.handler)||void 0===d?void 0:d.peerConnectionId,n&&(null===(R=this._monitor)||void 0===R||R.report("rtc_media_statistics",S,y)),e.abrupt("return",this.filterIllegal(u));case 42:case"end":return e.stop()}},e,this)})),function(e,t,i,n){return r.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(t=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u={},l={timestamp:Date.now()},p=(h=this._stream).streamId,f=h.userId,_=h.isScreen,A=h.subMediaType,m=h._attributes,v=l9({media_type:"video",is_screen:!!_,direction:"down",stream_id:p,stream_user_id:f,vid:this._stream.videoMid,connection_status:navigator.onLine,track_enabled:null==t?void 0:t.enabled,mute_state:Ei(A)?"mute_state_off":"mute_state_on",remote_user_capture_state:m.localvideo?"capture_state_on":"capture_state_off",remote_user_mute_state:m.localvideo&&m.videostream?"mute_state_off":"mute_state_on",is_intersecting:sD(null===(n=this._stream.videoTrack)||void 0===n?void 0:n.intersection()),thermal_status:Ts.state},this._stream.getVideoRenderInfo()),t&&this.handler){e.next=6;break}return e.abrupt("return",u);case 6:return u.isScreen=_,e.next=9,null===(o=this.handler.peer)||void 0===o?void 0:o.getStatsWithLowFrequency(t,!1,null===(a=this._stream.videoTransceiver)||void 0===a?void 0:a.receiver);case 9:if((E=e.sent).length){e.next=12;break}return e.abrupt("return",u);case 12:if(E.forEach(function(e){var t,r,i=e.type,n=e.frameHeight,o=e.frameWidth,a=e.packetsLost,s=e.packetsReceived,c=e.bytesReceived,d=e.framesDecoded,h=e.jitterBufferDelay,f=e.jitterBufferEmittedCount,_=e.mimeType,A=e.firCount,m=e.availableIncomingBitrate,E=e.availableOutgoingBitrate,g=e.bytesSent,S=e.nominated,b=e.id,T=e.currentRoundTripTime,y=e.state,R=e.writable,C=e.candidateType,k=e.ip,w=e.address,O=e.networkType,N=e.port,P=e.nackCount,D=e.pliCount,L=e.protocol,M=e.requestsReceived,x=e.responsesReceived,U=e.requestsSent,B=e.consentRequestsSent,V=e.responsesSent,F=e.ssrc,j=e.jitter,G=e.framesReceived,W=e.keyFramesDecoded,H=e.totalDecodeTime,Y=e.decoderImplementation,K=e.lastPacketReceivedTimestamp,Q=e.framesDropped;"inbound-rtp"===i?(l.packetsLost=a,v.packetsLost=a,l.packetsReceived=s,v.packetsReceived=s,l.bytesReceived=c,v.bytes=c,l.framesDecoded=d,l.totalDecodeTime=H,void 0!==h&&(l.jitterBufferDelay=h/f*1e3,v.average_jitter_buffer_delay_ms=l.jitterBufferDelay),v.fir_count=A,v.nackCount=P,l.nackCount=P,v.pli_count=D,v.ssrc=F,v.framesDropped=Q,v.jitter=1e3*j,v.framesReceived=G,l.framesReceived=G,v.framesDecoded=d,v.key_frames_decoded=W,v.decoder_name=Y,v.last_packet_received_timestamp=K,void 0!==o&&(u.width=o,v.frame_size_width=o,u.height=n,v.frame_size_height=n)):"track"===i&&void 0!==o?(u.width=o,v.frame_size_width=o,u.height=n,v.frame_size_height=n,void 0!==G&&(v.framesReceived=G,l.framesReceived=G)):"codec"===i?(v.codecName=_,u.codecType=_):"candidate-pair"===i?(v.ice_available_incoming_bitrate=m,v.ice_available_outgoing_bitrate=E,v.ice_bytes_received=c,v.ice_bytes_sent=g,v.ice_nominated=Number(S),v.ice_pair_id=b,v.ice_pair_rtt=T,v.rtt=1e3*T,v.rtt&&null!==(t=I._context.streamRTT)&&void 0!==t&&null!==(r=t[p])&&void 0!==r&&r.video&&(v.total_rtt_ms=Math.round(v.rtt+(I._context.streamRTT[p].video||0))),u.rtt=v.rtt,v.ice_pair_state=y,v.ice_pair_writable=R,v.recv_ping_requests=M,v.recv_ping_responses=x,v.sent_ping_requests_before_first_response=U,v.sent_ping_requests_total=U+(B||0),v.sent_ping_responses=V):"local-candidate"===i?(v.local_candidate_type=C,v.local_ip=k||w,v.local_network_type=O,v.local_port=N,v.protocol=L):"remote-candidate"===i&&(v.remote_candidate_type=C,v.remote_ip=k||w,v.remote_port=N)}),(g=r.video).timestamp){e.next=17;break}return r.video=l,e.abrupt("return",this.filterIllegal(u));case 17:return S=Math.max(0,l.packetsLost-g.packetsLost),b=l.packetsReceived-g.packetsReceived,u.videoLossRate=S/(b+S),u._receivePackets=l.packetsReceived,u._receivePacketsLost=l.packetsLost,g.totalDecodeTime&&g.framesDecoded&&l.framesDecoded!==g.framesDecoded&&(T=l.totalDecodeTime-g.totalDecodeTime,y=l.framesDecoded-g.framesDecoded,v.decode_elapse_per_frame=Number((T/y*1e3).toFixed(2))),u._retransmittedRate=(l.nackCount-g.nackCount)/(b+S),u.videoLossRate=Number.isNaN(u.videoLossRate)?0:u.videoLossRate,v.fraction_lost=u.videoLossRate,u.statsInterval=l.timestamp-g.timestamp,v.stats_interval=u.statsInterval,u.receivedKBitrate=(l.bytesReceived-g.bytesReceived||0)/u.statsInterval*8,v.bitrate=Math.round(1e3*u.receivedKBitrate),v.bandwidth=Math.round(v.bitrate/1024),u.decoderOutputFrameRate=1e3*(l.framesDecoded-g.framesDecoded)/u.statsInterval,u.receivedFrameRate=1e3*(l.framesReceived-g.framesReceived)/u.statsInterval,v.frame_rate_decoded=Math.round(u.decoderOutputFrameRate),v.frame_rate_received=Math.round(u.receivedFrameRate),v.average_jitter_buffer_delay_ms&&v.total_rtt_ms&&(u.e2eDelay=v.average_jitter_buffer_delay_ms+v.total_rtt_ms),null!==(s=this._context.streamRTT)&&void 0!==s&&null!==(c=s[p])&&void 0!==c&&c.video&&(u.totalRtt=(v.rtt?v.rtt:0)+(this._context.streamRTT[p].video||0)),r.video=l,this._stream.updateVideoStallInfo(v,u,i),v.vendor_mode=this._stream.vendorCode||0,v.pc_session_id=null===(d=this.handler)||void 0===d?void 0:d.peerConnectionId,i&&(null===(R=this._monitor)||void 0===R||R.report("rtc_media_statistics",v)),e.abrupt("return",this.filterIllegal(u));case 43:case"end":return e.stop()}},e,this)})),function(e,r,i){return t.apply(this,arguments)})},{key:"destroy",value:function(){hf(hp(a.prototype),"destroy",this).call(this),hf(hp(a.prototype),"stopReport",this).call(this,"destroy"),this._stream.stopAudioStallObserve()}}]),a}(),yn=function(){function e(t,r){nK(this,e),nQ(this,"_removeHandler",void 0),nQ(this,"_remotePauseHandler",void 0),nQ(this,"_prePts",void 0),nQ(this,"_stallList",void 0),nQ(this,"_videoInWaiting",!1),nQ(this,"_videoInWaitingCallback",!1),nQ(this,"_videoInWaiting100ms",!1),nQ(this,"_isPaused",void 0),nQ(this,"_pauseStart",0),nQ(this,"_pauseDuration",0),nQ(this,"_requestVideoFrameCallbackTimer",void 0),nQ(this,"_logger",void 0),nQ(this,"_player",void 0),nQ(this,"_recentVideoInfo",void 0),nQ(this,"_stallTimeThreshold",void 0),nQ(this,"_openVideoStall100ms",vx.VIDEO_STALL_100MS);var i=t?1500:m6||m4?550:500;this._stallTimeThreshold={report:i,callback:Math.max(vx.VIDEO_STALL_DATA,i)},this._logger=new mJ("VideoStallObserver",1,r)}return nY(e,[{key:"start",value:function(e){var t=this;if(this._logger.print("start","invoke"),this._player=e,Eh())e.domElement&&(this._requestVideoFrameCallbackTimer=e.domElement.requestVideoFrameCallback(this._onVideoRefresh.bind(this)),this._removeHandler=function(){var r;t._requestVideoFrameCallbackTimer&&(null===(r=e.domElement)||void 0===r||r.cancelVideoFrameCallback(t._requestVideoFrameCallbackTimer))});else{var r=function(r){return t._onVideoTimeupdate(r,e)};e.on("playback_event",r),this._removeHandler=function(){return e.off("playback_event",r)}}var i=function(e){return t._onVideoPause(e)};e.on("playback_event",i),this._remotePauseHandler=function(){return e.off("playback_event",i)}}},{key:"getRecentRenderInfo4Report",value:function(){var e=this,t={};return this._recentVideoInfo&&cG(this._recentVideoInfo).forEach(function(r){var i,n=r.replace(/[a-z]{1}[A-Z]{1}/g,function(e){var t;return sN(t="".concat(e[0],"_")).call(t,e[1].toLowerCase())});t["video_".concat(n)]=null===(i=e._recentVideoInfo)||void 0===i?void 0:i[r]}),t}},{key:"stop",value:function(){var e,t;this._logger.print("stop","invoke"),delete this._player,null===(e=this._removeHandler)||void 0===e||e.call(this),delete this._removeHandler,null===(t=this._remotePauseHandler)||void 0===t||t.call(this),delete this._remotePauseHandler,delete this._stallList,delete this._prePts,delete this._recentVideoInfo,this._videoInWaiting=!1,this._videoInWaitingCallback=!1,this._videoInWaiting100ms=!1}},{key:"destroy",value:function(){this.stop()}},{key:"getStallInfo",value:function(e){var t=this,r=e.interval,i=e.frameRateReceived,n=e.frameRateDecoded,o=e.bitrate,a={pts:0,report:{stallCount:0,stallDuration:0,list:[]},callback:{stallCount:0,stallDuration:0},pauseDuration:this._getPauseDuration()};return this._stallList&&((m6||m4)&&(0===o||1>=(n||1/0)||1>=(i||1/0))||0===this._stallList.length?(a.report.stallDuration=a.callback.stallDuration=2e3,a.report.stallCount=a.callback.stallCount=this._videoInWaiting?0:1,this._openVideoStall100ms&&(a.stall100ms={count:this._videoInWaiting100ms?0:1,duration:2e3}),this._videoInWaiting=!0,this._videoInWaitingCallback=!0,this._videoInWaiting100ms=!0):this._stallList.forEach(function(e,i){var n=e.timeUpdateInterval;0===i&&t._videoInWaiting&&(n=Math.round(e.timeUpdateInterval%r));var o=e.timeUpdateInterval>t._stallTimeThreshold.report;o&&(a.report.list.push(e.timeUpdateInterval),a.report.stallDuration+=n,t._videoInWaiting||a.report.stallCount++),t._videoInWaiting=o,e.timeUpdateInterval>t._stallTimeThreshold.callback?(a.callback.stallDuration+=n,t._videoInWaitingCallback||a.callback.stallCount++,t._videoInWaitingCallback=!0):t._videoInWaitingCallback=!1,t._openVideoStall100ms&&(a.stall100ms||(a.stall100ms={count:0,duration:0}),e.timeUpdateInterval>100?(a.stall100ms.duration+=n,t._videoInWaiting100ms||a.stall100ms.count++,t._videoInWaiting100ms=!0):t._videoInWaiting100ms=!1),a.pts=e.playTime}),this._stallList=[]),a}},{key:"_getPauseDuration",value:function(){var e=this._pauseDuration;if(this._pauseDuration=0,this._isPaused){var t=v0(),r=t-(this._pauseStart||0);r>500&&(this._pauseStart=t,e+=r)}return e}},{key:"_onVideoPause",value:function(e){if("pause"===e.eventName)this._isPaused=!0,this._pauseStart=v0();else if("play"===e.eventName&&this._isPaused){this._isPaused=!1;var t=v0()-this._pauseStart;t>500&&(this._pauseDuration+=t)}}},{key:"_onVideoTimeupdate",value:function(e,t){if("timeupdate"===e.eventName){var r=t.domElement;if(r&&0!==r.currentTime){if(void 0===this._prePts)return void(this._prePts=r.currentTime);if(this._stallList||(this._stallList=[]),r.currentTime>this._prePts){var i=r.currentTime-this._prePts;this._stallList.push({playTime:r.currentTime,timeUpdateInterval:Math.round(1e3*i)})}this._prePts=r.currentTime}}}},{key:"_onVideoRefresh",value:function(e,t){var r,i;if(this._stallList||(this._stallList=[]),this._prePts){var n=t.presentationTime-this._prePts;this._stallList.push({playTime:t.presentationTime,timeUpdateInterval:Math.round(n)})}this._recentVideoInfo=t,this._prePts=t.presentationTime,null===(r=this._player)||void 0===r||null===(i=r.domElement)||void 0===i||i.requestVideoFrameCallback(this._onVideoRefresh.bind(this))}}]),e}(),yo=function(){var e,t;function r(e){nK(this,r),nQ(this,"_audioStallTimer",void 0),nQ(this,"_preSample",void 0),nQ(this,"_isStallInPreCallbackEnd",!1),nQ(this,"_isStallInPreReportEnd",!1),nQ(this,"_stallList",[]),this._stream=e}return nY(r,[{key:"start",value:function(e,t){this.stop(),vx.AUDIO_STALL&&r.interval>0&&"number"==typeof e&&"number"==typeof t&&(this._preSample={ts:v0(),concealedSamples:e,totalSamplesReceived:t},this._startStallCountInterval())}},{key:"stop",value:function(){this._stallList=[],this._audioStallTimer&&(clearTimeout(this._audioStallTimer),delete this._audioStallTimer)}},{key:"destroy",value:function(){this.stop()}},{key:"getAudioStallInfo",value:(t=sk(sI().mark(function e(){var t,i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={stats_count:s8(t=this._stallList).call(t,function(e){return!!e.get_stats_cost}).length,stall_list:le(this._stallList)},e.prev=1,e.next=4,this._audioStallCount();case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return n=ya(this._stallList,2,this._isStallInPreReportEnd),this._isStallInPreReportEnd=n.isStallInEnd,o=vx.AUDIO_STALL_DATA/r.interval,a=ya(this._stallList,o,this._isStallInPreCallbackEnd),this._isStallInPreCallbackEnd=a.isStallInEnd,this.stop(),this._startStallCountInterval(),e.abrupt("return",{report:{stall_count:n.stall_count,stall_duration:n.stall_duration,list:n.list},callback:{stall_count:a.stall_count,stall_duration:a.stall_duration,list:a.list},extra:i});case 16:case"end":return e.stop()}},e,this,[[1,6]])})),function(){return t.apply(this,arguments)})},{key:"_startStallCountInterval",value:function(){var e,t=this,i=(e=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(t._audioStallTimer),delete t._audioStallTimer,e.next=4,t._audioStallCount();case 4:t._audioStallTimer||(t._audioStallTimer=setTimeout(i,r.interval));case 5:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)});this._audioStallTimer=setTimeout(i,r.interval)}},{key:"_audioStallCount",value:(e=sk(sI().mark(function e(){var t,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._preSample&&!(v0()-this._preSample.ts<.5*r.interval)){e.next=2;break}return e.abrupt("return");case 2:if(i=(t=this._stream).hasAudio,n=t.subAudio,o=t.virtual,a=t.virtualOccupy,s=t.removeTrack,c=t.audioTrack,!s&&c){e.next=7;break}return clearTimeout(this._audioStallTimer),delete this._audioStallTimer,e.abrupt("return");case 7:if((d=i&&n)&&(!o||a)){e.next=13;break}this._preSample.ts=v0(),this._stallList.push({reason:d?sN(l="virtual: ".concat(o,", virtualOccupy: ")).call(l,a):sN(u="hasAudio: ".concat(i,", subAudio: ")).call(u,n)}),e.next=29;break;case 13:return h=v0(),_=0,e.prev=15,e.next=18,null===(A=this._stream.audioTransceiver)||void 0===A?void 0:A.receiver.getStats();case 18:null==(m=e.sent)||m.forEach(function(e){"inbound-rtp"===e.type&&(p=e),_++}),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(15),f=e.t0.message||sD(e.t0);case 25:v=v0(),g=(E=v0())-this._preSample.ts,p?(b=(S=p).concealedSamples,T=S.totalSamplesReceived,y=b-this._preSample.concealedSamples,R=T-this._preSample.totalSamplesReceived,I=y>=0&&R>=0&&y>=r.ratio*R,this._stallList.push({concealed:y,received:R,diff:g,start:this._preSample.ts,end:E,get_stats_cost:v-h,get_stats_start:h,get_stats_end:v,is_stall:I}),this._preSample.concealedSamples=b,this._preSample.totalSamplesReceived=T,this._preSample.ts=E):this._stallList.push({diff:g,start:this._preSample.ts,end:E,get_stats_cost:v-h,get_stats_start:h,get_stats_end:v,reason:_?f||"no inbound-rtp":"no report"});case 29:case"end":return e.stop()}},e,this,[[15,22]])})),function(){return e.apply(this,arguments)})}],[{key:"setAudioStallConfig",value:function(e){r.interval=((null==e?void 0:e.audio_stall_interval)||200)/2,r.ratio=(null==e?void 0:e.audio_stall_ratio)||.6}}]),r}();nQ(yo,"interval",100),nQ(yo,"ratio",.6);var ya=function(e,t,r){for(var i,n={stall_count:0,stall_duration:0,isStallInEnd:!1,list:[]},o=0,a=0,s=0;s<e.length;s++){var c=e[s];c.is_stall&&(o++,a+=c.diff||0);var d=s===e.length-1;if(!c.is_stall||d){var u=o>=t,l=s+t-o-1;if(!u&&o>2){var h=0;uk(e).call(e,s+1,l+1).forEach(function(e){e.is_stall&&(h+=e.diff||0)}),(u=a+h>yo.interval*t*yo.ratio)&&(s=l,a+=h)}u&&(n.stall_count++,n.stall_duration+=a,n.list.push(a)),d&&(n.isStallInEnd=u),o=a=0}}return!0===(null===(i=e[0])||void 0===i?void 0:i.is_stall)&&r&&n.stall_count>0&&n.stall_count--,n},ys=((yC=ys||{})[yC.CAPTURE=0]="CAPTURE",yC[yC.PRE_PROCESSING=1]="PRE_PROCESSING",yC[yC.ENCODE=2]="ENCODE",yC[yC.TRANSFER=3]="TRANSFER",yC[yC.POST_PROCESSING=4]="POST_PROCESSING",yC[yC.DECODE=5]="DECODE",yC[yC.RENDERING=6]="RENDERING",yC),yc=((yk=yc||{})[yk.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",yk[yk.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",yk),yd=function(){var e;function t(e){nK(this,t),nQ(this,"_plugins",new d9),this.id=e}return nY(t,[{key:"register",value:function(e){var t=this._plugins.get(e.type)||[];if(hq(t).call(t,function(t){return t.name===e.name})>-1)throw Error("Failed to register ".concat(e.name,": name is repeated."));t.push(e),this._plugins.set(e.type,t)}},{key:"getPluginsByType",value:function(e){return this._plugins.get(e)||[]}},{key:"getPluginByName",value:function(e,t){var r;return uC(r=this._plugins.get(e)||[]).call(r,function(e){return e.name===t})}},{key:"getPreProcessingTrack",value:(e=sk(sI().mark(function e(t){var r,i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=this._plugins.get(1)||[],i=t.mediaTrack,n=sz(r),e.prev=3,n.s();case 5:if((o=n.n()).done){e.next=12;break}return a=o.value,e.next=9,a.effect(t,i);case 9:i=e.sent;case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:return e.abrupt("return",i);case 21:case"end":return e.stop()}},e,this,[[3,14,17,20]])})),function(t){return e.apply(this,arguments)})},{key:"destroy",value:function(){this._plugins.forEach(function(e){e.forEach(function(e){return e.destroy()})}),this._plugins.clear()}}]),t}();ti({target:"Array",proto:!0},{fill:function(e){for(var t=ey(this),r=tA(t),i=arguments.length,n=t$(i>1?arguments[1]:void 0,r),o=i>2?arguments[2]:void 0,a=void 0===o?r:t$(o,r);a>n;)t[n++]=e;return t}});var yu=n2("Array").fill,yl=Array.prototype,yh=d(function(e){var t=e.fill;return e===yl||ee(yl,e)&&t===yl.fill?yu:t}),yp=new mJ("InternalEventBus",1),yf=((yw=yf||{}).ON_IOS_INTERRUPTION_START="ON_IOS_INTERRUPTION_START",yw.ON_IOS_INTERRUPTION_END="ON_IOS_INTERRUPTION_END",yw.ON_IOS_LOCAL_TRACK_MUTE="ON_IOS_LOCAL_TRACK_MUTE",yw.ON_IOS_LOCAL_TRACK_UNMUTE="ON_IOS_LOCAL_TRACK_UNMUTE",yw),y_=new(function(e){hA(r,EN.EventEmitter);var t=hI(r);function r(){return nK(this,r),t.apply(this,arguments)}return nY(r,[{key:"emit",value:function(e){var t,i;yp.info(e);for(var n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return(t=hf(hp(r.prototype),"emit",this)).call.apply(t,sN(i=[this,e]).call(i,o))}}]),r}()),yA="data:application/javascript;base64,Y2xhc3MgRHVtcEF1ZGlvRGF0YSBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3NvciB7CiAgcHJvY2VzcyhpbnB1dHMpIHsKICAgIHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgIGRhdGE6IGlucHV0c1swXSwKICAgICAgY2hhbm5lbENvdW50OiBpbnB1dHNbMF0ubGVuZ3RoLAogICAgICBzYW1wbGVSYXRlLAogICAgfSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KCnJlZ2lzdGVyUHJvY2Vzc29yKCdkdW1wLWF1ZGlvLWRhdGEnLCBEdW1wQXVkaW9EYXRhKTsK",ym=new mJ("AudioContext",1),yv=function(){function e(){var t=this;nK(this,e),nQ(this,"isWorkletReady",void 0),nQ(this,"_audioContextInstance",void 0),nQ(this,"_previousState",""),nQ(this,"_currentState",""),nQ(this,"_contextStuckAt",0);var r=0;m$()||setInterval(function(){if(t._audioContextInstance){var e=t._audioContextInstance.currentTime;t._contextStuckAt?t._contextStuckAt!==e&&(t._contextStuckAt=0,ym.info("currentTime resume"),mE("currentTime resume","")):e&&r===e&&(t._contextStuckAt=e,ym.warn("currentTime stuck",t._contextStuckAt),t._audioContextInstance.suspend(),t._audioContextInstance.resume(),mE("AudioContext currentTime stuck",t._contextStuckAt)),r=e}},3e3)}return nY(e,[{key:"getAudioContextInstance",value:function(){var e=this;if(!this._audioContextInstance){var t,r=window.AudioContext||window.webkitAudioContext;this._audioContextInstance=gl?new r:new r({sampleRate:44100});try{this.isWorkletReady=this._audioContextInstance.audioWorklet.addModule(yA),this.isWorkletReady.catch(function(t){var r;mv("initial AudioWorklet error in promise",-1,sN(r="".concat(t.name,"-")).call(r,t.message)),ym.error("isWorkletReady",t),e.isWorkletReady=null})}catch(e){mv("initial AudioWorklet error in catch",-1,sN(t="".concat(e.name,"-")).call(t,e.message)),ym.error("isWorkletReady",e),this.isWorkletReady=null}this._audioContextInstance.onstatechange=function(){var t,r,i;ym.warn("state change",null===(t=e._audioContextInstance)||void 0===t?void 0:t.state),e._previousState=e._currentState,e._currentState=(null===(r=e._audioContextInstance)||void 0===r?void 0:r.state)||"","interrupted"===(null===(i=e._audioContextInstance)||void 0===i?void 0:i.state)&&e._audioContextInstance.resume(),(vs||vi)&&("running"===e._previousState&&"interrupted"===e._currentState&&y_.emit(yf.ON_IOS_INTERRUPTION_START),"interrupted"===e._previousState&&"running"===e._currentState&&y_.emit(yf.ON_IOS_INTERRUPTION_END))}}return this._audioContextInstance}}]),e}(),yE=function(){var e;function t(e){nK(this,t),nQ(this,"_ctx",void 0),nQ(this,"_analyserNode",void 0),nQ(this,"_audioSource",void 0),nQ(this,"currentTrackId",void 0),this.currentTrackId=e.id;var r=yS.getAudioContextInstance();if(e instanceof MediaStreamTrack){var i=new MediaStream;i.addTrack(e),this._audioSource=r.createMediaStreamSource(i)}else this._audioSource=r.createMediaElementSource(e),this._audioSource.connect(r.destination);var n=r.createAnalyser();this._audioSource.connect(n),this._analyserNode=n,this._ctx=r}return nY(t,[{key:"getAudioLevel",value:function(){"suspended"===(null===(e=this._ctx)||void 0===e?void 0:e.state)&&this._ctx.resume();var e,t=new Uint8Array(2048);this._analyserNode.getByteTimeDomainData(t);var r=0;t.forEach(function(e){return r=Math.max(r,Math.abs(e-128))});var i=r/128*255;return i>2?i:0}},{key:"resume",value:(e=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this._ctx)||void 0===t?void 0:t.resume();case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){this._audioSource.disconnect(),this._analyserNode.disconnect()}}]),t}(),yg=function(e){hA(r,EN.EventEmitter);var t=hI(r);function r(e,i){var n,o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yS.getAudioContextInstance(),s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:yS.isWorkletReady;return(nK(this,r),nQ(he(n=t.call(this)),"_ctx",void 0),nQ(he(n),"_worklet",void 0),nQ(he(n),"_source",void 0),nQ(he(n),"_buffers",[]),nQ(he(n),"_bufferLength",0),nQ(he(n),"_sampleRate",void 0),nQ(he(n),"_channelCount",void 0),nQ(he(n),"_frameSize",void 0),e instanceof MediaStreamTrack)?n._channelCount=null!==(o=e.getSettings().channelCount)&&void 0!==o?o:1:n._channelCount=e.channelCount,n._ctx=a,n._frameSize=i,null==s||s.then(function(){n._worklet=new AudioWorkletNode(n._ctx,"dump-audio-data"),e instanceof MediaStreamTrack?n._source=n._ctx.createMediaStreamSource(new MediaStream([e])):n._source=e,n._source.connect(n._worklet),n._initWorkletEventListener(n._worklet)}).catch(),n}return nY(r,[{key:"_initWorkletEventListener",value:function(e){e.port.onmessage=this._handleWorkletMessage.bind(this)}},{key:"_handleWorkletMessage",value:function(e){var t,r,i=this,n=e.data,o=n.data,a=n.sampleRate;if(this._bufferLength>=this._frameSize||this._sampleRate!==a){if(this._sampleRate){var s=1===this._channelCount||1===o.length?1:2;this.emit("data",{channels:le(this._buffers),sampleRate:this._sampleRate,channelCount:s})}this._sampleRate=a,this._buffers=sU(t=yh(r=Array(this._channelCount)).call(r,0)).call(t,function(){return new Float32Array(i._frameSize)}),this._bufferLength=0}for(var c=0;c<this._channelCount;c++)this._buffers[c].set(o[c],this._bufferLength);this._bufferLength=this._bufferLength+o[0].length}},{key:"setFrameSize",value:function(e){this._frameSize=e}},{key:"destroy",value:function(){var e,t,r;this.removeAllListeners("data"),this._worklet&&(null===(e=this._source)||void 0===e||e.disconnect(this._worklet)),null===(t=this._worklet)||void 0===t||t.disconnect(),null===(r=this._worklet)||void 0===r||r.port.close(),this._buffers=[],delete this._source,delete this._worklet}}]),r}(),yS=new yv,yb=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement(e);return t.id&&(r.id=t.id),t.classList&&t.classList.forEach(function(e){r.classList.add(e)}),t.style&&uo(r.style,t.style),t.attributes&&cb(t.attributes).forEach(function(e){var t=sq(e,2),i=t[0],n=t[1];"muted"===i?r.muted=!0:r.setAttribute(i,n)}),r},yT=new(function(e){hA(f,EL);var t,r,i,n,o,a,s,c,d,u,l,h,p=hI(f);function f(){var e,t,r;return nK(this,f),nQ(he(r=p.call(this)),"deviceMap",{audioinput:new d9,audiooutput:new d9,videoinput:new d9}),nQ(he(r),"checkDeviceChangeTimer",null),nQ(he(r),"isSupportedPermissionsQuery",!1),nQ(he(r),"isGrantedMicrophonePermission",!1),nQ(he(r),"isGrantedCameraPermission",!1),r.isSupportedPermissionsQuery=!m$()&&!(null===(e=navigator)||void 0===e||null===(t=e.permissions)||void 0===t||!t.query),r._handleDeviceChange=r._handleDeviceChange.bind(he(r)),m$()||r.initListener().then(function(){r.updateDeviceListInSilent()}),r}return nY(f,[{key:"refreshDevices",value:(h=sk(sI().mark(function e(){var t,r,i,n=this,o=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:"audio",navigator.mediaDevices){e.next=3;break}return e.abrupt("return");case 3:if(r=void 0,!m4){e.next=19;break}if(e.prev=5,"audio"!==t){e.next=12;break}return e.next=9,navigator.mediaDevices.getUserMedia({audio:!0});case 9:r=e.sent,e.next=15;break;case 12:return e.next=14,navigator.mediaDevices.getUserMedia({video:!0});case 14:r=e.sent;case 15:e.next=19;break;case 17:e.prev=17,e.t0=e.catch(5);case 19:return e.next=21,navigator.mediaDevices.enumerateDevices();case 21:i=e.sent,r&&r.getTracks().forEach(function(e){return e.stop()}),i.forEach(function(e){var t;e.deviceId&&(null===(t=n.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e))});case 24:case"end":return e.stop()}},e,null,[[5,17]])})),function(){return h.apply(this,arguments)})},{key:"initListener",value:(l=sk(sI().mark(function e(){var t,r,i,n,o=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.ondevicechange)&&"function"==typeof(null===(r=navigator.mediaDevices)||void 0===r?void 0:r.addEventListener)?navigator.mediaDevices.addEventListener("devicechange",function(){o._handleDeviceChange(),setTimeout(function(){o._handleDeviceChange()},300)}):this.checkDeviceChangeTimer=window.setInterval(function(){o._handleDeviceChange()},3e3),!this.isSupportedPermissionsQuery){e.next=22;break}return e.prev=2,e.next=5,navigator.permissions.query({name:"microphone"});case 5:i=e.sent,this.isGrantedMicrophonePermission="granted"===i.state,i.addEventListener("change",function(){o.isGrantedMicrophonePermission="granted"===i.state}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:return e.prev=12,e.next=15,navigator.permissions.query({name:"camera"});case 15:n=e.sent,this.isGrantedCameraPermission="granted"===n.state,n.addEventListener("change",function(){o.isGrantedCameraPermission="granted"===n.state}),e.next=22;break;case 20:e.prev=20,e.t1=e.catch(12);case 22:case"end":return e.stop()}},e,this,[[2,10],[12,20]])})),function(){return l.apply(this,arguments)})},{key:"_handleDeviceChange",value:(u=sk(sI().mark(function e(){var t,r,i,n,o,a,s,c=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}return e.abrupt("return");case 2:if(o=void 0,!m4){e.next=7;break}return e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:o=e.sent;case 7:return e.next=9,navigator.mediaDevices.enumerateDevices();case 9:a=s8(a=e.sent).call(a,function(e){return!!e.deviceId}),o&&o.getTracks().forEach(function(e){return e.stop()}),s=pZ(sN(t=[]).call(t,le(fY(r=this.deviceMap.audioinput).call(r)),le(fY(i=this.deviceMap.videoinput).call(i)),le(fY(n=this.deviceMap.audiooutput).call(n)))),(va||vi)&&!s.length&&a.length&&a.forEach(function(e){var t;null===(t=c.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e)}),a.forEach(function(e){var t,r,i=c.deviceMap[e.kind].get(e.deviceId);c.deviceMap[e.kind].set(e.deviceId,e),i||(cd(t=e.kind).call(t,"video")?c.emit(Eu.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}):cd(r=e.kind).call(r,"audio")&&c.emit(Eu.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}))}),s.forEach(function(e){var t,r;uC(a).call(a,function(t){return t.deviceId===e.deviceId&&t.kind===e.kind})||(c.deviceMap[e.kind].delete(e.deviceId),cd(t=e.kind).call(t,"video")?c.emit(Eu.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}):cd(r=e.kind).call(r,"audio")&&c.emit(Eu.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}))});case 16:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"getUserMedia",value:(d=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia(t);case 2:return r=e.sent,null!=t&&t.audio&&(this.isGrantedMicrophonePermission=!0),null!=t&&t.video&&(this.isGrantedCameraPermission=!0),null!=t&&t.video?this.refreshDevices("video"):this.refreshDevices("audio"),e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"checkPermissionsByDevices",value:(c=sk(sI().mark(function e(){var t,r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={audio:!1,video:!1},navigator.mediaDevices){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices();case 5:return r=e.sent,t.audio=s8(r).call(r,function(e){return"audioinput"===e.kind&&e.label&&e.deviceId}).length>0,t.video=s8(r).call(r,function(e){return"videoinput"===e.kind&&e.label&&e.deviceId}).length>0,e.abrupt("return",t);case 9:case"end":return e.stop()}},e)})),function(){return c.apply(this,arguments)})},{key:"getPermissions",value:(s=sk(sI().mark(function e(){var t,r,i,n,o,a,s,c,d,u,l=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=l.length>0&&void 0!==l[0]?l[0]:{}).audio,n=r.video,o=r.force,i||n||(i=!0,n=!0),a={audio:!1,video:!1,reason:void 0},o){e.next=30;break}if(!this.isSupportedPermissionsQuery){e.next=20;break}if(!i||!n){e.next=14;break}if(!this.isGrantedMicrophonePermission||!this.isGrantedCameraPermission){e.next=12;break}return a.audio=!0,a.video=!0,e.abrupt("return",a);case 12:e.next=18;break;case 14:if(!(i&&this.isGrantedMicrophonePermission||n&&this.isGrantedCameraPermission)){e.next=18;break}return a.audio=this.isGrantedMicrophonePermission,a.video=this.isGrantedCameraPermission,e.abrupt("return",a);case 18:case 26:e.next=30;break;case 20:return e.next=22,this.checkPermissionsByDevices();case 22:if(s=e.sent,!i||!n){e.next=28;break}if(!s.audio||!s.video){e.next=26;break}return e.abrupt("return",s);case 28:if(!(i&&s.audio||n&&s.video)){e.next=30;break}return e.abrupt("return",s);case 30:if(null===(t=navigator.mediaDevices)||void 0===t||!t.getUserMedia){e.next=70;break}return e.prev=31,e.next=34,navigator.mediaDevices.getUserMedia({audio:i,video:n});case 34:(c=e.sent)&&(c.getTracks().forEach(function(e){return e.stop()}),i&&(a.audio=!0,this.isGrantedMicrophonePermission=!0),n&&(a.video=!0,this.isGrantedCameraPermission=!0)),e.next=70;break;case 38:if(e.prev=38,e.t0=e.catch(31),a.reason=e.t0,!this.isSupportedPermissionsQuery){e.next=70;break}if(!i){e.next=56;break}return e.next=45,navigator.permissions.query({name:"microphone"}).catch(function(){});case 45:if(e.t2=d=e.sent,e.t1=null===e.t2,e.t1){e.next=49;break}e.t1=void 0===d;case 49:if(!e.t1){e.next=53;break}e.t3=void 0,e.next=54;break;case 53:e.t3=d.state;case 54:e.t4=e.t3,a.audio="granted"===e.t4;case 56:if(!n){e.next=70;break}return e.next=59,navigator.permissions.query({name:"camera"}).catch(function(){});case 59:if(e.t6=u=e.sent,e.t5=null===e.t6,e.t5){e.next=63;break}e.t5=void 0===u;case 63:if(!e.t5){e.next=67;break}e.t7=void 0,e.next=68;break;case 67:e.t7=u.state;case 68:e.t8=e.t7,a.video="granted"===e.t8;case 70:if(!i){e.next=75;break}return e.next=73,this.refreshDevices("audio");case 73:e.next=77;break;case 75:return e.next=77,this.refreshDevices("video");case 77:return e.abrupt("return",a);case 78:case"end":return e.stop()}},e,this,[[31,38]])})),function(){return s.apply(this,arguments)})},{key:"updateDeviceListInSilent",value:(a=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.isGrantedCameraPermission&&this.isGrantedMicrophonePermission&&this.refreshDevices("audio");case 1:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"enumerateDevices",value:(o=sk(sI().mark(function e(){var t,r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions();case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",pZ(sN(t=[]).call(t,le(fY(r=this.deviceMap.audioinput).call(r)),le(fY(i=this.deviceMap.videoinput).call(i)),le(fY(n=this.deviceMap.audiooutput).call(n)))));case 5:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"enumerateAudioCaptureDevices",value:(n=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices();case 4:return e.abrupt("return",pZ(fY(t=this.deviceMap.audioinput).call(t)));case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"enumerateVideoCaptureDevices",value:(i=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({video:!0});case 2:return e.next=4,this.refreshDevices("video");case 4:return e.abrupt("return",pZ(fY(t=this.deviceMap.videoinput).call(t)));case 5:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"enumerateAudioPlaybackDevices",value:(r=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPermissions({audio:!0});case 2:return e.next=4,this.refreshDevices("audio");case 4:return e.abrupt("return",pZ(fY(t=this.deviceMap.audiooutput).call(t)));case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getAudioPlaybackDeviceById",value:(t=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateAudioPlaybackDevices();case 2:return r=e.sent,e.abrupt("return",uC(r).call(r,function(e){return e.deviceId===t}));case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})}]),f}());m$()||(window.__rtc_dd__=yT);var yy,yR,yI,yC,yk,yw,yO,yN,yP,yD,yL=((yO=yL||{})[yO.AUTOPLAY_FAILED=-1e3]="AUTOPLAY_FAILED",yO[yO.TRACK_ERROR=-1001]="TRACK_ERROR",yO[yO.Fetch_MODIFY=-1002]="Fetch_MODIFY",yO[yO.BLACK_BROWSER=-1003]="BLACK_BROWSER",yO[yO.DC_SEND_ERROR=-1004]="DC_SEND_ERROR",yO[yO.DUPLICATE_DOM=-1005]="DUPLICATE_DOM",yO),yM=d(iM),yx=new mJ("VideoSnapshot",1),yU=function(e){var t=null==e?void 0:e.domElement;if(t&&!t.paused&&4===t.readyState)return t},yB=(yN=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(i=document.createElement("canvas")).getContext("2d")){e.next=4;break}throw Error("canvas.getContext error");case 4:if(o=function(e,t,r){return t=t||e.width,r=r||e.height,i.width=t,i.height=r,n.setTransform(1,0,0,1,0,0),n.drawImage(e,0,0,t,r),n.getImageData(0,0,t,r)},a=Date.now(),!(s=yU(r))){e.next=16;break}return yx.info("takeSnapshot","VideoPlayer already set."),e.next=11,o(s,s.videoWidth,s.videoHeight);case 11:return c=e.sent,yx.info("takeSnapshot","success, cost ".concat(Date.now()-a,"ms")),e.abrupt("return",c);case 16:if(!window.ImageCapture||"live"!==(d=new window.ImageCapture(t)).track.readyState||!d.track.enabled||d.track.muted){e.next=29;break}return yx.info("takeSnapshot","use ImageCapture"),e.t0=o,e.next=23,d.grabFrame();case 23:return e.t1=e.sent,e.next=26,(0,e.t0)(e.t1);case 26:return u=e.sent,yx.info("takeSnapshot","success, cost ".concat(Date.now()-a,"ms")),e.abrupt("return",u);case 29:return yx.info("takeSnapshot","use temp video"),e.abrupt("return",new sP(function(e,r){var i=new MediaStream([t]),n=document.createElement("video");n.setAttribute("playsinline",""),n.muted=!0,document.body.appendChild(n),n.onplaying=function(){var r=o(n,n.videoWidth,n.videoHeight);yx.info("takeSnapshot","success, cost ".concat(Date.now()-a,"ms")),e(r),i.removeTrack(t),n.srcObject=null,n.load()},n.onerror=r,n.srcObject=i,n.play()}));case 31:case"end":return e.stop()}},e)})),function(e,t){return yN.apply(this,arguments)}),yV=yM("default"),yF=((yP=yF||{}).START_STALL_OBSERVE="start_stall_observe",yP.STOP_STALL_OBSERVE="stop_stall_observe",yP),yj=function(e){hA(i,EX);var t,r=hI(i);function i(e,t,n){var o;return nK(this,i),nQ(he(o=r.call(this,e,t,l9(l9({},n),{},{mediaType:EK.VIDEO}))),"resolution",void 0),nQ(he(o),"videoPlayers",new d9),o.resolution={width:0,height:0},o}return nY(i,[{key:"intersection",value:function(){var e={};return this.videoPlayers.forEach(function(t,r){e[r.toString()]=t.isIntersecting}),e}},{key:"updateVideoCaptureConfig",value:(t=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateVideoEncoderConfig","update localVideoTrack: ",t),delete(r=l9({},t)).contentHint,m4&&this.trackInfo.streamIndex===EQ.MAIN&&(r.frameRate={ideal:30,max:30}),e.next=6,this.originTrack.applyConstraints(r);case 6:((i=this.originTrack.getSettings()).width&&i.width!==this.resolution.width||i.height&&i.height!==this.resolution.height)&&(this.resolution={width:i.width,height:i.height},this.emit("resolution-change",this.resolution));case 8:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"setContentHint",value:function(e){var t;"contentHint"in this.originTrack&&cd(t=["text","motion","detail"]).call(t,e)&&(this.originTrack.contentHint=e)}},{key:"setTrack",value:function(e,t){this._originTrack=e,this.trackInfo=l9(l9({},this.trackInfo),t),this.isTrackReady=this.generatePreProcessingTrack()}},{key:"setPlayer",value:function(e,t,r,i){var n,o=null!==(n=e.playerId)&&void 0!==n?n:yV,a=this.videoPlayers.get(o);return e.player!==a&&(a=e.player,this.videoPlayers.set(o,a),i(a,this.isPublic,this.streamIndex)),this.mirror(!!t),this.dummy||r===py.PLAY_MANUALLY||this.play(o),a.domElement}},{key:"setUserId",value:function(e){this.trackInfo.streamUserId=e,this.videoPlayers.forEach(function(t){t.userId=e})}},{key:"snapshot",value:function(){var e,t,r,i=sz(fY(e=this.videoPlayers).call(e));try{for(i.s();!(r=i.n()).done;){var n=r.value;if(n.played){t=n;break}}}catch(e){i.e(e)}finally{i.f()}return yB(this.preprocessingTrack,t)}},{key:"setRenderMode",value:function(e,t){var r;return null===(r=this.videoPlayers.get(e))||void 0===r?void 0:r.setRenderMode(t)}},{key:"mirror",value:function(e){this.videoPlayers.forEach(function(t){t.mirror(e)})}},{key:"removePlayerTrack",value:function(){var e=this;this.videoPlayers.forEach(function(t,r){var i;null===(i=e.videoPlayers.get(r))||void 0===i||i.removeTrack()})}},{key:"play",value:function(e){var t=this.videoPlayers.get(e);return null!=t&&t.played?t.manuallyPlay():null==t?void 0:t.playVideo(this)}},{key:"playAll",value:function(){var e=this;this.videoPlayers.forEach(function(t,r){e.play(r)})}},{key:"manuallyPlay",value:function(e){var t;return null===(t=this.videoPlayers.get(e))||void 0===t?void 0:t.manuallyPlay()}},{key:"pause",value:function(e){var t;null===(t=this.videoPlayers.get(e))||void 0===t||t.manuallyPause()}},{key:"stop",value:function(e){var t;return null===(t=this.videoPlayers.get(e))||void 0===t?void 0:t.stop()}},{key:"stopAll",value:function(){var e=this;return this.videoPlayers.forEach(function(t,r){e.stop(r)})}},{key:"destroy",value:function(){var e=this;this.videoPlayers.forEach(function(t,r){e.stop(r),t.removeAllListeners(),e.videoPlayers.delete(r)}),hf(hp(i.prototype),"destroy",this).call(this)}}]),i}(),yG=function(e){hA(r,EJ);var t=hI(r);function r(e,i,n,o){var a;return nK(this,r),nQ(he(a=t.call(this,e,i,l9(l9({},o),{},{mediaType:EK.VIDEO}))),"videoPlayers",new d9),nQ(he(a),"_stream",void 0),nQ(he(a),"_observingPlayer",void 0),a._stream=n,a}return nY(r,[{key:"observingPlayerId",get:function(){var e;return null===(e=this._observingPlayer)||void 0===e?void 0:e.playerId}},{key:"getSizeByPlayer",value:function(){var e=0,t=0;return this.videoPlayers.forEach(function(r){var i;null!==(i=r.domElement)&&void 0!==i&&i.videoWidth&&r.domElement.videoHeight&&(e=r.domElement.videoWidth,t=r.domElement.videoHeight)}),{width:e,height:t}}},{key:"intersection",value:function(){var e={};return this.videoPlayers.forEach(function(t,r){e[r.toString()]=t.isIntersecting}),e}},{key:"setPlayer",value:function(e,t,r,i){var n,o,a,s=null!==(o=t.playerId)&&void 0!==o?o:yV,c=this.videoPlayers.get(s);return t.player!==c&&(c=t.player,!Eo(this.streamIndex)&&c.mirror(this._ctx.getRemoteMirrorType(null!==(n=this.trackInfo.streamUserId)&&void 0!==n?n:"",this.streamIndex)),this.videoPlayers.set(s,c),this._handlePlayerStallEvent(c),i(c,this.isPublic,this.streamIndex)),this.dummy||this.play(s),null===(a=c)||void 0===a?void 0:a.domElement}},{key:"mirror",value:function(e){this.videoPlayers.forEach(function(t){t.mirror(e)})}},{key:"dangerousGetPlayer",value:function(e){return this.videoPlayers.get(e)}},{key:"snapshot",value:function(){var e,t,r,i=sz(fY(e=this.videoPlayers).call(e));try{for(i.s();!(r=i.n()).done;){var n=r.value;if(n.played){t=n;break}}}catch(e){i.e(e)}finally{i.f()}return yB(this.preprocessingTrack,t)}},{key:"stop",value:function(e){var t;null===(t=this.videoPlayers.get(e))||void 0===t||t.stop()}},{key:"stopAll",value:function(){var e=this;this.videoPlayers.forEach(function(t,r){e.stop(r)})}},{key:"play",value:function(e){if(this._ctx.autoPlayPolicy!==py.PLAY_MANUALLY){var t=this.videoPlayers.get(e);return null==t?void 0:t.playVideo(this)}}},{key:"manuallyPlay",value:function(e){var t=this.videoPlayers.get(e);return null!=t&&t.played?t.manuallyPlay():null==t?void 0:t.playVideo(this)}},{key:"pause",value:function(e){var t;return null===(t=this.videoPlayers.get(e))||void 0===t?void 0:t.manuallyPause()}},{key:"_handlePlayerStallEvent",value:function(e){var t=this;e.on("start_stall_observe",function(){!t._observingPlayer&&e&&(t._observingPlayer=e,t._stream.startVideoStallObserve(t._observingPlayer))}),e.on("stop_stall_observe",function(){t._observingPlayer===e&&(t._stream.stopVideoStallObserve(),t._observingPlayer=void 0,t.videoPlayers.forEach(function(e){!t._observingPlayer&&e.played&&(t._observingPlayer=e,t._stream.startVideoStallObserve(e))}))})}},{key:"destroy",value:function(){var e=this;this.videoPlayers.forEach(function(t,r){e.stop(r),t.removeAllListeners(),e.videoPlayers.delete(r)}),hf(hp(r.prototype),"destroy",this).call(this)}}]),r}(),yW=["play","playing","pause","ended","error","seeking","seeked","waiting","canplay","canplaythrough","durationchange","volumechange","loadedmetadata","loadeddata","loadstart","timeupdate"],yH={playsinline:"","webkit-playsinline":""},yY={playsinline:"","webkit-playsinline":"","x5-playsinline":"","x5-video-player-type":"h5","x-webkit-airplay":"allow",preload:"",muted:""},yK=function(e){hA(i,EN.EventEmitter);var t,r=hI(i);function i(e,t,n){nK(this,i),nQ(he(o=r.call(this)),"_containerDom",void 0),nQ(he(o),"_videoDom",void 0),nQ(he(o),"userId",void 0),nQ(he(o),"renderMode",void 0),nQ(he(o),"mirrorType",pl.MIRROR_TYPE_NONE),nQ(he(o),"isScreen",void 0),nQ(he(o),"isLocal",void 0),nQ(he(o),"played",!1),nQ(he(o),"_needLoad",!1),nQ(he(o),"_emitPlayFailed",!1),nQ(he(o),"_videoContainer",void 0),nQ(he(o),"_safari15VideoTimer",void 0),nQ(he(o),"_monitor",void 0),nQ(he(o),"logger",void 0),nQ(he(o),"_onLocalTrackMute",void 0),nQ(he(o),"_onInterruptionEnd",void 0),nQ(he(o),"_needResume",!1),nQ(he(o),"_rotate",0),nQ(he(o),"_rotateDom",void 0),nQ(he(o),"_resizeObserver",void 0),nQ(he(o),"_hasManuallyPaused",!1),nQ(he(o),"isIntersecting",void 0),nQ(he(o),"intersectionObserver",void 0),nQ(he(o),"emitVideoEvent",function(e){var t,r,i={type:"video",rawEvent:e,readyState:(null===(t=o._videoDom)||void 0===t?void 0:t.readyState)||0,userId:o.userId,eventName:e.type,currentTime:(null===(r=o._videoDom)||void 0===r?void 0:r.currentTime)||0,isScreen:o.isScreen};switch(o.emit("playback_event",i),e.type){case"canplay":o.refreshRenderSize("the video started playing."),o._internalPlay();break;case"loadeddata":o._internalPlay();break;case"playing":o.logger.info("VideoPlayerPlaying","[userId-".concat(o.userId,"] video element playing"));break;case"pause":o.logger.info("VideoPlayerPause","[userId-".concat(o.userId,"] video element pause")),o._needResume&&(o.logger.info("VideoPlayerPause","[userId-".concat(o.userId,"] video element resume")),o._internalPlay(),o._needResume=!1)}}),nQ(he(o),"_internalPlay",function(){var e,t;if(mw(o.engineId,"video _internalPlay",{paused:null===(e=o._videoDom)||void 0===e?void 0:e.paused,hasManuallyPaused:o._hasManuallyPaused}),!o._hasManuallyPaused&&null!==(t=o._videoDom)&&void 0!==t&&t.paused){var r=o._videoDom.play();null!=r&&r.then&&r.then(function(){var e;o.isLocal&&m8&&!o._needLoad&&(null===(e=o._videoDom)||void 0===e||e.load(),o._needLoad=!0)}).catch(function(e){var t,r,i,n,a,s;o._emitPlayFailed||("AbortError"!==e.name?(o._emitPlayFailed=!0,null===(t=o._monitor)||void 0===t||t.report("rtc_error",{message:sN(r="video autoplay failed, userId: ".concat(o.userId,", ")).call(r,e.name),error_code:yL.AUTOPLAY_FAILED}),o.emit("playback_event",{type:"video",rawEvent:e,readyState:(null===(i=o._videoDom)||void 0===i?void 0:i.readyState)||0,userId:o.userId,eventName:"autoplay-error",currentTime:(null===(n=o._videoDom)||void 0===n?void 0:n.currentTime)||0,isScreen:o.isScreen})):null===(a=o._monitor)||void 0===a||a.report("rtc_error",{message:sN(s="video autoplay failed, userId: ".concat(o.userId,", ")).call(s,e.name),error_code:yL.AUTOPLAY_FAILED}))})}}),o.engineId=e,o.playerId=t;var o,a=n.renderDom;o._monitor=mS(e),o.logger=new mJ("Player",0,e);var s=n.userId,c=n.isScreen?pn.RENDER_MODE_FIT:pn.RENDER_MODE_HIDDEN;o.renderMode=void 0!==n.renderMode?n.renderMode:c,o._rotate=Number(n.rotation||0);var d="string"==typeof a?document.getElementById(a):a;if(!d)throw new pB(h6.CANT_FIND_DOM,"can't find dom");return o._videoContainer=document.createElement("div"),o._videoContainer.style.width="100%",o._videoContainer.style.height="100%",o._videoContainer.style.position="relative",o._videoContainer.style.overflow="hidden",o._containerDom=d,o.userId=s,o.isLocal=!!n.isLocal,o.isScreen=!!n.isScreen,o._initVideo(),o.isLocal&&((null==vv?void 0:vv[0])===15||15===v_)&&(o._safari15VideoTimer=setTimeout(function(){try{o._videoContainer.style.display="block",setTimeout(function(){o._videoContainer.style.display="flex"},500)}catch(e){}},1e3)),o}return nY(i,[{key:"_initVideo",value:function(){var e,t,r=this;this._videoDom||(this._videoDom=yb("video",{style:{width:"100%",height:"100%"},attributes:yY}),this._videoDom.id=sN(t="".concat(this.userId,"_")).call(t,v$()),this.setRenderMode(this.renderMode),this.mirror(this.mirrorType===pl.MIRROR_TYPE_RENDER)),this._containerDom.appendChild(this._videoContainer),ux(e=[90,270]).call(e,this._rotate)>-1?(this._rotateDom=this._createRotationDiv(),this._rotateDom.appendChild(this._videoDom),this._videoContainer.appendChild(this._rotateDom)):(180===this._rotate&&(this._videoContainer.style.transform="rotate(180deg)"),this._videoContainer.appendChild(this._videoDom)),this._initInterSectionObserver(),this._initListeners(),this._onLocalTrackMute=function(){r._needResume=!0},this._onInterruptionEnd=function(){r.logger.warn("resume player after iOS interruption"),r._internalPlay()},y_.on(yf.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),y_.on(yf.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),y_.on(yf.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd)}},{key:"_initInterSectionObserver",value:function(){var e=this;!this.intersectionObserver&&"undefined"!=typeof IntersectionObserver&&this._videoDom&&(this.intersectionObserver=new IntersectionObserver(function(t){t[0]&&(e.isIntersecting=t[0].isIntersecting)},{}),this.intersectionObserver.observe(this._videoDom))}},{key:"_closeIntersectionObserver",value:function(){this.intersectionObserver&&this._videoDom&&(this.intersectionObserver.disconnect(),this.intersectionObserver.unobserve(this._videoDom),delete this.intersectionObserver)}},{key:"_createRotationDiv",value:function(){var e=this,t=document.createElement("div");return t.style.transform="rotate(".concat(this._rotate,"deg)"),180!==this._rotate&&(t.style.position="absolute",this.refreshRenderSize("init"),window.ResizeObserver&&(this._resizeObserver=new ResizeObserver(function(){e.refreshRenderSize("the container size has changed.")}),this._resizeObserver.observe(this._containerDom))),t}},{key:"refreshRenderSize",value:function(e){if(this._rotateDom){this.logger.print("refreshRenderSize","Because ".concat(e));var t,r,i,n,o=Number(window.getComputedStyle(this._containerDom).width.replace("px","")),a=Number(window.getComputedStyle(this._containerDom).height.replace("px","")),s=null===(t=this._videoDom)||void 0===t?void 0:t.videoWidth,c=null===(r=this._videoDom)||void 0===r?void 0:r.videoHeight;if(o&&a&&c&&s){if(this.renderMode===pn.RENDER_MODE_FILL)i=a,n=o;else{var d=this.renderMode===pn.RENDER_MODE_HIDDEN?Math.max(o/c,a/s):Math.min(o/c,a/s);i=s*d,n=c*d}this._rotateDom.style.width="".concat(i,"px"),this._rotateDom.style.height="".concat(n,"px"),this._rotateDom.style.left="".concat((o-i)/2,"px"),this._rotateDom.style.top="".concat((a-n)/2,"px")}}}},{key:"_initListeners",value:function(){var e=this;this._videoDom&&yW.forEach(function(t){var r;null===(r=e._videoDom)||void 0===r||r.addEventListener(t,e.emitVideoEvent)})}},{key:"_removeListeners",value:function(){var e=this;this._videoDom&&yW.forEach(function(t){var r;null===(r=e._videoDom)||void 0===r||r.removeEventListener(t,e.emitVideoEvent)})}},{key:"setRenderMode",value:function(e){this.renderMode=e,this._videoDom&&(this.renderMode===pn.RENDER_MODE_FIT?this._videoDom.style.objectFit="contain":this.renderMode===pn.RENDER_MODE_FILL?this._videoDom.style.objectFit="fill":this._videoDom.style.objectFit="cover")}},{key:"playVideo",value:(t=sk(sI().mark(function e(t){var r,i,n,o,a=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._videoDom,this.logger.info("playVideo","play video track: ".concat(this.userId)),!(n&&n.srcObject instanceof MediaStream&&n.srcObject.getTrackById(null===(r=t.preprocessingTrack)||void 0===r?void 0:r.id))){e.next=5;break}try{mw(this.engineId,"playVideo","play video repeatedly",0,this.userId)}catch(e){}return e.abrupt("return");case 5:n||(this._initVideo(),n=this._videoDom),this.logger.info("playVideo","play video by dom: ".concat(null===(i=n)||void 0===i?void 0:i.id)),(o=new MediaStream).addTrack(t.preprocessingTrack),n.srcObject=o,n&&!this._containerDom.contains(this._videoContainer)&&this._containerDom.appendChild(this._videoContainer),n&&!this._videoContainer.contains(n)&&this._videoContainer.appendChild(n),setTimeout(function(){return a._internalPlay()}),vx.VIDEO_STALL&&this.emit(yF.START_STALL_OBSERVE),this.played=!0;case 15:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"updateSrcObject",value:function(e){var t=e.preprocessingTrack;if(t&&this._videoDom){var r=new MediaStream;r.addTrack(t),this._videoDom.srcObject=r}}},{key:"removeTrack",value:function(){var e,t=null===(e=this._videoDom)||void 0===e?void 0:e.srcObject;if(t){var r=t.getVideoTracks();null!=r&&r.length&&r.forEach(function(e){t.removeTrack(e)})}}},{key:"manuallyPlay",value:function(){if(this.logger.info("Invoke VideoPlayer.manuallyPlay",this.userId,this.isScreen),this._emitPlayFailed=!1,this._hasManuallyPaused=!1,!this._videoDom)throw new pB(h6.INVALID_PARAMS,"Player not found");return 0!==this._videoDom.readyState||vo?this._videoDom.play():sP.resolve()}},{key:"manuallyPause",value:function(){if(this.logger.print("Invoke VideoPlayer.manuallyPause",this.userId,this.isScreen),this.played){if(this._hasManuallyPaused=!0,!this._videoDom)throw new pB(h6.INVALID_PARAMS,"Player not found");return this._videoDom.pause()}}},{key:"mirror",value:function(e){var t;this.logger.info("mirror",sN(t="".concat(this.userId," set mirror: ")).call(t,e)),this.mirrorType=e?pl.MIRROR_TYPE_RENDER:pl.MIRROR_TYPE_NONE,this._videoDom&&(this._videoDom.style.transform=e?"rotateY(180deg)":"")}},{key:"stop",value:function(){var e,t,r,i=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=this._containerDom;this.logger.info("stop",sN(e="stop video track: ".concat(this.userId," ")).call(e,this.playerId.toString())),this._videoDom&&(n||(this._videoDom.srcObject=null),null!=o&&o.contains(this._videoContainer)&&o.removeChild(this._videoContainer),null===(t=this._videoContainer)||void 0===t||t.childNodes.forEach(function(e){e!==i._videoDom&&e!==i._rotateDom||i._videoContainer.removeChild(e)}),null!==(r=this._rotateDom)&&void 0!==r&&r.contains(this._videoDom)&&this._rotateDom.removeChild(this._videoDom)),this._hasManuallyPaused=!1,this.played=!1,vx.VIDEO_STALL&&this.emit(yF.STOP_STALL_OBSERVE),this._closeIntersectionObserver()}},{key:"destroy",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger.info("destroy","video player: ".concat(this.userId)),this.stop(t),null===(e=this._resizeObserver)||void 0===e||e.disconnect(),hf(hp(i.prototype),"removeAllListeners",this).call(this),this._removeListeners(),y_.off(yf.ON_IOS_LOCAL_TRACK_MUTE,this._onLocalTrackMute),y_.off(yf.ON_IOS_LOCAL_TRACK_UNMUTE,this._onInterruptionEnd),y_.off(yf.ON_IOS_INTERRUPTION_END,this._onInterruptionEnd),this._videoDom&&delete this._videoDom,this._safari15VideoTimer&&(window.clearInterval(this._safari15VideoTimer),this._safari15VideoTimer=void 0)}},{key:"domElement",get:function(){return this._videoDom}}]),i}(),yQ=function(e){hA(n,EN.EventEmitter);var t,r,i=hI(n);function n(e,t){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{divId:void 0,muted:!1,isScreen:!1},a=o.divId,s=o.muted,c=o.isScreen;if(nK(this,n),nQ(he(r=i.call(this)),"_containerDom",void 0),nQ(he(r),"_audioDom",void 0),nQ(he(r),"_fakeAudioDom",void 0),nQ(he(r),"userId",void 0),nQ(he(r),"muted",!1),nQ(he(r),"_emitPlayFailed",!1),nQ(he(r),"played",!1),nQ(he(r),"isScreen",void 0),nQ(he(r),"_wechatTimer",void 0),nQ(he(r),"_edgeTimer",void 0),nQ(he(r),"_monitor",void 0),nQ(he(r),"logger",void 0),nQ(he(r),"_pasued",!0),nQ(he(r),"emitAudioEvent",function(e){var t,i,n,o,a={type:"audio",rawEvent:e,readyState:(null===(t=r._audioDom)||void 0===t?void 0:t.readyState)||0,userId:r.userId,eventName:e.type,currentTime:(null===(i=r._audioDom)||void 0===i?void 0:i.currentTime)||0};"playing"===e.type&&r.logger.info("AudioPlayerPlaying","[userId-".concat(r.userId,"] audio element playing")),"pause"===e.type&&(r.logger.info("AudioPlayerPause","[userId-".concat(r.userId,"] audio element pause")),!r._pasued&&null!==(n=r._audioDom)&&void 0!==n&&null!==(o=n.srcObject)&&void 0!==o&&o.active&&r._internalPlay()),vc&&vo&&("canplay"===e.type?(clearTimeout(r._wechatTimer),r._wechatTimer=setTimeout(function(){r._autoPlayError("wechat")},500)):"playing"===e.type&&clearTimeout(r._wechatTimer)),va&&ve&&"error"===e.type&&(clearTimeout(r._edgeTimer),r._edgeTimer=setTimeout(function(){var e;0===(null===(e=r._audioDom)||void 0===e?void 0:e.currentTime)&&r._autoPlayError("edge")},500)),r.emit("playback_event",a)}),nQ(he(r),"_internalPlay",function(){if(mw(r.engineId,"audio _internalPlay",{paused:null===(n=r._audioDom)||void 0===n?void 0:n.paused,userId:r.userId,screen:r.isScreen}),null!==(o=r._audioDom)&&void 0!==o&&o.paused)try{var e,t,i,n,o,a,s=r._audioDom.play(),c=yS.getAudioContextInstance();if("suspended"===c.state){var d=c.resume(),u=setTimeout(function(){var e;"suspended"===c.state&&(r._autoPlayError("AudioContext cannot resume"),null===(e=r._monitor)||void 0===e||e.report("rtc_error",{message:"audio autoplay failed, userId: ".concat(r.userId,": Cannot resume the AudioContext - timeout"),error_code:yL.AUTOPLAY_FAILED})),clearTimeout(u)});d.catch(function(e){var t,i,n;r._autoPlayError("AudioContext cannot resume"),null===(t=r._monitor)||void 0===t||t.report("rtc_error",{message:sN(i=sN(n="audio autoplay failed, userId: ".concat(r.userId,": Cannot resume the AudioContext - rejected by: [")).call(n,null==e?void 0:e.name,"]")).call(i,null==e?void 0:e.message),error_code:yL.AUTOPLAY_FAILED})}).finally(function(){clearTimeout(u)})}null!==(a=s)&&void 0!==a&&a.then&&(vc&&va&&(s=s.then(function(){return new sP(function(e){setTimeout(sk(sI().mark(function t(){var i;return sI().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return null===(i=r._audioDom)||void 0===i||i.pause(),r._audioDom.volume=1,t.next=4,r._audioDom.play();case 4:e();case 5:case"end":return t.stop()}},t)})),500)})})),s.then(function(){mw(r.engineId,"_internalPlay successfully",{userId:r.userId,screen:r.isScreen}),r._pasued=!1}).catch(function(e){var t,i,n;r._autoPlayError(e),null===(t=r._monitor)||void 0===t||t.report("rtc_error",{message:sN(i=sN(n="audio autoplay failed, userId: ".concat(r.userId,": ")).call(n,e.message," ")).call(i,e.name),error_code:yL.AUTOPLAY_FAILED})}))}catch(n){r._autoPlayError(n),null===(e=r._monitor)||void 0===e||e.report("rtc_error",{message:sN(t=sN(i="audio autoplay failed, userId: ".concat(r.userId,": ")).call(i,n.message," ")).call(t,n.name),error_code:yL.AUTOPLAY_FAILED})}}),r.engineId=e,a){var d=document.getElementById(a);if(!d)throw new pB(h6.CANT_FIND_DOM,"can't find dom");r._containerDom=d}else r._containerDom=document.body;return r.userId=t,r.muted=s,r.isScreen=c,r._monitor=mS(e),r.logger=new mJ("Player",0,e),r._initAudio(),r}return nY(n,[{key:"_initAudio",value:function(){var e;this._audioDom||(this._audioDom=yb("audio",{style:{display:"none"},attributes:yH}),this._audioDom.volume=this.muted?0:1,this._audioDom.muted=this.muted,this._audioDom.id=sN(e="".concat(this.userId,"_")).call(e,v$()),this._containerDom.appendChild(this._audioDom)),this._initListeners()}},{key:"_initListeners",value:function(){var e=this;this._audioDom&&yW.forEach(function(t){var r;null===(r=e._audioDom)||void 0===r||r.addEventListener(t,e.emitAudioEvent)})}},{key:"_removeListeners",value:function(){var e=this;this._audioDom&&(yW.forEach(function(t){var r;null===(r=e._audioDom)||void 0===r||r.removeEventListener(t,e.emitAudioEvent)}),this._audioDom.removeEventListener("canplay",this._internalPlay),this._audioDom.removeEventListener("loadeddata",this._internalPlay))}},{key:"playAudio",value:(r=sk(sI().mark(function e(t){var r,i,n,o,a,s=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("playAudio","play audio track: ".concat(this.userId)),!((o=this._audioDom)&&o.srcObject instanceof MediaStream&&o.srcObject.getTrackById(null===(r=t.preprocessingTrack)||void 0===r?void 0:r.id))){e.next=4;break}return e.abrupt("return");case 4:o||(this._initAudio(),o=this._audioDom),a=new MediaStream,t instanceof yJ&&(this._fakeAudioDom=new Audio,this._fakeAudioDom.muted=!0,this._fakeAudioDom.srcObject=new MediaStream([t.originTrack])),a.addTrack(t.preprocessingTrack),vc&&va&&(this._audioDom.volume=0),o.srcObject=a,null===(i=o)||void 0===i||i.addEventListener("canplay",this._internalPlay),null===(n=o)||void 0===n||n.addEventListener("loadeddata",this._internalPlay),setTimeout(function(){return s._internalPlay()}),this.played=!0;case 13:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_autoPlayError",value:function(e){var t,r;this._emitPlayFailed||(this._emitPlayFailed=!0,this.emit("playback_event",{type:"audio",rawEvent:e,readyState:(null===(t=this._audioDom)||void 0===t?void 0:t.readyState)||0,userId:this.userId,eventName:"autoplay-error",currentTime:(null===(r=this._audioDom)||void 0===r?void 0:r.currentTime)||0}))}},{key:"pause",value:function(){if(!this._audioDom)throw new pB(h6.INVALID_PARAMS,"Player not found");this._pasued=!0,this._audioDom.pause()}},{key:"manuallyPause",value:function(){return this.pause()}},{key:"manuallyPlay",value:function(){var e,t=this;if(this.logger.info("Invoke AudioPlayer.manuallyPlay"),this._emitPlayFailed=!1,!this._audioDom)throw new pB(h6.INVALID_PARAMS,"Player not found");if(!this.played)return sP.resolve();this._audioDom.volume=1,this._audioDom.muted=!1,null===(e=this._fakeAudioDom)||void 0===e||e.play();var r=[],i=this._audioDom.play();null!=i&&i.then&&r.push(i);var n=yS.getAudioContextInstance();if("suspended"===n.state){var o=n.resume();null!=o&&o.then&&r.push(o)}(r.length>0?sP.all(r):sP.resolve(i)).then(function(){t._pasued=!1})}},{key:"setPlaybackDevice",value:(t=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setPlaybackDevice","setPlaybackDevice: ".concat(t)),e.next=3,yT.enumerateAudioPlaybackDevices();case 3:if(cd(i=sU(r=e.sent).call(r,function(e){return e.deviceId})).call(i,t)&&this._audioDom&&this._audioDom.setSinkId){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this._audioDom.setSinkId(t);case 9:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"stop",value:function(){var e=this._containerDom;this.logger.info("stopAudio","stop audio track: ".concat(this.userId)),this._audioDom&&(this._audioDom.srcObject=null,null!=e&&e.contains(this._audioDom)&&e.removeChild(this._audioDom)),this._fakeAudioDom&&(this._fakeAudioDom.srcObject=null,this._fakeAudioDom=void 0),this.played=!1}},{key:"domElement",get:function(){return this._audioDom}},{key:"destroy",value:function(){this.logger.info("destroy","audio player: ".concat(this.userId)),this.stop(),hf(hp(n.prototype),"removeAllListeners",this).call(this),this._removeListeners(),this._audioDom&&(this._audioDom.srcObject=null,delete this._audioDom),this._edgeTimer&&clearTimeout(this._edgeTimer)}}]),n}(),yz=function(){function e(){nK(this,e),nQ(this,"_ac",void 0),nQ(this,"_sourceNode",void 0),nQ(this,"_gainNode",void 0),nQ(this,"_destNode",void 0),this._ac=yS.getAudioContextInstance(),this._gainNode=this._ac.createGain(),this._destNode=this._ac.createMediaStreamDestination(),this._gainNode.connect(this._destNode)}return nY(e,[{key:"setVolume",value:function(e){this._gainNode.gain.value=e/100}},{key:"getVolume",value:function(){return Math.round(100*this._gainNode.gain.value)}},{key:"updateInputTrack",value:function(e){this._sourceNode&&(this._sourceNode.mediaStream.getTracks().forEach(function(e){e.stop()}),delete this._sourceNode);var t=new MediaStream;t.addTrack(e),this._sourceNode=this._ac.createMediaStreamSource(t),this._sourceNode.connect(this._gainNode)}},{key:"getOutputTrack",value:function(){return this._destNode.stream.getTracks()[0]}},{key:"destroy",value:function(){var e,t;null===(e=this._sourceNode)||void 0===e||e.mediaStream.getTracks().forEach(function(e){e.stop()}),13!==v_&&this._destNode.stream.getTracks().forEach(function(e){e.stop()}),null===(t=this._sourceNode)||void 0===t||t.disconnect(),this._gainNode.disconnect(),delete this._sourceNode}}]),e}(),yX=function(e){hA(i,EX);var t,r=hI(i);function i(e,t,n){var o;return nK(this,i),nQ(he(o=r.call(this,e,t,l9(l9({},n),{},{mediaType:EK.AUDIO}))),"audioCaptureConfig",void 0),nQ(he(o),"_ap",void 0),nQ(he(o),"mixedAudioTrack",void 0),nQ(he(o),"mixType",Ci.PLAYOUT_AND_PUBLISH),nQ(he(o),"_audioFetchMap",new d9),nQ(he(o),"_audioDataFetcher",void 0),nQ(he(o),"_localPlaybackTrack",void 0),nQ(he(o),"notSupportedWebAudio",!1),o}return nY(i,[{key:"withWebAudio",get:function(){return!!this._ap}},{key:"getAudioLevel",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pp.MICROPHONE,i=r===pp.AUDIOMIXING&&this.mixType!==Ci.PLAYOUT&&null!==(e=this.mixedAudioTrack)&&void 0!==e?e:this.preprocessingTrack,n=this._audioFetchMap.get(r);return n&&n.currentTrackId===i.id||(null===(t=n)||void 0===t||t.destroy(),n=new yE(i),this._audioFetchMap.set(r,n)),n.getAudioLevel()}},{key:"updateAudioCaptureConfig",value:(t=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioCaptureConfig){e.next=2;break}return e.abrupt("return");case 2:return this.logger.print("updateAudioCaptureConfig","update localAudioTrack: ",this.audioCaptureConfig),e.next=5,this.originTrack.applyConstraints(this.audioCaptureConfig);case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"setVolume",value:function(e){var t=!vB("SKIP_WEB_AUDIO_IN_TRACK")&&gn();t||(this.notSupportedWebAudio=!0);var r,i=!this.withWebAudio&&100!==e;try{t&&i&&(this.logger.print("Create AudioProcess"),this._ap=new yz,this._ap.updateInputTrack(this.originTrack),this.mediaTrack=this._ap.getOutputTrack())}catch(e){this.logger.warn("WebAudio may not supported, quired return"),this.notSupportedWebAudio=!0}this.notSupportedWebAudio||null===(r=this._ap)||void 0===r||r.setVolume(e),t&&i&&this.emit("needReplaceTrack",this)}},{key:"getVolume",value:function(){return this._ap?this._ap.getVolume():100}},{key:"setUserId",value:function(e){this.trackInfo.streamUserId=e}},{key:"setDataFetcher",value:function(e,t){this.logger.info("setDataFetcher","frameSize %s",e),null!==yS.isWorkletReady?this._audioDataFetcher?this._audioDataFetcher.setFrameSize(e):(this._audioDataFetcher=new yg(this.preprocessingTrack,e),this._audioDataFetcher.on("data",t)):this.logger.info("setDataFetcher","audioContextManager.isWorkletReady is null")}},{key:"stopDataFetcher",value:function(){var e,t;null===(e=this._audioDataFetcher)||void 0===e||e.removeAllListeners("data"),null===(t=this._audioDataFetcher)||void 0===t||t.destroy(),this._audioDataFetcher=void 0}},{key:"play",value:function(e){var t,r,i=this;this._localPlaybackTrack&&this.stop();var n=e===pL.AFTER_CAPTURE?this.originTrack:e===pL.AFTER_PROCESS?this.preprocessingTrack:void 0;if(n){this._localPlaybackTrack=new yJ(this._ctx,n.clone(),l9({},this.trackInfo));var o=this._ctx.earMonitorSettings[null!==(t=this.streamIndex)&&void 0!==t?t:po.STREAM_INDEX_MAIN].volume;this.setPlaybackVolume(o);var a=new yQ(this._ctx.id,null!==(r=this.trackInfo.streamUserId)&&void 0!==r?r:"",{isScreen:this.streamIndex===po.STREAM_INDEX_SCREEN,muted:!1});return a.on("playback_event",function(e){var t;"autoplay-error"===e.eventName&&i.emit("autoplay-error",{kind:"audio",streamIndex:null!==(t=i.streamIndex)&&void 0!==t?t:po.STREAM_INDEX_MAIN,mediaType:EK.AUDIO})}),this._localPlaybackTrack.setPlayer(a),this._localPlaybackTrack.play()}this.logger.error("play()","no target track for %s",e)}},{key:"stop",value:function(){var e;null===(e=this._localPlaybackTrack)||void 0===e||e.destroy(),this._localPlaybackTrack=void 0}},{key:"setPlaybackVolume",value:function(e){var t;return null===(t=this._localPlaybackTrack)||void 0===t?void 0:t.setVolume(e)}},{key:"destroy",value:function(){var e,t;this._audioFetchMap.forEach(function(e){return e.destroy()}),this._audioFetchMap.clear(),null===(e=this._ap)||void 0===e||e.destroy(),null===(t=this._audioDataFetcher)||void 0===t||t.destroy(),this._audioDataFetcher=void 0,this.stop(),hf(hp(i.prototype),"destroy",this).call(this)}}]),i}(),yJ=function(e){hA(r,EJ);var t=hI(r);function r(e,i,n){var o;return nK(this,r),nQ(he(o=t.call(this,e,i,l9(l9({},n),{},{mediaType:EK.AUDIO}))),"_ap",void 0),nQ(he(o),"_audioPlayer",void 0),nQ(he(o),"_audioLevelFetcher",void 0),nQ(he(o),"_audioDataFetcher",void 0),nQ(he(o),"notSupportedWebAudio",!1),o}return nY(r,[{key:"withWebAudio",get:function(){return!!this._ap}},{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new yE(this.originTrack)),this._audioLevelFetcher.getAudioLevel()}},{key:"setVolume",value:function(e){var t=!vB("SKIP_WEB_AUDIO_IN_TRACK")&&gn();t||(this.notSupportedWebAudio=!0);var r,i,n=!this.withWebAudio&&100!==e;try{t&&n&&(this.logger.print("Create AudioProcess"),this._ap=new yz,this._ap.updateInputTrack(this.originTrack),this.mediaTrack=this._ap.getOutputTrack())}catch(e){this.logger.warn("WebAudio may not supported, quite return"),this.notSupportedWebAudio=!0}this.notSupportedWebAudio||null===(r=this._ap)||void 0===r||r.setVolume(e),t&&n&&(this.emit("needReplaceTrack",this),null===(i=this._audioPlayer)||void 0===i||i.playAudio(this))}},{key:"getVolume",value:function(){return this.notSupportedWebAudio?100:this._ap?this._ap.getVolume():100}},{key:"setPlaybackDevice",value:function(e){var t;return null===(t=this._audioPlayer)||void 0===t?void 0:t.setPlaybackDevice(e)}},{key:"setPlayer",value:function(e){this._audioPlayer=e}},{key:"havePlayer",value:function(){return!!this._audioPlayer}},{key:"bindPlayerEvent",value:function(e){var t;this._audioPlayer&&e(this._audioPlayer,this.isPublic,null!==(t=this.streamIndex)&&void 0!==t?t:po.STREAM_INDEX_MAIN)}},{key:"pause",value:function(){var e;return null===(e=this._audioPlayer)||void 0===e?void 0:e.pause()}},{key:"play",value:function(){var e;return null===(e=this._audioPlayer)||void 0===e?void 0:e.playAudio(this)}},{key:"manuallyPlay",value:function(){var e,t,r;return null!==(e=this._audioPlayer)&&void 0!==e&&e.played?null===(t=this._audioPlayer)||void 0===t?void 0:t.manuallyPlay():null===(r=this._audioPlayer)||void 0===r?void 0:r.playAudio(this)}},{key:"manuallyPause",value:function(){var e;return null===(e=this._audioPlayer)||void 0===e?void 0:e.manuallyPause()}},{key:"stop",value:function(){var e;return null===(e=this._audioPlayer)||void 0===e?void 0:e.stop()}},{key:"setDataFetcher",value:function(e,t){this.logger.info("setDataFetcher","frameSize %s",e),null!==yS.isWorkletReady?this._audioDataFetcher?this._audioDataFetcher.setFrameSize(e):(this._audioDataFetcher=new yg(this.originTrack,e),this._audioDataFetcher.on("data",t)):this.logger.warn("setDataFetcher","audioContextManager.isWorkletReady is null")}},{key:"stopDataFetcher",value:function(){var e;this.logger.info("stopDataFetcher"),null===(e=this._audioDataFetcher)||void 0===e||e.destroy(),this._audioDataFetcher=void 0}},{key:"destroy",value:function(){var e,t,i;null===(e=this._audioLevelFetcher)||void 0===e||e.destroy(),null===(t=this._audioDataFetcher)||void 0===t||t.destroy(),this._audioDataFetcher=void 0,this._ap&&this._ap.destroy(),null===(i=this._audioPlayer)||void 0===i||i.destroy(),this._audioPlayer=void 0,hf(hp(r.prototype),"destroy",this).call(this)}}]),r}(),yq=new mJ("VERTC",0),yZ=null;function y$(){if(yZ)return yZ;try{var e=(yZ=window.require("electron")).ipcRenderer;return yD={getSources:function(t){return e.invoke("DESKTOP_CAPTURER_GET_SOURCES",t)}},yZ}catch(e){return null}}function y0(e,t,r){return y2.apply(this,arguments)}function y2(){return(y2=sk(sI().mark(function e(t,r,i){var n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r||(r={width:1920,height:1080,frameRate:15}),n=i?{audio:{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",maxHeight:r.height,maxWidth:r.width,maxFrameRate:r.frameRate}}}:{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:r.height,maxWidth:r.width,maxFrameRate:r.frameRate}}},yq.info("getUserMediaConfig",sD(n)),e.next=5,navigator.mediaDevices.getUserMedia(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y1(e){return y4.apply(this,arguments)}function y4(){return(y4=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=["window","screen"],"window"===t&&(r=["window"]),"screen"===t&&(r=["screen"]),y$()){e.next=6;break}throw new pB(h6.ERR_ELECTRON_IS_NULL,"Unable to get Electron object");case 6:i=null;try{i=yD.getSources({types:r})}catch(e){i=null}return i&&i.then||(i=new sP(function(e,t){yD.getSources({types:r},function(r,i){r?t(r):e(i)})})),e.prev=9,e.next=12,i;case 12:return e.abrupt("return",e.sent);case 15:throw e.prev=15,e.t0=e.catch(9),new pB(h6.ERR_ELECTRON_IS_NULL,e.t0.toString());case 18:case"end":return e.stop()}},e,null,[[9,15]])}))).apply(this,arguments)}function y6(){return(y6=sk(sI().mark(function e(t,r){var i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y1();case 2:return i=e.sent,e.next=5,function(e){return new sP(function(t,r){var i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var n=document.createElement("div");n.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var o=document.createElement("div");o.innerText="Web Screensharing wants to share the contents of your screen. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");var a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var s=document.createElement("div");s.setAttribute("style","text-align: right; padding: 16px 0;");var c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=function(){document.body.removeChild(d);var e=Error("NotAllowedError");e.name="NotAllowedError",r(e)},s.appendChild(c),n.appendChild(o),n.appendChild(a),n.appendChild(s);var d=document.createElement("div");d.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),d.appendChild(i),d.appendChild(n),document.body.appendChild(d),sU(e).call(e,function(e){if(e.id){var r,i=document.createElement("div");i.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;"),i.innerHTML=sN(r="<div style='height: 120px; display: table-cell; vertical-align: middle;'> \n          <img style='width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);' src=\n          ".concat(e.thumbnail.toDataURL(),"\n           />\n          </div>\n          <span style='	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;'>\n          ")).call(r,e.name,"\n          </span>"),i.onclick=function(){document.body.removeChild(d),t(e.id)},a.appendChild(i)}})})}(i);case 5:return n=e.sent,e.next=8,y0(n,t,r);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y3(){return(y3=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new yj(t,r,{streamIndex:EQ.MAIN,sourceType:EY.INTERNAL,isDummy:!0}),e.next=3,i.isTrackReady;case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y8(){return(y8=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new yj(t,r,{isDummy:!0,streamIndex:EQ.SCREEN,sourceType:EY.INTERNAL}),e.next=3,i.isTrackReady;case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y5(e,t){return y9.apply(this,arguments)}function y9(){return(y9=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=(null===(i=(r=r||t.videoProfile.getCaptureConfig()).deviceId)||void 0===i?void 0:i.exact)||"default",a=f2(),s=new mJ("TrackFactory",0,t.id),e.prev=4,s.info("createCameraVideoTrack","constraints:",r),null===(c=t.monitor)||void 0===c||c.report("rtc_video_capture_event",{event_type:"start",media_device_id:o,capture_session_id:a}),l=v0(),m4&&(r.frameRate={ideal:30,max:30}),e.next=11,yT.getUserMedia({video:r});case 11:n=e.sent,null===(d=t.monitor)||void 0===d||d.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:o,media_device_name:(null===(u=n.getVideoTracks()[0])||void 0===u?void 0:u.label)||"",reason:"success",elapse:v0()-l,capture_session_id:a}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(4),null===(h=t.monitor)||void 0===h||h.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message,capture_session_id:a}),new pB(h6.GET_VIDEO_TRACK_FAILED,sN(p="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(p,e.t0.message||"unknown message","."),e.t0);case 19:return f=new yj(t,n.getVideoTracks()[0],{streamIndex:EQ.MAIN,sourceType:EY.INTERNAL,captureSessionId:a}),e.next=23,f.isTrackReady;case 23:return e.abrupt("return",f);case 24:case"end":return e.stop()}},e,null,[[4,15]])}))).apply(this,arguments)}function y7(e,t){return Re.apply(this,arguments)}function Re(){return(Re=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return new mJ("TrackFactory",0,t.id).info("createMicrophoneAudioTrack","constraints:",r),o=(null===(i=r.deviceId)||void 0===i?void 0:i.exact)||"default",a=f2(),e.prev=4,null===(s=t.monitor)||void 0===s||s.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_begin",media_device_id:o,event_session_id:a}),u=v0(),t.extensionManager.getPluginByName(ys.PRE_PROCESSING,"RTCAIAnsExtension")&&(r.autoGainControl=!0,r.noiseSuppression=!1),e.next=11,yT.getUserMedia({audio:r});case 11:n=e.sent,null===(c=t.monitor)||void 0===c||c.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_result",media_device_id:o,media_device_name:(null===(d=n.getAudioTracks()[0])||void 0===d?void 0:d.label)||"",reason:"success",elapse:v0()-u,event_session_id:a}),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(4),null===(l=t.monitor)||void 0===l||l.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_end",media_device_id:o,error_code:e.t0.code,reason:e.t0.name+e.t0.message,event_session_id:a}),new pB(h6.GET_AUDIO_TRACK_FAILED,sN(h="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(h,e.t0.message||"unknown message","."),e.t0);case 19:return p=new yX(t,n.getAudioTracks()[0],{streamIndex:EQ.MAIN,sourceType:EY.INTERNAL,captureSessionId:a}),e.next=23,p.isTrackReady;case 23:return e.abrupt("return",p);case 24:case"end":return e.stop()}},e,null,[[4,15]])}))).apply(this,arguments)}function Rt(){return(Rt=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return new mJ("TrackFactory",0,t.id).print("createCameraAndMicrophoneTrack","audioConstraints:",r,"videoConstraints:",i),s=(null===(n=r.deviceId)||void 0===n?void 0:n.exact)||"default",c=(null===(o=i.deviceId)||void 0===o?void 0:o.exact)||"default",d=f2(),u=f2(),e.prev=6,null===(l=t.monitor)||void 0===l||l.report("rtc_video_capture_event",{event_type:"start",media_device_id:c,capture_session_id:d}),null===(h=t.monitor)||void 0===h||h.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_begin",media_device_id:s,event_session_id:u}),m=v0(),m4&&(i.frameRate={ideal:30,max:30}),t.extensionManager.getPluginByName(ys.PRE_PROCESSING,"RTCAIAnsExtension")&&(r.autoGainControl=!0,r.noiseSuppression=!1),e.next=15,yT.getUserMedia({audio:r,video:i});case 15:a=e.sent,null===(p=t.monitor)||void 0===p||p.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:c,media_device_name:(null===(f=a.getVideoTracks()[0])||void 0===f?void 0:f.label)||"",reason:"success",elapse:v0()-m,capture_session_id:d}),null===(_=t.monitor)||void 0===_||_.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_result",media_device_id:s,media_device_name:(null===(A=a.getAudioTracks()[0])||void 0===A?void 0:A.label)||"",reason:"success",elapse:v0()-m,event_session_id:u}),e.next=25;break;case 20:throw e.prev=20,e.t0=e.catch(6),null===(v=t.monitor)||void 0===v||v.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:c,error_code:e.t0.code,reason:e.t0.name+e.t0.message,capture_session_id:d}),null===(E=t.monitor)||void 0===E||E.report("rtc_audio_device_event",{device_type:"audio_record",event_type:"start_end",media_device_id:s,error_code:e.t0.code,reason:e.t0.name+e.t0.message,event_session_id:u}),new pB(h6.GET_VIDEO_TRACK_FAILED,sN(g="throw error from getUserMedia. [".concat(e.t0.name||"unknown name","]: ")).call(g,e.t0.message||"unknown message","."),e.t0);case 25:return S=new yj(t,a.getVideoTracks()[0],{streamIndex:EQ.MAIN,sourceType:EY.INTERNAL,captureSessionId:d}),b=new yX(t,a.getAudioTracks()[0],{streamIndex:EQ.MAIN,sourceType:EY.INTERNAL,captureSessionId:u}),e.next=31,sP.all([S.isTrackReady,b.isTrackReady]);case 31:return e.abrupt("return",{videoTrack:S,audioTrack:b});case 32:case"end":return e.stop()}},e,null,[[6,20]])}))).apply(this,arguments)}function Rr(){return(Rr=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=new mJ("TrackFactory",0,t.id),c=t.videoProfile.getScreenEncodeConfig(),s.info("createScreenTracks","screenConfig: %o, constraints: %o",r,c),u=f2(),h=void 0!==(l=r.enableAudio)&&l,p=r.displaySurface,f=r.systemAudio,_=r.surfaceSwitching,A=r.selfBrowserSurface,m=r.sourceId,v={},p&&cd(i=["monitor","browser","window"]).call(i,p)&&(c?c.displaySurface=p:c={displaySurface:p}),f&&cd(n=["include","exclude"]).call(n,f)&&(v.systemAudio=f),_&&cd(o=["include","exclude"]).call(o,_)&&(v.surfaceSwitching=_),A&&cd(a=["include","exclude"]).call(a,A)&&(v.selfBrowserSurface=A),e.prev=10,null===(E=t.monitor)||void 0===E||E.report("rtc_video_capture_event",{event_type:"start",media_device_id:"screen",capture_session_id:u}),y=v0(),!y$()){e.next=25;break}if(!m){e.next=20;break}return e.next=17,y0(m,c,h);case 17:d=e.sent,e.next=23;break;case 20:return e.next=22,function(e,t){return y6.apply(this,arguments)}(c,h);case 22:d=e.sent;case 23:e.next=28;break;case 25:return e.next=27,navigator.mediaDevices.getDisplayMedia(l9({video:!(c&&(!m6||"16.1"!==vm))||c,audio:!!h&&{channelCount:2,noiseSuppression:!1,echoCancellation:!0,autoGainControl:!1}},v));case 27:d=e.sent;case 28:null===(g=t.monitor)||void 0===g||g.report("rtc_video_capture_event",{event_type:"start_capture_result",media_device_id:"screen",media_device_name:sN(S="".concat((null===(b=d.getVideoTracks()[0])||void 0===b?void 0:b.label)||"",", ")).call(S,(null===(T=d.getAudioTracks()[0])||void 0===T?void 0:T.label)||""),reason:"success",elapse:v0()-y,capture_session_id:u}),e.next=35;break;case 31:throw e.prev=31,e.t0=e.catch(10),null===(R=t.monitor)||void 0===R||R.report("rtc_video_capture_event",{event_type:"running_failed",media_device_id:"screen",error_code:e.t0.code,reason:e.t0.name+e.t0.message,capture_session_id:u}),new pB(h6.GET_SCREEN_TRACK_FAILED,"throw error from getDisplayMedia",e.t0);case 35:if(I=new yj(t,d.getVideoTracks()[0],{streamIndex:EQ.SCREEN,sourceType:EY.INTERNAL,captureSessionId:u}),C=d.getAudioTracks()[0],!d.getAudioTracks().length){e.next=43;break}return k=new yX(t,C,{streamIndex:EQ.SCREEN,sourceType:EY.INTERNAL,captureSessionId:u}),e.next=42,sP.all([I.isTrackReady,k.isTrackReady]);case 42:return e.abrupt("return",[I,k]);case 43:return e.next=45,I.isTrackReady;case 45:return e.abrupt("return",[I,void 0]);case 46:case"end":return e.stop()}},e,null,[[10,31]])}))).apply(this,arguments)}function Ri(e,t,r){return new yJ(e,t,l9({},r))}function Rn(){return(Rn=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new yj(t,r,{streamIndex:EQ.MAIN,sourceType:EY.EXTERNAL}),e.next=3,i.isTrackReady;case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ro(){return(Ro=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new yX(t,r,{streamIndex:EQ.MAIN,sourceType:EY.EXTERNAL}),e.next=3,i.isTrackReady;case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ra(){return(Ra=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new yj(t,r,{sourceType:EY.EXTERNAL,streamIndex:EQ.SCREEN}),e.next=3,i.isTrackReady;case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Rs(){return(Rs=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new yX(t,r,{sourceType:EY.EXTERNAL,streamIndex:EQ.SCREEN}),e.next=3,i.isTrackReady;case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Rc,Rd,Ru,Rl,Rh,Rp,Rf,R_=function(e){hA(r,EL);var t=hI(r);function r(e){var i;return nK(this,r),nQ(he(i=t.call(this)),"isScreen",!1),nQ(he(i),"audioMid",void 0),nQ(he(i),"videoMid",void 0),nQ(he(i),"audioMLine",void 0),nQ(he(i),"videoMLine",void 0),nQ(he(i),"videoTransceiver",void 0),nQ(he(i),"audioTransceiver",void 0),nQ(he(i),"vendorHandler",void 0),nQ(he(i),"vendorCode",0),nQ(he(i),"engineId",void 0),nQ(he(i),"logger",void 0),nQ(he(i),"logName","StreamBase"),nQ(he(i),"__seiHelper",gT),i._ctx=e,i.engineId=e.id,i.logger=new mJ(i.constructor.name,2,e.id),i}return nY(r,[{key:"stopReport",value:function(e){this.statsReport.stopReport(e)}},{key:"destroy",value:function(){var e,t;delete this.audioMid,delete this.videoMid,this.statsReport.destroy(),null===(e=this.observer)||void 0===e||e.reset(),delete this.videoTransceiver,delete this.audioTransceiver,null===(t=this.vendorHandler)||void 0===t||t.destroy(),this.vendorCode=0,delete this.vendorHandler,hf(hp(r.prototype),"removeAllListeners",this).call(this)}}]),r}(),RA=((Rc=RA||{})[Rc.INIT=0]="INIT",Rc[Rc.SUB_ING=1]="SUB_ING",Rc[Rc.SUB_ED=2]="SUB_ED",Rc),Rm=function(e){hA(i,R_);var t,r=hI(i);function i(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yc.STREAM_INDEX_MAIN;nK(this,i),nQ(he(t=r.call(this,e)),"id",void 0),nQ(he(t),"stream",void 0),nQ(he(t),"streamId",void 0),nQ(he(t),"seiList",[]),nQ(he(t),"videoTrack",void 0),nQ(he(t),"audioTrack",void 0),nQ(he(t),"subVideoDescriptions",[]),nQ(he(t),"observer",void 0),nQ(he(t),"statsReport",void 0),nQ(he(t),"pubAudio",!1),nQ(he(t),"pubVideo",!1),nQ(he(t),"blackFrameRenderInterval",void 0),nQ(he(t),"blackFrameLifetimeInterval",void 0),nQ(he(t),"pubAttributes",void 0),nQ(he(t),"pcSessionId",void 0),nQ(he(t),"maxSeiCount",1),nQ(he(t),"preReports",{audio:{},video:{}}),nQ(he(t),"remoteSdp",void 0),nQ(he(t),"currentVideoCodec",void 0),nQ(he(t),"_changeCodecs",[]),nQ(he(t),"_videoCaps",[]),nQ(he(t),"logName","LocalStream"),nQ(he(t),"transformer",function(e,r){var i;if(t.seiList.length){var n,o=[],a=0,s=sz(t.seiList);try{for(s.s();!(n=s.n()).done;){var c=n.value;if(o.length>=t.maxSeiCount)break;var d=gT.generateSEI(c.content,RE(e));a+=d.byteLength,c.repeatCount--,o.push(d)}}catch(e){s.e(e)}finally{s.f()}t.seiList=s8(i=t.seiList).call(i,function(e){return e.repeatCount>0});var u=new Uint8Array(a+e.data.byteLength);u.set(new Uint8Array(e.data));var l=e.data.byteLength;o.forEach(function(e){u.set(e,l),l+=e.byteLength}),e.data=u.buffer,r.enqueue(e)}else r.enqueue(e)}),t.stream=new MediaStream,t.id=f2(),t.pubAttributes={localaudio:!1,localvideo:!1,videostream:!1,audiostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[],videoType:EH.NORMAL},t.isScreen=n===yc.STREAM_INDEX_SCREEN,t.statsReport=new yr(e,he(t));var o=vB("SEI_COUNT_FPS");return"number"==typeof o&&o<=10&&(t.maxSeiCount=o),t}return nY(i,[{key:"enableSimulcast",get:function(){return!this.isScreen&&this._ctx.videoProfile.getSimulcastMode()}},{key:"videoEncodeConfig",get:function(){return this.isScreen?[this._ctx.videoProfile.getScreenEncodeConfig()]:this._ctx.videoProfile.getVideoEncodeConfig()}},{key:"audioHasCapture",get:function(){return this.pubAttributes.localaudio}},{key:"audioHasPublish",get:function(){return this.pubAttributes.audiostream}},{key:"videoHasCapture",get:function(){return this.pubAttributes.localvideo}},{key:"videoHasPublish",get:function(){return this.pubAttributes.videostream}},{key:"hasPublished",get:function(){return!!this.audioMid&&!!this.videoMid}},{key:"isEmptyStream",get:function(){return!this.audioTrack&&!this.videoTrack}},{key:"initStreamId",get:function(){return this.stream.id}},{key:"getSelectedCodec",value:(t=sk(sI().mark(function e(){var t,r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._changeCodecs.length>0)){e.next=4;break}e.t0=this._changeCodecs,e.next=12;break;case 4:if(!(this._videoCaps.length>0)){e.next=8;break}e.t1=this._videoCaps,e.next=11;break;case 8:return e.next=10,E0();case 10:e.t1=e.sent;case 11:e.t0=e.t1;case 12:if(r=e.t0,i=this._ctx.videoProfile.getPreferCodec(this.isScreen),n=this.isScreen?this._ctx.targetScreenCodec:this._ctx.targetCodec,!i||i===pu.AUTO){e.next=26;break}if(i!==pu.H264||!cd(r).call(r,EZ.H264)){e.next=20;break}return e.abrupt("return",EZ.H264);case 20:if(i!==pu.VP8||!cd(r).call(r,EZ.VP8)){e.next=24;break}return e.abrupt("return",EZ.VP8);case 24:if(i!==pu.ByteVC1||!cd(r).call(r,EZ.ByteVC1)){e.next=26;break}return e.abrupt("return",EZ.ByteVC1);case 26:if(null===(t=this._ctx.serverConfig)||void 0===t||!t.videoCodec||!cd(r).call(r,this._ctx.serverConfig.videoCodec)){e.next=28;break}return e.abrupt("return",this._ctx.serverConfig.videoCodec);case 28:if(!(i===pu.AUTO&&r.length>0)){e.next=30;break}return e.abrupt("return",r[0]);case 30:if(!n||!cd(r).call(r,n)){e.next=32;break}return e.abrupt("return",n);case 32:if(!cd(r).call(r,EZ.H264)){e.next=34;break}return e.abrupt("return",EZ.H264);case 34:if(!cd(r).call(r,EZ.VP8)){e.next=38;break}return e.abrupt("return",EZ.VP8);case 38:throw Error("no available codec");case 39:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"startReport",value:function(e,t){this.statsReport.setLocalStreamStatsEvtInterval(e,t)}},{key:"getLocalStreamStats",value:function(){return this.statsReport.getLocalStats()}},{key:"initVideoEncodedTransform",value:function(){if(this.videoTransceiver&&this.videoTransceiver.sender){var e=this.videoTransceiver.sender;if(gi()){var t=e.createEncodedStreams(),r=t.readable,i=t.writable,n=new TransformStream({transform:this.transformer});r.pipeThrough(n).pipeTo(i)}}else this.logger.warn("no sender found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.sender){var e=this.audioTransceiver.sender.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrough(new TransformStream({transform:function(e,t){t.enqueue(e)}})).pipeTo(r)}else this.logger.warn("no sender found when trying to bind encodedTransform")}},{key:"clean",value:function(){mw(this.engineId,"localstream_clean","".concat(Error().stack),0,this.streamId||""),hf(hp(i.prototype),"destroy",this).call(this),this.subVideoDescriptions=[],clearTimeout(this.blackFrameLifetimeInterval),clearInterval(this.blackFrameRenderInterval)}},{key:"switchTrackEnableState",value:function(e,t){"audio"===e?i=this.audioTrack:"video"===e&&(i=this.videoTrack);var r,i,n=null===(r=i)||void 0===r?void 0:r.mediaTrack;return!(!n||(null==n?void 0:n.enabled)===t)&&(n.enabled=t,!0)}},{key:"resetStream",value:function(){this.stream=new MediaStream}},{key:"genBlackFrame",value:function(){this.logger.info("genBlackFrame()");var e,t,r=null!==(e=this.videoEncodeConfig[0])&&void 0!==e&&e.frameRate?Ec(null===(t=this.videoEncodeConfig[0])||void 0===t?void 0:t.frameRate):15,i=Math.ceil(1e3/r),n=document.createElement("canvas"),o=n.getContext("2d");n.width=16,n.height=16;var a=function(e){e.fillRect(0,0,16,16)};return o&&(o.fillStyle="#000",a(o),this.blackFrameRenderInterval=window.setInterval(function(){a(o)},i),this.refreshBlackFrameLifetime()),n.captureStream(r).getVideoTracks()[0]}},{key:"stopBlackFrame",value:function(){this.logger.info("stopBlackFrame()"),clearTimeout(this.blackFrameLifetimeInterval),clearInterval(this.blackFrameRenderInterval),delete this.blackFrameRenderInterval}},{key:"refreshBlackFrameLifetime",value:function(){var e=this;this.logger.info("refreshBlackFrameLifetime()"),this.blackFrameRenderInterval&&(clearTimeout(this.blackFrameLifetimeInterval),this.blackFrameLifetimeInterval=setTimeout(function(){clearInterval(e.blackFrameRenderInterval),delete e.blackFrameRenderInterval,e.emit("black-frame-ended")},vx.BLACK_FRAME_LIFETIME))}},{key:"setChangeCodecs",value:function(e){this._changeCodecs=e}},{key:"setVideoCaps",value:function(e){var t,r;if(e){var i=s8(t=sU(r=e.split(",")).call(r,function(e){var t=lx(e).call(e).toUpperCase();return({H264:EZ.H264,VP8:EZ.VP8,BYTEVC1:EZ.ByteVC1})[t]||null})).call(t,function(e){return null!==e});this._videoCaps=i}}}]),i}(),Rv=function(e){hA(i,R_);var t,r=hI(i);function i(e,t,n,o,a,s){var c;return nK(this,i),nQ(he(c=r.call(this,e)),"streamId",void 0),nQ(he(c),"userId",void 0),nQ(he(c),"isPublic",void 0),nQ(he(c),"hasVideo",void 0),nQ(he(c),"hasAudio",void 0),nQ(he(c),"_attributes",void 0),nQ(he(c),"streamState",void 0),nQ(he(c),"removeTrack",!1),nQ(he(c),"observer",void 0),nQ(he(c),"statsReport",void 0),nQ(he(c),"subVideo",void 0),nQ(he(c),"subAudio",void 0),nQ(he(c),"subMediaType",void 0),nQ(he(c),"subLayer",void 0),nQ(he(c),"_sequenceId",void 0),nQ(he(c),"stream",void 0),nQ(he(c),"videoTrack",void 0),nQ(he(c),"audioTrack",void 0),nQ(he(c),"recordedVideoFrames",void 0),nQ(he(c),"stillExist",void 0),nQ(he(c),"originalMediaType",void 0),nQ(he(c),"priority",void 0),nQ(he(c),"remoteSessionId",""),nQ(he(c),"originalStreamIndex",0),nQ(he(c),"virtual",void 0),nQ(he(c),"pcSessionId",void 0),nQ(he(c),"_virtualOccupy",void 0),nQ(he(c),"_videoStallObserver",void 0),nQ(he(c),"_audioStallObserver",void 0),nQ(he(c),"preReports",{audio:{},video:{}}),nQ(he(c),"_installInfo",void 0),c.virtual=!1,c._virtualOccupy=!1,c.userId=t,c.isScreen=o,c.isPublic=a,c.streamId=n,c.logName="RemoteStream-".concat(n),c.hasAudio=s.audiostream&&s.localaudio,c.hasVideo=s.videostream&&s.localvideo,c._attributes=s,c.vendorCode=(null==s?void 0:s.vendorCode)||0,c.subVideo=!1,c.subAudio=!1,c._sequenceId=0,c.subMediaType=vP.NONE,c.subLayer={spatialLayer:0,spatialSubLayer:-1},c.streamState=0,c.statsReport=new yi(e,he(c)),c.enableVendorMode&&(c.pcSessionId=f2()),c}return nY(i,[{key:"vendor",get:function(){return this._attributes.vendorCode}},{key:"audioHasCapture",get:function(){return this._attributes.localaudio}},{key:"audioHasPublish",get:function(){return this._attributes.audiostream}},{key:"videoHasCapture",get:function(){return this._attributes.localvideo}},{key:"videoHasPublish",get:function(){return this._attributes.videostream}},{key:"sequenceId",get:function(){return this._sequenceId||-1},set:function(e){"number"==typeof e&&(this._sequenceId=e)}},{key:"enableVendorMode",get:function(){return"number"==typeof this.attributes.vendorCode&&0!==this.attributes.vendorCode}},{key:"hasSubscribed",get:function(){return 2===this.streamState}},{key:"attributes",get:function(){return this._attributes},set:function(e){this.hasVideo=e.localvideo&&e.videostream,this.hasAudio=e.localaudio&&e.audiostream,this._attributes=e,this.vendorCode=e.vendorCode||0}},{key:"virtualOccupy",get:function(){return this._virtualOccupy},set:function(e){var t,r;this._virtualOccupy&&!e?null===(t=this.observer)||void 0===t||t.setPushTrack(!1):!this._virtualOccupy&&e&&(null===(r=this.observer)||void 0===r||r.setPushTrack(!0)),this._virtualOccupy=e}},{key:"startReport",value:function(e,t){this.statsReport.setRemoteStreamStatsEvtInterval(e,t)}},{key:"getRemoteStreamStats",value:function(){return this.statsReport.getRemoteStreamStats()}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.receiver){var t=this.videoTransceiver.receiver.createEncodedStreams(),r=t.readable,i=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){var i=RE(t);gh.getNalunits(new gp(t.data),i).forEach(function(t){if(t.sei){var r=gT.decodeSeiBody(t.body,i);r&&(vx.SKIP_SEI_FILTER||r.type===gf.external)&&e.safeEmit("onSEIMessage",r.payload)}}),r.enqueue(t)}})).pipeTo(i)}else this.logger.warn("no receiver found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){var e=this;if(this.audioTransceiver&&this.audioTransceiver.receiver){var t=this.audioTransceiver.receiver.createEncodedStreams(),r=t.readable,i=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){t.data.byteLength<=1e3?r.enqueue(t):e.logger.print("too large audio frame",t.data.byteLength)}})).pipeTo(i)}else this.logger.warn("no receiver found when trying to bind encodedTransform")}},{key:"ontrack",value:function(e){try{mw(this.engineId,"Stream.ontrack",sD({uid:this.userId,streamId:this.streamId,streams:c_(n=e.streams).call(n,function(e,t){return e+f3(t)},""),transceiver:f9(e.transceiver),track:f6(e.track)}),0,this.streamId||"")}catch(e){}if(this.enableVendorMode||null!==(t=e.streams)&&void 0!==t&&null!==(r=t[0])&&void 0!==r&&null!==(i=r.id)&&void 0!==i&&cd(i).call(i,this.streamId)){var t,r,i,n,o,a=e.track;"video"===(null==a?void 0:a.kind)?this._setVideoTrack(a):"audio"===(null===(o=e.track)||void 0===o?void 0:o.kind)&&this._setAudioTrack(a),this._setStream(e.streams[0])}this.safeEmit("ontrack",e)}},{key:"startVideoStallObserve",value:function(e){this.logger.info("startVideoStallObserve","invoke",e.playerId),this._videoStallObserver||(this._videoStallObserver=new yn(this.isScreen,this.engineId)),this._videoStallObserver.start(e)}},{key:"stopVideoStallObserve",value:function(){var e;this.logger.info("stopVideoStallObserve","invoke"),null===(e=this._videoStallObserver)||void 0===e||e.stop()}},{key:"updateVideoStallInfo",value:function(e,t,r){var i,n;if(r?(i=null===(n=this._videoStallObserver)||void 0===n?void 0:n.getStallInfo({interval:e.stats_interval||0,bitrate:e.bitrate,frameRateDecoded:e.frame_rate_decoded,frameRateReceived:e.frame_rate_received}),this._installInfo=i):i=this._installInfo,i){var o,a=Math.min(i.report.stallDuration,e.stats_interval||0);if(e.play_time=i.pts,e.stall_count=i.report.stallCount,e.is_screen?e.stuck_length=a:e.stall_duration=a,e.pause_duration=Math.min(a,i.pauseDuration),t.stallCount=i.callback.stallCount,t.stallDuration=i.callback.stallDuration,i.stall100ms){var s=Math.min(i.stall100ms.duration,e.stats_interval||0);e.stall_duration_100ms=s,e.stall_count_100ms=i.stall100ms.count,t.stallDuration100MS=s,t.stallCount100MS=i.stall100ms.count}(0!==i.report.stallCount||0!==i.report.stallDuration)&&this.logger.print("video_stall_report",this.userId,null===(o=this.videoTrack)||void 0===o?void 0:o.observingPlayerId,sD(i.report),r)}}},{key:"getVideoRenderInfo",value:function(){var e;return(null===(e=this._videoStallObserver)||void 0===e?void 0:e.getRecentRenderInfo4Report())||{}}},{key:"stopAudioStallObserve",value:function(){var e;this.logger.info("stopAudioStallObserve","invoke"),null===(e=this._audioStallObserver)||void 0===e||e.stop()}},{key:"updateAudioStallInfo",value:(t=sk(sI().mark(function e(t,r,i){var n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._audioStallObserver){e.next=6;break}this._audioStallObserver=new yo(this),this._audioStallObserver.start(i.concealedSamples,i.totalSamplesReceived),this.logger.print("startAduioObserver","start"),e.next=12;break;case 6:return e.next=8,this._audioStallObserver.getAudioStallInfo();case 8:return n=e.sent,t.concealedSamples===t.interval_concealed_samples&&t.totalSamplesReceived===t.interval_samples_received?(t.stall_count=0,t.stall_duration=0,r.stallCount=0,r.stallDuration=0):(t.stall_count=n.report.stall_count,t.stall_duration=n.report.stall_duration,r.stallCount=n.callback.stall_count,r.stallDuration=n.callback.stall_duration),0===n.report.stall_count&&0===n.report.stall_duration||this.logger.print("audio_stall_report",this.userId,sD(l9(l9({},n.report),{},{callbackList:n.callback.list}))),e.abrupt("return",n.extra);case 12:case"end":return e.stop()}},e,this)})),function(e,r,i){return t.apply(this,arguments)})},{key:"resetStream",value:function(){var e,t;null===(e=this.audioTransceiver)||void 0===e||e.stop(),null===(t=this.videoTransceiver)||void 0===t||t.stop(),this.audioTransceiver=void 0,this.videoTransceiver=void 0}},{key:"clean",value:function(){var e,t,r;this.logger.info("clean",sN(e="exec stream.clean ".concat(this.streamId," ")).call(e,this.userId)),mw(this.engineId,"remotestream_clean","".concat(Error().stack),0,this.streamId),hf(hp(i.prototype),"destroy",this).call(this),this.subAudio=!1,this.subVideo=!1,this.sequenceId=0,null===(t=this.videoTrack)||void 0===t||t.destroy(),this.videoTrack=void 0,null===(r=this.audioTrack)||void 0===r||r.destroy(),this.audioTrack=void 0,this.stream=void 0,this.recordedVideoFrames=void 0,delete this.priority}},{key:"destroy",value:function(){var e,t;this.clean(),null===(e=this._audioStallObserver)||void 0===e||e.destroy(),delete this._audioStallObserver,null===(t=this._videoStallObserver)||void 0===t||t.destroy(),delete this._videoStallObserver,this.attributes={audiostream:!1,localaudio:!1,localvideo:!1,videostream:!1,extvideo:!1,extaudio:!1,videoDescriptions:[]}}},{key:"resetHasSubscribed",value:function(){this.streamState=0}},{key:"_setStream",value:function(e){var t=this;this.stream=e,e.onaddtrack=function(e){"video"===e.track.kind?t._setVideoTrack(e.track):"audio"===e.track.kind&&t._setAudioTrack(e.track)}}},{key:"_setAudioTrack",value:function(e){var t,r,i=this;if((null===(t=this.audioTrack)||void 0===t||null===(r=t.preprocessingTrack)||void 0===r?void 0:r.id)!==e.id){this.audioTrack=Ri(this._ctx,e,{streamIndex:this.isPublic?EQ.PUBLIC:this.virtual?EQ.VIRTUAL:this.isScreen?EQ.SCREEN:EQ.MAIN,streamUserId:this.userId});var n,o=this._ctx._remoteAudioTrackDumpConfig[this.isScreen?yc.STREAM_INDEX_SCREEN:yc.STREAM_INDEX_MAIN].get(this.userId);null!=o&&o.callback&&null!=o&&o.frameSize&&(null===(n=this.audioTrack)||void 0===n||n.setDataFetcher(o.frameSize,function(e){var t;i.audioHasCapture&&i.audioHasPublish&&(null===(t=o.callback)||void 0===t||t.call(o,e))})),this.emit("ontrack",this.audioTrack)}}},{key:"_setVideoTrack",value:function(e){var t,r,i,n,o;(null===(t=this.videoTrack)||void 0===t||null===(r=t.preprocessingTrack)||void 0===r?void 0:r.id)!==e.id&&(this.videoTrack=(i=this._ctx,n=e,o=this,new yG(i,n,o,l9({},{streamIndex:this.isPublic?EQ.PUBLIC:this.virtual?EQ.VIRTUAL:this.isScreen?EQ.SCREEN:EQ.MAIN,streamUserId:this.userId}))),this.emit("ontrack",this.videoTrack))}}]),i}(),RE=function(e){var t,r,i;return cd(t=((null===(r=e.getMetadata)||void 0===r||null===(i=r.call(e))||void 0===i?void 0:i.mimeType)||"").toLowerCase()).call(t,"h265")},Rg=((Rd=Rg||{}).RESUBSCRIBE="resubscribe",Rd.STREAM_FAILED="stream_failed",Rd.SUBSCRIBE_PUSH_TRACK="subscribe_push_track",Rd.REMOVE_PUSH_TRACK="remove_push_track",Rd.VIDEO_FIRST_FRAME="video_first_frame",Rd.ON_USER_PUBLISH_STATE_CHANGE="on_user_publish_state_change",Rd.ON_USER_START_AUDIO_CAPTURE="on_user_start_audio_capture",Rd.ON_USER_STOP_AUDIO_CAPTURE="on_user_stop_audio_capture",Rd.ON_USER_START_VIDEO_CAPTURE="on_user_start_video_capture",Rd.ON_USER_STOP_VIDEO_CAPTURE="on_user_stop_video_capture",Rd.ON_SEI_MESSAGED_RECEIVED="on_sei_messaged_received",Rd.ON_PUBLISH_RESULT="on_publish_result",Rd.ON_SUBSCRIBE_RESULT="ON_SUBSCRIBE_RESULT",Rd.ON_UPDATE_TOKEN_SUCCESS="on_update_token_success",Rd.ON_REMOTE_STREAM_STATS="ON_REMOTE_STREAM_STATS",Rd.ON_LOCAL_STREAM_STATS="ON_LOCAL_STREAM_STATS",Rd.ON_USER_LEAVE="on_user_leave",Rd.ON_ROOM_ERROR="on_room_error",Rd.ON_NETWORK_QUALITY="on_network_quality",Rd.ON_SIMULCAST_SUBSCRIBE_FALLBACK="on_simulcast_subscribe_fallback",Rd.ON_REMOTE_VIDEO_SIZE_CHANGED="on_remote_video_size_changed",Rd.ON_SUBTITLE_STATE_CHANGED="ON_SUBTITLE_STATE_CHANGED",Rd.ON_SUBTITLE_MESSAGE_RECEIVED="ON_SUBTITLE_MESSAGE_RECEIVED",Rd.ON_VIDEO_STREAM_BANNED="ON_VIDEO_STREAM_BANNED",Rd.ON_AUDIO_STREAM_BANNED="ON_AUDIO_STREAM_BANNED",Rd.ON_FORWARD_STREAM_ERROR="ON_FORWARD_STREAM_ERROR",Rd.ON_REJOIN_WITH_TCP="ON_REJOIN_WITH_TCP",Rd.PUB_RETRY="PUB_RETRY",Rd.SUB_RETRY="SUB_RETRY",Rd.VIDEO_TYPE_CHANGE="VIDEO_TYPE_CHANGE",Rd.JOIN_SUCCESS="JOIN_SUCCESS",Rd.UPDATE_PUBLISH="UPDATE_PUBLISH",Rd),RS=((Ru=RS||{})[Ru.START=1]="START",Ru[Ru.START_SUCCESS=2]="START_SUCCESS",Ru[Ru.START_FAILED=3]="START_FAILED",Ru[Ru.UPDATE=4]="UPDATE",Ru[Ru.UPDATE_SUCCESS=5]="UPDATE_SUCCESS",Ru[Ru.UPDATE_FAILED=6]="UPDATE_FAILED",Ru[Ru.STOP=7]="STOP",Ru[Ru.STOP_SUCCESS=8]="STOP_SUCCESS",Ru[Ru.STOP_FAILED=9]="STOP_FAILED",Ru),Rb=((Rl=Rb||{})[Rl.PUB=0]="PUB",Rl[Rl.UNPUB=1]="UNPUB",Rl),RT=(Rh=sk(sI().mark(function e(t,r,i,n){var o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d="",u=-1,l="video"===r?null==i||null===(o=i.videoTrack)||void 0===o?void 0:o.originTrack:null==i||null===(a=i.audioTrack)||void 0===a?void 0:a.originTrack,h="video"===r?null==i||null===(s=i.videoTransceiver)||void 0===s?void 0:s.receiver:null==i||null===(c=i.audioTransceiver)||void 0===c?void 0:c.receiver,e.prev=5,e.next=8,null===(p=t.peerConnection)||void 0===p?void 0:p.getStatsWithLowFrequency(l,!0,h);case 8:return m=uC(f=(A=e.sent)||[]).call(f,function(e){return"inbound-rtp"===e.type}),e.next=12,null==h?void 0:h.getStats();case 12:if(v=e.sent,E=[],null==v||v.forEach(function(e){return E.push(e.type)}),0!==(null==A?void 0:A.length)||0===E.length){e.next=19;break}return e.next=18,null===(S=t.peerConnection)||void 0===S?void 0:S.getStatsWithLowFrequency(void 0,void 0,h);case 18:g=e.sent;case 19:d=sD({type:r,reports:sU(A).call(A,function(e){return e.type}),reports2:E,pc:(null===(_=t.peerConnection)||void 0===_?void 0:_.getOriginRTCPeerConnection())||null,track:(null==l?void 0:l.id)||null,bytes:null==m?void 0:m.bytesReceived,framesReceived:null==m?void 0:m.framesReceived,packetsReceived:null==m?void 0:m.packetsReceived,allReports:g}),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(5),u=-999,d=e.t0.mseeage||sD(e.t0);case 26:null==n||n.report("rtc_invoke_status",{sdk_api_name:"first_frame_recv_timeout",error_code:u,message:d,stream_id:(null==i?void 0:i.streamId)||"",stream_user_id:null==i?void 0:i.userId,elapse:0}),e.next=31;break;case 29:e.prev=29,e.t1=e.catch(0);case 31:case"end":return e.stop()}},e,null,[[0,29],[5,22]])})),function(e,t,r,i){return Rh.apply(this,arguments)}),Ry=(Rp=sk(sI().mark(function e(t,r,i,n){var o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d="",u=-1,l="video"===r?null==i||null===(o=i.videoTrack)||void 0===o?void 0:o.preprocessingTrack:null==i||null===(a=i.audioTrack)||void 0===a?void 0:a.preprocessingTrack,h="video"===r?null==i||null===(s=i.videoTransceiver)||void 0===s?void 0:s.sender:null==i||null===(c=i.audioTransceiver)||void 0===c?void 0:c.sender,e.prev=5,e.next=8,null===(p=t.peerConnection)||void 0===p?void 0:p.getStatsWithLowFrequency(l,!0,h);case 8:return m=uC(f=(A=e.sent)||[]).call(f,function(e){return"outbound-rtp"===e.type}),e.next=12,null==h?void 0:h.getStats();case 12:if(v=e.sent,E=[],null==v||v.forEach(function(e){return E.push(e.type)}),0!==A.length||0===E.length){e.next=19;break}return e.next=18,null===(S=t.peerConnection)||void 0===S?void 0:S.getStatsWithLowFrequency(void 0,void 0,h);case 18:g=e.sent;case 19:d=sD({type:r,reports:sU(A).call(A,function(e){return e.type}),reports2:E,pc:(null===(_=t.peerConnection)||void 0===_?void 0:_.getOriginRTCPeerConnection())||null,track:(null==l?void 0:l.id)||null,bytes:null==m?void 0:m.bytesSent,framesSent:null==m?void 0:m.framesSent,packetsSent:null==m?void 0:m.packetsSent,allReports:g}),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(5),u=-999,d=e.t0.mseeage||sD(e.t0);case 26:null==n||n.report("rtc_invoke_status",{sdk_api_name:"first_frame_send_timeout",error_code:u,message:d,stream_id:(null==i?void 0:i.streamId)||"",stream_user_id:null==i?void 0:i.userId,elapse:0}),e.next=31;break;case 29:e.prev=29,e.t1=e.catch(0);case 31:case"end":return e.stop()}},e,null,[[0,29],[5,22]])})),function(e,t,r,i){return Rp.apply(this,arguments)}),RR=function(e){hA(a,EN.EventEmitter);var t,r,i,n,o=hI(a);function a(e,t){var r;return nK(this,a),nQ(he(r=o.call(this)),"_audioEventSessionId",v5()),nQ(he(r),"_videoEventSessionId",v5()),nQ(he(r),"_stream",void 0),nQ(he(r),"_firstAudioFrameTimer",void 0),nQ(he(r),"_firstVideoFrameTimer",void 0),nQ(he(r),"_transportDelayInterval",void 0),nQ(he(r),"_transportDelay",void 0),nQ(he(r),"_firstVideoFrameInterval",void 0),nQ(he(r),"_firstAudioFrameInterval",void 0),nQ(he(r),"_isScreen",!1),nQ(he(r),"_audioFirstFrameState",0),nQ(he(r),"_videoFirstFrameState",0),nQ(he(r),"_timeout",1e4),nQ(he(r),"_currentAudioRecv",{startTime:0,eventSessionId:0,type:"login"}),nQ(he(r),"_currentVideoRecv",{startTime:0,eventSessionId:0,type:"login"}),nQ(he(r),"_login",!1),nQ(he(r),"_unMuteAudio",!1),nQ(he(r),"_enableAudio",!1),nQ(he(r),"_unMuteVideo",!1),nQ(he(r),"_enableVideo",!1),nQ(he(r),"_remoteUnmuteAudio",!1),nQ(he(r),"_remoteUnmuteVideo",!1),nQ(he(r),"_audioExternal",!1),nQ(he(r),"_pushAudio",!1),nQ(he(r),"_videoExternal",!1),nQ(he(r),"_pushVideo",!1),nQ(he(r),"_autoSubscribeVideo",!1),nQ(he(r),"_autoSubscribeAudio",!1),nQ(he(r),"_autoSubscribe",!1),nQ(he(r),"_publishVideo",!1),nQ(he(r),"_publishAudio",!1),nQ(he(r),"_subscribeAudio",!1),nQ(he(r),"_subscribeVideo",!1),nQ(he(r),"_subscribe",!1),nQ(he(r),"_pushTrack",!1),nQ(he(r),"_multiChatMode",!1),nQ(he(r),"_monitor",void 0),nQ(he(r),"logger",void 0),r._ctx=e,r._stream=t,r.getTransportDelay(),r._monitor=mS(t.engineId),r.logger=new mJ("RecvFrameObserver",0,t.engineId),r}return nY(a,[{key:"beginRecvFrame",value:(n=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:n=this._transportDelay,o=!0,ux(i=["login","unmute","subscribe","push_track"]).call(i,r)>=0&&(n=0,o=!1),"audio"===t?(o||this._audioEventSessionId++,this._currentAudioRecv={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:r},f={media_type:t,event_type:"begin_recv",type:r,is_screen:!(null===(a=this._stream)||void 0===a||!a.isScreen),start:null===(s=this._currentAudioRecv)||void 0===s?void 0:s.startTime,event_session_id:this._audioEventSessionId,stream_user_id:null===(c=this._stream)||void 0===c?void 0:c.userId,transport_delay:n,vendor_mode:(null===(d=this._stream)||void 0===d?void 0:d.vendorCode)||0,pc_session_id:(null===(u=this._stream)||void 0===u?void 0:u.pcSessionId)||(null===(l=this._ctx.peerConnection)||void 0===l?void 0:l.getConnectionId()),remote_rtc_session_id:null===(h=this._stream)||void 0===h?void 0:h.remoteSessionId},this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=setTimeout(function(){RT(y._ctx,"audio",y._stream,y._monitor),y.stopRecvFrame("audio","timeout"),y._firstAudioFrameInterval&&window.clearInterval(y._firstAudioFrameInterval)},this._timeout),this.logger.info("rtcFirstFrameRecv",sD(f)),null===(p=this._monitor)||void 0===p||p.report("rtc_first_frame",f),this._watchForFirstAudioFrameRecv(),this._audioFirstFrameState=1,this._login=!0,this._unMuteAudio=!0,this._enableAudio=!0,this._remoteUnmuteAudio=!0):"video"===t&&(o||this._videoEventSessionId++,this._currentVideoRecv={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:r},T={media_type:t,event_type:"begin_recv",type:r,is_screen:!(null===(_=this._stream)||void 0===_||!_.isScreen),start:null===(A=this._currentVideoRecv)||void 0===A?void 0:A.startTime,event_session_id:this._videoEventSessionId,stream_user_id:null===(m=this._stream)||void 0===m?void 0:m.userId,transport_delay:n,vendor_mode:(null===(v=this._stream)||void 0===v?void 0:v.vendorCode)||0,pc_session_id:(null===(E=this._stream)||void 0===E?void 0:E.pcSessionId)||(null===(g=this._ctx.peerConnection)||void 0===g?void 0:g.getConnectionId()),remote_rtc_session_id:null===(S=this._stream)||void 0===S?void 0:S.remoteSessionId},this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=setTimeout(function(){RT(y._ctx,"video",y._stream,y._monitor),y.stopRecvFrame("video","timeout"),y._firstVideoFrameInterval&&window.clearInterval(y._firstVideoFrameInterval)},this._timeout),this._watchForFirstVideoFrameRecv(),this.logger.info("rtcFirstFrameRecv",sD(T)),null===(b=this._monitor)||void 0===b||b.report("rtc_first_frame",T),this._videoFirstFrameState=1,this._login=!0,this._unMuteVideo=!0,this._enableVideo=!0,this._remoteUnmuteVideo=!0);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"stopRecvFrame",value:function(e,t){if("audio"===e){if(1===this._audioFirstFrameState){var r,i,n,o,a,s,c,d,u,l={event_type:"recv_end",media_type:e,is_screen:!(null===(r=this._stream)||void 0===r||!r.isScreen),start:null===(i=this._currentAudioRecv)||void 0===i?void 0:i.startTime,reason:t,result:!1,stream_user_id:null===(n=this._stream)||void 0===n?void 0:n.userId,event_session_id:this._audioEventSessionId,type:null===(o=this._currentAudioRecv)||void 0===o?void 0:o.type,vendor_mode:(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,pc_session_id:(null===(s=this._stream)||void 0===s?void 0:s.pcSessionId)||(null===(c=this._ctx.peerConnection)||void 0===c?void 0:c.getConnectionId()),remote_rtc_session_id:null===(d=this._stream)||void 0===d?void 0:d.remoteSessionId};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioRecv,this.logger.info("rtcFirstFrameRecv",sD(l)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",l),this._audioFirstFrameState=2}}else if("video"===e){if(1!==this._videoFirstFrameState)return;var h,p,f,_,A,m,v,E,g,S={event_type:"recv_end",media_type:e,is_screen:!(null===(h=this._stream)||void 0===h||!h.isScreen),start:null===(p=this._currentVideoRecv)||void 0===p?void 0:p.startTime,reason:t,result:!1,stream_user_id:null===(f=this._stream)||void 0===f?void 0:f.userId,event_session_id:this._videoEventSessionId,type:null===(_=this._currentVideoRecv)||void 0===_?void 0:_.type,vendor_mode:(null===(A=this._stream)||void 0===A?void 0:A.vendorCode)||0,pc_session_id:(null===(m=this._stream)||void 0===m?void 0:m.pcSessionId)||(null===(v=this._ctx.peerConnection)||void 0===v?void 0:v.getConnectionId()),remote_rtc_session_id:null===(E=this._stream)||void 0===E?void 0:E.remoteSessionId};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoRecv,this.logger.info("rtcFirstFrameRecv",sD(S)),null===(g=this._monitor)||void 0===g||g.report("rtc_first_frame",S),this._videoFirstFrameState=2}}},{key:"recvFrameFinish",value:(i=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:if(r=this._transportDelay,"audio"!==t){e.next=19;break}if(1===this._audioFirstFrameState){e.next=6;break}return e.abrupt("return");case 6:if(this._currentAudioRecv){e.next=8;break}return e.abrupt("return");case 8:h=(l=this._currentAudioRecv).type,p=l.startTime,ux(i=["login","unmute","subscribe","push_track"]).call(i,h)>=0&&(r=0),f={event_type:"recv_end",media_type:t,start:p,result:!0,is_screen:!(null===(n=this._stream)||void 0===n||!n.isScreen),stream_user_id:null===(o=this._stream)||void 0===o?void 0:o.userId,event_session_id:this._audioEventSessionId,type:h,transport_delay:r,vendor_mode:(null===(a=this._stream)||void 0===a?void 0:a.vendorCode)||0,pc_session_id:(null===(s=this._stream)||void 0===s?void 0:s.pcSessionId)||(null===(c=this._ctx.peerConnection)||void 0===c?void 0:c.getConnectionId()),remote_rtc_session_id:null===(d=this._stream)||void 0===d?void 0:d.remoteSessionId},delete this._currentAudioRecv,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this.logger.info("rtcFirstFrameRecv",sD(f)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",f),this.emit("recvAudioFirstFrame"),this._audioFirstFrameState=3,e.next=33;break;case 19:if("video"!==t){e.next=33;break}if(1===this._videoFirstFrameState){e.next=22;break}return e.abrupt("return");case 22:if(this._currentVideoRecv){e.next=24;break}return e.abrupt("return");case 24:y=(T=this._currentVideoRecv).type,R=T.startTime,ux(_=["login","unmute","subscribe","push_track"]).call(_,y)>=0&&(r=0),I={event_type:"recv_end",media_type:t,is_screen:!(null===(A=this._stream)||void 0===A||!A.isScreen),start:R,result:!0,stream_user_id:null===(m=this._stream)||void 0===m?void 0:m.userId,event_session_id:this._videoEventSessionId,type:y,transport_delay:r,vendor_mode:(null===(v=this._stream)||void 0===v?void 0:v.vendorCode)||0,pc_session_id:(null===(E=this._stream)||void 0===E?void 0:E.pcSessionId)||(null===(g=this._ctx.peerConnection)||void 0===g?void 0:g.getConnectionId()),remote_rtc_session_id:null===(S=this._stream)||void 0===S?void 0:S.remoteSessionId},delete this._currentVideoRecv,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this.logger.info("rtcFirstFrameRecv",sD(I)),null===(b=this._monitor)||void 0===b||b.report("rtc_first_frame",I),this.emit("recvVideoFirstFrame"),this._videoFirstFrameState=3;case 33:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"setLogin",value:function(e){var t,r,i,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};this._login!==e&&(this._login=e,e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&o.audio&&this.beginRecvFrame("audio","login"),e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&o.video&&this.beginRecvFrame("video","login"),!e&&null!==(i=this._stream)&&void 0!==i&&i.hasAudio&&this.stopRecvFrame("audio","leave_room"),!e&&null!==(n=this._stream)&&void 0!==n&&n.hasVideo&&this.stopRecvFrame("video","leave_room"))}},{key:"setUnmuteAudio",value:function(e){var t,r,i;if(this._unMuteAudio!==e){this._unMuteAudio=e;var n=!(null===(t=this._stream)||void 0===t||!t.hasAudio);null!==(r=this._stream)&&void 0!==r&&r.audioHasCapture&&null!==(i=this._stream)&&void 0!==i&&i.audioHasPublish&&(this._unMuteAudio&&n?this.beginRecvFrame("audio","unmute"):n&&this.stopRecvFrame("audio","mute"))}}},{key:"setRemoteUnmuteAudio",value:function(e){this._remoteUnmuteAudio!==e&&(this._remoteUnmuteAudio=e,this._remoteUnmuteAudio?this.beginRecvFrame("audio","remote_unmute"):this.stopRecvFrame("audio","remote_mute"))}},{key:"setEnableAudio",value:function(e){this._enableAudio!==e&&(this._enableAudio=e,this._enableAudio?this.beginRecvFrame("audio","enable"):this.stopRecvFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t,r,i;if(this._unMuteVideo!==e){this._unMuteVideo=e;var n=!(null===(t=this._stream)||void 0===t||!t.hasVideo);null!==(r=this._stream)&&void 0!==r&&r.videoHasCapture&&null!==(i=this._stream)&&void 0!==i&&i.videoHasPublish&&(this._unMuteVideo&&n?this.beginRecvFrame("video","unmute"):n&&this.stopRecvFrame("video","mute"))}}},{key:"setRemoteUnmuteVideo",value:function(e){this._remoteUnmuteVideo!==e&&(this._remoteUnmuteVideo=e,this._remoteUnmuteVideo?this.beginRecvFrame("video","remote_unmute"):this.stopRecvFrame("video","remote_mute"))}},{key:"setEnableVideo",value:function(e){this._enableVideo!==e&&(this._enableVideo=e,this._enableVideo?this.beginRecvFrame("video","enable"):this.stopRecvFrame("video","disable"))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal=e}},{key:"setPushAudio",value:function(e){var t;this._audioExternal&&this._pushAudio!==e&&(this._pushAudio=e),this._pushAudio&&this.beginRecvFrame("audio","push"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","stop_push")}},{key:"setExternalVideoSource",value:function(e){this._videoExternal=e}},{key:"setPushVideo",value:function(e){var t;this._videoExternal&&this._pushVideo!==e&&(this._pushVideo=e),this._pushVideo&&this.beginRecvFrame("video","push"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","stop_push")}},{key:"setPublishVideo",value:function(e){var t;this._publishVideo!==e&&(this._publishVideo=e),this._publishVideo&&this.beginRecvFrame("video","publish"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","unpublish")}},{key:"setPublishAudio",value:function(e){var t;this._publishAudio!==e&&(this._publishAudio=e),this._publishAudio&&this.beginRecvFrame("audio","publish"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","unpublish")}},{key:"setAutoSubscribe",value:function(e){this._autoSubscribe=e}},{key:"setAutoSubscribeVideo",value:function(e){this._autoSubscribeVideo=e}},{key:"setAutoSubscribeAudio",value:function(e){this._autoSubscribeAudio=e}},{key:"setSubscribeAudio",value:function(e){var t,r;this._autoSubscribeAudio||this._subscribeAudio===e||(this._subscribe=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasAudio&&this.beginRecvFrame("audio","subscribe")),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","unsubscribe")}},{key:"setSubscribeVideo",value:function(e){var t,r;this._autoSubscribeVideo||this._subscribeVideo===e||(this._subscribeVideo=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&this.beginRecvFrame("video","subscribe")),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame("video","unsubscribe")}},{key:"setPushTrack",value:function(e){var t;this._pushTrack!==e&&(this._pushTrack=e,e&&!this._isScreen&&this.beginRecvFrame("audio","push_track"),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame("audio","remove_track"))}},{key:"setMultiChatMode",value:function(e){this._multiChatMode=e}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"_watchForFirstVideoFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(sk(sI().mark(function i(){var n,o,a,s,c,d,u,l,h,p,f,_;return sI().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(d=null!==(n=null===(o=e._stream)||void 0===o||null===(a=o.vendorHandler)||void 0===a?void 0:a.peer)&&void 0!==n?n:e._ctx.peerConnection)||null===(s=e._stream)||void 0===s||null===(c=s.videoTrack)||void 0===c||!c.preprocessingTrack){i.next=14;break}return p=null===(u=e._stream.videoTransceiver)||void 0===u?void 0:u.receiver,i.next=5,d.getStatsWithLowFrequency(null===(l=e._stream)||void 0===l||null===(h=l.videoTrack)||void 0===h?void 0:h.preprocessingTrack,!0,p);case 5:if(!(_=uC(f=i.sent).call(f,function(e){return"inbound-rtp"===e.type}))||!(_.framesReceived>t||_.packetsReceived>r)){i.next=14;break}if(-1!==t||-1!==r){i.next=12;break}return t=_.framesReceived,r=_.packetsReceived,i.abrupt("return");case 12:e.recvFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 14:case"end":return i.stop()}},i)})),200)}},{key:"_watchForFirstAudioFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(sk(sI().mark(function i(){var n,o,a,s,c,d,u,l,h,p;return sI().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(d=null!==(n=null===(o=e._stream)||void 0===o||null===(a=o.vendorHandler)||void 0===a?void 0:a.peer)&&void 0!==n?n:e._ctx.peerConnection)||null===(s=e._stream)||void 0===s||null===(c=s.audioTrack)||void 0===c||!c.originTrack){i.next=13;break}return i.next=4,d.getStatsWithLowFrequency(null===(u=e._stream)||void 0===u||null===(l=u.audioTrack)||void 0===l?void 0:l.originTrack);case 4:if(!(p=uC(h=i.sent).call(h,function(e){return"inbound-rtp"===e.type}))||!(p.totalSamplesReceived>t||p.packetsReceived>r)){i.next=13;break}if(-1!==t||-1!==r){i.next=11;break}return t=p.totalSamplesReceived,r=p.packetsReceived,i.abrupt("return");case 11:e.recvFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 13:case"end":return i.stop()}},i)})),200)}},{key:"getTransportDelay",value:(r=sk(sI().mark(function e(){var t=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelayIntl();case 2:window.clearInterval(this._transportDelayInterval),this._transportDelayInterval=window.setInterval(sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTransportDelayIntl();case 2:case"end":return e.stop()}},e)})),2e3);case 4:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"getTransportDelayIntl",value:(t=sk(sI().mark(function e(){var t,r,i,n,o,a,s;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this._ctx.peerConnection)){e.next=9;break}return n=null===(r=this._stream)||void 0===r||null===(i=r.videoTransceiver)||void 0===i?void 0:i.receiver,e.next=5,t.getStatsWithLowFrequency(void 0,!0,n);case 5:a=uC(o=e.sent).call(o,function(e){return"transport"===e.type&&"connected"===e.dtlsState}),(s=uC(o).call(o,function(e){return"candidate-pair"===e.type&&"succeeded"===e.state&&e.id===(null==a?void 0:a.selectedCandidatePairId)}))&&(this._transportDelay=Math.round(1e3*s.currentRoundTripTime/2));case 9:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"setDisconnect",value:function(){this.stopRecvFrame("audio","connection_lost"),this.stopRecvFrame("video","connection_lost"),this.reset()}},{key:"reset",value:function(){this._currentAudioRecv={startTime:0,eventSessionId:0,type:"login"},this._currentVideoRecv={startTime:0,eventSessionId:0,type:"login"},this._login=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._remoteUnmuteAudio=!1,this._remoteUnmuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoSubscribeVideo=!1,this._autoSubscribeAudio=!1,this._autoSubscribe=!1,this._subscribeAudio=!1,this._subscribeVideo=!1,this._subscribe=!1,this._pushTrack=!1,this._multiChatMode=!1,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._transportDelayInterval&&window.clearInterval(this._transportDelayInterval)}},{key:"audioFirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}},{key:"FirstFrameReceived",get:function(){return 3===this._audioFirstFrameState}}]),a}(),RI=function(){var e,t;function r(e,t){nK(this,r),nQ(this,"_audioEventSessionId",v5()),nQ(this,"_videoEventSessionId",v5()),nQ(this,"_pcSessionId",void 0),nQ(this,"_firstAudioFrameTimer",void 0),nQ(this,"_firstVideoFrameTimer",void 0),nQ(this,"_stream",void 0),nQ(this,"_firstVideoFrameInterval",void 0),nQ(this,"_firstAudioFrameInterval",void 0),nQ(this,"_currentAudioSend",{startTime:0,eventSessionId:0,type:"login"}),nQ(this,"_currentVideoSend",{startTime:0,eventSessionId:0,type:"login"}),nQ(this,"_login",!1),nQ(this,"_publisher",!1),nQ(this,"_unMuteAudio",!1),nQ(this,"_enableAudio",!1),nQ(this,"_unMuteVideo",!1),nQ(this,"_enableVideo",!1),nQ(this,"_audioExternal",!1),nQ(this,"_pushAudio",!1),nQ(this,"_videoExternal",!1),nQ(this,"_pushVideo",!1),nQ(this,"_autoPublish",!1),nQ(this,"_publish",!1),nQ(this,"_timeout",1e4),nQ(this,"_audioFirstFrameState",0),nQ(this,"_videoFirstFrameState",0),nQ(this,"_monitor",void 0),nQ(this,"logger",void 0),this._ctx=e,this._stream=t,this._monitor=mS(t.engineId),this.logger=new mJ("SendFrameObserver",0,t.engineId)}return nY(r,[{key:"beginSendFrame",value:function(e,t){var r=this;if("audio"===e){this._audioEventSessionId++,this._currentAudioSend={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:t};var i,n,o,a,s,c,d,u={event_type:"begin_send",media_type:e,is_screen:!(null===(i=this._stream)||void 0===i||!i.isScreen),type:t,start:this._currentAudioSend.startTime,event_session_id:this._audioEventSessionId,vendor_mode:(null===(n=this._stream)||void 0===n?void 0:n.vendorCode)||0,pc_session_id:(null===(o=this._stream)||void 0===o?void 0:o.pcSessionId)||(null===(a=this._ctx.peerConnection)||void 0===a?void 0:a.getConnectionId()),capture_session_id:null===(s=this._stream)||void 0===s||null===(c=s.audioTrack)||void 0===c?void 0:c.captureSessionId};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=setTimeout(function(){Ry(r._ctx,"audio",r._stream,r._monitor),r.stopSendFrame("audio","timeout"),r._firstAudioFrameInterval&&window.clearInterval(r._firstAudioFrameInterval)},this._timeout),this.logger.info("rtcFirstFrameSend",sD(u)),null===(d=this._monitor)||void 0===d||d.report("rtc_first_frame",u),this._watchForFirstAudioFrameSend(),this._audioFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteAudio=!0,this._pushAudio||(this._enableAudio=!0)}else if("video"===e){this._videoEventSessionId++,this._currentVideoSend={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:t};var l,h,p,f,_,A,m,v={event_type:"begin_send",media_type:e,is_screen:!(null===(l=this._stream)||void 0===l||!l.isScreen),type:t,start:this._currentVideoSend.startTime,event_session_id:this._videoEventSessionId,vendor_mode:(null===(h=this._stream)||void 0===h?void 0:h.vendorCode)||0,pc_session_id:(null===(p=this._stream)||void 0===p?void 0:p.pcSessionId)||(null===(f=this._ctx.peerConnection)||void 0===f?void 0:f.getConnectionId()),capture_session_id:null===(_=this._stream)||void 0===_||null===(A=_.videoTrack)||void 0===A?void 0:A.captureSessionId};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=setTimeout(function(){Ry(r._ctx,"video",r._stream,r._monitor),r.stopSendFrame("video","timeout"),r._firstVideoFrameInterval&&window.clearInterval(r._firstVideoFrameInterval)},this._timeout),this._watchForFirstVideoFrameSend(),this.logger.info("rtcFirstFrameSend",sD(v)),null===(m=this._monitor)||void 0===m||m.report("rtc_first_frame",v),this._videoFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteVideo=!0,this._pushVideo||(this._enableVideo=!0)}}},{key:"stopSendFrame",value:function(e,t){if("audio"===e){if(1===this._audioFirstFrameState){var r,i,n,o,a,s,c,d,u,l={event_type:"sent_end",media_type:e,is_screen:!(null===(r=this._stream)||void 0===r||!r.isScreen),start:null===(i=this._currentAudioSend)||void 0===i?void 0:i.startTime,reason:t,result:!1,event_session_id:this._audioEventSessionId,type:null===(n=this._currentAudioSend)||void 0===n?void 0:n.type,vendor_mode:(null===(o=this._stream)||void 0===o?void 0:o.vendorCode)||0,pc_session_id:(null===(a=this._stream)||void 0===a?void 0:a.pcSessionId)||(null===(s=this._ctx.peerConnection)||void 0===s?void 0:s.getConnectionId()),capture_session_id:null===(c=this._stream)||void 0===c||null===(d=c.audioTrack)||void 0===d?void 0:d.captureSessionId};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioSend,this.logger.info("rtcFirstFrameSend",sD(l)),null===(u=this._monitor)||void 0===u||u.report("rtc_first_frame",l),this._audioFirstFrameState=2}}else if("video"===e){if(1!==this._videoFirstFrameState)return;var h,p,f,_,A,m,v,E,g,S={event_type:"sent_end",media_type:e,start:null===(h=this._currentVideoSend)||void 0===h?void 0:h.startTime,is_screen:!(null===(p=this._stream)||void 0===p||!p.isScreen),reason:t,result:!1,event_session_id:this._videoEventSessionId,type:null===(f=this._currentVideoSend)||void 0===f?void 0:f.type,vendor_mode:(null===(_=this._stream)||void 0===_?void 0:_.vendorCode)||0,pc_session_id:(null===(A=this._stream)||void 0===A?void 0:A.pcSessionId)||(null===(m=this._ctx.peerConnection)||void 0===m?void 0:m.getConnectionId()),capture_session_id:null===(v=this._stream)||void 0===v||null===(E=v.videoTrack)||void 0===E?void 0:E.captureSessionId};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoSend,this.logger.info("rtcFirstFrameSend",sD(S)),null===(g=this._monitor)||void 0===g||g.report("rtc_first_frame",S),this._videoFirstFrameState=2}}},{key:"sendFrameFinish",value:function(e){if("audio"===e){if(1===this._audioFirstFrameState){if(this._currentAudioSend){var t,r,i,n,o,a,s,c=this._currentAudioSend,d=c.type,u=c.startTime,l={event_type:"sent_end",media_type:e,is_screen:!(null===(t=this._stream)||void 0===t||!t.isScreen),start:u,result:!0,event_session_id:this._audioEventSessionId,type:d,vendor_mode:(null===(r=this._stream)||void 0===r?void 0:r.vendorCode)||0,pc_session_id:(null===(i=this._stream)||void 0===i?void 0:i.pcSessionId)||(null===(n=this._ctx.peerConnection)||void 0===n?void 0:n.getConnectionId()),capture_session_id:null===(o=this._stream)||void 0===o||null===(a=o.audioTrack)||void 0===a?void 0:a.captureSessionId};delete this._currentAudioSend,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this.logger.info("rtcFirstFrameSend",sD(l)),null===(s=this._monitor)||void 0===s||s.report("rtc_first_frame",l),this._audioFirstFrameState=3}}}else if("video"===e){if(1!==this._videoFirstFrameState||!this._currentVideoSend)return;var h,p,f,_,A,m,v,E=this._currentVideoSend,g=E.type,S=E.startTime,b={event_type:"sent_end",media_type:e,is_screen:!(null===(h=this._stream)||void 0===h||!h.isScreen),start:S,result:!0,event_session_id:this._videoEventSessionId,type:g,vendor_mode:(null===(p=this._stream)||void 0===p?void 0:p.vendorCode)||0,pc_session_id:(null===(f=this._stream)||void 0===f?void 0:f.pcSessionId)||(null===(_=this._ctx.peerConnection)||void 0===_?void 0:_.getConnectionId()),capture_session_id:null===(A=this._stream)||void 0===A||null===(m=A.videoTrack)||void 0===m?void 0:m.captureSessionId};delete this._currentVideoSend,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this.logger.info("rtcFirstFrameSend",sD(b)),null===(v=this._monitor)||void 0===v||v.report("rtc_first_frame",b),this._videoFirstFrameState=3}}},{key:"setLogin",value:function(e){if(this._login!==e){var t,r;this._login=e,e&&(null!==(t=this._stream)&&void 0!==t&&t.videoTrack&&this._stream.pubVideo&&this.beginSendFrame("video","login"),null!==(r=this._stream)&&void 0!==r&&r.audioTrack&&this._stream.pubAudio&&this.beginSendFrame("audio","login")),!e&&this._audioSending&&this.stopSendFrame("audio","leave_room"),!e&&this._videoSending&&this.stopSendFrame("video","leave_room")}}},{key:"setPublish",value:function(e){if(this._publish!==e){var t,r;this._publish=e,e&&((null===(t=this._stream)||void 0===t?void 0:t.videoTrack)&&this._stream.pubVideo&&this.beginSendFrame("video","publish"),(null===(r=this._stream)||void 0===r?void 0:r.audioTrack)&&this._stream.pubAudio&&this.beginSendFrame("audio","publish")),!e&&this._audioSending&&this.stopSendFrame("audio","unpublish"),!e&&this._videoSending&&this.stopSendFrame("video","unpublish")}}},{key:"setUnmuteAudio",value:function(e){var t;this._unMuteAudio!==e&&(this._unMuteAudio=e,null!==(t=this._stream)&&void 0!==t&&t.audioHasCapture&&(e&&this.beginSendFrame("audio","unmute"),!e&&this._audioSending&&this.stopSendFrame("audio","mute")))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&null!==(t=this._stream)&&void 0!==t&&t.pubAudio&&(this._enableAudio=e,e&&this.beginSendFrame("audio","enable"),!e&&this._audioSending&&this.stopSendFrame("audio","disable"))}},{key:"setUnmuteVideo",value:function(e){var t;this._unMuteVideo!==e&&(this._unMuteVideo=e,null!==(t=this._stream)&&void 0!==t&&t.videoHasCapture&&(e&&this.beginSendFrame("video","unmute"),!e&&this._videoSending&&this.stopSendFrame("video","mute")))}},{key:"setEnableVideo",value:function(e){var t;this._enableVideo!==e&&null!==(t=this._stream)&&void 0!==t&&t.pubVideo&&(this._enableVideo=e,e&&this.beginSendFrame("video","enable"),!e&&this._videoSending&&this.stopSendFrame("video","disable"))}},{key:"setPushAudio",value:function(e){this._pushAudio!==e&&(this._pushAudio=e,e&&this.beginSendFrame("audio","push"),!e&&this._audioSending&&this.stopSendFrame("audio","stop_push"))}},{key:"setPushVideo",value:function(e){this._pushVideo!==e&&(this._pushVideo=e,e&&this.beginSendFrame("video","push"),!e&&this._videoSending&&this.stopSendFrame("video","stop_push"))}},{key:"setAutoPublish",value:function(e){this._autoPublish=e}},{key:"setPublisher",value:function(e){this._publisher!==e&&(this._publisher=e,!e&&this._audioSending&&this.stopSendFrame("audio","audience"),!e&&this._videoSending&&this.stopSendFrame("video","audience"))}},{key:"setDisconnect",value:function(){this._audioSending&&this.stopSendFrame("audio","connection_lost"),this._videoSending&&this.stopSendFrame("video","connection_lost"),this.reset()}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"setPCSessionId",value:function(e){this._pcSessionId=e}},{key:"_getFirstVideoFrameStats",value:(t=sk(sI().mark(function e(){var t,r,i,n,o,a,s,c,d,u,l,h;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=null===(t=this._stream)||void 0===t||null===(r=t.videoTrack)||void 0===r?void 0:r.preprocessingTrack,d=null===(i=this._stream)||void 0===i||null===(n=i.videoTransceiver)||void 0===n?void 0:n.sender,!(u=null!==(o=null===(a=this._stream)||void 0===a||null===(s=a.vendorHandler)||void 0===s?void 0:s.peer)&&void 0!==o?o:this._ctx.peerConnection)||!c){e.next=9;break}return e.next=6,u.getStatsWithLowFrequency(c,!0,d);case 6:return h=s8(l=e.sent).call(l,function(e){return"outbound-rtp"===e.type}),e.abrupt("return",h);case 9:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_getFirstAudioFrameStats",value:(e=sk(sI().mark(function e(){var t,r,i,n,o,a,s,c,d,u,l;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=null===(t=this._stream)||void 0===t||null===(r=t.audioTrack)||void 0===r?void 0:r.preprocessingTrack,d=null===(i=this._stream)||void 0===i||null===(n=i.audioTransceiver)||void 0===n?void 0:n.sender,!(u=null!==(o=null===(a=this._stream)||void 0===a||null===(s=a.vendorHandler)||void 0===s?void 0:s.peer)&&void 0!==o?o:this._ctx.peerConnection)||!c){e.next=8;break}return e.next=6,u.getStatsWithLowFrequency(c,!0,d);case 6:return l=e.sent,e.abrupt("return",uC(l).call(l,function(e){return"outbound-rtp"===e.type}));case 8:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_watchForFirstVideoFrameSend",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._firstVideoFrameInterval=window.setInterval(sk(sI().mark(function i(){var n,o,a;return sI().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e._getFirstVideoFrameStats();case 2:if(n=i.sent,o=0,a=0,null==n||sU(n).call(n,function(e){o+=e.framesSent,a+=e.packetsSent}),!(n&&n.length>0&&(o>t||a>r))){i.next=12;break}if(-1!==t||-1!==r){i.next=10;break}return t=o,r=a,i.abrupt("return");case 10:e.sendFrameFinish("video"),window.clearInterval(e._firstVideoFrameInterval);case 12:case"end":return i.stop()}},i)})),100)}},{key:"_watchForFirstAudioFrameSend",value:function(){var e=this,t=-1;this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstAudioFrameInterval=window.setInterval(sk(sI().mark(function r(){var i;return sI().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e._getFirstAudioFrameStats();case 2:if(!((i=r.sent)&&i.packetsSent>t)){r.next=9;break}if(-1!==t){r.next=7;break}return t=i.packetsSent,r.abrupt("return");case 7:e.sendFrameFinish("audio"),window.clearInterval(e._firstAudioFrameInterval);case 9:case"end":return r.stop()}},r)})),100)}},{key:"reset",value:function(){this._login=!1,this._publisher=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoPublish=!1,this._publish=!1,this._audioFirstFrameState=0,this._videoFirstFrameState=0,this._currentAudioSend={startTime:0,eventSessionId:0,type:"login"},this._currentVideoSend={startTime:0,eventSessionId:0,type:"login"},window.clearTimeout(this._firstAudioFrameTimer),window.clearTimeout(this._firstVideoFrameTimer),window.clearInterval(this._firstAudioFrameInterval),window.clearInterval(this._firstVideoFrameInterval)}},{key:"destroy",value:function(){this.reset(),delete this._stream}},{key:"_audioSending",get:function(){return 1===this._audioFirstFrameState}},{key:"_videoSending",get:function(){return 1===this._videoFirstFrameState}}]),r}(),RC=(nQ(Rf={},"audio",{delay:1200,stallRadio:.3}),nQ(Rf,"video",{delay:1200,stallRadio:.6}),nQ(Rf,"screen_audio",{delay:1600,stallRadio:.8}),nQ(Rf,"screen_video",{delay:1600,stallRadio:.8}),Rf),Rk=function(){function e(t){nK(this,e),nQ(this,"_preUplinkStats",new d9),nQ(this,"_preDownlinkStats",new d9),nQ(this,"_timer",void 0),nQ(this,"_delayTimer",void 0),nQ(this,"reportor",void 0),this._ctx=t}return nY(e,[{key:"updateUplinkStats",value:function(e,t){var r=e.audioStats,i=e.videoStats,n=e.isScreen;if(r.sendKBitrate>0&&r.rtt){var o,a,s=n?"screen_audio":"audio",c=r.rtt,d=r._fractionLost,u=r._retransmittedRate,l=this._getQosLevel(c,d||0,u||0),h=this._preUplinkStats.get(s)||[l];this._preUplinkStats.set(s,uk(o=sN(a=[]).call(a,le(h),[l])).call(o,-2))}if(i.sentKBitrate>0&&i.rtt){var p,f,_=n?"screen_video":"video",A=i._fractionLost,m=i.rtt,v=i._sendBandWidth,E=i._retransmittedRate;0===v&&(A=Math.max(.65,A));var g=this._getQosLevel(m,A||0,E||0),S=this._getUplinkVideoQoE(e,t),b=this._getVideoUplinkNetworkQuality(g,S),T=this._preUplinkStats.get(_)||[b];this._preUplinkStats.set(_,uk(p=sN(f=[]).call(f,le(T),[b])).call(p,-2))}this._startNetworkQualityReport()}},{key:"updateDownlinkStats",value:function(e,t){var r;if(t){var i,n,o=this._getStreamActiveState(t),a=o.audioActive,s=o.videoActive,c=e.audioStats,d=e.videoStats,u=e.isScreen,l=e.userId,h=!0,p=!0;if(a){if(0===c.receivedKBitrate)h=!1;else{var f=c.rtt,_=c.audioLossRate,A=c.stallDuration,m=c.statsInterval,v=c.e2eDelay,E=this._getQosLevel(f,_||0,d._retransmittedRate||0),g=this._getDownlinkQoE(u?"screen_audio":"audio",A/m,v);i=this._getNetworkQuality(E,g)}}if(s){if(0===d.receivedKBitrate||0===d.rtt)p=!1;else{var S=d.rtt,b=d.videoLossRate,T=d.stallDuration,y=d.statsInterval,R=d.e2eDelay,I=d._retransmittedRate,C=this._getQosLevel(S,b||0,I||0),k=this._getDownlinkQoE(u?"screen_video":"video",T/y,R);n=this._getNetworkQuality(C,k)}}var w=sN(r="".concat(l)).call(r,u?"_screen":"");if(h||p){var O=i&&n?Math.ceil((i+n)/2):i||n;if(O){var N,P,D=this._preDownlinkStats.get(w)||[O];this._preDownlinkStats.set(w,uk(N=sN(P=[]).call(P,le(D),[O])).call(N,-2)),this._startNetworkQualityReport()}}else this._preDownlinkStats.delete(w)}}},{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._delayTimer&&(window.clearTimeout(this._delayTimer),delete this._delayTimer),this._preUplinkStats.clear(),this._preDownlinkStats.clear()}},{key:"_startNetworkQualityReport",value:function(){var e=this;this._delayTimer||this._timer||(this._preUplinkStats.size>0||this._preDownlinkStats.size>0)&&(this._delayTimer=setTimeout(function(){delete e._delayTimer,e._reportNetworkQuality(),e._timer=window.setInterval(function(){e._reportNetworkQuality()},2e3)},300))}},{key:"_reportNetworkQuality",value:function(){var e,t,r,i,n=this;if(cd(e=["connected","connecting"]).call(e,null===(t=this._ctx.handler)||void 0===t?void 0:t.getConnectionState())){var o,a,s,c=this._getBetterQualityAndRemoveOldest("audio","up"),d=this._getBetterQualityAndRemoveOldest("video","up");r=c&&d?Math.ceil((c+d)/2):c||d||this._getBetterQualityAndRemoveOldest("screen_video","up")||this._getBetterQualityAndRemoveOldest("screen_audio","up")||pg.EXCELLENT;var u=s8(o=sU(a=pZ(fX(s=this._preDownlinkStats).call(s))).call(a,function(e){return n._getBetterQualityAndRemoveOldest(e,"down")})).call(o,function(e){return e});i=Math.ceil(c_(u).call(u,function(e,t){return t+e},0)/u.length)||pg.UNKNOWN}else r=i=pg.DOWN;navigator.onLine||(r=pg.DOWN,i=pg.DOWN),"function"==typeof this.reportor&&this.reportor(r,i)}},{key:"_getNetworkQuality",value:function(e,t){return 1===t?Math.max(e-2,1):2===t?e:Math.min(e+1,5)}},{key:"_getVideoUplinkNetworkQuality",value:function(e,t){return 1===t||0===t?e:2===t?Math.min(e+1,5):Math.min(e+2,5)}},{key:"_getQosLevel",value:function(e,t,r){var i;return i=(!e||e<=250)&&t<=.15?1:(!e||e<=500)&&t<=.3?2:(!e||e<=750)&&t<=.45?3:(!e||e<=1e3)&&t<=.6?4:5,r>.5?i=Math.max(i,4):r>.35?i=Math.max(i,3):r>.15&&(i=Math.max(i,2)),i}},{key:"_getUplinkQoE",value:function(e,t){var r=0;switch(e){case"audio":case"video":r=t<.05?1:t<.1?2:3;break;case"screen_video":case"screen_audio":r=t<.04?1:t<.08?2:3}return r}},{key:"_getUplinkVideoQoE",value:function(e,t){var r,i=(null==e||null===(r=e.videoStats)||void 0===r?void 0:r.rid)||"0";if(!t)return 0;var n=t.pubAttributes.videoDescriptions[i],o=e.videoStats,a=o.encodedFrameWidth*o.encodedFrameHeight/(n.width*n.height),s=o.sentFrameRate/n.framerate,c=0,d=0;return"number"!=typeof a||Number.isNaN(a)||(c=a>=.9?1:a<.9&&a>=.8?2:3),"number"!=typeof s||Number.isNaN(s)||(d=s>=.8?1:s<.8&&s>=.6?2:3),Math.max(0,c,d)}},{key:"_getDownlinkQoE",value:function(e,t,r){var i=RC[e];return t>i.stallRadio||r>i.delay||t>i.stallRadio/2&&r>i.delay/2?3:(t>i.stallRadio/2||i.delay,2)}},{key:"_getBetterQualityAndRemoveOldest",value:function(e,t){var r=pg.UNKNOWN,i="up"===t?this._preUplinkStats:this._preDownlinkStats,n=i.get(e);if(n){var o=s8(n).call(n,function(e){return e});o.length>0&&(r=Math.min.apply(Math,le(o))),n.shift(),0===n.length&&i.delete(e)}return r}},{key:"_getStreamActiveState",value:function(e){var t=e.subMediaType,r=e._attributes,i=e.subVideo;return{audioActive:e.subAudio&&Er(t)&&r.localaudio&&r.audiostream,videoActive:i&&Ei(t)&&r.localvideo&&r.videostream}}}]),e}(),Rw=function(){function e(t){nK(this,e),nQ(this,"_timer",void 0),nQ(this,"_remoteVideoSizeCache",{}),nQ(this,"_remoteScreenSizeCache",{}),nQ(this,"onchange",void 0),this._room=t,this._start()}return nY(e,[{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._remoteVideoSizeCache={},this._remoteScreenSizeCache={}}},{key:"_start",value:function(){var e=this;this._timer||(this._timer=window.setInterval(function(){var t={},r={};e._room.remoteStreams.forEach(function(i,n){i.forEach(function(i){var o,a=null===(o=i.videoTrack)||void 0===o?void 0:o.preprocessingTrack;if(a){var s=i.isScreen?e._remoteScreenSizeCache:e._remoteVideoSizeCache,c=s[n]||{},d=c.width,u=c.height,l=0,h=0;if(m4){var p,f,_=null!==(p=null==i||null===(f=i.videoTrack)||void 0===f?void 0:f.getSizeByPlayer())&&void 0!==p?p:{width:0,height:0};l=_.width,h=_.height}else{var A=a.getSettings();l=A.width||0,h=A.height||0}(void 0===u?0:u)===h&&(void 0===d?0:d)===l||"function"==typeof e.onchange&&e.onchange(n,i.isScreen,l,h),delete s[n],(i.isScreen?r:t)[n]={width:l,height:h}}})}),cG(e._remoteVideoSizeCache).forEach(function(t){"function"==typeof e.onchange&&e.onchange(t,!1,0,0)}),cG(e._remoteScreenSizeCache).forEach(function(t){"function"==typeof e.onchange&&e.onchange(t,!0,0,0)}),e._remoteVideoSizeCache=t,e._remoteScreenSizeCache=r},1e3))}}]),e}(),RO=pZ((new TextEncoder).encode("subt")),RN={1:h6.SUBTITLE_ERR_POSTPROCESS,2:h6.SUBTITLE_ERR_CONNECTION_ERROR,3:h6.SUBTITLE_ERR_PROCESS_ERROR},RP=new mJ("SubtitleTool",1),RD=function(e){if(e.extraInfo)try{var t,r=JSON.parse(e.extraInfo);r.source_language&&ux(t=["zh","en","ja"]).call(t,r.source_language)}catch(e){}else{var i,n,o=(null===(i=navigator.language)||void 0===i?void 0:i.substring(0,2))||"";ux(n=["zh","en","ja"]).call(n,o)>-1&&(e.extraInfo=sD({source_language:o}))}},RL=function(){var e,t,r,i;function n(e,t){nK(this,n),nQ(this,"_taskId",void 0),nQ(this,"_sourceLanguage","zh"),nQ(this,"_updating",!1),nQ(this,"onEvent",void 0),nQ(this,"onMessage",void 0),nQ(this,"_preConfig",void 0),nQ(this,"_timer",void 0),this._ctx=e,this._roomConf=t;var r=t.userInfo.extraInfo;if(r)try{var i=JSON.parse(r);i.source_language&&(this._sourceLanguage=i.source_language)}catch(e){}}return nY(n,[{key:"start",value:(i=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(RP.info("start","Invoke config: %o",t),E_(t.mode,"mode",[pC.ASR_ONLY,pC.ASR_AND_TRANSLATION]),r=Array.isArray(t.targetLanguage)?t.targetLanguage:[t.targetLanguage||""],!(t.mode===pC.ASR_AND_TRANSLATION&&hq(r).call(r,function(e){return -1===ux(Rx).call(Rx,e)})>-1)){e.next=5;break}throw new pB(h6.INVALID_PARAMS,"Invalid targetLanguage.");case 5:if(!this._taskId){e.next=7;break}throw new pB(h6.SUBTITLE_ALREADY_ON,"Already turned on subtitle");case 7:return this._preConfig={targetLanguage:r,mode:t.mode},this._taskId=(Date.now().toString()+this._roomConf.roomId+this._roomConf.userId).substring(0,20),e.next=11,this._sendSubtitleSignalingWithRetry(t,this._taskId);case 11:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"update",value:(r=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(RP.info("update","Invoke config: %o",t),this._taskId){e.next=3;break}throw new pB(h6.SUBTITLE_NOT_TURNED_ON,"Start subtitle first.");case 3:return this._sourceLanguage=t.sourceLanguage,this._updating=!0,e.prev=5,e.next=8,this._ctx.signalingManager.sendSignaling("controlMessage",this._genChangeSubtitleLanguageSignaling(t,this._taskId));case 8:e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(5),this._updating=!1,e.t0;case 14:case"end":return e.stop()}},e,this,[[5,10]])})),function(e){return r.apply(this,arguments)})},{key:"stop",value:function(){var e=this;RP.info("stop","Invoke"),this._taskId&&this._ctx.signalingManager.sendSignaling("controlMessage",{type:"subtitle",action:"stopped",appId:this._ctx.appId,roomId:this._roomConf.roomId,userId:this._roomConf.userId,taskId:this._taskId}).finally(function(){var t;delete e._taskId,null===(t=e.onEvent)||void 0===t||t.call(e,{event:pk.STOPPED}),e._clearTimer()})}},{key:"reconnect",value:(t=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._taskId||!this._preConfig){e.next=5;break}return e.next=3,this._ctx.signalingManager.sendSignaling("controlMessage",{type:"subtitle",action:"stopped",appId:this._ctx.appId,roomId:this._roomConf.roomId,userId:this._roomConf.userId,taskId:this._taskId});case 3:delete this._taskId,this.start(this._preConfig);case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return this._preConfig}},{key:"destroy",value:function(){RP.info("destroy","Invoke"),this.stop(),delete this._preConfig,delete this._taskId}},{key:"onResult",value:function(e){var t,r,i=e.body,n=i.error,o=i.errorMessage,a=i.eventType;if(0!==n){var s,c=new pB(RN[n]||h6.SUBTITLE_ERR_UNKNOWN,o||"");null===(s=this.onEvent)||void 0===s||s.call(this,{event:pk.ERROR,errorCode:c.code,errorMessage:c.message}),this._clearTimer()}else"SubtitleStarted"===a?(null===(t=this.onEvent)||void 0===t||t.call(this,{event:pk.STARTED}),this._clearTimer()):this._updating&&"LanguageChanged"===a&&(this._updating=!1,null===(r=this.onEvent)||void 0===r||r.call(this,{event:pk.UPDATED}))}},{key:"onMessageRecv",value:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this._taskId&&this._preConfig){var t=RM(e);if(!t||0===t.length)return!1;if(this._taskId&&this._preConfig){var r,i=this._preConfig,n=i.mode,o=i.targetLanguage,a=[];t.forEach(function(e){if(n===pC.ASR_ONLY)e.mode===n&&a.push(e);else{var t=cd(o).call(o,e.language);(t||e.mode===pC.ASR_ONLY)&&a.push(e),e.mode===pC.ASR_ONLY&&t&&a.push(l9(l9({},e),{},{mode:pC.ASR_AND_TRANSLATION}))}}),a.length>0&&(null===(r=this.onMessage)||void 0===r||r.call(this,a))}return!0}return!1}},{key:"_sendSubtitleSignalingWithRetry",value:(e=sk(sI().mark(function e(t,r){var i,o=this,a=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:0,e.next=3,this._ctx.signalingManager.sendSignaling("controlMessage",this._genSubtitleSignaling(t,r));case 3:this._timer=self.setTimeout(function(){var e;2===i?(null===(e=o.onEvent)||void 0===e||e.call(o,{event:pk.ERROR,errorCode:h6.TIME_OUT,errorMessage:"start subtitle timeout."}),delete o._timer,o.stop()):o._sendSubtitleSignalingWithRetry(t,r,i+1)},n.retryIntervel);case 4:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})},{key:"_genSubtitleSignaling",value:function(e,t){return{taskId:t,type:"subtitle",action:"started",roomId:this._roomConf.roomId,appId:this._ctx.appId,userId:this._roomConf.userId,subtitleMeta:{subtitleConfig:{mode:e.mode,usersConfig:[{userId:this._roomConf.userId,targetLanguages:Array.isArray(e.targetLanguage)?e.targetLanguage:[e.targetLanguage||""]}]},vendorConfig:{type:0}}}}},{key:"_genChangeSubtitleLanguageSignaling",value:function(e,t){return{taskId:t,type:"subtitle",action:"subtitleUpdated",roomId:this._roomConf.roomId,appId:this._ctx.appId,userId:this._roomConf.userId,subtitleMeta:{protocol:1,languageConfig:{sourceLanguages:[{userId:this._roomConf.userId,languageCode:[e.sourceLanguage]}]}}}}},{key:"_clearTimer",value:function(){this._timer&&(self.clearTimeout(this._timer),delete this._timer)}}]),n}();nQ(RL,"retryIntervel",3e4);var RM=function(e){var t=e.message;if(t instanceof ArrayBuffer&&t.byteLength>8)try{var r=new DataView(t,0),i=0;if(RO.every(function(e){return r.getUint8(i++)===e})){var n=r.getUint32(i);if(i+=4,n===r.byteLength-8){var o=v1.ab2str(uk(t).call(t,8)),a=JSON.parse(o),s=a.data;if("subtitle"===a.type)return s}}}catch(e){}return!1},Rx=["zh","zh-Hant","tn","vi","iu","it","id","hi","en","ho","he","es","el","uk","ur","tk","tr","ti","ty","tl","to","th","ta","te","sl","sk","ss","eo","sm","sg","st","sv","ja","tw","qu","pt","pa","no","nb","nr","my","bn","mn","mh","mk","ml","mr","ms","lu","ro","lt","lv","lo","kj","hr","kn","ki","cs","ca","nl","ko","ht","gu","ka","kl","km","lg","kg","fi","fj","fr","ru","ng","de","tt","da","ts","cv","fa","bs","pl","bi","nd","ba","bg","az","ar","af","sq","ab","os","ee","et","ay","lzh","am","ckb","cy","gl","ha","hy","ig","kmr","ln","nso","ny","om","sn","so","sr","sw","xh","yo","zu"];function RU(e,t){return l9(l9({},e),t)}function RB(e){var t={};return cG(e).forEach(function(r){var i=e[r];try{Array.isArray(i)?t[r]=sU(i).call(i,function(e){return null!==e&&"object"===nF(e)?RB(e):e}):null!==i&&"object"===nF(i)?t[r]=RB(i):t[r]=i}catch(e){}}),t}function RV(e){var t;return null===e?[]:sU(t=cG(e)).call(t,function(t){return e[t]})}var RF=new mJ("Locker",2),Rj=1,RG=function(){function e(t){var r;nK(this,e),nQ(this,"lockingPromise",sP.resolve()),nQ(this,"locks",0),nQ(this,"name",""),nQ(this,"lockId",void 0),nQ(this,"closeReason",void 0),this.lockId=Rj++,t&&(this.name=t),RF.info(sN(r="lock-".concat(this.name,"-")).call(r,this.lockId),"is created.")}return nY(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(){var e,t,r=this;this.locks+=1,RF.info(sN(e="lock-".concat(this.name,"-")).call(e,this.lockId),"locked, current queue ".concat(this.locks,"."));var i=new sP(function(e){t=function(){var t;r.locks-=1,RF.info(sN(t="lock-".concat(r.name,"-")).call(t,r.lockId),"unlocked, current queue ".concat(r.locks,".")),e()}}),n=this.lockingPromise.then(function(){return t});return this.lockingPromise=this.lockingPromise.then(function(){return i}),n}}]),e}(),RW=function(){var e;function t(e,r){nK(this,t),nQ(this,"roomId",void 0),nQ(this,"userInfo",void 0),nQ(this,"userId",void 0),nQ(this,"sessionId",f2()),nQ(this,"token",void 0),nQ(this,"rtcVid",void 0),nQ(this,"joinPromise",void 0),nQ(this,"startJoinTimestamp",void 0),nQ(this,"_liveControlMessage",void 0),nQ(this,"_userStreamMap",new d9),nQ(this,"_roomConfig",{isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:pb.communication}),nQ(this,"_vendorConfig",{enableMultiVendor:!1,vendorCode:0}),nQ(this,"_roomAttr",{multiChatMode:!1,bigRoomMode:!1}),nQ(this,"_tokenPublishPrivilegeExpired",!1),nQ(this,"_tokenSubscribePrivilegeExpired",!1),nQ(this,"_streamQueueMap",new d9),nQ(this,"_monitor",void 0),this._ctx=r,this.roomId=e.roomId,this.userInfo=e.userInfo,this.userId=e.userInfo.userId,this.token=e.token,this._monitor=mS(r.id)}return nY(t,[{key:"checkJoinRoom",value:(e=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.joinPromise;case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"vendorConfig",get:function(){return this._vendorConfig}},{key:"setVendorConfig",value:function(e){this._vendorConfig=e}},{key:"updateRoomAttributes",value:function(e){this._roomAttr=l9(l9({},this._roomAttr),e)}},{key:"setLiveControlMessage",value:function(e){this._liveControlMessage=e}},{key:"getLiveControlMessage",value:function(){return this._liveControlMessage}},{key:"isMultiChatMode",value:function(){return this._roomAttr.multiChatMode}},{key:"updateRoomConfig",value:function(e){return this._roomConfig=RU(this._roomConfig,e),this._roomConfig}},{key:"isAutoPublish",get:function(){return this._roomConfig.isAutoPublish}},{key:"isAutoSubscribeAudio",get:function(){return this._roomConfig.isAutoSubscribeAudio}},{key:"isAutoSubscribeVideo",get:function(){return this._roomConfig.isAutoSubscribeVideo}},{key:"remoteVideoConfig",get:function(){return this._roomConfig.remoteVideoConfig}},{key:"roomProfileType",get:function(){return this._roomConfig.roomProfileType||pb.communication}},{key:"updateUserPubInfo",value:function(e){var t=this._userStreamMap.get(e.clientId)||{};e.screen?(t.screenAudio=e.attributes.audiostream,t.screenVideo=e.attributes.videostream):(t.audio=e.attributes.audiostream,t.video=e.attributes.videostream),this._userStreamMap.set(e.clientId,t)}},{key:"getUserPubInfo",value:function(e){return l9({audio:!1,video:!1,screenAudio:!1,screenVideo:!1},this._userStreamMap.get(e)||{})}},{key:"resetUserPubInfo",value:function(){this._userStreamMap.clear()}},{key:"tokenPublishPrivilegeExpired",get:function(){return this._tokenPublishPrivilegeExpired}},{key:"tokenSubscribePrivilegeExpired",get:function(){return this._tokenSubscribePrivilegeExpired}},{key:"setTokenPublishPrivilegeExpired",value:function(e){this._tokenPublishPrivilegeExpired=e}},{key:"setTokenSubscribePrivilegeExpired",value:function(e){this._tokenSubscribePrivilegeExpired=e}},{key:"getStayRoomDuration",value:function(){return this.startJoinTimestamp?v0()-this.startJoinTimestamp:0}},{key:"getStreamQueueLock",value:function(e){var t=this._streamQueueMap.get(e);return t||(t=new RG(e),this._streamQueueMap.set(e,t)),t}},{key:"report",value:function(e,t,r){var i;null===(i=this._monitor)||void 0===i||i.report(e,l9({room_id:this.roomId,user_id:this.userId,rtc_session_id:this.sessionId,rtc_vid:this.rtcVid},t),r)}}]),t}(),RH=function(e,t,r){r.info(e,"userId: %o, subAudio: %o, subVideo: %o, audioMid: %o, videoMid: %o, sequenceId: %o",t.userId,t.subAudio,t.subVideo,t.audioMid,t.videoMid,t.sequenceId)};function RY(e,t,r){var i=r.value;return r.value=sk(sI().mark(function e(){var r,n,o,a=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._ctx.signalingManager.isConnected()){e.next=2;break}throw new pB(h6.NOT_CONNECTED_YET,"error in ".concat(t,": try again after connect"));case 2:return e.prev=2,e.next=5,(this._roomConf||this.config).checkJoinRoom();case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),new pB(h6.JOIN_ROOM_FAILED,"error in ".concat(t,": try again after joined"));case 10:for(n=Array(r=a.length),o=0;o<r;o++)n[o]=a[o];return e.abrupt("return",i.apply(this,n));case 12:case"end":return e.stop()}},e,this,[[2,7]])})),r}function RK(e,t,r){var i=r.value;return r.value=sk(sI().mark(function e(){var r,n,o,a,s,c,d,u,l=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=this._roomConf,n=this._logger,a=Array(o=l.length),s=0;s<o;s++)a[s]=l[s];if(null!=(c=a[0])&&c.streamId){e.next=6;break}return e.abrupt("return",null==i?void 0:i.apply(this,a));case 6:return d=c.streamId,n.info("streamQueue","lock stream %o, task %o",uk(d).call(d,-5),t),e.next=10,r.getStreamQueueLock(d).lock();case 10:return u=e.sent,e.prev=11,e.next=14,null==i?void 0:i.apply(this,a);case 14:return e.abrupt("return",e.sent);case 15:return e.prev=15,n.info("streamQueue","unlock stream %o, task %o",uk(d).call(d,-5),t),u(),e.finish(15);case 19:case"end":return e.stop()}},e,this,[[11,,15,19]])})),r}var RQ=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},Rz=function(e){hA(c,EL);var t,r,i,n,o,a,s=hI(c);function c(e,t){var r;return nK(this,c),nQ(he(r=s.call(this)),"_forwardDstRooms",new d9),nQ(he(r),"forwardStreamState","stopped"),r._ctx=e,r._roomConf=t,r}return nY(c,[{key:"startForwardStream2Rooms",value:(a=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("running"!==this.forwardStreamState&&"paused"!==this.forwardStreamState){e.next=2;break}throw new pB(h6.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke startForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("start",this._roomConf.roomId,t);case 4:return r=e.sent,this._updateDstRooms(t,r),i=this._transformForwardStreamResult(r),this.forwardStreamState="running",e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(o=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new pB(h6.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke updateForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult(t),"running"!==this.forwardStreamState){e.next=7;break}return e.next=6,this._sendForwardStreamSignaling("update",this._roomConf.roomId,t);case 6:r=e.sent;case 7:return this._updateDstRooms(t,r),i=this._transformForwardStreamResult(r),e.abrupt("return",i);case 10:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(n=sk(sI().mark(function e(){var t,r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("stopped"!==this.forwardStreamState){e.next=2;break}throw new pB(h6.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke stopForwardStreamToRooms in state: ".concat(this.forwardStreamState));case 2:if(r=this._mockForwardStreamResult([]),"running"!==this.forwardStreamState){e.next=7;break}return e.next=6,this._sendForwardStreamSignaling("stop",this._roomConf.roomId);case 6:r=e.sent;case 7:if(this._updateDstRooms([],r),!(le(fX(t=this._forwardDstRooms).call(t)).length>0)){e.next=10;break}throw new pB(h6.UNEXPECTED_ERROR,"stopforwardstream failed: ".concat(sD(r)));case 10:return i=this._transformForwardStreamResult(r),this.forwardStreamState="stopped",e.abrupt("return",i);case 13:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(i=sk(sI().mark(function e(){var t,r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("paused"!==this.forwardStreamState&&"stopped"!==this.forwardStreamState){e.next=2;break}throw new pB(h6.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke pauseForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 2:return e.next=4,this._sendForwardStreamSignaling("stop",this._roomConf.roomId);case 4:return t=e.sent,r=this._transformForwardStreamResult(t),this.forwardStreamState="paused",e.abrupt("return",r);case 8:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(r=sk(sI().mark(function e(){var t,r,i,n,o=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o.length>0&&void 0!==o[0]&&o[0]||!cd(t=["running","stopped"]).call(t,this.forwardStreamState)){e.next=3;break}throw new pB(h6.UNEXPECTED_INVOKE_FORWARD_STREAM,"should not invoke resumeForwardStreamToAllRooms in state: ".concat(this.forwardStreamState));case 3:return r=this._getDstRooms(),e.next=6,this._sendForwardStreamSignaling("start",this._roomConf.roomId,r);case 6:return i=e.sent,this._updateDstRooms(r,i),n=this._transformForwardStreamResult(i),this.forwardStreamState="running",e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"resumeFromReconnect",value:function(){var e=this;"running"===this.forwardStreamState&&this.resumeForwardStream2AllRooms(!0).then(function(t){t.forEach(function(t){t.state===pw.FORWARD_STREAM_STATE_FAILURE&&e.safeEmit(Rg.ON_FORWARD_STREAM_ERROR,t)})})}},{key:"onForwardDstRoomUserKick",value:function(e){var t=[{dstRoomId:e.dstRoomId,code:200,forwardStreamType:"stop"}];this._updateDstRooms([],t),this.safeEmit(Rg.ON_FORWARD_STREAM_ERROR,{roomId:e.dstRoomId,state:pw.FORWARD_STREAM_STATE_FAILURE,error:pO.FORWARD_STREAM_ERROR_REMOTE_KICKED})}},{key:"destoy",value:function(){hf(hp(c.prototype),"removeAllListeners",this).call(this),this._forwardDstRooms.clear(),this.forwardStreamState="stopped"}},{key:"_mockForwardStreamResult",value:function(e){var t=this,r=[];return this._forwardDstRooms.forEach(function(e,t){r.push({dstRoomId:t,forwardStreamType:"stop",code:200})}),e.forEach(function(e){var i=hq(r).call(r,function(t){return t.dstRoomId===e.roomId});-1===i?r.push({dstRoomId:e.roomId,forwardStreamType:"start",code:e.roomId===t._roomConf.roomId?400:200}):r[i].forwardStreamType="update"}),r}},{key:"_transformForwardStreamResult",value:function(e){e||(e=[]);var t,r=[],i=sz(e);try{for(i.s();!(t=i.n()).done;){var n=t.value,o=n.dstRoomId,a=n.code,s={roomId:o,state:pw.FORWARD_STREAM_STATE_SUCCESS,error:pO.FORWARD_STREAM_ERROR_OK};200===a||(400===a?(s.state=pw.FORWARD_STREAM_STATE_FAILURE,s.error=pO.FORWARD_STREAM_ERROR_REMOTE_KICKED):a>=700&&a<800?(s.state=pw.FORWARD_STREAM_STATE_FAILURE,s.error=pO.FORWARD_STREAM_ERROR_INVALID_TOKEN):(s.state=pw.FORWARD_STREAM_STATE_FAILURE,s.error=pO.FORWARD_STREAM_ERROR_RESPONSE)),r.push(s)}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"_updateDstRooms",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];0===r.length&&this._forwardDstRooms.clear(),r.forEach(function(r){var i=r.dstRoomId,n=r.code,o=r.forwardStreamType;if(200===n){if("stop"===o)t._forwardDstRooms.delete(i);else{var a,s=uC(e).call(e,function(e){return e.roomId===i});if(!s&&!t._forwardDstRooms.has(i))throw new pB(h6.UNEXPECTED_ERROR,"unknow roomid ".concat(i," in signaling return"));var c=null!==(a=t._forwardDstRooms.get(i))&&void 0!==a?a:{token:void 0};c=uo(c,s),t._forwardDstRooms.set(i,c)}}else t._forwardDstRooms.has(i)&&t._forwardDstRooms.delete(i)})}},{key:"_getDstRooms",value:function(){var e=[];return this._forwardDstRooms.forEach(function(t,r){e.push({roomId:r,token:t.token})}),e}},{key:"_sendForwardStreamSignaling",value:(t=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(v5()),"stop"!==t&&(o=sU(i).call(i,function(e){return e.roomId}),this._roomConf.report("rtc_forward_stream",{type:"begin",dst_rooms:"{ ".concat(sU(o).call(o,function(e){return'"'.concat(e,'"')}).join(",")," }"),event_session_id:n})),a={forwardStreamType:t,roomId:r},("start"===t||"update"===t)&&(a.dstRoomInfos=null==i?void 0:sU(i).call(i,function(e){return{dstRoomId:e.roomId,dstToken:v1.token2auth(l._ctx.appId,e.roomId,l._roomConf.userId,e.token)}})),e.next=7,this._ctx.signalingManager.sendSignaling("forwardStream",a);case 7:if(s=e.sent,c=[],200===(null==s?void 0:s.code)){e.next=12;break}throw"stop"!==t&&(null==i||i.forEach(function(e){c.push({dst_room_id:e.roomId,result:"server error ".concat(null==s?void 0:s.code)})}),this._roomConf.report("rtc_forward_stream",{type:"end",dst_rooms:sD(c),event_session_id:n})),new pB(h6.UNEXPECTED_ERROR,"server side internal error, error code: ".concat(s));case 12:return"stop"!==t&&(null===(d=s.forwardStreamResults)||void 0===d||d.forEach(function(e){c.push({dst_room_id:e.dstRoomId,result:"dst room lost"})}),null===(u=s.forwardStreamResults)||void 0===u||u.forEach(function(e){var t=uC(c).call(c,function(t){return t.dst_room_id===e.dstRoomId});t&&(200===e.code?"update"===e.forwardStreamType?t.result="update":t.result="success":t.result="server error ".concat(e.code))}),this._roomConf.report("rtc_forward_stream",{type:"end",dst_rooms:sD(c),event_session_id:n})),e.abrupt("return",s.forwardStreamResults);case 14:case"end":return e.stop()}},e,this)})),function(e,r,i){return t.apply(this,arguments)})}]),c}();RQ([RY],Rz.prototype,"startForwardStream2Rooms",1),RQ([RY],Rz.prototype,"updateForwardStream2Rooms",1),RQ([RY],Rz.prototype,"stopForwardStream2Rooms",1),RQ([RY],Rz.prototype,"pauseForwardStream2AllRooms",1),RQ([RY],Rz.prototype,"resumeForwardStream2AllRooms",1);var RX=[{maxLayers:3,totalPixels:2073600},{maxLayers:3,totalPixels:921600},{maxLayers:3,totalPixels:518400},{maxLayers:2,totalPixels:230400},{maxLayers:2,totalPixels:129600},{maxLayers:1,totalPixels:57600},{maxLayers:1,totalPixels:0}],RJ=function(e,t){var r=hq(RX).call(RX,function(r){return e*t>=r.totalPixels});if(0===r)return RX[r].maxLayers;var i=RX[r-1].totalPixels;return(i-e*t)/(i-RX[r].totalPixels)<.1?RX[r-1].maxLayers:RX[r].maxLayers};function Rq(e,t,r){var i,n=e?null===(i=uC(r).call(r,function(t){return t.rid===e}))||void 0===i?void 0:i.maxkbps:r[0].maxkbps;return Math.min(null!=n?n:Number.POSITIVE_INFINITY,t)}var RZ=function(e,t){for(var r,i,n,o,a,s,c,d=(null==t?void 0:t.attributes)||{},u=d.videoDescriptions,l=d.subVideoDescriptions,h=Array.isArray(l)?l:u,p=-1,f=e.width*e.height,_=0;_<(null==h?void 0:h.length);_++)if(f>=(null===(r=h[_])||void 0===r?void 0:r.width)*(null===(i=h[_])||void 0===i?void 0:i.height)){p=_;break}var A=h[0];if(-1===p)A=h[p=h.length-1];else if(0!==p){var m=h[p-1].width*h[p-1].height,v=(m-f)/(m-h[p].width*h[p].height);A=v<.1?h[p-1]:h[p],p=v<.1?p-1:p}return c=null!==(n=null===(o=A)||void 0===o?void 0:o.sub_index)&&void 0!==n?n:-1,{spatialLayer:null!==(a=null===(s=A)||void 0===s?void 0:s.video_index)&&void 0!==a?a:p,spatialSubLayer:c}},R$=function(e){return{width:Ec(e.width),height:Ec(e.height),frameRate:Ec(e.frameRate),maxKbps:e.maxKbps}},R0=function(e){var t=e.width,r=e.height;return Ec(t)*Ec(r)},R2=function(e,t){var r=Ec(e.width)/Ec(t.width)||1,i=Ec(e.height)/Ec(t.height)||1;Math.floor(r)===r&&Math.floor(i)===i||Es("setLocalSimulcastMode: The resolution setting needs to be an integer multiple")},R1=d(hr);ti({target:"Reflect",stat:!0,forced:p(function(){var e=function(){},t=e$.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)})},{set:function e(t,r,i){var n,o,a,s=arguments.length<4?t:arguments[3],c=N.f(e4(t),r);if(!c){if(J(o=iK(t)))return e(o,r,i,s);c=j(0)}if(ht(c)){if(!1===c.writable||!J(s))return!1;if(n=N.f(s,r)){if(n.get||n.set||!1===n.writable)return!1;n.value=i,e$.f(s,r,n)}else e$.f(s,r,j(0,i))}else{if(void 0===(a=c.set))return!1;L(a,s,i)}return!0}});var R4=q.Reflect.set,R6=d(R4),R3=function(){function e(t){nK(this,e),nQ(this,"_roomId",void 0),nQ(this,"_constraints",{}),nQ(this,"_profile",void 0),nQ(this,"_customMaxBitrate",0),this._appId=t}return nY(e,[{key:"setRoomId",value:function(e){this._roomId=e}},{key:"setAudioProfile",value:function(e){this._profile=e,this._customMaxBitrate=0}},{key:"customMaxBitrate",get:function(){return this._customMaxBitrate}},{key:"setCustomMaxBitrate",value:function(e){var t=vw.getEngineWebConfig(this._appId,this._roomId||"").audio_encode;this._customMaxBitrate=null!=t&&t.bitrate?0:1e3*e}},{key:"getOpusConfigStr",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=vw.getEngineWebConfig(this._appId,this._roomId||"").audio_encode,i=this.getConstraints(),n=i.sampleRate,o=i.channelCount,a="number"==typeof n?n:null==n?void 0:n.exact,s="number"==typeof o?o:null==o?void 0:o.exact,c={};t.split(";").forEach(function(e){var t=sq(e.split("="),2),r=t[0],i=t[1];r&&i&&(c[r]=i)});var d=(null==r?void 0:r.bitrate)||this._customMaxBitrate||this._getConfigByAudioProfile().bitrate;d&&(c.maxaveragebitrate=d);var u=(null==r?void 0:r.enc_sample_rate)||a;u&&(c["sprop-maxcapturerate"]=u);var l=(null==r?void 0:r.playback_rate)||a;return l&&(c.maxplaybackrate=l),(s&&s>1||null!=r&&r.stereo)&&(c["sprop-stereo"]=1,c.stereo=1),null!=r&&r.dtx&&(c.usedtx=1),sU(e=cG(c)).call(e,function(e){var t;return sN(t="".concat(e,"=")).call(t,c[e])}).join(";")}},{key:"updateConstraints",value:function(e){this._constraints=l9(l9({},this._constraints),e)}},{key:"getConstraints",value:function(){var e=l9({},this._constraints),t=vw.getEngineWebConfig(this._appId,this._roomId||"").audio_capture;Eo(null==t?void 0:t.sample_rate)||(e.sampleRate=t.sample_rate),Eo(null==t?void 0:t.channel)||(e.channelCount=t.channel),Eo(null==t?void 0:t.agc)||(e.autoGainControl=t.agc),Eo(null==t?void 0:t.ans)||(e.noiseSuppression=t.ans),Eo(null==t?void 0:t.aec)||(e.echoCancellation=t.aec);var r=this._getConfigByAudioProfile(),i=r.sampleRate,n=r.channel;return Eo(e.sampleRate)&&!Eo(i)&&(e.sampleRate=i),Eo(e.channelCount)&&!Eo(n)&&(e.channelCount=n),e}},{key:"_getConfigByAudioProfile",value:function(){var e={};switch(this._profile){case pT.fluent:e.sampleRate=16e3,e.bitrate=24e3;break;case pT.standard:e.sampleRate=48e3,e.bitrate=48e3;break;case pT.hd:e.sampleRate=48e3,e.bitrate=128e3,e.channel=2;break;case pT.standardStereo:e.sampleRate=48e3,e.bitrate=8e4,e.channel=2;break;case pT.hdMono:e.sampleRate=48e3,e.bitrate=128e3}return e}}]),e}(),R8={start_interval:100,multiplier:2,max_interval:3e4},R5=function(){function e(){nK(this,e),nQ(this,"_times",0),nQ(this,"_config",R8),nQ(this,"initTs",v0())}return nY(e,[{key:"getRetryDelay",value:function(){return Math.min(this._config.max_interval,Math.pow(this._config.multiplier,this._times++)*this._config.start_interval)}},{key:"setConfig",value:function(e){this._config=e}},{key:"reset",value:function(){this._times=0}}]),e}(),R9=function(){var e,t,r,i,n;function o(e){var t=this;nK(this,o),nQ(this,"_reconnectTimer",void 0),nQ(this,"_retryFunc",void 0),nQ(this,"_abortControllers",[]),nQ(this,"_monitor",void 0),nQ(this,"logger",void 0),nQ(this,"_groupConfigId",v$()),nQ(this,"_retryLimiter",new R5),nQ(this,"_timer",void 0),nQ(this,"_destroyed",!1),nQ(this,"_onlineListener",function(){t._reconnectTimer&&t._retryFunc&&(clearTimeout(t._reconnectTimer),t._retryFunc())}),this._ctx=e,this._monitor=mS(e.id),this.logger=new mJ("ICERequest",4,e.id),window.addEventListener("online",this._onlineListener)}return nY(o,[{key:"getICENode",value:(n=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("getICENode","invoke"),e.prev=1,e.next=4,this._getAccessWithRetry(t);case 4:if(0!==(r=e.sent).length){e.next=7;break}throw Error("server return empty nodes.");case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),this._reportRtcInvokeStatus("es.join.getNodeFailed",e.t0),new pB(h6.ICE_SERVER_WRONG,"get ICE config failed: ".concat(e.t0.message),e.t0);case 13:return this.logger.success("getICENode","success"),this._reportRtcInvokeStatus("es.join.getNodeSuccess",r),e.abrupt("return",r);case 16:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return n.apply(this,arguments)})},{key:"_getAccessWithRetry",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0!==r&&this.logger.info("_getAccessWithRetry()","invoke feedbackInfo: %o, 201count: %o",e,r),new sP(function(i,n){t._getAccessNode(e).then(function(e){t._retryLimiter.reset(),i(e)}).catch(function(o){if(!t._destroyed){if(Array.isArray(o)&&o.length>0){if(hq(o).call(o,function(e){return 400<=e.code&&e.code<500})>-1)return t._retryLimiter.reset(),n(Error("HTTP request failed(4xx)"));if(o.every(function(e){var t;return 201===e.code||201===(null===(t=e.error)||void 0===t?void 0:t.code)})&&r++,3===r)return t._retryLimiter.reset(),n(Error("HTTP request failed(201)"))}var a=t._retryLimiter.getRetryDelay();t.logger.warn("_getAccessWithRetry()","_getAccessWithRetry error, will retry after ".concat(a,"ms"),o),t._retryFunc=function(){t._getAccessWithRetry(e,r).then(i).catch(n)},t._reconnectTimer=self.setTimeout(t._retryFunc,a)}})})}},{key:"_getAccessNode",value:(i=sk(sI().mark(function e(t){var r=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new sP(function(e,i){var n=vw.getAccessNode(r._ctx.appId);if(n){var o,a=sU(o=Array.isArray(n)?n:[n]).call(o,function(e){return e.cache_status=!0,e});r.logger.info("getAccessNode","use cache node."),e(a),r._timer=setTimeout(function(){r._getAccessNodeFromServer(t),r._reportRtcInvokeStatus("es.R.node.cache",n),delete r._timer},0)}else r._getAccessNodeFromServer(t).then(e).catch(i)}));case 1:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)})},{key:"_getAccessNodeFromServer",value:(r=sk(sI().mark(function e(t){var r,i,n,o=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=(r=this._getAccessUrls()).urls,n=r.needFallback,e.abrupt("return",this.getICEConfigFromServer(i,t).then(function(e){var t=e.nodes;return!o._ctx.useCloudProxy&&(null==t?void 0:t.length)>0&&vw.setAccessNode(o._ctx.appId,t,e.ttl||11200),e.dispatchDomains&&!o._ctx.useCloudProxy&&vw.setAccessUrls(e.dispatchDomains),t}).catch(function(e){if(n)return o._reportRtcInvokeStatus("es.R.req.fallback",""),vw.clearAccessUrls(),o._getAccessNodeFromServer(t);throw e}));case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_getAccessUrls",value:function(){var e=vw.getAccessUrls()||[],t=!0;return this._reportRtcInvokeStatus("es.R.req.cache.urls",e),0===e.length&&(e=vx.ICE_CONFIG_REQUEST_URLS,t=!1,this._reportRtcInvokeStatus("es.R.req.external.urls",e)),0===e.length&&(e=vx.ICE_CONFIG_REQUEST_URLS_INTERNAL,t=!1,this._reportRtcInvokeStatus("es.R.req.internal.urls",e)),{urls:e,needFallback:t}}},{key:"getICEConfigFromServer",value:(t=sk(sI().mark(function e(t,r){var i,n,o,a,s=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={appID:this._ctx.appId,deviceID:vw.getDeviceId(),os:"web",sdkVersion:vx.VERSION,isOversea:vx.OVERSEA,expectedAddr:vB("EXPECTED_ADDR"),productPlatform:"VolcEngine",enableCloudProxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC},r&&(i.feedbackInfo=r,"ICE_FAILED"!==(null===(n=r[0])||void 0===n||null===(o=n.feedbackReason)||void 0===o?void 0:o.type)&&delete i.expectedAddr),a=sU(t).call(t,function(e){return s._httpRequest(e,i)}),e.abrupt("return",Ee(a));case 4:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"_httpRequest",value:(e=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=v$(),r.connectSessionID=n,o=Date.now(),null===(i=this._monitor)||void 0===i||i.report("rtc_get_access",{error_code:0,message:sD(r),elapse:0,type:"request",host:t,config_id:n,group_config_id:this._groupConfigId}),a=new AbortController,this._abortControllers.push(a),e.prev=6,e.prev=7,e.next=10,fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:sD(r),signal:a.signal});case 10:s=e.sent,e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),f4(fetch)||null===(u=this._monitor)||void 0===u||u.report("rtc_error",{error_code:yL.Fetch_MODIFY,message:"get access failed, possibly due to modifying the browser's Fetch API."},{origin_error:e.t0}),e.t0;case 17:if(this._abortControllers=s8(c=this._abortControllers).call(c,function(e){return e!==a}),200===s.status){e.next=20;break}throw{message:s.statusText,code:s.status};case 20:return e.next=22,s.json();case 22:if(200===(l=e.sent).code){e.next=25;break}throw l;case 25:return null===(d=this._monitor)||void 0===d||d.report("rtc_get_access",{error_code:200,message:sD(l),elapse:Date.now()-o,type:"response",host:t,config_id:n,group_config_id:this._groupConfigId}),e.abrupt("return",l);case 29:throw e.prev=29,e.t1=e.catch(6),null===(h=this._monitor)||void 0===h||h.report("rtc_get_access",{error_code:Number((null===e.t1||void 0===e.t1?void 0:e.t1.code)||(null===e.t1||void 0===e.t1?void 0:e.t1.server_code)),message:null===e.t1||void 0===e.t1?void 0:e.t1.message,elapse:Date.now()-o,type:"response",host:t,config_id:n,group_config_id:this._groupConfigId},{error:sD(e.t1)}),e.t1;case 33:case"end":return e.stop()}},e,this,[[6,29],[7,13]])})),function(t,r){return e.apply(this,arguments)})},{key:"destroy",value:function(){this._destroyed=!0,window.removeEventListener("online",this._onlineListener),this._abortControllers.forEach(function(e){return e.abort()}),this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer),this._timer&&(window.clearTimeout(this._timer),delete this._timer)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r;null===(r=this._monitor)||void 0===r||r.report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:0,stream_id:"",elapse:0,group_config_id:this._groupConfigId})}}]),o}(),R7={},Ie={},It={exports:{}},Ir=It.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=(null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v"),null!=e.generation&&(t+=" generation %d"),t+=(null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+((null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":"")+(null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":""))}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};cG(Ir).forEach(function(e){Ir[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});var Ii=It.exports;IA=Ie,Im=function(e){return String(Number(e))===e?Number(e):e},Iv=function(e,t,r){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var n=e.push?{}:i?t[e.name]:t;!function(e,t,r,i){if(i&&!r)t[i]=Im(e[1]);else for(var n=0;n<r.length;n+=1)null!=e[n+1]&&(t[r[n]]=Im(e[n+1]))}(r.match(e.reg),n,e.names,e.name),e.push&&t[e.push].push(n)},IE=RegExp.prototype.test.bind(/^([a-z])=(.*)/),IA.parse=function(e){var t,r={},i=[],n=r;return s8(t=e.split(/(\r\n|\r|\n)/)).call(t,IE).forEach(function(e){var t=e[0],r=uk(e).call(e,2);"m"===t&&(i.push({rtp:[],fmtp:[]}),n=i[i.length-1]);for(var o=0;o<(Ii[t]||[]).length;o+=1){var a=Ii[t][o];if(a.reg.test(r))return Iv(a,n,r)}}),r.media=i,r},Ig=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=Im(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e},IA.parseParams=function(e){var t;return c_(t=e.split(/;\s?/)).call(t,Ig,{})},IA.parseFmtpConfig=IA.parseParams,IA.parsePayloads=function(e){var t;return sU(t=e.toString().split(" ")).call(t,Number)},IA.parseRemoteCandidates=function(e){for(var t,r=[],i=sU(t=e.split(" ")).call(t,Im),n=0;n<i.length;n+=3)r.push({component:i[n],ip:i[n+1],port:i[n+2]});return r},IA.parseImageAttributes=function(e){var t;return sU(t=e.split(" ")).call(t,function(e){var t;return c_(t=e.substring(1,e.length-1).split(",")).call(t,Ig,{})})},IA.parseSimulcastStreamList=function(e){var t;return sU(t=e.split(";")).call(t,function(e){var t;return sU(t=e.split(",")).call(t,function(e){var t,r=!1;return"~"!==e[0]?t=Im(e):(t=Im(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})};var In=/%[sdv%]/g,Io=function(e){var t=1,r=arguments,i=r.length;return e.replace(In,function(e){if(t>=i)return e;var n=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}})},Ia=function(e,t,r){var i=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var o=t.names[n];t.name?i.push(r[t.name][o]):i.push(r[t.names[n]])}else i.push(r[t.name]);return Io.apply(null,i)},Is=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Ic=["i","c","b","a"];R7.write=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||Is,i=t.innerOrder||Ic,n=[];return r.forEach(function(t){Ii[t].forEach(function(r){r.name in e&&null!=e[r.name]?n.push(Ia(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){n.push(Ia(t,r,e))})})}),e.media.forEach(function(e){n.push(Ia("m",Ii.m[0],e)),i.forEach(function(t){Ii[t].forEach(function(r){r.name in e&&null!=e[r.name]?n.push(Ia(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){n.push(Ia(t,r,e))})})})}),n.join("\r\n")+"\r\n"},R7.parse=Ie.parse,R7.parseParams=Ie.parseParams,R7.parseFmtpConfig=Ie.parseFmtpConfig,R7.parsePayloads=Ie.parsePayloads,R7.parseRemoteCandidates=Ie.parseRemoteCandidates,R7.parseImageAttributes=Ie.parseImageAttributes,R7.parseSimulcastStreamList=Ie.parseSimulcastStreamList;var Id=new mJ("FirefoxHandler",3),Iu="kp34Za0H+aVf862l";function Il(e){return e>0xffffffee?(Id.warn("generateAllSsrc","reset start id",e),Il(e=e-0x100000000+1e4+18)):{audio:e,audioFec:e+1,audioRtx:e+2,video:e+3,videoFec:e+4,videoRtx:e+5,next:e+18}}var Ih=function(e,t,r){var i,n,o;return[{id:r,attribute:"cname",value:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"o/i14u9pJrxRKAsu"},{id:r,attribute:"msid",value:sN(i=sN(n="".concat(e," ")).call(n,e,"-")).call(i,t)},{id:r,attribute:"mslabel",value:"".concat(e)},{id:r,attribute:"label",value:sN(o="".concat(e,"-")).call(o,t)}]},Ip=function(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.video,o=t.videoRtx,a=t.videoFec,s=[n,o],c=i.cname,d=i.flexfec;d&&s.push(a);var u,l=c_(s).call(s,function(t,r){return sN(t).call(t,Ih(e,"video",r,c))},[]),h=[{semantics:"FID",ssrcs:sN(r="".concat(n," ")).call(r,o)}];return d&&h.push({semantics:"FEC-FR",ssrcs:sN(u="".concat(n," ")).call(u,a)}),{ssrcs:l,ssrcGroups:h}};function If(e){return e.direction="inactive",e.port=0,delete e.ext,delete e.ssrcs,delete e.ssrcGroups,delete e.simulcast,delete e.simulcast_03,delete e.rids,delete e.extmapAllowMixed,delete e.msid,delete e.bundleOnly,e}var I_=function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=l9(l9({},e),{},{media:[]});return i&&(n.invalid=[{value:"realx-exts:rscp"}]),t&&n.media.push(t),r&&n.media.push(r),delete n.groups,delete n.msidSemantic,R7.write(n)};var IA,Im,Iv,IE,Ig,IS,Ib,IT,Iy,IR,II,IC,Ik=function(e){var t=(new TextEncoder).encode("PREC"),r=function(e){for(var t=atob(e),r=t.length,i=new Uint8Array(r),n=0;n<r;n++)i[n]=t.charCodeAt(n);return i}(e),i=new Uint8Array(4);crypto.getRandomValues(i);var n=new Uint8Array(2);return n[0]=0,n[1]=1,function(e){for(var t="",r=e.byteLength,i=0;i<r;i++)t+=String.fromCharCode(e[i]);return btoa(t)}(v2(Uint8Array,t,r,i,n))},Iw=function(e,t){if(Array.isArray(e.fmtp)&&Array.isArray(e.rtp)){for(var r,i=0;i<e.rtp.length;i++)if(e.rtp[i].codec.toUpperCase()===t.toUpperCase()){e.rtp.unshift(uH(r=e.rtp).call(r,i,1)[0]);break}var n=[];e.rtp.forEach(function(e){return n.push(e.payload)}),e.payloads=n.join(" ")}},IO=function(e,t){var r=0;if(Array.isArray(e.fmtp)&&Array.isArray(e.rtp)){var i,n=sz(e.fmtp);try{for(n.s();!(i=n.n()).done;){var o,a,s,c=i.value;if(cd(o=c.config).call(o,"level-asymmetry-allowed=1")&&cd(a=c.config).call(a,"packetization-mode=1")&&cd(s=c.config).call(s,"profile-level-id=42e0")){r=c.payload;break}}}catch(e){n.e(e)}finally{n.f()}for(var d=0;d<e.rtp.length;d++){var u,l,h=e.rtp[d];if("H264"===t){if(h.payload===r){e.rtp.unshift(uH(u=e.rtp).call(u,d,1)[0]);break}}else if(h.codec===t){e.rtp.unshift(uH(l=e.rtp).call(l,d,1)[0]);break}}var p=[];e.rtp.forEach(function(e){return p.push(e.payload)}),e.payloads=p.join(" ")}},IN=function(e){var t,r=R7.parse(e);return r.media=sU(t=r.media).call(t,function(e){return"audio"===e.type?IL(e,r):ID(e,["H264","VP8","ByteVC1"],r)}),R7.write(r)},IP=function(e){e.media.forEach(function(e){"audio"!==e.type&&"video"!==e.type||e.rtp.forEach(function(t){var r;e.rtcpFb||(e.rtcpFb=[]),uC(r=e.rtcpFb).call(r,function(e){return e.payload===t.payload&&"rrtr"===e.type})||e.rtcpFb.push({payload:t.payload,type:"rrtr"})})})},ID=function(e,t,r){var i,n,o,a,s,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{rrtr:!1},d={},u={},l=-1,h=[];return Array.isArray(e.fmtp)&&e.fmtp.forEach(function(e){var t=e.payload,r=e.config;if(h4(r).call(r,"apt=")){var i=uk(r).call(r,4);d[t]=i}else cd(r).call(r,"42e0")&&cd(r).call(r,"packetization-mode=1")&&(l=t)}),Array.isArray(e.rtp)&&(e.rtp=s8(i=e.rtp).call(i,function(e){var r,i=e.codec,n=e.payload;switch(i){case"H264":return r=!1,sU(t).call(t,function(e){"H264"===e&&n===l&&(u[n]=n,h.push(n),r=!0)}),r;case"rtx":return!!u[d[n]]&&(u[n]=n,!0);case"red":case"ulpfec":case"flexfec-03":return u[n]=n,!0;default:return r=!1,sU(t).call(t,function(e){e===i&&(u[n]=n,h.push(n),r=!0)}),r}})),Array.isArray(e.fmtp)&&(e.fmtp=s8(n=e.fmtp).call(n,function(e){return u[e.payload]})),Array.isArray(e.rtcpFb)?e.rtcpFb=s8(o=e.rtcpFb).call(o,function(e){return u[e.payload]}):e.rtcpFb=[],c.rrtr&&h.forEach(function(t){var r;null===(r=e.rtcpFb)||void 0===r||r.push({payload:t,type:"rrtr"})}),IM(e,r),Array.isArray(e.ext)&&(e.ext=s8(a=e.ext).call(a,function(e){if("http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"!==e.uri&&"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"!==e.uri&&"http://www.webrtc.org/experiments/rtp-hdrext/color-space"!==e.uri)return e})),"string"==typeof e.payloads&&(e.payloads=s8(s=e.payloads.split(" ")).call(s,function(e){return u[e]}).join(" ")),e},IL=function(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{rrtr:!1},n={};if(Array.isArray(e.rtp)&&(e.rtp=s8(r=e.rtp).call(r,function(e){var t=e.codec,r=e.payload;return("opus"===t||"red"===t)&&(n[r]=r,!0)})),Array.isArray(e.rtcpFb)||(e.rtcpFb=[]),i.rrtr&&cG(n).forEach(function(t){var r;null===(r=e.rtcpFb)||void 0===r||r.push({payload:Number(t),type:"rrtr"})}),IM(e,t),"string"==typeof e.payloads){var o=[];e.payloads.split(" ").forEach(function(e){n[e]&&o.push(e)}),e.payloads=o.join(" ")}return e},IM=function(e,t){e.iceOptions&&delete e.iceOptions,e.icePwd&&(t.icePwd=e.icePwd,delete e.icePwd),e.iceUfrag&&(t.iceUfrag=e.iceUfrag,delete e.iceUfrag),e.fingerprint&&(t.fingerprint=e.fingerprint,delete e.fingerprint)},Ix=function(e){return IB(e,"H265","ByteVC1")},IU=function(e){return IB(e,"ByteVC1","H265")},IB=function(e,t,r){if(-1===ux(e).call(e,t))return e;var i,n=R7.parse(e);return n.media=sU(i=n.media).call(i,function(e){var i;return"video"===e.type&&(e.rtp=sU(i=e.rtp).call(i,function(e){return e.codec===t&&(e.codec=r),e})),e}),R7.write(n)},IV={iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",encodedInsertableStreams:!!gi()||void 0},IF=((IS=IF||{})[IS.DC_ERROR=0]="DC_ERROR",IS[IS.DC_CLOSE=1]="DC_CLOSE",IS[IS.ICE_FAILED=2]="ICE_FAILED",IS[IS.DESTROY=3]="DESTROY",IS[IS.TIMEOUT=4]="TIMEOUT",IS),Ij=0,IG=function(e){hA(c,EL);var t,r,i,n,o,a,s=hI(c);function c(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return nK(this,c),nQ(he(r=s.call(this)),"uuid",(Ij++).toString()),nQ(he(r),"_peerConnectionId",""),nQ(he(r),"audioTrack4ff",void 0),nQ(he(r),"_pc",void 0),nQ(he(r),"_dc",void 0),nQ(he(r),"_iceNode",void 0),nQ(he(r),"_initSctpEvents",!1),nQ(he(r),"_monitor",void 0),nQ(he(r),"_offerIce",{}),nQ(he(r),"_answerIce",{}),nQ(he(r),"_offerSession",void 0),nQ(he(r),"_answerSession",void 0),nQ(he(r),"_offerMlines",[]),nQ(he(r),"_answerMlines",[]),nQ(he(r),"_connectReject",void 0),nQ(he(r),"_logger",void 0),nQ(he(r),"_destroyed",!1),nQ(he(r),"_reportTimer",void 0),nQ(he(r),"_clearPeerListeners",void 0),nQ(he(r),"_iceStartTs",0),nQ(he(r),"_icePreStepTs",0),r._ctx=e,r._groupConnectionId=t,r._isReconnect=i,r._monitor=mS(e.id),r._logger=new mJ("PeerConnection_".concat(r.uuid),4,e.id),r._pc=new RTCPeerConnection(IV),r._pc.ontrack=function(e){var t,i,n,o,a=null===(t=e.streams)||void 0===t||null===(i=t[0])||void 0===i?void 0:i.id;r._print("pc.ontrack",sN(n=sN(o="".concat(e.track.kind," ")).call(o,e.track.id," ")).call(n,a)),"ff-stream"===a&&(r.audioTrack4ff=e.track),r.emit("ontrack",e)},r._pc.onconnectionstatechange=function(){var e;r._print("onconnectionstatechange",sN(e="".concat(r._pc.connectionState,". ice -> ")).call(e,r._pc.iceConnectionState)),"failed"!==r._pc.iceConnectionState&&"closed"!==r._pc.iceConnectionState&&"failed"!==r._pc.connectionState||r.emit("disconnect",IZ.ICE_FAILED)},r._pc.oniceconnectionstatechange=function(){var e=r._pc.iceConnectionState;r._report("rtc_pre_ice_state",{message:e,ice_state:e.toUpperCase()}),r.emit("ice_state",e)},r}return nY(c,[{key:"getOriginRTCPeerConnection",value:function(){return this._pc}},{key:"getConnectionId",value:function(){return this._peerConnectionId}},{key:"getGroupConnectionId",value:function(){return this._groupConnectionId}},{key:"getIceConnectionState",value:function(){return this._pc.iceConnectionState}},{key:"createOfferSdp",value:(a=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._pc.createOffer();case 2:return(t=e.sent.sdp)&&(t=Ix(t)),e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"startIceConnect",value:(o=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("connect","invoke. %o",t),this._iceNode=t,(r=this._pc.createDataChannel("signaling",{negotiated:!0,id:100})).binaryType="arraybuffer",this._dc=r,n=(i=this._genIceInfo(t)).offerIce,o=i.answerIce,this._offerIce=n,this._answerIce=o,this._peerConnectionId=o.iceUfrag||"",this.reportRtcPreIce("ice_start"),m4&&(this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"})),e.next=13,this.createOfferSdp();case 13:if(a=e.sent){e.next=16;break}throw new pB(h6.NOT_SUPPORTED,"create offer sdp failed.");case 16:if(c=sq((s=R7.parse(a)).media,1)[0],this._offerIce.fingerprint=s.fingerprint||c.fingerprint,!m4){e.next=32;break}return s.media=sU(d=s.media).call(d,function(e){var t,r,i,n,o=l9(l9({},e),h._offerIce);return"video"===o.type&&(ga?(o.ext=null===(t=o.ext)||void 0===t?void 0:s8(t).call(t,function(e){var t;return -1===ux(t=e.uri).call(t,"abs-send-time")}),o.rtcpFb=null===(r=o.rtcpFb)||void 0===r?void 0:s8(r).call(r,function(e){return"goog-remb"!==e.type})):(o.rtcpFb=null===(i=o.rtcpFb)||void 0===i?void 0:s8(i).call(i,function(e){return"transport-cc"!==e.type}),o.ext=null===(n=o.ext)||void 0===n?void 0:s8(n).call(n,function(e){var t;return -1===ux(t=e.uri).call(t,"transport")}))),o}),gs&&IP(s),(l=l9({},s)).fingerprint=this._answerIce.fingerprint,l.media=sU(u=l.media).call(u,function(e){return delete(e=l9(l9({},e),h._answerIce)).bundleOnly,e.port=9,"application"===e.type?e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}:("audio"===e.type&&(e.msid="ff-stream ff-stream-audio"),e.direction="sendonly"),e}),gs&&IP(l),e.next=28,this.setLocalDescription(R7.write(s));case 28:return e.next=30,this.setRemoteDescription(R7.write(l));case 30:e.next=40;break;case 32:delete s.media,this._offerSession=l9({},s),this._answerSession=l9({},s),this._answerSession.fingerprint&&(this._answerSession.fingerprint=this._answerIce.fingerprint),this._offerMlines=[l9(l9(l9({},c),this._offerIce),{},{mid:"".concat(0)})],this._answerMlines=[l9(l9(l9({},c),this._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144},mid:"".concat(0)})],this.setDescription();case 40:return this._reportTransportStats(),e.next=43,new sP(function(e,t){h._connectReject=t;var i=setTimeout(function(){var e;h.reportRtcPreIce("timeout"),null===(e=h._connectReject)||void 0===e||e.call(h,{code:4,message:"connect timeout"}),delete h._connectReject},8e3),n=function(){h._print("connect","dataChannel open"),h._reportRtcInvokeStatus("es.dc.open",""),h.reportRtcPreIce("datachannel_opened"),clearTimeout(i),e(""),delete h._connectReject},o=function(e){var t,r,n,o;h._report("rtc_signaling_msg_error",{error_code:null==e||null===(t=e.error)||void 0===t?void 0:t.sdpLineNumber,message:null==e||null===(r=e.error)||void 0===r?void 0:r.errorDetail,reason:"invalid data"}),h._reportRtcInvokeStatus("es.dc.error",""),null===(n=h._connectReject)||void 0===n||n.call(h,{message:"dc.onerror, ".concat(null===(o=e.error)||void 0===o?void 0:o.errorDetail),code:0}),h.emit("disconnect",IZ.DC_ERROR),delete h._connectReject,clearTimeout(i)},a=function(){var e;h._reportRtcInvokeStatus("es.dc.close",""),null===(e=h._connectReject)||void 0===e||e.call(h,{message:"dc.onclose",code:1}),h.reportRtcPreIce("datachannel_closed"),h.emit("disconnect",IZ.DC_CLOSE),delete h._connectReject,clearTimeout(i)},s=function(){"connected"===h._pc.iceConnectionState?h.reportRtcPreIce("ice_connected"):"failed"!==h._pc.iceConnectionState&&"closed"!==h._pc.iceConnectionState||h.reportRtcPreIce("ice_failed")},c=function(){var e,t;"failed"!==h._pc.iceConnectionState&&"closed"!==h._pc.iceConnectionState&&"failed"!==h._pc.connectionState||(null===(e=h._connectReject)||void 0===e||e.call(h,{message:sN(t="pc.connectionstatechange -> ".concat(h._pc.connectionState,", ice -> ")).call(t,h._pc.iceConnectionState),code:2}),delete h._connectReject,clearTimeout(i))};r.addEventListener("open",n),r.addEventListener("error",o),r.addEventListener("close",a),h._pc.addEventListener("iceconnectionstatechange",s),h._pc.addEventListener("connectionstatechange",c),h._clearPeerListeners=function(){r.removeEventListener("open",n),r.removeEventListener("error",o),r.removeEventListener("close",a),h._pc.removeEventListener("iceconnectionstatechange",s),h._pc.removeEventListener("connectionstatechange",c)}});case 43:return this._print("connect","dataChannel establish success"),e.abrupt("return",r);case 45:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"setDescription",value:(n=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._print("setDescription","invoke."),this._offerSession.media=this._offerMlines,this._answerSession.media=this._answerMlines,r=[],this._offerMlines.forEach(function(e){"inactive"!==e.direction&&e.mid&&r.push(e.mid)}),this._offerSession.groups&&this._answerSession.groups&&(this._offerSession.groups[0].mids=r.join(" "),this._answerSession.groups[0].mids=r.join(" ")),i=v0(),t&&this._report("rtc_begin_create_offer",{direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,pc_session_id:this._peerConnectionId,vendor_mode:0}),e.next=10,this._pc.createOffer();case 10:return t&&this._report("rtc_create_offer",{error_code:0,direction:"local"===t.streamUserId?"up":"down",stream_id:t.streamId,stream_user_id:t.streamUserId,elapse:v0()-i}),e.next=13,this.setLocalDescription(R7.write(this._offerSession),t);case 13:return e.next=15,this.setRemoteDescription(R7.write(this._answerSession),t);case 15:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"setLocalDescription",value:(i=sk(sI().mark(function e(t,r){var i,n,o,a=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=v0(),e.prev=1,t=IU(t),e.next=5,this._pc.setLocalDescription({type:"offer",sdp:t});case 5:this._report("rtc_set_description",{error_code:0,message:t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:v0()-i},{type:"offer"}),this._initSctpEvents||(this._initSctpEvents=!0,(o=null===(n=this._pc)||void 0===n?void 0:n.sctp)&&(o.onstatechange=function(){a._reportRtcInvokeStatus("sctp","sctp state change TO: ".concat(o.state))},o.transport&&(o.transport.onstatechange=function(){var e;a._reportRtcInvokeStatus("dtls","dtls state change TO: ".concat(null==o||null===(e=o.transport)||void 0===e?void 0:e.state))}))),e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(1),console.error("setLocal",e.t0),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"1",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:"",stream_user_id:"",elapse:v0()-i},{type:"offer"}),e.t0;case 14:case"end":return e.stop()}},e,this,[[1,9]])})),function(e,t){return i.apply(this,arguments)})},{key:"setRemoteDescription",value:(r=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=v0(),e.prev=1,t=IU(t),e.next=5,this._pc.setRemoteDescription({type:"answer",sdp:t});case 5:this._report("rtc_set_description",{error_code:0,message:t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:v0()-i},{type:"answer"}),e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(1),console.error("setRemote",e.t0),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+t,is_local:"0",direction:"local"===(null==r?void 0:r.streamUserId)?"up":"down",stream_id:(null==r?void 0:r.streamId)||"",stream_user_id:(null==r?void 0:r.streamUserId)||"",elapse:v0()-i},{type:"answer"}),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,8]])})),function(e,t){return r.apply(this,arguments)})},{key:"closeIceConnect",value:function(){var e,t,r;null===(e=this._connectReject)||void 0===e||e.call(this,{code:3,message:"invoke destroy()"}),delete this._connectReject,this._pc.close(),null===(t=this._dc)||void 0===t||t.close(),delete this._dc,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,ye(this._pc),null===(r=this._clearPeerListeners)||void 0===r||r.call(this),delete this._clearPeerListeners}},{key:"reportRtcPreIce",value:function(e){var t,r=v0();"ice_start"===e&&(this._iceStartTs=r,this._icePreStepTs=r),this._report("rtc_pre_ice",{connect_event:e,message:e,elapse:r-this._icePreStepTs,total_elapse:r-this._iceStartTs,cache_status:!(null===(t=this._iceNode)||void 0===t||!t.cache_status),is_reconnect:this._isReconnect}),this._icePreStepTs=r}},{key:"getStatsWithLowFrequency",value:function(e,t,r){return T7(this._pc,e,t,r)}},{key:"destroy",value:function(){this._print("destroy",this._peerConnectionId),hf(hp(c.prototype),"removeAllListeners",this).call(this),this.closeIceConnect(),this._destroyed=!0,this._reportTimer&&(clearTimeout(this._reportTimer),delete this._reportTimer),delete this._pc}},{key:"_genIceInfo",value:function(e){var t,r,i,n,o,a,s,c;return{offerIce:{iceUfrag:null===(t=e.iceParams)||void 0===t?void 0:t.clientIceUfrag,icePwd:null===(r=e.iceParams)||void 0===r?void 0:r.clientIcePwd,iceOptions:"renomination"},answerIce:(n={},o=(i=e).publicIPs,a=i.certFingerprint,s=i.iceParams,c=i.iceConfig,n.fingerprint={type:"sha-256",hash:a},n.icePwd=s.serverIcePwd,n.iceUfrag=Ik(s.serverIceUfrag),n.candidates=function(e,t){if(!Array.isArray(e))return[];var r=0,i=[];return e.forEach(function(e){var n={component:1,ip:e.ip,type:"host",generation:e.generation};e.udpPorts&&!t.tcpOnly&&e.udpPorts.forEach(function(e){i.push(l9(l9({},n),{},{foundation:r++,transport:"udp",port:e,priority:0x7effffff}))}),e.tcpPorts&&e.tcpPorts.forEach(function(e){i.push(l9(l9({},n),{},{foundation:r++,transport:"tcp",port:e,tcptype:"passive",priority:0x7efffc17}))})}),i}(o,c),n.setup="active",n.iceOptions="renomination",n)}}},{key:"_reportTransportStats",value:(t=sk(sI().mark(function e(){var t,r,i,n,o=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStatsWithLowFrequency();case 2:t=e.sent,r={},t.forEach(function(e){if("transport"===e.type)r.dtls_state=e.dtlsState,r.bytes_received=e.bytesReceived,r.bytes_sent=e.bytesSent,r.ice_state=e.iceState,r.packets_received=e.packetsReceived,r.packets_sent=e.packetsSent,r.selected_candidate_pair_changes=e.selectedCandidatePairChanges;else if("local-candidate"===e.type||"remote-candidate"===e.type){var t;r.candidates_info=sN(t=[]).call(t,le(r.candidates_info||[]),[{id:e.id,is_remote:e.isRemote,port:e.port,protocol:e.protocol,candidate_type:e.candidateType,priority:e.priority,network_type:e.networkType,candidate_ip:e.ip}])}else"candidate-pair"===e.type&&(r.candidatePairsInfo={},r.candidatePairsInfo.candidate_state=e.state,r.candidatePairsInfo.writable_state=e.writable,r.candidatePairsInfo.sent_ping_requests_total=e.requestsSent,r.candidatePairsInfo.recv_ping_requests=e.requestsReceived,r.candidatePairsInfo.sent_ping_responses=e.responsesSent,r.candidatePairsInfo.recv_ping_responses=e.responsesReceived,r.candidatePairsInfo.current_rtt=e.currentRoundTripTime,r.candidatePairsInfo.total_rtt=e.totalRoundTripTime,["localCandidateId","remoteCandidateId","bytesSent","bytesReceived","availableOutgoingBitrate","availableIncomingBitrate","bytesDiscardedOnSend","consentRequestsSent","packetsDiscardedOnSend","lastPacketReceivedTimestamp","lastPacketSentTimestamp"].forEach(function(t){void 0!==e[t]&&(r.candidatePairsInfo[t.replace(/[A-Z]/g,function(e){return"_".concat(e.toLowerCase())})]=e[t])}))}),cG(r).length>0&&(null===(i=this._monitor)||void 0===i||i.report("rtc_transport_statistics",r)),this._destroyed||(n="connected"===this._pc.iceConnectionState&&"connected"===this._pc.connectionState,this._reportTimer=setTimeout(function(){o._reportTransportStats()},n?5e3:1e3));case 7:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_print",value:function(e){for(var t,r,i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];(t=this._logger).info.apply(t,sN(r=["".concat(e)]).call(r,n))}},{key:"_report",value:function(e,t,r){var i,n,o,a;null===(i=this._monitor)||void 0===i||i.report(e,l9(l9({},t),{},{connection_id:this._peerConnectionId,group_connection_id:this._groupConnectionId}),l9(l9({},r),{},{tcp_only:null===(n=this._iceNode)||void 0===n?void 0:n.iceConfig.tcpOnly,ms_addr:sD((null===(o=this._iceNode)||void 0===o?void 0:sU(a=o.publicIPs).call(a,function(e){return{ip:e.ip,tcp:e.tcpPorts,udp:e.udpPorts}}))||[])}))}},{key:"_reportRtcInvokeStatus",value:function(e,t){this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:0,stream_id:"",elapse:0})}}],[{key:"checkSupported",value:function(){if(!RTCPeerConnection)throw new pB(h6.NOT_SUPPORTED,"missing RTCPeerConnection API.");["addTransceiver","createDataChannel","createOffer","setLocalDescription","setRemoteDescription"].forEach(function(e){var t,r;if(null===(t=RTCPeerConnection)||void 0===t||null===(r=t.prototype)||void 0===r||!r[e])throw new pB(h6.NOT_SUPPORTED,"missing peer.".concat(e," API."))})}}]),c}(),IW=((Ib=IW||{})[Ib.SEND=0]="SEND",Ib[Ib.FEEDBACK=1]="FEEDBACK",Ib),IH=((IT=IH||{})[IT.P2P=0]="P2P",IT[IT.SIGNAL=1]="SIGNAL",IT[IT.BROADCAST=2]="BROADCAST",IT[IT.BUSINESS_SERVER=3]="BUSINESS_SERVER",IT),IY=((Iy=IY||{})[Iy.SUCCESS=0]="SUCCESS",Iy[Iy.TIMEOUT=1]="TIMEOUT",Iy[Iy.BROKEN=2]="BROKEN",Iy[Iy.NO_RECEIVER=3]="NO_RECEIVER",Iy[Iy.NO_RELAYPATH=4]="NO_RELAYPATH",Iy[Iy.EXCEED_QPS=5]="EXCEED_QPS",Iy[Iy.SEND_TO_SERVER_ERROR=17]="SEND_TO_SERVER_ERROR",Iy[Iy.SERVER_RESPONSE_ERROR=18]="SERVER_RESPONSE_ERROR",Iy[Iy.NOT_JOIN=100]="NOT_JOIN",Iy[Iy.NOT_LOGIN=105]="NOT_LOGIN",Iy[Iy.SERVER_PARAMS_NOTSET=106]="SERVER_PARAMS_NOTSET",Iy[Iy.UNKNOWN=1e3]="UNKNOWN",Iy),IK=(nQ(IC={},0,[0,"success"]),nQ(IC,1,[h6.USER_MESSAGE_TIMEOUT,"timeout, failed to send."]),nQ(IC,2,[h6.USER_MESSAGE_BROKEN,"dataChannel broken, failed to send."]),nQ(IC,3,[h6.USER_MESSAGE_NO_RECEIVER,"cannot find the receiver."]),nQ(IC,4,[h6.USER_MESSAGE_NO_RECEIVER,"cannot find relay path."]),nQ(IC,5,[h6.USER_MESSAGE_EXCEED_QPS,"cannot find relay path."]),nQ(IC,17,[h6.USER_MESSAGE_SEND_TO_SERVER_ERROR,"failed to send to business server."]),nQ(IC,18,[h6.USER_MESSAGE_SERVER_RESPONSE_ERROR,"business server response error."]),nQ(IC,100,[h6.USER_MESSAGE_NOT_JOIN,"not join room"]),nQ(IC,105,[h6.USER_MESSAGE_NOT_LOGIN,"not login."]),nQ(IC,106,[h6.USER_MESSAGE_SERVER_PARAMS_NOTSET,"server param is not set."]),nQ(IC,1e3,[h6.USER_MESSAGE_UNKNOWN,"unknown."]),IC),IQ=["msg"],Iz=[],IX=[EV.ENGINE_CONTROL_MESSAGE],IJ=((IR=IJ||{})[IR.C2S=0]="C2S",IR[IR.C2C=1]="C2C",IR[IR.C2GW=2]="C2GW",IR[IR.C2CDirect=3]="C2CDirect",IR[IR.C2RTM=4]="C2RTM",IR),Iq=function(e){hA(a,EN.EventEmitter);var t,r,i,n,o=hI(a);function a(e,t,r){var i;return nK(this,a),nQ(he(i=o.call(this)),"_singlingCache",new d9),nQ(he(i),"_p2pCache",new d9),nQ(he(i),"_rttIds",{}),nQ(he(i),"_p2pMessageId",new Ed),nQ(he(i),"_clearDataChannelListener",void 0),nQ(he(i),"_monitor",void 0),nQ(he(i),"logger",void 0),i.id=e,i._dataChannel=t,i.connectionIds=r,i._clearDataChannelListener=i._handleHandler(),i._monitor=mS(e),i.logger=new mJ("DataChannelSignaling",3,e),i}return nY(a,[{key:"destroy",value:function(){var e=this;this._clearDataChannelListener(),delete this._dataChannel,this._singlingCache.forEach(function(t,r){t.error(new pB(h6.OPERATION_CANCEL,"disconnect")),e._singlingCache.delete(r)}),this._singlingCache.clear(),this._p2pCache.clear(),this._rttIds={}}},{key:"sendSignaling",value:function(e,t,r){var i,n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6e4;return null===(i=this._monitor)||void 0===i||i.report("rtc_signaling",l9({error_code:0,message:sD(t),signaling_event:"call-".concat(e),signaling_type:"Send",stream_id:t.streamId,stream_user_id:t.streamUserId,direction:"up"},this.connectionIds)),new sP(function(i,a){var s,c=n._genHeader(r);c.id=v6();var d=c.id.join("-"),u="customMessage"===e;u&&ml.samplingOne2ManyMsg(n.id,Number(c.id.join("")),t);var l=setTimeout(function(){n._singlingCache.delete(d),a(new pB(h6.TIME_OUT,"".concat(e," message time out"))),u&&ml.updateOne2ManyMsgAck(n.id,t,999)},o);n._singlingCache.set(d,{start:v0(),signalingType:e,success:function(e){clearTimeout(l),i(e),u&&ml.updateOne2ManyMsgAck(n.id,t,0)},error:function(e){clearTimeout(l),a(e),u&&ml.updateOne2ManyMsgAck(n.id,t,e.code)}}),n.logger.info("Signal",sN(s=">>>>>> [".concat(e,"][")).call(s,d,"]"),t),n._sendMessage(e,c,t)})}},{key:"sendPingSignaling",value:function(){return this.sendSignaling("CheckConnectivity",{ts:Date.now()},{functionType:2})}},{key:"sendP2PMessage",value:(n=sk(sI().mark(function e(t,r){var i,n,o;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.msg,n=l7(t,IQ),o=i instanceof ArrayBuffer,e.t0=this,e.t1=ml,e.t2=this.id,e.t3=l9,e.t4=l9({ver:1,id:this._p2pMessageId.getMessageId(),time:Date.now(),dir:IW.SEND,type:IH.P2P,err:IY.SUCCESS},n),e.t5={},e.t6=o,!o){e.next=15;break}return e.next=12,v1.ab2b64str(i);case 12:e.t7=e.sent,e.next=16;break;case 15:e.t7=i;case 16:return e.t8=e.t7,e.t9={binary:e.t6,msg:e.t8},e.t10=(0,e.t3)(e.t4,e.t5,e.t9),e.t11=e.t1.samplingP2PMsg.call(e.t1,e.t2,e.t10),e.t12=r,e.abrupt("return",e.t0._sendP2PMessage.call(e.t0,e.t11,e.t12));case 22:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"_sendP2PMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return v9(e.msg)?this._rttIds[e.id]=e.id:e.dir===IW.SEND&&this.logger.info("_sendP2PMessage [DC Signaling p2p >>]",sD(e)),new sP(function(i,n){var o=t._genHeader(l9(l9({needAck:!0,functionType:1},r),{},{id:v6()}));if(e.dir===IW.SEND){var a=setTimeout(function(){t._p2pCache.delete(e.id),n(new pB(h6.USER_MESSAGE_TIMEOUT,"P2P message timeout")),ml.updateP2PMsgAck(t.id,e,999)},12e3);t._p2pCache.set(e.id,{success:function(r,n){clearTimeout(a),i(n),ml.updateP2PMsgAck(t.id,e,0)},error:function(r){clearTimeout(a),ml.updateP2PMsgAck(t.id,e,r.err);var i,o=sq(IK[r.err]||[h6.USER_MESSAGE_UNKNOWN,sN(i="err: ".concat(r.err,", msg: ")).call(i,r.msg)],2),s=o[0],c=o[1];n({err:r.err,code:s,message:r.msg||c})}})}try{t._sendMessage("p2p",o,e)}catch(e){throw e.code===h6.NOT_CONNECTED_YET&&(e.code=h6.USER_MESSAGE_BROKEN),e}})}},{key:"_sendMessage",value:function(e,t,r){if(!this._dataChannel||"open"!==this._dataChannel.readyState)throw new pB(h6.NOT_CONNECTED_YET,"DataChannel not open");var i,n,o=vB("SIGNAL_COMPRESSION")||t.zip,a=t.version+(Number(o)<<4)+(Number(t.encrypt)<<5),s=Number(t.needAck)+(Number(t.direction)<<1)+(Number(t.functionType)<<2)+(Number(t.binary)<<6),c=v1.str2ab(sD([e,r])),d=v2(Uint8Array,sN(i=[a,s]).call(i,le(t.id||[])),o||t.zip?A2.deflate(new Uint8Array(c)):new Uint8Array(c));try{this._dataChannel.send(d.buffer)}catch(e){throw null===(n=this._monitor)||void 0===n||n.report("rtc_error",{message:"datachannel send error: ".concat(e.message),error_code:yL.DC_SEND_ERROR}),e}"p2p"===e?ml.updateP2PMsgReq(this.id,r,d.buffer.byteLength):"customMessage"===e&&ml.updateOne2ManyMsgReq(this.id,r,d.buffer.byteLength)}},{key:"_dispartData",value:function(e){var t=new Uint8Array(e),r=0,i=t[r++],n=t[r++],o={version:15&i,zip:16==(16&i),encrypt:32==(32&i),needAck:1==(1&n),direction:(2&n)>>1,functionType:(60&n)>>2,binary:64==(64&n)};if(o.needAck||1===o.direction){for(;r<=6;r++)if(128!=(128&t[r])){r++;break}o.id=pZ(uk(t).call(t,2,r))}return{header:o,data:uk(t).call(t,r)}}},{key:"_feedbackSignaling",value:function(e,t,r){var i,n,o=this._genHeader({needAck:!0,direction:1,id:sU(i=e.split("-")).call(i,function(e){return Number(e)})});cd(Iz).call(Iz,t)||this.logger.info("Signal",sN(n=">>>>>> [".concat(t,"-res][")).call(n,e,"]")),this._sendMessage("".concat(t,"-res"),o,r)}},{key:"_handleMessage",value:(i=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=Date.now(),i=t.byteLength,o=(n=this._dispartData(t)).data,(a=n.header).zip&&((s=new A2.Inflate).push(o,!0),o=s.result),c=v1.ab2str(o),d=[],e.prev=8,d=JSON.parse(c),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(8),e.t0 instanceof Error&&(null===(u=this._monitor)||void 0===u||u.report("rtc_signaling_msg_error",l9({error_code:-1,message:e.t0.message,reason:"message parse failed"},this.connectionIds))),e.abrupt("return");case 16:e.t1=a.functionType,e.next=0===e.t1?19:1===e.t1?21:2===e.t1?23:25;break;case 19:return this.C2S(a,d,c,i,r),e.abrupt("break",26);case 21:return this.C2C(d,i,r),e.abrupt("break",26);case 23:return this.C2GW(a,d,c),e.abrupt("break",26);case 25:return e.abrupt("break",26);case 26:case"end":return e.stop()}},e,this,[[8,12]])})),function(e){return i.apply(this,arguments)})},{key:"C2S",value:(r=sk(sI().mark(function e(t,r,i,n,o){var a,s,c,d,u;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(null===(a=t.id)||void 0===a?void 0:a.join("-"))||"",1!==t.direction){e.next=5;break}this._handleAckMessage(s,r[0]||{},i),e.next=18;break;case 5:if(!Array.isArray(r)){e.next=18;break}if(d=r[0],r=r[1],cd(Iz).call(Iz,d)||this.logger.info("Signal","<<<<<< ".concat(d),r,s),cd(IX).call(IX,d)||this._feedbackSignaling(s,d,d===EV.ON_CUSTOM_MESSAGE?l9(l9({},r),{},{message:""}):""),!r.binary||"string"!=typeof r.message){e.next=14;break}return e.next=13,v1.b64str2ab(r.message,this._monitor);case 13:r.message=e.sent;case 14:u=Date.now(),this.emit(d,l9({},r)),d===EV.ON_CUSTOM_MESSAGE&&ml.reportOne2ManyMsgRecv(this.id,r,{msg_size:n,recv_msg_ts:o,fwd_msg_ts:u}),null===(c=this._monitor)||void 0===c||c.report("rtc_signaling",l9({error_code:0,message:i,signaling_event:"on-".concat(d),signaling_type:"Recv",stream_id:r.streamId,stream_user_id:r.clientId,direction:"down"},this.connectionIds));case 18:case"end":return e.stop()}},e,this)})),function(e,t,i,n,o){return r.apply(this,arguments)})},{key:"C2C",value:(t=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h,p,f,_,A;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Array.isArray(t)&&(t=t[1]),c=null===(n=t)||void 0===n?void 0:n.id,this._rttIds[c]||(null===(o=t)||void 0===o?void 0:o.dir)===IW.FEEDBACK||v9(null===(a=t)||void 0===a?void 0:a.msg)?delete this._rttIds[c]:this.logger.info("Signal","<<<<<< p2p response",t),e.t0=t.dir,e.next=e.t0===IW.SEND?6:e.t0===IW.FEEDBACK?46:48;break;case 6:if(d=Date.now(),v9(null===(s=t)||void 0===s?void 0:s.msg)){e.next=43;break}if(l=(u=t).binary,h=u.msg,p=u.room,f=u.to,_=u.from,A=""===p?l?EV.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM:EV.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM:l?EV.USER_BINARY_MESSAGE_RECEIVED:EV.USER_MESSAGE_RECEIVED,f){e.next=27;break}if(e.t1=this,e.t2=EV.ON_CUSTOM_MESSAGE,e.t3=_,e.t4=l,!l){e.next=21;break}return e.next=18,v1.b64str2ab(h,this._monitor);case 18:e.t5=e.sent,e.next=22;break;case 21:e.t5=h;case 22:e.t6=e.t5,e.t7={clientId:e.t3,binary:e.t4,message:e.t6},e.t1.emit.call(e.t1,e.t2,e.t7),e.next=43;break;case 27:if(e.t8=this,e.t9=A,e.t10=l9,e.t11=l9({},t),e.t12={},!l){e.next=38;break}return e.next=35,v1.b64str2ab(h,this._monitor);case 35:e.t13=e.sent,e.next=39;break;case 38:e.t13=h;case 39:e.t14=e.t13,e.t15={msg:e.t14},e.t16=(0,e.t10)(e.t11,e.t12,e.t15),e.t8.emit.call(e.t8,e.t9,e.t16);case 43:return this._sendP2PMessage(l9(l9({},t),{},{dir:IW.FEEDBACK,msg:""})),ml.reportP2PMsgRecv(this.id,t,{msg_size:r,recv_msg_ts:i,fwd_msg_ts:d}),e.abrupt("break",49);case 46:return this._handleP2PMsgFeedback(t),e.abrupt("break",49);case 48:return e.abrupt("break",49);case 49:case"end":return e.stop()}},e,this)})),function(e,r,i){return t.apply(this,arguments)})},{key:"C2GW",value:function(e,t,r){if(1===e.direction){var i,n=(null===(i=e.id)||void 0===i?void 0:i.join("-"))||"";this._handleAckMessage(n,t[0]||{},r)}else{var o=sq(t,2),a=o[0],s=o[1],c=void 0===s?{}:s;if("RXMediaMsg"===a){var d,u=c.type,l=c.data;switch(null===(d=this._monitor)||void 0===d||d.report("rtc_signaling",l9({error_code:0,message:r,signaling_event:"on-".concat(u),signaling_type:"Recv",stream_id:"",stream_user_id:"",direction:"down"},this.connectionIds)),u){case"RSCP":try{var h=JSON.parse(l);Array.isArray(h)&&this.emit(u,h)}catch(e){}break;case"RTT":try{var p=JSON.parse(l);p.length&&this.emit(u,p[0])}catch(e){}break;case"SSC":try{var f=JSON.parse(l);f.length&&(this.logger.info("Signal","<<<<<< ".concat(u),f),this.emit(u,f[0]))}catch(e){}}}else"engineControlMessage"===a&&this.C2S(e,t,r,0,0)}}},{key:"_handleHandler",value:function(){var e=this,t=function(t){e.logger.warn("_handleHandler","dataChannel close",t)},r=function(t){e.logger.error("_handleHandler","dataChannel error",t)},i=function(t){e._handleMessage(t.data)};return this._dataChannel.addEventListener("close",t),this._dataChannel.addEventListener("error",r),this._dataChannel.addEventListener("message",i),function(){var n=e._dataChannel;null==n||n.removeEventListener("close",t),null==n||n.removeEventListener("error",r),null==n||n.removeEventListener("message",i)}}},{key:"_genHeader",value:function(){return l9({version:2,zip:!1,encrypt:!1,needAck:!0,direction:0,functionType:0,binary:!1},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"_handleAckMessage",value:function(e,t,r){var i,n,o=this._singlingCache.get(e);o&&(this._singlingCache.delete(e),200===t.code?o.success(t):o.error(t),this.logger.info("Signal",sN(n="<<<<<< [".concat(o.signalingType,"-ack] ")).call(n,e),t)),null===(i=this._monitor)||void 0===i||i.report("rtc_signaling",l9({error_code:0,message:r,signaling_event:null==o?void 0:o.signalingType,signaling_type:"Ack",stream_id:"",stream_user_id:"",direction:"down",elapse:o?v0()-o.start:0},this.connectionIds))}},{key:"_handleP2PMsgFeedback",value:function(e){var t=this._p2pCache.get(e.id);t&&(this._p2pCache.delete(e.id),e.err===IY.SUCCESS?t.success(e.id,e):t.error(e))}}]),a}(),IZ=((II=IZ||{}).ICE_FAILED="ice failed",II.DC_ERROR="datachannel onerror",II.DC_CLOSE="datachannel onclose",II.NODE_CHANGE="recv nodeChange signaling",II.NOTIFY_RECONNECT="recv notifyReconnect signaling",II.JOIN_TIMEOUT="joinRoom timeout, retry with tcp only",II),I$=function(e){hA(o,EL);var t,r,i,n=hI(o);function o(e){var t;return nK(this,o),nQ(he(t=n.call(this)),"id",void 0),nQ(he(t),"_monitor",void 0),nQ(he(t),"logger",void 0),nQ(he(t),"_getAccessManager",void 0),nQ(he(t),"_connectionPool",new d9),nQ(he(t),"_curConnection",void 0),nQ(he(t),"_hasReportBrowerWarning",!1),nQ(he(t),"_reconnectTimer",void 0),nQ(he(t),"_connecting",!1),nQ(he(t),"_isFirstTimeConnected",!0),nQ(he(t),"_feedbackNodes",[]),nQ(he(t),"_preIceStartTime",-1),nQ(he(t),"_tcpOnlyTimer",void 0),nQ(he(t),"_destroyed",!1),t._ctx=e,t.id=e.id,t._monitor=mS(t.id),t.logger=new mJ("ConnectionManager",3,t.id),t.logger.info("constructor","invoke"),t._getAccessManager=new R9(e),t}return nY(o,[{key:"startup",value:function(){var e=this;this.logger.info("connect","invoke");try{IG.checkSupported()}catch(e){this.asyncEmit("disconnected",e)}this._connecting||(this._onConnectStart(),sP.resolve().then(function(){return e.emit("__onGetIceConfigHook")}),this._getAccess())}},{key:"reconnectByNodeChange",value:(i=sk(sI().mark(function e(t){var r,i,n,o,a,s,c;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("reconnectByNodeChange","invoke %o",t),a=t.nodes,s=t.reason,null===(r=this._monitor)||void 0===r||r.report("rtc_node_change",{error_code:0,message:sD(t),reason:sD(s)}),vw.clearAccessNode(this._ctx.appId),null===(i=this._curConnection)||void 0===i||i.pc.reportRtcPreIce("node_change"),c=(null===(n=this._curConnection)||void 0===n||null===(o=n.node.publicIPs[0])||void 0===o?void 0:o.ip)||"",this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart("recv nodeChange signaling"),Array.isArray(a)&&a.length>0?this._startIceConnect(a):this._getAccess([{feedbackIP:c,feedbackReason:{type:"NODE_CHANGED",reason:s}}]);case 11:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"reconnect",value:(r=sk(sI().mark(function e(t){var r,i=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=i.length>1&&void 0!==i[1]&&i[1],this.logger.info("reconnect","invoke. ".concat(r?"ICE over TCP":"")),this._closeCurrentConnection(),this._clearConnectionPool(),this._clearReconnectTimer(),this._onConnectStart(t),this._getAccess(void 0,r);case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"shotdown",value:function(){var e=this;this.logger.info("destroy","invoke"),this._destroyed=!0,this.asyncEmit("disconnected",new pB(h6.OPERATION_CANCEL,"destroy")).then(function(){hf(hp(o.prototype),"removeAllListeners",e).call(e)}),this._clearReconnectTimer(),this._clearConnectionPool(),this._getAccessManager.destroy(),this._closeCurrentConnection()}},{key:"_getAccess",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._getAccessManager.getICENode(e).then(function(e){t.emit("__onGetIceSuccessHook",e),t._startIceConnect(e,r)}).catch(function(e){t.asyncEmit("disconnected",e)}).finally(function(){t._feedbackNodes=[]})}},{key:"_startIceConnect",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._destroyed){this.logger.info("_startIceConnect","invoke");var i,n=f2();this._preIceStartTime=v0();var o=this._ctx.joinRoomConfig.useTcpJoin,a=this._ctx.joinRoomConfig.useTcpJoinDelay,s=(i=sk(sI().mark(function i(o){var a,s,c,d;return sI().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r&&((o=RB(o)).iceConfig.tcpOnly=!0),a={node:o},i.prev=2,s=new IG(t._ctx,n,!t._isFirstTimeConnected),a.pc=s,t._connectionPool.set(s.uuid,a),i.next=8,s.startIceConnect(o);case 8:return c=i.sent,d=new Iq(t.id,c,{connection_id:s.getConnectionId(),group_connection_id:n}),a.signaling=d,s.reportRtcPreIce("datachannel_send_ping"),i.next=14,d.sendPingSignaling();case 14:s.reportRtcPreIce("datachannel_recv_pong"),t._onConnectSuccess({node:o,pc:s,signaling:d,dc:c}),t.safeEmit("__onConnectSuccessHook",e.length),i.next=22;break;case 19:i.prev=19,i.t0=i.catch(2),t._onConnectionFailed(a,i.t0);case 22:case"end":return i.stop()}},i,null,[[2,19]])})),function(e){return i.apply(this,arguments)});this.emit("__onIceConnectStartHook"),e.forEach(s),o&&!r&&(this.logger.info("_startIceConnect","tcp-only will try after ".concat(a,"ms")),this._tcpOnlyTimer=setTimeout(function(){t.emit("connectWidthTcp"),e.forEach(function(e){(e=RB(e)).iceConfig.tcpOnly=!0,s(e)}),delete t._tcpOnlyTimer},a))}}},{key:"_onConnectSuccess",value:function(e){var t,r=this;(this.logger.info("connect","peer_%s connect success.",e.pc.uuid),this.emit("__onIceConnectSuccessHook",e),this._curConnection)?(e.pc.destroy(),e.signaling.destroy(),this._connectionPool.delete(e.pc.uuid)):(this._curConnection=e,this._addConnectionHandler(e.pc),null===(t=this._monitor)||void 0===t||t.set({connection_id:e.pc.getConnectionId()}),this._connectionPool.delete(e.pc.uuid),this._feedbackNodes.forEach(function(e){return r._feedbackBySignaling(e)}),this._feedbackNodes=[],this._onConnectEnded(e))}},{key:"_onConnectionFailed",value:function(e,t){var r,i,n=this;this.logger.info("connect","peer_%s connect failed. %s",(null===(r=e.pc)||void 0===r?void 0:r.uuid)||"",t.message),this.emit("__onIceConnectFailedHook",e),t.code!==IF.DESTROY&&t.code!==h6.OPERATION_CANCEL&&(this._curConnection?this._feedbackBySignaling(e.node):this._feedbackNodes.push(e.node),this.logger.info("connect","remove cache node"),vw.deleteAccessNode(this._ctx.appId,e.node),e.pc&&(this._connectionPool.delete(e.pc.uuid),e.pc.destroy()),null===(i=e.signaling)||void 0===i||i.destroy(),0!==this._connectionPool.size||this._curConnection||this._destroyed||(this.logger.error("connect","establish peerConnection failed"),this._checkBrowserUA(),v0()-this._preIceStartTime<1e3?(this._clearReconnectTimer(),this._reconnectTimer=setTimeout(function(){delete n._reconnectTimer,n._reconnectWithIceFailed(n._feedbackNodes)},1e3)):this._reconnectWithIceFailed(this._feedbackNodes)))}},{key:"_feedbackBySignaling",value:function(e){var t;null===(t=this._curConnection)||void 0===t||t.signaling.sendSignaling("scheduleMessage",{type:"feedback",body:{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}})}},{key:"_reconnectWithIceFailed",value:(t=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._onConnectStart("ice failed"),this.logger.warn("reconnect","because of ice failed"),this._getAccess(sU(t).call(t,function(e){return{feedbackIP:e.publicIPs[0].ip,feedbackReason:{type:"ICE_FAILED",reason:{}}}}));case 3:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_checkBrowserUA",value:function(){var e;!this._hasReportBrowerWarning&&this._ctx.joinRoomConfig.isBlackBrower()&&(this._hasReportBrowerWarning=!0,null===(e=this._monitor)||void 0===e||e.report("rtc_error",{error_code:yL.BLACK_BROWSER,message:"failed to establish data-channel, and the current browser is on the browser blacklist."}))}},{key:"_onConnectStart",value:function(e){this.logger.info("_onConnectStart","invoke, reason: ".concat(e||"init")),this._connecting=!0,e?this.asyncEmit("reconnecting",e):this.asyncEmit("connecting");var t,r,i=f2();null===(t=this._monitor)||void 0===t||t.set({connect_session_id:i}),this._isFirstTimeConnected||null===(r=this._monitor)||void 0===r||r.report("rtc_reconnect",{error_code:1002,message:"peerconnection reconnecting",reconnect_id:i,reconnect_type:"peerconnection"},{reason:e})}},{key:"_onConnectEnded",value:function(e){var t;this.logger.info("_onConnectEnded","invoke"),this._connecting=!1,this._isFirstTimeConnected||null===(t=this._monitor)||void 0===t||t.report("rtc_reconnected",{message:"peerconnection reconnected",reconnect_type:"peerconnection"}),this._isFirstTimeConnected=!1,this.asyncEmit("connected",e),e.node.iceConfig.tcpOnly&&(this.logger.info("_onConnectEnded","use tcp only"),mw(this._ctx.id,"connected_with_tcp_only",sD(e.node))),this._tcpOnlyTimer&&(window.clearTimeout(this._tcpOnlyTimer),delete this._tcpOnlyTimer),this._clearConnectionPool()}},{key:"_addConnectionHandler",value:function(e){var t=this;e.on("disconnect",function(e){t._closeCurrentConnection(),t._clearReconnectTimer(),navigator.onLine?t.reconnect(e):t._reconnectTimer=setTimeout(function(){return t.reconnect(e)},3e3)})}},{key:"_closeCurrentConnection",value:function(){var e,t;null===(e=this._curConnection)||void 0===e||e.pc.destroy(),null===(t=this._curConnection)||void 0===t||t.signaling.destroy(),delete this._curConnection}},{key:"_clearConnectionPool",value:function(){var e=this;this._connectionPool.forEach(function(t,r){var i,n;null===(i=t.signaling)||void 0===i||i.destroy(),null===(n=t.pc)||void 0===n||n.destroy(),e._connectionPool.delete(r)})}},{key:"_clearReconnectTimer",value:function(){this._reconnectTimer&&(window.clearTimeout(this._reconnectTimer),delete this._reconnectTimer)}}]),o}(),I0=rT.f("asyncIterator"),I2=d(I0);function I1(e){function t(e){if(Object(e)!==e)return sl.reject(TypeError(e+" is not an object."));var t=e.done;return sl.resolve(e.value).then(function(e){return{value:e,done:t}})}return(I1=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?sl.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?sl.reject(e):t(r.apply(this.s,arguments))}},new I1(e)}var I4,I6,I3,I8,I5,I9,I7,Ce,Ct,Cr=((I4=Cr||{})[I4.AUTO=0]="AUTO",I4[I4.MODE_L=1]="MODE_L",I4[I4.MODE_R=2]="MODE_R",I4[I4.MODE_MIX=3]="MODE_MIX",I4),Ci=((I6=Ci||{})[I6.PLAYOUT=0]="PLAYOUT",I6[I6.PUBLISH=1]="PUBLISH",I6[I6.PLAYOUT_AND_PUBLISH=2]="PLAYOUT_AND_PUBLISH",I6),Cn=((I3=Cn||{})[I3.AUDIO_MIXING_STATE_PRELOADED=0]="AUDIO_MIXING_STATE_PRELOADED",I3[I3.AUDIO_MIXING_STATE_PLAYING=1]="AUDIO_MIXING_STATE_PLAYING",I3[I3.AUDIO_MIXING_STATE_PAUSED=2]="AUDIO_MIXING_STATE_PAUSED",I3[I3.AUDIO_MIXING_STATE_STOPPED=3]="AUDIO_MIXING_STATE_STOPPED",I3[I3.AUDIO_MIXING_STATE_FAILED=4]="AUDIO_MIXING_STATE_FAILED",I3[I3.AUDIO_MIXING_STATE_FINISHED=5]="AUDIO_MIXING_STATE_FINISHED",I3[I3.AUDIO_MIXING_STATE_PCM_ENABLED=6]="AUDIO_MIXING_STATE_PCM_ENABLED",I3[I3.AUDIO_MIXING_STATE_PCM_DISABLED=7]="AUDIO_MIXING_STATE_PCM_DISABLED",I3),Co=function(e){hA(i,EN.EventEmitter);var t,r=hI(i);function i(e,t){var n;return nK(this,i),nQ(he(n=r.call(this)),"_context",void 0),nQ(he(n),"peerConnectionMode",0),nQ(he(n),"id",void 0),nQ(he(n),"_monitor",void 0),nQ(he(n),"logger",void 0),nQ(he(n),"_nextSsrc",Math.floor(0x100000000*Math.random()+1e4)),nQ(he(n),"_aSendonlyAnswerTpl",void 0),nQ(he(n),"_vSendonlyAnswerTpl",void 0),nQ(he(n),"_enableSubFlexfec",!1),nQ(he(n),"audioTrack4ff",void 0),nQ(he(n),"setLocalDescription",void 0),nQ(he(n),"setRemoteDescription",void 0),n.peer=t,n.id=e.id,n._monitor=mS(n.id),n.logger=new mJ("BasicHandler",3,e.id),n.setLocalDescription=t.setLocalDescription.bind(t),n.setRemoteDescription=t.setRemoteDescription.bind(t),n._context=e,n.peer.on("ontrack",function(e){n.emit("ontrack",e)}),n}return nY(i,[{key:"destroy",value:function(){this.logger.info("destroy",this.peerConnectionId||""),hf(hp(i.prototype),"removeAllListeners",this).call(this)}},{key:"_peerConnection",get:function(){return this.peer.getOriginRTCPeerConnection()}},{key:"getTransceivers",value:function(){return this._peerConnection.getTransceivers()}},{key:"getConnectionState",value:function(){return this._peerConnection.connectionState}},{key:"internalPublish",value:function(e){var t=e.stream,r=e.videoTrack,i=e.audioTrack,n=e.pubAudio,o=e.pubVideo,a={direction:"sendonly",streams:[t]},s={direction:"sendonly",streams:[t]},c=this._context.videoProfile.genVideoDescriptions(e),d=c.sendEncodings,u=c.videoDescriptions,l=c.subVideoDescriptions,h=c.activeSimulcastStreams;s.sendEncodings=d,this._context.videoProfile.activeSimStreams=h,this.logger.info("publish videoTransceiverInit videoDescriptions","",s,u);var p=null==i?void 0:i.preprocessingTrack;(null==i?void 0:i.mixType)!==Ci.PLAYOUT&&null!=i&&i.mixedAudioTrack&&(p=null==i?void 0:i.mixedAudioTrack),p=n&&p?p:"audio";var f=null==r?void 0:r.preprocessingTrack;f=o&&f?f:"video";try{this._reportRtcInvokeStatus("Handler.internalPublish",sD({aTrack:f6(p),vTrack:f6(f),audioTransceiverInit:a,videoTransceiverInit:s}))}catch(e){}return{semantics:"unified-plan",videoDescriptions:u,subVideoDescriptions:l,audioTransceiverInit:{track:p,init:a},videoTransceiverInit:{track:f,init:s}}}},{key:"setCurrentDescription",value:(t=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})},{key:"createAVMlineAnswerTpl",value:function(e){var t=this,r=R7.parse(e);r.media.forEach(function(e){if("audio"===e.type){if("sendonly"===e.direction){var r,i=null==e?void 0:uC(r=e.rtp).call(r,function(e){return"opus"===e.codec});if(i&&null!=e&&e.fmtp){var n,o=null==e?void 0:uC(n=e.fmtp).call(n,function(e){return e.payload===i.payload});o&&t._context&&(o.config+=";stereo=1;sprop-stereo=1")}t._aSendonlyAnswerTpl=e}}else"video"===e.type&&("sendonly"===e.direction&&(t._vSendonlyAnswerTpl=e),Array.isArray(e.rtp)&&e.rtp.forEach(function(e){var r;null!==(r=e.codec)&&void 0!==r&&cd(r).call(r,"flexfec")&&(t._enableSubFlexfec=!0)}))}),gs&&IP(r)}},{key:"peerConnectionId",get:function(){return this.peer.getConnectionId()||""}},{key:"addBitrateLimit",value:function(e,t){null==e||e.rtp.forEach(function(r){var i,n=r.codec,o=r.payload;if(cd(i=["vp8","h264"]).call(i,n.toLocaleLowerCase())){var a,s,c=uC(a=e.fmtp).call(a,function(e){return e.payload===o});c?c.config=sN(s=[]).call(s,le(c.config.split(";")),["x-google-min-bitrate=100","x-google-start-bitrate=".concat(t)]).join(";"):e.fmtp.push({payload:o,config:"x-google-min-bitrate=100;x-google-start-bitrate=".concat(t)})}})}},{key:"_report",value:function(e,t,r){var i;null===(i=this._monitor)||void 0===i||i.report(e,l9(l9({},t),{},{connection_id:this.peer.getConnectionId(),group_connection_id:this.peer.getGroupConnectionId()}),r)}},{key:"_reportRtcInvokeStatus",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4?arguments[4]:void 0;this._report("rtc_invoke_status",{sdk_api_name:e,message:t,error_code:r,stream_id:i,elapse:0},n)}}]),i}(),Ca=new mJ("queue",4),Cs=((I8=Cs||{})[I8.ADD=0]="ADD",I8[I8.CLOSE=1]="CLOSE",I8),Cc=((I5=Cc||{}).publish="publish",I5.unpublish="unpublish",I5.subscribe="subscribe",I5.unsubscribe="unsubscribe",I5.pushtrack="pushtrack",I5.removetrack="removetrack",I5),Cd=(nQ(I7={},"publish","unpublish"),nQ(I7,"subscribe","unsubscribe"),nQ(I7,"pushtrack","removetrack"),I7),Cu=(nQ(Ce={},"publish",0),nQ(Ce,"subscribe",0),nQ(Ce,"pushtrack",0),nQ(Ce,"unpublish",1),nQ(Ce,"unsubscribe",1),nQ(Ce,"removetrack",1),Ce),Cl=function(e){hA(r,EP);var t=hI(r);function r(){var e;return nK(this,r),nQ(he(e=t.call(this)),"_queue",void 0),e._queue=[],e}return nY(r,[{key:"queue",get:function(){return this._queue}},{key:"enqueue",value:function(e){var t,r=this._queue.length,i="";return this._queue=s8(t=this._queue).call(t,function(t){return t.streamId!==e.streamId||e.action!==Cd[t.action]||(i=t.streamId,Ca.info("offsetStreamId",i),!1)}),this._queue.length===r&&this._queue.push(e),this.emit("start"),i}},{key:"dequeue",value:function(){if(!this._queue.length)return null;var e,t,r=this._queue.length;m3&&vS>=86&&vS<=92&&(r=Math.min(this._queue.length,5));for(var i=Cu[this._queue[0].action],n=1;n<r;n++)if(Cu[this._queue[n].action]!==i)return{sdpStrategy:i,items:uH(t=this._queue).call(t,0,n)};return{sdpStrategy:i,items:uH(e=this._queue).call(e,0,r)}}}]),r}(),Ch=gi(),Cp=function(e){hA(d,Co);var t,r,i,n,o,a,s,c=hI(d);function d(e,t){var r;return nK(this,d),nQ(he(r=c.call(this,e,t)),"name","chrome"),nQ(he(r),"_queueBusy",!1),nQ(he(r),"_sdpQueue",void 0),nQ(he(r),"_aSendonlyOfferTpl",void 0),nQ(he(r),"_vSendonlyOfferTpl",void 0),nQ(he(r),"_aRecvonlyOfferTpl",void 0),nQ(he(r),"_vRecvonlyOfferTpl",void 0),nQ(he(r),"_mid",10),nQ(he(r),"_inactiveMlineIndex",[]),nQ(he(r),"setDescription",void 0),r.logger=new mJ("ChromeHandler",3,e.id),r.setDescription=t.setDescription.bind(t),r._sdpQueue=new Cl,r._sdpQueue.on("start",function(){r._queueBusy||"stable"!==r._peerConnection.signalingState||(r.logger.info("dequeue start"),r.dequeue())}),r}return nY(d,[{key:"destroy",value:function(){hf(hp(d.prototype),"destroy",this).call(this)}},{key:"publish",value:(s=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.stream,s=t.enableSimulcast,u=(c=hf(hp(d.prototype),"internalPublish",this).call(this,t)).videoDescriptions,l=c.subVideoDescriptions,h=c.audioTransceiverInit,p=c.videoTransceiverInit,f=Il(this._nextSsrc),this._nextSsrc=f.next,_="".concat(this._mid++),A="".concat(this._mid++),m=l9(l9(l9({},this._aSendonlyOfferTpl),this.peer._offerIce),{},{mid:_,msid:sN(r="".concat(a.id," ")).call(r,a.id,"-audio"),ssrcs:Ih(a.id,"audio",f.audio,Iu)}),v=l9(l9(l9({},this._vSendonlyOfferTpl),this.peer._offerIce),{},{mid:A,msid:sN(i="".concat(a.id," ")).call(i,a.id,"-video")}),s?(this.logger.info("subVideoDesc","desc: %o ",l),delete v.ssrcGroups,delete v.ssrcs,E=[],v.rids=sU(u).call(u,function(e){var t=e.rid;return E.unshift(t),{id:t,direction:"send"}}),v.simulcast={dir1:"send",list1:E.join(";")}):(S=(g=Ip(a.id,f,{cname:Iu})).ssrcs,b=g.ssrcGroups,v.ssrcs=S,v.ssrcGroups=b),null!==(n=this._context.serverConfig)&&void 0!==n&&n.audioRed&&Array.isArray(m.rtp)&&(-1!==(y=hq(T=m.rtp).call(T,function(e){return"red"===e.codec}))&&(I=sq(uH(R=m.rtp).call(R,y,1),1)[0],m.rtp.unshift(I)),C=[],m.rtp.forEach(function(e){return C.push(e.payload)}),m.payloads=C.join(" ")),Array.isArray(v.ext)&&(!vB("IOS_SAFARI_ORIENTATION")&&(m6||vs)&&(v.ext=s8(w=v.ext).call(w,function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&cd(t).call(t,"video-orientation"))})),v.ext=s8(k=v.ext).call(k,function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&cd(t).call(t,"framemarking"))})),(O=null==m?void 0:uC(o=m.rtp).call(o,function(e){return"opus"===e.codec}))&&m.fmtp&&(P=uC(N=m.fmtp).call(N,function(e){return e.payload===O.payload}))&&this._context.audioProfileManager&&(P.config=this._context.audioProfileManager.getOpusConfigStr(P.config)),s||m6||this.addBitrateLimit(v,t.videoEncodeConfig[0].maxKbps),t.audioMLine=m,t.videoMLine=v,e.abrupt("return",{partialSdp:I_(this.peer._offerSession,m,v),audioMid:_,videoMid:A,type:"incroffer",semantics:"unified-plan",videoDescriptions:u,subVideoDescriptions:l,audioTransceiverInit:h,videoTransceiverInit:p,peerConnectionMode:this.peerConnectionMode});case 17:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"subscribe",value:(a=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P,D,L,M;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("subscribe"),a="incroffer",s="unified-plan",this._aRecvonlyOfferTpl&&this._vRecvonlyOfferTpl){e.next=9;break}return e.next=6,this._genOfferSdp();case 6:return c=e.sent,e.next=9,this.createAVMlineOfferTpl(c);case 9:return d="",u="",l=!1,h=!1,p=void 0,f=void 0,t.audioMLine=p,t.videoMLine=f,t.virtual?(d="".concat(this._mid++),l=!0):r.multiChatMode?(d="".concat(this._mid++),u="".concat(this._mid++),h=!0):(l=!0,h=!0,d="".concat(this._mid++),u="".concat(this._mid++)),d&&(p=l9(l9({},RB(this._aRecvonlyOfferTpl)),{},{mid:d})),l&&(t.audioMLine=p,_={track:"audio",init:{direction:"recvonly"}}),u&&(f=l9(l9({},RB(this._vRecvonlyOfferTpl)),{},{mid:u})),h&&(t.videoMLine=f,A={track:"video",init:{direction:"recvonly"}}),m=I_(this.peer._offerSession,p,f),v=void 0,E=void 0,t.enableVendorMode||r.multiChatMode||t.virtual||!this._aSendonlyAnswerTpl||!this._vSendonlyAnswerTpl||(v=Il(this._nextSsrc),this._nextSsrc=v.next,R=l9(l9(l9({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:sN(g=sN(S="".concat(t.streamId)).call(S,this._context.avSync?"":"-audio"," ")).call(g,t.streamId,"-audio"),ssrcs:Ih(t.streamId,"audio",v.audio)}),I=l9(l9(l9({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:u,msid:sN(b=sN(T="".concat(t.streamId)).call(T,this._context.avSync?"":"-video"," ")).call(b,t.streamId,"-video")},Ip(t.streamId,v,{flexfec:this._enableSubFlexfec})),E={sdp:R7.write(l9(l9({},this.peer._answerSession),{},{media:[R,I]})),sequenceId:t.sequenceId?++t.sequenceId:0},null===(y=v)||void 0===y||delete y.next),(C=null===(i=p)||void 0===i?void 0:uC(n=i.rtp).call(n,function(e){return"opus"===e.codec}))&&null!==(o=p)&&void 0!==o&&o.fmtp&&(O=null===(k=p)||void 0===k?void 0:uC(w=k.fmtp).call(w,function(e){return e.payload===C.payload}))&&this._context&&(O.config+=";stereo=1;sprop-stereo=1"),t.isPublic&&vS>=86&&null!=(L=null===(N=f)||void 0===N?void 0:s8(P=N.rtp).call(P,function(e){return"H264"===e.codec}))&&L.length&&null!==(D=f)&&void 0!==D&&D.fmtp&&(null===(M=f)||void 0===M||M.fmtp.forEach(function(e){uC(L).call(L,function(t){return t.payload===e.payload})&&(e.config+=";sps-pps-idr-in-keyframe=1")})),e.abrupt("return",{partialSdp:m,audioMid:d,videoMid:u,type:a,semantics:s,audioTransceiverInit:_,videoTransceiverInit:A,allSsrc:v,peerConnectionMode:this.peerConnectionMode,signalingAck:E});case 30:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"handleAck",value:(o=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("handleAck()","item: %o",t),e.abrupt("return",this._sdpQueue.enqueue(t));case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"dequeue",value:(n=sk(sI().mark(function e(){var t,r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queueBusy=!0,t=this._sdpQueue.dequeue(),this.logger.info("dequeue()","ret: %o",t),t){e.next=6;break}return this._queueBusy=!1,e.abrupt("return");case 6:if(r=[],e.prev=7,i=t.items,n=t.sdpStrategy,o=[],a=[],s=[],n!==Cs.ADD){e.next=49;break}delete l9({},this.peer._answerIce).candidates,c=!1,d=!1,e.prev=17,l=function(e){var t,r,i,n=2;for(void 0!==nk&&(r=I2,i=nV);n--;){if(r&&null!=(t=e[r]))return t.call(e);if(i&&null!=(t=e[i]))return new I1(t.call(e));r="@@asyncIterator",i="@@iterator"}throw TypeError("Object is not async iterable")}(i);case 19:return e.next=21,l.next();case 21:if(!(c=!(h=e.sent).done)){e.next=31;break}if(p=h.value,"break"!==(f=function(){var e,t,i,n=p.audioMid,c=p.videoMid,d=p.action,u=p.audioTransceiverInit,l=p.videoTransceiverInit,h=p.signalingAck,f=p.stream,_=p.videoCodec,A=p.onSuccess,m=p.onFail,v=f instanceof Rv;if(A&&s.push(A),m&&r.push(m),v&&h.sequenceId<f.sequenceId)return"break";var g=R7.parse(h.sdp);if(!Array.isArray(g.media))return"break";hY(e=g.media).call(e,function(e,t){var r;return null==e||null===(r=e.type)||void 0===r?void 0:r.localeCompare(null==t?void 0:t.type)});var S=uC(t=g.media).call(t,function(e){return"audio"===e.type}),b=uC(i=g.media).call(i,function(e){return"video"===e.type});if(!S||!b)return"break";var T=l9(l9(l9({},S),E.peer._answerIce),{},{mid:n}),y=l9(l9(l9({},b),E.peer._answerIce),{},{mid:c}),R=f.audioMLine,I=f.videoMLine,C=f.audioTransceiver,k=f.videoTransceiver;if(R){var w,O,N=hq(w=E.peer._offerMlines).call(w,function(e){return e.mid===n});if(C){if(E._reportRtcInvokeStatus("chromeHandler.updateTrack",sD({audioStreamTrack:f6(null===(O=f.audioTrack)||void 0===O?void 0:O.preprocessingTrack)})),-1===N)return E.logger.error("dequeue","audio mid not found when update sdp, %s from %o",n,E.peer._offerMlines),"continue"}else u&&R&&(f.audioTransceiver=E._peerConnection.addTransceiver(u.track,u.init),E._reportRtcInvokeStatus("chromeHandler.addTrack",sD({audioStreamTrack:f6(u.track)})),(N=E._inactiveMlineIndex.shift())||(N=E.peer._offerMlines.length),Ch&&f.initAudioEncodedTransform());d===Cc.publish&&"OPUS"!==vB("AUDIO_CODEC")&&(Iw(R,vB("AUDIO_CODEC")),Iw(T,vB("AUDIO_CODEC"))),E.peer._offerMlines[N]=l9({},R),E.peer._answerMlines[N]=l9({},T)}if(I){var P,D,L=hq(P=E.peer._offerMlines).call(P,function(e){return e.mid===c});if(k){if(E._reportRtcInvokeStatus("chromeHandler.updateTrack",sD({audioStreamTrack:f6(null===(D=f.videoTrack)||void 0===D?void 0:D.preprocessingTrack)})),-1===L)return E.logger.error("dequeue","video mid not found when update sdp, %s from %o",c,E.peer._offerMlines),"continue"}else l&&I&&(f.videoTransceiver=E._peerConnection.addTransceiver(l.track,l.init),E._reportRtcInvokeStatus("chromeHandler.addTrack",sD({videoStreamTrack:f6(l.track)})),(L=E._inactiveMlineIndex.shift())||(L=E.peer._offerMlines.length),Ch&&f.initVideoEncodedTransform());E.peer._offerMlines[L]=l9({},I),d===Cc.publish&&_&&(IO(I,_),IO(y,_)),E.peer._answerMlines[L]=y}o.push(f.streamId||""),a.push(v?f.userId:"local"),v&&(f.sequenceId=h.sequenceId)}())){e.next=26;break}return e.abrupt("break",31);case 26:if("continue"!==f){e.next=28;break}return e.abrupt("continue",28);case 28:c=!1,e.next=19;break;case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(17),d=!0,u=e.t0;case 37:if(e.prev=37,e.prev=38,!c||null==l.return){e.next=42;break}return e.next=42,l.return();case 42:if(e.prev=42,!d){e.next=45;break}throw u;case 45:return e.finish(42);case 46:return e.finish(37);case 47:e.next=54;break;case 49:v={},i.forEach(function(e){var t=e.audioMid,r=e.videoMid,i=e.action;v[t]=t,i!==Cc.removetrack&&(v[r]=r),v[t]=t}),this.peer._offerMlines=sU(_=this.peer._offerMlines).call(_,function(e,t){return e.mid&&v[e.mid]&&(e=If(e),E._inactiveMlineIndex.push(t)),e}),hY(A=this._inactiveMlineIndex).call(A,function(e,t){return e-t}),this.peer._answerMlines=sU(m=this.peer._answerMlines).call(m,function(e){return e.mid&&v[e.mid]&&(e=If(e)),e});case 54:return e.prev=54,e.next=57,this.setDescription(o.length?{streamId:o.join(","),streamUserId:a.join(",")}:void 0);case 57:e.next=65;break;case 59:if(e.prev=59,e.t1=e.catch(54),"have-local-offer"!==this._peerConnection.signalingState){e.next=64;break}return e.next=64,this._peerConnection.setLocalDescription({type:"rollback"});case 64:throw e.t1;case 65:try{s.forEach(function(e){return e()})}catch(e){}this.logger.info("dequeue","loop"),e.next=73;break;case 69:e.prev=69,e.t2=e.catch(7),this.logger.error("dequeue","unknown error: %o",e.t2),r.forEach(function(t){return t(e.t2)});case 73:return e.prev=73,this.dequeue(),e.finish(73);case 76:case"end":return e.stop()}},e,this,[[7,69,73,76],[17,33,37,47],[38,,42,46],[54,59]])})),function(){return n.apply(this,arguments)})},{key:"getDefaultSdp",value:(i=sk(sI().mark(function e(){var t,r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._genOfferSdp();case 2:return r=e.sent,this.createAVMlineOfferTpl(r),i=R7.parse(r),n=[],i.media=s8(t=i.media).call(t,function(e){var t;return"recvonly"===e.direction&&(Array.isArray(e.ext)&&(e.ext=s8(t=e.ext).call(t,function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri})),n.push("".concat(e.mid)),!0)}),i.groups=[{mids:n.join(" "),type:"BUNDLE"}],gs&&IP(i),e.abrupt("return",{sdp:R7.write(i),semantics:"unified-plan",type:"incroffer"});case 10:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"rollback",value:(r=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:delete(r=t.stream).audioMLine,delete r.videoMLine;case 3:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this,r=R7.parse(e);r.media.forEach(function(e){var r,i;"audio"===e.type?"sendonly"===e.direction?t._aSendonlyOfferTpl=e:(Array.isArray(e.ext)&&(e.ext=s8(r=e.ext).call(r,function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri})),t._aRecvonlyOfferTpl=e):"video"===e.type&&("sendonly"===e.direction?t._vSendonlyOfferTpl=e:(Array.isArray(e.ext)&&(e.ext=s8(i=e.ext).call(i,function(e){return"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id"!==e.uri})),t._vRecvonlyOfferTpl=e))}),gs&&IP(r)}},{key:"_genOfferSdp",value:(t=sk(sI().mark(function e(){var t,r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v7(!0);case 3:if(t=Ix(t=e.sent)){e.next=7;break}throw"pc.createOffer() return empty.";case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(0),r="Get offer Error. ".concat(e.t0.message|e.t0),new pB(h6.NOT_SUPPORTED,r);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}},e,null,[[0,9]])})),function(){return t.apply(this,arguments)})}]),d}(),Cf=function(e){hA(l,Co);var t,r,i,n,o,a,s,c,d,u=hI(l);function l(e,t){var r;return nK(this,l),nQ(he(r=u.call(this,e,t)),"name","firefox"),nQ(he(r),"_aRecvonlyOfferTpl",void 0),r.logger=new mJ("FirefoxHandler",3,e.id),r}return nY(l,[{key:"publish",value:(d=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,h,p,f,_,A,m,v=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=(n=hf(hp(l.prototype),"internalPublish",this).call(this,t)).videoDescriptions,a=n.subVideoDescriptions,s=n.audioTransceiverInit,c=n.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(s.track,s.init),Array.isArray(c.init.sendEncodings)&&1===c.init.sendEncodings.length&&(c.init.sendEncodings=sU(d=c.init.sendEncodings).call(d,function(e){return delete e.rid,e})),t.videoTransceiver=this._peerConnection.addTransceiver(c.track,c.init),u=v0(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=8,this.peer.createOfferSdp();case 8:return h=e.sent,this._report("rtc_create_offer",{direction:"up",error_code:0,stream_id:"",stream_user_id:"",elapse:v0()-u}),(p=R7.parse(h)).media=null===(r=p.media)||void 0===r?void 0:sU(r).call(r,function(e){return l9(l9({},e),v.peer._offerIce)}),IP(p),e.next=15,this.setLocalDescription(R7.write(p));case 15:return f=t.audioTransceiver.mid,_=t.videoTransceiver.mid,A=null,m=null,p.media=null===(i=p.media)||void 0===i?void 0:sU(i).call(i,function(e){if("".concat(e.mid)===f){var t,r,i=null===(t=A=e)||void 0===t?void 0:uC(r=t.rtp).call(r,function(e){return"opus"===e.codec});if(i&&A.fmtp){var n,o,a=uC(n=A.fmtp).call(n,function(e){return e.payload===i.payload});a&&null!==(o=v._context)&&void 0!==o&&o.audioProfileManager&&(a.config=v._context.audioProfileManager.getOpusConfigStr(a.config))}}else"".concat(e.mid)===_&&(m=e);return e}),this.addBitrateLimit(m,t.videoEncodeConfig[0].maxKbps),e.next=23,this.setLocalDescription(R7.write(p));case 23:return e.abrupt("return",{partialSdp:I_(p,A,m),audioMid:f,videoMid:_,type:"incroffer",semantics:"unified-plan",videoDescriptions:o,subVideoDescriptions:a,audioTransceiverInit:s,videoTransceiverInit:c,peerConnectionMode:this.peerConnectionMode});case 24:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"_internalChangePubCodec",value:(c=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this._peerConnection.localDescription)){e.next=6;break}return e.next=4,this.peer.createOfferSdp();case 4:return e.next=6,this._peerConnection.setLocalDescription(t);case 6:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"subscribe",value:(s=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribe()"),c="",d="",u=!1,l=!1,h=void 0,p=void 0,t.virtual?u=!0:(r.multiChatMode||(u=!0),l=!0),u&&(t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"})),l&&(t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"})),f=v0(),this._report("rtc_begin_create_offer",{direction:"up",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:0}),e.next=14,this.peer.createOfferSdp();case 14:return _=e.sent,this._report("rtc_create_offer",{error_code:0,direction:"up",stream_id:t.streamId,stream_user_id:t.userId,elapse:v0()-f}),(A=R7.parse(_)).media=null===(i=A.media)||void 0===i?void 0:sU(i).call(i,function(e){return l9(l9({},e),k.peer._offerIce)}),sU(n=A.media).call(n,function(e){var t,r,i,n;"video"===e.type&&(ga?(e.ext=null===(t=e.ext)||void 0===t?void 0:s8(t).call(t,function(e){var t;return -1===ux(t=e.uri).call(t,"abs-send-time")}),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:s8(r).call(r,function(e){return"goog-remb"!==e.type})):(e.rtcpFb=null===(i=e.rtcpFb)||void 0===i?void 0:s8(i).call(i,function(e){return"transport-cc"!==e.type}),e.ext=null===(n=e.ext)||void 0===n?void 0:s8(n).call(n,function(e){var t;return -1===ux(t=e.uri).call(t,"transport")})))}),gs&&IP(A),e.next=22,this.setLocalDescription(R7.write(A),{streamId:t.streamId||"",streamUserId:t.userId});case 22:return c=null===(o=t.audioTransceiver)||void 0===o?void 0:o.mid,d=null===(a=t.videoTransceiver)||void 0===a?void 0:a.mid,null===(s=A.media)||void 0===s||s.forEach(function(e){"".concat(e.mid)===c?h=e:"".concat(e.mid)===d&&(p=e)}),c&&h||(c="audio_".concat(d),h=l9(l9({},this._aRecvonlyOfferTpl),{},{mid:c})),t.audioMid=c,t.videoMid=d,m=void 0,v=void 0,!r.multiChatMode&&!t.virtual&&this._aSendonlyAnswerTpl&&this._aSendonlyAnswerTpl&&(m=Il(this._nextSsrc),this._nextSsrc=m.next,I=l9(l9(l9({},this._aSendonlyAnswerTpl),this.peer._answerIce),{},{mid:c,msid:sN(E=sN(g="".concat(t.streamId)).call(g,null!==(S=this._context)&&void 0!==S&&S.avSync?"":"-audio"," ")).call(E,t.streamId,"-audio"),ssrcs:Ih(t.streamId,"audio",m.audio)}),C=l9(l9(l9({},this._vSendonlyAnswerTpl),this.peer._answerIce),{},{mid:d,msid:sN(b=sN(T="".concat(t.streamId)).call(T,null!==(y=this._context)&&void 0!==y&&y.avSync?"":"-video"," ")).call(b,t.streamId,"-video")},Ip(t.streamId,m,{flexfec:this._enableSubFlexfec})),v={sdp:R7.write(l9(l9({},this.peer._answerSession),{},{media:[I,C]})),sequenceId:t.sequenceId?++t.sequenceId:0},null===(R=m)||void 0===R||delete R.next),e.abrupt("return",{partialSdp:I_(A,h,p,!1),audioMid:c,videoMid:d,type:"incroffer",semantics:"unified-plan",audioTransceiverInit:t.audioTransceiver?{track:"audio",init:{direction:"recvonly"}}:void 0,videoTransceiverInit:t.videoTransceiver?{track:"video",init:{direction:"recvonly"}}:void 0,allSsrc:m,peerConnectionMode:this.peerConnectionMode,signalingAck:v});case 32:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"handleAck",value:(a=sk(sI().mark(function e(t){var r,i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.stream,(i=t.action)!==Cc.removetrack){e.next=3;break}return e.abrupt("return","");case 3:if(i!==Cc.unpublish&&i!==Cc.unsubscribe){e.next=14;break}return e.prev=4,e.next=7,this.close(r);case 7:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),"function"==typeof t.onFail&&t.onFail(e.t0);case 13:return e.abrupt("return",r.streamId||"");case 14:return n=t.signalingAck,o=t.videoCodec,a=R7.parse(n.sdp),e.prev=16,e.next=19,this._internalSetRemoteDescription(a.media,r,o);case 19:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(16),"function"==typeof t.onFail&&t.onFail(e.t1);case 25:return e.abrupt("return","");case 26:case"end":return e.stop()}},e,this,[[4,10],[16,22]])})),function(e){return a.apply(this,arguments)})},{key:"_internalSetRemoteDescription",value:(o=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c={},(d=R7.parse(null===(n=this._peerConnection.remoteDescription)||void 0===n?void 0:n.sdp)).media.forEach(function(e){void 0!==e.mid&&(c[e.mid]=e)}),t.forEach(function(e){if("audio"===(e=l9(l9({},e),h.peer._answerIce)).type&&(r.audioMid?(e.mid=r.audioMid,c[r.audioMid]=e):c[e.mid]=e),"video"===e.type){if(r instanceof Rm&&vA<=87){var t,n,o,a,s={};Array.isArray(e.rtp)&&(e.rtp=s8(t=e.rtp).call(t,function(e){return"rtx"!==e.codec||(s[e.payload]=e.payload,!1)})),"string"==typeof e.payloads&&(e.payloads=s8(n=e.payloads.split(" ")).call(n,function(e){return!s[e]}).join(" ")),Array.isArray(e.fmtp)&&(e.fmtp=s8(o=e.fmtp).call(o,function(e){return!s[e.payload]})),Array.isArray(e.rtcpFb)&&(e.fmtp=s8(a=e.fmtp).call(a,function(e){return!s[e.payload]}))}i&&IO(e,i),r.videoMid?(e.mid=r.videoMid,c[r.videoMid]=e):c[e.mid]=e}}),l=sU(a=(u=R7.parse(null===(o=this._peerConnection.localDescription)||void 0===o?void 0:o.sdp)).media).call(a,function(e){var t=c[e.mid];return"inactive"===e.direction?e:t}),d.groups=u.groups,d.media=l,sU(s=d.media).call(s,function(e){var t,r,i,n;"video"===e.type&&(ga?(e.ext=null===(t=e.ext)||void 0===t?void 0:s8(t).call(t,function(e){var t;return -1===ux(t=e.uri).call(t,"abs-send-time")}),e.rtcpFb=null===(r=e.rtcpFb)||void 0===r?void 0:s8(r).call(r,function(e){return"goog-remb"!==e.type})):(e.rtcpFb=null===(i=e.rtcpFb)||void 0===i?void 0:s8(i).call(i,function(e){return"transport-cc"!==e.type}),e.ext=null===(n=e.ext)||void 0===n?void 0:s8(n).call(n,function(e){var t;return -1===ux(t=e.uri).call(t,"transport")})))}),gs&&IP(d),e.next=12,this.setRemoteDescription(R7.write(d));case 12:case"end":return e.stop()}},e,this)})),function(e,t,r){return o.apply(this,arguments)})},{key:"getDefaultSdp",value:(n=sk(sI().mark(function e(){var t,r,i,n,o;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=R7.parse(null===(t=this._peerConnection.localDescription)||void 0===t?void 0:t.sdp),this.createAVMlineOfferTpl(null===(r=this._peerConnection.localDescription)||void 0===r?void 0:r.sdp),o=[],n.media=s8(i=n.media).call(i,function(e){return"recvonly"===e.direction&&(e.mid=e.mid+1,o.push("".concat(e.mid)),!0)}),gs&&IP(n),n.groups=[{mids:o.join(" "),type:"BUNDLE"}],e.abrupt("return",{sdp:R7.write(n),semantics:"unified-plan",type:"incroffer"});case 7:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"rollback",value:(i=sk(sI().mark(function e(t){var r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.msid,r=t.stream,i=t.audioMid,n=t.videoMid,this.logger.warn("rollback()"),e.abrupt("return",this.close(r,i,n));case 3:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"close",value:(r=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h,p,f,_=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("close()"),s=t.audioMid||r,c=t.videoMid||i,d={},t.audioTransceiver&&s&&(t.audioTransceiver.stop(),d[s]=s),t.videoTransceiver&&c&&(t.videoTransceiver.stop(),d[c]=c),u=[],e.next=9,this.peer.createOfferSdp();case 9:return l=e.sent,(h=R7.parse(l)).media=sU(n=h.media).call(n,function(e){return d[e.mid]&&(e=If(e)),"inactive"!==e.direction&&u.push(e.mid),l9(l9({},e),_.peer._offerIce)}),p=R7.parse(null===(o=this._peerConnection.remoteDescription)||void 0===o?void 0:o.sdp),f={},p.media.forEach(function(e){void 0!==e.mid&&(f[e.mid]=e)}),p.media=sU(a=h.media).call(a,function(e){return"inactive"===e.direction?e:f[e.mid]}),h.groups&&p.groups&&(h.groups[0].mids=u.join(" "),p.groups[0].mids=u.join(" ")),e.next=19,this.setLocalDescription(R7.write(h));case 19:return e.next=21,this.setRemoteDescription(R7.write(p));case 21:case"end":return e.stop()}},e,this)})),function(e,t,i){return r.apply(this,arguments)})},{key:"setCurrentDescription",value:(t=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.peer.createOfferSdp();case 2:if(!this._peerConnection.localDescription||!this._peerConnection.remoteDescription){e.next=7;break}return e.next=5,this._peerConnection.setLocalDescription(this._peerConnection.localDescription);case 5:return e.next=7,this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription);case 7:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this,r=R7.parse(e);r.media.forEach(function(e){"audio"===e.type&&(t._aRecvonlyOfferTpl=e)}),gs&&IP(r)}}]),l}(),C_=(nQ(Ct={},IZ.ICE_FAILED,pd.ICE_FAILED),nQ(Ct,IZ.DC_ERROR,pd.ICE_FAILED),nQ(Ct,IZ.DC_CLOSE,pd.ICE_FAILED),nQ(Ct,IZ.NODE_CHANGE,pd.NODE_CHANGE),nQ(Ct,IZ.NOTIFY_RECONNECT,pd.NOTIFY_RECONNECT),nQ(Ct,IZ.JOIN_TIMEOUT,pd.JOIN_TIMEOUT),Ct),CA=function(e){hA(r,EL);var t=hI(r);function r(e){var i;return nK(this,r),nQ(he(i=t.call(this)),"_connectionManager",void 0),nQ(he(i),"_dataChannelSignal",void 0),nQ(he(i),"_state",void 0),nQ(he(i),"_connectionLostTimer",void 0),nQ(he(i),"_isReconnecting",!1),nQ(he(i),"logger",void 0),i._ctx=e,i.logger=new mJ("SignalingManager",1,e.id),i.logger.info("constructor","invoke"),i._connectionManager=new I$(e),i._addConnectorHandler(),i}return nY(r,[{key:"connect",value:function(){var e=this;return this.isConnected()?sP.resolve():new sP(function(t,r){e._connectionManager.once("connected",function(){return t()}),e._connectionManager.once("disconnected",r),e._connectionManager.startup()})}},{key:"reconnect",value:function(e,t){this._connectionManager.reconnect(e,t)}},{key:"sendSignaling",value:function(e,t,r,i){if(!this._dataChannelSignal)throw new pB(h6.NOT_CONNECTED_YET,"signaling channel is not connected");return this._dataChannelSignal.sendSignaling(e,t,r,i)}},{key:"sendP2PMessage",value:function(e){if(!this._dataChannelSignal)throw new pB(h6.NOT_CONNECTED_YET,"signaling channel is not connected");return this._dataChannelSignal.sendP2PMessage(e)}},{key:"destroy",value:function(){var e;this.logger.info("destroy()"),this._clearConnectionLostTimer(),this._connectionManager.shotdown(),this._ctx.handler=void 0,null===(e=this._dataChannelSignal)||void 0===e||e.destroy(),this._setState(pc.CONNECTION_STATE_DISCONNECTED),this.removeAllListeners()}},{key:"isConnected",value:function(){return this._state===pc.CONNECTION_STATE_CONNECTED||this._state===pc.CONNECTION_STATE_RECONNECTED}},{key:"isReconnecting",value:function(){return this._state===pc.CONNECTION_STATE_CONNECTING||this._state===pc.CONNECTION_STATE_RECONNECTING}},{key:"_setState",value:function(e,t){if(this._state!==e){this._state=e;var r={state:e};t&&(r.reason=C_[t]||pd.ICE_FAILED),this.safeEmit(Ej.ON_CONNECTION_STATE_CHANGE,r)}}},{key:"_addConnectorHandler",value:function(){var e=this;this._connectionManager.on("connected",function(t){var r,i,n;e.logger.info("connectStateChange","connected"),e._clearConnectionLostTimer(),null===(r=e._dataChannelSignal)||void 0===r||r.destroy(),e._ctx.peerConnection=t.pc,e._ctx.handler=(i=e._ctx,n=t.pc,m4?new Cf(i,n):new Cp(i,n)),e._dataChannelSignal=t.signaling,e._addSignalEventHandler(),e._setState(e._isReconnecting?pc.CONNECTION_STATE_RECONNECTED:pc.CONNECTION_STATE_CONNECTED)}),this._connectionManager.on("disconnected",function(t){e._clearConnectionLostTimer(),e._setState(pc.CONNECTION_STATE_DISCONNECTED),e.logger.error("connectStateChange","disconnected. %o",t.message),e._isReconnecting&&e.safeEmit(Ej.ON_RECONNECT_FAILED)}),this._connectionManager.on("connecting",function(){e._isReconnecting=!1,e._ctx.handler=void 0,e._setState(pc.CONNECTION_STATE_CONNECTING),e.logger.info("connectStateChange","connecting")}),this._connectionManager.on("reconnecting",function(t){e._setState(pc.CONNECTION_STATE_DISCONNECTED,t),e._connectionLostTimer||(e._connectionLostTimer=setTimeout(function(){e.safeEmit(Ej.ON_CONNECTION_STATE_CHANGE,{state:pc.CONNECTION_STATE_LOST})},1e4)),e._isReconnecting=!0,e._ctx.handler=void 0,e._setState(pc.CONNECTION_STATE_RECONNECTING,t),e.logger.warn("connectStateChange","reconnecting")}),this._connectionManager.on("connectWidthTcp",function(){e.safeEmit(Ej.CONNECT_WITH_TCP)}),["__onGetIceConfigHook","__onIceConnectSuccessHook","__onConnectSuccessHook"].forEach(function(t){e._connectionManager.on(t,function(){for(var r,i=arguments.length,n=Array(i),o=0;o<i;o++)n[o]=arguments[o];return e.emit.apply(e,sN(r=[t]).call(r,n))})})}},{key:"_clearConnectionLostTimer",value:function(){this._connectionLostTimer&&(clearTimeout(this._connectionLostTimer),delete this._connectionLostTimer)}},{key:"_addSignalEventHandler",value:function(){var e,t,r=this;[EV.ON_ADD_STREAM,EV.ON_ADD_STREAM_LIST,EV.ON_REMOVE_STREAM,EV.ON_REMOVE_STREAM_LIST,EV.USER_CONNECTION,EV.USER_CONNECTION_LIST,EV.USER_DISCONNECTION,EV.USER_DISCONNECTION_LIST,EV.ON_UPDATE_STREAM_ATTRIBUTES,EV.ON_UPDATE_ROOM_ATTRIBUTES,EV.ON_PUSH_TRACK,EV.ON_REMOVE_TRACK,EV.ON_CUSTOM_MESSAGE,EV.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,EV.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,EV.USER_MESSAGE_RECEIVED,EV.USER_BINARY_MESSAGE_RECEIVED,EV.POST_PROCESSING_MESSAGE,EV.ON_USER_TOKEN_WILL_EXPIRE,EV.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE,EV.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED,EV.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE,EV.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED,EV.STREAM_CONTROL_MESSAGE,EV.ENGINE_CONTROL_MESSAGE,EV.ON_UPDATE_USER_ATTRIBUTES,EV.ON_SPEAKER_CHANGE,EV.ON_STREAM_FAILED,EV.ON_FORWARD_DST_ROOM_USER_KICK,EV.ON_STREAM_PULL_STATE_CHANGED,EV.ON_STREAM_PUSHED_BY_OTHER,EF.RSCP,EF.RTT,EF.SSC].forEach(function(e){var t;null===(t=r._dataChannelSignal)||void 0===t||t.on(e,function(t){r.safeEmit(e,t)})}),null===(e=this._dataChannelSignal)||void 0===e||e.on(EV.NODE_CHANGE,function(e){r._connectionManager.reconnectByNodeChange(e)}),null===(t=this._dataChannelSignal)||void 0===t||t.on(EV.ON_NOTIFY_RECONNECT,function(){r._connectionManager.reconnect(IZ.NOTIFY_RECONNECT)})}}]),r}(),Cm=((I9=Cm||{}).NORMAL_USER="normalUser",I9.SILENT_USER="silentUser",I9);var Cv=["preferCodecName"],CE=function(){var e,t,r;function i(e){nK(this,i),nQ(this,"_captureDeviceId",void 0),nQ(this,"_contentHint",void 0),nQ(this,"_videoCaptureConf",l9({},vY)),nQ(this,"_mainPreferCodec",void 0),nQ(this,"_screenPreferCodec",void 0),nQ(this,"_remoteVideoConfig",new d9),nQ(this,"_remoteSimulcastStreamType",new d9),nQ(this,"_simulcastMode",pP.VIDEO_ONLY_ONE),nQ(this,"_highVideoEncodeConf",R$(vY)),nQ(this,"_midVideoEncodeConf",void 0),nQ(this,"_lowVideoEncodeConf",void 0),nQ(this,"_screenEncodeConfig",vK),nQ(this,"_invalidVideoEncodeConf",void 0),nQ(this,"activeSimStreams",[]),nQ(this,"_logger",void 0),nQ(this,"_apiVersion",void 0),this._ctx=e,this._logger=new mJ("EngineVideoProfile",1,e.id)}return nY(i,[{key:"setCaptureDeviceId",value:function(e){this._captureDeviceId=e}},{key:"setCaptureConfig",value:function(e){this._videoCaptureConf=l9(l9({},this._videoCaptureConf),e)}},{key:"getCaptureConfig",value:function(e){e=e||this._captureDeviceId;var t=l9({},this._videoCaptureConf);return"user"===e||"environment"===e||"left"===e||"right"===e?(delete t.deviceId,t.facingMode=e):e&&(!vt||vs?t.deviceId={exact:e}:delete t.deviceId),t}},{key:"getContentHint",value:function(){return this._contentHint}},{key:"getPreferCodec",value:function(e){return e?this._screenPreferCodec:this._mainPreferCodec}},{key:"setRemoteUserVideoConfig",value:function(e,t){"object"===nF(t)?this._remoteVideoConfig.set(e,t):this._remoteSimulcastStreamType.set(e,t)}},{key:"getSubLayer",value:function(e,t){var r=this._remoteSimulcastStreamType.get(e.userId),i=this._remoteVideoConfig.get(e.userId);if(r){var n,o,a,s,c,d,u,l,h=e.attributes||{},p=h.videoDescriptions,f=h.subVideoDescriptions,_=Array.isArray(f)?f:p;return 1===_.length?l=0:2===_.length?l=r===pD.VIDEO_STREAM_HIGH?0:1:_.length>=3&&(l=(nQ(n={},pD.VIDEO_STREAM_HIGH,0),nQ(n,pD.VIDEO_STREAM_MID,1),nQ(n,pD.VIDEO_STREAM_LOW,2),n)[r]),{spatialLayer:null!==(o=null!==(a=l&&(null===(s=_[l])||void 0===s?void 0:s.video_index))&&void 0!==a?a:l)&&void 0!==o?o:0,spatialSubLayer:null!==(c=null!==(d=l&&(null===(u=_[l])||void 0===u?void 0:u.sub_index))&&void 0!==d?d:l)&&void 0!==c?c:-1}}return i?RZ(i,e):t?RZ(t,e):void 0}},{key:"getSimulcastMode",value:function(){return this._simulcastMode}},{key:"setSimulcastMode",value:(r=sk(sI().mark(function e(t,r){var i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!m4&&!vr&&14!==(null==vv?void 0:vv[0])){e.next=2;break}throw new pB(h6.NOT_SUPPORTED,"Simulcast is not supported");case 2:if(this._simulcastMode===t){e.next=13;break}if(null==r||!r.hasPublished){e.next=11;break}if(null!==(i=r.localStream)&&void 0!==i&&i.videoHasPublish||null!==(n=r.localStream)&&void 0!==n&&n.audioHasPublish){e.next=10;break}return this._logger.print("setSimulcastMode()","change simulcast mode and unpublish."),e.next=8,r.unpublish();case 8:e.next=11;break;case 10:throw new pB(h6.SET_SIMULCAST_FAILED,"Cannot change simulcast mode after publishing the video streams");case 11:this._simulcastMode=t,t!==pP.VIDEO_ONLY_ONE&&this._autoGenerateSubVideoEncodeConfig();case 13:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"closeSimulcast",value:function(){this._simulcastMode=pP.VIDEO_ONLY_ONE}},{key:"setVideoEncodeConfigPolyfill",value:(t=sk(sI().mark(function e(t){var r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:var o;if(!Array.isArray(t)){e.next=8;break}return EC(t),i=(r=sX(o=t)||u7(o)||sQ(o)||sJ())[0],n=uk(r).call(r,1),this.setVideoEncodeConfig(i),e.next=6,this.setSubVideoEncodeConfig(p$(n).call(n));case 6:e.next=9;break;case 8:this.setVideoEncodeConfig(t);case 9:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"setVideoEncodeConfig",value:function(e){EC([e]);var t=this._midVideoEncodeConf||this._lowVideoEncodeConf;t&&R0(t)>=R0(e)?(this._logger.warn("setVideoEncodeConfig","smaller then substream"),this._invalidVideoEncodeConf=R$(e),e=t):delete this._invalidVideoEncodeConf;var r=l9({},e),i=r.preferCodecName,n=l7(r,Cv);EE(n),this._logger.print("setVideoEncodeConfig","update encode config",e),this._highVideoEncodeConf=R$(e),this._contentHint=n.contentHint,this._mainPreferCodec=i,this._logger.print("setVideoEncodeConfig","update capture config",n),this._videoCaptureConf=n}},{key:"setSubVideoEncodeConfig",value:(e=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.print("setSubVideoEncodeConfig","%o, published=%s",t,null==r?void 0:r.hasPublished),!(t&&t.length>0)){e.next=27;break}if(EC(t),hY(t).call(t,function(e,t){return R0(e)-R0(t)}),n=this._invalidVideoEncodeConf||this._highVideoEncodeConf,!(R0(t[t.length-1])>=R0(n))){e.next=10;break}throw new pB(h6.SET_SIMULCAST_FAILED,"The resolution cannot exceed the mainstream");case 10:if(null==r||!r.hasPublished||t.length===this._getSubLayers().length){e.next=17;break}if(null!==(o=r.localStream)&&void 0!==o&&o.videoHasPublish||null!==(a=r.localStream)&&void 0!==a&&a.audioHasPublish){e.next=16;break}return e.next=14,r.unpublish();case 14:e.next=17;break;case 16:throw new pB(h6.SET_SIMULCAST_FAILED,"Cannot change the number of substreams after publishing the video streams");case 17:if(t.length>2&&(mw(this._ctx.id,"simulcast_over_limit","setLocalSimulcastMode: You can set parameters for up to 2 streams"),Es("setLocalSimulcastMode: You can set parameters for up to 2 streams")),c=(s=sq(t,2))[0],d=s[1],c&&(R2(n,c),this._lowVideoEncodeConf=R$(c)),d&&(R2(n,d),this._midVideoEncodeConf=R$(d)),!this._invalidVideoEncodeConf){e.next=25;break}return this.setVideoEncodeConfig(this._invalidVideoEncodeConf),e.next=25,null==i?void 0:i.updateVideoCaptureConfig(this._ctx.videoProfile.getCaptureConfig());case 25:e.next=28;break;case 27:this._autoGenerateSubVideoEncodeConfig();case 28:case"end":return e.stop()}},e,this)})),function(t,r,i){return e.apply(this,arguments)})},{key:"genVideoDescriptions",value:function(e){var t,r=[],i=[],n=[],o=[],a=this._highVideoEncodeConf,s=a.width,c=a.height,d=a.frameRate,u=a.maxKbps,l=null===(t=e.videoTrack)||void 0===t?void 0:t.preprocessingTrack;if(l){var h=null==l?void 0:l.getSettings();s=Math.floor(h.width),c=Math.floor(h.height),d=Math.floor(h.frameRate)}"number"!=typeof d&&(d=30),r.push({width:s,height:c,framerate:d,maxkbps:u,rid:"0"}),n.unshift({maxBitrate:1e3*u,rid:"0"});var p=this._ctx.serverConfig;if(!(e.isScreen||this._simulcastMode===pP.VIDEO_ONLY_ONE||m4&&"VP8"!==(null==p?void 0:p.videoCodec))){var f=RJ(s,c);if(f>1){var _=this._getSubVideoEncodeConfig(f,{width:s,height:c});this._logger.info("simulcast() ","simulcastLayers: %o",_),o.push(!0),_.forEach(function(e,t){var i={maxBitrate:1e3*e.maxkbps,scaleResolutionDownBy:e.scaleResolutionDownBy,rid:"".concat(t+1),maxFramerate:e.frameRate};n.unshift(i),r.push({width:e.width,height:e.height,framerate:e.frameRate,maxkbps:e.maxkbps,rid:"".concat(t+1)}),o.push(!0)}),null!=p&&p.simulcastOnDemand&&(i=sU(r).call(r,function(e,t){return l9(l9({},e),{},{video_index:t,sub_index:t})}))}}return null!=p&&p.e2eFeedback&&(i=sU(r).call(r,function(e,t){return l9(l9({},e),{},{video_index:t,sub_index:t})})),{videoDescriptions:r,subVideoDescriptions:i,sendEncodings:n,activeSimulcastStreams:o}}},{key:"getVideoEncodeConfig",value:function(){var e;return s8(e=[this._highVideoEncodeConf,this._midVideoEncodeConf,this._lowVideoEncodeConf]).call(e,function(e){return e})}},{key:"setScreenEncodeConfig",value:function(e){this._screenEncodeConfig=e}},{key:"getScreenEncodeConfig",value:function(){return this._screenEncodeConfig}},{key:"checkSimulcastApiVersion",value:function(e){if(this._apiVersion){if(this._apiVersion!==e){var t="mixing old and new apis, please use ".concat("new"===this._apiVersion?"setLocalSimulcastMode/setRemoteSimulcastStreamType":"enableSimulcastMode/setRemoteVideoConfig"," instead.");throw mw(this._ctx.id,"mixingOldAndNewApis",t),new pB(h6.MIXING_OLD_AND_NEW_APIS,t)}}else this._apiVersion=e}},{key:"destroy",value:function(){this._videoCaptureConf=vY,this._highVideoEncodeConf=R$(vY),delete this._invalidVideoEncodeConf,this._remoteVideoConfig.clear(),this._remoteSimulcastStreamType.clear()}},{key:"_autoGenerateSubVideoEncodeConfig",value:function(){this._logger.print("_autoGenerateSubVideoEncodeConfig()","generate low stream.");var e=this._highVideoEncodeConf,t=Ec(e.width),r=Ec(e.height),i=Math.min(t,r)/90;this._lowVideoEncodeConf={width:Math.floor(t/i),height:Math.floor(r/i),maxKbps:100,frameRate:10}}},{key:"_getSubLayers",value:function(){var e=[];return this._midVideoEncodeConf&&e.push(this._midVideoEncodeConf),this._lowVideoEncodeConf&&e.push(this._lowVideoEncodeConf),e}},{key:"_getSubVideoEncodeConfig",value:function(e,t){var r,i;return sU(r=uk(i=this._getSubLayers()).call(i,1-e)).call(r,function(e){if(e.width>e.height&&t.width<t.height||e.width<e.height&&t.width>t.height){var r=e.width;e.width=e.height,e.height=r}var i=Ec(e.width),n=Ec(e.height),o=Math.max(t.width/i,t.height/n);return{width:Math.floor(t.width/o),height:Math.floor(t.height/o),scaleResolutionDownBy:o,frameRate:Ec(e.frameRate)||15,maxkbps:e.maxKbps||600}})}},{key:"__autoResetVideoEncoderConfig",value:function(e){var t=vH(this.getVideoEncodeConfig(),e);t&&(this.setVideoEncodeConfigPolyfill(t),this._logger.print("autoResetVideoEncoderConfig() result",sD(t)),mw(this._ctx.id,"autoResetVideoEncoderConfig",sD(t)))}}]),i}(),Cg=function(){function e(t,r){nK(this,e),nQ(this,"_sendTimes",[]),this._interval=t,this._qps=r}return nY(e,[{key:"check",value:function(){var e,t=Date.now();if(this._sendTimes.length<this._qps)this._sendTimes.push(t);else{if(t-this._sendTimes[0]<this._interval)throw new pB(h6.USER_MESSAGE_EXCEED_QPS,"user message exceed qps");uH(e=this._sendTimes).call(e,0,1),this._sendTimes.push(t)}}}]),e}(),CS=((Ck=CS||{}).RECONNECT="ice-reconnect",Ck.LEAVE="leave_room",Ck),Cb=function(){function e(t,r,i){var n,o,a;nK(this,e),nQ(this,"avSync",!0),nQ(this,"streamRTT",{}),nQ(this,"useCloudProxy",!1),nQ(this,"videoProfile",void 0),nQ(this,"audioProfileManager",void 0),nQ(this,"extensionManager",void 0),nQ(this,"userPriority",new d9),nQ(this,"expectedIDC",void 0),nQ(this,"autoPlayPolicy",void 0),nQ(this,"joinRoomConfig",void 0),nQ(this,"signalingManager",void 0),nQ(this,"peerConnection",void 0),nQ(this,"pubSubLock",new RG("pubSubLock")),nQ(this,"visibility",!0),nQ(this,"rtsLimiter",{}),nQ(this,"serverConfig",void 0),nQ(this,"mediaParams",void 0),nQ(this,"subscribeFallbackOption",void 0),nQ(this,"joinRoomParams",void 0),nQ(this,"isPreConnection",!1),nQ(this,"_handler",void 0),nQ(this,"monitor",void 0),nQ(this,"_businessId",void 0),nQ(this,"_userStreamConfig",new d9),nQ(this,"_localAudioTrackDumpConfig",(nQ(n={},po.STREAM_INDEX_MAIN,{callback:void 0,frameSize:void 0}),nQ(n,po.STREAM_INDEX_SCREEN,{callback:void 0,frameSize:void 0}),n)),nQ(this,"_remoteAudioTrackDumpConfig",(nQ(o={},po.STREAM_INDEX_MAIN,new d9),nQ(o,po.STREAM_INDEX_SCREEN,new d9),o)),nQ(this,"_targetCodec",void 0),nQ(this,"_targetScreenCodec",void 0),nQ(this,"earMonitorSettings",(nQ(a={},po.STREAM_INDEX_MAIN,{position:pL.NONE,volume:100}),nQ(a,po.STREAM_INDEX_SCREEN,{position:pL.NONE,volume:100}),a)),nQ(this,"localVideoTrack",void 0),nQ(this,"localAudioTrack",void 0),nQ(this,"publicAudioVolume",new d9),this.id=t,this.appId=r,this.monitor=mS(t),this.expectedIDC=null==i?void 0:i.expectedIDC,this.autoPlayPolicy=null==i?void 0:i.autoPlayPolicy,this.audioProfileManager=new R3(r),this.extensionManager=new yd(t),this.joinRoomConfig=new vN(t),this.signalingManager=new CA(this),this.videoProfile=new CE(this)}return nY(e,[{key:"businessId",get:function(){return this._businessId},set:function(e){var t;this._businessId=e,null===(t=this.monitor)||void 0===t||t.set({rtc_business_id:e})}},{key:"handler",get:function(){return this._handler},set:function(e){var t;e&&this.resetPubSubLock("ice-reconnect"),null===(t=this._handler)||void 0===t||t.destroy(),this._handler=e}},{key:"role",get:function(){return this.visibility?Cm.NORMAL_USER:Cm.SILENT_USER}},{key:"targetCodec",get:function(){return this._targetCodec},set:function(e){var t=this;e&&[EZ.H264,EZ.VP8,EZ.ByteVC1].forEach(function(r){e.toLowerCase()===r.toLowerCase()&&(t._targetCodec=r)})}},{key:"targetScreenCodec",get:function(){return this._targetScreenCodec},set:function(e){var t=this;e&&[EZ.H264,EZ.VP8,EZ.ByteVC1].forEach(function(r){e.toLowerCase()===r.toLowerCase()&&(t._targetScreenCodec=r)})}},{key:"resetPubSubLock",value:function(e){this.pubSubLock.closeReason=e,this.pubSubLock=new RG("pubSubLock")}},{key:"setUserStreamConf",value:function(e,t,r){var i=this._userStreamConfig.get(e)||{},n=i[t]||{};i[t]=l9(l9({},n),r),this._userStreamConfig.set(e,i)}},{key:"getRemoteMirrorType",value:function(e,t){var r,i;return!(null===(r=this._userStreamConfig.get(e))||void 0===r||null===(i=r[t])||void 0===i||!i.mirrorType)}},{key:"setRtsQpsConf",value:function(e){"number"==typeof(null==e?void 0:e.rts_qps_interval)&&("number"==typeof e.rts_e2e_qps_value&&0!==e.rts_e2e_qps_value&&(this.rtsLimiter.e2e=new Cg(e.rts_qps_interval,e.rts_e2e_qps_value)),"number"==typeof e.rts_broadcast_qps_value&&0!==e.rts_broadcast_qps_value&&(this.rtsLimiter.boradcast=new Cg(e.rts_qps_interval,e.rts_broadcast_qps_value)),"number"==typeof e.rts_e2s_qps_value&&0!==e.rts_e2s_qps_value&&(this.rtsLimiter.e2s=new Cg(e.rts_qps_interval,e.rts_e2s_qps_value)),this.rtsLimiter.conf=e)}},{key:"destroy",value:function(){var e,t,r;this.signalingManager.destroy(),null===(e=this.handler)||void 0===e||e.destroy(),this.userPriority.clear(),this.avSync=!0,this._localAudioTrackDumpConfig=(nQ(t={},po.STREAM_INDEX_MAIN,{callback:void 0,frameSize:void 0}),nQ(t,po.STREAM_INDEX_SCREEN,{callback:void 0,frameSize:void 0}),t),this._remoteAudioTrackDumpConfig[po.STREAM_INDEX_MAIN].clear(),this._remoteAudioTrackDumpConfig[po.STREAM_INDEX_SCREEN].clear(),this.extensionManager.destroy(),this.earMonitorSettings=(nQ(r={},po.STREAM_INDEX_MAIN,{position:pL.NONE,volume:100}),nQ(r,po.STREAM_INDEX_SCREEN,{position:pL.NONE,volume:100}),r),this.publicAudioVolume.clear()}}]),e}();function CT(e,t,r){var i=r.value;return r.value=sk(sI().mark(function e(){var t,r,n,o,a,s,c,d=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.pubSubLock.lock();case 2:if(r=e.sent,"chrome"===(null===(t=this._ctx.handler)||void 0===t?void 0:t.name)&&r(),e.prev=4,!(n=this._ctx.pubSubLock.closeReason)){e.next=8;break}throw new pB(h6.UNEXPECTED_ERROR,n);case 8:for(a=Array(o=d.length),s=0;s<o;s++)a[s]=d[s];return e.next=11,i.apply(this,a);case 11:return e.abrupt("return",e.sent);case 12:return e.prev=12,"chrome"!==(null===(c=this._ctx.handler)||void 0===c?void 0:c.name)&&r(),e.finish(12);case 15:case"end":return e.stop()}},e,this,[[4,,12,15]])})),r}var Cy=gi(),CR=function(e){hA(s,Co);var t,r,i,n,o,a=hI(s);function s(e,t){var r;return nK(this,s),nQ(he(r=a.call(this,e,t)),"_peerConnectionId",v$()),nQ(he(r),"peerConnectionMode",1),nQ(he(r),"name","vendor"),nQ(he(r),"direction","up"),nQ(he(r),"stream",void 0),t.on("ice_state",function(e){r._report("rtc_ice_state",{pc_session_id:r.peerConnectionId,direction:r.direction,error_code:0,ice_state:e.toUpperCase(),message:"",peer_connection_id:r.peerConnectionId,stream_id:"",stream_user_id:""})}),t.on("disconnect",function(){r.emit("disconnect")}),r}return nY(s,[{key:"publish",value:(o=sk(sI().mark(function e(t){var r,i,n,o,a,c,d,u,l,h,p=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._context.videoProfile.closeSimulcast(),this.stream=t,i=(r=hf(hp(s.prototype),"internalPublish",this).call(this,t)).videoDescriptions,n=r.subVideoDescriptions,o=r.audioTransceiverInit,a=r.videoTransceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(o.track,o.init),t.videoTransceiver=this._peerConnection.addTransceiver(a.track,a.init),Cy&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"up",stream_id:"",stream_user_id:"",pc_session_id:this.peerConnectionId,vendor_mode:(null==t?void 0:t.vendorCode)||0}),e.next=9,this.peer.createOfferSdp();case 9:return c=e.sent,d=v0(),Array.isArray((u=R7.parse(c)).media)&&(u.media=sU(l=u.media).call(l,function(e){var t;if("video"===e.type)(m6||vs)&&Array.isArray(e.ext)&&(e.ext=s8(t=e.ext).call(t,function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&cd(t).call(t,"video-orientation"))})),m6||p.addBitrateLimit(e,p._context.videoProfile.getVideoEncodeConfig()[0].maxKbps);else if("audio"===e.type){var r,i=null==e?void 0:uC(r=e.rtp).call(r,function(e){return"opus"===e.codec});if(i&&e.fmtp){var n,o,a=uC(n=e.fmtp).call(n,function(e){return e.payload===i.payload});a&&null!==(o=p._context)&&void 0!==o&&o.audioProfileManager&&(a.config=p._context.audioProfileManager.getOpusConfigStr(a.config))}}return e})),h={type:"offer",sdp:R7.write(u)},e.prev=14,e.next=17,this._peerConnection.setLocalDescription(h);case 17:this._report("rtc_set_description",{error_code:0,message:h.sdp||"",is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:v0()-d},{type:"offer"}),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(14),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+h.sdp,is_local:"1",direction:"up",stream_id:"",stream_user_id:"",elapse:v0()-d},{type:"offer"}),e.t0;case 24:return e.abrupt("return",{partialSdp:h.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",videoDescriptions:i,subVideoDescriptions:n,audioTransceiverInit:o,videoTransceiverInit:a,peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 25:case"end":return e.stop()}},e,this,[[14,20]])})),function(e){return o.apply(this,arguments)})},{key:"subscribe",value:(n=sk(sI().mark(function e(t){var r,i,n,o,a,s=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.stream=t,this.direction="down",t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}),Cy&&(t.initAudioEncodedTransform(),t.initVideoEncodedTransform()),this._report("rtc_begin_create_offer",{direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:this.peerConnectionId,vendor_mode:t.vendorCode||0}),e.next=8,this.peer.createOfferSdp();case 8:return r=e.sent,i=v0(),Array.isArray((n=R7.parse(r)).media)&&(n.media=sU(o=n.media).call(o,function(e){if("audio"===e.type){var t,r=null==e?void 0:uC(t=e.rtp).call(t,function(e){return"opus"===e.codec});if(r&&null!=e&&e.fmtp){var i,n=null==e?void 0:uC(i=e.fmtp).call(i,function(e){return e.payload===r.payload});n&&s._context&&(n.config+=";stereo=1;sprop-stereo=1")}}return e})),a={type:"offer",sdp:R7.write(n)},e.prev=13,e.next=16,this._peerConnection.setLocalDescription(a);case 16:this._report("rtc_set_description",{error_code:0,message:a.sdp||"",is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:v0()-i},{type:"offer"}),e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(13),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+a.sdp,is_local:"1",direction:"down",stream_id:t.streamId,stream_user_id:t.userId,elapse:v0()-i},{type:"offer"}),e.t0;case 23:return e.abrupt("return",{partialSdp:a.sdp||"",audioMid:"0",videoMid:"1",type:"offer",semantics:"unified-plan",peerConnectionMode:this.peerConnectionMode,peerConnectionId:this.peerConnectionId});case 24:case"end":return e.stop()}},e,this,[[13,19]])})),function(e){return n.apply(this,arguments)})},{key:"handleAck",value:(i=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.action!==Cc.publish&&t.action!==Cc.subscribe){e.next=20;break}return i=t.signalingAck,n=t.videoMid,o=t.videoCodec,a=i.sdp,(s=R7.parse(a)).media=sU(r=s.media).call(r,function(e){return e.mid===n&&o&&IO(e,o),e}),c={sdp:R7.write(s),type:"answer"},d=v0(),e.prev=7,e.next=10,this._peerConnection.setRemoteDescription(c);case 10:this._report("rtc_set_description",{error_code:0,message:c.sdp||"",is_local:"1",direction:"down",stream_id:(null===(u=t.stream)||void 0===u?void 0:u.streamId)||"",stream_user_id:null===(l=t.stream)||void 0===l?void 0:l.userId,elapse:v0()-d},{type:"answer"}),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),this._report("rtc_set_description",{error_code:-1,message:e.t0.message+c.sdp,is_local:"1",direction:"down",stream_id:(null===(h=t.stream)||void 0===h?void 0:h.streamId)||"",stream_user_id:null===(p=t.stream)||void 0===p?void 0:p.userId,elapse:v0()-d},{type:"offer"}),e.t0;case 17:"function"==typeof t.onSuccess&&t.onSuccess(),e.next=21;break;case 20:t.action!==Cc.unpublish&&t.action!==Cc.unsubscribe||this.destroy();case 21:return e.abrupt("return","");case 22:case"end":return e.stop()}},e,this,[[7,13]])})),function(e){return i.apply(this,arguments)})},{key:"destroy",value:function(){this.peer.destroy(),hf(hp(s.prototype),"destroy",this).call(this)}},{key:"getDefaultSdp",value:(r=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{sdp:"",type:"offer",semantics:""});case 1:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"connect",value:function(){throw Error("Method not implemented.")}},{key:"rollback",value:(t=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{this._peerConnection.close()}catch(e){}case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"peerConnectionId",get:function(){return this._peerConnectionId},set:function(e){this._peerConnectionId=e}}]),s}(),CI=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},CC=function(e){hA(h,EL);var t,r,i,n,o,a,s,c,d,u,l=hI(h);function h(e,t){var r;return nK(this,h),nQ(he(r=l.call(this)),"_logger",void 0),nQ(he(r),"_pubBackOff",new d9),r._ctx=e,r._roomConf=t,r._logger=new mJ("RoomPublisher",2,e.id),r}return nY(h,[{key:"publish",value:(u=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._publish(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"_publish",value:(d=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P,D,L=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.info("publish()","localStream: %o",t),f=t.videoTrack,_=t.audioTrack,A=v0(),m=this._ctx.handler,!this._roomConf.vendorConfig.enableMultiVendor){e.next=14;break}return e.next=8,this._getVendorPubSdpInfo(t);case 8:m=(E=sq(e.sent,2))[0],v=E[1],e.next=17;break;case 14:return e.next=16,this._ctx.handler.publish(t);case 16:v=e.sent;case 17:return this.emit("_test_pub_sdpInfo_",v),S=(g=v).audioMid,b=g.videoMid,t.pubAttributes={localaudio:!!_,localvideo:!!f,videostream:t.pubVideo,audiostream:t.pubAudio,extvideo:(null==f?void 0:f.sourceType)===EY.EXTERNAL,extaudio:(null==_?void 0:_.sourceType)===EY.EXTERNAL,videoDescriptions:v.videoDescriptions,videoType:EH.NORMAL},T={attributes:l9({},t.pubAttributes),audio:!0,video:!0,screen:t.isScreen,audioMid:S,videoMid:b,sdpInfo:{msid:t.stream.id,type:v.type,sdp:v.partialSdp,semantics:v.semantics},peerConnectionMode:null===(r=v)||void 0===r?void 0:r.peerConnectionMode,supportMultiVendor:!0},((y=!this._roomConf.vendorConfig.enableMultiVendor&&t.enableSimulcast&&(null===(i=this._ctx.serverConfig)||void 0===i?void 0:i.simulcastOnDemand)&&(null===(n=v.subVideoDescriptions)||void 0===n?void 0:n.length))||null!==(o=this._ctx.serverConfig)&&void 0!==o&&o.e2eFeedback)&&(T.attributes.subVideoDescriptions=v.subVideoDescriptions),null!==(a=v)&&void 0!==a&&a.peerConnectionId&&(T.peerConnectionId=v.peerConnectionId),e.prev=24,this.emit("_test_pub_body_",T),e.next=28,this._ctx.signalingManager.sendSignaling("publish",T);case 28:R=e.sent,e.next=57;break;case 31:return e.prev=31,e.t0=e.catch(24),e.t0 instanceof Error?this._roomConf.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:A,message:sN(C="".concat(e.t0.name,": ")).call(C,e.t0.message)}):e.t0 instanceof pB&&this._roomConf.report("rtc_publish_stat",{result:"fail",is_screen:"0",start:A,message:sN(k="".concat(e.t0.code,": ")).call(k,e.t0.message)}),e.next=36,null===(I=m)||void 0===I?void 0:I.rollback({msid:t.stream.id,stream:t,audioMid:S,videoMid:b});case 36:if(!(e.t0.code>=500&&e.t0.code<600)){e.next=54;break}if(this.emit("_test_pub_5xx_"),!((w=this._getPubBackOff(t.id)).retryDuration<6e4)){e.next=50;break}return this._logger.info("pubRetry",t.id,w.retryDuration),e.next=43,new sP(function(e){return setTimeout(e,w.interval)});case 43:return w.retryDuration+=w.interval,w.interval=w.interval>4e3?8e3:2*w.interval,t.resetStream(),this.emit(Rg.PUB_RETRY,{screen:t.isScreen}),e.abrupt("return",this._publish(t));case 50:this._logger.info("pubRetry","end"),this._pubBackOff.delete(t.id);case 52:e.next=56;break;case 54:if(403!==e.t0.code){e.next=56;break}throw new pB(h6.TOKEN_NO_PUBLISH_PERMISSION,e.t0.message||"token no publish permission");case 56:throw e.t0;case 57:return this._roomConf.report("rtc_recv_answer",{error_code:0,answer_type:null===(s=R)||void 0===s?void 0:s.relayMessage.type,sequence_id:(null===(c=R)||void 0===c||null===(d=c.relayMessage)||void 0===d?void 0:d.sequenceId)||0,message:null===(u=R)||void 0===u||null===(l=u.relayMessage)||void 0===l?void 0:l.sdp,direction:"up",stream_id:"",stream_user_id:"",pc_session_id:(null===(h=m)||void 0===h?void 0:h.peerConnectionId)||""}),t.isScreen?t.setVideoCaps(null===(O=R.relayMessage.content)||void 0===O?void 0:O.screenCaps):t.setVideoCaps(null===(N=R.relayMessage.content)||void 0===N?void 0:N.videoCaps),t.streamId=R.streamId,e.next=62,t.getSelectedCodec();case 62:if(P=e.sent,t.currentVideoCodec=P,D=new sP(function(e,r){var i,n,o,a,s,c,d;null===(i=m)||void 0===i||i.handleAck({action:Cc.publish,streamId:R.streamId,audioMid:S,videoMid:b,audioTransceiverInit:null===(n=v)||void 0===n?void 0:n.audioTransceiverInit,videoTransceiverInit:null===(o=v)||void 0===o?void 0:o.videoTransceiverInit,signalingAck:{sdp:null===(a=R)||void 0===a||null===(s=a.relayMessage)||void 0===s?void 0:s.sdp,sequenceId:null===(c=R)||void 0===c||null===(d=c.relayMessage)||void 0===d?void 0:d.sequenceId},stream:t,videoCodec:P,onSuccess:function(){L._logger.info("publish()","publish success"),e(0)},onFail:function(e){L._logger.info("publish()","publish fail"),r(e)}})}),e.t1=!m4,!e.t1){e.next=69;break}return e.next=69,D;case 69:this.emit("___afterHandleAckInPub"),(y&&this._ctx.videoProfile.getSimulcastMode()===pP.VIDEO_ON_DEMAND||null!==(p=this._ctx.serverConfig)&&void 0!==p&&p.e2eFeedback)&&this.emit(EF.RSCP,[{StreamIds:[t.stream.id],Metadata:{VideoIndex:0}}],!0),t.videoMid=b,t.audioMid=S,t.subVideoDescriptions=v.subVideoDescriptions,t.remoteSdp=R.relayMessage.sdp,this._roomConf.report("rtc_publish_stat",{result:"success",is_screen:"0",start:A,message:"unknown"});case 76:case"end":return e.stop()}},e,this,[[24,31]])})),function(e){return d.apply(this,arguments)})},{key:"updatePubTrack",value:(c=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.info("updatePubTrack()","localStream: %o",t),r=t.videoTrack,i=t.audioTrack,n=t.pubAudio,o=t.pubVideo,a=t.vendorHandler||this._ctx.handler,s=null==i?void 0:i.preprocessingTrack,c=null==r?void 0:r.preprocessingTrack,!o||!c){e.next=12;break}return t.stopBlackFrame(),e.next=9,null===(d=t.videoTransceiver)||void 0===d?void 0:d.sender.replaceTrack(c);case 9:this._updateVideoDescriptions(t),e.next=14;break;case 12:return e.next=14,null===(u=t.videoTransceiver)||void 0===u?void 0:u.sender.replaceTrack(null);case 14:if(!n||!s){e.next=21;break}return h=i.mixType,(p=i.mixedAudioTrack)&&h!==Ci.PLAYOUT&&s.enabled&&(s=p),e.next=19,null===(l=t.audioTransceiver)||void 0===l?void 0:l.sender.replaceTrack(s);case 19:e.next=24;break;case 21:return e.next=23,null===(f=t.audioTransceiver)||void 0===f?void 0:f.sender.replaceTrack(null);case 23:mw(this._ctx.id,"MediaClient.updatePubTrack(audio)","null");case 24:return e.next=26,this._updatePublishCodec(t);case 26:this.emit("___onAfterReplaceTrack");try{mw(this._ctx.id,"MediaClient.updatePubTrack",sD({audioStreamTrack:f6(s),videoStreamTrack:f6(c)}))}catch(e){}for(_={localaudio:!!i,localvideo:!!r,videostream:o,audiostream:n,extvideo:(null==r?void 0:r.sourceType)===EY.EXTERNAL,extaudio:(null==i?void 0:i.sourceType)===EY.EXTERNAL,videoType:r?EH.NORMAL:t.pubAttributes.videoType},A={},m=0,v=cb(_);m<v.length;m++)g=(E=sq(v[m],2))[0],(S=E[1])!==R1(t.pubAttributes,g)&&R6(A,g,S);if(cG(A).length){e.next=33;break}return e.abrupt("return");case 33:return t.observer&&(b=t.observer,T=A.audiostream,y=A.videostream,R=A.localaudio,I=A.localvideo,C=A.extaudio,k=A.extvideo,void 0!==I?void 0!==k?b.setPushVideo(k):b.setEnableVideo(I):void 0!==y&&b.setUnmuteVideo(y),void 0!==R?void 0!==C?b.setPushAudio(C):b.setEnableAudio(R):void 0!==T&&b.setUnmuteAudio(T)),t.pubAttributes=l9(l9({},t.pubAttributes),_),t.pubAttributes.videostream||t.stopBlackFrame(),w={roomId:this._roomConf.roomId,streamId:t.streamId,attributes:A},e.next=39,this._ctx.signalingManager.sendSignaling("updateStreamAttributes",w);case 39:if(this.emit("___onAfterUpdateSignaling"),!m4){e.next=43;break}return e.next=43,null==a?void 0:a.setCurrentDescription();case 43:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"_updatePublishCodec",value:(s=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("updatePublishCodec()","localStream: %o",t),r=t.audioMid,i=t.videoMid,n=t.remoteSdp,o=t.streamId,a=t.currentVideoCodec,e.next=4,t.getSelectedCodec();case 4:if(s=e.sent,this._logger.info("updatePublishCodec()","selectedCodec: %o",s),s!==a){e.next=9;break}return this._logger.warn("updatePublishCodec()","selectedCodec is equal to currentVideoCodec"),e.abrupt("return");case 9:if(t.currentVideoCodec=s,!(r&&i&&o&&n)){e.next=17;break}if(!(m4&&this._ctx.handler instanceof Cf)){e.next=14;break}return e.next=14,null===(c=this._ctx.handler)||void 0===c?void 0:c._internalChangePubCodec();case 14:return e.abrupt("return",new sP(function(e,a){var c;null===(c=l._ctx.handler)||void 0===c||c.handleAck({action:Cc.publish,streamId:o,audioMid:r,videoMid:i,signalingAck:{sdp:n,sequenceId:-1},videoCodec:s,onSuccess:e,onFail:a,stream:t})}));case 17:u=s8(d=["audioMid","videoMid","streamId","remoteSdp"]).call(d,function(e){return!R1(t,e)}),this._logger.warn("updatePublishCodec()","fast return, because params: %o",u);case 19:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"unpublish",value:(a=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("unpublish()","localStream: %o",t),r={roomId:this._roomConf.roomId,initStreamId:t.initStreamId,streamId:t.streamId},this._ctx.signalingManager.sendSignaling("unpublish",r).catch(function(){}),i=t.vendorHandler||this._ctx.handler,t.stopBlackFrame(),e.next=7,null==i?void 0:i.handleAck({action:Cc.unpublish,audioMid:t.audioMid,videoMid:t.videoMid,stream:t,streamId:t.streamId});case 7:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"updatePubBlackFrame",value:(o=sk(sI().mark(function e(t){var r,i,n,o=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.genBlackFrame()){e.next=3;break}return e.abrupt("return");case 3:null===(r=t.videoTransceiver)||void 0===r||null===(i=r.sender)||void 0===i||i.replaceTrack(n),t.pubAttributes.videoType=EH.BLACK,this._ctx.signalingManager.sendSignaling("updateStreamAttributes",{roomId:this._roomConf.roomId,streamId:t.streamId,attributes:{videoType:EH.BLACK}}),t.on("black-frame-ended",function(){var e,r;null===(e=t.videoTransceiver)||void 0===e||null===(r=e.sender)||void 0===r||r.replaceTrack(null),t.pubAttributes.videoType=EH.NORMAL,o._ctx.signalingManager.sendSignaling("updateStreamAttributes",{roomId:o._roomConf.roomId,streamId:t.streamId,attributes:{videoType:EH.NORMAL}})});case 7:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"cleanStream",value:(n=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("cleanStream()","localStream: %o",t),e.abrupt("return",null==t?void 0:t.clean());case 2:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"destroyStream",value:(i=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("destroyStream()","localStream: %o",t),e.abrupt("return",null==t?void 0:t.destroy());case 2:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"destroy",value:function(e){var t=this;e.forEach(function(e){e&&(t.unpublish(e),t.destroyStream(e))}),this._pubBackOff.clear(),hf(hp(h.prototype),"removeAllListeners",this).call(this)}},{key:"_updateVideoDescriptions",value:(r=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._ctx.videoProfile.genVideoDescriptions(t),(n=t.pubAttributes.videoDescriptions).length===i.videoDescriptions.length){e.next=4;break}return e.abrupt("return");case 4:o={},uC(n).call(n,function(e,t){if(e.framerate!==i.videoDescriptions[t].framerate||e.maxkbps!==i.videoDescriptions[t].maxkbps||e.width!==i.videoDescriptions[t].width||e.height!==i.videoDescriptions[t].height)return o.videoDescriptions=i.videoDescriptions,!0}),null===(r=t.subVideoDescriptions)||void 0===r||uC(r).call(r,function(e,t){if(e.framerate!==i.subVideoDescriptions[t].framerate||e.maxkbps!==i.subVideoDescriptions[t].maxkbps||e.width!==i.subVideoDescriptions[t].width||e.height!==i.subVideoDescriptions[t].height)return o.subVideoDescriptions=i.subVideoDescriptions,!0}),cG(o).length>0&&(this._ctx.signalingManager.sendSignaling("updateStreamAttributes",{roomId:this._roomConf.roomId,streamId:t.streamId,attributes:o}),c=null===(a=t.videoTransceiver)||void 0===a||null===(s=a.sender)||void 0===s?void 0:s.getParameters(),mw(this._ctx.id,"sender.getParameters",sD(c),0,t.streamId),c&&Array.isArray(null==c?void 0:c.encodings)&&(c.encodings=sU(d=c.encodings).call(d,function(e,t){return e.rid===i.sendEncodings[t].rid&&(e.maxBitrate=i.sendEncodings[t].maxBitrate,e.maxFramerate=i.sendEncodings[t].maxFramerate,e.scaleResolutionDownBy=i.sendEncodings[t].scaleResolutionDownBy),e}),this._logger.info("sender.setParameters()",sD(c.encodings)),mw(this._ctx.id,"sender.setParameters",sD(c),0,t.streamId),null===(u=t.videoTransceiver)||void 0===u||u.sender.setParameters(c),mw(this._ctx.id,"Handler.updateScaleResolutionDownBy",sD(c.encodings))));case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_getVendorPubSdpInfo",value:(t=sk(sI().mark(function e(t){var r,i,n,o=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new IG(this._ctx,""),t.vendorHandler=new CR(this._ctx,r),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),e.next=5,t.vendorHandler.publish(t);case 5:return i=e.sent,(n=t.vendorHandler).on("ice_state",function(e){o.emit(Ej.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:pc.CONNECTION_STATE_CONNECTING,connected:pc.CONNECTION_STATE_CONNECTED,disconnected:pc.CONNECTION_STATE_RECONNECTING}[e],userId:o._roomConf.userId})}),n.once("disconnect",sk(sI().mark(function e(){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.removeAllListeners(),"connected"===(null===(r=o._ctx.peerConnection)||void 0===r?void 0:r.getIceConnectionState())){e.next=4;break}return o._logger.info("vendor ice failed",t.streamId),e.abrupt("return");case 4:return e.next=6,o.unpublish(t);case 6:return e.next=8,o.publish(t);case 8:t.vendorHandler&&t.statsReport.setVar(t.vendorHandler);case 9:case"end":return e.stop()}},e)}))),e.abrupt("return",[n,i]);case 10:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_getPubBackOff",value:function(e){return this._pubBackOff.has(e)||this._pubBackOff.set(e,{interval:1e3,retryDuration:0}),this._pubBackOff.get(e)}}]),h}();CI([RK,CT,RY],CC.prototype,"publish",1),CI([RK,CT,RY],CC.prototype,"updatePubTrack",1),CI([RK,CT,RY],CC.prototype,"unpublish",1),CI([RK,RY],CC.prototype,"updatePubBlackFrame",1),CI([RK],CC.prototype,"cleanStream",1),CI([RK],CC.prototype,"destroyStream",1),CI([RY],CC.prototype,"_updateVideoDescriptions",1);var Ck,Cw,CO=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},CN=function(e){hA(f,EL);var t,r,i,n,o,a,s,c,d,u,l,h,p=hI(f);function f(e,t){var r;return nK(this,f),nQ(he(r=p.call(this)),"_logger",void 0),nQ(he(r),"_subBackOff",new d9),nQ(he(r),"_subResolves",{}),nQ(he(r),"_ontrackCallbackMap",new d9),r._ctx=e,r._roomConf=t,r._logger=new mJ("RoomSubscriber",2,e.id),r}return nY(f,[{key:"subscribe",value:(h=sk(sI().mark(function e(t,r,i){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.streamState!==RA.SUB_ED){e.next=3;break}return this._logger.warn("subscribe()","remoteStream ".concat(t.streamId," has been subscribed, silently return")),e.abrupt("return");case 3:return e.abrupt("return",this._subscribe(t,r,i));case 4:case"end":return e.stop()}},e,this)})),function(e,t,r){return h.apply(this,arguments)})},{key:"_subscribe",value:(l=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P,D,L,M,x,U,B,V,F,j,G,W,H,Y,K,Q,z,X,J,q,Z,$,ee,et=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.info("subscribe()","mediaType: %o",r),RH("subscribe()",t,this._logger),t.streamState=RA.SUB_ING,b=!1,T=!1,Er(r)&&(T=!0),Ei(r)&&(b=!0),b||!this._roomConf.isMultiChatMode()){e.next=9;break}return t.streamState=RA.INIT,e.abrupt("return");case 9:if(y=v0(),R=t.subVideo,I=[],this._subResolves[t.streamId]||(this._subResolves[t.streamId]=[]),I.push(new sP(function(e,r){et._subResolves[t.streamId].push(e);var i=setTimeout(function(){return r(new pB(h6.TIME_OUT,"wait video timeout for userId: ".concat(t.userId)))},6e4);t.on("ontrack",function r(n){"video"===n.mediaType&&(et._logger.info("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(i),e(0))})})),this._roomConf.isMultiChatMode()||I.push(new sP(function(e,r){et._subResolves[t.streamId].push(e);var i=setTimeout(function(){return r(new pB(h6.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))},6e4);t.on("ontrack",function r(n){"audio"===n.mediaType&&(et._logger.info("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(i),e(0))})})),C=function(e){t.ontrack(e)},null===(n=this._ctx.handler)||void 0===n||n.on("ontrack",C),this._ontrackCallbackMap.set(t,C),k=this._ctx.handler,null!==(o=this._ctx.serverConfig)&&void 0!==o&&o.forceUniHandler||!t.enableVendorMode){e.next=28;break}return e.next=22,this._getVendorSubSdpInfo(t,C);case 22:k=(O=sq(e.sent,2))[0],w=O[1],e.next=31;break;case 28:return e.next=30,this._ctx.handler.subscribe(t,{multiChatMode:this._roomConf.isMultiChatMode()});case 30:w=e.sent;case 31:if(P=(N=w).audioMid,D=N.videoMid,t.subVideo=b,L={spatialLayer:(null==i?void 0:i.spatialLayer)||0,temporalLayer:0,spatialSubLayer:(null==i?void 0:i.spatialSubLayer)||-1},M={audio:!this._roomConf.isMultiChatMode(),video:!0,data:!0,screen:t.isScreen,browser:"chrome-stable",videoMid:D,audioMid:P,sdpInfo:{sdp:null===(a=w)||void 0===a?void 0:a.partialSdp,semantics:null===(s=w)||void 0===s?void 0:s.semantics,type:null===(c=w)||void 0===c?void 0:c.type},streamUserId:t.userId,streamId:t.streamId,config:{enableMediaType:{audio:!!this._roomConf.isMultiChatMode()||T,video:b},qualityLayer:L},extra:{enableSendRTT:!0},peerConnectionMode:null===(d=w)||void 0===d?void 0:d.peerConnectionMode,supportMultiVendor:!0},null!==(u=w)&&void 0!==u&&u.peerConnectionId&&(M.peerConnectionId=w.peerConnectionId),U=(x=this._ctx).subscribeFallbackOption,B=x.userPriority,"number"==typeof U&&(M.config.fallbackOption=U),B.has(t.userId)&&(M.config.priority=B.get(t.userId)),null!==(l=w)&&void 0!==l&&l.allSsrc&&(M.extra.subscribeSSRC=w.allSsrc),F=(V=w).signalingAck,j=V.audioTransceiverInit,G=V.videoTransceiverInit,!F){e.next=44;break}return e.next=44,new sP(function(e,r){var i;null===(i=k)||void 0===i||i.handleAck({action:Cc.subscribe,streamId:t.streamId,audioMid:P,videoMid:D,audioTransceiverInit:j,videoTransceiverInit:G,signalingAck:F,stream:t,onSuccess:function(){et._logger.info("ssrc","success"),e(0)},onFail:function(e){et._logger.info("ssrc","fail",e),r(e)}})});case 44:return e.prev=44,this.emit("_test_sub_body_",M),H=this._ctx.signalingManager.sendSignaling("subscribe",M),this.emit("_test_during_signaling_",M),e.next=50,H;case 50:W=e.sent,e.next=85;break;case 53:if(e.prev=53,e.t0=e.catch(44),t.streamState=RA.INIT,e.t0 instanceof Error&&this._roomConf.report("rtc_subscribe_stat",{result:"fail",start:y,message:e.t0.message,stream_user_id:t.userId}),!(e.t0.code>=500&&e.t0.code<600)){e.next=75;break}if(this.emit("_test_sub_5xx_"),!((K=this._getSubBackOff(t.streamId)).retryDuration<6e4)){e.next=73;break}return this._logger.info("subRetry",t.streamId,K.retryDuration),e.next=64,new sP(function(e){return setTimeout(e,K.interval)});case 64:return K.retryDuration+=K.interval,K.interval=K.interval>4e3?8e3:2*K.interval,this.emit(Rg.SUB_RETRY,{screen:t.isScreen,userId:t.userId}),e.next=69,null===(Q=k)||void 0===Q?void 0:Q.handleAck({action:Cc.unsubscribe,streamId:t.streamId,audioMid:P,videoMid:D,stream:t});case 69:return t.resetStream(),e.abrupt("return",this._subscribe(t,r,i));case 73:this._logger.info("subRetry","end",t.streamId),this._subBackOff.delete(t.streamId);case 75:return t.subVideo=R,e.next=78,null===(Y=k)||void 0===Y?void 0:Y.rollback({msid:t.streamId,stream:t});case 78:return z={roomId:this._roomConf.roomId,streamId:t.streamId,userId:t.userId},e.next=81,this._ctx.signalingManager.sendSignaling("unsubscribe",z).catch(function(){});case 81:if(t.streamState=RA.INIT,403!==e.t0.code){e.next=84;break}throw new pB(h6.TOKEN_NO_SUBSCRIBE_PERMISSION,e.t0.message||"token no subscribe permission");case 84:throw e.t0;case 85:if(W.relayMessage){e.next=88;break}throw this._roomConf.report("rtc_error",{error_code:-1009,message:"relayMessage is null"}),new pB(h6.UNEXPECTED_ERROR,"unable to subscribe");case 88:if(J=(X=null!==(h=null===(p=W)||void 0===p?void 0:p.relayMessage)&&void 0!==h?h:{}).audioMid,q=X.videoMid,nQ(f={},P,J),nQ(f,D,q),Z=f,this._logger.info("sub midmap",t.userId,Z),t.videoMid=D,t.audioMid=P,t.subMediaType=r,t.streamState=RA.SUB_ED,t.subLayer=L,this._roomConf.report("rtc_recv_answer",{error_code:0,answer_type:null===(_=W)||void 0===_||null===(A=_.relayMessage)||void 0===A?void 0:A.type,sequence_id:(null===(m=W)||void 0===m||null===(v=m.relayMessage)||void 0===v?void 0:v.sequenceId)||0,message:null===(E=W)||void 0===E||null===(g=E.relayMessage)||void 0===g?void 0:g.sdp,direction:"down",stream_id:t.streamId,stream_user_id:t.userId,pc_session_id:(null===(S=k)||void 0===S?void 0:S.peerConnectionId)||""}),e.prev=97,null!==($=w)&&void 0!==$&&$.signalingAck){e.next=101;break}return e.next=101,new sP(function(e,r){var i,n,o,a,s,c,d;null===(i=k)||void 0===i||i.handleAck({action:Cc.subscribe,streamId:t.streamId,audioMid:P,videoMid:D,audioTransceiverInit:null===(n=w)||void 0===n?void 0:n.audioTransceiverInit,videoTransceiverInit:null===(o=w)||void 0===o?void 0:o.videoTransceiverInit,signalingAck:{sdp:null===(a=W)||void 0===a||null===(s=a.relayMessage)||void 0===s?void 0:s.sdp,sequenceId:null===(c=W)||void 0===c||null===(d=c.relayMessage)||void 0===d?void 0:d.sequenceId},stream:t,onSuccess:function(){et._logger.info("sub ack","success"),e(0)},onFail:function(e){et._logger.info("sub ack","fail",e),r(e)}})});case 101:return e.next=103,sP.all(I);case 103:e.next=116;break;case 105:return e.prev=105,e.t1=e.catch(97),e.t1 instanceof Error&&this._roomConf.report("rtc_subscribe_stat",{result:"fail",start:y,message:e.t1.message,stream_user_id:t.userId}),z={roomId:this._roomConf.roomId,streamId:t.streamId,userId:t.userId},e.next=111,this._ctx.signalingManager.sendSignaling("unsubscribe",z).catch(function(){});case 111:return e.next=113,null===(ee=k)||void 0===ee?void 0:ee.handleAck({action:Cc.unsubscribe,streamId:t.streamId,audioMid:P,videoMid:D,stream:t});case 113:throw t.streamState=RA.INIT,t.resetStream(),e.t1;case 116:this._roomConf.isMultiChatMode()||(t.subAudio=T),this._roomConf.report("rtc_subscribe_stat",{result:"success",start:y,message:"unknown",stream_user_id:t.userId}),t.startReport(function(e){return et.emit("onRemoteStreamStats",e)},k);case 119:case"end":return e.stop()}},e,this,[[44,53],[97,105]])})),function(e,t,r){return l.apply(this,arguments)})},{key:"unsubscribe",value:(u=sk(sI().mark(function e(t){var r,i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return RH("unsubscribe()",t,this._logger),n={roomId:this._roomConf.roomId,streamId:t.streamId,userId:t.userId},o=t.vendorHandler||this._ctx.handler,this._ctx.signalingManager.sendSignaling("unsubscribe",n).catch(function(){}),t.streamState=RA.INIT,t.subVideo=!1,null===(r=t.observer)||void 0===r||r.setSubscribeVideo(!1),this._roomConf.isMultiChatMode()||null===(i=t.observer)||void 0===i||i.setSubscribeAudio(!1),e.next=10,null==o?void 0:o.handleAck({action:Cc.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 10:a=e.sent,this._subResolves[a]&&this._subResolves[a].forEach(function(e){return e(0)}),this._logger.info("unsubscribe","clean unsub ".concat(t.userId)),t.clean(),t.subMediaType=vP.NONE,this._removeOnTrackListener(t),t.statsReport.unsubscribe();case 17:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"unsubscribe4removeTrack",value:(d=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(RH("unsubscribe4removeTrack()",t,this._logger),this._logger.info("unsubscribe4removeTrack()","sequenceId: ",r.sequenceId,"trackType: ",i),!(r.sequenceId<t.sequenceId)){e.next=5;break}return this._logger.warn("unsubscribe4removeTrack()","sequenceId return"),e.abrupt("return");case 5:return d=!!((c=i+1)&pa.AUDIO),u=!!(c&pa.VIDEO),e.next=10,null===(n=this._ctx.handler)||void 0===n?void 0:n.handleAck({action:Cc.removetrack,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 10:null===(o=t.observer)||void 0===o||o.setPushTrack(!1),null===(a=t.observer)||void 0===a||a.setUnmuteAudio(!d),t.subAudio=!d,null===(s=t.observer)||void 0===s||s.setUnmuteVideo(!u),t.subVideo=!u,t.subMediaType=t.subMediaType-(t.subMediaType&c),t.virtual&&(t.clean(),t.resetHasSubscribed(),t.statsReport.unsubscribe());case 17:case"end":return e.stop()}},e,this)})),function(e,t,r){return d.apply(this,arguments)})},{key:"handleRemoveStream",value:(c=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(RH("handleRemoveStream()",t,this._logger),t.subVideo=!1,t.streamState!==RA.INIT){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this.unsubscribe(t));case 5:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"_removeOnTrackListener",value:function(e){var t=this._ontrackCallbackMap.get(e);if(t){var r=e.vendorHandler||this._ctx.handler;null==r||r.off("ontrack",t),this._ontrackCallbackMap.delete(e)}}},{key:"_getVendorSubSdpInfo",value:(s=sk(sI().mark(function e(t,r){var i,n,o,a=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new IG(this._ctx,""),t.vendorHandler=new CR(this._ctx,i),t.pcSessionId&&(t.vendorHandler.peerConnectionId=t.pcSessionId),(n=t.vendorHandler).on("ontrack",r),e.next=7,t.vendorHandler.subscribe(t);case 7:return o=e.sent,n.on("ice_state",function(e){a.emit(Ej.ON_VENDOR_CONNECTION_STATE_CHANGE,{state:{checking:pc.CONNECTION_STATE_CONNECTING,connected:pc.CONNECTION_STATE_CONNECTED,disconnected:pc.CONNECTION_STATE_RECONNECTING}[e],userId:t.userId})}),n.once("disconnect",sk(sI().mark(function e(){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n||n.removeAllListeners(),"connected"===(null===(r=a._ctx.peerConnection)||void 0===r?void 0:r.getIceConnectionState())){e.next=4;break}return a._logger.info("vendor ice failed",t.streamId),e.abrupt("return");case 4:return i=t.subMediaType,e.next=7,a.unsubscribe(t);case 7:return e.next=9,a.subscribe(t,i);case 9:t.vendorHandler&&t.statsReport.setVar(t.vendorHandler),a.emit(Rg.RESUBSCRIBE,{stream:t});case 11:case"end":return e.stop()}},e)}))),e.abrupt("return",[n,o]);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"subscribe4pushTrack",value:(a=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("subscribe4pushTrack()","streamInfo: %o",r),RH("subscribe4pushTrack()",t,this._logger),t.subAudio=!0,e.next=5,null===(i=this._ctx.handler)||void 0===i?void 0:i.subscribe(t,{multiChatMode:this._roomConf.isMultiChatMode()});case 5:if(a=e.sent){e.next=8;break}throw new pB(h6.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 8:return s=a.audioMid,c=a.videoMid,(d=[]).push(new sP(function(e,r){var i=setTimeout(function(){return r(new pB(h6.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))},6e4);t.on("ontrack",function r(n){"audio"===n.mediaType&&(l._logger.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(i),e(0))})})),u=function(e){t.ontrack(e)},null===(n=this._ctx.handler)||void 0===n||n.on("ontrack",u),this._ontrackCallbackMap.set(t,u),e.next=17,null===(o=this._ctx.handler)||void 0===o?void 0:o.handleAck({action:Cc.pushtrack,streamId:t.streamId,audioMid:s,videoMid:c,stream:t,audioTransceiverInit:null==a?void 0:a.audioTransceiverInit,videoTransceiverInit:null==a?void 0:a.videoTransceiverInit,signalingAck:null==r?void 0:r.message});case 17:return e.next=19,sP.all(d);case 19:t.startReport(function(e){return l.emit("onRemoteStreamStats",e)},this._ctx.handler);case 20:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"updateUserAttributes",value:(o=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("updateUserAttributes()","attributes: %o",t),e.next=3,this._ctx.signalingManager.sendSignaling("updateUserAttributes",{roomId:this._roomConf.roomId,sessionId:this._roomConf.sessionId,attributes:t});case 3:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"updateSubTrackLayer",value:(n=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.info("updateSubTrack()","subLayer: %o",r),t.subLayer.spatialLayer!==r.spatialLayer||t.subLayer.spatialSubLayer!==r.spatialSubLayer){e.next=4;break}return this._logger.warn("updateSubTrack()","subLayer no change"),e.abrupt("return");case 4:return i={roomId:this._roomConf.roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{qualityLayer:r}},e.next=7,this._ctx.signalingManager.sendSignaling("updateSubscribe",i);case 7:return this.emit("___afterUpdateSubscribeSend"),t.subLayer=r,e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"updateSubPriority",value:(i=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.info("updateSubPriority()","priority: %o",r),t.priority!==r){e.next=4;break}return this._logger.warn("updateSubPriority()","priority no change"),e.abrupt("return",t);case 4:return i={roomId:this._roomConf.roomId,streamList:[t.streamId],streamId:t.streamId,streamUserId:t.userId,config:{priority:r}},e.next=7,this._ctx.signalingManager.sendSignaling("updateSubscribe",i);case 7:return t.priority=r,e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"updateSubMediaType",value:(r=sk(sI().mark(function e(t,r){var i,n,o,a,s;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!1,o=!1,Er(r)&&(o=!0),Ei(r)&&(n=!0),a={roomId:this._roomConf.roomId,streamList:[t.streamId],config:{enableMediaType:{video:n,audio:!!this._roomConf.isMultiChatMode()||o}}},e.next=6,this._ctx.signalingManager.sendSignaling("updateSubscribe",a);case 6:return this._roomConf.isMultiChatMode()||(null===(s=t.observer)||void 0===s||s.setUnmuteAudio(o),t.subAudio=o),null===(i=t.observer)||void 0===i||i.setUnmuteVideo(n),t.subVideo=n,t.subMediaType=r,e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"cleanStream",value:(t=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._logger.info("cleanStream()","stream: %o",t),null==t||t.clean();case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"destroyStream",value:function(e){this._logger.info("destroyStream()","stream: %o",e),null==e||e.destroy()}},{key:"destroy",value:function(e){var t,r=this;this._logger.info("destroy()","remoteStream: %o",e),e.forEach(function(e){e.forEach(function(e){r.unsubscribe(e),r.destroyStream(e)})}),this._subBackOff.clear(),this._ontrackCallbackMap.forEach(function(e,t){r._removeOnTrackListener(t),r._ontrackCallbackMap.delete(t)}),this._subResolves={},null===(t=this._ctx.handler)||void 0===t||t.removeAllListeners("ontrack"),hf(hp(f.prototype),"removeAllListeners",this).call(this)}},{key:"_getSubBackOff",value:function(e){return this._subBackOff.has(e)||this._subBackOff.set(e,{interval:1e3,retryDuration:0}),this._subBackOff.get(e)}}]),f}();CO([RK,CT,RY],CN.prototype,"subscribe",1),CO([RK,CT,RY],CN.prototype,"unsubscribe",1),CO([RK,CT,RY],CN.prototype,"unsubscribe4removeTrack",1),CO([RY],CN.prototype,"handleRemoveStream",1),CO([RK,CT,RY],CN.prototype,"subscribe4pushTrack",1),CO([RK,RY],CN.prototype,"updateUserAttributes",1),CO([RK,RY],CN.prototype,"updateSubTrackLayer",1),CO([RK,RY],CN.prototype,"updateSubPriority",1),CO([RK],CN.prototype,"updateSubMediaType",1),CO([RK],CN.prototype,"cleanStream",1),CO([RK],CN.prototype,"destroyStream",1);var CP=(nQ(Cw={},pb.communication,[0]),nQ(Cw,pb.chat,[0]),nQ(Cw,pb.chatRoom,[1,"IES_chatroom"]),nQ(Cw,pb.coHost,[1,"IES_PK"]),nQ(Cw,pb.meeting,[16]),nQ(Cw,pb.classRoom,[0]),Cw),CD=function(e){hA(a,EL);var t,r,i,n,o=hI(a);function a(e,t){var r;return nK(this,a),nQ(he(r=o.call(this)),"_logger",void 0),nQ(he(r),"_authorization",void 0),nQ(he(r),"_joinRoom5xxTimer",void 0),nQ(he(r),"_joinTask",void 0),nQ(he(r),"_sdpInfo",void 0),r._ctx=e,r._roomConf=t,r._logger=new mJ("RoomJoin",2,e.id),r._logger.info("constructor","invoke"),r}return nY(a,[{key:"join",value:function(){var e,t,r=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._logger.info("join()");var n=new sP(function(n,o){e=n,t=o,r._callJoinRoom(i).catch(function(e){var t=Array.isArray(e)&&e.length>0?e[0]:e;r._joinRoomFailed(t.message)})});return this._joinTask&&i?this._joinTask.startTime=v0():(this._joinTask={startTime:v0(),success:e,fail:t},this._roomConf.joinPromise=n),this._reportJoinRoomStart(),n}},{key:"updateToken",value:(n=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.info("updateToken()","newToken: %o",t),this._ctx.appId&&this._roomConf.userId&&this._roomConf.roomId){e.next=3;break}return e.abrupt("return");case 3:return r={roomId:this._roomConf.roomId,userId:this._roomConf.userId,appId:this._ctx.appId,token:"Bearer ".concat(t)},e.prev=4,e.next=7,this._ctx.signalingManager.sendSignaling("updateToken",r);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),new pB(h6.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 12:case"end":return e.stop()}},e,this,[[4,9]])})),function(e){return n.apply(this,arguments)})},{key:"leave",value:(i=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("leave()"),this._stopJoinRoom5xxRetry(),this._joinRoomFailed("leave_room"),t={Authorization:this._authorization,roomId:this._roomConf.roomId,sessionId:this._roomConf.sessionId},e.next=6,this._ready2join();case 6:if(!this._ctx.signalingManager.isConnected()){e.next=11;break}return e.next=9,this._ctx.signalingManager.sendSignaling("leaveRoom",t);case 9:e.next=12;break;case 11:return e.abrupt("return",sP.reject(new pB(h6.NOT_CONNECTED_YET,"server not connected")));case 12:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"destroy",value:function(){this._logger.info("destroy()"),this._joinRoomFailed("leave_room"),this._authorization=void 0,this._stopJoinRoom5xxRetry(),this.removeAllListeners()}},{key:"_ready2join",value:(r=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.signalingManager.connect();case 2:if(this._sdpInfo){e.next=6;break}return e.next=5,null===(t=this._ctx.handler)||void 0===t?void 0:t.getDefaultSdp();case 5:this._sdpInfo=e.sent;case 6:if(a.supportedCodecs){e.next=10;break}return e.next=9,E0();case 9:a.supportedCodecs=e.sent;case 10:return e.abrupt("return",{sdpInfo:this._sdpInfo,supportedCodecs:a.supportedCodecs});case 11:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"_callJoinRoom",value:(t=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P,D,L,M=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("_callJoinRoom","invoke"),delete this._sdpInfo,n=(i=this._ctx).appId,o=i.role,a=i.businessId,s=i.useCloudProxy,c=i.joinRoomParams,d=i.mediaParams,e.next=5,this._ready2join();case 5:if(l=(u=e.sent).sdpInfo,h=u.supportedCodecs,p={Authorization:v1.token2auth(n,this._roomConf.roomId,this._roomConf.userId,this._roomConf.token),sessionId:this._roomConf.sessionId,timestamp:Date.now(),controlMessage:this._roomConf.getLiveControlMessage(),userAttributes:{extra_info:this._roomConf.userInfo.extraInfo,role:o},sdpInfo:l,params:{supportedCodecs:h,deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:vx.VERSION,deviceId:vw.getDeviceId(),appId:n,roomId:this._roomConf.roomId,userId:this._roomConf.userId,businessId:a,enableCloudProxy:s,channelProfile:CP[this._roomConf.roomProfileType]?"".concat(CP[this._roomConf.roomProfileType][0]):"0",SDKCodecNegotiation:vB("SDK_CODEC_NEGOTIATION")},options:{supportCheckTokenPrivilege:!0,supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0}},c)for(f=0,_=cb(c);f<_.length;f++)m=(A=sq(_[f],2))[0],v=A[1],p.params[m]=v;return d&&(p.mediaParams=d),vB("SIGNAL_CROP_JOINROOM")&&null!==(r=p.sdpInfo)&&void 0!==r&&r.sdp&&(p.sdpInfo.sdp=IN(p.sdpInfo.sdp)),sP.resolve().then(function(){return M.emit("onSendingJoinMessageHook")}),e.prev=14,I=t?"reconnected":"joinRoom",e.next=18,this._joinRoomWithRetry(I,p);case 18:C=e.sent,this._logger.success("join","send join message success"),w=(k=C.config||{}).engine_WEB,O=k._abtest_vid,this._authorization=p.Authorization,vw.setEngineWebConfig(this._ctx.appId,this._roomConf.roomId,w),this._ctx.serverConfig={videoCodec:null==w?void 0:w.video_codec,audioRed:!(null==w||!w.pub_audio_red),muteReplaceUnsub:!(null===(E=C.config)||void 0===E||!E.mute_replace_unsub),simulcastOnDemand:!1!==(null===(g=C.config)||void 0===g||null===(S=g.engine_VPM)||void 0===S||null===(b=S.ondemand)||void 0===b?void 0:b.enable),forceUniHandler:1===(null===(T=C.config)||void 0===T||null===(y=T.vendor_param)||void 0===y?void 0:y.vendor_stream_sub_mode),e2eFeedback:null==w?void 0:w.e2e_feedback},vB("SDK_CODEC_NEGOTIATION")&&(this._ctx.targetCodec=null===(N=C.config)||void 0===N?void 0:N.targetCodec,this._ctx.targetScreenCodec=null===(P=C.config)||void 0===P?void 0:P.targetScreenCodec),"boolean"==typeof(null==w?void 0:w.av_sync)&&(this._ctx.avSync=w.av_sync),this._roomConf.rtcVid=O,C.vendorConfig&&this._roomConf.setVendorConfig(C.vendorConfig),yo.setAudioStallConfig(w),null!==(R=C.relayMessage)&&void 0!==R&&R.sdp&&(null===(D=this._ctx.handler)||void 0===D||D.createAVMlineAnswerTpl(C.relayMessage.sdp)),this.emit(Rg.JOIN_SUCCESS,{joinRes:C,reconnect:t}),this._joinRoomSuccess(C),e.next=38;break;case 34:e.prev=34,e.t0=e.catch(14),L={461:h6.ROOM_FORBIDDEN,462:h6.USER_FORBIDDEN},(null===e.t0||void 0===e.t0?void 0:e.t0.code)>=700&&(null===e.t0||void 0===e.t0?void 0:e.t0.code)<800?this._joinRoomFailed("token_error",h6.INVALID_TOKEN):L[null===e.t0||void 0===e.t0?void 0:e.t0.code]?this._joinRoomFailed((null===e.t0||void 0===e.t0?void 0:e.t0.message)||L[null===e.t0||void 0===e.t0?void 0:e.t0.code],L[null===e.t0||void 0===e.t0?void 0:e.t0.code]):(null===e.t0||void 0===e.t0?void 0:e.t0.code)===h6.TIME_OUT&&this._ctx.joinRoomConfig.useTcpAfterJoinTimeout?(this._logger.error("join",IZ.JOIN_TIMEOUT),this.safeEmit(Rg.ON_REJOIN_WITH_TCP),this._ctx.signalingManager.reconnect(IZ.JOIN_TIMEOUT,!0)):e.t0.code===h6.OPERATION_CANCEL&&this._ctx.signalingManager.isReconnecting()||this._joinRoomFailed((null===e.t0||void 0===e.t0?void 0:e.t0.message)||"signaling_error");case 38:case"end":return e.stop()}},e,this,[[14,34]])})),function(e){return t.apply(this,arguments)})},{key:"_joinRoomWithRetry",value:function(e,t,r){var i=this;return new sP(function(n,o){i._ctx.signalingManager.sendSignaling(e,t,void 0,1e4).then(function(e){i.emit("onJoinRoomAck",e),n(e)}).catch(function(a){if(r=r||new R5,a.code>=500&&a.code<600&&v0()-r.initTs<6e4){var s,c=r.getRetryDelay();return i._logger.warn("_joinRoomWithRetry",sN(s="joinRoom failed(code: ".concat(a.code,"), will retry after ")).call(s,c,"ms")),void(i._joinRoom5xxTimer=setTimeout(function(){delete i._joinRoom5xxTimer,i._joinRoomWithRetry(e,t,r).then(n).catch(o)},c))}o(a)})})}},{key:"_stopJoinRoom5xxRetry",value:function(){this._joinRoom5xxTimer&&(clearTimeout(this._joinRoom5xxTimer),delete this._joinRoom5xxTimer)}},{key:"_reportJoinRoomStart",value:function(){this._joinTask&&(this.emit("__joinRoomStartReport"),this._roomConf.report("join_room",{type:"begin",start:this._joinTask.startTime,result:!1,reason:""},{enable_cloud_proxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC}))}},{key:"_joinRoomSuccess",value:function(e){this._joinTask&&(this._joinTask.success(e),this.emit("__joinRoomSuccessReport"),this._roomConf.report("join_room",{type:"end",start:this._joinTask.startTime,result:!0,reason:""},{enable_cloud_proxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC}),this._roomConf.report("rtc_join_room",{error_code:0,deviceModel:"web",deviceManufacturer:"web",elapse:v0()-this._joinTask.startTime}),delete this._joinTask,delete this._roomConf.joinPromise)}},{key:"_joinRoomFailed",value:function(e,t){this._joinTask&&(this._joinTask.fail(new pB(t||h6.JOIN_ROOM_FAILED,e)),this.emit("__joinRoomFailedReport"),this._roomConf.report("join_room",{type:"end",start:this._joinTask.startTime,result:!1,reason:e},{enable_cloud_proxy:this._ctx.useCloudProxy,expectedIDC:this._ctx.expectedIDC}),delete this._joinTask,delete this._roomConf.joinPromise)}}]),a}();nQ(CD,"supportedCodecs",void 0);var CL=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},CM=function(){var e,t;function r(e,t){nK(this,r),nQ(this,"_logger",void 0),this._ctx=e,this._roomConf=t,this._logger=new mJ("RoomMessage",2,e.id)}return nY(r,[{key:"sendUserMessage",value:function(e,t){return this._ctx.signalingManager.sendP2PMessage({to:e,from:this._roomConf.userId,room:this._roomConf.roomId,app:this._ctx.appId,msg:t})}},{key:"sendRoomMessage",value:(t=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i={clientId:this._roomConf.userId,binary:r,message:"",roomId:this._roomConf.roomId},!r){e.next=7;break}return e.next=4,v1.ab2b64str(t);case 4:i.message=e.sent,e.next=8;break;case 7:i.message=t;case 8:return e.abrupt("return",this._ctx.signalingManager.sendSignaling("customMessage",i));case 9:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"controlMessage",value:(e=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.info("controlMessage()","params: %o",t),r=t,"transcode"===t.type&&(r.roomId=this._roomConf.roomId),e.next=5,this._ctx.signalingManager.sendSignaling("controlMessage",r);case 5:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})}]),r}();CL([RY],CM.prototype,"sendUserMessage",1),CL([RY],CM.prototype,"sendRoomMessage",1),CL([RY],CM.prototype,"controlMessage",1);var Cx=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},CU={audiostream:!0,extaudio:!1,extvideo:!1,localaudio:!0,localvideo:!1,videoDescriptions:[],videostream:!1,publishTime:0},CB=function(e){hA(P,EL);var t,r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N=hI(P);function P(e,t){var r;return nK(this,P),nQ(he(r=N.call(this)),"_localStream",void 0),nQ(he(r),"_localScreenStream",void 0),nQ(he(r),"_remoteUsers",new d9),nQ(he(r),"_remoteStreams",new d9),nQ(he(r),"_remoteStreamStreamIdUserIdMap",{}),nQ(he(r),"_virtualStreams",[]),nQ(he(r),"_serverConfig",void 0),nQ(he(r),"_userDuplicateLoginTimerMap",new d9),nQ(he(r),"_networkQualityManager",void 0),nQ(he(r),"_videoSizeObserver",void 0),nQ(he(r),"_hasPublished",!1),nQ(he(r),"_subtitleTool",void 0),nQ(he(r),"_csrcUserIdMap",{}),nQ(he(r),"_publishOnDemandItem",void 0),nQ(he(r),"_onceTriggerBySignal",!1),nQ(he(r),"_pubTransceiverReady",!1),nQ(he(r),"_publishOnDemandBusy",!1),nQ(he(r),"logger",void 0),nQ(he(r),"_forwardStreamManager",void 0),nQ(he(r),"_publisher",void 0),nQ(he(r),"_subscriber",void 0),nQ(he(r),"_roomJoin",void 0),nQ(he(r),"_roomMessage",void 0),nQ(he(r),"_clearSignalListeners",void 0),r.config=e,r._ctx=t,r.logger=new mJ("Room",1,t.id),r.logger.info("constructor","invoke"),r._publisher=new CC(t,e),r._addPublisherListeners(),r._subscriber=new CN(t,e),r._addSubscriberListeners(),r._roomJoin=new CD(t,e),r._addJoinRoomHandler(),r._forwardStreamManager=new Rz(t,e),r._addForwardStreamListeners(),r._roomMessage=new CM(t,e),r._networkQualityManager=new Rk(t),r._networkQualityManager.reportor=r._reportNetworkQuality.bind(he(r)),r._videoSizeObserver=new Rw(he(r)),r._videoSizeObserver.onchange=r._emitVideoSizeChange.bind(he(r)),r._addSignalListeners(),r}return nY(P,[{key:"hasScreenPublished",get:function(){var e;return null===(e=this._localScreenStream)||void 0===e?void 0:e.hasPublished}},{key:"hasPublished",get:function(){var e;return!(null===(e=this._localStream)||void 0===e||!e.hasPublished)}},{key:"remoteUsers",get:function(){return this._remoteUsers}},{key:"remoteStreams",get:function(){return this._remoteStreams}},{key:"localStream",get:function(){return this._localStream}},{key:"localScreenStream",get:function(){return this._localScreenStream}},{key:"virtualStreams",get:function(){return this._virtualStreams}},{key:"_addSignalListeners",value:function(){var e,t=this,r=(nQ(e={},EV.ON_ADD_STREAM,this._onAddStream.bind(this)),nQ(e,EV.ON_ADD_STREAM_LIST,function(e){e&&Array.isArray(e.streamList)&&e.streamList.forEach(function(e){return t._onAddStream(e)})}),nQ(e,EV.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),nQ(e,EV.ON_REMOVE_STREAM_LIST,function(e){e&&Array.isArray(e.streamList)&&e.streamList.forEach(function(e){return t._onRemoveStream(e)})}),nQ(e,EV.USER_CONNECTION,this._onUserConnection.bind(this)),nQ(e,EV.USER_CONNECTION_LIST,function(e){e&&Array.isArray(e.userList)&&e.userList.forEach(function(e){return t._onUserConnection(e)})}),nQ(e,EV.USER_DISCONNECTION,this._onUserDisconnection.bind(this)),nQ(e,EV.USER_DISCONNECTION_LIST,function(e){e&&Array.isArray(e.userList)&&e.userList.forEach(function(e){return t._onUserDisconnection(e)})}),nQ(e,EV.ON_UPDATE_ROOM_ATTRIBUTES,this._onUpdateRoomAttributes.bind(this)),nQ(e,EV.ON_UPDATE_USER_ATTRIBUTES,this._onUpdateUserAttributes.bind(this)),nQ(e,EV.ON_UPDATE_STREAM_ATTRIBUTES,this._onUpdateStreamAttributes.bind(this)),nQ(e,EV.ON_PUSH_TRACK,this._onPushTrack.bind(this)),nQ(e,EV.ON_REMOVE_TRACK,this._onRemoveTrack.bind(this)),nQ(e,EV.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),nQ(e,EV.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),nQ(e,EV.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),nQ(e,EV.POST_PROCESSING_MESSAGE,this._onPostProcessingMessage.bind(this)),nQ(e,EV.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),nQ(e,EV.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE,this._onUserTokePublishPrivilegeWillExpire.bind(this)),nQ(e,EV.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED,this._onUserTokenPublishPrivilegeDidExpire.bind(this)),nQ(e,EV.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE,this._onUserTokeSubscribePrivilegeWillExpire.bind(this)),nQ(e,EV.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED,this._onUserTokenSubscribePrivilegeDidExpire.bind(this)),nQ(e,EV.STREAM_CONTROL_MESSAGE,this._onStreamControlMessage.bind(this)),nQ(e,EV.ENGINE_CONTROL_MESSAGE,this._onEngineControlMessage.bind(this)),nQ(e,EV.ON_STREAM_FAILED,this._onStreamFailed.bind(this)),nQ(e,EF.RTT,this._onRTT.bind(this)),nQ(e,EF.SSC,this._onSSC.bind(this)),nQ(e,Ej.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),nQ(e,EV.ON_SPEAKER_CHANGE,this._onMeetingSpeakerChange.bind(this)),nQ(e,EV.ON_FORWARD_DST_ROOM_USER_KICK,this._forwardStreamManager.onForwardDstRoomUserKick.bind(this._forwardStreamManager)),nQ(e,EF.RSCP,this._onRSCP.bind(this)),e);cG(r).forEach(function(e){t._ctx.signalingManager.on(e,r[e])}),this._clearSignalListeners=function(){cG(r).forEach(function(e){t._ctx.signalingManager.off(e,r[e])})}}},{key:"_addPublisherListeners",value:function(){var e=this;this._publisher.on(Rg.PUB_RETRY,function(t){e.emit(Rg.PUB_RETRY,t)}),this._publisher.on(EF.RSCP,this._onRSCP.bind(this)),this._publisher.on(Ej.ON_VENDOR_CONNECTION_STATE_CHANGE,function(t){return e.emit(Ej.ON_VENDOR_CONNECTION_STATE_CHANGE,t)})}},{key:"_addSubscriberListeners",value:function(){var e=this;this._subscriber.on(Ej.ON_VENDOR_CONNECTION_STATE_CHANGE,function(t){return e.emit(Ej.ON_VENDOR_CONNECTION_STATE_CHANGE,t)}),this._subscriber.on("onRemoteStreamStats",function(t){e._networkQualityManager.updateDownlinkStats(t,e._findRemoteStreamByScreen(t.userId,t.isScreen)),vB("HIDDEN_STATS")||(t=En(t)),e.emit(Rg.ON_REMOTE_STREAM_STATS,t)}),this._subscriber.on(Rg.RESUBSCRIBE,function(t){e.emit(Rg.RESUBSCRIBE,t)}),this._subscriber.on(Rg.SUB_RETRY,function(t){e.emit(Rg.SUB_RETRY,t)})}},{key:"_addJoinRoomHandler",value:function(){var e=this;this._roomJoin.on(Rg.JOIN_SUCCESS,this._onJoinSucc.bind(this)),this._roomJoin.on(Rg.ON_REJOIN_WITH_TCP,function(){e.emit(Rg.ON_REJOIN_WITH_TCP)})}},{key:"_addForwardStreamListeners",value:function(){var e=this;this._forwardStreamManager.on(Rg.ON_FORWARD_STREAM_ERROR,function(t){e.safeEmit(Rg.ON_FORWARD_STREAM_ERROR,t)})}},{key:"_onLocalStreamStats",value:function(e){var t=e.isScreen?this._localScreenStream:this.localStream;this._networkQualityManager.updateUplinkStats(e,t),vB("HIDDEN_STATS")||(e=En(e)),this.emit(Rg.ON_LOCAL_STREAM_STATS,e)}},{key:"join",value:(O=sk(sI().mark(function e(){var t,r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("join()"),this.config.startJoinTimestamp=v0(),e.prev=2,e.next=5,this._roomJoin.join();case 5:return null!==(t=(r=e.sent).roomAttributes)&&void 0!==t&&t.multiChatMode&&this._handleFFAudioTrack(),this._initSubtitleTool(),e.abrupt("return",{users:r.clients,streams:r.streams});case 11:if(e.prev=11,e.t0=e.catch(2),e.t0.code===h6.OPERATION_CANCEL){e.next=15;break}throw e.t0;case 15:case"end":return e.stop()}},e,this,[[2,11]])})),function(){return O.apply(this,arguments)})},{key:"publishScreen",value:(w=sk(sI().mark(function e(t,r,i,n){var o,a,s,c,d,u,l,h,p;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishScreen()"),this._localScreenStream||(this._localScreenStream=new Rm(this._ctx,po.STREAM_INDEX_SCREEN),this.config.vendorConfig.enableMultiVendor&&(this._localScreenStream.pcSessionId=f2()),this._localScreenStream.isScreen=!0,this._localScreenStream.observer=new RI(this._ctx,this._localScreenStream)),o=!1,a=!1,s=!1,c=!1,!this._localScreenStream.videoTrack&&t?(t.sourceType===EY.EXTERNAL&&(a=!0),o=!0):this._localScreenStream.videoTrack&&!t&&(o=!1),!this._localScreenStream.audioTrack&&r?(r.sourceType===EY.EXTERNAL&&(c=!0),s=!0):this._localScreenStream.audioTrack&&!r&&(s=!1),this._localScreenStream.videoTrack=t,this._localScreenStream.audioTrack=r,i&&(Er(i)&&(this._localScreenStream.pubAudio=n===Rb.PUB),Ei(i)&&(this._localScreenStream.pubVideo=n===Rb.PUB),this.logger.info("publishScreen mediaType","pubAudio: %o, pubVideo: %o",this._localScreenStream.pubAudio,this._localScreenStream.pubVideo)),this._localScreenStream.pubAudio||this._localScreenStream.pubVideo){e.next=17;break}if(!this._localScreenStream.hasPublished){e.next=16;break}return e.abrupt("return",this.unpublishScreen());case 16:return e.abrupt("return");case 17:if(this._localScreenStream.hasPublished){e.next=23;break}return null===(d=this._localScreenStream.observer)||void 0===d||d.setPublish(!0),e.next=21,this._publisher.publish(this._localScreenStream);case 21:e.next=27;break;case 23:return a?null===(u=this._localScreenStream.observer)||void 0===u||u.setPushVideo(o):null===(l=this._localScreenStream.observer)||void 0===l||l.setEnableVideo(o),c?null===(h=this._localScreenStream.observer)||void 0===h||h.setPushAudio(s):null===(p=this._localScreenStream.observer)||void 0===p||p.setEnableAudio(s),e.next=27,this.updatePubScreenTrack();case 27:this._localScreenStream.pubAudio||this._localScreenStream.pubVideo?this._ctx.handler&&this._localScreenStream.startReport(this._onLocalStreamStats.bind(this),this._localScreenStream.vendorHandler||this._ctx.handler):this._localScreenStream.stopReport("unpublish screen");case 28:case"end":return e.stop()}},e,this)})),function(e,t,r,i){return w.apply(this,arguments)})},{key:"updatePubScreenTrack",value:(k=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updatePubScreenTrack","Invoke updatePubScreenTrack"),!this._localScreenStream){e.next=4;break}return e.next=4,this._publisher.updatePubTrack(this._localScreenStream);case 4:case"end":return e.stop()}},e,this)})),function(){return k.apply(this,arguments)})},{key:"unpublishScreen",value:(C=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublish","Invoke unpublishScreen"),!this._localScreenStream){e.next=9;break}return null===(t=this._localScreenStream.observer)||void 0===t||t.setPublish(!1),e.next=5,this._publisher.unpublish(this._localScreenStream);case 5:return this._localScreenStream.stopReport("unpublish screen"),e.next=8,this._publisher.cleanStream(this._localScreenStream);case 8:this._localScreenStream=void 0;case 9:case"end":return e.stop()}},e,this)})),function(){return C.apply(this,arguments)})},{key:"liveControlMessage",value:(I=sk(sI().mark(function e(t){var r,i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("controlMessage","Invoke controlMessage"),null===(r=t.transcodeMeta)||void 0===r||r.layout.regions.forEach(function(e){e.roomID=i.config.roomId}),this.config.setLiveControlMessage("stopped"===t.action?void 0:t),e.prev=3,e.next=6,this._roomMessage.controlMessage(t);case 6:e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(3),"stopped"===t.action){e.next=12;break}throw e.t0;case 12:case"end":return e.stop()}},e,this,[[3,8]])})),function(e){return I.apply(this,arguments)})},{key:"publicStreamControlMessage",value:(R=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"stopped"===t.action&&delete t.publicStreamMeta,e.next=3,this._roomMessage.controlMessage(t);case 3:case"end":return e.stop()}},e,this)})),function(e){return R.apply(this,arguments)})},{key:"getLocalStreamStats",value:(y=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.localStream)||void 0===t?void 0:t.getLocalStreamStats();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"updateUserAttributes",value:(T=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateUserAttributes","Invoke updateUserAttributes"),e.next=3,this._subscriber.updateUserAttributes({role:this._ctx.role});case 3:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})},{key:"publish",value:(b=sk(sI().mark(function e(t,r,i,n){var o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=b.length>4&&void 0!==b[4]&&b[4],this.logger.info("publish","Invoke publish"),a=!1,this._localStream||(this._localStream=new Rm(this._ctx),this.config.vendorConfig.enableMultiVendor&&(this._localStream.pcSessionId=f2()),this._localStream.observer=new RI(this._ctx,this._localStream),a=!0,this._localStream.vendorCode=this.config.vendorConfig.vendorCode||0),this._localStream.videoTrack=t,this._localStream.audioTrack=r,c=(s=this._localStream).pubAudio,d=s.pubVideo,i&&(Er(i)&&(this._localStream.pubAudio=n===Rb.PUB),Ei(i)&&(this._localStream.pubVideo=n===Rb.PUB),this.logger.info("publish mediaType","pubAudio: %o, pubVideo: %o",this._localStream.pubAudio,this._localStream.pubVideo)),this._localStream.hasPublished){e.next=27;break}if(this._localStream.pubAudio||this._localStream.pubVideo){e.next=11;break}return e.abrupt("return");case 11:return e.prev=11,o?null===(u=this._localStream.observer)||void 0===u||u.setLogin(!0):a&&(p=!!this._localStream.videoTrack,f=!!this._localStream.audioTrack,_=(null===(l=this._localStream.videoTrack)||void 0===l?void 0:l.sourceType)===EY.EXTERNAL,A=(null===(h=this._localStream.audioTrack)||void 0===h?void 0:h.sourceType)===EY.EXTERNAL,this.config.isAutoPublish&&!this._hasPublished?(p&&(_?null===(m=this._localStream.observer)||void 0===m||m.setPushVideo(!0):null===(v=this._localStream.observer)||void 0===v||v.setEnableVideo(!0)),f&&(A?null===(E=this._localStream.observer)||void 0===E||E.setPushAudio(!0):null===(g=this._localStream.observer)||void 0===g||g.setEnableAudio(!0))):null===(S=this._localStream.observer)||void 0===S||S.setPublish(!0)),this.emit("___onMediaServerClientPublish"),e.next=16,this._publisher.publish(this._localStream);case 16:this._hasPublished=!0,this.emit(Rg.ON_PUBLISH_RESULT,{isScreen:!1,state:pr.PUBLISH_SUCC}),e.next=25;break;case 20:throw e.prev=20,e.t0=e.catch(11),this.emit(Rg.ON_PUBLISH_RESULT,{isScreen:!1,state:pr.PUBLISH_FAIL,errorCode:e.t0.code}),delete this._localStream,e.t0;case 25:case 31:e.next=38;break;case 27:return e.prev=27,this.emit("___onMediaServerClientPublish"),e.next=31,this.updatePubTrack();case 33:throw e.prev=33,e.t1=e.catch(27),this._localStream.pubAudio=c,this._localStream.pubVideo=d,e.t1;case 38:this._localStream.pubAudio||this._localStream.pubVideo?this._ctx.handler&&this._localStream.startReport(this._onLocalStreamStats.bind(this),this._localStream.vendorHandler||this._ctx.handler):this._localStream.stopReport("unpublish");case 39:case"end":return e.stop()}},e,this,[[11,20],[27,33]])})),function(e,t,r,i){return b.apply(this,arguments)})},{key:"updatePubTrack",value:(S=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updatePubTrack","Invoke updatePubTrack"),!this._localStream){e.next=4;break}return e.next=4,this._publisher.updatePubTrack(this._localStream);case 4:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})},{key:"unpublish",value:(g=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublish","Invoke unpublish"),!this._localStream){e.next=8;break}return e.next=4,this._publisher.unpublish(this._localStream);case 4:return this._localStream.stopReport("unpublish"),e.next=7,this._publisher.cleanStream(this._localStream);case 7:this._localStream=void 0;case 8:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"subscribe",value:(E=sk(sI().mark(function e(t,r){var i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("subscribe","remoteStream %o",t),t.streamState===RA.INIT){e.next=8;break}if((i=t.subMediaType|r)===t.subMediaType){e.next=7;break}return e.next=6,this._subscriber.updateSubMediaType(t,i);case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return");case 8:return n=this._ctx.videoProfile.getSubLayer(t,this.config.remoteVideoConfig),e.next=11,this._subscriber.subscribe(t,r,n);case 11:case"end":return e.stop()}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"updateSubVideoConfig",value:(v=sk(sI().mark(function e(t){var r,i,n,o;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._findRemoteStreamByScreen(t,!1),this.logger.info("updateSubVideoConfig","userId %s",t),null!=n&&n.hasSubscribed&&!((null===(r=n.attributes)||void 0===r||null===(i=r.videoDescriptions)||void 0===i?void 0:i.length)<=1)){e.next=4;break}return e.abrupt("return");case 4:if(!(o=this._ctx.videoProfile.getSubLayer(n))){e.next=8;break}return n.originalStreamIndex=o.spatialLayer,e.abrupt("return",this._subscriber.updateSubTrackLayer(n,o));case 8:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"unsubscribe",value:(m=sk(sI().mark(function e(t,r){var i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unsubscribe","Invoke unsubscribe"),t.hasSubscribed){e.next=3;break}return e.abrupt("return");case 3:if(n=t.subMediaType-(t.subMediaType&r),null!==(i=this._ctx.serverConfig)&&void 0!==i&&i.muteReplaceUnsub||!(n===vP.NONE||this.config.isMultiChatMode()&&n===pa.AUDIO)){e.next=8;break}return e.next=7,this._subscriber.unsubscribe(t);case 7:return e.abrupt("return",e.sent);case 8:return e.next=10,this._subscriber.updateSubMediaType(t,n);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"startSubtitle",value:(A=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._subtitleTool){e.next=5;break}return e.next=3,this._subtitleTool.start(t);case 3:e.next=6;break;case 5:throw new pB(h6.INVOKED_BEFORE_JOIN_ROOM,"join first");case 6:case"end":return e.stop()}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"updateSubtitleConfig",value:(_=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._subtitleTool){e.next=5;break}return e.next=3,this._subtitleTool.update(t);case 3:e.next=6;break;case 5:throw new pB(h6.INVOKED_BEFORE_JOIN_ROOM,"join first");case 6:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"stopSubtitle",value:(f=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=this._subtitleTool)||void 0===t||t.stop();case 1:case"end":return e.stop()}},e,this)})),function(){return f.apply(this,arguments)})},{key:"startForwardStream2Rooms",value:(p=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.startForwardStream2Rooms(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"updateForwardStream2Rooms",value:(h=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.updateForwardStream2Rooms(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"stopForwardStream2Rooms",value:(l=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.stopForwardStream2Rooms());case 1:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"pauseForwardStream2AllRooms",value:(u=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.pauseForwardStream2AllRooms());case 1:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"resumeForwardStream2AllRooms",value:(d=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._forwardStreamManager.resumeForwardStream2AllRooms());case 1:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"updateMediaParams",value:(c=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.signalingManager.sendSignaling("updateMediaParams",{roomId:this.config.roomId,mediaParams:t}));case 1:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"leave",value:(s=sk(sI().mark(function e(){var t,r,i,n,o,a,s,c=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=c.length>0&&void 0!==c[0]&&c[0],this.logger.info("leave","Invoke leave"),null===(t=this._subtitleTool)||void 0===t||t.destroy(),delete this._subtitleTool,e.prev=4,n=sz(fY(i=this._remoteStreams).call(i));try{for(n.s();!(o=n.n()).done;)a=o.value,Array.isArray(a)&&a.forEach(function(e){var t;null===(t=e.observer)||void 0===t||t.setLogin(!1)})}catch(e){n.e(e)}finally{n.f()}return this._localStream&&(null===(s=this._localStream.observer)||void 0===s||s.setLogin(!1)),e.next=10,this._roomJoin.leave().catch(function(){});case 10:this.destroy(),this.config.report("rtc_leave_room",{error_code:0,message:"",elapse:this.config.getStayRoomDuration()}),e.next=22;break;case 14:if(e.prev=14,e.t0=e.catch(4),e.t0 instanceof Error&&this.config.report("rtc_leave_room",{error_code:-1,message:e.t0.message,elapse:this.config.getStayRoomDuration()}),!r){e.next=21;break}throw e.t0;case 21:this.destroy();case 22:case"end":return e.stop()}},e,this,[[4,14]])})),function(){return s.apply(this,arguments)})},{key:"updateRemoteUserPriority",value:function(e){var t,r=this;null===(t=this.remoteStreams.get(e))||void 0===t||t.forEach(function(t){var i=r._ctx.userPriority;t.hasSubscribed&&i.has(e)&&r._subscriber.updateSubPriority(t,i.get(e))})}},{key:"destroy",value:function(){var e,t,r=this;this.logger.info("destroy","Invoke destroy"),mw(this._ctx.id,"room_destroy","".concat(Error().stack)),null===(e=this._subtitleTool)||void 0===e||e.destroy(),delete this._subtitleTool,this._subscriber.destroy(this._remoteStreams),this._publisher.destroy([this.localStream,this.localScreenStream]),this._roomJoin.destroy(),null===(t=this._clearSignalListeners)||void 0===t||t.call(this),this._remoteUsers=new d9,this._virtualStreams.forEach(function(e){r._subscriber.cleanStream(e)}),this._remoteStreams=new d9,this._localStream&&(this._localStream=void 0),this._localScreenStream&&(this._localScreenStream=void 0),this._userDuplicateLoginTimerMap.forEach(function(e){clearTimeout(e)}),this._userDuplicateLoginTimerMap.clear(),this._networkQualityManager.destroy(),this._videoSizeObserver.destroy(),this._csrcUserIdMap={},this._virtualStreams=[],this._remoteStreamStreamIdUserIdMap={},this._forwardStreamManager.destoy()}},{key:"updateToken",value:(a=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateToken","Invoke updateToken"),this.config.token=t,e.prev=2,e.next=5,this._roomJoin.updateToken(t);case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),this.safeEmit(Rg.ON_ROOM_ERROR,{errorCode:h6.UPDATE_TOKEN_WITH_INVALID_TOKEN}),e.t0;case 11:case"end":return e.stop()}},e,this,[[2,7]])})),function(e){return a.apply(this,arguments)})},{key:"sendUserMessage",value:function(e,t){var r;return null===(r=this._ctx.rtsLimiter.e2e)||void 0===r||r.check(),this._roomMessage.sendUserMessage(e,t)}},{key:"sendRoomMessage",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null===(t=this._ctx.rtsLimiter.boradcast)||void 0===t||t.check(),this._roomMessage.sendRoomMessage(e,r)}},{key:"maybeFillBackFrame2Stream",value:(o=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.refreshBlackFrameLifetime(),null!==(r=t.videoTransceiver)&&void 0!==r&&r.sender.track||this._publisher.updatePubBlackFrame(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"_onJoinSucc",value:function(e){var t,r,i,n=this,o=e.joinRes,a=e.reconnect;this.logger.info("_onJoinSucc()","invoke. ".concat(a?"[reconnect]":"")),this.emit(Rg.JOIN_SUCCESS,a),this._serverConfig=o.config,this.config.updateRoomAttributes(o.roomAttributes);var s=[],c=[],d=[],u=[],l=[];null===(t=o.clientsDetail)||void 0===t||t.forEach(function(e){if(e.attributes&&(e.attributes.serverMuteVideo&&n.safeEmit(Rg.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&n.safeEmit(Rg.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio})),e.clientId!==o.clientId){var t=n._remoteUsers.get(e.clientId);t?t._stillExist=!0:s.push(e)}});var h,p=sz(fY(r=this._remoteUsers).call(r));try{for(p.s();!(h=p.n()).done;){var f=h.value;f._stillExist||c.push({clientId:f.userId}),delete f._stillExist}}catch(e){p.e(e)}finally{p.f()}o.streams.forEach(function(e){var t=n._findRemoteStreamByScreen(e.clientId,e.screen);n.config.updateUserPubInfo(e),t?(t.stillExist=!0,t.streamId=e.streamId,l.push(e)):u.push(e)});var _,A=sz(fY(i=this._remoteStreams).call(i));try{for(A.s();!(_=A.n()).done;){var m=_.value;Array.isArray(m)&&m.forEach(function(e){e.stillExist?delete e.stillExist:d.push({clientId:e.userId,streamId:e.streamId,message:Ex.clientDisconnected})})}}catch(e){A.e(e)}finally{A.f()}c.forEach(function(e){return n._onUserDisconnection(e)}),s.forEach(function(e){return n._onUserConnection(e)}),d.forEach(function(e){return n._onRemoveStream(e)}),u.forEach(function(e){return n._onAddStream(e,{fromSignal:!1})}),l.forEach(function(e){return n._onUpdateStreamAttributes(e)}),this.config.resetUserPubInfo(),a&&this._handleSendOrRecvStreamAfterReconnect(),this.emit("__joinSuccess")}},{key:"_handleSendOrRecvStreamAfterReconnect",value:function(){var e,t,r=this;this._localStream&&(this._publisher.cleanStream(this._localStream).then(function(){var e;r._localStream&&(r._localStream.vendorCode=r.config.vendorConfig.vendorCode||0,null===(e=r._localStream.observer)||void 0===e||e.setLogin(!0))}),this._publisher.publish(this._localStream).then(function(){var e;r._ctx.handler&&(null===(e=r._localStream)||void 0===e||e.startReport(r._onLocalStreamStats.bind(r),r._localStream.vendorHandler||r._ctx.handler)),r.emit(Rg.ON_PUBLISH_RESULT,{isScreen:!1,state:pr.PUBLISH_SUCC,retry:!0})}).catch(function(e){r.logger.error("failed repub error:".concat(e)),r.emit(Rg.ON_PUBLISH_RESULT,{isScreen:!1,state:pr.PUBLISH_FAIL,errorCode:e.code,retry:!0})})),this._localScreenStream&&(this._publisher.cleanStream(this._localScreenStream).then(function(){var e;r._localScreenStream&&(null===(e=r._localScreenStream.observer)||void 0===e||e.setLogin(!0))}),this._publisher.publish(this._localScreenStream).then(function(){var e;r._ctx.handler&&(null===(e=r._localScreenStream)||void 0===e||e.startReport(r._onLocalStreamStats.bind(r),r._localScreenStream.vendorHandler||r._ctx.handler)),r.emit(Rg.ON_PUBLISH_RESULT,{isScreen:!0,state:pr.PUBLISH_SUCC,retry:!0})}).catch(function(e){r.logger.error("failed repub screen stream error:".concat(e)),r.emit(Rg.ON_PUBLISH_RESULT,{isScreen:!0,state:pr.PUBLISH_FAIL,errorCode:e.code,retry:!0})}));var i,n=sz(fY(t=this._remoteStreams).call(t));try{for(n.s();!(i=n.n()).done;){var o=i.value;Array.isArray(o)&&o.forEach(function(){var e=sk(sI().mark(function e(t){var i,n,o,a,s,c;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.hasSubscribed){e.next=23;break}return t.resetHasSubscribed(),e.prev=2,r.logger.info(sN(i="start resubscribe ".concat(t.userId," with ")).call(i,t.subMediaType)),Ei(t.subMediaType)&&(null===(n=t.observer)||void 0===n||n.setSubscribeVideo(!0)),Er(t.subMediaType)&&(null===(o=t.observer)||void 0===o||o.setSubscribeAudio(!0)),e.next=8,r._subscriber.subscribe(t,t.subMediaType);case 8:r.logger.info(sN(a="success resubscribe ".concat(t.userId," with ")).call(a,t.subMediaType)),r.safeEmit(Rg.RESUBSCRIBE,{stream:t}),r.emit(Rg.ON_SUBSCRIBE_RESULT,{state:pt.SUBSCRIBE_SUCC,userId:t.userId,isScreen:t.isScreen,retry:!0}),e.next=23;break;case 13:if(e.prev=13,e.t0=e.catch(2),r.emit(Rg.ON_SUBSCRIBE_RESULT,{state:pt.SUBSCRIBE_FAIL,userId:t.userId,isScreen:t.isScreen,errorCode:e.t0.code,retry:!0}),r.logger.error(sN(s=sN(c="failed resubscribe ".concat(t.userId," with ")).call(c,t.subMediaType,", error:")).call(s,e.t0)),e.t0.code!==h6.NOT_CONNECTED_YET){e.next=20;break}return t.streamState=RA.SUB_ED,e.abrupt("return");case 20:return e.next=22,r._subscriber.cleanStream(t);case 22:t.resetHasSubscribed();case 23:case"end":return e.stop()}},e,null,[[2,13]])}));return function(t){return e.apply(this,arguments)}}())}}catch(e){n.e(e)}finally{n.f()}null===(e=this._subtitleTool)||void 0===e||e.reconnect(),this._forwardStreamManager.resumeFromReconnect()}},{key:"_handleFFAudioTrack",value:function(){var e,t,r=null===(e=this._ctx.handler)||void 0===e?void 0:e.audioTrack4ff,i=null===(t=this._ctx.handler)||void 0===t?void 0:t.getTransceivers();if(r&&Array.isArray(i)){var n=uC(i).call(i,function(e){var t;return(null==e||null===(t=e.receiver)||void 0===t?void 0:t.track)===r});if(n){var o=new Rv(this._ctx,"ff-stream","ff-stream",!1,!1,CU);o.virtual=!0,o.audioTransceiver=n,o.audioMid="0",o.audioTrack=Ri(this._ctx,r,{streamIndex:EQ.VIRTUAL}),this._virtualStreams.push(o),this.safeEmit(Rg.SUBSCRIBE_PUSH_TRACK,{stream:o})}}}},{key:"_findRemoteStream",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?uC(r).call(r,function(e){return e.streamId===t}):null}},{key:"_findRemoteStreamByScreen",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?uC(r).call(r,function(e){return e.isScreen===t}):null}},{key:"_onAddStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.needEmit,i=void 0===r||r,n=t.fromSignal,o=void 0===n||n,a=t.virtual,s=void 0!==a&&a;if(e.clientId!==this.config.userId){var c=this.config,d=c.isAutoSubscribeAudio,u=c.isAutoSubscribeVideo,l=this._findRemoteStreamByScreen(e.clientId,e.screen);if(l&&l.streamId!==e.streamId){var h,p=null===(h=this._remoteStreams.get(e.clientId))||void 0===h?void 0:s8(h).call(h,function(e){return e.streamId!==l.streamId});this._subscriber.cleanStream(l),this._remoteStreams.set(e.clientId,p||[])}var f=this._findRemoteStream(e.clientId,e.streamId);if(this._remoteStreamStreamIdUserIdMap[e.streamId]=e.clientId,f)f.attributes=e.attributes;else if((f=new Rv(this._ctx,e.clientId,e.streamId,e.screen,!1,e.attributes)).virtual=s,this._initStreamListeners(f),!s){var _=this._remoteStreams.get(e.clientId);_?_.push(f):this._remoteStreams.set(e.clientId,[f])}if(f.remoteSessionId=e.remoteSessionId||"",f.observer=new RR(this._ctx,f),!f.isScreen&&u&&(o&&f.hasVideo&&(f.attributes.extvideo?(f.observer.setExternalVideoSource(!0),f.observer.setPushVideo(!0)):(f.observer.setExternalVideoSource(!1),f.observer.setPublishVideo(!0))),o&&f.hasAudio&&d&&!this.config.isMultiChatMode()&&(f.attributes.extaudio?(f.observer.setExternalAudioSource(!0),f.observer.setPushAudio(!0)):(f.observer.setExternalAudioSource(!1),f.observer.setPublishAudio(!0))),i&&!o)){var A=this.config,m=A.isAutoSubscribeAudio,v=A.isAutoSubscribeVideo;f.observer.setLogin(!0,{audio:!!m&&!this.config.isMultiChatMode(),video:!!v})}return i&&this.safeEmit(EV.ON_ADD_STREAM,{stream:f}),f}}},{key:"_onUserConnection",value:function(e){if(e.clientId!==this.config.userId){var t=this._userDuplicateLoginTimerMap.get(e.clientId);if("number"==typeof t)return this._userDuplicateLoginTimerMap.delete(e.clientId),void self.clearTimeout(t);var r={userId:e.clientId,extraInfo:e.attributes.extra_info};this._remoteUsers.set(e.clientId,l9({},r)),this.safeEmit(EV.USER_CONNECTION,{userInfo:r,publishState:this.config.getUserPubInfo(r.userId)}),e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(Rg.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(Rg.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}}},{key:"_onUserDisconnection",value:function(e){var t=this,r=e.clientId,i=e.tag,n=e.code,o=e.forbiddenTime;if(r){if(r===this.config.userInfo.userId){var a=null;i===EG.kickedByAdmin?a=h6.KICKED_OUT:i===EG.onUserTokenDidExpire?a=h6.TOKEN_EXPIRED:i===EG.userDuplicateLogin&&(a=h6.DUPLICATE_LOGIN),n===EW.roomDismissByAdmin&&(a=h6.ROOM_DISMISS),a&&this.safeEmit(Rg.ON_ROOM_ERROR,{errorCode:a,forbiddenTime:o})}else{var s=h9.DROPPED;i===EG.userLeave?s=h9.QUIT:i===EG.kickedByAdmin?s=h9.KICKED_BY_ADMIN:i===EG.roleChanged&&(s=h9.SWITCH_TO_INVISIBLE);var c=function(){t._remoteUsers.delete(r);var e,i=[];null===(e=t._remoteStreams.get(r))||void 0===e||e.forEach(function(e){i.push(t._onRemoveStream({clientId:e.userId,streamId:e.streamId,message:Ex.clientDisconnected}))}),t._remoteStreams.delete(r),sP.all(i).finally(function(){t.safeEmit(Rg.ON_USER_LEAVE,{userInfo:{userId:r},reason:s})})};if(i===EG.userDuplicateLogin){var d=this._userDuplicateLoginTimerMap.get(r);d&&self.clearTimeout(d);var u=self.setTimeout(c,5e3);this._userDuplicateLoginTimerMap.set(r,u)}else c()}}}},{key:"_onRemoveStream",value:(n=sk(sI().mark(function e(t){var r,i,n,o,a,s=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.clientId!==this.config.userId){e.next=2;break}return e.abrupt("return");case 2:if(r=this._remoteStreams.get(t.clientId)){e.next=5;break}return e.abrupt("return");case 5:if(i=uC(r).call(r,function(e){return e.streamId===t.streamId})){e.next=8;break}return e.abrupt("return");case 8:return i.hasVideo&&(null===(n=i.observer)||void 0===n||n.setPublishVideo(!1)),i.hasAudio&&!this.config.isMultiChatMode()&&(null===(o=i.observer)||void 0===o||o.setPublishAudio(!1)),a=s8(r).call(r,function(e){return e.streamId!==t.streamId}),this._remoteStreams.set(t.clientId,a),e.prev=12,e.next=15,this._subscriber.handleRemoveStream(i).then(function(){return s._subscriber.cleanStream(i)}).finally(function(){s.safeEmit(EV.ON_REMOVE_STREAM,{stream:i,reason:t.message,callback:function(){s._subscriber.destroyStream(i)}})});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(12),console.error(e.t0);case 20:case"end":return e.stop()}},e,this,[[12,17]])})),function(e){return n.apply(this,arguments)})},{key:"_onUpdateUserAttributes",value:function(e){e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(Rg.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(Rg.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}},{key:"_onUpdateRoomAttributes",value:function(e){var t;e.roomAttributes&&this.config.updateRoomAttributes(e.roomAttributes),null!==(t=e.roomAttributes)&&void 0!==t&&t.multiChatMode&&this._handleFFAudioTrack()}},{key:"_onUpdateStreamAttributes",value:function(e){var t=this.config,r=t.isAutoSubscribeAudio,i=t.isAutoSubscribeVideo,n=e.clientId,o=e.streamId,a=e.attributes,s=this._findRemoteStream(n,o);if(s){var c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I=s.attributes,C=l9(l9({},I),a),k=!1,w=C.localaudio!==I.localaudio,O=!1,N=!1,P=C.localvideo!==I.localvideo,D=!1,L=vP.NONE,M=vP.NONE;C.audiostream!==I.audiostream&&(k=C.localaudio,O=!!C.audiostream,C.audiostream?L|=pa.AUDIO:M|=pa.AUDIO),C.videostream!==I.videostream&&(N=C.localvideo,D=!!C.videostream,C.videostream?L|=pa.VIDEO:M|=pa.VIDEO),L&&this.safeEmit(Rg.ON_USER_PUBLISH_STATE_CHANGE,{userId:n,mediaType:L,isScreen:s.isScreen,pubState:Rb.PUB,remoteStream:s}),M&&this.safeEmit(Rg.ON_USER_PUBLISH_STATE_CHANGE,{userId:n,mediaType:M,isScreen:s.isScreen,pubState:Rb.UNPUB,remoteStream:s}),s.remoteSessionId=e.remoteSessionId||"",s.attributes=C,C.localaudio!==I.localaudio&&(C.localaudio?((r||s.subAudio)&&C.audiostream&&(C.extaudio?(null===(c=s.observer)||void 0===c||c.setExternalAudioSource(!0),null===(d=s.observer)||void 0===d||d.setPushAudio(!0)):(null===(u=s.observer)||void 0===u||u.setExternalAudioSource(!1),null===(l=s.observer)||void 0===l||l.setEnableAudio(!0))),this.safeEmit(Rg.ON_USER_START_AUDIO_CAPTURE,{userId:n},s)):(C.extaudio?(null===(h=s.observer)||void 0===h||h.setExternalAudioSource(!0),null===(p=s.observer)||void 0===p||p.setPushAudio(!1)):(null===(f=s.observer)||void 0===f||f.setExternalAudioSource(!1),null===(_=s.observer)||void 0===_||_.setEnableAudio(!1)),s.isScreen||this.safeEmit(Rg.ON_USER_STOP_AUDIO_CAPTURE,{userId:n}))),C.localvideo!==I.localvideo&&(C.localvideo?((i||s.subVideo)&&C.videostream&&(C.extvideo?(null===(A=s.observer)||void 0===A||A.setExternalVideoSource(!0),null===(m=s.observer)||void 0===m||m.setPushVideo(!0)):(null===(v=s.observer)||void 0===v||v.setExternalVideoSource(!1),null===(E=s.observer)||void 0===E||E.setEnableVideo(!0))),this.safeEmit(Rg.ON_USER_START_VIDEO_CAPTURE,{userId:n})):(C.extvideo?(null===(g=s.observer)||void 0===g||g.setExternalVideoSource(!0),null===(S=s.observer)||void 0===S||S.setPushVideo(!1)):(null===(b=s.observer)||void 0===b||b.setExternalVideoSource(!1),null===(T=s.observer)||void 0===T||T.setEnableVideo(!1)),s.isScreen||this.safeEmit(Rg.ON_USER_STOP_VIDEO_CAPTURE,{userId:n}))),k&&!w&&r&&(null===(y=s.observer)||void 0===y||y.setRemoteUnmuteAudio(O)),N&&!P&&i&&(null===(R=s.observer)||void 0===R||R.setRemoteUnmuteVideo(D)),"number"==typeof C.videoType&&C.videoType!==I.videoType&&this.safeEmit(Rg.VIDEO_TYPE_CHANGE,{userId:s.userId,isScreen:s.isScreen,type:C.videoType===EH.BLACK?EM.BLACK:EM.NORMAL})}}},{key:"_onPushTrack",value:function(e){var t,r,i=this;if(null!==(r=e.streamId)&&void 0!==r&&h4(r).call(r,"audio_mux")){var n=this._onAddStream(l9(l9({},e),{},{attributes:CU}),{needEmit:!1,fromSignal:!1,virtual:!0});n&&this._subscriber.subscribe4pushTrack(n,e).then(function(){i.safeEmit(Rg.SUBSCRIBE_PUSH_TRACK,{stream:n}),i._virtualStreams.push(n)}).catch(function(e){i.logger.error("subscribe","push track failed %o",e)})}else this.config.report("rtc_error",{message:sN(t="onPushTrack, userId: ".concat(e.clientId,", ")).call(t,e.streamId),error_code:yL.TRACK_ERROR})}},{key:"_onRemoveTrack",value:function(e){var t=e.clientId,r=e.streamId,i=e.message,n=e.trackType;this.logger.info("_onRemoveTrack","remove track: %o",t);var o=this._findRemoteStream(t,r);o&&(o.removeTrack=!0,this._subscriber.unsubscribe4removeTrack(o,i,n),this.emit(Rg.REMOVE_PUSH_TRACK,{stream:o,mediaType:n+1}))}},{key:"_onMeetingSpeakerChange",value:function(e){if(Array.isArray(null==e?void 0:e.speakerCsrcInfo)){var t={};null==e||e.speakerCsrcInfo.forEach(function(e){var r=e.csrc,i=e.userId;e.isScreen||(t[r]=i)}),this._csrcUserIdMap=t}Array.isArray(e.muxStreamInUse)&&this._virtualStreams.forEach(function(t){var r;null!==(r=e.muxStreamInUse)&&void 0!==r&&cd(r).call(r,t.streamId)?t.virtualOccupy=!0:t.virtualOccupy=!1})}},{key:"getActiveSpeakerInMultiChatMode",value:function(){var e=this,t=[];return this._virtualStreams.forEach(function(r){var i,n=null===(i=r.audioTransceiver)||void 0===i?void 0:i.receiver;if(n){var o=sq(n.getContributingSources()||[],1)[0];if(o){var a=o.audioLevel,s=o.source;e._csrcUserIdMap[s]&&t.push({userId:e._csrcUserIdMap[s],audioLevel:a})}}}),t.length&&hY(t).call(t,function(e,t){return e.audioLevel-t.audioLevel}),t}},{key:"_onReconnecting",value:function(){var e,t,r,i,n,o,a=this,s=sz(fY(n=this._remoteStreams).call(n));try{for(s.s();!(o=s.n()).done;){var c=o.value;Array.isArray(c)&&c.forEach(function(e){var t;null===(t=e.observer)||void 0===t||t.setDisconnect(),a._subscriber.cleanStream(e)})}}catch(e){s.e(e)}finally{s.f()}this._virtualStreams.forEach(function(e){var t;a.emit(Rg.REMOVE_PUSH_TRACK,{stream:e,mediaType:pa.AUDIO}),null===(t=e.observer)||void 0===t||t.setDisconnect(),a._subscriber.cleanStream(e)}),this._virtualStreams=[],null===(e=this.localStream)||void 0===e||null===(t=e.observer)||void 0===t||t.setDisconnect(),this._publisher.cleanStream(this.localStream),null===(r=this.localScreenStream)||void 0===r||null===(i=r.observer)||void 0===i||i.setDisconnect(),this._publisher.cleanStream(this.localScreenStream)}},{key:"_onConnectionStateChange",value:function(e){e.state===pc.CONNECTION_STATE_RECONNECTING?this._onReconnecting():e.state===pc.CONNECTION_STATE_RECONNECTED&&this._roomJoin.join(!0)}},{key:"_initStreamListeners",value:function(e){var t=this;e.on("ontrack",function(e){e.track}),e.on("onSEIMessage",function(r){t.emit(Rg.ON_SEI_MESSAGED_RECEIVED,{sei:r,remoteStreamKey:{userId:e.userId,roomId:t.config.roomId,streamIndex:e.isScreen?po.STREAM_INDEX_SCREEN:po.STREAM_INDEX_MAIN}})})}},{key:"_onCustomMessage",value:function(e){var t;null!==(t=this._subtitleTool)&&void 0!==t&&t.onMessageRecv(e)||this.safeEmit(EV.ON_CUSTOM_MESSAGE,e)}},{key:"_onUserMessageReceived",value:function(e){this.safeEmit(EV.USER_MESSAGE_RECEIVED,{userId:e.from,message:e.msg})}},{key:"_onUserBinaryMessageReceived",value:function(e){var t,r={userId:e.from,message:e.msg};null!==(t=this._subtitleTool)&&void 0!==t&&t.onMessageRecv(r)||this.safeEmit(EV.USER_BINARY_MESSAGE_RECEIVED,r)}},{key:"_initSubtitleTool",value:function(){var e=this;this._subtitleTool=new RL(this._ctx,this.config),this._subtitleTool.onEvent=function(t){e.emit(Rg.ON_SUBTITLE_STATE_CHANGED,t)},this._subtitleTool.onMessage=function(t){e.emit(Rg.ON_SUBTITLE_MESSAGE_RECEIVED,t)}}},{key:"_onPostProcessingMessage",value:function(e){if(e.body){if("subtitleCallback"!==e.type){var t,r=e.body,i=r.error||0,n=RS.START,o=["success","parameter error","subscription timeout","ffmpeg error","cdn error","publish error"];if("2.0"===r.protocol){switch(r.eventType){case"TranscodeStarted":0!==r.error&&(n=RS.START_FAILED);break;case"TranscodeStateChanged":n=0!==r.error?RS.START_FAILED:RS.START_SUCCESS;break;case"TranscodeStopped":n=0!==r.error?RS.STOP_FAILED:RS.STOP_SUCCESS;break;case"TranscodeUpdated":n=0!==r.error?RS.UPDATE_FAILED:RS.UPDATE_SUCCESS}this.safeEmit(EV.POST_PROCESSING_MESSAGE,{code:i,protocol:r.protocol,error:r.error,eventType:n,message:o[i]})}this.safeEmit(EV.POST_PROCESSING_MESSAGE,{code:i,message:o[i],type:e.type})}else null===(t=this._subtitleTool)||void 0===t||t.onResult(e)}}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(EV.ON_USER_TOKEN_WILL_EXPIRE,null)}},{key:"_onUserTokePublishPrivilegeWillExpire",value:function(){this.safeEmit(EV.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE,null)}},{key:"_onUserTokenPublishPrivilegeDidExpire",value:function(){this.safeEmit(EV.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED,null)}},{key:"_onUserTokeSubscribePrivilegeWillExpire",value:function(){this.safeEmit(EV.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE,null)}},{key:"_onUserTokenSubscribePrivilegeDidExpire",value:function(){this.safeEmit(EV.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED,null)}},{key:"_onStreamFailed",value:(i=sk(sI().mark(function e(t){var r,i,n,o,a,s,c;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("publish"!==t.type){e.next=13;break}if(n=void 0,(null===(r=this.localStream)||void 0===r?void 0:r.streamId)===t.streamId?n=this.localStream:(null===(i=this.localScreenStream)||void 0===i?void 0:i.streamId)===t.streamId&&(n=this.localScreenStream),n){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this._publisher.unpublish(n).catch(function(){});case 7:return e.next=9,this._publisher.cleanStream(n);case 9:return e.next=11,this._publisher.publish(n).catch(function(){});case 11:e.next=24;break;case 13:if("subscribe"!==t.type||(o=this._remoteStreamStreamIdUserIdMap[t.streamId],!(a=this._findRemoteStream(o,t.streamId)))){e.next=24;break}return s=a.subMediaType,c=a.subLayer,e.next=21,this._subscriber.unsubscribe(a);case 21:return e.next=23,this._subscriber.subscribe(a,s,c);case 23:this.safeEmit(Rg.RESUBSCRIBE,{stream:a});case 24:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"_onStreamControlMessage",value:function(e){var t,r;e.type===EU.PushLimitWarn&&(null!==(t=this._localStream)&&void 0!==t&&t.pubAudio||null!==(r=this._localStream)&&void 0!==r&&r.pubVideo||this.unpublish())}},{key:"_onPublishOnDemand",value:(r=sk(sI().mark(function e(){var t,r,i,n,o,a,s,c,d,u,l,h,p,f=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._publishOnDemandItem&&!this._publishOnDemandBusy&&!1!==(null===(t=this._serverConfig)||void 0===t||null===(r=t.engine_VPM)||void 0===r||null===(i=r.ondemand)||void 0===i?void 0:i.enable)){e.next=2;break}return e.abrupt("return");case 2:if(null===(n=this._localStream)||void 0===n||!n.videoTransceiver){e.next=19;break}return this._publishOnDemandBusy=!0,a=this._publishOnDemandItem,this._publishOnDemandItem=void 0,s=[],c=this._localStream.stream.id,u=(d=this._localStream.videoTransceiver.sender).getParameters(),mw(this._ctx.id,"sender.getParameters",sD(u),0,c),Array.isArray(u.encodings)&&Array.isArray(a)&&(h={},this.logger.info("_onPublishOnDemand exec","usedDescriptions: %o",a),a.forEach(function(e){var t;if(null!==(t=e.StreamIds)&&void 0!==t&&cd(t).call(t,c)){var r,i,n,o,a,s,d,u=null!==(r=null===(i=e.Metadata)||void 0===i?void 0:i.VideoIndex)&&void 0!==r?r:0,l=0;null!==(n=f._ctx.serverConfig)&&void 0!==n&&n.e2eFeedback&&(l=Math.max.apply(Math,sN(o=le(sU(a=cG(null!==(s=null===(d=e.Metadata)||void 0===d?void 0:d.VideoKbpsHist)&&void 0!==s?s:{})).call(a,function(e){return Number(e)}))).call(o,[0]))),h[u]={kbps:l}}}),p=le(this._localStream.pubAttributes.videoDescriptions),u.encodings=sU(l=u.encodings).call(l,function(e){if(e.rid){if(h[e.rid]){e.active=!0;var t,r=null===(t=h[e.rid])||void 0===t?void 0:t.kbps;r&&(e.maxBitrate=1e3*Rq(e.rid,r,p))}else e.active=!1;s[Number(e.rid)]=e.active}else{var i,n=null===(i=h[0])||void 0===i?void 0:i.kbps;n&&(e.maxBitrate=1e3*Rq(void 0,n,p))}return e}),this.config.report("rtc_invoke_status",{sdk_api_name:"onPublishOnDemand",message:sD(u.encodings),error_code:0,stream_id:c,elapse:0}),this._ctx.videoProfile.activeSimStreams=s),this.logger.info("sender.setParameters()",sD(u.encodings)),mw(this._ctx.id,"sender.setParameters",sD(u),0,c),e.next=16,d.setParameters(u);case 16:this._publishOnDemandBusy=!1,e.next=21;break;case 19:if(null!==(o=this._localStream)&&void 0!==o&&o.videoTransceiver){e.next=21;break}return e.abrupt("return");case 21:this._onPublishOnDemand();case 22:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"_onRTT",value:function(e){var t=e.StreamIds,r=e.Metadata;if(null!=t&&t.length&&r){var i=t[0];this._ctx.streamRTT[i]={audio:r.audio_rtt,video:r.video_rtt}}}},{key:"_onRSCP",value:function(e,t){var r=this;uC(e).call(e,function(e){var t,i,n;return null==e||null===(t=e.StreamIds)||void 0===t?void 0:cd(t).call(t,null===(i=r._localStream)||void 0===i||null===(n=i.stream)||void 0===n?void 0:n.id)})&&(t?this._pubTransceiverReady=!0:this._onceTriggerBySignal=!0,t&&this._onceTriggerBySignal||(this._publishOnDemandItem=e),this._pubTransceiverReady&&this._onPublishOnDemand())}},{key:"_onSSC",value:function(e){var t=e.StreamIds,r=e.Metadata,i=t[0],n=this._remoteStreamStreamIdUserIdMap[i],o=this._findRemoteStream(n,i),a={userId:n,isScreen:!!o&&o.isScreen,beforeVideoIndex:r.ssc_items[0].prev_layer_id,afterVideoIndex:r.ssc_items[0].cur_layer_id,beforeEnable:0!==r.ssc_items[0].prev_video_open,afterEnable:0!==r.ssc_items[0].cur_video_open,reason:r.ssc_items[0].change_reason};this.emit(Rg.ON_SIMULCAST_SUBSCRIBE_FALLBACK,a)}},{key:"_reportNetworkQuality",value:function(e,t){this.emit(Rg.ON_NETWORK_QUALITY,e,t)}},{key:"_emitVideoSizeChange",value:function(e,t,r,i){this.emit(Rg.ON_REMOTE_VIDEO_SIZE_CHANGED,{roomId:this.config.roomId,userId:e,streamIndex:t?po.STREAM_INDEX_SCREEN:po.STREAM_INDEX_MAIN},{width:r,height:i})}},{key:"setAudioEncodeMaxBitrate",value:(t=sk(sI().mark(function e(t,r){var i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(i=t===po.STREAM_INDEX_MAIN?this.localStream:this.localScreenStream)||!i.pubAudio||(o=null===(n=i.audioTransceiver)||void 0===n?void 0:n.sender.getParameters(),mw(this._ctx.id,"sender.getParameters",sD(o),0,i.streamId),null==o||!o.encodings.length)){e.next=9;break}return o.encodings[0].maxBitrate=1e3*r,mw(this._ctx.id,"sender.setParameters",sD(o),0,i.streamId),e.next=9,null===(a=i.audioTransceiver)||void 0===a?void 0:a.sender.setParameters(o);case 9:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"_onEngineControlMessage",value:function(e){var t=e.type,r=e.body;if(t===EB.CHANGE_CODEC){if(!vB("SDK_CODEC_NEGOTIATION"))return void this.logger.info("_onEngineControlMessage","SDK_CODEC_NEGOTIATION is false, ignore");var i=r.codec,n=r.media,o=r.streamId;if(!n||"audio"===n)return;var a,s,c,d,u,l=sU(a=i.split(",")).call(a,function(e){return lx(e).call(e).toUpperCase()});(this.logger.info("_onEngineControlMessage","changeCodec to %s",i),o)?((null===(c=this.localStream)||void 0===c?void 0:c.streamId)===o?s=this.localStream:(null===(d=this.localScreenStream)||void 0===d?void 0:d.streamId)===o&&(s=this.localScreenStream),null===(u=s)||void 0===u||u.setChangeCodecs(l)):"video"===n?(s=this.localStream,this._ctx.targetCodec=l[0]):"screen"===n&&(s=this.localScreenStream,this._ctx.targetScreenCodec=l[0]),s&&this.emit(Rg.UPDATE_PUBLISH,{streamIndex:s.isScreen?po.STREAM_INDEX_SCREEN:po.STREAM_INDEX_MAIN})}}}]),P}();Cx([RY],CB.prototype,"publishScreen",1),Cx([RY],CB.prototype,"updatePubScreenTrack",1),Cx([RY],CB.prototype,"unpublishScreen",1),Cx([RY],CB.prototype,"liveControlMessage",1),Cx([RY],CB.prototype,"publicStreamControlMessage",1),Cx([RY],CB.prototype,"updateUserAttributes",1),Cx([RY],CB.prototype,"publish",1),Cx([RY],CB.prototype,"updatePubTrack",1),Cx([RY],CB.prototype,"unpublish",1),Cx([RY],CB.prototype,"subscribe",1),Cx([RY],CB.prototype,"updateSubVideoConfig",1),Cx([RY],CB.prototype,"unsubscribe",1),Cx([RY],CB.prototype,"startSubtitle",1),Cx([RY],CB.prototype,"stopSubtitle",1),Cx([RY],CB.prototype,"startForwardStream2Rooms",1),Cx([RY],CB.prototype,"updateForwardStream2Rooms",1),Cx([RY],CB.prototype,"stopForwardStream2Rooms",1),Cx([RY],CB.prototype,"pauseForwardStream2AllRooms",1),Cx([RY],CB.prototype,"resumeForwardStream2AllRooms",1),Cx([RY],CB.prototype,"updateMediaParams",1),Cx([RY],CB.prototype,"updateRemoteUserPriority",1),Cx([RY],CB.prototype,"updateToken",1),Cx([RY],CB.prototype,"sendUserMessage",1),Cx([RY],CB.prototype,"sendRoomMessage",1),Cx([RY],CB.prototype,"maybeFillBackFrame2Stream",1);var CV=(kt=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Audio(Tn.createObjectURL(new Blob([t],r))),e.prev=1,i.muted=!0,e.next=5,i.play();case 5:return i.pause(),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[1,9]])})),function(e,t){return kt.apply(this,arguments)}),CF=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},Cj=function(){var e,t,r;function i(e,t){var r,n,o=this;nK(this,i),nQ(this,"_sharedAudioContext",new AudioContext),nQ(this,"_workletReady",void 0),nQ(this,"_audioDestination",this._sharedAudioContext.createMediaStreamDestination()),nQ(this,"_localGainNode",this._sharedAudioContext.createGain()),nQ(this,"_bufferGainNode",this._sharedAudioContext.createGain()),nQ(this,"_audioBufferSource",void 0),nQ(this,"_localSource",void 0),nQ(this,"_context",void 0),nQ(this,"_failedAudioList",[]),nQ(this,"_startingIds",new d9),nQ(this,"_revokeURLs",new T4),nQ(this,"_audioFetchMap",new d9),nQ(this,"_audioFetchConfig",new d9),nQ(this,"mixingMap",new d9),nQ(this,"resourcesCache",new d9),nQ(this,"volumeConfig",new d9),nQ(this,"cachedBuffer",[]),nQ(this,"id","AudioMixingManager"),this.engineId=t,this._context=e;try{this._workletReady=null===(r=this._sharedAudioContext.audioWorklet)||void 0===r||null===(n=r.addModule)||void 0===n?void 0:n.call(r,yA),this._workletReady.catch(function(){o._workletReady=null})}catch(e){this._workletReady=null}this._localGainNode.gain.value=1}return nY(i,[{key:"mixMediaStream",value:function(e){this._localSource&&this._localSource.disconnect(this._localGainNode),this._localSource=this._sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this._localGainNode).connect(this._audioDestination)}},{key:"startAudioMixing",value:(r=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h,p,f,_,A,m=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this._startingIds.get(t)){e.next=3;break}return console.warn("AudioMixing task id: ".concat(t," is starting")),e.abrupt("return");case 3:if(this._startingIds.set(t,t),n=i.playCount,E_(o=i.type,"mixingType",RV(Ci)),a=this._context.getLocalAudioTrack()){e.next=9;break}return e.abrupt("return");case 9:if((s=a.preprocessingTrack)&&this.mixMediaStream(new MediaStream([s])),a.once("needReplaceTrack",function(){m.mixMediaStream(new MediaStream([a.preprocessingTrack]))}),null!=(c=this.mixingMap.get(t))&&c.audioNode){c.audioNode.pause(),this._context.emitMessage({mixId:t,state:Cn.AUDIO_MIXING_STATE_STOPPED,error:h3.AUDIO_MIXING_ERROR_OK});try{c.gainNode.disconnect(this._audioDestination),c.audioSource.disconnect(c.gainNode)}catch(e){}}if(!(u=this.resourcesCache.get(t))||u.filePath!==r){e.next=19;break}d=u.getAudioNode(),e.next=34;break;case 19:return e.next=21,fetch(r,{mode:"cors",credentials:"include"}).then(function(e){if(e.ok)return e.arrayBuffer();throw m._context.emitMessage({mixId:t,state:Cn.AUDIO_MIXING_STATE_FAILED,error:h3.AUDIO_MIXING_ERROR_START_FAILED}),m._startingIds.delete(t),m.mixingMap.delete(t),new pB(h6.LOAD_RESOURCES_FAILED,e.statusText)});case 21:return l=e.sent,ul(r).call(r,"mp3")?h={type:"audio/mpeg"}:ul(r).call(r,"aac")&&(h={type:"audio/aac"}),e.next=25,CV(l,h);case 25:if(e.sent){e.next=31;break}throw this._context.emitMessage({mixId:t,state:Cn.AUDIO_MIXING_STATE_FAILED,error:h3.AUDIO_MIXING_ERROR_START_FAILED}),this._startingIds.delete(t),this.mixingMap.delete(t),new pB(h6.LOAD_RESOURCES_FAILED,"invalid audio resource");case 31:(d=new Audio).crossOrigin="anonymous",d.src=Tn.createObjectURL(new Blob([l],h));case 34:return n<=0?d.loop=!0:n>0&&(p=n,d.onended=function(){--p>0?d.play():(m.mixingMap.delete(t),m._context.emitMessage({mixId:t,state:Cn.AUDIO_MIXING_STATE_FINISHED,error:h3.AUDIO_MIXING_ERROR_OK}))}),e.prev=35,e.next=38,d.play();case 38:e.next=45;break;case 40:e.prev=40,e.t0=e.catch(35),console.error(e.t0),this._failedAudioList.push(d),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:po.STREAM_INDEX_MAIN,mediaType:pa.AUDIO});case 45:if(this._startingIds.delete(t),f=this._sharedAudioContext.createMediaElementSource(d),_=this._sharedAudioContext.createGain(),A=this.volumeConfig.get(t),_.gain.value=A?A/100:1,f.connect(_).connect(this._audioDestination),this.mixingMap.set(t,{audioSource:f,audioNode:d,gainNode:_,type:"file"}),o===Ci.PUBLISH)try{_.disconnect(this._sharedAudioContext.destination)}catch(e){}else _.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],i.type),this._context.emitMessage({mixId:t,state:Cn.AUDIO_MIXING_STATE_PLAYING,error:h3.AUDIO_MIXING_ERROR_OK}),this.updateFetcher(t);case 56:case"end":return e.stop()}},e,this,[[35,40]])})),function(e,t,i){return r.apply(this,arguments)})},{key:"stopAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&"file"===t.type&&(this.mixingMap.delete(e),t.audioNode.pause(),t.audioSource.disconnect(t.gainNode),t.gainNode.disconnect(this._audioDestination),this.updateFetcher(e),this._context.emitMessage({mixId:e,state:Cn.AUDIO_MIXING_STATE_STOPPED,error:h3.AUDIO_MIXING_ERROR_OK}))}},{key:"pauseAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:Cn.AUDIO_MIXING_STATE_PAUSED,error:h3.AUDIO_MIXING_ERROR_OK}),t.audioNode.pause())}},{key:"resumeAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:Cn.AUDIO_MIXING_STATE_PLAYING,error:h3.AUDIO_MIXING_ERROR_OK}),t.audioNode.play())}},{key:"preloadAudioMixing",value:(t=sk(sI().mark(function e(t,r){var i,n,o=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAudioMixing(t),e.next=3,fetch(r,{mode:"cors",credentials:"include"}).then(function(e){if(e.ok)return e.arrayBuffer();throw new pB(h6.LOAD_RESOURCES_FAILED,e.statusText)}).catch(function(e){if(o._context.emitMessage({mixId:t,state:Cn.AUDIO_MIXING_STATE_FAILED,error:h3.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),e instanceof pB)throw e;throw new pB(h6.LOAD_RESOURCES_FAILED,"Load resources failed",e)});case 3:return i=e.sent,ul(r).call(r,"mp3")?n={type:"audio/mpeg"}:ul(r).call(r,"aac")&&(n={type:"audio/aac"}),e.next=7,CV(i,n);case 7:if(e.sent){e.next=11;break}throw this._context.emitMessage({mixId:t,state:Cn.AUDIO_MIXING_STATE_FAILED,error:h3.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new pB(h6.LOAD_RESOURCES_FAILED,"Load resources failed");case 11:return this._context.emitMessage({mixId:t,state:Cn.AUDIO_MIXING_STATE_PRELOADED,error:h3.AUDIO_MIXING_ERROR_OK}),this.resourcesCache.set(t,{getAudioNode:function(){var e=Tn.createObjectURL(new Blob([i],n));return o._revokeURLs.add(e),new Audio(e)},filePath:r,duration:0}),e.next=15,new sP(function(e){var r=Tn.createObjectURL(new Blob([i],n)),a=new Audio(r);a.addEventListener("durationchange",function(){var i=o.resourcesCache.get(t);i&&(i.duration=a.duration,o.resourcesCache.set(t,i)),Tn.revokeObjectURL(r),e(null)})});case 15:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"unloadAudioMixing",value:function(e){this.resourcesCache.has(e)&&this.resourcesCache.delete(e)}},{key:"getAudioMixingVolume",value:function(e){var t=this.mixingMap.get(e);return t?100*t.gainNode.gain.value:0}},{key:"setAudioMixingVolume",value:function(e,t){t<0?t=0:t>400&&(t=400),this.volumeConfig.set(e,t);var r=this.mixingMap.get(e);r&&(r.gainNode.gain.value=Number(t)/100)}},{key:"getAudioMixingDuration",value:function(e){var t=this.mixingMap.get(e),r=this.resourcesCache.get(e);return t||r?t?1e3*t.audioNode.duration:r?1e3*r.duration:0:0}},{key:"getAudioMixingCurrentPosition",value:function(e){var t=this.mixingMap.get(e);return t?1e3*t.audioNode.currentTime:0}},{key:"setAudioMixingPosition",value:function(e,t){var r=this.mixingMap.get(e);r&&(r.audioNode.currentTime=t/1e3,r.audioNode.play())}},{key:"setAudioFrameCallback",value:function(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4096;if(E_(i,"frameSize",[256,512,1024,2048,4096,8192,16384]),i=null!==(r=i)&&void 0!==r?r:4096,null===this._workletReady)throw new pB(h6.NOT_SUPPORTED,"Not support AudioWorklet");t?this._audioFetchConfig.set(e,{callback:t,frameSize:i}):this._audioFetchConfig.delete(e),this.updateFetcher(e)}},{key:"updateFetcher",value:function(e){var t,r,i=null!==(t=this._audioFetchConfig.get(e))&&void 0!==t?t:{},n=i.callback,o=i.frameSize,a=null===(r=this.mixingMap.get(e))||void 0===r?void 0:r.gainNode;if(console.log("updateFetcher",a,o,n),a&&n&&o){var s=this._audioFetchMap.get(e);s?s.setFrameSize(o):s=new yg(a,o,this._sharedAudioContext,this._workletReady),s.on("data",n),this._audioFetchMap.set(e,s)}else{var c=this._audioFetchMap.get(e);null==c||c.removeAllListeners("data"),null==c||c.destroy(),this._audioFetchMap.delete(e)}}},{key:"enableAudioMixingBuffer",value:function(e){E_(e,"type",RV(Ci));var t=this._context.getLocalAudioTrack();if(t){var r=t.preprocessingTrack;if(r&&this.mixMediaStream(new MediaStream([r])),e===Ci.PUBLISH)try{this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(e){}else this._bufferGainNode.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],e),this._bufferGainNode.connect(this._audioDestination),this._context.emitMessage({mixId:-1,state:Cn.AUDIO_MIXING_STATE_PCM_ENABLED,error:h3.AUDIO_MIXING_ERROR_OK})}}},{key:"disableAudioMixingBuffer",value:function(){if(this.cachedBuffer=[],this._audioBufferSource){try{this._audioBufferSource.onended=null,this._audioBufferSource.disconnect(this._bufferGainNode),this._bufferGainNode.disconnect(this._audioDestination),this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(e){}finally{this._audioBufferSource=void 0}this._context.updateLocalAudioTrack(),this._context.emitMessage({mixId:-1,state:Cn.AUDIO_MIXING_STATE_PCM_DISABLED,error:h3.AUDIO_MIXING_ERROR_OK})}}},{key:"pushAudioMixingBuffer",value:function(e){var t=this;if(!(this._audioBufferSource&&(this.cachedBuffer.push(e),this.cachedBuffer.length>0))){this._audioBufferSource=this._sharedAudioContext.createBufferSource(),this._audioBufferSource.buffer=e,this._audioBufferSource.connect(this._bufferGainNode);try{this._audioBufferSource.start()}catch(e){this._failedAudioList.push(this._audioBufferSource)}this._audioBufferSource.onended=function(){var e;if(null===(e=t._audioBufferSource)||void 0===e||e.disconnect(t._bufferGainNode),t._audioBufferSource=void 0,t.cachedBuffer.length){var r=t.cachedBuffer.shift();r&&t.pushAudioMixingBuffer(r)}}}}},{key:"stopAll",value:function(){var e=this;if(this._localSource)try{this._localSource.disconnect(this._localGainNode),delete this._localSource}catch(e){}this.mixingMap.forEach(function(t,r){e.stopAudioMixing(r)})}},{key:"mixTrack",get:function(){return this._audioDestination.stream.getAudioTracks()[0]}},{key:"sharedAudioContext",get:function(){return this._sharedAudioContext}},{key:"resumeLocalPlay",value:(e=sk(sI().mark(function e(){var t,r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=sz(this._failedAudioList),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=24;break}if(n=i.value,e.prev=6,!(n instanceof HTMLAudioElement)){e.next=13;break}return n.muted=!1,e.next=11,n.play();case 11:e.next=14;break;case 13:n.start();case 14:e.next=22;break;case 16:return e.prev=16,e.t0=e.catch(6),t.push(n),console.error(e.t0),this._context.onAutoPlayFailed({userId:this.id,kind:"audio",streamIndex:po.STREAM_INDEX_MAIN,mediaType:pa.AUDIO}),e.abrupt("break",24);case 22:e.next=4;break;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(2),r.e(e.t1);case 29:return e.prev=29,r.f(),e.finish(29);case 32:this._failedAudioList=t;case 33:case"end":return e.stop()}},e,this,[[2,26,29,32],[6,16]])})),function(){return e.apply(this,arguments)})},{key:"destroy",value:function(){var e=this._sharedAudioContext;"closed"!==e.state&&"function"==typeof e.close&&e.close(),this.cachedBuffer=[],this.mixingMap.clear(),this.resourcesCache.clear(),this.volumeConfig.clear(),this._startingIds=new d9,this._revokeURLs.forEach(function(e){Tn.revokeObjectURL(e)})}}]),i}();CF([mR(["id","filePath","options"])],Cj.prototype,"startAudioMixing",1),CF([mR(["id"])],Cj.prototype,"stopAudioMixing",1),CF([mR(["id"])],Cj.prototype,"pauseAudioMixing",1),CF([mR(["id"])],Cj.prototype,"resumeAudioMixing",1),CF([mR(["id"])],Cj.prototype,"preloadAudioMixing",1),CF([mR(["id"])],Cj.prototype,"unloadAudioMixing",1),CF([mR(["id"])],Cj.prototype,"getAudioMixingVolume",1),CF([mR(["id","volume"])],Cj.prototype,"setAudioMixingVolume",1),CF([mR(["id"])],Cj.prototype,"getAudioMixingDuration",1),CF([mR(["id"])],Cj.prototype,"getAudioMixingCurrentPosition",1),CF([mR(["id","position"])],Cj.prototype,"setAudioMixingPosition",1),CF([mR(["id","callback","frameSize"])],Cj.prototype,"setAudioFrameCallback",1),CF([mR(["type"])],Cj.prototype,"enableAudioMixingBuffer",1),CF([mR()],Cj.prototype,"disableAudioMixingBuffer",1),CF([mR(["buffer"])],Cj.prototype,"pushAudioMixingBuffer",1);var CG=function(e){hA(d,EN.EventEmitter);var t,r,i,n,o,a,s,c=hI(d);function d(e){var t;return nK(this,d),nQ(he(t=c.call(this)),"_loginSessionId",null),nQ(he(t),"_userId",null),nQ(he(t),"_token",null),nQ(he(t),"_loginResolveCallback",void 0),nQ(he(t),"_loginRejectCallback",void 0),nQ(he(t),"_waitLoginToken",!1),nQ(he(t),"_serverParamsCache",void 0),nQ(he(t),"id",void 0),nQ(he(t),"logger",void 0),nQ(he(t),"_clearListeners",void 0),t._ctx=e,t.id=e.id,t.logger=new mJ("RTSClient",1,e.id),t}return nY(d,[{key:"login",value:function(e,t){var r=this;return new sP(function(i,n){var o;if(r.logger.info("login","invoke login, token: %o, userId: %o",e,t),r._loginSessionId)throw new pB(h6.ALREADY_LOGIN,"Already logined");if(r._loginResolveCallback)throw new pB(h6.LOGIN_FAILED,"Is logging in, please try again later.");r._userId=t,r._token=e,null===(o=mS(r.id))||void 0===o||o.set({rtm_user_id:t}),r._loginResolveCallback=i,r._loginRejectCallback=n,r._ctx.signalingManager.connect().then(function(){r._addSignalEventHandler(),r._login()})})}},{key:"logout",value:(s=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new pB(h6.NOT_LOGIN,"login first");case 2:return e.next=4,this._ctx.signalingManager.sendSignaling("logout",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId},{functionType:IJ.C2RTM}).catch(function(){});case 4:this._clearState();case 5:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"updateLoginToken",value:(a=sk(sI().mark(function e(t){var r=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._token=t,e.abrupt("return",new sP(function(e,t){r._waitLoginToken?(r._loginResolveCallback=e,r._loginRejectCallback=t,r._login()):e()}));case 2:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(o=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new pB(h6.NOT_LOGIN,"login first");case 2:return e.next=4,this._ctx.signalingManager.sendSignaling("getPeerOnlineStatus",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,peerUserId:t},{functionType:IJ.C2RTM});case 4:return r=e.sent,e.abrupt("return",null==r?void 0:r.status);case 6:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(n=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new pB(h6.NOT_LOGIN,"login first");case 2:return null===(i=this._ctx.rtsLimiter.e2e)||void 0===i||i.check(),e.abrupt("return",this._ctx.signalingManager.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:t,room:"",msg:r}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"setRTSMessageLimit",value:(i=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t&&this._ctx.signalingManager.sendSignaling("RTSMessageLimit",{appId:this._ctx.appId,interval:t.rts_qps_interval,broadcast:t.rts_broadcast_qps_value,one2one:t.rts_e2e_qps_value,e2bs:t.rts_e2s_qps_value},{functionType:IJ.C2RTM}).catch(function(){});case 1:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"setServerParams",value:(r=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,Ef(t,"signature"),Ef(r,"url"),this._loginSessionId&&this._userId){e.next=5;break}throw new pB(h6.NOT_LOGIN,"login first");case 5:return e.next=7,this._ctx.signalingManager.sendSignaling("setServerParams",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._ctx.appId,signature:t,url:r},{functionType:IJ.C2RTM}).catch(function(e){throw new pB(h6.UNEXPECTED_ERROR,e.msg)});case 7:ml.setServerUrl(this.id,r),this._serverParamsCache={signature:t,url:r},this.emit("onServerParamsSetResult"),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(0),this.emit("onServerParamsSetResult",e.t0),e.t0;case 16:case"end":return e.stop()}},e,this,[[0,12]])})),function(e,t){return r.apply(this,arguments)})},{key:"sendServerMessage",value:(t=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new pB(h6.NOT_LOGIN,"login first");case 2:return null===(r=this._ctx.rtsLimiter.e2s)||void 0===r||r.check(),e.abrupt("return",this._ctx.signalingManager.sendP2PMessage({from:this._userId,app:this._ctx.appId,to:"",room:"",type:IH.BUSINESS_SERVER,msg:t}));case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.logger.info("destroy","invoke."),hf(hp(d.prototype),"removeAllListeners",this).call(this),this._loginResolveCallback&&this._loginRejectCallback&&(this._loginRejectCallback(new pB(h6.LOGIN_FAILED,"logout")),delete this._loginResolveCallback,delete this._loginRejectCallback),this._clearState(),delete this._serverParamsCache}},{key:"_login",value:function(){var e=this;if(this._userId){var t=v$();this._ctx.signalingManager.sendSignaling("login",{Token:v1.token2auth(this._ctx.appId,null,this._userId,this._token),timestamp:Date.now(),loginSessionId:t,params:{deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:vx.VERSION,deviceId:vw.getDeviceId(),appId:this._ctx.appId,userId:this._userId}},{functionType:IJ.C2RTM}).then(function(){"function"==typeof e._loginResolveCallback&&e._loginResolveCallback(),e._loginSessionId=t,ml.setRtsSessionId(e.id,t),e._waitLoginToken=!1,e._serverParamsCache&&e.setServerParams(e._serverParamsCache.signature,e._serverParamsCache.url)}).catch(function(t){var r,i,n=t||{},o=n.code,a=n.message;e._waitLoginToken=!1,o>=700&&o<800?708===o?(r=h6.INVALID_PARAMS,i="Invalid userId"):(r=h6.INVALID_TOKEN,i="Invalid token",e._waitLoginToken=!0,e._loginRejectCallback||e.emit("onRTMTokenError")):(r=h6.LOGIN_FAILED,i="login failed"),"function"==typeof e._loginRejectCallback&&e._loginRejectCallback(new pB(r,a||i))}).finally(function(){delete e._loginResolveCallback,delete e._loginRejectCallback})}}},{key:"_addSignalEventHandler",value:function(){var e=this,t=function(t){t.state===pc.CONNECTION_STATE_RECONNECTED&&e._login()},r=function(){return e._clearState()},i=function(t){e.emit("onUserMessageReceivedOutsideRoom",{userId:t.from,message:t.msg})},n=function(t){e.emit("onUserBinaryMessageReceivedOutsideRoom",{userId:t.from,message:t.msg})},o=function(t){t.clientId!==e._userId||t.roomId||(e.emit("onUserDisconnection"),e._clearState())};this._ctx.signalingManager.on(Ej.ON_CONNECTION_STATE_CHANGE,t),this._ctx.signalingManager.on(Ej.ON_RECONNECT_FAILED,r),this._ctx.signalingManager.on(EV.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,i),this._ctx.signalingManager.on(EV.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,n),this._ctx.signalingManager.on(EV.USER_DISCONNECTION,o),this._clearListeners=function(){e._ctx.signalingManager.off(Ej.ON_CONNECTION_STATE_CHANGE,t),e._ctx.signalingManager.off(Ej.ON_RECONNECT_FAILED,r),e._ctx.signalingManager.off(EV.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,i),e._ctx.signalingManager.off(EV.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,n),e._ctx.signalingManager.off(EV.USER_DISCONNECTION,o)}}},{key:"_clearState",value:function(){var e;null===(e=this._clearListeners)||void 0===e||e.call(this),this._userId=null,this._token=null,this._loginSessionId=null,ml.setRtsSessionId(this.id,"")}}]),d}(),CW=((kr=CW||{}).onWTNPushStateChanged="onWTNPushStateChanged",kr.onWTNPlayStateChanged="onWTNPlayStateChanged",kr.onWTNRemoteAudioStateChanged="onWTNRemoteAudioStateChanged",kr.onWTNRemoteVideoStateChanged="onWTNRemoteVideoStateChanged",kr.onWTNRemoteVideoStats="onWTNRemoteVideoStats",kr.onWTNRemoteAudioStats="onWTNRemoteAudioStats",kr.onWTNFirstRemoteVideoFrameDecoded="onWTNFirstRemoteVideoFrameDecoded",kr.onWTNSEIMessageReceived="onWTNSEIMessageReceived",kr),CH=((ki=CH||{})[ki.INIT=0]="INIT",ki[ki.START=1]="START",ki[ki.SUCCESS=2]="SUCCESS",ki[ki.STOP=3]="STOP",ki[ki.FAIL=4]="FAIL",ki),CY=((kn=CY||{})[kn.PUSH_SUCCESS=0]="PUSH_SUCCESS",kn[kn.START_PUSH=1]="START_PUSH",kn[kn.STOP_PUSH=2]="STOP_PUSH",kn[kn.IN_RETRY=3]="IN_RETRY",kn[kn.RETRY_FAIL=4]="RETRY_FAIL",kn[kn.NO_PUSH_PERMISSION=5]="NO_PUSH_PERMISSION",kn[kn.STREAM_PUSH_BY_OTHER=6]="STREAM_PUSH_BY_OTHER",kn),CK=((ko=CK||{})[ko.INIT=0]="INIT",ko[ko.START=1]="START",ko[ko.SUCCESS=2]="SUCCESS",ko[ko.STOP=3]="STOP",ko[ko.FAIL=4]="FAIL",ko),CQ=((ka=CQ||{})[ka.PLAY_SUCCESS=0]="PLAY_SUCCESS",ka[ka.START_PLAY=1]="START_PLAY",ka[ka.STOP_PLAY=2]="STOP_PLAY",ka[ka.REMOTE_STOP=3]="REMOTE_STOP",ka[ka.REMOTE_FAILURE=4]="REMOTE_FAILURE",ka[ka.STREAM_BANNED=5]="STREAM_BANNED",ka[ka.NO_PLAY_PERMISSION=6]="NO_PLAY_PERMISSION",ka[ka.STREAM_NOT_EXIST=7]="STREAM_NOT_EXIST",ka[ka.IN_RETRY=8]="IN_RETRY",ka[ka.RETRY_FAIL=9]="RETRY_FAIL",ka[ka.INTERNAL=10]="INTERNAL",ka[ka.OVER_CLIENT_SUBSCRIBE_STREAM_LIMIT=1310]="OVER_CLIENT_SUBSCRIBE_STREAM_LIMIT",ka[ka.OVER_STREAM_SUBSCRIBE_USER_LIMIT=1311]="OVER_STREAM_SUBSCRIBE_USER_LIMIT",ka[ka.OVER_STREAM_SUBSCRIBE_REQUES_TLIMIT=1312]="OVER_STREAM_SUBSCRIBE_REQUES_TLIMIT",ka),Cz=((ks=Cz||{})[ks.STOPED=0]="STOPED",ks[ks.STARTING=1]="STARTING",ks[ks.DECODING=2]="DECODING",ks[ks.FROZEN=3]="FROZEN",ks[ks.FAILED=4]="FAILED",ks),CX=((kc=CX||{})[kc.INTERNAL=0]="INTERNAL",kc[kc.NETWORK_CONGESTION=1]="NETWORK_CONGESTION",kc[kc.NETWORK_RECOVERY=2]="NETWORK_RECOVERY",kc[kc.UNMUTE=3]="UNMUTE",kc[kc.MUTE=4]="MUTE",kc[kc.REMOTE_START=5]="REMOTE_START",kc[kc.REMOTE_STOP=6]="REMOTE_STOP",kc),CJ=((kd=CJ||{})[kd.STOPED=0]="STOPED",kd[kd.STARTING=1]="STARTING",kd[kd.DECODING=2]="DECODING",kd[kd.FROZEN=3]="FROZEN",kd[kd.FAILED=4]="FAILED",kd),Cq=((ku=Cq||{})[ku.INTERNAL=0]="INTERNAL",ku[ku.NETWORK_CONGESTION=1]="NETWORK_CONGESTION",ku[ku.NETWORK_RECOVERY=2]="NETWORK_RECOVERY",ku[ku.UNMUTE=3]="UNMUTE",ku[ku.MUTE=4]="MUTE",ku[ku.REMOTE_START=5]="REMOTE_START",ku[ku.REMOTE_STOP=6]="REMOTE_STOP",ku),CZ={interval:1e3,retryDuration:0},C$=function(e){hA(r,Rm);var t=hI(r);function r(e,i,n){var o,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return nK(this,r),nQ(he(o=t.call(this,n,yc.STREAM_INDEX_MAIN)),"_state",CH.INIT),nQ(he(o),"_stateChangeTs",v0()),nQ(he(o),"streamId",void 0),nQ(he(o),"Authorization",void 0),nQ(he(o),"_backOff",CZ),o.token=i,o.streamId=e,o.logName="WTNLocalStream-".concat(e),o.observer=new RI(o._ctx,he(o)),o.Authorization=v1.token2auth(n.appId,"",e,i),o._state=a?CH.FAIL:CH.INIT,o}return nY(r,[{key:"setState",value:function(e,t){var r=this._state;if(r!==e){this.logger.print("setState",e,t),this._state=e;var i=v0();this.safeEmit(CW.onWTNPushStateChanged,{streamId:this.streamId,oldState:r,newState:e,reason:t,elapse:i-this._stateChangeTs}),this._stateChangeTs=i}}},{key:"getPushBackOff",value:function(){return this._backOff}},{key:"updatePushBackOff",value:function(){this._backOff.retryDuration+=this._backOff.interval,this._backOff.interval=this._backOff.interval>4e3?8e3:2*this._backOff.interval}},{key:"resetPushBackOff",value:function(){this._backOff=CZ}}]),r}(),C0=function(e){hA(r,Rv);var t=hI(r);function r(e,i,n){var o,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return nK(this,r),nQ(he(o=t.call(this,n,e,e,!1,!0,{audiostream:!0,localaudio:!0,videostream:!0,localvideo:!0,extaudio:!1,extvideo:!1,videoDescriptions:[]})),"_state",CK.INIT),nQ(he(o),"Authorization",void 0),nQ(he(o),"_stateChangeTs",v0()),nQ(he(o),"streamId",void 0),nQ(he(o),"_backOff",CZ),nQ(he(o),"_audioState",Cz.STOPED),nQ(he(o),"_videoState",CJ.STOPED),o.token=i,o.streamId=e,o.logName="WTNRemoteStream-".concat(e),o.observer=new RR(o._ctx,he(o)),o._initObserverEvent(a),o.Authorization=v1.token2auth(n.appId,"",e,i),o._state=a?CK.FAIL:CK.INIT,o}return nY(r,[{key:"setState",value:function(e,t){var r=this._state;if(r!==e){this.logger.print("setState",e,t),this._state=e;var i=v0();this.safeEmit(CW.onWTNPlayStateChanged,{streamId:this.streamId,oldState:r,newState:e,reason:t,elapse:i-this._stateChangeTs}),this._stateChangeTs=i}}},{key:"state",get:function(){return this._state}},{key:"getPushBackOff",value:function(){return this._backOff}},{key:"updatePushBackOff",value:function(){this._backOff.retryDuration+=this._backOff.interval,this._backOff.interval=this._backOff.interval>4e3?8e3:2*this._backOff.interval}},{key:"resetPushBackOff",value:function(){this._backOff=CZ}},{key:"setVideoState",value:function(e,t){this._videoState!==e&&(e===CJ.DECODING&&this.setVideoState(CJ.STARTING,t),this.logger.print("setVideoState",e,t),this._videoState=e,this.safeEmit(CW.onWTNRemoteVideoStateChanged,{streamId:this.streamId,state:e,reason:t}))}},{key:"setAudioState",value:function(e,t){this._audioState!==e&&(e===Cz.DECODING&&this.setAudioState(Cz.STARTING,t),this.logger.print("setAudioState",e,t),this._audioState=e,this.safeEmit(CW.onWTNRemoteAudioStateChanged,{streamId:this.streamId,state:e,reason:t}))}},{key:"muteToSubMediaType",value:function(e,t){var r=!1,i=Er(this.subMediaType),n=Ei(this.subMediaType);return"boolean"==typeof e&&i===e&&(this.subMediaType+=e?-pa.AUDIO:pa.AUDIO,r=!0),"boolean"==typeof t&&n===t&&(this.subMediaType+=t?-pa.VIDEO:pa.VIDEO,r=!0),r}},{key:"getEnableMediaType",value:function(){return{audio:Er(this.subMediaType),video:Ei(this.subMediaType)}}},{key:"_initObserverEvent",value:function(e){var t,r,i=this;null===(t=this.observer)||void 0===t||t.once("recvAudioFirstFrame",function(){i.setAudioState(Cz.DECODING,e?CX.NETWORK_RECOVERY:CX.REMOTE_START)}),null===(r=this.observer)||void 0===r||r.once("recvVideoFirstFrame",function(){i.setVideoState(CJ.DECODING,e?Cq.NETWORK_RECOVERY:Cq.REMOTE_START)})}}]),r}(),C2=["rid"],C1=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},C4=function(e){hA(v,EL);var t,r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m=hI(v);function v(e){var t;return nK(this,v),nQ(he(t=m.call(this)),"_reportName","WTNStream"),nQ(he(t),"_localStreams",new d9),nQ(he(t),"_remoteStreams",new d9),nQ(he(t),"_logger",void 0),nQ(he(t),"_monitor",void 0),nQ(he(t),"_ontrackCallbackMap",new d9),nQ(he(t),"_pushTaskMap",new d9),nQ(he(t),"_playTaskMap",new d9),nQ(he(t),"engineId",void 0),nQ(he(t),"_publicVideoPlayerConfig",new d9),nQ(he(t),"__onSEIMessageReceived",void 0),nQ(he(t),"__onRemoteStreamStats",void 0),nQ(he(t),"__onResubscribe",void 0),nQ(he(t),"__onPlayerEvents",void 0),nQ(he(t),"_clearSignalListeners",void 0),t._ctx=e,t._monitor=mS(e.id),t._logger=new mJ("WTNStream",1,e.id),t.engineId=e.id,t._addSignalListeners(),t}return nY(v,[{key:"startPushWTN",value:(A=sk(sI().mark(function e(t,r,i,n){var o,a,s=this,c=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=c.length>4&&void 0!==c[4]&&c[4],i=!!i,n=!!n,this._logger.print("startPushWTN",t,r,i,n),ET(r),Eg(t)||Ef(t,"token"),!this._localStreams.get(r)){e.next=8;break}return e.abrupt("return");case 8:return a=new C$(r,t,this._ctx,o),this._addLocalStreamEventHandler(a),a.setState(CH.START,CY.START_PUSH),this._localStreams.set(r,a),e.next=14,this._ctx.signalingManager.connect();case 14:return a.videoTrack=this._ctx.localVideoTrack,a.audioTrack=this._ctx.localAudioTrack,a.pubAudio=!n,a.pubVideo=!i,e.next=20,new sP(function(e,t){o||s._pushTaskMap.set(r,{resolve:function(){e(),a.startReport(function(){},s._ctx.handler)},reject:t}),s._sendStartPushStreamSignal(a).catch(function(e){return t(e)})});case 20:case"end":return e.stop()}},e,this)})),function(e,t,r,i){return A.apply(this,arguments)})},{key:"stopPushWTN",value:(_=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.print("stopPushWTN",t),r=this._localStreams.get(t)){e.next=4;break}return e.abrupt("return");case 4:return r.setState(CH.STOP,CY.STOP_PUSH),this._ctx.signalingManager.sendSignaling("stopPushStream",{appId:this._ctx.appId,streamId:t}),e.next=8,this._stopLocalStream(r);case 8:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"muteWTNLocalAudio",value:(f=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.print("muteWTNLocalAudio",t,r),i=this._localStreams.get(t)){e.next=4;break}throw new pB(h6.INVALID_PARAMS,"streamId not found");case 4:return this._assertNotConnect(),i.pubAudio=!r,e.next=8,this._updatePushStream(i);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"muteWTNLocalVideo",value:(p=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.print("muteWTNLocalVideo",t,r),i=this._localStreams.get(t)){e.next=4;break}throw new pB(h6.INVALID_PARAMS,"streamId not found");case 4:return this._assertNotConnect(),i.pubVideo=!r,e.next=8,this._updatePushStream(i);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"sendWTNSEIMessage",value:function(e,t,r){var i=this;this._logger.info("sendWTNSEIMessage()","streamId: %o, sei: %o, repeatCount: %o",e,t,r);var n=this._localStreams.get(e);if(n&&(n.pubVideo||n.pubAudio)){if(!gi())return Es("Your browser does not support sending SEI"),!1;Ep(r,"repeatCount",0,30);var o="string"==typeof t?new Uint8Array(v1.str2ab(t)):t;if(!t.length)return this._logger.warn("sei message must not be empty"),!1;if(o.byteLength>4096)this._logger.warn("sei size must not bigger than 4KB");else{vc||this._maybeFillBackFrame2Stream(n);var a=v$();n.seiList.push({content:o,uuid:a,repeatCount:r+1}),setTimeout(function(){var e;if(n){var r,o,s=hq(e=n.seiList).call(e,function(e){return e.uuid===a});s>=0&&(uH(r=n.seiList).call(r,s,1),console.error("[RTC WebSDK] sei timeout for message: %o",t),null===(o=i._monitor)||void 0===o||o.report("rtc_sdk_callback",{sdk_callback_name:"sendSEIMessage",message:"timeout for message: ".concat(t),error_code:400}))}},vB("SEI_TIME_OUT"))}}}},{key:"startPlayWTN",value:(h=sk(sI().mark(function e(t,r,i,n){var o,a,s,c=this,d=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=d.length>4&&void 0!==d[4]&&d[4],i=!!i,n=!!n,this._logger.print("startPlayWTN",t,r,i,n),ET(r),Eg(t)||Ef(t,"token"),!(s=this._remoteStreams.get(r))){e.next=14;break}if(s.state!==CK.START&&s.state!==CK.SUCCESS){e.next=12;break}throw new pB(h6.REPEAT_PLAY,"repeat play public media stream");case 12:return e.next=14,this.stopPlayWTN(s.streamId);case 14:return s=new C0(r,t,this._ctx,a),this._addRemoteStreamEventHandler(s),s.setState(CK.START,CQ.START_PLAY),s.muteToSubMediaType(n,i),this._remoteStreams.set(r,s),null===(o=s.observer)||void 0===o||o.setLogin(!0,s.getEnableMediaType()),e.prev=20,e.next=23,this._ctx.signalingManager.connect();case 23:return e.next=25,new sP(function(e,t){a||c._playTaskMap.set(r,{resolve:e,reject:t}),c._sendStartPullStreamSignal(s).catch(function(e){return t(e)})});case 25:e.next=31;break;case 27:throw e.prev=27,e.t0=e.catch(20),this._remoteStreams.delete(r),e.t0;case 31:case"end":return e.stop()}},e,this,[[20,27]])})),function(e,t,r,i){return h.apply(this,arguments)})},{key:"stopPlayWTN",value:(l=sk(sI().mark(function e(t){var r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.print("stopPlayWTN",t),n=this._remoteStreams.get(t)){e.next=4;break}return e.abrupt("return");case 4:return n.setState(CK.STOP,CQ.STOP_PLAY),n.setAudioState(Cz.STOPED,CX.MUTE),n.setVideoState(CJ.STOPED,Cq.MUTE),null===(r=n.observer)||void 0===r||r.setLogin(!1),null==n||null===(i=n.audioTrack)||void 0===i||i.stop(),this._remoteStreams.delete(t),e.next=12,this._ctx.signalingManager.connect();case 12:return e.abrupt("return",this._unsubscribePublicStream(n));case 13:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"muteWTNRemoteAudio",value:(u=sk(sI().mark(function e(t,r){var i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.print("muteWTNRemoteAudio",t,r),this._assertNotConnect(),i=this._remoteStreams.get(t)){e.next=5;break}throw new pB(h6.INVALID_PARAMS,"streamId not found");case 5:if(!i.muteToSubMediaType(r,null)){e.next=10;break}return null===(n=i.observer)||void 0===n||n.setUnmuteAudio(!r),e.next=9,this._updatePullStream(t,i);case 9:i.setAudioState(r?Cz.STOPED:Cz.DECODING,r?CX.MUTE:CX.UNMUTE);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"muteWTNRemoteVideo",value:(d=sk(sI().mark(function e(t,r){var i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._logger.print("muteWTNRemoteVideo",t,r),this._assertNotConnect(),i=this._remoteStreams.get(t)){e.next=5;break}throw new pB(h6.INVALID_PARAMS,"streamId not found");case 5:if(!i.muteToSubMediaType(null,r)){e.next=10;break}return null===(n=i.observer)||void 0===n||n.setUnmuteVideo(!r),e.next=9,this._updatePullStream(t,i);case 9:i.setVideoState(r?CJ.STOPED:CJ.DECODING,r?Cq.MUTE:Cq.UNMUTE);case 10:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)})},{key:"setWTNRemoteVideoPlayer",value:function(e,t){var r,i;if(this._logger.print("setWTNRemoteVideoPlayer()","streamId: %o, videoPlayerOption: %o",e,t),null===(r=this._publicVideoPlayerConfig.get(e))||void 0===r||null===(i=r.player)||void 0===i||i.destroy(),t.renderDom){var n=new yK(this._ctx.id,yV,l9(l9({},t),{},{isLocal:!1,userId:e})),o=l9(l9({},t),{},{player:n});return this._publicVideoPlayerConfig.set(e,o),this._updateVideoPlayerState(e),n.domElement}this._publicVideoPlayerConfig.delete(e)}},{key:"setWTNRemoteAudioPlaybackVolume",value:function(e,t){var r,i;Ef(e,"publicStreamId"),t=Ek(t,"volume",0,400),this._ctx.publicAudioVolume.set(e,t),null===(r=this._remoteStreams.get(e))||void 0===r||null===(i=r.audioTrack)||void 0===i||i.setVolume(t)}},{key:"__getRemoteStreams",value:function(){return this._remoteStreams}},{key:"__getPublicStreamTrack",value:function(e,t){var r=this._remoteStreams.get(e);if(r)return"video"===t?r.videoTrack:r.audioTrack}},{key:"_updatePushTrack",value:(c=sk(sI().mark(function e(){var t=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this._localStreams.size){e.next=2;break}return e.abrupt("return");case 2:this._logger.info("_updatePushTrack()"),this._localStreams.forEach(function(){var e=sk(sI().mark(function e(r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.videoTrack=t._ctx.localVideoTrack,r.audioTrack=t._ctx.localAudioTrack,e.next=4,t._updatePushStream(r);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"destroy",value:function(){var e;this._remoteStreams.forEach(function(e){e.clean()}),this._remoteStreams=new d9,this.removeAllListeners(),this._ontrackCallbackMap.clear(),this._publicVideoPlayerConfig.forEach(function(e){e.player.destroy()}),this._publicVideoPlayerConfig.clear(),null===(e=this._clearSignalListeners)||void 0===e||e.call(this)}},{key:"_sendStartPushStreamSignal",value:(s=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.print("_sendStartPushStreamSignal()","streamId: %s",t.streamId),a=t.streamId,s=t.Authorization,c=t.pubAudio,d=t.pubVideo,u=this._ctx.handler,e.next=5,null==u?void 0:u.getDefaultSdp();case 5:return e.next=7,u.publish(t);case 7:return l=e.sent,e.next=10,E0();case 10:return h=e.sent,f=(p=this._ctx).appId,_=p.businessId,A=p.useCloudProxy,m={appId:f,streamId:a,Authorization:s,sdpInfo:{msid:t.stream.id,type:l.type,sdp:l.partialSdp,semantics:l.semantics},timestamp:Date.now(),params:{appId:f,businessId:_,userAgent:window.navigator.userAgent,sdkVersion:vx.VERSION,deviceId:vw.getDeviceId(),deviceType:"web",enableCloudProxy:A,channelProfile:"0",SDKCodecNegotiation:!0,supportedCodecs:h},options:{supportCheckTokenPrivilege:!0,supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0,enableStreamStatusCallback:!0},attributes:{localaudio:!!t.audioTrack,localvideo:!!t.videoTrack,videostream:d,audiostream:c,extvideo:(null===(r=t.videoTrack)||void 0===r?void 0:r.sourceType)===EY.EXTERNAL,extaudio:(null===(i=t.audioTrack)||void 0===i?void 0:i.sourceType)===EY.EXTERNAL,videoDescriptions:sU(n=l.videoDescriptions).call(n,function(e){return e.rid,l7(e,C2)}),videoType:EH.NORMAL},video:d,audio:c,screen:t.isScreen},e.prev=13,this.emit("__onSendingPushStreamMessageHook"),e.next=17,this._ctx.signalingManager.sendSignaling("startPushStream",m);case 17:v=e.sent,e.next=56;break;case 20:return e.prev=20,e.t0=e.catch(13),e.next=24,null==u?void 0:u.rollback({msid:t.stream.id,stream:t,audioMid:l.audioMid,videoMid:l.videoMid});case 24:if(!(e.t0.code>=500&&e.t0.code<600)){e.next=44;break}if(!((E=t.getPushBackOff()).retryDuration<6e4)){e.next=36;break}return this._logger.info("pushRetry","start msid: %s, retryDuration: %s",t.id,E.retryDuration),e.next=30,new sP(function(e){return setTimeout(e,E.interval)});case 30:return t.updatePushBackOff(),t.resetStream(),t.setState(CH.START,CY.IN_RETRY),e.abrupt("return",this._sendStartPushStreamSignal(t));case 36:return this._logger.info("pushRetry","end"),t.setState(CH.FAIL,CY.RETRY_FAIL),e.next=40,this._stopLocalStream(t);case 40:throw t.resetPushBackOff(),new pB(h6.WTN_PUSH_FAILED,e.t0.message||"server error");case 42:e.next=56;break;case 44:if(401!==e.t0.code){e.next=51;break}return t.setState(CH.FAIL,CY.NO_PUSH_PERMISSION),e.next=48,this._stopLocalStream(t);case 48:throw new pB(h6.WTN_PUSH_FAILED,e.t0.message||"token error");case 51:if(e.t0.code!==h6.OPERATION_CANCEL||!this._ctx.signalingManager.isReconnecting()){e.next=55;break}return e.abrupt("return");case 55:throw new pB(h6.WTN_PUSH_FAILED,e.t0.message||"push error");case 56:return t.pubAttributes=m.attributes,e.next=59,t.getSelectedCodec();case 59:if(g=e.sent,t.currentVideoCodec=g,S=new sP(function(e,r){var i,n,o,s;null==u||u.handleAck({action:Cc.publish,streamId:a,audioMid:l.audioMid,videoMid:l.videoMid,audioTransceiverInit:null==l?void 0:l.audioTransceiverInit,videoTransceiverInit:null==l?void 0:l.videoTransceiverInit,signalingAck:{sdp:null===(i=v)||void 0===i||null===(n=i.relayMessage)||void 0===n?void 0:n.sdp,sequenceId:null===(o=v)||void 0===o||null===(s=o.relayMessage)||void 0===s?void 0:s.sequenceId},stream:t,videoCodec:g,onSuccess:function(){b._logger.info("pushStream()","pushStream success"),t.setState(CH.SUCCESS,CY.PUSH_SUCCESS),e(0)},onFail:function(e){b._logger.info("pushStream()","pushStream fail"),r(e)}})}),e.t1=!m4,!e.t1){e.next=66;break}return e.next=66,S;case 66:null===(o=this._pushTaskMap.get(a))||void 0===o||o.resolve(),this._pushTaskMap.delete(a);case 68:case"end":return e.stop()}},e,this,[[13,20]])})),function(e){return s.apply(this,arguments)})},{key:"_stopLocalStream",value:(a=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopBlackFrame(),e.next=3,null===(r=this._ctx.handler)||void 0===r?void 0:r.handleAck({action:Cc.unpublish,audioMid:t.audioMid,videoMid:t.videoMid,stream:t,streamId:t.streamId});case 3:t.destroy(),this._localStreams.delete(t.streamId);case 5:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"_updatePushStream",value:(o=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.videoTrack,s=t.audioTrack,c=t.pubAudio,d=t.pubVideo,u=null===(r=t.audioTrack)||void 0===r?void 0:r.preprocessingTrack,l=null===(i=t.videoTrack)||void 0===i?void 0:i.preprocessingTrack,!d||!l){e.next=9;break}return t.stopBlackFrame(),e.next=7,null===(h=t.videoTransceiver)||void 0===h?void 0:h.sender.replaceTrack(l);case 7:e.next=11;break;case 9:return e.next=11,null===(p=t.videoTransceiver)||void 0===p?void 0:p.sender.replaceTrack(null);case 11:if(!c||!u){e.next=18;break}return A=(_=t.audioTrack).mixType,(m=_.mixedAudioTrack)&&A!==Ci.PLAYOUT&&u.enabled&&(u=m),e.next=16,null===(f=t.audioTransceiver)||void 0===f?void 0:f.sender.replaceTrack(u);case 16:e.next=20;break;case 18:return e.next=20,null===(v=t.audioTransceiver)||void 0===v?void 0:v.sender.replaceTrack(null);case 20:for(E={localaudio:!!s,localvideo:!!a,videostream:d,audiostream:c,extvideo:(null==a?void 0:a.sourceType)===EY.EXTERNAL,extaudio:(null==s?void 0:s.sourceType)===EY.EXTERNAL,videoType:a?EH.NORMAL:t.pubAttributes.videoType},g={},S=0,b=cb(E);S<b.length;S++)y=(T=sq(b[S],2))[0],(R=T[1])!==R1(t.pubAttributes,y)&&R6(g,y,R);if(cG(g).length){e.next=25;break}return e.abrupt("return");case 25:return t.pubAudio=null!==(n=E.audiostream)&&void 0!==n?n:t.pubAudio,t.pubVideo=null!==(o=E.videostream)&&void 0!==o?o:t.pubVideo,t.pubAttributes=l9(l9({},t.pubAttributes),E),t.pubAttributes.videostream||t.stopBlackFrame(),e.next=31,this._ctx.signalingManager.sendSignaling("updatePushStream",{appId:this._ctx.appId,streamId:t.streamId,attributes:E});case 31:if(!m4){e.next=34;break}return e.next=34,null===(I=this._ctx.handler)||void 0===I?void 0:I.setCurrentDescription();case 34:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"_sendStartPullStreamSignal",value:(n=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._logger.print("startPullStream()","streamId:",t.streamId),a=t.streamId,s=t.Authorization,c=this._ctx.handler,e.next=5,null==c?void 0:c.subscribe(t,{multiChatMode:!1});case 5:if(d=e.sent){e.next=8;break}throw new pB(h6.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 8:return u=v0(),l=d.audioMid,h=d.videoMid,f=(p=this._ctx).appId,_=p.businessId,A=p.useCloudProxy,e.next=13,E0();case 13:return m=e.sent,v={appId:f,streamId:a,Authorization:s,audio:!0,video:!0,screen:!1,timestamp:Date.now(),sdpInfo:{sdp:d.partialSdp,semantics:d.semantics,type:d.type},params:{appId:f,businessId:_,userAgent:window.navigator.userAgent,sdkVersion:vx.VERSION,deviceId:vw.getDeviceId(),deviceType:"web",enableCloudProxy:A,channelProfile:"0",SDKCodecNegotiation:!0,supportedCodecs:m},options:{supportCheckTokenPrivilege:!0,supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0,enableAudioMux:!0,enableBigRoomMode:!0,needNegotiateSDP:!0,supportMultiVendor:!0,enableStreamStatusCallback:!0},config:{enableMediaType:t.getEnableMediaType(),qualityLayer:{spatialLayer:0,temporalLayer:0}}},e.prev=15,this.emit("__onSendingPullStreamMessageHook"),e.next=19,this._ctx.signalingManager.sendSignaling("startPullStream",v);case 19:E=e.sent,e.next=47;break;case 22:return e.prev=22,e.t0=e.catch(15),e.next=26,null==c?void 0:c.rollback({msid:a,stream:t});case 26:if(401!==e.t0.code){e.next=31;break}throw t.setState(CK.FAIL,CQ.NO_PLAY_PERMISSION),new pB(h6.WTN_PLAY_FAILED,e.t0.message||"token error");case 31:if(433!==e.t0.code){e.next=36;break}throw t.setState(CK.FAIL,CQ.OVER_CLIENT_SUBSCRIBE_STREAM_LIMIT),new pB(h6.WTN_PLAY_FAILED,e.t0.message||"over client subscribe stream limit");case 36:if(434!==e.t0.code){e.next=41;break}throw t.setState(CK.FAIL,CQ.OVER_STREAM_SUBSCRIBE_USER_LIMIT),new pB(h6.WTN_PLAY_FAILED,e.t0.message||"over stream subscribe user limit");case 41:if(e.t0.code!==h6.OPERATION_CANCEL||!this._ctx.signalingManager.isReconnecting()){e.next=45;break}return e.abrupt("return");case 45:throw t.setState(CK.FAIL,CQ.INTERNAL),new pB(h6.WTN_PLAY_FAILED,e.t0.message||"play wtn error");case 47:return(g=[]).push(new sP(function(e,r){var i=setTimeout(function(){return r(new pB(h6.WTN_PLAY_FAILED,"wait video timeout for streamId: ".concat(a)))},6e4);t.on("ontrack",function r(n){"video"===n.mediaType&&(R._logger.success("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(i),e(0))})})),g.push(new sP(function(e,r){var i=setTimeout(function(){return r(new pB(h6.WTN_PLAY_FAILED,"wait audio timeout for streamId: ".concat(a)))},6e4);t.on("ontrack",function r(n){"audio"===n.mediaType&&(R._logger.success("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(i),e(0))})})),S=function(e){t.ontrack(e)},null===(r=this._ctx.handler)||void 0===r||r.on("ontrack",S),this._ontrackCallbackMap.set(t,S),T=(b=E.relayMessage).sequenceId,y=b.sdp,t.videoMid=h,t.audioMid=l,t.sequenceId=T,t.streamState=RA.SUB_ED,e.next=60,null===(i=this._ctx.handler)||void 0===i?void 0:i.handleAck({action:Cc.subscribe,streamId:a,audioMid:l,videoMid:h,audioTransceiverInit:d.audioTransceiverInit,videoTransceiverInit:d.videoTransceiverInit,signalingAck:{sdp:y,sequenceId:T},stream:t});case 60:return e.next=62,sP.all(g);case 62:null===(n=this._monitor)||void 0===n||n.report("rtc_subscribe_stat",{result:"success",start:u,message:"unknown",stream_user_id:t.userId}),t.startReport(function(e){e.publicStreamId=e.userId,delete e.userId,delete e.isScreen;var r,i=En(e);i.audioStats&&R.safeEmit(CW.onWTNRemoteAudioStats,{streamId:t.streamId,audioStats:i.audioStats}),i.videoStats&&R.safeEmit(CW.onWTNRemoteVideoStats,{streamId:t.streamId,videoStats:i.videoStats}),null===(r=R.__onRemoteStreamStats)||void 0===r||r.call(R,i)},this._ctx.handler),this._updateVideoPlayerState(a),this._initAudioPlayer(a),t.subVideo=t.getEnableMediaType().video,t.subAudio=t.getEnableMediaType().audio,null===(o=this._playTaskMap.get(a))||void 0===o||o.resolve(),this._playTaskMap.delete(a);case 70:case"end":return e.stop()}},e,this,[[15,22]])})),function(e){return n.apply(this,arguments)})},{key:"_unsubscribePublicStream",value:(i=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return RH("_unsubscribePublicStream()",t,this._logger),i={appId:this._ctx.appId,streamId:t.streamId},e.prev=2,e.next=5,this._ctx.signalingManager.sendSignaling("stopPullStream",i);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return t.streamState=RA.INIT,e.next=12,null===(r=this._ctx.handler)||void 0===r?void 0:r.handleAck({action:Cc.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 12:t.subMediaType=vP.NONE,this._removeOnTrackListener(t),t.statsReport.unsubscribe(),t.destroy();case 16:case"end":return e.stop()}},e,this,[[2,7]])})),function(e){return i.apply(this,arguments)})},{key:"_updatePullStream",value:(r=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.getEnableMediaType(),e.next=3,this._ctx.signalingManager.sendSignaling("updatePullStream",{appId:this._ctx.appId,streamId:t,config:{enableMediaType:i}});case 3:r.subVideo=i.video,r.subAudio=i.audio;case 5:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"_removeOnTrackListener",value:function(e){var t=this._ontrackCallbackMap.get(e);if(t){var r=e.vendorHandler||this._ctx.handler;null==r||r.off("ontrack",t),this._ontrackCallbackMap.delete(e)}}},{key:"_addSignalListeners",value:function(){var e,t,r=this,i=(nQ(e={},Ej.ON_CONNECTION_STATE_CHANGE,function(e){var t,i;e.state===pc.CONNECTION_STATE_RECONNECTED?(pZ(fY(t=r._remoteStreams).call(t)).forEach(function(e){var t=e.streamId,i=e.token,n=e.getEnableMediaType(),o=n.audio,a=n.video;e.destroy(),r._remoteStreams.delete(t),r.startPlayWTN(i,t,!a,!o,!0).then(function(){var t;null===(t=r.__onResubscribe)||void 0===t||t.call(r,{stream:e})})}),pZ(fY(i=r._localStreams).call(i)).forEach(function(e){var t=e.token,i=e.pubAudio,n=e.pubVideo;e.destroy(),r._localStreams.delete(e.streamId),r.startPushWTN(t,e.streamId,!n,!i,!0)})):e.state===pc.CONNECTION_STATE_DISCONNECTED&&(r._remoteStreams.forEach(function(e){e.setState(CK.FAIL,CQ.IN_RETRY),e.setAudioState(Cz.FROZEN,CX.NETWORK_CONGESTION),e.setVideoState(CJ.FROZEN,Cq.NETWORK_CONGESTION)}),r._localStreams.forEach(function(e){e.setState(CH.FAIL,CY.IN_RETRY)}))}),nQ(e,EV.ON_STREAM_PUSHED_BY_OTHER,function(e){var t=r._localStreams.get(e.streamId);r._logger.print("_addSignalListeners","onStreamPushedByOther",e.streamId),t&&(t.setState(CH.FAIL,CY.STREAM_PUSH_BY_OTHER),r._stopLocalStream(t))}),nQ(e,EV.ON_STREAM_PULL_STATE_CHANGED,(t=sk(sI().mark(function e(t){var i,n,o,a,s;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r._remoteStreams.get(t.streamId),r._logger.print("_addSignalListeners","onStreamPullStateChanged",t),i){e.next=4;break}return e.abrupt("return");case 4:e.t0=t.code,e.next=0===e.t0?7:1===e.t0||2===e.t0||3===e.t0?9:4===e.t0?14:32;break;case 7:return i.setState(CK.SUCCESS,CQ.PLAY_SUCCESS),e.abrupt("break",32);case 9:return n=({1:CQ.STREAM_NOT_EXIST,2:CQ.REMOTE_STOP,3:CQ.REMOTE_FAILURE})[t.code],i.setAudioState(Cz.STOPED,CX.REMOTE_STOP),i.setVideoState(CJ.STOPED,Cq.REMOTE_STOP),i.setState(CK.FAIL,n),e.abrupt("break",32);case 14:if(!((o=i.getPushBackOff()).retryDuration<6e4)){e.next=28;break}return r._logger.info("subRetry",i.streamId,o.retryDuration),i.setState(CK.START,CQ.IN_RETRY),e.next=20,new sP(function(e){return setTimeout(e,o.interval)});case 20:return i.updatePushBackOff(),e.next=23,null===(a=r._ctx)||void 0===a||null===(s=a.handler)||void 0===s?void 0:s.handleAck({action:Cc.unsubscribe,streamId:i.streamId,audioMid:i.audioMid,videoMid:i.videoMid,stream:i});case 23:return i.clean(),e.next=26,r._sendStartPullStreamSignal(i);case 26:e.next=31;break;case 28:i.setState(CK.FAIL,CQ.RETRY_FAIL),r._logger.info("subRetry","end",i.streamId),i.resetPushBackOff();case 31:return e.abrupt("break",32);case 32:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})),e);cG(i).forEach(function(e){r._ctx.signalingManager.on(e,i[e])}),this._clearSignalListeners=function(){cG(i).forEach(function(e){r._ctx.signalingManager.off(e,i[e])})}}},{key:"_addLocalStreamEventHandler",value:function(e){var t=this;e.on(CW.onWTNPushStateChanged,function(e){t.safeEmit(CW.onWTNPushStateChanged,e)})}},{key:"_addRemoteStreamEventHandler",value:function(e){var t=this;e.on(CW.onWTNPlayStateChanged,function(e){t.safeEmit(CW.onWTNPlayStateChanged,e)}),e.on(CW.onWTNRemoteAudioStateChanged,function(e){t.safeEmit(CW.onWTNRemoteAudioStateChanged,e)}),e.on(CW.onWTNRemoteVideoStateChanged,function(e){t.safeEmit(CW.onWTNRemoteVideoStateChanged,e)}),e.on("onSEIMessage",function(r){if(r instanceof Uint8Array)for(var i,n=function(e){var t=new DataView(e.buffer);if(t.byteLength<=4||65535!==t.getUint16(0))return{seiCount:1,seis:[e]};for(var r={seiCount:0,seis:[]},i=!1,n=2;n<t.byteLength;){var o=t.getUint16(n);if(n+=2,t.byteLength-n<o){i=!0;break}var a=new Uint8Array(e.buffer,n,o);if(n+=o,t.byteLength-n>0&&t.byteLength-n<=2){i=!0;break}r.seiCount++,r.seis.push(a)}return i&&(r.seiCount=1,r.seis=[e]),r}(r),o=0;o<n.seiCount;o++)null===(i=t.__onSEIMessageReceived)||void 0===i||i.call(t,{sei:n.seis[o],publicStreamId:e.streamId}),t.safeEmit(CW.onWTNSEIMessageReceived,{streamId:e.streamId,sei:n.seis[o]})})}},{key:"_updateVideoPlayerState",value:function(e){var t=this._remoteStreams.get(e);if(t){var r,i,n=this._publicVideoPlayerConfig.get(e);n&&(null===(r=t.videoTrack)||void 0===r||r.setPlayer(this._ctx.id,n,null===(i=this._ctx)||void 0===i?void 0:i.autoPlayPolicy,this._initPlayerEvents.bind(this)))}}},{key:"_initAudioPlayer",value:function(e){var t=this._remoteStreams.get(e);if(null!=t&&t.audioTrack){var r,i,n=new yQ(this._ctx.id,e,{muted:(null===(r=this._ctx)||void 0===r?void 0:r.autoPlayPolicy)===py.VIDEO_ONLY||(null===(i=this._ctx)||void 0===i?void 0:i.autoPlayPolicy)===py.PLAY_MANUALLY,isScreen:!1});t.audioTrack.setPlayer(n),t.audioTrack.bindPlayerEvent(this._initPlayerEvents.bind(this)),t.audioTrack.play()}}},{key:"_initPlayerEvents",value:function(e){var t,r=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:po.STREAM_INDEX_MAIN;null===(t=this.__onPlayerEvents)||void 0===t||t.call(this,e,i,n),e.on("playback_event",function(t){var i=r._remoteStreams.get(e.userId);if("loadeddata"===t.eventName){var n=function(){i&&"video"===t.type&&r.safeEmit(CW.onWTNFirstRemoteVideoFrameDecoded,{streamId:i.streamId})};null==i||!i.observer||i.observer.audioFirstFrameReceived?n():i.observer.once("recvVideoFirstFrame",n)}})}},{key:"_maybeFillBackFrame2Stream",value:(t=sk(sI().mark(function e(t){var r,i,n,o,a=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.refreshBlackFrameLifetime(),null!==(r=t.videoTransceiver)&&void 0!==r&&r.sender.track){e.next=9;break}if(o=t.genBlackFrame()){e.next=5;break}return e.abrupt("return");case 5:null===(i=t.videoTransceiver)||void 0===i||null===(n=i.sender)||void 0===n||n.replaceTrack(o),t.pubAttributes.videoType=EH.BLACK,this._ctx.signalingManager.sendSignaling("updatePushStream",{streamId:t.streamId,appId:this._ctx.appId,attributes:{videoType:EH.BLACK}}),t.on("black-frame-ended",function(){var e,r;null===(e=t.videoTransceiver)||void 0===e||null===(r=e.sender)||void 0===r||r.replaceTrack(null),t.pubAttributes.videoType=EH.NORMAL,a._ctx.signalingManager.sendSignaling("updatePushStream",{streamId:t.streamId,appId:a._ctx.appId,attributes:{videoType:EH.NORMAL}})});case 9:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"safeEmit",value:function(e){for(var t,r,i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return mk(this._ctx.id,e,n),(t=hf(hp(v.prototype),"safeEmit",this)).call.apply(t,sN(r=[this,e]).call(r,n))}},{key:"_assertNotConnect",value:function(){if(!this._ctx.signalingManager.isConnected())throw new pB(h6.NOT_CONNECTED_YET,"server not connected")}}]),v}();C1([mR()],C4.prototype,"startPushWTN",1),C1([mR()],C4.prototype,"stopPushWTN",1),C1([mR()],C4.prototype,"muteWTNLocalAudio",1),C1([mR()],C4.prototype,"muteWTNLocalVideo",1),C1([mR()],C4.prototype,"sendWTNSEIMessage",1),C1([mR()],C4.prototype,"startPlayWTN",1),C1([mR()],C4.prototype,"stopPlayWTN",1),C1([mR()],C4.prototype,"muteWTNRemoteAudio",1),C1([mR()],C4.prototype,"muteWTNRemoteVideo",1),C1([mR()],C4.prototype,"setWTNRemoteVideoPlayer",1),C1([mR()],C4.prototype,"setWTNRemoteAudioPlaybackVolume",1),C1([CT],C4.prototype,"_sendStartPushStreamSignal",1),C1([CT],C4.prototype,"_stopLocalStream",1),C1([CT],C4.prototype,"_sendStartPullStreamSignal",1),C1([CT],C4.prototype,"_unsubscribePublicStream",1);var C6=new mJ("AudioDeviceManager",1),C3=function(e){hA(c,EN.EventEmitter);var t,r,i,n,o,a,s=hI(c);function c(e){var t;return nK(this,c),nQ(he(t=s.call(this)),"_audioLevelFetcher",void 0),nQ(he(t),"_playbackDeviceTestTimer",void 0),nQ(he(t),"_audioElement",void 0),nQ(he(t),"_audioTrack",void 0),nQ(he(t),"_mediaRecorder",void 0),nQ(he(t),"_recoderTimer",void 0),nQ(he(t),"_isAudioPlaybackDeviceTesting",!1),nQ(he(t),"_isAudioDeviceRecordTesting",!1),nQ(he(t),"_audioCaptureAndRecoderResolve",void 0),nQ(he(t),"_onAutoplayFailed",void 0),nQ(he(t),"_audioPlaybackDeviceId",void 0),t._ctx=e,t}return nY(c,[{key:"audioTrack",get:function(){return this._audioTrack}},{key:"startAudioPlaybackDeviceTest",value:(a=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAudioPlaybackDeviceTesting&&!this._isAudioDeviceRecordTesting){e.next=2;break}throw new pB(h6.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 2:return this._isAudioPlaybackDeviceTesting=!0,C6.info("startAudioPlaybackDeviceTest()","Invoke"),e.prev=4,e.next=7,this._playAudioFile(t,{loop:!0});case 7:e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(4),C6.error("startAudioPlaybackDeviceTest()","error",e.t0),this.stopAudioPlaybackDeviceTest(),e.t0;case 14:this._startEmitAudioPlaybackDeviceTestVolume(r);case 15:case"end":return e.stop()}},e,this,[[4,9]])})),function(e,t){return a.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this._isAudioPlaybackDeviceTesting&&(C6.info("stopAudioPlaybackDeviceTest()","Invoke"),this._isAudioPlaybackDeviceTesting=!1,this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement())}},{key:"startAudioDeviceRecordTest",value:(o=sk(sI().mark(function e(t,r,i){var n,o=this,a=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>3&&void 0!==a[3]?a[3]:3e4,window.MediaRecorder){e.next=3;break}throw new pB(h6.NOT_SUPPORTED,"Your browser does not support MediaRecorder.");case 3:if(!this._isAudioDeviceRecordTesting&&!this._isAudioPlaybackDeviceTesting){e.next=5;break}throw new pB(h6.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 5:return this._isAudioDeviceRecordTesting=!0,C6.info("startAudioDeviceRecordTest()","Invoke"),this._recoderTimer=setTimeout(function(){C6.info("startAudioDeviceRecordTest()","".concat(n,'ms automatic call method "stopAudioDeviceRecordAndPlayTest"')),o._stopAudioCaptureAndRecoder()},n),e.prev=8,this._onAutoplayFailed=r,e.next=12,this._startAudioCaptureAndRecoder(t,null!=i?i:100);case 12:e.next=19;break;case 14:throw e.prev=14,e.t0=e.catch(8),this._isAudioDeviceRecordTesting=!1,delete this._onAutoplayFailed,e.t0;case 19:delete this._audioCaptureAndRecoderResolve;case 20:case"end":return e.stop()}},e,this,[[8,14]])})),function(e,t,r){return o.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){C6.info("stopAudioDeviceRecordAndPlayTest()","Invoke"),void 0!==this._recoderTimer&&(clearTimeout(this._recoderTimer),delete this._recoderTimer),this._stopAudioCaptureAndRecoder()}},{key:"stopAudioDevicePlayTest",value:function(){this._isAudioDeviceRecordTesting&&(C6.info("stopAudioDevicePlayTest()","Invoke"),this._isAudioDeviceRecordTesting=!1,this._mediaRecorder&&(this._mediaRecorder.ondataavailable=null),this.stopAudioDeviceRecordAndPlayTest(),this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement()),delete this._onAutoplayFailed}},{key:"getRecordTrack",value:function(){return this._audioTrack}},{key:"setSinkId",value:(n=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(C6.info("setSinkId()","Invoke"),void 0!==HTMLAudioElement.prototype.setSinkId){e.next=3;break}throw new pB(h6.NOT_SUPPORTED,"setSinkId not supported by current browser");case 3:return e.next=5,yT.getAudioPlaybackDeviceById(t);case 5:if(r=e.sent){e.next=8;break}throw new pB(h6.INVALID_DEVICE_ID,"audio playback device id ".concat(t," is invalid"));case 8:return this._audioPlaybackDeviceId=t,this._setAudioCtxSinkId(),e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getSinkId",value:function(){return this._audioPlaybackDeviceId}},{key:"destroy",value:function(){C6.info("destroy()","Invoke"),hf(hp(c.prototype),"removeAllListeners",this).call(this),this.stopAudioPlaybackDeviceTest(),this.stopAudioDevicePlayTest()}},{key:"_playAudioFile",value:(i=sk(sI().mark(function e(t,r){var i,n=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return C6.info("_playAudioFile()",sN(i="Invoke url=".concat(t,"; loop=")).call(i,r.loop)),e.abrupt("return",new sP(function(e,i){var o=yb("audio",{attributes:{src:t,crossOrigin:"anonymous"}});n._audioElement=o,o.loop=r.loop,n._audioLevelFetcher=new yE(o),o.onplaying=function(){o.onplaying=null,C6.info("_playAudioFile()","onplaying"),e()},o.onerror=function(){var e=sk(sI().mark(function e(t){var r,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:C6.error("_playAudioFile()","onerror",t),n=t.message||(null==o||null===(r=o.error)||void 0===r?void 0:r.message),i(new pB(h6.LOAD_RESOURCES_FAILED,"Failed to play recorded audio".concat(n?", reason: ".concat(n):".")));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n._setAudioCtxSinkId().then(function(){var e,t;return null===(e=o.play())||void 0===e||null===(t=e.catch)||void 0===t?void 0:t.call(e,function(e){C6.warn("_playAudioFile()","autoplay error",e);var t,r=sN(t="Failed to play recorded audio, ".concat(e.name,": ")).call(t,e.message);"NotAllowedError"===e.name&&n._onAutoplayFailed?n._onAutoplayFailed(function(){var e;return sP.all([null===(e=n._audioLevelFetcher)||void 0===e?void 0:e.resume(),o.play()])}):i(new pB(h6.LOAD_RESOURCES_FAILED,r))})})}));case 2:case"end":return e.stop()}},e)})),function(e,t){return i.apply(this,arguments)})},{key:"_destroyAudioElement",value:function(){this._audioElement&&(C6.info("_destroyAudioElement()","Invoke"),this._audioElement.onplaying=null,this._audioElement.onerror=null,this._audioElement.src="",delete this._audioElement,"function"==typeof this._audioCaptureAndRecoderResolve&&this._audioCaptureAndRecoderResolve())}},{key:"_startEmitAudioPlaybackDeviceTestVolume",value:function(e){var t=this;e=Math.max(e,100),this._audioElement&&(C6.info("_startEmitAudioPlaybackDeviceTestVolume()","start timer(".concat(e,"ms)")),this._playbackDeviceTestTimer=self.setInterval(function(){t._audioLevelFetcher&&t.emit("onAudioPlaybackDeviceTestVolume",t._audioLevelFetcher.getAudioLevel())},e))}},{key:"_stopEmitAudioPlaybackDeviceTestVolume",value:function(){var e;void 0!==this._playbackDeviceTestTimer&&(C6.info("_stopEmitAudioPlaybackDeviceTestVolume()","stop timer"),self.clearInterval(this._playbackDeviceTestTimer),delete this._playbackDeviceTestTimer),null===(e=this._audioLevelFetcher)||void 0===e||e.destroy(),delete this._audioLevelFetcher}},{key:"_startAudioCaptureAndRecoder",value:(r=sk(sI().mark(function e(t,r){var i,n=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y7(this._ctx,this._ctx.audioProfileManager.getConstraints());case 2:return this._audioTrack=e.sent,this._audioTrack.setVolume(r+.01),i=new MediaStream([this._audioTrack.preprocessingTrack]),C6.info("startAudioDeviceRecordTest()","create microphone track success!"),e.abrupt("return",new sP(function(e,r){"function"==typeof MediaRecorder.isTypeSupported&&(o=uC(a=["audio/webm","audio/mp4"]).call(a,function(e){return MediaRecorder.isTypeSupported(e)}),C6.info("startAudioDeviceRecordTest()","use mimeType: ".concat(o))),n._mediaRecorder=new MediaRecorder(i,o?{mimeType:o}:void 0);var o,a,s=n._mediaRecorder.mimeType;n._mediaRecorder.ondataavailable=function(){var i=sk(sI().mark(function i(o){var a,c;return sI().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!n._isAudioDeviceRecordTesting){i.next=16;break}return C6.info("startAudioDeviceRecordTest()","get recorded file(mimeType: ".concat(s,").")),c=new Blob([o.data],{type:s}),i.prev=3,i.next=6,n._playAudioFile(Tn.createObjectURL(c),{loop:!1});case 6:i.next=11;break;case 8:return i.prev=8,i.t0=i.catch(3),i.abrupt("return",r(i.t0));case 11:n._startEmitAudioPlaybackDeviceTestVolume(t),null===(a=n._audioElement)||void 0===a||a.addEventListener("ended",function(){n.stopAudioDevicePlayTest(),e()}),n._audioCaptureAndRecoderResolve=e,i.next=17;break;case 16:e();case 17:case"end":return i.stop()}},i,null,[[3,8]])}));return function(e){return i.apply(this,arguments)}}(),n._mediaRecorder.onerror=function(e){r(new pB(h6.AUDIO_DEVICE_TEST_FAILED,e.message||"mediaRecorder error"))},n._audioCaptureAndRecoderResolve=e,n._mediaRecorder.start()}));case 7:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"_stopAudioCaptureAndRecoder",value:function(){var e;this._mediaRecorder&&("recording"===this._mediaRecorder.state&&this._mediaRecorder.stop(),delete this._mediaRecorder),null===(e=this._audioTrack)||void 0===e||e.destroy(),delete this._audioTrack}},{key:"_setAudioCtxSinkId",value:(t=sk(sI().mark(function e(){var t,r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._audioPlaybackDeviceId){"default"===t&&(t="");try{null===(r=yS.getAudioContextInstance())||void 0===r||null===(i=r.setSinkId)||void 0===i||i.call(r,t),C6.info("setSinkId","ctx.sinkId=".concat(t))}catch(e){C6.error("setSinkId",sN(n="failed, ".concat(e.name," - ")).call(n,e.message))}}case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),c}(),C8=function(){return{url:"",video:{codec:pI.H264,width:640,height:360,fps:15,gop:2,kBitRate:C5(640,360,15)},audio:{codec:"AAC",kBitRate:64,sampleRate:48e3,channels:2,AACProfile:pR.LC},layout:{regions:[],appData:"",backgroundColor:"#000000"}}};function C5(e,t,r){return e*t<=288e3?r<=15?800:1200:e*t<=864e3?r<=15?1200:1800:e*t<=1152e3?r<=15?1600:2400:e*t<=2592e3?r<=15?2500:3750:r<=15?3300:5e3}function C9(e){if("string"!=typeof e||!/^rtmps?:\/\//.test(e))throw new pB(h6.INVALID_PARAMS,"Invalid rtmp address")}function C7(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(null==e||!e.length)throw new pB(h6.INVALID_PARAMS,"regions should not be empty.");var t,r=sz(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if("string"!=typeof i.userId)throw new pB(h6.INVALID_PARAMS,"region.userId(".concat(i.userId,") should be a string."));if(Eb(i.userId),"boolean"!=typeof i.isScreenStream)throw new pB(h6.INVALID_PARAMS,"region.isScreenStream(".concat(i.isScreenStream,") should be a boolean."))}}catch(e){r.e(e)}finally{r.f()}}function ke(e,t){var r,i,n,o=function(e,r){var i=c_(e).call(e,function(e,t){return null==e?void 0:e[t]},t),n=c_(e).call(e,function(e,t){return null==e?void 0:e[t]},C8());return i&&r(i)?i:n},a=function(e){return e%2==0?e:e+1},s=a(o(["video","width"],function(e){return e>=2&&e<=1920})),c=a(o(["video","height"],function(e){return e>=2&&e<=1920})),d=o(["video","fps"],function(e){return e>=1&&e<=60}),u=(null===(r=t.video)||void 0===r?void 0:r.kBitRate)||0,l=o(["audio","sampleRate"],function(e){var t;return!!uC(t=[32e3,44100,48e3]).call(t,function(t){return t===e||t/1e3===e})});return{type:"transcode",action:e,transcodeMeta:{transcode:{url:t.url},control:{protocol:"2.0"},audio:{codec:o(["audio","codec"],function(e){return"AAC"===e}),bitRate:1e3*o(["audio","kBitRate"],function(e){return e>=32&&e<=192}),sampleRate:l<100?1e3*l:l,channels:o(["audio","channels"],function(e){var t;return cd(t=[1,2]).call(t,e)}),profile:o(["audio","AACProfile"],function(e){var t;return cd(t=[pR.LC,pR.HEv1,pR.HEv2]).call(t,e)})},video:{codec:o(["video","codec"],function(e){var t;return cd(t=["H264","H265"]).call(t,e)}),fps:d,gop:o(["video","gop"],function(e){return e>=1&&e<=5})*d,bitRate:1e3*(u>=16&&u<=1e4?u:C5(s,c,d)),width:s,height:c},layout:{canvas:{bgnd:o(["layout","backgroundColor"],function(e){return/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/.test(e)})},regions:(null===(i=t.layout)||void 0===i||null===(n=i.regions)||void 0===n?void 0:sU(n).call(n,function(e){var t,r;return{alpha:!e.alpha||Number(e.alpha)>1||0>=Number(e.alpha)?1:Number(e.alpha),uid:e.userId,zorder:!e.zorder||0>Number(e.zorder)||Number(e.zorder)>100?0:Number(e.zorder),x:!e.x||Number(e.x)>=1||0>Number(e.x)?0:Number(e.x),y:!e.y||Number(e.y)>=1||0>Number(e.y)?0:Number(e.y),w:!e.w||Number(e.w)>1||0>=Number(e.w)?1:Number(e.w),h:!e.h||Number(e.h)>1||0>=Number(e.h)?1:Number(e.h),renderMode:e.renderMode&&cd(t=[1,2,3]).call(t,e.renderMode)?e.renderMode:1,contentControl:e.contentControl&&cd(r=[0,1,2]).call(r,e.contentControl)?e.contentControl:0,screen:!!e.isScreenStream}}))||[],app_data:o(["layout","appData"],function(e){return"string"==typeof e})}}}}var kt,kr,ki,kn,ko,ka,ks,kc,kd,ku,kl,kh={getDefaultValue:C8,checkStartParams:function(e){var t;C9(e.url),C7(null===(t=e.layout)||void 0===t?void 0:t.regions)},checkUpdateParams:function(e){var t;e.url&&C9(e.url),C7(null===(t=e.layout)||void 0===t?void 0:t.regions)},getStartParams:function(e){return ke("started",e)},getUpdateParams:function(e){return ke("layoutChanged",e)}},kp=function(e){kl&&clearTimeout(kl),kl=setTimeout(function(){var t,r=sz(e);try{for(r.s();!(t=r.n()).done;){var i=sq(t.value,2),n=i[0],o=i[1];null!=n&&h4(n).call(n,"mux")&&o.forEach(function(e){var t;null===(t=e.audioTrack)||void 0===t||t.pause()})}}catch(e){r.e(e)}finally{r.f()}var a,s=sz(e);try{for(s.s();!(a=s.n()).done;){var c=sq(a.value,2),d=c[0],u=c[1];null!=d&&h4(d).call(d,"mux")&&u.forEach(function(e){var t;null===(t=e.audioTrack)||void 0===t||t.play()})}}catch(e){s.e(e)}finally{s.f()}},2e3)};ti({target:"Object",stat:!0},{fromEntries:function(e){var t={};return oR(e,function(e,r){tE(t,e,r)},{AS_ENTRIES:!0}),t}});var kf,k_=q.Object.fromEntries,kA=d(k_),km=["ele","fakeEle"],kv=["orgTrack","mediaTrack","preprocessingTrack"],kE=["orgTrack","mediaTrack","preprocessingTrack"],kg=["currentTime","duration","ended","error","muted","networkState","paused","readyState","seekable","sinkId","src","volume"],kS=["currentTime","sampleRate","state","baseLatency","outputLatency","sinkId"],kb=["contentHint","enabled","id","kind","label","muted","readyState"],kT=["currentDirection","direction","mid","stopped"];function ky(){return(ky=sk(sI().mark(function e(t){var r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Date.now(),i=[],!t._ctx.handler||!t._ctx.handler._peerConnection){e.next=6;break}return e.next=5,t._ctx.handler._peerConnection.getStats();case 5:i=e.sent;case 6:return n=[],i.forEach(function(e){n.push(e)}),e.abrupt("return",{timestamp:r,stats:n});case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function kR(e){var t={};if(e instanceof MediaStream){t.id=e.id,t.active=e.active;var r=e.getTracks();t.tracks=sU(r).call(r,function(e){return kA(sU(kb).call(kb,function(t){return[t,e[t]]}))})}return t}function kI(){return(kI=sk(sI().mark(function e(t){var r,i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),i=[],t._videoPlayer&&i.push({userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,ele:t._videoPlayer._videoDom}),t._screenPlayer&&i.push({userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,ele:t._screenPlayer._videoDom}),t._remoteVideoPlayer&&t._remoteVideoPlayer.forEach(function(e,t){i.push({userId:t,mediaType:"video",isScreen:!1,isPublic:!1,ele:e?e._videoDom:void 0})}),t._remoteScreenPlayer&&(null===(n=t._remoteScreenPlayer)||void 0===n||n.forEach(function(e,t){i.push({userId:t,mediaType:"video",isScreen:!0,isPublic:!1,ele:e?e._videoDom:void 0})})),t._remoteAudioPlayer&&t._remoteAudioPlayer.forEach(function(e,t){i.push({userId:t,mediaType:"audio",isScreen:!1,isPublic:!1,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})}),t._remoteScreenAudioPlayer&&t._remoteScreenAudioPlayer.forEach(function(e,t){i.push({userId:t,mediaType:"audio",isScreen:!0,isPublic:!1,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})}),t._publicStreamVideoPlayer&&t._publicStreamVideoPlayer.forEach(function(e,t){i.push({userId:t,mediaType:"video",isScreen:!1,isPublic:!0,ele:e?e._videoDom:void 0})}),t._publicStreamAudioPlayer&&t._publicStreamAudioPlayer.forEach(function(e,t){i.push({userId:t,mediaType:"audio",isScreen:!1,isPublic:!0,ele:e?e._audioDom:void 0,fakeEle:e?e._fakeAudioDom:void 0})}),t._localVideoTrack&&t._localVideoTrack.videoPlayers&&t._localVideoTrack.videoPlayers.forEach(function(e,t){i.push({playerId:t.toString(),userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,ele:e._videoDom})}),t._localScreenTrack&&t._localScreenTrack.videoPlayers&&t._localScreenTrack.videoPlayers.forEach(function(e,t){i.push({playerId:t.toString(),userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,ele:e._videoDom})}),t._room&&t._room._remoteStreams&&t._room._remoteStreams.forEach(function(e,t){e.forEach(function(e){if(e.audioTrack){var r=e.audioTrack._audioPlayer;i.push({userId:t,mediaType:"audio",isScreen:e.isScreen,isPublic:!1,ele:r?r._audioDom:void 0,fakeEle:r?r._fakeAudioDom:void 0})}e.videoTrack&&e.videoTrack.videoPlayers&&e.videoTrack.videoPlayers.forEach(function(r,n){i.push({playerId:n.toString(),userId:t,mediaType:"video",isScreen:e.isScreen,isPublic:!1,ele:r?r._videoDom:void 0})})})}),(o=t._publicStreamManager)||(o=t._outsideRoom),o&&o.remoteStreams&&o.remoteStreams.forEach(function(e,t){if(e.audioTrack){var r=e.audioTrack._audioPlayer;i.push({userId:t,mediaType:"audio",isScreen:!1,isPublic:!0,ele:r?r._audioDom:void 0,fakeEle:r?r._fakeAudioDom:void 0})}e.videoTrack&&e.videoTrack.videoPlayers&&e.videoTrack.videoPlayers.forEach(function(e,r){i.push({playerId:r.toString(),userId:t,mediaType:"video",isScreen:!1,isPublic:!0,ele:e?e._videoDom:void 0})})}),t&&t._room&&t._room._virtualStreams&&t._room._virtualStreams.forEach(function(e,t){if(e.audioTrack){var r=e.audioTrack._audioPlayer;i.push({userId:"virtualStream-".concat(t),mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!0,ele:r?r._audioDom:void 0,fakeEle:r?r._fakeAudioDom:void 0})}}),a=sU(i).call(i,function(e){var t=e.ele,r=e.fakeEle,i=l7(e,km),n=l9({ele:l9({srcObject:t?kR(t.srcObject):void 0},kA(sU(kg).call(kg,function(e){return[e,t[e]]})))},i);return r&&(n.fakeEle=l9({srcObject:kR(r.srcObject)},kA(sU(kg).call(kg,function(e){return[e,r[e]]})))),n}),e.abrupt("return",{timestamp:r,elementStats:a});case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}function kC(e){var t,r=[],i=[];e&&e._room&&e._room._remoteStreams&&(i=fY(t=e._room._remoteStreams).call(t));var n,o=sz(i);try{for(o.s();!(n=o.n()).done;)n.value.forEach(function(e){e.audioTrack&&r.push(e.audioTrack)})}catch(e){o.e(e)}finally{o.f()}e._localAudioTrack&&r.push(e._localAudioTrack),e._localScreenAudioTrack&&r.push(e._localScreenAudioTrack);for(var a=0;a<r.length;a++){var s,c,d=r[a];if(d._audioLevelFetcher&&d._audioLevelFetcher._ctx)return d._audioLevelFetcher._ctx;if(d._ac)return d._ac;if(d._audioFetchMap&&pZ(fY(s=d._audioFetchMap).call(s)).length)return pZ(fY(c=d._audioFetchMap).call(c))[0]._ctx;if(d._ap&&d._ap._ac)return d._ap._ac}return null}function kk(){return(kk=sk(sI().mark(function e(t){var r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Date.now(),i=kC(t),n={},i){e.next=5;break}return e.abrupt("return",{timestamp:r,acState:void 0});case 5:return kS.forEach(function(e){n[e]=i[e]}),e.abrupt("return",{timestamp:r,acState:n});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function kw(e){var t=[];e._localAudioTrack&&t.push({userId:"__local__",mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!1,orgTrack:e._localAudioTrack._originTrack,mediaTrack:e._localAudioTrack._mediaTrack,preprocessingTrack:e._localAudioTrack._preProcessingTrack}),e._localScreenAudioTrack&&t.push({userId:"__local__",mediaType:"audio",isScreen:!0,isPublic:!1,isVirtual:!1,orgTrack:e._localScreenAudioTrack._originTrack,mediaTrack:e._localScreenAudioTrack._mediaTrack,preprocessingTrack:e._localScreenAudioTrack._preProcessingTrack}),e._localVideoTrack&&t.push({userId:"__local__",mediaType:"video",isScreen:!1,isPublic:!1,isVirtual:!1,orgTrack:e._localVideoTrack._originTrack,mediaTrack:e._localVideoTrack._mediaTrack,preprocessingTrack:e._localVideoTrack._preProcessingTrack}),e._localScreenVideoTrack&&t.push({userId:"__local__",mediaType:"video",isScreen:!0,isPublic:!1,isVirtual:!1,orgTrack:e._localScreenVideoTrack._originTrack,mediaTrack:e._localScreenVideoTrack._mediaTrack,preprocessingTrack:e._localScreenVideoTrack._preProcessingTrack}),e._room&&e._room._remoteStreams&&e._room._remoteStreams.forEach(function(e,r){e.forEach(function(e){e.audioTrack&&t.push({userId:r,mediaType:"audio",isScreen:e.isScreen,isPublic:!1,isVirtual:!1,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:r,mediaType:"video",isScreen:e.isScreen,isPublic:!1,isVirtual:!1,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})})});var r=e._publicStreamManager;return r||(r=e._outsideRoom),r&&r.remoteStreams&&r.remoteStreams.forEach(function(e,r){e.audioTrack&&t.push({userId:r,mediaType:"audio",isScreen:e.isScreen,isPublic:!0,isVirtual:!1,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:r,mediaType:"video",isScreen:e.isScreen,isPublic:!0,isVirtual:!1,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})}),e&&e._room&&e._room._virtualStreams&&e._room._virtualStreams.forEach(function(e,r){e.audioTrack&&t.push({userId:"virtualStream-".concat(r),mediaType:"audio",isScreen:!1,isPublic:!1,isVirtual:!0,orgTrack:e.audioTrack._originTrack,mediaTrack:e.audioTrack._mediaTrack}),e.videoTrack&&t.push({userId:"virtualStream-".concat(r),mediaType:"video",isScreen:!1,isPublic:!1,isVirtual:!0,orgTrack:e.videoTrack._originTrack,mediaTrack:e.videoTrack._mediaTrack})}),t}function kO(e,t){return kN.apply(this,arguments)}function kN(){return(kN=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=2048,n=50,o=128,a=256,s=2,t){e.next=7;break}return e.abrupt("return",void 0);case 7:return(c=new MediaStream).addTrack(t),d=r.createMediaStreamSource(c),u=r.createAnalyser(),d.connect(u),"suspended"===r.state&&(console.warn(r.state),r.resume()),l=new Uint8Array(i),u.getByteTimeDomainData(l),e.next=17,new sP(function(e){setTimeout(e,n)});case 17:return u.getByteTimeDomainData(l),e.next=20,new sP(function(e){setTimeout(e,n)});case 20:return h=0,l.forEach(function(e){return h=Math.max(h,Math.abs(e-o))}),f=(p=h/o*a)>s?p:0,d.disconnect(),u.disconnect(),e.abrupt("return",f);case 27:case"end":return e.stop()}},e)}))).apply(this,arguments)}function kP(){return(kP=sk(sI().mark(function e(t){var r,i,n,o;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Date.now(),kf||(kf=new AudioContext),"suspended"!==kf.state){e.next=6;break}return e.next=6,new sP(function(e){var r=setTimeout(function(){console.warn("[RTC_AMBULANCE] AudioContext resume failed, try to find one in RTCEngine"),(kf=kC(t))&&console.warn("[RTC_AMBULANCE] find AudioContext in RTCEngine success"),e()},1e3);kf.resume().then(function(){clearTimeout(r),e()},function(){clearTimeout(r),kf=null,e()})});case 6:if(kf){e.next=9;break}return console.error("[RTC_AMBULANCE] get volume is not supported"),e.abrupt("return");case 9:return n=kw(t),o=[],e.next=13,sP.all(sU(r=s8(n).call(n,function(e){return"audio"===e.mediaType})).call(r,function(){var e=sk(sI().mark(function e(t){var r,i,n,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.orgTrack,i=t.mediaTrack,n=t.preprocessingTrack,a=l9({},l7(t,kv)),e.next=4,sP.all([kO(r,kf).then(function(e){a.orgTrackVolume=e}),kO(i,kf).then(function(e){a.mediaTrackVolume=e}),kO(n,kf).then(function(e){a.preprocessingTrackVolume=e})]);case 4:o.push(a);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 13:return e.abrupt("return",{timestamp:i,trackVolumes:o});case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}function kD(){return(kD=sk(sI().mark(function e(t){var r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),n=sU(i=kw(t)).call(i,function(e){var t=e.orgTrack,r=e.mediaTrack,i=e.preprocessingTrack,n=l7(e,kE);return l9({orgTrack:t?kA(sU(kb).call(kb,function(e){return[e,t[e]]})):void 0,mediaTrack:r?kA(sU(kb).call(kb,function(e){return[e,r[e]]})):void 0,preprocessingTrack:i?kA(sU(kb).call(kb,function(e){return[e,i[e]]})):void 0},n)}),e.abrupt("return",{timestamp:r,trackStates:n});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function kL(e){if(e){var t={track:e.track?e.track.id:void 0,transport:{state:e.transport?e.transport.state:void 0}};return e.transport&&e.transport.iceTransport&&(t.iceTransport={state:e.transport.iceTransport.state,role:e.transport.iceTransport.role,gatheringState:e.transport.iceTransport.gatheringState,component:e.transport.iceTransport.component}),t}}function kM(){return(kM=sk(sI().mark(function e(t){var r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),i=[],t._ctx._handler&&t._ctx._handler._peerConnection&&(i=t._ctx._handler._peerConnection.getTransceivers()),n=[],i.forEach(function(e){var t=l9({sender:kL(e.sender),receiver:kL(e.receiver)},kA(sU(kT).call(kT,function(t){return[t,e[t]]})));n.push(t)}),e.abrupt("return",{timestamp:r,tranceiverStates:n});case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function kx(){return(kx=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={stats:[],mediaElementStates:[],audioContextStates:[],volumes:[],trackStates:[],tranceiverStates:[]},i=[],e.next=4,new sP(function(e){var n,o=0;n=setTimeout(function a(){i.push((function(e){return ky.apply(this,arguments)})(t).then(function(e){r.stats.push(e)}),(function(e){return kI.apply(this,arguments)})(t).then(function(e){r.mediaElementStates.push(e)}),(function(e){return kk.apply(this,arguments)})(t).then(function(e){r.audioContextStates.push(e)}),(function(e){return kP.apply(this,arguments)})(t).then(function(e){r.volumes.push(e)}),(function(e){return kD.apply(this,arguments)})(t).then(function(e){r.trackStates.push(e)}),(function(e){return kM.apply(this,arguments)})(t).then(function(e){r.tranceiverStates.push(e)})),++o>=10?sP.all(i).then(function(){e()}):(clearTimeout(n),n=setTimeout(a,500))},500)});case 4:return console.log("RTC_AMBULANCE",r),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}var kU=dA.getWeakData,kB=rj.set,kV=rj.getterFor,kF=rH.find,kj=rH.findIndex,kG=b([].splice),kW=0,kH=function(e){return e.frozen||(e.frozen=new kY)},kY=function(){this.entries=[]},kK=function(e,t){return kF(e.entries,function(e){return e[0]===t})};kY.prototype={get:function(e){var t=kK(this,e);if(t)return t[1]},has:function(e){return!!kK(this,e)},set:function(e,t){var r=kK(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=kj(this.entries,function(t){return t[0]===e});return~t&&kG(this.entries,t,1),!!~t}};dS("WeakSet",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,t,r,i){var n=e(function(e,n){oj(e,o),kB(e,{type:t,id:kW++,frozen:void 0}),Y(n)||oR(n,e[i],{that:e,AS_ENTRIES:r})}),o=n.prototype,a=kV(t),s=function(e,t,r){var i=a(e),n=kU(e4(t),!0);return!0===n?kH(i).set(t,r):n[i.id]=r,e};return db(o,{delete:function(e){var t=a(this);if(!J(e))return!1;var r=kU(e);return!0===r?kH(t).delete(e):r&&eI(r,t.id)&&delete r[t.id]},has:function(e){var t=a(this);if(!J(e))return!1;var r=kU(e);return!0===r?kH(t).has(e):r&&eI(r,t.id)}}),db(o,r?{get:function(e){var t=a(this);if(J(e)){var r=kU(e);return!0===r?kH(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),n}});var kQ=q.WeakSet,kz=function(e){if("object"==typeof e&&"has"in e&&"add"in e&&"delete"in e)return e;throw TypeError(ep(e)+" is not a weakset")},kX={WeakSet:$("WeakSet"),add:dk("add",1),has:dk("has",1),remove:dk("delete",1)},kJ=kX.add;ti({target:"WeakSet",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=kz(this),t=0,r=arguments.length;t<r;t++)kJ(e,arguments[t]);return e}});var kq=kX.remove;ti({target:"WeakSet",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=kz(this),r=!0,i=0,n=arguments.length;i<n;i++)e=kq(t,arguments[i]),r=r&&e;return!!r}});ti({target:"WeakSet",stat:!0,forced:!0},{from:dU});ti({target:"WeakSet",stat:!0,forced:!0},{of:dB});var kZ=d(kQ),k$=function(){function e(){nK(this,e),nQ(this,"containers",new kZ)}return nY(e,[{key:"getContainerById",value:function(e){return document.getElementById(e)}},{key:"registerContainer",value:function(e){var t;return"string"==typeof e&&(e=null!==(t=this.getContainerById(e))&&void 0!==t?t:void 0),!(!e||this.containers.has(e))&&(this.containers.add(e),!0)}},{key:"unregisterContainer",value:function(e){var t;return"string"==typeof e&&(e=null!==(t=this.getContainerById(e))&&void 0!==t?t:void 0),!!e&&(this.containers.delete(e),!0)}}]),e}(),k0=["videoStats","audioStats"],k2=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},k1=function(e){hA(eF,EL);var t,r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P,D,L,M,x,U,B,V,F,j,G,W,H,Y,K,Q,z,X,J,q,Z,$,ee,et,er,ei,en,eo,ea,es,ec,ed,eu,el,eh,ep,ef,e_,eA,em,ev,eE,eg,eS,eb,eT,ey,eR,eI,eC,ek,ew,eO,eN,eP,eD,eL,eM,ex,eU,eB,eV=hI(eF);function eF(e,t,r){var i,n,o,a;return nK(this,eF),nQ(he(o=eV.call(this)),"monitor",void 0),nQ(he(o),"logger",void 0),nQ(he(o),"_room",void 0),nQ(he(o),"_wtnStreamManager",void 0),nQ(he(o),"_appId",void 0),nQ(he(o),"_localImgVideoTrack",void 0),nQ(he(o),"_localImgScreenTrack",void 0),nQ(he(o),"_localScreenVideoTrack",void 0),nQ(he(o),"_localScreenAudioTrack",void 0),nQ(he(o),"_tempMixingAudioTrack",void 0),nQ(he(o),"_localAudioVolume",100),nQ(he(o),"_localScreenAudioVolume",100),nQ(he(o),"_remoteAudioVolume",new d9),nQ(he(o),"_remoteScreenAudioVolume",new d9),nQ(he(o),"_localVideoPlayerConfig",(nQ(i={},po.STREAM_INDEX_MAIN,new d9),nQ(i,po.STREAM_INDEX_SCREEN,new d9),i)),nQ(he(o),"_remoteVideoPlayerConfig",(nQ(n={},po.STREAM_INDEX_MAIN,new d9),nQ(n,po.STREAM_INDEX_SCREEN,new d9),n)),nQ(he(o),"_publicStreamIds",new d9),nQ(he(o),"_dummyMainImage",void 0),nQ(he(o),"_dummyScreenImage",void 0),nQ(he(o),"_trackSourceType",void 0),nQ(he(o),"_liveTranscodeConfig",void 0),nQ(he(o),"_startCloudProxyTimestamp",void 0),nQ(he(o),"_pauseAllSubscribeState",{audio:void 0,video:void 0,resumeAudioStreamIds:{},resumeVideoStreamIds:{}}),nQ(he(o),"_audioVolumeIndicationTimer",void 0),nQ(he(o),"_dummyMainTimer",void 0),nQ(he(o),"_dummyScreenTimer",void 0),nQ(he(o),"_audioPropertiesReportTimer",null),nQ(he(o),"_mirrorType",pl.MIRROR_TYPE_RENDER),nQ(he(o),"_audioMixingManager",void 0),nQ(he(o),"_pubLock",void 0),nQ(he(o),"_subLocks",void 0),nQ(he(o),"_audioCaptureLock",void 0),nQ(he(o),"_videoCaptureLock",void 0),nQ(he(o),"_screenCaptureLock",void 0),nQ(he(o),"_subScreenLocks",void 0),nQ(he(o),"_rtmClient",void 0),nQ(he(o),"_messageStatisticsObserver",void 0),nQ(he(o),"_waitForNewToken",!1),nQ(he(o),"_originIceConfigRequestUrls",void 0),nQ(he(o),"_originConfigServerUrls",void 0),nQ(he(o),"_originLogServerUrl",void 0),nQ(he(o),"_audioDeviceManager",void 0),nQ(he(o),"_config",void 0),nQ(he(o),"_needClosePreTrack",!1),nQ(he(o),"_containerCollisionDetector",new k$),nQ(he(o),"_ctx",void 0),nQ(he(o),"_updateMixAudioTrack",(a=sk(sI().mark(function e(t){var r,i,n=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.length>1&&void 0!==n[1]?n[1]:Ci.PLAYOUT_AND_PUBLISH,o.logger.info("_updateMixAudioTrack()"),o._localAudioTrack){e.next=5;break}return t&&(o._tempMixingAudioTrack={track:t,type:i}),e.abrupt("return");case 5:if(t?(o._localAudioTrack.mixType=i,o._localAudioTrack.mixedAudioTrack=t):(delete o._localAudioTrack.mixType,delete o._localAudioTrack.mixedAudioTrack),null===(r=o._room)||void 0===r||!r.hasPublished){e.next=9;break}return e.next=9,o._updatePublish();case 9:o._wtnStreamManager._updatePushTrack();case 10:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)})),nQ(he(o),"_onAudioMixingMessage",function(e){o.safeEmit(Eu.onAudioMixingStateChanged,e)}),nQ(he(o),"_onAudioMixingAutoplayFailed",function(e){o.safeEmit(Eu.onAutoplayFailed,e)}),o.id=t,o._appId=e,o.monitor=mS(t),o._ctx=new Cb(t,e,r),o._pubLock=new RG("pubLock"),o._subLocks=new d9,o._subScreenLocks=new d9,o._audioCaptureLock=new RG("audioCap"),o._videoCaptureLock=new RG("videoCap"),o._screenCaptureLock=new RG("screenCap"),o._addDeviceEventHandler(),o._audioDeviceManager=new C3(o._ctx),o._audioMixingManager=new Cj({getLocalAudioTrack:function(){return o._localAudioTrack},updateLocalAudioTrack:o._updateMixAudioTrack,emitMessage:o._onAudioMixingMessage,onAutoPlayFailed:o._onAudioMixingAutoplayFailed},t),o._addSignalingEventHandler(),o._wtnStreamManager=new C4(o._ctx),o._addWTNStreamEventHandler(),window.__rtc_engine__=he(o),window["__rtc_engine__".concat(Math.floor(100*Math.random()+1))]=he(o),o._trackSourceType={video:h8.VIDEO_SOURCE_TYPE_INTERNAL,screenVideo:h8.VIDEO_SOURCE_TYPE_INTERNAL,audio:h5.AUDIO_SOURCE_TYPE_INTERNAL,screenAudio:h5.AUDIO_SOURCE_TYPE_INTERNAL},o._config=r,o._rtmClient=new CG(o._ctx),o._handleRTMClient(o._rtmClient),o._handleAudioDeviceManager(),o._messageStatisticsObserver=new mh(t),o.logger=new mJ("Engine",0,t),ml.createRTSMsgReportor(o.id),o._getServerConfig(),o.monitor.reportLongString("NativeDetector",sD(cW)),o}return nY(eF,[{key:"appId",get:function(){return this._appId},set:function(e){this._appId=e}},{key:"updateToken",value:(eB=sk(sI().mark(function e(t){var r,i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateToken()","token: %s",t),Ef(t,"token"),!this._room||!this._waitForNewToken){e.next=8;break}return this._waitForNewToken=!1,this._room.config.token=t,e.next=7,this._join(this._room);case 7:return e.abrupt("return",e.sent);case 8:if(this._room){e.next=10;break}throw new pB(h6.UPDATE_TOKEN_BEFORE_JOIN,"update token before join room");case 10:return e.next=12,this._room.updateToken(t);case 12:return r=[],this._room.config.tokenPublishPrivilegeExpired&&this._room.config.isAutoPublish&&this._ctx.visibility&&r.push(this._updatePublish({mediaType:pa.AUDIO_AND_VIDEO})),this._room.config.tokenSubscribePrivilegeExpired&&(n=(i=this._room.config).isAutoSubscribeAudio,o=i.isAutoSubscribeVideo,(a=(n?pa.AUDIO:0)|(o?pa.VIDEO:0))&&r.push(this._triedResumeAllRemoteStreams(a,!0))),e.next=17,sP.allSettled(r);case 17:case"end":return e.stop()}},e,this)})),function(e){return eB.apply(this,arguments)})},{key:"setVideoCaptureDevice",value:(eU=sk(sI().mark(function e(t){var r,i,n,o,a=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setVideoCaptureDevice()","deviceId: %s",t),Ef(t,"deviceId"),this._localVideoTrack){e.next=5;break}return this._ctx.videoProfile.setCaptureDeviceId(t),e.abrupt("return");case 5:if(!vo||!vc||this._localVideoTrack.originTrack.getSettings().deviceId!==t){e.next=9;break}return e.abrupt("return");case 9:return r=this._ctx.videoProfile.getCaptureConfig(t),vc&&m3&&vS>=85&&vS<=91&&(null===(i=this.localVideoTrack)||void 0===i||i.removePlayerTrack()),this._needClosePreTrack=this._needClosePreTrack||gc,this._needClosePreTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy(),delete this._localVideoTrack),this.logger.info("setVideoCaptureDevice()","start createCameraVideoTrack..."),e.next=16,y5(this._ctx,r).catch(function(e){if(a._localVideoTrack&&!a._localVideoTrack.dummy)return a.logger.warn("setVideoCaptureDevice()","createCameraVideoTrack failed, stop pre VideoTrack."),a._removeLocalTrackEvents(a._localVideoTrack),a._localVideoTrack.destroy(),delete a._localVideoTrack,y5(a._ctx,r).then(function(e){return a._needClosePreTrack=!0,e}).catch(sk(sI().mark(function t(){var r;return sI().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.logger.error("setVideoCaptureDevice()","createCameraVideoTrack failed, rollback."),t.next=3,y5(a._ctx);case 3:throw r=t.sent,a._switchTrack(r),e;case 6:case"end":return t.stop()}},t)})));throw e});case 16:return n=e.sent,this.logger.success("setVideoCaptureDevice()","createCameraVideoTrack success."),this._ctx.videoProfile.setCaptureDeviceId(t),this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy()),(o=this._ctx.videoProfile.getContentHint())&&n.setContentHint(o),e.next=24,this._switchTrack(n);case 24:case"end":return e.stop()}},e,this)})),function(e){return eU.apply(this,arguments)})},{key:"setAudioCaptureDevice",value:(ex=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setAudioCaptureDevice()","deviceId: %s",t),Ef(t,"deviceId"),this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),this._localAudioTrack){e.next=5;break}return e.abrupt("return");case 5:return this._localAudioTrack.destroy(),this._removeLocalTrackEvents(this._localAudioTrack),e.next=9,y7(this._ctx,this._ctx.audioProfileManager.getConstraints());case 9:if(i=e.sent,this._initLocalTrackEvents(i),this._localAudioTrack=i,this._localAudioTrack.setVolume(this._localAudioVolume),this._wtnStreamManager._updatePushTrack(),this._room){e.next=16;break}return e.abrupt("return");case 16:if(null===(r=this._room.localStream)||void 0===r||!r.pubAudio){e.next=19;break}return e.next=19,this._updatePublish();case 19:case"end":return e.stop()}},e,this)})),function(e){return ex.apply(this,arguments)})},{key:"_addDeviceEventHandler",value:function(){yT.on(Eu.onVideoDeviceStateChanged,this._onVideoDeviceStateChange.bind(this)),yT.on(Eu.onAudioDeviceStateChanged,this._onAudioDeviceStateChange.bind(this))}},{key:"_addSignalingEventHandler",value:function(){var e=this,t=this._ctx.signalingManager;t.on(Ej.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),t.on(Ej.ON_RECONNECT_FAILED,function(){e.safeEmit(Eu.onError,{errorCode:h6.RECONNECT_FAILED})}),t.on(Ej.CONNECT_WITH_TCP,function(){e.safeEmit(Eu.onIceConnectWithTcp)})}},{key:"_addWTNStreamEventHandler",value:function(){var e=this;this._wtnStreamManager.__onResubscribe=function(t){var r=t.stream;r&&(r.audioTrack&&e._updateAudioPlayerState(r),r.videoTrack&&e._updateVideoPlayerState(r))},this._wtnStreamManager.__onRemoteStreamStats=function(t){e.safeEmit(Eu.onPublicStreamStats,t)},this._wtnStreamManager.__onSEIMessageReceived=function(t){e.safeEmit(Eu.onPublicStreamSEIMessageReceived,t)},this._wtnStreamManager.__onPlayerEvents=function(t,r,i){e._initPlayerEvents(t,r,i)}}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P,D,L,M,x,U,B,V,F,j,G=this;null===(e=this._room)||void 0===e||e.on(EV.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._room)||void 0===t||t.on(EV.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(r=this._room)||void 0===r||r.on(EV.USER_CONNECTION,this._onUserConnection.bind(this)),null===(i=this._room)||void 0===i||i.on(Rg.ON_USER_LEAVE,this._onUserLeave.bind(this)),null===(n=this._room)||void 0===n||n.on(Rg.ON_ROOM_ERROR,this._onRoomError.bind(this)),null===(o=this._room)||void 0===o||o.on(Rg.ON_NETWORK_QUALITY,this._onNetworkQuality.bind(this)),null===(a=this._room)||void 0===a||a.on(EV.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(s=this._room)||void 0===s||s.on(EV.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(c=this._room)||void 0===c||c.on(EV.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(d=this._room)||void 0===d||d.on(EV.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(u=this._room)||void 0===u||u.on(EV.ON_TOKEN_PUBLISH_PRIVILEGE_WILL_EXPIRE,this._onUserTokenPublishPrivilegeWillExpire.bind(this)),null===(l=this._room)||void 0===l||l.on(EV.ON_TOKEN_PUBLISH_PRIVILEGE_DID_EXPIRED,this._onUserTokenPublishPrivilegeDidExpired.bind(this)),null===(h=this._room)||void 0===h||h.on(EV.ON_TOKEN_SUBSCRIBE_PRIVILEGE_WILL_EXPIRE,this._onUserTokenSubscribePrivilegeWillExpire.bind(this)),null===(p=this._room)||void 0===p||p.on(EV.ON_TOKEN_SUBSCRIBE_PRIVILEGE_DID_EXPIRED,this._onUserTokenSubscribePrivilegeDidExpired.bind(this)),null===(f=this._room)||void 0===f||f.on(EV.POST_PROCESSING_MESSAGE,function(e){"2.0"===(null==e?void 0:e.protocol)?G._onStreamMixingEvent({error:e.error,event:e.eventType,message:e.message}):"publicStreamCallback"===e.type?G._onPushPublicStreamResult(e):"transcodeStatusCallback"===e.type&&G._onLiveTranscodingResult(e)}),null===(_=this._room)||void 0===_||_.on(Ej.ON_VENDOR_CONNECTION_STATE_CHANGE,function(e){return G.safeEmit(Eu.onVendorConnectionStateChanged,e)}),null===(A=this._room)||void 0===A||A.on(Rg.RESUBSCRIBE,this._onResubscribe.bind(this)),null===(m=this._room)||void 0===m||m.on(Rg.SUBSCRIBE_PUSH_TRACK,this._onSubscribePushTrack.bind(this)),null===(v=this._room)||void 0===v||v.on(Rg.REMOVE_PUSH_TRACK,this._onRemovePushTrack.bind(this)),null===(E=this._room)||void 0===E||E.on(Rg.ON_PUBLISH_RESULT,function(e){e.state===pr.PUBLISH_SUCC&&(null===(r=G._room)||void 0===r||r.config.setTokenPublishPrivilegeExpired(!1)),e.state===pr.PUBLISH_FAIL&&e.errorCode===h6.TOKEN_NO_PUBLISH_PERMISSION&&(null===(i=G._room)||void 0===i||i.config.setTokenPublishPrivilegeExpired(!0));var t,r,i,n=!(e.retry||null===(t=G._room)||void 0===t||!t.config.isAutoPublish);n&&G.safeEmit(Eu.onAutoPublishResult,e),G.safeEmit(Eu.onPublishResult,{isScreen:e.isScreen,isAutoPublish:n,errorCode:e.errorCode})}),null===(g=this._room)||void 0===g||g.on(Rg.ON_SUBSCRIBE_RESULT,function(e){var t;e.state===pt.SUBSCRIBE_SUCC&&(null===(t=G._room)||void 0===t||t.config.setTokenSubscribePrivilegeExpired(!1)),e.state===pt.SUBSCRIBE_FAIL&&e.errorCode===h6.TOKEN_NO_SUBSCRIBE_PERMISSION&&G._handleLoseSubscribePrivilege(),G.safeEmit(Eu.onSubscribeResult,{userId:e.userId,isScreen:e.isScreen,isAutoSubscribe:!1,errorCode:e.errorCode})}),null===(S=this._room)||void 0===S||S.on(Rg.ON_REMOTE_STREAM_STATS,function(e){G.safeEmit(Eu.onRemoteStreamStats,e)}),null===(b=this._room)||void 0===b||b.on(Rg.ON_LOCAL_STREAM_STATS,function(e){G.safeEmit(Eu.onLocalStreamStats,e)}),null===(T=this._room)||void 0===T||T.on(Rg.ON_SUBTITLE_STATE_CHANGED,function(e){G.safeEmit(Eu.onSubtitleStateChanged,e)}),null===(y=this._room)||void 0===y||y.on(Rg.ON_SUBTITLE_MESSAGE_RECEIVED,function(e){G.safeEmit(Eu.onSubtitleMessageReceived,e)}),null===(R=this._room)||void 0===R||R.on(Rg.ON_USER_PUBLISH_STATE_CHANGE,this._onUserPublishStateChange.bind(this)),null===(I=this._room)||void 0===I||I.on(Rg.ON_USER_START_AUDIO_CAPTURE,function(e,t){var r=e.userId;G._updateAudioPlayerState(t),G.safeEmit(Eu.onUserStartAudioCapture,{userId:r})}),null===(C=this._room)||void 0===C||C.on(Rg.ON_USER_STOP_AUDIO_CAPTURE,function(e){var t=e.userId;G.safeEmit(Eu.onUserStopAudioCapture,{userId:t})}),null===(k=this._room)||void 0===k||k.on(Rg.ON_USER_START_VIDEO_CAPTURE,function(e){var t=e.userId;G.safeEmit(Eu.onUserStartVideoCapture,{userId:t})}),null===(w=this._room)||void 0===w||w.on(Rg.ON_USER_STOP_VIDEO_CAPTURE,function(e){var t=e.userId;G.safeEmit(Eu.onUserStopVideoCapture,{userId:t})}),null===(O=this._room)||void 0===O||O.on(Rg.ON_SEI_MESSAGED_RECEIVED,function(e){G.safeEmit(Eu.onSEIMessageReceived,e)}),null===(N=this._room)||void 0===N||N.on(Rg.ON_REMOTE_VIDEO_SIZE_CHANGED,function(e,t){G.safeEmit(Eu.onRemoteVideoSizeChanged,e,t)}),null===(P=this._room)||void 0===P||P.on(Rg.ON_SIMULCAST_SUBSCRIBE_FALLBACK,function(e){return G.safeEmit(Eu.onSimulcastSubscribeFallback,e)}),null===(D=this._room)||void 0===D||D.on(Rg.ON_VIDEO_STREAM_BANNED,function(e){G.safeEmit(Eu.onVideoStreamBanned,{uid:e.uid,banned:e.banned})}),null===(L=this._room)||void 0===L||L.on(Rg.ON_AUDIO_STREAM_BANNED,function(e){G.safeEmit(Eu.onAudioStreamBanned,{uid:e.uid,banned:e.banned})}),null===(M=this._room)||void 0===M||M.on(Rg.ON_FORWARD_STREAM_ERROR,function(e){G.safeEmit(Eu.onForwardStreamError,e)}),null===(x=this._room)||void 0===x||x.on(Rg.ON_REJOIN_WITH_TCP,function(){G.safeEmit(Eu.onRejoinWithTcp)}),null===(U=this._room)||void 0===U||U.on(Rg.PUB_RETRY,function(e){G.safeEmit(Eu.onPublishRetry,e)}),null===(B=this._room)||void 0===B||B.on(Rg.SUB_RETRY,function(e){G.safeEmit(Eu.onSubscribeRetry,e)}),null===(V=this._room)||void 0===V||V.on(Rg.VIDEO_TYPE_CHANGE,function(e){G.safeEmit(Eu.onSEIStreamUpdate,e)}),null===(F=this._room)||void 0===F||F.on(Rg.JOIN_SUCCESS,function(e){G._ctx.isPreConnection||G.safeEmit(Eu.onConnectionStateChanged,{state:e?pc.CONNECTION_STATE_RECONNECTED:pc.CONNECTION_STATE_CONNECTED})}),null===(j=this._room)||void 0===j||j.on(Rg.UPDATE_PUBLISH,function(e){var t=e.streamIndex;t===po.STREAM_INDEX_MAIN?G._updatePublish():t===po.STREAM_INDEX_SCREEN&&G._updateScreenPublish()})}},{key:"safeEmit",value:function(e){for(var t,r,i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];if(a=e,null!=(c=vB("FORCE_ENABLED_REPORT_CALLBACKS"))&&cd(c).call(c,a)||a===Eu.onRemoteStreamStats&&vB("UPLOAD_REMOTE_STATS")||!cd(s=[Eu.onRemoteStreamStats,Eu.onLocalStreamStats,Eu.onAudioVolumeIndication,Eu.onLocalAudioPropertiesReport,Eu.onRemoteAudioPropertiesReport]).call(s,a)){if(e===Eu.onRemoteStreamStats){var a,s,c,d,u=vB("UPLOAD_REMOTE_STATS"),l=cd(d=vB("FORCE_ENABLED_REPORT_CALLBACKS")).call(d,"onRemoteStreamStats"),h=n[0],p=h.videoStats,f=h.audioStats,_=l7(h,k0);n[0]=l9({},_),(u&pa.VIDEO||l)&&(n[0].videoStats=p),(u&pa.AUDIO||l)&&(n[0].audioStats=f)}mk(this.id,e,n)}return(t=hf(hp(eF.prototype),"safeEmit",this)).call.apply(t,sN(r=[this,e]).call(r,n))}},{key:"_removeHandlerEventHandler",value:function(){var e;null===(e=this._room)||void 0===e||e.removeAllListeners()}},{key:"connect",value:(eM=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ctx.signalingManager.connect();case 2:case"end":return e.stop()}},e,this)})),function(){return eM.apply(this,arguments)})},{key:"joinRoom",value:(eL=sk(sI().mark(function e(t,r,i,n){var o,a,s,c,d;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("joinRoom()","token: %o roomId: %o, userInfo: %o, roomConfig: %o",t,r,i,n),Eg(t)||Ef(t,"token"),!this._room){e.next=4;break}throw new pB(h6.REPEAT_JOIN,"Already joined");case 4:var u,l;return ES(r),Em(u=i,"userInfo"),Eb(u.userId),Eg(u.extraInfo)||Ef(u.extraInfo,"userInfo.extraInfo",1,200),Em(l=(d=new RW({token:t,roomId:r,userInfo:i},this._ctx)).updateRoomConfig(n),"roomConfig"),El(l.isAutoPublish,"roomConfig.isAutoPublish"),El(l.isAutoSubscribeAudio,"roomConfig.isAutoSubscribeAudio"),El(l.isAutoSubscribeVideo,"roomConfig.isAutoSubscribeVideo"),Eg(l.roomProfileType)||E_(l.roomProfileType,"roomConfig",[pb.communication,pb.chat,pb.chatRoom,pb.coHost,pb.meeting,pb.classRoom]),d.setLiveControlMessage(this._liveTranscodeConfig&&kh.getStartParams(this._liveTranscodeConfig)),this._room=new CB(d,this._ctx),this.monitor.set({rtc_session_id:this._room.config.sessionId}),this._addHandlerEventHandler(),this._ctx.useCloudProxy&&(this._startCloudProxyTimestamp=Date.now()),null===(o=this._localVideoTrack)||void 0===o||o.setUserId(i.userId),null===(a=this._localScreenVideoTrack)||void 0===a||a.setUserId(i.userId),null===(s=this._localAudioTrack)||void 0===s||s.setUserId(i.userId),null===(c=this._localScreenAudioTrack)||void 0===c||c.setUserId(i.userId),RD(i),e.next=20,this._join(this._room);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}},e,this)})),function(e,t,r,i){return eL.apply(this,arguments)})},{key:"_join",value:(eD=sk(sI().mark(function e(t){var r,i,n=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.join();case 3:return i=e.sent,this._waitForNewToken=!1,this._ctx.audioProfileManager.setRoomId(t.config.roomId),null!==(r=this._room)&&void 0!==r&&r.config.isAutoPublish&&(this._ctx.visibility?this._updatePublish({invokeByJoinRoom:!0,mediaType:pa.AUDIO_AND_VIDEO}).catch(function(e){n.logger.error("_join","_updatePublish failed",e)}):(this.safeEmit(Eu.onAutoPublishResult,{isScreen:!1,state:pr.PUBLISH_FAIL}),this.safeEmit(Eu.onPublishResult,{isScreen:!1,isAutoPublish:!0,errorCode:h6.NO_PUBLISH_PERMISSION}))),this.monitor.set({rtc_vid:t.config.rtcVid}),ml.setRoomId(this.id,t.config.roomId),ml.setUserId(this.id,t.config.userId),e.abrupt("return",i);case 13:throw e.prev=13,e.t0=e.catch(0),e.t0.code===h6.INVALID_TOKEN?this._waitForNewToken=!0:(t.destroy(),this._room===t&&delete this._room),e.t0;case 17:case"end":return e.stop()}},e,this,[[0,13]])})),function(e){return eD.apply(this,arguments)})},{key:"leaveRoom",value:(eP=sk(sI().mark(function e(){var t,r,i=this,n=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]&&n[0],this.logger.info("leaveRoom()"),r=this._room,delete this._room,this._ctx.resetPubSubLock(CS.LEAVE),!t){e.next=10;break}return e.next=8,null==r?void 0:r.leave(t);case 8:e.next=11;break;case 10:null==r||r.leave(t).catch();case 11:this._removeHandlerEventHandler(),this._subLocks=new d9,this._subScreenLocks=new d9,this._ctx.audioProfileManager.setRoomId(),this._liveTranscodeConfig&&this.stopLiveTranscoding(),null==r||r.destroy(),this._remoteVideoPlayerConfig[po.STREAM_INDEX_MAIN].forEach(function(e){e.forEach(function(e){var t=e.player,r=e.renderDom;null==t||t.destroy(),i._containerCollisionDetector.unregisterContainer(r)})}),this._remoteVideoPlayerConfig[po.STREAM_INDEX_MAIN].clear(),this._remoteVideoPlayerConfig[po.STREAM_INDEX_SCREEN].forEach(function(e){e.forEach(function(e){var t=e.player,r=e.renderDom;null==t||t.destroy(),i._containerCollisionDetector.unregisterContainer(r)})}),this._remoteVideoPlayerConfig[po.STREAM_INDEX_SCREEN].clear(),this._publicStreamIds=new d9,ml.setRoomId(this.id,""),ml.setUserId(this.id,""),this.monitor.set({rtc_session_id:"",rtc_vid:""});case 25:case"end":return e.stop()}},e,this)})),function(){return eP.apply(this,arguments)})},{key:"_destroyLocalTrack",value:function(){this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.destroy(),this._localAudioTrack=void 0),this._localVideoTrack&&(this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy(),this._localVideoTrack=void 0),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.destroy(),this._localScreenAudioTrack=void 0),this._localScreenVideoTrack&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.destroy(),this._localScreenVideoTrack=void 0),this._localImgVideoTrack&&(this._localImgVideoTrack.stop(),this._localImgVideoTrack=void 0),this._localImgScreenTrack&&(this._localImgScreenTrack.stop(),this._localImgScreenTrack=void 0)}},{key:"destroy",value:function(){var e;this.logger.info("destroy()"),this.removeAllListeners(),this._removeHandlerEventHandler(),null===(e=this._room)||void 0===e||e.destroy(),this._room=void 0,this._subLocks=new d9,this._subScreenLocks=new d9,this._audioCaptureLock=new RG("audioCap"),this._videoCaptureLock=new RG("videoCap"),this._screenCaptureLock=new RG("screenCap"),this._pauseAllSubscribeState={audio:void 0,video:void 0,resumeVideoStreamIds:{},resumeAudioStreamIds:{}},this._messageStatisticsObserver.destroy(),this.monitor.destroy(),ml.destroyRTSMsgReportor(this.id),clearInterval(this._audioVolumeIndicationTimer),clearInterval(this._dummyMainTimer),clearInterval(this._dummyScreenTimer),this._audioVolumeIndicationTimer=void 0,this._stopAudioPropertiesReport(),this._destroyLocalTrack(),y_.on("".concat(this.id,"capture-end"),this._destroyLocalTrack.bind(this)),this._audioMixingManager.destroy(),this._rtmClient.destroy(),this._wtnStreamManager.destroy(),this._publicStreamIds=new d9,this._audioDeviceManager.destroy(),this._ctx.destroy(),this._localAudioVolume=100,this._localScreenAudioVolume=100,this._remoteAudioVolume.clear(),this._remoteScreenAudioVolume.clear(),this._localVideoPlayerConfig[po.STREAM_INDEX_MAIN].forEach(function(e){e.player.destroy()}),this._localVideoPlayerConfig[po.STREAM_INDEX_MAIN].clear(),this._localVideoPlayerConfig[po.STREAM_INDEX_SCREEN].forEach(function(e){e.player.destroy()}),this._localVideoPlayerConfig[po.STREAM_INDEX_SCREEN].clear(),this._remoteVideoPlayerConfig[po.STREAM_INDEX_MAIN].forEach(function(e){e.forEach(function(e){e.player.destroy()})}),this._remoteVideoPlayerConfig[po.STREAM_INDEX_MAIN].clear(),this._remoteVideoPlayerConfig[po.STREAM_INDEX_SCREEN].forEach(function(e){e.forEach(function(e){e.player.destroy()})}),this._remoteVideoPlayerConfig[po.STREAM_INDEX_SCREEN].clear()}},{key:"publishStream",value:(eN=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!Ei(t)||this._localVideoTrack||!this._localImgVideoTrack){e.next=7;break}return e.next=6,function(e,t){return y3.apply(this,arguments)}(this._ctx,this._localImgVideoTrack);case 6:this._localVideoTrack=e.sent;case 7:return e.next=9,this._updatePublish({mediaType:t},!0);case 9:case"end":return e.stop()}},e,this)})),function(e){return eN.apply(this,arguments)})},{key:"unpublishStream",value:(eO=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("unpublishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!r){e.next=5;break}return e.abrupt("return",null===(i=this._room)||void 0===i?void 0:i.unpublish());case 5:return e.next=7,this._updatePublish({mediaType:t,pubState:Rb.UNPUB},!0);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return eO.apply(this,arguments)})},{key:"publishScreen",value:(ew=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("publishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.prev=3,!Ei(t)||this._localScreenVideoTrack||!this._localImgScreenTrack){e.next=8;break}return e.next=7,function(e,t){return y8.apply(this,arguments)}(this._ctx,this._localImgScreenTrack);case 7:this._localScreenVideoTrack=e.sent;case 8:return e.next=10,this._updateScreenPublish({mediaType:t,pubState:Rb.PUB});case 10:e.next=19;break;case 12:if(e.prev=12,e.t0=e.catch(3),!(e.t0 instanceof pB)){e.next=18;break}throw e.t0;case 18:throw new pB(h6.UNEXPECTED_ERROR,"unexpected error",e.t0);case 19:case"end":return e.stop()}},e,this,[[3,12]])})),function(e){return ew.apply(this,arguments)})},{key:"unpublishScreen",value:(ek=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unpublishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.next=5,this._updateScreenPublish({mediaType:t,pubState:Rb.UNPUB});case 5:case"end":return e.stop()}},e,this)})),function(e){return ek.apply(this,arguments)})},{key:"subscribeStream",value:(eC=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribeStream()","userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!1,t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eC.apply(this,arguments)})},{key:"_subscribe",value:(eI=sk(sI().mark(function e(t,r,i){var n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i,i!==pa.AUDIO||null===(n=this._room)||void 0===n||!n.config.isMultiChatMode()){e.next=4;break}return this.logger.warn("subscribeStream()","due to multiChatMode return"),e.abrupt("return");case 4:if(s=null==(a=this._room.remoteStreams.get(r))?void 0:uC(a).call(a,function(e){return e.isScreen===t})){e.next=8;break}throw new pB(h6.STREAM_NOT_EXIST,"stream not exist");case 8:return c=this._pauseAllSubscribeState.audio,d=this._pauseAllSubscribeState.video,this._pauseAllSubscribeState.audio&&(i-=i&pa.AUDIO),this._pauseAllSubscribeState.video&&(i-=i&pa.VIDEO),this.logger.warn("subscribeStream()","due to pauseAll mediaType: %o",i),u=s.hasSubscribed,s.originalMediaType=i,e.prev=15,e.next=18,this._room.subscribe(s,i);case 18:Er(i)&&this._updateAudioPlayerState(s),Ei(i)&&this._updateVideoPlayerState(s),h=0,p=0,c!==this._pauseAllSubscribeState.audio&&(this._pauseAllSubscribeState.audio?h|=pa.AUDIO:p|=pa.AUDIO),d!==this._pauseAllSubscribeState.video&&(this._pauseAllSubscribeState.video?h|=pa.VIDEO:p|=pa.VIDEO),h&&this.pauseAllSubscribedStream(h),p&&this.resumeAllSubscribedStream(p),Er(o)&&(this._pauseAllSubscribeState.resumeAudioStreamIds[s.streamId]=s.streamId),Ei(o)&&(this._pauseAllSubscribeState.resumeVideoStreamIds[s.streamId]=s.streamId),(s.audioTrack||s.videoTrack)&&(A=!(t||!(null!==(f=this._room)&&void 0!==f&&f.config.isAutoSubscribeAudio||null!==(_=this._room)&&void 0!==_&&_.config.isAutoSubscribeVideo)),m={userId:r,isScreen:!1,state:pt.SUBSCRIBE_SUCC},A&&this.safeEmit(Eu.onAutoSubscribeResult,m),this.safeEmit(Eu.onSubscribeResult,{userId:r,isScreen:t,isAutoSubscribe:A})),null!==(l=this._room)&&void 0!==l&&l.config.isMultiChatMode()||u||!Er(i)||!s.hasAudio||null===(v=s.observer)||void 0===v||v.setSubscribeAudio(!0),!u&&Ei(i)&&s.hasVideo&&(null===(E=s.observer)||void 0===E||E.setSubscribeVideo(!0)),e.next=37;break;case 33:throw e.prev=33,e.t0=e.catch(15),e.t0 instanceof pB&&e.t0.code===h6.TOKEN_NO_SUBSCRIBE_PERMISSION&&this._handleLoseSubscribePrivilege(),e.t0;case 37:case"end":return e.stop()}},e,this,[[15,33]])})),function(e,t,r){return eI.apply(this,arguments)})},{key:"_handleLoseSubscribePrivilege",value:(eR=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=this._room)||void 0===t||t.config.setTokenSubscribePrivilegeExpired(!0),e.prev=1,e.next=4,this._unSubscribeAllRemoteStreams();case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:case"end":return e.stop()}},e,this,[[1,6]])})),function(){return eR.apply(this,arguments)})},{key:"unsubscribeStream",value:(ey=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unsubscribeStream()","userId: %o, mediaType: %o",t,r),e.abrupt("return",this._unsubscribe(!1,t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return ey.apply(this,arguments)})},{key:"subscribeScreen",value:(eT=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("subscribeScreen() userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!0,t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eT.apply(this,arguments)})},{key:"unsubscribeScreen",value:(eb=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("unsubscribeScreen() userId: %o, mediaType: %o",t,r),e.abrupt("return",this._unsubscribe(!0,t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return eb.apply(this,arguments)})},{key:"_unsubscribe",value:function(e,t,r,i){var n,o=this;if(r!==pa.AUDIO||null===(n=this._room)||void 0===n||!n.config.isMultiChatMode()){var a,s=this._room.remoteStreams.get(t),c=null==s?void 0:uC(s).call(s,function(t){return t.isScreen===e});if(!c)throw new pB(h6.STREAM_NOT_EXIST,"stream not exist");return vc&&vS&&vS>=85&&vS<=91&&r!==pa.AUDIO&&(null===(a=c.videoTrack)||void 0===a||a.stopAll()),this._room.unsubscribe(c,r).then(function(){i||(Er(r)&&delete o._pauseAllSubscribeState.resumeAudioStreamIds[c.streamId],Ei(r)&&delete o._pauseAllSubscribeState.resumeVideoStreamIds[c.streamId])})}this.logger.warn("subscribeStream()","due to multiChatMode return")}},{key:"setRemoteVideoConfig",value:(eS=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setRemoteVideoConfig() userId: %o, remoteVideoConfig: %o",t,r),this._ctx.videoProfile.checkSimulcastApiVersion("old"),Eb(t),function(e){if("number"!=typeof(null==e?void 0:e.width)||"number"!=typeof(null==e?void 0:e.height))throw new pB(h6.INVALID_PARAMS,"remoteVideoConfig must contain width, height, frameRate")}(r),this._ctx.videoProfile.setRemoteUserVideoConfig(t,r),e.abrupt("return",null===(i=this._room)||void 0===i?void 0:i.updateSubVideoConfig(t).then(function(){}));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return eS.apply(this,arguments)})},{key:"setRemoteSimulcastStreamType",value:(eg=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setRemoteSimulcastStreamType()","userId: %s, streamType: %s",t,r),this._ctx.videoProfile.checkSimulcastApiVersion("new"),Eb(t),E_(r,"SimulcastStreamType",[pD.VIDEO_STREAM_HIGH,pD.VIDEO_STREAM_MID,pD.VIDEO_STREAM_LOW]),this._ctx.videoProfile.setRemoteUserVideoConfig(t,r),e.next=7,null===(i=this._room)||void 0===i?void 0:i.updateSubVideoConfig(t);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return eg.apply(this,arguments)})},{key:"startVideoCapture",value:(eE=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startVideoCapture()","deviceId: %s",t),Eg(t)||Ef(t,"deviceId"),t&&this._ctx.videoProfile.setCaptureDeviceId(t),this._trackSourceType.video!==h8.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 5:if(!this._localVideoTrack||this._localVideoTrack.dummy){e.next=7;break}throw new pB(h6.REPEAT_CAPTURE,"Has already capture");case 7:return o={},e.next=10,y5(this._ctx);case 10:if(a=e.sent,(s=this._ctx.videoProfile.getContentHint())&&a.setContentHint(s),this._initLocalTrackEvents(a),this._localVideoTrack=a,this._localVideoPlayerConfig[po.STREAM_INDEX_MAIN].forEach(function(e){var t,r;null===(t=u._localVideoTrack)||void 0===t||t.setPlayer(e,u._mirrorType,null===(r=u._config)||void 0===r?void 0:r.autoPlayPolicy,u._initPlayerEvents.bind(u))}),c={width:(o=a.originTrack.getSettings()).width,height:o.height},this._localVideoTrack.resolution=c,this._ctx.videoProfile.__autoResetVideoEncoderConfig(o),setTimeout(function(){return u.safeEmit(Eu.onLocalVideoSizeChanged,{streamIndex:po.STREAM_INDEX_MAIN,info:c})}),y_.emit("".concat(this.id,"capture-end")),this._wtnStreamManager._updatePushTrack(),this._room){e.next=27;break}return e.abrupt("return",o);case 27:return d=this._room.config.isAutoPublish,(null!==(r=this._room.localStream)&&void 0!==r&&r.pubVideo||d)&&this._ctx.visibility&&this._updatePublish(),null===(i=this._room.localStream)||void 0===i||null===(n=i.observer)||void 0===n||n.setEnableVideo(!0),e.abrupt("return",o);case 31:case"end":return e.stop()}},e,this)})),function(e){return eE.apply(this,arguments)})},{key:"getLocalStreamStats",value:(ev=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this._room)||void 0===t?void 0:t.getLocalStreamStats();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return ev.apply(this,arguments)})},{key:"stopVideoCapture",value:(em=sk(sI().mark(function e(){var t,r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopVideoCapture()"),this._trackSourceType.video!==h8.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=3;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 3:if(this._localVideoTrack&&(this._localVideoTrack.dummy||((n=this._ctx.extensionManager.getPluginByName(ys.PRE_PROCESSING,"RTCBeautyExtension"))&&n.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy(),this._localImgVideoTrack?this._localVideoTrack.setTrack(this._localImgVideoTrack,{isDummy:!0}):this._localVideoTrack=void 0)),this._wtnStreamManager._updatePushTrack(),this._room){e.next=7;break}return e.abrupt("return");case 7:if(null===(t=this._room.localStream)||void 0===t||!t.pubVideo){e.next=10;break}return e.next=10,this._updatePublish();case 10:null===(r=this._room.localStream)||void 0===r||null===(i=r.observer)||void 0===i||i.setEnableVideo(!1);case 11:case"end":return e.stop()}},e,this)})),function(){return em.apply(this,arguments)})},{key:"startAudioCapture",value:(eA=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startAudioCapture()","deviceId: $o",t),Eg(t)||Ef(t,"deviceId"),t&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:t}}),this._trackSourceType.audio!==h5.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 5:if(!this._localAudioTrack){e.next=7;break}throw new pB(h6.REPEAT_CAPTURE,"Has already capture");case 7:return o={},e.next=10,y7(this._ctx,this._ctx.audioProfileManager.getConstraints());case 10:if(o=(a=e.sent).originTrack.getSettings(),this._initLocalTrackEvents(a),this._localAudioTrack=a,this._localAudioTrack.setVolume(this._localAudioVolume),c=(s=this._ctx._localAudioTrackDumpConfig[po.STREAM_INDEX_MAIN]).frameSize,d=s.callback,c&&d&&this._localAudioTrack.setDataFetcher(c,d),l=(u=this._ctx.earMonitorSettings[po.STREAM_INDEX_MAIN]).position,h=u.volume,l!==pL.NONE&&(this._localAudioTrack.play(l),this._localAudioTrack.setPlaybackVolume(h)),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),y_.emit("".concat(this.id,"capture-end")),this._wtnStreamManager._updatePushTrack(),this._room){e.next=24;break}return e.abrupt("return",o);case 24:return p=this._room.config.isAutoPublish,(null!==(r=this._room.localStream)&&void 0!==r&&r.pubAudio||p)&&this._ctx.visibility&&this._updatePublish(),null===(i=this._room.localStream)||void 0===i||null===(n=i.observer)||void 0===n||n.setEnableAudio(!0),e.abrupt("return",o);case 28:case"end":return e.stop()}},e,this)})),function(e){return eA.apply(this,arguments)})},{key:"stopAudioCapture",value:(e_=sk(sI().mark(function e(){var t,r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopAudioCapture()"),this._trackSourceType.audio!==h5.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=3;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 3:if(this._localAudioTrack&&(this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.destroy()),this._localAudioTrack=void 0,this._audioMixingManager.stopAll(),this._wtnStreamManager._updatePushTrack(),this._room){e.next=9;break}return e.abrupt("return");case 9:if(null===(t=this._room.localStream)||void 0===t||!t.pubAudio){e.next=12;break}return e.next=12,this._updatePublish();case 12:null===(r=this._room.localStream)||void 0===r||null===(i=r.observer)||void 0===i||i.setEnableAudio(!1);case 13:case"end":return e.stop()}},e,this)})),function(){return e_.apply(this,arguments)})},{key:"startAudioAndVideoCapture",value:(ef=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("startAudioAndVideoCapture","optionsOrAudioDeviceId: $o",t,"videoDeviceId: $o",r),u=(d=function(e,t){var r;return Eg(t)||Ef(t,"videoDeviceId"),Eg(e)||("string"==typeof e?(Ef(e,"audioDeviceId"),r=e):(r=null==e?void 0:e.audioDeviceId,t=null==e?void 0:e.videoDeviceId,Ef(r,"audioDeviceId"),Ef(t,"videoDeviceId"))),{audioDeviceId:r,videoDeviceId:t}}(t,r)).audioDeviceId,l=d.videoDeviceId,u&&this._ctx.audioProfileManager.updateConstraints({deviceId:{exact:u}}),this._trackSourceType.video!==h8.VIDEO_SOURCE_TYPE_EXTERNAL&&this._trackSourceType.audio!==h5.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,this._trackSourceType.video===h8.VIDEO_SOURCE_TYPE_EXTERNAL?"setVideoSourceType as internal first":"setAudioSourceType as internal first");case 5:if(!this._localVideoTrack||this._localVideoTrack.dummy){e.next=7;break}throw new pB(h6.REPEAT_CAPTURE,"video has already capture");case 7:if(!this._localAudioTrack){e.next=9;break}throw new pB(h6.REPEAT_CAPTURE,"audio has already capture");case 9:return h=this._ctx.videoProfile.getCaptureConfig(l),p={},f={},e.next=14,function(e,t,r){return Rt.apply(this,arguments)}(this._ctx,this._ctx.audioProfileManager.getConstraints(),h);case 14:if(A=(_=e.sent).audioTrack,m=_.videoTrack,(v=this._ctx.videoProfile.getContentHint())&&m.setContentHint(v),l&&this._ctx.videoProfile.setCaptureDeviceId(l),this._initLocalTrackEvents(m),this._localVideoTrack=m,this._localVideoPlayerConfig[po.STREAM_INDEX_MAIN].forEach(function(e){var t,r;null===(t=R._localVideoTrack)||void 0===t||t.setPlayer(e,R._mirrorType,null===(r=R._config)||void 0===r?void 0:r.autoPlayPolicy,R._initPlayerEvents.bind(R))}),this._initLocalTrackEvents(A),this._localAudioTrack=A,this._localAudioTrack.setVolume(this._localAudioVolume),g=(E=this._ctx._localAudioTrackDumpConfig[po.STREAM_INDEX_MAIN]).frameSize,S=E.callback,g&&S&&this._localAudioTrack.setDataFetcher(g,S),this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack),T={width:(p=(b=m.originTrack).getSettings()).width||0,height:p.height||0},this._localVideoTrack.resolution=T,this._ctx.videoProfile.__autoResetVideoEncoderConfig(p),setTimeout(function(){return R.safeEmit(Eu.onLocalVideoSizeChanged,{streamIndex:po.STREAM_INDEX_MAIN,info:T})}),f=(b=A.originTrack).getSettings(),y_.emit("".concat(this.id,"capture-end")),this._wtnStreamManager._updatePushTrack(),this._room){e.next=42;break}return e.abrupt("return",{audioTrackSettings:f,videoTrackSettings:p});case 42:return y=this._room.config.isAutoPublish,(null!==(i=this._room.localStream)&&void 0!==i&&i.pubVideo||null!==(n=this._room.localStream)&&void 0!==n&&n.pubAudio||y)&&this._ctx.visibility&&this._updatePublish(),null===(o=this._room.localStream)||void 0===o||null===(a=o.observer)||void 0===a||a.setEnableVideo(!0),null===(s=this._room.localStream)||void 0===s||null===(c=s.observer)||void 0===c||c.setEnableAudio(!0),e.abrupt("return",{audioTrackSettings:f,videoTrackSettings:p});case 47:case"end":return e.stop()}},e,this)})),function(e,t){return ef.apply(this,arguments)})},{key:"startVideoAndAudioCapture",value:(ep=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.startAudioAndVideoCapture(r,t));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return ep.apply(this,arguments)})},{key:"getAudioMixingManager",value:function(){return this.logger.info("getAudioMixingManager()","invoke"),this._audioMixingManager}},{key:"getWTNStreamManager",value:function(){return this._wtnStreamManager}},{key:"startScreenCapture",value:(eh=sk(sI().mark(function e(){var t,r,i,n,o,a,s,c,d,u,l,h=this,p=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=p.length>0&&void 0!==p[0]?p[0]:{},this.logger.info("startScreenCapture()","config: %o",a),this._trackSourceType.screenVideo!==h8.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=4;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 4:if(this._trackSourceType.screenAudio!==h5.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 6:return e.next=8,function(e,t){return Rr.apply(this,arguments)}(this._ctx,a);case 8:if(c=(s=sq(e.sent,2))[0],null==(d=s[1])||d.setVolume(this._localScreenAudioVolume),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.destroy()),null===(t=this._localScreenAudioTrack)||void 0===t||t.destroy(),delete this._localScreenAudioTrack,this._localScreenVideoTrack=c,(u=this._ctx.videoProfile.getScreenEncodeConfig().contentHint)&&c.setContentHint(u),l=c.originTrack,setTimeout(function(){var e=l.getSettings(),t={width:e.width,height:e.height};c.resolution=t,h.safeEmit(Eu.onLocalVideoSizeChanged,{streamIndex:po.STREAM_INDEX_SCREEN,info:{width:e.width,height:e.height}})},500),d&&(this._localScreenAudioTrack=d,this._initLocalTrackEvents(d)),this._localVideoPlayerConfig[po.STREAM_INDEX_SCREEN].forEach(function(e){var t,r;null===(t=h._localScreenVideoTrack)||void 0===t||t.setPlayer(e,pl.MIRROR_TYPE_NONE,null===(r=h._config)||void 0===r?void 0:r.autoPlayPolicy,h._initPlayerEvents.bind(h))}),this._initLocalTrackEvents(this._localScreenVideoTrack,!0),!(null!==(r=this._room)&&void 0!==r&&null!==(i=r.localScreenStream)&&void 0!==i&&i.pubAudio||null!==(n=this._room)&&void 0!==n&&null!==(o=n.localScreenStream)&&void 0!==o&&o.pubVideo)){e.next=28;break}return e.next=28,this._updateScreenPublish();case 28:case"end":return e.stop()}},e,this)})),function(){return eh.apply(this,arguments)})},{key:"stopScreenCapture",value:(el=sk(sI().mark(function e(){var t,r,i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopScreenCapture()"),null===(t=this._localScreenVideoTrack)||void 0===t||t.stopAll(),this._localScreenVideoTrack&&(this._localScreenVideoTrack.dummy||(this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.destroy(),this._localImgScreenTrack&&this._localScreenVideoTrack.setTrack(this._localImgScreenTrack,{isDummy:!0}))),this._localScreenAudioTrack&&(this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.destroy()),this._localScreenAudioTrack=void 0,null!==(r=this._localScreenVideoTrack)&&void 0!==r&&r.dummy||(this._localScreenVideoTrack=void 0),!(null!==(i=this._room)&&void 0!==i&&null!==(n=i.localScreenStream)&&void 0!==n&&n.pubAudio||null!==(o=this._room)&&void 0!==o&&null!==(a=o.localScreenStream)&&void 0!==a&&a.pubVideo)){e.next=9;break}return e.next=9,this._updateScreenPublish();case 9:case"end":return e.stop()}},e,this)})),function(){return el.apply(this,arguments)})},{key:"setLocalVideoPlayer",value:function(e,t){this.logger.info("setLocalVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),E_(e,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]);var r=e===po.STREAM_INDEX_MAIN?this._localVideoTrack:this._localScreenVideoTrack,i=null!==(n=null==t?void 0:t.playerId)&&void 0!==n?n:yV;if(null==t||!t.renderDom){null===(o=this._localVideoPlayerConfig[e].get(i))||void 0===o||null===(a=o.player)||void 0===a||a.destroy();var n,o,a,s,c=null===(s=this._localVideoPlayerConfig[e].get(i))||void 0===s?void 0:s.renderDom;return this._containerCollisionDetector.unregisterContainer(c),void this._localVideoPlayerConfig[e].delete(i)}Ey(t);var d=this._localVideoPlayerConfig[e].get(i);if(!d){var u,l,h,p=t.renderDom;if(!this._containerCollisionDetector.registerContainer(p))return this.monitor.report("rtc_error",{message:"RenderDom is not empty",error_code:yL.DUPLICATE_DOM}),void Es("renderDom is not empty");var f=new yK(this._ctx.id,i,l9(l9({},t),{},{isLocal:!0,isScreen:e===po.STREAM_INDEX_SCREEN,userId:null!==(u=t.userId)&&void 0!==u?u:"_local_"})),_=l9(l9({},t),{},{player:f});return this._localVideoPlayerConfig[e].set(i,_),null==r||r.setPlayer(_,e===po.STREAM_INDEX_MAIN?this._mirrorType:pl.MIRROR_TYPE_NONE,null===(l=this._config)||void 0===l?void 0:l.autoPlayPolicy,this._initPlayerEvents.bind(this)),null===(h=_.player)||void 0===h?void 0:h.domElement}void 0!==t.renderMode&&(null==r||r.setRenderMode(i,t.renderMode),d.renderMode=t.renderMode)}},{key:"startLiveTranscoding",value:(eu=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("startLiveTranscoding()","transcode: %o",t),kh.checkStartParams(t),this._liveTranscodeConfig=t,!((i=null===(r=this._room)||void 0===r?void 0:r.config)&&i.roomId.length+i.userId.length>126)){e.next=6;break}throw new pB(h6.INVALID_PARAMS,"The roomId+userId must be within 126 bytes");case 6:if(e.prev=6,this.safeEmit(Eu.onStreamMixingEvent,{event:RS.START,error:0,message:""}),!this._room||!this._ctx.signalingManager.isConnected()){e.next=11;break}return e.next=11,this._room.liveControlMessage(kh.getStartParams(this._liveTranscodeConfig));case 11:e.next=20;break;case 13:if(e.prev=13,e.t0=e.catch(6),!(e.t0 instanceof pB)){e.next=19;break}throw e.t0;case 19:throw new pB(h6.UNEXPECTED_ERROR,"unexpected error",e.t0);case 20:case"end":return e.stop()}},e,this,[[6,13]])})),function(e){return eu.apply(this,arguments)})},{key:"updateLiveTranscoding",value:(ed=sk(sI().mark(function e(t){var r,i,n,o;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("updateLiveTranscoding()","transcode: %o",t),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete(n=RU({},t)).audio,null===(r=n.video)||void 0===r||delete r.codec,null===(i=n.video)||void 0===i||delete i.gop,kh.checkUpdateParams(n),this._liveTranscodeConfig=RU(this._liveTranscodeConfig,n),e.prev=9,this.safeEmit(Eu.onStreamMixingEvent,{event:RS.UPDATE,error:0,message:""}),e.next=13,null===(o=this._room)||void 0===o?void 0:o.liveControlMessage(kh.getUpdateParams(this._liveTranscodeConfig));case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(9),!(e.t0 instanceof pB)){e.next=21;break}throw e.t0;case 21:throw new pB(h6.UNEXPECTED_ERROR,"unexpected error",e.t0);case 22:case"end":return e.stop()}},e,this,[[9,15]])})),function(e){return ed.apply(this,arguments)})},{key:"stopLiveTranscoding",value:(ec=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("stopLiveTranscoding()"),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete this._liveTranscodeConfig,e.prev=4,this.safeEmit(Eu.onStreamMixingEvent,{event:RS.STOP,error:0,message:""}),e.next=8,null===(t=this._room)||void 0===t?void 0:t.liveControlMessage({action:"stopped",type:"transcode"});case 8:e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),!(e.t0 instanceof pB)){e.next=16;break}throw e.t0;case 16:throw new pB(h6.UNEXPECTED_ERROR,"unexpected error",e.t0);case 17:case"end":return e.stop()}},e,this,[[4,10]])})),function(){return ec.apply(this,arguments)})},{key:"startSubtitle",value:(es=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("startSubtitle()","config: %o",t),this._assertNotInRoom(),e.next=4,null===(r=this._room)||void 0===r?void 0:r.startSubtitle(t);case 4:case"end":return e.stop()}},e,this)})),function(e){return es.apply(this,arguments)})},{key:"updateSubtitleConfig",value:(ea=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateSubtitleConfig()","config: %o",t),this._assertNotInRoom(),e.next=4,null===(r=this._room)||void 0===r?void 0:r.updateSubtitleConfig(t);case 4:case"end":return e.stop()}},e,this)})),function(e){return ea.apply(this,arguments)})},{key:"stopSubtitle",value:function(){var e;this.logger.info("stopSubtitle()","invoke"),null===(e=this._room)||void 0===e||e.stopSubtitle()}},{key:"setBusinessId",value:function(e){return this.logger.info("setBusinessId()","businessId: %s",e),!("string"!=typeof e)&&!this._room&&(this._ctx.businessId=e,!0)}},{key:"setUserVisibility",value:(eo=sk(sI().mark(function e(t){var r,i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setUserVisibility()","enable: %o",t),t=!!t,this._ctx.visibility!==t){e.next=4;break}return e.abrupt("return");case 4:if(this._room){e.next=7;break}return this._ctx.visibility=t,e.abrupt("return");case 7:if(this._assertNotInRoom(),this._room.localStream&&(null===(i=this._room.localStream.observer)||void 0===i||i.setPublisher(t)),t){e.next=14;break}return e.next=12,this._pubLock.lock();case 12:n=e.sent;try{this._room.unpublish(),this._room.unpublishScreen()}finally{n()}case 14:return this._ctx.visibility=t,e.prev=15,e.next=18,this._room.updateUserAttributes();case 18:e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(15),this._ctx.visibility=!t,e.t0;case 24:t&&null!==(r=this._room)&&void 0!==r&&r.config.isAutoPublish&&this._updatePublish({mediaType:pa.AUDIO_AND_VIDEO});case 25:case"end":return e.stop()}},e,this,[[15,20]])})),function(e){return eo.apply(this,arguments)})},{key:"_initPlayerEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:po.STREAM_INDEX_MAIN)===po.STREAM_INDEX_SCREEN;e.on("playback_event",function(n){switch(n.eventName){case"timeupdate":return;case"loadeddata":if("audio"===n.type){var o,a,s=e.userId.replace("_screen",""),c=null===(o=t._room)||void 0===o||null===(a=o.remoteStreams.get(s))||void 0===a?void 0:uC(a).call(a,function(e){return e.isScreen===i}),d=function(){r?t.safeEmit(Eu.onFirstPublicStreamAudioFrameDecoded,{publicStreamId:s}):(t.safeEmit(Eu.onAudioFirstFrameDecoded,{userId:s,isScreen:i}),t.safeEmit(Eu.onRemoteAudioFirstFrame,{userId:s,isScreen:i})),t.monitor.report("first_remote_audio_render",{stream_id:"",stream_user_id:s||""},{isScreen:i})};null==c||!c.observer||c.observer.audioFirstFrameReceived?d():c.observer.once("recvAudioFirstFrame",d)}else{var u,l,h={userId:e.userId,height:(null===(u=e.domElement)||void 0===u?void 0:u.videoHeight)||0,width:(null===(l=e.domElement)||void 0===l?void 0:l.videoWidth)||0,isScreen:i,playerId:e.playerId};r?(h.publicStreamId=h.userId,delete h.userId,delete h.isScreen,t.safeEmit(Eu.onFirstPublicStreamVideoFrameRendered,h),t.safeEmit(Eu.onFirstPublicStreamVideoFrameDecoded,h)):e.isLocal||(t.safeEmit(Eu.onVideoFirstFrameRendered,h),t.safeEmit(Eu.onVideoFirstFrameDecoded,h),t.safeEmit(Eu.onRemoteVideoFirstFrame,h)),t.monitor.report("first_remote_video_render",{stream_id:"",stream_user_id:n.userId||""},{isScreen:i})}break;case"autoplay-error":r&&(n.publicStreamId=n.userId),mw(t.id,"autoplay-error",e instanceof yK?"video":"audio",0,n.userId||"");var p={userId:n.userId,kind:e instanceof yK?"video":"audio",mediaType:e instanceof yK?pa.VIDEO:pa.AUDIO,streamIndex:e.isScreen?po.STREAM_INDEX_SCREEN:po.STREAM_INDEX_MAIN};return e instanceof yK&&(p.playerId=e.playerId===yV?void 0:e.playerId),void t.safeEmit(Eu.onAutoplayFailed,p)}e instanceof yK&&(n.playerId=e.playerId===yV?void 0:e.playerId),t.safeEmit(Eu.onPlayerEvent,n)})}},{key:"_initLocalTrackEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];["track-ended","track-mute","track-unmute"].forEach(function(r){var i;e.on(r,(i=sk(sI().mark(function e(i){var n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.monitor.report("rtc_error",{message:sN(n="track-".concat(r," mediaType: ")).call(n,i.originTrack.kind),error_code:yL.TRACK_ERROR,capture_session_id:i.captureSessionId,media_type:r,reason:r}),o=!1,i!==t._localScreenAudioTrack&&i!==t._localScreenVideoTrack||(o=!0),a=i.originTrack.kind,t.safeEmit({"track-ended":Eu.onTrackEnded,"track-mute":Eu.onTrackMute,"track-unmute":Eu.onTrackUnmute}[r],{kind:a,isScreen:o}),!vs&&!vi){e.next=13;break}if("track-mute"!==r||(y_.emit(yf.ON_IOS_LOCAL_TRACK_MUTE,a),"audio"!==a)){e.next=12;break}return e.next=11,t.stopAudioCapture();case 11:t.startAudioCapture();case 12:"track-unmute"===r&&y_.emit(yf.ON_IOS_LOCAL_TRACK_UNMUTE,a);case 13:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)}))}),e.on("resolution-change",function(e){t._ctx.extensionManager.getPluginsByType(ys.PRE_PROCESSING).forEach(function(t){var i;null==t||null===(i=t.applyConstraints)||void 0===i||i.call(t,r?po.STREAM_INDEX_SCREEN:po.STREAM_INDEX_MAIN,e)}),t.safeEmit(Eu.onLocalVideoSizeChanged,{streamIndex:r?po.STREAM_INDEX_SCREEN:po.STREAM_INDEX_MAIN,info:e})}),e.on("needReplaceTrack",function(){if(e instanceof yX){e.stopDataFetcher();var r=t._ctx._localAudioTrackDumpConfig[null!==(i=e.streamIndex)&&void 0!==i?i:po.STREAM_INDEX_MAIN];null!=r&&r.frameSize&&null!=r&&r.callback&&e.setDataFetcher(r.frameSize,r.callback);var i,n,o,a,s=t._ctx.earMonitorSettings[null!==(n=e.streamIndex)&&void 0!==n?n:po.STREAM_INDEX_MAIN],c=s.position,d=s.volume;c!==pL.NONE&&(e.play(c),e.setPlaybackVolume(d)),t._room&&(e.streamIndex===po.STREAM_INDEX_MAIN?null!==(o=t._room.localStream)&&void 0!==o&&o.pubAudio&&t._ctx.visibility&&t._updatePublish():null!==(a=t._room.localStream)&&void 0!==a&&a.pubAudio&&t._ctx.visibility&&t._updateScreenPublish())}}),e.on("autoplay-error",function(e){t.safeEmit(Eu.onAutoplayFailed,e)})}},{key:"_removeLocalTrackEvents",value:function(e){e.removeAllListeners("track-ended"),e.removeAllListeners("track-mute"),e.removeAllListeners("track-unmute"),e.removeAllListeners("resolution-change")}},{key:"setRemoteVideoPlayer",value:function(e,t){this.logger.info("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),E_(e,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),Ey(t);var r=t.userId,i=e===po.STREAM_INDEX_SCREEN,n=null===(s=this._room)||void 0===s||null===(c=s.remoteStreams.get(r))||void 0===c?void 0:uC(c).call(c,function(e){return e.isScreen===i}),o=null==n?void 0:n.videoTrack,a=null!==(d=t.playerId)&&void 0!==d?d:yV;null===(u=this._getRemoteVideoPlayerConfig(e,r,a))||void 0===u||null===(l=u.player)||void 0===l||l.destroy();var s,c,d,u,l,h,p,f,_,A=null===(h=this._getRemoteVideoPlayerConfig(e,r,a))||void 0===h?void 0:h.renderDom;if(this._containerCollisionDetector.unregisterContainer(A),t.renderDom){var m=t.renderDom;if(!this._containerCollisionDetector.registerContainer(m))return this.monitor.report("rtc_error",{message:"RenderDom is not empty",error_code:yL.DUPLICATE_DOM}),void Es("renderDom is not empty");var v=new yK(this.id,a,l9(l9({},t),{},{isLocal:!1,isScreen:i,userId:r})),E=l9(l9({},t),{},{player:v});return this._setRemoteVideoPlayerConfig(e,r,a,E),null==o||o.setPlayer(this.id,E,null===(p=this._config)||void 0===p?void 0:p.autoPlayPolicy,this._initPlayerEvents.bind(this)),n&&this._updateVideoPlayerState(n),null===(f=E.player)||void 0===f?void 0:f.domElement}null===(_=this._remoteVideoPlayerConfig[e].get(r))||void 0===_||_.delete(a)}},{key:"setLocalVideoMirrorType",value:function(e){var t;this.logger.info("setLocalVideoMirrorType()","mirrorType: %o",e),E_(e,"mirrorType",[pl.MIRROR_TYPE_NONE,pl.MIRROR_TYPE_RENDER]),this._mirrorType=e,null===(t=this.localVideoTrack)||void 0===t||t.mirror(!!e)}},{key:"setRemoteVideoMirrorType",value:function(e,t,r){var i,n,o,a;this.logger.info("setRemoteVideoMirrorType()","userId: %s, streamIndex: %o, mirrorType: %o",e,t,r),Eb(e),E_(t,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),E_(r,"mirrorType",[pl.MIRROR_TYPE_NONE,pl.MIRROR_TYPE_RENDER]),this._ctx.setUserStreamConf(e,t,{mirrorType:r}),null===(i=this._room)||void 0===i||null===(n=i.remoteStreams.get(e))||void 0===n||null===(o=uC(n).call(n,function(e){return e.isScreen===(t===po.STREAM_INDEX_SCREEN)}))||void 0===o||null===(a=o.videoTrack)||void 0===a||a.mirror(!!r)}},{key:"setAudioPlaybackDevice",value:(en=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setAudioPlaybackDevice()","deviceId: %s",t),Ef(t,"deviceId"),e.next=4,this._audioDeviceManager.setSinkId(t);case 4:i=e.sent,null===(r=this._room)||void 0===r||r.remoteStreams.forEach(function(e){e.forEach(function(e){var r;null===(r=e.audioTrack)||void 0===r||r.setPlaybackDevice(t)})}),this.safeEmit(Eu.onAudioPlaybackDeviceChanged,i),this.monitor.report("rtc_audio_device",{audio_event:"playout_device_switch",message:sD(i),error_code:0});case 8:case"end":return e.stop()}},e,this)})),function(e){return en.apply(this,arguments)})},{key:"play",value:(ei=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=m.length>1&&void 0!==m[1]?m[1]:pa.AUDIO_AND_VIDEO,n=m.length>2?m[2]:void 0,o=m.length>3?m[3]:void 0,this.logger.info("play()","userId: %s, mediaType: %s, streamIndex: %s",t,i,n),a=null!=o?o:yV,s=!t||t===this._getUserId()||"local_user"===t,c=void 0===n||n===po.STREAM_INDEX_MAIN,d=void 0===n||n===po.STREAM_INDEX_SCREEN,u=i!==pa.VIDEO,l=i!==pa.AUDIO,h=[],s&&l&&(c&&this._localVideoTrack&&(this._localVideoTrack.mirror(!!this._mirrorType),(p=this._localVideoTrack.play(a))&&h.push(p)),d&&this._localScreenVideoTrack&&(null===(f=this._localScreenVideoTrack)||void 0===f?void 0:f.manuallyPlay(a))&&h.push()),t===this._audioMixingManager.id&&h.push(this._audioMixingManager.resumeLocalPlay()),_=[],null===(r=this._room)||void 0===r||r.remoteStreams.forEach(function(e,r){t&&t!==r||e.forEach(function(e){e.audioTrack&&_.push(e.audioTrack),e.videoTrack&&_.push(e.videoTrack)})}),this._wtnStreamManager.__getRemoteStreams().forEach(function(e,r){t&&t!==r||(e.audioTrack&&_.push(e.audioTrack),e.videoTrack&&_.push(e.videoTrack))}),c||(_=s8(_).call(_,function(e){return!!e.isScreen})),d||(_=s8(_).call(_,function(e){return!e.isScreen})),u||(_=s8(_).call(_,function(e){return"audio"!==e.mediaType})),l||(_=s8(_).call(_,function(e){return"video"!==e.mediaType})),u&&(null===(A=this._room)||void 0===A||A.virtualStreams.forEach(function(e){e.audioTrack&&_.push(e.audioTrack)})),_.forEach(function(e){var t=e.manuallyPlay(a);t&&h.push(t)}),e.abrupt("return",sP.all(h).then(function(){}));case 23:case"end":return e.stop()}},e,this)})),function(e){return ei.apply(this,arguments)})},{key:"stop",value:(er=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l,h,p,f,_,A=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=A.length>1&&void 0!==A[1]?A[1]:pa.AUDIO_AND_VIDEO,i=A.length>2?A[2]:void 0,n=A.length>3?A[3]:void 0,this.logger.info("stop()","userId: %s, mediaType: %s, streamIndex: %s, playerId: %s",t,r,i,n),o=null!=n?n:yV,a=!t||t===this._getUserId()||"local_user"===t,s=void 0===i||i===po.STREAM_INDEX_MAIN,c=void 0===i||i===po.STREAM_INDEX_SCREEN,d=r!==pa.VIDEO,u=r!==pa.AUDIO,a&&u&&(s&&this._localVideoTrack&&this._localVideoTrack.pause(o),c&&this._localScreenVideoTrack&&this._localScreenVideoTrack.pause(o)),t&&(p=[],null===(l=this._room)||void 0===l||null===(h=l.remoteStreams.get(t))||void 0===h||h.forEach(function(e){e.audioTrack&&p.push(e.audioTrack),e.videoTrack&&p.push(e.videoTrack)}),f=this._wtnStreamManager.__getPublicStreamTrack(t,"audio"),_=this._wtnStreamManager.__getPublicStreamTrack(t,"video"),f&&p.push(f),_&&p.push(_),s||(p=s8(p).call(p,function(e){return!!e.isScreen})),c||(p=s8(p).call(p,function(e){return!e.isScreen})),d||(p=s8(p).call(p,function(e){return"audio"!==e.mediaType})),u||(p=s8(p).call(p,function(e){return"video"!==e.mediaType})),p.forEach(function(e){e.pause(o)}));case 12:case"end":return e.stop()}},e,this)})),function(e){return er.apply(this,arguments)})},{key:"getAudioVolume",value:function(e,t){E_(e,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]);var r=0;if(t){var i,n,o,a=null===(i=this._room)||void 0===i||null===(n=i.remoteStreams.get(t))||void 0===n||null===(o=uC(n).call(n,function(t){return t.isScreen===(e===po.STREAM_INDEX_SCREEN)}))||void 0===o?void 0:o.audioTrack;a&&(r=a.getAudioLevel())}else{var s=e===po.STREAM_INDEX_MAIN?this._localAudioTrack:this._localScreenAudioTrack;s&&(r=s.getAudioLevel())}return{linearVolume:r,nonlinearVolume:Et(r)}}},{key:"setAudioFrameCallback",value:function(e,t,r){var i,n,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4096;if(this.logger.info("setAudioFrameCallback()","streamIndex: %s, userId: %s, callback: %s, frameSize: %s",e,t,r?"true":"false",a),E_(a,"frameSize",[256,512,1024,2048,4096,8192,16384]),void 0===yS.isWorkletReady&&yS.getAudioContextInstance(),null===yS.isWorkletReady)throw this.logger.error("setAudioFrameCallback()","Not support AudioWorklet"),new pB(h6.NOT_SUPPORTED,"Not support AudioWorklet");t?r?this._ctx._remoteAudioTrackDumpConfig[e].set(t,{callback:r,frameSize:a}):this._ctx._remoteAudioTrackDumpConfig[e].delete(t):this._ctx._localAudioTrackDumpConfig[e]={callback:r,frameSize:r?a:void 0};var s=t?null===(i=this._room)||void 0===i||null===(n=i.remoteStreams.get(t))||void 0===n||null===(o=uC(n).call(n,function(t){return t.isScreen===(e===po.STREAM_INDEX_SCREEN)}))||void 0===o?void 0:o.audioTrack:e===po.STREAM_INDEX_MAIN?this._localAudioTrack:this._localScreenAudioTrack;s?r?s.setDataFetcher(a,r):s.stopDataFetcher():this.logger.warn("setAudioFrameCallback()","track not found")}},{key:"pauseAllSubscribedStream",value:(et=sk(sI().mark(function e(t){var r=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("pauseAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),Er(t)&&(r._pauseAllSubscribeState.audio=!0),Ei(t)&&(r._pauseAllSubscribeState.video=!0),this._room){e.next=6;break}return e.abrupt("return",sP.resolve());case 6:return e.abrupt("return",this._pauseAllRemoteStreams(t));case 7:case"end":return e.stop()}},e,this)})),function(e){return et.apply(this,arguments)})},{key:"_pauseAllRemoteStreams",value:(ee=sk(sI().mark(function e(t){var r,i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._room){e.next=2;break}return e.abrupt("return",sP.resolve());case 2:return r=[],this._room.remoteStreams.forEach(function(e){Array.isArray(e)&&e.forEach(function(e){if(e.hasSubscribed){e.attributes.audiostream&&Er(t)&&(i._pauseAllSubscribeState.resumeAudioStreamIds[e.streamId]=e.streamId),e.attributes.videostream&&Ei(t)&&(i._pauseAllSubscribeState.resumeVideoStreamIds[e.streamId]=e.streamId);var n=i._unsubscribe(e.isScreen,e.userId,t,!0);n&&r.push(n)}})}),e.abrupt("return",sP.all(r).then(function(){}));case 5:case"end":return e.stop()}},e,this)})),function(e){return ee.apply(this,arguments)})},{key:"resumeAllSubscribedStream",value:($=sk(sI().mark(function e(t){var r=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("resumeAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),Er(t)&&(r._pauseAllSubscribeState.audio=!1),Ei(t)&&(r._pauseAllSubscribeState.video=!1),this._room){e.next=6;break}return e.abrupt("return",sP.resolve());case 6:return e.next=8,this._triedResumeAllRemoteStreams(t,!1);case 8:return e.abrupt("return");case 9:case"end":return e.stop()}},e,this)})),function(e){return $.apply(this,arguments)})},{key:"_triedResumeAllRemoteStreams",value:(Z=sk(sI().mark(function e(t,r){var i,n,o,a=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._room){e.next=2;break}return e.abrupt("return",sP.resolve());case 2:if(!this._pauseAllSubscribeState.audio||t!==pa.AUDIO){e.next=4;break}return e.abrupt("return",sP.resolve());case 4:if(!this._pauseAllSubscribeState.video||t!==pa.VIDEO){e.next=6;break}return e.abrupt("return",sP.resolve());case 6:if(!this._pauseAllSubscribeState.video||!this._pauseAllSubscribeState.audio||t!==pa.AUDIO_AND_VIDEO){e.next=8;break}return e.abrupt("return",sP.resolve());case 8:return i=[],n=le(cG(this._pauseAllSubscribeState.resumeAudioStreamIds)),o=le(cG(this._pauseAllSubscribeState.resumeVideoStreamIds)),this._room.remoteStreams.forEach(function(e){Array.isArray(e)&&e.forEach(function(e){if(!r||!e.isScreen){var n=a._pauseAllSubscribeState.resumeAudioStreamIds[e.streamId],o=a._pauseAllSubscribeState.resumeVideoStreamIds[e.streamId];if(n&&Er(t)||o&&Ei(t)){var s=a._subscribe(e.isScreen,e.userId,t).then(function(){n&&Er(t)&&delete a._pauseAllSubscribeState.resumeAudioStreamIds[e.streamId],o&&Ei(t)&&delete a._pauseAllSubscribeState.resumeVideoStreamIds[e.streamId]});s&&i.push(s)}}})}),e.abrupt("return",sP.all(i).then(function(){var e;return null===(e=a._room)||void 0===e||e.remoteStreams.forEach(function(e){Array.isArray(e)&&e.forEach(function(e){a._updateAudioPlayerState(e),a._updateVideoPlayerState(e)})}),sP.resolve()}).finally(function(){var e;return null!==(e=a._room)&&void 0!==e&&e.config.tokenSubscribePrivilegeExpired&&(n.forEach(function(e){a._pauseAllSubscribeState.resumeAudioStreamIds[e]=e}),o.forEach(function(e){a._pauseAllSubscribeState.resumeVideoStreamIds[e]=e})),sP.resolve()}));case 13:case"end":return e.stop()}},e,this)})),function(e,t){return Z.apply(this,arguments)})},{key:"sendUserMessage",value:(q=sk(sI().mark(function e(t,r){var i,n,o,a=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Eb(t),ER(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null===(i=this._room)||void 0===i||null===(n=i.sendUserMessage(t,r))||void 0===n?void 0:n.then(function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!1,o,e),e.id}).catch(function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!1,o,e),e}));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return q.apply(this,arguments)})},{key:"sendUserBinaryMessage",value:(J=sk(sI().mark(function e(t,r){var i,n,o,a=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Eb(t),Ev(r,"message"),ER(r),this._assertNotInRoom(),o=Date.now(),e.abrupt("return",null===(i=this._room)||void 0===i||null===(n=i.sendUserMessage(t,r))||void 0===n?void 0:n.then(function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!0,o,e),e.id}).catch(function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!0,o,e),e}));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return J.apply(this,arguments)})},{key:"sendRoomMessage",value:(X=sk(sI().mark(function e(t){var r,i,n,o,a,s=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ER(t),this._assertNotInRoom(),o=null===(r=this._room)||void 0===r?void 0:r.config.roomId,a=Date.now(),e.abrupt("return",null===(i=this._room)||void 0===i||null===(n=i.sendRoomMessage(t))||void 0===n?void 0:n.then(function(e){return s._messageStatisticsObserver.countRoomMessage(!0,o,!1,a),e}).catch(function(e){throw s._messageStatisticsObserver.countRoomMessage(!1,o,!1,a),e}));case 5:case"end":return e.stop()}},e,this)})),function(e){return X.apply(this,arguments)})},{key:"sendRoomBinaryMessage",value:(z=sk(sI().mark(function e(t){var r,i,n,o,a,s=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ER(t),this._assertNotInRoom(),o=null===(r=this._room)||void 0===r?void 0:r.config.roomId,a=Date.now(),e.abrupt("return",null===(i=this._room)||void 0===i||null===(n=i.sendRoomMessage(t,!0))||void 0===n?void 0:n.then(function(e){return s._messageStatisticsObserver.countRoomMessage(!0,o,!0,a),e}).catch(function(e){throw s._messageStatisticsObserver.countRoomMessage(!1,o,!0,a),e}));case 5:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"setAudioCaptureConfig",value:(Q=sk(sI().mark(function e(){var t,r=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:{},this.logger.info("setAudioCaptureConfig()","config: %o",t),delete t.deviceId,EE(t),this._shouldUpdateAudioConf("setAudioCaptureConfig")&&this._ctx.audioProfileManager.updateConstraints(t);case 5:case"end":return e.stop()}},e,this)})),function(){return Q.apply(this,arguments)})},{key:"setVideoCaptureConfig",value:(K=sk(sI().mark(function e(){var t,r=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},this.logger.info("setVideoCaptureConfig()","config: %o",t),e.abrupt("return",this._setVideoCaptureConfig(t));case 3:case"end":return e.stop()}},e,this)})),function(){return K.apply(this,arguments)})},{key:"_setVideoCaptureConfig",value:(Y=sk(sI().mark(function e(){var t,r,i,n=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(delete(r=n.length>0&&void 0!==n[0]?n[0]:{}).deviceId,EE(r),i=l9(l9({},this._ctx.videoProfile.getCaptureConfig()),r),!this._localVideoTrack){e.next=7;break}return e.next=7,this._localVideoTrack.updateVideoCaptureConfig(i);case 7:return this._ctx.videoProfile.setCaptureConfig(i),e.abrupt("return",(null===(t=this._localVideoTrack)||void 0===t?void 0:t.originTrack.getSettings())||{});case 9:case"end":return e.stop()}},e,this)})),function(){return Y.apply(this,arguments)})},{key:"enableSimulcastMode",value:function(e){this.logger.info("enableSimulcastMode()","enabled: %o",e),this._ctx.videoProfile.checkSimulcastApiVersion("old");try{return this._ctx.videoProfile.setSimulcastMode(e?pP.VIDEO_ON_DEMAND:pP.VIDEO_ONLY_ONE,this._room),!0}catch(e){return!1}}},{key:"setLocalSimulcastMode",value:(H=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setLocalSimulcastMode()","mode: %o, config: %o",t,r),this._ctx.videoProfile.checkSimulcastApiVersion("new"),e.next=4,this._ctx.videoProfile.setSimulcastMode(t,this._room);case 4:return e.next=6,this._ctx.videoProfile.setSubVideoEncodeConfig(r,this._room,this._localVideoTrack);case 6:null!==(i=this._room)&&void 0!==i&&i.hasPublished&&this._updatePublish();case 7:case"end":return e.stop()}},e,this)})),function(e,t){return H.apply(this,arguments)})},{key:"setVideoEncoderConfig",value:(W=sk(sI().mark(function e(t){var r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setVideoEncoderConfig()","descriptions: %o",t),e.next=3,this._ctx.videoProfile.setVideoEncodeConfigPolyfill(t);case 3:if(!this._localVideoTrack){e.next=8;break}return(i=this._ctx.videoProfile.getContentHint())&&this._localVideoTrack.setContentHint(i),e.next=8,this._localVideoTrack.updateVideoCaptureConfig(this._ctx.videoProfile.getCaptureConfig());case 8:this._updateDummyCaptureImage(po.STREAM_INDEX_MAIN),null!==(r=this._room)&&void 0!==r&&r.hasPublished&&this._updatePublish();case 10:case"end":return e.stop()}},e,this)})),function(e){return W.apply(this,arguments)})},{key:"setVideoEncoderAutoConfigList",value:function(e){if(Array.isArray(e))return hY(e).call(e,function(e,t){return e.maxKbps-t.maxKbps}),void(vF=e)}},{key:"setScreenEncoderConfig",value:(G=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setScreenEncoderConfig()","description: %o",t),this._ctx.videoProfile.setScreenEncodeConfig(t),!this._localScreenVideoTrack){e.next=7;break}if("16.1"===vm){e.next=6;break}return e.next=6,this._localScreenVideoTrack.updateVideoCaptureConfig(t);case 6:t.contentHint&&this._localScreenVideoTrack.setContentHint(t.contentHint);case 7:this._updateDummyCaptureImage(po.STREAM_INDEX_SCREEN),null!==(r=this._room)&&void 0!==r&&r.hasScreenPublished&&this._updateScreenPublish();case 9:case"end":return e.stop()}},e,this)})),function(e){return G.apply(this,arguments)})},{key:"sendSEIMessage",value:function(e,t,r){var i=this;if(this.logger.info("sendSEIMessage()","streamIdex: %o, message: %o, repeatCount: %o",e,t,r),!gi())return Es("Your browser does not support sending SEI"),!1;E_(e,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),Ep(r,"repeatCount",0,30);var n,o="string"==typeof t?new Uint8Array(v1.str2ab(t)):t;if(!t.length)return this.logger.warn("sei message must not be empty"),!1;if(e===po.STREAM_INDEX_MAIN){if(!(null!==(a=this._room)&&void 0!==a&&null!==(s=a.localStream)&&void 0!==s&&s.pubAudio||null!==(c=this._room)&&void 0!==c&&null!==(d=c.localStream)&&void 0!==d&&d.pubVideo))return;n=this._room.localStream}else{if(!(null!==(u=this._room)&&void 0!==u&&null!==(l=u.localScreenStream)&&void 0!==l&&l.pubAudio||null!==(h=this._room)&&void 0!==h&&null!==(p=h.localScreenStream)&&void 0!==p&&p.pubVideo))return;n=this._room.localScreenStream}if(o.byteLength>4096)this.logger.warn("sei size must not bigger than 4KB");else{!vc&&(null===(f=this._room)||void 0===f||f.maybeFillBackFrame2Stream(n));var a,s,c,d,u,l,h,p,f,_=v$();n.seiList.push({content:o,uuid:_,repeatCount:r+1}),setTimeout(function(){var e;if(n){var r,o=hq(e=n.seiList).call(e,function(e){return e.uuid===_});o>=0&&(uH(r=n.seiList).call(r,o,1),console.error("[RTC WebSDK] sei timeout for message: %o",t),i.monitor.report("rtc_sdk_callback",{sdk_callback_name:"sendSEIMessage",message:"timeout for message: ".concat(t),error_code:400}))}},vB("SEI_TIME_OUT"))}}},{key:"setAudioVolumeIndicationInterval",value:function(e){var t=this;this.logger.info("setAudioVolumeIndicationInterval()","interval %o: ",e),("number"!=typeof e||e<200)&&(e=200);var r=[];this._audioVolumeIndicationTimer&&clearInterval(this._audioVolumeIndicationTimer),this._audioVolumeIndicationTimer=setInterval(function(){r=[],null===(e=t._room)||void 0===e||e.remoteStreams.forEach(function(e,t){var i;if(0!==e.length){var n=uC(e).call(e,function(e){return!e.isScreen}),o=null==n||null===(i=n.audioTrack)||void 0===i?void 0:i.getAudioLevel();r.push({userId:t,volume:o||0})}});var e,i,n=null===(i=t._localAudioTrack)||void 0===i?void 0:i.getAudioLevel();r.push({userId:t._getUserId(),volume:n||0}),t.safeEmit(Eu.onAudioVolumeIndication,{speakers:r})},e)}},{key:"_sendActiveSpeaker",value:function(e,t){if(this._room&&this._room.remoteUsers.size>=1){var r,i,n=e[0],o=c_(t).call(t,function(e,t){return e&&e.audioPropertiesInfo.nonlinearVolume>t.audioPropertiesInfo.nonlinearVolume?e:t},void 0);(r=n?o?n.audioPropertiesInfo.nonlinearVolume>o.audioPropertiesInfo.nonlinearVolume?n:o:n:o)&&r.audioPropertiesInfo.nonlinearVolume>-35&&(i=r.streamKey?this._room.remoteUsers.get(r.streamKey.userId):this._room.config.userInfo)&&this.safeEmit(Eu.onActiveSpeaker,{userId:i.userId,extraInfo:i.extraInfo})}}},{key:"enableAudioPropertiesReport",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger.info("enableAudioPropertiesReport()","config %o: ",t);var r=t.enableInBackground,i=void 0===r||r,n=t.localMainReportMode,o=void 0===n?ph.NORMAL:n,a=t.audioReportMode,s=void 0===a?pp.MICROPHONE:a,c=t.interval,d=void 0===c?100:c;this._stopAudioPropertiesReport(),d<=0||(d=Math.max(100,d),this._audioPropertiesReportTimer=self.setInterval(function(){if(i||"hidden"!==document.visibilityState){var t=[],r=e._audioDeviceManager.getRecordTrack()||e._localAudioTrack;if(r){var n,a,c=null===(n=e._room)||void 0===n||null===(a=n.localStream)||void 0===a?void 0:a.audioHasPublish,d=!!e._audioDeviceManager.getRecordTrack(),u=r.getAudioLevel(s),l=Et(u),h={streamIndex:po.STREAM_INDEX_MAIN,audioPropertiesInfo:{linearVolume:u,nonlinearVolume:l}};if(c||d)t.push(h);else switch(o){case ph.DISCONNECT:break;case ph.RESET:h.audioPropertiesInfo.linearVolume=0,h.audioPropertiesInfo.nonlinearVolume=-127,t.push(h);break;case ph.NORMAL:t.push(h);break;default:throw new pB(h6.INVALID_PARAMS,"invalid localMainReportMode: ".concat(o," in config"))}}if(e._localScreenAudioTrack){var p=e._localScreenAudioTrack.getAudioLevel();t.push({streamIndex:po.STREAM_INDEX_SCREEN,audioPropertiesInfo:{linearVolume:p,nonlinearVolume:Et(p)}})}if(e.safeEmit(Eu.onLocalAudioPropertiesReport,t),e._room){var f=[];e._room.config.isMultiChatMode()?e._room.getActiveSpeakerInMultiChatMode().forEach(function(t){var r,i,n=255*t.audioLevel;f.push({streamKey:{userId:t.userId,streamIndex:po.STREAM_INDEX_MAIN,roomId:null!==(r=null===(i=e._room)||void 0===i?void 0:i.config.roomId)&&void 0!==r?r:""},audioPropertiesInfo:{linearVolume:n,nonlinearVolume:Et(n)}})}):e._room.remoteStreams.forEach(function(t,r){t.forEach(function(t){if(t.audioTrack){var i,n,o=t.audioTrack.getAudioLevel();f.push({streamKey:{userId:r,streamIndex:t.isScreen?po.STREAM_INDEX_SCREEN:po.STREAM_INDEX_MAIN,roomId:null!==(i=null===(n=e._room)||void 0===n?void 0:n.config.roomId)&&void 0!==i?i:""},audioPropertiesInfo:{linearVolume:o,nonlinearVolume:Et(o)}})}})}),e.safeEmit(Eu.onRemoteAudioPropertiesReport,f),e._sendActiveSpeaker(t,s8(f).call(f,function(e){return e.streamKey.streamIndex!==po.STREAM_INDEX_SCREEN}))}}},d))}},{key:"setVideoSourceType",value:(j=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setVideoSourceType()","index: %o, videoSourceType: %o",t,r),E_(t,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),E_(r,"VideoSourceType",[h8.VIDEO_SOURCE_TYPE_EXTERNAL,h8.VIDEO_SOURCE_TYPE_INTERNAL]),i=t===po.STREAM_INDEX_MAIN?"video":"screenVideo",this._trackSourceType[i]===r){e.next=26;break}if(this._trackSourceType[i]=r,this.logger.print("setVideoSourceType",sN(n="set ".concat(i," source type to ")).call(n,r)),!this._localVideoTrack||t!==po.STREAM_INDEX_MAIN||(d=!1,r===h8.VIDEO_SOURCE_TYPE_EXTERNAL&&(d=!0,(u=this._ctx.extensionManager.getPluginByName(ys.PRE_PROCESSING,"RTCBeautyExtension"))&&u.emit("stop"),this._removeLocalTrackEvents(this._localVideoTrack),this._localVideoTrack.destroy()),null===(o=this._localVideoTrack)||void 0===o||o.destroy(),this._localVideoTrack=void 0,l=null===(a=this._room)||void 0===a?void 0:a.config.isAutoPublish,d?null===(h=this._room)||void 0===h||null===(p=h.localStream)||void 0===p||null===(f=p.observer)||void 0===f||f.setEnableVideo(!1):null===(_=this._room)||void 0===_||null===(A=_.localStream)||void 0===A||null===(m=A.observer)||void 0===m||m.setPushVideo(!1),!(null!==(s=this._room)&&void 0!==s&&null!==(c=s.localStream)&&void 0!==c&&c.pubVideo||l))){e.next=17;break}return e.next=17,this._updatePublish();case 17:if(!this._localScreenVideoTrack||t!==po.STREAM_INDEX_SCREEN||(S=!1,r===h8.VIDEO_SOURCE_TYPE_EXTERNAL&&(S=!0,this._removeLocalTrackEvents(this._localScreenVideoTrack),this._localScreenVideoTrack.destroy()),null===(v=this._localScreenVideoTrack)||void 0===v||v.destroy(),this._localScreenVideoTrack=void 0,S?null===(b=this._room)||void 0===b||null===(T=b.localScreenStream)||void 0===T||null===(y=T.observer)||void 0===y||y.setEnableVideo(!1):null===(R=this._room)||void 0===R||null===(I=R.localScreenStream)||void 0===I||null===(C=I.observer)||void 0===C||C.setPushVideo(!1),null===(E=this._room)||void 0===E||null===(g=E.localScreenStream)||void 0===g||!g.pubVideo)){e.next=26;break}return e.next=26,this._updateScreenPublish();case 26:case"end":return e.stop()}},e,this)})),function(e,t){return j.apply(this,arguments)})},{key:"setExternalVideoTrack",value:(F=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setExternalVideoTrack()","index: %o, track: %o",t,r),E_(t,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),EA(r),t!==po.STREAM_INDEX_MAIN){e.next=17;break}if(this._trackSourceType.video===h8.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 6:return e.next=8,function(e,t){return Rn.apply(this,arguments)}(this._ctx,r);case 8:if(this._localVideoTrack=e.sent,a=this._ctx.videoProfile.getContentHint(),!r.contentHint&&a&&this._localVideoTrack.setContentHint(a),this._initLocalTrackEvents(this._localVideoTrack),this._localVideoPlayerConfig[po.STREAM_INDEX_MAIN].forEach(function(e){var t,r;null===(t=p._localVideoTrack)||void 0===t||t.setPlayer(e,p._mirrorType,null===(r=p._config)||void 0===r?void 0:r.autoPlayPolicy,p._initPlayerEvents.bind(p))}),s=null===(i=this._room)||void 0===i?void 0:i.config.isAutoPublish,!(null!==(n=this._room)&&void 0!==n&&null!==(o=n.localStream)&&void 0!==o&&o.pubVideo||s)){e.next=17;break}return e.next=17,this._updatePublish();case 17:if(t!==po.STREAM_INDEX_SCREEN){e.next=29;break}if(this._trackSourceType.screenVideo===h8.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=20;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 20:return e.next=22,function(e,t){return Ra.apply(this,arguments)}(this._ctx,r);case 22:if(this._localScreenVideoTrack=e.sent,this._initLocalTrackEvents(this._localScreenVideoTrack,!0),this._localVideoPlayerConfig[po.STREAM_INDEX_SCREEN].forEach(function(e){var t,r;null===(t=p._localScreenVideoTrack)||void 0===t||t.setPlayer(e,p._mirrorType,null===(r=p._config)||void 0===r?void 0:r.autoPlayPolicy,p._initPlayerEvents.bind(p))}),null===(c=this._room)||void 0===c||null===(d=c.localScreenStream)||void 0===d||null===(u=d.observer)||void 0===u||u.setPushVideo(!0),null===(l=this._room)||void 0===l||null===(h=l.localScreenStream)||void 0===h||!h.pubVideo){e.next=29;break}return e.next=29,this._updateScreenPublish();case 29:case"end":return e.stop()}},e,this)})),function(e,t){return F.apply(this,arguments)})},{key:"setAudioSourceType",value:(V=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setAudioSourceType()","index: %o, audioSourceType: %o",t,r),E_(t,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),E_(r,"audioSourceType",[h5.AUDIO_SOURCE_TYPE_EXTERNAL,h5.AUDIO_SOURCE_TYPE_INTERNAL]),i=t===po.STREAM_INDEX_MAIN?"audio":"screenAudio",this._trackSourceType[i]===r){e.next=24;break}if(this._trackSourceType[i]=r,this.logger.print("setVideoSourceType",sN(n="set ".concat(i," source type to ")).call(n,r)),!this._localAudioTrack||t!==po.STREAM_INDEX_MAIN||(c=!1,this._trackSourceType.audio===h5.AUDIO_SOURCE_TYPE_EXTERNAL&&(c=!0,this._removeLocalTrackEvents(this._localAudioTrack),this._localAudioTrack.destroy()),this._localAudioTrack=void 0,d=null===(o=this._room)||void 0===o?void 0:o.config.isAutoPublish,c?null===(u=this._room)||void 0===u||null===(l=u.localStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setEnableAudio(!1):null===(p=this._room)||void 0===p||null===(f=p.localStream)||void 0===f||null===(_=f.observer)||void 0===_||_.setPushAudio(!1),!(null!==(a=this._room)&&void 0!==a&&null!==(s=a.localStream)&&void 0!==s&&s.pubAudio||d))){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(!this._localScreenAudioTrack||t!==po.STREAM_INDEX_SCREEN||(v=!1,this._trackSourceType.audio===h5.AUDIO_SOURCE_TYPE_EXTERNAL&&(v=!0,this._removeLocalTrackEvents(this._localScreenAudioTrack),this._localScreenAudioTrack.destroy()),this._localScreenAudioTrack=void 0,v?null===(E=this._room)||void 0===E||null===(g=E.localScreenStream)||void 0===g||null===(S=g.observer)||void 0===S||S.setEnableAudio(!1):null===(b=this._room)||void 0===b||null===(T=b.localScreenStream)||void 0===T||null===(y=T.observer)||void 0===y||y.setPushAudio(!1),null===(A=this._room)||void 0===A||null===(m=A.localScreenStream)||void 0===m||!m.pubAudio)){e.next=24;break}return e.next=24,this._updateScreenPublish();case 24:case"end":return e.stop()}},e,this)})),function(e,t){return V.apply(this,arguments)})},{key:"setExternalAudioTrack",value:(B=sk(sI().mark(function e(t,r){var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setExternalAudioTrack()","index: %o, track: %o",t,r),E_(t,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),EA(r),t!==po.STREAM_INDEX_MAIN){e.next=20;break}if(this._trackSourceType.audio===h5.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 6:return e.next=8,function(e,t){return Ro.apply(this,arguments)}(this._ctx,r);case 8:if(this._localAudioTrack=e.sent,this._localAudioTrack.setVolume(this._localAudioVolume),this._initLocalTrackEvents(this._localAudioTrack),(d=this._ctx._localAudioTrackDumpConfig[po.STREAM_INDEX_MAIN]).frameSize&&d.callback&&this._localAudioTrack.setDataFetcher(d.frameSize,d.callback),l=(u=this._ctx.earMonitorSettings[po.STREAM_INDEX_MAIN]).position,h=u.volume,l!==pL.NONE&&(this.setEarMonitorMode(po.STREAM_INDEX_MAIN,l),this.setEarMonitorVolume(po.STREAM_INDEX_MAIN,h)),p=null===(i=this._room)||void 0===i?void 0:i.config.isAutoPublish,null===(n=this._room)||void 0===n||null===(o=n.localStream)||void 0===o||null===(a=o.observer)||void 0===a||a.setPushAudio(!0),!(null!==(s=this._room)&&void 0!==s&&null!==(c=s.localStream)&&void 0!==c&&c.pubAudio||p)){e.next=20;break}return e.next=20,this._updatePublish();case 20:if(t!==po.STREAM_INDEX_SCREEN){e.next=36;break}if(this._trackSourceType.screenAudio===h5.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=23;break}throw new pB(h6.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 23:return e.next=25,function(e,t){return Rs.apply(this,arguments)}(this._ctx,r);case 25:if(this._localScreenAudioTrack=e.sent,this._localScreenAudioTrack.setVolume(this._localScreenAudioVolume),this._initLocalTrackEvents(this._localScreenAudioTrack),(E=this._ctx._localAudioTrackDumpConfig[po.STREAM_INDEX_SCREEN]).frameSize&&E.callback&&this._localScreenAudioTrack.setDataFetcher(E.frameSize,E.callback),S=(g=this._ctx.earMonitorSettings[po.STREAM_INDEX_SCREEN]).position,b=g.volume,S!==pL.NONE&&(this.setEarMonitorMode(po.STREAM_INDEX_SCREEN,S),this.setEarMonitorVolume(po.STREAM_INDEX_SCREEN,b)),null===(f=this._room)||void 0===f||null===(_=f.localScreenStream)||void 0===_||null===(A=_.observer)||void 0===A||A.setPushAudio(!0),null===(m=this._room)||void 0===m||null===(v=m.localScreenStream)||void 0===v||!v.pubAudio){e.next=36;break}return e.next=36,this._updateScreenPublish();case 36:case"end":return e.stop()}},e,this)})),function(e,t){return B.apply(this,arguments)})},{key:"login",value:(U=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("login()","token: %o, userInfo: %o",t,r),Eg(t)||Ef(t,"token"),Eb(r),e.abrupt("return",this._rtmClient.login(t,r));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return U.apply(this,arguments)})},{key:"logout",value:(x=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("logout()"),e.abrupt("return",this._rtmClient.logout());case 2:case"end":return e.stop()}},e,this)})),function(){return x.apply(this,arguments)})},{key:"updateLoginToken",value:(M=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("updateLoginToken()","token: %o",t),Eg(t)||Ef(t,"token"),e.abrupt("return",this._rtmClient.updateLoginToken(t));case 3:case"end":return e.stop()}},e,this)})),function(e){return M.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(L=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("getPeerOnlineStatus()","userId: %o",t),Eb(t),e.abrupt("return",this._rtmClient.getPeerOnlineStatus(t));case 3:case"end":return e.stop()}},e,this)})),function(e){return L.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(D=sk(sI().mark(function e(t,r){var i,n=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Eb(t),ER(r),i=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then(function(e){return n._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!1,i,e),e.id}).catch(function(e){throw n._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!1,i,e),e}));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return D.apply(this,arguments)})},{key:"sendUserBinaryMessageOutsideRoom",value:(P=sk(sI().mark(function e(t,r){var i,n=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Eb(t),Ev(r,"message"),ER(r),i=Date.now(),e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then(function(e){return n._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!0,i,e),e.id}).catch(function(e){throw n._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!0,i,e),e}));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return P.apply(this,arguments)})},{key:"setServerParams",value:(N=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.info("setServerParams()","signature: %o, url: %0",t,r),e.abrupt("return",this._rtmClient.setServerParams(t,r));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return N.apply(this,arguments)})},{key:"sendServerMessage",value:(O=sk(sI().mark(function e(t){var r,i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Ef(t,"message"),ER(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then(function(e){i._messageStatisticsObserver.countServerMessage(!0,!1,r,e)}).catch(function(e){throw i._messageStatisticsObserver.countServerMessage(!1,!1,r,e),e}));case 4:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"sendServerBinaryMessage",value:(w=sk(sI().mark(function e(t){var r,i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Ev(t,"message"),ER(t),r=Date.now(),e.abrupt("return",this._rtmClient.sendServerMessage(t).then(function(e){i._messageStatisticsObserver.countServerMessage(!0,!0,r,e)}).catch(function(e){throw i._messageStatisticsObserver.countServerMessage(!1,!0,r,e),e}));case 4:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"startCloudProxy",value:function(e){if(this._room)throw new pB(h6.START_CLOUD_PROXY_AFTER_JOIN,"[startCloudProxy] should be invoke before join room ");if(this.logger.info("startCloudProxy()",e),Ef(e.logProxy,"logProxy"),Array.isArray(e.accessProxy)){var t,r=sz(e.accessProxy);try{for(r.s();!(t=r.n()).done;)Ef(t.value,"accessProxy")}catch(e){r.e(e)}finally{r.f()}}else Ef(e.accessProxy,"accessProxy");Ef(e.configProxy,"configProxy"),this._originIceConfigRequestUrls=vB("ICE_CONFIG_REQUEST_URLS"),this._originLogServerUrl=vB("LOG_SERVER_URL"),this._originConfigServerUrls=vB("CONFIG_REQUEST_DOMAINS"),vU("ICE_CONFIG_REQUEST_URLS",e.accessProxy),vU("LOG_SERVER_URL",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://".concat(e)),"".concat(e,"/video/v1/webrtc_log/")}(e.logProxy)),vU("CONFIG_REQUEST_DOMAINS",[e.configProxy]),vw.clearAccessNode(this._appId),vw.clearAccessUrls(),this._ctx.useCloudProxy=!0}},{key:"stopCloudProxy",value:function(){if(this._room)throw new pB(h6.STOP_CLOUD_PROXY_BEFORE_LEAVE,"[stopCloudProxy] should be invoke after leave room ");this.logger.info("stopCloudProxy()");var e,t,r,i=null===(e=this._originIceConfigRequestUrls)||void 0===e?void 0:sU(e).call(e,function(e){return e.replace("https://","").replace("/dispatch/v1/AccessInfo?Action=GetAccessInfo","")});vU("ICE_CONFIG_REQUEST_URLS",null!=i?i:[]),vU("LOG_SERVER_URL",null!==(t=this._originLogServerUrl)&&void 0!==t?t:""),vU("CONFIG_REQUEST_DOMAINS",null!==(r=this._originConfigServerUrls)&&void 0!==r?r:[]),vw.clearAccessNode(this._appId),vw.clearAccessUrls(),this._ctx.useCloudProxy=!1,this._startCloudProxyTimestamp=void 0}},{key:"startPushPublicStream",value:(k=sk(sI().mark(function e(t,r){var i,n,o,a,s,c=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),ET(t),this._assertNotInRoom(),!this._publicStreamIds.get(t)){e.next=5;break}throw new pB(h6.REPEAT_PUSH,"repeat push public media stream");case 5:return this._room&&(null===(o=r.layout)||void 0===o||null===(a=o.regions)||void 0===a||sU(a).call(a,function(e){var t;e.roomId=null===(t=c._room)||void 0===t?void 0:t.config.roomId})),s=vV(t,"started",r),e.abrupt("return",null===(i=this._room)||void 0===i||null===(n=i.publicStreamControlMessage(s))||void 0===n?void 0:n.then(function(){c._publicStreamIds.set(t,t)}));case 8:case"end":return e.stop()}},e,this)})),function(e,t){return k.apply(this,arguments)})},{key:"updatePublicStreamParam",value:(C=sk(sI().mark(function e(t,r){var i,n;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),ET(t),this._assertNotInRoom(),n=vV(t,"layoutChanged",r),e.abrupt("return",null===(i=this._room)||void 0===i?void 0:i.publicStreamControlMessage(n));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return C.apply(this,arguments)})},{key:"stopPushPublicStream",value:(I=sk(sI().mark(function e(t){var r,i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startPushPublicStream()","publicStreamId: %o",t),ET(t),this._assertNotInRoom(),e.abrupt("return",null===(r=this._room)||void 0===r?void 0:r.publicStreamControlMessage({type:"publicstream",action:"stopped",publicStreamID:t}).then(function(){i._publicStreamIds.delete(t)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return I.apply(this,arguments)})},{key:"startPlayPublicStream",value:(R=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._wtnStreamManager.startPlayWTN(null,t,!1,!1);case 2:case"end":return e.stop()}},e,this)})),function(e){return R.apply(this,arguments)})},{key:"stopPlayPublicStream",value:(y=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._wtnStreamManager.stopPlayWTN(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"setAudioProfile",value:(T=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.info("setAudioProfile()","profile: %o",t),this._shouldUpdateAudioConf("setAudioProfile")&&this._ctx.audioProfileManager.setAudioProfile(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"setAudioEncodeMaxBitrate",value:(b=sk(sI().mark(function e(t){var r,i,n,o,a,s;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("setAudioEncodeMaxBitrate()",t),Ep(t,"maxBitrate",6,256),this._ctx.audioProfileManager.setCustomMaxBitrate(t),!this._ctx.audioProfileManager.customMaxBitrate){e.next=10;break}if(!m4||!(null!==(r=this._room)&&void 0!==r&&null!==(i=r.localStream)&&void 0!==i&&i.pubAudio||null!==(n=this._room)&&void 0!==n&&null!==(o=n.localScreenStream)&&void 0!==o&&o.pubAudio)){e.next=6;break}throw new pB(h6.NOT_SUPPORTED,"Your browser does not support set audio encode maxBitrate dynamically.");case 6:return e.next=8,null===(a=this._room)||void 0===a?void 0:a.setAudioEncodeMaxBitrate(po.STREAM_INDEX_MAIN,t);case 8:return e.next=10,null===(s=this._room)||void 0===s?void 0:s.setAudioEncodeMaxBitrate(po.STREAM_INDEX_SCREEN,t);case 10:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"setPublicStreamVideoPlayer",value:function(e,t){return this._wtnStreamManager.setWTNRemoteVideoPlayer(e,t)}},{key:"setDummyCaptureImagePath",value:(S=sk(sI().mark(function e(t,r){var i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new sP(function(e,n){Ef(r,"filePath");var o=new Image;o.crossOrigin="anonymous",o.src=r,o.onload=function(){t===po.STREAM_INDEX_MAIN?i._dummyMainImage=o:i._dummyScreenImage=o;try{i._updateDummyCaptureImage(t),e()}catch(e){n(new pB(h6.UNEXPECTED_ERROR,e.message))}},o.onerror=function(){n(new pB(h6.UNEXPECTED_ERROR,"Load image error"))}}));case 1:case"end":return e.stop()}},e)})),function(e,t){return S.apply(this,arguments)})},{key:"_updateDummyCaptureImage",value:function(e){var t,r;if(e===po.STREAM_INDEX_MAIN?(t=this._dummyMainImage,r=this._ctx.videoProfile.getVideoEncodeConfig()[0]):(t=this._dummyScreenImage,r=this._ctx.videoProfile.getScreenEncodeConfig()),t){var i,n,o=document.createElement("canvas"),a=o.getContext("2d"),s=Ec(r.width),c=Ec(r.height);if(!a)throw new pB(h6.UNEXPECTED_ERROR,"Not support canvas");!s||!c||t.width<=s&&t.height<=c?(i=t.width,n=t.height):(i=Math.min(s,t.width*c/t.height),n=Math.min(c,t.height*s/t.width)),o.width=i,o.height=n,a.drawImage(t,0,0,t.width,t.height,0,0,i,n);var d=window.setInterval(function(){t&&a.drawImage(t,0,0,t.width,t.height,0,0,i,n)},200);e===po.STREAM_INDEX_MAIN?(clearInterval(this._dummyMainTimer),this._dummyMainTimer=d):(clearInterval(this._dummyScreenTimer),this._dummyScreenTimer=d);var u,l,h=o.captureStream(5).getVideoTracks()[0];e===po.STREAM_INDEX_MAIN?(this._localImgVideoTrack=h,null!==(u=this._localVideoTrack)&&void 0!==u&&u.dummy&&this._localVideoTrack.setTrack(this._localImgVideoTrack)):(this._localImgScreenTrack=h,null!==(l=this._localScreenVideoTrack)&&void 0!==l&&l.dummy&&this._localScreenVideoTrack.setTrack(this._localImgScreenTrack))}}},{key:"_addListenExtensionEvent",value:function(e){var t,r=this;e.on("re-capture-audio",function(){r._localAudioTrack&&r.stopAudioCapture().then(function(){r.startAudioCapture()})}),e.on("re-capture-video",function(){r._localVideoTrack&&!r._localVideoTrack.dummy&&r.stopVideoCapture().then(function(){r.startVideoCapture()})}),e.on("reset-video-effect",(t=sk(sI().mark(function e(t,i){var n,o;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r._localVideoTrack||r._localVideoTrack.dummy){e.next=19;break}return r._localVideoTrack&&r._removeLocalTrackEvents(r._localVideoTrack),e.prev=2,e.next=5,r._localVideoTrack.generatePreProcessingTrack();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),i(e.t0);case 10:if(r._initLocalTrackEvents(r._localVideoTrack),r._localVideoTrack.stopAll(),r._localVideoTrack.playAll(),r.safeEmit(Eu.onLocalStreamTrackChangedByExtension,{streamIndex:po.STREAM_INDEX_MAIN,type:"video"}),t(),null===(n=r._room)||void 0===n||null===(o=n.localStream)||void 0===o||!o.pubVideo){e.next=18;break}return e.next=18,r._updatePublish();case 18:r._wtnStreamManager._updatePushTrack();case 19:t();case 20:case"end":return e.stop()}},e,null,[[2,7]])})),function(e,r){return t.apply(this,arguments)}))}},{key:"registerExtension",value:(g=sk(sI().mark(function e(t){var r,i,n,o,a,s,c,d,u,l;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.monitor=this.monitor,t.logger=new mJ(t.name,0,this.id),e.prev=2,e.next=5,t.isSupported();case 5:if(e.sent){e.next=8;break}throw Error("This extension is not supported.");case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(2),Error("This extension is not supported.");case 13:return vB("VERSION")!==t.version&&(Es(sN(o="This extension version is ".concat(t.version,", but the sdk version is ")).call(o,vB("VERSION"),".")),this.monitor.report("rtc_error",{message:sN(a="This extension version is ".concat(t.version,", but the sdk version is ")).call(a,vB("VERSION"),"."),error_code:-1})),s={},"RTCAIAnsExtension"===t.name&&(c=vB("AINR_OVERLOAD_THRESHOLD"),d=vB("AINR_ENABLE_DUMP"),u=vB("AINR_URLS"),l=vB("AINR_CACHE_TIME"),s={overloadThreshold:c,enableCache:d,urls:u,cacheTime:l,dumpTime:vB("AINR_DUMP_TIME")}),s=function(e){var t={};return cG(e).forEach(function(r){void 0!==e[r]&&(t[r]=e[r])}),t}(s),e.next=19,t.init(s);case 19:this._ctx.extensionManager.register(t),this._addListenExtensionEvent(t),null===(r=this._localAudioTrack)||void 0===r||r.generatePreProcessingTrack(),null===(i=this._localVideoTrack)||void 0===i||i.generatePreProcessingTrack(),null===(n=this._localScreenAudioTrack)||void 0===n||n.generatePreProcessingTrack();case 24:case"end":return e.stop()}},e,this,[[2,10]])})),function(e){return g.apply(this,arguments)})},{key:"defaultTranscoding",value:function(){return JSON.parse(sD(kh.getDefaultValue()))}},{key:"_updatePublish",value:(E=sk(sI().mark(function e(){var t,r,i,n=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1&&void 0!==n[1]&&n[1],this.logger.info("_updatePublish()","config: %o",t),t=l9(l9({},{mediaType:void 0,invokeByJoinRoom:!1,pubState:Rb.PUB}),t),this._ctx.visibility){e.next=7;break}throw new pB(h6.NO_PUBLISH_PERMISSION,"no publish permission");case 7:return e.next=9,this._pubLock.lock();case 9:if(i=e.sent,this._room&&this._ctx.signalingManager.isConnected()){e.next=17;break}if(i(),!r){e.next=16;break}throw new pB(h6.NOT_CONNECTED_YET,"not connected");case 16:return e.abrupt("return");case 17:return e.prev=17,e.next=20,this._room.publish(this._localVideoTrack,this._localAudioTrack,t.mediaType,t.pubState,t.invokeByJoinRoom);case 20:e.next=30;break;case 22:if(e.prev=22,e.t0=e.catch(17),!(e.t0 instanceof pB)){e.next=29;break}throw e.t0.code===h6.TOKEN_NO_PUBLISH_PERMISSION&&this._room.config.setTokenPublishPrivilegeExpired(!0),e.t0;case 29:throw new pB(h6.UNEXPECTED_ERROR,"unexpected error",e.t0);case 30:return e.prev=30,i(),e.finish(30);case 33:case"end":return e.stop()}},e,this,[[17,22,30,33]])})),function(){return E.apply(this,arguments)})},{key:"startAudioPlaybackDeviceTest",value:(v=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startAudioPlaybackDeviceTest()","filePath: %o, indicationInterval: %o",t,r),Ef(t,"filePath"),Ep(r,"indicationInterval"),e.next=5,this._audioDeviceManager.startAudioPlaybackDeviceTest(t,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this.logger.info("stopAudioPlaybackDeviceTest()"),this._audioDeviceManager.stopAudioPlaybackDeviceTest()}},{key:"startAudioDeviceRecordTest",value:(m=sk(sI().mark(function e(t,r){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("startAudioDeviceRecordTest()","indicationInterval: %o",t),Ep(t,"indicationInterval"),e.next=4,this._audioDeviceManager.startAudioDeviceRecordTest(t,r,this._localAudioVolume);case 4:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){this.logger.info("stopAudioDeviceRecordAndPlayTest()"),this._audioDeviceManager.stopAudioDeviceRecordAndPlayTest()}},{key:"stopAudioDevicePlayTest",value:function(){this.logger.info("stopAudioDevicePlayTest()"),this._audioDeviceManager.stopAudioDevicePlayTest()}},{key:"setRemoteUserPriority",value:function(e,t){var r;this.logger.print("setRemoteUserPriority()","userId: %o, priority: %o",e,t);try{Eb(e),E_(t,"priority",[pE.HIGH,pE.MEDIUM,pE.LOW])}catch(e){return console.warn(e),!1}return this._ctx.userPriority.set(e,t),null===(r=this._room)||void 0===r||r.updateRemoteUserPriority(e),!0}},{key:"takeLocalSnapshot",value:(A=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("takeLocalSnapshot()","streamIndex: %o",t),E_(t,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),r=t===po.STREAM_INDEX_MAIN?this.localVideoTrack:this.localScreenVideoTrack){e.next=5;break}throw new pB(h6.INVOKED_BEFORE_CAPTURE,"capture first");case 5:return e.abrupt("return",r.snapshot());case 6:case"end":return e.stop()}},e,this)})),function(e){return A.apply(this,arguments)})},{key:"takeRemoteSnapshot",value:(_=sk(sI().mark(function e(t,r){var i,n,o,a;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.print("takeRemoteSnapshot()","id: %o, streamIndex: %o",t,r),Ef(t,"id"),E_(r,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),a=(null===(i=this._room)||void 0===i||null===(n=i.remoteStreams.get(t))||void 0===n||null===(o=uC(n).call(n,function(e){return e.isScreen===(r===po.STREAM_INDEX_SCREEN)}))||void 0===o?void 0:o.videoTrack)||this._wtnStreamManager.__getPublicStreamTrack(t,"video")){e.next=6;break}throw new pB(h6.STREAM_NOT_EXIST,"stream not exist");case 6:return e.abrupt("return",a.snapshot());case 7:case"end":return e.stop()}},e,this)})),function(e,t){return _.apply(this,arguments)})},{key:"setSubscribeFallbackOption",value:function(e){this.logger.info("setSubscribeFallbackOption()","option: %o",e);try{E_(e,"option",[pv.DISABLE,pv.VIDEO_STREAM_LOW,pv.AUDIO_ONLY])}catch(e){return console.warn(e),!1}return!this._room&&(this._ctx.subscribeFallbackOption=e,!0)}},{key:"getLocalStreamTrack",value:function(e,t){var r,i,n=this;if(e===po.STREAM_INDEX_MAIN?(r="video"===t?this.localVideoTrack:this.localAudioTrack,i=function(){var e;return null===(e=n._room)||void 0===e?void 0:e.localStream}):(r="video"===t?this.localScreenVideoTrack:this.localScreenAudioTrack,i=function(){var e;return null===(e=n._room)||void 0===e?void 0:e.localScreenStream}),r){var o=r instanceof yX&&r.mixedAudioTrack?r.mixedAudioTrack:r.preprocessingTrack;if(o){var a=i();return this._reportMsTrackEvent(o,(null==a?void 0:a.stream.id)||"local"),o}}}},{key:"getRemoteStreamTrack",value:function(e,t,r){var i,n,o,a,s,c,d,u=(null===(c=this._room)||void 0===c?void 0:c.remoteStreams.get(e))||[];if(null!=u&&u.length&&(t===po.STREAM_INDEX_MAIN?(i=uC(u).call(u,function(e){return!e.isScreen}),d="video"===r?null===(n=i)||void 0===n?void 0:n.videoTrack:null===(o=i)||void 0===o?void 0:o.audioTrack):(i=uC(u).call(u,function(e){return e.isScreen}),d="video"===r?null===(a=i)||void 0===a?void 0:a.videoTrack:null===(s=i)||void 0===s?void 0:s.audioTrack),d)){var l=d.preprocessingTrack;if(l&&i){var h=i.streamId;return this._reportMsTrackEvent(l,h),l}}}},{key:"getPublicStreamTrack",value:function(e,t){var r=this._wtnStreamManager.__getPublicStreamTrack(e,t),i=null==r?void 0:r.preprocessingTrack;if(i)return i?(this._reportMsTrackEvent(i,e),i):void 0}},{key:"setRemoteStreamRenderSync",value:function(e){return!this._room&&(this._ctx.avSync=!!e,!0)}},{key:"setJoinRoomParams",value:function(e){e&&(this._ctx.joinRoomParams=e)}},{key:"setAudioSelectionConfig",value:(f=sk(sI().mark(function e(t){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(E_(t,"audioSelectionPriority",[pN.DEFAULT,pN.HIGH]),this._ctx.mediaParams||(this._ctx.mediaParams={}),this._ctx.mediaParams.audioSelectionConfig={isHighPriority:t===pN.HIGH},!this._room){e.next=6;break}return e.next=6,this._room.updateMediaParams(this._ctx.mediaParams);case 6:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"setCaptureVolume",value:function(e,t){var r,i,n,o,a,s=this;(E_(e,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),t=Ek(t,"volume",0,400),e===po.STREAM_INDEX_SCREEN)?(null===(r=this._localScreenAudioTrack)||void 0===r||r.once("needReplaceTrack",function(){var e;null===(e=s._room)||void 0===e||e.updatePubScreenTrack()}),null===(i=this._localScreenAudioTrack)||void 0===i||i.setVolume(t),this._localScreenAudioVolume=t):(null===(n=this._localAudioTrack)||void 0===n||n.once("needReplaceTrack",function(){var e;null===(e=s._room)||void 0===e||e.updatePubTrack()}),null===(o=this._localAudioTrack)||void 0===o||o.setVolume(t),null===(a=this._audioDeviceManager.audioTrack)||void 0===a||a.setVolume(t),this._localAudioVolume=t)}},{key:"setPlaybackVolume",value:function(e,t,r){var i,n,o,a;if(Eb(e),E_(t,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),r=Ek(r,"volume",0,400),null!==(i=this._room)&&void 0!==i&&i.config.isMultiChatMode())Es("setPlaybackVolume is not supported in Conference mode");else{var s=t===po.STREAM_INDEX_SCREEN;s?this._remoteScreenAudioVolume.set(e,r):this._remoteAudioVolume.set(e,r);var c=null===(n=this._room)||void 0===n||null===(o=n.remoteStreams.get(e))||void 0===o?void 0:uC(o).call(o,function(e){return e.isScreen===s});null==c||null===(a=c.audioTrack)||void 0===a||a.setVolume(r)}}},{key:"setPublicStreamVolume",value:function(e,t){this._wtnStreamManager.setWTNRemoteAudioPlaybackVolume(e,t)}},{key:"startForwardStreamToRooms",value:(p=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach(function(e){ES(e.roomId)}),this._assertNotInRoom(),e.next=4,this._room.startForwardStream2Rooms(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"updateForwardStreamToRooms",value:(h=sk(sI().mark(function e(t){var r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach(function(e){ES(e.roomId)}),this._assertNotInRoom(),e.next=4,this._room.updateForwardStream2Rooms(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"stopForwardStreamToRooms",value:(l=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.stopForwardStream2Rooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"pauseForwardStreamToAllRooms",value:(u=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.pauseForwardStream2AllRooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"resumeForwardStreamToAllRooms",value:(d=sk(sI().mark(function e(){var t;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertNotInRoom(),e.next=3,this._room.resumeForwardStream2AllRooms();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"ambulance",value:(c=sk(sI().mark(function e(){var t,r;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(e){return kx.apply(this,arguments)}(this);case 2:return r=sD(t=e.sent),this.monitor.reportLongString("ambulance",r),e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"setEarMonitorMode",value:(s=sk(sI().mark(function e(t,r){var i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("setEarMonitorMode()","streamIndex: %s, position: %s",t,r),E_(t,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),E_(r,"position",[pL.NONE,pL.AFTER_CAPTURE,pL.AFTER_PROCESS]),this._ctx.earMonitorSettings[t].position=r,i=t===po.STREAM_INDEX_MAIN?this.localAudioTrack:t===po.STREAM_INDEX_SCREEN?this.localScreenAudioTrack:void 0){e.next=8;break}return this.logger.warn("setEarMonitorMode()","local audio track not exist"),e.abrupt("return");case 8:if(r===pL.NONE){e.next=12;break}return e.abrupt("return",i.play(r));case 12:return e.abrupt("return",i.stop());case 13:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"setEarMonitorVolume",value:function(e,t){this.logger.info("setEarMonitorVolume()","streamIndex: %s, volume: %s",e,t),E_(e,"streamIndex",[po.STREAM_INDEX_MAIN,po.STREAM_INDEX_SCREEN]),t=Ek(t,"volume",0,400),this._ctx.earMonitorSettings[e].volume=t;var r=e===po.STREAM_INDEX_MAIN?this.localAudioTrack:e===po.STREAM_INDEX_SCREEN?this.localScreenAudioTrack:void 0;if(r)return r.setPlaybackVolume(t);this.logger.warn("setEarMonitorVolume()","local audio track not exist")}},{key:"setUserInfo",value:function(e,t){ES(e),Eb(t),this.monitor.set({room_id:e,user_id:t})}},{key:"_reportMsTrackEvent",value:function(e,t){var r=this;if(!e.hookStop){e.hookStop=!0;var i=e.stop;e.stop=function(){mw(r.id,"stop",t,0,t),i.call(e)}}}},{key:"_updateScreenPublish",value:(a=sk(sI().mark(function e(){var t,r,i=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},this.logger.info("_updateScreenPublish()"),t=l9(l9({},{mediaType:void 0,pubState:Rb.PUB}),t),this._ctx.visibility){e.next=6;break}throw new pB(h6.NO_PUBLISH_PERMISSION,"no publish permission");case 6:return e.next=8,this._pubLock.lock();case 8:if(r=e.sent,this._room&&this._ctx.signalingManager.isConnected()){e.next=12;break}return r(),e.abrupt("return");case 12:return e.prev=12,e.next=15,this._room.publishScreen(this._localScreenVideoTrack,this._localScreenAudioTrack,t.mediaType,t.pubState);case 15:e.next=24;break;case 17:if(e.prev=17,e.t0=e.catch(12),!(e.t0 instanceof pB)){e.next=23;break}throw e.t0;case 23:throw new pB(h6.UNEXPECTED_ERROR,"unexpected error",e.t0);case 24:return e.prev=24,r(),e.finish(24);case 27:case"end":return e.stop()}},e,this,[[12,17,24,27]])})),function(){return a.apply(this,arguments)})},{key:"_updateAudioPlayerState",value:function(e){this.logger.info("_updateAudioPlayerState()");var t,r=e.userId,i=e.isScreen,n=e.isPublic;if(e.audioTrack&&e.attributes.audiostream&&e.subAudio){if(!e.audioTrack.havePlayer()){var o,a,s,c,d,u,l,h=new yQ(this.id,r,{muted:(null===(u=this._config)||void 0===u?void 0:u.autoPlayPolicy)===py.VIDEO_ONLY||(null===(l=this._config)||void 0===l?void 0:l.autoPlayPolicy)===py.PLAY_MANUALLY,isScreen:!n&&i});e.audioTrack.setPlayer(h),e.audioTrack.bindPlayerEvent(this._initPlayerEvents.bind(this));var p=this._audioDeviceManager.getSinkId();p&&e.audioTrack.setPlaybackDevice(p)}e.audioTrack.play();var f=n?null!==(s=this._ctx.publicAudioVolume.get(r))&&void 0!==s?s:100:i?null!==(c=this._remoteScreenAudioVolume.get(r))&&void 0!==c?c:100:null!==(d=this._remoteAudioVolume.get(r))&&void 0!==d?d:100;if(e.audioTrack.setVolume(f),m6&&vi){;kp(null!==(o=null===(a=this._room)||void 0===a?void 0:a.remoteStreams)&&void 0!==o?o:new d9)}}else null===(t=e.audioTrack)||void 0===t||t.stop()}},{key:"_updateVideoPlayerState",value:function(e){if(this.logger.info("_updateVideoPlayerState()"),e.videoTrack){var t=e.isPublic?this._wtnStreamManager._publicVideoPlayerConfig:this._remoteVideoPlayerConfig[e.isScreen?po.STREAM_INDEX_SCREEN:po.STREAM_INDEX_MAIN].get(e.userId);if(t){var r,i=sz(t);try{for(i.s();!(r=i.n()).done;){var n,o=sq(r.value,2)[1];e.videoTrack.setPlayer(this.id,o,null===(n=this._config)||void 0===n?void 0:n.autoPlayPolicy,this._initPlayerEvents.bind(this))}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"_localVideoTrack",get:function(){return this._ctx.localVideoTrack},set:function(e){this._ctx.localVideoTrack=e}},{key:"_localAudioTrack",get:function(){return this._ctx.localAudioTrack},set:function(e){this._ctx.localAudioTrack=e}},{key:"_onAddStream",value:(o=sk(sI().mark(function e(t){var r,i,n,o,a,s,c;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(i=(r=t.stream).attributes).localaudio,o=i.audiostream,a=i.localvideo,s=i.videostream,c=vP.NONE,o&&(c|=pa.AUDIO),s&&(c|=pa.VIDEO),!c){e.next=11;break}return e.next=8,new sP(function(e){return setTimeout(e)});case 8:r.isScreen?this.safeEmit(Eu.onUserPublishScreen,{userId:r.userId,mediaType:c}):(this.safeEmit(Eu.onUserPublishStream,{userId:r.userId,mediaType:c,videoStreamDescriptions:r.attributes.videoDescriptions}),this._handleAutoSubscribe(r,!0)),this.safeEmit("onAddStream",{userId:r.userId,mediaType:c,isScreen:!!r.isScreen}),r.isScreen||(n&&this.safeEmit(Eu.onUserStartAudioCapture,{userId:r.userId}),a&&this.safeEmit(Eu.onUserStartVideoCapture,{userId:r.userId}));case 11:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"_handleAutoSubscribe",value:function(e,t){var r,i,n,o,a,s=vP.NONE;null!==(o=this._room)&&void 0!==o&&o.config.isAutoSubscribeAudio&&(s|=pa.AUDIO),null!==(a=this._room)&&void 0!==a&&a.config.isAutoSubscribeVideo&&(s|=pa.VIDEO),s&&(t&&Er(s)&&(null===(i=e.observer)||void 0===i||i.setAutoSubscribeAudio(!0)),t&&Ei(s)&&(null===(n=e.observer)||void 0===n||n.setAutoSubscribeVideo(!0)),null!==(r=this._room)&&void 0!==r&&r.config.tokenSubscribePrivilegeExpired?(Er(s)&&(this._pauseAllSubscribeState.resumeAudioStreamIds[e.streamId]=e.streamId),Ei(s)&&(this._pauseAllSubscribeState.resumeVideoStreamIds[e.streamId]=e.streamId)):this._subscribe(!1,e.userId,s))}},{key:"_onRemoveStream",value:function(e){var t,r=e.stream,i=null!==(t=k4[e.reason])&&void 0!==t?t:ps.STREAM_REMOVE_REASON_OTHER,n=r.isScreen?Eu.onUserUnpublishScreen:Eu.onUserUnpublishStream,o=vP.NONE;r.attributes.audiostream&&(o|=pa.AUDIO),r.attributes.videostream&&(o|=pa.VIDEO),o!==vP.NONE&&(this.safeEmit(n,{userId:r.userId,mediaType:o,reason:i}),this.safeEmit("onRemoveStream",{userId:r.userId,isScreen:r.isScreen})),delete this._pauseAllSubscribeState.resumeAudioStreamIds[r.streamId],delete this._pauseAllSubscribeState.resumeVideoStreamIds[r.streamId],"function"==typeof e.callback&&e.callback()}},{key:"_onUserConnection",value:function(e){var t=this;setTimeout(function(){return t.safeEmit(Eu.onUserJoined,e)})}},{key:"_onUserLeave",value:function(e){this.safeEmit(Eu.onUserLeave,e)}},{key:"_onRoomError",value:function(e){var t;this.safeEmit(Eu.onError,e),null===(t=this._room)||void 0===t||t.destroy(),this._room=void 0}},{key:"_onNetworkQuality",value:function(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];this.safeEmit.apply(this,sN(e=[Eu.onNetworkQuality]).call(e,r))}},{key:"_onConnectionStateChange",value:function(e){if(void 0!==this._startCloudProxyTimestamp&&this._ctx.useCloudProxy&&e.state===pc.CONNECTION_STATE_CONNECTED&&this.safeEmit(Eu.onCloudProxyConnected,{interval:Date.now()-this._startCloudProxyTimestamp}),(this._ctx.isPreConnection||e.state!==pc.CONNECTION_STATE_CONNECTED&&e.state!==pc.CONNECTION_STATE_RECONNECTED)&&this.safeEmit(Eu.onConnectionStateChanged,e),e.state===pc.CONNECTION_STATE_RECONNECTING){var t,r,i,n=sz(null!==(t=null===(r=this._room)||void 0===r?void 0:r.remoteStreams)&&void 0!==t?t:new d9);try{for(n.s();!(i=n.n()).done;){var o=sq(i.value,2),a=o[0],s=o[1];h4(a).call(a,"mux")&&s.forEach(function(e){var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.stop()})}}catch(e){n.e(e)}finally{n.f()}}else e.state===pc.CONNECTION_STATE_CONNECTED&&this._rtmClient.setRTSMessageLimit(this._ctx.rtsLimiter.conf)}},{key:"_stopAudioPropertiesReport",value:function(){null!==this._audioPropertiesReportTimer&&(clearInterval(this._audioPropertiesReportTimer),this._audioPropertiesReportTimer=null)}},{key:"_onResubscribe",value:function(e){var t,r;e.stream&&(null===(t=e.stream.videoTrack)||void 0===t||t.stopAll(),null===(r=e.stream.audioTrack)||void 0===r||r.stop(),this._updateAudioPlayerState(e.stream),this._updateVideoPlayerState(e.stream))}},{key:"_onSubscribePushTrack",value:function(e){e.stream&&this._updateAudioPlayerState(e.stream)}},{key:"_onRemovePushTrack",value:function(e){e.stream&&this._updateAudioPlayerState(e.stream)}},{key:"_onVideoDeviceStateChange",value:function(e){this.safeEmit(Eu.onVideoDeviceStateChanged,e)}},{key:"_onAudioDeviceStateChange",value:function(e){this.safeEmit(Eu.onAudioDeviceStateChanged,e)}},{key:"_onUserPublishStateChange",value:function(e){var t=this,r=e.userId,i=e.isScreen,n=e.mediaType,o=e.pubState,a=e.remoteStream,s={userId:r,mediaType:n};n&pa.AUDIO&&setTimeout(function(){t._updateAudioPlayerState(a)}),i?o===Rb.PUB?this.safeEmit(Eu.onUserPublishScreen,s):this.safeEmit(Eu.onUserUnpublishScreen,l9(l9({},s),{},{reason:ps.STREAM_REMOVE_REASON_UNPUBLISH})):o===Rb.PUB?(s.videoStreamDescriptions=a.attributes.videoDescriptions,this.safeEmit(Eu.onUserPublishStream,s),this._handleAutoSubscribe(a,!0)):this.safeEmit(Eu.onUserUnpublishStream,l9(l9({},s),{},{reason:ps.STREAM_REMOVE_REASON_UNPUBLISH}))}},{key:"_onCustomMessage",value:function(e){var t=e.message;e.binary?this.safeEmit(Eu.onRoomBinaryMessageReceived,{userId:e.clientId,message:t}):this.safeEmit(Eu.onRoomMessageReceived,{userId:e.clientId,message:t})}},{key:"_onUserMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(Eu.onUserMessageReceived,e)}},{key:"_onUserBinaryMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(Eu.onUserBinaryMessageReceived,e)}},{key:"_onLiveTranscodingResult",value:function(e){this.safeEmit(Eu.onLiveTranscodingResult,e)}},{key:"_onStreamMixingEvent",value:function(e){this.safeEmit(Eu.onStreamMixingEvent,e)}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(Eu.onTokenWillExpire)}},{key:"_onUserTokenPublishPrivilegeWillExpire",value:function(){this.safeEmit(Eu.onTokenPublishPrivilegeWillExpire)}},{key:"_onUserTokenPublishPrivilegeDidExpired",value:(n=sk(sI().mark(function e(){var t,r,i;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this._room)||void 0===t?void 0:t.unpublish();case 2:return e.next=4,null===(r=this._room)||void 0===r?void 0:r.unpublishScreen();case 4:null===(i=this._room)||void 0===i||i.config.setTokenPublishPrivilegeExpired(!0),this.safeEmit(Eu.onTokenPublishPrivilegeDidExpired,{errorCode:h6.TOKEN_NO_PUBLISH_PERMISSION,message:"Token no longer has publish privilege"});case 6:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"_onUserTokenSubscribePrivilegeWillExpire",value:function(){this.safeEmit(Eu.onTokenSubscribePrivilegeWillExpire)}},{key:"_onUserTokenSubscribePrivilegeDidExpired",value:(i=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._handleLoseSubscribePrivilege(),this.safeEmit(Eu.onTokenSubscribePrivilegeDidExpired,{errorCode:h6.TOKEN_NO_SUBSCRIBE_PERMISSION,message:"Token no longer has subscribe privilege"});case 2:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_unSubscribeAllRemoteStreams",value:(r=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._room){e.next=2;break}return e.abrupt("return",sP.resolve());case 2:return e.abrupt("return",this._pauseAllRemoteStreams(pa.AUDIO_AND_VIDEO));case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"_onPushPublicStreamResult",value:function(e){this.safeEmit(Eu.onPushPublicStreamResult,e)}},{key:"_handleRTMClient",value:function(e){var t=this;e.on("onUserMessageReceivedOutsideRoom",function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(Eu.onUserMessageReceivedOutsideRoom,e)}),e.on("onUserBinaryMessageReceivedOutsideRoom",function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(Eu.onUserBinaryMessageReceivedOutsideRoom,e)}),e.on("onUserDisconnection",function(){t.safeEmit(Eu.onError,{errorCode:h6.RTM_DUPLICATE_LOGIN})}),e.on("onRTMTokenError",function(){t.safeEmit(Eu.onError,{errorCode:h6.RTM_TOKEN_ERROR})}),e.on("onServerParamsSetResult",function(e){t.safeEmit(Eu.onServerParamsSetResult,null==e?void 0:e.code)})}},{key:"getSubLock",value:function(e,t){var r,i=e?this._subScreenLocks:this._subLocks,n=i.get(t);return n||(n=new RG(sN(r="sub_".concat(e?1:0,"_")).call(r,t)),i.set(t,n)),n}},{key:"localAudioTrack",get:function(){return this._localAudioTrack}},{key:"localVideoTrack",get:function(){return this._localVideoTrack}},{key:"localScreenAudioTrack",get:function(){return this._localScreenAudioTrack}},{key:"localScreenVideoTrack",get:function(){return this._localScreenVideoTrack}},{key:"remoteStreams",get:function(){var e,t=[];return null!==(e=this._room)&&void 0!==e&&e.remoteStreams&&this._room.remoteStreams.forEach(function(e){Array.isArray(e)&&e.forEach(function(e){t.push({userId:e.userId,isScreen:e.isScreen,hasVideo:e.hasVideo,hasAudio:e.hasAudio,videoStreamDescriptions:e.attributes.videoDescriptions})})}),t}},{key:"iceState",get:function(){var e;return null===(e=this._ctx.peerConnection)||void 0===e?void 0:e.getIceConnectionState()}},{key:"remoteUsers",get:function(){var e,t=[];return null!==(e=this._room)&&void 0!==e&&e.remoteUsers&&this._room.remoteUsers.forEach(function(e){t.push({userId:e.userId})}),t}},{key:"multiChatMode",get:function(){var e;return!(null===(e=this._room)||void 0===e||!e.config.isMultiChatMode())}},{key:"checkMediaType",get:function(){return this._checkMediaType}},{key:"assertNotInRoom",get:function(){return this._assertNotInRoom}},{key:"peerConnection",get:function(){var e;return null===(e=this._ctx.peerConnection)||void 0===e?void 0:e.getOriginRTCPeerConnection()}},{key:"_handleAudioDeviceManager",value:function(){var e=this;this._audioDeviceManager.on("onAudioPlaybackDeviceTestVolume",function(t){e.safeEmit(Eu.onAudioPlaybackDeviceTestVolume,t)})}},{key:"_assertNotInRoom",value:function(){if(!this._room||!this._ctx.signalingManager.isConnected())throw new pB(h6.NOT_CONNECTED_YET,"server not connected")}},{key:"_checkMediaType",value:function(e){E_(e,"mediaType",[pa.AUDIO,pa.VIDEO,pa.AUDIO_AND_VIDEO])}},{key:"_getUserId",value:function(){var e;return(null===(e=this._room)||void 0===e?void 0:e.config.userInfo.userId)||"local_user"}},{key:"_switchTrack",value:(t=sk(sI().mark(function e(t){var r,i,n=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._initLocalTrackEvents(t),this._localVideoTrack=t,this._localVideoPlayerConfig[po.STREAM_INDEX_MAIN].forEach(function(e){var r;t.setPlayer(e,n._mirrorType,null===(r=n._config)||void 0===r?void 0:r.autoPlayPolicy,n._initPlayerEvents.bind(n))}),null===(r=this._room)||void 0===r||null===(i=r.localStream)||void 0===i||!i.pubVideo){e.next=6;break}return e.next=6,this._updatePublish();case 6:this._wtnStreamManager._updatePushTrack();case 7:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_shouldUpdateAudioConf",value:function(e){var t,r,i,n=(null===(t=this._room)||void 0===t?void 0:t.hasPublished)||(null===(r=this._room)||void 0===r||null===(i=r.localStream)||void 0===i?void 0:i.pubAudio)||this._localAudioTrack&&this._localAudioTrack.sourceType===EY.INTERNAL;if(n){var o="engine.".concat(e," should be called before publishing or capturing.");console.warn("[RTC WebSDK]: ".concat(o)),mw(this.id,e,o)}return!n}},{key:"_getServerConfig",value:function(){var e=this,t=vw.getServerConfig(this.appId);t.rts_report&&ml.setConfig(t.rts_report),this._ctx.joinRoomConfig.setServerConfig(t.web_join_room),this._setRtsQpsConf(t.rts_qps),this._preConnect(t),this._getServerConfigExecutor(t),mZ({engineId:this.id,appId:this.appId,sdkVersion:vB("VERSION"),requestDomains:vB("CONFIG_REQUEST_DOMAINS"),keys:["rts_report","web_join_room","web_rtc_config","rts_qps"],deviceId:vB("DEVICE_ID")}).then(function(t){vw.setServerConfig(e.appId,t)})}},{key:"_setRtsQpsConf",value:function(e){this.logger.print("_setRtsQpsConf",sD(e)),this._ctx.setRtsQpsConf(e),cG(this._ctx.rtsLimiter).length>0&&mw(this.id,"setRtsQpsConf",sD(e))}},{key:"_getServerConfigExecutor",value:function(e){var t,r,i,n,o,a,s,c,d,u;if(_c.setParameter("UPLOAD_CONSOLE_ON",!(null==e||null===(t=e.web_rtc_config)||void 0===t||!t.upload_console_on)),_c.setParameter("UPLOAD_CONSOLE_LENGTH_CUT",null==e||null===(r=e.web_rtc_config)||void 0===r?void 0:r.upload_console_length_cut),_c.setParameter("UPLOAD_REPORT_LIMIT",null==e||null===(i=e.web_rtc_config)||void 0===i?void 0:i.upload_report_limit),_c.setParameter("ENABLE_REPORT_IDB_BUFFER",!(null==e||null===(n=e.web_rtc_config)||void 0===n||!n.enable_report_idb_buffer)),!1===(null==e||null===(o=e.web_rtc_config)||void 0===o?void 0:o.sdk_codec_negotiation)&&vU("SDK_CODEC_NEGOTIATION",!1),void 0!==(null==e||null===(a=e.web_rtc_config)||void 0===a?void 0:a.ainr_enable_dump)&&vU("AINR_ENABLE_DUMP",e.web_rtc_config.ainr_enable_dump),void 0!==(null==e||null===(s=e.web_rtc_config)||void 0===s?void 0:s.ainr_overload_threshold)&&vU("AINR_OVERLOAD_THRESHOLD",e.web_rtc_config.ainr_overload_threshold),void 0!==(null==e||null===(c=e.web_rtc_config)||void 0===c?void 0:c.ainr_urls))try{vU("AINR_URLS",JSON.parse(e.web_rtc_config.ainr_urls))}catch(e){this.logger.warn("_getServerConfigExecutor","parse AINR_URLS error %o",e)}void 0!==(null==e||null===(d=e.web_rtc_config)||void 0===d?void 0:d.ainr_cache_time)&&vU("AINR_CACHE_TIME",e.web_rtc_config.ainr_cache_time),void 0!==(null==e||null===(u=e.web_rtc_config)||void 0===u?void 0:u.ainr_dump_time)&&vU("AINR_DUMP_TIME",e.web_rtc_config.ainr_dump_time)}},{key:"_preConnect",value:function(e){var t,r=vB("PRE_ICE");"boolean"==typeof(null==e||null===(t=e.web_rtc_config)||void 0===t?void 0:t.pre_ice)&&(r=e.web_rtc_config.pre_ice),r&&(this.logger.print("preConnect","start pre ice connection."),this._ctx.signalingManager.connect(),this.monitor.set({pre_connection:!0}),this._ctx.isPreConnection=!0)}},{key:"_getRemoteVideoPlayerConfig",value:function(e,t,r){var i;return null===(i=this._remoteVideoPlayerConfig[e].get(t))||void 0===i?void 0:i.get(r)}},{key:"_setRemoteVideoPlayerConfig",value:function(e,t,r,i){var n=this._remoteVideoPlayerConfig[e].get(t)||new d9;n.set(r,i),this._remoteVideoPlayerConfig[e].set(t,n)}},{key:"getRemoteVideoStats",value:function(){var e,t=null===(e=this._room)||void 0===e?void 0:e.remoteStreams;if(!t||0===t.size)return{};var r={};return t.forEach(function(e,t){null!==(i=e[0])&&void 0!==i&&i.isScreen?(s=e[0],a=e[1]):(s=e[1],a=e[0]);var i,n,o,a,s,c={mainVideoStats:En((null===(n=a)||void 0===n?void 0:n.getRemoteStreamStats().videoStats)||{}),screenVideoStats:En((null===(o=s)||void 0===o?void 0:o.getRemoteStreamStats().videoStats)||{})};r[t]=c}),r}},{key:"getRemoteAudioStats",value:function(){var e,t=null===(e=this._room)||void 0===e?void 0:e.remoteStreams;if(!t||0===t.size)return{};var r={};return t.forEach(function(e,t){null!==(i=e[0])&&void 0!==i&&i.isScreen?(s=e[0],a=e[1]):(s=e[1],a=e[0]);var i,n,o,a,s,c={mainAudioStats:En((null===(n=a)||void 0===n?void 0:n.getRemoteStreamStats().audioStats)||{}),screenAudioStats:En((null===(o=s)||void 0===o?void 0:o.getRemoteStreamStats().audioStats)||{})};r[t]=c}),r}},{key:"getLocalVideoStats",value:function(){var e,t,r,i;return{mainVideoStats:En((null===(e=this._room)||void 0===e||null===(t=e.localStream)||void 0===t?void 0:t.getLocalStreamStats().videoStats)||{}),screenVideoStats:En((null===(r=this._room)||void 0===r||null===(i=r.localScreenStream)||void 0===i?void 0:i.getLocalStreamStats().videoStats)||{})}}},{key:"getLocalAudioStats",value:function(){var e,t,r,i;return{mainAudioStats:En((null===(e=this._room)||void 0===e||null===(t=e.localStream)||void 0===t?void 0:t.getLocalStreamStats().audioStats)||{}),screenAudioStats:En((null===(r=this._room)||void 0===r||null===(i=r.localScreenStream)||void 0===i?void 0:i.getLocalStreamStats().audioStats)||{})}}},{key:"getPublicVideoStats",value:function(){var e=this._wtnStreamManager.__getRemoteStreams();if(!e||0===e.size)return{};var t={};return e.forEach(function(e,r){var i=En(e.getRemoteStreamStats().videoStats||{});delete i.isScreen,t[r]=i}),t}},{key:"getPublicAudioStats",value:function(){var e=this._wtnStreamManager.__getRemoteStreams();if(!e||0===e.size)return{};var t={};return e.forEach(function(e,r){var i=En(e.getRemoteStreamStats().audioStats||{});delete i.isScreen,t[r]=i}),t}}]),eF}();k2([mR()],k1.prototype,"updateToken",1),k2([mR(),k8("video")],k1.prototype,"setVideoCaptureDevice",1),k2([mR(),k8("audio")],k1.prototype,"setAudioCaptureDevice",1),k2([mR()],k1.prototype,"connect",1),k2([function(e,t,r){if("function"==typeof r.value){var i=r.value;r.value=function(){for(var e,t=mS(this.id),r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];return null==t||t.set({room_id:n[1],user_id:null===(e=n[2])||void 0===e?void 0:e.userId}),i.apply(this,n)}}},mR()],k1.prototype,"joinRoom",1),k2([mR()],k1.prototype,"leaveRoom",1),k2([mR()],k1.prototype,"destroy",1),k2([mR()],k1.prototype,"publishStream",1),k2([mR()],k1.prototype,"unpublishStream",1),k2([mR()],k1.prototype,"publishScreen",1),k2([mR()],k1.prototype,"unpublishScreen",1),k2([mR()],k1.prototype,"subscribeStream",1),k2([k6],k1.prototype,"_subscribe",1),k2([mR()],k1.prototype,"unsubscribeStream",1),k2([mR()],k1.prototype,"subscribeScreen",1),k2([mR()],k1.prototype,"unsubscribeScreen",1),k2([k6],k1.prototype,"_unsubscribe",1),k2([mR(),k3],k1.prototype,"setRemoteVideoConfig",1),k2([mR()],k1.prototype,"setRemoteSimulcastStreamType",1),k2([mR(),k8("video")],k1.prototype,"startVideoCapture",1),k2([mR(),k8("video")],k1.prototype,"stopVideoCapture",1),k2([mR(),k8("audio")],k1.prototype,"startAudioCapture",1),k2([mR(),k8("audio")],k1.prototype,"stopAudioCapture",1),k2([mR(),k8("all")],k1.prototype,"startAudioAndVideoCapture",1),k2([mR()],k1.prototype,"startVideoAndAudioCapture",1),k2([mR()],k1.prototype,"getAudioMixingManager",1),k2([mR()],k1.prototype,"getWTNStreamManager",1),k2([mR(),k5],k1.prototype,"startScreenCapture",1),k2([mR(),k5],k1.prototype,"stopScreenCapture",1),k2([mR()],k1.prototype,"setLocalVideoPlayer",1),k2([mR()],k1.prototype,"startLiveTranscoding",1),k2([mR()],k1.prototype,"updateLiveTranscoding",1),k2([mR()],k1.prototype,"stopLiveTranscoding",1),k2([mR()],k1.prototype,"startSubtitle",1),k2([mR()],k1.prototype,"updateSubtitleConfig",1),k2([mR()],k1.prototype,"stopSubtitle",1),k2([mR()],k1.prototype,"setBusinessId",1),k2([mR()],k1.prototype,"setUserVisibility",1),k2([mR()],k1.prototype,"setRemoteVideoPlayer",1),k2([mR()],k1.prototype,"setLocalVideoMirrorType",1),k2([mR()],k1.prototype,"setRemoteVideoMirrorType",1),k2([mR()],k1.prototype,"setAudioPlaybackDevice",1),k2([mR()],k1.prototype,"play",1),k2([mR()],k1.prototype,"stop",1),k2([mR()],k1.prototype,"getAudioVolume",1),k2([mR()],k1.prototype,"setAudioFrameCallback",1),k2([mR()],k1.prototype,"pauseAllSubscribedStream",1),k2([mR()],k1.prototype,"resumeAllSubscribedStream",1),k2([mR()],k1.prototype,"sendUserMessage",1),k2([mR()],k1.prototype,"sendUserBinaryMessage",1),k2([mR()],k1.prototype,"sendRoomMessage",1),k2([mR()],k1.prototype,"sendRoomBinaryMessage",1),k2([mR()],k1.prototype,"setAudioCaptureConfig",1),k2([Ea("4.51"),mR()],k1.prototype,"setVideoCaptureConfig",1),k2([mR()],k1.prototype,"enableSimulcastMode",1),k2([mR()],k1.prototype,"setLocalSimulcastMode",1),k2([mR()],k1.prototype,"setVideoEncoderConfig",1),k2([mR()],k1.prototype,"setScreenEncoderConfig",1),k2([mR()],k1.prototype,"sendSEIMessage",1),k2([Ea("4.42"),mR()],k1.prototype,"setAudioVolumeIndicationInterval",1),k2([mR()],k1.prototype,"enableAudioPropertiesReport",1),k2([mR()],k1.prototype,"setVideoSourceType",1),k2([mR()],k1.prototype,"setExternalVideoTrack",1),k2([mR()],k1.prototype,"setAudioSourceType",1),k2([mR()],k1.prototype,"setExternalAudioTrack",1),k2([mR()],k1.prototype,"login",1),k2([mR()],k1.prototype,"logout",1),k2([mR()],k1.prototype,"updateLoginToken",1),k2([mR()],k1.prototype,"getPeerOnlineStatus",1),k2([mR()],k1.prototype,"sendUserMessageOutsideRoom",1),k2([mR()],k1.prototype,"sendUserBinaryMessageOutsideRoom",1),k2([mR()],k1.prototype,"setServerParams",1),k2([mR()],k1.prototype,"sendServerMessage",1),k2([mR()],k1.prototype,"sendServerBinaryMessage",1),k2([mR()],k1.prototype,"startCloudProxy",1),k2([mR()],k1.prototype,"stopCloudProxy",1),k2([mR()],k1.prototype,"startPushPublicStream",1),k2([mR()],k1.prototype,"updatePublicStreamParam",1),k2([mR()],k1.prototype,"stopPushPublicStream",1),k2([mR(["streamId"])],k1.prototype,"startPlayPublicStream",1),k2([mR(["streamId"])],k1.prototype,"stopPlayPublicStream",1),k2([mR()],k1.prototype,"setAudioProfile",1),k2([mR()],k1.prototype,"setAudioEncodeMaxBitrate",1),k2([mR()],k1.prototype,"setPublicStreamVideoPlayer",1),k2([mR()],k1.prototype,"setDummyCaptureImagePath",1),k2([mR()],k1.prototype,"registerExtension",1),k2([mR()],k1.prototype,"startAudioPlaybackDeviceTest",1),k2([mR()],k1.prototype,"stopAudioPlaybackDeviceTest",1),k2([mR()],k1.prototype,"startAudioDeviceRecordTest",1),k2([mR()],k1.prototype,"stopAudioDeviceRecordAndPlayTest",1),k2([mR()],k1.prototype,"stopAudioDevicePlayTest",1),k2([mR(),k3],k1.prototype,"setRemoteUserPriority",1),k2([mR()],k1.prototype,"takeLocalSnapshot",1),k2([mR()],k1.prototype,"takeRemoteSnapshot",1),k2([mR()],k1.prototype,"setSubscribeFallbackOption",1),k2([mR()],k1.prototype,"getLocalStreamTrack",1),k2([mR()],k1.prototype,"getRemoteStreamTrack",1),k2([mR()],k1.prototype,"getPublicStreamTrack",1),k2([mR()],k1.prototype,"setRemoteStreamRenderSync",1),k2([mR()],k1.prototype,"setJoinRoomParams",1),k2([mR()],k1.prototype,"setAudioSelectionConfig",1),k2([mR()],k1.prototype,"startForwardStreamToRooms",1),k2([mR()],k1.prototype,"updateForwardStreamToRooms",1),k2([mR()],k1.prototype,"stopForwardStreamToRooms",1),k2([mR()],k1.prototype,"pauseForwardStreamToAllRooms",1),k2([mR()],k1.prototype,"resumeForwardStreamToAllRooms",1),k2([mR()],k1.prototype,"setEarMonitorMode",1),k2([mR([],{debounce:2e3,debounceTag:function(e){return"".concat(e)}})],k1.prototype,"setEarMonitorVolume",1),k2([mR()],k1.prototype,"setUserInfo",1);var k4={"client unpublished":ps.STREAM_REMOVE_REASON_UNPUBLISH,"publish failed":ps.STREAM_REMOVE_REASON_PUBLISH_FAILED,"stream removed":ps.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED,"client disconnected":ps.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED,"client republish":ps.STREAM_REMOVE_REASON_REPUBLISH,"token publish privilege expired":ps.STREAM_REMOVE_REASON_TOKEN_PRIVILEGE_EXPIRED};function k6(e,t,r){var i=r.value;return r.value=sk(sI().mark(function e(){var t,r,n,o,a,s,c,d=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=Array(t=d.length),n=0;n<t;n++)r[n]=d[n];return o=r[0],a=r[1],s=r[2],this.checkMediaType(s),this.assertNotInRoom(),e.next=6,this.getSubLock(o,a).lock();case 6:return c=e.sent,e.prev=7,e.next=10,i.apply(this,r);case 10:return e.abrupt("return",e.sent);case 11:return e.prev=11,c(),e.finish(11);case 14:case"end":return e.stop()}},e,this,[[7,,11,14]])})),r}function k3(e,t,r){var i=r.value;return r.value=sk(sI().mark(function e(){var t,r,n,o,a,s=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=Array(t=s.length),n=0;n<t;n++)r[n]=s[n];return o=r[0],e.next=4,this.getSubLock(!1,o).lock();case 4:return a=e.sent,e.prev=5,e.next=8,i.apply(this,r);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,a(),e.finish(9);case 12:case"end":return e.stop()}},e,this,[[5,,9,12]])})),r}function k8(e){return function(t,r,i){var n=i.value;return i.value=sk(sI().mark(function t(){var r,i,o,a,s,c=arguments;return sI().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],"video"!==e&&r.push(this._audioCaptureLock.lock()),"audio"!==e&&r.push(this._videoCaptureLock.lock()),t.next=5,sP.all(r);case 5:for(i=t.sent,t.prev=6,a=Array(o=c.length),s=0;s<o;s++)a[s]=c[s];return t.next=10,n.apply(this,a);case 10:return t.abrupt("return",t.sent);case 11:return t.prev=11,i.forEach(function(e){return e()}),t.finish(11);case 14:case"end":return t.stop()}},t,this,[[6,,11,14]])})),i}}function k5(e,t,r){var i=r.value;return r.value=sk(sI().mark(function e(){var t,r,n,o,a=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._screenCaptureLock.lock();case 2:for(t=e.sent,e.prev=3,n=Array(r=a.length),o=0;o<r;o++)n[o]=a[o];return e.next=7,i.apply(this,n);case 7:return e.abrupt("return",e.sent);case 8:return e.prev=8,t(),e.finish(8);case 11:case"end":return e.stop()}},e,this,[[3,,8,11]])})),r}var k9,k7=function(e,t,r,i){for(var n,o=i>1?void 0:i?uq(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i?n(t,r,o):n(o))||o);return i&&o&&d7(t,r,o),o},we=function(e){hA(n,k1);var t,r,i=hI(n);function n(e,t,r){var o;return nK(this,n),nQ(he(o=i.call(this,e,t,r)),"singleStreamRenderMode",!1),o.id=t,o.logger=new mJ("BLWEngine",0,t),vF=[{width:192,height:108,frameRate:15,maxKbps:100},{width:320,height:180,frameRate:15,maxKbps:140},{width:640,height:360,frameRate:15,maxKbps:400},{width:1280,height:720,frameRate:15,maxKbps:1e3},{width:1920,height:1080,frameRate:15,maxKbps:2e3}],o._handleEngineEvents(),o}return nY(n,[{key:"subscribeStream",value:(r=sk(sI().mark(function e(t,r){var i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("subscribeStream()","userId: %o, mediaType: %o",t,r),this.singleStreamRenderMode&&Ei(r)&&hf(hp(n.prototype),"subscribeScreen",this).call(this,t,pa.VIDEO).catch(function(e){i.logger.error("singleStreamRenderMode subscribeScreen()",e)}),e.abrupt("return",hf(hp(n.prototype),"subscribeStream",this).call(this,t,r));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"unsubscribeStream",value:(t=sk(sI().mark(function e(t,r){var i=this;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.logger.print("unsubscribeStream()","userId: %o, mediaType: %o",t,r),this.singleStreamRenderMode&&Ei(r)&&hf(hp(n.prototype),"unsubscribeScreen",this).call(this,t,pa.VIDEO).catch(function(e){i.logger.error("singleStreamRenderMode unsubscribeScreen()",e)}),e.abrupt("return",hf(hp(n.prototype),"unsubscribeStream",this).call(this,t,r));case 3:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})},{key:"setRemoteScreenVideoStreamIndex",value:function(e){return this.logger.print("setRemoteScreenVideoStreamIndex()","streamIndex: %o",e),!this._room&&(this.singleStreamRenderMode=e===po.STREAM_INDEX_MAIN,!0)}},{key:"setRemoteVideoPlayer",value:function(e,t){if(this.logger.print("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),null==t||delete t.playerId,!this.singleStreamRenderMode||e!==po.STREAM_INDEX_SCREEN)return hf(hp(n.prototype),"setRemoteVideoPlayer",this).call(this,e,t)}},{key:"destroy",value:function(){this.singleStreamRenderMode=!1,hf(hp(n.prototype),"destroy",this).call(this)}},{key:"_updateVideoPlayerState",value:function(e){if(!this.singleStreamRenderMode)return hf(hp(n.prototype),"_updateVideoPlayerState",this).call(this,e);var t,r,i,o,a,s,c,d=e.userId,u=null===(t=this._room)||void 0===t?void 0:t.remoteStreams.get(d);Array.isArray(u)&&u.forEach(function(e){e.isScreen?s=e:c=e});var l,h,p,f=null===(r=c)||void 0===r||null===(i=r.videoTrack)||void 0===i?void 0:i.dangerousGetPlayer(yV);if(!f){var _,A,m,v,E,g,S=null===(_=this._remoteVideoPlayerConfig[po.STREAM_INDEX_MAIN].get(d))||void 0===_?void 0:_.get(yV);if(!S)return;null===(A=c)||void 0===A||null===(m=A.videoTrack)||void 0===m||m.setPlayer(this.id,S,null===(v=this._config)||void 0===v?void 0:v.autoPlayPolicy,this._initPlayerEvents.bind(this)),f=null===(E=c)||void 0===E||null===(g=E.videoTrack)||void 0===g?void 0:g.dangerousGetPlayer(yV)}if(!e.isScreen&&null!==(o=s)&&void 0!==o&&o.videoTrack&&s.videoHasPublish)return this.logger.print("_updateVideoPlayerState","prevent play main stream"),void(null===(l=f)||void 0===l||l.playVideo(s.videoTrack));e.videoTrack?(null===(h=this._config)||void 0===h?void 0:h.autoPlayPolicy)!==py.PLAY_MANUALLY&&(null===(p=f)||void 0===p||p.playVideo(e.videoTrack)):null!==(a=f)&&void 0!==a&&a.played&&f.stop()}},{key:"_handleEngineEvents",value:function(){var e=this;this.on(Eu.onUserPublishScreen,function(t){if(e.singleStreamRenderMode&&Ei(t.mediaType)){var r,i,n=null===(r=e._room)||void 0===r?void 0:r.remoteStreams.get(t.userId),o=null==n?void 0:uC(n).call(n,function(e){return!e.isScreen}),a=null==n?void 0:uC(n).call(n,function(e){return e.isScreen});null!=a&&a.hasSubscribed?(e.logger.info("onUserPublishScreen","singleStreamRenderMode screen hasSubscribed"),e._updateVideoPlayerState(a)):(null!==(i=e._room)&&void 0!==i&&i.config.isAutoSubscribeVideo||null!=o&&o.hasSubscribed&&Ei(o.subMediaType))&&(e.logger.info("onUserPublishScreen","singleStreamRenderMode subscribeScreen"),e.subscribeScreen(t.userId,pa.VIDEO))}}),this.on(Eu.onUserUnpublishScreen,function(t){if(e.singleStreamRenderMode&&Ei(t.mediaType)){var r,i=null===(r=e._room)||void 0===r?void 0:r.remoteStreams.get(t.userId),n=null==i?void 0:uC(i).call(i,function(e){return!e.isScreen});n&&setTimeout(function(){e._updateVideoPlayerState(n)})}})}}]),n}();k7([mR()],we.prototype,"subscribeStream",1),k7([mR()],we.prototype,"unsubscribeStream",1),k7([mR()],we.prototype,"setRemoteScreenVideoStreamIndex",1),k7([mR()],we.prototype,"setRemoteVideoPlayer",1),k7([mR()],we.prototype,"destroy",1);var wt=new mJ("VERTC",0);_t.storeKey=sN(k9="".concat(Date.now(),"-")).call(k9,vw.getDeviceId()),mp({rtc_sdk_version:vx.VERSION,device_id:vw.getDeviceId(),log_cache_key:_t.storeKey}),mf(vx.LOG_SERVER_URL);var wr=1,wi=function(e,t){wt.info("createEngine","Invoke VERTC.createEngine"),Ef(e,"appId");var r=(wr++).toString();return mb(r,{rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy}),new k1(e,r,t)},wn=function(e,t){wt.print("createBLWEngine","Invoke VERTC.createBLWEngine"),Ef(e,"appId");var r=(wr++).toString();return mb(r,{rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy}),new we(e,r,t)},wo=function(e){if(wt.info("destroyEngine","Invoke VERTC.destroyEngine"),!(e instanceof k1))throw new pB(h6.INVALID_ENGINE,"Invalid engine object");e.destroy(),mT(e.monitor)},wa=(i=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",yT.enumerateDevices());case 1:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)}),ws=(n=sk(sI().mark(function e(){var t,r,i,n,o,a=arguments;return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t=a.length>0&&void 0!==a[0]?a[0]:{video:!0,audio:!0}).video,i=t.audio,n={video:!1,audio:!1},o=[],r&&o.push(yT.getPermissions({video:!0,force:!0}).then(function(e){n.video=e.video,e.video||(n.videoExceptionError=e.reason)})),i&&o.push(yT.getPermissions({audio:!0,force:!0}).then(function(e){n.audio=e.audio,e.audio||(n.audioExceptionError=e.reason)})),e.next=8,sP.allSettled(o);case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)}),wc=(o=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",yT.enumerateAudioCaptureDevices());case 1:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)}),wd=(a=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",yT.enumerateVideoCaptureDevices());case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)}),wu=(s=sk(sI().mark(function e(){return sI().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",yT.enumerateAudioPlaybackDevices());case 1:case"end":return e.stop()}},e)})),function(){return s.apply(this,arguments)}),wl=function(){return vx.VERSION},wh=function(){return E$()},wp=function(){return E2()},wf=function(e){var t=e.logLevel,r=e.LogfileSize;t&&(_t.logLevel=t),r&&(_t.LogfileSize=r)},w_=function(e){_t.download(e)};function wA(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return sD(sU(t).call(t,function(e){return e instanceof k1?"[ENGINE]":e}))}function wm(e,t){return function(){mA(t,0,wA.apply(void 0,arguments));var r=e.apply(void 0,arguments);return"function"==typeof(null==r?void 0:r.then)?r.then(function(e){return mm(t,0,wA(e)),e}).catch(function(e){throw mm(t,e.code,e.message),e}):(mm(t,0,wA(r)),r)}}new(nY(function e(){nK(this,e),nQ(this,"getSdkVersion",wm(wl,"getSdkVersion")),nQ(this,"createEngine",wm(wi,"createEngine")),nQ(this,"createBLWEngine",wm(wn,"createBLWEngine")),nQ(this,"destroyEngine",wm(wo,"destroyEngine")),nQ(this,"enumerateDevices",wm(wa,"enumerateDevices")),nQ(this,"enableDevices",wm(ws,"enableDevices")),nQ(this,"enumerateAudioCaptureDevices",wm(wc,"enumerateAudioCaptureDevices")),nQ(this,"enumerateVideoCaptureDevices",wm(wd,"enumerateVideoCaptureDevices")),nQ(this,"enumerateAudioPlaybackDevices",wm(wu,"enumerateAudioPlaybackDevices")),nQ(this,"getParameter",vB),nQ(this,"setParameter",vU),nQ(this,"isSupported",wm(wh,"isSupported")),nQ(this,"getSupportedCodecs",wm(wp,"getSupportedCodecs")),nQ(this,"getElectronScreenSources",wm(y1,"getElectronScreenSources")),nQ(this,"events",Eu),nQ(this,"ErrorCode",h6),nQ(this,"platform","VolcEngine"),nQ(this,"commitInfo","HEAD<8cf97a7*>"),nQ(this,"downloadLog",wm(w_,"downloadLog")),nQ(this,"setLogConfig",wm(wf,"setLogConfig"))}))},947720:function(e,t,r){"use strict";r.d(t,{e:()=>N});var i,n,o=r("723530"),a=r("704062"),s=r("312115"),c=r("342050"),d=r("698307"),u=r("86860"),l=r("662246"),h=r("957246"),p=r("929188"),f={deferEvents:!1},_=function(){function e(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=(0,s.pi)((0,s.pi)({},f),e)}return e.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents){this.schedule(e);return}this.process(e)}this.flushEvents()},e.prototype.schedule=function(e){if(!this.initialized||this.processingEvent){this.queue.push(e);return}if(0!==this.queue.length)throw Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()},e.prototype.clear=function(){this.queue=[]},e.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},e.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(e){throw this.clear(),e}finally{this.processingEvent=!1}},e}(),A=r("334718"),m=new Map,v=0,E={bookId:function(){return"x:".concat(v++)},register:function(e,t){return m.set(e,t),e},get:function(e){return m.get(e)},free:function(e){m.delete(e)}};function g(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:void(!h.M&&console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues"))}var S=r("319904"),b={sync:!1,autoForward:!1};(i=n||(n={}))[i.NotStarted=0]="NotStarted",i[i.Running=1]="Running",i[i.Stopped=2]="Stopped";var T=function(){function e(t,r){void 0===r&&(r=e.defaultOptions);var i=this;this.machine=t,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=n.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(e,t){if((0,p.kJ)(e))return i.batch(e),i.state;var r=(0,p.g5)((0,p._v)(e,t));if(i.status===n.Stopped)return!h.M&&(0,p.ZK)(!1,'Event "'.concat(r.name,'" was sent to stopped service "').concat(i.machine.id,'". This service has already reached its final state, and will not transition.\nEvent: ').concat(JSON.stringify(r.data))),i.state;if(i.status!==n.Running&&!i.options.deferEvents)throw Error('Event "'.concat(r.name,'" was sent to uninitialized service "').concat(i.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\nEvent: ').concat(JSON.stringify(r.data)));return i.scheduler.schedule(function(){i.forward(r);var e=i._nextState(r);i.update(e,r)}),i._state},this.sendTo=function(e,t,r){var o=i.parent&&(t===c.K.Parent||i.parent.id===t),a=o?i.parent:(0,p.HD)(t)?i.children.get(t)||E.get(t):(0,p.Bc)(t)?t:void 0;if(!a){if(!o)throw Error("Unable to send event to child '".concat(t,"' from service '").concat(i.id,"'."));!h.M&&(0,p.ZK)(!1,"Service '".concat(i.id,"' has no parent: unable to send event ").concat(e.type));return}if("machine"in a){if(i.status!==n.Stopped||i.parent!==a||i.state.done){var d=(0,s.pi)((0,s.pi)({},e),{name:e.name===u.vU?"".concat((0,l.vU)(i.id)):e.name,origin:i.sessionId});!r&&i.machine.config.predictableActionArguments?i._outgoingQueue.push([a,d]):a.send(d)}}else!r&&i.machine.config.predictableActionArguments?i._outgoingQueue.push([a,e.data]):a.send(e.data)},this._exec=function(e,t,r,o){void 0===o&&(o=i.machine.options.actions);var a=e.exec||(0,l.o$)(e.type,o),s=(0,p.mf)(a)?a:a?a.exec:e.exec;if(s)try{return s(t,r.data,i.machine.config.predictableActionArguments?{action:e,_event:r}:{action:e,state:i.state,_event:r})}catch(e){throw i.parent&&i.parent.send({type:"xstate.error",data:e}),e}switch(e.type){case u.lW:if("number"==typeof e.delay){i.defer(e);return}e.to?i.sendTo(e._event,e.to,r===l.bf):i.send(e._event);break;case u.al:i.cancel(e.sendId);break;case u.BL:if(i.status!==n.Running)return;var d=e.activity;if(!i.machine.config.predictableActionArguments&&!i.state.activities[d.id||d.type])break;if(d.type===c.M.Invoke){var f=(0,p.j)(d.src),_=i.machine.options.services?i.machine.options.services[f.type]:void 0,A=d.id,m=d.data;!h.M&&(0,p.ZK)(!("forward"in d),"`forward` property is deprecated (found in invocation of '".concat(d.src,"' in in machine '").concat(i.machine.id,"'). ")+"Please use `autoForward` instead.");var v="autoForward"in d?d.autoForward:!!d.forward;if(!_){!h.M&&(0,p.ZK)(!1,"No service found for invocation '".concat(d.src,"' in machine '").concat(i.machine.id,"'."));return}var E=m?(0,p.QX)(m,t,r):void 0;if("string"==typeof _)return;var g=(0,p.mf)(_)?_(t,r.data,{data:E,src:f,meta:d.meta}):_;if(!g)return;var S=void 0;(0,p.O4)(g)&&(g=E?g.withContext(E):g,S={autoForward:v}),i.spawn(g,A,S)}else i.spawnActivity(d);break;case u.sT:i.stopChild(e.activity.id);break;case u.cM:var b=e.label,T=e.value;b?i.logger(b,T):i.logger(T);break;default:!h.M&&(0,p.ZK)(!1,"No implementation found for action type '".concat(e.type,"'"))}};var o=(0,s.pi)((0,s.pi)({},e.defaultOptions),r),a=o.clock,d=o.logger,f=o.parent,A=o.id,m=void 0!==A?A:t.id;this.id=m,this.logger=d,this.clock=a,this.parent=f,this.options=o,this.scheduler=new _({deferEvents:this.options.deferEvents}),this.sessionId=E.bookId()}return Object.defineProperty(e.prototype,"initialState",{get:function(){var e=this;return this._initialState?this._initialState:(0,S.J)(this,function(){return e._initialState=e.machine.initialState,e._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return!h.M&&(0,p.ZK)(this.status!==n.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),e.prototype.execute=function(e,t){var r,i;try{for(var n=(0,s.XA)(e.actions),o=n.next();!o.done;o=n.next()){var a=o.value;this.exec(a,e,t)}}catch(e){r={error:e}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}},e.prototype.update=function(e,t){var r,i,n,o,a,c,d,u,h=this;if(e._sessionid=this.sessionId,this._state=e,(!this.machine.config.predictableActionArguments||t===l.bf)&&this.options.execute)this.execute(this.state);else{for(var f=void 0;f=this._outgoingQueue.shift();)f[0].send(f[1])}if(this.children.forEach(function(e){h.state.children[e.id]=e}),this.devTools&&this.devTools.send(t.data,e),e.event)try{for(var _=(0,s.XA)(this.eventListeners),A=_.next();!A.done;A=_.next()){var m=A.value;m(e.event)}}catch(e){r={error:e}}finally{try{A&&!A.done&&(i=_.return)&&i.call(_)}finally{if(r)throw r.error}}try{for(var v=(0,s.XA)(this.listeners),E=v.next();!E.done;E=v.next()){var m=E.value;m(e,e.event)}}catch(e){n={error:e}}finally{try{E&&!E.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}try{for(var g=(0,s.XA)(this.contextListeners),S=g.next();!S.done;S=g.next())(0,S.value)(this.state.context,this.state.history?this.state.history.context:void 0)}catch(e){a={error:e}}finally{try{S&&!S.done&&(c=g.return)&&c.call(g)}finally{if(a)throw a.error}}if(this.state.done){var b=e.configuration.find(function(e){return"final"===e.type&&e.parent===h.machine}),T=b&&b.doneData?(0,p.QX)(b.doneData,e.context,t):void 0;try{for(var y=(0,s.XA)(this.doneListeners),R=y.next();!R.done;R=y.next()){var m=R.value;m((0,l.Sl)(this.id,T))}}catch(e){d={error:e}}finally{try{R&&!R.done&&(u=y.return)&&u.call(y)}finally{if(d)throw d.error}}this._stop(),this._stopChildren()}},e.prototype.onTransition=function(e){return this.listeners.add(e),this.status===n.Running&&e(this.state,this.state.event),this},e.prototype.subscribe=function(e,t,r){var i=this,o=(0,p.zM)(e,t,r);this.listeners.add(o.next),this.status!==n.NotStarted&&o.next(this.state);var a=function(){i.doneListeners.delete(a),i.stopListeners.delete(a),o.complete()};return this.status===n.Stopped?o.complete():(this.onDone(a),this.onStop(a)),{unsubscribe:function(){i.listeners.delete(o.next),i.doneListeners.delete(a),i.stopListeners.delete(a)}}},e.prototype.onEvent=function(e){return this.eventListeners.add(e),this},e.prototype.onSend=function(e){return this.sendListeners.add(e),this},e.prototype.onChange=function(e){return this.contextListeners.add(e),this},e.prototype.onStop=function(e){return this.stopListeners.add(e),this},e.prototype.onDone=function(e){return this.doneListeners.add(e),this},e.prototype.off=function(e){return this.listeners.delete(e),this.eventListeners.delete(e),this.sendListeners.delete(e),this.stopListeners.delete(e),this.doneListeners.delete(e),this.contextListeners.delete(e),this},e.prototype.start=function(e){var t=this;if(this.status===n.Running)return this;this.machine._init(),E.register(this.sessionId,this),this.initialized=!0,this.status=n.Running;var r=void 0===e?this.initialState:(0,S.J)(this,function(){return(0,d.TL)(e)?t.machine.resolveState(e):t.machine.resolveState(d.ZM.from(e,t.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){t.update(r,l.bf)}),this},e.prototype._stopChildren=function(){this.children.forEach(function(e){(0,p.mf)(e.stop)&&e.stop()}),this.children.clear()},e.prototype._stop=function(){var e,t,r,i,o,a,c,d,u,l;try{for(var h=(0,s.XA)(this.listeners),p=h.next();!p.done;p=h.next()){var f=p.value;this.listeners.delete(f)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(t=h.return)&&t.call(h)}finally{if(e)throw e.error}}try{for(var A=(0,s.XA)(this.stopListeners),m=A.next();!m.done;m=A.next()){var f=m.value;f(),this.stopListeners.delete(f)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(i=A.return)&&i.call(A)}finally{if(r)throw r.error}}try{for(var v=(0,s.XA)(this.contextListeners),E=v.next();!E.done;E=v.next()){var f=E.value;this.contextListeners.delete(f)}}catch(e){o={error:e}}finally{try{E&&!E.done&&(a=v.return)&&a.call(v)}finally{if(o)throw o.error}}try{for(var g=(0,s.XA)(this.doneListeners),S=g.next();!S.done;S=g.next()){var f=S.value;this.doneListeners.delete(f)}}catch(e){c={error:e}}finally{try{S&&!S.done&&(d=g.return)&&d.call(g)}finally{if(c)throw c.error}}if(!this.initialized)return this;this.initialized=!1,this.status=n.Stopped,this._initialState=void 0;try{for(var b=(0,s.XA)(Object.keys(this.delayedEventsMap)),T=b.next();!T.done;T=b.next()){var y=T.value;this.clock.clearTimeout(this.delayedEventsMap[y])}}catch(e){u={error:e}}finally{try{T&&!T.done&&(l=b.return)&&l.call(b)}finally{if(u)throw u.error}}this.scheduler.clear(),this.scheduler=new _({deferEvents:this.options.deferEvents})},e.prototype.stop=function(){var e=this,t=this.scheduler;return this._stop(),t.schedule(function(){var t=(0,p.g5)({type:"xstate.stop"}),r=(0,S.J)(e,function(){var r=(0,p.xH)((0,s.ev)([],(0,s.CR)(e.state.configuration),!1).sort(function(e,t){return t.order-e.order}).map(function(t){return(0,l.AE)(t.onExit,e.machine.options.actions)})),i=(0,s.CR)((0,l.yC)(e.machine,e.state,e.state.context,t,[{type:"exit",actions:r}],e.machine.config.predictableActionArguments?e._exec:void 0,e.machine.config.predictableActionArguments||e.machine.config.preserveActionOrder),2),n=i[0],o=i[1],a=new d.ZM({value:e.state.value,context:o,_event:t,_sessionid:e.sessionId,historyValue:void 0,history:e.state,actions:n.filter(function(e){return e.type!==u.OU&&(e.type!==u.lW||!!e.to&&e.to!==c.K.Internal)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:e.state.done,tags:e.state.tags,machine:e.machine});return a.changed=!0,a});e.update(r,t),e._stopChildren(),E.free(e.sessionId)}),this},e.prototype.batch=function(e){var t=this;if(this.status===n.NotStarted&&this.options.deferEvents)!h.M&&(0,p.ZK)(!1,"".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'" and are deferred. Make sure .start() is called for this service.\nEvent: ').concat(JSON.stringify(event)));else if(this.status!==n.Running)throw Error("".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(!!e.length){var r=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,n,o=t.state,a=!1,c=[];try{for(var u=(0,s.XA)(e),l=u.next();!l.done;l=u.next()){var h=l.value;!function(e){var i=(0,p.g5)(e);t.forward(i),o=(0,S.J)(t,function(){return t.machine.transition(o,i,void 0,r||void 0)}),c.push.apply(c,(0,s.ev)([],(0,s.CR)(t.machine.config.predictableActionArguments?o.actions:o.actions.map(function(e){return(0,d.j1)(e,o)})),!1)),a=a||!!o.changed}(h)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}o.changed=a,o.actions=c,t.update(o,(0,p.g5)(e[e.length-1]))})}},e.prototype.sender=function(e){return this.send.bind(this,e)},e.prototype._nextState=function(e,t){var r=this;void 0===t&&(t=!!this.machine.config.predictableActionArguments&&this._exec);var i=(0,p.g5)(e);if(0===i.name.indexOf(u.Mg)&&!this.state.nextEvents.some(function(e){return 0===e.indexOf(u.Mg)}))throw i.data.data;return(0,S.J)(this,function(){return r.machine.transition(r.state,i,void 0,t||void 0)})},e.prototype.nextState=function(e){return this._nextState(e,!1)},e.prototype.forward=function(e){var t,r;try{for(var i=(0,s.XA)(this.forwardTo),n=i.next();!n.done;n=i.next()){var o=n.value,a=this.children.get(o);if(!a)throw Error("Unable to forward event '".concat(e,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));a.send(e)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},e.prototype.defer=function(e){var t=this;this.delayedEventsMap[e.id]=this.clock.setTimeout(function(){e.to?t.sendTo(e._event,e.to,!0):t.send(e._event)},e.delay)},e.prototype.cancel=function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]},e.prototype.exec=function(e,t,r){void 0===r&&(r=this.machine.options.actions),this._exec(e,t.context,t._event,r)},e.prototype.removeChild=function(e){var t;this.children.delete(e),this.forwardTo.delete(e),null===(t=this.state)||void 0===t||delete t.children[e]},e.prototype.stopChild=function(e){var t=this.children.get(e);if(!!t)this.removeChild(e),(0,p.mf)(t.stop)&&t.stop()},e.prototype.spawn=function(e,t,r){if(this.status!==n.Running)return(0,A.Xg)(e,t);if((0,p.y8)(e))return this.spawnPromise(Promise.resolve(e),t);if((0,p.mf)(e))return this.spawnCallback(e,t);if((0,A.f3)(e))return this.spawnActor(e,t);else if((0,p.bi)(e))return this.spawnObservable(e,t);else if((0,p.O4)(e))return this.spawnMachine(e,(0,s.pi)((0,s.pi)({},r),{id:t}));else if((0,p.HV)(e))return this.spawnBehavior(e,t);else throw Error('Unable to spawn entity "'.concat(t,'" of type "').concat(typeof e,'".'))},e.prototype.spawnMachine=function(t,r){var i=this;void 0===r&&(r={});var n=new e(t,(0,s.pi)((0,s.pi)({},this.options),{parent:this,id:r.id||t.id})),o=(0,s.pi)((0,s.pi)({},b),r);return o.sync&&n.onTransition(function(e){i.send(u.Vx,{state:e,id:n.id})}),this.children.set(n.id,n),o.autoForward&&this.forwardTo.add(n.id),n.onDone(function(e){i.removeChild(n.id),i.send((0,p.g5)(e,{origin:n.id}))}).start(),n},e.prototype.spawnBehavior=function(e,t){var r,i,n,o,a,s,c,d,u,l=(r=e,i={id:t,parent:this},n=r.initialState,o=new Set,a=[],s=!1,c=function(){if(!s){for(s=!0;a.length>0;){var e=a.shift();n=r.transition(n,e,u),o.forEach(function(e){return e.next(n)})}s=!1}},d=(0,A.vk)({id:i.id,send:function(e){a.push(e),c()},getSnapshot:function(){return n},subscribe:function(e,t,r){var i=(0,p.zM)(e,t,r);return o.add(i),i.next(n),{unsubscribe:function(){o.delete(i)}}}}),u={parent:i.parent,self:d,id:i.id||"anonymous",observers:o},n=r.start?r.start(u):n,d);return this.children.set(t,l),l},e.prototype.spawnPromise=function(e,t){var r,i,n=this,o=!1;e.then(function(e){!o&&(i=e,n.removeChild(t),n.send((0,p.g5)((0,l.Sl)(t,e),{origin:t})))},function(e){if(!o){n.removeChild(t);var r=(0,l.vU)(t,e);try{n.send((0,p.g5)(r,{origin:t}))}catch(i){(0,p.v4)(e,i,t),n.devTools&&n.devTools.send(r,n.state),n.machine.strict&&n.stop()}}});var a=((r={id:t,send:function(){},subscribe:function(t,r,i){var n=(0,p.zM)(t,r,i),o=!1;return e.then(function(e){if(o)return;if(n.next(e),!o)n.complete()},function(e){if(!o)n.error(e)}),{unsubscribe:function(){return o=!0}}},stop:function(){o=!0},toJSON:function(){return{id:t}},getSnapshot:function(){return i}})[p.L$]=function(){return this},r);return this.children.set(t,a),a},e.prototype.spawnCallback=function(e,t){var r,i,n,o=this,a=!1,s=new Set,c=new Set;try{n=e(function(e){if(i=e,c.forEach(function(t){return t(e)}),!a)o.send((0,p.g5)(e,{origin:t}))},function(e){s.add(e)})}catch(e){this.send((0,l.vU)(t,e))}if((0,p.y8)(n))return this.spawnPromise(n,t);var d=((r={id:t,send:function(e){return s.forEach(function(t){return t(e)})},subscribe:function(e){var t=(0,p.zM)(e);return c.add(t.next),{unsubscribe:function(){c.delete(t.next)}}},stop:function(){a=!0,(0,p.mf)(n)&&n()},toJSON:function(){return{id:t}},getSnapshot:function(){return i}})[p.L$]=function(){return this},r);return this.children.set(t,d),d},e.prototype.spawnObservable=function(e,t){var r,i,n=this,o=e.subscribe(function(e){i=e,n.send((0,p.g5)(e,{origin:t}))},function(e){n.removeChild(t),n.send((0,p.g5)((0,l.vU)(t,e),{origin:t}))},function(){n.removeChild(t),n.send((0,p.g5)((0,l.Sl)(t),{origin:t}))}),a=((r={id:t,send:function(){},subscribe:function(t,r,i){return e.subscribe(t,r,i)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return i},toJSON:function(){return{id:t}}})[p.L$]=function(){return this},r);return this.children.set(t,a),a},e.prototype.spawnActor=function(e,t){return this.children.set(t,e),e},e.prototype.spawnActivity=function(e){var t=this.machine.options&&this.machine.options.activities?this.machine.options.activities[e.type]:void 0;if(!t){!h.M&&(0,p.ZK)(!1,"No implementation found for activity '".concat(e.type,"'"));return}var r=t(this.state.context,e);this.spawnEffect(e.id,r)},e.prototype.spawnEffect=function(e,t){var r;this.children.set(e,((r={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:t||void 0,getSnapshot:function(){},toJSON:function(){return{id:e}}})[p.L$]=function(){return this},r))},e.prototype.attachDev=function(){var e=g();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var t="object"==typeof this.options.devTools?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect((0,s.pi)((0,s.pi)({name:this.id,autoPause:!0,stateSanitizer:function(e){return{value:e.value,context:e.context,actions:e.actions}}},t),{features:(0,s.pi)({jump:!1,skip:!1},t?t.features:void 0)}),this.machine),this.devTools.init(this.state)}!function(e){if(!!g()){var t=function(){var e=g();if(e&&"__xstate__"in e)return e.__xstate__}();t&&t.register(e)}}(this)}},e.prototype.toJSON=function(){return{id:this.id}},e.prototype[p.L$]=function(){return this},e.prototype.getSnapshot=function(){return this.status===n.NotStarted?this.initialState:this._state},e.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(e,t){return setTimeout(e,t)},clearTimeout:function(e){return clearTimeout(e)}},logger:console.log.bind(console),devTools:!1},e.interpret=y,e}();function y(e,t){return new T(e,t)}var R=o.useLayoutEffect;function I(e){var t=o.useRef();return!t.current&&(t.current={v:e()}),t.current.v}var C=function(){return(C=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},k=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r},w=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a};function O(e){return e}function N(e){for(var t,r,i,s,c,u,l,h,p,f,_,A=[],m=1;m<arguments.length;m++)A[m-1]=arguments[m];var v=w(A,1)[0],E=void 0===v?{}:v;var g=(t=e,r=E,i=I(function(){return"function"==typeof t?t():t}),s=r.context,c=r.guards,u=r.actions,l=r.activities,h=r.services,p=r.delays,f=(r.state,k(r,["context","guards","actions","activities","services","delays","state"])),_=I(function(){return y(i.withConfig({context:s,guards:c,actions:u,activities:l,services:h,delays:p},function(){return C(C({},i.context),s)}),f)}),R(function(){Object.assign(_.machine.options.actions,u),Object.assign(_.machine.options.guards,c),Object.assign(_.machine.options.activities,l),Object.assign(_.machine.options.services,h),Object.assign(_.machine.options.delays,p)},[u,c,l,h,p]),_),S=(0,o.useCallback)(function(){return g.status===n.NotStarted?E.state?d.ZM.create(E.state):g.machine.initialState:g.getSnapshot()},[g]),b=(0,o.useCallback)(function(e,t){if(g.status===n.NotStarted)return!0;var r=void 0===t.changed&&(Object.keys(t.children).length>0||"boolean"==typeof e.changed);return!(t.changed||r)},[g]),T=(0,o.useCallback)(function(e){return g.subscribe(e).unsubscribe},[g]),N=(0,a.useSyncExternalStoreWithSelector)(T,S,S,O,b);return(0,o.useEffect)(function(){var e=E.state;return g.start(e?d.ZM.create(e):void 0),function(){g.stop(),g.status=n.NotStarted}},[]),[N,g.send,g]}},104710:function(e,t,r){var i,n,o=r(353434).Buffer;i=0,n=function(){"use strict";let e,t,i,n,a,s;var c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P,D,L,M,x,U,B,V,F,j,G,W,H,Y,K,Q,z,X,J,q,Z,$,ee,et,er,ei,en,eo,ea,es,ec,ed,eu,el,eh,ep,ef,e_,eA,em,ev,eE,eg,eS,eb,eT,ey,eR,eI,eC,ek,ew,eO,eN,eP,eD,eL,eM,ex,eU,eB,eV,eF,ej,eG,eW,eH,eY,eK,eQ,ez,eX,eJ,eq,eZ,e$,e0,e2,e1,e4,e6,e3,e8,e5,e9,e7,te,tt,tr,ti,tn,to,ta,ts,tc,td,tu,tl,th,tp,tf,t_,tA,tm,tv,tE,tg,tS,tb,tT,ty,tR,tI,tC,tk,tw,tO,tN,tP,tD,tL,tM,tx,tU,tB,tV,tF,tj,tG,tW,tH,tY,tK,tQ,tz,tX,tJ,tq,tZ,t$,t0,t2,t1,t4,t6,t3,t8,t5,t9,t7,re,rt,rr,ri,rn,ro,ra,rs,rc,rd,ru,rl,rh,rp,rf,r_,rA,rm,rv,rE,rg,rS,rb,rT,ry,rR,rI,rC,rk,rw,rO,rN,rP,rD,rL,rM,rx,rU,rB,rV,rF,rj,rG,rW,rH,rY,rK,rQ,rz,rX,rJ,rq,rZ,r$,r0,r2,r1,r4,r6,r3,r8,r5,r9,r7,ie,it,ir,ii,io,ia,is,ic,id,iu,il,ih,ip,i_,iA,im,iv,iE,ig,iS,ib,iT,iy,iR,iI,iC,ik,iw,iO,iN,iP,iD,iL,iM,ix,iU="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{};function iB(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var iV=function(e){try{return!!e()}catch(e){return!0}},iF=!iV(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),ij=Function.prototype,iG=ij.call,iW=iF&&ij.bind.bind(iG,iG),iH=iF?iW:function(e){return function(){return iG.apply(e,arguments)}},iY=iH({}.isPrototypeOf),iK=function(e){return e&&e.Math==Math&&e},iQ=iK("object"==typeof globalThis&&globalThis)||iK("object"==typeof window&&window)||iK("object"==typeof self&&self)||iK("object"==typeof iU&&iU)||function(){return this}()||iU||Function("return this")(),iz=Function.prototype,iX=iz.apply,iJ=iz.call,iq="object"==typeof Reflect&&Reflect.apply||(iF?iJ.bind(iX):function(){return iJ.apply(iX,arguments)}),iZ=iH({}.toString),i$=iH("".slice),i0=function(e){return i$(iZ(e),8,-1)},i2=function(e){if("Function"===i0(e))return iH(e)},i1="object"==typeof document&&document.all,i4={all:i1,IS_HTMLDDA:void 0===i1&&void 0!==i1},i6=i4.all,i3=i4.IS_HTMLDDA?function(e){return"function"==typeof e||e===i6}:function(e){return"function"==typeof e},i8={},i5=!iV(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),i9=Function.prototype.call,i7=iF?i9.bind(i9):function(){return i9.apply(i9,arguments)},ne={},nt={}.propertyIsEnumerable,nr=Object.getOwnPropertyDescriptor,ni=nr&&!nt.call({1:2},1);ne.f=ni?function(e){var t=nr(this,e);return!!t&&t.enumerable}:nt;var nn,no,na=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ns=Object,nc=iH("".split),nd=iV(function(){return!ns("z").propertyIsEnumerable(0)})?function(e){return"String"==i0(e)?nc(e,""):ns(e)}:ns,nu=function(e){return null==e},nl=TypeError,nh=function(e){if(nu(e))throw nl("Can't call method on "+e);return e},np=function(e){return nd(nh(e))},nf=i4.all,n_=i4.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:i3(e)||e===nf}:function(e){return"object"==typeof e?null!==e:i3(e)},nA={},nm=function(e){return i3(e)?e:void 0},nv=function(e,t){return arguments.length<2?nm(nA[e])||nm(iQ[e]):nA[e]&&nA[e][t]||iQ[e]&&iQ[e][t]},nE="undefined"!=typeof navigator&&String(navigator.userAgent)||"",ng=iQ.process,nS=iQ.Deno,nb=ng&&ng.versions||nS&&nS.version,nT=nb&&nb.v8;nT&&(no=(nn=nT.split("."))[0]>0&&nn[0]<4?1:+(nn[0]+nn[1])),!no&&nE&&(!(nn=nE.match(/Edge\/(\d+)/))||nn[1]>=74)&&(nn=nE.match(/Chrome\/(\d+)/))&&(no=+nn[1]);var ny=no,nR=iQ.String,nI=!!Object.getOwnPropertySymbols&&!iV(function(){var e=Symbol();return!nR(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ny&&ny<41}),nC=nI&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,nk=Object,nw=nC?function(e){return"symbol"==typeof e}:function(e){var t=nv("Symbol");return i3(t)&&iY(t.prototype,nk(e))},nO=String,nN=function(e){try{return nO(e)}catch(e){return"Object"}},nP=TypeError,nD=function(e){if(i3(e))return e;throw nP(nN(e)+" is not a function")},nL=function(e,t){var r=e[t];return nu(r)?void 0:nD(r)},nM=TypeError,nx={exports:{}},nU=Object.defineProperty,nB="__core-js_shared__",nV=iQ[nB]||function(e,t){try{nU(iQ,e,{value:t,configurable:!0,writable:!0})}catch(r){iQ[e]=t}return t}(nB,{});(nx.exports=function(e,t){return nV[e]||(nV[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var nF=nx.exports,nj=Object,nG=function(e){return nj(nh(e))},nW=iH({}.hasOwnProperty),nH=Object.hasOwn||function(e,t){return nW(nG(e),t)},nY=0,nK=Math.random(),nQ=iH(1..toString),nz=function(e){return"Symbol("+(void 0===e?"":e)+")_"+nQ(++nY+nK,36)},nX=iQ.Symbol,nJ=nF("wks"),nq=nC?nX.for||nX:nX&&nX.withoutSetter||nz,nZ=function(e){return nH(nJ,e)||(nJ[e]=nI&&nH(nX,e)?nX[e]:nq("Symbol."+e)),nJ[e]},n$=function(e,t){var r,i;if("string"===t&&i3(r=e.toString)&&!n_(i=i7(r,e))||i3(r=e.valueOf)&&!n_(i=i7(r,e))||"string"!==t&&i3(r=e.toString)&&!n_(i=i7(r,e)))return i;throw nM("Can't convert object to primitive value")},n0=TypeError,n2=nZ("toPrimitive"),n1=function(e,t){if(!n_(e)||nw(e))return e;var r,i=nL(e,n2);if(i){if(void 0===t&&(t="default"),!n_(r=i7(i,e,t))||nw(r))return r;throw n0("Can't convert object to primitive value")}return void 0===t&&(t="number"),n$(e,t)},n4=function(e){var t=n1(e,"string");return nw(t)?t:t+""},n6=iQ.document,n3=n_(n6)&&n_(n6.createElement),n8=function(e){return n3?n6.createElement(e):{}},n5=!i5&&!iV(function(){return 7!=Object.defineProperty(n8("div"),"a",{get:function(){return 7}}).a}),n9=Object.getOwnPropertyDescriptor;i8.f=i5?n9:function(e,t){if(e=np(e),t=n4(t),n5)try{return n9(e,t)}catch(e){}if(nH(e,t))return na(!i7(ne.f,e,t),e[t])};var n7=/#|\.prototype\./,oe=function(e,t){var r=or[ot(e)];return r==on||r!=oi&&(i3(t)?iV(t):!!t)},ot=oe.normalize=function(e){return String(e).replace(n7,".").toLowerCase()},or=oe.data={},oi=oe.NATIVE="N",on=oe.POLYFILL="P",oo=i2(i2.bind),oa=function(e,t){return nD(e),void 0===t?e:iF?oo(e,t):function(){return e.apply(t,arguments)}},os={},oc=i5&&iV(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),od=String,ou=TypeError,ol=function(e){if(n_(e))return e;throw ou(od(e)+" is not an object")},oh=TypeError,op=Object.defineProperty,of=Object.getOwnPropertyDescriptor,o_="enumerable",oA="configurable",om="writable";os.f=i5?oc?function(e,t,r){if(ol(e),t=n4(t),ol(r),"function"==typeof e&&"prototype"===t&&"value"in r&&om in r&&!r[om]){var i=of(e,t);i&&i[om]&&(e[t]=r.value,r={configurable:oA in r?r[oA]:i[oA],enumerable:o_ in r?r[o_]:i[o_],writable:!1})}return op(e,t,r)}:op:function(e,t,r){if(ol(e),t=n4(t),ol(r),n5)try{return op(e,t,r)}catch(e){}if("get"in r||"set"in r)throw oh("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var ov=i5?function(e,t,r){return os.f(e,t,na(1,r))}:function(e,t,r){return e[t]=r,e},oE=i8.f,og=function(e){var t=function(r,i,n){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,n)}return iq(e,this,arguments)};return t.prototype=e.prototype,t},oS=function(e,t){var r,i,n,o,a,s,c,d,u,l=e.target,h=e.global,p=e.stat,f=e.proto,_=h?iQ:p?iQ[l]:(iQ[l]||{}).prototype,A=h?nA:nA[l]||ov(nA,l,{})[l],m=A.prototype;for(o in t)i=!(r=oe(h?o:l+(p?".":"#")+o,e.forced))&&_&&nH(_,o),s=A[o],i&&(c=e.dontCallGetSet?(u=oE(_,o))&&u.value:_[o]),a=i&&c?c:t[o],i&&typeof s==typeof a||(d=e.bind&&i?oa(a,iQ):e.wrap&&i?og(a):f&&i3(a)?i2(a):a,(e.sham||a&&a.sham||s&&s.sham)&&ov(d,"sham",!0),ov(A,o,d),f&&(nH(nA,n=l+"Prototype")||ov(nA,n,{}),ov(nA[n],o,a),e.real&&m&&(r||!m[o])&&ov(m,o,a)))},ob=Math.ceil,oT=Math.floor,oy=Math.trunc||function(e){var t=+e;return(t>0?oT:ob)(t)},oR=function(e){var t=+e;return t!=t||0===t?0:oy(t)},oI=Math.max,oC=Math.min,ok=function(e,t){var r=oR(e);return r<0?oI(r+t,0):oC(r,t)},ow=Math.min,oO=function(e){return e>0?ow(oR(e),0x1fffffffffffff):0},oN=function(e){return oO(e.length)},oP=function(e){return function(t,r,i){var n,o=np(t),a=oN(o),s=ok(i,a);if(e&&r!=r){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},oD={includes:oP(!0),indexOf:oP(!1)},oL=oD.includes;oS({target:"Array",proto:!0,forced:iV(function(){return![,].includes()})},{includes:function(e){return oL(this,e,arguments.length>1?arguments[1]:void 0)}});var oM=function(e){return nA[e+"Prototype"]},ox=oM("Array").includes,oU=nZ("match"),oB=function(e){var t;return n_(e)&&(void 0!==(t=e[oU])?!!t:"RegExp"==i0(e))},oV=TypeError,oF={};oF[nZ("toStringTag")]="z";var oj="[object z]"===String(oF),oG=nZ("toStringTag"),oW=Object,oH="Arguments"==i0(function(){return arguments}()),oY=oj?i0:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=oW(e),oG))?r:oH?i0(t):"Object"==(i=i0(t))&&i3(t.callee)?"Arguments":i},oK=String,oQ=function(e){if("Symbol"===oY(e))throw TypeError("Cannot convert a Symbol value to a string");return oK(e)},oz=nZ("match"),oX=function(e){if(oB(e))throw oV("The method doesn't accept regular expressions");return e},oJ=iH("".indexOf);oS({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[oz]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~oJ(oQ(nh(this)),oQ(oX(e)),arguments.length>1?arguments[1]:void 0)}});var oq=oM("String").includes,oZ=Array.prototype,o$=String.prototype,o0=iB(function(e){var t=e.includes;return e===oZ||iY(oZ,e)&&t===oZ.includes?ox:"string"==typeof e||e===o$||iY(o$,e)&&t===o$.includes?oq:t}),o2=TypeError,o1=function(e){return function(t,r,i,n){nD(r);var o=nG(t),a=nd(o),s=oN(o),c=e?s-1:0,d=e?-1:1;if(i<2)for(;;){if(c in a){n=a[c],c+=d;break}if(c+=d,e?c<0:s<=c)throw o2("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=d)c in a&&(n=r(n,a[c],c,o));return n}},o4={left:o1(!1),right:o1(!0)},o6=function(e,t){var r=[][e];return!!r&&iV(function(){r.call(null,t||function(){return 1},1)})},o3="undefined"!=typeof process&&"process"==i0(process),o8=o4.left;oS({target:"Array",proto:!0,forced:!o3&&ny>79&&ny<83||!o6("reduce")},{reduce:function(e){var t=arguments.length;return o8(this,e,t,t>1?arguments[1]:void 0)}});var o5=oM("Array").reduce,o9=Array.prototype,o7=function(e){var t=e.reduce;return e===o9||iY(o9,e)&&t===o9.reduce?o5:t},ae=iB(o7),at=Array.isArray||function(e){return"Array"==i0(e)},ar=iH([].reverse),ai=[1,2];oS({target:"Array",proto:!0,forced:String(ai)===String(ai.reverse())},{reverse:function(){return at(this)&&(this.length=this.length),ar(this)}});var an=oM("Array").reverse,ao=Array.prototype,aa=function(e){var t=e.reverse;return e===ao||iY(ao,e)&&t===ao.reverse?an:t},as=iB(aa),ac=nF("keys"),ad=function(e){return ac[e]||(ac[e]=nz(e))},au=!iV(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),al=ad("IE_PROTO"),ah=Object,ap=ah.prototype,af=au?ah.getPrototypeOf:function(e){var t=nG(e);if(nH(t,al))return t[al];var r=t.constructor;return i3(r)&&t instanceof r?r.prototype:t instanceof ah?ap:null},a_=String,aA=TypeError,am=function(e,t,r){try{return iH(nD(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}},av=function(e){if("object"==typeof e||i3(e))return e;throw aA("Can't set "+a_(e)+" as a prototype")},aE=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=am(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return ol(r),av(i),t?e(r,i):r.__proto__=i,r}}():void 0),ag={},aS={},ab=oD.indexOf,aT=iH([].push),ay=function(e,t){var r,i=np(e),n=0,o=[];for(r in i)!nH(aS,r)&&nH(i,r)&&aT(o,r);for(;t.length>n;)nH(i,r=t[n++])&&(~ab(o,r)||aT(o,r));return o},aR=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],aI=aR.concat("length","prototype");ag.f=Object.getOwnPropertyNames||function(e){return ay(e,aI)};var aC={};aC.f=Object.getOwnPropertySymbols;var ak=iH([].concat),aw=nv("Reflect","ownKeys")||function(e){var t=ag.f(ol(e)),r=aC.f;return r?ak(t,r(e)):t},aO={},aN=Object.keys||function(e){return ay(e,aR)};aO.f=i5&&!oc?Object.defineProperties:function(e,t){ol(e);for(var r,i=np(t),n=aN(t),o=n.length,a=0;o>a;)os.f(e,r=n[a++],i[r]);return e};var aP,aD=nv("document","documentElement"),aL="prototype",aM="script",ax=ad("IE_PROTO"),aU=function(){},aB=function(e){return"<"+aM+">"+e+"</"+aM+">"},aV=function(e){e.write(aB("")),e.close();var t=e.parentWindow.Object;return e=null,t},aF=function(){try{aP=new ActiveXObject("htmlfile")}catch(e){}aF="undefined"!=typeof document?document.domain&&aP?aV(aP):(t=n8("iframe"),r="java"+aM+":",t.style.display="none",aD.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(aB("document.F=Object")),e.close(),e.F):aV(aP);for(var e,t,r,i=aR.length;i--;)delete aF[aL][aR[i]];return aF()};aS[ax]=!0;var aj=Object.create||function(e,t){var r;return null!==e?(aU[aL]=ol(e),r=new aU,aU[aL]=null,r[ax]=e):r=aF(),void 0===t?r:aO.f(r,t)},aG=Error,aW=iH("".replace),aH=String(aG("zxcasd").stack),aY=/\n\s*at [^:]*:[^\n]*/,aK=aY.test(aH),aQ=!iV(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",na(1,7)),7!==e.stack)}),az=function(e,t){if(aK&&"string"==typeof e&&!aG.prepareStackTrace)for(;t--;)e=aW(e,aY,"");return e},aX=Error.captureStackTrace,aJ={},aq=nZ("iterator"),aZ=Array.prototype,a$=function(e){return void 0!==e&&(aJ.Array===e||aZ[aq]===e)},a0=nZ("iterator"),a2=function(e){if(!nu(e))return nL(e,a0)||nL(e,"@@iterator")||aJ[oY(e)]},a1=TypeError,a4=function(e,t){var r=arguments.length<2?a2(e):t;if(nD(r))return ol(i7(r,e));throw a1(nN(e)+" is not iterable")},a6=function(e,t,r){var i,n;ol(e);try{if(!(i=nL(e,"return"))){if("throw"===t)throw r;return r}i=i7(i,e)}catch(e){n=!0,i=e}if("throw"===t)throw r;if(n)throw i;return ol(i),r},a3=TypeError,a8=function(e,t){this.stopped=e,this.result=t},a5=a8.prototype,a9=function(e,t,r){var i,n,o,a,s,c,d,u=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),f=!(!r||!r.INTERRUPTED),_=oa(t,u),A=function(e){return i&&a6(i,"normal",e),new a8(!0,e)},m=function(e){return l?(ol(e),f?_(e[0],e[1],A):_(e[0],e[1])):f?_(e,A):_(e)};if(h)i=e.iterator;else if(p)i=e;else{if(!(n=a2(e)))throw a3(nN(e)+" is not iterable");if(a$(n)){for(o=0,a=oN(e);a>o;o++)if((s=m(e[o]))&&iY(a5,s))return s;return new a8(!1)}i=a4(e,n)}for(c=h?e.next:i.next;!(d=i7(c,i)).done;){try{s=m(d.value)}catch(e){a6(i,"throw",e)}if("object"==typeof s&&s&&iY(a5,s))return s}return new a8(!1)},a7=function(e,t){n_(t)&&"cause"in t&&ov(e,"cause",t.cause)},se=function(e,t,r,i){aQ&&(aX?aX(e,t):ov(e,"stack",az(r,i)))},st=nZ("toStringTag"),sr=Error,si=[].push,sn=function(e,t){var r,i=iY(so,this);aE?r=aE(sr(),i?af(this):so):ov(r=i?this:aj(so),st,"Error"),void 0!==t&&ov(r,"message",function(e,t){return void 0===e?arguments.length<2?"":t:oQ(e)}(t)),se(r,sn,r.stack,1),arguments.length>2&&a7(r,arguments[2]);var n=[];return a9(e,si,{that:n}),ov(r,"errors",n),r};aE?aE(sn,sr):function(e,t,r){for(var i=aw(t),n=os.f,o=i8.f,a=0;a<i.length;a++){var s=i[a];nH(e,s)||r&&nH(r,s)||n(e,s,o(t,s))}}(sn,sr,{name:!0});var so=sn.prototype=aj(sr.prototype,{constructor:na(1,sn),message:na(1,""),name:na(1,"AggregateError")});oS({global:!0,constructor:!0,arity:2},{AggregateError:sn});var sa,ss,sc,sd=iQ.WeakMap,su=i3(sd)&&/native code/.test(String(sd)),sl="Object already initialized",sh=iQ.TypeError,sp=iQ.WeakMap;if(su||nV.state){var sf=nV.state||(nV.state=new sp);sf.get=sf.get,sf.has=sf.has,sf.set=sf.set,sa=function(e,t){if(sf.has(e))throw sh(sl);return t.facade=e,sf.set(e,t),t},ss=function(e){return sf.get(e)||{}},sc=function(e){return sf.has(e)}}else{var s_=ad("state");aS[s_]=!0,sa=function(e,t){if(nH(e,s_))throw sh(sl);return t.facade=e,ov(e,s_,t),t},ss=function(e){return nH(e,s_)?e[s_]:{}},sc=function(e){return nH(e,s_)}}var sA,sm,sv,sE={set:sa,get:ss,has:sc,enforce:function(e){return sc(e)?ss(e):sa(e,{})},getterFor:function(e){return function(t){var r;if(!n_(t)||(r=ss(t)).type!==e)throw sh("Incompatible receiver, "+e+" required");return r}}},sg=Function.prototype,sS=i5&&Object.getOwnPropertyDescriptor,sb=nH(sg,"name"),sT={EXISTS:sb,PROPER:sb&&"something"===(function(){}).name,CONFIGURABLE:sb&&(!i5||i5&&sS(sg,"name").configurable)},sy=function(e,t,r,i){return i&&i.enumerable?e[t]=r:ov(e,t,r),e},sR=nZ("iterator"),sI=!1;[].keys&&("next"in(sv=[].keys())?(sm=af(af(sv)))!==Object.prototype&&(sA=sm):sI=!0),i3((sA=!n_(sA)||iV(function(){var e={};return sA[sR].call(e)!==e})?{}:aj(sA))[sR])||sy(sA,sR,function(){return this});var sC={IteratorPrototype:sA,BUGGY_SAFARI_ITERATORS:sI},sk=os.f,sw=oj?({}).toString:function(){return"[object "+oY(this)+"]"},sO=nZ("toStringTag"),sN=function(e,t,r,i){if(e){var n=r?e:e.prototype;nH(n,sO)||sk(n,sO,{configurable:!0,value:t}),i&&!oj&&ov(n,"toString",sw)}},sP=sC.IteratorPrototype,sD=function(){return this},sL=function(e,t,r,i){var n=t+" Iterator";return e.prototype=aj(sP,{next:na(+!i,r)}),sN(e,n,!1,!0),aJ[n]=sD,e},sM=sT.PROPER,sx=sC.BUGGY_SAFARI_ITERATORS,sU=nZ("iterator"),sB="keys",sV="values",sF="entries",sj=function(){return this},sG=function(e,t,r,i,n,o,a){sL(r,t,i);var s,c,d,u=function(e){if(e===n&&_)return _;if(!sx&&e in p)return p[e];switch(e){case sB:case sV:case sF:return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",h=!1,p=e.prototype,f=p[sU]||p["@@iterator"]||n&&p[n],_=!sx&&f||u(n),A="Array"==t&&p.entries||f;if(A&&(s=af(A.call(new e)))!==Object.prototype&&s.next&&(sN(s,l,!0,!0),aJ[l]=sj),sM&&n==sV&&f&&f.name!==sV&&(h=!0,_=function(){return i7(f,this)}),n){if(c={values:u(sV),keys:o?_:u(sB),entries:u(sF)},a)for(d in c)!sx&&!h&&d in p||sy(p,d,c[d]);else oS({target:t,proto:!0,forced:sx||h},c)}return a&&p[sU]!==_&&sy(p,sU,_,{name:n}),aJ[t]=_,c},sW=function(e,t){return{value:e,done:t}};os.f;var sH="Array Iterator",sY=sE.set,sK=sE.getterFor(sH);sG(Array,"Array",function(e,t){sY(this,{type:sH,target:np(e),index:0,kind:t})},function(){var e=sK(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,sW(void 0,!0)):sW("keys"==r?i:"values"==r?t[i]:[i,t[i]],!1)},"values"),aJ.Arguments=aJ.Array;var sQ=function(e,t,r){return os.f(e,t,r)},sz=nZ("species"),sX=TypeError,sJ=function(e,t){if(iY(t,e))return e;throw sX("Incorrect invocation")},sq=iH(Function.toString);i3(nV.inspectSource)||(nV.inspectSource=function(e){return sq(e)});var sZ=nV.inspectSource,s$=function(){},s0=[],s2=nv("Reflect","construct"),s1=/^\s*(?:class|function)\b/,s4=iH(s1.exec),s6=!s1.exec(s$),s3=function(e){if(!i3(e))return!1;try{return s2(s$,s0,e),!0}catch(e){return!1}},s8=function(e){if(!i3(e))return!1;switch(oY(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return s6||!!s4(s1,sZ(e))}catch(e){return!0}};s8.sham=!0;var s5,s9,s7,ce,ct=!s2||iV(function(){var e;return s3(s3.call)||!s3(Object)||!s3(function(){e=!0})||e})?s8:s3,cr=TypeError,ci=function(e){if(ct(e))return e;throw cr(nN(e)+" is not a constructor")},cn=nZ("species"),co=function(e,t){var r,i=ol(e).constructor;return void 0===i||nu(r=ol(i)[cn])?t:ci(r)},ca=iH([].slice),cs=TypeError,cc=function(e,t){if(e<t)throw cs("Not enough arguments");return e},cd=/(?:ipad|iphone|ipod).*applewebkit/i.test(nE),cu=iQ.setImmediate,cl=iQ.clearImmediate,ch=iQ.process,cp=iQ.Dispatch,cf=iQ.Function,c_=iQ.MessageChannel,cA=iQ.String,cm=0,cv={},cE="onreadystatechange";iV(function(){s5=iQ.location});var cg=function(e){if(nH(cv,e)){var t=cv[e];delete cv[e],t()}},cS=function(e){return function(){cg(e)}},cb=function(e){cg(e.data)},cT=function(e){iQ.postMessage(cA(e),s5.protocol+"//"+s5.host)};cu&&cl||(cu=function(e){cc(arguments.length,1);var t=i3(e)?e:cf(e),r=ca(arguments,1);return cv[++cm]=function(){iq(t,void 0,r)},s9(cm),cm},cl=function(e){delete cv[e]},o3?s9=function(e){ch.nextTick(cS(e))}:cp&&cp.now?s9=function(e){cp.now(cS(e))}:c_&&!cd?(ce=(s7=new c_).port2,s7.port1.onmessage=cb,s9=oa(ce.postMessage,ce)):iQ.addEventListener&&i3(iQ.postMessage)&&!iQ.importScripts&&s5&&"file:"!==s5.protocol&&!iV(cT)?(s9=cT,iQ.addEventListener("message",cb,!1)):s9=cE in n8("script")?function(e){aD.appendChild(n8("script"))[cE]=function(){aD.removeChild(this),cg(e)}}:function(e){setTimeout(cS(e),0)});var cy=cu,cR=cl,cI=function(){this.head=null,this.tail=null};cI.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var cC,ck,cw,cO,cN,cP=/ipad|iphone|ipod/i.test(nE)&&"undefined"!=typeof Pebble,cD=/web0s(?!.*chrome)/i.test(nE),cL=i8.f,cM=cy,cx=iQ.MutationObserver||iQ.WebKitMutationObserver,cU=iQ.document,cB=iQ.process,cV=iQ.Promise,cF=cL(iQ,"queueMicrotask"),cj=cF&&cF.value;if(!cj){var cG=new cI,cW=function(){var e,t;for(o3&&(e=cB.domain)&&e.exit();t=cG.get();)try{t()}catch(e){throw cG.head&&cC(),e}e&&e.enter()};cd||o3||cD||!cx||!cU?!cP&&cV&&cV.resolve?((cO=cV.resolve(void 0)).constructor=cV,cN=oa(cO.then,cO),cC=function(){cN(cW)}):o3?cC=function(){cB.nextTick(cW)}:(cM=oa(cM,iQ),cC=function(){cM(cW)}):(ck=!0,cw=cU.createTextNode(""),new cx(cW).observe(cw,{characterData:!0}),cC=function(){cw.data=ck=!ck}),cj=function(e){cG.head||cC(),cG.add(e)}}var cH=cj,cY=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},cK=iQ.Promise,cQ="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,cz=!cQ&&!o3&&"object"==typeof window&&"object"==typeof document,cX=cK&&cK.prototype,cJ=nZ("species"),cq=!1,cZ=i3(iQ.PromiseRejectionEvent),c$={CONSTRUCTOR:oe("Promise",function(){var e=sZ(cK),t=e!==String(cK);if(!t&&66===ny||!cX.catch||!cX.finally)return!0;if(!ny||ny<51||!/native code/.test(e)){var r=new cK(function(e){e(1)}),i=function(e){e(function(){},function(){})};if((r.constructor={})[cJ]=i,!(cq=r.then(function(){})instanceof i))return!0}return!t&&(cz||cQ)&&!cZ}),REJECTION_EVENT:cZ,SUBCLASSING:cq},c0={},c2=TypeError,c1=function(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw c2("Bad Promise constructor");t=e,r=i}),this.resolve=nD(t),this.reject=nD(r)};c0.f=function(e){return new c1(e)};var c4,c6,c3=cy,c8=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}},c5="Promise",c9=c$.CONSTRUCTOR,c7=c$.REJECTION_EVENT,de=sE.getterFor(c5),dt=sE.set,dr=cK&&cK.prototype,di=cK,dn=dr,da=iQ.TypeError,ds=iQ.document,dc=iQ.process,dd=c0.f,du=dd,dl=!!(ds&&ds.createEvent&&iQ.dispatchEvent),dh="unhandledrejection",dp=function(e){var t;return!(!n_(e)||!i3(t=e.then))&&t},df=function(e,t){var r,i,n,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,d=e.reject,u=e.domain;try{s?(a||(2===t.rejection&&dE(t),t.rejection=1),!0===s?r=o:(u&&u.enter(),r=s(o),u&&(u.exit(),n=!0)),r===e.promise?d(da("Promise-chain cycle")):(i=dp(r))?i7(i,r,c,d):c(r)):d(o)}catch(e){u&&!n&&u.exit(),d(e)}},d_=function(e,t){e.notified||(e.notified=!0,cH(function(){for(var r,i=e.reactions;r=i.get();)df(r,e);e.notified=!1,t&&!e.rejection&&dm(e)}))},dA=function(e,t,r){var i,n;dl?((i=ds.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),iQ.dispatchEvent(i)):i={promise:t,reason:r},!c7&&(n=iQ["on"+e])?n(i):e===dh&&c8("Unhandled promise rejection",r)},dm=function(e){i7(c3,iQ,function(){var t,r=e.facade,i=e.value;if(dv(e)&&(t=cY(function(){o3?dc.emit("unhandledRejection",i,r):dA(dh,r,i)}),e.rejection=o3||dv(e)?2:1,t.error))throw t.value})},dv=function(e){return 1!==e.rejection&&!e.parent},dE=function(e){i7(c3,iQ,function(){var t=e.facade;o3?dc.emit("rejectionHandled",t):dA("rejectionhandled",t,e.value)})},dg=function(e,t,r){return function(i){e(t,i,r)}},dS=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,d_(e,!0))},db=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw da("Promise can't be resolved itself");var i=dp(t);i?cH(function(){var r={done:!1};try{i7(i,t,dg(db,r,e),dg(dS,r,e))}catch(t){dS(r,t,e)}}):(e.value=t,e.state=1,d_(e,!1))}catch(t){dS({done:!1},t,e)}}};c9&&(dn=(di=function(e){sJ(this,dn),nD(e),i7(c4,this);var t=de(this);try{e(dg(db,t),dg(dS,t))}catch(e){dS(t,e)}}).prototype,(c4=function(e){dt(this,{type:c5,done:!1,notified:!1,parent:!1,reactions:new cI,rejection:!1,state:0,value:void 0})}).prototype=sy(dn,"then",function(e,t){var r=de(this),i=dd(co(this,di));return r.parent=!0,i.ok=!i3(e)||e,i.fail=i3(t)&&t,i.domain=o3?dc.domain:void 0,0==r.state?r.reactions.add(i):cH(function(){df(i,r)}),i.promise}),c6=function(){var e=new c4,t=de(e);this.promise=e,this.resolve=dg(db,t),this.reject=dg(dS,t)},c0.f=dd=function(e){return e===di||void 0===e?new c6(e):du(e)}),oS({global:!0,constructor:!0,wrap:!0,forced:c9},{Promise:di}),sN(di,c5,!1,!0),uG=nv(c5),i5&&uG&&!uG[sz]&&sQ(uG,sz,{configurable:!0,get:function(){return this}});var dT=nZ("iterator"),dy=!1;try{var dR=0,dI={next:function(){return{done:!!dR++}},return:function(){dy=!0}};dI[dT]=function(){return this},Array.from(dI,function(){throw 2})}catch(e){}var dC=c$.CONSTRUCTOR||!function(e,t){if(!dy)return!1;var r=!1;try{var i={};i[dT]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch(e){}return r}(function(e){cK.all(e).then(void 0,function(){})});oS({target:"Promise",stat:!0,forced:dC},{all:function(e){var t=this,r=c0.f(t),i=r.resolve,n=r.reject,o=cY(function(){var r=nD(t.resolve),o=[],a=0,s=1;a9(e,function(e){var c=a++,d=!1;s++,i7(r,t,e).then(function(e){d||(d=!0,o[c]=e,--s||i(o))},n)}),--s||i(o)});return o.error&&n(o.value),r.promise}});var dk=c$.CONSTRUCTOR;cK&&cK.prototype,oS({target:"Promise",proto:!0,forced:dk,real:!0},{catch:function(e){return this.then(void 0,e)}});oS({target:"Promise",stat:!0,forced:dC},{race:function(e){var t=this,r=c0.f(t),i=r.reject,n=cY(function(){var n=nD(t.resolve);a9(e,function(e){i7(n,t,e).then(r.resolve,i)})});return n.error&&i(n.value),r.promise}});oS({target:"Promise",stat:!0,forced:c$.CONSTRUCTOR},{reject:function(e){var t=c0.f(this);return i7(t.reject,void 0,e),t.promise}});var dw=function(e,t){if(ol(e),n_(t)&&t.constructor===e)return t;var r=c0.f(e);return(0,r.resolve)(t),r.promise},dO=c$.CONSTRUCTOR,dN=nv("Promise"),dP=!dO;oS({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return dw(dP&&this===dN?cK:this,e)}});oS({target:"Promise",stat:!0,forced:dC},{allSettled:function(e){var t=this,r=c0.f(t),i=r.resolve,n=r.reject,o=cY(function(){var r=nD(t.resolve),n=[],o=0,a=1;a9(e,function(e){var s=o++,c=!1;a++,i7(r,t,e).then(function(e){c||(c=!0,n[s]={status:"fulfilled",value:e},--a||i(n))},function(e){c||(c=!0,n[s]={status:"rejected",reason:e},--a||i(n))})}),--a||i(n)});return o.error&&n(o.value),r.promise}});var dD="No one promise resolved";oS({target:"Promise",stat:!0,forced:dC},{any:function(e){var t=this,r=nv("AggregateError"),i=c0.f(t),n=i.resolve,o=i.reject,a=cY(function(){var i=nD(t.resolve),a=[],s=0,c=1,d=!1;a9(e,function(e){var u=s++,l=!1;c++,i7(i,t,e).then(function(e){l||d||(d=!0,n(e))},function(e){l||d||(l=!0,a[u]=e,--c||o(new r(a,dD)))})}),--c||o(new r(a,dD))});return a.error&&o(a.value),i.promise}});var dL=cK&&cK.prototype;oS({target:"Promise",proto:!0,real:!0,forced:!!cK&&iV(function(){dL.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=co(this,nv("Promise")),r=i3(e);return this.then(r?function(r){return dw(t,e()).then(function(){return r})}:e,r?function(r){return dw(t,e()).then(function(){throw r})}:e)}});var dM=iH("".charAt),dx=iH("".charCodeAt),dU=iH("".slice),dB=function(e){return function(t,r){var i,n,o=oQ(nh(t)),a=oR(r),s=o.length;return a<0||a>=s?e?"":void 0:(i=dx(o,a))<55296||i>56319||a+1===s||(n=dx(o,a+1))<56320||n>57343?e?dM(o,a):i:e?dU(o,a,a+2):n-56320+(i-55296<<10)+65536}},dV={codeAt:dB(!1),charAt:dB(!0)},dF=dV.charAt,dj="String Iterator",dG=sE.set,dW=sE.getterFor(dj);sG(String,"String",function(e){dG(this,{type:dj,string:oQ(e),index:0})},function(){var e,t=dW(this),r=t.string,i=t.index;return i>=r.length?sW(void 0,!0):(e=dF(r,i),t.index+=e.length,sW(e,!1))});var dH=nA.Promise,dY={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},dK=nZ("toStringTag");for(var dQ in dY){var dz=iQ[dQ],dX=dz&&dz.prototype;dX&&oY(dX)!==dK&&ov(dX,dK,dQ),aJ[dQ]=aJ.Array}var dJ=iB(dH),dq=oM("Array").values,dZ=Array.prototype,d$={DOMTokenList:!0,NodeList:!0},d0=iB(function(e){var t=e.values;return e===dZ||iY(dZ,e)&&t===dZ.values||nH(d$,oY(e))?dq:t}),d2=nZ("iterator"),d1=!iV(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2"),i="";return e.pathname="c%20d",t.forEach(function(e,r){t.delete("b"),i+=r+e}),r.delete("a",2),!e.toJSON||!r.has("a",1)||r.has("a",2)||!t.size||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[d2]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==i||"x"!==new URL("http://x",void 0).host}),d4=function(e,t,r){var i=n4(t);i in e?os.f(e,i,na(0,r)):e[i]=r},d6=Array,d3=Math.max,d8=function(e,t,r){for(var i=oN(e),n=ok(t,i),o=ok(void 0===r?i:r,i),a=d6(d3(o-n,0)),s=0;n<o;n++,s++)d4(a,s,e[n]);return a.length=s,a},d5=Math.floor,d9=function(e,t){var r=e.length,i=d5(r/2);return r<8?d7(e,t):ue(e,d9(d8(e,0,i),t),d9(d8(e,i),t),t)},d7=function(e,t){for(var r,i,n=e.length,o=1;o<n;){for(i=o,r=e[o];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==o++&&(e[i]=r)}return e},ue=function(e,t,r,i){for(var n=t.length,o=r.length,a=0,s=0;a<n||s<o;)e[a+s]=a<n&&s<o?0>=i(t[a],r[s])?t[a++]:r[s++]:a<n?t[a++]:r[s++];return e},ut=nZ("iterator"),ur="URLSearchParams",ui=ur+"Iterator",un=sE.set,uo=sE.getterFor(ur),ua=sE.getterFor(ui),us=Object.getOwnPropertyDescriptor,uc=function(e){if(!i5)return iQ[e];var t=us(iQ,e);return t&&t.value},ud=uc("fetch"),uu=uc("Request"),ul=uc("Headers"),uh=uu&&uu.prototype,up=ul&&ul.prototype,uf=iQ.RegExp,u_=iQ.TypeError,uA=iQ.decodeURIComponent,um=iQ.encodeURIComponent,uv=iH("".charAt),uE=iH([].join),ug=iH([].push),uS=iH("".replace),ub=iH([].shift),uT=iH([].splice),uy=iH("".split),uR=iH("".slice),uI=/\+/g,uC=[,,,,],uk=function(e){try{return uA(e)}catch(t){return e}},uw=function(e){var t,r=uS(e,uI," "),i=4;try{return uA(r)}catch(e){for(;i;){;r=uS(r,uC[(t=i--)-1]||(uC[t-1]=uf("((?:%[\\da-f]{2}){"+t+"})","gi")),uk)}return r}},uO=/[!'()~]|%20/g,uN={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},uP=function(e){return uN[e]},uD=function(e){return uS(um(e),uO,uP)},uL=sL(function(e,t){un(this,{type:ui,iterator:a4(uo(e).entries),kind:t})},"Iterator",function(){var e=ua(this),t=e.kind,r=e.iterator.next(),i=r.value;return r.done||(r.value="keys"===t?i.key:"values"===t?i.value:[i.key,i.value]),r},!0),uM=function(e){this.entries=[],this.url=null,void 0!==e&&(n_(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===uv(e,0)?uR(e,1):e:oQ(e)))};uM.prototype={type:ur,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,i,n,o,a,s,c=a2(e);if(c)for(r=(t=a4(e,c)).next;!(i=i7(r,t)).done;){if((a=i7(o=(n=a4(ol(i.value))).next,n)).done||(s=i7(o,n)).done||!i7(o,n).done)throw u_("Expected sequence with length 2");ug(this.entries,{key:oQ(a.value),value:oQ(s.value)})}else for(var d in e)nH(e,d)&&ug(this.entries,{key:d,value:oQ(e[d])})},parseQuery:function(e){if(e)for(var t,r,i=uy(e,"&"),n=0;n<i.length;)(t=i[n++]).length&&(r=uy(t,"="),ug(this.entries,{key:uw(ub(r)),value:uw(uE(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],i=0;i<t.length;)ug(r,uD((e=t[i++]).key)+"="+uD(e.value));return uE(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ux=function(){sJ(this,uU);var e=un(this,new uM(arguments.length>0?arguments[0]:void 0));i5||(this.size=e.entries.length)},uU=ux.prototype;if(function(e,t,r){for(var i in t)r&&r.unsafe&&e[i]?e[i]=t[i]:sy(e,i,t[i],r);}(uU,{append:function(e,t){var r=uo(this);cc(arguments.length,2),ug(r.entries,{key:oQ(e),value:oQ(t)}),i5||this.length++,r.updateURL()},delete:function(e){for(var t=uo(this),r=cc(arguments.length,1),i=t.entries,n=oQ(e),o=r<2?void 0:arguments[1],a=void 0===o?o:oQ(o),s=0;s<i.length;){var c=i[s];if(c.key!==n||void 0!==a&&c.value!==a)s++;else if(uT(i,s,1),void 0!==a)break}i5||(this.size=i.length),t.updateURL()},get:function(e){var t=uo(this).entries;cc(arguments.length,1);for(var r=oQ(e),i=0;i<t.length;i++)if(t[i].key===r)return t[i].value;return null},getAll:function(e){var t=uo(this).entries;cc(arguments.length,1);for(var r=oQ(e),i=[],n=0;n<t.length;n++)t[n].key===r&&ug(i,t[n].value);return i},has:function(e){for(var t=uo(this).entries,r=cc(arguments.length,1),i=oQ(e),n=r<2?void 0:arguments[1],o=void 0===n?n:oQ(n),a=0;a<t.length;){var s=t[a++];if(s.key===i&&(void 0===o||s.value===o))return!0}return!1},set:function(e,t){var r=uo(this);cc(arguments.length,1);for(var i,n=r.entries,o=!1,a=oQ(e),s=oQ(t),c=0;c<n.length;c++)(i=n[c]).key===a&&(o?uT(n,c--,1):(o=!0,i.value=s));o||ug(n,{key:a,value:s}),i5||(this.size=n.length),r.updateURL()},sort:function(){var e=uo(this);d9(e.entries,function(e,t){return e.key>t.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=uo(this).entries,i=oa(e,arguments.length>1?arguments[1]:void 0),n=0;n<r.length;)i((t=r[n++]).value,t.key,this)},keys:function(){return new uL(this,"keys")},values:function(){return new uL(this,"values")},entries:function(){return new uL(this,"entries")}},{enumerable:!0}),sy(uU,ut,uU.entries,{name:"entries"}),sy(uU,"toString",function(){return uo(this).serialize()},{enumerable:!0}),i5&&sQ(uU,"size",{get:function(){return uo(this).entries.length},configurable:!0,enumerable:!0}),sN(ux,ur),oS({global:!0,constructor:!0,forced:!d1},{URLSearchParams:ux}),!d1&&i3(ul)){var uB=iH(up.has),uV=iH(up.set),uF=function(e){if(n_(e)){var t,r=e.body;if(oY(r)===ur)return uB(t=e.headers?new ul(e.headers):new ul,"content-type")||uV(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),aj(e,{body:na(0,oQ(r)),headers:na(0,t)})}return e};if(i3(ud)&&oS({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return ud(e,arguments.length>1?uF(arguments[1]):{})}}),i3(uu)){var uj=function(e){return sJ(this,uh),new uu(e,arguments.length>1?uF(arguments[1]):{})};uh.constructor=uj,uj.prototype=uh,oS({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:uj})}}var uG,uW,uH=nA.URLSearchParams,uY=Object.assign,uK=Object.defineProperty,uQ=iH([].concat),uz=!uY||iV(function(){if(i5&&1!==uY({b:1},uY(uK({},"a",{enumerable:!0,get:function(){uK(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(e){t[e]=e}),7!=uY({},e)[r]||aN(uY({},t)).join("")!=i})?function(e,t){for(var r=nG(e),i=arguments.length,n=1,o=aC.f,a=ne.f;i>n;)for(var s,c=nd(arguments[n++]),d=o?uQ(aN(c),o(c)):aN(c),u=d.length,l=0;u>l;)s=d[l++],i5&&!i7(a,c,s)||(r[s]=c[s]);return r}:uY,uX=function(e,t,r,i){try{return i?t(ol(r)[0],r[1]):t(r)}catch(t){a6(e,"throw",t)}},uJ=Array,uq=/[^\0-\u007E]/,uZ=/[.\u3002\uFF0E\uFF61]/g,u$="Overflow: input needs wider integers to process",u0=RangeError,u2=iH(uZ.exec),u1=Math.floor,u4=String.fromCharCode,u6=iH("".charCodeAt),u3=iH([].join),u8=iH([].push),u5=iH("".replace),u9=iH("".split),u7=iH("".toLowerCase),le=function(e){return e+22+75*(e<26)},lt=function(e,t,r){var i=0;for(e=r?u1(e/700):e>>1,e+=u1(e/t);e>455;)e=u1(e/35),i+=36;return u1(i+36*e/(e+38))},lr=function(e){var t=[],r,i,n=(e=function(e){for(var t=[],r=0,i=e.length;r<i;){var n=u6(e,r++);if(n>=55296&&n<=56319&&r<i){var o=u6(e,r++);56320==(64512&o)?u8(t,((1023&n)<<10)+(1023&o)+65536):(u8(t,n),r--)}else u8(t,n)}return t}(e)).length,o=128,a=0,s=72;for(r=0;r<e.length;r++)(i=e[r])<128&&u8(t,u4(i));var c=t.length,d=c;for(c&&u8(t,"-");d<n;){var u=0x7fffffff;for(r=0;r<e.length;r++)(i=e[r])>=o&&i<u&&(u=i);var l=d+1;if(u-o>u1((0x7fffffff-a)/l))throw u0(u$);for(a+=(u-o)*l,o=u,r=0;r<e.length;r++){if((i=e[r])<o&&++a>0x7fffffff)throw u0(u$);if(i==o){for(var h=a,p=36;;){var f=p<=s?1:p>=s+26?26:p-s;if(h<f)break;var _=h-f,A=36-f;u8(t,u4(le(f+_%A))),h=u1(_/A),p+=36}u8(t,u4(le(h))),s=lt(a,l,d==c),a=0,d++}}a++,o++}return u3(t,"")},li=function(e){var t=nG(e),r=ct(this),i=arguments.length,n=i>1?arguments[1]:void 0,o=void 0!==n;o&&(n=oa(n,i>2?arguments[2]:void 0));var a,s,c,d,u,l,h=a2(t),p=0;if(!h||this===uJ&&a$(h))for(a=oN(t),s=r?new this(a):uJ(a);a>p;p++)l=o?n(t[p],p):t[p],d4(s,p,l);else for(u=(d=a4(t,h)).next,s=r?new this:[];!(c=i7(u,d)).done;p++)l=o?uX(d,n,[c.value,p],!0):c.value,d4(s,p,l);return s.length=p,s},ln=dV.codeAt,lo=function(e){var t,r,i=[],n=u9(u5(u7(e),uZ,"."),".");for(t=0;t<n.length;t++)u8(i,u2(uq,r=n[t])?"xn--"+lr(r):r);return u3(i,".")},la=ux,ls=uo,lc=sE.set,ld=sE.getterFor("URL"),lu=iQ.URL,ll=iQ.TypeError,lh=iQ.parseInt,lp=Math.floor,lf=Math.pow,l_=iH("".charAt),lA=iH(/./.exec),lm=iH([].join),lv=iH(1..toString),lE=iH([].pop),lg=iH([].push),lS=iH("".replace),lb=iH([].shift),lT=iH("".split),ly=iH("".slice),lR=iH("".toLowerCase),lI=iH([].unshift),lC="Invalid scheme",lk="Invalid host",lw="Invalid port",lO=/[a-z]/i,lN=/[\d+-.a-z]/i,lP=/\d/,lD=/^0x/i,lL=/^[0-7]+$/,lM=/^\d+$/,lx=/^[\da-f]+$/i,lU=/[\0\t\n\r #%/:<>?@[\\\]^|]/,lB=/[\0\t\n\r #/:<>?@[\\\]^|]/,lV=/^[\u0000-\u0020]+/,lF=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,lj=/[\t\n\r]/g,lG=function(e){var t,r,i,n;if("number"==typeof e){for(t=[],r=0;r<4;r++)lI(t,e%256),e=lp(e/256);return lm(t,".")}if("object"==typeof e){for(t="",i=function(e){for(var t=null,r=1,i=null,n=0,o=0;o<8;o++)0!==e[o]?(n>r&&(t=i,r=n),i=null,n=0):(null===i&&(i=o),++n);return n>r&&(t=i,r=n),t}(e),r=0;r<8;r++)n&&0===e[r]||(n&&(n=!1),i===r?(t+=r?":":"::",n=!0):(t+=lv(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},lW={},lH=uz({},lW,{" ":1,'"':1,"<":1,">":1,"`":1}),lY=uz({},lH,{"#":1,"?":1,"{":1,"}":1}),lK=uz({},lY,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),lQ=function(e,t){var r=ln(e,0);return r>32&&r<127&&!nH(t,e)?e:encodeURIComponent(e)},lz={ftp:21,file:null,http:80,https:443,ws:80,wss:443},lX=function(e,t){var r;return 2==e.length&&lA(lO,l_(e,0))&&(":"==(r=l_(e,1))||!t&&"|"==r)},lJ=function(e){var t;return e.length>1&&lX(ly(e,0,2))&&(2==e.length||"/"===(t=l_(e,2))||"\\"===t||"?"===t||"#"===t)},lq={},lZ={},l$={},l0={},l2={},l1={},l4={},l6={},l3={},l8={},l5={},l9={},l7={},he={},ht={},hr={},hi={},hn={},ho={},ha={},hs={},hc=function(e,t,r){var i,n,o,a=oQ(e);if(t){if(n=this.parse(a))throw ll(n);this.searchParams=null}else{if(void 0!==r&&(i=new hc(r,!0)),n=this.parse(a,null,i))throw ll(n);(o=ls(new la)).bindURL(this),this.searchParams=o}};hc.prototype={type:"URL",parse:function(e,t,r){var i,n,o,a,s,c=t||lq,d=0,u="",l=!1,h=!1,p=!1;for(e=oQ(e),t||(this.scheme="",this.username="",this.password="",this.host=null,this.port=null,this.path=[],this.query=null,this.fragment=null,this.cannotBeABaseURL=!1,e=lS(e,lV,""),e=lS(e,lF,"$1")),i=li(e=lS(e,lj,""));d<=i.length;){switch(n=i[d],c){case lq:if(!n||!lA(lO,n)){if(t)return lC;c=l$;continue}u+=lR(n),c=lZ;break;case lZ:if(n&&(lA(lN,n)||"+"==n||"-"==n||"."==n))u+=lR(n);else{if(":"!=n){if(t)return lC;u="",c=l$,d=0;continue}if(t&&(this.isSpecial()!=nH(lz,u)||"file"==u&&(this.includesCredentials()||null!==this.port)||"file"==this.scheme&&!this.host))return;if(this.scheme=u,t)return void(this.isSpecial()&&lz[this.scheme]==this.port&&(this.port=null));u="","file"==this.scheme?c=he:this.isSpecial()&&r&&r.scheme==this.scheme?c=l0:this.isSpecial()?c=l6:"/"==i[d+1]?(c=l2,d++):(this.cannotBeABaseURL=!0,lg(this.path,""),c=ho)}break;case l$:if(!r||r.cannotBeABaseURL&&"#"!=n)return lC;if(r.cannotBeABaseURL&&"#"==n){this.scheme=r.scheme,this.path=d8(r.path),this.query=r.query,this.fragment="",this.cannotBeABaseURL=!0,c=hs;break}c="file"==r.scheme?he:l1;continue;case l0:if("/"!=n||"/"!=i[d+1]){c=l1;continue}c=l3,d++;break;case l2:if("/"==n){c=l8;break}c=hn;continue;case l1:if(this.scheme=r.scheme,n==uW)this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=d8(r.path),this.query=r.query;else if("/"==n||"\\"==n&&this.isSpecial())c=l4;else if("?"==n)this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=d8(r.path),this.query="",c=ha;else{if("#"!=n){this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=d8(r.path),this.path.length--,c=hn;continue}this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,this.path=d8(r.path),this.query=r.query,this.fragment="",c=hs}break;case l4:if(this.isSpecial()&&("/"==n||"\\"==n))c=l3;else{if("/"!=n){this.username=r.username,this.password=r.password,this.host=r.host,this.port=r.port,c=hn;continue}c=l8}break;case l6:if(c=l3,"/"!=n||"/"!=l_(u,d+1))continue;d++;break;case l3:if("/"!=n&&"\\"!=n){c=l8;continue}break;case l8:if("@"==n){l&&(u="%40"+u),l=!0,o=li(u);for(var f,_=0;_<o.length;_++){var A=o[_];if(":"!=A||p){var m=lQ(A,lK);p?this.password+=m:this.username+=m}else p=!0}u=""}else if(n==uW||"/"==n||"?"==n||"#"==n||"\\"==n&&this.isSpecial()){if(l&&""==u)return"Invalid authority";d-=li(u).length+1,u="",c=l5}else u+=n;break;case l5:case l9:if(t&&"file"==this.scheme){c=hr;continue}if(":"!=n||h){if(n==uW||"/"==n||"?"==n||"#"==n||"\\"==n&&this.isSpecial()){if(this.isSpecial()&&""==u)return lk;if(t&&""==u&&(this.includesCredentials()||null!==this.port))return;if(a=this.parseHost(u))return a;if(u="",c=hi,t)return;continue}"["==n?h=!0:"]"==n&&(h=!1),u+=n}else{if(""==u)return lk;if(a=this.parseHost(u))return a;if(u="",c=l7,t==l9)return}break;case l7:if(!lA(lP,n)){if(n==uW||"/"==n||"?"==n||"#"==n||"\\"==n&&this.isSpecial()||t){if(""!=u){var v=lh(u,10);if(v>65535)return lw;this.port=this.isSpecial()&&v===lz[this.scheme]?null:v,u=""}if(t)return;c=hi;continue}return lw}u+=n;break;case he:if(this.scheme="file","/"==n||"\\"==n)c=ht;else{if(!r||"file"!=r.scheme){c=hn;continue}if(n==uW)this.host=r.host,this.path=d8(r.path),this.query=r.query;else if("?"==n)this.host=r.host,this.path=d8(r.path),this.query="",c=ha;else{if("#"!=n){lJ(lm(d8(i,d),""))||(this.host=r.host,this.path=d8(r.path),this.shortenPath()),c=hn;continue}this.host=r.host,this.path=d8(r.path),this.query=r.query,this.fragment="",c=hs}}break;case ht:if("/"==n||"\\"==n){c=hr;break}r&&"file"==r.scheme&&!lJ(lm(d8(i,d),""))&&(lX(r.path[0],!0)?lg(this.path,r.path[0]):this.host=r.host),c=hn;continue;case hr:if(n==uW||"/"==n||"\\"==n||"?"==n||"#"==n){if(!t&&lX(u))c=hn;else if(""==u){if(this.host="",t)return;c=hi}else{if(a=this.parseHost(u))return a;if("localhost"==this.host&&(this.host=""),t)return;u="",c=hi}continue}u+=n;break;case hi:if(this.isSpecial()){if(c=hn,"/"!=n&&"\\"!=n)continue}else if(t||"?"!=n){if(t||"#"!=n){if(n!=uW&&(c=hn,"/"!=n))continue}else this.fragment="",c=hs}else this.query="",c=ha;break;case hn:if(n==uW||"/"==n||"\\"==n&&this.isSpecial()||!t&&("?"==n||"#"==n)){;if(".."===(s=lR(s=u))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(this.shortenPath(),"/"==n||"\\"==n&&this.isSpecial()||lg(this.path,"")):"."===(f=u)||"%2e"===lR(f)?"/"==n||"\\"==n&&this.isSpecial()||lg(this.path,""):("file"==this.scheme&&!this.path.length&&lX(u)&&(this.host&&(this.host=""),u=l_(u,0)+":"),lg(this.path,u)),u="","file"==this.scheme&&(n==uW||"?"==n||"#"==n))for(;this.path.length>1&&""===this.path[0];)lb(this.path);"?"==n?(this.query="",c=ha):"#"==n&&(this.fragment="",c=hs)}else u+=lQ(n,lY);break;case ho:"?"==n?(this.query="",c=ha):"#"==n?(this.fragment="",c=hs):n!=uW&&(this.path[0]+=lQ(n,lW));break;case ha:t||"#"!=n?n!=uW&&("'"==n&&this.isSpecial()?this.query+="%27":this.query+="#"==n?"%23":lQ(n,lW)):(this.fragment="",c=hs);break;case hs:n!=uW&&(this.fragment+=lQ(n,lH))}d++}},parseHost:function(e){var t,r,i;if("["==l_(e,0)){if("]"!=l_(e,e.length-1)||!(t=function(e){var t,r,i,n,o,a,s,c=[0,0,0,0,0,0,0,0],d=0,u=null,l=0,h=function(){return l_(e,l)};if(":"==h()){if(":"!=l_(e,1))return;l+=2,u=++d}for(;h();){if(8==d)return;if(":"!=h()){for(t=r=0;r<4&&lA(lx,h());)t=16*t+lh(h(),16),l++,r++;if("."==h()){if(0==r||(l-=r,d>6))return;for(i=0;h();){if(n=null,i>0){if(!("."==h()&&i<4))return;l++}if(!lA(lP,h()))return;for(;lA(lP,h());){if(o=lh(h(),10),null===n)n=o;else{if(0==n)return;n=10*n+o}if(n>255)return;l++}c[d]=256*c[d]+n,2!=++i&&4!=i||d++}if(4!=i)return;break}if(":"==h()){if(l++,!h())return}else if(h())return;c[d++]=t}else{if(null!==u)return;l++,u=++d}}if(null!==u)for(a=d-u,d=7;0!=d&&a>0;)s=c[d],c[d--]=c[u+a-1],c[u+--a]=s;else if(8!=d)return;return c}(ly(e,1,-1))))return lk;this.host=t}else if(this.isSpecial()){if(lA(lU,e=lo(e))||null===(t=function(e){var t,r,i,n,o,a,s,c=lT(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(r=[],i=0;i<t;i++){if(""==(n=c[i]))return e;if(o=10,n.length>1&&"0"==l_(n,0)&&(o=lA(lD,n)?16:8,n=ly(n,8==o?1:2)),""===n)a=0;else{if(!lA(10==o?lM:8==o?lL:lx,n))return e;a=lh(n,o)}lg(r,a)}for(i=0;i<t;i++)if(a=r[i],i==t-1){if(a>=lf(256,5-t))return null}else if(a>255)return null;for(s=lE(r),i=0;i<r.length;i++)s+=r[i]*lf(256,3-i);return s}(e)))return lk;this.host=t}else{if(lA(lB,e))return lk;for(t="",r=li(e),i=0;i<r.length;i++)t+=lQ(r[i],lW);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return nH(lz,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&lX(e[0],!0)||e.length--},serialize:function(){var e=this.scheme,t=this.username,r=this.password,i=this.host,n=this.port,o=this.path,a=this.query,s=this.fragment,c=e+":";return null!==i?(c+="//",this.includesCredentials()&&(c+=t+(r?":"+r:"")+"@"),c+=lG(i),null!==n&&(c+=":"+n)):"file"==e&&(c+="//"),c+=this.cannotBeABaseURL?o[0]:o.length?"/"+lm(o,"/"):"",null!==a&&(c+="?"+a),null!==s&&(c+="#"+s),c},setHref:function(e){var t=this.parse(e);if(t)throw ll(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new hd(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+lG(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(oQ(e)+":",lq)},getUsername:function(){return this.username},setUsername:function(e){var t=li(oQ(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=lQ(t[r],lK)}},getPassword:function(){return this.password},setPassword:function(e){var t=li(oQ(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=lQ(t[r],lK)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?lG(e):lG(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,l5)},getHostname:function(){var e=this.host;return null===e?"":lG(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,l9)},getPort:function(){var e=this.port;return null===e?"":oQ(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=oQ(e))?this.port=null:this.parse(e,l7))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+lm(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,hi))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=oQ(e))?this.query=null:("?"==l_(e,0)&&(e=ly(e,1)),this.query="",this.parse(e,ha)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=oQ(e))?("#"==l_(e,0)&&(e=ly(e,1)),this.fragment="",this.parse(e,hs)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var hd=function(e){var t=sJ(this,hu),r=cc(arguments.length,1)>1?arguments[1]:void 0,i=lc(t,new hc(e,!1,r));i5||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},hu=hd.prototype,hl=function(e,t){return{get:function(){return ld(this)[e]()},set:t&&function(e){return ld(this)[t](e)},configurable:!0,enumerable:!0}};if(i5&&(sQ(hu,"href",hl("serialize","setHref")),sQ(hu,"origin",hl("getOrigin")),sQ(hu,"protocol",hl("getProtocol","setProtocol")),sQ(hu,"username",hl("getUsername","setUsername")),sQ(hu,"password",hl("getPassword","setPassword")),sQ(hu,"host",hl("getHost","setHost")),sQ(hu,"hostname",hl("getHostname","setHostname")),sQ(hu,"port",hl("getPort","setPort")),sQ(hu,"pathname",hl("getPathname","setPathname")),sQ(hu,"search",hl("getSearch","setSearch")),sQ(hu,"searchParams",hl("getSearchParams")),sQ(hu,"hash",hl("getHash","setHash"))),sy(hu,"toJSON",function(){return ld(this).serialize()},{enumerable:!0}),sy(hu,"toString",function(){return ld(this).serialize()},{enumerable:!0}),lu){var hh=lu.createObjectURL,hp=lu.revokeObjectURL;hh&&sy(hd,"createObjectURL",oa(hh,lu)),hp&&sy(hd,"revokeObjectURL",oa(hp,lu))}sN(hd,"URL"),oS({global:!0,constructor:!0,forced:!d1,sham:!i5},{URL:hd});var hf=nv("URL");oS({target:"URL",stat:!0,forced:!(d1&&iV(function(){hf.canParse()}))},{canParse:function(e){var t=cc(arguments.length,1),r=oQ(e),i=t<2||void 0===arguments[1]?void 0:oQ(arguments[1]);try{return new hf(r,i),!0}catch(e){return!1}}});var h_=iB(nA.URL);let hA=!0,hm=!0;function hv(e,t,r){let i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function hE(e,t,r){if(!e.RTCPeerConnection)return;let i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return n.apply(this,arguments);let o=e=>{let t=r(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),n.apply(this,[e,o])};let o=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(r))return o.apply(this,arguments);let i=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function hg(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(hA=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function hS(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(hm=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function hb(){"object"==typeof window&&!hA&&"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}function hT(e,t){hm&&console.warn(e+" is deprecated, please use "+t+" instead.")}function hy(e){return"[object Object]"===Object.prototype.toString.call(e)}function hR(e,t,r){let i=r?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;let o=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(r=>{r.type===i&&r.trackId===t.id&&function e(t,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(n=>{n.endsWith("Id")?e(t,t.get(r[n]),i):n.endsWith("Ids")&&r[n].forEach(r=>{e(t,t.get(r),i)})}))}(e,r,n)})}),n}function hI(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach(r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;let i="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);let n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[n("min",r)]=i.ideal,t.optional.push(e),(e={})[n("max",r)]=i.ideal):e[n("",r)]=i.ideal,t.optional.push(e)}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",r)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});let a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then(r=>{let a=(r=r.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>{var r;return o0(r=e.label.toLowerCase()).call(r,t)}));return!a&&r.length&&o0(t).call(t,"back")&&(a=r[r.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),hb("chrome: "+JSON.stringify(e)),n(e)})}e.video=i(e.video)}return hb("chrome: "+JSON.stringify(e)),n(e)},o=function(e){return t.version>=64?e:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(e,t,i){n(e,e=>{r.webkitGetUserMedia(e,t,e=>{i&&i(o(e))})})}).bind(r),r.mediaDevices.getUserMedia){let e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return n(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>dJ.reject(o(e))))}}}function hC(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function hk(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)hE(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.track.id):{track:r.track};let n=new Event("track");n.track=r.track,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)}),t.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.id):{track:r};let n=new Event("track");n.track=r,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function hw(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let n=r.apply(this,arguments);return n||(n=t(this,e),this._senders.push(n)),n};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{let t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function hO(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,r,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0==arguments.length||"function"!=typeof e))return t.apply(this,[]);let n=function(e){let t={};return e.result().forEach(e=>{let r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{r[t]=e.stat(t)}),t[r.id]=r}),t},o=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};return arguments.length>=2?t.apply(this,[function(e){r(o(n(e)))},e]):new dJ((e,r)=>{t.apply(this,[function(t){e(o(n(t)))},r])}).then(r,i)}}function hN(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>hR(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),hE(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>hR(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,r;let i=arguments[0];return this.getSenders().forEach(t=>{t.track===i&&(e?r=!0:e=t)}),this.getReceivers().forEach(e=>(e.track===i&&(t?r=!0:t=e),e.track===i)),r||e&&t?dJ.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():dJ.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function hP(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let t=this.getSenders();r.apply(this,arguments);let i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};let n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{let r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),n.apply(this,arguments)}}function hD(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return hP(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){let r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};let n=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let n=this._streams[r.id];if(n)n.addTrack(t),dJ.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let i=new e.MediaStream([t]);this._streams[r.id]=i,this._reverseStreams[i.id]=r,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){let e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{let r=o(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(e=>o(this,e))}})[t]});let a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t;let r;return arguments.length&&arguments[0].type&&(arguments[0]=(e=this,t=arguments[0],r=t.sdp,Object.keys(e._reverseStreams||[]).forEach(t=>{let i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r}))),a.apply(this,arguments)};let s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){let t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(r=>{this._streams[r].getTracks().find(t=>e.track===t)&&(t=this._streams[r])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function hL(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}})[t]})}function hM(e,t){hE(e,"negotiationneeded",e=>{let r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e})}var hx=Object.freeze({__proto__:null,fixNegotiationNeeded:hM,shimAddTrackRemoveTrack:hD,shimAddTrackRemoveTrackWithNative:hP,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(t=>{let i=r.video&&r.video.width,n=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},i&&(r.video.mandatory.maxWidth=i),n&&(r.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:hw,shimGetStats:hO,shimGetUserMedia:hI,shimMediaStream:hC,shimOnTrack:hk,shimPeerConnection:hL,shimSenderReceiverGetStats:hN});function hU(e,t){let r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){hT("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(e((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},i&&i.prototype.getSettings){let t=i.prototype.getSettings;i.prototype.getSettings=function(){let r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(i&&i.prototype.applyConstraints){let t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(e(r=JSON.parse(JSON.stringify(r)),"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function hB(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function hV(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}})[t]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,o]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!n)try{e.forEach(e=>{e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(n,o)}}function hF(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):dJ.resolve(new Map)}}function hj(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),hE(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function hG(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){hT("removeStream","removeTrack"),this.getSenders().forEach(t=>{var r;t.track&&o0(r=e.getTracks()).call(r,t.track)&&this.removeTrack(t)})})}function hW(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function hH(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);let r=(e=[...e]).length>0;r&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let i=t.apply(this,arguments);if(r){let{sender:t}=i,r=t.getParameters();"encodings"in r&&(1!==r.encodings.length||0!==Object.keys(r.encodings[0]).length)||(r.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(r).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function hY(e){if("object"!=typeof e||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function hK(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dJ.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function hQ(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dJ.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var hz=Object.freeze({__proto__:null,shimAddTransceiver:hH,shimCreateAnswer:hQ,shimCreateOffer:hK,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,dJ.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:hY,shimGetUserMedia:hU,shimOnTrack:hB,shimPeerConnection:hV,shimRTCDataChannel:hW,shimReceiverGetStats:hj,shimRemoveStream:hG,shimSenderGetStats:hF});function hX(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r;this._localStreams||(this._localStreams=[]),o0(r=this._localStreams).call(r,e)||this._localStreams.push(e),e.getAudioTracks().forEach(r=>t.call(this,r,e)),e.getVideoTracks().forEach(r=>t.call(this,r,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return i&&i.forEach(e=>{var t;this._localStreams?o0(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let r=e.getTracks();this.getSenders().forEach(e=>{o0(r).call(r,e.track)&&this.removeTrack(e)})})}}function hJ(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),o0(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);let r=new Event("addstream");r.stream=e,this.dispatchEvent(r)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let r=new Event("addstream");r.stream=t,e.dispatchEvent(r)})}),t.apply(e,arguments)}}}function hq(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){let i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),dJ.resolve()):n},t.createAnswer=function(e,t){let r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),dJ.resolve()):n};let s=function(e,t,r){let i=n.apply(this,[e]);return r?(i.then(t,r),dJ.resolve()):i};t.setLocalDescription=s,s=function(e,t,r){let i=o.apply(this,[e]);return r?(i.then(t,r),dJ.resolve()):i},t.setRemoteDescription=s,s=function(e,t,r){let i=a.apply(this,[e]);return r?(i.then(t,r),dJ.resolve()):i},t.addIceCandidate=s}function hZ(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(h$(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}).bind(t))}function h$(e){return e&&void 0!==e.video?Object.assign({},e,{video:function e(t){var r;return hy(t)?ae(r=Object.keys(t)).call(r,function(r,i){let n=hy(t[i]),o=n?e(t[i]):t[i],a=n&&!Object.keys(o).length;return void 0===o||a?r:Object.assign(r,{[i]:o})},{}):t}(e.video)}):e}function h0(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){let t=[];for(let r=0;r<e.iceServers.length;r++){let i=e.iceServers[r];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(hT("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function h2(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function h1(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let r=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function h4(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var h6=Object.freeze({__proto__:null,shimAudioContext:h4,shimCallbacksAPI:hq,shimConstraints:h$,shimCreateOfferLegacy:h1,shimGetUserMedia:hZ,shimLocalStreamsAPI:hX,shimRTCIceServerUrls:h0,shimRemoteStreamsAPI:hJ,shimTrackEventTransceiver:h2}),h3="	\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF",h8=iH("".replace),h5=RegExp("^["+h3+"]+"),h9=RegExp("(^|[^"+h3+"])["+h3+"]+$"),h7=function(e){return function(t){var r=oQ(nh(t));return 1&e&&(r=h8(r,h5,"")),2&e&&(r=h8(r,h9,"$1")),r}},pe={start:h7(1),end:h7(2),trim:h7(3)},pt=sT.PROPER,pr=pe.trim;oS({target:"String",proto:!0,forced:(c="trim",iV(function(){return!!h3[c]()||"\u200B\x85\u180E"!=="\u200B\x85\u180E"[c]()||pt&&h3[c].name!==c}))},{trim:function(){return pr(this)}});var pi=oM("String").trim,pn=String.prototype,po=iB(function(e){var t=e.trim;return"string"==typeof e||e===pn||iY(pn,e)&&t===pn.trim?pi:t}),pa={exports:{}};!function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){let r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){let r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter(e=>0===e.indexOf(r))},t.parseCandidate=function(e){let t;let r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1],10);break;case"tcptype":r.tcpType=t[e+1];break;case"ufrag":r.ufrag=t[e+1],r.usernameFragment=t[e+1];break;default:void 0===r[t[e]]&&(r[t[e]]=t[e+1])}return r},t.writeCandidate=function(e){let t=[];t.push(e.foundation);let r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){let t;let r={},i=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)r[(t=i[e].trim().split("="))[0].trim()]=t[1];return r},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){let t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substring(t+1,i),r.value=e.substring(i+1)):r.attribute=e.substring(t+1),r},t.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){let r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},t.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){let i=t.matchPrefix(e+r,"a=ice-ufrag:")[0],n=t.matchPrefix(e+r,"a=ice-pwd:")[0];return i&&n?{usernameFragment:i.substring(12),password:n.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){let r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");r.profile=i[2];for(let n=3;n<i.length;n++){let o=i[n],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){let i=t.parseRtpMap(a),n=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(i.parameters=n.length?t.parseFmtp(n[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),r.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{r.headerExtensions.push(t.parseExtmap(e))});let n=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(e=>{n.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),r},t.writeRtpDescription=function(e,r){let i="";i+="m="+e+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let n=0;return r.codecs.forEach(e=>{e.maxptime>n&&(n=e.maxptime)}),n>0&&(i+="a=maxptime:"+n+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){let r;let i=[],n=t.parseRtpParameters(e),o=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),c=s.length>0&&s[0].ssrc,d=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(r=d[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&r&&(t.rtx={ssrc:r}),i.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},i.push(t))}}),0===i.length&&c&&i.push({ssrc:c});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,i.forEach(e=>{e.maxBitrate=u})),i},t.parseRtcpParameters=function(e){let r={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);let n=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=n.length>0,r.compound=0===n.length;let o=t.matchPrefix(e,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;let i=t.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(r=i[0].substring(7).split(" "))[0],track:r[1]};let n=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return n.length>0?{stream:(r=n[0].value.split(" "))[0],track:r[1]}:void 0},t.parseSctpDescription=function(e){let r;let i=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");n.length>0&&(r=parseInt(n[0].substring(19),10)),isNaN(r)&&(r=65536);let o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};let a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){let e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,r,i){return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+(void 0!==r?r:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){let i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){let r=t.splitLines(e)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){let r=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let r=t.splitLines(e);for(let e=0;e<r.length;e++)if(r[e].length<2||"="!==r[e].charAt(1))return!1;return!0},e.exports=t}(pa);var ps=pa.exports,pc=iB(ps),pd=(d={__proto__:null,default:pc},[ps].forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(t){if("default"!==t&&!(t in d)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(d,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}})}),Object.freeze(d));function pu(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){let r=new t(e),i=Object.assign(r,pc.parseCandidate(e.candidate));return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,hE(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function pl(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||hE(e,"icecandidate",e=>{if(e.candidate){let t=pc.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[t.priority>>24])}return e})}function ph(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let r=function(e){if(!e||!e.sdp)return!1;let t=pc.splitSections(e.sdp);return t.shift(),t.some(e=>{let t=pc.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},i=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return -1;let r=parseInt(t[1],10);return r!=r?-1:r},n=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:0x7ffffff5:t.version<60?57===t.version?65535:65536:0x7ffffff5),r},o=function(e,r){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);let n=pc.matchPrefix(e.sdp,"a=max-message-size:");return n.length>0?i=parseInt(n[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=0x7ffffff5),i},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let e;let t=i(arguments[0]),r=n(t),a=o(arguments[0],t);e=0===r&&0===a?Number.POSITIVE_INFINITY:0===r||0===a?Math.max(r,a):Math.min(r,a);let s={};Object.defineProperty(s,"maxMessageSize",{get:()=>e}),this._sctp=s}return a.apply(this,arguments)}}function pp(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let r=e.send;e.send=function(){let i=arguments[0],n=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=r.apply(this,arguments);return t(e,this),e},hE(e,"datachannel",e=>(t(e.channel,e.target),e))}function pf(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{let r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function p_(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let r=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==po(e).call(e)).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function pA(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?dJ.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),dJ.resolve())})}function pm(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(!(e={type:e.type,sdp:e.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?r.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>r.apply(this,[e]))})}var pv=Object.freeze({__proto__:null,removeExtmapAllowMixed:p_,shimAddIceCandidateNullOrEmpty:pA,shimConnectionState:pf,shimMaxMessageSize:ph,shimParameterlessSetLocalDescription:pm,shimRTCIceCandidate:pu,shimRTCIceCandidateRelayProtocol:pl,shimSendThrowTypeError:pp});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;let{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=hv(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=hv(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=hv(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:pv,extractVersion:hv,disableLog:hg,disableWarnings:hS,sdp:pd};switch(r.browser){case"chrome":if(!hx||!hL||!t.shimChrome)return hb("Chrome shim is not included in this adapter release.");if(null===r.version)return hb("Chrome shim can not determine version, not shimming.");hb("adapter.js shimming chrome."),i.browserShim=hx,pA(e,r),pm(e),hI(e,r),hC(e),hL(e,r),hk(e),hD(e,r),hw(e),hO(e),hN(e),hM(e,r),pu(e),pl(e),pf(e),ph(e,r),pp(e),p_(e,r);break;case"firefox":if(!hz||!hV||!t.shimFirefox)return hb("Firefox shim is not included in this adapter release.");hb("adapter.js shimming firefox."),i.browserShim=hz,pA(e,r),pm(e),hU(e,r),hV(e,r),hB(e),hG(e),hF(e),hj(e),hW(e),hH(e),hY(e),hK(e),hQ(e),pu(e),pf(e),ph(e,r),pp(e);break;case"safari":if(!h6||!t.shimSafari)return hb("Safari shim is not included in this adapter release.");hb("adapter.js shimming safari."),i.browserShim=h6,pA(e,r),pm(e),h0(e),h1(e),hq(e),hX(e),hJ(e),h2(e),hZ(e),h4(e),pu(e),pl(e),ph(e,r),pp(e),p_(e,r);break;default:hb("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var pE=TypeError,pg=nE.match(/firefox\/(\d+)/i),pS=!!pg&&+pg[1],pb=/MSIE|Trident/.test(nE),pT=nE.match(/AppleWebKit\/(\d+)\./),py=!!pT&&+pT[1],pR=function(e,t){if(!delete e[t])throw pE("Cannot delete property "+nN(t)+" of "+nN(e))},pI=[],pC=iH(pI.sort),pk=iH(pI.push),pw=iV(function(){pI.sort(void 0)}),pO=iV(function(){pI.sort(null)}),pN=o6("sort"),pP=!iV(function(){if(ny)return ny<70;if(!(pS&&pS>3)){if(pb)return!0;if(py)return py<603;var e,t,r,i,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)pI.push({k:t+i,v:r})}for(pI.sort(function(e,t){return t.v-e.v}),i=0;i<pI.length;i++)t=pI[i].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n}});oS({target:"Array",proto:!0,forced:pw||!pO||!pN||!pP},{sort:function(e){void 0!==e&&nD(e);var t,r=nG(this);if(pP)return void 0===e?pC(r):pC(r,e);var i,n,o=[],a=oN(r);for(n=0;n<a;n++)n in r&&pk(o,r[n]);for(d9(o,(t=e,function(e,r){return void 0===r?-1:void 0===e?1:void 0!==t?+t(e,r)||0:oQ(e)>oQ(r)?1:-1})),i=oN(o),n=0;n<i;)r[n]=o[n++];for(;n<a;)pR(r,n++);return r}});var pD=oM("Array").sort,pL=Array.prototype,pM=iB(function(e){var t=e.sort;return e===pL||iY(pL,e)&&t===pL.sort?pD:t});oS({global:!0,forced:iQ.globalThis!==iQ},{globalThis:iQ});var px=iB(iQ),pU={exports:{}};u=pU,l=pU.exports,function(e,t){var r="function",i="undefined",n="object",o="string",a="major",s="model",c="name",d="type",h="vendor",p="version",f="architecture",_="console",A="mobile",m="tablet",v="smarttv",E="wearable",g="embedded",S="Amazon",b="Apple",T="ASUS",y="BlackBerry",R="Browser",I="Chrome",C="Firefox",k="Google",w="Huawei",O="Microsoft",N="Motorola",P="Opera",D="Samsung",L="Sharp",M="Sony",x="Xiaomi",U="Zebra",B="Facebook",V="Chromium OS",F="Mac OS",j=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},G=function(e,t){return typeof e===o&&-1!==W(t).indexOf(W(e))},W=function(e){return e.toLowerCase()},H=function(e,t){if(typeof e===o)return e=e.replace(/^\s\s*/,""),typeof t===i?e:e.substring(0,350)},Y=function(e,i){for(var o,a,s,c,d,u,l=0;l<i.length&&!d;){var h=i[l],p=i[l+1];for(o=a=0;o<h.length&&!d&&h[o];)if(d=h[o++].exec(e))for(s=0;s<p.length;s++)u=d[++a],typeof(c=p[s])===n&&c.length>0?2===c.length?typeof c[1]==r?this[c[0]]=c[1].call(this,u):this[c[0]]=c[1]:3===c.length?typeof c[1]!==r||c[1].exec&&c[1].test?this[c[0]]=u?u.replace(c[1],c[2]):void 0:this[c[0]]=u?c[1].call(this,u,c[2]):t:4===c.length&&(this[c[0]]=u?c[3].call(this,u.replace(c[1],c[2])):t):this[c]=u||t;l+=2}},K=function(e,r){for(var i in r)if(typeof r[i]===n&&r[i].length>0){for(var o=0;o<r[i].length;o++)if(G(r[i][o],e))return"?"===i?t:i}else if(G(r[i],e))return"?"===i?t:i;return e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,p],[/opios[\/ ]+([\w\.]+)/i],[p,[c,P+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[c,P]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[c,"UC"+R]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[c,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+R],p],[/\bfocus\/([\w\.]+)/i],[p,[c,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[c,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[c,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[c,"MIUI "+R]],[/fxios\/([-\w\.]+)/i],[p,[c,C]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+R]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+R],p],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,B],p],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[c,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[c,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,I+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[c,"Android "+R]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[p,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[c,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,p],[/(cobalt)\/([\w\.]+)/i],[c,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,W]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",W]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,W]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[h,D],[d,m]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[h,D],[d,A]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[h,b],[d,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[h,b],[d,m]],[/(macintosh);/i],[s,[h,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[h,L],[d,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[h,w],[d,m]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[s,[h,w],[d,A]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[h,x],[d,A]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[h,x],[d,m]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[h,"OPPO"],[d,A]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[h,"Vivo"],[d,A]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[h,"Realme"],[d,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[h,N],[d,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[h,N],[d,m]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[h,"LG"],[d,m]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[h,"LG"],[d,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[h,"Lenovo"],[d,m]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[h,"Nokia"],[d,A]],[/(pixel c)\b/i],[s,[h,k],[d,m]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[h,k],[d,A]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[h,M],[d,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[h,M],[d,m]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[h,"OnePlus"],[d,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[h,S],[d,m]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[h,S],[d,A]],[/(playbook);[-\w\),; ]+(rim)/i],[s,h,[d,m]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[h,y],[d,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[h,T],[d,m]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[h,T],[d,A]],[/(nexus 9)/i],[s,[h,"HTC"],[d,m]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[s,/_/g," "],[d,A]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[h,"Acer"],[d,m]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[h,"Meizu"],[d,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,s,[d,A]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,s,[d,m]],[/(surface duo)/i],[s,[h,O],[d,m]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[h,"Fairphone"],[d,A]],[/(u304aa)/i],[s,[h,"AT&T"],[d,A]],[/\bsie-(\w*)/i],[s,[h,"Siemens"],[d,A]],[/\b(rct\w+) b/i],[s,[h,"RCA"],[d,m]],[/\b(venue[\d ]{2,7}) b/i],[s,[h,"Dell"],[d,m]],[/\b(q(?:mv|ta)\w+) b/i],[s,[h,"Verizon"],[d,m]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[h,"Barnes & Noble"],[d,m]],[/\b(tm\d{3}\w+) b/i],[s,[h,"NuVision"],[d,m]],[/\b(k88) b/i],[s,[h,"ZTE"],[d,m]],[/\b(nx\d{3}j) b/i],[s,[h,"ZTE"],[d,A]],[/\b(gen\d{3}) b.+49h/i],[s,[h,"Swiss"],[d,A]],[/\b(zur\d{3}) b/i],[s,[h,"Swiss"],[d,m]],[/\b((zeki)?tb.*\b) b/i],[s,[h,"Zeki"],[d,m]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],s,[d,m]],[/\b(ns-?\w{0,9}) b/i],[s,[h,"Insignia"],[d,m]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[h,"NextBook"],[d,m]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],s,[d,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],s,[d,A]],[/\b(ph-1) /i],[s,[h,"Essential"],[d,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[h,"Envizen"],[d,m]],[/\b(trio[-\w\. ]+) b/i],[s,[h,"MachSpeed"],[d,m]],[/\btu_(1491) b/i],[s,[h,"Rotor"],[d,m]],[/(shield[\w ]+) b/i],[s,[h,"Nvidia"],[d,m]],[/(sprint) (\w+)/i],[h,s,[d,A]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[h,O],[d,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[h,U],[d,m]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[h,U],[d,A]],[/smart-tv.+(samsung)/i],[h,[d,v]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[h,D],[d,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,"LG"],[d,v]],[/(apple) ?tv/i],[h,[s,b+" TV"],[d,v]],[/crkey/i],[[s,I+"cast"],[h,k],[d,v]],[/droid.+aft(\w)( bui|\))/i],[s,[h,S],[d,v]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[s,[h,L],[d,v]],[/(bravia[\w ]+)( bui|\))/i],[s,[h,M],[d,v]],[/(mitv-\w{5}) bui/i],[s,[h,x],[d,v]],[/Hbbtv.*(technisat) (.*);/i],[h,s,[d,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,H],[s,H],[d,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,s,[d,_]],[/droid.+; (shield) bui/i],[s,[h,"Nvidia"],[d,_]],[/(playstation [345portablevi]+)/i],[s,[h,M],[d,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[h,O],[d,_]],[/((pebble))app/i],[h,s,[d,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[s,[h,b],[d,E]],[/droid.+; (glass) \d/i],[s,[h,k],[d,E]],[/droid.+; (wt63?0{2,3})\)/i],[s,[h,U],[d,E]],[/(quest( 2| pro)?)/i],[s,[h,B],[d,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[d,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[d,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[d,m]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,m]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,A]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[p,K,Q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[p,K,Q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,F],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,p],[/\(bb(10);/i],[p,[c,y]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[c,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[c,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,V],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,p],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c,p]]},X=function(u,l){if(typeof u===n&&(l=u,u=t),!(this instanceof X))return new X(u,l).getResult();var _=typeof e!==i&&e.navigator?e.navigator:t,v=u||(_&&_.userAgent?_.userAgent:""),E=_&&_.userAgentData?_.userAgentData:t,g=l?function(e,t){var r={};for(var i in e)t[i]&&t[i].length%2==0?r[i]=t[i].concat(e[i]):r[i]=e[i];return r}(z,l):z;return this.getBrowser=function(){var e,i={};return i[c]=t,i[p]=t,Y.call(i,v,g.browser),i[a]=typeof(e=i[p])===o?e.replace(/[^\d\.]/g,"").split(".")[0]:t,_&&_.brave&&typeof _.brave.isBrave==r&&(i[c]="Brave"),i},this.getCPU=function(){var e={};return e[f]=t,Y.call(e,v,g.cpu),e},this.getDevice=function(){var e={};return e[h]=t,e[s]=t,e[d]=t,Y.call(e,v,g.device),!e[d]&&E&&E.mobile&&(e[d]=A),"Macintosh"==e[s]&&_&&typeof _.standalone!==i&&_.maxTouchPoints&&_.maxTouchPoints>2&&(e[s]="iPad",e[d]=m),e},this.getEngine=function(){var e={};return e[c]=t,e[p]=t,Y.call(e,v,g.engine),e},this.getOS=function(){var e={};return e[c]=t,e[p]=t,Y.call(e,v,g.os),!e[c]&&E&&"Unknown"!=E.platform&&(e[c]=E.platform.replace(/chrome os/i,V).replace(/macos/i,F)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(e){return v=typeof e===o&&e.length>350?H(e,350):e,this},this.setUA(v),this};X.VERSION="0.7.34",X.BROWSER=j([c,p,a]),X.CPU=j([f]),X.DEVICE=j([s,h,d,_,A,v,m,E,g]),X.ENGINE=X.OS=j([c,p]),u.exports&&(l=u.exports=X),l.UAParser=X;var J=typeof e!==i&&(e.jQuery||e.Zepto);if(J&&!J.ua){var q=new X;J.ua=q.getResult(),J.ua.get=function(){return q.getUA()},J.ua.set=function(e){q.setUA(e);var t=q.getResult();for(var r in t)J.ua[r]=t[r]}}}("object"==typeof window?window:iU);var pB=iB(pU.exports),pV=nZ("iterator"),pF=Object,pj=iB(function(e){if(nu(e))return!1;var t=pF(e);return void 0!==t[pV]||"@@iterator"in t||nH(aJ,oY(t))}),pG=cR;oS({global:!0,bind:!0,enumerable:!0,forced:iQ.clearImmediate!==pG},{clearImmediate:pG});var pW="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,pH=iQ.Function,pY=/MSIE .\./.test(nE)||pW&&((h=iQ.Bun.version.split(".")).length<3||0==h[0]&&(h[1]<3||3==h[1]&&0==h[2])),pK=cy,pQ=iQ.setImmediate?(p=pK,_=(f=!1,1),pY?function(e,t){var r=cc(arguments.length,1)>_,i=i3(e)?e:pH(e),n=r?ca(arguments,_):[],o=r?function(){iq(i,this,n)}:i;return f?p(o,t):p(o)}:p):pK;oS({global:!0,bind:!0,enumerable:!0,forced:iQ.setImmediate!==pQ},{setImmediate:pQ});var pz=iB(nA.setImmediate),pX=iQ.process;oS({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){cc(arguments.length,1),nD(e);var t=o3&&pX.domain;cH(t?t.bind(e):e)}});var pJ=iB(nA.queueMicrotask);function pq(e,t){return function(){return e.apply(t,arguments)}}let{toString:pZ}=Object.prototype,{getPrototypeOf:p$}=Object,p0=(tc=Object.create(null),e=>{let t=pZ.call(e);return tc[t]||(tc[t]=t.slice(8,-1).toLowerCase())}),p2=e=>(e=e.toLowerCase(),t=>p0(t)===e),p1=e=>t=>typeof t===e,{isArray:p4}=Array,p6=p1("undefined"),p3=p2("ArrayBuffer"),p8=p1("string"),p5=p1("function"),p9=p1("number"),p7=e=>null!==e&&"object"==typeof e,fe=e=>{if("object"!==p0(e))return!1;let t=p$(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||pj(e))},ft=p2("Date"),fr=p2("File"),fi=p2("Blob"),fn=p2("FileList"),fo=p2("URLSearchParams"),[fa,fs,fc,fd]=["ReadableStream","Request","Response","Headers"].map(p2);function fu(e,t){let r,i,{allOwnKeys:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e){if("object"!=typeof e&&(e=[e]),p4(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{let i;let o=n?Object.getOwnPropertyNames(e):Object.keys(e),a=o.length;for(r=0;r<a;r++)i=o[r],t.call(null,e[i],i,e)}}}function fl(e,t){t=t.toLowerCase();let r=Object.keys(e),i,n=r.length;for(;n-- >0;)if(t===(i=r[n]).toLowerCase())return i;return null}let fh=void 0!==px?px:"undefined"!=typeof self?self:"undefined"!=typeof window?window:r.g,fp=e=>!p6(e)&&e!==fh,ff=(td="undefined"!=typeof Uint8Array&&p$(Uint8Array),e=>td&&e instanceof td),f_=p2("HTMLFormElement"),fA=(e=>{let{hasOwnProperty:t}=e;return(e,r)=>t.call(e,r)})(Object.prototype),fm=p2("RegExp"),fv=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),i={};fu(r,(r,n)=>{let o;!1!==(o=t(r,n,e))&&(i[n]=o||r)}),Object.defineProperties(e,i)},fE=p2("AsyncFunction"),fg=(tu="function"==typeof pz,tl=p5(fh.postMessage),tu?pz:tl?(th="axios@".concat(Math.random()),tp=[],fh.addEventListener("message",e=>{let{source:t,data:r}=e;t===fh&&r===th&&tp.length&&tp.shift()()},!1),e=>{tp.push(e),fh.postMessage(th,"*")}):e=>setTimeout(e)),fS=void 0!==pJ?pJ.bind(fh):"undefined"!=typeof process&&process.nextTick||fg;var fb={isArray:p4,isArrayBuffer:p3,isBuffer:function(e){return null!==e&&!p6(e)&&null!==e.constructor&&!p6(e.constructor)&&p5(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||p5(e.append)&&("formdata"===(t=p0(e))||"object"===t&&p5(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&p3(e.buffer)},isString:p8,isNumber:p9,isBoolean:e=>!0===e||!1===e,isObject:p7,isPlainObject:fe,isReadableStream:fa,isRequest:fs,isResponse:fc,isHeaders:fd,isUndefined:p6,isDate:ft,isFile:fr,isBlob:fi,isRegExp:fm,isFunction:p5,isStream:e=>p7(e)&&p5(e.pipe),isURLSearchParams:fo,isTypedArray:ff,isFileList:fn,forEach:fu,merge:function e(){let{caseless:t}=fp(this)&&this||{},r={},i=(i,n)=>{let o=t&&fl(r,n)||n;fe(r[o])&&fe(i)?r[o]=e(r[o],i):fe(i)?r[o]=e({},i):p4(i)?r[o]=i.slice():r[o]=i};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&fu(arguments[e],i);return r},extend:function(e,t,r){let{allOwnKeys:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return fu(t,(t,i)=>{r&&p5(t)?e[i]=pq(t,r):e[i]=t},{allOwnKeys:i}),e},trim:e=>po(e)?po(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,i)=>{let n,o,a;let s={};if(t=t||{},null==e)return t;do{for(o=(n=Object.getOwnPropertyNames(e)).length;o-- >0;)a=n[o],i&&!i(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==r&&p$(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:p0,kindOfTest:p2,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;let i=e.indexOf(t,r);return -1!==i&&i===r},toArray:e=>{if(!e)return null;if(p4(e))return e;let t=e.length;if(!p9(t))return null;let r=Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{let r;let i=(e&&e[Symbol.iterator]).call(e);for(;(r=i.next())&&!r.done;){let i=r.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let r;let i=[];for(;null!==(r=e.exec(t));)i.push(r);return i},isHTMLForm:f_,hasOwnProperty:fA,hasOwnProp:fA,reduceDescriptors:fv,freezeMethods:e=>{fv(e,(t,r)=>{if(p5(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;p5(e[r])&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{let r={},i=e=>{e.forEach(e=>{r[e]=!0})};return i(p4(e)?e:String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:fl,global:fh,isContextDefined:fp,isSpecCompliantForm:function(e){return!!(e&&p5(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{let t=Array(10),r=(e,i)=>{if(p7(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[i]=e;let n=p4(e)?[]:{};return fu(e,(e,t)=>{let o=r(e,i+1);p6(o)||(n[t]=o)}),t[i]=void 0,n}}return e};return r(e,0)},isAsyncFn:fE,isThenable:e=>e&&(p7(e)||p5(e))&&p5(e.then)&&p5(e.catch),setImmediate:fg,asap:fS};function fT(e,t,r,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),n&&(this.response=n,this.status=n.status?n.status:null)}fb.inherits(fT,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:fb.toJSONObject(this.config),code:this.code,status:this.status}}});let fy=fT.prototype,fR={};function fI(e){return fb.isPlainObject(e)||fb.isArray(e)}function fC(e){return fb.endsWith(e,"[]")?e.slice(0,-2):e}function fk(e,t,r){return e?e.concat(t).map(function(e,t){return e=fC(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{fR[e]={value:e}}),Object.defineProperties(fT,fR),Object.defineProperty(fy,"isAxiosError",{value:!0}),fT.from=(e,t,r,i,n,o)=>{let a=Object.create(fy);return fb.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),fT.call(a,e.message,t,r,i,n),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};let fw=fb.toFlatObject(fb,{},null,function(e){return/^is[A-Z]/.test(e)});function fO(e,t,r){if(!fb.isObject(e))throw TypeError("target must be an object");t=t||new FormData;let i=(r=fb.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!fb.isUndefined(t[e])})).metaTokens,n=r.visitor||u,a=r.dots,s=r.indexes,c=(r.Blob||"undefined"!=typeof Blob&&Blob)&&fb.isSpecCompliantForm(t);if(!fb.isFunction(n))throw TypeError("visitor must be a function");function d(e){if(null===e)return"";if(fb.isDate(e))return e.toISOString();if(!c&&fb.isBlob(e))throw new fT("Blob is not supported. Use a Buffer instead.");return fb.isArrayBuffer(e)||fb.isTypedArray(e)?c&&"function"==typeof Blob?new Blob([e]):o.from(e):e}function u(e,r,n){let o=e;if(e&&!n&&"object"==typeof e){if(fb.endsWith(r,"{}"))r=i?r:r.slice(0,-2),e=JSON.stringify(e);else{var c;if(fb.isArray(e)&&(c=e,fb.isArray(c)&&!c.some(fI))||(fb.isFileList(e)||fb.endsWith(r,"[]"))&&(o=fb.toArray(e)))return r=fC(r),o.forEach(function(e,i){fb.isUndefined(e)||null===e||t.append(!0===s?fk([r],i,a):null===s?r:r+"[]",d(e))}),!1}}return!!fI(e)||(t.append(fk(n,r,a),d(e)),!1)}let l=[],h=Object.assign(fw,{defaultVisitor:u,convertValue:d,isVisitable:fI});if(!fb.isObject(e))throw TypeError("data must be an object");return function e(r,i){if(!fb.isUndefined(r)){if(-1!==l.indexOf(r))throw Error("Circular reference detected in "+i.join("."));l.push(r),fb.forEach(r,function(r,o){!0===(!(fb.isUndefined(r)||null===r)&&n.call(t,r,fb.isString(o)?po(o).call(o):o,i,h))&&e(r,i?i.concat(o):[o])}),l.pop()}}(e),t}function fN(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function fP(e,t){this._pairs=[],e&&fO(e,this,t)}let fD=fP.prototype;function fL(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function fM(e,t,r){let i;if(!t)return e;let n=r&&r.encode||fL;fb.isFunction(r)&&(r={serialize:r});let o=r&&r.serialize;if(i=o?o(t,r):fb.isURLSearchParams(t)?t.toString():new fP(t,r).toString(n)){let t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}fD.append=function(e,t){this._pairs.push([e,t])},fD.toString=function(e){let t=e?function(t){return e.call(this,t,fN)}:fN;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};var fx=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){fb.forEach(this.handlers,function(t){null!==t&&e(t)})}},fU={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fB={exports:{}},fV=os.f;oS({target:"Object",stat:!0,forced:Object.defineProperty!==fV,sham:!i5},{defineProperty:fV});var fF=nA.Object,fj=fB.exports=function(e,t,r){return fF.defineProperty(e,t,r)};fF.defineProperty.sham&&(fj.sham=!0);var fG=iB(fB.exports),fW=TypeError,fH=nZ("species"),fY=Array,fK=function(e){var t;return at(e)&&(ct(t=e.constructor)&&(t===fY||at(t.prototype))||n_(t)&&null===(t=t[fH]))&&(t=void 0),void 0===t?fY:t},fQ=function(e,t){return new(fK(e))(0===t?0:t)},fz=nZ("species"),fX=function(e){return ny>=51||!iV(function(){var t=[];return(t.constructor={})[fz]=function(){return{foo:1}},1!==t[e](Boolean).foo})},fJ=function(e){if(e>0x1fffffffffffff)throw fW("Maximum allowed index exceeded");return e},fq=nZ("isConcatSpreadable"),fZ=ny>=51||!iV(function(){var e=[];return e[fq]=!1,e.concat()[0]!==e}),f$=function(e){if(!n_(e))return!1;var t=e[fq];return void 0!==t?!!t:at(e)};oS({target:"Array",proto:!0,arity:1,forced:!fZ||!fX("concat")},{concat:function(e){var t,r,i,n,o,a=nG(this),s=fQ(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(f$(o=-1===t?a:arguments[t]))for(fJ(c+(n=oN(o))),r=0;r<n;r++,c++)r in o&&d4(s,c,o[r]);else fJ(c+1),d4(s,c++,o);return s.length=c,s}});var f0={},f2=ag.f,f1="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];f0.f=function(e){return f1&&"Window"==i0(e)?function(e){try{return f2(e)}catch(e){return d8(f1)}}(e):f2(np(e))};var f4={};f4.f=nZ;var f6=os.f,f3=function(e){var t=nA.Symbol||(nA.Symbol={});nH(t,e)||f6(t,e,{value:f4.f(e)})},f8=function(){var e=nv("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,i=nZ("toPrimitive");t&&!t[i]&&sy(t,i,function(e){return i7(r,this)},{arity:1})},f5=iH([].push),f9=function(e){var t=1==e,r=2==e,i=3==e,n=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,d,u,l){for(var h,p,f=nG(c),_=nd(f),A=oa(d,u),m=oN(_),v=0,E=l||fQ,g=t?E(c,m):r||a?E(c,0):void 0;m>v;v++)if((s||v in _)&&(p=A(h=_[v],v,f),e)){if(t)g[v]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:f5(g,h)}else switch(e){case 4:return!1;case 7:f5(g,h)}}return o?-1:i||n?n:g}},f7={forEach:f9(0),map:f9(1),filter:f9(2),some:f9(3),every:f9(4),find:f9(5),findIndex:f9(6),filterReject:f9(7)},_e=f7.forEach,_t=ad("hidden"),_r="Symbol",_i="prototype",_n=sE.set,_o=sE.getterFor(_r),_a=Object[_i],_s=iQ.Symbol,_c=_s&&_s[_i],_d=iQ.TypeError,_u=iQ.QObject,_l=i8.f,_h=os.f,_p=f0.f,_f=ne.f,__=iH([].push),_A=nF("symbols"),_m=nF("op-symbols"),_v=nF("wks"),_E=!_u||!_u[_i]||!_u[_i].findChild,_g=i5&&iV(function(){return 7!=aj(_h({},"a",{get:function(){return _h(this,"a",{value:7}).a}})).a})?function(e,t,r){var i=_l(_a,t);i&&delete _a[t],_h(e,t,r),i&&e!==_a&&_h(_a,t,i)}:_h,_S=function(e,t){var r=_A[e]=aj(_c);return _n(r,{type:_r,tag:e,description:t}),i5||(r.description=t),r},_b=function(e,t,r){e===_a&&_b(_m,t,r),ol(e);var i=n4(t);return ol(r),nH(_A,i)?(r.enumerable?(nH(e,_t)&&e[_t][i]&&(e[_t][i]=!1),r=aj(r,{enumerable:na(0,!1)})):(nH(e,_t)||_h(e,_t,na(1,{})),e[_t][i]=!0),_g(e,i,r)):_h(e,i,r)},_T=function(e,t){ol(e);var r=np(t);return _e(aN(r).concat(_C(r)),function(t){i5&&!i7(_y,r,t)||_b(e,t,r[t])}),e},_y=function(e){var t=n4(e),r=i7(_f,this,t);return!(this===_a&&nH(_A,t)&&!nH(_m,t))&&(!(r||!nH(this,t)||!nH(_A,t)||nH(this,_t)&&this[_t][t])||r)},_R=function(e,t){var r=np(e),i=n4(t);if(r!==_a||!nH(_A,i)||nH(_m,i)){var n=_l(r,i);return!n||!nH(_A,i)||nH(r,_t)&&r[_t][i]||(n.enumerable=!0),n}},_I=function(e){var t=_p(np(e)),r=[];return _e(t,function(e){nH(_A,e)||nH(aS,e)||__(r,e)}),r},_C=function(e){var t=e===_a,r=_p(t?_m:np(e)),i=[];return _e(r,function(e){nH(_A,e)&&(!t||nH(_a,e))&&__(i,_A[e])}),i};nI||(sy(_c=(_s=function(){if(iY(_c,this))throw _d("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?oQ(arguments[0]):void 0,t=nz(e),r=function(e){this===_a&&i7(r,_m,e),nH(this,_t)&&nH(this[_t],t)&&(this[_t][t]=!1),_g(this,t,na(1,e))};return i5&&_E&&_g(_a,t,{configurable:!0,set:r}),_S(t,e)})[_i],"toString",function(){return _o(this).tag}),sy(_s,"withoutSetter",function(e){return _S(nz(e),e)}),ne.f=_y,os.f=_b,aO.f=_T,i8.f=_R,ag.f=f0.f=_I,aC.f=_C,f4.f=function(e){return _S(nZ(e),e)},i5&&sQ(_c,"description",{configurable:!0,get:function(){return _o(this).description}})),oS({global:!0,constructor:!0,wrap:!0,forced:!nI,sham:!nI},{Symbol:_s}),_e(aN(_v),function(e){f3(e)}),oS({target:_r,stat:!0,forced:!nI},{useSetter:function(){_E=!0},useSimple:function(){_E=!1}}),oS({target:"Object",stat:!0,forced:!nI,sham:!i5},{create:function(e,t){return void 0===t?aj(e):_T(aj(e),t)},defineProperty:_b,defineProperties:_T,getOwnPropertyDescriptor:_R}),oS({target:"Object",stat:!0,forced:!nI},{getOwnPropertyNames:_I}),f8(),sN(_s,_r),aS[_t]=!0;var _k=nI&&!!Symbol.for&&!!Symbol.keyFor,_w=nF("string-to-symbol-registry"),_O=nF("symbol-to-string-registry");oS({target:"Symbol",stat:!0,forced:!_k},{for:function(e){var t=oQ(e);if(nH(_w,t))return _w[t];var r=nv("Symbol")(t);return _w[t]=r,_O[r]=t,r}});var _N=nF("symbol-to-string-registry");oS({target:"Symbol",stat:!0,forced:!_k},{keyFor:function(e){if(!nw(e))throw TypeError(nN(e)+" is not a symbol");if(nH(_N,e))return _N[e]}});var _P=iH([].push),_D=function(e){if(i3(e))return e;if(at(e)){for(var t=e.length,r=[],i=0;i<t;i++){var n=e[i];"string"==typeof n?_P(r,n):"number"!=typeof n&&"Number"!=i0(n)&&"String"!=i0(n)||_P(r,oQ(n))}var o=r.length,a=!0;return function(e,t){if(a)return a=!1,t;if(at(this))return t;for(var i=0;i<o;i++)if(r[i]===e)return t}}},_L=String,_M=nv("JSON","stringify"),_x=iH(/./.exec),_U=iH("".charAt),_B=iH("".charCodeAt),_V=iH("".replace),_F=iH(1..toString),_j=/[\uD800-\uDFFF]/g,_G=/^[\uD800-\uDBFF]$/,_W=/^[\uDC00-\uDFFF]$/,_H=!nI||iV(function(){var e=nv("Symbol")();return"[null]"!=_M([e])||"{}"!=_M({a:e})||"{}"!=_M(Object(e))}),_Y=iV(function(){return'"\udf06\ud834"'!==_M("\udf06\ud834")||'"\udead"'!==_M("\udead")}),_K=function(e,t){var r=ca(arguments),i=_D(t);if(i3(i)||void 0!==e&&!nw(e))return r[1]=function(e,t){if(i3(i)&&(t=i7(i,this,_L(e),t)),!nw(t))return t},iq(_M,null,r)},_Q=function(e,t,r){var i=_U(r,t-1),n=_U(r,t+1);return _x(_G,e)&&!_x(_W,n)||_x(_W,e)&&!_x(_G,i)?"\\u"+_F(_B(e,0),16):e};_M&&oS({target:"JSON",stat:!0,arity:3,forced:_H||_Y},{stringify:function(e,t,r){var i=ca(arguments),n=iq(_H?_K:_M,null,i);return _Y&&"string"==typeof n?_V(n,_j,_Q):n}});oS({target:"Object",stat:!0,forced:!nI||iV(function(){aC.f(1)})},{getOwnPropertySymbols:function(e){var t=aC.f;return t?t(nG(e)):[]}}),f3("asyncIterator"),f3("hasInstance"),f3("isConcatSpreadable"),f3("iterator"),f3("match"),f3("matchAll"),f3("replace"),f3("search"),f3("species"),f3("split");f3("toPrimitive"),f8();f3("toStringTag"),sN(nv("Symbol"),"Symbol"),f3("unscopables"),sN(iQ.JSON,"JSON",!0);var _z=nA.Symbol,_X=os.f,_J=nZ("metadata"),_q=Function.prototype;void 0===_q[_J]&&_X(_q,_J,{value:null}),f3("dispose"),f3("metadata");f3("asyncDispose");var _Z=nv("Symbol"),_$=_Z.keyFor,_0=iH(_Z.prototype.valueOf),_2=_Z.isRegisteredSymbol||function(e){try{return void 0!==_$(_0(e))}catch(e){return!1}};oS({target:"Symbol",stat:!0},{isRegisteredSymbol:_2});for(var _1=nv("Symbol"),_4=_1.isWellKnownSymbol,_6=nv("Object","getOwnPropertyNames"),_3=iH(_1.prototype.valueOf),_8=nF("wks"),_5=0,_9=_6(_1),_7=_9.length;_5<_7;_5++)try{var Ae=_9[_5];nw(_1[Ae])&&nZ(Ae)}catch(e){}var At=function(e){if(_4&&_4(e))return!0;try{for(var t=_3(e),r=0,i=_6(_8),n=i.length;r<n;r++)if(_8[i[r]]==t)return!0}catch(e){}return!1};oS({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:At}),f3("matcher"),f3("observable"),oS({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:_2}),oS({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:At}),f3("metadataKey"),f3("patternMatch"),f3("replaceAll");var Ar=iB(_z),Ai=iB(f4.f("iterator"));function An(e){return(An="function"==typeof Ar&&"symbol"==typeof Ai?function(e){return typeof e}:function(e){return e&&"function"==typeof Ar&&e.constructor===Ar&&e!==Ar.prototype?"symbol":typeof e})(e)}var Ao=iB(f4.f("toPrimitive"));function Aa(e,t,r){var i;return(i=function(e,t){if("object"!==An(e)||null===e)return e;var r=e[Ao];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==An(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"===An(i)?i:String(i))in e)?fG(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var As=iB(uH),Ac={isBrowser:!0,classes:{URLSearchParams:void 0!==As?As:fP,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};let Ad="undefined"!=typeof window&&"undefined"!=typeof document,Au="object"==typeof navigator&&navigator||void 0,Al=Ad&&(!Au||0>["ReactNative","NativeScript","NS"].indexOf(Au.product)),Ah="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Ap=Ad&&window.location.href||"http://localhost";function Af(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function A_(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Af(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Af(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var AA=A_(A_({},Object.freeze({__proto__:null,hasBrowserEnv:Ad,hasStandardBrowserEnv:Al,hasStandardBrowserWebWorkerEnv:Ah,navigator:Au,origin:Ap})),Ac),Am=function(){var e=ol(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Av=RegExp.prototype,AE=function(e){var t=e.flags;return void 0!==t||"flags"in Av||nH(e,"flags")||!iY(Av,e)?t:i7(Am,e)},Ag=dV.charAt,AS=/./.exec,Ab=TypeError,AT=function(e,t){var r=e.exec;if(i3(r)){var i=i7(r,e,t);return null!==i&&ol(i),i}if("RegExp"===i0(e))return i7(AS,e,t);throw Ab("RegExp#exec called on incompatible receiver")},Ay=nZ("matchAll"),AR="RegExp String",AI=AR+" Iterator",AC=sE.set,Ak=sE.getterFor(AI),Aw=TypeError,AO=i2("".indexOf),AN=i2("".matchAll),AP=!!AN&&!iV(function(){AN("a",/./)}),AD=sL(function(e,t,r,i){AC(this,{type:AI,regexp:e,string:t,global:r,unicode:i,done:!1})},AR,function(){var e,t,r=Ak(this);if(r.done)return sW(void 0,!0);var i=r.regexp,n=r.string,o=AT(i,n);return null===o?(r.done=!0,sW(void 0,!0)):(r.global?""===oQ(o[0])&&(i.lastIndex=(e=n,t=oO(i.lastIndex),t+(r.unicode?Ag(e,t).length:1))):r.done=!0,sW(o,!1))}),AL=function(e){var t,r,i,n=ol(this),o=oQ(e),a=co(n,RegExp),s=oQ(AE(n));return t=new a(a===RegExp?n.source:n,s),r=!!~AO(s,"g"),i=!!~AO(s,"u"),t.lastIndex=oO(n.lastIndex),new AD(t,o,r,i)};oS({target:"String",proto:!0,forced:AP},{matchAll:function(e){var t,r,i=nh(this);if(nu(e)){if(AP)return AN(i,e)}else{if(oB(e)&&!~AO(oQ(nh(AE(e))),"g"))throw Aw("`.matchAll` does not allow non-global regexes");if(AP)return AN(i,e);if(void 0===(r=nL(e,Ay))&&"RegExp"==i0(e)&&(r=AL),r)return i7(r,e,i)}return t=oQ(i),i7(AL,RegExp(e,"g"),t)}});var AM=oM("String").matchAll,Ax=String.prototype,AU=iB(function(e){var t=e.matchAll;return"string"==typeof e||e===Ax||iY(Ax,e)&&t===Ax.matchAll?AM:t});function AB(e){if(fb.isFormData(e)&&fb.isFunction(e.entries)){let t={};return fb.forEachEntry(e,(e,r)=>{var i;(function e(t,r,i,n){let o=t[n++];if("__proto__"===o)return!0;let a=Number.isFinite(+o),s=n>=t.length;return(o=!o&&fb.isArray(i)?i.length:o,s)?(fb.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):(i[o]&&fb.isObject(i[o])||(i[o]=[]),e(t,r,i[o],n)&&fb.isArray(i[o])&&(i[o]=function(e){let t,r;let i={},n=Object.keys(e),o=n.length;for(t=0;t<o;t++)i[r=n[t]]=e[r];return i}(i[o])),!a)})((i=e,AU(fb).call(fb,/\w+|\[(\w*)]/g,i).map(e=>"[]"===e[0]?"":e[1]||e[0])),r,t,0)}),t}return null}let AV={transitional:fU,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let r;let i=t.getContentType()||"",n=i.indexOf("application/json")>-1,o=fb.isObject(e);if(o&&fb.isHTMLForm(e)&&(e=new FormData(e)),fb.isFormData(e))return n?JSON.stringify(AB(e)):e;if(fb.isArrayBuffer(e)||fb.isBuffer(e)||fb.isStream(e)||fb.isFile(e)||fb.isBlob(e)||fb.isReadableStream(e))return e;if(fb.isArrayBufferView(e))return e.buffer;if(fb.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(o){if(i.indexOf("application/x-www-form-urlencoded")>-1){var a,s;return(a=e,s=this.formSerializer,fO(a,new AA.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,i){return AA.isNode&&fb.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},s))).toString()}if((r=fb.isFileList(e))||i.indexOf("multipart/form-data")>-1){let t=this.env&&this.env.FormData;return fO(r?{"files[]":e}:e,t&&new t,this.formSerializer)}}return o||n?(t.setContentType("application/json",!1),function(e,t,r){if(fb.isString(e))try{return(0,JSON.parse)(e),po(fb).call(fb,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){let t=this.transitional||AV.transitional,r=t&&t.forcedJSONParsing,i="json"===this.responseType;if(fb.isResponse(e)||fb.isReadableStream(e))return e;if(e&&fb.isString(e)&&(r&&!this.responseType||i)){let r=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw fT.from(e,fT.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:AA.classes.FormData,Blob:AA.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};fb.forEach(["delete","get","head","post","put","patch"],e=>{AV.headers[e]={}});let AF=fb.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Aj=Symbol("internals");function AG(e){var t;return e&&po(t=String(e)).call(t).toLowerCase()}function AW(e){return!1===e||null==e?e:fb.isArray(e)?e.map(AW):String(e)}function AH(e,t,r,i,n){return fb.isFunction(i)?i.call(this,t,r):(n&&(t=r),fb.isString(t)?fb.isString(i)?-1!==t.indexOf(i):fb.isRegExp(i)?i.test(t):void 0:void 0)}class AY{constructor(e){e&&this.set(e)}set(e,t,r){var i;let n=this;function o(e,t,r){let i=AG(t);if(!i)throw Error("header name must be a non-empty string");let o=fb.findKey(n,i);o&&void 0!==n[o]&&!0!==r&&(void 0!==r||!1===n[o])||(n[o||t]=AW(e))}let a=(e,t)=>fb.forEach(e,(e,r)=>o(e,r,t));if(fb.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(fb.isString(e)&&(e=po(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(po(i=e).call(i)))a((e=>{let t,r,i;let n={};return e&&e.split("\n").forEach(function(e){var o,a;i=e.indexOf(":"),t=po(o=e.substring(0,i)).call(o).toLowerCase(),r=po(a=e.substring(i+1)).call(a),!t||n[t]&&AF[t]||("set-cookie"===t?n[t]?n[t].push(r):n[t]=[r]:n[t]=n[t]?n[t]+", "+r:r)}),n})(e),t);else if(fb.isHeaders(e))for(let[t,i]of e.entries())o(i,t,r);else null!=e&&o(t,e,r);return this}get(e,t){if(e=AG(e)){let r=fb.findKey(this,e);if(r){let e=this[r];if(!t)return e;if(!0===t)return function(e){let t;let r=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;t=i.exec(e);)r[t[1]]=t[2];return r}(e);if(fb.isFunction(t))return t.call(this,e,r);if(fb.isRegExp(t))return t.exec(e);throw TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=AG(e)){let r=fb.findKey(this,e);return!(!r||void 0===this[r]||t&&!AH(0,this[r],r,t))}return!1}delete(e,t){let r=this,i=!1;function n(e){if(e=AG(e)){let n=fb.findKey(r,e);n&&(!t||AH(0,r[n],n,t))&&(delete r[n],i=!0)}}return fb.isArray(e)?e.forEach(n):n(e),i}clear(e){let t=Object.keys(this),r=t.length,i=!1;for(;r--;){let n=t[r];e&&!AH(0,this[n],n,e,!0)||(delete this[n],i=!0)}return i}normalize(e){let t=this,r={};return fb.forEach(this,(i,n)=>{var o,a;let s=fb.findKey(r,n);if(s)return t[s]=AW(i),void delete t[n];let c=e?po(a=n).call(a).toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r):po(o=String(n)).call(o);c!==n&&delete t[n],t[c]=AW(i),r[c]=!0}),this}concat(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.constructor.concat(this,...t)}toJSON(e){let t=Object.create(null);return fb.forEach(this,(r,i)=>{null!=r&&!1!==r&&(t[i]=e&&fb.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,r]=e;return t+": "+r}).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let t=new this(e);for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];return i.forEach(e=>t.set(e)),t}static accessor(e){let t=(this[Aj]=this[Aj]={accessors:{}}).accessors,r=this.prototype;function i(e){let i=AG(e);t[i]||(!function(e,t){let r=fb.toCamelCase(" "+t);["get","set","has"].forEach(i=>{Object.defineProperty(e,i+r,{value:function(e,r,n){return this[i].call(this,t,e,r,n)},configurable:!0})})}(r,e),t[i]=!0)}return fb.isArray(e)?e.forEach(i):i(e),this}}AY.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),fb.reduceDescriptors(AY.prototype,(e,t)=>{let{value:r}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(e){this[i]=e}}}),fb.freezeMethods(AY);function AK(e,t){let r=this||AV,i=t||r,n=AY.from(i.headers),o=i.data;return fb.forEach(e,function(e){o=e.call(r,o,n.normalize(),t?t.status:void 0)}),n.normalize(),o}function AQ(e){return!(!e||!e.__CANCEL__)}function Az(e,t,r){fT.call(this,null==e?"canceled":e,fT.ERR_CANCELED,t,r),this.name="CanceledError"}function AX(e,t,r){let i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(new fT("Request failed with status code "+r.status,[fT.ERR_BAD_REQUEST,fT.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}fb.inherits(Az,fT,{__CANCEL__:!0});let AJ=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0,n=function(e,t){let r=Array(e=e||10),i=Array(e),n,o=0,a=0;return t=void 0!==t?t:1e3,function(s){let c=Date.now(),d=i[a];n||(n=c),r[o]=s,i[o]=c;let u=a,l=0;for(;u!==o;)l+=r[u++],u%=e;if((o=(o+1)%e)===a&&(a=(a+1)%e),c-n<t)return;let h=d&&c-d;return h?Math.round(1e3*l/h):void 0}}(50,250);return function(e,t){let r,i,n=0,o=1e3/t,a=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();n=o,r=null,i&&(clearTimeout(i),i=null),e.apply(null,t)};return[function(){let e=Date.now(),t=e-n;for(var s=arguments.length,c=Array(s),d=0;d<s;d++)c[d]=arguments[d];t>=o?a(c,e):(r=c,i||(i=setTimeout(()=>{i=null,a(r)},o-t)))},()=>r&&a(r)]}(r=>{let o=r.loaded,a=r.lengthComputable?r.total:void 0,s=o-i,c=n(s);i=o,e({loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:c||void 0,estimated:c&&a&&o<=a?(a-o)/c:void 0,event:r,lengthComputable:null!=a,[t?"download":"upload"]:!0})},r)},Aq=(e,t)=>{let r=null!=e;return[i=>t[0]({lengthComputable:r,total:e,loaded:i}),t[1]]},AZ=e=>function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return fb.asap(()=>e(...r))};var A$=AA.hasStandardBrowserEnv?(a=new h_(AA.origin),s=AA.navigator&&/(msie|trident)/i.test(AA.navigator.userAgent),e=>(e=new h_(e,AA.origin),a.protocol===e.protocol&&a.host===e.host&&(s||a.port===e.port))):()=>!0,A0=AA.hasStandardBrowserEnv?{write(e,t,r,i,n,o){let a=[e+"="+encodeURIComponent(t)];fb.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),fb.isString(i)&&a.push("path="+i),fb.isString(n)&&a.push("domain="+n),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read(e){let t=document.cookie.match(RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function A2(e,t,r){var i,n,o;let a=(i=t,!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i));return e&&(a||0==r)?(n=e,(o=t)?n.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):n):t}function A1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}let A4=e=>e instanceof AY?function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A1(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A1(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e):e;function A6(e,t){t=t||{};let r={};function i(e,t,r,i){return fb.isPlainObject(e)&&fb.isPlainObject(t)?fb.merge.call({caseless:i},e,t):fb.isPlainObject(t)?fb.merge({},t):fb.isArray(t)?t.slice():t}function n(e,t,r,n){return fb.isUndefined(t)?fb.isUndefined(e)?void 0:i(void 0,e,0,n):i(e,t,0,n)}function o(e,t){if(!fb.isUndefined(t))return i(void 0,t)}function a(e,t){return fb.isUndefined(t)?fb.isUndefined(e)?void 0:i(void 0,e):i(void 0,t)}function s(r,n,o){return o in t?i(r,n):o in e?i(void 0,r):void 0}let c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t,r)=>n(A4(e),A4(t),0,!0)};return fb.forEach(Object.keys(Object.assign({},e,t)),function(i){let o=c[i]||n,a=o(e[i],t[i],i);fb.isUndefined(a)&&o!==s||(r[i]=a)}),r}var A3=e=>{let t=A6({},e),r,{data:i,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:a,headers:s,auth:c}=t;if(t.headers=s=AY.from(s),t.url=fM(A2(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),fb.isFormData(i)){if(AA.hasStandardBrowserEnv||AA.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(r=s.getContentType())){let[e,...t]=r?r.split(";").map(e=>po(e).call(e)).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}}if(AA.hasStandardBrowserEnv&&(n&&fb.isFunction(n)&&(n=n(t)),n||!1!==n&&A$(t.url))){let e=o&&a&&A0.read(a);e&&s.set(o,e)}return t},A8="undefined"!=typeof XMLHttpRequest&&function(e){return new dJ(function(t,r){let i=A3(e),n=i.data,o=AY.from(i.headers).normalize(),a,s,c,d,u,{responseType:l,onUploadProgress:h,onDownloadProgress:p}=i;function f(){d&&d(),u&&u(),i.cancelToken&&i.cancelToken.unsubscribe(a),i.signal&&i.signal.removeEventListener("abort",a)}let _=new XMLHttpRequest;function A(){if(!_)return;let i=AY.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders());AX(function(e){t(e),f()},function(e){r(e),f()},{data:l&&"text"!==l&&"json"!==l?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:i,config:e,request:_}),_=null}_.open(i.method.toUpperCase(),i.url,!0),_.timeout=i.timeout,"onloadend"in _?_.onloadend=A:_.onreadystatechange=function(){_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))&&setTimeout(A)},_.onabort=function(){_&&(r(new fT("Request aborted",fT.ECONNABORTED,e,_)),_=null)},_.onerror=function(){r(new fT("Network Error",fT.ERR_NETWORK,e,_)),_=null},_.ontimeout=function(){let t=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded",n=i.transitional||fU;i.timeoutErrorMessage&&(t=i.timeoutErrorMessage),r(new fT(t,n.clarifyTimeoutError?fT.ETIMEDOUT:fT.ECONNABORTED,e,_)),_=null},void 0===n&&o.setContentType(null),"setRequestHeader"in _&&fb.forEach(o.toJSON(),function(e,t){_.setRequestHeader(t,e)}),fb.isUndefined(i.withCredentials)||(_.withCredentials=!!i.withCredentials),l&&"json"!==l&&(_.responseType=i.responseType),p&&([c,u]=AJ(p,!0),_.addEventListener("progress",c)),h&&_.upload&&([s,d]=AJ(h),_.upload.addEventListener("progress",s),_.upload.addEventListener("loadend",d)),(i.cancelToken||i.signal)&&(a=t=>{_&&(r(!t||t.type?new Az(null,e,_):t),_.abort(),_=null)},i.cancelToken&&i.cancelToken.subscribe(a),i.signal&&(i.signal.aborted?a():i.signal.addEventListener("abort",a)));let m=function(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(i.url);m&&-1===AA.protocols.indexOf(m)?r(new fT("Unsupported protocol "+m+":",fT.ERR_BAD_REQUEST,e)):_.send(n||null)})},A5=(e,t)=>{let{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,i=new AbortController,n=function(e){if(!r){r=!0,a();let t=e instanceof Error?e:this.reason;i.abort(t instanceof fT?t:new Az(t instanceof Error?t.message:t))}},o=t&&setTimeout(()=>{o=null,n(new fT("timeout ".concat(t," of ms exceeded"),fT.ETIMEDOUT))},t),a=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(n):e.removeEventListener("abort",n)}),e=null)};e.forEach(e=>e.addEventListener("abort",n));let{signal:s}=i;return s.unsubscribe=()=>fb.asap(a),s}};oS({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=c0.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});oS({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=c0.f(this),r=cY(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var A9=iB(dH),A7=f4.f("asyncIterator"),me=iB(A7);function mt(e,t){this.v=e,this.k=t}function mr(e){var t,r;function i(t,r){try{var o=e[t](r),a=o.value,s=a instanceof mt;A9.resolve(s?a.v:a).then(function(r){if(s){var c="return"===t?"return":"next";if(!a.k||r.done)return i(c,r);r=e[c](r).value}n(o.done?"return":"normal",r)},function(e){i("throw",e)})}catch(e){n("throw",e)}}function n(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?i(t.key,t.arg):r=null}this._invoke=function(e,n){return new A9(function(o,a){var s={key:e,arg:n,resolve:o,reject:a,next:null};r?r=r.next=s:(t=r=s,i(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}function mi(e){return function(){return new mr(e.apply(this,arguments))}}function mn(e){return new mt(e,0)}function mo(e){var t={},r=!1;function i(t,i){return r=!0,{done:!1,value:new mt(i=new A9(function(r){r(e[t](i))}),1)}}return t[void 0!==Ar&&Ai||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):i("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return i("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):i("return",e)}),t}mr.prototype["function"==typeof Ar&&me||"@@asyncIterator"]=function(){return this},mr.prototype.next=function(e){return this._invoke("next",e)},mr.prototype.throw=function(e){return this._invoke("throw",e)},mr.prototype.return=function(e){return this._invoke("return",e)};var ma=iB(A7);function ms(e){var t,r,i,n=2;for("undefined"!=typeof Symbol&&(r=ma,i=Symbol.iterator);n--;){if(r&&null!=(t=e[r]))return t.call(e);if(i&&null!=(t=e[i]))return new mc(t.call(e));r="@@asyncIterator",i="@@iterator"}throw TypeError("Object is not async iterable")}function mc(e){function t(e){if(Object(e)!==e)return dJ.reject(TypeError(e+" is not an object."));var t=e.done;return dJ.resolve(e.value).then(function(e){return{value:e,done:t}})}return(mc=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?dJ.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?dJ.reject(e):t(r.apply(this.s,arguments))}},new mc(e)}let md=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let i,n=0;for(;n<r;)i=n+t,yield e.slice(n,i),n=i},mu=(A=mi(function*(e,t){var r,i=!1,n=!1;try{for(var o,a=ms(ml(e));i=!(o=yield mn(a.next())).done;i=!1){let e=o.value;yield*mo(ms(md(e,t)))}}catch(e){n=!0,r=e}finally{try{i&&null!=a.return&&(yield mn(a.return()))}finally{if(n)throw r}}}),function(e,t){return A.apply(this,arguments)}),ml=(m=mi(function*(e){if(e[ma])return void(yield*mo(ms(e)));let t=e.getReader();try{for(;;){let{done:e,value:r}=yield mn(t.read());if(e)break;yield r}}finally{yield mn(t.cancel())}}),function(e){return m.apply(this,arguments)}),mh=(e,t,r,i)=>{let n=mu(e,t),o,a=0,s=e=>{o||(o=!0,i&&i(e))};return new ReadableStream({async pull(e){try{let{done:t,value:i}=await n.next();if(t)return s(),void e.close();let o=i.byteLength;if(r){let e=a+=o;r(e)}e.enqueue(new Uint8Array(i))}catch(e){throw s(e),e}},cancel:e=>(s(e),n.return())},{highWaterMark:2})};function mp(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function mf(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mp(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mp(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let m_="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,mA=m_&&"function"==typeof ReadableStream,mm=m_&&("function"==typeof TextEncoder?(tf=new TextEncoder,e=>tf.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer())),mv=function(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return!!e(...r)}catch(e){return!1}},mE=mA&&mv(()=>{let e=!1,t=new Request(AA.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),mg=mA&&mv(()=>fb.isReadableStream(new Response("").body)),mS={stream:mg&&(e=>e.body)};m_&&(t_=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{mS[e]||(mS[e]=fb.isFunction(t_[e])?t=>t[e]():(t,r)=>{throw new fT("Response type '".concat(e,"' is not supported"),fT.ERR_NOT_SUPPORT,r)})}));let mb=async(e,t)=>{let r=fb.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(fb.isBlob(e))return e.size;if(fb.isSpecCompliantForm(e)){let t=new Request(AA.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return fb.isArrayBufferView(e)||fb.isArrayBuffer(e)?e.byteLength:(fb.isURLSearchParams(e)&&(e+=""),fb.isString(e)?(await mm(e)).byteLength:void 0)})(t):r},mT={http:null,xhr:A8,fetch:m_&&(async e=>{let t,{url:r,method:i,data:n,signal:o,cancelToken:a,timeout:s,onDownloadProgress:c,onUploadProgress:d,responseType:u,headers:l,withCredentials:h="same-origin",fetchOptions:p}=A3(e);u=u?(u+"").toLowerCase():"text";let f,_=A5([o,a&&a.toAbortSignal()],s),A=_&&_.unsubscribe&&(()=>{_.unsubscribe()});try{if(d&&mE&&"get"!==i&&"head"!==i&&0!==(t=await mb(l,n))){let e,i=new Request(r,{method:"POST",body:n,duplex:"half"});if(fb.isFormData(n)&&(e=i.headers.get("content-type"))&&l.setContentType(e),i.body){let[e,r]=Aq(t,AJ(AZ(d)));n=mh(i.body,65536,e,r)}}fb.isString(h)||(h=h?"include":"omit");let o="credentials"in Request.prototype;f=new Request(r,mf(mf({},p),{},{signal:_,method:i.toUpperCase(),headers:l.normalize().toJSON(),body:n,duplex:"half",credentials:o?h:void 0}));let a=await fetch(f),s=mg&&("stream"===u||"response"===u);if(mg&&(c||s&&A)){let e={};["status","statusText","headers"].forEach(t=>{e[t]=a[t]});let t=fb.toFiniteNumber(a.headers.get("content-length")),[r,i]=c&&Aq(t,AJ(AZ(c),!0))||[];a=new Response(mh(a.body,65536,r,()=>{i&&i(),A&&A()}),e)}u=u||"text";let m=await mS[fb.findKey(mS,u)||"text"](a,e);return!s&&A&&A(),await new dJ((t,r)=>{AX(t,r,{data:m,headers:AY.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:f})})}catch(t){if(A&&A(),t&&"TypeError"===t.name&&/fetch/i.test(t.message))throw Object.assign(new fT("Network Error",fT.ERR_NETWORK,e,f),{cause:t.cause||t});throw fT.from(t,t&&t.code,e,f)}})};fb.forEach(mT,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});let my=e=>"- ".concat(e),mR=e=>fb.isFunction(e)||null===e||!1===e;var mI=e=>{let t,r;let{length:i}=e=fb.isArray(e)?e:[e],n={};for(let o=0;o<i;o++){let i;if(r=t=e[o],!mR(t)&&void 0===(r=mT[(i=String(t)).toLowerCase()]))throw new fT("Unknown adapter '".concat(i,"'"));if(r)break;n[i||"#"+o]=r}if(!r){let e=Object.entries(n).map(e=>{let[t,r]=e;return"adapter ".concat(t," ")+(!1===r?"is not supported by the environment":"is not available in the build")});throw new fT("There is no suitable adapter to dispatch the request "+(i?e.length>1?"since :\n"+e.map(my).join("\n"):" "+my(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r};function mC(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Az(null,e)}function mk(e){return mC(e),e.headers=AY.from(e.headers),e.data=AK.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),mI(e.adapter||AV.adapter)(e).then(function(t){return mC(e),t.data=AK.call(e,e.transformResponse,t),t.headers=AY.from(t.headers),t},function(t){return AQ(t)||(mC(e),t&&t.response&&(t.response.data=AK.call(e,e.transformResponse,t.response),t.response.headers=AY.from(t.response.headers))),dJ.reject(t)})}let mw="1.8.4",mO={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{mO[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});let mN={};mO.transitional=function(e,t,r){function i(e,t){return"[Axios v"+mw+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,n,o)=>{if(!1===e)throw new fT(i(n," has been removed"+(t?" in "+t:"")),fT.ERR_DEPRECATED);return t&&!mN[n]&&(mN[n]=!0,console.warn(i(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,o)}},mO.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var mP={assertOptions:function(e,t,r){if("object"!=typeof e)throw new fT("options must be an object",fT.ERR_BAD_OPTION_VALUE);let i=Object.keys(e),n=i.length;for(;n-- >0;){let o=i[n],a=t[o];if(a){let t=e[o],r=void 0===t||a(t,o,e);if(!0!==r)throw new fT("option "+o+" must be "+r,fT.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new fT("Unknown option "+o,fT.ERR_BAD_OPTION)}},validators:mO};let mD=mP.validators,mL=class{constructor(e){this.defaults=e,this.interceptors={request:new fx,response:new fx}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=Error();let r=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?r&&!String(e.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+r):e.stack=r}catch(e){}}throw e}}_request(e,t){let r;"string"==typeof e?(t=t||{}).url=e:t=e||{};let{transitional:i,paramsSerializer:n,headers:o}=t=A6(this.defaults,t);void 0!==i&&mP.assertOptions(i,{silentJSONParsing:mD.transitional(mD.boolean),forcedJSONParsing:mD.transitional(mD.boolean),clarifyTimeoutError:mD.transitional(mD.boolean)},!1),null!=n&&(fb.isFunction(n)?t.paramsSerializer={serialize:n}:mP.assertOptions(n,{encode:mD.function,serialize:mD.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),mP.assertOptions(t,{baseUrl:mD.spelling("baseURL"),withXsrfToken:mD.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&fb.merge(o.common,o[t.method]);o&&fb.forEach(["delete","get","head","post","put","patch","common"],e=>{delete o[e]}),t.headers=AY.concat(a,o);let s=[],c=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(c=c&&e.synchronous,s.unshift(e.fulfilled,e.rejected))});let d=[];this.interceptors.response.forEach(function(e){d.push(e.fulfilled,e.rejected)});let u,l=0;if(!c){let e=[mk.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,d),u=e.length,r=dJ.resolve(t);l<u;)r=r.then(e[l++],e[l++]);return r}u=s.length;let h=t;for(l=0;l<u;){let e=s[l++],t=s[l++];try{h=e(h)}catch(e){t.call(this,e);break}}try{r=mk.call(this,h)}catch(e){return dJ.reject(e)}for(l=0,u=d.length;l<u;)r=r.then(d[l++],d[l++]);return r}getUri(e){return fM(A2((e=A6(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};fb.forEach(["delete","get","head","options"],function(e){mL.prototype[e]=function(t,r){return this.request(A6(r||{},{method:e,url:t,data:(r||{}).data}))}}),fb.forEach(["post","put","patch"],function(e){function t(t){return function(r,i,n){return this.request(A6(n||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}mL.prototype[e]=t(),mL.prototype[e+"Form"]=t(!0)});class mM{constructor(e){let t;if("function"!=typeof e)throw TypeError("executor must be a function.");this.promise=new dJ(function(e){t=e});let r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t;let i=new dJ(e=>{r.subscribe(e),t=e}).then(e);return i.cancel=function(){r.unsubscribe(t)},i},e(function(e,i,n){r.reason||(r.reason=new Az(e,i,n),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new mM(function(t){e=t}),cancel:e}}}let mx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(mx).forEach(e=>{let[t,r]=e;mx[r]=t});let mU=function e(t){let r=new mL(t),i=pq(mL.prototype.request,r);return fb.extend(i,mL.prototype,r,{allOwnKeys:!0}),fb.extend(i,r,null,{allOwnKeys:!0}),i.create=function(r){return e(A6(t,r))},i}(AV);mU.Axios=mL,mU.CanceledError=Az,mU.CancelToken=mM,mU.isCancel=AQ,mU.VERSION=mw,mU.toFormData=fO,mU.AxiosError=fT,mU.Cancel=mU.CanceledError,mU.all=function(e){return dJ.all(e)},mU.spread=function(e){return function(t){return e.apply(null,t)}},mU.isAxiosError=function(e){return fb.isObject(e)&&!0===e.isAxiosError},mU.mergeConfig=A6,mU.AxiosHeaders=AY,mU.formToJSON=e=>AB(fb.isHTMLForm(e)?new FormData(e):e),mU.getAdapter=mI,mU.HttpStatusCode=mx,mU.default=mU;let mB=()=>{};function mV(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:mB};return e.promise=new dJ((t,r)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(t))}}),e}let mF=new Map,mj=new Map,mG=new Map;let mW=((v={}).WIN_10="Windows 10",v.WIN_81="Windows 8.1",v.WIN_8="Windows 8",v.WIN_7="Windows 7",v.WIN_VISTA="Windows Vista",v.WIN_SERVER_2003="Windows Server 2003",v.WIN_XP="Windows XP",v.WIN_2000="Windows 2000",v.ANDROID="Android",v.HARMONY_OS="HarmonyOS",v.OPEN_BSD="Open BSD",v.SUN_OS="Sun OS",v.LINUX="Linux",v.IOS="iOS",v.MAC_OS="Mac OS",v.CHROMIUM_OS="Chromium OS",v.QNX="QNX",v.UNIX="UNIX",v.BEOS="BeOS",v.OS_2="OS/2",v.SEARCH_BOT="Search Bot",v),mH=((E={}).CHROME="Chrome",E.SAFARI="Safari",E.EDGE="Edge",E.FIREFOX="Firefox",E.OPERA="OPR",E.QQ="QQBrowser",E.WECHAT="MicroMessenger",E),mY=new pB,mK=mY.getResult(),mQ=null;function mz(e){if(!mQ){var t;e&&mY.setUA(e);let r=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return mH.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return mH.CHROME;case"Safari":case"Mobile Safari":return mH.SAFARI;case"Edge":return mH.EDGE;case"Firefox":return mH.FIREFOX;case"QQ":case"QQBrowser":return mH.QQ;case"Opera":return mH.OPERA;case"WeChat":return mH.WECHAT;default:return e.browser.name||""}}(mK=mY.getResult()),i=mX(mK),n="Windows"===(t=mK).os.name?t.os.version?t.os.name+" "+t.os.version:t.os.name:t.os.name||"",o=mK.os.version,a=mX(mK,!1),s=mK.device.type;if(!(r&&i&&n&&o))return{name:r,version:i,os:n,osVersion:o,browserVersion:a,deviceType:s};mQ={name:r,version:i,os:n,osVersion:o,browserVersion:a,deviceType:s}}return mQ}function mX(e){let t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function mJ(){return mz().os}function mq(){let e=mz();return"".concat(e.os," ").concat(e.osVersion)}function mZ(){let e=mz();return!!("WebKit"===mK.engine.name&&e.os===mW.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==mH.SAFARI||m4()&&e.name!==mH.SAFARI)}function m$(){return mz().name===mH.CHROME}function m0(){return mz().name===mH.SAFARI}function m2(){return mz().name===mH.EDGE}function m1(){return mz().name===mH.FIREFOX}function m4(){return mz().os===mW.IOS}function m6(e){let t=mz();return!(t.name!==mH.CHROME||!t.osVersion)&&Number(t.version)>=e}function m3(e){let t=mz();return!(t.name!==mH.CHROME||!t.osVersion)&&Number(t.version)<e}function m8(e,t,r){let i=mz();return!(i.name!==e||!i.osVersion)&&(r?Number(i.version)>=t&&Number(i.version)<=r:Number(i.version)===t)}function m5(e){let t=mz();return!(t.name!==mH.EDGE||!t.osVersion)&&Number(t.version)>=e}function m9(e){let t=mz();return!(t.name!==mH.SAFARI||!t.osVersion)&&Number(t.version)>=e}function m7(e,t,r){let i=mz();if(i.os!==mW.IOS||!i.osVersion)return!1;let n=i.osVersion.split(".");return r?t&&Number(n[0])===e&&Number(n[1])<t||Number(n[0])<e:t?Number(n[0])===e&&Number(n[1])<=t||Number(n[0])<e:Number(n[0])<=e}function ve(e,t,r){let i=mz();if(i.name!==mH.SAFARI||!i.osVersion||!i.browserVersion)return!1;let n=i.browserVersion.split(".");return r?t&&Number(n[0])===e&&Number(n[1])<t||Number(n[0])<e:t?Number(n[0])===e&&Number(n[1])<=t||Number(n[0])<e:Number(n[0])<=e}function vt(e){let t=mz();return!(t.name!==mH.OPERA||!t.osVersion)&&Number(t.version)>=e}function vr(){let e=mz();if(e.os!==mW.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 14>Number(t[0])||14===Number(t[0])&&6>=Number(t[1])}function vi(){let e=mz();return e.os===mW.IOS&&!!e.osVersion&&15===Number(e.osVersion.split(".")[0])}function vn(){let e=mz();return e.os===mW.IOS&&!!e.osVersion&&16===Number(e.osVersion.split(".")[0])}function vo(){let e=mz();if(e.os!==mW.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function va(){return m0()&&navigator.maxTouchPoints>0}function vs(){return mz().name===mH.WECHAT}function vc(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function vd(){let e=mJ();return function(){let{deviceType:e}=mz();return"mobile"===e||"tablet"===e}()||e===mW.ANDROID||e===mW.IOS||e===mW.HARMONY_OS}function vu(){let e=mz();return e.name!==mH.EDGE&&e.name!==mH.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function vl(){return mJ()===mW.ANDROID}function vh(){let e=mz();return vl()&&(e.name===mH.CHROME||e.name===mH.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function vp(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vf(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function v_(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vf(Object(r),!0).forEach(function(t){vp(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vf(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let vA=((g={}).UNEXPECTED_ERROR="UNEXPECTED_ERROR",g.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",g.TIMEOUT="TIMEOUT",g.INVALID_PARAMS="INVALID_PARAMS",g.NOT_READABLE="NOT_READABLE",g.NOT_SUPPORTED="NOT_SUPPORTED",g.INVALID_OPERATION="INVALID_OPERATION",g.OPERATION_ABORTED="OPERATION_ABORTED",g.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",g.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",g.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",g.DATACHANNEL_FAILED="DATACHANNEL_FAILED",g.NETWORK_ERROR="NETWORK_ERROR",g.NETWORK_TIMEOUT="NETWORK_TIMEOUT",g.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",g.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",g.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",g.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",g.ELECTRON_IS_NULL="ELECTRON_IS_NULL",g.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",g.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",g.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",g.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",g.PERMISSION_DENIED="PERMISSION_DENIED",g.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",g.TRACK_IS_DISABLED="TRACK_IS_DISABLED",g.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",g.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",g.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",g.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",g.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",g.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",g.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",g.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",g.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",g.UID_CONFLICT="UID_CONFLICT",g.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",g.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",g.TOKEN_EXPIRE="TOKEN_EXPIRE",g.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",g.INVALID_TRACK="INVALID_TRACK",g.SENDER_NOT_FOUND="SENDER_NOT_FOUND",g.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",g.SET_ANSWER_FAILED="SET_ANSWER_FAILED",g.ICE_FAILED="ICE_FAILED",g.PC_CLOSED="PC_CLOSED",g.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",g.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",g.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",g.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",g.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",g.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",g.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",g.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",g.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",g.INVALID_REMOTE_USER="INVALID_REMOTE_USER",g.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",g.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",g.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",g.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",g.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",g.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",g.WS_ABORT="WS_ABORT",g.WS_DISCONNECT="WS_DISCONNECT",g.WS_ERR="WS_ERR",g.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",g.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",g.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",g.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",g.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",g.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",g.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",g.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",g.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",g.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",g.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",g.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",g.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",g.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",g.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",g.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",g.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",g.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",g.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",g.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",g.INVALID_PLUGIN="INVALID_PLUGIN",g.DISCONNECT_P2P="DISCONNECT_P2P",g.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",g.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",g.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",g.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",g.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",g.PROHIBITED_OPERATION="PROHIBITED_OPERATION",g.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",g.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",g),vm=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),vp(this,"code",void 0),vp(this,"message",void 0),vp(this,"data",void 0),vp(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function vv(e,t){if("boolean"!=typeof e)throw new vm(vA.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function vE(e,t,r){if(!o0(r).call(r,e))throw new vm(vA.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function vg(e,t){var r;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<i||e>n||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!("number"==typeof(r=e)&&r%1==0))throw new vm(vA.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(i,", ").concat(n,"]. integer only"))}function vS(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new vm(vA.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&vg(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&vg(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&vg(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&vg(e.ideal,"".concat(t,".ideal"),1,1/0)}else vg(e,t,1,1/0)}function vb(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new vm(vA.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!vR(e,r,i,n))throw new vm(vA.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(i,"].").concat(n?" ASCII characters only.":""))}function vT(e,t){if(!Array.isArray(e))throw new vm(vA.INVALID_PARAMS,"".concat(t," should be an array"))}function vy(e){return null==e}function vR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=r&&e.length>=t&&(!i||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){let r=e.charCodeAt(t);if(r<0||r>255)return!1}return!0}(e))}var vI=((S=vI||{}).COVERED="COVERED",S.POSITION="POSITION",S.SIZE="SIZE",S.STYLE="STYLE",S),vC=((b=vC||{}).UNMOUNTED="UNMOUNTED",b.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",b);let vk=new class{constructor(){vp(this,"_clientSize",null),vp(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),vp(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),vp(this,"getStyle",e=>window.getComputedStyle(e,null)),vp(this,"checkCssVisibleProperty",e=>{var t;let r=!0,{display:i,visibility:n,opacity:o,filter:a}=this.getStyle(e);return("none"===i||o0(t=["hidden","collapse"]).call(t,n)||.1>Number(o))&&(r=!1),!!r&&(a&&a.split(" ").filter(e=>{var t;let r=e.split("(")[0];return o0(t=["brightness","blur","opacity"]).call(t,r)}).map(e=>{let[t,r]=e.split(/\(|\)/);return[t,Number(r.match(/^[0-9\.]+/))]}).forEach(e=>{let[t,i]=e;switch(t){case"brightness":(i<.1||i>3)&&(r=!1);break;case"blur":i>3&&(r=!1);break;case"opacity":i<.1&&(r=!1)}}),r)}),vp(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,i=!0,n=e=>t(e),o=e;for(;o&&i;)n(o)||(r=!1,i=!1),(o=o.parentElement)||(i=!1);return r}),vp(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),vp(this,"getSizeAboutClient",e=>{let{width:t,height:r,left:i,right:n,top:o,bottom:a}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:r,left:i,right:n,top:o,bottom:a,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}}),vp(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),vp(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),vp(this,"checkCoverForAPoint",(e,t,r)=>{let i=this.elementFromPoint(e,t);return null!==i&&i!==r}),vp(this,"getPointPositionList",()=>{let{width:e,height:t,left:r,top:i}=this._clientSize,n=e/6,o=t/6,a=[];for(let e=0;e<5;e++)for(let t=0;t<5;t++){let s=(1e6*r+(0===e?.1:4===e?(n*e*1e6-1e5)/1e6:n*e)*1e6)/1e6,c=(1e6*i+(0===t?.1:4===t?(o*t*1e6-1e5)/1e6:o*t)*1e6)/1e6;a.push({x:s,y:c})}return[...a]}),vp(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(e=>!!e).length>6),vp(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),vp(this,"checkSizeOfPartInClient",()=>{let e,t,r;let{left:i,right:n,top:o,bottom:a,clientHeight:s,clientWidth:c,clientMin:d}=this._clientSize;if(i<0)e=0;else{if(!(i<c))return!1;e=i}if(n<0)return!1;if(t=n<c?n:c,o<0)r=0;else{if(!(o<s))return!1;r=o}if(a<0)return!1;let u=t-e,l=(a<s?a:s)-r;return this.checkSizeIsVisible(u,l,d)}),vp(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),vp(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(vI.COVERED);{let e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(vI.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(vI.SIZE)}}return this.returnHiddenResult(vI.STYLE)}return this.returnHiddenResult(vC.UNMOUNTED)}return this.returnHiddenResult(vC.INVALID_HTML_ELEMENT)}),vp(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))}};function vw(e){return(new TextEncoder).encode(e)}let vO=function(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},vN=async e=>{var t,r;let i;return t=await crypto.subtle.digest("SHA-256",vw(e)),r=16,i="",new Uint8Array(t).forEach(e=>{i+=e.toString(16).padStart(2,"0")}),i},vP=class{constructor(){vp(this,"_events",{}),vp(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],i=this._indexOfListener(r,t);-1!==i&&r.splice(i,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(e=>e);for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(let r=0;r<t.length;r+=1){let n=t[r];n.once&&this.off(e,n.listener),n.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];[...this._events[e]||[]].forEach(t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,r)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return -1}},vD=null;function vL(){if(vD)return vD;if(window.electron)return vD=window.electron;if(!window.require)return null;try{return vD=window.require("electron")}catch(e){return null}}let vM=((T={}).CREATE_CLIENT="createClient",T.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",T.SET_AREA="setArea",T.PRELOAD="PRELOAD",T.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",T.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",T.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",T.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",T.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",T.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",T.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",T.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",T.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",T.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",T.START_PROXY_SERVER="Client.startProxyServer",T.STOP_PROXY_SERVER="Client.stopProxyServer",T.SET_PROXY_SERVER="Client.setProxyServer",T.SET_TURN_SERVER="Client.setTurnServer",T.SET_CLIENT_ROLE="Client.setClientRole",T.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",T.ENABLE_DUAL_STREAM="Client.enableDualStream",T.DISABLE_DUAL_STREAM="Client.disableDualStream",T.JOIN="Client.join",T.LEAVE="Client.leave",T.PUBLISH="Client.publish",T.UNPUBLISH="Client.unpublish",T.SUBSCRIBE="Client.subscribe",T.MASS_SUBSCRIBE="Client.massSubscribe",T.MASS_UNSUBSCRIBE="Client.massUnsubscribe",T.UNSUBSCRIBE="Client.unsubscribe",T.RENEW_TOKEN="Client.renewToken",T.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",T.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",T.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",T.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",T.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",T.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",T.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",T.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",T.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",T.START_LIVE_STREAMING="Client.startLiveStreaming",T.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",T.STOP_LIVE_STREAMING="Client.stopLiveStreaming",T.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",T.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",T.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",T.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",T.SET_CONFIG_DISTRIBUTE="_configDistribute",T.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",T.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",T.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",T.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",T.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",T.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",T.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",T.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",T.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",T.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",T.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",T.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",T.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",T.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",T.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",T.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",T.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",T.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",T.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",T.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",T.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",T.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",T.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",T.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",T.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",T.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",T.STREAM_TYPE_CHANGE="streamTypeChange",T.CONNECTION_STATE_CHANGE="connectionStateChange",T.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",T.IMAGE_MODERATION_UPLOAD="imageModerationUpload",T.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",T),vx=((y={}).TRACER="tracer",y);function vU(e){return vg(e.timeout,"config.timeout",0,1e5),vg(e.timeoutFactor,"config.timeoutFactor",0,100,!1),vg(e.maxRetryCount,"config.maxRetryConfig",0,1/0),vg(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let vB=((R={})[R.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",R[R.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",R[R.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",R),vV=((I={}).LEAVE="LEAVE",I.NETWORK_ERROR="NETWORK_ERROR",I.SERVER_ERROR="SERVER_ERROR",I.UID_BANNED="UID_BANNED",I.FALLBACK="FALLBACK",I.IP_BANNED="IP_BANNED",I.CHANNEL_BANNED="CHANNEL_BANNED",I.LICENSE_MISSING="LICENSE_MISSING",I.LICENSE_EXPIRED="LICENSE_EXPIRED",I.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",I.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",I.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",I.LICENSE_ILLEGAL="LICENSE_ILLEGAL",I.TOKEN_EXPIRE="TOKEN_EXPIRE",I);function vF(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(e=>{if(!e.urls)throw Error()})}catch(e){return!1}return!0}function vj(e){return vb(e.turnServerURL,"turnServerURL"),vb(e.username,"username"),vb(e.password,"password"),e.udpport&&vg(e.udpport,"udpport",1,99999,!0),e.forceturn&&vv(e.forceturn,"forceturn"),e.security&&vv(e.security,"security"),e.tcpport&&vg(e.tcpport,"tcpport",1,99999,!0),!0}function vG(e){return void 0!==e.level&&vE(e.level,"level",[1,2,3]),void 0!==e.delay&&vg(e.delay,"delay",0,3e3,!0),!0}let vW=((C={}).PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",C.AUDIO_METADATA="audio-metadata",C.CONNECTION_STATE_CHANGE="connection-state-change",C.MEDIA_RECONNECT_START="media-reconnect-start",C.MEDIA_RECONNECT_END="media-reconnect-end",C.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",C.USER_JOINED="user-joined",C.USER_LEAVED="user-left",C.USER_PUBLISHED="user-published",C.USER_UNPUBLISHED="user-unpublished",C.USER_INFO_UPDATED="user-info-updated",C.CLIENT_BANNED="client-banned",C.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",C.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",C.VOLUME_INDICATOR="volume-indicator",C.CRYPT_ERROR="crypt-error",C.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",C.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",C.NETWORK_QUALITY="network-quality",C.STREAM_TYPE_CHANGED="stream-type-changed",C.STREAM_FALLBACK="stream-fallback",C.RECEIVE_METADATA="receive-metadata",C.STREAM_MESSAGE="stream-message",C.LIVE_STREAMING_ERROR="live-streaming-error",C.LIVE_STREAMING_WARNING="live-streaming-warning",C.EXCEPTION="exception",C.ERROR="error",C.P2P_LOST="p2p_lost",C.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",C.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",C.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",C.PUBLISHED_USER_LIST="published-user-list",C.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",C.CONTENT_INSPECT_ERROR="content-inspect-error",C.CONTENT_INSPECT_RESULT="content-inspect-result",C.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",C),vH=((k={}).NETWORK_ERROR="NETWORK_ERROR",k.SERVER_ERROR="SERVER_ERROR",k.MULTI_IP="MULTI_IP",k.TIMEOUT="TIMEOUT",k.OFFLINE="OFFLINE",k.LEAVE="LEAVE",k.P2P_FAILED="P2P_FAILED",k.FALLBACK="FALLBACK",k.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",k),vY=((w={}).ONLINE="ONLINE",w.OFFLINE="OFFLINE",w),vK=((O={}).NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",O.ONLINE="ONLINE",O.OFFLINE="OFFLINE",O);function vQ(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return 0===e.getListeners(t).length?dJ.reject(new vm(vA.UNEXPECTED_ERROR,"can not emit promise")):new dJ((r,n)=>{e.emit(t,...i,r,n)})}function vz(e,t){if(0===e.getListeners(t).length)return dJ.resolve();for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return vQ(e,t,...i)}function vX(e,t){if(0===e.getListeners(t).length)return null;for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return vJ(e,t,...i)}function vJ(e,t){let r=null,i=null;for(var n=arguments.length,o=Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];if(e.emit(t,...o,e=>{r=e},e=>{i=e}),null!==i)throw i;if(null===r)throw new vm(vA.UNEXPECTED_ERROR,"handler is not sync");return r}let vq=new class extends vP{set networkState(e){this.emit(vK.NETWORK_STATE_CHANGE,e,this._networkState),e===vY.ONLINE?this.emit(vK.ONLINE):e===vY.OFFLINE&&(this.onlineWaiter=new dJ(e=>{this.once(vK.ONLINE,()=>{this.onlineWaiter=void 0,e(vY.ONLINE)})}),this.emit(vK.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===vY.ONLINE}constructor(){super(),vp(this,"_moduleName","network-indicator"),vp(this,"_networkState",vY.ONLINE),vp(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=vY.ONLINE}),window.addEventListener("offline",()=>{this.networkState=vY.OFFLINE})}};function vZ(e,t){let r=e.indexOf(t);-1!==r&&e.splice(r,1)}function v$(e){let t=[];return e.forEach(e=>{-1===t.indexOf(e)&&t.push(e)}),t}function v0(e){void 0!==dJ?dJ.resolve().then(e):setTimeout(e,0)}function v2(e){return JSON.parse(JSON.stringify(e))}function v1(e){try{return v2(e)}catch(t){return e}}let v4={};function v6(e,t){v4[t]||(v4[t]=!0,e())}function v3(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)r[e]=t.charCodeAt(e);return r}function v8(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function v5(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,r=(new TextEncoder).encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){let e=new Uint8Array(t);e.set(r),r=e}return r}function v9(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=new Uint8Array(new ArrayBuffer(ae(t).call(t,(e,t)=>e+t.length,0))),n=0;return t.forEach(e=>{i.set(e,n),n+=e.length}),i}function v7(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function Ee(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(e=>{t+="string"==typeof e?v7(e):e.size}),t+138}function Et(e){return new dJ(t=>{window.setTimeout(t,e)})}function Er(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+Er(e-r.length,"")}function Ei(){return Er(32,"").toUpperCase()}let En=()=>{},Eo=new class{constructor(){vp(this,"fnMap",new Map)}throttleByKey(e,t,r,i){for(var n=arguments.length,o=Array(n>4?n-4:0),a=4;a<n;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){let n=this.fnMap.get(t);if(n.threshold!==r){n.fn(...n.args),clearTimeout(n.timer);let a=window.setTimeout(()=>{let e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:a,args:o,skipFn:i})}else n.skipFn&&n.skipFn(...n.args),this.fnMap.set(t,v_(v_({},n),{},{fn:e,args:o,skipFn:i}))}else{let n=window.setTimeout(()=>{let e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:n,args:o,skipFn:i})}}},Ea=Eo.throttleByKey.bind(Eo);function Es(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function Ec(e,t){let r=[0];if(t&&(r=Array(t).fill(0)),0===e)return r;let i=0;for(;e>0&&(r[i]=255&e,e>>=8,i++,!t||i!==t););return r}function Ed(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function Eu(e){let t="0123456789abcdef";function r(e){let r,i="";for(r=0;r<=3;r++)i+=t.charAt(e>>8*r+4&15)+t.charAt(e>>8*r&15);return i}function i(e,t){let r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,t,r,n,o,a){var s,c;return i((s=i(i(t,e),i(n,a)),s<<(c=o)|s>>>32-c),r)}function o(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function s(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function c(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}let d=function(e){let t;let r=1+(e.length+8>>6),i=Array(16*r);for(t=0;t<16*r;t++)i[t]=0;for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<t%4*8;return i[t>>2]|=128<<t%4*8,i[16*r-2]=8*e.length,i}(e),u,l,h,p,f,_=0x67452301,A=-0x10325477,m=-0x67452302,v=0x10325476;for(u=0;u<d.length;u+=16)l=_,h=A,p=m,f=v,_=o(_,A,m,v,d[u+0],7,-0x28955b88),v=o(v,_,A,m,d[u+1],12,-0x173848aa),m=o(m,v,_,A,d[u+2],17,0x242070db),A=o(A,m,v,_,d[u+3],22,-0x3e423112),_=o(_,A,m,v,d[u+4],7,-0xa83f051),v=o(v,_,A,m,d[u+5],12,0x4787c62a),m=o(m,v,_,A,d[u+6],17,-0x57cfb9ed),A=o(A,m,v,_,d[u+7],22,-0x2b96aff),_=o(_,A,m,v,d[u+8],7,0x698098d8),v=o(v,_,A,m,d[u+9],12,-0x74bb0851),m=o(m,v,_,A,d[u+10],17,-42063),A=o(A,m,v,_,d[u+11],22,-0x76a32842),_=o(_,A,m,v,d[u+12],7,0x6b901122),v=o(v,_,A,m,d[u+13],12,-0x2678e6d),m=o(m,v,_,A,d[u+14],17,-0x5986bc72),A=o(A,m,v,_,d[u+15],22,0x49b40821),_=a(_,A,m,v,d[u+1],5,-0x9e1da9e),v=a(v,_,A,m,d[u+6],9,-0x3fbf4cc0),m=a(m,v,_,A,d[u+11],14,0x265e5a51),A=a(A,m,v,_,d[u+0],20,-0x16493856),_=a(_,A,m,v,d[u+5],5,-0x29d0efa3),v=a(v,_,A,m,d[u+10],9,0x2441453),m=a(m,v,_,A,d[u+15],14,-0x275e197f),A=a(A,m,v,_,d[u+4],20,-0x182c0438),_=a(_,A,m,v,d[u+9],5,0x21e1cde6),v=a(v,_,A,m,d[u+14],9,-0x3cc8f82a),m=a(m,v,_,A,d[u+3],14,-0xb2af279),A=a(A,m,v,_,d[u+8],20,0x455a14ed),_=a(_,A,m,v,d[u+13],5,-0x561c16fb),v=a(v,_,A,m,d[u+2],9,-0x3105c08),m=a(m,v,_,A,d[u+7],14,0x676f02d9),A=a(A,m,v,_,d[u+12],20,-0x72d5b376),_=s(_,A,m,v,d[u+5],4,-378558),v=s(v,_,A,m,d[u+8],11,-0x788e097f),m=s(m,v,_,A,d[u+11],16,0x6d9d6122),A=s(A,m,v,_,d[u+14],23,-0x21ac7f4),_=s(_,A,m,v,d[u+1],4,-0x5b4115bc),v=s(v,_,A,m,d[u+4],11,0x4bdecfa9),m=s(m,v,_,A,d[u+7],16,-0x944b4a0),A=s(A,m,v,_,d[u+10],23,-0x41404390),_=s(_,A,m,v,d[u+13],4,0x289b7ec6),v=s(v,_,A,m,d[u+0],11,-0x155ed806),m=s(m,v,_,A,d[u+3],16,-0x2b10cf7b),A=s(A,m,v,_,d[u+6],23,0x4881d05),_=s(_,A,m,v,d[u+9],4,-0x262b2fc7),v=s(v,_,A,m,d[u+12],11,-0x1924661b),m=s(m,v,_,A,d[u+15],16,0x1fa27cf8),A=s(A,m,v,_,d[u+2],23,-0x3b53a99b),_=c(_,A,m,v,d[u+0],6,-0xbd6ddbc),v=c(v,_,A,m,d[u+7],10,0x432aff97),m=c(m,v,_,A,d[u+14],15,-0x546bdc59),A=c(A,m,v,_,d[u+5],21,-0x36c5fc7),_=c(_,A,m,v,d[u+12],6,0x655b59c3),v=c(v,_,A,m,d[u+3],10,-0x70f3336e),m=c(m,v,_,A,d[u+10],15,-1051523),A=c(A,m,v,_,d[u+1],21,-0x7a7ba22f),_=c(_,A,m,v,d[u+8],6,0x6fa87e4f),v=c(v,_,A,m,d[u+15],10,-0x1d31920),m=c(m,v,_,A,d[u+6],15,-0x5cfebcec),A=c(A,m,v,_,d[u+13],21,0x4e0811a1),_=c(_,A,m,v,d[u+4],6,-0x8ac817e),v=c(v,_,A,m,d[u+11],10,-0x42c50dcb),m=c(m,v,_,A,d[u+2],15,0x2ad7d2bb),A=c(A,m,v,_,d[u+9],21,-0x14792c6f),_=i(_,l),A=i(A,h),m=i(m,p),v=i(v,f);return r(_)+r(A)+r(m)+r(v)}let El=1,Eh=console,Ep=class{static setLogger(e){Eh=e}constructor(e,t){vp(this,"id",void 0),vp(this,"lockingPromise",dJ.resolve()),vp(this,"locks",0),vp(this,"name",""),vp(this,"lockId",void 0),this.lockId=El++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");Eh.debug("".concat(r," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let r=new dJ(r=>{t=()=>{this.locks-=1,this.logger("unlocked",e),r()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),i}};function Ef(e,t){return function(r,i,n){let o=n.value;if("function"!=typeof o)throw Error("Cannot use mutex on object property.");return n.value=async function(){let r=this[t];if(!r)throw Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let n=await r.lock("From ".concat(e,".").concat(i));try{for(var a=arguments.length,s=Array(a),c=0;c<a;c++)s[c]=arguments[c];return await o.apply(this,s)}finally{n()}},n}}let E_={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function EA(e,t){let r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function Em(e,t,r,i){let n=Object.assign({},E_,i),o=n.timeout,a=async()=>{var e;await (e=o,new dJ(t=>{window.setTimeout(t,e)})),o*=n.timeoutFactor,o=Math.min(n.maxRetryTimeout,o)},s=!1,c=new dJ(async(i,o)=>{t=t||(()=>!1),r=r||(()=>!0);for(let c=0;c<n.maxRetryCount;c+=1){if(s)return o(new vm(vA.OPERATION_ABORTED));try{let r=await e();if(!t(r,c)||c+1===n.maxRetryCount)return i(r);await a()}catch(e){if(!r(e,c)||c+1===n.maxRetryCount)return o(e);await a()}}});return c.cancel=()=>s=!0,c}let Ev,EE=class{constructor(e){vp(this,"input",[]),vp(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:ae(e=this.input).call(e,(e,t)=>e+t)/this.input.length}},Eg=0,ES=0;function Eb(e,t,r,i){return new dJ((n,o)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),Eg+=v7(t.data)):r&&(t.data.size?Eg+=t.data.size:t.data instanceof FormData?Eg+=Ee(t.data):Eg+=v7(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,mU.request(t).then(e=>{"string"==typeof e.data?ES+=v7(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?ES+=e.data.byteLength:ES+=v7(JSON.stringify(e.data)),i&&n({data:e.data,headers:e.headers}),n(e.data)}).catch(e=>{mU.isCancel(e)?o(new vm(vA.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new vm(vA.NETWORK_TIMEOUT,e.message)):e.response?o(new vm(vA.NETWORK_RESPONSE_ERROR,e.response.status)):o(new vm(vA.NETWORK_ERROR,e.message))})})}async function ET(e,t){let r=new Blob([t.data],{type:"buffer"});return await Eb(e,v_(v_({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}let Ey=()=>void 0!==window.isSecureContext;function ER(e){if(Array.isArray(e))return e.map(e=>e);if(!EI(e))return e;let t={};for(let r in e){let i=e[r];EI(i)||Array.isArray(i)?t[r]=ER(i):t[r]=i}return t}function EI(e){return!("object"!=typeof e||Array.isArray(e)||!e)}let EC=class{constructor(e){vp(this,"input",[]),vp(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},Ek={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Ew={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ek,remoteCandidate:Ek},updateInterval:0},EO={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},EN={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},EP={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},ED={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let EL=class{constructor(e,t){vp(this,"onFirstVideoReceived",void 0),vp(this,"onFirstVideoDecoded",void 0),vp(this,"onFirstAudioReceived",void 0),vp(this,"onFirstVideoDecodedTimeout",void 0),vp(this,"onFirstAudioDecoded",void 0),vp(this,"onSelectedLocalCandidateChanged",void 0),vp(this,"onSelectedRemoteCandidateChanged",void 0),vp(this,"videoIsReady",!1),vp(this,"videoIsReady2",{}),vp(this,"pc",void 0),vp(this,"options",void 0),vp(this,"intervalTimer",void 0),vp(this,"stats",ER(Ew)),vp(this,"isFirstVideoReceived",{}),vp(this,"isFirstVideoDecoded",{}),vp(this,"isFirstAudioReceived",{}),vp(this,"isFirstAudioDecoded",{}),vp(this,"isFirstVideoDecodedTimeout",{}),vp(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new dJ(e=>{e({local:v_({},Ek),remote:v_({},Ek)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,r=0,i=0,n=0,o=0;for(let a of["videoSend","audioSend","videoRecv","audioRecv"])e[a].forEach((e,s)=>{if(!this.lossRateWindowStats[t-1][a][s]||!this.lossRateWindowStats[0][a][s])return;let c=this.lossRateWindowStats[t-1][a][s].packets-this.lossRateWindowStats[0][a][s].packets,d=this.lossRateWindowStats[t-1][a][s].packetsLost-this.lossRateWindowStats[0][a][s].packetsLost;"videoSend"===a||"audioSend"===a?(r+=c,n+=d):(i+=c,o+=d),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||d<=0?0:d/(c+d)});e.sendPacketLossRate=r<=0||n<=0?0:n/(r+n),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}},EM=class extends EL{constructor(){super(...arguments),vp(this,"_stats",Ew),vp(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=ER(Ew);let r=t.filter(e=>"ssrc"===e.type);this.processSSRCStats(r);let i=t.find(e=>"VideoBwe"===e.type);i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(e=>{var t;let r=o0(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(r?"send":"recv")){case"video_send":{let t=ER(EN);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{let t=ER(EO),r=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),r){let i=r.stats,n=Date.now()-r.lts;t.framesDecodeFreezeTime=i.framesDecodeFreezeTime,t.framesDecodeInterval=i.framesDecodeInterval,t.framesDecodeCount>i.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=n,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:v_({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{let t=ER(ED);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{let t=ER(EP);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t)}}})}_getStats(){return new dJ((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(e=>{let r={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(t=>{r[t]=e.stat(t)}),t.push(r)}),t}},Ex=((N={}).BANDWIDTH="bandwidth",N.CPU="cpu",N.NONE="none",N.OTHER="other",N),EU=((P={}).L1T1="L1T1",P.L1T2="L1T2",P.L1T3="L1T3",P.L1T3_KEY="L1T3_KEY",P.L2T1_KEY="L2T1_KEY",P.L2T2_KEY="L2T2_KEY",P.L2T3_KEY="L2T3_KEY",P.L3T1_KEY="L3T1_KEY",P.L3T2_KEY="L3T2_KEY",P.L3T3_KEY="L3T3_KEY",P),EB=((D={})[D.new=0]="new",D[D.connecting=1]="connecting",D[D.connected=2]="connected",D[D.disconnected=3]="disconnected",D[D.failed=4]="failed",D[D.closed=5]="closed",D),EV=((L={}).CERTIFICATE="certificate",L.CODEC="codec",L.CANDIDATE_PAIR="candidate-pair",L.LOCAL_CANDIDATE="local-candidate",L.REMOTE_CANDIDATE="remote-candidate",L.INBOUND="inbound-rtp",L.TRACK="track",L.OUTBOUND="outbound-rtp",L.PC="peer-connection",L.REMOTE_INBOUND="remote-inbound-rtp",L.REMOTE_OUTBOUND="remote-outbound-rtp",L.TRANSPORT="transport",L.CSRC="csrc",L.DATA_CHANNEL="data-channel",L.STREAM="stream",L.SENDER="sender",L.RECEIVER="receiver",L);var EF=((M=EF||{})[M.kNone=1]="kNone",M[M.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",M[M.kBytesToBits=8]="kBytesToBits",M);function Ej(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:EF.kNone;if(!t)return;let o=Number(t[r]);if("number"!=typeof o)return;let a=Number(t[i]);if("number"!=typeof a)return;if(!e)return a?o/a*n:void 0;let s=Number(e[r]);if("number"!=typeof s)return;let c=Number(e[i]);if("number"!=typeof c)return;let d=a-c;return d?(o-s)/d*n:void 0}let EG=class extends EL{constructor(){super(...arguments),vp(this,"_stats",Ew),vp(this,"report",void 0),vp(this,"lastDecodeVideoReceiverStats",new Map),vp(this,"lastVideoFramesRecv",new Map),vp(this,"lastVideoFramesSent",new Map),vp(this,"lastVideoFramesDecode",new Map),vp(this,"lastVideoFramesOutput",new Map),vp(this,"lastVideoJBDelay",new Map),vp(this,"lastAudioJBDelay",new Map),vp(this,"mediaBytesSent",new Map),vp(this,"mediaBytesRetransmit",new Map),vp(this,"mediaBytesTargetEncode",new Map),vp(this,"lastDecodeAudioReceiverStats",new Map),vp(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ER(Ew),this.report.forEach(e=>{switch(e.type){case EV.OUTBOUND:case EV.INBOUND:{let t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===EV.OUTBOUND?"audio"===t||i?this.processAudioOutboundStats(e):("video"===t||r)&&this.processVideoOutboundStats(e):e.type===EV.INBOUND&&("audio"===t||i?this.processAudioInboundStats(e):("video"===t||r)&&this.processVideoInboundStats(e));break}case EV.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case EV.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:v_({},Ek),remote:v_({},Ek)};return e.forEach(r=>{let i;if(r.type===EV.TRANSPORT&&(i=e.get(r.selectedCandidatePairId)),r.type===EV.CANDIDATE_PAIR&&r.selected&&(i=r),i){let r=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(i.localCandidateId){let n=e.get(i.localCandidateId);n&&r(t.local,n)}if(i.remoteCandidateId){let n=e.get(i.remoteCandidateId);n&&r(t.remote,n)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===EV.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===EV.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===EV.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(v_({},t),v_({},this.stats.selectedCandidatePair.localCandidate)),e.type===EV.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(v_({},t),v_({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(t=>t.ssrc===e.ssrc);t||(t=ER(ED),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Ej(r,t,"totalProcessingDelay","jitterBufferEmittedCount",EF.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,v_({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find(t=>t.ssrc===e.ssrc);t||(t=ER(EO),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let r=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),n=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let e=t.decodedFrame?t.decodedFrame.width:0,r=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,r),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){let i=r.stats,n=o-r.lts;t.framesDecodeFreezeTime=i.framesDecodeFreezeTime,t.framesDecodeInterval=i.framesDecodeInterval,this.isFirstVideoDecoded[t.ssrc]||!(n>this.options.firstVideoDecodedTimeout)||this.isFirstVideoDecodedTimeout[t.ssrc]||(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>i.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=n,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<i.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Ej(null==r?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Ej(null==r?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",EF.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Ej(null==r?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",EF.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Ej(null==r?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",EF.kMillisecondsFromSeconds),i&&o-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(n&&o-n.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-n.count)/((o-n.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):n?t.outputFrameRate=n.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:v_({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(t=>t.ssrc===e.ssrc);t||(t=ER(EN),this._stats.videoSend.push(t));let r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{let t=new EC(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){let t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{let t=new EC(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){let t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{let t=new EC(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){let r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let i=e.framesEncoded-r.lastFrameCount,n=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*n/i}}if(e.framesEncoded&&e.qpSum){let r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,EV.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(t=>t.ssrc===e.ssrc);if(t||(t=ER(EP),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,EV.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;let i=Array.from(d0(r=this.report).call(r)).find(r=>r.type===t&&r.ssrc===e);return i?i.id:null}processVideoMediaSource(e,t){let r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){let r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var i,n,o,a;let s=t?this.report.get(t):void 0,c=null!==(i=null==s?void 0:s.framesSent)&&void 0!==i?i:e.framesSent;if("number"!=typeof c)return;let d=null!==(n=null==s?void 0:s.frameWidth)&&void 0!==n?n:e.frameWidth,u=null!==(o=null==s?void 0:s.frameHeight)&&void 0!==o?o:e.frameHeight,l=null!==(a=null==s?void 0:s.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof d&&"number"==typeof u||(d=0,u=0),null==l){let e=Date.now(),t=this.lastVideoFramesSent.get(r.ssrc);t&&e-t.lts>=800?(l=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:e,rate:l})):t?l=t.rate:this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:e,rate:0})}r.sentFrame={width:d,height:u,frameRate:Math.max(0,l)}}processVideoTrackReceiverStats(e,t,r){var i,n,o,a,s;let c=t?this.report.get(t):void 0,d=null!==(i=null==c?void 0:c.framesReceived)&&void 0!==i?i:e.framesReceived,u=null!==(n=null==c?void 0:c.frameWidth)&&void 0!==n?n:e.frameWidth,l=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,h=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof d){let e=this.lastVideoFramesRecv.get(r.ssrc),t=Date.now();r.framesReceivedCount=d;let i=0;e&&t-e.lts>=800?(i=Math.round((d-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:t,rate:i})):e?i=e.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:t,rate:0}),r.receivedFrame={width:u||0,height:l||0,frameRate:i||0},r.decodedFrame={width:u||0,height:l||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:u||0,height:l||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(h&&p){let e=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},t=e.jitterBufferMs,i=p-e.jitterBufferEmittedCount;i>0&&(t=1e3*(h-e.jitterBufferDelay)/i),r.jitterBufferMs=t,r.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var i,n,o,a;let s=t?this.report.get(t):void 0,c=null!==(i=null!==(n=null==s?void 0:s.echoReturnLoss)&&void 0!==n?n:e.echoReturnLoss)&&void 0!==i?i:0,d=null!==(o=null!==(a=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==o?o:0;r.aecReturnLoss=c,r.aecReturnLossEnhancement=d}processAudioTrackReceiverStats(e,t,r){var i,n,o,a,s,c,d;let u=t?this.report.get(t):void 0,l=null!==(i=null==u?void 0:u.removedSamplesForAcceleration)&&void 0!==i?i:e.removedSamplesForAcceleration,h=null!==(n=null==u?void 0:u.totalSamplesReceived)&&void 0!==n?n:e.totalSamplesReceived,p=null!==(o=null==u?void 0:u.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,f=null!==(a=null==u?void 0:u.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,_=null!==(s=null==u?void 0:u.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,A=null!==(c=null==u?void 0:u.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,m=null!==(d=null==u?void 0:u.concealedSamples)&&void 0!==d?d:e.concealedSamples;if("number"==typeof h&&(r.totalSamplesReceived=h),l&&h&&(r.accelerateRate=l/h),p&&f){let e=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},t=e.jitterBufferMs,i=f-e.jitterBufferEmittedCount;i>0&&(t=1e3*(p-e.jitterBufferDelay)/i),r.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:f,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=_;let v=1920;A&&h&&(v=h/A/50,r.receivedFrames=Math.round(h/v)),m&&(r.droppedFrames=Math.round(m/v))}processRemoteInboundStats(e,t){let r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(t=>{e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(e=>{t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(e=>{r=null===r?e.diffMean():r+e.diffMean()});let i=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==r&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},EW=class extends EL{updateStats(){return dJ.resolve()}};function EH(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,o=function(){let e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return o?o<76?new EM(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):new EG(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):!function(e){var t;if(!window.RTCStatsReport)return!1;let r=e.getStats();return!!(r instanceof dJ||(t=r)&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then)}(e)?new EW(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):new EG(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n})}let EY="websdk_ng_install_id";function EK(){try{if(E4("INSTALL_ID"))return E4("INSTALL_ID");let e=window.localStorage.getItem(EY);return e||(e=Ei(),window.localStorage.setItem(EY,e)),E1("INSTALL_ID",e),e}catch(e){return}}let EQ=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let e=t[1],r=t[2];return"".concat(e,".").concat(r)}return"4.0.0.999"}("4.23.2-1"),Ez=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let EX=((x={}).Default="default",x.Auto="auto",x.Relay="relay",x.SdRtn="sd-rtn",x),EJ=function(){let e=["t","s","t"];e.splice(1,0,"e");let t=e.join(""),r=[];for(let e=0;e<6;e++)r.push("1");let i=r.join(""),n={};return n["us".concat("erna","me")]=t,n["pa".concat("sswo","rd")]=i,Object.assign(n,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=EJ;let Eq={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},EZ={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},E$="v4.23.2-1-0-g7fdaa39d-dirty(3/20/2025, 3:17:24 PM)",E0={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},E2=v_(v_(v_({},E0),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:EZ,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Eq),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function E1(e,t,r){var i,n,o;o0(i=Object.keys(E2)).call(i,e)&&(!r&&o0(n=Object.keys(E3)).call(n,e)||(E2[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS_METADATA"!==e||!0!==t||(E2.ENABLE_ENCODED_TRANSFORM=!0,"ENABLE_AUDIO_PTS_METADATA"===e&&(E2.ENABLE_AUDIO_METADATA=!0)),"USE_NEW_NETWORK_CONFIG"===e&&t&&(o=!!t,E2.USE_NEW_NETWORK_CONFIG=o,o&&(E2.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],E2.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],E2.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],E2.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],E2.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",E2.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",E2.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(E2.ENABLE_INSTANT_VIDEO=!0,E2.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(E2.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(E2.NEW_TURN_MODE||(E2.NEW_TURN_MODE=4))))}function E4(e){return E2[e]}Ez||(E2.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],E2.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],E2.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],E2.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],E2.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],E2.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],E2.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",E2.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",E2.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",E2.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",E2.AREAS=["NORTH_AMERICA","OVERSEA"]);let E6=((U={})[U.REALTIME=1]="REALTIME",U),E3={};var E8=((B=E8||{}).SET_SESSION_ID="SET_SESSION_ID",B.SET_P2P_ID="SET_P2P_id",B.SET_DC_ID="SET_DC_id",B.SET_UID="SET_UID",B.SET_INT_UID="SET_INT_UID",B.SET_PUB_ID="SET_PUB_ID",B.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",B.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",B.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",B.AVOID_JOIN_START="AVOID_JOIN_START",B.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",B.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",B.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",B.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",B.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",B.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",B.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",B.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",B.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",B.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",B.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",B.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",B.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",B.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",B.RESET_KEY_METRICS="RESET_KEY_METRICS",B.SET_USE_P2P="SET_USE_P2P",B.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",B);let E5=((V={}).h264="h264",V.h265="h265",V.vp8="vp8",V.vp9="vp9",V.av1="av1",V);(F={}).opus="opus",F.pcma="pcma",F.pcmu="pcmu",F.g722="g722";let E9=0;var E7=(()=>{var e={8:(e,t,r)=>{var i;let n;r.r(t),r.d(t,{Parser:()=>S,Printer:()=>I,parse:()=>O,print:()=>N});let o="".concat("\r").concat("\n");function a(e){return e>="0"&&e<="9"}function s(e){return e>="!"&&e<="~"}function c(e){return s(e)||e>="\x80"&&e<="\xff"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function l(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function h(e){return"d"===e||"h"===e||"m"===e||"s"===e}function p(e){return e>"\x01"&&e<"	"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function f(e){return l(e)||a(e)||"+"===e||"/"===e}function _(e){return a(e)||l(e)||"+"===e||"/"===e||"-"===e||"_"===e}function A(e){return l(e)||a(e)||"+"===e||"/"===e}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){E(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(i=n||(n={})).VERSION="v",i.ORIGIN="o",i.SESSION_NAME="s",i.INFORMATION="i",i.URI="u",i.EMAIL="e",i.PHONE="p",i.CONNECTION="c",i.BANDWIDTH="b",i.TIME="t",i.REPEAT="r",i.ZONE_ADJUSTMENTS="z",i.KEY="k",i.ATTRIBUTE="a",i.MEDIA="m";class g{consumeText(e,t){let r=t;for(;r<e.length;){let t=e[r];if("\0"===t||"\r"===t||"\n"===t)break;r+=1}if(r-t==0)throw Error("Invalid text, at ".concat(e));return r}consumeUnicastAddress(e,t,r){return this.consumeTill(e,t," ")}consumeOneOrMore(e,t,r){let i=t;for(;r(e[i]);)i++;if(i-t==0)throw Error("Invalid rule at ".concat(t,"."));return i}consumeSpace(e,t){if(" "===e[t])return t+1;throw Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let r=t;for(let t=0;t<4;t++)if(r=this.consumeDecimalUChar(e,r),3!==t){if("."!==e[r])throw Error("Invalid IP4 address.");r++}return r}consumeDecimalUChar(e,t){let r=t;for(let t=0;t<3&&a(e[r]);t++,r++);if(r-t==0)throw Error("Invalid decimal uchar.");let i=parseInt(e.slice(t,r));if(i>=0&&i<=255)return r;throw Error("Invalid decimal uchar")}consumeIP6Address(e,t){let r=this.consumeHexpart(e,t);return":"===e[r]?(r+=1,r=this.consumeIP4Address(e,r)):r}consumeHexpart(e,t){let r=t;if(":"===e[r]&&":"===e[r+1]){r+=2;try{r=this.consumeHexseq(e,r)}catch(e){}return r}if(r=this.consumeHexseq(e,r),":"===e[r]&&":"===e[r+1]){r+=2;try{r=this.consumeHexseq(e,r)}catch(e){}}return r}consumeHexseq(e,t){let r=t;for(;r=this.consumeHex4(e,r),":"===e[r]&&":"!==e[r+1];)r+=1;return r}consumeHex4(e,t){var r;let i=0;for(;i<4;i++)if(!((r=e[t+i])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===i)throw Error("Invalid hex 4");break}return t+i}consumeFQDN(e,t){let r=t;for(;a(e[r])||l(e[r])||"-"===e[r]||"."===e[r];)r+=1;if(r-t<4)throw Error("Invalid FQDN");return r}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,c)}consumeMulticastAddress(e,t,r){switch(r){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(r){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){let r=this.consumeHexpart(e,t);return"/"===e[r]?this.consumeInteger(e,r+1):r}consumeIP4MulticastAddress(e,t){let r=t+3,i=parseInt(e.slice(t,r));if(i<224||i>239)throw Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let t=0;t<3;t++){if("."!==e[r])throw Error("Invalid IP4 multicast address.");r+=1,r=this.consumeDecimalUChar(e,r)}return"/"===e[r]&&(r+=1),r=this.consumeTTL(e,r),"/"===e[r]&&(r=this.consumeInteger(e,r)),r}consumeInteger(e,t){if(!u(e[t]))throw Error("Invalid integer.");for(t+=1;a(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw Error("Invalid TTL.");t+=1;for(let r=0;r<2&&a(e[t]);r++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let r=t;if("0"===e[r])return r+1;for(u(e[r])&&(r+=1);a(e[r]);)r++;if(r-t<10)throw Error("Invalid time");return r}consumeAddress(e,t){return this.consumeTill(e,t," ")}consumeTypedTime(e,t){let r=t;return r=this.consumeOneOrMore(e,r,a),h(e[r])?r+1:r}consumeRepeatInterval(e,t){if(!u(e[t]))throw Error("Invalid repeat interval");for(t+=1;a(e[t]);)t+=1;return h(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,a)}consume(e,t,r){for(let i=0;i<r.length;i++){if(t+i>=e.length)throw Error("consume exceeding value length");if(e[t+i]!==r[i])throw Error("consume ".concat(r," failed at ").concat(i))}return t+r.length}consumeTill(e,t,r){let i=t;for(;i<e.length&&("string"!=typeof r||e[i]!==r)&&("function"!=typeof r||!r(e[i]));)i++;return i}}class S extends g{constructor(){super(),E(this,"records",[]),E(this,"currentLine",0)}parse(e){let t=this.probeEOL(e);this.records=e.split(t).filter(e=>!!po(e).call(e)).map(this.parseLine),this.currentLine=0;let r=this.parseVersion(),i=this.parseOrigin(),n=this.parseSessionName(),o=this.parseInformation(),a=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),d=this.parseConnection(),u=this.parseBandWidth(),l=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw Error("parsing failed, non exhaustive sdp lines.");return{version:r,origin:i,sessionName:n,information:o,uri:a,emails:s,phones:c,connection:d,bandwidths:u,timeFields:l,key:h,attributes:p,mediaDescriptions:f}}getCurrentRecord(){let e=this.records[this.currentLine];if(!e)throw Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if("\n"===e[t])return"\r"===e[t-1]?o:"\n";throw Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let r=e[0];if("="!==e[1])throw Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:r,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){let e=new T;for(;this.currentLine<this.records.length;){let t=this.getCurrentRecord();if(t.type!==n.ATTRIBUTE)break;let r={attField:this.extractOneOrMore(t,e=>d(e)&&":"!==e),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,r.attValue=this.extractOneOrMore(t,p)),e.parse(r),this.currentLine++}return e.digest()}parseMediaAttributes(e){let t=new y(e);for(;this.currentLine<this.records.length;){let e=this.getCurrentRecord();if(e.type!==n.ATTRIBUTE)break;let r={attField:this.extractOneOrMore(e,e=>d(e)&&":"!==e),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,r.attValue=this.extractOneOrMore(e,p)),t.parse(r),this.currentLine++}return t.digest()}parseKey(){let e=this.getCurrentRecord();if(e.type===n.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,Error("Invalid key.")}}parseZone(){let e=this.getCurrentRecord();if(e.type===n.ZONE_ADJUSTMENTS){let t=[];for(;;)try{let r=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let i=!1;"-"===e.value[e.cur]&&(i=!0,e.cur+=1);let n=this.extract(e,this.consumeTypedTime);t.push({time:r,typedTime:n,back:i})}catch(e){break}if(0===t.length)throw Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==n.REPEAT)break;{let r=this.extract(t,this.consumeRepeatInterval),i=this.parseTypedTime(t);e.push({repeatInterval:r,typedTimes:i}),this.currentLine++}}return e}parseTypedTime(e){let t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw Error("Invalid typed time.");return t}parseTime(){let e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:r}}parseBandWidth(){let e=[];for(;this.currentLine<this.records.length;){let t=this.getCurrentRecord();if(t.type!==n.BANDWIDTH)break;{let r=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw Error("Invalid bandwidth field.");t.cur++;let i=this.extractOneOrMore(t,a);e.push({bwtype:r,bandwidth:i}),this.currentLine++}}return e}parseVersion(){let e=this.getCurrentRecord();if(e.type!==n.VERSION)throw Error("first sdp record must be version");let t=e.value.slice(0,this.consumeOneOrMore(e.value,0,a));if(t.length!==e.value.length)throw Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){let e=this.getCurrentRecord();if(e.type!==n.ORIGIN)throw Error("second line of sdp must be origin");let t=this.extractOneOrMore(e,c);this.consumeSpaceForRecord(e);let r=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);let i=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);let o=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let s=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let u=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:r,sessVersion:i,nettype:o,addrtype:s,unicastAddress:u}}parseSessionName(){let e=this.getCurrentRecord();if(e.type===n.SESSION_NAME){let t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){let e=this.getCurrentRecord();if(e.type!==n.INFORMATION)return;let t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){let e=this.getCurrentRecord();if(e.type===n.URI)return this.currentLine++,e.value}parseEmail(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==n.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==n.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){let e=this.getCurrentRecord();if(e.type===n.CONNECTION){let t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let r=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let i=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:r,address:i}}}parseMedia(){let e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let r=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,r+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);let i=[];for(i.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,i.push(this.extract(e,this.consumeToken));if(0===i.length)throw Error("Invalid proto");let n=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:r,protos:i,fmts:n}}parseTimeFields(){let e=[];for(;this.getCurrentRecord().type===n.TIME;){let t=this.parseTime(),r=this.parseRepeat(),i=this.parseZone();e.push({time:t,repeats:r,zones:i})}return e}parseMediaDescription(){let e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===n.MEDIA;){let t=this.parseMedia(),r=this.parseInformation(),i=this.parseConnections(),n=this.parseBandWidth(),o=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:r,connections:i,bandwidths:n,key:o,attributes:a})}return e}parseConnections(){let e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===n.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){let t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw Error("Invalid fmts");return t}extract(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];let o=t.call(this,e.value,e.cur,...i),a=e.value.slice(e.cur,o);return e.cur=o,a}extractOneOrMore(e,t){let r=this.consumeOneOrMore(e.value,e.cur,t),i=e.value.slice(e.cur,r);return e.cur=r,i}consumeSpaceForRecord(e){if(" "!==e.value[e.cur])throw Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class b extends g{constructor(){super(...arguments),E(this,"attributes",void 0),E(this,"digested",!1)}extractOneOrMore(e,t,r){let i=this.consumeOneOrMore(e.attValue,e._cur,t),n=e.attValue.slice(e._cur,i),[o,a]=r||[];if("number"==typeof o&&n.length<o)throw Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof a&&n.length>a)throw Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=i,n}consumeAttributeSpace(e){if(" "!==e.attValue[e._cur])throw Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw Error("Nothing to extract from attValue.");for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];let o=t.call(this,e.attValue,e._cur,...i),a=e.attValue.slice(e._cur,o);return e._cur=o,a}atEnd(e){if(!e.attValue)throw Error();return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw Error();return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw Error();for(let r=0;r<t.length;r++)if(t[r]!==e.attValue[e._cur+r])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,f,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,f,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw Error("Invalid ice-options, should be only one 'ice-options' line");let t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,f));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:r})}parseExtmap(e){let t;let r=this.extractOneOrMore(e,a);"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),t=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeTill," "),n=v(v({entry:parseInt(r,10)},t&&{direction:t}),{},{extensionName:i});" "===this.peekChar(e)&&(this.consumeAttributeSpace(e),n.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(n)}parseSetup(e){if(this.attributes.setup)throw Error("must only be one single 'a=setup' line.");let t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class T extends b{constructor(){super(...arguments),E(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){let t=this.extract(e,this.consumeToken),r=[];for(;!this.atEnd(e)&&" "===this.peekChar(e);)this.consumeAttributeSpace(e),r.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:r})}parseIceLite(){if(this.attributes.iceLite)throw Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,_)}parseIdentity(e){let t=this.extractOneOrMore(e,A),r=[];for(;!this.atEnd(e)&&" "===this.peekChar(e);){this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");let i=this.extractOneOrMore(e,e=>" "!==e&&p(e));r.push({name:t,value:i})}this.attributes.identities.push({assertionValue:t,extensions:r})}parseMsidSemantic(e){" "===this.peekChar(e)&&this.consumeAttributeSpace(e);let t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{let r=this.extract(e,this.consumeTill," ");t.identifierList.push(r)}}this.attributes.msidSemantic=t}}class y extends b{constructor(e){super(),E(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw Error("attribute parsing error")}parseCandidate(e){let t=this.extractOneOrMore(e,f,[1,32]);this.consumeAttributeSpace(e);let r=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let n=this.extractOneOrMore(e,a,[1,10]);this.consumeAttributeSpace(e);let o=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);let c=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);let d={foundation:t,componentId:r,transport:i,priority:n,connectionAddress:o,port:c,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));" "===this.peekChar(e);){this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,s)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){let t=[];for(;;){let r=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);let n=this.extract(e,this.consumePort);t.push({componentId:r,connectionAddress:i,port:n});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");let i={encodingName:r,clockRate:this.extractOneOrMore(e,a)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),i.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));let n=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));n?n.rtpMap=i:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:i,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){let t;let r=this.extractOneOrMore(e,a);this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeTill,":");":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),t=this.extract(e,this.consumeTill));let n=this.attributes.ssrcs.find(e=>e.ssrcId===parseInt(r,10));n?n.attributes[i]=t:this.attributes.ssrcs.push({ssrcId:parseInt(r,10),attributes:{[i]:t}})}parseFmtp(e){let t=this.extract(e,this.consumeTill," ");this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeTill),i={};r.split(";").forEach(e=>{let[t,r]=e.split("=");t=po(t).call(t);let n="string"==typeof r?po(r).call(r):null;"string"==typeof t&&t.length>0&&(i[t]=n)});let n=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));n?n.fmtp={parameters:i}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:i}})}parseFmtParameters(e){let t={},r=this.extract(e,this.consumeTill,"=");e._cur++;let i=this.extract(e,this.consumeTill,";");for(t[r]=i;";"===e.attValue[e._cur];){let r=this.extract(e,this.consumeTill,"=");e._cur++;let i=this.extract(e,this.consumeTill,";");t[r]=i}return t}parseRtcpFb(e){let t,r="";r="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill," "),this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeTill," ");if("trr-int"===i)t={type:i,interval:this.extract(e,this.consumeTill)};else{let r={type:i};" "===this.peekChar(e)&&(this.consumeAttributeSpace(e),r.parameter=this.extract(e,this.consumeToken)," "===this.peekChar(e)&&(r.additional=this.extract(e,this.consumeTill))),t=r}if("*"===r)this.attributes.rtcpFeedbackWildcards.push(t);else{let e=this.attributes.payloads.find(e=>e.payloadType===parseInt(r,10));e?e.rtcpFeedbacks.push(t):this.attributes.payloads.push({payloadType:parseInt(r,10),rtcpFeedbacks:[t]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw Error("must be single line of rtcp");let t={port:this.extract(e,this.consumePort)};" "===this.peekChar(e)&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){let t={id:this.extractOneOrMore(e,d,[1,64])};" "===this.peekChar(e)&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){let t=this.extractOneOrMore(e,e=>l(e)||a(e)||"_"===e||"-"===e);this.consumeAttributeSpace(e);let r={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(" "===this.peekChar(e)){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");let t=[];for(;;){let r=this.extract(e,this.consumeToken);t.push(r);try{this.extract(e,this.consume,",")}catch(e){break}}r.payloads=t," "===this.peekChar(e)&&this.extract(e,this.consume," ")}for(;;){let t=this.extract(e,this.consumeToken);if("depend"===t){let i={type:t,rids:this.extract(e,this.consume,"=").split(",")};r.params.push(i)}else{let i={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),i.val=this.extract(e,this.consumeTill,";")),r.params.push(i)}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(r)}parseSimulcast(e){if(this.attributes.simulcast)throw Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,a,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){let t=this.extract(e,this.consumeToken),r=[];for(;;)try{this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeInteger);r.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:r})}}function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class I{constructor(){R(this,"eol",o)}print(e,t){let r="";return t&&(this.eol=t),r+=this.printVersion(e.version),r+=this.printOrigin(e.origin),r+=this.printSessionName(e.sessionName),r+=this.printInformation(e.information),r+=this.printUri(e.uri),r+=this.printEmail(e.emails),r+=this.printPhone(e.phones),r+=this.printConnection(e.connection),r+=this.printBandwidth(e.bandwidths),r+=this.printTimeFields(e.timeFields),r+=this.printKey(e.key),r+=this.printSessionAttributes(e.attributes),r+=this.printMediaDescription(e.mediaDescriptions)}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(let r of e)t+="e=".concat(r).concat(this.eol);return t}printPhone(e){let t="";for(let r of e)t+="e=".concat(r).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(let r of e)t+="b=".concat(r.bwtype,":").concat(r.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(let r of e){for(let e of(t+="t=".concat(r.time.startTime," ").concat(r.time.startTime).concat(this.eol),r.repeats))t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);r.zoneAdjustments&&(t+="z=",t+="z=".concat(r.zoneAdjustments.map(e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(let r of e)t+="a=".concat(r.attField).concat(r.attValue?":".concat(r.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(let r of e)t+=this.printMedia(r.media),t+=this.printInformation(r.information),t+=this.printConnections(r.connections),t+=this.printBandwidth(r.bandwidths),t+=this.printKey(r.key),t+=this.printMediaAttributes(r);return t}printConnections(e){let t="";for(let r of e)t+=this.printConnection(r);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new k(this.eol).print(e)}printMediaAttributes(e){return new w(this.eol).print(e)}}class C{constructor(e){R(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(" ")).concat(this.eol)}printFingerprints(e){return e.length>0?e.map(e=>"a=fingerprint:".concat(e.hashFunction).concat(" ").concat(e.fingerprint)).join(this.eol)+this.eol:""}printExtmap(e){return e.map(e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(" ").concat(e.extensionName).concat(e.extensionAttributes?"".concat(" ").concat(e.extensionAttributes):"").concat(this.eol)).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map(e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol)).join("")}}class k extends C{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized)}printGroups(e){let t="";return e.length>0&&(t+=e.map(e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map(e=>"".concat(" ").concat(e)).join("")).concat(this.eol)).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map(e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map(e=>"".concat(" ").concat(e.name).concat(e.value?"=".concat(e.value):"")))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(" ","*"):e.identifierList.length>0&&(t+=e.identifierList.map(e=>"".concat(" ").concat(e))),t+this.eol}}class w extends C{print(e){let t=e.attributes,r="";return r+=this.printRTCP(t.rtcp),r+=this.printIceUfrag(t.iceUfrag),r+=this.printIcePwd(t.icePwd),r+=this.printIceOptions(t.iceOptions),r+=this.printCandidates(t.candidates),r+=this.printRemoteCandidatesList(t.remoteCandidatesList),r+=this.printEndOfCandidates(t.endOfCandidates),r+=this.printFingerprints(t.fingerprints),r+=this.printSetup(t.setup),r+=this.printMid(t.mid),r+=this.printExtmap(t.extmaps),r+=this.printRTPRelated(t),r+=this.printPtime(t.ptime),r+=this.printMaxPtime(t.maxPtime),r+=this.printDirection(t.direction),r+=this.printSSRCGroups(t.ssrcGroups),r+=this.printSSRC(t.ssrcs),r+=this.printRTCPMux(t.rtcpMux),r+=this.printRTCPMuxOnly(t.rtcpMuxOnly),r+=this.printRTCPRsize(t.rtcpRsize),r+=this.printMSId(t.msids),r+=this.printImageattr(t.imageattr),r+=this.printRid(t.rids),r+=this.printSimulcast(t.simulcast),r+=this.printSCTPPort(t.sctpPort),r+=this.printMaxMessageSize(t.maxMessageSize),r+=this.printUnrecognized(t.unrecognized)}printCandidates(e){return e.map(e=>"a=candidate:".concat(e.foundation).concat(" ").concat(e.componentId).concat(" ").concat(e.transport).concat(" ").concat(e.priority).concat(" ").concat(e.connectionAddress).concat(" ").concat(e.port).concat(" ","typ").concat(" ").concat(e.type).concat(e.relAddr?"".concat(" ","raddr").concat(" ").concat(e.relAddr):"").concat(e.relPort?"".concat(" ","rport").concat(" ").concat(e.relPort):"").concat(Object.keys(e.extension).map(t=>"".concat(" ").concat(t).concat(" ").concat(e.extension[t])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(e){return e.map(e=>"a=remote-candidates:".concat(e.join(" ")).concat(this.eol)).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";let t=e.payloads,r="";for(let i of(r+=e.rtcpFeedbackWildcards.map(e=>this.printRTCPFeedback("*",e)).join(""),t))r+=this.printRtpMap(i.payloadType,i.rtpMap),r+=this.printFmtp(i.payloadType,i.fmtp),r+=i.rtcpFeedbacks.map(e=>this.printRTCPFeedback(i.payloadType,e)).join("");return r}printFmtp(e,t){if(!t)return"";let r=Object.keys(t.parameters);return 1===r.length&&null===t.parameters[r[0]]?"a=fmtp:".concat(e).concat(" ").concat(r[0]).concat(this.eol):"a=fmtp:".concat(e).concat(" ").concat(Object.keys(t.parameters).map(e=>"".concat(e,"=").concat(t.parameters[e])).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(" ").concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let r="a=rtcp-fb:".concat(e).concat(" ");return"trr-int"===t.type?r+="ttr-int".concat(" ").concat(t.interval):(r+="".concat(t.type),t.parameter&&(r+="".concat(" ").concat(t.parameter),t.additional&&(r+="".concat(" ").concat(t.additional)))),r+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map(e=>Object.keys(e.attributes).map(t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(" ").concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol)).join("")).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(" ").concat(e.netType)),e.addressType&&(t+="".concat(" ").concat(e.addressType)),e.address&&(t+="".concat(" ").concat(e.address)),t+this.eol}printMSId(e){return e.map(e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(" ").concat(e.appdata):"").concat(this.eol)).join("")}printImageattr(e){return e.map(e=>"a=imageattr:".concat(e).concat(this.eol)).join("")}printRid(e){return e.map(e=>{let t="a=rid:".concat(e.id).concat(" ").concat(e.direction);return e.payloads&&(t+="".concat(" ","pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(" ").concat(e.params.map(e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)).join(";"))),t+this.eol}).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map(e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map(e=>"".concat(" ").concat(e.toString(10))).join("")).concat(this.eol)).join("")}}function O(e){return(new S).parse(e)}function N(e,t){return(new I).print(e,t)}}},t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}return r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(8)})();function ge(e){return E7.parse(e)}function gt(e,t){return E7.print(e,t)}var gr=oM("Array").keys,gi=Array.prototype,gn={DOMTokenList:!0,NodeList:!0},go=iB(function(e){var t=e.keys;return e===gi||iY(gi,e)&&t===gi.keys||nH(gn,oY(e))?gr:t});function ga(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function gc(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gs(Object(r),!0).forEach(function(t){ga(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gs(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let gd=new class extends vP{constructor(){super(...arguments),ga(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class gu{constructor(e){ga(this,"logger",void 0),ga(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function gl(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function gh(){let e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let gp={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},gf=Date.now(),g_=e=>{for(let t in gp)if(Object.prototype.hasOwnProperty.call(gp,t)&&gp[t]===e)return t;return"DEFAULT"},gA=new class{constructor(){ga(this,"proxyServerURL",void 0),ga(this,"logLevel",gp.DEBUG),ga(this,"uploadState","collecting"),ga(this,"uploadLogWaitingList",[]),ga(this,"uploadLogUploadingList",[]),ga(this,"uploadErrorCount",0),ga(this,"currentLogID",0),ga(this,"url",void 0),ga(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[gp.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[gp.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[gp.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[gp.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[gp.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){E1("UPLOAD_LOG",!0)}disableLogUpload(){E1("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new gu(this).prefix(e)}log(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-gf<100)return void setTimeout(()=>{this.log(...t)},Date.now()-gf);let i=Math.max(0,Math.min(4,t[0]));if(t[0]=gl()+" Agora-SDK [".concat(g_(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;let n=gl()+" %cAgora-SDK [".concat(g_(i),"]:"),o=[];if(!E4("USE_NEW_LOG"))switch(i){case gp.DEBUG:o=[n,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case gp.INFO:o=[n,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case gp.WARNING:o=[n,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case gp.ERROR:o=[n,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-gf<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-gf);let i=Math.max(0,Math.min(4,t[0]));t[0]=gl()+" Agora-SDK [".concat(g_(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!E4("UPLOAD_LOG"))return;for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];Array.isArray(r[0])?r[0][0]=gh()+" Agora-SDK [".concat(g_(e),"]:"):r[0]=gh()+" Agora-SDK [".concat(g_(e),"]:");let n="";r.forEach(e=>{"object"==typeof e&&(e=JSON.stringify(e)),n+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:EQ,process_id:E4("PROCESS_ID"),payload:JSON.stringify(e)};return Em(async()=>{let e=await mU.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(E4("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(E4("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){let t=Error("unexpected upload log response");throw t.response=e,t}},()=>(this.uploadLogUploadingList=[],!1),t=>{let r={status:-1,message:t.message,errorRange:e.map(e=>e.log_item_id)};return t.response?(r.status=t.response.status,r.data=t.response.data,r.headers=t.response.headers):t.request&&(r.status=t.request.status),gd.reportLogUploadError(r),!0},{timeout:E4("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:E4("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,E4("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),E4("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),E4("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),E4("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};function gm(e){return vb(e.reportId,"params.reportId",0,100,!1),vb(e.category,"params.category",0,100,!1),vb(e.event,"params.event",0,100,!1),vb(e.label,"params.label",0,100,!1),vg(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(tA={}).FREE="free",tA.UPLOADING="uploading",(j={})[j.MISC=0]="MISC",j[j.INTERNAL_EVENT=1]="INTERNAL_EVENT",j[j.PUBLIC_EVENT=2]="PUBLIC_EVENT",j[j.WEB_EVENT=3]="WEB_EVENT",j[j.INTERNAL_API=4]="INTERNAL_API",j[j.WEB_API=5]="WEB_API",j[j.PUBLIC_API=6]="PUBLIC_API";let gv={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let gE=((G={}).PUBLISH="publish",G.SUBSCRIBE="subscribe",G.WS_COMPRESSOR_INIT="ws_compressor_init",G.SESSION_INIT="session_init",G.JOIN_CHOOSE_SERVER="join_choose_server",G.REQ_USER_ACCOUNT="req_user_account",G.JOIN_GATEWAY="join_gateway",G.REJOIN_GATEWAY="rejoin_gateway",G.STREAM_SWITCH="stream_switch",G.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",G.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",G.FIRST_VIDEO_RECEIVED="first_video_received",G.FIRST_AUDIO_RECEIVED="first_audio_received",G.FIRST_VIDEO_DECODE="first_video_decode",G.FIRST_AUDIO_DECODE="first_audio_decode",G.ON_ADD_AUDIO_STREAM="on_add_audio_stream",G.ON_ADD_VIDEO_STREAM="on_add_video_stream",G.ON_UPDATE_STREAM="on_update_stream",G.ON_REMOVE_STREAM="on_remove_stream",G.USER_ANALYTICS="req_user_analytics",G.PC_STATS="pc_stats",G.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",G.AB_TEST="ab_test",G),gg=((W={}).SESSION="io.agora.pb.Wrtc.Session",W.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",W.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",W.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",W.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",W.PUBLISH="io.agora.pb.Wrtc.Publish",W.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",W.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",W.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",W.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",W.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",W.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",W.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",W.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",W.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",W.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",W.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",W.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",W.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",W.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",W.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",W.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",W.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",W.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",W.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",W.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",W.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",W.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",W.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",W.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",W.PC_STATS="io.agora.pb.Wrtc.PCStats",W.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",W.AB_TEST="io.agora.pb.Wrtc.ABTest",W);(H={})[H.WORKER_EVENT=156]="WORKER_EVENT",H[H.AP_WORKER_EVENT=160]="AP_WORKER_EVENT";let gS=((Y={})[Y.SESSION=26]="SESSION",Y[Y.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",Y[Y.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",Y[Y.JOIN_GATEWAY=28]="JOIN_GATEWAY",Y[Y.PUBLISH=30]="PUBLISH",Y[Y.SUBSCRIBE=29]="SUBSCRIBE",Y[Y.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",Y[Y.STREAM_SWITCH=32]="STREAM_SWITCH",Y[Y.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",Y[Y.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",Y[Y.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",Y[Y.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",Y[Y.API_INVOKE=41]="API_INVOKE",Y[Y.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",Y[Y.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",Y[Y.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",Y[Y.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",Y[Y.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",Y[Y.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",Y[Y.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",Y[Y.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",Y[Y.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",Y[Y.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",Y[Y.WORKER_EVENT=156]="WORKER_EVENT",Y[Y.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",Y[Y.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",Y[Y.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",Y[Y.USER_ANALYTICS=1e4]="USER_ANALYTICS",Y[Y.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",Y);function gb(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r,i){let n=i.value;if("function"==typeof n){let o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);i.value=function(){for(var t,i=arguments.length,a=Array(i),s=0;s<i;s++)a[s]=arguments[s];let c=a;if(e.argsMap)try{c=e.argsMap(this,...a)}catch(e){gA.warning(e),c=[]}try{JSON.stringify(c)}catch(e){gA.warning("arguments for method ".concat(o,".").concat(String(r)," not serializable for apiInvoke.")),c=[]}let d=(e.report||gT).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(o,".").concat(String(r)),options:c,tag:vx.TRACER,reportResult:e.reportResult},e.throttleTime);try{let t=n.apply(this,a);return t instanceof dJ?t.then(t=>(d.onSuccess(e.reportResult&&t),t)).catch(e=>{throw d.onError(e),e}):(d.onSuccess(e.reportResult&&t),t)}catch(e){throw d.onError(e),e}}}return i}}let gT=new class{constructor(){ga(this,"baseInfoMap",new Map),ga(this,"proxyServer",void 0),ga(this,"eventUploadTimer",void 0),ga(this,"setSessionIdTimer",void 0),ga(this,"url",void 0),ga(this,"sids",new Set),ga(this,"backupUrl",void 0),ga(this,"_appId",void 0),ga(this,"_aid",0),ga(this,"keyEventUploadPendingItems",[]),ga(this,"normalEventUploadPendingItems",[]),ga(this,"apiInvokeUploadPendingItems",[]),ga(this,"apiInvokeCount",0),ga(this,"apiInvokeLoggedCount",0),ga(this,"ltsList",[]),ga(this,"lastSendNormalEventTime",Date.now()),ga(this,"customReportCounterTimer",void 0),ga(this,"customReportCount",0),ga(this,"extApiInvoke",async e=>{for(let t of e){let e=gc(gc({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:vx.TRACER});this.sendApiInvoke(e)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),E4("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),E4("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,e=>{let[t,r]=e;return t+r}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;let i=Date.now();this.apiInvokeCount+=1;let n=this.apiInvokeCount,o=!!E4("SHOW_REPORT_INVOKER_LOG"),a=!!E4("SHOW_REPORT_USER_INVOKER_LOG"),s=o||a&&t.id;s&&(this.apiInvokeLoggedCount+=1);let c=this.apiInvokeLoggedCount;function d(e,r){if(s){let i="[apiInvoke-".concat(c,"]");t.id&&(i+="[".concat(t.id,"]")),t.name&&(i+="[".concat(t.name,"]")),gA.info("".concat(i," ").concat(e),"start"===e?t.options:r||"")}}let u=()=>({tag:t.tag,invokeId:n,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});d("start");let l=!1;Et(t.timeout).then(()=>{l||(this.sendApiInvoke(gc(gc({},u()),{},{error:vA.API_INVOKE_TIMEOUT,success:!1})),d("timeout"))});let h=new vm(vA.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{let i=()=>{if(l)throw h;return l=!0,this.sendApiInvoke(gc(gc({},u()),{},{success:!0},t.reportResult&&{result:e})),d("onSuccess"),e};return r?Ea(i,t.name+"Success",r,()=>l=!0):i()},onError:e=>{let i=()=>{if(l)throw e;l=!0,this.sendApiInvoke(gc(gc({},u()),{},{success:!1,error:e})),d("onFailure",e.toString())};return r?Ea(i,t.name+"Error",r,()=>l=!0):i()}}}sessionInit(e,t){var r;if(this.baseInfoMap.has(e))return;let i=Date.now(),n=this.createBaseInfo(e,i);n.cname=t.cname;let o=Object.assign({},{willUploadConsoleLog:E4("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Ez?"global":"oversea",areas:E4("AREAS")&&E4("AREAS").join(",")},t.extend),{stringUid:a,channelProfile:s,channelMode:c,isABTestSuccess:d,lsid:u,clientRole:l}=t,h=Date.now(),p=gc(gc({},n),{},{eventType:gE.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:E$,lts:h,elapse:h-i,extend:JSON.stringify(o),mode:t.mode,process:E4("PROCESS_ID"),appType:E4("APP_TYPE"),success:!0,version:EQ,stringUid:a,channelProfile:s,channelMode:c,isABTestSuccess:d,lsid:u,clientType:o0(r=window.navigator.userAgent).call(r,"AgoraWebView")?42:20,clientRole:l,serviceId:E4("PROCESS_ID"),extensionID:E4("PLUGIN_INFO").join(",")||""});this.send({type:gg.SESSION,data:p},!0)}joinChooseServer(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc({},i),{},{role:t.role,eventType:gE.JOIN_CHOOSE_SERVER,lts:n,eventElapse:t.elapse||n-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:n-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:gg.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc({},i),{},{eventType:gE.REQ_USER_ACCOUNT,lts:n,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||n-r.startTime,eventElapse:n-t.lts,extend:JSON.stringify(t.extend)});this.send({type:gg.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;let n=Date.now(),{firstSuccess:o,avoidJoinStartTime:a,addr:s,isProxy:c}=t,d=n-(o&&a?a:r.startTime),u=gc(gc({},i),{},{eventType:gE.JOIN_GATEWAY,lts:n,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:d,eventElapse:n-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:EK(),isABTestSuccess:t.isABTestSuccess?1:0}),l=u.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=n),o)this.send({type:gg.JOIN_GATEWAY,data:u},!0);else{let e;if(s){if(c){let t=s.match(/h=(\d{1,3}-){3}\d{1,3}/g),r=s.match(/p=[0-9]{1,6}/g);e={isSuccess:l,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:r&&r.length?r[0].split("=")[1]:"",isProxy:c?1:0}}else{let t=s.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),r=s.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:l,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:r&&r.length?r[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}}else e={isSuccess:l,gatewayIp:"",port:"",isProxy:c?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);let t=Object.assign({},u,e,{eventType:gE.REJOIN_GATEWAY});this.send({type:gg.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=Date.now(),n=gc(gc({},r.info),{},{lts:i,timeout:t,elapse:i-r.startTime});this.send({type:gg.JOIN_CHANNEL_TIMEOUT,data:n},!0)}publish(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc({},i),{},{eventType:gE.PUBLISH,lts:n,eventElapse:t.eventElapse,elapse:n-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:gg.PUBLISH,data:o},!0)}subscribe(e,t,r){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,o=Date.now(),a=gc(gc({},n),{},{eventType:gE.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:gg.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;let r=[...go(t=this.baseInfoMap).call(t)],i=r.length?r[0]:"UnableToGetSid",n=this.baseInfoMap.get(i);if(!n)return;let o=n.info,a=Date.now(),s=gc(gc({},o),{},{eventType:gE.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-n.startTime,status:e.status?1:2});this.send({type:gg.WS_COMPRESSOR_INIT,data:s},!0)}firstRemoteVideoDecode(e,t,r,i){let n=this.baseInfoMap.get(e);if(!n)return;let o=n.info,a=Date.now(),s=gc(gc(gc({},o),i),{},{elapse:a-n.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((i.firstFrame||a)-n.startTime,0),apEnd:Math.max(i.apEnd-n.startTime,0),apStart:Math.max(i.apStart-n.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-n.startTime,0),joinGwStart:Math.max(i.joinGwStart-n.startTime,0),pcEnd:Math.max(i.pcEnd-n.startTime,0),pcStart:Math.max(i.pcStart-n.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-n.startTime,0),subscriberStart:Math.max(i.subscriberStart-n.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-n.startTime,0)});this.send({type:r,data:s},!0)}firstRemoteFrame(e,t,r,i){let n=this.baseInfoMap.get(e);if(!n)return;let o=n.info,a=Date.now(),s=gc(gc(gc({},o),i),{},{elapse:a-n.startTime,eventType:t,lts:a});this.send({type:r,data:s},!0)}abTest(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc(gc({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),elapse:n-r.startTime,eventType:gE.AB_TEST,lts:n});this.send({type:gg.AB_TEST,data:o},!0)}pcStats(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc(gc({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),elapse:n-r.startTime,eventType:gE.PC_STATS,lts:n,preallocation:t.preallocation?1:0});this.send({type:gg.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc(gc({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),eventType:gE.UPDATE_REMOTE_RTPCAPABILITIES,lts:n});this.send({type:gg.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,r,i){let n=this.baseInfoMap.get(e);if(!n)return;let o=n.info,a=Date.now(),s=gc(gc(gc({},o),i),{},{eventType:t,lts:a});this.send({type:r,data:s},!0)}streamSwitch(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc({},i),{},{eventType:gE.STREAM_SWITCH,lts:n,isDual:t.isdual,elapse:n-r.startTime,success:t.succ});this.send({type:gg.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc({},i),{},{eventType:gE.REQUEST_PROXY_APPCENTER,lts:n,eventElapse:n-t.lts,elapse:n-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:gg.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc({},i),{},{eventType:gE.REQUEST_PROXY_WORKER_MANAGER,lts:n,eventElapse:n-t.lts,elapse:n-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:gg.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?gA.debug("reportProxyServerurl: ".concat(e)):gA.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:n,elapse:n-r.startTime,joinChannelSuccessElapse:n-(r.lastJoinSuccessTime||n),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:gg.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now();(function(e,t,r){let i=e[t];if(!i||"string"!=typeof i)return[e];e[t]="";let n=v7(JSON.stringify(e)),o=0,a=[],s=0;for(let r=0;r<i.length;r++)(s+=127>=i.charCodeAt(r)?1:3)<=1300-n||(a[a.length]=v_(v_({},e),{},{[t]:i.substring(o,r)}),o=r,s=127>=i.charCodeAt(r)?1:3);return o!==i.length-1&&(a[a.length]=v_(v_({},e),{},{[t]:i.substring(o)})),a})(gc(gc(gc({},i),t),{},{elapse:n-r.startTime,lts:n,productType:"WebRTC"}),"payload",1300).forEach(e=>this.send({type:gg.WORKER_EVENT,data:e},!0))}apworkerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc(gc({},i),t),{},{elapse:n-r.startTime,lts:n});this.send({type:gg.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc(gc({},i),t),{},{elapse:n-r.startTime,lts:n,extend:t.extend||void 0});this.send({type:gg.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=gc(gc(gc({},i),t),{},{elapse:n-r.startTime,lts:n});this.send({type:gg.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>E4("CUSTOM_REPORT_LIMIT"))throw new vm(vA.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let r=Date.now(),i=t.map(t=>({type:gg.USER_ANALYTICS,data:gc(gc({sid:e},t),{},{lts:r})}));try{E4("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(e){throw gA.error("send custom report message failed",e.toString()),new vm(vA.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){let t;let r=E4("NOT_REPORT_EVENT");if(e.tag&&o0(r)&&o0(r).call(r,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;let i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:n,uid:o,cid:a}=i.info;if(e.lts=e.lts||Date.now(),e.error){if(e.error instanceof vm){let{code:r,message:i}=e.error;t=r||i||e.error.toString()}else t=e.error.toString()}let s={invokeId:e.invokeId,sid:e.sid,cname:n,cid:a,uid:o,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?t:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:gg.API_INVOKE,data:s},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(0===e.length)return;let t=Array.from(this.sids).find(e=>null!==e);t&&e.forEach(e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>E4("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let r,i=[],n=[];for(;e.length;){let t=e.shift();i.length<20?i.push(t):n.push(t)}for(let t of(e.push(...n),[...i])){var o;-1!==this.ltsList.indexOf(t.data.lts)?(t.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(t.data.lts)):(this.ltsList.push(t.data.lts),pM(o=this.ltsList).call(o,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=Date.now()),E4("ENABLE_EVENT_REPORT")&&i.length&&(E4("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((r=i,e=>{E4("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(r):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(r),this.normalEventUploadPendingItems.length>E4("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-E4("NORMAL_EVENT_QUEUE_CAPACITY")),gA.warning("report: drop normal events"))))})),e}async postDataToStatsCollector2(e){vq.networkState===vY.OFFLINE&&await dJ.race([vq.onlineWaiter,Et(2*E_.maxRetryTimeout)]);let t=e=>{let t=new Uint8Array;return e.forEach(e=>{var r;let i;let n=vw(JSON.stringify(e.data)),o=new ArrayBuffer(5),a=(r=e,i=0,Object.entries(gg).forEach(e=>{let[t,n]=e;n===r.type&&(i=gS[t])}),i),s=new DataView(o);s.setUint16(0,n.byteLength,!0),s.setUint8(2,255&a),s.setUint8(3,a>>>8&255),s.setUint8(4,a>>>16&255),t=vO(t,new Uint8Array(o)),t=vO(t,n)}),t},r="event",i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(E4("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(E4("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let n=0;n<2;n+=1){1===n&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(E4("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(E4("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await Eb(i,{timeout:1e4,data:t(e),headers:gc(gc({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===n)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(e=>{let t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),i=r?void 0:this._aid,n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(e=>JSON.stringify(e)),vid:r,aid:i};vq.networkState===vY.OFFLINE&&await dJ.race([vq.onlineWaiter,Et(2*E_.maxRetryTimeout)]);let o=t?"/events/proto-raws":"/events/messages",a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(E4("EVENT_REPORT_DOMAIN"),"&p=").concat(E4("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(E4("EVENT_REPORT_DOMAIN"),":").concat(E4("STATS_COLLECTOR_PORT")).concat(o));for(let e=0;e<2;e+=1){1===e&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(E4("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(E4("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(E4("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(E4("STATS_COLLECTOR_PORT")).concat(o)));try{t?await ET(a,{timeout:1e4,data:n}):await Eb(a,{timeout:1e4,data:n})}catch(t){if(1===e)throw t;continue}return}}createBaseInfo(e,t){let r=Object.assign({},gv);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){let r=performance.getEntriesByName(e),i=r[r.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:vx.TRACER}).onSuccess()}};gd.on("REPORT_LOG_UPLOAD",e=>{e.networkState=vq.networkState,gT.reportApiInvoke(null,{name:"logUploadError",options:e,tag:vx.TRACER}).onSuccess("logUploadError")});class gy extends vm{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ga(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,gA)}throw(){super.throw(gA)}}let gR={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function gI(){return gR}function gC(){return"setSinkId"in HTMLAudioElement.prototype&&(!E4("RESTRICTION_SET_PLAYBACK_DEVICE")||(m$()||m2())&&!vd())}function gk(){return!gR.supportUnifiedPlan||E4("CHROME_FORCE_PLAN_B")&&vu()}let gw=((K={}).IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",K.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",K.IOS_INTERRUPTION_START="ios-interruption-start",K.IOS_INTERRUPTION_END="ios-interruption-end",K.STATE_CHANGE="state-change",K);function gO(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function gN(e,t,r,i,n){return{width:e,height:t,frameRate:r,bitrateMin:i,bitrateMax:n}}function gP(e,t,r,i,n){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:i,bitrateMax:n}}function gD(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let gL={"90p":gN(160,90),"90p_1":gN(160,90),"120p":gN(160,120,15,30,65),"120p_1":gN(160,120,15,30,65),"120p_3":gN(120,120,15,30,50),"120p_4":gN(212,120),"180p":gN(320,180,15,30,140),"180p_1":gN(320,180,15,30,140),"180p_3":gN(180,180,15,30,100),"180p_4":gN(240,180,15,30,120),"240p":gN(320,240,15,40,200),"240p_1":gN(320,240,15,40,200),"240p_3":gN(240,240,15,40,140),"240p_4":gN(424,240,15,40,220),"360p":gN(640,360,15,80,400),"360p_1":gN(640,360,15,80,400),"360p_3":gN(360,360,15,80,260),"360p_4":gN(640,360,30,80,600),"360p_6":gN(360,360,30,80,400),"360p_7":gN(480,360,15,80,320),"360p_8":gN(480,360,30,80,490),"360p_9":gN(640,360,15,80,800),"360p_10":gN(640,360,24,80,800),"360p_11":gN(640,360,24,80,1e3),"480p":gN(640,480,15,100,500),"480p_1":gN(640,480,15,100,500),"480p_2":gN(640,480,30,100,1e3),"480p_3":gN(480,480,15,100,400),"480p_4":gN(640,480,30,100,750),"480p_6":gN(480,480,30,100,600),"480p_8":gN(848,480,15,100,610),"480p_9":gN(848,480,30,100,930),"480p_10":gN(640,480,10,100,400),"720p":gN(1280,720,15,120,1130),"720p_auto":gN(1280,720,30,900,3e3),"720p_1":gN(1280,720,15,120,1130),"720p_2":gN(1280,720,30,120,2e3),"720p_3":gN(1280,720,30,120,1710),"720p_5":gN(960,720,15,120,910),"720p_6":gN(960,720,30,120,1380),"1080p":gN(1920,1080,15,120,2080),"1080p_1":gN(1920,1080,15,120,2080),"1080p_2":gN(1920,1080,30,120,3e3),"1080p_3":gN(1920,1080,30,120,3150),"1080p_5":gN(1920,1080,60,120,4780),"1440p":gN(2560,1440,30,120,4850),"1440p_1":gN(2560,1440,30,120,4850),"1440p_2":gN(2560,1440,60,120,7350),"4k":gN(3840,2160,30,120,8910),"4k_1":gN(3840,2160,30,120,8910),"4k_3":gN(3840,2160,60,120,13500)},gM={"480p":gP(640,480,5),"480p_1":gP(640,480,5),"480p_2":gP(640,480,30),"480p_3":gP(640,480,15),"720p":gP(1280,720,5),"720p_auto":gN(1280,720,30,900,3e3),"720p_1":gP(1280,720,5),"720p_2":gP(1280,720,30),"720p_3":gP(1280,720,15),"1080p":gP(1920,1080,5),"1080p_1":gP(1920,1080,5),"1080p_2":gP(1920,1080,30),"1080p_3":gP(1920,1080,15)},gx={"1SL1TL":gD(1,1),"3SL3TL":gD(3,3),"2SL3TL":gD(2,3)};function gU(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},gL[e]):e}function gB(e){return"string"==typeof e?Object.assign({},gM[e]):e}function gV(e){return"string"==typeof e?Object.assign({},gx[e]):e}let gF={speech_low_quality:gO(16e3,!1),speech_standard:gO(32e3,!1,18),music_standard:gO(48e3,!1),standard_stereo:gO(48e3,!0,56),high_quality:gO(48e3,!1,128),high_quality_stereo:gO(48e3,!0,192)};function gj(e){return"string"==typeof e?Object.assign({},gF[e]):e}let gG=[];function gW(e){return vE(e,"mediaSource",["screen","window","application"]),!0}let gH=((Q={}).NEED_RENEGOTIATE="@need_renegotiate",Q.NEED_REPLACE_TRACK="@need_replace_track",Q.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",Q.NEED_CLOSE="@need_close",Q.NEED_ENABLE_TRACK="@need_enable_track",Q.NEED_DISABLE_TRACK="@need_disable_track",Q.NEED_SESSION_ID="@need_sid",Q.SET_OPTIMIZATION_MODE="@set_optimization_mode",Q.GET_STATS="@get_stats",Q.GET_RTC_STATS="@get_rtc_stats",Q.GET_LOW_VIDEO_TRACK="@get_low_video_track",Q.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",Q.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",Q.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",Q.NEED_MUTE_TRACK="@need_mute_track",Q.NEED_UNMUTE_TRACK="@need_unmute_track",Q),gY=((z={}).SCREEN_TRACK="screen_track",z.CUSTOM_TRACK="custome_track",z.LOW_STREAM="low_stream",z.SCREEN_LOW_TRACK="screen_low_track",z);let gK=((X={})[X.HIGH_STREAM=0]="HIGH_STREAM",X[X.LOW_STREAM=1]="LOW_STREAM",X),gQ=((J={})[J.HIGH_STREAM=0]="HIGH_STREAM",J[J.LOW_STREAM=1]="LOW_STREAM",J[J.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",J[J.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",J[J.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",J[J.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",J[J.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",J[J.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",J),gz=((q={})[q.DISABLE=0]="DISABLE",q[q.LOW_STREAM=1]="LOW_STREAM",q[q.AUDIO_ONLY=2]="AUDIO_ONLY",q[q.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",q[q.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",q[q.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",q[q.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",q[q.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",q[q.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",q),gX=((Z={}).TRANSCEIVER_UPDATED="transceiver-updated",Z.SEI_TO_SEND="sei-to-send",Z.SEI_RECEIVED="sei-received",Z.TRACK_UPDATED="track-updated",Z),gJ=(($={}).SOURCE_STATE_CHANGE="source-state-change",$.TRACK_ENDED="track-ended",$.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",$.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",$.CLOSED="closed",$),gq=((ee={}).FIRST_FRAME_DECODED="first-frame-decoded",ee.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",ee.VIDEO_STATE_CHANGED="video-state-changed",ee),gZ=((et={}).AUDIO="audio",et.VIDEO="video",et.DATA="data",et),g$=((er={}).AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",er.RECEIVE_TRACK_BUFFER="receive_track_buffer",er.ON_AUDIO_BUFFER="on_audio_buffer",er.UPDATE_SOURCE="update_source",er);let g0={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},g2={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},g1={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},g4={uplinkNetworkQuality:0,downlinkNetworkQuality:0},g6={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let g3=((ei={}).ON_TRACK="on_track",ei.ON_NODE="on_node",ei),g8=((en={}).REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",en.REQUEST_CONSTRAINTS="request_constraints",en),g5=((eo={}).IDLE="IDLE",eo.INITING="INITING",eo.INITEND="INITEND",eo),g9=((ea={}).STATE_CHANGE="state_change",ea.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",ea.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",ea.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",ea),g7=((es={}).NONE="none",es.INIT="init",es.CANPLAY="canplay",es.PLAYING="playing",es.PAUSED="paused",es.SUSPEND="suspend",es.STALLED="stalled",es.WAITING="waiting",es.ERROR="error",es.DESTROYED="destroyed",es.ABORT="abort",es.ENDED="ended",es.EMPTIED="emptied",es.LOADEDDATA="loadeddata",es),Se=((ec={})[ec.VideoStateStopped=0]="VideoStateStopped",ec[ec.VideoStateStarting=1]="VideoStateStarting",ec[ec.VideoStateDecoding=2]="VideoStateDecoding",ec[ec.VideoStateFrozen=3]="VideoStateFrozen",ec),St={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Sr=((ed={}).OPEN="open",ed.MESSAGE="message",ed.CLOSE="close",ed.CLOSING="closing",ed.ERROR="error",ed);function Si(e,t,r,i,n){var o,a,s={};return Object.keys(i).forEach(function(e){s[e]=i[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=ae(o=as(a=r.slice()).call(a)).call(o,function(r,i){return i(e,t,r)||r},s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function Sn(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function So(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function Sa(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?So(Object(r),!0).forEach(function(t){Sn(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):So(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class Ss extends vP{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(gX.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){var r;super(),Sn(this,"trackMediaType",void 0),Sn(this,"_ID",void 0),Sn(this,"_rtpTransceiver",void 0),Sn(this,"_lowRtpTransceiver",void 0),Sn(this,"_hints",[]),Sn(this,"_isClosed",!1),Sn(this,"_originMediaStreamTrack",void 0),Sn(this,"mediaStreamTrack",void 0),Sn(this,"_external",{}),this._ID=t||Er(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,r=this,o0(gG).call(gG,r)||gG.push(r)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||v6(()=>{var e;gT.reportApiInvoke(null,{name:vM.GET_MEDIA_STREAM_TRACK,options:[],tag:vx.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===gK.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){let t=gG.indexOf(e);-1!==t&&gG.splice(t,1)}(this),this.emit(gJ.CLOSED),this.removeAllListeners(gX.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===gK.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(gX.TRANSCEIVER_UPDATED,e,t)}}class Sc extends Ss{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),Sn(this,"_enabled",!0),Sn(this,"_muted",!1),Sn(this,"_isExternalTrack",!1),Sn(this,"_isClosed",!1),Sn(this,"_enabledMutex",void 0),Sn(this,"processor",void 0),Sn(this,"_processorContext",void 0),Sn(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ep("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,gA.debug("[".concat(this.getTrackId(),"] close")),this.emit(gH.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=r,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vz(this,gH.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){gA.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(gJ.TRACK_ENDED)}stateCheck(e,t){if(gA.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),vv(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new vm(vA.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",gA);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new vm(vA.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",gA)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():dJ.resolve([])}}let Sd=window.AudioContext||window.webkitAudioContext,Su=null,Sl=new class extends vP{constructor(){super(...arguments),Sn(this,"prevState",void 0),Sn(this,"curState",void 0),Sn(this,"currentTime",void 0),Sn(this,"currentTimeStuckAt",void 0),Sn(this,"interruptDetectorTrack",void 0),Sn(this,"onLocalAudioTrackMute",()=>{gA.info("ios15-interruption-start"),this.emit(gw.IOS_15_16_INTERRUPTION_START)}),Sn(this,"onLocalAudioTrackUnmute",async()=>{gA.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?gA.info("ios15-interruption-end-canceled"):(Su&&await Su.suspend(),this.emit(gw.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){gA.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){gA.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Sh(){if(!Su&&(function(){if(!Sd)return void gA.error("your browser is not support web audio");gA.info("create audio context");let e=Sa({},E4("WEBAUDIO_INIT_OPTIONS"));gA.debug("audio context init option:",JSON.stringify(e)),Su=new Sd(e),Sl.curState=Su.state,Su.onstatechange=()=>{Sl.prevState=Sl.curState,Sl.curState=Su?Su.state:void 0;let{prevState:e,curState:t}=Sl,r="running"===t,i="interrupted"===t,n="running"===e,o="suspended"===e,a="interrupted"===e,s=mz().osVersion;(m4()||va())&&n&&i&&(gA.info("ios".concat(s,"-interruption-start")),Sl.emit(gw.IOS_INTERRUPTION_START)),(m4()||va())&&(o||a)&&r&&(gA.info("ios".concat(s,"-interruption-end")),Sl.emit(gw.IOS_INTERRUPTION_END)),e!==t&&Sl.emit(gw.STATE_CHANGE,t,e)},setInterval(()=>{var e;let t=null===(e=Su)||void 0===e?void 0:e.currentTime;Sl.currentTime!==t?(Sl.currentTimeStuckAt&&(gA.debug("AudioContext current time resume at ".concat(t)),Sl.currentTimeStuckAt=void 0),Sl.currentTime=t):(t!==Sl.currentTimeStuckAt&&(gT.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:vx.TRACER}).onSuccess(),gA.warning("AudioContext current time stuck at ".concat(t))),Sl.currentTimeStuckAt=t)},5e3),async function(e){let t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r,i=!1,n=!1,o=!1;function a(t){"running"===e.state?s(!1):m4()||va()?"suspended"===e.state&&(s(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(s(!0),t&&e.resume().then(c,c))}function s(e){if(i!==e){i=e;for(let r=0;r<t.length;r+=1){let i=t[r];e?window.addEventListener(i,d,{capture:!0,passive:!0}):window.removeEventListener(i,d,{capture:!0,passive:!0})}}}function c(){a(!1)}function d(){a(!0)}function u(e){if(!o){if(r.paused){if(e){let e;l(!1),o=!0;try{(e=r.play())?e.then(h,h):(r.addEventListener("playing",h),r.addEventListener("abort",h),r.addEventListener("error",h))}catch(e){h()}}else l(!0)}else l(!1)}}function l(e){if(n!==e){n=e;for(let r=0;r<t.length;r++){let i=t[r];e?window.addEventListener(i,p,{capture:!0,passive:!0}):window.removeEventListener(i,p,{capture:!0,passive:!0})}}}function h(){r.removeEventListener("playing",h),r.removeEventListener("abort",h),r.removeEventListener("error",h),o=!1,u(!1)}function p(){u(!0)}if(m4()){let t=e.createMediaStreamDestination(),i=document.createElement("div");i.innerHTML="<audio x-webkit-airplay='deny'></audio>",(r=i.children.item(0)).controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=t.stream,u(!0)}Sl.on(gw.STATE_CHANGE,function(){a(!0)}),a(!1)}(Su)}(),!Su))throw new vm(vA.NOT_SUPPORTED,"can not create audio context");return Su}function Sp(e){if(function(){if(null!==Sf)return Sf;let e=Sh(),t=e.createBufferSource(),r=e.createGain(),i=e.createGain();t.connect(r),t.connect(i),t.disconnect(r);let n=!1;try{t.disconnect(r)}catch(e){n=!0}return t.disconnect(),Sf=n,n}())return;let t=e.connect,r=e.disconnect;e.connect=(r,i,n)=>{var o;return e._inputNodes||(e._inputNodes=[]),o0(o=e._inputNodes).call(o,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,n)):t.call(e,r,i)),e},e.disconnect=(i,n,o)=>{for(let n of(r.call(e),i?vZ(e._inputNodes,i):e._inputNodes=[],e._inputNodes))t.call(e,n)}}let Sf=null;function S_(e,t){let r=!1,i=1/t;if(E4("DISABLE_WEBAUDIO")){let t=window.setInterval(()=>{r?window.clearInterval(t):e(performance.now()/1e3)},1e3*i)}else{let t=Sh(),n=t.createGain();n.gain.value=0,n.connect(t.destination);let o=()=>{if(r)return void(n=null);let a=t.createOscillator();a.onended=o,a.connect(n),a.start(0),a.stop(t.currentTime+i),e(t.currentTime)};o()}return()=>{r=!0}}class SA{constructor(){Sn(this,"context",void 0),Sn(this,"analyserNode",void 0),Sn(this,"sourceNode",void 0),this.context=Sh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||m4()||va()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let r=0;r<e.length;++r)e[r]=t[r]/128-1}return Math.max(10*Math.log10(ae(e).call(e,(e,t)=>e+t*t,0)/e.length)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){gA.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Sm extends vP{get processSourceNode(){return this.sourceNode}set processedNode(e){var t,r;if(!this.isDestroyed&&this._processedNode!==e){try{null===(r=this.sourceNode)||void 0===r||r.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Sn(this,"outputNode",void 0),Sn(this,"outputTrack",void 0),Sn(this,"isPlayed",!1),Sn(this,"sourceNode",void 0),Sn(this,"context",void 0),Sn(this,"audioBufferNode",void 0),Sn(this,"destNode",void 0),Sn(this,"audioOutputLevel",0),Sn(this,"volumeLevelAnalyser",void 0),Sn(this,"_processedNode",void 0),Sn(this,"playNode",void 0),Sn(this,"isDestroyed",!1),Sn(this,"onNoAudioInput",void 0),Sn(this,"isNoAudioInput",!1),Sn(this,"_noAudioInputCount",0),this.context=Sh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Sp(this.outputNode),this.volumeLevelAnalyser=new SA}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(g$.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){let r=e.outputBuffer.getChannelData(t);for(let e=0;e<r.length;e+=1)r[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!gR.webAudioMediaStreamDest)throw new vm(vA.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&v0(()=>{Sl.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;m4()||va()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();let r=this.volumeLevelAnalyser.getAnalyserNode();r.getFloatTimeDomainData?(e=new Float32Array(r.fftSize),r.getFloatTimeDomainData(e)):(e=new Uint8Array(r.fftSize),r.getByteTimeDomainData(e));let i=!1;for(let t=0;t<e.length;t++)0!==e[t]&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Et(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Sv extends Sm{get isFreeze(){return!1}constructor(e,t,r){var i;if(super(),Sn(this,"sourceNode",void 0),Sn(this,"track",void 0),Sn(this,"clonedTrack",void 0),Sn(this,"audioElement",void 0),Sn(this,"isCurrentTrackCloned",!1),Sn(this,"isRemoteTrack",!1),Sn(this,"originVolumeLevelAnalyser",void 0),Sn(this,"rebuildWebAudio",async()=>{if(gA.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void gA.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>gA.info("resume success")),gA.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;let t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),Sp(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let r=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(r,this.context.currentTime),Sp(this.outputNode),this.emit(g$.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),"audio"!==e.kind)throw new vm(vA.UNEXPECTED_ERROR);this.track=e;let n=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(n),Sp(this.sourceNode),r){let e=r.clone();e.enabled=!0,this.clonedTrack=e,gA.debug("create an unmuted track ".concat(e.id," from the original track ").concat(r.id," to get the volume"));let t=this.context.createMediaStreamSource(new MediaStream([e]));Sp(t),this.originVolumeLevelAnalyser=new SA,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=n;let o=mz();t&&o.os===mW.IOS&&15>Number(null===(i=o.osVersion)||void 0===i?void 0:i.split(".")[0])&&(Sl.on(gw.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),Sp(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(g$.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Sl.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),gA.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let r=this.context.createMediaStreamSource(new MediaStream([t]));Sp(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function SE(e,t,r){let i=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,n={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(n.video.mandatory.maxFrameRate=t.frameRate.max,n.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(n.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(n)}async function Sg(e,t){let r=await SS(e.mediaSource),{sourceId:i,audio:n}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new dJ((r,i)=>{let n=document.createElement("div");n.innerText="share screen",n.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");let s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let d=document.createElement("button");d.innerHTML="cancel",d.setAttribute("style","width: 85px;"),d.onclick=()=>{document.body.removeChild(h);let e=Error("NotAllowedError");e.name="NotAllowedError",i(e)};let u=t,l=document.createElement("div");if(t){let e=document.createElement("input");e.setAttribute("type","checkbox");let t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=u,e.onchange=()=>{u=e.checked},l.appendChild(e),l.appendChild(t)}c.appendChild(l),c.appendChild(d),o.appendChild(a),o.appendChild(s),o.appendChild(c);let h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(n),h.appendChild(o),document.body.appendChild(h),e.map(e=>{if(e.id){let t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let i=e.thumbnail;try{let{width:e}=i.getSize();e>1920&&(i=i.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+i.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",t.onclick=()=>{document.body.removeChild(h),r({sourceId:e.id,audio:u})},s.appendChild(t)}})})}(r,t);return await SE(i,e,n)}async function SS(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);let r=vL();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new vm(vA.ELECTRON_IS_NULL);let i=null;try{var n;i=(null===(n=r.desktopCapturer)||void 0===n?void 0:n.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){i=null}i&&i.then||(i=new dJ((e,i)=>{r.desktopCapturer.getSources({types:t},(t,r)=>{t?i(t):e(r)})}));try{return await i}catch(e){throw new vm(vA.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}let Sb=new Ep("safari"),ST=!1,Sy=!1;async function SR(e,t){let r=0,i=null;for(;r<2;)try{i=await SI(e,t,r>0);break}catch(i){if(i instanceof vm)throw gA.error("[".concat(t,"] ").concat(i.toString())),i;let e=SC(i.name||i.code||i,i.message);if(e.code===vA.MEDIA_OPTION_INVALID){gA.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Et(500);continue}throw gA.error("[".concat(t,"] ").concat(e.toString())),e}if(!i)throw new vm(vA.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function SI(e,t,r){var i,n;if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new vm(vA.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return gA.debug("Using Video Source/ Audio Source"),o;if(e.screen){if(vL())e.screen.sourceId?Sk(o,await SE(e.screen.sourceId,e.screen,!!e.screenAudio)):Sk(o,await Sg(e.screen,!!e.screenAudio));else if(m$()&&e.screen.extensionId&&e.screen.mandatory){if(!gR.getStreamFromExtension)throw new vm(vA.NOT_SUPPORTED,"This browser does not support screen sharing");gA.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let r=await (n=e.screen.extensionId,new dJ((e,r)=>{try{chrome.runtime.sendMessage(n,{getStream:!0},i=>{if(!i||!i.streamId)return gA.error("[".concat(t,"] No response from Chrome Plugin. Plugin not installed properly"),i),void r(new vm(vA.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(i.streamId)})}catch(e){gA.error("[".concat(t,"] AgoraRTC screensharing plugin is not accessible(").concat(n,")"),e.toString()),r(new vm(vA.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=r,Sk(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(gR.getDisplayMedia){e.screen.mediaSource&&gW(e.screen.mediaSource);let r={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(i=e.screen.displaySurface)&&void 0!==i?i:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:n,surfaceSwitching:a,systemAudio:s,preferCurrentTab:c}=e.screen,d={selfBrowserSurface:n,surfaceSwitching:a,systemAudio:s,preferCurrentTab:c};n||delete d.selfBrowserSurface,a||delete d.surfaceSwitching,s||delete d.systemAudio,c||delete d.preferCurrentTab,gA.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:r,audio:e.screenAudio,controls:d})),Sk(o,await navigator.mediaDevices.getDisplayMedia(Sa({video:r,audio:e.screenAudio},d)))}else{if(!m1())throw gA.error("[".concat(t,"] This browser does not support screenSharing")),new vm(vA.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&gW(e.screen.mediaSource);let r={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};gA.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(r))),Sk(o,await navigator.mediaDevices.getUserMedia(r))}}}if(!e.video&&!e.audio)return o;let a={video:e.video,audio:e.audio},s=E4("MEDIA_DEVICE_CONSTRAINTS");if(s)try{"string"==typeof s&&(s=JSON.parse(s)),a=function e(t,r){if(!Es(t)||!Es(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){let i=[...t];for(let n=0;n<r.length;n++)i[n]=e(t[n],r[n]);return i}{let i=v_({},t);for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(Object.prototype.hasOwnProperty.call(t,n)?i[n]=e(t[n],r[n]):i[n]=r[n]);return i}}(a,s)}catch(e){}gA.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(a)),mz();let c,d=null;(m0()||m4()||mZ())&&(d=await Sb.lock());try{c=await navigator.mediaDevices.getUserMedia(a)}catch(e){throw d&&d(),e}return a.audio&&(ST=!0),a.video&&(Sy=!0),Sk(o,c),d&&d(),o}function SC(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new vm(vA.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new vm(vA.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new vm(vA.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new vm(vA.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new vm(vA.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new vm(vA.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return gA.error("getUserMedia unexpected error",e),new vm(vA.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Sk(e,t){let r=e.getVideoTracks()[0],i=e.getAudioTracks()[0],n=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(i&&e.removeTrack(i),e.addTrack(o)),n&&(r&&e.removeTrack(r),e.addTrack(n))}let Sw=new class extends vP{get state(){return this._state}set state(e){e!==this._state&&(this.emit(g9.STATE_CHANGE,e),this._state=e)}constructor(){super(),Sn(this,"_state",g5.IDLE),Sn(this,"isAccessMicrophonePermission",!1),Sn(this,"isAccessCameraPermission",!1),Sn(this,"lastAccessMicrophonePermission",!1),Sn(this,"lastAccessCameraPermission",!1),Sn(this,"checkdeviceMatched",!1),Sn(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(E4("ENUMERATE_DEVICES_INTERVAL")||(vl()||mJ()===mW.HARMONY_OS)&&vu())&&this.updateDevicesInfo()},E4("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>gA.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new vm(vA.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let i=await navigator.mediaDevices.enumerateDevices(),n=this.checkMediaDeviceInfoIsOk(i),o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;n.audio&&(o=!1),n.video&&(a=!1);let s=null,c=null,d=null;if(!r&&(o||a)){if(Sb.isLocked&&(gA.debug("[device manager] wait GUM lock"),(await Sb.lock())(),gA.debug("[device manager] GUM unlock")),ST&&(o=!1,this.isAccessMicrophonePermission=!0),Sy&&(a=!1,this.isAccessCameraPermission=!0),gA.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{d=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(t){let e=SC(t.name||t.code||t,t.message);if(e.code===vA.PERMISSION_DENIED)throw e;gA.warning("getUserMedia failed in getDevices",e)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(t){let e=SC(t.name||t.code||t,t.message);if(e.code===vA.PERMISSION_DENIED)throw e;gA.warning("getUserMedia failed in getDevices",e)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(t){let e=SC(t.name||t.code||t,t.message);if(e.code===vA.PERMISSION_DENIED)throw e;gA.warning("getUserMedia failed in getDevices",e)}this.isAccessCameraPermission=!0}gA.debug("[device manager] mic permission",e,"cam permission",t)}try{let e=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),d&&d.getTracks().forEach(e=>e.stop()),s=null,c=null,d=null,e}catch(e){return s&&s.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),d&&d.getTracks().forEach(e=>e.stop()),s=null,c=null,d=null,new vm(vA.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audioinput"===e.kind)}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(e=>"videoinput"===e.kind)}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audiooutput"===e.kind)}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===e);if(!t)throw new vm(vA.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=g5.INITING;try{await this.updateDevicesInfo(),this.state=g5.INITEND}catch(e){throw gA.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=g5.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new vm(vA.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;let t=e.find(e=>"audioinput"===e.kind&&"default"===e.deviceId),r=e.find(e=>"audiooutput"===e.kind&&"default"===e.deviceId);t&&r?r.groupId===t.groupId?gA.debug("[device-check] default input ".concat(t.label," and output ").concat(r.label," is the same group")):gA.debug("[device-check] default input ".concat(t.label," and output ").concat(r.label," is not the same group")):gA.debug("[device-check] default input or output not found")}let i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(e=>{if(!e.deviceId)return;let i=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(i?i.state:"INACTIVE")){let i={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),i),r.push(i)}i&&(i.updateAt=t)}),this.deviceInfoMap.forEach((e,i)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",r.push(e))}),this.state!==g5.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(g9.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(g9.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(g9.PLAYOUT_DEVICE_CHANGED,e)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(e=>"audioinput"===e.kind),r=e.filter(e=>"videoinput"===e.kind),i={audio:!1,video:!1};for(let e of t)if(e.label&&e.deviceId){i.audio=!0;break}for(let e of r)if(e.label&&e.deviceId){i.video=!0;break}return i}},SO=!1,SN=new class extends vP{constructor(){super(...arguments),Sn(this,"onAutoplayFailed",void 0),Sn(this,"onAudioAutoplayFailed",void 0)}};function SP(){if(mz(),!SO){let e=t=>{t.preventDefault(),SO=!1,vh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};SO=!0,vh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),gA.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),SN.onAutoplayFailed?SN.onAutoplayFailed():SN.onAudioAutoplayFailed?gA.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):gA.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),SN.emit("autoplay-failed")}}function SD(e,t,r,i){if(!e)return;let n=gT.getBaseInfoBySessionId(e);if(!n)return;let o=n.info,a=Date.now(),s=Sa(Sa({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:a,elapse:a-n.startTime,cbRegistered:SN.onAutoplayFailed||SN.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:i,extend:void 0});gT.send({type:gg.AUTOPLAY_FAILED,data:s},!0)}let SL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],SM=new class{constructor(){Sn(this,"onAutoplayFailed",void 0),Sn(this,"elementMap",new Map),Sn(this,"elementStateMap",new Map),Sn(this,"elementsNeedToResume",[]),Sn(this,"sinkIdMap",new Map),Sn(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t,n=this.elementStateMap.get(r),o=i.srcObject.getAudioTracks()[0],a=o&&o.readyState;if(gA.debug("resume after interrupted, ele: ".concat(n," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return i.pause(),void i.play();if("running"===Sl.curState)return vi()?(i.pause(),void i.play()):void(n&&"paused"===n&&i.play())}})}),Sn(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e,i=r.srcObject.getAudioTracks()[0];i&&"live"===i.readyState&&(gA.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),Sl.on(gw.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Sl.on(gw.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Sl.on(gw.STATE_CHANGE,()=>{m4()&&"suspended"===Sl.prevState&&"running"===Sl.curState&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(e){throw new vm(vA.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,r,i){if(this.elementMap.has(t))return;let n=document.createElement("audio");n.autoplay=!0,n.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,n),this.elementMap.set(t,n),this.elementStateMap.set(t,g7.INIT),this.setVolume(t,r);let o=this.sinkIdMap.get(t);if(o)try{n.setSinkId(o).catch(e=>{gA.warning("[".concat(t,"] set sink id failed"),e.toString())})}catch(e){gA.warning("[".concat(t,"] set sink id failed"),e.toString())}let a=n.play();a&&a.then&&a.catch(e=>{i&&SD(i,"audio",e.message,t),gA.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(gA.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(n),v0(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),SP()}))})}updateTrack(e,t){let r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){let r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){SL.forEach(r=>{t.addEventListener(r,r=>{let i=this.elementStateMap.get(e),n="pause"===r.type?"paused":r.type;if(gA.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(n)),"error"===r.type){let r=null==t?void 0:t.error;r&&gA.error("[".concat(e,"] media error, code: ").concat(r.code,", message: ").concat(r.message))}this.elementStateMap.set(e,n)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(e=>{gA.debug("Auto resume audio element success")}).catch(e=>{gA.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new dJ(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{vh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Sx(){return function(e,t,r){let i=r.value;return"function"==typeof i&&(r.value=function(){this._isClosed&&new vm(vA.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",gA);for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=i.apply(this,t);return n instanceof dJ?new dJ((e,t)=>{n.then(e).catch(t)}):n}),r}}class SU extends vP{constructor(e){super(),Sn(this,"name","VideoProcessorDestination"),Sn(this,"ID","0"),Sn(this,"_source",void 0),Sn(this,"videoContext",void 0),Sn(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new vm(vA.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new vm(vA.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(g3.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(g3.ON_TRACK,void 0)}}class SB extends vP{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),Sn(this,"constraintsMap",new Map),Sn(this,"statsRegistry",[]),Sn(this,"usageRegistry",[]),Sn(this,"trackId",void 0),Sn(this,"direction",void 0),Sn(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await vQ(this,g8.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var r;return gA.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),vz(this,g8.REQUEST_UPDATE_CONSTRAINTS,Array.from(d0(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return gA.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),vz(this,g8.REQUEST_UPDATE_CONSTRAINTS,Array.from(d0(t=this.constraintsMap).call(t)))}registerStats(e,t,r){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:r})}unregisterStats(e,t){let r=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t);-1!==r&&this.statsRegistry.splice(r,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:r,type:i,cb:n}of this.statsRegistry)try{let o=n();e.push({processorID:t,processorName:r,type:i,stats:o})}catch(e){gA.error(new vm(vA.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let r=t();r instanceof dJ&&(r=await r),e.push(Sa(Sa({},r),{},{direction:this.direction}))}catch(e){gA.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class SV extends vP{constructor(e){super(),Sn(this,"name","AudioProcessorDestination"),Sn(this,"ID","0"),Sn(this,"inputTrack",void 0),Sn(this,"inputNode",void 0),Sn(this,"audioProcessorContext",void 0),Sn(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new vm(vA.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new vm(vA.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(g3.ON_TRACK,void 0),this.emit(g3.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(g3.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(g3.ON_NODE,this.inputNode))}}class SF extends vP{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,r){super(),Sn(this,"constraintsMap",new Map),Sn(this,"statsRegistry",[]),Sn(this,"audioContext",void 0),Sn(this,"trackId",void 0),Sn(this,"direction",void 0),Sn(this,"usageRegistry",[]),Sn(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=r}async getConstraints(){return vQ(this,g8.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var r;return gA.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),vz(this,g8.REQUEST_UPDATE_CONSTRAINTS,Array.from(d0(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),vz(this,g8.REQUEST_UPDATE_CONSTRAINTS,Array.from(d0(t=this.constraintsMap).call(t)))}registerStats(e,t,r){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:r})}unregisterStats(e,t){let r=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t);-1!==r&&this.statsRegistry.splice(r,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:r,type:i,cb:n}of this.statsRegistry)try{let o=n();e.push({processorID:t,processorName:r,type:i,stats:o})}catch(e){gA.error(new vm(vA.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let r=t();r instanceof dJ&&(r=await r),e.push(Sa(Sa({},r),{},{direction:this.direction}))}catch(e){gA.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Sj extends vP{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Sn(this,"context",void 0),Sn(this,"processSourceNode",void 0),Sn(this,"outputTrack",void 0),Sn(this,"processedNode",void 0),Sn(this,"clonedTrack",void 0),Sn(this,"outputNode",void 0),this.outputNode=new SG}setVolume(){}createOutputTrack(){throw new vm(vA.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class SG{disconnect(){}connect(){}}function SW(e){return new dJ((t,r)=>{let i=!1,n=document.createElement("video");n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.muted=!0,n.autoplay=!0,n.setAttribute("playsinline",""),n.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(n);let o=m4()?"canplay":"playing";n.addEventListener(o,()=>{let e=n.videoWidth,r=n.videoHeight;!e&&m1()||(i=!0,n.srcObject=null,n.remove(),t([e,r]))}),n.srcObject=new MediaStream([e]),n.play().catch(En),setTimeout(()=>{i||(n.srcObject=null,n.remove(),t([n.videoWidth,n.videoHeight]))},4e3)})}function SH(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let r=gU(e.encoderConfig);return null!=r.width&&(t.width=r.width),null!=r.height&&(t.height=r.height),!vc()&&r.frameRate&&(t.frameRate=r.frameRate),m2()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),m1()&&(t.frameRate={ideal:30,max:30}),t}function SY(e){let t={};return vc()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,m$()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function SK(e){let t=SY(e);if(e.encoderConfig){let r=gj(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),vl()&&(t.sampleRate=void 0),t}let SQ=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:r,width:i,height:n}=e.getMediaStreamTrackSettings(),{frameRate:o=r,width:a=i,height:s=n}=t;if(!o||!a||!s)return;a=Ed(a),s=Ed(s);let{max:c,min:d}=function(e,t,r){let i=200*Math.pow(r/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(i),max:Math.floor(4*i)}}(a,s,o=Ed(o)),{bitrateMax:u,bitrateMin:l}=t||{};u||gA.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(u,", brMin: ").concat(l,"]"));let{maxFramerate:h}=E4("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:u||c,bitrateMin:l||d,scaleResolutionDownBy:1,scale:0}},Sz=async(e,t,r)=>await (async(e,t,r)=>{let i=(function(e){let t=[];for(let r=0;r<e.length;r+=2)t.push(parseInt(e.slice(r,r+2),16));return Uint8Array.from(t)})(Eu(""+t+r)).slice(0,16),n=i.slice(0,12),o=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},o,e))})(e.buffer,t,r),SX=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new dJ((r,i)=>{t.toBlob(async e=>{(t.remove(),e)?r({buffer:await SJ(e),width:t.width,height:t.height}):i(new vm(vA.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},SJ=async e=>new Uint8Array(await e.arrayBuffer()),Sq=(tm=gb({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tv=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),tE=Sx(),tg=Ef("LocalAudioTrack","_enabledMutex"),tS=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),tb=Sx(),tT=Ef("LocalAudioTrack","_enabledMutex"),ty=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),tR=Sx(),tI=Sx(),tC=Sx(),tk=gb({argsMap:e=>[e.getTrackId()]}),tw=Sx(),tO=gb({argsMap:e=>[e.getTrackId()]}),tN=Sx(),tP=gb({argsMap:e=>[e.getTrackId()]}),tD=gb({argsMap:(e,t)=>[e.getTrackId(),t.name]}),tL=gb({argsMap:e=>[e.getTrackId()]}),Si((tM=class extends Sc{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?SM.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,i){super(e,r),Sn(this,"trackMediaType",gZ.AUDIO),Sn(this,"_encoderConfig",void 0),Sn(this,"_trackSource",void 0),Sn(this,"metadata",[]),Sn(this,"_enabled",!0),Sn(this,"_volume",100),Sn(this,"_useAudioElement",!0),Sn(this,"_bypassWebAudio",!1),Sn(this,"processor",void 0),Sn(this,"_processorContext",void 0),Sn(this,"_processorDestination",void 0),Sn(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new Sj,E4("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),E4("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),m0()&&!Su?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){vg(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&SM.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void gA.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,vz(this,gH.NEED_REPLACE_TRACK,this).then(()=>{gA.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{gA.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!gC())throw new vm(vA.NOT_SUPPORTED,"your browser does not support setting the audio output device");await SM.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(gA.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await vz(this,gH.NEED_ENABLE_TRACK,this),gA.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw r||(this._enabled=!1),gA.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await vz(this,gH.NEED_DISABLE_TRACK,this)}catch(e){throw r||(this._enabled=!0),gA.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,gA.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await vz(this,gH.NEED_MUTE_TRACK,this):await vz(this,gH.NEED_UNMUTE_TRACK,this))}getStats(){return v6(()=>{gA.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),vX(this,gH.GET_STATS)||Sa({},g0)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(g$.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(g$.ON_AUDIO_BUFFER),this._source.on(g$.ON_AUDIO_BUFFER,t=>e(t))}play(){gA.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(gA.debug("[".concat(this.getTrackId(),"] start audio playback in element")),SM.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){gA.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?SM.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];gA.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&SM.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vz(this,gH.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return dJ.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new vm(vA.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new vm(vA.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(g3.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await vz(this,gH.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vz(this,gH.NEED_REPLACE_TRACK,this))}),e.on(g3.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(e){e.removeAllListeners(g3.ON_TRACK),e.removeAllListeners(g3.ON_NODE)}bindProcessorContextEvents(e){e.on(g8.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(g8.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Sj&&(this._trackSource=new Sv(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new SF(this._source.context,this.getTrackId(),"local"),t=new SV(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(g$.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(SM.stop(this.getTrackId()),this._source.play()),vz(this,gH.NEED_REPLACE_MIXING_TRACK,this).then(()=>{gA.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(e=>{gA.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[tm],Object.getOwnPropertyDescriptor(tM.prototype,"setVolume"),tM.prototype),Si(tM.prototype,"setPlaybackDevice",[tv,tE],Object.getOwnPropertyDescriptor(tM.prototype,"setPlaybackDevice"),tM.prototype),Si(tM.prototype,"setEnabled",[tg,tS,tb],Object.getOwnPropertyDescriptor(tM.prototype,"setEnabled"),tM.prototype),Si(tM.prototype,"setMuted",[tT,ty,tR],Object.getOwnPropertyDescriptor(tM.prototype,"setMuted"),tM.prototype),Si(tM.prototype,"getStats",[tI],Object.getOwnPropertyDescriptor(tM.prototype,"getStats"),tM.prototype),Si(tM.prototype,"setAudioFrameCallback",[tC],Object.getOwnPropertyDescriptor(tM.prototype,"setAudioFrameCallback"),tM.prototype),Si(tM.prototype,"play",[tk,tw],Object.getOwnPropertyDescriptor(tM.prototype,"play"),tM.prototype),Si(tM.prototype,"stop",[tO,tN],Object.getOwnPropertyDescriptor(tM.prototype,"stop"),tM.prototype),Si(tM.prototype,"close",[tP],Object.getOwnPropertyDescriptor(tM.prototype,"close"),tM.prototype),Si(tM.prototype,"pipe",[tD],Object.getOwnPropertyDescriptor(tM.prototype,"pipe"),tM.prototype),Si(tM.prototype,"unpipe",[tL],Object.getOwnPropertyDescriptor(tM.prototype,"unpipe"),tM.prototype),tM),SZ=(tx=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),tU=Sx(),tB=Ef("MicrophoneAudioTrack","_enabledMutex"),tV=gb({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),tF=Sx(),tj=gb({argsMap:e=>[e.getTrackId()]}),Si((tG=class extends Sq{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,i){super(e,t.encoderConfig?gj(t.encoderConfig):{},i,E4("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Sn(this,"_config",void 0),Sn(this,"_deviceName","default"),Sn(this,"_constraints",void 0),Sn(this,"_originalConstraints",void 0),Sn(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(vi()||vn())&&Sl.bindInterruptDetectorTrack(this)}async setDevice(e){if(gA.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await Sw.getDeviceById(e),r={};r.audio=Sa({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await SR(r,this.getTrackId())}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),i=await SR({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{let t=await Sw.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}gA.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return gA.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(gA.info("[".concat(this.getTrackId(),"] start setEnabled"),e),E4("AUTO_RESET_AUDIO_ROUTE")&&(m4()||va())){let t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(i=this._source.clonedTrack)||void 0===i||i.stop(),r||(this._enabled=!1);try{await vz(this,gH.NEED_DISABLE_TRACK,this)}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}let n=Sa({},this._constraints),o=Sw.searchDeviceIdByName(this._deviceName);o&&!n.deviceId&&(n.deviceId=o);try{r||(this._enabled=!0);let e=await SR({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await vz(this,gH.NEED_ENABLE_TRACK,this)}catch(e){throw r||(this._enabled=!1),gA.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}gA.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(vi()||vn())&&Sl.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((m4()||va())&&this._enabled&&!this._isClosed&&Sl.duringInterruption){let e=async()=>{Sl.off(gw.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(gA.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Sl.on(gw.IOS_INTERRUPTION_END,e)}else gA.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(gJ.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=Sw.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let e=await SR({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(g8.REQUEST_UPDATE_CONSTRAINTS,async(e,t,r)=>{try{let r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(e){r(e)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(g8.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[tx,tU],Object.getOwnPropertyDescriptor(tG.prototype,"setDevice"),tG.prototype),Si(tG.prototype,"setEnabled",[tB,tV,tF],Object.getOwnPropertyDescriptor(tG.prototype,"setEnabled"),tG.prototype),Si(tG.prototype,"close",[tj],Object.getOwnPropertyDescriptor(tG.prototype,"close"),tG.prototype),tG),S$=(tW=gb({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),tH=Sx(),tY=gb({argsMap:e=>[e.getTrackId()]}),tK=Sx(),tQ=gb({argsMap:e=>[e.getTrackId()]}),tz=Sx(),tX=gb({argsMap:e=>[e.getTrackId()]}),tJ=Sx(),tq=gb({argsMap:e=>[e.getTrackId()]}),tZ=Sx(),t$=gb({argsMap:e=>[e.getTrackId()]}),t0=gb({argsMap:e=>[e.getTrackId()]}),t2=Sx(),Si((t1=class extends Sq{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,i){super(t.createOutputTrack(),r,i),Sn(this,"source",void 0),Sn(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(g$.AUDIO_SOURCE_STATE_CHANGE,e=>{this.safeEmit(gJ.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){vg(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[tW,tH],Object.getOwnPropertyDescriptor(t1.prototype,"startProcessAudioBuffer"),t1.prototype),Si(t1.prototype,"pauseProcessAudioBuffer",[tY,tK],Object.getOwnPropertyDescriptor(t1.prototype,"pauseProcessAudioBuffer"),t1.prototype),Si(t1.prototype,"seekAudioBuffer",[tQ,tz],Object.getOwnPropertyDescriptor(t1.prototype,"seekAudioBuffer"),t1.prototype),Si(t1.prototype,"resumeProcessAudioBuffer",[tX,tJ],Object.getOwnPropertyDescriptor(t1.prototype,"resumeProcessAudioBuffer"),t1.prototype),Si(t1.prototype,"stopProcessAudioBuffer",[tq,tZ],Object.getOwnPropertyDescriptor(t1.prototype,"stopProcessAudioBuffer"),t1.prototype),Si(t1.prototype,"close",[t$],Object.getOwnPropertyDescriptor(t1.prototype,"close"),t1.prototype),Si(t1.prototype,"setAudioBufferPlaybackSpeed",[t0,t2],Object.getOwnPropertyDescriptor(t1.prototype,"setAudioBufferPlaybackSpeed"),t1.prototype),t1);class S0 extends Sq{get __className__(){return"MixingAudioTrack"}get isActive(){for(let e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){let e=Sh().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Er(8,"track-mix-")),Sn(this,"trackList",void 0),Sn(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return -1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(gA.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):gA.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){gA.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}vZ(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){let e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof S0?t.emit(gX.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class S2 extends Sm{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(g$.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Sn(this,"audioBuffer",void 0),Sn(this,"sourceNode",void 0),Sn(this,"startPlayTime",0),Sn(this,"startPlayOffset",0),Sn(this,"pausePlayTime",0),Sn(this,"options",void 0),Sn(this,"currentLoopCount",0),Sn(this,"currentPlaybackSpeed",100),Sn(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):gA.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let S1=new Map;class S4{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(gA.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){Sn(this,"trackId",void 0),Sn(this,"config",void 0),Sn(this,"onFirstVideoFrameDecoded",void 0),Sn(this,"onVideoStateChanged",void 0),Sn(this,"freezeTimeCounterList",[]),Sn(this,"renderFreezeAccTime",0),Sn(this,"isKeepLastFrame",!1),Sn(this,"timeUpdatedCount",0),Sn(this,"freezeTime",0),Sn(this,"playbackTime",0),Sn(this,"lastTimeUpdatedTime",0),Sn(this,"autoplayFailed",!1),Sn(this,"videoTrack",void 0),Sn(this,"videoElement",void 0),Sn(this,"cacheVideoElement",void 0),Sn(this,"renderStats",void 0),Sn(this,"_videoState",Se.VideoStateStopped),Sn(this,"videoElementCheckInterval",void 0),Sn(this,"videoElementFreezeTimeout",void 0),Sn(this,"_videoElementStatus",g7.NONE),Sn(this,"isGettingVideoDimensions",!1),Sn(this,"startGetVideoDimensions",()=>{let e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return gA.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};this.isGettingVideoDimensions||e()}),Sn(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===Sl.curState&&(gA.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(mq())),vo()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack])):this.videoElement.pause(),this.videoElement.play())}),Sn(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=g7.PLAYING;break;case"loadeddata":if(this.videoState=Se.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=g7.CANPLAY;break;case"stalled":this.videoElementStatus=g7.STALLED;break;case"suspend":this.videoElementStatus=g7.SUSPEND;break;case"pause":this.videoElementStatus=g7.PAUSED,m4()||va()||m0()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(gA.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=g7.WAITING;break;case"abort":this.videoElementStatus=g7.ABORT;break;case"ended":this.videoElementStatus=g7.ENDED;break;case"emptied":this.videoElementStatus=g7.EMPTIED;break;case"error":{let e=this.videoElement.error;e&&(this.videoElementStatus=g7.ERROR,gA.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{let e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);let t=e-this.lastTimeUpdatedTime,r=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,br.lastVisibleTime<br.lastHiddenTime||r<br.lastHiddenTime||r<br.lastVisibleTime)return;for(t>E4("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;let e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}}}}),Sn(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(gA.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(mq())),vo()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack])):this.videoElement.pause(),this.videoElement.play())}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Sl.on(gw.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Sl.on(gw.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch(t=>{e&&SD(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(gA.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):gA.warning("[".concat(this.trackId,"] play warning: "),t)});let r=mz();if(("Safari"===r.name&&15===Number(r.version)||vi())&&t&&t.then){let e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return gA.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let r=t.getImageData(0,0,e.width,e.height);return e.remove(),r}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;let i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new dJ((i,n)=>{r.toBlob(async e=>{(r.remove(),e)?i({buffer:await SJ(e),width:r.width,height:r.height}):n(new vm(vA.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await SX(e)}destroy(){this.renderStats=void 0,Sl.off(gw.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Sl.off(gw.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Se.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=g7.INIT,!this.videoElementCheckInterval&&(S6.forEach(e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var e;(e=this.videoElement)!==document.body&&document.body.contains(e)||(this.videoElementStatus=g7.DESTROYED)},1e3),E4("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let r;let i=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",i),this.videoElementFreezeTimeout=window.setTimeout(n,E4("VIDEO_FREEZE_DURATION")))},n=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Se.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=Se.VideoStateFrozen:document.addEventListener("visibilitychange",i))},o=(e,t)=>{var i,a;if(this.videoElementStatus===g7.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=t.mediaTime):this.renderStats={lastTs:t.mediaTime,curTs:t.mediaTime,lastRenderNum:0,renderNum:0},r){let e=t.presentationTime-r.presentationTime;this.videoState===Se.VideoStateStarting&&(this.videoState=Se.VideoStateDecoding),this.videoState===Se.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(n,E4("VIDEO_FREEZE_DURATION"))),e<E4("VIDEO_FREEZE_DURATION")&&this.videoState===Se.VideoStateFrozen&&(this.videoState=Se.VideoStateDecoding),e>E4("VIDEO_FREEZE_DURATION")&&br.lastVisibleTime>=br.lastHiddenTime&&r.timestamp>br.lastVisibleTime&&r.timestamp>br.lastHiddenTime&&(this.renderFreezeAccTime+=e)}r=Sa(Sa({},t),{},{timestamp:e})}E4("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(i=(a=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(a,o))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,o)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),vl()&&!E4("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let r=mz();"Safari"===r.name&&15===Number(r.version)||vi()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,m1()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,m1()&&this.videoElement.load());let i=this.videoElement.play();void 0!==i&&i.catch(e=>{gA.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}resetVideoElement(){S6.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=g7.NONE}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{gA.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(e=>{gA.error(e)}),this.autoplayFailed=!1,vh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};vh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),SP()}}let S6=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class S3 extends S4{constructor(e){super(e),Sn(this,"container",void 0),Sn(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,r):await SX(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",E4("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}let S8=(t4=gb({argsMap:(e,t,r)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),t6=Sx(),t3=gb({argsMap:e=>[e.getTrackId()]}),t8=Ef("LocalVideoTrack","_enabledMutex"),t5=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),t9=Sx(),t7=Ef("LocalVideoTrack","_enabledMutex"),re=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),rt=Sx(),rr=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),ri=Sx(),rn=Sx(),ro=gb({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),ra=Sx(),rs=Sx(),rc=Sx(),rd=Sx(),ru=Sx(),rl=Sx(),rh=Sx(),rp=gb({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rf=gb({argsMap:e=>[e.getTrackId()]}),r_=gb({argsMap:e=>[e.getTrackId()]}),rA=gb({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),Si((rm=class e extends Sc{get videoHeight(){if(m0()){let{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(m0()){let{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==g7.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,r,i,n,o){if(super(e,n),Sn(this,"trackMediaType",gZ.VIDEO),Sn(this,"_player",void 0),Sn(this,"isUseScaleResolutionDownBy",!1),Sn(this,"_videoVisibleTimer",null),Sn(this,"_previousVideoVisibleStatus",void 0),Sn(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Sn(this,"_encoderConfig",void 0),Sn(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Sn(this,"_optimizationMode",void 0),Sn(this,"_videoHeight",void 0),Sn(this,"_videoWidth",void 0),Sn(this,"_forceBitrateLimit",void 0),Sn(this,"_enabled",!0),Sn(this,"_processorDestination",void 0),Sn(this,"_processorContext",void 0),m0()){let{width:t,height:r}=e.getSettings();this._videoWidth=t,this._videoHeight=r}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],-1===this._hints.indexOf(gY.SCREEN_TRACK))this.updateBitrateFromProfile();else if(m8(mH.CHROME,115)&&-1!==mJ().indexOf("Windows")){let t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&gR.supportWebRTCInsertableStream){let r=new MediaStreamTrackProcessor(e),i=new MediaStreamTrackGenerator({kind:"video"}),n,o,a=Date.now(),s=()=>{c&&(clearInterval(c),c=void 0),n&&(n.close(),n=void 0),e.stop(),o=void 0,i.removeEventListener("ended",s)},c=window.setInterval(()=>{if(o&&n&&Date.now()-a>1e3)try{"live"===i.readyState?o.enqueue(n.clone()):s()}catch(e){s()}},null!=t?t:1e3),d=new TransformStream({transform:(e,t)=>{"live"===i.readyState?(o=t,a=Date.now(),void 0===n?(n=e,t.enqueue(e.clone())):(t.enqueue(n),n=e)):e.close()}});return i.addEventListener("ended",s),r.readable.pipeThrough(d).pipeTo(i.writable),i}}(e);t&&(gA.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(gY.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new SB(this.getTrackId(),"local"),this._processorDestination=new SU(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let t=document.getElementById(e);t?e=t:(gA.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}gA.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=Sa(Sa(Sa({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new S4(r):this._player=new S3(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let e=this.getVideoElementVisibleStatus();this.safeEmit(gJ.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},E4("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,gA.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(gA.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await vz(this,gH.NEED_DISABLE_TRACK,this)}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void gA.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await vz(this,gH.NEED_ENABLE_TRACK,this)}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}gA.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,gA.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await vz(this,gH.NEED_MUTE_TRACK,this):await vz(this,gH.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new vm(vA.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=gU(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){let t=SH({encoderConfig:e});(m0()||m4()||va())&&(t.deviceId=void 0),gA.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(t){let e=new vm(vA.UNEXPECTED_ERROR,t.toString());throw gA.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}}this._encoderConfig=e,-1===this._hints.indexOf(gY.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await vz(this,gH.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(gA)}}getStats(){return v6(()=>{gA.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),vX(this,gH.GET_STATS)||Sa({},g2)}async setBeautyEffect(e){gA.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await SX(e)}async setBitrateLimit(e){gA.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void gA.error(vA.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let t=this._optimizationMode;try{this._optimizationMode=e,await vz(this,gH.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,gA.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}gA.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return gA.error(vA.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,gA.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){SW(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(En)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new vm(vA.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");gA.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=gU(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(gY.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await vz(this,gH.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(gA)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:e,height:t,frameRate:r}=this.getMediaStreamTrackSettings();if(!e||!t||!r)return;let{bitrateMax:i,bitrateMin:n}=this._encoderConfig;if(null==n||null==i){let{max:o,min:a}=function(e,t,r,i,n){var o,a;let s=E4("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===s)return{min:i,max:n};if(void 0===n){let a=Math.floor(200*Math.pow(r/15,.6)*Math.pow(e*t/640/360,.75));n="STANDARD_BITRATE"===s?4*a:2*a,i=null!==(o=i)&&void 0!==o?o:a}else i=null!==(a=i)&&void 0!==a?a:Math.floor(n/10);return{min:i,max:n}}(e,t,r,n,i);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,gA.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var e,t;let r=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),{element:i,slot:n}={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==r?void 0:r.parentElement};if(this.isPlaying&&i instanceof HTMLVideoElement&&n instanceof HTMLElement){let e=vk.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;let e=gT.reportApiInvoke(null,{tag:vx.TRACER,name:vM.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new vm(vA.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new vm(vA.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._encoderConfig;t&&(i=Sa(Sa({},i),gU(t))),i=v1(i);let n=Er(8,"track-video-cloned-"),o=new e(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,v1(this._scalabilityMode),this._optimizationMode,n,v1(this._hints));return t&&i&&o.setEncoderConfiguration(i),gA.debug("clone video track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(r)),o}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new vm(vA.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new vm(vA.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(v6(()=>{gT.reportApiInvoke(null,{name:vM.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:vx.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!E4("ENABLE_VIDEO_SEI")||!E4("ENABLE_ENCODED_TRANSFORM"))return void gA.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new vm(vA.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let t=this.getRTCRtpTransceiver();if(!t)return void gA.warning("Video track is not published, SEI can not be send");let r=t.sender.getParameters();if(0===r.codecs.length)return;let i=r.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===i?this.safeEmit("sei-to-send",e):gA.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(g3.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await vz(this,gH.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vz(this,gH.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(g3.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(g8.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(g8.REQUEST_CONSTRAINTS)}}).prototype,"play",[t4,t6],Object.getOwnPropertyDescriptor(rm.prototype,"play"),rm.prototype),Si(rm.prototype,"stop",[t3],Object.getOwnPropertyDescriptor(rm.prototype,"stop"),rm.prototype),Si(rm.prototype,"setEnabled",[t8,t5,t9],Object.getOwnPropertyDescriptor(rm.prototype,"setEnabled"),rm.prototype),Si(rm.prototype,"setMuted",[t7,re,rt],Object.getOwnPropertyDescriptor(rm.prototype,"setMuted"),rm.prototype),Si(rm.prototype,"setEncoderConfiguration",[rr,ri],Object.getOwnPropertyDescriptor(rm.prototype,"setEncoderConfiguration"),rm.prototype),Si(rm.prototype,"getStats",[rn],Object.getOwnPropertyDescriptor(rm.prototype,"getStats"),rm.prototype),Si(rm.prototype,"setBeautyEffect",[ro,ra],Object.getOwnPropertyDescriptor(rm.prototype,"setBeautyEffect"),rm.prototype),Si(rm.prototype,"getCurrentFrameData",[rs],Object.getOwnPropertyDescriptor(rm.prototype,"getCurrentFrameData"),rm.prototype),Si(rm.prototype,"getCurrentFrameImage",[rc],Object.getOwnPropertyDescriptor(rm.prototype,"getCurrentFrameImage"),rm.prototype),Si(rm.prototype,"setBitrateLimit",[rd],Object.getOwnPropertyDescriptor(rm.prototype,"setBitrateLimit"),rm.prototype),Si(rm.prototype,"setOptimizationMode",[ru],Object.getOwnPropertyDescriptor(rm.prototype,"setOptimizationMode"),rm.prototype),Si(rm.prototype,"setScalabiltyMode",[rl],Object.getOwnPropertyDescriptor(rm.prototype,"setScalabiltyMode"),rm.prototype),Si(rm.prototype,"updateMediaStreamTrackResolution",[rh],Object.getOwnPropertyDescriptor(rm.prototype,"updateMediaStreamTrackResolution"),rm.prototype),Si(rm.prototype,"pipe",[rp],Object.getOwnPropertyDescriptor(rm.prototype,"pipe"),rm.prototype),Si(rm.prototype,"unpipe",[rf],Object.getOwnPropertyDescriptor(rm.prototype,"unpipe"),rm.prototype),Si(rm.prototype,"close",[r_],Object.getOwnPropertyDescriptor(rm.prototype,"close"),rm.prototype),Si(rm.prototype,"replaceTrack",[rA],Object.getOwnPropertyDescriptor(rm.prototype,"replaceTrack"),rm.prototype),rm),S5=(rv=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),rE=Sx(),rg=Ef("CameraVideoTrack","_enabledMutex"),rS=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),rb=Sx(),rT=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),ry=Sx(),rR=gb({argsMap:e=>[e.getTrackId()]}),Si((rI=class e extends S8{get __className__(){return"CameraVideoTrack"}constructor(e,t,r,i,n,o){super(e,gU(t.encoderConfig),i,n,o),Sn(this,"_config",void 0),Sn(this,"_originalConstraints",void 0),Sn(this,"_constraints",void 0),Sn(this,"_enabled",!0),Sn(this,"_deviceName","default"),Sn(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(vi()||vn())&&!function(){let e=mz();if(e.os!==mW.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&vs()&&this._enabled&&!this._isClosed&&(gA.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=r,this._constraints=r,this._deviceName=e.label,this._encoderConfig=gU(this._config.encoderConfig),Sl.on(gw.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Sl.on(gw.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(gA.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{let t=await Sw.getDeviceById(e),r={};r.video=Sa({},this._constraints),r.video.deviceId={exact:e},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await SR(r,this.getTrackId())}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),i=await SR({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{let t=await Sw.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}gA.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){gA.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));let t={video:Sa(Sa({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await SR(t,this.getTrackId())}catch(t){throw gA.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await SR({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Sa({},t.video),gA.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(gA.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let e=await SR({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await vz(this,gH.NEED_ENABLE_TRACK,this)}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),gA.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await vz(this,gH.NEED_DISABLE_TRACK,this)}catch(e){throw gA.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}gA.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new vm(vA.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=gU(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);let r=v2(this._config);r.encoderConfig=e;let i=SH(r);(m0()||m4()||va())&&(i.deviceId=void 0),gA.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(t){let e=new vm(vA.UNEXPECTED_ERROR,t.toString());throw gA.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,-1===this._hints.indexOf(gY.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await vz(this,gH.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(gA)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((m4()||va())&&this._enabled&&!this._isClosed&&Sl.duringInterruption){let e=async()=>{Sl.off(gw.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(gA.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Sl.on(gw.IOS_INTERRUPTION_END,e)}else gA.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(gJ.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=Sw.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId={exact:r}),this._enabled){let e=await SR({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Sl.off(gw.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Sl.off(gw.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._encoderConfig;t&&(i=Sa(Sa({},i),gU(t))),i=v1(i);let n=Er(8,"track-cam-cloned-"),o=new e(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,v1(Sa(Sa({},this._config),{},{encoderConfig:i})),v1(this._constraints),v1(this._scalabilityMode),this._optimizationMode,n);return t&&i&&o.setEncoderConfiguration(i),gA.debug("clone track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(r)),o}bindProcessorContextEvents(){this.processorContext.on(g8.REQUEST_UPDATE_CONSTRAINTS,async(e,t,r)=>{try{let r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(e){r(e)}}),this.processorContext.on(g8.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[rv,rE],Object.getOwnPropertyDescriptor(rI.prototype,"setDevice"),rI.prototype),Si(rI.prototype,"setEnabled",[rg,rS,rb],Object.getOwnPropertyDescriptor(rI.prototype,"setEnabled"),rI.prototype),Si(rI.prototype,"setEncoderConfiguration",[rT,ry],Object.getOwnPropertyDescriptor(rI.prototype,"setEncoderConfiguration"),rI.prototype),Si(rI.prototype,"close",[rR],Object.getOwnPropertyDescriptor(rI.prototype,"close"),rI.prototype),rI);function S9(e,t,r,i){r.optimizationMode&&(i&&i.width&&i.height?(r.encoderConfig=Sa(Sa({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),"motion"!==r.optimizationMode&&"detail"!==r.optimizationMode||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?gA.debug("[".concat(e,"] set content hint to"),r.optimizationMode):gA.debug("[".concat(e,"] set content hint failed")))):gA.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}class S7 extends Ss{getUserId(){return this._userId}constructor(e,t,r,i){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(i.clientId,"_").concat(Er(5,""))),Sn(this,"_userId",void 0),Sn(this,"_uintId",void 0),Sn(this,"_isDestroyed",!1),Sn(this,"store",void 0),Sn(this,"processor",void 0),Sn(this,"processorContext",void 0),this._userId=t,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,gA.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let be=(rC=gb({argsMap:(e,t,r)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),rk=gb({argsMap:e=>[e.getTrackId()]}),rw=gb({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rO=gb({argsMap:e=>[e.getTrackId()]}),Si((rN=class extends S7{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==g7.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,i){super(e,t,r,i),Sn(this,"_videoVisibleTimer",null),Sn(this,"_previousVideoVisibleStatus",void 0),Sn(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Sn(this,"trackMediaType",gZ.VIDEO),Sn(this,"_videoWidth",void 0),Sn(this,"_videoHeight",void 0),Sn(this,"_player",void 0),Sn(this,"processorDestination",void 0),Sn(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new SB(this.getTrackId(),"remote"),this.processorDestination=new SU(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return v6(()=>{gA.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),vX(this,gH.GET_STATS)||Sa({},g6)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let t=document.getElementById(e);t?e=t:(gA.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}gA.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=Sa(Sa({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new S4(r):this._player=new S3(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(gq.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=e=>{this.safeEmit(gq.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let e=this.getVideoElementVisibleStatus();this.safeEmit(gq.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},E4("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,gA.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){SW(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(En)}_updatePlayerSource(){gA.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let r=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),{element:i,slot:n}={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==r?void 0:r.parentElement};if(this.isPlaying&&i instanceof HTMLVideoElement&&n instanceof HTMLElement){let e=vk.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;let e=gT.reportApiInvoke(null,{tag:vx.TRACER,name:vM.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new vm(vA.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new vm(vA.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(g3.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(g3.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(gX.SEI_RECEIVED,e)}}).prototype,"play",[rC],Object.getOwnPropertyDescriptor(rN.prototype,"play"),rN.prototype),Si(rN.prototype,"stop",[rk],Object.getOwnPropertyDescriptor(rN.prototype,"stop"),rN.prototype),Si(rN.prototype,"pipe",[rw],Object.getOwnPropertyDescriptor(rN.prototype,"pipe"),rN.prototype),Si(rN.prototype,"unpipe",[rO],Object.getOwnPropertyDescriptor(rN.prototype,"unpipe"),rN.prototype),rN),bt=(rP=gb({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),rD=gb({argsMap:(e,t)=>[e.getTrackId(),t]}),rL=gb({argsMap:e=>[e.getTrackId()]}),rM=gb({argsMap:e=>[e.getTrackId()]}),rx=gb({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rU=gb({argsMap:e=>[e.getTrackId()]}),Si((rB=class extends S7{get isPlaying(){return this._useAudioElement?SM.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,i){super(e,t,r,i),Sn(this,"trackMediaType",gZ.AUDIO),Sn(this,"_source",void 0),Sn(this,"_useAudioElement",!0),Sn(this,"_volume",100),Sn(this,"processorContext",void 0),Sn(this,"processorDestination",void 0),Sn(this,"_played",!1),Sn(this,"_bypassWebAudio",!1),E4("DISABLE_WEBAUDIO")?(this._source=new Sj,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Sv(e,!0),E4("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(g$.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(gq.FIRST_FRAME_DECODED)}),this.processorContext=new SF(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new SV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(g$.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(g$.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(g$.ON_AUDIO_BUFFER),this._source.on(g$.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){this._volume=e,this._useAudioElement?SM.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!gC())throw new vm(vA.NOT_SUPPORTED,"your browser does not support setting the audio output device");await SM.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return v6(()=>{gA.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),vX(this,gH.GET_STATS)||Sa({},g1)}play(){gA.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(gA.debug("[".concat(this.getTrackId(),"] use audio element to play")),SM.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){gA.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?SM.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];gA.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&SM.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new vm(vA.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new vm(vA.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new vm(vA.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(g3.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(g3.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(g3.ON_TRACK),this.processorDestination.removeAllListeners(g3.ON_NODE)}}).prototype,"setVolume",[rP],Object.getOwnPropertyDescriptor(rB.prototype,"setVolume"),rB.prototype),Si(rB.prototype,"setPlaybackDevice",[rD],Object.getOwnPropertyDescriptor(rB.prototype,"setPlaybackDevice"),rB.prototype),Si(rB.prototype,"play",[rL],Object.getOwnPropertyDescriptor(rB.prototype,"play"),rB.prototype),Si(rB.prototype,"stop",[rM],Object.getOwnPropertyDescriptor(rB.prototype,"stop"),rB.prototype),Si(rB.prototype,"pipe",[rx],Object.getOwnPropertyDescriptor(rB.prototype,"pipe"),rB.prototype),Si(rB.prototype,"unpipe",[rU],Object.getOwnPropertyDescriptor(rB.prototype,"unpipe"),rB.prototype),rB),br=new class extends vP{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Sn(this,"_lastHiddenTime",0),Sn(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),gA.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class bi extends vP{constructor(e,t){super(),Sn(this,"trackMediaType",gZ.DATA),Sn(this,"_version",1),Sn(this,"_type",3),Sn(this,"_config",void 0),Sn(this,"_originDataChannel",void 0),Sn(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Sn(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),Sn(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return E4("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new dJ((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();let r=setTimeout(()=>{var e;t(new vm(vA.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new vm(vA.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new vm(vA.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Sr.OPEN,Sr.CLOSE,Sr.ERROR].forEach(t=>{let r=()=>{this.emit(t)};this._datachannelEventMap.set(t,r),e.addEventListener(t,r)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[r,i]=t;e.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class bn extends bi{constructor(e){super(e),Sn(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let t=new DataView(e.data.slice(0,this._dataStreamPacketHeader.byteLength)).getUint8(3);if(t!==this.id)return void(E4("SHOW_DATASTREAM2_LOG")&&gA.debug("invalid datachannel id: ".concat(t," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit(Sr.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class bo extends bi{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);let r=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function ba(){let e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>h_.revokeObjectURL(e),0),new Worker(h_.createObjectURL(e))}var bs=((eu=bs||{})[eu.AUDIO_LEVEL=1]="AUDIO_LEVEL",eu[eu.METADATA=2]="METADATA",eu[eu.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",eu);function bc(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.getUint8(0);if(71!==r)return;let i=e.getUint16(1),n=3+i,o=new Uint8Array(e.byteLength-n);o.set(new Uint8Array(e.buffer,n,e.byteLength-n));let a={m:r,tlvLen:i,tlv:[],frame:o},s=3;for(;s<n;){let r=e.getUint8(s),i=e.getUint16(s+1),n=3;if(r===bs.AUDIO_LEVEL){let o=e.getUint8(s+n);for(let t=1;t<i;t++)o=o<<8|e.getUint8(s+n+t);a.tlv.push({tag:r,length:i,value:t?127^o>>1:127&o})}else if(r===bs.METADATA||r===bs.AUDIO_64_BIT_PTS){let t=new Uint8Array(i);for(let r=0;r<i;r++)t[r]=e.getUint8(s+n+r);a.tlv.push({tag:r,length:i,value:t})}s+=n+i}return a}let bd=new Map,bu=139/13,bl=new Map;function bh(e,t,r){let i="".concat(e,"-").concat(t,"-").concat(r),n=0;return bl.has(i)?n=bl.get(i):(n=Math.log(function(e,t){let r=e-t;t<r&&(t=r);let i=1;for(let r=e,n=1;r>t;r--,n++)i=i*r/n;return i}(t,e))+e*Math.log(.5)+(t-e)*Math.log(.5)-Math.log(r)+r*e,bl.set(i,n)),n<1e-10&&(n=1e-10),n}function bp(e,t,r){let i=t.length,n=e.length/i,o=!1;for(let a=0,s=0;a<i;a++){let i=0;for(let t=s+n;s<t;s++)e[s]>r&&i++;t[a]!==i&&(t[a]=i,o=!0)}return o}window.cache=bl;let bf=0;class b_{constructor(e){Sn(this,"id",void 0),Sn(this,"immediates",[]),Sn(this,"lastNonSilence",-1),Sn(this,"immediateSpeechActivityScore",1e-10),Sn(this,"lastLevelChangedTime",Date.now()),Sn(this,"levels",[]),Sn(this,"longs",[]),Sn(this,"longSpeechActivityScore",1e-10),Sn(this,"mediums",[]),Sn(this,"mediumSpeechActivityScore",1e-10),Sn(this,"minLevel",0),Sn(this,"nextMinLevel",0),Sn(this,"nextMinLevelWindowLength",0),Sn(this,"energyScore",0),this.id=e||"".concat(bf++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let e=this.immediates,t=this.levels,r=this.minLevel+bu,i=!1;for(let n=0;n<e.length;++n){let o=t[n];o<r&&(o=0);let a=Math.floor(o/bu);e[n]!==a&&(e[n]=a,i=!0)}return i}computeLongs(){return bp(this.mediums,this.longs,4)}computeMediums(){return bp(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=bh(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=bh(this.longs[0],10,47),this.longSpeechActivityScore>1e-10&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=bh(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(as(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let r=e;return e<0&&(r=0),e>127&&(r=127),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+bu?r:r/2}return -1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let e=Math.sqrt(this.minLevel*this.nextMinLevel);e<0?e=0:e>127&&(e=127),this.minLevel=e,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class bA{constructor(e){Sn(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{let t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class bm{constructor(e,t,r){Sn(this,"isDominant",void 0),Sn(this,"energyRanking",void 0),Sn(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=r}}class bv extends vP{constructor(e){super(),Sn(this,"dominantId",null),Sn(this,"lastDecisionTime",0),Sn(this,"lastLevelChangedTime",0),Sn(this,"lastLevelIdleTime",0),Sn(this,"relativeSpeechActivities",[]),Sn(this,"speakers",new Map),Sn(this,"enableSilence",!1),Sn(this,"timeoutToSilenceInterval",0),Sn(this,"decisionMaker",null),Sn(this,"loudest",[]),Sn(this,"numLoudestToTrack",3),Sn(this,"energyExpireTimeMs",250),Sn(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=r&&(this.energyAlphaPct=r),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(t=>t.id===e)}levelChanged(e,t){let r=Date.now(),i=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());let n=i.levelChanged(t,r);return this.updateLoudestList(i,n,r)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(e=>{this.speakers.has(e.id)||this.speakers.set(e.id,e)})}removeSpeakers(e){e.forEach(e=>{this.speakers.delete(e.id)})}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new b_(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,r){let i=e.id===this.dominantId;if(t<0){let t=0;for(;t<this.loudest.length&&this.loudest[t]!==e;)++t;return new bm(i,t,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new bm(i,0,e.energyScore);let n=r-this.energyExpireTimeMs,o=0;for(;o<this.loudest.length;){let t=this.loudest[o];if(t.getLastLevelChangedTime()<n&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(t.id!==e.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let a=0;for(;a<this.loudest.length&&!(this.loudest[a].energyScore<e.energyScore);)++a;return a<this.numLoudestToTrack&&(this.loudest.splice(a,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new bm(i,a,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new bA(this),this.decisionMaker.execute())}makeDecision(e){let t=null,r=null,i=this.speakers.size,n=null;if(0===i)n=null;else if(1===i){var o;let t=d0(o=this.speakers).call(o).next().value;this.enableSilence&&t&&(n=t.id,t.evaluateSpeechActivityScores(e),e-t.lastNonSilence>this.timeoutToSilenceInterval&&(n=null))}else{let t=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==t){let e=this.speakers.entries().next();e.value&&(n=e.value[0],t=e.value[1])}else n=t.id;null!=t&&t.evaluateSpeechActivityScores(e);let r=this.relativeSpeechActivities,i=2;for(let o of this.speakers.entries()){let[a,s]=o;if(s===t)continue;s.evaluateSpeechActivityScores(e);for(let e=0;e<r.length;++e){let i=null==t?1e-10:t.getSpeechActivityScore(e);r[e]=Math.log(s.getSpeechActivityScore(e)/i)}let c=r[0],d=r[1],u=r[2];c>3&&d>2&&u>0&&d>i&&(i=d,n=a)}this.enableSilence&&null!=t&&n===t.id&&e-t.lastNonSilence>this.timeoutToSilenceInterval&&(n=null)}(null!=n||this.enableSilence)&&n!==this.dominantId&&(t=this.dominantId,this.dominantId=n,r=this.dominantId),(null!=r||this.enableSilence)&&r!==t&&this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){let e=Date.now(),t=300-(e-this.lastLevelIdleTime),r=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):r=t;let i=300-(e-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=e,this.makeDecision(e),i=300-(Date.now()-e)),i>0&&r>i&&(r=i),r}timeoutIdleLevels(e){let t=[];for(let i of d0(r=this.speakers).call(r)){var r;let n=e-i.getLastLevelChangedTime();36e5<n&&(null==this.dominantId||i.id!==this.dominantId)?t.push(i.id):300<n&&i.levelTimedOut()}t.forEach(e=>this.speakers.delete(e))}}let bE=new Map,bg=null,bS=null,bb=[],bT=new Map,by=new Map;class bR{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){Sn(this,"id",void 0),Sn(this,"track",void 0),Sn(this,"score",0),Sn(this,"active",!0),Sn(this,"muted",!1),Sn(this,"timer",0),Sn(this,"actives",0),Sn(this,"inactives",0),this.id=e,this.track=t,this.setActive(bT.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let e=this.active;this.active=this.activeRate>=.8;let{actives:t,inactives:r}=function(){let e=[],t=[];return Array.from(d0(bT).call(bT)).forEach(r=>{r.active?e.push(r):t.push(r)}),{actives:e,inactives:t}}();if(t.length>3){let e;t.forEach(t=>{(!e||e.score>t.score)&&(e=t)}),e&&e.setActive(!1)}if(t.length<3&&r.length>0){let t;r.forEach(e=>{(!t||t.score<e.score)&&e.id!==this.id&&(t=e)}),t&&e&&!this.active&&(t.samples>40&&t.activeRate-this.activeRate>.4?t.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){var e;let t;let r=(e=this.id,Array.from(d0(bT).call(bT)).forEach(r=>{!r.active||r.id===e||r.samples<40||(!t||r.score<t.score)&&(t=r)}),t);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){var e;let t;let r=(e=this.id,Array.from(d0(bT).call(bT)).forEach(r=>{r.active||r.id===e||r.samples<40||(!t||r.score>t.score)&&(t=r)}),t);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(0!==this.samples)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}function bI(e){let t=bT.get(e);t&&(bT.delete(e),t.clearTimer())}let bC=new Map,bk=new Map,bw=new Map,bO=new Map;!function(){let e=mz();gR.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),gR.getStreamFromExtension=e.name===mH.CHROME&&Number(e.version)>34,gR.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),gR.supportMinBitrate=e.name===mH.CHROME||e.name===mH.EDGE,gR.supportSetRtpSenderParameters=function(){let e=mz();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!vu()||!(!m0()&&!mZ())||e.name===mH.FIREFOX&&Number(e.version)>=64)}(),e.name===mH.SAFARI&&(Number(e.version)>=14?gR.supportDualStream=!0:gR.supportDualStream=!1),gR.webAudioMediaStreamDest=function(){let e=mz();return!(e.name===mH.SAFARI&&12>Number(e.version))}(),gR.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,gR.supportWebGL="undefined"!=typeof WebGLRenderingContext,gR.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,vu()||(gR.webAudioWithAEC=!0),gR.supportShareAudio=function(){let e=mz();return(e.os===mW.WIN_10||e.os===mW.WIN_81||e.os===mW.WIN_7||e.os===mW.LINUX||e.os===mW.MAC_OS||e.os===mW.CHROMIUM_OS)&&e.name===mH.CHROME&&Number(e.version)>=74}(),gR.supportDataChannel=!!(m6(76)||function(e){let t=mz();return!(t.name!==mH.FIREFOX||!t.osVersion)&&Number(t.version)>=68}(68)||m9(14)),gR.supportPCSetConfiguration=function(){let e=window.RTCPeerConnection;return!m1()&&!!e&&e.prototype.setConfiguration instanceof Function}(),gR.supportWebRTCEncodedTransform=function(){let e=mz();return"Chrome"===e.name&&Number(e.version)>=87||"Safari"===e.name&&Number(e.version)>=15}(),gR.supportWebRTCInsertableStream=function(){let e=mz();return(e.name===mH.CHROME||e.name===mH.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),gR.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,gR.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,v0(()=>{gR.supportDualStreamEncoding=function(){let e=mz();return!!E4("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&E4("CHROME_DUAL_STREAM_USE_ENCODING"))}(),gA.debug("browser ua: ",navigator.userAgent),gA.info("browser info: ",e),gA.info("browser compatibility: ",gR)})}();let bN=["CHINA","GLOBAL"],bP=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],bD=[],bL=[];function bM(e,t){return!!t&&bD.some(r=>r.uid===e&&r.channelName===t)}function bx(){return bL.length>0}var bU=f7.forEach,bB=o6("forEach")?[].forEach:function(e){return bU(this,e,arguments.length>1?arguments[1]:void 0)};oS({target:"Array",proto:!0,forced:[].forEach!=bB},{forEach:bB});var bV=oM("Array").forEach,bF=Array.prototype,bj={DOMTokenList:!0,NodeList:!0},bG=iB(function(e){var t=e.forEach;return e===bF||iY(bF,e)&&t===bF.forEach||nH(bj,oY(e))?bV:t});oS({target:"Object",stat:!0,forced:iV(function(){aN(1)})},{keys:function(e){return aN(nG(e))}});var bW=iB(nA.Object.keys),bH=iB(o7),bY=iB(aa),bK=fX("slice"),bQ=nZ("species"),bz=Array,bX=Math.max;oS({target:"Array",proto:!0,forced:!bK},{slice:function(e,t){var r,i,n,o=np(this),a=oN(o),s=ok(e,a),c=ok(void 0===t?a:t,a);if(at(o)&&((ct(r=o.constructor)&&(r===bz||at(r.prototype))||n_(r)&&null===(r=r[bQ]))&&(r=void 0),r===bz||void 0===r))return ca(o,s,c);for(i=new(void 0===r?bz:r)(bX(c-s,0)),n=0;s<c;s++,n++)s in o&&d4(i,n,o[s]);return i.length=n,i}});var bJ=oM("Array").slice,bq=Array.prototype,bZ=iB(function(e){var t=e.slice;return e===bq||iY(bq,e)&&t===bq.slice?bJ:t});function b$(e,t,r,i,n){var o,a,s,c={};return bG(o=bW(i)).call(o,function(e){c[e]=i[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=bH(a=bY(s=bZ(r).call(r)).call(s)).call(a,function(r,i){return i(e,t,r)||r},c),n&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(n):void 0,c.initializer=void 0),void 0===c.initializer&&(fG(e,t,c),c=null),c}let b0=((el={})[el.ACCESS_POINT=101]="ACCESS_POINT",el[el.UNILBS=201]="UNILBS",el[el.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",el),b2=((eh={})[eh.IIIEGAL_APPID=1]="IIIEGAL_APPID",eh[eh.IIIEGAL_UID=2]="IIIEGAL_UID",eh[eh.INTERNAL_ERROR=3]="INTERNAL_ERROR",eh),b1=((ep={})[ep.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",ep[ep.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",ep[ep.INTERNAL_ERROR=8]="INTERNAL_ERROR",ep[ep.NO_AUTHORIZED=9]="NO_AUTHORIZED",ep[ep.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",ep[ep.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",ep[ep.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",ep[ep.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",ep[ep.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",ep[ep.USER_OVERLOAD=16]="USER_OVERLOAD",ep[ep.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",ep[ep.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",ep),b4=((ef={})[ef.NO_FLAG_SET=100]="NO_FLAG_SET",ef[ef.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",ef[ef.INVALID_FALG_SET=102]="INVALID_FALG_SET",ef[ef.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",ef[ef.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",ef[ef.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",ef[ef.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",ef[ef.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",ef[ef.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",ef[ef.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",ef[ef.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",ef[ef.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",ef[ef.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",ef[ef.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",ef[ef.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",ef[ef.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",ef[ef.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",ef[ef.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",ef[ef.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",ef),b6=((e_={})[e_.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e_[e_.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e_[e_.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e_[e_.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e_[e_.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e_[e_.K_TICKET_INVALID=7]="K_TICKET_INVALID",e_[e_.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e_[e_.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e_[e_.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e_[e_.K_UID_BANNED=14]="K_UID_BANNED",e_[e_.K_IP_BANNED=15]="K_IP_BANNED",e_[e_.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e_[e_.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e_[e_.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e_[e_.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e_[e_.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e_[e_.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e_[e_.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e_[e_.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e_[e_.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e_[e_.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e_[e_.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e_[e_.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e_[e_.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e_[e_.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e_[e_.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e_[e_.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e_[e_.ERR_INVALID_UID=117]="ERR_INVALID_UID",e_[e_.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e_[e_.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e_[e_.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e_[e_.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e_[e_.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e_[e_.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e_[e_.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e_[e_.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e_[e_.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e_[e_.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e_[e_.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e_[e_.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e_[e_.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e_[e_.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e_[e_.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e_[e_.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e_[e_.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e_[e_.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e_[e_.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e_[e_.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e_[e_.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e_[e_.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e_[e_.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e_[e_.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e_[e_.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e_[e_.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e_[e_.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e_[e_.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e_[e_.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e_[e_.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e_[e_.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e_[e_.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e_[e_.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e_[e_.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e_[e_.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e_[e_.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e_[e_.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e_),b3=((eA={}).CONNECTING="connecting",eA.CONNECTED="connected",eA.RECONNECTING="reconnecting",eA.CLOSED="closed",eA),b8=((em={}).WS_CONNECTED="ws_connected",em.WS_RECONNECTING="ws_reconnecting",em.WS_CLOSED="ws_closed",em.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",em.ON_BINARY_DATA="on_binary_data",em.REQUEST_RECOVER="request_recover",em.REQUEST_JOIN_INFO="request_join_info",em.REQUEST_REJOIN_INFO="req_rejoin_info",em.IS_P2P_DISCONNECTED="is_p2p_dis",em.DISCONNECT_P2P="dis_p2p",em.ABORT_P2P_EXECUTION="abort_p2p_execution",em.NEED_RENEW_SESSION="need-sid",em.REPORT_JOIN_GATEWAY="report_join_gateway",em.REQUEST_TIMEOUT="request_timeout",em.REQUEST_SUCCESS="request_success",em.JOIN_RESPONSE="join_response",em.PRE_CONNECT_PC="pre_connect_pc",em.P2P_CONNECTION="p2p_connection",em.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",em.P2P_SUBSCRIBE="p2p_subscribe",em.P2P_UNSUBSCRIBE="p2p_unsubscribe",em.P2P_EXCHANGE_SDP="p2p_exchange_sdp",em.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",em.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",em.RECOVER_NOTIFICATION="recover_notification",em),b5=((ev={}).PING="ping",ev.PING_BACK="ping_back",ev.JOIN="join_v3",ev.REJOIN="rejoin_v3",ev.LEAVE="leave",ev.SET_CLIENT_ROLE="set_client_role",ev.PUBLISH="publish",ev.PUBLISH_DATASTREAM="publish_datastream",ev.UNPUBLISH="unpublish",ev.UNPUBLISH_DATASTREAM="unpublish_datastream",ev.SUBSCRIBE="subscribe",ev.PRE_SUBSCRIBE="pre_subscribe",ev.SUBSCRIBE_DATASTREAM="subscribe_datastream",ev.SUBSCRIBE_STREAMS="subscribe_streams",ev.UNSUBSCRIBE="unsubscribe",ev.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",ev.UNSUBSCRIBE_STREAMS="unsubscribe_streams",ev.SUBSCRIBE_CHANGE="subscribe_change",ev.TRAFFIC_STATS="traffic_stats",ev.RENEW_TOKEN="renew_token",ev.SWITCH_VIDEO_STREAM="switch_video_stream",ev.DEFAULT_VIDEO_STREAM="default_video_stream",ev.SET_FALLBACK_OPTION="set_fallback_option",ev.GATEWAY_INFO="gateway_info",ev.CONTROL="control",ev.SEND_METADATA="send_metadata",ev.DATA_STREAM="data_stream",ev.PICK_SVC_LAYER="pick_svc_layer",ev.RESTART_ICE="restart_ice",ev.CONNECT_PC="connect_pc",ev.SET_VIDEO_PROFILE="set_video_profile",ev.SET_PARAMETER="set_parameter",ev.SET_RTM2_FLAG="set_rtm2_flag",ev),b9=((eE={}).WRTC_STATS="wrtc_stats",eE.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",eE.DENOISER_STATS="denoiser_stats",eE.EXTENSION_USAGE_STATS="extension_usage_stats",eE),b7=((eg={}).ON_USER_ONLINE="on_user_online",eg.ON_USER_OFFLINE="on_user_offline",eg.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",eg.ON_PUBLISH_STREAM="on_publish_stream",eg.ON_UPLINK_STATS="on_uplink_stats",eg.ON_P2P_LOST="on_p2p_lost",eg.ON_REMOVE_STREAM="on_remove_stream",eg.ON_ADD_AUDIO_STREAM="on_add_audio_stream",eg.ON_ADD_VIDEO_STREAM="on_add_video_stream",eg.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",eg.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",eg.ON_USER_BANNED="on_user_banned",eg.ON_USER_LICENSE_BANNED="on_user_license_banned",eg.ON_NOTIFICATION="on_notification",eg.ON_CRYPT_ERROR="on_crypt_error",eg.MUTE_AUDIO="mute_audio",eg.MUTE_VIDEO="mute_video",eg.UNMUTE_AUDIO="unmute_audio",eg.UNMUTE_VIDEO="unmute_video",eg.ON_P2P_OK="on_p2p_ok",eg.RECEIVE_METADATA="receive_metadata",eg.ON_DATA_STREAM="on_data_stream",eg.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",eg.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",eg.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",eg.ENABLE_LOCAL_VIDEO="enable_local_video",eg.DISABLE_LOCAL_VIDEO="disable_local_video",eg.ENABLE_LOCAL_AUDIO="enable_local_audio",eg.DISABLE_LOCAL_AUDIO="disable_local_audio",eg.ON_PUBLISHED_USER_LIST="on_published_user_list",eg),Te=((eS={}).SEND_ONLY="SEND_ONLY",eS.RECEIVE_ONLY="RECEIVE_ONLY",eS),Tt=((eb={}).CONNECTED="websocket:connected",eb.RECONNECTING="websocket:reconnecting",eb.WILL_RECONNECT="websocket:will_reconnect",eb.CLOSED="websocket:closed",eb.FAILED="websocket:failed",eb.ON_MESSAGE="websocket:on_message",eb.REQUEST_NEW_URLS="websocket:request_new_urls",eb.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",eb.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",eb);function Tr(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw gA.error("Invalid Channel Name ".concat(e)),new gy(vA.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Ti(e){if(!("number"==typeof e&&Math.floor(e)===e&&0<=e&&e<=0xffffffff||vR(e,1,255)))throw new gy(vA.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");"string"==typeof e&&gA.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Tn=((eT={}).TRANSCODE="mix_streaming",eT.RAW="raw_streaming",eT),To={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Ta={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Ts(e,t){vb(e.url,"".concat(t,".url"),1,1e3,!1),vy(e.x)||vg(e.x,"".concat(t,".x"),0,1e4),vy(e.y)||vg(e.y,"".concat(t,".y"),0,1e4),vy(e.width)||vg(e.width,"".concat(t,".width"),0,1e4),vy(e.height)||vg(e.height,"".concat(t,".height"),0,1e4),vy(e.zOrder)||vg(e.zOrder,"".concat(t,".zOrder"),0,255),vy(e.alpha)||vg(e.alpha,"".concat(t,".alpha"),0,1,!1)}let Tc={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Td=((ey={}).WARNING="@live_uap-warning",ey.ERROR="@line_uap-error",ey.PUBLISH_STREAM_STATUS="@live_uap-publish-status",ey.WORKER_STATUS="@live_uap-worker-status",ey.REQUEST_NEW_ADDRESS="@live_uap-request-address",ey),Tu=((eR={}).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",eR),Tl=((eI={})[eI.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",eI[eI.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",eI[eI.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",eI[eI.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",eI[eI.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",eI[eI.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",eI[eI.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",eI[eI.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",eI[eI.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",eI[eI.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",eI[eI.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",eI[eI.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",eI[eI.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",eI[eI.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",eI[eI.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",eI[eI.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",eI[eI.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",eI[eI.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",eI[eI.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",eI[eI.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",eI[eI.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",eI);function Th(e){if(!e.channelName)throw new gy(vA.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new gy(vA.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&vb(e.token,"info.token",1,2047),Ti(e.uid),Tr(e.channelName),!0}let Tp=((eC={})[eC.SetSdkProfile=0]="SetSdkProfile",eC[eC.SetSourceChannel=1]="SetSourceChannel",eC[eC.SetSourceUserId=2]="SetSourceUserId",eC[eC.SetDestChannel=3]="SetDestChannel",eC[eC.StartPacketTransfer=4]="StartPacketTransfer",eC[eC.StopPacketTransfer=5]="StopPacketTransfer",eC[eC.UpdateDestChannel=6]="UpdateDestChannel",eC[eC.Reconnect=7]="Reconnect",eC[eC.SetVideoProfile=8]="SetVideoProfile",eC),Tf=((ek={}).NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",ek.NETWORK_CONNECTED="NETWORK_CONNECTED",ek.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",ek.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",ek.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",ek.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",ek.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",ek.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",ek.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",ek.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",ek),T_=((ew={}).RELAY_STATE_IDLE="RELAY_STATE_IDLE",ew.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",ew.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",ew.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",ew),TA=((eO={}).RELAY_OK="RELAY_OK",eO.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",eO.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",eO.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",eO),Tm=((eN={}).High="high",eN.Low="low",eN.Audio="audio",eN.Screen="screen",eN.ScreenLow="screen_low",eN),Tv=((eP={}).DISCONNECT="disconnect",eP.CONNECTION_STATE_CHANGE="connection-state-change",eP.NETWORK_QUALITY="network-quality",eP.STREAM_TYPE_CHANGE="stream-type-change",eP.IS_P2P_DISCONNECTED="is-p2p-dis",eP.DISCONNECT_P2P="dis-p2p",eP.REQUEST_NEW_GATEWAY_LIST="req-gate-url",eP.NEED_RENEW_SESSION="need-sid",eP.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",eP.JOIN_RESPONSE="join-response",eP.RESET_CONNECTION_EVENTS="reset-connection-events",eP.PRE_CONNECT_PC="pre-connect_pc",eP.UPDATE_GATEWAY_CONFIG="update-gateway-config",eP),TE=((eD={}).P2P_DISCONNECTED="P2P_DISCONNECTED",eD.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",eD.TIMEOUT="TIMEOUT",eD.UNKNOWN_REASON="UNKNOWN_REASON",eD),Tg=((eL={})[eL.Nothing=0]="Nothing",eL[eL.Audio=1]="Audio",eL[eL.LwoVideo=2]="LwoVideo",eL[eL.Video=4]="Video",eL[eL.Data=8]="Data",eL[eL.DataStream0=256]="DataStream0",eL[eL.DataStream1=512]="DataStream1",eL[eL.DataStream2=1024]="DataStream2",eL[eL.DataStream3=2048]="DataStream3",eL[eL.DataStream4=4096]="DataStream4",eL[eL.DataStream5=8192]="DataStream5",eL[eL.DataStream6=16384]="DataStream6",eL[eL.DataStream7=32768]="DataStream7",eL),TS=((eM={}).CHINA="CHINA",eM.ASIA="ASIA",eM.NORTH_AMERICA="NORTH_AMERICA",eM.EUROPE="EUROPE",eM.JAPAN="JAPAN",eM.INDIA="INDIA",eM.KOREA="KOREA",eM.HKMC="HKMC",eM.US="US",eM.OCEANIA="OCEANIA",eM.SOUTH_AMERICA="SOUTH_AMERICA",eM.AFRICA="AFRICA",eM.OVERSEA="OVERSEA",eM.GLOBAL="GLOBAL",eM.EXTENSIONS="EXTENSIONS",eM),Tb=[TS.AFRICA,TS.ASIA,TS.CHINA,TS.EUROPE,TS.GLOBAL,TS.INDIA,TS.JAPAN,TS.NORTH_AMERICA,TS.OCEANIA,TS.OVERSEA,TS.SOUTH_AMERICA];let TT=((ex={}).CHINA="CN",ex.ASIA="AS",ex.NORTH_AMERICA="NA",ex.EUROPE="EU",ex.JAPAN="JP",ex.INDIA="IN",ex.KOREA="KR",ex.HKMC="HK",ex.US="US",ex.OCEANIA="OC",ex.SOUTH_AMERICA="SA",ex.AFRICA="AF",ex.OVERSEA="OVERSEA",ex.GLOBAL="GLOBAL",ex.EXTENSIONS="GLOBAL",ex),Ty={CHINA:{},ASIA:{CODE:TT.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:TT.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:TT.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:TT.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:TT.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:TT.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:TT.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:TT.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:TT.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:TT.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:TT.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:TT.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:TT.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Ez&&(Ty.CHINA={CODE:TT.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let TR=((eU={}).UPDATE_BITRATE_LIMIT="update_bitrate_limit",eU.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",eU);function TI(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class TC extends vP{constructor(e,t){super(),Aa(this,"onICEConnectionStateChange",void 0),Aa(this,"onConnectionStateChange",void 0),Aa(this,"onDTLSTransportStateChange",void 0),Aa(this,"onDTLSTransportError",void 0),Aa(this,"onICETransportStateChange",void 0),Aa(this,"onFirstAudioReceived",void 0),Aa(this,"onFirstVideoReceived",void 0),Aa(this,"onFirstAudioDecoded",void 0),Aa(this,"onFirstVideoDecoded",void 0),Aa(this,"onFirstVideoDecodedTimeout",void 0),Aa(this,"onSelectedLocalCandidateChanged",void 0),Aa(this,"onSelectedRemoteCandidateChanged",void 0),Aa(this,"onICECandidateError",void 0),Aa(this,"getLocalVideoStats",void 0)}}class Tk extends TC{constructor(e,t){super(e,t),Aa(this,"establishPromise",void 0)}}let Tw=((eB={}).VIDEO="video",eB.AUDIO="audio",eB),TO=((eV={}).UDP_RELAY="udp_relay",eV.UDP_TCP_RELAY="udp_tcp_relay",eV.TCP_RELAY="tcp_relay",eV.RELAY="relay",eV),TN=((eF={})[eF.FIRST_CONNECTION=0]="FIRST_CONNECTION",eF[eF.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",eF[eF.RELAY_RESTART=2]="RELAY_RESTART",eF[eF.TCP_RESTART=3]="TCP_RESTART",eF[eF.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",eF[eF.OLD_RESTART=11]="OLD_RESTART",eF[eF.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",eF),TP=["disconnected","failed"];let TD=((ej={}).LocalVideoTrack="videoTrack",ej.LocalAudioTrack="audioTrack",ej.LocalVideoLowTrack="videoLowTrack",ej),TL=((eG={}).New="new",eG.Connected="connected",eG.Reconnecting="reconnecting",eG.Disconnected="disconnected",eG),TM=((eW={}).AudioMetadata="audioMetadata",eW.StateChange="stateChange",eW.IceConnectionStateChange="iceConnectionStateChange",eW.RequestMuteLocal="requestMuteLocal",eW.RequestUnmuteLocal="requestUnmuteLocal",eW.RequestRePublish="requestRePublish",eW.RequestRePublishDataChannel="requestRePublishDataChannel",eW.RequestReSubscribe="requestReSubscribe",eW.RequestUploadStats="requestUploadStats",eW.RequestUpload="requestUpload",eW.MediaReconnectStart="MediaReconnectStart",eW.MediaReconnectEnd="MediaReconnectEnd",eW.NeedSignalRTT="NeedSignalRTT",eW.RequestRestartICE="RequestRestartIce",eW.PeerConnectionStateChange="PeerConnectionStateChange",eW.RequestReconnect="RequestReconnect",eW.RequestReconnectPC="RequestReconnectPC",eW.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",eW.P2PLost="P2PLost",eW.UpdateVideoEncoder="UpdateVideoEncoder",eW.ConnectionTypeChange="ConnectionTypeChange",eW.RequestLowStreamParameter="RequestLowStreamParameter",eW.QueryClientConnectionState="QueryClientConnectionState",eW.LocalCandidate="LocalCandidate",eW.RequestP2PMuteLocal="requestP2PMuteLocal",eW.RequestP2PUnPublish="RequestP2PUnPublish",eW.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",eW.RequestP2PMuteRemote="RequestP2PMuteRemote",eW.RequestP2PRestartICE="RequestP2PRestartICE",eW),Tx=((eH={}).CONNECTING="CONNECTING",eH.RECONNECTING="RECONNECTING",eH.CONNECTED="CONNECTED",eH.CLOSED="CLOSED",eH),TU=((eY={})[eY.CONNECT_AP=0]="CONNECT_AP",eY[eY.AP_CONNECTED=1]="AP_CONNECTED",eY[eY.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",eY[eY.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",eY[eY.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",eY[eY.CONNECT_WORKER=5]="CONNECT_WORKER",eY[eY.WORKER_CONNECTED=6]="WORKER_CONNECTED",eY[eY.CLOSED=7]="CLOSED",eY),TB=((eK={}).CONNECTION_STATE_CHANGE="connection-state-change",eK.STATE_CHANGE="state-change",eK.INSPECT_RESULT="inspect-result",eK.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",eK.REQUEST_NEW_WORKER_URL="request-new-worker-url",eK),TV=((eQ={}).CONNECTED="transmitter:connected",eQ.RECONNECTING="transmitter:reconnecting",eQ.WILL_RECONNECT="transmitter:will_reconnect",eQ.CLOSED="transmitter:closed",eQ.FAILED="transmitter:failed",eQ.ON_MESSAGE="transmitter:on_message",eQ.REQUEST_NEW_URLS="transmitter:request_new_urls",eQ.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",eQ.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",eQ.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",eQ.FAILBACK="transmitter:failback",eQ.PRE_CONNECT_PC="transmitter:pre_connect_pc",eQ),TF=((ez={}).CAMERA_CHANGED="camera-changed",ez.MICROPHONE_CHANGED="microphone-changed",ez.PLAYBACK_DEVICE_CHANGED="playback-device-changed",ez.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",ez.AUTOPLAY_FAILED="autoplay-failed",ez.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",ez.SECURITY_POLICY_VIOLATION="security-policy-violation",ez),Tj=((eX={}).CONNECTING="CONNECTING",eX.RECONNECTING="RECONNECTING",eX.CONNECTED="CONNECTED",eX.CLOSED="CLOSED",eX),TG=((eJ={}).CONNECTION_STATE_CHANGE="connection-state-change",eJ.STATE_CHANGE="state-change",eJ.INSPECT_RESULT="inspect-result",eJ.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",eJ.REQUEST_NEW_WORKER_URL="request-new-worker-url",eJ),TW=((eq={})[eq.CONNECT_AP=0]="CONNECT_AP",eq[eq.AP_CONNECTED=1]="AP_CONNECTED",eq[eq.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",eq[eq.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",eq[eq.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",eq[eq.CONNECT_WORKER=5]="CONNECT_WORKER",eq[eq.WORKER_CONNECTED=6]="WORKER_CONNECTED",eq[eq.CLOSED=7]="CLOSED",eq),TH=((eZ={}).CALL="call",eZ.CANDIDATE="candidate",eZ.PUBLISH="publish",eZ.UNPUBLISH="unpublish",eZ.CONTROL="control",eZ.RESTART_ICE="restart_ice",eZ.ACK="ack",eZ.RESPONSE="response",eZ.JOIN="join",eZ.CHECK="check",eZ),TY=((e$={}).ABORT="abort",e$),TK=((e0={}).MUTE_LOCAL_AUDIO="mute_local_audio",e0.MUTE_LOCAL_VIDEO="mute_local_video",e0.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e0.UNMUTE_LOCAL_VIDEO="unmute_local_video",e0),TQ=((e2={}).P2P_TOKEN_TIMEOUT="p2p_token_timeout",e2.P2P_TOKEN_CHANGED="p2p_token_changed",e2),Tz={[b0.ACCESS_POINT]:{[b4.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[b4.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[b4.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[b4.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[b4.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[b4.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[b4.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[b0.UNILBS]:{[b1.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[b1.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[b1.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[b1.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[b1.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[b1.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[b1.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[b1.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[b1.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[b1.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[b1.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[b1.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[b0.STRING_UID_ALLOCATOR]:{[b2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[b2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[b2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function TX(e){let t=Tz[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===b0.ACCESS_POINT){let t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}let TJ={[b6.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[b6.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[b6.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[b6.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[b6.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[b6.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[b6.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[b6.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[b6.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[b6.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[b6.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[b6.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[b6.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[b6.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[b6.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[b6.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[b6.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[b6.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[b6.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[b6.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[b6.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[b6.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[b6.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[b6.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[b6.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[b6.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[b6.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[b6.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[b6.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[b6.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[b6.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[b6.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[b6.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[b6.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[b6.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[b6.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[b6.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[b6.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[b6.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[b6.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[b6.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[b6.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[b6.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[b6.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[b6.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[b6.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[b6.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[b6.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[b6.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[b6.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[b6.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[b6.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[b6.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[b6.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[b6.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[b6.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[b6.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[b6.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[b6.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[b6.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[b6.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[b6.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[b6.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[b6.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Tq(e){return TJ[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function TZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function T$(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?TZ(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TZ(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function T0(e,t){if("string"==typeof e)return e;let{proxy:r,host:i,port:n}=e;if(t){let e=E4("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(i,"/ws/?p=").concat(Number(n)+150):"wss://".concat(i,":").concat(e,"/ws/?p=").concat(Number(n)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(i,"&p=").concat(n):"wss://".concat(i,":").concat(n)}let T2=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,T1=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,T4=/wss:\/\/(.+):([0-9]+)\/?/,T6=/wss:\/\/(.[^\/]+)\/?/,T3=0;class T8{constructor(e,t){Aa(this,"id",0),Aa(this,"store",void 0),Aa(this,"recordIndex",void 0),Aa(this,"websockets",[]),Aa(this,"try443PortDuration",2e3),Aa(this,"forceCloseWSDuration",5e3),Aa(this,"try443PortTimeout",null),Aa(this,"forceCloseTimeout",null),Aa(this,"isTry443PortFailed",!1),Aa(this,"isNormalPortFailed",!1),Aa(this,"useDoubleDomain",!1),Aa(this,"useProxy",!1),Aa(this,"startTime",Date.now()),this.id=++T3,this.try443PortDuration=E4("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;let t=Date.now()-this.startTime;for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];gA.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...i)}createWebSocket(e,t,r){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:r});let i=E4("GATEWAY_DOMAINS"),n=Date.now(),o=[],a=i.find(t=>{var r;return o0(r=e.host).call(r,t)});a||(this.useDoubleDomain=!1);let s=[];if(this.useDoubleDomain)i.forEach(r=>{s.push(T0(T$(T$({},e),{},{host:e.host.replace(a,r)}),t))});else{let r=T$({},e);if(t&&a){let e=i.find(e=>e!==a);e&&(r.host=r.host.replace(a,e))}s.push(T0(r,t))}try{s.forEach(e=>{let t=new WebSocket(e);t.binaryType="arraybuffer",o.push(t),this.logger("ws is connecting:",t.url)})}catch(i){if(this.logger("ws create failed"),o.forEach(e=>e.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,r);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,r);throw new gy(vA.WS_ERR,"init websocket failed! Error: ".concat(i.toString()))}let c=mV();this.store&&this.store.recordJoinChannelService({urls:o.map(e=>e.url),service:"gateway"},this.recordIndex),o.forEach(e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-n,"ms")),this.websockets.forEach(t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))}),this.websockets.length=0,c.resolve(e)},e.onclose=r=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-n,"ms state: ").concat(e.readyState));let i=o.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING);this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(i)),i&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(r.reason)),c.reject({code:r.code,reason:TE.A_ROUND_WS_FAILED})):!t&&i&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),u()),t?this.isTry443PortFailed=i:this.isNormalPortFailed=i},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))}),this.websockets.push(...o);let d=()=>{this.websockets.forEach(e=>e.readyState!==WebSocket.OPEN&&e.close())},u=()=>{if(c.isResolved)return d();mz().os===mW.MAC_OS&&m1()&&d(),this.createWebSocket(e,!0,!0).then(e=>{c.resolve(e)}).catch(e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,d()},this.forceCloseWSDuration)};return r||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,d()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,u()},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,r,i){var n;let o,a,s;return this.useDoubleDomain=!!t,"string"==typeof e&&(n=e,[,o,a,s]=n.match(T2)||[],o||([,a,s]=n.match(T1)||[]),a&&s||([,a,s]=n.match(T4)||[]),a&&s||([,a]=n.match(T6)||[]),a||gA.warning("un-destructible url: ",n),e={proxy:o,host:a,port:s||"443"}),this.recordIndex=i,this.useProxy=!!e.proxy,r&&this.useProxy&&(gA.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(e,!!r,!1).finally(()=>this.clearTimeout())}}function T5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}class T9 extends vP{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;o0(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Tt.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Tt.CONNECTED):"closed"===this._state?this.emit(Tt.CLOSED):"failed"===this._state&&this.emit(Tt.FAILED))}resetReconnectCount(e){gA.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),Aa(this,"connectionID",0),Aa(this,"currentURLIndex",0),Aa(this,"urls",[]),Aa(this,"_reconnectMode","tryNext"),Aa(this,"reconnectReason",void 0),Aa(this,"_initMutex",void 0),Aa(this,"name",void 0),Aa(this,"_state","closed"),Aa(this,"reconnectInterrupter",void 0),Aa(this,"websocket",void 0),Aa(this,"retryConfig",void 0),Aa(this,"reconnectCount",0),Aa(this,"forceCloseTimeout",5e3),Aa(this,"onlineReconnectListener",void 0),Aa(this,"useCompress",void 0),Aa(this,"tryDoubleDomain",!1),Aa(this,"use443PortOnly",!1),Aa(this,"wsInflateLength",0),Aa(this,"wsDeflateLength",0),Aa(this,"closeEstablishingWs",()=>{}),Aa(this,"store",void 0),Aa(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T5(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T5(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},t),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=n,this._initMutex=new Ep("websocket",o?o.clientId:void 0);let{timeout:a,timeoutFactor:s}=t,c=Math.max(300,Math.floor(3*a/5)),d=Math.max(1.2,Math.floor(8*s)/10);vY.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=d),vq.on(vK.NETWORK_STATE_CHANGE,(e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===vY.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=d):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=s))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{let e=mV(),t=this.urls[this.currentURLIndex];E4("ENABLE_PREALLOC_PC")&&this.emit(TV.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(Tt.CLOSED,()=>{e.reject(new vm(vA.WS_DISCONNECT))}),this.once(Tt.CONNECTED,e.resolve),await e.promise}catch(e){}finally{r()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let e=this.websocket;t?setTimeout(()=>e.close(),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void gA.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),gA.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[Error(t)]},this.joinGatewayRecordIndex);let r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new vm(vA.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new vm(vA.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t,r;let i=mV();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let n=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),gA.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},o=async e=>{var t;if(gA.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new vm(vA.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");let t=vX(this,Tt.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void gA.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return i.reject(new vm(vA.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);i.resolve()}};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),E4("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=E4("GATEWAY_WSS_ADDRESS")),gA.debug("[".concat(this.name,"] start connect, url:"),e);let a=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{let t=await this.chooseBestWebsocketConnection(e);this.websocket=t,n&&n(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=e=>{this.emit(Tt.ON_MESSAGE,e)},this.websocket.onerror=e=>{gA.warn("[".concat(this.connectionID,"] ws open error ").concat(e))},null===(r=this.store)||void 0===r||r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this.joinGatewayRecordIndex=a}catch(c){let e="closed"===this.state,t=c instanceof vm,r=t&&c.code===vA.WS_ABORT,n=t&&c.code===vA.WS_ERR,s=t?c.message:c&&(c.reason||c.toString());gA.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(s)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:r?"aborted":"error",errors:[c]},a),e||n?(i.reject(e?new vm(vA.WS_DISCONNECT,"websocket is closed: ".concat(s)):new vm(vA.WS_ERR,"init websocket failed: ".concat(s))),n&&gA.error("[".concat(this.name,"] init websocket failed: ").concat(s))):o&&o(c)}return i.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||0===this.urls.length||"closed"===this.state)return!1;gA.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||vq.isOnline||!vq.onlineWaiter||(this.onlineReconnectListener=vq.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,t){let t=EA(this.reconnectCount,this.retryConfig);gA.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await dJ.race([Et(t),this.onlineReconnectListener||new dJ(()=>{})])}if("closed"===this._state||!r)return!1;this.reconnectCount+=1;let i=async(e,t)=>{this.emit(Tt.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await i(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);gA.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],e)}else"recover"===e&&(gA.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await vQ(this,Tt.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(i){var n;gA.error("[".concat(this.name,"] reconnect failed ").concat(i&&i.toString()));let r=null==i||null===(n=i.data)||void 0===n?void 0:n.desc;return Array.isArray(r)&&o0(r).call(r,"dynamic key expired")?(this.emit(Tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class T7 extends T9{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){var r;let i=mV(),n=(r=this.forceCloseTimeout,new T8(r,this.store));this.closeEstablishingWs=()=>{gA.debug("[choose-best-ws] close establishing websockets"),n.closeAllWebsockets(),i.reject(new vm(vA.WS_ABORT,"choose best websocket aborted"))};let o=E4("GATEWAY_DOMAINS");return gA.debug("[choose-best-ws] currentDomain: ",e,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),n.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class ye extends T9{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new dJ((r,i)=>{var n,o;let a=!1,s=[];this.closeEstablishingWs=()=>{gA.debug("[choose-best-ws] close establishing websockets"),s.forEach(e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()}),i(new vm(vA.WS_ABORT,"choose best websocket aborted"))};let c=E4("GATEWAY_DOMAINS"),d=e.indexOf("?h="),u=c.find(t=>-1!==d?o0(e).call(e,t,d):o0(e).call(e,t));gA.debug("[choose-best-ws] currentDomain: ",u,", domains: ",c);let l=!this.tryDoubleDomain||!u;if(!l&&u){let o=Date.now();try{c.forEach(t=>{let r=-1===d?e.replace(u,t):e.substr(0,d)+e.substr(d).replace(u,t),i=new WebSocket(r);i.binaryType="arraybuffer",s.push(i),gA.debug("[choose-best-ws] ws is connecting:",i.url)})}catch(e){for(gA.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach(e=>e.close());s.length;)s.pop();l=!0}null===(n=this.store)||void 0===n||n.recordJoinChannelService({urls:s.map(e=>e.url),service:"gateway"},t),s.forEach(e=>{e.onopen=()=>{if(a)return;let t=Date.now()-o;gA.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),s.filter(t=>t!==e).forEach(e=>{gA.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()}),a=!0,r(e)},e.onclose=e=>{!a&&(s.find(e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))||(gA.debug("[choose-best-ws] all websocket is closed"),a=!0,i(e)))},e.onmessage=t=>{gA.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}}),Et(this.forceCloseTimeout).then(()=>{s.forEach(e=>{e.readyState!==WebSocket.OPEN&&e.close()})})}if(l){let n;gA.debug("[choose-best-ws] use single url: ",e),null===(o=this.store)||void 0===o||o.recordJoinChannelService({urls:[e],service:"gateway"},t);try{n=new WebSocket(e),s.push(n),n.binaryType="arraybuffer"}catch(t){let e=new vm(vA.WS_ERR,"init websocket failed! Error: ".concat(t.toString()));return gA.error("[".concat(this.name,"]").concat(e)),void i(e)}n.onopen=()=>{r(n)},n.onclose=e=>{i(e)},n.onmessage=e=>{gA.debug("[choose-best-ws]".concat(n.url," onmessage: ").concat(e.data))},Et(this.forceCloseTimeout).then(()=>{n&&n.readyState!==WebSocket.OPEN&&n.close()})}}).then(e=>(this.closeEstablishingWs=void 0,e)).catch(e=>{throw this.closeEstablishingWs=void 0,e})}}class yt extends vP{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===b3.CONNECTED?this.emit(b8.WS_CONNECTED):e===b3.RECONNECTING?this.emit(b8.WS_RECONNECTING,this._websocketReconnectReason):e===b3.CLOSED&&this.emit(b8.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),Aa(this,"_disconnectedReason",void 0),Aa(this,"_websocketReconnectReason",void 0),Aa(this,"_connectionState",b3.CLOSED),Aa(this,"reconnectToken",void 0),Aa(this,"websocket",void 0),Aa(this,"openConnectionTime",void 0),Aa(this,"clientId",void 0),Aa(this,"lastMsgTime",Date.now()),Aa(this,"uploadCache",[]),Aa(this,"uploadCacheInterval",void 0),Aa(this,"rttRolling",new EE(5)),Aa(this,"pingpongTimer",void 0),Aa(this,"wsInflateDataTimer",void 0),Aa(this,"pingpongTimeoutCount",0),Aa(this,"joinResponse",void 0),Aa(this,"multiIpOption",void 0),Aa(this,"initError",void 0),Aa(this,"spec",void 0),Aa(this,"store",void 0),Aa(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(b8.ON_BINARY_DATA,e.data);let t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){let e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===b7.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===b7.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(vV.UID_BANNED);break;case 15:this.close(vV.IP_BANNED);break;case 16:this.close(vV.CHANNEL_BANNED)}if(t._type===b7.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case b6.ERR_LICENSE_MISSING:this.close(vV.LICENSE_MISSING);break;case b6.ERR_LICENSE_EXPIRED:this.close(vV.LICENSE_EXPIRED);break;case b6.ERR_LICENSE_MINUTES_EXCEEDED:this.close(vV.LICENSE_MINUTES_EXCEEDED);break;case b6.ERR_LICENSE_PERIOD_INVALID:this.close(vV.LICENSE_PERIOD_INVALID);break;case b6.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(vV.LICENSE_MULTIPLE_SDK_SERVICE);break;case b6.ERR_LICENSE_ILLEGAL:this.close(vV.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new T7("gateway-".concat(this.clientId),this.spec.retryConfig,!0,E4("JOIN_GATEWAY_USE_DUAL_DOMAIN"),E4("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===b3.CONNECTED&&this.reconnect("retry",vH.OFFLINE)})}async request(e,t,r,i){let n=Er(6,""),o=this.websocket.connectionID,a=()=>new dJ((t,r)=>{if(this.connectionState===b3.CONNECTED)return t();let i=()=>{this.off(b8.WS_CLOSED,n),t()},n=()=>{this.off(b8.WS_CONNECTED,i),r(new gy(vA.WS_ABORT))};this.once(b8.WS_CONNECTED,i),this.once(b8.WS_CLOSED,n),e!==b5.PUBLISH&&e!==b5.PUBLISH_DATASTREAM&&e!==b5.SUBSCRIBE&&e!==b5.SUBSCRIBE_DATASTREAM&&e!==b5.UNSUBSCRIBE&&e!==b5.UNSUBSCRIBE_DATASTREAM&&e!==b5.UNPUBLISH&&e!==b5.UNPUBLISH_DATASTREAM&&e!==b5.CONTROL&&e!==b5.RESTART_ICE||this.once(b8.DISCONNECT_P2P,()=>{r(new gy(vA.DISCONNECT_P2P))}),e!==b5.PUBLISH&&e!==b5.RESTART_ICE||this.once(b8.ABORT_P2P_EXECUTION,()=>{r(new gy(vA.DISCONNECT_P2P))})});if(this.connectionState!==b3.CONNECTING&&this.connectionState!==b3.RECONNECTING||e===b5.JOIN||e===b5.REJOIN||await a(),this.websocket.sendMessage({_id:n,_type:e,_message:t},!0),i)return;let s=new dJ((r,i)=>{let a=!1,s=(i,n)=>{a=!0,r({isSuccess:"success"===i,message:n||{}}),this.off(b8.WS_CLOSED,c),this.off(b8.WS_RECONNECTING,c),this.emit(b8.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(n),s);let c=()=>{i(new gy(vA.WS_ABORT,"type: ".concat(e))),this.off(b8.WS_CLOSED,c),this.off(b8.WS_RECONNECTING,c),this.off("res-@".concat(n),s)};this.once(b8.WS_CLOSED,c),this.once(b8.WS_RECONNECTING,c),Et(E4("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==o||a||(gA.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(b8.REQUEST_TIMEOUT,e,t))})}),c=null;try{c=await s}catch(i){if(this.connectionState===b3.CLOSED||e===b5.LEAVE)throw new gy(vA.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?i.throw():e===b5.JOIN||e===b5.REJOIN?null:(await a(),await this.request(e,t))}if(c.isSuccess)return c.message;let d=Number(c.message.error_code||c.message.code),u=Tq(d),l=new gy(vA.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(c.message.error_str),{code:d,data:c.message,desc:u.desc});return"success"===u.action?c.message:(gA.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===b6.ERR_TOO_MANY_BROADCASTERS?((e===b5.JOIN||e===b5.REJOIN)&&(this.initError=l,this.close()),l.throw()):"failed"===u.action?l.throw():"quit"===u.action?(this.initError=l,this.close(),l.throw()):(d===b6.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=c.message.option,gA.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",vH.MULTI_IP)):this.reconnect(u.action,vH.SERVER_ERROR),e===b5.JOIN||e===b5.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new dJ(r=>{let i=n=>{(!t||t(n))&&(this.off(e,i),r(n))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void gA.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(b9.WRTC_STATS,t)}upload(e,t){let r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(t){let e=E4("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==b3.CONNECTED)return;let e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},E4("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){this.websocket.sendMessage({_type:e,_message:t})}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dJ((t,r)=>{this.once(b8.WS_CONNECTED,()=>t(this.joinResponse)),this.once(b8.WS_CLOSED,e=>r(this.initError||new gy(vA.WS_ABORT,e))),this.connectionState=b3.CONNECTING,this.websocket.init(e).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||vV.LEAVE,this.connectionState=b3.CLOSED,gA.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(b8.ABORT_P2P_EXECUTION);let e=await vQ(this,b8.REQUEST_JOIN_INFO),t=await this.request(b5.JOIN,e);if(!t)return this.emit(b8.REPORT_JOIN_GATEWAY,TE.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(b8.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=b3.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new gy(vA.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=vJ(this,b8.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(b5.REJOIN,e);return!!t&&(this.connectionState=b3.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(e=>{this.emit(b7.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(b7.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(b7.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(b7.MUTE_AUDIO,{uid:e.uid}):this.emit(b7.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(b7.MUTE_VIDEO,{uid:e.uid}):this.emit(b7.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(b7.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(b7.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(b7.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(b7.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(b7.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){gA.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Tq(e.code);if(28===e.code&&"detail"in e&&(gA.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(b8.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(vV.UID_BANNED),void this.close()):void this.reconnect(t.action,vH.SERVER_ERROR);gA.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=E4("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(gA.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>E4("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",vH.TIMEOUT):this.request(b5.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let e=Date.now()-t;this.rttRolling.add(e),E4("REPORT_STATS")&&this.send(b5.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(b9.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Tt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(b8.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Tt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Tt.CLOSED,()=>{this.connectionState=b3.CLOSED}),this.websocket.on(Tt.FAILED,()=>{this._disconnectedReason=vV.NETWORK_ERROR,this.connectionState=b3.CLOSED}),this.websocket.on(Tt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===b3.CONNECTED?this.connectionState=b3.RECONNECTING:this.connectionState=b3.CONNECTING}),this.websocket.on(Tt.WILL_RECONNECT,(e,t,r)=>{let i=vJ(this,b8.IS_P2P_DISCONNECTED),n=i||"retry"!==e;i&&"retry"===e&&(gA.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=TE.P2P_DISCONNECTED),n&&(gA.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(b8.REPORT_JOIN_GATEWAY,t||TE.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(b8.DISCONNECT_P2P)),r(e)}),this.websocket.on(Tt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{gA.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",vH.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(b8.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof gy){if(e.code===vA.UNEXPECTED_RESPONSE&&e.data.code===b6.ERR_NO_AUTHORIZED)return this.initError=new gy(vA.TOKEN_EXPIRE,"dynamic key expired"),void this.close(vV.TOKEN_EXPIRE);gA.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",vH.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Tt.REQUEST_NEW_URLS,(e,t)=>{vQ(this,b8.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(b7.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(TV.PRE_CONNECT_PC,()=>{this.emit(b8.PRE_CONNECT_PC)})}}let yr=((e1={}).NATIVE_RTC="native_rtc",e1.NATIVE_RTM="native_rtm",e1.WEB_RTC="web_rtc",e1.WEB_RTM="web_rtm",e1),yi=((e4={})[e4.CHOOSE_SERVER=11]="CHOOSE_SERVER",e4[e4.CLOUD_PROXY=18]="CLOUD_PROXY",e4[e4.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e4[e4.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e4);function yn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yn(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ya(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(E4("TURN_DOMAIN")):(gA.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function ys(e,t){let r;e.addresses||(e.addresses=[]);let i=function(e,t){if(E4("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map(e=>{let{ip:t,port:r}=e;return{address:"".concat(t,":").concat(r)}});let r=E4("GATEWAY_DOMAINS"),i=r[1]&&o0(t).call(t,r[1])?1:0;return e.map(e=>{let{domain_prefix:t,port:n,ip:o}=e;if(t)return{address:"".concat(t,".").concat(r[i++%r.length],":").concat(n)};let a=/^[\.\:\d]+$/.test(o),s=a?"".concat(o.replace(/[^\d]/g,"-"),".").concat(r[i++%r.length],":").concat(n):"".concat(o,":").concat(n);return a||gA.debug("Cannot recognized as ip address: ".concat(o,", use as host")),{ip:o,port:n,address:s}})}(e.addresses,t),n=Array.isArray(e.detail)&&e.detail[18];if(n&&"string"==typeof n){let e=n.split(";");for(let t=0;t<e.length;t++){var o;let r=po(o=e[t]).call(o);i[t]&&r&&(i[t].ip6=r)}}let a=e.detail&&e.detail.candidate;if(a){let[e,t]=a.split(":");e&&t&&(r={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:i,apGatewayAddress:r,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function yc(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function yd(e){let t=e._encoderConfig;if(!t)return{};let r={resolution:t.width&&t.height?"".concat(yc(t.width),"x").concat(yc(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function yu(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function yl(e,t){let r,i,n;switch(t){case yi.CHOOSE_SERVER:i=4096,n="choose server";break;case yi.CLOUD_PROXY:i=1048576,n="proxy";break;case yi.CLOUD_PROXY_5:i=4194304,n="proxy5";break;case yi.CLOUD_PROXY_FALLBACK:i=4194310,n="proxy fallback";break;default:throw new gy(vA.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(t=>{t.buffer&&t.buffer.flag===i&&(r={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map(e=>yo(yo({},e),{},{ticket:t.buffer.cert})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:yo(yo({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})}),!r)throw new gy(vA.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(n," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function yh(e,t){return await dJ.all(e.addresses.map(async e=>({address:E4("USE_TURN_IP")?e.ip:ya(e.ip),tcpport:e.port,udpport:e.port,username:t&&E4("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():EJ.username,password:t&&E4("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await vN(t.toString()):EJ.password})))}function yp(e,t){let r=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||r.height,n=t.videoWidth||r.width;return i&&n?Math.max(Math.min(i,n)/Math.min(yc(e.height),yc(e.width)),1):(gA.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function yf(e){let{candidateType:t,relayProtocol:r,type:i,address:n,port:o,protocol:a}=e,s={candidateType:t,relayProtocol:r,protocol:a};if("local-candidate"!==i){let e=n.split(".");e.length>=4&&(e[1]="*",e[2]="*"),s.address=e.join("."),s.port=o}return s}function y_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E4("SVC_MODE");if(E4("ENABLE_SVC"))return e in EU?e:EU.L1T3}let yA={[Tw.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Tw.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function ym(e,t,r){t.forEach(t=>{var i;let n=yA[e].find(e=>{var r;let{key:i}=e;return o0(r=t.extensionName).call(r,i)});if(!n)return;let o=r.find(e=>{let{extensionName:t}=e;return o0(t).call(t,n.key)});o&&o0(i=o.extensionName).call(i,"gdpr_forbidden")&&(t.extensionName=o.extensionName)})}function yv(e,t){t.forEach(t=>{var r;let i=yA[e].find(e=>{var r;let{key:i}=e;return o0(r=t.extensionName).call(r,i)});o0(r=t.extensionName).call(r,"gdpr_forbidden")&&i&&(t.extensionName=i.extensionName)})}function yE(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||o0(e).call(e,"abs-send-time")}function yg(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||o0(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function yS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yb(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yS(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yS(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,{filterRTX:n,filterVideoFec:o,filterAudioFec:a,filterAudioCodec:s,filterVideoCodec:c}=t,{useXR:d}=r,u=[],l=[],h=[],p=[],f=!1,_=!1;if(ge(e).mediaDescriptions.forEach(e=>{i&&i!==e.attributes.direction||("video"!==e.media.mediaType||f||(l=e.attributes.payloads,p=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||_||(u=e.attributes.payloads,h=e.attributes.extmaps,_=!0))}),!p||0===l.length)throw Error("Cannot get video capabilities from SDP.");if(!h||0===u.length)throw Error("Cannot get audio capabilities from SDP.");if(l.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),d&&e.rtcpFeedbacks.push({type:"rrtr"})}),u.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),d&&e.rtcpFeedbacks.push({type:"rrtr"})}),n&&(u=u.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}),l=l.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),o&&(l=l.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),a&&(u=u.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),s&&(null==s?void 0:s.length)>0&&(u=u.filter(e=>{var t;return o0(s).call(s,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")})),c&&(null==c?void 0:c.length)>0){let e=l.filter(e=>{var t;return o0(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")});l=e.concat(n?[]:yj(e,l))}let A=E4("UNSUPPORTED_VIDEO_CODEC");return A&&A.length>0&&(l=l.filter(e=>!(e.rtpMap&&o0(A).call(A,e.rtpMap.encodingName.toLowerCase())))),{audioCodecs:u,videoCodecs:l,audioExtensions:h,videoExtensions:p}}function yy(e){let t,r;let i=ge(e);for(let e of i.mediaDescriptions){if(!t){let r=e.attributes.iceUfrag,i=e.attributes.icePwd;if(!r||!i)throw Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:r,icePwd:i}}if(!r){let t=e.attributes.fingerprints;t.length>0&&(r={fingerprints:t})}}if(!r&&i.attributes.fingerprints.length>0&&(r={fingerprints:i.attributes.fingerprints}),!r||!t)throw Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:r}}function yR(e,t){let r=[],i=e.attributes.ssrcGroups.filter(e=>"FID"===e.semantic),n=e.attributes.ssrcGroups.find(e=>"SIM"===e.semantic),o=e.attributes.ssrcs;if(n)n.ssrcIds.forEach(e=>{var n;let o=null===(n=i.find(t=>t.ssrcIds[0]===e))||void 0===n?void 0:n.ssrcIds[1];r.push({ssrcId:e,rtx:t?o:void 0})});else if(i.length>0){let e=i[0].ssrcIds[0],n=i[0].ssrcIds[1];r.push({ssrcId:e,rtx:t?n:void 0})}else{if(0===o.length)throw Error("No ssrcs found on local media description.");r.push({ssrcId:o[0].ssrcId})}return r}function yI(e,t,r){let i;let{cname:n}=e,o=[];t&&(o=yC(t)),0===o.length&&(o=e.iceParameters.candidates.map(e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})),gA.debug("Using candidates from gateway."));let a={fingerprints:e.dtlsParameters.fingerprints.map(e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint}))},s={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};switch(e.dtlsParameters.role){case"server":i="passive";break;case"client":i="active";break;case"auto":i="actpass"}let c=yB(e.rtpCapabilities),d=[];return Array.isArray(r)&&r.length>0&&r.forEach(e=>{d.push({kind:Tw.VIDEO,ssrcId:e.v,rtx:e.v_rtx,mslabel:"".concat(e.v,"_").concat(e.a)},{kind:Tw.AUDIO,ssrcId:e.a,mslabel:"".concat(e.v,"_").concat(e.a)})}),{dtlsParameters:a,iceParameters:s,candidates:o,rtpCapabilities:c,setup:i,cname:n,preSSRCs:d}}function yC(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],gA.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),gA.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function yk(e,t,r){let i=[],n=[];return e.forEach(e=>{let{ssrcId:o,rtx:a}=e,s=Er(8,"track-"),c={ssrcId:o,attributes:yb({label:s,mslabel:r=r||Er(10,""),msid:"".concat(r," ").concat(s)},t&&{cname:t})};if(i.push(c),void 0!==a){let e={ssrcId:a,attributes:yb({label:s,mslabel:r,msid:"".concat(r," ").concat(s)},t&&{cname:t})};i.push(e),n.push({semantic:"FID",ssrcIds:[o,a]})}}),e.length>1&&n.push({semantic:"SIM",ssrcIds:e.map(e=>{let{ssrcId:t}=e;return t})}),{ssrcs:i,ssrcGroups:n}}function yw(e,t){t instanceof Sq&&e.attributes.payloads.forEach(e=>{var r;let i=null===(r=e.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase();if(!i||-1===["opus","pcmu","pcma","g722"].indexOf(i))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";let n=t._encoderConfig;n&&"pcmu"!==i&&"pcma"!==i&&"g722"!==i&&(n.bitrate&&!m1()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*n.bitrate))),n.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(n.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(n.sampleRate)),n.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))})}function yO(e){let t=e.attributes.unrecognized.findIndex(e=>"x-google-flag"===e.attField&&"conference"===e.attValue);-1!==t&&e.attributes.unrecognized.splice(t,1)}function yN(e,t){var r;if(!(t instanceof S8&&t._encoderConfig&&-1===t._hints.indexOf(gY.SCREEN_TRACK)))return;let i=t._encoderConfig;gR.supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(e=>{var t,r;o0(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(r=e.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),gR.supportMinBitrate&&!o0(r=t._hints).call(r,gY.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(e=>{var t,r;o0(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(r=e.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(E4("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function yP(e){if("video"!==e.media.mediaType)return;let t=mz();if(t.name!==mH.SAFARI&&t.os!==mW.IOS)return;let r=e.attributes.extmaps.findIndex(e=>/video-orientation/g.test(e.extensionName));-1!==r&&e.attributes.extmaps.splice(r,1)}function yD(e,t,r){let i,n;if(t){var o,a;if("video"===e.media.mediaType?(i=r.videoExtensions,n=r.videoCodecs):(i=r.audioExtensions,n=r.audioCodecs),!0===t.twcc){let t=i.find(e=>yg(e.extensionName));if(t){;let r=t.extensionName;e.attributes.extmaps.find(e=>yg(e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:r}),(o=n,e.attributes.payloads.filter(e=>!!o.find(t=>t.payloadType===e.payloadType&&!!t.rtcpFeedbacks.find(e=>"transport-cc"===e.type)))).forEach(e=>{e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)||e.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===t.twcc){let t=e.attributes.extmaps.findIndex(e=>yg(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{let t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}if(!0===t.remb){let t=i.find(e=>yE(e.extensionName));if(t){;let r=t.extensionName;e.attributes.extmaps.find(e=>e.extensionName===r)||e.attributes.extmaps.push({entry:t.entry,extensionName:r}),(a=n,e.attributes.payloads.filter(e=>!!a.find(t=>t.payloadType===e.payloadType&&!!t.rtcpFeedbacks.find(e=>"goog-remb"===e.type)))).forEach(e=>{e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)||e.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===t.remb){let t=e.attributes.extmaps.findIndex(e=>yE(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{let t=e.rtcpFeedbacks.findIndex(e=>"goog-remb"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}}}function yL(e,t,r){if(m1()||"video"!==e.media.mediaType||!(t instanceof S8)||"vp9"!==r&&"vp8"!==r||"vp8"===r&&!E4("SIMULCAST")||"vp9"===r&&E4("ENABLE_SVC")||void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;let i="vp8"===r?2:t._scalabilityMode.numSpatialLayers,n=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(e=>"FID"===e.semantic&&e.ssrcIds[0]===n.ssrcId),a={semantic:"SIM",ssrcIds:[n.ssrcId]};for(let t=1;t<i;t++)e.attributes.ssrcs.push({ssrcId:n.ssrcId+t,attributes:v2(n.attributes)}),a.ssrcIds.push(n.ssrcId+t),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+t,attributes:v2(n.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[n.ssrcId+t,o.ssrcIds[1]+t]}));e.attributes.ssrcGroups.unshift(a)}async function yM(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});let{send:i,recv:n,sendrecv:o}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=yT(r,e,t,"sendonly"),n=yT(r,e,t,"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(yU(i,n,"videoExtensions",o,a,s),yU(i,n,"videoCodecs",o,a,s),yU(i,n,"audioExtensions",o,a,s),yU(i,n,"audioCodecs",o,a,s),E4("RAISE_H264_BASELINE_PRIORITY")){let e=[],t=[];s.videoCodecs.forEach((r,i)=>{var n,o,a;if("h264"===(null===(n=r.rtpMap)||void 0===n?void 0:n.encodingName.toLocaleLowerCase())){let n=s.videoCodecs[i+1],c=n&&yY(r,n),d=null===(o=r.fmtp)||void 0===o?void 0:o.parameters["profile-level-id"],u=null===(a=r.fmtp)||void 0===a?void 0:a.parameters["packetization-mode"];!d||d!==E4("FIRST_H264_PROFILE_LEVEL_ID")||E4("FIRST_PACKETIZATION_MODE")&&u!==E4("FIRST_PACKETIZATION_MODE")?c?t.push([r,n]):t.push([r]):c?e.push([r,n]):e.push([r])}}),e.length>0&&t.length>0&&(gA.debug("raising H264 baseline profile priority"),s.videoCodecs.forEach((r,i)=>{var n;if("h264"===(null===(n=r.rtpMap)||void 0===n?void 0:n.encodingName.toLocaleLowerCase())){let n=yY(r,s.videoCodecs[i+1]),o=e.shift()||t.shift()||[];o.length>0&&(n?s.videoCodecs.splice(i,2,...o):s.videoCodecs.splice(i,1,...o))}}),a.videoCodecs=a.videoCodecs.filter(e=>{var t,r;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(r=e.fmtp)||void 0===r?void 0:r.parameters["profile-level-id"])!==E4("FIRST_H264_PROFILE_LEVEL_ID"))}),E4("FILTER_SEND_H264_BASELINE")&&(o.videoCodecs=o.videoCodecs.filter(e=>{var t,r;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(r=e.fmtp)||void 0===r?void 0:r.parameters["profile-level-id"])!==E4("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:o,recv:a,sendrecv:s}}(e,t,(await r.createOffer()).sdp);try{r.close()}catch(e){}return{send:i,recv:n,sendrecv:o}}function yx(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=yT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(yU(e,t,"videoExtensions",r,i,n),yU(e,t,"videoCodecs",r,i,n),yU(e,t,"audioExtensions",r,i,n),yU(e,t,"audioCodecs",r,i,n),E4("RAISE_H264_BASELINE_PRIORITY")){let e=n.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){let t=n.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){gA.debug("raising H264 baseline profile priority");let r=n.videoCodecs[e];n.videoCodecs.splice(e,1),n.videoCodecs.splice(t,0,r)}-1!==t&&(i.videoCodecs=i.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:r,recv:i,sendrecv:n}}function yU(e,t,r,i,n,o){if("videoExtensions"===r||"audioExtensions"===r){let a=[];return e[r].forEach(e=>{t[r].some((t,r)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(r),!0})?o[r].push(e):i[r].push(e)}),void t[r].forEach((e,t)=>{-1===a.indexOf(t)&&n[r].push(e)})}if("videoCodecs"===r||"audioCodecs"===r){let a=[];return e[r].forEach(e=>{t[r].some((t,r)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(r),!0})?o[r].push(e):i[r].push(e)}),void t[r].forEach((e,t)=>{-1===a.indexOf(t)&&n[r].push(e)})}}function yB(e){let t,r;let{send:i,recv:n,sendrecv:o}=e;if(!o){if(!i||!n)throw Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:n}}return i?((t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[...i.audioCodecs,...o.audioCodecs],t.videoCodecs=[...i.videoCodecs,...o.videoCodecs],t.audioExtensions=[...i.audioExtensions,...o.audioExtensions],t.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):t=o,n?((r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[...n.audioCodecs,...o.audioCodecs],r.videoCodecs=[...n.videoCodecs,...o.videoCodecs],r.audioExtensions=[...n.audioExtensions,...o.audioExtensions],r.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):r=o,{send:t,recv:r}}function yV(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter(e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function yF(e,t,r,i){let n=[];if(e===Tw.VIDEO){if(E4("H264_PROFILE_LEVEL_ID")&&"h264"===i&&(n=t.videoCodecs.filter(e=>{var t;return o0(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,i)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===E4("H264_PROFILE_LEVEL_ID")})),!Array.isArray(n)||0===n.length){let e=[],o=[],a=[],s=[];if(r.videoCodecs.forEach(t=>{let r=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";o0(r).call(r,i)?e.push(t):o0(r).call(r,"vp9")?o.push(t):o0(r).call(r,"vp8")?a.push(t):o0(r).call(r,"h264")&&s.push(t)}),0===e.length){let t="";0!==o.length?(e=o,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==s.length&&(e=s,t="h264"),gA.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(n=t.videoCodecs.filter(t=>e.some(e=>e.payloadType===t.payloadType)))}if(0===n.length&&(gA.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),n=t.videoCodecs),E4("USE_PUB_RTX")||E4("USE_SUB_RTX")){let e=yj(n,t.videoCodecs);n=[...n,...e]}}else 0===(n=t.audioCodecs.filter(e=>{var t;return o0(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,i)})).length&&(gA.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),n=t.audioCodecs.filter(e=>{var t;return o0(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")}));return n}function yj(e,t){let r=e.map(e=>e.payloadType.toString());return t.filter(e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&o0(r).call(r,e.fmtp&&e.fmtp.parameters.apt))}async function yG(e,t,r){let i=t.toString(),n=function e(t,r,i,n){if(E4("SDP_LOGGING"))return gA.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(n,"\n"),t),"offer"===r?t=>{e(t,"answer","local"===i?"remote":"local",n)}:void 0}(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});let o=await e.createAnswer();if(!o.sdp)throw Error("cannot get answer sdp");let a=o.sdp;a=yW(a,r||{}),null==n||n(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function yW(e,t,r){let i=ge(e),{useXR:n}=t;return i.mediaDescriptions.forEach(e=>{var t;e.attributes.mid&&(Array.isArray(r)&&!o0(r).call(r,e.attributes.mid)||("audio"===e.media.mediaType&&yV(e),n&&o0(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach(e=>{-1===e.rtcpFeedbacks.findIndex(e=>"rrtr"===e.type)&&e.rtcpFeedbacks.push({type:"rrtr"})})))}),gt(i)}function yH(e){let t=E4("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(t=>o0(e).call(e,t))}function yY(e,t){try{var r;return(null===(r=e.fmtp)||void 0===r?void 0:r.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function yK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function yQ(e,t){return typeof E4(e)===t?E4(e):void 0}let yz={};function yX(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&gA.debug("install service ".concat(e.name)),yz[e.name]=e}function yJ(e){let t=yz[e];if(!t)throw new vm(vA.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function yq(e,t){return yJ("DataStream").create(e,t)}function yZ(){return yJ("InterceptFrame").create()}function y$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function y0(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y$(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y$(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let y2=new Map;class y1 extends vP{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(Tv.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(Tv.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){gA.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var r,i,n;super(),Aa(this,"store",void 0),Aa(this,"joinInfo",void 0),Aa(this,"key",void 0),Aa(this,"ntpOffset",0),Aa(this,"signal",void 0),Aa(this,"role",void 0),Aa(this,"inChannelInfo",{joinAt:null,duration:0}),Aa(this,"spec",void 0),Aa(this,"_state","DISCONNECTED"),Aa(this,"_statsCollector",void 0),Aa(this,"_disconnectedReason",void 0),Aa(this,"isSignalRecover",!1),Aa(this,"hasChangeBGPAddress",!1),Aa(this,"trafficStatsInterval",void 0),Aa(this,"networkQualityInterval",void 0),Aa(this,"_joinGatewayStartTime",0),Aa(this,"_signalTimeout",!1),Aa(this,"_clientRoleOptions",void 0),Aa(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(r={spec:y0(y0({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(i=(n=yJ("P2PChannel")).createSubmodule)||void 0===i?void 0:i.call(n,r)):new yt(y0(y0({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,r){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);let i=Date.now(),n=y2.get(e.cname);if(n||(n=new Map,y2.set(e.cname,n)),this._isProactiveJoin=!0,n.has(e.uid)){let t=new gy(vA.UID_CONFLICT);throw gT.joinGateway(e.sid,{lts:i,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}n.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=i;let a=e.proxyServer;try{gA.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));let t=e.gatewayAddrs.map(t=>{let{address:r}=t,[i,n]=r.split(":"),o={host:i,port:n};return e.proxyServer&&(o.proxy=e.proxyServer),o});o=(await this.signal.init(t)).uid,gA.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var s;throw gA.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),gT.joinGateway(e.sid,{lts:i,succ:!1,ec:(null===(s=t.data)||void 0===s?void 0:s.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:e.preload}),n.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),gA.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{gA.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(Tv.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Tv.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(Tv.NETWORK_QUALITY,{uplinkNetworkQuality:yu(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:yu(this._statsCollector.trafficStats.B_dnq)}):this.emit(Tv.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==vV.FALLBACK&&(this.state="DISCONNECTING");try{var r,i;e||this.signal.connectionState!==b3.CONNECTED||await (r=this.signal.request(b5.LEAVE,void 0,!0),i=3e3,3e3==1/0?r:dJ.race([r,function(e){let t=new vm(vA.TIMEOUT,"timeout");return new dJ((r,i)=>{window.setTimeout(()=>i(t),e)})}(i)]))}catch(e){gA.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==vV.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,r){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:E4("PUB_EXTEND"),twcc:!!E4("PUBLISH_TWCC"),rtx:!!E4("USE_PUB_RTX")};try{return(await this.signal.request(b5.PUBLISH,i,!0))._message}catch(i){if(r&&i.data&&i.data.code===b6.ERR_PUBLISH_REQUEST_INVALID)return gA.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),i.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw i}}async publishDataChannel(e,t,r){var i;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let n={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(i=t.maxRetransmits)&&void 0!==i?i:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(b5.PUBLISH_DATASTREAM,n,!0)}catch(i){if(r&&i.data&&i.data.code===b6.ERR_PUBLISH_REQUEST_INVALID)return gA.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),i.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw i}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(b5.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){gA.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dJ.all(e.map(e=>this.signal.request(b5.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){gA.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,r){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let i={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!E4("SUBSCRIBE_TWCC"),rtx:!!E4("USE_SUB_RTX")||void 0,extend:E4("SUB_EXTEND"),svc:Array.isArray(E4("SVC"))&&0!==E4("SVC").length?E4("SVC"):void 0};try{return await this.signal.request(b5.PRE_SUBSCRIBE,i,!0)}catch(i){if(r&&i.data&&i.data.code===b6.ERR_SUBSCRIBE_REQUEST_INVALID)return gA.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),i.toString()),this.presubscribe(e,t,!1);throw i}}async subscribe(e,t,r){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let i={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!E4("SUBSCRIBE_TWCC"),rtx:!!E4("USE_SUB_RTX"),extend:E4("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(E4("SVC"))&&0!==E4("SVC").length?E4("SVC"):void 0};try{return(await this.signal.request(b5.SUBSCRIBE,i,!0))._message}catch(i){if(r&&i.data&&i.data.code===b6.ERR_SUBSCRIBE_REQUEST_INVALID)return gA.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),i.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw i}}async subscribeDataChannel(e,t,r){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let i={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(b5.SUBSCRIBE_DATASTREAM,i,!0)}catch(i){if(r&&i.data&&i.data.code===b6.ERR_SUBSCRIBE_REQUEST_INVALID)return gA.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),i.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw i}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!E4("USE_SUB_RTX"),twcc:!!E4("SUBSCRIBE_TWCC"),svc:Array.isArray(E4("SVC"))&&0!==E4("SVC").length?E4("SVC"):void 0};try{return await this.signal.request(b5.SUBSCRIBE_STREAMS,r,!0)}catch(r){if(t&&r.data&&r.data.code===b6.ERR_SUBSCRIBE_REQUEST_INVALID)return gA.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){let t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,r=e.width,i=e.height,n=!0;return"number"!=typeof t&&((t=t.exact||t.ideal||t.max||t.min||0)||(n=!1)),"number"!=typeof r&&((r=r.exact||r.ideal||r.max||r.min||0)||(n=!1)),"number"!=typeof i&&(i=i.exact||i.ideal||i.max||i.min||0,t||(n=!1)),n?{stream_type:0,width:r,height:i,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(b5.SET_VIDEO_PROFILE,t);gA.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(b5.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){gA.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new gy(vA.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dJ.all(e.map(e=>this.signal.request(b5.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0)))}catch(e){gA.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(b5.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){gA.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(b5.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(b5.GATEWAY_INFO)}async renewToken(e){await this.signal.request(b5.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),E4("CLIENT_ROLE_OPTIONS")&&(gA.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(E4("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},E4("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),E4("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},E4("CLIENT_ROLE_OPTIONS")),gA.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(E4("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let r,i=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(b5.SET_CLIENT_ROLE,{role:e,level:i,delay:r,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(b5.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(b5.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(b5.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(b5.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(b5.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),y0({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(b5.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=y2.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){var e;let t;if(!this.joinInfo)return;let r=(t=(e=("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"").startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/))?{username:EJ.username,password:EJ.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null;this.joinInfo.turnServer.serversFromGateway=[],r&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(y0(y0({},EJ),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;let e=await this.signal.request(b5.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(e=>{let t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(t=>t.peer_uid===e.peer_uid);t&&t.B_st!==e.B_st&&v0(()=>{this.emit(Tv.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t;if(!this.joinInfo||!this.key)throw new gy(vA.UNEXPECTED_ERROR,"can not generate join message, no join info");let r=Object.assign({},this.joinInfo.apResponse),i=E4("REPORT_APP_SCENARIO");if("string"!=typeof i)try{i=JSON.stringify(i)}catch(e){i=void 0}i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Tv.UPDATE_GATEWAY_CONFIG),t=this.store.clientId,o0(bL).call(bL,t)||bL.push(t);let n=!(m1()||m3(87)||gk())&&"boolean"==typeof E4("ENABLE_PRE_SUB")&&E4("ENABLE_PRE_SUB"),o=!gk()&&yQ("ENABLE_PREALLOC_PC","boolean"),a=function(){try{let e=E4("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yK(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yK(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e)}catch(e){return gA.debug("handle gateway attributes failed: ",e),{}}}(),s=m6(87)||function(){let e=mz();if(e.name!==mH.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}(),c=y0({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:EQ,browser:navigator.userAgent,process_id:E4("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:E4("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:y0({enableEncodedTransform:!!E4("ENABLE_AUDIO_METADATA")&&s||!!E4("ENABLE_AUDIO_TOPN")&&m8(mH.CHROME,87,116)||void 0,enableAudioMetadata:!!E4("ENABLE_AUDIO_METADATA")&&s,enableAudioPts:!!E4("ENABLE_AUDIO_PTS_METADATA")&&s,topnSmoothLevel:E4("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:E4("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:E4("TOPN_SWITCH_HOLD_MS"),topnAudioGain:E4("TOPN_AUDIO_GAIN"),enablePublishedUserList:E4("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:E4("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:yQ("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:yQ("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:yQ("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===E4("USE_PUB_RTX")||!0===E4("USE_SUB_RTX")||void 0,disableFEC:E4("DISABLE_FEC"),enableNTPReport:!!E4("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!E4("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!E4("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:yQ("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!E4("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!E4("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:yQ("USE_XR","boolean"),enableLossbasedBwe:yQ("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!E4("ENABLE_AUT_CC")||void 0,enableCCFallback:yQ("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:n?yQ("PRE_SUB_NUM","number"):void 0,enablePubTWCC:yQ("PUBLISH_TWCC","boolean"),enableSubTWCC:yQ("SUBSCRIBE_TWCC","boolean"),enablePubRTX:yQ("USE_PUB_RTX","boolean"),enableSubRTX:yQ("USE_SUB_RTX","boolean"),enableSubSVC:E4("ENABLE_SVC")?E4("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(E4("SVC"))&&0!==E4("SVC").length?E4("SVC"):void 0,enableSvcExtended:E4("ENABLE_SVC")&&Array.isArray(E4("SVC_EXTENDED"))&&0!==E4("SVC_EXTENDED").length?E4("SVC_EXTENDED"):void 0},a)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(c.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(c.aes_mode=this.joinInfo.aesmode,E4("ENCRYPT_AES")?(c.aes_secret=this.joinInfo.aespassword,c.aes_encrypt=!0):c.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(c.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(c.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(c.default_video_stream=this.joinInfo.defaultVideoStream),c}getRejoinMessage(){if(!this.joinInfo)throw new gy(vA.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(b8.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(b8.WS_RECONNECTING,e=>{this.joinInfo&&gT.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||vH.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",gT.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(b8.WS_CLOSED,e=>{let t;switch(e){case vV.LEAVE:t=vH.LEAVE;break;case vV.UID_BANNED:case vV.IP_BANNED:case vV.CHANNEL_BANNED:case vV.SERVER_ERROR:t=vH.SERVER_ERROR;break;case vV.FALLBACK:t=vH.FALLBACK;break;case vV.LICENSE_MISSING:case vV.LICENSE_EXPIRED:case vV.LICENSE_MINUTES_EXCEEDED:case vV.LICENSE_PERIOD_INVALID:case vV.LICENSE_MULTIPLE_SDK_SERVICE:case vV.LICENSE_ILLEGAL:case vV.TOKEN_EXPIRE:t=e;break;default:t=vH.NETWORK_ERROR}gA.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+vH.NETWORK_ERROR)),this.joinInfo&&gT.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===vV.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==vV.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(b8.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){let e=E4("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(gA.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(gT.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void gA.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));E1("EVENT_REPORT_DOMAIN",e[1]),E1("EVENT_REPORT_BACKUP_DOMAIN",e[1]),E1("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(b7.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(b8.REQUEST_RECOVER,(e,t,r)=>{if(!this.joinInfo)return r(new gy(vA.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,vQ(this,Tv.REQUEST_NEW_GATEWAY_LIST).then(t).catch(r)}),this.signal.on(b8.REQUEST_JOIN_INFO,async(e,t,r)=>{var i;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let n=v2(null===(i=this.joinInfo)||void 0===i?void 0:i.turnServer);if(E4("NEW_TURN_MODE")&&n){let e=n.servers,t=n.serversFromGateway,r=this.signal.currentURLIndex;e.length>0&&(e=[e[r%e.length]],n.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],n.serversFromGateway=t),gA.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(r))}let{iceParameters:o,dtlsParameters:a,rtpCapabilities:s}=await vQ(this,Tv.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:n});try{e(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:a,rtpCapabilities:s,version:"2"}}))}catch(e){t(e)}}),this.signal.on(b8.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(b8.REPORT_JOIN_GATEWAY,(e,t)=>{var r;if(!this.joinInfo)return;let i,n="";e instanceof gy?(i=(null===(r=e.data)||void 0===r?void 0:r.desc)||e.code,n=e.message):i=e,gT.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:n,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(b8.IS_P2P_DISCONNECTED,e=>{e(vJ(this,Tv.IS_P2P_DISCONNECTED))}),this.signal.on(b8.DISCONNECT_P2P,()=>{this.emit(Tv.DISCONNECT_P2P)}),this.signal.on(b8.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(b8.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(b8.JOIN_RESPONSE,e=>{let t=this.getCurrentGatewayAddress();this.emit(Tv.JOIN_RESPONSE,e,t)}),this.signal.on(b8.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let e=this.getCurrentGatewayAddress(),t=E4("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){let r=yC(e);this.emit(Tv.PRE_CONNECT_PC,{candidates:r,fingerprint:t})}}}),this.signal.on(b8.RECOVER_NOTIFICATION,e=>{this.joinInfo&&"string"==typeof E4("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(E4("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(b5.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw gA.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(b5.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw gA.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(b5.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw gA.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(b5.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw gA.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){let t={users:e.map(e=>({stream_id:e.stream_id,stream_type:e.stream_type}))};try{await this.signal.request(b5.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw gA.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){let r={action:e.find(e=>e.stream_type===Tm.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(b5.CONTROL,r,!0,!0)}catch(e){throw gA.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){let r={action:e.find(e=>e.stream_type===Tm.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(b5.CONTROL,r,!0,!0)}catch(e){throw gA.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){let r={action:e===Tw.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(b5.CONTROL,r,!0,!0)}catch(e){throw gA.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){let r={action:e===Tw.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(b5.CONTROL,r,!0,!0)}catch(e){throw gA.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(b5.RESTART_ICE,t,!0)}catch(e){throw gA.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||vH.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!E4("GATEWAY_WSS_ADDRESS"))return E4("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(gA.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(b5.SET_PARAMETER,{enablePublishAudioFilter:e})}}let y4=0,y6=0;function y3(e,t,r,i){return new dJ((n,o)=>{t.timeout=t.timeout||E4("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),y4+=v7(t.data)):r&&(t.data.size?y4+=t.data.size:t.data instanceof FormData?y4+=Ee(t.data):y4+=v7(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,mU.request(t).then(e=>{"string"==typeof e.data?y6+=v7(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?y6+=e.data.byteLength:y6+=v7(JSON.stringify(e.data)),i&&n({data:e.data,headers:e.headers}),n(e.data)}).catch(e=>{mU.isCancel(e)?o(new gy(vA.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new gy(vA.NETWORK_TIMEOUT,e.message)):e.response?o(new gy(vA.NETWORK_RESPONSE_ERROR,e.response.status)):o(new gy(vA.NETWORK_ERROR,e.message))})})}!function(){function e(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var t,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype||(e[t]=r.value),e},i,n,o=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof iU&&iU];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var i=o;e=e.split(".");for(var n=0;n<e.length-1;n++){var a=e[n];if(!(a in i))break e;i=i[a]}(t=t(n=i[e=e[e.length-1]]))!=n&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}function s(t){var r="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return r?r.call(t):{next:e(t)}}if(a("Symbol",function(e){function t(e,t){this.A=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",n=0;return function e(r){if(this instanceof e)throw TypeError("Symbol is not a constructor");return new t(i+(r||"")+"_"+n++,r)}}),a("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var i="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<i.length;n++){var a=o[i[n]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&r(a.prototype,t,{configurable:!0,writable:!0,value:function(){var t;return(t={next:t=e(this)})[Symbol.iterator]=function(){return this},t}})}return t}),"function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{e:{var c={};try{c.__proto__={a:!0},t=c.a;break e}catch(e){}t=!1}n=t?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw TypeError(e+" is not extensible");return e}:null}var d=n;function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function l(e){if(e.m)throw TypeError("Generator is already running");e.m=!0}function h(e,t){return e.h=3,{value:t}}function p(e){this.g=new u,this.G=e}function f(e,t,r,i){try{var n=t.call(e.g.j,r);if(!(n instanceof Object))throw TypeError("Iterator result "+n+" is not an object");if(!n.done)return e.g.m=!1,n;var o=n.value}catch(t){return e.g.j=null,e.g.s(t),_(e)}return e.g.j=null,i.call(e.g,o),_(e)}function _(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function A(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){var r,i,n;return r=e,i=t,l(r.g),(n=r.g.j)?f(r,"return"in n?n.return:function(e){return{value:e,done:!0}},i,r.g.return):(r.g.return(i),_(r))},this[Symbol.iterator]=function(){return this}}function m(e,t){return t=new A(new p(t)),d&&e.prototype&&d(t,e.prototype),t}if(u.prototype.o=function(e){this.v=e},u.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},u.prototype.return=function(e){this.l={return:e},this.h=this.u},p.prototype.o=function(e){return l(this.g),this.g.j?f(this,this.g.j.next,e,this.g.o):(this.g.o(e),_(this))},p.prototype.s=function(e){return l(this.g),this.g.j?f(this,this.g.j.throw,e,this.g.o):(this.g.s(e),_(this))},a("Array.prototype.entries",function(e){return e||function(){var e,t,r,i,n;return e=this,t=function(e,t){return[e,t]},e instanceof String&&(e+=""),r=0,i=!1,(n={next:function(){if(!i&&r<e.length){var n=r++;return{value:t(n,e[n]),done:!1}}return i=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return n},n}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var v=function(e,t){for(var r=0;r<e.length;r++)t(e[r])},E=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},g=function(e,t,r){return t instanceof Blob?(r=void 0!==r?String(r+""):"string"==typeof t.name?t.name:"blob",t.name===r&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],r)),[String(e),t]):[String(e),String(t)]},S=function(e,t){if(e.length<t)throw TypeError(t+" argument required, but only "+e.length+" present.")},b="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,T=b.FormData,y=b.XMLHttpRequest&&b.XMLHttpRequest.prototype.send,R=b.Request&&b.fetch,I=b.navigator&&b.navigator.sendBeacon,C=b.Element&&b.Element.prototype,k=b.Symbol&&Symbol.toStringTag;k&&(Blob.prototype[k]||(Blob.prototype[k]="Blob"),"File"in b&&!File.prototype[k]&&(File.prototype[k]="File"));try{new File([],"")}catch(e){b.File=function(e,t,r){return Object.defineProperties(e=new Blob(e,r||{}),{name:{value:t},lastModified:{value:+(r&&void 0!==r.lastModified?new Date(r.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),k&&Object.defineProperty(e,k,{value:"File"}),e}}var w=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},O=function(e){this.i=[];var t=this;e&&v(e.elements,function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *")){if("file"===e.type){var r=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];v(r,function(r){t.append(e.name,r)})}else"select-multiple"===e.type||"select-one"===e.type?v(e.options,function(r){!r.disabled&&r.selected&&t.append(e.name,r.value)}):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(r="textarea"===e.type?E(e.value):e.value,t.append(e.name,r))}})};if((i=O.prototype).append=function(e,t,r){S(arguments,2),this.i.push(g(e,t,r))},i.delete=function(e){S(arguments,1);var t=[];e=String(e),v(this.i,function(r){r[0]!==e&&t.push(r)}),this.i=t},i.entries=function e(){var t,r=this;return m(e,function(e){if(1==e.h&&(t=0),3!=e.h)return t<r.i.length?e=h(e,r.i[t]):(e.h=0,e=void 0),e;t++,e.h=2})},i.forEach=function(e,t){S(arguments,1);for(var r=s(this),i=r.next();!i.done;i=r.next()){var n=s(i.value);i=n.next().value,n=n.next().value,e.call(t,n,i,this)}},i.get=function(e){S(arguments,1);var t=this.i;e=String(e);for(var r=0;r<t.length;r++)if(t[r][0]===e)return t[r][1];return null},i.getAll=function(e){S(arguments,1);var t=[];return e=String(e),v(this.i,function(r){r[0]===e&&t.push(r[1])}),t},i.has=function(e){S(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},i.keys=function e(){var t,r,i=this;return m(e,function(e){if(1==e.h&&(r=(t=s(i)).next()),3!=e.h)return r.done?void(e.h=0):h(e,s(r.value).next().value);r=t.next(),e.h=2})},i.set=function(e,t,r){S(arguments,2);var i=[],n=g(e=String(e),t,r),o=!0;v(this.i,function(t){t[0]===e?o&&(o=!i.push(n)):i.push(t)}),o&&i.push(n),this.i=i},i.values=function e(){var t,r,i,n=this;return m(e,function(e){if(1==e.h&&(r=(t=s(n)).next()),3!=e.h)return r.done?void(e.h=0):((i=s(r.value)).next(),h(e,i.next().value));r=t.next(),e.h=2})},O.prototype._asNative=function(){for(var e=new T,t=s(this),r=t.next();!r.done;r=t.next()){var i=s(r.value);r=i.next().value,i=i.next().value,e.append(r,i)}return e},O.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],r="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(e,i){return"string"==typeof e?t.push(r+w(E(i))+'"\r\n\r\n'+E(e)+"\r\n"):t.push(r+w(E(i))+'"; filename="'+w(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")}),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},O.prototype[Symbol.iterator]=function(){return this.entries()},O.prototype.toString=function(){return"[object FormData]"},C&&!C.matches&&(C.matches=C.matchesSelector||C.mozMatchesSelector||C.msMatchesSelector||C.oMatchesSelector||C.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return -1<t}),k&&(O.prototype[k]="FormData"),y){var N=b.XMLHttpRequest.prototype.setRequestHeader;b.XMLHttpRequest.prototype.setRequestHeader=function(e,t){N.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},b.XMLHttpRequest.prototype.send=function(e){e instanceof O&&(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type)),y.call(this,e)}}R&&(b.fetch=function(e,t){return t&&t.body&&t.body instanceof O&&(t.body=t.body._blob()),R.call(this,e,t)}),I&&(b.navigator.sendBeacon=function(e,t){return t instanceof O&&(t=t._asNative()),I.call(this,e,t)}),b.FormData=O}}();let y8=()=>{let e=E4("AREAS");return 0===e.length&&e.push(TS.GLOBAL),ae(e).call(e,(e,t,r)=>{let i=y5(t);return i?0===r?i:"".concat(e,",").concat(i):e},"")},y5=e=>e===TS.OVERSEA?"".concat(TT.ASIA,",").concat(TT.EUROPE,",").concat(TT.AFRICA,",").concat(TT.NORTH_AMERICA,",").concat(TT.SOUTH_AMERICA,",").concat(TT.OCEANIA):TT[e],y9=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(e=>{let r=Ty[e],i=Object.keys(r);i&&i.map(e=>{"CODE"!==e&&(t[e]=t[e].concat(r[e]))})}),t},y7={GLOBAL:{ASIA:[TS.CHINA,TS.JAPAN,TS.INDIA,TS.KOREA,TS.HKMC],EUROPE:[],NORTH_AMERICA:[TS.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Re=Object.keys(y7[TS.GLOBAL]),Rt=[TS.CHINA,TS.NORTH_AMERICA,TS.EUROPE,TS.ASIA,TS.JAPAN,TS.INDIA,TS.OCEANIA,TS.SOUTH_AMERICA,TS.AFRICA,TS.KOREA,TS.HKMC,TS.US],Rr=function(e,t){let r=[];if(o0(e).call(e,TS.GLOBAL)){let o=[TS.GLOBAL,TS.OVERSEA],a=Object.keys(Ty);if(t===TS.GLOBAL)throw new gy(vA.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===TS.CHINA)r=[TS.OVERSEA];else if(o0(Re).call(Re,t)){let e=y7[TS.GLOBAL][t]||[],i=[...o,t,...e];r=a.filter(e=>!o0(i).call(i,e))}else{var i,n;let s;if(i=t,s=!1,Re.forEach(e=>{var t;o0(t=y7[TS.GLOBAL][e]).call(t,i)&&(s=!0)}),s){;let e;let i=[...o,(n=t,Re.forEach(t=>{var r;o0(r=y7[TS.GLOBAL][t]).call(r,n)&&(e=t)}),e),t];r=a.filter(e=>!o0(i).call(i,e))}else r=e}r=function(e){let t=[];return Rt.forEach(r=>{o0(e).call(e,r)&&t.push(r)}),t.concat(e.filter(e=>!o0(Rt).call(Rt,e)))}(r)}else r=e;return r};function Ri(e){var t,r;if(!e&&o0(t=E4("AREAS")).call(t,TS.EXTENSIONS))return gA.debug("update area from ap : reset"),void Rn(bN,!0);if(!o0(r=E4("AREAS")).call(r,TS.GLOBAL)||!e)return;let i=Ty.EXTENSIONS;i&&(i={CODE:y5(TS.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},gA.debug("update area from ap success: ".concat(e,",config is "),i),E1("AREAS",[TS.EXTENSIONS],!0),Object.keys(i).map(e=>{"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?E1(e,i[e][0]):E1(e,i[e])}))}function Rn(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=gT.reportApiInvoke(null,{name:vM.SET_AREA,options:e,tag:vx.TRACER});try{let i=[];if("string"==typeof e&&(i=[e]),Array.isArray(e)&&(e.forEach(e=>{if(!o0(Tb).call(Tb,e))throw new gy(vA.INVALID_PARAMS,"invalid area code")}),i=e),"[object Object]"===Object.prototype.toString.call(e)){let{areaCode:t,excludedArea:r}=e;if(!t)throw new gy(vA.INVALID_PARAMS,"area code is needed");let n=t;"string"==typeof t&&(n=[t]),i=r?Rr(n,r):n}if(!t){if(E3.AREAS){let e=new gy(vA.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(e),void gA.warning("setArea is prohibited because of config-distribute")}if(o0(i).call(i,TS.GLOBAL)&&E4("AREAS")===TS.EXTENSIONS){let e=new gy(vA.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(e),void gA.warning("setArea is prohibited because of ap extensions")}}E1("AREAS",i,t);let n=y9(i);Object.keys(n).map(e=>{"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?E1(e,n[e][0]):E1(e,n[e])}),gA.debug("set area success:",i.join(","))}catch(e){throw r.onError(e),e}r.onSuccess()}function Ro(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function Ra(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ro(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ro(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let Rs=1,Rc=1;function Rd(e,t,r,i){let n,{url:o,areaCode:a}=e,{clientId:s,sid:c}=t,d=Date.now(),u=t.role,[l,h]=Rf(t,a,[yi.CHOOSE_SERVER]),p=vq.networkState;return Em(async()=>{p&&vq.networkState===vY.OFFLINE&&vq.onlineWaiter&&await dJ.race([vq.onlineWaiter,Et(i&&i.maxRetryTimeout||E_.maxRetryTimeout)]),p=vq.networkState;let{data:e,headers:a}=await y3(o,{data:l,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);n="1"===a.http3?1:-1,gT.reportResourceTiming(o,c),Rl(e,o,t,d,[yi.CHOOSE_SERVER],n);let s=yl(e,yi.CHOOSE_SERVER);return Rh(s),ys(s,o)},e=>(e&&gT.joinChooseServer(c,{role:u,lts:d,succ:!0,csAddr:o,opid:h,serverList:e.gatewayAddrs.map(e=>e.address),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),isHttp3:n,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1),e=>e.code!==vA.OPERATION_ABORTED&&(e.code===vA.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(gT.joinChooseServer(c,{role:u,lts:d,succ:!1,csAddr:o,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:n,corssRegionTagReq:t.apRequestDetail}),gA.warning("[".concat(s||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),e),!0)),i)}function Ru(e,t,r,i){let n,o,{url:a,areaCode:s,serviceIds:c}=e,d=Date.now(),u=t.role,[l,h]=Rf(t,s,c);return Em(async()=>{n&&vq.networkState===vY.OFFLINE&&vq.onlineWaiter&&await dJ.race([vq.onlineWaiter,Et(i&&i.maxRetryTimeout||E_.maxRetryTimeout)]),n=vq.networkState;let{data:e,headers:s}=await y3(a,{data:l,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o="1"===s.http3?1:-1,gT.reportResourceTiming(a,t.sid),Rl(e,a,t,d,c,o);let u=yl(e,yi.CHOOSE_SERVER),h=yl(e,"proxy5"===t.cloudProxyServer?yi.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK);return Rh(u),{gatewayInfo:ys(u,a),proxyInfo:h,url:a}},e=>(e.gatewayInfo&&gT.joinChooseServer(t.sid,{role:u,lts:d,succ:!0,csAddr:a,serverList:e.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,opid:h,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38]}),e.proxyInfo&&gT.joinWebProxyAP(t.sid,{lts:d,sucess:1,apServerAddr:a,turnServerAddrList:e.proxyInfo.addresses.map(e=>e.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1),e=>e.code!==vA.OPERATION_ABORTED&&(e.code===vA.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(gT.joinWebProxyAP(t.sid,{lts:d,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:n})}),gA.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0)),i)}let Rl=(e,t,r,i,n,o)=>{let{sid:a,clientId:s,cloudProxyServer:c}=r,d=[],u=s=>{4096===s.flag?gT.joinChooseServer(a,{role:r.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:s.error.message,csIp:s.error.data&&s.error.data.csIp,unilbsServerIds:n.toString(),isHttp3:o,corssRegionTagReq:r.apRequestDetail}):1048576!==s.flag&&4194304!==s.flag&&4194310!==s.flag||gT.joinWebProxyAP(a,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:s.error.code,eventType:c,unilbsServerIds:n.toString()})};if(e.response_body.forEach(t=>{let r=t.buffer.code;if(23===t.uri&&0===r&&!t.buffer.edges_services){if(4194310===t.buffer.flag)gA.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{let r={error:new gy(vA.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};d.push(r),u(r)}}if(0!==r){let i=TX(r),n={error:new gy(vA.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?gA.warning(n.error.toString()):d.push(n),u(n)}}),d.length)throw gA.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(d.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)).join(" | "))),new gy(vA.CAN_NOT_GET_GATEWAY_SERVER,d.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!d.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(d.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})},Rh=e=>{var t,r,i,n,o;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new gy(vA.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(E4("AP_AREA")&&(null!==(i=e.detail)&&void 0!==i&&i[23]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[23])?Ri(e.detail[23].toLowerCase()):Ri()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[19])){let t=e.detail[19],r=null==t?void 0:t.split(";");for(let t=0;t<r.length;t++){let i=po(o=r[t]).call(o);e.addresses[t]&&r&&(e.addresses[t].fingerprint=i)}}if(E4("GATEWAY_ADDRESS")&&E4("GATEWAY_ADDRESS").length>0){gA.debug("assign gateway address to",E4("GATEWAY_ADDRESS"));let t=E4("GATEWAY_ADDRESS").map(t=>{var r,i;let n=null!==(r=null===(i=e.addresses.find(e=>e.ip===t.ip&&e.port===t.port))||void 0===i?void 0:i.fingerprint)&&void 0!==r?r:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:n}});e.addresses=t}},Rp=(e,t)=>{if(e.response_body&&e.response_body.length){let t=e.response_body[0];if(0!==t.buffer.code){let e=TX(t.buffer.code);throw new gy(vA.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw gA.debug("update ticket request received ap response without response body:",t),new gy(vA.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Rf=(e,t,r)=>{let i=Math.floor(1e12*Math.random()),n="host"===e.role?"1":"audience"===e.role?"2":void 0,o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ra(Ra(Ra({6:e.stringUid,11:t,12:E4("USE_NEW_TOKEN")?"1":void 0},n?{17:n}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};o.request_bodies.forEach(t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let a=new FormData;return a.append("request",JSON.stringify(o)),[a,i]},R_=(e,t)=>{let r=Math.floor(1e12*Math.random()),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(e=>({ip:e.ip,port:e.port}))}}]},n=new FormData;return n.append("request",JSON.stringify(i)),[n,r]},RA=0;function Rm(e){return dJ.all(e.map(e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}let Rv=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:i,allFailedhandler:n,promisesCollector:o}=e,a=0,s,c=0,d=async()=>{let e=(()=>{let e=a*t;return r.slice(e,e+t).map(i)})();o&&o.push(...e);try{s=await Rm(e)}catch(e){if(c+=t,a++,!(c>=r.length))return void await d();n(e)}e.forEach(e=>e.cancel())};return await d(),s},RE=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:i}=e,n=t.length,o=0,a=async()=>{let e=r(t.shift());try{return await e}catch(e){if(++o>=n||null!=i&&i(e))throw e;return a()}};return a()};async function Rg(e,t,r,i){let n=async function(e,t,r,i){let n=null,o=[],a=async()=>{let n=E4("WEBCS_DOMAIN").slice(0,E4("AJAX_REQUEST_CONCURRENT")).map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:y8()})),a=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:n.map(e=>e.url)}),s=await Rv({fragementLength:E4("FRAGEMENT_LENGTH"),referenceList:n,asyncMapHandler:i=>(gA.debug("[".concat(e.clientId,"] Connect to choose_server:"),i.url),Rd(i,e,t,r)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},a),s},s=async()=>{if(await Et(1e3),null!==n)return n;let a=E4("WEBCS_DOMAIN_BACKUP_LIST").map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:y8()})),s=i.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map(e=>e.url)}),c=await Rv({fragementLength:E4("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:i=>(gA.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),i.url),Rd(i,e,t,r)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c};try{return n=await Rm([a(),s()]),o.length&&o.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),n}catch(e){throw e[0]}}(e,t,r,i);return{gatewayInfo:await n}}async function RS(e,t,r,i,n){var o,a;let s=e.cloudProxyServer;if("disabled"===s){if(!i)return;if(e.useLocalAccessPoint)return await Rg(e,t,r,n);if(E4("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:i,proxyInfo:a}=await RI(e,t,r,n);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:i};let s=a.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||EJ.tcpport,udpport:e.udpport||EJ.udpport,username:e.username||EJ.username,password:e.password||EJ.password,forceturn:!1,security:!0}));if(n.useP2P){let t=null!==(o=e.uid)&&void 0!==o?o:i.uid,r="glb:".concat(t.toString()),n=await vN(r),c=a.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||EJ.tcpport,udpport:e.udpport||EJ.udpport,username:r,password:n,forceturn:!1,security:!0}));s.push(...c)}return e.turnServer={mode:"manual",servers:s},{gatewayInfo:i}}return await Rg(e,t,r,n)}let{proxyInfo:c,gatewayInfo:d}=await RI(e,t,r,n),u=c.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===s?void 0:e.tcpport?e.tcpport:EJ.tcpport,udpport:"proxy4"===s?void 0:e.udpport?e.udpport:EJ.udpport,username:e.username||EJ.username,password:e.password||EJ.password,forceturn:"proxy4"!==s,security:"proxy5"===s}));if(n.useP2P){let t=null!==(a=e.uid)&&void 0!==a?a:d.uid,r="glb:".concat(t.toString()),i=await vN(r),n=c.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===s?void 0:e.tcpport||EJ.tcpport,udpport:"proxy4"===s?void 0:e.udpport||EJ.udpport,username:r,password:i,forceturn:"proxy4"!==s,security:"proxy5"===s}));u.push(...n)}return e.turnServer={mode:"manual",servers:u},gA.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),{gatewayInfo:d}}async function Rb(e,t,r,i,n){let o=E4("ACCOUNT_REGISTER").slice(0,E4("AJAX_REQUEST_CONCURRENT")),a=[];a=t.proxyServer?o.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):o.map(e=>"https://".concat(e,"/api/v1"));let s=null==n?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{let o=await async function(e,t,r,i,n){let o=Date.now(),a={sid:r.sid,opid:10,appid:r.appId,string_uid:t},s=e[0],c=await Em(()=>y3(s+"".concat(-1===s.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(r,i)=>{if(0===r.code){if(r.uid<=0||r.uid>=0x100000000)throw gA.error("Invalid Uint Uid ".concat(t," => ").concat(r.uid),r),gT.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:r.uid,errorCode:vA.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new gy(vA.INVALID_UINT_UID_FROM_STRING_UID);return gT.reqUserAccount(a.sid,{lts:o,success:!0,serverAddr:s,stringUid:a.string_uid,uid:r.uid,errorCode:null,extend:a}),!1}let n=TX(r.code);return n.retry&&(s=e[(i+1)%e.length]),gT.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:r.uid,errorCode:n.desc,extend:a}),n.retry},(t,r)=>t.code!==vA.OPERATION_ABORTED&&(gT.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),s=e[(r+1)%e.length],!0),n);if(0!==c.code){let e=TX(c.code);throw new gy(vA.UNEXPECTED_RESPONSE,e.desc)}return c}(a,e,t,r,i);return null==n||n.recordJoinChannelService({status:"success",endTs:Date.now()},s),o.uid}catch(e){throw null==n||n.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},s),e}}async function RT(e,t,r){let i=E4("ACCOUNT_REGISTER"),n=[];n=t.proxyServer?i.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):i.map(e=>"https://".concat(e,"/api/v1"));try{return await RE({referenceList:n,asyncMapHandler:i=>(async function(e,t,r,i){let n=Date.now(),o={sid:r.sid,opid:10,appid:r.appId,string_uid:t};try{let t=await y3(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){let e=TX(t.code);throw new gy(vA.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=0x100000000)throw new gy(vA.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:n,url:e,req:o,uid:t.uid,elapse:Date.now()-n}}catch(e){throw e}})(i,e,t,r),closeFn:e=>e.code===vA.OPERATION_ABORTED||e.code===vA.UNEXPECTED_RESPONSE&&!e.data.retry})}catch(e){throw e}}async function Ry(e,t,r){let i=E4("CDS_AP").slice(0,E4("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")).map(i=>(function(e,t,r,i){let n=mz(),o={flag:64,cipher_method:0,features:Ra(Ra(Ra(Ra(Ra({install_id:EK(),device:n.name,system:n.os,system_general:navigator.userAgent,vendor:t.appId,version:EQ,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:yr.WEB_RTC,browser_name:n.name,browser_version:n.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),n.os&&{os_name:n.os}),n.osVersion&&{os_version:n.osVersion}),{},{detail:""})};return Em(()=>y3(e,{data:o,timeout:1e3,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==vA.OPERATION_ABORTED,i)})(i,e,t,r)),n=null,o=null,a={};try{n=await Rm(i)}catch(e){if(e.code===vA.OPERATION_ABORTED)throw e;o=e}if(i.forEach(e=>e.cancel()),gT.reportApiInvoke(e.sid,{name:vM.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:n}}).onSuccess(),n&&n.test_tags)try{a=function(e){if(!e.test_tags)return{};let t=e.test_tags,r=Object.keys(t),i={};return r.forEach(e=>{var r;let n=po(r=e.slice(4)).call(r),o=JSON.parse(t[e]),a=o[1];i[n]={tag:o[0]||"",value:a}}),i}(n)}catch(e){}return a}async function RR(e,t){let r=E4("WEBCS_DOMAIN").concat(E4("WEBCS_DOMAIN_BACKUP_LIST")).map(e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:y8(),serviceIds:[yi.CHOOSE_SERVER,yi.CLOUD_PROXY_FALLBACK]}));try{return await RE({referenceList:r,asyncMapHandler:r=>(async function(e,t,r){let i,{url:n,areaCode:o,serviceIds:a}=e,s=Date.now(),[c,d]=Rf(t,o,a),u=vq.networkState;try{u&&vq.networkState===vY.OFFLINE&&vq.onlineWaiter&&await dJ.race([vq.onlineWaiter,Et(E_.maxRetryTimeout)]),u=vq.networkState;let{data:e,headers:t}=await y3(n,{data:c,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===t.http3?1:-1;(e=>{let t=[];if(e.response_body.forEach(r=>{let i=r.buffer.code;if(23===r.uri&&0===i&&!r.buffer.edges_services){if(4194310===r.buffer.flag)r.buffer.edges_services=[];else{let i={error:new gy(vA.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:r.buffer.flag};t.push(i)}}if(0!==i){let n=TX(i),o={error:new gy(vA.CAN_NOT_GET_GATEWAY_SERVER,n.desc,{desc:n.desc,retry:n.retry,csIp:e.detail[502]}),flag:r.buffer.flag};4194310===r.buffer.flag?gA.warning(o.error.toString()):t.push(o)}}),t.length)throw new gy(vA.CAN_NOT_GET_GATEWAY_SERVER,t.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!t.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(t.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})})(e);let o=yl(e,yi.CHOOSE_SERVER),a=yl(e,yi.CLOUD_PROXY_FALLBACK);return Rh(o),{gatewayInfo:ys(o,n),proxyInfo:a,opid:d,requestTime:s,url:n,isHttp3:i,elapse:Date.now()-s}}catch(e){throw e}})(r,e,t),closeFn:e=>e.code===vA.OPERATION_ABORTED||e.code===vA.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry})}catch(e){throw e}}async function RI(e,t,r,i){let n,o,a;let s=E4("PROXY_SERVER_TYPE3"),c=(e,t,r)=>{let i=r||s;return Array.isArray(i)&&(i=t%2==0?s[1]:s[0]),"https://".concat(i,"/ap/?url=").concat(e)},d=null,u=[],l=async()=>{let n=E4("WEBCS_DOMAIN").slice(0,E4("AJAX_REQUEST_CONCURRENT")).map((t,r)=>({url:"disabled"===e.cloudProxyServer&&e.proxyServer?c("".concat(t,"/api/v2/transpond/webrtc?v=2"),r,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):c("".concat(t,"/api/v2/transpond/webrtc?v=2"),r),areaCode:y8(),serviceIds:[yi.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?yi.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK]})),o=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:n.map(e=>e.url)}),a=await Rv({fragementLength:E4("FRAGEMENT_LENGTH"),referenceList:n,asyncMapHandler:i=>(gA.debug("[".concat(e.clientId,"] Connect to choose_server:"),i.url),Ru(i,e,t,r)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},o),a},h=async()=>{if(await Et(1e3),null!==d)return d;let n=E4("WEBCS_DOMAIN_BACKUP_LIST").map((t,r)=>({url:"disabled"===e.cloudProxyServer&&e.proxyServer?c("".concat(t,"/api/v2/transpond/webrtc?v=2"),r,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):c("".concat(t,"/api/v2/transpond/webrtc?v=2"),r),areaCode:y8(),serviceIds:[yi.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?yi.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK]})),o=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:n.map(e=>e.url)}),a=await Rv({fragementLength:E4("FRAGEMENT_LENGTH"),referenceList:n,asyncMapHandler:i=>(gA.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),i.url),Ru(i,e,t,r)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},o),a};try{({gatewayInfo:n,proxyInfo:o,url:a}=await Rm([l(),h()]))}catch(e){throw e[0]}if(u.length&&u.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),!n||!o)throw new gy(vA.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=a,"disabled"!==e.cloudProxyServer&&Array.isArray(s)&&a){let t=/^https?:\/\/(.+?)(\/.*)?$/.exec(a)[1];o0(s).call(s,t)&&(e.proxyServer=t,gA.setProxyServer(t),gT.setProxyServer(t))}return d={gatewayInfo:n,proxyInfo:await yh(o,n.uid)}}async function RC(e,t,r){let i=E4("UAP_AP").slice(0,E4("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")).map(i=>(function(e,t,r,i){let n={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:EQ,cname:t.cname,uid:t.uid.toString(),requestId:Rc,seq:Rc};Rc+=1;let o={service_name:"tele_channel",json_body:JSON.stringify(n)};return Em(async()=>{let t=await y3(e,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){let e=new gy(vA.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw gA.error(e.toString()),e}let i=JSON.parse(t.json_body);if(200!==i.code){let e=new gy(vA.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(i.code,", reason: ").concat(i.reason));throw gA.error(e.toString()),e}if(!i.servers||0===i.servers.length){let e=new gy(vA.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw gA.error(e.toString()),e}return{vid:i.vid,workerToken:i.workerToken,addressList:(E4("CHANNEL_MEDIA_RELAY_SERVERS")||i.servers).map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(E4("WORKER_DOMAIN"),":").concat(e.wss))}},void 0,e=>!!(e.code!==vA.OPERATION_ABORTED&&e.code!==vA.UNEXPECTED_RESPONSE||e.data&&e.data.retry),i)})(i,e,t,r));try{let e=await Rm(i);return i.forEach(e=>e.cancel()),e}catch(e){throw e[0]}}async function Rk(e,t,r){let i=null,n=[],o=async o=>{let a=E4(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"));return o&&(await Et(1e3),null!==i)?i:await Rv({fragementLength:E4("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:i=>(gA.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),i),function(e,t,r,i){let[n]=R_(t,[yi.CHOOSE_SERVER]),o=vq.networkState;return Em(async()=>(o&&vq.networkState===vY.OFFLINE&&vq.onlineWaiter&&await dJ.race([vq.onlineWaiter,Et(i&&i.maxRetryTimeout||E_.maxRetryTimeout)]),o=vq.networkState,Rp(await y3(e,{data:n,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0),e)),()=>!1,e=>e.code!==vA.OPERATION_ABORTED&&(e.code===vA.UPDATE_TICKET_FAILED?e.data.retry:(gA.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0)),i)}(i,e,t,r)),allFailedhandler:e=>{throw e[0]},promisesCollector:n})};try{return i=await Rm([o(!1),o(!0)]),n.length&&n.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),i}catch(e){throw e[0]}}function Rw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function RO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rw(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rw(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class RN extends vP{get isSuccess(){return!!this.configs}constructor(e,t){super(),Aa(this,"configs",void 0),Aa(this,"store",void 0),Aa(this,"joinInfo",void 0),Aa(this,"cancelToken",void 0),Aa(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Aa(this,"interval",void 0),Aa(this,"mutex",void 0),Aa(this,"mutableParamsRead",!1),Aa(this,"configCache",{}),Aa(this,"limit_bitrate",void 0),this.mutex=new Ep("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),E4("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},E4("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){let e;if(!this.mutableParamsRead&&(this.mutableParamsRead=!0,gT.reportApiInvoke(null,{options:void 0,name:vM.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:vx.TRACER}).onSuccess(JSON.stringify(E3))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void gA.debug("[config-distribute] get config distribute interrupted have no joininfo");let t=await this.mutex.lock();try{e=await Ry(this.joinInfo,this.cancelToken,this.retryConfig),gA.debug("[config-distribute] get config distribute",JSON.stringify(e));let t=function(e){var t;let r=pM(t=Object.keys(e).filter(e=>/^webrtc_ng_global_parameter/.test(e))).call(t);for(let t=0;t<r.length;t++)for(let i=r.length-1;i>t;i--){let t=r[i],n=e[t].value;if("number"==typeof n.__priority){let o=n.__priority,a=e[r[i-1]].value;if("number"==typeof a.__priority){if(!(o>a.__priority))continue;r[i]=r[i-1],r[i-1]=t}else r[i]=r[i-1],r[i-1]=t}}let i=Date.now(),n={};return r.forEach(t=>{let r=e[t].value.__expires;r&&r<=i||(n[t]=e[t])}),n}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(t){let e=new gy(vA.NETWORK_RESPONSE_ERROR,t);gA.warning("[config-distribute] ".concat(e.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){TI(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(TR.UPDATE_BITRATE_LIMIT,e):this.emit(TR.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&RO({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{let t={},r=Object.keys(e),i=[];r.forEach(r=>{let n=e[r].value;t[r]=n;let o=n.__id;if(o&&this.configCache[r]&&this.configCache[r].__id===o)return;let a=n.__type,s=e[r].value,c=e[r].tag,d=0;a?a===E6.REALTIME&&(d=1):Object.keys(s).some(e=>Object.prototype.hasOwnProperty.call(E0,e)||!bx()&&Object.prototype.hasOwnProperty.call(Eq,e)?(d=1,!0):void 0),i.push({tag:c,isApplied:d,feature:r,params:JSON.stringify(n)})}),i.forEach(e=>{let{tag:t,feature:r,params:i,isApplied:n}=e;this.store.sessionId&&gT.abTest(this.store.sessionId,{intSucc:1,isApplied:n,tag:t,feature:r,params:i,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=t}catch(e){gA.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){let t=function(e){let t={};return Object.keys(e).forEach(r=>{let i=e[r].value,n=i.__expires,o=i.__type;Object.keys(i).forEach(e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=RO(RO({value:i[e]},n&&{expires:n}),o&&{type:o}))})}),t}(e);try{var r;let i=null===(r=t.LIMIT_BITRATE)||void 0===r?void 0:r.value;delete t.LIMIT_BITRATE,i&&TI(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{let t=Date.now();Object.keys(e).forEach(r=>{let{value:i,type:n,expires:o}=e[r];o&&o<=t||((n===E6.REALTIME||Object.prototype.hasOwnProperty.call(E0,r))&&(E3[r]=i,E2[r]=i,gA.debug("Update realtime parameters from config distribute",r,i)),n||bx()||!Object.prototype.hasOwnProperty.call(Eq,r)||(E3[r]=i,E2[r]=i,gA.debug("Update gateway parameters from config distribute",r,i)))})}catch(t){gA.error("Error update config immediately: ".concat(e),t.message)}}(t);let n=JSON.stringify(t),o=window.btoa(n);window.localStorage.setItem("websdk_ng_global_parameter",o),gA.debug("Caching global parameters ".concat(n))}catch(e){gA.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{let t=Date.now();Object.keys(e).forEach(r=>{if("CLIENT_ROLE_OPTIONS"===r&&Object.prototype.hasOwnProperty.call(E2,r)){let{value:i,expires:n}=e[r];(!n||!(n<=t))&&(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}}(E2[r],i)||(E3[r]=i,E2[r]=i,this.emit(TR.UPDATE_CLIENT_ROLE_OPTIONS,i),gA.debug("Updating client role options: ".concat(JSON.stringify(i)))))}})}catch(e){gA.error("Error handling global parameter config:",e.message)}}}class RP extends vP{constructor(){super(...arguments),Aa(this,"resultStorage",new Map)}setLocalAudioStats(e,t,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(r,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(r,t))}setLocalVideoStats(e,t,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(r,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(r,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(r))}setRemoteAudioStats(e,t){let r=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let r=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(t))}record(e,t,r){if(E4("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let i=this.resultStorage.get(e);if(i&&(i.result.push(r),i.result.length>=5)){var n;let r=o0(n=i.result).call(n,!0);i.isPrevNormal&&!r&&this.emit("exception",RD[e],e,t),!i.isPrevNormal&&r&&this.emit("exception",RD[e]+2e3,e+"_RECOVER",t),i.isPrevNormal=r,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof S0&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let r=null;t._encoderConfig&&t._encoderConfig.frameRate&&(r=yc(t._encoderConfig.frameRate));let i=e.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof S0&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}let RD={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},RL=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){let e=r[r.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){let e=r[r.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function RM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function Rx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?RM(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RM(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class RU{constructor(e){Aa(this,"store",void 0),Aa(this,"onStatsException",void 0),Aa(this,"onUploadPublishDuration",void 0),Aa(this,"onStatsChanged",void 0),Aa(this,"localStats",new Map),Aa(this,"remoteStats",new Map),Aa(this,"updateStatsInterval",void 0),Aa(this,"trafficStats",void 0),Aa(this,"trafficStatsPeerList",[]),Aa(this,"uplinkStats",void 0),Aa(this,"exceptionMonitor",void 0),Aa(this,"p2pChannel",void 0),Aa(this,"scalabilityMode",EU.L1T1),Aa(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new RP,this.exceptionMonitor.on("exception",(e,t,r)=>{this.onStatsException&&this.onStatsException(e,t,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(TD.LocalAudioTrack)||Rx({},g0)}getLocalVideoTrackStats(){return this.localStats.get(TD.LocalVideoTrack)||Rx({},g2)}getRemoteAudioTrackStats(e){let t=(e,t)=>{if(!this.trafficStats)return t;let r=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return r&&(t.publishDuration=r.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},r={};if(e){var i;let n=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.audioStats;n&&(r[e]=t(e,n))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{audioStats:n}]=e;n&&(r[i]=t(i,n))});return r}getRemoteNetworkQualityStats(e){let t={};if(e){var r;let i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.networkStats;i&&(t[e]=i)}else Array.from(this.remoteStats.entries()).forEach(e=>{let[r,{networkStats:i}]=e;i&&(t[r]=i)});return t}getRemoteVideoTrackStats(e){let t=(e,t)=>{if(!this.trafficStats)return t;let r=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return r&&(t.publishDuration=r.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},r={};if(e){var i;let n=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.videoStats;n&&(r[e]=t(e,n))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{videoStats:n}]=e;n&&(r[i]=t(i,n))});return r}getRTCStats(){let e=0,t=0,r=0,i=0,n=this.localStats.get(TD.LocalAudioTrack);n&&(e+=n.sendBytes,t+=n.sendBitrate);let o=this.localStats.get(TD.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);let a=this.localStats.get(TD.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach(e=>{let{audioStats:t,videoStats:n}=e;t&&(r+=t.receiveBytes,i+=t.receiveBitrate),n&&(r+=n.receiveBytes,i+=n.receiveBitrate)});let s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(e=>void 0!==e.B_ppad||void 0!==e.B_ppvd),e.peer_delay.filter(e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid)).forEach(e=>{var t;let r=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),i=null!=r&&r.videoSSRC?RL.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,n=null!=r&&r.audioSSRC?RL.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,i>n?i:n),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&gA.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,r){if(!e)return!1;let i=!!r&&t.framesDecodeFreezeTime>r.framesDecodeFreezeTime,n=!r||t.framesDecodeCount>r.framesDecodeCount;return i||!n}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[r,i]=t;switch(r){case TD.LocalVideoTrack:case TD.LocalVideoLowTrack:{var n;let t=Rx({},g2),o=e.getStats(),a=e.getLocalMedia(r);if(o){let r=o.videoSend.find(e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId));if(r){let n=e.getLocalVideoSize(),o=e.getEncoderConfig(TD.LocalVideoTrack);"H264"!==r.codec&&"H265"!==r.codec&&"VP8"!==r.codec&&"VP9"!==r.codec&&"AV1X"!==r.codec&&"AV1"!==r.codec||(t.codecType=r.codec),t.sendBytes=r.bytes,t.sendBitrate=i?8*Math.max(0,t.sendBytes-i.sendBytes):0,r.inputFrame?(t.captureFrameRate=r.inputFrame.frameRate,t.captureResolutionHeight=r.inputFrame.height,t.captureResolutionWidth=r.inputFrame.width):n&&(t.captureResolutionWidth=n.width,t.captureResolutionHeight=n.height),r.sentFrame?(t.sendFrameRate=r.sentFrame.frameRate,t.sendResolutionHeight=r.sentFrame.height,t.sendResolutionWidth=r.sentFrame.width):n&&(t.sendResolutionWidth=n.width,t.sendResolutionHeight=n.height),r.avgEncodeMs&&(t.encodeDelay=r.avgEncodeMs),o&&o.bitrateMax&&(t.targetSendBitrate=1e3*o.bitrateMax),t.sendPackets=r.packets,t.sendPacketsLost=r.packetsLost,t.sendJitterMs=r.jitterMs,t.sendRttMs=r.rttMs,t.totalDuration=i?i.totalDuration+1:1,t.totalFreezeTime=i?i.totalFreezeTime:0,this.isLocalVideoFreeze(r)&&(t.totalFreezeTime+=1),r.scalabilityMode&&this.scalabilityMode!==r.scalabilityMode&&(gA.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(r.scalabilityMode)),this.scalabilityMode=r.scalabilityMode)}this.trafficStats&&(t.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}this.localStats.set(r,t),((null==i?void 0:i.sendResolutionWidth)!==t.sendResolutionWidth||(null==i?void 0:i.sendResolutionHeight)!==t.sendResolutionHeight)&&(null===(n=this.onStatsChanged)||void 0===n||n.call(this,"resolution",{width:t.sendResolutionWidth,height:t.sendResolutionHeight})),t&&a&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,a.track,t);break}case TD.LocalAudioTrack:{let t=Rx({},g0),n=e.getStats(),o=e.getLocalMedia(r);if(n){let r=n.audioSend.find(e=>e.ssrc===(null==o?void 0:o.ssrcs[0].ssrcId));if(r){if("opus"!==r.codec&&"aac"!==r.codec&&"PCMU"!==r.codec&&"PCMA"!==r.codec&&"G722"!==r.codec||(t.codecType=r.codec),r.inputLevel)t.sendVolumeLevel=Math.round(32767*r.inputLevel);else{let r=e.getLocalAudioVolume();r&&(t.sendVolumeLevel=Math.round(32767*r))}t.sendBytes=r.bytes,t.sendPackets=r.packets,t.sendPacketsLost=r.packetsLost,t.sendJitterMs=r.jitterMs,t.sendRttMs=r.rttMs,t.sendBitrate=i?8*Math.max(0,t.sendBytes-i.sendBytes):0}}this.trafficStats&&(t.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(TD.LocalAudioTrack,t),t&&o&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,o.track,t)}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var r;let i;let[n,{videoStats:o,audioStats:a,videoPcStats:s}]=t,c=Rx({},g1),d=Rx({},g6),u=Rx({},g4),{audioTrack:l,videoTrack:h,audioSSRC:p,videoSSRC:f}=e.getRemoteMedia(n),_=null==(i=this.store.useP2P?e.getStats(!0):e.getStats())?void 0:i.audioRecv.find(e=>e.ssrc===p),A=null==i?void 0:i.videoRecv.find(e=>e.ssrc===f),m=this.trafficStats&&this.trafficStats.peer_delay.find(e=>e.peer_uid===n);if(_&&("opus"!==_.codec&&"aac"!==_.codec&&"PCMU"!==_.codec&&"PCMA"!==_.codec&&"G722"!==_.codec||(c.codecType=_.codec),_.outputLevel?c.receiveLevel=Math.round(32767*_.outputLevel):l&&(c.receiveLevel=Math.round(32767*l.getVolumeLevel())),c.receiveBytes=_.bytes,c.receivePackets=_.packets,c.receivePacketsLost=_.packetsLost,c.receivePacketsDiscarded=_.packetsDiscarded,c.packetLossRate=c.receivePacketsLost/(c.receivePackets+c.receivePacketsLost),c.receiveBitrate=a?8*Math.max(0,c.receiveBytes-a.receiveBytes):0,c.totalDuration=a?a.totalDuration+1:1,c.totalFreezeTime=a?a.totalFreezeTime:0,c.freezeRate=c.totalFreezeTime/c.totalDuration,c.receiveDelay=_.jitterBufferMs,c.totalDuration>10&&RU.isRemoteAudioFreeze(l)&&(c.totalFreezeTime+=1)),A){"H264"!==A.codec&&"H265"!==A.codec&&"VP8"!==A.codec&&"VP9"!==A.codec&&"AV1X"!==A.codec&&"AV1"!==A.codec||(d.codecType=A.codec),d.receiveBytes=A.bytes,d.receiveBitrate=o?8*Math.max(0,d.receiveBytes-o.receiveBytes):0,d.decodeFrameRate=A.decodeFrameRate<0?0:A.decodeFrameRate,d.renderFrameRate=A.decodeFrameRate<0?0:A.decodeFrameRate,A.outputFrame&&(d.renderFrameRate=A.outputFrame.frameRate),A.receivedFrame?(d.receiveFrameRate=A.receivedFrame.frameRate,d.receiveResolutionHeight=A.receivedFrame.height,d.receiveResolutionWidth=A.receivedFrame.width):h&&(d.receiveResolutionHeight=h._videoHeight||0,d.receiveResolutionWidth=h._videoWidth||0),void 0!==A.framesRateFirefox&&(d.receiveFrameRate=Math.round(A.framesRateFirefox)),d.receivePackets=A.packets,d.receivePacketsLost=A.packetsLost,d.packetLossRate=d.receivePacketsLost/(d.receivePackets+d.receivePacketsLost);let t=o?o.totalFreezeTime:0,i=o?o.totalDuration:0;d.totalDuration=o?o.totalDuration+1:1,d.totalFreezeTime=null!==(r=A.totalFreezesDuration)&&void 0!==r?r:t||0,d.receiveDelay=A.jitterBufferMs||0;let n=!!f&&e.getRemoteVideoIsReady(f);void 0===A.totalFreezesDuration&&h&&n&&RU.isRemoteVideoFreeze(h,A,s)&&(d.totalFreezeTime+=1),d.freezeRate=Math.max(0,Math.min((d.totalFreezeTime-t)/(d.totalDuration-i),1))}m&&(c.end2EndDelay=m.B_ad,d.end2EndDelay=m.B_vd,c.transportDelay=m.B_ed,d.transportDelay=m.B_ed,c.currentPacketLossRate=m.B_ealr4/100,d.currentPacketLossRate=m.B_evlr4/100,u.uplinkNetworkQuality=m.B_punq?m.B_punq:0,u.downlinkNetworkQuality=m.B_pdnq?m.B_pdnq:0),this.remoteStats.set(n,{audioStats:c,videoStats:d,videoPcStats:A,networkStats:u}),l&&this.exceptionMonitor.setRemoteAudioStats(l,c),h&&this.exceptionMonitor.setRemoteVideoStats(h,d)})}}class RB{constructor(){Aa(this,"destChannelMediaInfos",new Map),Aa(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Th(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Th(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Tr(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function RV(e){if(!(e instanceof RB))return new gy(vA.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();return t?0===r.size?new gy(vA.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new gy(vA.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class RF{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){Aa(this,"uid",void 0),Aa(this,"_uintid",void 0),Aa(this,"_trust_in_room_",!0),Aa(this,"_trust_audio_enabled_state_",!0),Aa(this,"_trust_video_enabled_state_",!0),Aa(this,"_trust_audio_mute_state_",!0),Aa(this,"_trust_video_mute_state_",!0),Aa(this,"_audio_muted_",!1),Aa(this,"_video_muted_",!1),Aa(this,"_audio_enabled_",!0),Aa(this,"_video_enabled_",!0),Aa(this,"_audio_added_",!1),Aa(this,"_video_added_",!1),Aa(this,"_is_pre_created",!1),Aa(this,"_video_pre_subscribed",!1),Aa(this,"_audio_pre_subscribed",!1),Aa(this,"_trust_video_stream_added_state_",!0),Aa(this,"_trust_audio_stream_added_state_",!0),Aa(this,"_audioTrack",void 0),Aa(this,"_videoTrack",void 0),Aa(this,"_dataChannels",[]),Aa(this,"_audioSSRC",void 0),Aa(this,"_videoSSRC",void 0),Aa(this,"_audioOrtc",void 0),Aa(this,"_videoOrtc",void 0),Aa(this,"_cname",void 0),Aa(this,"_rtxSsrcId",void 0),Aa(this,"_videoMid",void 0),Aa(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function Rj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function RG(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rj(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rj(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function RW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function RH(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?RW(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RW(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var RY=((e6=RY||{})[e6.DOWN=0]="DOWN",e6[e6.UP=1]="UP",e6);let RK=new Map;function RQ(e,t,r,i){let{scale:n}=e;if(0===n&&i===RY.UP||n>=t.length-1&&i===RY.DOWN)return e;let o=RH(RH({},e),{},{scale:i===RY.DOWN?++n:--n});switch(r){case"maintain-framerate":o=RH(RH({},o),t[n].motion);break;case"maintain-resolution":o=RH(RH({},o),t[n].detail);break;case"balanced":o=RH(RH({},o),t[n].balanced)}return o}function Rz(e,t){if(t){let r={overUse:0,underUse:0,adaptationList:RX(t)};RK.set(e,r)}else RK.delete(e)}function RX(e){let t=RH({},e),{bitrateMax:r,frameRate:i,scaleResolutionDownBy:n,bitrateMin:o}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:d,BITRATE_MAX_THRESHOLD:u,BWE_SCALE_UP_THRESHOLD:l,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:f,BALANCE_BITRATE_FACTOR:_,BALANCE_FRAMERATE_FACTOR:A,BALANCE_RESOLUTION_FACTOR:m,MOTION_RESOLUTION_FACTOR:v,MOTION_BITRATE_FACTOR:E,DETAIL_FRAMERATE_FACTOR:g,DETAIL_BITRATE_FACTOR:S}=EZ,b=Math.min(t.frameRate,s),T=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(p,1)*b),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o}}];for(let e=1;e<=c;e++){let t={bwe_up:Math.round(Math.pow(l,e)*r),bwe_down:Math.round(Math.pow(h,e+1)*r),fps_up:Math.round(Math.pow(f,e)*b),fps_down:Math.round(Math.pow(p,e+1)*b)},s={scaleResolutionDownBy:n/Math.pow(m,e),frameRate:Math.max(Math.round(Math.pow(A,e)*i),a),bitrateMax:Math.max(Math.round(Math.pow(_,e)*r),u),bitrateMin:Math.max(Math.round(Math.pow(_,e)*o),d)},c={scaleResolutionDownBy:n/Math.pow(v,e),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(E,e)*r),u),bitrateMin:Math.max(Math.round(Math.pow(E,e)*o),d)},y={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(g,e)*i),a),bitrateMax:Math.max(Math.round(Math.pow(S,e)*r),u),bitrateMin:Math.max(Math.round(Math.pow(S,e)*o),d)};T.push({scale:e,threshold:t,balanced:s,motion:c,detail:y})}return T}function RJ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function Rq(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?RJ(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RJ(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let RZ=new Map;function R$(e,t){let r=RZ.get(e);if(r){let{timer:t}=r;window.clearTimeout(t),RZ.delete(e)}t.qualityLimitationReason=Ex.NONE,Rz(e)}function R0(e){if(e.some(e=>e._bypassWebAudio))throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!gR.webAudioMediaStreamDest)throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function R2(e,t){R0(e);let r=t||new S0;return e.forEach(e=>r.addAudioTrack(e)),r}let R1=!gR.supportUnifiedPlan||E4("CHROME_FORCE_PLAN_B")&&vu();function R4(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return R1?(t={spec:r,store:e},yJ("PlanBConnection").create(t)):new R9(r,e)}function R6(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function R3(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(vF(e.turnServer.servers))return!1;if(E4("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch(e){return!1}}function R8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function R5(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R8(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R8(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let R9=(b$((rV=class e extends Tk{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return o0(t=Object.keys(E5)).call(t,e)}))]}constructor(t,r){super(t,r),Aa(this,"id",Er(5,"connection-")),Aa(this,"store",void 0),Aa(this,"peerConnection",void 0),Aa(this,"forceTurn",!1),Aa(this,"remoteSDP",void 0),Aa(this,"initialOffer",void 0),Aa(this,"transportEventReceiver",void 0),Aa(this,"statsFilter",void 0),Aa(this,"extension",{useXR:E4("USE_XR")}),Aa(this,"localCapabilities",void 0),Aa(this,"remoteCodecs",void 0),Aa(this,"localCandidateCount",0),Aa(this,"allCandidatesReceived",!1),Aa(this,"isPreallocation",!1),Aa(this,"preSSRCMap",new Map),Aa(this,"dataStreamChannelMap",new Map),Aa(this,"establishPromise",void 0),Aa(this,"recoveredDataChannelIds",[]),Aa(this,"currentDataChannelId",1),Aa(this,"supportAV1RtpSpec",!1),Aa(this,"mutex",void 0),Aa(this,"qualityLimitationReason",Ex.NONE),Aa(this,"isFirstConnected",!1),this.store=r,this.forceTurn=R3(t),this.mutex=new Ep("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=EH(this.peerConnection,E4("STATS_UPDATE_INTERVAL"),void 0,m1()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){let t=this.preSSRCMap.get(e);if(void 0!==t){let e=this.peerConnection.getTransceivers().find(e=>e.mid===t);if(e)return{transceiver:e,track:e.receiver.track,id:t}}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,!this.remoteSDP)return void gA.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t));if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){let e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);let r=this.remoteSDP.toString();null==t||t(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}else gA.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){var e,t;try{let r;this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let i=await this.peerConnection.createOffer();if(!i.sdp)throw Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=yy(i.sdp),o=await yM({filterRTX:!E4("USE_PUB_RTX")&&!E4("USE_SUB_RTX"),filterVideoFec:E4("FILTER_VIDEO_FEC"),filterAudioFec:E4("FILTER_AUDIO_FEC"),filterVideoCodec:E4("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=yB(o),this.initialOffer=i,E4("ENABLE_SVC")&&"av1"==this.store.codec){let t=await async function(){try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:EU.L1T3}]});let t=await e.createOffer();if(!t.sdp)return void e.close();let r=ge(t.sdp).mediaDescriptions[0];if(!r)return;let i=r.attributes.extmaps.find(e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName);return e.close(),i}catch(e){return}}();t&&(this.supportAV1RtpSpec=!0,null===(e=o.send)||void 0===e||e.videoExtensions.push(t))}return i.sdp&&yH(i.sdp)&&((t=r=v2(o)).send&&(yv(Tw.VIDEO,t.send.videoExtensions),yv(Tw.AUDIO,t.send.audioExtensions)),t.recv&&(yv(Tw.VIDEO,t.recv.videoExtensions),yv(Tw.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(yv(Tw.VIDEO,t.sendrecv.videoExtensions),yv(Tw.AUDIO,t.sendrecv.audioExtensions))),R5(R5({},n),{},{rtpCapabilities:r||o,offerSDP:i.sdp})}catch(e){throw new vm(vA.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){var t,r;try{if(!this.initialOffer)throw Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&yH(this.initialOffer.sdp)&&(t=e.rtpCapabilities,r=this.localCapabilities,t.send&&(ym(Tw.VIDEO,t.send.videoExtensions,r.send.videoExtensions),ym(Tw.AUDIO,t.send.audioExtensions,r.send.audioExtensions)),t.recv&&(ym(Tw.VIDEO,t.recv.videoExtensions,r.recv.videoExtensions),ym(Tw.AUDIO,t.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return v2(this._localCapabilities)}get rtpCapabilities(){return v2(this._rtpCapabilities)}get candidates(){return v2(this._candidates)}get iceParameters(){return v2(this._iceParameters)}get dtlsParameters(){return v2(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Aa(this,"sessionDesc",void 0),Aa(this,"_localCapabilities",void 0),Aa(this,"_rtpCapabilities",void 0),Aa(this,"_candidates",void 0),Aa(this,"_originCandidates",void 0),Aa(this,"_iceParameters",void 0),Aa(this,"_isUseExtmapAllowMixed",void 0),Aa(this,"_dtlsParameters",void 0),Aa(this,"setup",void 0),Aa(this,"currentMidIndex",void 0),Aa(this,"cname",void 0),Aa(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t;let{iceParameters:r,dtlsParameters:i,candidates:n,rtpCapabilities:o,setup:a,localCapabilities:s,cname:c}=e=v2(e);this._rtpCapabilities=o,this._candidates=n,this._originCandidates=v2(n),this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=s,this.setup=a,this.cname=c,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){let t=this.candidates,r=this.dtlsParameters,i=this.iceParameters,n=this.rtpCapabilities.send,o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){let e=2*a+2e4,s=2*a+4e4,{ssrcs:c,ssrcGroups:d}=yk([{ssrcId:e}],this.cname),{ssrcs:u,ssrcGroups:l}=yk([{ssrcId:s,rtx:E4("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:n.videoCodecs.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:t,extmaps:n.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:n.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:n.audioCodecs.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:t,extmaps:n.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:n.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return gt(this.sessionDesc)}send(e,t,r,i){let{ssrcs:n,ssrcGroups:o}=yk(t,this.cname,E4("SYNC_GROUP")?r:void 0),a=this.findPreloadMediaDesc(n);if(a){if(m1()&&this.firefoxSsrcMidMap.set(n[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){let e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{let t;let r=this.findAvailableMediaIndex(e,n);return -1===r||1===r&&(m0()||function(){let e=mz();return!(e.name!==mH.CHROME||!e.osVersion)&&90>=Number(e.version)}()||E4("ENABLE_ENCODED_TRANSFORM")&&m$())||0===r&&E4("USE_SUB_RTX")||vr()?(t=this.createOrRecycleSendMedia(e,n,o,"sendonly",i),this.updateBundleMids()):((t=v2(this.sessionDesc.mediaDescriptions[r])).attributes.direction="sendonly",t.attributes.ssrcs=n,t.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[r]=this.mungSendMediaDesc(t,i)),m1()&&this.firefoxSsrcMidMap.set(n[0].ssrcId,t.attributes.mid),{mid:t.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(e=>{let{kind:t,ssrcMsg:r,mslabel:i}=e;return this.send(t,r,i)}),r=[],i=!1;return t.forEach(e=>{let{mid:t,needExchangeSDP:n}=e;n&&(i=!0),r.push(t)}),{mids:r,needExchangeSDP:i}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{"0"===e.attributes.mid||m1()||vr()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>o0(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>o0(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}receive(e,t,r,i){e.forEach((e,n)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,r,i[n])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){var t;let r=this.sessionDesc||ge((t=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(t?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));this._rtpCapabilities=e;let i=this.rtpCapabilities.send,n=this.localCapabilities.send;for(let e of r.mediaDescriptions){if(e.attributes.iceUfrag=this._iceParameters.iceUfrag,e.attributes.icePwd=this._iceParameters.icePwd,e.attributes.fingerprints=this._dtlsParameters.fingerprints,e.attributes.candidates=this._candidates,e.attributes.setup=this.setup,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType){if(0===i.videoCodecs.length){let t=n.videoCodecs.filter(e=>{var t,r;return null===(t=e.rtpMap)||void 0===t?void 0:o0(r=t.encodingName.toLowerCase()).call(r,"vp8")})||[n.videoCodecs[0]];e.media.fmts=t.map(e=>e.payloadType.toString(10)),e.attributes.payloads=t,e.attributes.extmaps=[]}else if(e.media.fmts=i.videoCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=i.videoCodecs,e.attributes.extmaps=i.videoExtensions,E4("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:t,ssrcGroups:r}=yk([{ssrcId:4e4,rtx:E4("USE_SUB_RTX")?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=r}}if("audio"===e.media.mediaType){if(0===i.audioCodecs.length){let t=n.audioCodecs.filter(e=>{var t,r;return null===(t=e.rtpMap)||void 0===t?void 0:o0(r=t.encodingName.toLowerCase()).call(r,"opus")})||[n.audioCodecs[0]];e.media.fmts=t.map(e=>e.payloadType.toString(10)),e.attributes.payloads=t,e.attributes.extmaps=[]}else if(e.media.fmts=i.audioCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions,yV(e),E4("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:t,ssrcGroups:r}=yk([{ssrcId:2e4}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=r}}}return this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){let t=this._originCandidates.filter(e=>"udp"===e.transport),r=[];if(t.forEach(e=>{r.push(RG(RG({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case TO.TCP_RELAY:this._candidates=r;break;case TO.UDP_TCP_RELAY:case TO.RELAY:this._candidates=[...t,...r];break;default:this._candidates=t}for(let e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=v2(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(m1()){if(i){let e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(let e of this.sessionDesc.mediaDescriptions)if("application"===e.media.mediaType)return{mediaDesc:e,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,r,i,n,o){let a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=yF(a,s,this.localCapabilities.send,a===Tw.VIDEO?i:n),d=a===Tw.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;let u="".concat(this.currentMidIndex),l={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};l=this.mungRecvMediaDsec(l,e,o);let h=this.findFirstClosedMedia(a);if(h){let e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateRemoteCodec(e,t,r){let i;let n=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return o0(t=Object.keys(E5)).call(t,e)}))],o=new Set(t);if(n.every(e=>o.has(e)))return gA.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let a=this._rtpCapabilities.recv.videoCodecs.filter(e=>t.some(t=>{var r;return o0(r=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(r,t)}));if(0===a.length)return gA.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(n," codecs: ").concat(t)),!1;let s=[...new Set(a.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""))];if(gA.debug("updateRemoteCodec, from ".concat(n," to ").concat(s)),0===e.length)i=this.sessionDesc.mediaDescriptions.filter(e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction);else if((i=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&o0(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)).length!==e.length)return gA.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(E4("USE_PUB_RTX")||E4("USE_SUB_RTX")){let e=yj(a,this.rtpCapabilities.recv.videoCodecs);a.push(...e)}this._rtpCapabilities.recv.videoCodecs=a;let c=this.localCapabilities.send,d=this.rtpCapabilities.recv,u=yF(Tw.VIDEO,d,c,r);return i.forEach(e=>{let t=u.map(e=>e.payloadType.toString(10));gA.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",u),e.attributes.payloads=u,e.media.fmts=t}),!0}createOrRecycleSendMedia(e,t,r,i,n){let o=this.rtpCapabilities.send,a=e===Tw.VIDEO?o.videoCodecs:o.audioCodecs,s=e===Tw.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;let c="".concat(this.currentMidIndex),d={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};d=this.mungSendMediaDesc(d,n);let u=this.findFirstClosedMedia(e);if(u){let e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,r){let i=v2(e);return yO(i),yw(i,t),yN(i,t),yP(i),yD(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,t){let r=v2(e);return yD(r,t,this.localCapabilities.recv),yV(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==r){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>m1()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return(null===(r=t.attributes)||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===t?void 0:t.attributes.ssrcs}}(R5(R5({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let i=this.remoteSDP.toString(),n=yW(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(n||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});let a=this.peerConnection.getTransceivers()[0];if(null!=a&&a.receiver&&this.tryBindTransportEvents(a.receiver),E4("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(E4("PRELOAD_MEDIA_COUNT"));let e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}let{preSSRCs:s}=e;if(Array.isArray(s)&&s.length>0){let{mids:e}=this.remoteSDP.batchSend(s.map(e=>({kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel})));e.forEach((e,t)=>{this.preSSRCMap.set(s[t].ssrcId,e)}),await yG(this.peerConnection,this.remoteSDP,this.extension),gA.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:t}=e;this.remoteSDP.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:r}=e;if(Array.isArray(r)&&r.length>0){let{mids:e}=this.remoteSDP.batchSend(r.map(e=>Object.assign({},{kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel})));e.forEach((e,t)=>{this.preSSRCMap.set(r[t].ssrcId,e)})}await yG(this.peerConnection,this.remoteSDP,this.extension),gA.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,r){var i=this;return mi(function*(){let n=yield mn(i.mutex.lock("From P2PConnection.send"));try{let n;if(!i.remoteSDP)throw Error("Cannot call P2PConnection.send before remote SDP created");let o=[],a=y_();e.forEach(e=>{let t=i.peerConnection.addTransceiver(e._mediaStreamTrack,R5({direction:"sendonly"},"video"===e.trackMediaType&&i.supportAV1RtpSpec&&a?{sendEncodings:[{scalabilityMode:a}]}:{}));o.push(t),e._updateRtpTransceiver(t)}),m1()&&!0===E4("SIMULCAST")&&(yield mn(i.applySimulcastForFirefox(o,e)));let s=yield mn(i.peerConnection.createOffer()),c=i.remoteSDP.predictReceivingMids(e.length),d=i.mungSendOfferSDP(s.sdp,e,c),u=ge(d),l=c.map(e=>{let t=u.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("Cannot extract ssrc from mediaDescription.");return yR(t,E4("USE_PUB_RTX"))});try{n=yield l}catch(a){n=[],i.remoteSDP.receive(e,t,r,n);let o=i.remoteSDP.toString();throw yield mn(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield mn(i.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield mn(i.stopSending(c,!0)),a}i.remoteSDP.receive(e,t,r,n);let h=i.remoteSDP.toString(),p=i.logSDPExchange(d,"offer","local","send");return yield mn(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield mn(i.applySimulcastEncodings(o,e)),yield mn(i.applySendEncodings(o,e)),null==p||p(h),yield mn(i.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map((e,t)=>{let r=c[t];return{localSSRC:l[t],id:r,transceiver:e}})}catch(e){throw e instanceof vm?e:new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{n()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(e);if(r&&"open"===r.readyState)gA.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw Error("create DataChannel error, because cannot get dc id");(r=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:E4("DATASTREAM_MAX_RETRANSMITS")})).binaryType="arraybuffer",this.dataStreamChannelMap.set(e,r)}t.forEach(e=>{e._updateOriginDataChannel(r)});let{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){let e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),gA.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else gA.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof vm?e:new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{let t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof vm?e:new vm(vA.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){let r=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{var t;R$(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);let n=this.remoteSDP.toString();null==i||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{r&&r()}}async receive(e,t,r,i){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:n,needExchangeSDP:o}=this.remoteSDP.send(e,t,r,i);o&&(await yG(this.peerConnection,this.remoteSDP,this.extension),gA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));let a=this.peerConnection.getTransceivers().find(e=>e.mid===n);if(!a)throw Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:n,transceiver:a}}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:t,needExchangeSDP:r}=this.remoteSDP.batchSend(e);return r&&(await yG(this.peerConnection,this.remoteSDP,this.extension),gA.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(e=>{let t=this.peerConnection.getTransceivers().find(t=>t.mid===e);if(!t)throw Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(e=>{Array.from(this.preSSRCMap.entries()).some(t=>{let[r,i]=t;if(i===e)return this.preSSRCMap.delete(r),!0})}),this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();null==r||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();null==r||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();null==r||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);let n=this.remoteSDP.toString();null==i||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length.");t.map(async(e,t)=>{e.direction="sendonly"});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);let n=this.remoteSDP.toString();null==i||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return mi(function*(){let r=yield mn(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw Error("Cannot restartICE before remoteSDP created.");let r=gR.supportPCSetConfiguration,i=E4("FORCE_TURN_TCP")||t.forceTurn;if(e===TO.RELAY&&!r)return;if(r&&!i){let r=e===TO.RELAY?"relay":"all",i=t.peerConnection.getConfiguration();i.iceTransportPolicy!==r&&(gA.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(i.iceTransportPolicy,"] to [").concat(r,"]")),i.iceTransportPolicy=r,t.peerConnection.setConfiguration(i))}t.remoteSDP.updateCandidates(e);let n=yield mn(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw Error("Cannot restartICE because restart offer SDP does not exist.");let o=yy(n.sdp),{remoteIceParameters:a}=yield o.iceParameters;t.remoteSDP.restartICE(a);let s=t.remoteSDP.toString(),c=t.logSDPExchange(n.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield mn(t.peerConnection.setLocalDescription(n)),null==c||c(s),yield mn(t.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(e){gA.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(TO.TCP_RELAY),await yG(this.peerConnection,this.remoteSDP,this.extension)}catch(e){gA.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(e=>{R$(this.id+e.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return R5(R5({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let n=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==o||o(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){let r=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===r.length&&(this.isVP8Simulcast(t)?m1()||await this.applySimulcastEncodings(r,[t]):await this.applySendEncodings(r,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let r=this.peerConnection.getTransceivers().find(e=>e.mid===t);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let{local:t,remote:r}=e[0].transport.iceTransport.getSelectedCandidatePair();return{local:R5(R5({},Ek),{},{candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port}),remote:R5(R5({},Ek),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;let r="code: ".concat(e.errorCode,", message: ").concat(e.errorText),i=e.port?"local: ".concat(e.port):"";gA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(e.url||"",", host_candidate:").concat(i)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,r)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&gA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,gA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,gA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},E4("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(vF(t.turnServer.servers)?r.iceServers=t.turnServer.servers:E4("NEW_TURN_MODE")&&r.iceServers?(E4("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),E4("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(r.iceServers&&r.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),E4("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),E4("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(r.iceTransportPolicy="relay")}))),E4("ENABLE_ENCODED_TRANSFORM")&&gR.supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(e){let t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(ya(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!E4("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}static newTurnServerConfigToIceServers(e){let t=[];return e.forEach(e=>{let r=E4("NEW_TURN_MODE");1===r?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===r?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===r?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(ya(e.turnServerURL),":443?transport=tcp")}):4===r&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(ya(e.turnServerURL),":443?transport=tcp")}))}),t}tryBindTransportEvents(e){let t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};let r=t.iceTransport;r&&(r.onstatechange=()=>{var e;let r=null==t?void 0:t.iceTransport.state;r&&(null===(e=this.onICETransportStateChange)||void 0===e||e.call(this,r))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:e,remote:t}=r.getSelectedCandidatePair();gA.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var r,i,n,o,a,s,c,d,u;if(!t&&(t=this.peerConnection.getSenders().find(t=>t.track===e._mediaStreamTrack)),!t)return gA.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return gA.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!gR.supportSetRtpSenderParameters)return gA.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let l={},h={};switch(e._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}let p=(s=this.peerConnection,c=e._mediaStreamTrack,s.getTransceivers().find(e=>e.sender.track===c||e.receiver.track===c)),f=SQ(e);if(d=e,E4("ENABLE_AG_ADAPTATION")&&(d instanceof S5||o0(u=d._hints).call(u,gY.CUSTOM_TRACK))&&(E4("FORCE_SUPPORT_AG_ADAPTATION")||function(e){let t=mz();return t.os===mW.IOS&&!!t.osVersion&&Number(t.osVersion.split(".")[0])>=14}(14)&&m7(17,4,!0)||m9(14)&&ve(17,4,!0))&&p&&t&&f&&this.getLocalVideoStats&&o0(r=["vp8","vp9"]).call(r,this.store.codec)){let r=l.degradationPreference||(o0(n=e._hints).call(n,gY.CUSTOM_TRACK)?E4("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,r,i,n,o){if(R$(e,r),n(t),"balanced"!==i&&"maintain-framerate"!==i&&"maintain-resolution"!==i)return;let a=-1;Rz(e,t);let s=window.setInterval(()=>{let s=RZ.get(e);if(!E4("ENABLE_AG_ADAPTATION")||!s)return R$(e,r),void n(t);let c=o();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;let o=c.sendFrameRate,d=c.OutgoingAvailableBandwidth,[u,l]=function(e,t,r,i,n,o){let a,s;let c=RK.get(e)||{overUse:0,underUse:0,adaptationList:RX(n)},{adaptationList:d}=c;RK.set(e,c);let{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:l}=EZ,{scale:h}=i;return"number"==typeof t&&t>0&&function(e,t,r,i){if(t>=r.length)return!1;let{threshold:{fps_down:n}}=r[t];return E4("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===i&&(n=r[0].threshold.fps_down),e<n}(t,h,d,o)&&(c.overUse++,s=Ex.CPU,c.overUse>u)||"number"==typeof r&&r>0&&function(e,t,r){if(t>=r.length)return!1;let{threshold:{bwe_down:i}}=r[t];return e<i}(r,h,d)&&(c.overUse++,s=Ex.BANDWIDTH,c.overUse>u)?(c.overUse=0,c.underUse=0,[a=RQ(i,d,o,RY.DOWN),s]):("number"==typeof t&&t>0&&"number"==typeof r&&r>0&&function(e,t,r,i){if(0===t)return;let{threshold:{fps_up:n}}=r[t];return E4("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===i&&(n=r[1].threshold.fps_up),e>n}(t,h,d,o)&&function(e,t,r){if(0===t)return;let{threshold:{bwe_up:i}}=r[t];return e>i}(r,h,d)&&(c.underUse++,c.underUse>l&&(c.overUse=0,c.underUse=0,0===(a=RQ(i,d,o,RY.UP)).scale&&(s=Ex.NONE))),[a,s])}(e,o,d,s.adaptationConfig,t,i);l&&(r.qualityLimitationReason=l),u&&s.adaptationConfig.scale!==u.scale&&(gA.debug("[".concat(e,"] applyAdaptation: ").concat(r.qualityLimitationReason,"\n           sendFps ").concat(o,", bwe ").concat(d,", switch from ").concat(s.adaptationConfig.scale," to ").concat(u.scale," ")),s.adaptationConfig=Rq(Rq({},s.adaptationConfig),u),n(u))}},E4("CHECK_LOCAL_STATS_INTERVAL")),c=Rq({},t);RZ.set(e,{timer:s,adaptationConfig:c,originConfig:t,adaptationFunc:n}),gA.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(i))}(this.id+p.mid,f,this,r,e=>{t&&this.updateAdaptation(t,e)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){let{bitrateMax:t,frameRate:r,scaleResolutionDownBy:i}=e._encoderConfig;t&&(h.maxBitrate=1e3*t),(o0(o=e._hints).call(o,gY.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(r&&(h.maxFramerate=yc(r)),i&&i>=1&&(h.scaleResolutionDownBy=i))}let{maxFramerate:_}=E4("ENCODER_CONFIG_LIMIT");if(_&&"number"==typeof _&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,_):_),E4("DSCP_TYPE")&&vu()){let e=E4("DSCP_TYPE");o0(a=["very-low","low","medium","high"]).call(a,e)&&(h.networkPriority=e)}let A=t.getParameters(),m=null===(i=A.encodings)||void 0===i?void 0:i[0];m1()&&!m&&(l.encodings=[h]),m&&Object.assign(m,h),Object.assign(A,l),gA.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await t.setParameters(A),await async function(e,t,r){try{var i,n;if(!gR.supportSetRtpSenderParameters)return;if(n=e,"vp9"!==n&&"av1"!==n||!E4("ENABLE_SVC"))return;let o={},a=t.getParameters(),s=null===(i=a.encodings)||void 0===i?void 0:i[0];o.scalabilityMode=y_(r),s&&Object.assign(s,o),Object.assign(a,{}),await t.setParameters(a),gA.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(e){gA.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,E4("SVC_MODE"))}async updateAdaptation(e,t){var r,i;if(!e)return gA.debug("[updateAdaptation] no rtpSender found");if(!gR.supportSetRtpSenderParameters)return gA.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let n={},{bitrateMax:o,frameRate:a,scaleResolutionDownBy:s}=t;o&&(n.maxBitrate=1e3*o),a&&(n.maxFramerate=yc(a)),s&&s>=1&&o0(r=["vp8","vp9"]).call(r,this.store.codec)&&(n.scaleResolutionDownBy=s);let c=e.getParameters(),d=null===(i=c.encodings)||void 0===i?void 0:i[0];d&&Object.assign(d,n),Object.assign(c,{});try{await e.setParameters(c),gA.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){"transport"in e&&(!e.transport||"connected"!==e.transport.state)?gA.debug("[updateAdaptation] rtpSender transport not connected}"):"connected"!==this.peerConnectionState?gA.debug("[updateAdaptation] peerConnection not connected}"):gA.debug("[updateAdaptation] updateRtpSenderEncodings failed",t)}}async applySendEncodings(e,t){try{if(!gR.supportSetRtpSenderParameters||e.length!==t.length)return;for(let r=0;r<e.length;r++){let i=e[r],n=t[r];n instanceof S8&&!this.isVP8Simulcast(n)&&await this.updateRtpSenderEncodings(n,i.sender)}}catch(e){gA.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,r){let i=ge(e);return t.forEach((e,t)=>{let n=r[t],o=i.mediaDescriptions.find(e=>e.attributes.mid===n);o&&(yw(o,e),yL(o,e,this.store.codec))}),gt(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,r)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,e,t,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var r;null===(r=this.onSelectedLocalCandidateChanged)||void 0===r||r.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var r;null===(r=this.onSelectedRemoteCandidateChanged)||void 0===r||r.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var r,i,n,o,a;let c=e[s],d=t[s];if(d instanceof S8&&!o0(r=d._hints).call(r,gY.LOW_STREAM)&&null!==(i=d._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(n=d._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(o=d._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=d._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){let e={},t={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];let r=c.sender.getParameters();await c.sender.setParameters(Object.assign(r,e))}}}async applySimulcastEncodings(e,t){if(!m1()&&e.length===t.length)for(let r=0;r<e.length;r++){let i=t[r];if(i instanceof S8&&this.isVP8Simulcast(i)){let t=e[r],n={},o={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};n.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];let a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,n))}}}isVP8Simulcast(e){var t,r,i,n,o;return!!(e instanceof S8&&E4("SIMULCAST")&&"vp8"===this.store.codec&&!o0(t=e._hints).call(t,gY.LOW_STREAM)&&null!==(r=e._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=e._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(n=e._scalabilityMode)&&void 0!==n&&n.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,r,i){if(E4("SDP_LOGGING"))return gA.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(t," SDP during P2PConnection.").concat(i,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===r?"remote":"local",i)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(gR.supportPCSetConfiguration){let r=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}}).prototype,"updateRemoteRTPCapabilities",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"updateRemoteRTPCapabilities"),rV.prototype),b$(rV.prototype,"connect",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"connect"),rV.prototype),b$(rV.prototype,"updateRemoteConnect",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"updateRemoteConnect"),rV.prototype),b$(rV.prototype,"createDataChannels",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"createDataChannels"),rV.prototype),b$(rV.prototype,"receive",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"receive"),rV.prototype),b$(rV.prototype,"batchReceive",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"batchReceive"),rV.prototype),b$(rV.prototype,"stopReceiving",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"stopReceiving"),rV.prototype),b$(rV.prototype,"muteRemote",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"muteRemote"),rV.prototype),b$(rV.prototype,"unmuteRemote",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"unmuteRemote"),rV.prototype),b$(rV.prototype,"muteLocal",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"muteLocal"),rV.prototype),b$(rV.prototype,"unmuteLocal",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"unmuteLocal"),rV.prototype),b$(rV.prototype,"close",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"close"),rV.prototype),b$(rV.prototype,"updateEncoderConfig",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"updateEncoderConfig"),rV.prototype),b$(rV.prototype,"updateSendParameters",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"updateSendParameters"),rV.prototype),b$(rV.prototype,"replaceTrack",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"replaceTrack"),rV.prototype),b$(rV.prototype,"updateAdaptation",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"updateAdaptation"),rV.prototype),b$(rV.prototype,"getRemoteSSRC",[R7],Object.getOwnPropertyDescriptor(rV.prototype,"getRemoteSSRC"),rV.prototype),rV);function R7(e,t,r){let i=e[t];if("function"!=typeof i)throw Error("Cannot use mutex on object property.");return r.value=async function(){let e=this.mutex,r=await e.lock("From P2PConnection.".concat(t));try{for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return await i.apply(this,o)}finally{r()}},r}function Ie(e,t){let r=document.createElement("video"),i=document.createElement("canvas");r.setAttribute("style","display:none"),i.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),i.width=yc(t.width),i.height=yc(t.height);let n=yc(t.framerate||15);document.body.append(r),document.body.append(i);let o=e._mediaStreamTrack;r.srcObject=new MediaStream([o]),r.play();let a=i.getContext("2d");if(!a)throw new gy(vA.UNEXPECTED_ERROR,"can not get canvas context");let s=i.captureStream(gR.supportRequestFrame?0:n).getVideoTracks()[0];s.canvas||(s.canvas=i),i.startCapture=()=>{if(!r)return i.stopCapture&&i.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){let e=r.videoWidth,t=r.videoHeight/e,n=i.width*t;Math.abs(n-i.height)>=2&&(gA.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(n)),i.height=n)}a.drawImage(r,0,0,i.width,i.height),s.requestFrame&&s.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,r.srcObject=new MediaStream([o]))},i.stopCapture=S_(()=>i.startCapture&&i.startCapture(),n);let c=s.stop;return s.stop=()=>{c.call(s),r&&(r.remove(),r.srcObject=null,r=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),gA.debug("clean low stream renderer")},s}var It=((e3=It||{})[e3.HEIGHT=2033]="HEIGHT",e3[e3.FRAME_RATE=2034]="FRAME_RATE",e3[e3.WIDTH=2035]="WIDTH",e3),Ir=((e8=Ir||{})[e8.FRAME_RATE=2002]="FRAME_RATE",e8[e8.WIDTH=2003]="WIDTH",e8[e8.HEIGHT=2004]="HEIGHT",e8[e8.PACKAGE_LOST=2005]="PACKAGE_LOST",e8[e8.AVG_ENCODE=2007]="AVG_ENCODE",e8[e8.NACKS=2009]="NACKS",e8[e8.PLIS=2010]="PLIS",e8[e8.FIRS=2011]="FIRS",e8[e8.BITRATE=2012]="BITRATE",e8[e8.PACKAGE_RATE=2031]="PACKAGE_RATE",e8[e8.ADAPTATION=2032]="ADAPTATION",e8[e8.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e8[e8.BANDWIDTH=2061]="BANDWIDTH",e8[e8.RETRANSMIT=2062]="RETRANSMIT",e8[e8.TARGET_ENCODED=2064]="TARGET_ENCODED",e8[e8.TRANSMIT=2066]="TRANSMIT",e8[e8.FREEZE=2082]="FREEZE",e8[e8.DISABLED=2095]="DISABLED",e8[e8.PLAYER_STATUS=2128]="PLAYER_STATUS",e8[e8.QP_SUM=2143]="QP_SUM",e8[e8.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e8[e8.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e8[e8.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e8[e8.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e8),Ii=((e5=Ii||{})[e5.BITRATE=2069]="BITRATE",e5[e5.PACKAGE_LOST=2070]="PACKAGE_LOST",e5[e5.PACKAGE_RATE=2071]="PACKAGE_RATE",e5[e5.HEIGHT=2073]="HEIGHT",e5[e5.FRAME_RATE=2075]="FRAME_RATE",e5[e5.WIDTH=2077]="WIDTH",e5),In=((e9=In||{})[e9.JITTER=-1]="JITTER",e9[e9.PACKAGE_LOST=2014]="PACKAGE_LOST",e9[e9.WIDTH=2018]="WIDTH",e9[e9.HEIGHT=2019]="HEIGHT",e9[e9.FRAME_RATE=2020]="FRAME_RATE",e9[e9.JITTER_BUFFER=2023]="JITTER_BUFFER",e9[e9.CURRENT_DELAY=2024]="CURRENT_DELAY",e9[e9.NACKS=2026]="NACKS",e9[e9.PLIS=2027]="PLIS",e9[e9.FIRS=2028]="FIRS",e9[e9.BITRATE=2029]="BITRATE",e9[e9.PACKAGE_RATE=2078]="PACKAGE_RATE",e9[e9.FREEZE=2084]="FREEZE",e9[e9.DISABLED=2101]="DISABLED",e9[e9.PLAYER_STATUS=2129]="PLAYER_STATUS",e9[e9.QP_SUM=2144]="QP_SUM",e9[e9.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e9[e9.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e9[e9.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e9[e9.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e9[e9.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e9[e9.AVG_DECODE=2200]="AVG_DECODE",e9[e9.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e9[e9.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e9[e9.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e9[e9.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e9),Io=((e7=Io||{})[e7.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e7[e7.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e7[e7.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e7[e7.FREEZE_TIME=2109]="FREEZE_TIME",e7[e7.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e7[e7.FREEZE_DURATION=2156]="FREEZE_DURATION",e7),Ia=((te=Ia||{})[te.PCM_LEVEL=2104]="PCM_LEVEL",te),Is=((tt=Is||{})[tt.PACKAGE_LOST=-1]="PACKAGE_LOST",tt[tt.LEVEL=2038]="LEVEL",tt[tt.BITRATE=2039]="BITRATE",tt[tt.PACKAGE_RATE=2040]="PACKAGE_RATE",tt[tt.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",tt[tt.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",tt[tt.FREEZE=2081]="FREEZE",tt[tt.DISABLED=2096]="DISABLED",tt[tt.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",tt[tt.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",tt),Ic=((tr=Ic||{})[tr.BITRATE=2044]="BITRATE",tr[tr.PACKAGE_LOST=2045]="PACKAGE_LOST",tr[tr.PACKAGE_RATE=2046]="PACKAGE_RATE",tr[tr.CURRENT_DELAY=2047]="CURRENT_DELAY",tr[tr.JITTER_BUFFER=2054]="JITTER_BUFFER",tr[tr.JITTER=2055]="JITTER",tr[tr.FREEZE=2083]="FREEZE",tr[tr.DISABLED=2102]="DISABLED",tr[tr.PCM_LEVEL=2105]="PCM_LEVEL",tr[tr.PLAYER_STATUS=2130]="PLAYER_STATUS",tr[tr.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",tr[tr.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",tr[tr.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",tr[tr.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",tr[tr.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",tr[tr.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",tr),Id=((ti=Id||{})[ti.FREEZE_TIME=-1]="FREEZE_TIME",ti[ti.LEVEL=2043]="LEVEL",ti),Iu=((tn=Iu||{})[tn.RTT=2006]="RTT",tn[tn.CONN_TYPE=801]="CONN_TYPE",tn[tn.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",tn),Il=((to=Il||{})[to.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",to);function Ih(e,t,r){null!=r&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function Ip(e){let t={[Iu.CONN_TYPE]:0,[Iu.RTT]:e.rtt,[Iu.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(t[Iu.CONN_TYPE]=1),"tcp"===r&&(t[Iu.CONN_TYPE]=3),"tls"===r&&(t[Iu.CONN_TYPE]=4);break}case"srflx":t[Iu.CONN_TYPE]=2;break;case"unknown":t[Iu.CONN_TYPE]=5;break;default:t[Iu.CONN_TYPE]=0}return t}function If(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class I_ extends vP{constructor(e){super(),Aa(this,"store",void 0),Aa(this,"uploadWRTCStatsTimer",void 0),Aa(this,"uploadOutboundDenoiserStatsTimer",void 0),Aa(this,"uploadExtStatsTimer",void 0),Aa(this,"uploadExtUsageStatsTimer",void 0),Aa(this,"uploadInboundExtStatsTimer",void 0),Aa(this,"requestStats",void 0),Aa(this,"requestTransportStats",void 0),Aa(this,"requestLocalMedia",void 0),Aa(this,"requestRemoteMedia",void 0),Aa(this,"requestAllTracks",void 0),Aa(this,"requestVideoIsReady",void 0),Aa(this,"requestUploadStats",void 0),Aa(this,"requestUpload",void 0),Aa(this,"uploadOutboundStarted",!1),Aa(this,"uploadInboundStarted",!1),Aa(this,"uploadTransportStarted",!1),Aa(this,"uploadBaseStatsStarted",!1),Aa(this,"uploadExtensionUsageStarted",!1),Aa(this,"lastRecvStats",void 0),Aa(this,"lastSendStats",void 0),Aa(this,"lastRefRecvStats",void 0),Aa(this,"lastRefSendStats",void 0),Aa(this,"lastFullRecvStats",void 0),Aa(this,"lastFullSendStats",void 0),Aa(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){let t,r;if(!this.requestStats||!this.requestUploadStats)return;let i=e%3==0,n=e%6==0;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),t||r){var o;let e={};if(this.uploadTransportStarted&&t){let n=this.getTransportStats(t,r,i);n&&(e.misc=[n])}if(this.uploadOutboundStarted&&t){let r=this.getOutboundStats(t,n?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,n);r&&(e.outbound=[r])}if(this.uploadInboundStarted&&r){let t=this.getInboundStats(r,n?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,n);t&&(e.inbound=t)}let a=null===(o=this.requestTransportStats)||void 0===o?void 0:o.call(this).connectState;a&&(Array.isArray(e.misc)?e.misc[0]&&e.misc[0].addition&&(e.misc[0].addition[Il.RTC_PEER_CONNECTION_STATE]=EB[a]):e.misc=[{addition:{[Il.RTC_PEER_CONNECTION_STATE]:EB[a]}}]),this.requestUploadStats(e)}this.lastRecvStats=r,this.lastSendStats=t,n&&(this.lastFullRecvStats=r,this.lastFullSendStats=t),i&&(this.lastRefRecvStats=r,this.lastRefSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,r;let e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(r=this.requestUploadStats)||void 0===r||r.call(this,{misc:[{addition:{[Il.RTC_PEER_CONNECTION_STATE]:EB[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),7==++e&&(e=1)},1e3)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,r){if(!this.requestStats)return;if(!r)return null==e.rtt?void 0:{addition:{[Iu.RTT]:e.rtt,[Iu.CONN_TYPE]:void 0,[Iu.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};let i=Ip(e);if(this.store.useP2P){if(t){let e=Ip(t);i[Iu.CONN_TYPE]+=e[Iu.CONN_TYPE]<<3}i[Iu.CONN_TYPE]+=110}else i[Iu.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,t,r,i){let n,o,a;if(!this.requestUploadStats||!this.requestLocalMedia)return;let s=this.requestLocalMedia();if(s&&0!==s.length)return s.forEach(s=>{let[c,{track:d,ssrcs:u}]=s;switch(c){case TD.LocalVideoLowTrack:case TD.LocalVideoTrack:if(c===TD.LocalVideoTrack){let n=function(e,t,r,i,n,o){let a=t.videoSend.find(t=>t.ssrc===e);if(!a)return;let s={},{sentFrame:c,inputFrame:d}=a;if(o&&(Ih(s,Ir.QP_SUM,a.qpSumPerFrame),d&&c)){var u,l;let e,t=d.frameRate,r=c.frameRate;u=t,l=r,e=!0,s[Ir.FREEZE]=!(u<=5)&&(u<=10?l<3:u<=20?l<4:l<5)?1:0}if(n){switch(c&&(Ih(s,Ir.HEIGHT,c.height),Ih(s,Ir.WIDTH,c.width),Ih(s,Ir.FRAME_RATE,c.frameRate)),s[Ir.DISABLED]=i._originMediaStreamTrack&&!i._originMediaStreamTrack.enabled||i._mediaStreamTrack&&!i._mediaStreamTrack.enabled?1:0,a.adaptionChangeReason){case"none":s[Ir.ADAPTATION]=0;break;case"cpu":s[Ir.ADAPTATION]=1;break;case"bandwidth":s[Ir.ADAPTATION]=2;break;case"other":s[Ir.ADAPTATION]=3}let o=0;a.adaptionChangeReason&&(o+=If(a.adaptionChangeReason)),t.qualityLimitationReason&&(o+=If(t.qualityLimitationReason)<<3),s[Ir.ADAPTATION]=o,s[Ir.PLAYER_STATUS]=St[i._player?i._player.videoElementStatus:"uninit"],Ih(s,Ir.NACKS,a.nacksCount),Ih(s,Ir.PLIS,a.plisCount),Ih(s,Ir.FIRS,a.firsCount),Ih(s,Ir.AVG_ENCODE,a.avgEncodeMs),Ih(s,Ir.HUGE_FRAME_SENT,a.hugeFramesSent),Ih(s,Ir.BYTES_RETRANSMIT,a.retransmittedBytesSent),Ih(s,Ir.PACKAGES_RETRANSMIT,a.retransmittedPacketsSent),Ih(s,Ir.KEY_FRAMES_ENCODED,a.keyFramesEncoded);let d=r&&r.videoSend.find(t=>t.ssrc===e);if(d){let e=n?1e3:6e3;d.timestamp&&a.timestamp&&(e=a.timestamp-d.timestamp),null!=d.packets&&null!=a.packets&&Ih(s,Ir.PACKAGE_RATE,1e3*(a.packets-d.packets)/e),null!=a.packetsLost&&null!=d.packetsLost&&Ih(s,Ir.PACKAGE_LOST,a.packetsLost-d.packetsLost),null!=d.bytes&&null!=a.bytes&&Ih(s,Ir.BITRATE,8*(a.bytes-d.bytes)/e)}}return s}(u[0].ssrcId,e,t,d,r,i),a=d&&function(e,t,r,i){let n=t.videoSend.find(t=>t.ssrc===e);if(!n)return null;let o={};if(i){let e=n.inputFrame,t=e&&e.height||r.videoHeight||0,i=e&&e.width||r.videoWidth||0,a=e&&e.frameRate||0;Ih(o,It.HEIGHT,t),Ih(o,It.WIDTH,i),Ih(o,It.FRAME_RATE,a)}return o}(u[0].ssrcId,e,d,r);o=Object.assign({},n,a,function(e,t){let r={};return t&&(Ih(r,Ir.RETRANSMIT,e.bitrate.retransmit),Ih(r,Ir.TARGET_ENCODED,e.bitrate.targetEncoded),Ih(r,Ir.ACTUAL_ENCODED,e.bitrate.actualEncoded),Ih(r,Ir.TRANSMIT,e.bitrate.transmit),Ih(r,Ir.BANDWIDTH,e.sendBandwidth)),r}(e,r))}else a=function(e,t,r,i){let n=t.videoSend.find(t=>t.ssrc===e);if(!n)return;let o={};if(i){let t=n.sentFrame;if(t&&(Ih(o,Ii.HEIGHT,t.height),Ih(o,Ii.WIDTH,t.width),Ih(o,Ii.FRAME_RATE,t.frameRate)),r){let t=r.videoSend.find(t=>t.ssrc===e);if(t){let e=6e3;t.timestamp&&n.timestamp&&(e=n.timestamp-t.timestamp),null!=t.packets&&null!=n.packets&&Ih(o,Ii.PACKAGE_RATE,1e3*(n.packets-t.packets)/e),null!=n.packetsLost&&null!=t.packetsLost&&Ih(o,Ii.PACKAGE_LOST,n.packetsLost-t.packetsLost),null!=t.bytes&&null!=n.bytes&&Ih(o,Ii.BITRATE,8*(n.bytes-t.bytes)/e)}}}return o}(u[0].ssrcId,e,t,r);break;case TD.LocalAudioTrack:n=d&&function(e,t,r,i,n){let o=t.audioSend.find(t=>t.ssrc===e);if(!o)return;let a={};if(n){a[Is.DISABLED]=i._originMediaStreamTrack&&!i._originMediaStreamTrack.enabled||i._mediaStreamTrack&&!i._mediaStreamTrack.enabled?1:0;let t=100*i._source.getAccurateVolumeLevel(),n=o.inputLevel;if(null!=n){let e=Math.ceil(50*Math.log10(100*n+1));Ih(a,Is.LEVEL,e)}Ih(a,Ia.PCM_LEVEL,t),Ih(a,Is.AEC_RETURN_LOSS,o.aecReturnLoss),Ih(a,Is.AEC_RETURN_LOSS_ENH,o.aecReturnLossEnhancement),Ih(a,Is.BYTES_RETRANSMIT,o.retransmittedBytesSent),Ih(a,Is.PACKAGES_RETRANSMIT,o.retransmittedPacketsSent),a[Is.FREEZE]=0;let s=r&&r.audioSend.find(t=>t.ssrc===e);if(s){let e=6e3;s.timestamp&&o.timestamp&&(e=o.timestamp-s.timestamp),null!=s.bytes&&null!=o.bytes&&Ih(a,Is.BITRATE,8*(o.bytes-s.bytes)/e),null!=s.packets&&null!=o.packets&&Ih(a,Is.PACKAGE_RATE,1e3*(o.packets-s.packets)/e)}}return a}(u[0].ssrcId,e,t,d,r)}}),{high:o,low:a,audio:n}}getInboundStats(e,t,r,i){if(!this.requestRemoteMedia)return;let n=this.requestRemoteMedia()||[],o=[];return n.forEach(n=>{let[a,s]=n,c={peer:a.uid};if(s.has(Tw.VIDEO)&&a.videoTrack){let n=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,o=a.videoTrack?function(e,t,r,i,n,o,a,s){let c=t.videoRecv.find(t=>t.ssrc===e);if(!c)return;let d={},{receivedFrame:u,outputFrame:l,decodeFrameRate:h}=c,p=r&&r.videoRecv.find(t=>t.ssrc===e);if(Ih(d,Io.FRAME_RATE_DECODE,h),c.framesRateFirefox&&Ih(d,In.FRAME_RATE,c.framesRateFirefox),u&&Ih(d,In.FRAME_RATE,u.frameRate),Ih(d,In.FRAMES_DROPPED,c.framesDroppedCount),Ih(d,In.BYTES_RETRANSMIT,c.retransmittedBytesReceived),Ih(d,In.PACKAGES_RETRANSMIT,c.retransmittedPacketsReceived),Ih(d,In.PACKAGES_DISCARDED,c.packetsDiscarded),Ih(d,In.AVG_DECODE,c.avgDecodeMs),Ih(d,In.AVG_PROCESSING_DELAY,c.avgProcessingDelayMs),Ih(d,In.AVG_ASSEMBLY_TIME,c.avgFramesAssembledFromMultiplePacketsMs),Ih(d,In.AVG_INTER_FRAME_DELAY,c.avgInterFrameDelayMs),Ih(d,In.KEY_FRAMES_DECODED,c.keyFramesDecoded),p){let e=t.timestamp-r.timestamp||1e3*(s?6:a?3:1);null!=c.packetsLost&&null!=p.packetsLost&&Ih(d,In.PACKAGE_LOST,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&Ih(d,In.BITRATE,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&Ih(d,In.PACKAGE_RATE,1e3*(c.packets-p.packets)/e)}if(s&&(Ih(d,In.QP_SUM,c.qpSumPerFrame),d[In.FREEZE]=n&&RU.isRemoteVideoFreeze(i,c,p)?1:0),a){var f;u?(Ih(d,In.HEIGHT,u.height),Ih(d,In.WIDTH,u.width)):i&&(Ih(d,In.HEIGHT,i._videoHeight||0),Ih(d,In.WIDTH,i._videoWidth||0)),l&&Ih(d,Io.FRAME_RATE_OUTPUT,l.frameRate);let e=null===(f=i._player)||void 0===f?void 0:f.rendFrameRate.toFixed(0);if(e&&Ih(d,Io.FRAME_RATE_RENDER,+e),Ih(d,In.JITTER_BUFFER,c.jitterBufferMs),Ih(d,In.CURRENT_DELAY,c.currentDelayMs),Ih(d,In.FIRS,c.firsCount),Ih(d,In.NACKS,c.nacksCount),Ih(d,In.PLIS,c.plisCount),i){d[In.DISABLED]=i._originMediaStreamTrack.enabled&&i._mediaStreamTrack.enabled?0:1;let e=i._player;if(e){let{freezeTimeCounterList:t,renderFreezeAccTime:r,videoElementStatus:i}=e;if(t&&t.length>0&&Ih(d,Io.FREEZE_TIME,t.splice(0,1)[0]),o&&"visible"===br.visibility&&i===g7.PLAYING&&gR.supportRequestVideoFrameCallback){let t=Math.min(6e3,r);e.renderFreezeAccTime=Math.max(0,r-t),Ih(d,Io.FREEZE_TIME_RENDER,t)}if("number"==typeof c.totalFreezesDuration){let e=p&&p.totalFreezesDuration?c.totalFreezesDuration-p.totalFreezesDuration:c.totalFreezesDuration;Ih(d,Io.FREEZE_DURATION,1e3*e)}}}if(d[In.PLAYER_STATUS]=St[i._player?i._player.videoElementStatus:"uninit"],p&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==p.totalInterFrameDelay&&void 0!==p.totalSquaredInterFrameDelay){let e=c.totalInterFrameDelay-p.totalInterFrameDelay,t=c.totalSquaredInterFrameDelay-p.totalSquaredInterFrameDelay,r=c.framesDecodeCount-p.framesDecodeCount,i=e/r*1e3,n=Math.round(1e3*Math.sqrt((t-Math.pow(e,2)/r)/r));!isNaN(n)&&i+n>Math.max(3*i,i+150)&&(d[In.I_FRAME_DELAY]=n)}}return d}(a._videoSSRC,e,t,a.videoTrack,!0===n,this.needUploadRenderFreezeTime,r,i):void 0;o&&(c.video=o)}if(s.has(Tw.AUDIO)&&a.audioTrack){let n=a.audioTrack?function(e,t,r,i,n,o){let a=t.audioRecv.find(t=>t.ssrc===e);if(!a)return;let s={},c=r&&r.audioRecv.find(t=>t.ssrc===e);if(Ih(s,Ic.JITTER,a.jitterMs),Ih(s,Ic.BYTES_RETRANSMIT,a.retransmittedBytesReceived),Ih(s,Ic.PACKAGES_RETRANSMIT,a.retransmittedPacketsReceived),Ih(s,Ic.PACKAGES_DISCARDED,a.packetsDiscarded),Ih(s,Ic.AVG_PROCESSING_DELAY,a.avgProcessingDelayMs),c){let e=t.timestamp-r.timestamp||1e3*(o?6:n?3:1);null!=a.packets&&null!=c.packets&&Ih(s,Ic.PACKAGE_RATE,1e3*(a.packets-c.packets)/e),n&&null!=c.bytes&&null!=a.bytes&&Ih(s,Ic.BITRATE,8*(a.bytes-c.bytes)/e),null!=a.packetsLost&&null!=c.packetsLost&&Ih(s,Ic.PACKAGE_LOST,a.packetsLost-c.packetsLost)}if(o){let{receivedFrames:e,droppedFrames:t}=a;null!=e&&null!=t&&(s[Ic.FREEZE]=0===e||100*t/e>20?1:0)}if(n){let e=100*i._source.getAccurateVolumeLevel(),t=a.outputLevel;if(null!=t){let e=Math.ceil(50*Math.log10(100*t+1));Ih(s,Id.LEVEL,e)}if(Ih(s,Ic.PCM_LEVEL,e),i&&(s[Ic.DISABLED]=i._originMediaStreamTrack.enabled&&i._mediaStreamTrack.enabled?0:1),Ih(s,Ic.JITTER_BUFFER,a.jitterBufferMs),Ih(s,Ic.CURRENT_DELAY,a.jitterBufferMs),s[Ic.PLAYER_STATUS]=St[SM.getPlayerState(i.getTrackId())],c){let e=a.concealedSamples-c.concealedSamples;e>0&&Ih(s,Ic.CONCEALED_SAMPLES,e);let t=a.totalSamplesReceived-c.totalSamplesReceived;t>0&&Ih(s,Ic.TOTAL_SAMPLES_RECEIVED,t)}}return s}(a._audioSSRC,e,t,a.audioTrack,r,i):void 0;n&&(c.audio=n)}(c.video||c.audio)&&o.push(c)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find(e=>e instanceof SZ);if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(b9.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach(e=>{let[t,r]=e;r.has(Tw.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}),r.has(Tw.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let t=Date.now(),r={connectionInterval:E4("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t},i=[];for(let e of this.requestAllTracks&&this.requestAllTracks()||[])!e.muted&&e.enabled&&(i=i.concat(await e.getProcessorUsage()));for(let[e,t]of this.requestRemoteMedia&&this.requestRemoteMedia()||[])t.has(Tw.VIDEO)&&e.videoTrack&&(i=i.concat(await e.videoTrack.getProcessorUsage())),t.has(Tw.AUDIO)&&e.audioTrack&&(i=i.concat(await e.audioTrack.getProcessorUsage()));if(0===i.length)return;r.details=function(e,t){let r={};for(let{id:a,value:s,level:c,direction:d}of e){var i,n,o;let e=null!==(i=t.get(a))&&void 0!==i?i:0,u=2===s?e+E4("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;t.set(a,u),r[a]?(2===s&&(r[a].value=s),c>r[a].level&&(r[a].level=c),"remote"===d&&(r[a].remoteUidCount+=1),r[a].totalTs=null!==(n=t.get(a))&&void 0!==n?n:0):r[a]={value:s,level:c,remoteUidCount:"local"===d?0:1,totalTs:null!==(o=t.get(a))&&void 0!==o?o:0}}return Object.keys(r).map(e=>{let{level:t,value:i,totalTs:n}=r[e];return{id:e,level:t,value:i,totalTs:n}})}(i,e);let n=Date.now(),o=n>t?n:t+1;this.requestUpload&&this.requestUpload(b9.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:o})},E4("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let IA=E4("ICE_RESTART_INTERVAL"),Im=new Map,Iv=new Map,IE=[TO.UDP_TCP_RELAY,TO.TCP_RELAY,TO.RELAY],Ig=E4("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&gR.supportPCSetConfiguration;function IS(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Im.get(e.id);r&&(window.clearTimeout(r),Im.delete(e.id));let i=Iv.get(e.id);t&&i&&i.index===IE.length-1&&(gA.debug("[".concat(e.id,"] reset ICE restart policy")),Iv.delete(e.id))}function Ib(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function IT(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ib(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ib(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Iy(e){var t,r,i,n=2;for("undefined"!=typeof Symbol&&(r=ma,i=Symbol.iterator);n--;){if(r&&null!=(t=e[r]))return t.call(e);if(i&&null!=(t=e[i]))return new IR(t.call(e));r="@@asyncIterator",i="@@iterator"}throw TypeError("Object is not async iterable")}function IR(e){function t(e){if(Object(e)!==e)return dJ.reject(TypeError(e+" is not an object."));var t=e.done;return dJ.resolve(e.value).then(function(e){return{value:e,done:t}})}return(IR=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?dJ.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?dJ.reject(e):t(r.apply(this.s,arguments))}},new IR(e)}let II=(b$((rF=class extends vP{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(TM.StateChange,t,this._state)}constructor(e,t){super(),Aa(this,"isPlanB",void 0),Aa(this,"store",void 0),Aa(this,"statsUploader",void 0),Aa(this,"connection",void 0),Aa(this,"localTrackMap",new Map),Aa(this,"remoteUserMap",new Map),Aa(this,"localDataChannels",[]),Aa(this,"remoteDataChannelMap",new Map),Aa(this,"pendingLocalTracks",[]),Aa(this,"pendingRemoteTracks",[]),Aa(this,"pendingLocalDataChannels",[]),Aa(this,"pendingRemoteDataChannels",[]),Aa(this,"statsCollector",void 0),Aa(this,"shouldForwardP2PCreation",void 0),Aa(this,"iceFailedCount",0),Aa(this,"dtlsFailedCount",0),Aa(this,"mutex",void 0),Aa(this,"_state",TL.Disconnected),Aa(this,"_pcStatsUploadType",E4("NEW_ICE_RESTART")?TN.FIRST_CONNECTION:TN.OLD_FIRST_CONNECTION),Aa(this,"_isStartRestartIce",!1),Aa(this,"_restartTimer",void 0),Aa(this,"_isTryConnecting",!1),Aa(this,"_iceError",null),Aa(this,"_forceTurn",!1),Aa(this,"_isWaitPcToRePub",!1),Aa(this,"handleMuteLocalTrack",async(e,t,r)=>{let i=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==TL.Connected)return void r(new vm(vA.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let i=this.filterTobeMutedTracks(e);if(0===i.length)return void t();let n=i.find(e=>"videoLowTrack"===e[0]);n&&n[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(i.map(e=>{let[,{id:t}]=e;return t}));let o=this.createMuteMessage(i);await vz(this,TM.RequestMuteLocal,o),t()}catch(e){r(e)}finally{i()}}),Aa(this,"handleUnmuteLocalTrack",async(e,t,r)=>{let i=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==TL.Connected)return void r(new vm(vA.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let i=this.filterTobeUnmutedTracks(e);if(0===i.length)return void t();let n=i.find(e=>"videoLowTrack"===e[0]);if(n){let t=n[1];if(t.track._originMediaStreamTrack.stop(),!E4("DISABLE_DUAL_STREAM_USE_ENCODING")&&gR.supportDualStreamEncoding){let r=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r}else{let r=Ie(e,vJ(this,TM.RequestLowStreamParameter));t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r}await new dJ((e,r)=>{this.handleReplaceTrack(t.track,e,r,!0)})}await this.connection.unmuteLocal(i.map(e=>{let[,{id:t}]=e;return t}));let o=this.createUnmuteMessage(i);await vz(this,TM.RequestUnmuteLocal,o),t()}catch(e){r(e)}finally{i()}}),Aa(this,"handleUpdateVideoEncoder",async(e,t,r,i)=>{let n;i||(n=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let r=this.localTrackMap.get(TD.LocalVideoTrack);if(!this.connection||!r||r.track!==e||this.state!==TL.Connected)return void t();let{id:i,track:n}=r;await this.connection.updateSendParameters(i,n),await this.connection.updateEncoderConfig(i,n),this.emit(TM.UpdateVideoEncoder,n),t()}catch(e){r(e)}finally{var o;null===(o=n)||void 0===o||o()}}),Aa(this,"handleUpdateVideoSendParameters",async(e,t,r)=>{let i=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let r=this.localTrackMap.get(TD.LocalVideoTrack);if(!this.connection||!r||r.track!==e||this.state!==TL.Connected)return void t();let{id:i,track:n}=r;await this.connection.updateSendParameters(i,n),t()}catch(e){r(e)}finally{i()}}),Aa(this,"handleReplaceMixingTrack",async(e,t,r,i)=>{let n;if(!this.connection||this.state!==TL.Connected)return void t();let o=R2([e]);gA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),"boolean"==typeof i&&i||(n=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,o),t()}catch(e){r(e)}finally{var a;null===(a=n)||void 0===a||a()}}),Aa(this,"handleReplaceTrack",async(e,t,r,i)=>{var n,o;let a;gA.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof i&&i||(a=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{let r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(!this.connection||!r||this.state!==TL.Connected)return void t();if(await (null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(e,r[1].id)),this.isPlanB){let t=r[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(r[0],t)}if(r[0]===TD.LocalVideoTrack&&!E4("DISABLE_DUAL_STREAM_USE_ENCODING")&&gR.supportDualStreamEncoding){let t=this.localTrackMap.get(TD.LocalVideoLowTrack);if(t){let r=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r,await new dJ((e,r)=>{this.handleReplaceTrack(t.track,e,r,!0)})}}t()}catch(e){r(e)}finally{null===(o=a)||void 0===o||o()}}),Aa(this,"handleGetRTCStats",e=>{e(this.statsCollector.getRTCStats())}),Aa(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),Aa(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),Aa(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),Aa(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new I_(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ep("P2PChannel-mutex",this.store.clientId),this.isPlanB=!gR.supportUnifiedPlan||E4("CHROME_FORCE_PLAN_B")&&vu(),this.shouldForwardP2PCreation=E4("FORWARD_P2P_CREATION")&&gR.supportPCSetConfiguration&&vd(),this.shouldForwardP2PCreation&&(this.connection=R4(this.store),this.emit(TM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=TL.New,this._forceTurn=R3(e),gA.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let r=this.shouldForwardP2PCreation&&"closed"===(null===(t=this.connection)||void 0===t?void 0:t.peerConnectionState);if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(gA.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=R4(this.store,e),this.emit(TM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new vm(vA.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=E4("NEW_ICE_RESTART")?TN.FIRST_CONNECTION:TN.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new vm(vA.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");E4("ENABLE_PREALLOC_PC")&&this.state===TL.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=TL.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(e=>{var t;let[r]=e;return o0(t=[TD.LocalVideoLowTrack,TD.LocalVideoTrack]).call(t,r)}),r=t.map(e=>{let[,{id:t}]=e;return t}),i=t.map(e=>{let[t]=e;return t});if(this.connection instanceof R9){if(gT.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!o0(e).call(e,this.store.codec)){let t=["vp9","vp8","h264"].find(t=>o0(e).call(e,t));t&&(this.store.codec=t,gA.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof R9&&"closed"!==this.connection.peerConnectionState&&o0(e=[TL.New,TL.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==TL.Connected){if(this.state===TL.Disconnected)throw new vm(vA.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(e=>{var t;o0(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)}),[]}let t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach(e=>{let t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(e=>{this.localDataChannels.push(e);let t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)}),e.map(e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId})))}publish(e,t,r){var i=this;return mi(function*(){let n=yield mn(i.mutex.lock("From P2PChannel.publish"));try{var o;let n=i.connection&&o0(o=["disconnected","failed"]).call(o,i.connection.peerConnectionState);if(!i.connection||i.state!==TL.Connected||n){if(i.state===TL.Disconnected)throw new vm(vA.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);let t=e.filter(e=>-1===i.pendingLocalTracks.indexOf(e));return i.pendingLocalTracks=i.pendingLocalTracks.concat(t),void(n&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,RL.markPublishStart(i.store.clientId,i.store.pubId);let a=i.filterTobePublishedTracks(e,t,r);if(0===a.length)return void(yield mn(i.tryToUnmuteAudio(e)));yield*mo(Iy(i.doPublish(i.connection,a)))}finally{n()}})()}doPublish(e,t){var r=this;return mi(function*(){let i;t.forEach(e=>{let{track:t,type:i}=e,n=Date.now();r.store.publish(t.getTrackId(),i===TD.LocalAudioTrack?"audio":"video",n)}),r.bindLocalTrackEvents(t);let n=t.map(e=>{let{track:t}=e;return t}),o=yield mn(e.send(n,r.store.codec,r.store.audioCodec)),a=(yield mn(o.next())).value,s=r.createGatewayPublishMessage(t,a);try{i=yield s}catch(e){throw o.throw(e),(null==e?void 0:e.code)===vA.WS_ABORT&&t.forEach(e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)}),r.unbindLocalTrackEvents(t),e}let c=r.mapPubResToRemoteConfig(s,i,n),d=(yield mn(o.next(c))).value;if(r.state===TL.Disconnected)throw new vm(vA.UNEXPECTED_ERROR,"PeerConnection already disconnected.");E4("ENABLE_VIDEO_SEI");let u=E4("ENABLE_ENCODED_TRANSFORM"),l=E4("ENABLE_AUDIO_METADATA");n.forEach(async e=>{let t=e.getRTCRtpTransceiver();if(!t||!u)return;let{interceptLocalVideoFrame:r,interceptLocalAudioFrame:i}=yZ();e.trackMediaType===Tw.VIDEO?await r(t.sender,e):e.trackMediaType===Tw.AUDIO&&await i(t.sender,{metadata:l?()=>{let t=e.metadata.shift();return t&&t.value}:void 0})}),t.forEach(e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)}),r.assignLocalTracks(t,d),r.statsUploader.startUploadOutboundStats(),t.forEach(e=>{let{track:t,type:i}=e,n=Date.now();r.store.publish(t.getTrackId(),i===TD.LocalAudioTrack?"audio":"video",void 0,n)})})()}async updateVideoStreamParameter(e,t){let r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof S8))return gA.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:i}=r,n=function(e,t){let r={};return e.height&&e.width&&(r.scaleResolutionDownBy=yp(e,t)),r.maxFramerate=e.framerate?yc(e.framerate):void 0,r.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,r}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==TD.LocalVideoLowTrack||!E4("DISABLE_DUAL_STREAM_USE_ENCODING")&&gR.supportDualStreamEncoding)null!=n.scaleResolutionDownBy&&(i._encoderConfig.scaleResolutionDownBy=n.scaleResolutionDownBy);else{let t=i._originMediaStreamTrack;if(!t.canvas)return gA.warn("[".concat(i.getTrackId(),"] no canvas on track"));!function(e,t){let r=e.canvas;t.width&&(r.width=yc(t.width)),t.height&&(r.height=yc(t.height)),t.framerate&&(r.stopCapture&&r.stopCapture(),r.stopCapture=S_(()=>{!r.startCapture&&r.stopCapture&&r.stopCapture(),r.startCapture&&r.startCapture()},yc(t.framerate)))}(t,e)}null!=n.maxBitrate&&(i._encoderConfig.bitrateMax=n.maxBitrate/1e3),null!=n.maxFramerate&&(i._encoderConfig.frameRate&&"object"==typeof i._encoderConfig.frameRate?i._encoderConfig.frameRate.max=n.maxFramerate:i._encoderConfig.frameRate={max:n.maxFramerate}),gA.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return mi(function*(){if(!t.connection||t.state!==TL.Connected)return;let r=yield mn(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let r=t.localTrackMap.get(TD.LocalVideoTrack);if(!r)throw new vm(vA.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(TD.LocalVideoLowTrack))throw new vm(vA.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let n=[{track:t.getLowVideoTrack(r.track,e),type:TD.LocalVideoLowTrack}];if(yield*mo(Iy(t.doPublish(t.connection,n))),r.track.muted||!r.track.enabled){var i;let e=null===(i=t.localTrackMap.get(TD.LocalVideoLowTrack))||void 0===i?void 0:i.id;void 0!==e&&(yield mn(t.connection.muteLocal([e])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(gA.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await vQ(this,TM.RequestRePublish,this.pendingLocalTracks),this.emit(TM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(gA.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await vQ(this,TM.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){let{user:t,kind:r}=this.pendingRemoteTracks[e];(r!==Tw.AUDIO||t._audio_added_&&t._audioSSRC)&&(r!==Tw.VIDEO||t._video_added_&&t._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(e)await vQ(this,TM.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:e,kind:t}of this.pendingRemoteTracks)await this.subscribe(e,t,t===Tw.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(TM.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==TL.Connected)return void e.forEach(e=>{let t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)});let t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;let r=t.find(e=>"videoLowTrack"===e[0]);return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==TL.Connected)return void e.forEach(e=>{let t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)});let t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach(e=>{let t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)}),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map(e=>e.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==TL.Connected)return;let e=this.localTrackMap.get(TD.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[TD.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:r}]=e;return{type:t,track:r}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==TL.Connected)throw new vm(vA.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r=t.filter(t=>{var r;return!(null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.get(t.id))});if(0!==r.length)return await this.connection.createDataChannels(e.uid,r),r.forEach(t=>{var r;this.remoteDataChannelMap.has(e)?null===(r=this.remoteDataChannelMap.get(e))||void 0===r||r.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));let i=this.pendingRemoteDataChannels.findIndex(r=>{let{user:i,id:n}=r;return i.uid===e.uid&&n===t.id});-1!==i&&this.pendingRemoteDataChannels.splice(i,1)}),r.map(e=>e.id)}async subscribe(e,t,r,i,n){var o;let a,s,c;if(!this.connection||this.state!==TL.Connected)throw new vm(vA.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let d=this.connection.getPreMedia(r);if(d)gA.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),c=d.transceiver,a=d.track,s=d.id;else if(n){let r=n.find(e=>{let{stream_type:r}=e;return r===t});if(!r)throw new vm(vA.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let i=await this.connection.receive(t,r.ssrcs,String(e._uintid),r.attributes);this.connection instanceof R9&&(c=i.transceiver),a=i.track,s=i.id}else{let n=await this.connection.receive(t,[{ssrcId:r,rtx:i}],String(e._uintid),void 0);this.connection instanceof R9&&(c=n.transceiver),a=n.track,s=n.id}if(t===Tw.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new bt(a,e.uid,e._uintid,this.store),gA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new be(a,e.uid,e._uintid,this.store),gA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&E4("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:r,interceptRemoteAudioFrame:i}=yZ();t==Tw.VIDEO?await r(c.receiver,{onSei:E4("ENABLE_VIDEO_SEI")&&(t=>{var r;return null===(r=e._videoTrack)||void 0===r?void 0:r._onSei(t)})}):t==Tw.AUDIO&&await i(c.receiver,{enableTopn:!!E4("ENABLE_AUDIO_TOPN"),enableMetadata:!!E4("ENABLE_AUDIO_METADATA"),onMetadata:e=>{this.safeEmit(TM.AudioMetadata,e)}})}let u=this.remoteUserMap.get(e);u?u.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let l=this.pendingRemoteTracks.findIndex(r=>{let{user:i,kind:n}=r;return i.uid===e.uid&&t===n});-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(TM.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==TL.Connected)throw new vm(vA.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(e=>{var t;let{user:r,mediaType:i}=e;return!(null!==(t=this.remoteUserMap.get(r))&&void 0!==t&&t.has(i))});let t=[],r=new Map;e.forEach(e=>{if(!this.connection)return;let i=this.connection.getPreMedia(e.ssrcId);i?r.set(e.ssrcId,i):t.push(e)});let i=await this.connection.batchReceive(t.map(e=>{let{user:t,mediaType:r,ssrcId:i,rtxSsrcId:n}=e;return{kind:r,ssrcMsg:[{ssrcId:i,rtx:n}],mslabel:String(t._uintid)}}));for(let{user:n,mediaType:o,ssrcId:a}of(t.forEach((e,t)=>{r.set(e.ssrcId,i[t])}),e)){let e=r.get(a);if(!e)return void gA.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(n.uid," subscribe data,").concat(o,", ").concat(a));let{track:t,id:i,transceiver:s}=e;if(s&&E4("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=yZ();o==Tw.VIDEO?await e(s.receiver,{onSei:E4("ENABLE_VIDEO_SEI")&&(e=>{var t;return null===(t=n._videoTrack)||void 0===t?void 0:t._onSei(e)})}):o==Tw.AUDIO&&await t(s.receiver,{enableTopn:!!E4("ENABLE_AUDIO_TOPN"),enableMetadata:!!E4("ENABLE_AUDIO_METADATA"),onMetadata:e=>{this.safeEmit(TM.AudioMetadata,e)}})}if(o===Tw.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(t):(n._audioTrack=new bt(t,n.uid,n._uintid,this.store),gA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),s&&n._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(t):(n._videoTrack=new be(t,n.uid,n._uintid,this.store),gA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),s&&n._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(n,n._videoTrack)),E4("ENABLE_VIDEO_SEI")&&s){let{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=yZ();o==Tw.VIDEO?await e(s.receiver,{onSei:e=>{var t;null===(t=n._videoTrack)||void 0===t||t._onSei(e)}}):o==Tw.AUDIO&&await t(s.receiver)}let c=this.remoteUserMap.get(n);c?c.set(o,i):this.remoteUserMap.set(n,new Map([[o,i]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats();let d=this.pendingRemoteTracks.findIndex(e=>{let{user:t,kind:r}=e;return t.uid===n.uid&&o===r});-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(TM.MediaReconnectEnd,n.uid))}}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(r=>{let{user:i,kind:n}=r;return void 0!==t?i.uid===e.uid&&t===n:i.uid===e.uid});if(i.forEach(e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.connection&&this.state===TL.Connected||r||i.forEach(t=>{var r,i;let{kind:n}=t;n===Tw.AUDIO?(null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0):n===Tw.VIDEO&&(null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0)}),!this.connection||this.state!==TL.Connected)return;let n=this.filterTobeUnSubscribedTracks(e,t);if(0===n.length)return;await this.connection.stopReceiving(n.map(e=>{let[,{id:t}]=e;return t}));let o=this.createUnsubscribeMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach(e=>{var t,i,n;let[o,{kind:a}]=e;a===Tw.VIDEO&&o._videoSSRC&&(null===(t=this.connection)||void 0===t||t.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===Tw.VIDEO?(this.unbindRemoteTrackEvents(o._videoTrack),r||(null===(i=o._videoTrack)||void 0===i||i._destroy(),o._videoTrack=void 0)):a===Tw.AUDIO&&(this.unbindRemoteTrackEvents(o._audioTrack),!r&&(null===(n=o._audioTrack)||void 0===n||n._destroy(),o._audioTrack=void 0))}),o}async unsubscribeDataChannel(e,t){if(t.forEach(e=>{let t=this.pendingRemoteDataChannels.findIndex(t=>t.id===e.id);-1!==t&&this.pendingRemoteDataChannels.splice(t,1)}),!this.connection)return;let r=this.filterTobeUnSubscribedDataChannels(e,t);if(0===r.length)return;t.forEach(e=>{e._close()});let i=this.remoteDataChannelMap.get(e);return r.forEach(e=>{i&&i.delete(e.id)}),i&&0===i.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(e=>e.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:r,mediaType:i}of e){let e=this.pendingRemoteTracks.filter(e=>{let{user:t,kind:n}=e;return void 0!==i?t.uid===r.uid&&i===n:t.uid===r.uid});e.forEach(e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),t=t.concat(e)}if(!this.connection||this.state!==TL.Connected)return void t.forEach(e=>{var t,r;let{user:i,kind:n}=e;n===Tw.AUDIO?(null===(t=i._audioTrack)||void 0===t||t._destroy(),i._audioTrack=void 0):n===Tw.VIDEO&&(null===(r=i._videoTrack)||void 0===r||r._destroy(),i._videoTrack=void 0)});let r=ae(e).call(e,(e,t)=>{let{user:r,mediaType:i}=t,n=this.filterTobeUnSubscribedTracks(r,i);return e.concat(n)},[]);if(0===r.length)return;await this.connection.stopReceiving(r.map(e=>{let[,{id:t}]=e;return t}));let i=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),r.forEach(e=>{var t,r,i;let[n,{kind:o}]=e;o===Tw.VIDEO&&n._videoSSRC&&(null===(t=this.connection)||void 0===t||t.setStatsRemoteVideoIsReady(n._videoSSRC,!1)),o===Tw.VIDEO?(this.unbindRemoteTrackEvents(n._videoTrack),null===(r=n._videoTrack)||void 0===r||r._destroy(),n._videoTrack=void 0):o===Tw.AUDIO&&(this.unbindRemoteTrackEvents(n._audioTrack),null===(i=n._audioTrack)||void 0===i||i._destroy(),n._audioTrack=void 0)}),i}isPreSubScribe(e){return!!this.connection&&this.state===TL.Connected&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void gA.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void gA.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===Tw.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==i&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void gA.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||gA.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(TD.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(TD.LocalAudioTrack);if((null==t?void 0:t.track)instanceof S0){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==TD.LocalAudioTrack}).filter(t=>{let[r]=t;return!(e&&r===TD.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[r]=t;return!(e&&r===TD.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,i,n){if(e){let r=this.localTrackMap.get(TD.LocalAudioTrack),o=i?this.localTrackMap.get(TD.LocalVideoLowTrack):this.localTrackMap.get(TD.LocalVideoTrack);gT.publish(this.store.sessionId,{eventElapse:RL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==r?void 0:r.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(gY.SCREEN_TRACK)),audio:!!r,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var o;r||(r=[]);let a=r.find(e=>e instanceof Sq),s=i?null===(o=this.localTrackMap.get(TD.LocalVideoTrack))||void 0===o?void 0:o.track:r.find(e=>e instanceof S8);gT.publish(this.store.sessionId,{eventElapse:RL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(gY.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,r,i){let n=i===Tw.VIDEO?r._videoSSRC:r._audioSSRC;n&&gT.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Tw.VIDEO,audio:i===Tw.AUDIO,peerid:r.uid,subscribeRequestid:n,p2pid:this.store.p2pId,eventElapse:RL.measureFromSubscribeStart(this.store.clientId,n),preSsrc:this.isPreSubScribe(n)})}reset(){gA.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ep("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=R4(this.store),this.emit(TM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(TD.LocalAudioTrack);if((null==e?void 0:e.track)instanceof S0){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=TL.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(TD.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(TD.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof S8||t&&t.track instanceof Sq?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(go(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(TD.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=pM(e).call(e,(e,t)=>e.level-t.level)}async disconnectForReconnect(){this.connection&&(gA.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=TL.Reconnecting,E4("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{var t;let[r]=e;r._videoTrack&&r._videoTrack._player&&(null===(t=r._videoTrack._player.getVideoElement())||void 0===t||t.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=R4(this.store),this.emit(TM.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:i}]=e;switch(r){case TD.LocalVideoTrack:o0(t=i._hints).call(t,gY.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case TD.LocalAudioTrack:i instanceof S0?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case TD.LocalVideoLowTrack:}}),this.emit(TM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(go(r).call(r)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(TM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(go(r).call(r)).forEach(e=>{this.setPendingRemoteDataChannel(t,e)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),gA.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let r of this.pendingRemoteDataChannels){let{user:i,id:n}=r;if((e instanceof RF?e.uid:e)===i.uid&&n===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:n}=r;if((e instanceof RF?e.uid:e)===i.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return mi(function*(){let r;if(!t.connection||t.state!==TL.Connected)return;let i=yield mn(t.mutex.lock("From P2PChannel.restartICE"));try{r=yield mn(t.connection.restartICE(e));let i=yield mn(r.next());if(i.done)return;let n=i.value,o=yield n;switch(R6(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case TO.UDP_TCP_RELAY:t._pcStatsUploadType=TN.UDP_TCP_RESTART;break;case TO.TCP_RELAY:t._pcStatsUploadType=TN.TCP_RESTART;break;case TO.RELAY:t._pcStatsUploadType=TN.RELAY_RESTART;break;default:t._pcStatsUploadType=TN.OLD_RESTART}t._isTryConnecting=!0,r.next(o)}catch(e){var n;null===(n=r)||void 0===n||n.throw(e)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(TD.LocalVideoTrack),r=this.localTrackMap.get(TD.LocalAudioTrack),i=e.videoSend.find(e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)),n=e.audioSend.find(e=>e.ssrc===(null==r?void 0:r.ssrcs[0].ssrcId));if(!i||!n)return 1;let o=vX(this,TM.NeedSignalRTT),a=i?i.rttMs:void 0,s=n?n.rttMs:void 0,c=a&&s?(a+s)/2:a||s,d=100*e.sendPacketLossRate*.7/50+.3*((c&&o?(c+o)/2:c||o)||0)/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,l=null==t?void 0:t.track;if(l&&l._encoderConfig&&-1===l._hints.indexOf(gY.SCREEN_TRACK)){let t=l._encoderConfig.bitrateMax,r=e.bitrate.actualEncoded;if(t&&r){let e=(1e3*t-r)/(1e3*t);return bP[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,n=i._audioSSRC,o=i._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===n),s=e.videoRecv.find(e=>e.ssrc===o);if(!a&&!s)return void(t+=1);let c=vX(this,TM.NeedSignalRTT),d=e.rtt,u=(d&&c?(d+c)/2:d||c)||0,l=a?a.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*u/1500;l&&(p=.6*h*100/50+.2*u/1500+.2*l/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new dJ((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(gA.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==TL.Connected)return;let i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(!i)return;let n=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:n}]),this.bindLocalTrackEvents([{track:t,type:n}]),i[1].track=t),await (null===(r=this.connection)||void 0===r?void 0:r.replaceTrack(t,i[1].id)),this.isPlanB){let e=i[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(n,e)}if(n===TD.LocalVideoTrack&&!E4("DISABLE_DUAL_STREAM_USE_ENCODING")&&gR.supportDualStreamEncoding){let t=this.localTrackMap.get(TD.LocalVideoLowTrack);if(t){let r=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r,await new dJ((e,r)=>{this.handleReplaceTrack(t.track,e,r,!0)})}}}filterTobePublishedTracks(e,t,r){let i=[],n=this.getAllTracks();e=v$(e=e.filter(e=>-1===n.indexOf(e)));let o,a=!1,s=this.localTrackMap.get(TD.LocalAudioTrack);for(let n of e){if(n instanceof S8&&(this.localTrackMap.has(TD.LocalVideoTrack)||a?new vm(vA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:n,type:TD.LocalVideoTrack}),a=!0),t)){let e=this.getLowVideoTrack(n,r);i.push({track:e,type:TD.LocalVideoLowTrack})}if(n instanceof Sq){if(s){let e=s.track;if(e instanceof S0)R0([n]),e.addAudioTrack(n),this.bindLocalAudioTrackEvents(n,!0);else{let t=R2([e,n]);gA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else o instanceof S0?(R0([n]),o.addAudioTrack(n)):o=o||!n._useAudioElement&&gR.webAudioMediaStreamDest&&!n._bypassWebAudio?R2(o?[n,o]:[n]):n}}return o&&(gA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),i.push({track:o,type:TD.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();for(let i of e=v$(e=e.filter(e=>-1!==r.indexOf(e)))){if(i instanceof Sq){let e=this.localTrackMap.get(TD.LocalAudioTrack);if(!e)continue;e.track instanceof S0?(e.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),0===e.track.trackList.length&&(t.push([TD.LocalAudioTrack,e]),e.track.close())):t.push([TD.LocalAudioTrack,e])}if(i instanceof S8){let e=this.localTrackMap.get(TD.LocalVideoTrack);if(!e)continue;t.push([TD.LocalVideoTrack,e]);let r=this.localTrackMap.get(TD.LocalVideoLowTrack);r&&t.push([TD.LocalVideoLowTrack,r])}}return t}filterTobePublishedDataChannels(e){return e=(e=v$(e)).filter(e=>-1===this.localDataChannels.findIndex(t=>t.id===e.id))}filterTobeUnpublishedDataChannels(e){return e=(e=(e=v$(e)).filter(e=>-1!==this.localDataChannels.indexOf(e))).filter(e=>e._originDataChannel)}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:r}=e;switch(r){case TD.LocalVideoTrack:t.addListener(gH.GET_STATS,this.handleGetLocalVideoStats),t.addListener(gH.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(gH.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(gH.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(gH.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case TD.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case TD.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof S0?e.trackList.forEach(e=>{e.addListener(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gH.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(gH.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(gH.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(gH.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:r}]=e;return{track:r,type:t}})),e.forEach(e=>{let{track:t,type:r}=e;switch(r){case TD.LocalVideoTrack:t.off(gH.GET_STATS,this.handleGetLocalVideoStats),t.off(gH.GET_RTC_STATS,this.handleGetRTCStats),t.off(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(gH.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(gH.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(gH.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case TD.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case TD.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof S0?e.trackList.forEach(e=>{e.off(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gH.GET_STATS,this.handleGetLocalAudioStats),e.off(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(gH.GET_STATS,this.handleGetLocalAudioStats),e.off(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gH.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(gH.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof be&&t.addListener(gH.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof bt&&t.addListener(gH.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(gH.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Tw.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Tw.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,r)=>{var i;let n,o,{track:a,type:s}=e;switch(s){case TD.LocalAudioTrack:n=Tm.Audio,o={dtx:a instanceof SZ&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case TD.LocalVideoTrack:n=o0(i=a._hints).call(i,gY.SCREEN_TRACK)?Tm.Screen:Tm.High,o=IT(IT({},yd(a)),{},{codec:this.store.codec,svc_mode:y_()});break;case TD.LocalVideoLowTrack:n=Tm.Low,o=IT(IT({},yd(a)),{},{codec:this.store.codec,svc_mode:y_()})}return{stream_type:n,attributes:o,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let r,[i,{track:n,ssrcs:o,id:a}]=e;switch(i){case TD.LocalVideoTrack:r=o0(t=n._hints).call(t,gY.SCREEN_TRACK)?Tm.Screen:Tm.High;break;case TD.LocalAudioTrack:r=Tm.Audio;break;case TD.LocalVideoLowTrack:r=Tm.Low}return{stream_type:r,ssrcs:o,mid:a}})}assignLocalTracks(e,t){e.forEach((e,r)=>{let{track:i,type:n}=e;this.localTrackMap.set(n,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(TM.PeerConnectionStateChange,t),"connecting"===t&&e instanceof R9&&!m1()&&E4("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{"connecting"===t&&e.extendCandidate()},E4("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof R9&&IS(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=TN.DISCONNECTED_OR_FAILED,"CONNECTED"===vX(this,TM.QueryClientConnectionState)&&this._isWaitPcToRePub)){let e=this.pendingLocalTracks.map(e=>e.getTrackId()),t=this.pendingLocalDataChannels.map(e=>"dc_".concat(e.id));gT.reportApiInvoke(this.store.sessionId,{name:vM.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:vx.TRACER}).onSuccess(),this.republish()}if(E4("NEW_ICE_RESTART")&&e instanceof R9&&!m1()&&!this._forceTurn){if(o0(TP).call(TP,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let t=t=>{R6(e)&&(gA.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===vX(this,TM.QueryClientConnectionState)&&this.emit(TM.RequestRestartICE,t))},r=()=>{R6(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),gA.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(TM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{(function e(t,r,i){if(0===Im.size&&0===Iv.size&&(Array.isArray(E4("RESTART_SEQUENCE"))&&E4("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1){let i=e[r];if(e.filter(e=>e===i).length!==t.filter(e=>e===i).length)return!1}return!0}(IE,E4("RESTART_SEQUENCE"))&&(IE=E4("RESTART_SEQUENCE").filter(e=>{var t;if(o0(t=Object.values(TO)).call(t,e))return!0}),gA.debug("use reconnection policy from config distribution, queues: ".concat(IE.join(" => ")))),Ig=E4("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&gR.supportPCSetConfiguration),0===IE.length)return void i();let n,{index:o=0,type:a}=Iv.get(t.id)||{};if(Ig&&a===TO.RELAY)return void i();let s=a&&o>=IE.length-1;if(Ig)a=TO.RELAY;else{if(s)return void i();a?a=IE[++o]:(a=IE[0],o=0)}gA.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(a,", index: ").concat(o)),r(a),Iv.set(t.id,{index:o,type:a}),n=window.setTimeout(()=>e(t,r,i),IA),Im.set(t.id,n)})(e,t,r)},800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout(()=>{"disconnected"===e.iceConnectionState&&E4("ICE_RESTART")&&"CONNECTED"===vX(this,TM.QueryClientConnectionState)&&this.emit(TM.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===e.peerConnectionState&&(gA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(TM.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);"failed"===t&&(gA.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(TM.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),gT.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:vx.TRACER}).onSuccess(),this.emit(TM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t,r;let i=Array.from(go(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=i.audioTrack)||void 0===r||r.emit(gq.FIRST_FRAME_DECODED),gT.firstRemoteFrame(this.store.sessionId,gE.FIRST_AUDIO_DECODE,gg.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:RL.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;let r=Array.from(go(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);r&&gT.firstRemoteFrame(this.store.sessionId,gE.FIRST_AUDIO_RECEIVED,gg.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:RL.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,r)=>{this.reportVideoFirstFrameDecoded(e,t,r)},e.onFirstVideoReceived=e=>{var t;let r=Array.from(go(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);r&&gT.firstRemoteFrame(this.store.sessionId,gE.FIRST_VIDEO_RECEIVED,gg.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:RL.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{let r="relay"===e.candidateType,i="relay"===t.candidateType;"unknown"!==t.candidateType&&r===i||this.emit(TM.ConnectionTypeChange,r),gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(yf(t))," -> ").concat(JSON.stringify(yf(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(yf(t))," -> ").concat(JSON.stringify(yf(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return IT(IT({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){var t,r;e instanceof R9&&(t=e,Iv.delete(t.id),IS(t)),e.close(),this.emit(TM.PeerConnectionStateChange,"closed"),(r=e).onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0,this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(-1===this.getAllTracks().indexOf(e))return t;let r=this.localTrackMap.get(TD.LocalAudioTrack);if(e instanceof Sq&&(null==r?void 0:r.track)instanceof S0)return r.track.isActive||t.push([TD.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(i&&(t.push(i),i[0]===TD.LocalVideoTrack)){let e=this.localTrackMap.get(TD.LocalVideoLowTrack);e&&t.push([TD.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(TD.LocalAudioTrack);if(e instanceof Sq&&(null==r?void 0:r.track)instanceof S0)return r.track.isActive&&t.push([TD.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(i){if(i[0]===TD.LocalVideoTrack){t.push(i);let e=this.localTrackMap.get(TD.LocalVideoLowTrack);e&&t.push([TD.LocalVideoLowTrack,e])}else t.push(i)}return t}createMuteMessage(e){return e.map(e=>{var t;let r,[i,{track:n,ssrcs:o,id:a}]=e;switch(i){case TD.LocalAudioTrack:r=Tm.Audio;break;case TD.LocalVideoTrack:r=o0(t=n._hints).call(t,gY.SCREEN_TRACK)?Tm.Screen:Tm.High;break;case TD.LocalVideoLowTrack:r=Tm.Low}return{stream_type:r,ssrcs:o,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let r,[i,{track:n,ssrcs:o,id:a}]=e;switch(i){case TD.LocalAudioTrack:r=Tm.Audio;break;case TD.LocalVideoTrack:r=o0(t=n._hints).call(t,gY.SCREEN_TRACK)?Tm.Screen:Tm.High;break;case TD.LocalVideoLowTrack:r=Tm.Low}return{stream_type:r,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let n=i.get(t);if(!n)return r;r.push([e,{kind:t,id:n}])}else Array.from(i.entries()).forEach(t=>{let[i,n]=t;r.push([e,{kind:i,id:n}])});return r}filterTobeUnSubscribedDataChannels(e,t){let r=[];return t.forEach(t=>{var i;null!==(i=this.remoteDataChannelMap.get(e))&&void 0!==i&&i.has(t.id)&&r.push(t)}),r}createUnsubscribeMessage(e){let t=[];return e.forEach(e=>{let[r,{kind:i,id:n}]=e;switch(i){case Tw.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Tw.VIDEO,ssrcId:r._videoSSRC}));case Tw.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Tw.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(e=>{let[r,{kind:i}]=e;if(t.has(r)){let e=t.get(r);i===Tw.VIDEO?e|=Tg.Video:e|=Tg.Audio,t.set(r,e)}else i===Tw.VIDEO?t.set(r,Tg.Video):t.set(r,Tg.Audio)}),{users:Array.from(t.entries()).map(e=>{let[t,r]=e;return{stream_id:t.uid,stream_type:r}})}}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:r}]=e,i=this.remoteUserMap.get(t);i&&(i.delete(r),0===Array.from(i.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(TD.LocalVideoTrack),r=this.localTrackMap.get(TD.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new dJ((e,r)=>{this.handleUpdateVideoEncoder(t.track,e,r,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new dJ((e,t)=>{this.handleUpdateVideoEncoder(r.track,e,t,!0)}))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t,r){return e.map((e,i)=>{var n;let{stream_type:o}=e,a=null===(n=t.find(e=>{let{stream_type:t}=e;return o===t}))||void 0===n?void 0:n.attributes;if(a&&E4("DISABLE_SCREEN_SHARE_REMB")){let e=r[i]._hints;(o0(e).call(e,gY.SCREEN_TRACK)||o0(e).call(e,gY.SCREEN_LOW_TRACK))&&(a.remb=!1,gA.debug("disable remb for screen share, hints:",e))}return a})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Sq){var t;let i=this.filterTobeUnmutedTracks(e[r]);if(0===i.length)continue;await (null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(i.map(e=>{let[,{id:t}]=e;return t})));let n=this.createUnmuteMessage(i);return void await vz(this,TM.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(TM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(TM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Et(EA(this.dtlsFailedCount,E_)),this.emit(TM.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await vQ(this,TM.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(TM.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(TD.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof S8)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof S8).length>1)throw new vm(vA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof Sq).length>1&&(e.some(e=>e instanceof Sq&&e._bypassWebAudio)||!gR.webAudioMediaStreamDest))throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof S8&&this.pendingLocalTracks.some(e=>e instanceof S8))throw new vm(vA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Sq&&this.pendingLocalTracks.some(e=>e instanceof Sq)&&(!gR.webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof Sq&&e._bypassWebAudio)))throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;let i;let n=!E4("DISABLE_DUAL_STREAM_USE_ENCODING")&&gR.supportDualStreamEncoding,o=IT(IT({},{width:160,height:120,framerate:15,bitrate:50}),t);i=n?e._mediaStreamTrack.clone():Ie(e,o);let a=Er(8,"track-low-"),s=new S8(i,IT(IT({},n&&{scaleResolutionDownBy:yp(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,a);return s.on(gX.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,gK.LOW_STREAM)}),s._hints.push(gY.LOW_STREAM),o0(r=e._hints).call(r,gY.SCREEN_TRACK)&&s._hints.push(gY.SCREEN_LOW_TRACK),e.on("sei-to-send",e=>{s.emit("sei-to-send",e)}),e.addListener(gH.NEED_CLOSE,()=>{s.close()}),s}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof R9){var n,o,a,s;let c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:d,dtlsTransportState:u,peerConnectionState:l}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();gT.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:d,dtlsstate:u,connectionstate:l,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:null!==(n=null==h?void 0:h.protocol)&&void 0!==n?n:"",selectedLocalCandidateType:null!==(o=h.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(a=p.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(s=p.candidateType)&&void 0!==s?s:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,r,i){var n;let o=Array.from(go(n=this.remoteUserMap).call(n)).find(t=>t._videoSSRC===e);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let n=this.store.keyMetrics,a=n.subscribe.find(e=>e.userId===o.uid&&"video"===e.type);gT.firstRemoteVideoDecode(this.store.sessionId,gE.FIRST_VIDEO_DECODE,gg.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:r,subscribeElapse:RL.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:n.requestAPEnd||0,apStart:n.requestAPStart||0,joinGwEnd:n.joinGatewayEnd||0,joinGwStart:n.joinGatewayStart||0,pcEnd:n.peerConnectionEnd||0,pcStart:n.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:i?1:0,firstFrame:(null==a?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let n=i.get(t);if(!n)return!1;let o=await this.connection.getRemoteSSRC(n);return void 0!==o&&o!==r}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===TD.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,gK.LOW_STREAM):r._updateRtpTransceiver(void 0)})}}).prototype,"startP2PConnection",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"startP2PConnection"),rF.prototype),b$(rF.prototype,"connect",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"connect"),rF.prototype),b$(rF.prototype,"updateRemoteRTPCapabilities",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"updateRemoteRTPCapabilities"),rF.prototype),b$(rF.prototype,"publishDataChannel",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"publishDataChannel"),rF.prototype),b$(rF.prototype,"unpublish",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"unpublish"),rF.prototype),b$(rF.prototype,"unpublishDataChannel",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"unpublishDataChannel"),rF.prototype),b$(rF.prototype,"unpublishLowStream",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"unpublishLowStream"),rF.prototype),b$(rF.prototype,"subscribeDataChannel",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"subscribeDataChannel"),rF.prototype),b$(rF.prototype,"subscribe",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"subscribe"),rF.prototype),b$(rF.prototype,"massSubscribe",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"massSubscribe"),rF.prototype),b$(rF.prototype,"unsubscribe",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"unsubscribe"),rF.prototype),b$(rF.prototype,"unsubscribeDataChannel",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"unsubscribeDataChannel"),rF.prototype),b$(rF.prototype,"massUnsubscribe",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"massUnsubscribe"),rF.prototype),b$(rF.prototype,"muteRemote",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"muteRemote"),rF.prototype),b$(rF.prototype,"unmuteRemote",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"unmuteRemote"),rF.prototype),b$(rF.prototype,"hasRemoteMediaWithLock",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"hasRemoteMediaWithLock"),rF.prototype),b$(rF.prototype,"disconnectForReconnect",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"disconnectForReconnect"),rF.prototype),b$(rF.prototype,"updateBitrateLimit",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"updateBitrateLimit"),rF.prototype),b$(rF.prototype,"remoteMediaSsrcChanged",[IC],Object.getOwnPropertyDescriptor(rF.prototype,"remoteMediaSsrcChanged"),rF.prototype),rF);function IC(e,t,r){let i=e[t];if("function"!=typeof i)throw Error("Cannot use mutex on object property.");return r.value=async function(){let e=this.mutex,r=await e.lock("From P2PChannel.".concat(t));try{for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return await i.apply(this,o)}finally{r()}},r}function Ik(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function Iw(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ik(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ik(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let IO=Date.now(),IN=new Map,IP=new Map;async function ID(e){let t=IN.get(e),r=Array.isArray(t)&&t[t.length-1],i=IP.get(e);if(!r)return void(i.isSyncing=!1);let n={uid:r.uid,payload:r.payload};0===i.firstRecvTs&&(i.firstRecvTs=r.recvTs,i.firstSendTs=r.sendTs);let o=r.sendTs-i.firstSendTs,a=o-(Date.now()-i.firstRecvTs);a>0&&(i.firstRecvTs=Date.now()-o);let s=r.mediaDelay+a;s<=0?(t.pop(),IL(r.context,n),s=0):s=Math.min(s,20),setTimeout(()=>t.length&&ID(e),s)}function IL(e,t){e.safeEmit(vW.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}let IM=mz().name;function Ix(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function IU(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ix(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ix(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let IB="websdk_ng_cache_parameter",IV=E4("MAX_PRELOAD_ASYNC_LENGTH"),IF=new Map,Ij=[],IG=null,IW=0,IH=0,IY=new Map,IK=function(e,t){let r=[],i=0,n=async()=>{let e=r.shift();e&&await e(),r.length>0&&i<t?n():i--};return async function(){for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return new dJ(async(o,s)=>{r.push(async()=>{try{let t=await e(...a);o(t)}catch(e){s(e)}}),i<t&&(i++,n())})}}(Iz,IV),IQ=mU.CancelToken.source();async function Iz(e,t,r,i,n,o){try{let a,s;if(!E4("ENABLE_PRELOAD"))return;if(!gR.supportWebCrypto)return void v6(()=>{gA.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&null!==r)throw new vm(vA.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&vb(r,"token",1,2047),vb(e,"appid",1,2047),Tr(t),i&&Ti(i);let c=Ei();gA.debug("preload channel ".concat(t,", uid is ").concat(i));let d={appId:e,cname:t,token:r||e,uid:"string"!=typeof i?i:null,sid:c,proxyServer:n};"string"==typeof i?(d.stringUid=i,[s,a]=await dJ.all([RT(i,{sid:c,appId:e},IQ.token),RR(IU(IU({},d),{},{token:r||e,uid:0}),IQ.token)]),d.uid=s.uid,a.gatewayInfo.uid=d.uid,a.gatewayInfo.res.uid=d.uid):(o&&(d.stringUid=o),a=await RR(d,IQ.token));let u={sid:c,appId:e,cname:t,token:r||e,uid:d.stringUid||i,intUid:d.uid||a.gatewayInfo.uid,stringUid:d.stringUid,ts:Date.now(),sua:s,ap:a};await async function(e){let t;try{e.uid&&IJ({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});let r=I1(e),i=await async function(e,t){try{let r=await window.crypto.subtle.importKey("raw",v5(t),"AES-GCM",!1,["encrypt"]),i=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},r,v3(window.btoa(JSON.stringify(e))));return v8(new Uint8Array(i))}catch(e){return}}(e,e.token||e.appId);if(!i)return;let n=(t=I0(IB))?JSON.parse(t):[];n.push({[r]:i}),n.length>E4("AP_CACHE_NUM")&&n.shift(),I2(IB,JSON.stringify(n))}catch(e){gA.warn("Error caching server parameters:",e.message),I2(IB,"")}}(u),IW++}catch(e){throw IH++,function(e){IG||(IG=window.setTimeout(()=>{let t="";IY.forEach((e,r)=>{t+="".concat(r,": ").concat(e," ;")}),gT.reportApiInvoke(null,{name:vM.PRELOAD,options:{success:IW,failed:IH,err:t}}).onError(e),IW=0,IH=0,IY.clear(),IG=null},1e4));let t=IY.get(e.code)||0;IY.set(e.code,t+1)}(e),e}}async function IX(e){try{var t,r;if(E4("AP_REQUEST_DETAIL")||E4("ENABLE_ROLE_SELECT_EDGE"))return;let i=IJ(e);if(!i||"disabled"!==e.cloudProxyServer)return;let n=await async function(e,t){try{let r=await window.crypto.subtle.importKey("raw",v5(t),"AES-GCM",!1,["decrypt"]),i=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},r,v3(e));return JSON.parse(window.atob(v8(new Uint8Array(i))))}catch(e){return}}(i,e.token||e.appId);if(!n)return;if(t=n,r=e,t.cname!==r.cname||t.appId!==r.appId||t.token!==r.token||(r.stringUid?t.stringUid!==r.stringUid:"number"==typeof r.uid?t.uid!==r.uid:t.uid!=r.uid))return;if(n&&Date.now()-n.ts<E4("AP_CACHE_LIFETIME"))return n}catch(e){gA.warn("Error get preloadInfo",e.message)}}function IJ(e){let t;try{if(!(t=I0(IB)))return;let r=JSON.parse(t),i=I1(e),n=function(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1}(r,e=>i in e);if(-1===n)return;let o=r.splice(n,1)[0];return I2(IB,JSON.stringify(r)),o[i]}catch(e){gA.warn("Error delete preload info: ".concat(t),e.message),I2(IB,"")}}function Iq(e){if(e){let t=IF.get(e);t&&(window.clearTimeout(t),t=null,IF.delete(e)),o0(Ij).call(Ij,e)||"disabled"!==e.cloudProxyServer||Ij.push(e)}if(IF.size<E4("AP_CACHE_NUM")&&Ij.length>0){let e=Ij.shift();IF.set(e,window.setTimeout(async()=>{let{appId:t,cname:r,token:i,stringUid:n,uid:o,proxyServer:a}=e;try{await IK(t,r,i,o,a,n),IF.has(e)&&Iq(e)}catch(t){gA.warn("update preload failed",t.message),IZ(e)}},E4("AP_UPDATE_INTERVAL")))}}function IZ(e){let t=Ij.indexOf(e);-1!==t&&Ij.splice(t,1);let r=IF.get(e);r&&(window.clearTimeout(r),r=null,IF.delete(e),Iq())}function I$(e,t){let r=e.sua,i=e.ap;t&&r&&gT.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),gT.reportResourceTiming(e.ap.url,e.sid),gT.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(e=>e.ip).join(","),eventType:"disabled",unilbsServerIds:[yi.CHOOSE_SERVER,yi.CLOUD_PROXY_FALLBACK].toString()}),gT.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function I0(e){return window.atob(window.localStorage.getItem(e)||"")}function I2(e,t){window.localStorage.setItem(e,window.btoa(t))}function I1(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),Eu(t)}function I4(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let I6=[];function I3(e,t){if(e.offset+t>e.limit)throw Error("Skip past limit");e.offset+=t}function I8(e,t){let r=e.bytes,i=e.offset,n=e.limit,o=i+t;if(o>r.length){let t=new Uint8Array(2*o);t.set(r),e.bytes=t}return e.offset=o,o>n&&(e.limit=o),i}function I5(e,t){let r=e.offset;if(r+t>e.limit)throw Error("Read past limit");return e.offset+=t,r}function I9(e,t){let r=I8(e,t.length);e.bytes.set(t,r)}function I7(e,t){let r=I5(e,t),i=String.fromCharCode,n=e.bytes,o="";for(let e=0;e<t;e++){let a,s,c,d,u=n[e+r];0==(128&u)?o+=i(u):192==(224&u)?e+1>=t?o+="\uFFFD":128!=(192&(a=n[e+r+1]))?o+="\uFFFD":(d=(31&u)<<6|63&a)<128?o+="\uFFFD":(o+=i(d),e++):224==(240&u)?e+2>=t?o+="\uFFFD":(a=n[e+r+1],32896!=(49344&(a|(s=n[e+r+2])<<8))?o+="\uFFFD":(d=(15&u)<<12|(63&a)<<6|63&s)<2048||d>=55296&&d<=57343?o+="\uFFFD":(o+=i(d),e+=2)):240==(248&u)?e+3>=t?o+="\uFFFD":(a=n[e+r+1],s=n[e+r+2],8421504!=(0xc0c0c0&(a|s<<8|(c=n[e+r+3])<<16))?o+="\uFFFD":(d=(7&u)<<18|(63&a)<<12|(63&s)<<6|63&c)<65536||d>1114111?o+="\uFFFD":(d-=65536,o+=i(55296+(d>>10),56320+(1023&d)),e+=3)):o+="\uFFFD"}return o}function Ce(e,t){let r=t.length,i=0;for(let e=0;e<r;e++){let n=t.charCodeAt(e);n>=55296&&n<=56319&&e+1<r&&(n=(n<<10)+t.charCodeAt(++e)-0x35fdc00),i+=n<128?1:n<2048?2:n<65536?3:4}Cn(e,i);let n=I8(e,i),o=e.bytes;for(let e=0;e<r;e++){let i=t.charCodeAt(e);i>=55296&&i<=56319&&e+1<r&&(i=(i<<10)+t.charCodeAt(++e)-0x35fdc00),i<128?o[n++]=i:(i<2048?o[n++]=i>>6&31|192:(i<65536?o[n++]=i>>12&15|224:(o[n++]=i>>18&7|240,o[n++]=i>>12&63|128),o[n++]=i>>6&63|128),o[n++]=63&i|128)}}function Ct(e){return e.bytes[I5(e,1)]}function Cr(e,t){let r=I8(e,1);e.bytes[r]=t}function Ci(e){let t,r=0,i=0;do t=Ct(e),r<32&&(i|=(127&t)<<r),r+=7;while(128&t);return i}function Cn(e,t){for(t>>>=0;t>=128;)Cr(e,127&t|128),t>>>=7;Cr(e,t)}function Co(e,t){let r=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,o=0===n?0===i?r<16384?r<128?1:2:r<2097152?3:4:i<16384?i<128?5:6:i<2097152?7:8:n<128?9:10,a=I8(e,o),s=e.bytes;switch(o){case 10:s[a+9]=n>>>7&1;case 9:s[a+8]=9!==o?128|n:127&n;case 8:s[a+7]=8!==o?i>>>21|128:i>>>21&127;case 7:s[a+6]=7!==o?i>>>14|128:i>>>14&127;case 6:s[a+5]=6!==o?i>>>7|128:i>>>7&127;case 5:s[a+4]=5!==o?128|i:127&i;case 4:s[a+3]=4!==o?r>>>21|128:r>>>21&127;case 3:s[a+2]=3!==o?r>>>14|128:r>>>14&127;case 2:s[a+1]=2!==o?r>>>7|128:r>>>7&127;case 1:s[a]=1!==o?128|r:127&r}}let Ca={},Cs={},Cc=0xffffffffffffffff,Cd=0xffffffffffffffff/2,Cu=C_(0,!0),Cl=C_(0),Ch=CA(0,-0x80000000,!1),Cp=CA(-1,0x7fffffff,!1),Cf=CA(-1,-1,!0);function C_(e,t){let r,i,n;return t?(n=0<=(e>>>=0)&&e<256)&&(i=Cs[e])?i:(r=CA(e,0,!0),n&&(Cs[e]=r),r):(n=-128<=(e|=0)&&e<128)&&(i=Ca[e])?i:(r=CA(e,e<0?-1:0,!1),n&&(Ca[e]=r),r)}function CA(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function Cm(e,t){if(isNaN(e))return t?Cu:Cl;if(t){if(e<0)return Cu;if(e>=Cc)return Cf}else{if(e<=-Cd)return Ch;if(e+1>=Cd)return Cp}return e<0?t?Cu:Cl:CA(e%0x100000000|0,e/0x100000000|0,t)}function Cv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}class CE extends vP{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(TG.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),Aa(this,"name","AgoraRTCImageModeration"),Aa(this,"_connectionState",Tj.CONNECTING),Aa(this,"_sequence",0),Aa(this,"_moderationStartTime",void 0),Aa(this,"_workerConnection",void 0),Aa(this,"_workerMessageLengthLimit",void 0),Aa(this,"_qualityRatio",void 0),Aa(this,"_connectInfo",void 0),Aa(this,"_cancelTokenSource",mU.CancelToken.source()),Aa(this,"_retryConfig",void 0),Aa(this,"_moderationInterval",void 0),Aa(this,"_moderationTimer",null),Aa(this,"_moderationMode",1),Aa(this,"_quality",1),Aa(this,"_qualityTimer",null),Aa(this,"_ticket",void 0),Aa(this,"_moderationIntervalMinimum",void 0),Aa(this,"_uploadFailedNum",0),Aa(this,"_uploadNum",0),Aa(this,"_uploadTimer",null),Aa(this,"_extraInfo",void 0),Aa(this,"_vendor",""),Aa(this,"_encoder",new TextEncoder),Aa(this,"_moderationId",void 0),Aa(this,"inspectImage",()=>{if(this.connectionState!==Tj.CONNECTED)throw new gy(vA.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Tj.CONNECTED?this.requestToInspectImage():gA.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Er(5,"image-moderation-"),this._workerMessageLengthLimit=E4("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=E4("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=E4("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new ye("worker-"+this._moderationId,E_),this.on(TG.STATE_CHANGE,(e,t)=>{gA.debug("[".concat(this._moderationId,"] Moderation operation :").concat(TW[e]," ").concat(t||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(TG.STATE_CHANGE,TW.CONNECT_AP),this._connectInfo=e;let r=this._cancelTokenSource.token;return this._retryConfig=t,new dJ((i,n)=>{this.on(TG.CONNECTION_STATE_CHANGE,(e,t)=>{e===Tj.CONNECTED&&i()}),this.requestAP(e,r,t).then(e=>{this.connectWorker(e)}).catch(e=>{n(e)})})}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),gA.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Tj.CONNECTED&&this.inspectImage()}async requestAP(e,t,r){let i=E4("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),n=await function(e,t,r,i){let{appId:n,areaCode:o,cname:a,sid:s,token:c,uid:d}=t,u="moderation_plugin",l={service_name:u,json_body:JSON.stringify({appId:n,areaCode:o,cname:a,command:"allocateEdge",requestId:++RA,seq:RA,sid:s,appToken:c,ts:Date.now(),uid:d+""})},h,p,f=e[0];return Em(async()=>{h=Date.now();let e=await y3(f,{data:l,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){let t=new gy(vA.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw gA.error(t.toString()),t}let t=JSON.parse(e.json_body);if(200!==t.code){let e=new gy(vA.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw gA.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){let e=new gy(vA.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw gA.error(e.toString()),e}if(!t.servers.some(e=>!!e.wss)){let e=new gy(vA.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw gA.error(e.toString()),e}let i=E4("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map(e=>{let{address:t,wss:r}=e;if(t&&r)return"wss://".concat(t.replace(/\./g,"-"),".").concat(i,":").concat(r,"/moderation")}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}},(t,r)=>(gT.apworkerEvent(s,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===r,responseTime:p,serverIp:e[r%e.length]}),!1),(t,r)=>(gT.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:u,responseTime:p,serverIp:e[r%e.length]}),!!(t.code!==vA.OPERATION_ABORTED&&t.code!==vA.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(r+1)%e.length],!0)),i)}(i,e,t,r);this.emit(TG.STATE_CHANGE,TW.AP_CONNECTED);let{addressList:o,ticket:a}=n;return this._ticket=a,o}async connectWorker(e){this.emit(TG.STATE_CHANGE,TW.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Tt.CONNECTED,async()=>{this.emit(TG.STATE_CHANGE,TW.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Tj.CONNECTED}),this._workerConnection.on(Tt.CLOSED,()=>{this.connectionState=Tj.CLOSED}),this._workerConnection.on(Tt.FAILED,()=>{this.connectionState=Tj.CLOSED}),this._workerConnection.on(Tt.RECONNECTING,()=>{this.connectionState=this.connectionState===Tj.CONNECTED?Tj.RECONNECTING:Tj.CONNECTING}),this._workerConnection.on(Tt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let t=function(e){return function(e){let t={};e:for(;!function(e){return e.offset>=e.limit}(e);){let r=Ci(e);switch(r>>>3){case 0:break e;case 1:t.code=Ci(e);break;case 2:t.msg=I7(e,Ci(e));break;case 3:t.requestId=I7(e,Ci(e));break;case 4:t.timestamp=function(e,t){let r,i=0,n=0,o=0;return i=127&(r=Ct(e)),128&r&&(i|=(127&(r=Ct(e)))<<7,128&r&&(i|=(127&(r=Ct(e)))<<14,128&r&&(i|=(127&(r=Ct(e)))<<21,128&r&&(n=127&(r=Ct(e)),128&r&&(n|=(127&(r=Ct(e)))<<7,128&r&&(n|=(127&(r=Ct(e)))<<14,128&r&&(n|=(127&(r=Ct(e)))<<21,128&r&&(o=127&(r=Ct(e)),128&r&&(o|=(127&(r=Ct(e)))<<7))))))))),{low:i|n<<28,high:n>>>4|o<<24,unsigned:t}}(e,!1);break;default:(function(e,t){switch(t){case 0:for(;128&Ct(e););break;case 2:I3(e,Ci(e));break;case 5:I3(e,4);break;case 1:I3(e,8);break;default:throw Error("Unimplemented type: "+t)}})(e,7&r)}}return t}({bytes:e,offset:0,limit:e.length})}(new Uint8Array(e.data));E4("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&gA.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,gA.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{gT.reportApiInvoke(this._connectInfo.sid||null,{name:vM.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:vx.TRACER}).onError(new gy(vA.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},E4("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else gA.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Tt.WILL_RECONNECT,(e,t,r)=>{"recover"===e&&r(e),r("tryNext")}),this._workerConnection.on(Tt.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){let e=vX(this,TG.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(E4("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&gA.debug("Only the track being played can be inspected"));this._sequence++;let r=await this.generateRequestData(e,t);this._workerConnection.sendMessage(r,!0,!0)}else E4("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&gA.debug("Only the track being published can be inspected")}async generateRequestData(e,t){var r,i,n,o;let a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,{appId:N,cname:P,cid:D,vid:L,sid:M,uid:x}=t,U=Date.now(),B=await e.getCurrentFrameImage("image/jpeg",this.quality),V=await Sz(B,N,P),F=this._sequence+"-"+D+"-"+x+"-"+U+"-"+Er(12,""),j={appId:N,cid:D,cname:P,deviceId:"",elapse:CE.intToLong(Number(U-this._moderationStartTime)),fileSize:B.buffer.byteLength,height:B.height,width:B.width,jpg:V,networkType:6,osType:7,requestId:F,sdkVersion:"4.23.2-1",sequence:this._sequence,sid:M,timestamp:Cm(U),uid:x,vid:L,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete j.callbackData;let G=(r=j,a=function(){let e=I6.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}(),i=r,n=a,void 0!==(s=i.appId)&&(Cn(n,10),Ce(n,s)),void 0!==(c=i.cid)&&(Cn(n,16),Cn(n,c)),void 0!==(d=i.cname)&&(Cn(n,26),Ce(n,d)),void 0!==(u=i.deviceId)&&(Cn(n,34),Ce(n,u)),void 0!==(l=i.elapse)&&(Cn(n,40),Co(n,l)),void 0!==(h=i.fileSize)&&(Cn(n,48),Co(n,I4(h))),void 0!==(p=i.height)&&(Cn(n,56),Co(n,I4(p))),void 0!==(f=i.jpg)&&(Cn(n,66),Cn(n,f.length),I9(n,f)),void 0!==(_=i.networkType)&&(Cn(n,72),Co(n,I4(_))),void 0!==(A=i.osType)&&(Cn(n,80),Co(n,I4(A))),void 0!==(m=i.requestId)&&(Cn(n,90),Ce(n,m)),void 0!==(v=i.sdkVersion)&&(Cn(n,98),Ce(n,v)),void 0!==(E=i.sequence)&&(Cn(n,104),Co(n,I4(E))),void 0!==(g=i.sid)&&(Cn(n,114),Ce(n,g)),void 0!==(S=i.timestamp)&&(Cn(n,120),Co(n,S)),void 0!==(b=i.uid)&&(Cn(n,128),Cn(n,b)),void 0!==(T=i.vid)&&(Cn(n,136),Cn(n,T)),void 0!==(y=i.width)&&(Cn(n,144),Co(n,I4(y))),void 0!==(R=i.service)&&(Cn(n,152),Cn(n,R)),void 0!==(I=i.callbackData)&&(Cn(n,162),Cn(n,I.length),I9(n,I)),void 0!==(C=i.ticket)&&(Cn(n,170),Ce(n,C)),void 0!==(k=i.vendorConfigs)&&(Cn(n,178),Ce(n,k)),w=(o=a).bytes,O=o.limit,w.length===O?w:w.subarray(0,O));if(G.byteLength<this._workerMessageLengthLimit){if(E4("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let e=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Cv(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cv(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},j);delete e.jpg,gA.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return G}{let t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:N,cname:P,cid:D,vid:L,sid:M,uid:x})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mU.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Tj.CLOSED,this.emit(TG.STATE_CHANGE,TW.CLOSED)}}function Cg(e){if(vg(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new gy(vA.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new gy(vA.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}function CS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function Cb(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?CS(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CS(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}Ep.setLogger(gA);let CT=(rj=gb(),rG=gb({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Sc))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),rW=gb({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==gZ.DATA?(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())):[t.getChannelId()])}),rH=gb({argsMap:(e,t,r,i)=>["object"==typeof t?t.uid:t,r,i]}),rY=gb({argsMap:(e,t,r)=>[t,r]}),rK=gb({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:r}=e;return[null==t?void 0:t.uid,r]})}),rQ=gb({argsMap:(e,t,r,i)=>["object"==typeof t?t.uid:t,r,i]}),rz=gb({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:r}=e;return{uid:null==t?void 0:t.uid,mediaType:r}})}),rX=gb(),rJ=gb(),rq=gb(),rZ=gb(),r$=gb(),r0=gb(),r2=gb(),r1=gb(),r4=gb(),r6=gb(),r3=gb(),r8=gb(),r5=gb(),r9=gb(),r7=gb(),ie=gb({argsMap:(e,t)=>[t]}),it=gb(),ir=gb(),ii=gb(),io=gb(),ia=gb(),is=gb(),ic=gb(),id=gb(),iu=gb({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),il=gb(),ih=gb(),ip=gb(),i_=gb(),iA=gb(),im=gb(),iv=gb({reportResult:!0}),iE=gb(),b$((ig=class extends vP{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){var r;let i;if(super(),Aa(this,"store",void 0),Aa(this,"_uid",void 0),Aa(this,"_channelName",void 0),Aa(this,"_uintUid",void 0),Aa(this,"_users",[]),Aa(this,"_config",void 0),Aa(this,"_clientId",void 0),Aa(this,"_appId",void 0),Aa(this,"_sessionId",null),Aa(this,"_key",void 0),Aa(this,"_rtmConfig",{}),Aa(this,"_joinInfo",void 0),Aa(this,"_gateway",void 0),Aa(this,"_statsCollector",void 0),Aa(this,"_configDistribute",void 0),Aa(this,"_leaveMutex",void 0),Aa(this,"_publishMutex",void 0),Aa(this,"_renewTokenMutex",void 0),Aa(this,"_subscribeMutex",void 0),Aa(this,"_encryptionMode","none"),Aa(this,"_encryptionSecret",null),Aa(this,"_encryptionSalt",null),Aa(this,"_encryptDataStream",!1),Aa(this,"_encryptDataStreamKey",null),Aa(this,"_encryptDataStreamIv",null),Aa(this,"_proxyServer",void 0),Aa(this,"_turnServer",{servers:[],mode:"auto"}),Aa(this,"_cloudProxyServerMode","disabled"),Aa(this,"_isDualStreamEnabled",!1),Aa(this,"_defaultStreamFallbackType",void 0),Aa(this,"_lowStreamParameter",void 0),Aa(this,"_streamFallbackTypeCacheMap",new Map),Aa(this,"_remoteStreamTypeCacheMap",new Map),Aa(this,"_axiosCancelSource",mU.CancelToken.source()),Aa(this,"_audioVolumeIndicationInterval",void 0),Aa(this,"_networkQualityInterval",void 0),Aa(this,"_userOfflineTimeout",void 0),Aa(this,"_streamRemovedTimeout",void 0),Aa(this,"_liveTranscodeStreamingClient",void 0),Aa(this,"_liveRawStreamingClient",void 0),Aa(this,"_channelMediaRelayClient",void 0),Aa(this,"_networkQualitySensitivity","normal"),Aa(this,"_p2pChannel",void 0),Aa(this,"_useLocalAccessPoint",!1),Aa(this,"_setLocalAPVersion",void 0),Aa(this,"_joinAndNotLeaveYet",!1),Aa(this,"_numberOfJoinCount",0),Aa(this,"_remoteDefaultVideoStreamType",void 0),Aa(this,"_inspect",void 0),Aa(this,"_moderation",void 0),Aa(this,"_license",void 0),Aa(this,"_pendingPublishedUsers",[]),Aa(this,"ntpAlignErrorCount",0),Aa(this,"remoteInboundOffset",0),Aa(this,"_peerConnectionState",void 0),Aa(this,"_handleLocalTrackEnable",(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),Aa(this,"_handleLocalTrackDisable",(e,t,r)=>{this.unpublish(e).then(t).catch(r)}),Aa(this,"_handleUserOnline",e=>{if(E4("BLOCK_LOCAL_CLIENT")&&bM(e.uid,this.channelName))return void gA.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&gA.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let t=this._users.find(t=>t.uid===e.uid);if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(vW.USER_JOINED,t));else{let t=new RF(e.uid,e.uint_id||e.uid);this._users.push(t),gA.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(vW.USER_JOINED,t)}}),Aa(this,"_handleUserOffline",e=>{if(E4("BLOCK_LOCAL_CLIENT")&&bM(e.uid,this.channelName))return;let t=this._users.find(t=>t.uid===e.uid);t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:vZ(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),gA.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(vW.USER_LEAVED,t,e.reason))}),Aa(this,"_handleAddAudioOrVideoStream",(e,t,r,i,n,o,a)=>{if(E4("BLOCK_LOCAL_CLIENT")&&bM(t,this.channelName))return;let s=this._users.find(e=>e.uid===t);if(!s)return void gA.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));gA.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(s.uid,e,void 0,void 0,void 0,Date.now());let c="audio"===e?s.hasAudio:s.hasVideo;s._uintid||(s._uintid=n||t),"audio"===e?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,"audio"===e?(s._audio_added_=!0,void 0!==r&&(s._audioSSRC=r),void 0!==i&&(s._cname=i),o&&(s._audioOrtc=o)):(s._video_added_=!0,void 0!==r&&(s._videoSSRC=r),void 0!==i&&(s._cname=i),void 0!==a&&(s._rtxSsrcId=a),o&&(s._videoOrtc=o)),("audio"===e?s.hasAudio:s.hasVideo)&&!c&&(gA.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(e)),this.safeEmit(vW.USER_PUBLISHED,s,e)),"video"===e?gT.onGatewayStream(this._sessionId,gE.ON_ADD_VIDEO_STREAM,gg.ON_ADD_VIDEO_STREAM,{peer:n||t,ssrc:s._videoSSRC}):gT.onGatewayStream(this._sessionId,gE.ON_ADD_AUDIO_STREAM,gg.ON_ADD_AUDIO_STREAM,{peer:n||t,ssrc:s._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(s,e,r).then(t=>{if(t&&(gA.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof II))return this._p2pChannel.unsubscribe(s,e,!0).then(()=>this._subscribe(s,e,!0).catch(e=>{gA.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(s,e)&&(gA.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,e,!0).catch(e=>{gA.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),Aa(this,"_handleRemoveStream",e=>{if(E4("BLOCK_LOCAL_CLIENT")&&bM(e.uid,this.channelName))return;let t=this._users.find(t=>t.uid===e.uid);if(!t)return void gA.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));gA.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let r=()=>{};t.hasAudio&&t.hasVideo?r=()=>{gA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(vW.USER_UNPUBLISHED,t,"audio"),gA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(vW.USER_UNPUBLISHED,t,"video")}:t.hasVideo?r=()=>{gA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(vW.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(r=()=>{gA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(vW.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof II&&this._p2pChannel.unsubscribe(t).then(e=>{if(e)return this._gateway.unsubscribe(e,t.uid)}),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),gT.onGatewayStream(this._sessionId,gE.ON_REMOVE_STREAM,gg.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),r()}),Aa(this,"_handleSetStreamLocalEnable",(e,t,r)=>{if(E4("BLOCK_LOCAL_CLIENT")&&bM(t,this.channelName))return;let i=this._users.find(e=>e.uid===t);if(!i)return void gA.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));gA.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(r?"enabled":"disabled"," with uid ").concat(t));let n="audio"===e?i.hasAudio:i.hasVideo;if("audio"===e){i._trust_audio_enabled_state_=!0;let e=i._audio_enabled_;if(i._audio_enabled_=r,i._audio_enabled_===e)return;{let e=i._audio_enabled_?"enable-local-audio":"disable-local-audio";gA.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(vW.USER_INFO_UPDATED,t,e)}}else{i._trust_video_enabled_state_=!0;let e=i._video_enabled_;if(i._video_enabled_=r,i._video_enabled_===e)return;{let e=i._video_enabled_?"enable-local-video":"disable-local-video";gA.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(vW.USER_INFO_UPDATED,t,e)}}let o="audio"===e?i.hasAudio:i.hasVideo;return n!==o?!n&&o?(gA.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(vW.USER_PUBLISHED,i,e)):("video"===e&&i._videoTrack&&i._videoTrack._destroy(),"audio"===e&&i._audioTrack,this._p2pChannel.muteRemote(i,e),gA.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(vW.USER_UNPUBLISHED,i,e)):void 0}),Aa(this,"_handleMuteStream",(e,t,r)=>{if(E4("BLOCK_LOCAL_CLIENT")&&bM(e,this.channelName))return;gA.debug("[".concat(this._clientId,"] receive mute message"),e,t,r);let i=this._users.find(t=>t.uid===e);if(!i)return void gA.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));let n="audio"===t?i.hasAudio:i.hasVideo;if("audio"===t){i._trust_audio_mute_state_=!0;let t=i._audio_muted_;if(i._audio_muted_=r,i._audio_muted_===t)return;{let t=i._audio_muted_?"mute-audio":"unmute-audio";gA.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(vW.USER_INFO_UPDATED,e,t)}}else{i._trust_video_mute_state_=!0;let t=i._video_muted_;if(i._video_muted_=r,i._video_muted_===t)return;{let t=i._video_muted_?"mute-video":"unmute-video";gA.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(vW.USER_INFO_UPDATED,e,t)}}let o="audio"===t?i.hasAudio:i.hasVideo;if(n!==o){if(!n&&o)return("audio"===t?i._audioSSRC:i._videoSSRC)?(gA.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(vW.USER_PUBLISHED,i,t)):void gA.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&i._videoTrack&&!i._video_pre_subscribed&&i._videoTrack._destroy(),"audio"===t&&i._audioTrack,this._p2pChannel.muteRemote(i,t),gA.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(vW.USER_UNPUBLISHED,i,t)}}),Aa(this,"_handleP2PLost",async e=>{gA.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():gA.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)}),Aa(this,"_handleTokenWillExpire",()=>{gA.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(vW.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Aa(this,"_handleBeforeUnload",e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),gA.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Aa(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(vW.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(vW.NETWORK_QUALITY,e)}),Aa(this,"_handleP2PAddAudioOrVideoStream",(e,t,r,i)=>{let n=this._users.find(e=>e.uid===t);if(!n)return void gA.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));gA.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(n.uid,e,void 0,void 0,void 0,Date.now());let o="audio"===e?n.hasAudio:n.hasVideo;"audio"===e?n._trust_audio_stream_added_state_=!0:n._trust_video_stream_added_state_=!0,"audio"===e?(n._audio_added_=!0,void 0!==r&&(n._audioSSRC=r),void 0!==i&&(n._audioMid=i)):(n._video_added_=!0,void 0!==r&&(n._videoSSRC=r),void 0!==i&&(n._videoMid=i)),("audio"===e?n.hasAudio:n.hasVideo)&&!o&&(gA.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published ").concat(e)),this.safeEmit(vW.USER_PUBLISHED,n,e)),this._p2pChannel.hasPendingRemoteMedia(n,e)&&(gA.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(n.uid," after reconnect.")),this._subscribe(n,e,!0).catch(e=>{gA.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._config=e,this._clientId=t||Er(5,"client-"),this.store=new class{constructor(e,t,r,i){vp(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:EX.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case E8.SET_SESSION_ID:return v_(v_({},e),{},{sessionId:t.sessionId});case E8.SET_P2P_ID:return v_(v_({},e),{},{p2pId:t.p2pId});case E8.SET_UID:return v_(v_({},e),{},{uid:t.uid});case E8.SET_INT_UID:return v_(v_({},e),{},{intUid:t.intUid});case E8.SET_PUB_ID:return v_(v_({},e),{},{pubId:t.pubId});case E8.KEY_METRIC_CLIENT_CREATED:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{clientCreated:t.metric})});case E8.KEY_METRIC_JOIN_START:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{joinStart:t.metric})});case E8.AVOID_JOIN_START:return v_(v_({},e),{},{avoidJoinStart:t.avoidJoinStart});case E8.KEY_METRIC_JOIN_END:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{joinEnd:t.metric})});case E8.KEY_METRIC_REQUEST_AP_START:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{requestAPStart:t.metric})});case E8.KEY_METRIC_REQUEST_AP_END:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{requestAPEnd:t.metric})});case E8.KEY_METRIC_JOIN_GATEWAY_START:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case E8.KEY_METRIC_JOIN_GATEWAY_END:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case E8.KEY_METRIC_PEER_CONNECTION_START:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case E8.KEY_METRIC_PEER_CONNECTION_END:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case E8.KEY_METRIC_DESCRIPTION_START:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{descriptionStart:t.metric})});case E8.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case E8.KEY_METRIC_ICE_CONNECTION_END:return v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case E8.KEY_METRIC_PUBLISH:{let r=e.keyMetrics.publish,i=r.findIndex(e=>e.trackId===t.metric.trackId);return -1!==i?(r[i]=v_(v_({},r[i]),t.metric),v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{publish:[...r]})})):v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case E8.KEY_METRIC_SUBSCRIBE:{let r=e.keyMetrics.subscribe,i=r.findIndex(e=>e.userId===t.metric.userId&&e.type===t.metric.type);return -1!==i?(r[i]=v_(v_({},r[i]),t.metric),v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{subscribe:[...r]})})):v_(v_({},e),{},{keyMetrics:v_(v_({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case E8.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case E8.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=v_(v_({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case E8.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case E8.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case E8.SET_USE_P2P:return v_(v_({},e),{},{useP2P:t.val});case E8.SET_TRANSPORT_TYPE:return v_(v_({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:E8.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:E8.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:E8.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:E8.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:E8.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:E8.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:E8.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:E8.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:E8.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:E8.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:E8.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:E8.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:E8.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:E8.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:E8.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:E8.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:E8.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:E8.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:E8.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:E8.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:E8.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,r,i){this.dispatch({type:E8.KEY_METRIC_PUBLISH,metric:v_(v_({trackId:e,type:t},r&&{publishStart:r}),i&&{publishEnd:i})})}subscribe(e,t,r,i,n,o,a){this.dispatch({type:E8.KEY_METRIC_SUBSCRIBE,metric:v_(v_(v_(v_(v_({userId:e,type:t},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),n&&{firstFrame:n}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,t,r,i){e.forEach(e=>{this.dispatch({type:E8.KEY_METRIC_SUBSCRIBE,metric:v_(v_(v_({userId:e.userId,type:e.type},t&&{subscribeStart:t}),r&&{subscribeEnd:r}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map(e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof t?(this.dispatch({type:E8.RECORD_JOIN_CHANNEL_SERVICE,record:v_(v_({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:E8.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:E8.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:E8.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:E8.AVOID_JOIN_START,avoidJoinStart:e})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Ep("client-leave",this._clientId),this._publishMutex=new Ep("client-publish",this._clientId),this._renewTokenMutex=new Ep("client-renewtoken",this._clientId),this._subscribeMutex=new Ep("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),gA.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(EQ," build: ").concat(E$,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{vG(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(e){gA.warning("[".concat(this._clientId,"] ").concat(e.toString()))}this._statsCollector=new RU(this.store),this._statsCollector.onStatsException=(e,t,r)=>{gA.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(r)),this.safeEmit(vW.EXCEPTION,{code:e,msg:t,uid:r})},this._statsCollector.onUploadPublishDuration=(e,t,r,i)=>{let n=this._users.find(t=>t.uid===e);n&&gT.peerPublishStatus(this._sessionId,{subscribeElapse:i,audioPublishDuration:t,videoPublishDuration:r,peer:n._uintid})},this.store.useP2P="p2p"===e.mode,this._gateway=new y1(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||E_,httpRetryConfig:e.httpRetryConfig||E_,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new RN(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},yJ("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new II(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,i,n){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];E1("JOIN_GATEWAY_USE_443PORT_ONLY",o),E1("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);let s=this._gateway.signal.websocket;return s instanceof T7&&(s.use443PortOnly=o,s.tryDoubleDomain=a),async function(e,t,r){mF.get(e)||mF.set(e,[]),mj.get(e)||mj.set(e,t),mG.get(e)||mG.set(e,0);let i=mF.get(e),n=mj.get(e);if(!i||!n)throw Error("concurrent: deferQueue or maxConcurrency is null");if(mG.get(e)===n){let e=mV();i.push(e),await e.promise}mG.set(e,mG.get(e)+1);for(var o=arguments.length,a=Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];let c=await r(...a);return mG.set(e,mG.get(e)-1),mG.get(e)===n-1&&i.length>0&&(i[0].resolve(),i.shift()),0===mG.get(e)&&(mF.set(e,[]),mj.set(e,0),mG.set(e,0)),c}("client.join",E4("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,i,n)}async join(e,t,r,i,n){var o;let a=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);let s="HTTPS"===(Ev||Ev||(Ev=(window.location.protocol.split(":")[0]||"").toUpperCase())),c=Ey()?window.isSecureContext:"Browser Not Support";(!Ey()&&!s||!window.isSecureContext)&&gA.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),gA.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),gT.setAppId(e);try{if(!r&&null!==r)throw new gy(vA.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&vb(r,"token",1,2047),vb(e,"appid",1,2047),Tr(t),i&&Ti(i),n&&vb(n,"optionalInfo",1,2047)}catch(n){throw gT.reportApiInvoke(Ei(),{name:vM.JOIN,options:[e,t,r,i],states:{isHttps:s,isSecureContext:c},tag:vx.TRACER}).onError(n),n}if(this._leaveMutex.isLocked&&(gA.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),gA.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){let n=new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw gT.reportApiInvoke(Ei(),{name:vM.JOIN,options:[e,t,r,i],states:{isHttps:s,isSecureContext:c},tag:vx.TRACER}).onError(n),n}this._gateway.state="CONNECTING";let d=await IX({appId:e,cname:t,uid:i,stringUid:"string"==typeof i?i:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let u=(null==d?void 0:d.sid)||Ei();gA.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId);let l=gT.reportApiInvoke(u,{id:this._clientId,name:vM.JOIN,options:[e,t,r,i],states:{isHttps:s,isSecureContext:c},tag:vx.TRACER}),h=Cb(Cb(Cb({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof i?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:n,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:E4("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(h.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof i&&(h.stringUid=i,this._uintUid?(h.uid=this._uintUid,this._uintUid=void 0):h.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(h.aesmode=this._encryptionMode,h.aespassword=await (async e=>{let t=function(e){let t=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),r=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)r[e]=t.charCodeAt(e);return r}(),r=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=vw(e);return function(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}(new Uint8Array(await window.crypto.subtle.encrypt({name:"RSA-OAEP"},r,i)))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(h.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode)){if(this._encryptionSalt&&this._encryptionSecret){if(window.crypto.subtle){let e=new TextEncoder,t=E4("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(h.appId+this._encryptionSecret+this._encryptionSecret):e.encode(h.appId+h.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,r){let i=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),n="aes-128-gcm2"===e?128:256;return new Uint8Array(await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:r},i,n+96)).subarray(n/8)}(this._encryptionMode,t,v3(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,r){let i=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]);return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:r},i,{name:"AES-GCM",length:"aes-128-gcm2"===e?128:256},!0,["encrypt","decrypt"])}(this._encryptionMode,t,v3(this._encryptionSalt))}else c?gA.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):gA.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1}else this._encryptDataStream=!1,gA.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"))}this._startSession(this._sessionId,{channel:t,appId:e,stringUid:h.stringUid});let p=this._sessionId;setTimeout(()=>{"CONNECTING"===this.connectionState&&p===this._sessionId&&gT.joinChannelTimeout(this._sessionId,5)},5e3);try{let i;let n=h.cloudProxyServer;if(o0(o=["proxy3","proxy4","proxy5"]).call(o,n)){let e=E4("PROXY_SERVER_TYPE3");Array.isArray(e)?h.proxyServer=e[0]:h.proxyServer=e}if(gT.setProxyServer(h.proxyServer),gA.setProxyServer(h.proxyServer),this.store.requestAPStart(),d){if(gA.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(h.stringUid?", ".concat(h.stringUid," => ").concat(d.intUid):""," ")),h.stringUid&&!h.uid&&(h.uid=d.intUid),i={gatewayInfo:d.ap.gatewayInfo},E4("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===h.turnServer.mode){if(0===d.ap.proxyInfo.addresses.length)gA.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let e=(await yh(d.ap.proxyInfo,d.ap.gatewayInfo.uid)).map(e=>({turnServerURL:e.address,tcpport:e.tcpport||EJ.tcpport,udpport:e.udpport||EJ.udpport,username:e.username||EJ.username,password:e.password||EJ.password,forceturn:!1,security:!0}));h.turnServer={mode:"manual",servers:e}}}I$(d,h.stringUid)}else{if(h.stringUid&&!h.uid){let e;[e,i]=await dJ.all([Rb(h.stringUid,h,this._axiosCancelSource.token,this._config.httpRetryConfig||E_,this.store),RS(h,this._axiosCancelSource.token,this._config.httpRetryConfig||E_,!0,this.store)]),gA.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(h.stringUid," => ").concat(e)),h.uid=e,i.gatewayInfo.uid=e,i.gatewayInfo.res.uid=e}else i=await RS(h,this._axiosCancelSource.token,this._config.httpRetryConfig||E_,!0,this.store);if(!this._joinAndNotLeaveYet)throw new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(h,this._axiosCancelSource.token),this._configDistribute.on(TR.UPDATE_BITRATE_LIMIT,e=>{this._p2pChannel.updateBitrateLimit(e)}),this._configDistribute.on(TR.UPDATE_CLIENT_ROLE_OPTIONS,e=>{this._setClientRoleOptions(e)})},0),this._key=r||e;let a=i.gatewayInfo,s=h.uid?h.uid:a.uid;this._joinInfo=Cb(Cb({},h),{},{cid:a.cid,uid:s,vid:a.vid,apResponse:a.res,apGatewayAddress:a.apGatewayAddress,uni_lbs_ip:a.uni_lbs_ip,gatewayAddrs:a.gatewayAddrs}),this.store.intUid=s,this.store.cid=a.cid;let c=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(c),this._appId=e,this._channelName=h.cname,this._uid=c,this.store.uid=c,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(m0()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let u=h.stringUid?"string uid: ".concat(h.stringUid,",uid: ").concat(h.uid):"uid: ".concat(this._uid);return gA.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(u)),setTimeout(()=>{gA.startUpload()},5e3),this.store.joinEnd(),o0(bD).call(bD,this)||bD.push(this),"disabled"===this._cloudProxyServerMode&&gR.supportWebCrypto&&E4("ENABLE_PRELOAD")&&Iq(this._joinInfo),c}catch(t){let e=Array.isArray(t)?t[0]:t;throw e&&e.code===vA.OPERATION_ABORTED?gA.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),e):gA.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),e),e.code!==vA.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(e),e}}_joinGateway(){if(!this._joinInfo||!this._key)throw new gy(vA.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!E4("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){gA.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(m0()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){let t=bD.indexOf(e);-1!==t&&bD.splice(t,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return gA.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,vV.LEAVE),gA.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Sc))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new gy(vA.INVALID_PARAMS,"param list is empty");let r=e;if("audience"===this._gateway.role)throw new gy(vA.INVALID_OPERATION,"audience can not publish stream");for(let e of r){if(!(e instanceof Sc))throw new gy(vA.INVALID_PARAMS,"parameter is not local track");if(!e._enabled&&t)throw new gy(vA.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(e.getTrackId()))}gA.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(e=>"".concat(e.getTrackId()," "))));let i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(e=>{let t=this._configDistribute.getBitrateLimit();e instanceof S8&&t&&e.setBitrateLimit(t.uplink)});try{await this._publishHighStream(r),gA.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(e=>"".concat(e.getTrackId()," "))))}catch(e){throw gA.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{i()}}async _publishDataChannel(e){vg(e.id,"id",0,65535,!0),vv(e.ordered,"ordered"),vb(e.metadata,"metadata",0,512),gA.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{var r;if(-1!==this._p2pChannel.getAllDataChannels().findIndex(t=>t.id===e.id))throw new gy(vA.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new gy(vA.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&E4("FORCE_TURN")&&!E4("TURN_ENABLE_TCP")&&!E4("TURN_ENABLE_UDP"))throw new gy(vA.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let t=(r=e,yq(r,!1)),i=await this._p2pChannel.publishDataChannel([t]);if(i.length>0){if("number"!=typeof t._originDataChannelId)throw gA.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new gy(vA.CREATE_DATACHANNEL_ERROR);try{await dJ.all(i.map(e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0))),await t._waitTillOpen()}catch(e){if(e.code!==vA.DISCONNECT_P2P)throw e}}return gA.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw gA.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new gy(vA.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e){if(Array.isArray(e))t=e;else{if(!(e instanceof Sc))return this._unpublishDataChannel([e]);t=[e]}}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);gA.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(e=>"".concat(e.getTrackId()," "))," "));let r=await this._publishMutex.lock();try{if(this.store.useP2P){let e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(TH.UNPUBLISH,{unpubMsg:e},!0)}else{let e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),gA.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(e=>"".concat(e.getTrackId()))))}}catch(e){throw gA.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{r&&r()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),gA.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(e=>"".concat(e.id," "))," "));let t=await this._publishMutex.lock();try{let t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),gA.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(e=>"".concat(e.id))))}catch(e){throw gA.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof RF)){let t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new gy(vA.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(vE(t,"mediaType",["audio","video"]),this.store.useP2P)throw new gy(vA.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r=t===Tw.AUDIO,i=t===Tw.VIDEO,n=await this._subscribeMutex.lock();try{let{ssrcId:n,ortc:o,rtxSsrcId:a,cname:s,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==n)throw new gy(vA.UNEXPECTED_RESPONSE,"no ssrc id");let d=this._users.find(t=>t.uid===e);d||((d=new RF(e,c||e))._is_pre_created=!0,this._users.push(d)),s&&(d._cname=s),d._uintid||(d._uintid=c||e),r&&(d._audioSSRC=n,d._audio_pre_subscribed=!0,o&&(d._audioOrtc=o)),i&&(d._videoSSRC=n,d._video_pre_subscribed=!0,o&&(d._videoOrtc=o),null!=a&&(d._rtxSsrcId=a)),gA.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(n)),await this._p2pChannel.subscribe(d,t,n,a,o);let u=r?d._audioTrack:d._videoTrack;if(!u)throw new gy(vA.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(d._trust_audio_stream_added_state_=!0,d._audio_added_=!0),i&&(d._trust_video_stream_added_state_=!0,d._video_added_=!0),u}catch(t){throw gA.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{n()}}async _subscribeDataChannel(e,t){var r,i;if(vg(t,"channelId",0,65535,!0),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(t=>t===e))throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new gy(vA.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new gy(vA.INVALID_REMOTE_USER,"user is not published");let n=null===(r=e._dataChannels)||void 0===r?void 0:r.find(e=>e.id===t);if(!n)throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new gy(vA.REMOTE_USER_IS_NOT_PUBLISHED);let o=await this._subscribeMutex.lock();gA.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let t=await this._p2pChannel.subscribeDataChannel(e,[n]);if(t&&o0(t).call(t,n.id))try{if("number"!=typeof n._originDataChannelId)throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new gy(vA.CREATE_DATACHANNEL_ERROR);let t={id:n.id,datachannelId:n._originDataChannelId,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:null!==(i=n.metadata)&&void 0!==i?i:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await n._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==vA.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[n]),t;await this._p2pChannel.unsubscribeDataChannel(e,[n]),this._p2pChannel.setPendingRemoteDataChannel(e,n.id)}return gA.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),n}finally{o()}}async _p2pSubscribe(e,t,r){if(vE(t,"mediaType",["audio","video"]),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(t=>t===e)){let t=new gy(vA.INVALID_REMOTE_USER,"user is not in the channel");throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){let t=new gy(vA.INVALID_REMOTE_USER,"user is not published");throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!r&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){let r=new gy(vA.REMOTE_USER_IS_NOT_PUBLISHED);throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),r}let i=await this._subscribeMutex.lock();gA.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let r="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,r,i)}catch(e){throw e}gA.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{gA.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});let r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new gy(vA.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(t){throw gA.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(vE(t,"mediaType",["audio","video"]),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(t=>t===e)){let t=new gy(vA.INVALID_REMOTE_USER,"user is not in the channel");throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){let t=new gy(vA.INVALID_REMOTE_USER,"user is not published");throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(r||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){let r=new gy(vA.REMOTE_USER_IS_NOT_PUBLISHED);throw gA.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),r}let i="audio"===t?e._audioSSRC:e._videoSSRC,n="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?Tw.AUDIO:Tw.VIDEO,ssrcId:i},s=await this._subscribeMutex.lock();gA.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let r="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==r&&r!==i&&(i=r,n="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?Tw.AUDIO:Tw.VIDEO,ssrcId:i}),RL.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,n);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,a,!0)}catch(r){if((null==r?void 0:r.code)!==vA.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),r;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(r){throw this._p2pChannel.reportSubscribeEvent(!1,null==r?void 0:r.code,e,t),r}gA.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{gA.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});let r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new gy(vA.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(t){throw gA.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{s()}}async massSubscribe(e){if(vT(e,"subscribeList"),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),r=new Map,i=await this._subscribeMutex.lock();gA.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(e=>{let{user:t,mediaType:r}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(r)}).join("; ")));let n=(e=[...e]).map(e=>{let{user:t,mediaType:r}=e;return{user:t,mediaType:r}}),o=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){let{user:i,mediaType:o}=e[t];if(vE(o,"mediaType",["audio","video"]),!i){let e=new gy(vA.INVALID_PARAMS,"user property does not exist in subscribeList item");throw gA.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}if(!this._users.find(e=>e===i)){let r=new gy(vA.INVALID_REMOTE_USER,"user is not in the channel");gA.error("[".concat(this._clientId,"] can not massSubscribe ").concat(i.uid,", this user is not in the channel")),n[t].error=r,e.splice(t,1);continue}if("audio"===o&&(!i.hasAudio||void 0===i._audioSSRC)||"video"===o&&(!i.hasVideo||void 0===i._videoSSRC)){let r=new gy(vA.REMOTE_USER_IS_NOT_PUBLISHED);gA.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(o,", remote user is not published")),n[t].error=r,e.splice(t,1);continue}let a=Tg.Video|Tg.LwoVideo,s=r.get(i);if(s){if("video"===o?s&a:s&Tg.Audio){e.splice(t,1),gA.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(i.uid,", mediaType:").concat(o," twice"));continue}r.set(i,s|("video"===o?a:Tg.Audio))}else r.set(i,"video"===o?a:Tg.Audio)}for(let t=e.length-1;t>=0;t--){let{user:i,mediaType:n}=e[t],o=Tg.Video|Tg.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,n)){await this._p2pChannel.unmuteRemoteNoLock(i,n);let a=r.get(i);r.set(i,"video"===n?a^o:a^Tg.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map(e=>({userId:e.user.uid,type:e.mediaType})),t);let i=ae(a=Array.from(r.entries())).call(a,(e,t)=>{let[r,i]=t;if(0===i)return e;let n={stream_id:r.uid,stream_type:i};return i&Tg.Audio&&(n.audio_ssrc=r._audioSSRC),i&Tg.Video&&(n.video_ssrc=r._videoSSRC),e.push(n),e},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(e=>{let{user:t,mediaType:r}=e;return{user:t,mediaType:r,ssrcId:r===Tw.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:r===Tw.VIDEO?t._rtxSsrcId:void 0}}));let r=new Map;if((i=i.filter(e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc)).length>0){let e=await this._gateway.subscribeAll(i,!0);((null==e?void 0:e.users)||[]).forEach(e=>{let{stream_id:t,video_error_code:i,audio_error_code:n,error_code:o}=e;(i||n||o)&&r.set(t,{video_error_code:i,audio_error_code:n,error_code:o})})}if(Array.from(r.entries()).length>0){let e=[];Array.from(r.entries()).forEach(t=>{let[r,i]=t,n=this.remoteUsers.find(e=>e.uid===r);if(n){let t;i.error_code||i.video_error_code&&i.audio_error_code?t=void 0:i.video_error_code?t=Tw.VIDEO:i.audio_error_code&&(t=Tw.AUDIO),e.push({user:n,mediaType:t})}}),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(let e of n){let t=r.get(e.user.uid);if(t){let r=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(r){let t=Tq(r);gA.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new gy(vA.SUBSCRIBE_FAILED,"code ".concat(r,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(n.filter(e=>!e.error).map(e=>({userId:e.user.uid,type:e.mediaType})),void 0,Date.now()),n.forEach(e=>{var r;gT.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(r=e.error)||void 0===r?void 0:r.code)||null,video:e.mediaType===Tw.VIDEO,audio:e.mediaType===Tw.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===Tw.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)}),gA.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(e=>{let{user:t,mediaType:r}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(r)}).join("; "))),n}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),i()}}async unsubscribe(e,t,r){if(!(e instanceof RF)){let t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new gy(vA.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&vE(t,"mediaType",["audio","video"]),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(t=>t===e)){let t=new gy(vA.INVALID_REMOTE_USER,"user is not in the channel");throw gA.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}gA.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let r=await this._p2pChannel.unsubscribe(e,t);r&&await this._gateway.unsubscribe(r,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&vZ(this._users,e),gA.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===vA.DISCONNECT_P2P)return void gA.warning("disconnecting p2p, abort unsubscribe request.");throw gA.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){let r;if(t&&vg(t,"id",0,65535,!0),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(t=>t===e)){let t=new gy(vA.INVALID_REMOTE_USER,"user is not in the channel");throw gA.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}if("number"==typeof t){let i=e._dataChannels.find(e=>e.id===t);i&&(r=[i])}else r=e._dataChannels;if(void 0===r){let r=new gy(vA.REMOTE_USER_IS_NOT_PUBLISHED);throw gA.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),r}gA.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(e=>e.id)));try{let t=await this._p2pChannel.unsubscribeDataChannel(e,r);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),gA.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===vA.DISCONNECT_P2P)return void gA.warning("disconnecting p2p, abort unsubscribe request.");throw gA.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(vT(e,"unsubscribeList"),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");gA.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(e=>{let{user:t,mediaType:r}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(r,";")}).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:i,mediaType:n}=e[r];if(!i){let e=new gy(vA.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw gA.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}if(vE(n,"mediaType",["video","audio",void 0]),!this._users.find(e=>e===i)){gA.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(r,1);continue}let o=Tg.Video|Tg.LwoVideo;if(t.has(i)){let a;let s=t.get(i);switch(n){case"video":a=s&o;break;case"audio":a=s&Tg.Audio;break;default:a=s&(Tg.Audio|o)}if(a){gA.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(n," twice.")),e.splice(r,1);continue}n?"audio"===n?t.set(i,s|Tg.Audio):"video"===n&&t.set(i,s|o):t.set(i,s|Tg.Audio|o)}else n?"audio"===n?t.set(i,Tg.Audio):"video"===n&&t.set(i,o):t.set(i,Tg.Audio|o)}try{let t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),gA.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(e=>{let{user:t,mediaType:r}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(r,";")}).join()))}catch(e){if(e.code===vA.DISCONNECT_P2P)return void gA.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw gA.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){(function(e){if(!e)throw new vm(vA.INVALID_PARAMS);vy(e.width)||vS(e.width,"streamParameter.width"),vy(e.height)||vS(e.height,"streamParameter.height"),vy(e.framerate)||vS(e.framerate,"streamParameter.framerate"),vy(e.bitrate)||vg(e.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&gA.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),gA.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,TD.LocalVideoLowTrack)}async enableDualStream(){if(!gR.supportDualStream)throw gT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new gy(vA.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new gy(vA.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw gT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,gT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),gA.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(TD.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw gT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,gT.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),gA.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(vE(e,"role",["audience","host"]),t&&vG(t),"rtc"===this.mode||"p2p"===this.mode)throw gA.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new gy(vA.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new gy(vA.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new gy(vA.INVALID_OPERATION,"can not set client role to audience when publishing stream");let r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&E4("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",vH.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),gA.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode||"audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&vG(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{gA.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(vb(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new gy(vA.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,gT.setProxyServer(this._proxyServer),gA.setProxyServer(this._proxyServer),gA.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new gy(vA.INVALID_OPERATION,"You have already set the proxy")}if(vF(e))return this._turnServer={servers:e,mode:"original-manual"},void gA.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(e=>e.urls).join(","),"."));e.forEach(e=>vj(e)),this._turnServer={servers:e,mode:"manual"},gA.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"you should set license before join channel");if(vb(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new gy(vA.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,gA.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){let t;if("DISCONNECTED"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new gy(vA.INVALID_OPERATION,"You have already set the proxy");switch(void 0===e&&(e=3),e){case 1:case 2:throw new gy(vA.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new gy(vA.INVALID_PARAMS,"proxy server mode must be ".concat("3|4|5"))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,gA.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"Stop proxy server after leave channel");gT.setProxyServer(),gA.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",gA.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new gy(vA.INVALID_PARAMS,"accessPoints is required.");vT(e.accessPoints.serverList,"accessPoints.serverList"),vb(e.accessPoints.domain,"accessPoints.domain");let t=(e,t)=>{vg(e,t,0,65535,!0)},r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new gy(vA.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");E4("CLOSE_AFB_FOR_LOCAL_AP")&&(E1("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),E1("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,n=e.accessPoints.domain,o=e.accessPoints.serverList.map(e=>i.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(n):e),a=o.map(e=>"".concat(e,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,E1("WEBCS_DOMAIN",a),E1("WEBCS_DOMAIN_BACKUP_LIST",a),E1("GATEWAY_DOMAINS",[n]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(vT(e.report.hostname,"report.hostname"),E1("EVENT_REPORT_DOMAIN",e.report.hostname[0]),E1("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(E1("EVENT_REPORT_DOMAIN",o[0]),E1("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),E1("STATS_COLLECTOR_PORT",s),e.report?E1("ENABLE_EVENT_REPORT",!0):E1("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(vT(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let d=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),d=e.log.port),E1("LOG_UPLOAD_SERVER","".concat(c,":").concat(d));let u=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(vT(e.cds.hostname,"cds.hostname"),u=e.cds.hostname):u=o;let l=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),l=e.cds.port),E1("CDS_AP",u.map(e=>"".concat(e,":").concat(l))),e.cds?E1("ENABLE_CONFIG_DISTRIBUTE",!0):E1("ENABLE_CONFIG_DISTRIBUTE",!1),gA.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(vT(e,"serverList"),vb(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new gy(vA.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,E1("WEBCS_DOMAIN",e),E1("WEBCS_DOMAIN_BACKUP_LIST",e),E1("GATEWAY_DOMAINS",[t]),E1("EVENT_REPORT_DOMAIN",e[0]),E1("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),E1("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),gA.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(vE(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw gA.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else gA.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){vE(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let t=this._users.find(t=>t.uid===e);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(e){throw gA.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}gA.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){vE(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw gA.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}gA.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,i){vE(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),vb(t,"secret");let n=["aes-128-gcm2","aes-256-gcm2"];if(o0(n).call(n,e)){if(!r||!(r instanceof Uint8Array&&32===r.length))throw new gy(vA.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new gy(vA.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(vv(i,"encryptDataStream"),!o0(n).call(n,e))throw new gy(vA.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||gA.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=v8(r))}async renewToken(e){if(vb(e,"token",1,2047),!this._key||!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let r=await this._renewTokenMutex.lock();try{if(E4("USE_NEW_TOKEN")){gA.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let t=await Rk(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||E_);gA.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else gA.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});gA.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,gA.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?gA.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(vW.VOLUME_INDICATOR,e)},E4("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new gy(vA.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new gy(vA.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new gy(vA.LIVE_STREAMING_TASK_CONFLICT);let r=t?Tn.TRANSCODE:Tn.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(Tn.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(e));if(!t.length)throw new gy(vA.INVALID_PARAMS,"can not find live streaming url to stop");await dJ.all(t.map(t=>t&&t.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){RV(e);let t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){RV(e);let t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){let e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof II&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){let t=new TextEncoder;e.payload=t.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&o0(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await async function(e,t,r){var i;let n=ae(i=Array.from(r)).call(i,(e,t)=>e+t,0),o={serverTs:0,seq:E9++,length:r.length,checkSum:n},a=new Uint8Array(Ec(n,2)),s=new ArrayBuffer(10),c=new DataView(s);c.setUint32(0,o.serverTs),c.setUint16(4,o.seq),c.setUint16(6,o.length),c.setUint16(8,o.checkSum);let d=16-r.length%16;r=v9(r,new Uint8Array(d));let u=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:128,additionalData:a},t,r);return v9(new Uint8Array(s),new Uint8Array(u))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new gy(vA.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(b5.DATA_STREAM,{payload:v8(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-IO},!r)}sendMetadata(e){if(!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new gy(vA.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(b5.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:v8(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(gm),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"can not send custom report, not joined");await gT.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){vE(t.spatialLayer,"spatialLayer",[0,1,2,3]),vE(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw gA.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:r}=e;if(vv(t,"apRTM"),vg(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,gA.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(gA.debug("[".concat(this._clientId,"] reset client")),function(e){let t=bL.indexOf(e);-1!==t&&bL.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=mU.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&IZ(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&gT.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(e=>e._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ep("client-publish",this._clientId),this._subscribeMutex=new Ep("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var r;let i=e||Ei();e?gA.debug("[".concat(this._clientId,"] new Session ").concat(i)):gA.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));let n=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,gT.addSid(i);let o={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(r=this._joinInfo)||void 0===r?void 0:r.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:n,clientRole:"audience"===this.role?2:1};gT.sessionInit(this._sessionId,Cb({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new gy(vA.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&E4("FORCE_TURN")&&!E4("TURN_ENABLE_TCP")&&!E4("TURN_ENABLE_UDP"))throw new gy(vA.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");gA.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let e=(await r.next()).value;if(e){try{await this._gateway.sendExtensionMessage(TH.PUBLISH,e,!0)}catch(e){throw r.throw(e),e}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let i=(await r.next()).value;if(i){var t;let e;try{e=await this._gateway.publish(this._uid,i,!0)}catch(e){if(e.code!==vA.DISCONNECT_P2P)throw r.throw(e),e}await r.next((null===(t=e)||void 0===t?void 0:t.ortc)||[])}for(let t of(this._p2pChannel.reportPublishEvent(!0,null),e))t instanceof S8&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch(e=>{gA.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===vA.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new gy(vA.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));gA.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await e.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(t){if(t.code!==vA.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=i)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===vA.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){let t=()=>{var e;if(!this._joinInfo||!this._appId)return new gy(vA.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=(e={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},yJ("LiveStreaming").create(e));return t.onLiveStreamError=(e,t)=>{gT.reportApiInvoke(this._sessionId,{name:vM.ON_LIVE_STREAM_ERROR,options:[e,t],tag:vx.TRACER}).onSuccess(),this.safeEmit(vW.LIVE_STREAMING_ERROR,e,t)},t.onLiveStreamWarning=(e,t)=>{gT.reportApiInvoke(this._sessionId,{name:vM.ON_LIVE_STREAM_WARNING,options:[e,t],tag:vx.TRACER}).onSuccess(),this.safeEmit(vW.LIVE_STREAMING_WARNING,e,t)},t.on(Tu.REQUEST_WORKER_MANAGER_LIST,(e,t,r)=>{if(!this._joinInfo)return r(new gy(vA.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,r,i){let n=E4("UAP_AP").slice(0,E4("AJAX_REQUEST_CONCURRENT")).map(e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap"));return await function(e,t,r,i,n){Rs+=1;let o={service_name:t,json_body:JSON.stringify({sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:Rs,requestId:Rs,version:EQ,cname:r.cname})},a,s,c=e[0];return Em(async()=>{var e,r;a=Date.now();let n=await y3(c,{data:o,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(s=Date.now()-a,0!==n.code){let e=new gy(vA.UNEXPECTED_RESPONSE,"live streaming ap error, code"+n.code,{retry:!0,responseTime:s});throw gA.error(e.toString()),e}let d=JSON.parse(n.json_body);if(200!==d.code){let e=new gy(vA.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(d.code,", reason: ").concat(d.reason),{code:d.code,responseTime:s});throw gA.error(e.toString()),e}if(!d.servers||0===d.servers.length){let e=new gy(vA.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:d.code,responseTime:s});throw gA.error(e.toString()),e}let u=(e=d,r=t,{addressList:e.servers.map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(E4("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(r))),workerToken:e.workerToken,vid:e.vid});return E4("LIVE_STREAMING_ADDRESS")&&(u.addressList=E4("LIVE_STREAMING_ADDRESS")instanceof Array?E4("LIVE_STREAMING_ADDRESS"):[E4("LIVE_STREAMING_ADDRESS")]),Ra(Ra({},u),{},{responseTime:s})},(i,n)=>(gT.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(i.addressList),firstSuccess:0===n,responseTime:s,serverIp:e[n%e.length]}),!1),(i,n)=>(gT.apworkerEvent(r.sid,{success:!1,sc:i.data&&i.data.code||200,serviceName:t,responseTime:s,serverIp:e[n%e.length]}),!!(i.code!==vA.OPERATION_ABORTED&&i.code!==vA.UNEXPECTED_RESPONSE||i.data&&i.data.retry)&&(c=e[(n+1)%e.length],!0)),n)}(n,e,t,r,i)})(e,this._joinInfo,this._axiosCancelSource.token,E_).then(t).catch(r)}),t};return e===Tn.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){var e;if(!this._joinInfo)return new gy(vA.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},yJ("ChannelMediaRelay").create(e));i.on("state",e=>{e===T_.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(vW.CHANNEL_MEDIA_RELAY_STATE,e)}),i.on("event",e=>{this.safeEmit(vW.CHANNEL_MEDIA_RELAY_EVENT,e)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(e,t)=>{var r;"resolution"===e&&(null===(r=this._channelMediaRelayClient)||void 0===r||r.setVideoProfile(t))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:r,deleted:i}=e,n=[];if(t){let e=[];this._users.forEach(t=>{t._dataChannels.forEach(i=>{r.every(e=>e.uid!==t._uintid||e.stream_id!==i.id)&&e.push({uid:t._uintid,stream_id:i.id,ordered:i.ordered,max_retrans_times:i.maxRetransmits,metadata:i.metadata})})}),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(r)&&r.length>0&&r.forEach(e=>{let{uid:r,stream_id:i,ordered:o,max_retrans_times:a,metadata:s}=e,c=this._users.find(e=>e._uintid===r);if(!c)return void gA.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(gA.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(r)),o0(n).call(n,c)||n.push(c),c._uintid||(c._uintid=r),!(-1!==c._dataChannels.findIndex(t=>t.id===e.stream_id))){let e={id:i,ordered:!!o,maxRetransmits:a,metadata:s},r=yq(e,!0);c._dataChannels.push(r),gA.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(vW.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(gA.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch(e=>{gA.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())}))}),t&&(this.safeEmit(vW.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(e=>{let{uid:t,stream_id:r}=e,i=this._users.find(e=>e._uintid===t);if(!i)return void gA.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let n=i._dataChannels.find(t=>t.id===e.stream_id);n&&(gA.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(i,[n]).then(e=>{if(i._dataChannels=i._dataChannels.filter(e=>e!==n),e)return this._gateway.unsubscribeDataChannel(e,i.uid)}),gA.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(n.id)),this.safeEmit(vW.USER_UNPUBLISHED,i,"datachannel",n._config))})}_handleRemoveDataChannels(e){let t=this._users.find(t=>t.uid===e.uid);if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){gA.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)}),(()=>{gA.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(e=>{this.safeEmit(vW.USER_UNPUBLISHED,t,"datachannel",e._config)})})()}}else gA.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Tv.UPDATE_GATEWAY_CONFIG,()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void gA.error("Error loading sdk config",e.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(e=>{let{value:i,type:n,expires:o}=t[e];o&&o<=r||n||bx()||!Object.prototype.hasOwnProperty.call(Eq,e)||(E3[e]=i,E2[e]=i,gA.debug("Update gateway parameters from config distribute",e,i))})}catch(e){gA.error("Error update config from local cache",e.message)}}()}),this._gateway.on(Tv.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Tv.CONNECTION_STATE_CHANGE,(e,t,r)=>{var i,n;if(r===vV.FALLBACK)return;let o=()=>{this.safeEmit(vW.CONNECTION_STATE_CHANGE,e,t,r)};if(gT.reportApiInvoke(this._sessionId||(null===(i=this._gateway.joinInfo)||void 0===i?void 0:i.sid)||null,{name:vM.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:vx.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),gA.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void o();"RECONNECTING"===e?(this._users.forEach(e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0):"CONNECTED"===e&&(this._streamFallbackTypeCacheMap.forEach((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>{gA.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)})}),this._remoteStreamTypeCacheMap.forEach((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>{gA.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(n=this._joinInfo)||void 0===n?void 0:n.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{gA.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(e=>{gA.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(e=>!e._trust_in_room_).forEach(e=>{gA.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(e=>{e._trust_audio_mute_state_||(gA.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,Tw.AUDIO,!1)),e._trust_video_mute_state_||(gA.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,Tw.VIDEO,!1)),e._trust_audio_enabled_state_||(gA.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(gA.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(gA.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(gA.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(gA.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3))),o()}),this._gateway.on(Tv.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new gy(vA.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;let r=await IX(Cb(Cb({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(t=r.ap,I$(r),this._joinInfo.preload=!0):(t=await Rg(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||E_,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);let i=[];t.gatewayInfo.gatewayAddrs.forEach(e=>{let{address:t}=e,[r,n]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:r,port:n}):i.push({host:r,port:n})}),e(i)}catch(e){t(e)}}),this._gateway.on(Tv.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(vW.NETWORK_QUALITY,e)}),this._gateway.on(Tv.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(vW.STREAM_TYPE_CHANGED,e,t),gT.reportApiInvoke(this._sessionId,{name:vM.STREAM_TYPE_CHANGE,options:[e,t],tag:vx.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Tv.IS_P2P_DISCONNECTED,e=>{e(!!this._p2pChannel.isP2PDisconnected()||!(this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia())&&!0)}),this._gateway.on(Tv.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let r=await this._p2pChannel.getEstablishParams();E4("ENABLE_PREALLOC_PC")&&r||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(e){r(e)}}),this._gateway.on(Tv.JOIN_RESPONSE,(e,t)=>{let r;if(this.store.useP2P)return;e.attributes?r=e.attributes.userAttributes.preSubSsrcs:gA.debug("no attributes in joinResponse");let i=yI(e.ortc,t,r);this._p2pChannel.connect(i)}),this._gateway.on(Tv.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:e,cid:n}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(n,"_").concat(e),icePwd:"".concat(n,"_").concat(e)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(i=E4("FINGERPRINT"))&&void 0!==i?i:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(b7.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(b7.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(b7.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(b7.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(b7.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(b7.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(b7.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(b7.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(b7.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,Tw.AUDIO,!0)),this._gateway.signal.on(b7.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,Tw.AUDIO,!1)),this._gateway.signal.on(b7.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,Tw.VIDEO,!0)),this._gateway.signal.on(b7.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,Tw.VIDEO,!1)),this._gateway.signal.on(b7.RECEIVE_METADATA,e=>{let t=v3(e.metadata);this.safeEmit(vW.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(b7.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=v3(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&o0(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<10)throw new gy(vA.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(10));r=await async function(e,t,r){let i=r.subarray(0,10),n=i.slice(8,10),o=(n[0]<<8)+n[1],a=(i[6]<<8)+i[7],s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:128,additionalData:new Uint8Array(Ec(o,2))},t,r.subarray(10));return new Uint8Array(s).subarray(0,a)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let i=0;if(e.ordered||e.syncWithAudio){let t=this._p2pChannel.getStats(),r=this.remoteUsers.find(t=>t.uid===e.uid),n=null==t?void 0:t.audioRecv.find(e=>e.ssrc===(null==r?void 0:r._audioSSRC));i=null==n?void 0:n.jitterBufferMs}(null==i||Number.isNaN(i))&&(i=0),function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return IL(i,{uid:e.uid,payload:e.payload});let n="".concat(i.id,"-").concat(e.uid),o=IN.get(n)||[],a=o.findIndex(t=>e.sendTs>=t.sendTs),s=Iw(Iw({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});-1===a?o.push(s):o.splice(a,0,s),IN.set(n,o);let c=!1;IP.has(n)?c=!(null===(t=IP.get(n))||void 0===t||!t.isSyncing):IP.set(n,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||ID(n)}(Cb(Cb({},e),{},{payload:r}),i,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(b7.ON_CRYPT_ERROR,()=>{v6(()=>{gA.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(vW.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(b7.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(b7.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{gA.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,vV.TOKEN_EXPIRE),this.safeEmit(vW.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(b7.ON_STREAM_FALLBACK_UPDATE,e=>{gA.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(vW.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(b7.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),gA.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(b7.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(b7.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(b8.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case b5.PUBLISH:{if(!t)return;let e=t.ortc;if(e){var r,i;let n=e.some(e=>{let{stream_type:t}=e;return t===Tm.Audio}),o=e.some(e=>{let{stream_type:t}=e;return t!==Tm.Audio}),a=e.some(e=>{let{stream_type:t}=e;return t===Tm.Screen||t===Tm.ScreenLow});"offer"===t.state&&gT.publish(this._joinInfo.sid,{eventElapse:RL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:vA.TIMEOUT,audio:n,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:n?null===(r=e.find(e=>{let{stream_type:t}=e;return t===Tm.Audio}))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0,videoName:o?null===(i=e.find(e=>{let{stream_type:t}=e;return t!==Tm.Audio}))||void 0===i||null===(i=i.ssrcs[0])||void 0===i?void 0:i.ssrcId.toString():void 0})}break}case b5.SUBSCRIBE:t&&gT.subscribe(this._joinInfo.sid,{succ:!1,ec:vA.TIMEOUT,audio:t.stream_type===Tw.AUDIO,video:t.stream_type===Tw.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:RL.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(b7.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(b7.ON_PUBLISHED_USER_LIST,e=>{if(null==e||!e.users)return;E4("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(e=>!bM(e.string_id||e.stream_id,this.channelName)));let t=[],r=[];for(let i of e.users){let e=this._users.find(e=>e._uintid===i.stream_id);e?e._trust_in_room_=!0:(e=new RF(i.string_id||i.stream_id,i.stream_id),this._users.push(e),0===this.getListeners(vW.PUBLISHED_USER_LIST).length&&(gA.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(vW.USER_JOINED,e)));let n=Tg.Audio&i.stream_type,o=(Tg.Video|Tg.LwoVideo)&i.stream_type,a=0!=(65280&i.stream_type),s=n&&e.hasAudio,c=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=i.video_ssrc,e._rtxSsrcId=i.video_rtx),n&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=i.audio_ssrc),n&&!s&&0===this.getListeners(vW.PUBLISHED_USER_LIST).length&&(gA.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(vW.USER_PUBLISHED,e,"audio")),o&&!c&&0===this.getListeners(vW.PUBLISHED_USER_LIST).length&&(gA.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(vW.USER_PUBLISHED,e,"video")),(n&&!s||o&&!c||a)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&r.push({user:e,mediaType:"video"}),n&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&r.push({user:e,mediaType:"audio"})}r.length>0&&(gA.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(e=>{gA.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())})),this.getListeners(vW.PUBLISHED_USER_LIST).length>0?E4("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(gA.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(e=>e.uid).join(", "))),this.safeEmit(vW.PUBLISHED_USER_LIST,t)):gA.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(e=>e.uid).join(", ")))}),this._gateway.signal.on(b7.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof II&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(e=>e.toLowerCase()).filter(e=>{var t;return o0(t=Object.keys(E5)).call(t,e)}))})}_handleP2PEvents(){this._gateway.signal.on(b7.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(TH.PUBLISH,(e,t,r)=>{let{uid:i}=e;e.forEach(e=>{let{kind:n,ssrcs:o,mid:a,isMuted:s}=e;this._handleP2PAddAudioOrVideoStream(n,i,o[0].ssrcId,a);let c=this._users.find(e=>e.uid===i);return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,n,o[0].ssrcId,a).then(()=>{t()}).catch(r):t(),this._handleMuteStream(i,n,!!s)})}),this._gateway.signal.on(TH.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:null===(i=this._joinInfo)||void 0===i?void 0:i.turnServer},e))}catch(e){r(e)}}),this._gateway.signal.on(b8.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(TH.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){let{unpubMsg:i,uid:n}=e,o=this._users.find(e=>e.uid===n);if(!o)return gA.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n)),void t();try{i.forEach(async e=>{let{stream_type:t}=e,r=t===Tm.Audio?Tw.AUDIO:Tw.VIDEO;await this._p2pChannel.unsubscribe(o,r),this._handleMuteStream(n,r,!0)}),t()}catch(e){r(e)}}}),this._gateway.signal.on(TH.CONTROL,async(e,t)=>{let{action:r}=e;switch(r){case TK.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Tw.VIDEO,!0);break;case TK.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Tw.AUDIO,!0);break;case TK.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Tw.VIDEO,!1);break;case TK.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Tw.AUDIO,!1)}}),this._gateway.signal.on(TH.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{let{direction:r,iceParameter:i}=e;r!==Te.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(e){r(e)}}),this._gateway.signal.on(TH.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(TM.RequestP2PRestartICE,async(e,t,r)=>{try{let{direction:r}=e;t(await this._gateway.sendExtensionMessage(TH.RESTART_ICE,e,r===Te.SEND_ONLY))}catch(e){r(e)}}),this._p2pChannel.on(TM.LocalCandidate,e=>{this._gateway.sendExtensionMessage(TH.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(TM.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(TH.CONTROL,e,!0),t()}catch(e){r(e)}}),this._p2pChannel.on(TM.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===vA.DISCONNECT_P2P?t():r(e)}else t()}),this._p2pChannel.on(TM.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===vA.DISCONNECT_P2P?t():r(e)}else t()}),this._p2pChannel.on(TM.StateChange,(e,t)=>{t===TL.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(TM.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(vW.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(TM.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===vA.DISCONNECT_P2P?t():r(e)}else t()}),this._p2pChannel.on(TM.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===vA.DISCONNECT_P2P?t():r(e)}else t()}),this._p2pChannel.on(TM.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(TM.RequestRePublishDataChannel,(e,t,r)=>{dJ.all(e.map(async e=>{let t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach(e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)})}catch(e){if(e.code!==vA.DISCONNECT_P2P)throw e}})).then(t).catch(r)}),this._p2pChannel.on(TM.RequestReSubscribe,async(e,t,r)=>{try{for(let{user:t,kind:r}of e)r===Tw.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){r(e)}}),this._p2pChannel.on(TM.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(TM.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(TM.MediaReconnectStart,e=>{this.safeEmit(vW.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(TM.MediaReconnectEnd,e=>{this.safeEmit(vW.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(TM.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(TM.RequestRestartICE,async e=>{let t;if(this.store.useP2P)return;let r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;let n=i.value;try{t=await this._gateway.restartICE({iceParameters:n})}catch(e){return void r.throw(e)}let{iceParameters:o}=function(e){let t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(t);await r.next({remoteIceParameters:o})}),this._p2pChannel.on(TM.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(TM.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:n,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:i}),a=yI(n,o);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(TM.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(TM.P2PLost,()=>{this.safeEmit(vW.P2P_LOST,this.store.uid)}),this._p2pChannel.on(TM.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(TM.ConnectionTypeChange,e=>{this.safeEmit(vW.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(TM.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(TM.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(TM.AudioMetadata,e=>{this.safeEmit(vW.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){var t;if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let r=(t={config:e},yJ("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);let{appId:i,cname:n,sid:o,token:a,uid:s,cid:c,vid:d}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:n,sid:o,token:a,uid:s,cid:c,vid:d?Number(d):0},E_)}catch(e){throw Array.isArray(e)?e[0]:e}}handleVideoInspectEvents(e){e.on(TB.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(vW.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===Tx.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(vW.CONTENT_INSPECT_ERROR,new gy(vA.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(TB.INSPECT_RESULT,(e,t)=>{var r;if((null==t?void 0:t.code)===vA.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return gA.debug("Stop inspect content because that has left channel"),null==this||null===(r=this._inspect)||void 0===r||r.close(),void(this._inspect=void 0);this.safeEmit(vW.CONTENT_INSPECT_RESULT,e,t)}),e.on(TB.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}async disableContentInspect(){if(!this._inspect)throw new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(vv(e,"enabled"),e){if(!t)throw new gy(vA.INVALID_PARAMS,"config is required");if(Cg(t),!this._joinInfo)throw new gy(vA.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let e=(r={config:t},yJ("ImageModeration").create(r));this._moderation=e,this.handleImageModerationEvents(e);let{appId:i,cname:n,sid:o,token:a,uid:s,cid:c,vid:d}=this._joinInfo;await e.init({appId:i,areaCode:"",cname:n,sid:o,token:a,uid:s,cid:c,vid:d?Number(d):0},E_)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var r;if(!this._moderation)throw new gy(vA.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(TG.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(vW.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===Tj.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new gy(vA.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(TG.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}setP2PTransport(e){if(vE(e,"transport",["default","auto","relay","sd-rtn"]),"p2p"!==this.mode)throw new gy(vA.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,gA.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return gA.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){vv(e,"enabled"),E1("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[rj],Object.getOwnPropertyDescriptor(ig.prototype,"leave"),ig.prototype),b$(ig.prototype,"publish",[rG],Object.getOwnPropertyDescriptor(ig.prototype,"publish"),ig.prototype),b$(ig.prototype,"unpublish",[rW],Object.getOwnPropertyDescriptor(ig.prototype,"unpublish"),ig.prototype),b$(ig.prototype,"subscribe",[rH],Object.getOwnPropertyDescriptor(ig.prototype,"subscribe"),ig.prototype),b$(ig.prototype,"presubscribe",[rY],Object.getOwnPropertyDescriptor(ig.prototype,"presubscribe"),ig.prototype),b$(ig.prototype,"massSubscribe",[rK],Object.getOwnPropertyDescriptor(ig.prototype,"massSubscribe"),ig.prototype),b$(ig.prototype,"unsubscribe",[rQ],Object.getOwnPropertyDescriptor(ig.prototype,"unsubscribe"),ig.prototype),b$(ig.prototype,"massUnsubscribe",[rz],Object.getOwnPropertyDescriptor(ig.prototype,"massUnsubscribe"),ig.prototype),b$(ig.prototype,"setLowStreamParameter",[rX],Object.getOwnPropertyDescriptor(ig.prototype,"setLowStreamParameter"),ig.prototype),b$(ig.prototype,"enableDualStream",[rJ],Object.getOwnPropertyDescriptor(ig.prototype,"enableDualStream"),ig.prototype),b$(ig.prototype,"disableDualStream",[rq],Object.getOwnPropertyDescriptor(ig.prototype,"disableDualStream"),ig.prototype),b$(ig.prototype,"setClientRole",[rZ],Object.getOwnPropertyDescriptor(ig.prototype,"setClientRole"),ig.prototype),b$(ig.prototype,"_setClientRoleOptions",[r$],Object.getOwnPropertyDescriptor(ig.prototype,"_setClientRoleOptions"),ig.prototype),b$(ig.prototype,"setProxyServer",[r0],Object.getOwnPropertyDescriptor(ig.prototype,"setProxyServer"),ig.prototype),b$(ig.prototype,"setTurnServer",[r2],Object.getOwnPropertyDescriptor(ig.prototype,"setTurnServer"),ig.prototype),b$(ig.prototype,"setLicense",[r1],Object.getOwnPropertyDescriptor(ig.prototype,"setLicense"),ig.prototype),b$(ig.prototype,"startProxyServer",[r4],Object.getOwnPropertyDescriptor(ig.prototype,"startProxyServer"),ig.prototype),b$(ig.prototype,"stopProxyServer",[r6],Object.getOwnPropertyDescriptor(ig.prototype,"stopProxyServer"),ig.prototype),b$(ig.prototype,"setLocalAccessPointsV2",[r3],Object.getOwnPropertyDescriptor(ig.prototype,"setLocalAccessPointsV2"),ig.prototype),b$(ig.prototype,"setLocalAccessPoints",[r8],Object.getOwnPropertyDescriptor(ig.prototype,"setLocalAccessPoints"),ig.prototype),b$(ig.prototype,"setRemoteDefaultVideoStreamType",[r5],Object.getOwnPropertyDescriptor(ig.prototype,"setRemoteDefaultVideoStreamType"),ig.prototype),b$(ig.prototype,"setRemoteVideoStreamType",[r9],Object.getOwnPropertyDescriptor(ig.prototype,"setRemoteVideoStreamType"),ig.prototype),b$(ig.prototype,"setStreamFallbackOption",[r7],Object.getOwnPropertyDescriptor(ig.prototype,"setStreamFallbackOption"),ig.prototype),b$(ig.prototype,"setEncryptionConfig",[ie],Object.getOwnPropertyDescriptor(ig.prototype,"setEncryptionConfig"),ig.prototype),b$(ig.prototype,"renewToken",[it],Object.getOwnPropertyDescriptor(ig.prototype,"renewToken"),ig.prototype),b$(ig.prototype,"enableAudioVolumeIndicator",[ir],Object.getOwnPropertyDescriptor(ig.prototype,"enableAudioVolumeIndicator"),ig.prototype),b$(ig.prototype,"startLiveStreaming",[ii],Object.getOwnPropertyDescriptor(ig.prototype,"startLiveStreaming"),ig.prototype),b$(ig.prototype,"setLiveTranscoding",[io],Object.getOwnPropertyDescriptor(ig.prototype,"setLiveTranscoding"),ig.prototype),b$(ig.prototype,"stopLiveStreaming",[ia],Object.getOwnPropertyDescriptor(ig.prototype,"stopLiveStreaming"),ig.prototype),b$(ig.prototype,"startChannelMediaRelay",[is],Object.getOwnPropertyDescriptor(ig.prototype,"startChannelMediaRelay"),ig.prototype),b$(ig.prototype,"updateChannelMediaRelay",[ic],Object.getOwnPropertyDescriptor(ig.prototype,"updateChannelMediaRelay"),ig.prototype),b$(ig.prototype,"stopChannelMediaRelay",[id],Object.getOwnPropertyDescriptor(ig.prototype,"stopChannelMediaRelay"),ig.prototype),b$(ig.prototype,"sendCustomReportMessage",[iu],Object.getOwnPropertyDescriptor(ig.prototype,"sendCustomReportMessage"),ig.prototype),b$(ig.prototype,"pickSVCLayer",[il],Object.getOwnPropertyDescriptor(ig.prototype,"pickSVCLayer"),ig.prototype),b$(ig.prototype,"setRTMConfig",[ih],Object.getOwnPropertyDescriptor(ig.prototype,"setRTMConfig"),ig.prototype),b$(ig.prototype,"enableContentInspect",[ip],Object.getOwnPropertyDescriptor(ig.prototype,"enableContentInspect"),ig.prototype),b$(ig.prototype,"disableContentInspect",[i_],Object.getOwnPropertyDescriptor(ig.prototype,"disableContentInspect"),ig.prototype),b$(ig.prototype,"setImageModeration",[iA],Object.getOwnPropertyDescriptor(ig.prototype,"setImageModeration"),ig.prototype),b$(ig.prototype,"setP2PTransport",[im],Object.getOwnPropertyDescriptor(ig.prototype,"setP2PTransport"),ig.prototype),b$(ig.prototype,"getJoinChannelServiceRecords",[iv],Object.getOwnPropertyDescriptor(ig.prototype,"getJoinChannelServiceRecords"),ig.prototype),b$(ig.prototype,"setPublishAudioFilterEnabled",[iE],Object.getOwnPropertyDescriptor(ig.prototype,"setPublishAudioFilterEnabled"),ig.prototype),ig);class Cy{constructor(e,t){Aa(this,"id",0),Aa(this,"element",void 0),Aa(this,"peerPair",void 0),Aa(this,"context",void 0),Aa(this,"audioPlayerElement",void 0),Aa(this,"audioTrack",void 0),Cy.count+=1,this.id=Cy.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{let t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;let e=async(e,t)=>{let r="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(r),"complete"===e.iceGatheringState?e.localDescription:new dJ(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})},t=async(e,t)=>await e.setRemoteDescription(t);try{let r=await e(this.peerPair[0],"offer");await t(this.peerPair[1],r);let i=await e(this.peerPair[1],"answer");await t(this.peerPair[0],i)}catch(e){throw new gy(vA.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){let t;if(this.audioTrack)return this.audioTrack;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new gy(vA.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new gy(vA.LOCAL_AEC_ERROR,"no dest node when local aec").print();let r=t.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){gA.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}Aa(Cy,"count",0);let CR=window.AudioContext||window.webkitAudioContext,CI=new(iS=gb({report:gT}),b$((ib=class{constructor(){Aa(this,"units",[]),Aa(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return gA.debug("the system does not need to process local aec"),-1;this.context||(this.context=new CR);let t=this.units.find(t=>t&&t.getElement()===e);return t||(t=new Cy(e,this.context),this.units.push(t)),t.startEchoCancellation(),gA.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return mz().name!==mH.SAFARI}}).prototype,"processExternalMediaAEC",[iS],Object.getOwnPropertyDescriptor(ib.prototype,"processExternalMediaAEC"),ib.prototype),ib);function CC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function Ck(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?CC(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CC(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let Cw=window||document;function CO(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Cw)return;let r=OZ._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);let i=e=>{if(!(e&&e.blockedURI&&(OZ.onSecurityPolicyViolation||OZ.getListeners(TF.SECURITY_POLICY_VIOLATION).length>0)))return;let t=e.blockedURI;E4("CSP_DETECTED_HOSTNAME_LIST").some(e=>o0(t).call(t,e))&&(OZ.onSecurityPolicyViolation&&"function"==typeof OZ.onSecurityPolicyViolation&&OZ.onSecurityPolicyViolation(e),OZ.getListeners(TF.SECURITY_POLICY_VIOLATION).length>0&&OZ.safeEmit(TF.SECURITY_POLICY_VIOLATION,e))};r&&Cw.removeEventListener("securitypolicyviolation",r),(t||e&&"function"==typeof e||OZ.getListeners(TF.SECURITY_POLICY_VIOLATION).length>0)&&Cw.addEventListener("securitypolicyviolation",i),OZ._cspEventHandlerPointer=i}var CN=RegExp.prototype,CP=iB(function(e){return e===CN||iY(CN,e)?AE(e):e.flags});function CD(e){let t=e.length;for(;--t>=0;)e[t]=0}let CL=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),CM=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Cx=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),CU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),CB=Array(576);CD(CB);let CV=Array(60);CD(CV);let CF=Array(512);CD(CF);let Cj=Array(256);CD(Cj);let CG=Array(29);CD(CG);let CW=Array(30);function CH(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}function CY(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}CD(CW);let CK=e=>e<256?CF[e]:CF[256+(e>>>7)],CQ=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Cz=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,CQ(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},CX=(e,t,r)=>{Cz(e,r[2*t],r[2*t+1])},CJ=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},Cq=(e,t,r)=>{let i=Array(16),n,o,a=0;for(n=1;n<=15;n++)a=a+r[n-1]<<1,i[n]=a;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=CJ(i[t]++,t))}},CZ=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},C$=e=>{e.bi_valid>8?CQ(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},C0=(e,t,r,i)=>{let n=2*t,o=2*r;return e[n]<e[o]||e[n]===e[o]&&i[t]<=i[r]},C2=(e,t,r)=>{let i=e.heap[r],n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&C0(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!C0(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i},C1=(e,t,r)=>{let i,n,o,a,s=0;if(0!==e.sym_next)do i=(255&e.pending_buf[e.sym_buf+s++])+((255&e.pending_buf[e.sym_buf+s++])<<8),n=e.pending_buf[e.sym_buf+s++],0===i?CX(e,n,t):(CX(e,(o=Cj[n])+256+1,t),0!==(a=CL[o])&&Cz(e,n-=CG[o],a),CX(e,o=CK(--i),r),0!==(a=CM[o])&&Cz(e,i-=CW[o],a));while(s<e.sym_next);CX(e,256,t)},C4=(e,t)=>{let r=t.dyn_tree,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.elems,a,s,c,d=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<o;a++)0!==r[2*a]?(e.heap[++e.heap_len]=d=a,e.depth[a]=0):r[2*a+1]=0;for(;e.heap_len<2;)r[2*(c=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[c]=0,e.opt_len--,n&&(e.static_len-=i[2*c+1]);for(t.max_code=d,a=e.heap_len>>1;a>=1;a--)C2(e,r,a);c=o;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],C2(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,r[2*c]=r[2*a]+r[2*s],e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,r[2*a+1]=r[2*s+1]=c,e.heap[1]=c++,C2(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{let r=t.dyn_tree,i=t.max_code,n=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length,d,u,l,h,p,f,_=0;for(h=0;h<=15;h++)e.bl_count[h]=0;for(r[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)(h=r[2*r[2*(u=e.heap[d])+1]+1]+1)>c&&(h=c,_++),r[2*u+1]=h,u>i||(e.bl_count[h]++,p=0,u>=s&&(p=a[u-s]),f=r[2*u],e.opt_len+=f*(h+p),o&&(e.static_len+=f*(n[2*u+1]+p)));if(0!==_){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,_-=2}while(_>0);for(h=c;0!==h;h--)for(u=e.bl_count[h];0!==u;)(l=e.heap[--d])>i||(r[2*l+1]!==h&&(e.opt_len+=(h-r[2*l+1])*r[2*l],r[2*l+1]=h),u--)}})(e,t),Cq(r,d,e.bl_count)},C6=(e,t,r)=>{let i,n,o=-1,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=t[2*(i+1)+1],++s<c&&n===a||(s<d?e.bl_tree[2*n]+=s:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=n,0===a?(c=138,d=3):n===a?(c=6,d=3):(c=7,d=4))},C3=(e,t,r)=>{let i,n,o=-1,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),i=0;i<=r;i++)if(n=a,a=t[2*(i+1)+1],!(++s<c&&n===a)){if(s<d)do CX(e,n,e.bl_tree);while(0!=--s);else 0!==n?(n!==o&&(CX(e,n,e.bl_tree),s--),CX(e,16,e.bl_tree),Cz(e,s-3,2)):s<=10?(CX(e,17,e.bl_tree),Cz(e,s-3,3)):(CX(e,18,e.bl_tree),Cz(e,s-11,7));s=0,o=n,0===a?(c=138,d=3):n===a?(c=6,d=3):(c=7,d=4)}},C8=!1,C5=(e,t,r,i)=>{Cz(e,0+(i?1:0),3),C$(e),CQ(e,r),CQ(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var C9={_tr_init:e=>{C8||((()=>{let e,r,o,a,s;let c=Array(16);for(o=0,a=0;a<28;a++)for(CG[a]=o,e=0;e<1<<CL[a];e++)Cj[o++]=a;for(Cj[o-1]=a,s=0,a=0;a<16;a++)for(CW[a]=s,e=0;e<1<<CM[a];e++)CF[s++]=a;for(s>>=7;a<30;a++)for(CW[a]=s<<7,e=0;e<1<<CM[a]-7;e++)CF[256+s++]=a;for(r=0;r<=15;r++)c[r]=0;for(e=0;e<=143;)CB[2*e+1]=8,e++,c[8]++;for(;e<=255;)CB[2*e+1]=9,e++,c[9]++;for(;e<=279;)CB[2*e+1]=7,e++,c[7]++;for(;e<=287;)CB[2*e+1]=8,e++,c[8]++;for(Cq(CB,287,c),e=0;e<30;e++)CV[2*e+1]=5,CV[2*e]=CJ(e,5);t=new CH(CB,CL,257,286,15),i=new CH(CV,CM,0,30,15),n=new CH([],Cx,0,19,7)})(),C8=!0),e.l_desc=new CY(e.dyn_ltree,t),e.d_desc=new CY(e.dyn_dtree,i),e.bl_desc=new CY(e.bl_tree,n),e.bi_buf=0,e.bi_valid=0,CZ(e)},_tr_stored_block:C5,_tr_flush_block:(e,t,r,i)=>{let n,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=0xf3ffc07f;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),C4(e,e.l_desc),C4(e,e.d_desc),a=(e=>{let t;for(C6(e,e.dyn_ltree,e.l_desc.max_code),C6(e,e.dyn_dtree,e.d_desc.max_code),C4(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*CU[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=n&&(n=o)):n=o=r+5,r+4<=n&&-1!==t?C5(e,t,r,i):4===e.strategy||o===n?(Cz(e,2+(i?1:0),3),C1(e,CB,CV)):(Cz(e,4+(i?1:0),3),((e,t,r,i)=>{let n;for(Cz(e,t-257,5),Cz(e,r-1,5),Cz(e,i-4,4),n=0;n<i;n++)Cz(e,e.bl_tree[2*CU[n]+1],3);C3(e,e.dyn_ltree,t-1),C3(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),C1(e,e.dyn_ltree,e.dyn_dtree)),CZ(e),i&&C$(e)},_tr_tally:(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Cj[r]+256+1)]++,e.dyn_dtree[2*CK(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{var t;Cz(e,2,3),CX(e,256,CB),16===(t=e).bi_valid?(CQ(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},C7=(e,t,r,i)=>{let n=65535&e|0,o=e>>>16&65535|0,a=0;for(;0!==r;){a=r>2e3?2e3:r,r-=a;do o=o+(n=n+t[i++]|0)|0;while(--a);n%=65521,o%=65521}return n|o<<16|0};let ke=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?0xedb88320^e>>>1:e>>>1;t[r]=e}return t})());var kt=(e,t,r,i)=>{let n=i+r;e^=-1;for(let r=i;r<n;r++)e=e>>>8^ke[255&(e^t[r])];return -1^e},kr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ki={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:kn,_tr_stored_block:ko,_tr_flush_block:ka,_tr_tally:ks,_tr_align:kc}=C9,{Z_NO_FLUSH:kd,Z_PARTIAL_FLUSH:ku,Z_FULL_FLUSH:kl,Z_FINISH:kh,Z_BLOCK:kp,Z_OK:kf,Z_STREAM_END:k_,Z_STREAM_ERROR:kA,Z_DATA_ERROR:km,Z_BUF_ERROR:kv,Z_DEFAULT_COMPRESSION:kE,Z_FILTERED:kg,Z_HUFFMAN_ONLY:kS,Z_RLE:kb,Z_FIXED:kT,Z_DEFAULT_STRATEGY:ky,Z_UNKNOWN:kR,Z_DEFLATED:kI}=ki,kC=573,kk=(e,t)=>(e.msg=kr[t],t),kw=e=>2*e-(e>4?9:0),kO=e=>{let t=e.length;for(;--t>=0;)e[t]=0},kN=e=>{let t,r,i,n=e.w_size;i=t=e.hash_size;do r=e.head[--i],e.head[i]=r>=n?r-n:0;while(--t);i=t=n;do r=e.prev[--i],e.prev[i]=r>=n?r-n:0;while(--t)},kP=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,kD=e=>{let t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},kL=(e,t)=>{ka(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,kD(e.strm)},kM=(e,t)=>{e.pending_buf[e.pending++]=t},kx=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},kU=(e,t,r,i)=>{let n=e.avail_in;return n>i&&(n=i),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),1===e.state.wrap?e.adler=C7(e.adler,t,n,r):2===e.state.wrap&&(e.adler=kt(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},kB=(e,t)=>{let r,i,n=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,d=e.window,u=e.w_mask,l=e.prev,h=e.strstart+258,p=d[o+a-1],f=d[o+a];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do if(d[(r=t)+a]===f&&d[r+a-1]===p&&d[r]===d[o]&&d[++r]===d[o+1]){o+=2,r++;do;while(d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&d[++o]===d[++r]&&o<h);if(i=258-(h-o),o=h-258,i>a){if(e.match_start=t,a=i,i>=s)break;p=d[o+a-1],f=d[o+a]}}while((t=l[t&u])>c&&0!=--n);return a<=e.lookahead?a:e.lookahead},kV=e=>{let t,r,i;let n=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-262)&&(e.window.set(e.window.subarray(n,n+n-r),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),kN(e),r+=n),0===e.strm.avail_in)break;if(t=kU(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=t,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=kP(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=kP(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)},kF=(e,t)=>{let r,i,n,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(r=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n||(n=e.strm.avail_out-n,r>(i=e.strstart-e.block_start)+e.strm.avail_in&&(r=i+e.strm.avail_in),r>n&&(r=n),r<o&&(0===r&&t!==kh||t===kd||r!==i+e.strm.avail_in)))break;a=t===kh&&r===i+e.strm.avail_in?1:0,ko(e,0,0,a),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,kD(e.strm),i&&(i>r&&(i=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,r-=i),r&&(kU(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===a);return(s-=e.strm.avail_in)&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==kd&&t!==kh&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(kU(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,o=(n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n)>e.w_size?e.w_size:n,((i=e.strstart-e.block_start)>=o||(i||t===kh)&&t!==kd&&0===e.strm.avail_in&&i<=n)&&(r=i>n?n:i,a=t===kh&&0===e.strm.avail_in&&r===i?1:0,ko(e,e.block_start,r,a),e.block_start+=r,kD(e.strm)),a?3:1)},kj=(e,t)=>{let r,i;for(;;){if(e.lookahead<262){if(kV(e),e.lookahead<262&&t===kd)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=kP(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=kB(e,r)),e.match_length>=3){if(i=ks(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=kP(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=kP(e,e.ins_h,e.window[e.strstart+1])}else i=ks(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(kL(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===kh?(kL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(kL(e,!1),0===e.strm.avail_out)?1:2},kG=(e,t)=>{let r,i,n;for(;;){if(e.lookahead<262){if(kV(e),e.lookahead<262&&t===kd)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=kP(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=kB(e,r),e.match_length<=5&&(e.strategy===kg||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,i=ks(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=kP(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(kL(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=ks(e,0,e.window[e.strstart-1]))&&kL(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=ks(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===kh?(kL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(kL(e,!1),0===e.strm.avail_out)?1:2};function kW(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}let kH=[new kW(0,0,0,0,kF),new kW(4,4,8,4,kj),new kW(4,5,16,8,kj),new kW(4,6,32,32,kj),new kW(4,4,16,16,kG),new kW(8,16,32,32,kG),new kW(8,16,128,128,kG),new kW(8,32,128,256,kG),new kW(32,128,258,1024,kG),new kW(32,258,258,4096,kG)];function kY(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=kI,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*kC),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),kO(this.dyn_ltree),kO(this.dyn_dtree),kO(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),kO(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),kO(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let kK=e=>{if(!e)return 1;let t=e.state;return t&&t.strm===e&&(42===t.status||57===t.status||69===t.status||73===t.status||91===t.status||103===t.status||113===t.status||666===t.status)?0:1},kQ=e=>{if(kK(e))return kk(e,kA);e.total_in=e.total_out=0,e.data_type=kR;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=-2,kn(t),kf},kz=e=>{var t;let r=kQ(e);return r===kf&&((t=e.state).window_size=2*t.w_size,kO(t.head),t.max_lazy_match=kH[t.level].max_lazy,t.good_match=kH[t.level].good_length,t.nice_match=kH[t.level].nice_length,t.max_chain_length=kH[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r},kX=(e,t,r,i,n,o)=>{if(!e)return kA;let a=1;if(t===kE&&(t=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),n<1||n>9||r!==kI||i<8||i>15||t<0||t>9||o<0||o>kT||8===i&&1!==a)return kk(e,kA);8===i&&(i=9);let s=new kY;return e.state=s,s.strm=e,s.status=42,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=r,kz(e)};var kJ={deflateInit2:kX,deflateSetHeader:(e,t)=>kK(e)||2!==e.state.wrap?kA:(e.state.gzhead=t,kf),deflate:(e,t)=>{if(kK(e)||t>kp||t<0)return e?kk(e,kA):kA;let r=e.state;if(!e.output||0!==e.avail_in&&!e.input||666===r.status&&t!==kh)return kk(e,0===e.avail_out?kv:kA);let i=r.last_flush;if(r.last_flush=t,0!==r.pending){if(kD(e),0===e.avail_out)return r.last_flush=-1,kf}else if(0===e.avail_in&&kw(t)<=kw(i)&&t!==kh)return kk(e,kv);if(666===r.status&&0!==e.avail_in)return kk(e,kv);if(42===r.status&&0===r.wrap&&(r.status=113),42===r.status){let t=kI+(r.w_bits-8<<4)<<8,i=-1;if(t|=(i=r.strategy>=kS||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(t|=32),kx(r,t+=31-t%31),0!==r.strstart&&(kx(r,e.adler>>>16),kx(r,65535&e.adler)),e.adler=1,r.status=113,kD(e),0!==r.pending)return r.last_flush=-1,kf}if(57===r.status){if(e.adler=0,kM(r,31),kM(r,139),kM(r,8),r.gzhead)kM(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),kM(r,255&r.gzhead.time),kM(r,r.gzhead.time>>8&255),kM(r,r.gzhead.time>>16&255),kM(r,r.gzhead.time>>24&255),kM(r,9===r.level?2:r.strategy>=kS||r.level<2?4:0),kM(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(kM(r,255&r.gzhead.extra.length),kM(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=kt(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(kM(r,0),kM(r,0),kM(r,0),kM(r,0),kM(r,0),kM(r,9===r.level?2:r.strategy>=kS||r.level<2?4:0),kM(r,3),r.status=113,kD(e),0!==r.pending)return r.last_flush=-1,kf}if(69===r.status){if(r.gzhead.extra){let t=r.pending,i=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+i>r.pending_buf_size;){let n=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=kt(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=n,kD(e),0!==r.pending)return r.last_flush=-1,kf;t=0,i-=n}let n=new Uint8Array(r.gzhead.extra);r.pending_buf.set(n.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending+=i,r.gzhead.hcrc&&r.pending>t&&(e.adler=kt(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,i=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i&&(e.adler=kt(e.adler,r.pending_buf,r.pending-i,i)),kD(e),0!==r.pending)return r.last_flush=-1,kf;i=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,kM(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>i&&(e.adler=kt(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,i=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i&&(e.adler=kt(e.adler,r.pending_buf,r.pending-i,i)),kD(e),0!==r.pending)return r.last_flush=-1,kf;i=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,kM(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>i&&(e.adler=kt(e.adler,r.pending_buf,r.pending-i,i))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(kD(e),0!==r.pending))return r.last_flush=-1,kf;kM(r,255&e.adler),kM(r,e.adler>>8&255),e.adler=0}if(r.status=113,kD(e),0!==r.pending)return r.last_flush=-1,kf}if(0!==e.avail_in||0!==r.lookahead||t!==kd&&666!==r.status){let i=0===r.level?kF(r,t):r.strategy===kS?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(kV(e),0===e.lookahead)){if(t===kd)return 1;break}if(e.match_length=0,r=ks(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(kL(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===kh?(kL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(kL(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===kb?((e,t)=>{let r,i,n,o;let a=e.window;for(;;){if(e.lookahead<=258){if(kV(e),e.lookahead<=258&&t===kd)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=a[n=e.strstart-1])===a[++n]&&i===a[++n]&&i===a[++n]){o=e.strstart+258;do;while(i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&n<o);e.match_length=258-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=ks(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=ks(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(kL(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===kh?(kL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(kL(e,!1),0===e.strm.avail_out)?1:2})(r,t):kH[r.level].func(r,t);if(3!==i&&4!==i||(r.status=666),1===i||3===i)return 0===e.avail_out&&(r.last_flush=-1),kf;if(2===i&&(t===ku?kc(r):t!==kp&&(ko(r,0,0,!1),t===kl&&(kO(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),kD(e),0===e.avail_out))return r.last_flush=-1,kf}return t!==kh?kf:r.wrap<=0?k_:(2===r.wrap?(kM(r,255&e.adler),kM(r,e.adler>>8&255),kM(r,e.adler>>16&255),kM(r,e.adler>>24&255),kM(r,255&e.total_in),kM(r,e.total_in>>8&255),kM(r,e.total_in>>16&255),kM(r,e.total_in>>24&255)):(kx(r,e.adler>>>16),kx(r,65535&e.adler)),kD(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?kf:k_)},deflateEnd:e=>{if(kK(e))return kA;let t=e.state.status;return e.state=null,113===t?kk(e,km):kf},deflateSetDictionary:(e,t)=>{let r=t.length;if(kK(e))return kA;let i=e.state,n=i.wrap;if(2===n||1===n&&42!==i.status||i.lookahead)return kA;if(1===n&&(e.adler=C7(e.adler,t,r,0)),i.wrap=0,r>=i.w_size){0===n&&(kO(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(r-i.w_size,r),0),t=e,r=i.w_size}let o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,kV(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do i.ins_h=kP(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++;while(--t);i.strstart=e,i.lookahead=2,kV(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,i.wrap=n,kf}};let kq=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var kZ={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let r=t.shift();if(r){if("object"!=typeof r)throw TypeError(r+"must be non-object");for(let t in r)kq(r,t)&&(e[t]=r[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;let r=new Uint8Array(t);for(let t=0,i=0,n=e.length;t<n;t++){let n=e[t];r.set(n,i),i+=n.length}return r}};let k$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){k$=!1}let k0=new Uint8Array(256);for(let e=0;e<256;e++)k0[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;k0[254]=k0[254]=1;var k2={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,i,n,o,a=e.length,s=0;for(n=0;n<a;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),o=0,n=0;o<s;n++)55296==(64512&(r=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=e.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?t[o++]=r:(r<2048?t[o++]=192|r>>>6:(r<65536?t[o++]=224|r>>>12:(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63),t[o++]=128|r>>>6&63),t[o++]=128|63&r);return t},buf2string:(e,t)=>{let r,i;let n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let o=Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){o[i++]=t;continue}let a=k0[t];if(a>4)o[i++]=65533,r+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&r<n;)t=t<<6|63&e[r++],a--;a>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&k$)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+k0[e[r]]>t?r:t}},k1=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let k4=Object.prototype.toString,{Z_NO_FLUSH:k6,Z_SYNC_FLUSH:k3,Z_FULL_FLUSH:k8,Z_FINISH:k5,Z_OK:k9,Z_STREAM_END:k7,Z_DEFAULT_COMPRESSION:we,Z_DEFAULT_STRATEGY:wt,Z_DEFLATED:wr}=ki;function wi(e){this.options=kZ.assign({level:we,method:wr,chunkSize:16384,windowBits:15,memLevel:8,strategy:wt},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k1,this.strm.avail_out=0;let r=kJ.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==k9)throw Error(kr[r]);if(t.header&&kJ.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?k2.string2buf(t.dictionary):"[object ArrayBuffer]"===k4.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=kJ.deflateSetDictionary(this.strm,e))!==k9)throw Error(kr[r]);this._dict_set=!0}}function wn(e,t){let r=new wi(t);if(r.push(e,!0),r.err)throw r.msg||kr[r.err];return r.result}wi.prototype.push=function(e,t){let r,i;let n=this.strm,o=this.options.chunkSize;if(this.ended)return!1;for(i=t===~~t?t:!0===t?k5:k6,"string"==typeof e?n.input=k2.string2buf(e):"[object ArrayBuffer]"===k4.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),(i===k3||i===k8)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if((r=kJ.deflate(n,i))===k7)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=kJ.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===k9;if(0!==n.avail_out){if(i>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},wi.prototype.onData=function(e){this.chunks.push(e)},wi.prototype.onEnd=function(e){e===k9&&(this.result=kZ.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var wo=function(e,t){let r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R;let I=e.state;r=e.next_in,y=e.input,i=r+(e.avail_in-5),n=e.next_out,R=e.output,o=n-(t-e.avail_out),a=n+(e.avail_out-257),s=I.dmax,c=I.wsize,d=I.whave,u=I.wnext,l=I.window,h=I.hold,p=I.bits,f=I.lencode,_=I.distcode,A=(1<<I.lenbits)-1,m=(1<<I.distbits)-1;e:do for(p<15&&(h+=y[r++]<<p,p+=8,h+=y[r++]<<p,p+=8),v=f[h&A];;){if(h>>>=E=v>>>24,p-=E,0==(E=v>>>16&255))R[n++]=65535&v;else{if(!(16&E)){if(0==(64&E)){v=f[(65535&v)+(h&(1<<E)-1)];continue}if(32&E){I.mode=16191;break e}e.msg="invalid literal/length code",I.mode=16209;break e}for(g=65535&v,(E&=15)&&(p<E&&(h+=y[r++]<<p,p+=8),g+=h&(1<<E)-1,h>>>=E,p-=E),p<15&&(h+=y[r++]<<p,p+=8,h+=y[r++]<<p,p+=8),v=_[h&m];;){if(h>>>=E=v>>>24,p-=E,!(16&(E=v>>>16&255))){if(0==(64&E)){v=_[(65535&v)+(h&(1<<E)-1)];continue}e.msg="invalid distance code",I.mode=16209;break e}if(S=65535&v,p<(E&=15)&&(h+=y[r++]<<p,(p+=8)<E&&(h+=y[r++]<<p,p+=8)),(S+=h&(1<<E)-1)>s){e.msg="invalid distance too far back",I.mode=16209;break e}if(h>>>=E,p-=E,S>(E=n-o)){if((E=S-E)>d&&I.sane){e.msg="invalid distance too far back",I.mode=16209;break e}if(b=0,T=l,0===u){if(b+=c-E,E<g){g-=E;do R[n++]=l[b++];while(--E);b=n-S,T=R}}else if(u<E){if(b+=c+u-E,(E-=u)<g){g-=E;do R[n++]=l[b++];while(--E);if(b=0,u<g){g-=E=u;do R[n++]=l[b++];while(--E);b=n-S,T=R}}}else if(b+=u-E,E<g){g-=E;do R[n++]=l[b++];while(--E);b=n-S,T=R}for(;g>2;)R[n++]=T[b++],R[n++]=T[b++],R[n++]=T[b++],g-=3;g&&(R[n++]=T[b++],g>1&&(R[n++]=T[b++]))}else{b=n-S;do R[n++]=R[b++],R[n++]=R[b++],R[n++]=R[b++],g-=3;while(g>2);g&&(R[n++]=R[b++],g>1&&(R[n++]=R[b++]))}break}}break}while(r<i&&n<a);r-=g=p>>3,p-=g<<3,h&=(1<<p)-1,e.next_in=r,e.next_out=n,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=n<a?a-n+257:257-(n-a),I.hold=h,I.bits=p};let wa=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ws=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),wc=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),wd=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var wu=(e,t,r,i,n,o,a,s)=>{let c=s.bits,d,u,l,h,p,f,_=0,A=0,m=0,v=0,E=0,g=0,S=0,b=0,T=0,y=0,R=null,I=new Uint16Array(16),C=new Uint16Array(16),k,w,O,N=null;for(_=0;_<=15;_++)I[_]=0;for(A=0;A<i;A++)I[t[r+A]]++;for(E=c,v=15;v>=1&&0===I[v];v--);if(E>v&&(E=v),0===v)return n[o++]=0x1400000,n[o++]=0x1400000,s.bits=1,0;for(m=1;m<v&&0===I[m];m++);for(E<m&&(E=m),b=1,_=1;_<=15;_++)if(b<<=1,(b-=I[_])<0)return -1;if(b>0&&(0===e||1!==v))return -1;for(C[1]=0,_=1;_<15;_++)C[_+1]=C[_]+I[_];for(A=0;A<i;A++)0!==t[r+A]&&(a[C[t[r+A]]++]=A);if(0===e?(R=N=a,f=20):1===e?(R=wa,N=ws,f=257):(R=wc,N=wd,f=0),y=0,A=0,_=m,p=o,g=E,S=0,l=-1,h=(T=1<<E)-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){k=_-S,a[A]+1<f?(w=0,O=a[A]):a[A]>=f?(w=N[a[A]-f],O=R[a[A]-f]):(w=96,O=0),d=1<<_-S,m=u=1<<g;do n[p+(y>>S)+(u-=d)]=k<<24|w<<16|O|0;while(0!==u);for(d=1<<_-1;y&d;)d>>=1;if(0!==d?(y&=d-1,y+=d):y=0,A++,0==--I[_]){if(_===v)break;_=t[r+a[A]]}if(_>E&&(y&h)!==l){for(0===S&&(S=E),p+=m,b=1<<(g=_-S);g+S<v&&!((b-=I[g+S])<=0);)g++,b<<=1;if(T+=1<<g,1===e&&T>852||2===e&&T>592)return 1;n[l=y&h]=E<<24|g<<16|p-o|0}}return 0!==y&&(n[p+y]=_-S<<24|4194304),s.bits=E,0};let{Z_FINISH:wl,Z_BLOCK:wh,Z_TREES:wp,Z_OK:wf,Z_STREAM_END:w_,Z_NEED_DICT:wA,Z_STREAM_ERROR:wm,Z_DATA_ERROR:wv,Z_MEM_ERROR:wE,Z_BUF_ERROR:wg,Z_DEFLATED:wS}=ki,wb=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function wT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let wy=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<16180||t.mode>16211?1:0},wR=e=>{if(wy(e))return wm;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=16180,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,wf},wI=e=>{if(wy(e))return wm;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,wR(e)},wC=(e,t)=>{let r;if(wy(e))return wm;let i=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?wm:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,wI(e))},wk=(e,t)=>{if(!e)return wm;let r=new wT;e.state=r,r.strm=e,r.window=null,r.mode=16180;let i=wC(e,t);return i!==wf&&(e.state=null),i},ww,wO,wN=!0,wP=e=>{if(wN){ww=new Int32Array(512),wO=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(wu(1,e.lens,0,288,ww,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;wu(2,e.lens,0,32,wO,0,e.work,{bits:5}),wN=!1}e.lencode=ww,e.lenbits=9,e.distcode=wO,e.distbits=5},wD=(e,t,r,i)=>{let n;let o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>i&&(n=i),o.window.set(t.subarray(r-i,r-i+n),o.wnext),(i-=n)?(o.window.set(t.subarray(r-i,r),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0};var wL={inflateReset:wI,inflateInit2:wk,inflate:(e,t)=>{let r,i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I=0,C=new Uint8Array(4),k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(wy(e)||!e.output||!e.input&&0!==e.avail_in)return wm;16191===(n=e.state).mode&&(n.mode=16192),c=e.next_out,a=e.output,u=e.avail_out,s=e.next_in,o=e.input,d=e.avail_in,l=n.hold,h=n.bits,p=d,f=u,R=wf;e:for(;;)switch(n.mode){case 16180:if(0===n.wrap){n.mode=16192;break}for(;h<16;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&l,C[1]=l>>>8&255,n.check=kt(n.check,C,2,0),l=0,h=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=16209;break}if((15&l)!==wS){e.msg="unknown compression method",n.mode=16209;break}if(l>>>=4,h-=4,y=8+(15&l),0===n.wbits&&(n.wbits=y),y>15||y>n.wbits){e.msg="invalid window size",n.mode=16209;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:16191,l=0,h=0;break;case 16181:for(;h<16;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(n.flags=l,(255&CP(n))!==wS){e.msg="unknown compression method",n.mode=16209;break}if(57344&CP(n)){e.msg="unknown header flags set",n.mode=16209;break}n.head&&(n.head.text=l>>8&1),512&CP(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=kt(n.check,C,2,0)),l=0,h=0,n.mode=16182;case 16182:for(;h<32;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}n.head&&(n.head.time=l),512&CP(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,C[2]=l>>>16&255,C[3]=l>>>24&255,n.check=kt(n.check,C,4,0)),l=0,h=0,n.mode=16183;case 16183:for(;h<16;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&CP(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=kt(n.check,C,2,0)),l=0,h=0,n.mode=16184;case 16184:if(1024&CP(n)){for(;h<16;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}n.length=l,n.head&&(n.head.extra_len=l),512&CP(n)&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=kt(n.check,C,2,0)),l=0,h=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&CP(n)&&((_=n.length)>d&&(_=d),_&&(n.head&&(y=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(o.subarray(s,s+_),y)),512&CP(n)&&4&n.wrap&&(n.check=kt(n.check,o,_,s)),d-=_,s+=_,n.length-=_),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&CP(n)){if(0===d)break e;_=0;do y=o[s+_++],n.head&&y&&n.length<65536&&(n.head.name+=String.fromCharCode(y));while(y&&_<d);if(512&CP(n)&&4&n.wrap&&(n.check=kt(n.check,o,_,s)),d-=_,s+=_,y)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&CP(n)){if(0===d)break e;_=0;do y=o[s+_++],n.head&&y&&n.length<65536&&(n.head.comment+=String.fromCharCode(y));while(y&&_<d);if(512&CP(n)&&4&n.wrap&&(n.check=kt(n.check,o,_,s)),d-=_,s+=_,y)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&CP(n)){for(;h<16;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=16209;break}l=0,h=0}n.head&&(n.head.hcrc=CP(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=16191;break;case 16189:for(;h<32;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}e.adler=n.check=wb(l),l=0,h=0,n.mode=16190;case 16190:if(0===n.havedict)return e.next_out=c,e.avail_out=u,e.next_in=s,e.avail_in=d,n.hold=l,n.bits=h,wA;e.adler=n.check=1,n.mode=16191;case 16191:if(t===wh||t===wp)break e;case 16192:if(n.last){l>>>=7&h,h-=7&h,n.mode=16206;break}for(;h<3;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}switch(n.last=1&l,h-=1,3&(l>>>=1)){case 0:n.mode=16193;break;case 1:if(wP(n),n.mode=16199,t===wp){l>>>=2,h-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=16209}l>>>=2,h-=2;break;case 16193:for(l>>>=7&h,h-=7&h;h<32;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=16209;break}if(n.length=65535&l,l=0,h=0,n.mode=16194,t===wp)break e;case 16194:n.mode=16195;case 16195:if(_=n.length){if(_>d&&(_=d),_>u&&(_=u),0===_)break e;a.set(o.subarray(s,s+_),c),d-=_,s+=_,u-=_,c+=_,n.length-=_;break}n.mode=16191;break;case 16196:for(;h<14;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(n.nlen=257+(31&l),l>>>=5,h-=5,n.ndist=1+(31&l),l>>>=5,h-=5,n.ncode=4+(15&l),l>>>=4,h-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=16209;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;h<3;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}n.lens[k[n.have++]]=7&l,l>>>=3,h-=3}for(;n.have<19;)n.lens[k[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,r={bits:n.lenbits},R=wu(0,n.lens,0,19,n.lencode,0,n.work,r),n.lenbits=r.bits,R){e.msg="invalid code lengths set",n.mode=16209;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;v=(I=n.lencode[l&(1<<n.lenbits)-1])>>>24,E=I>>>16&255,g=65535&I,!(v<=h);){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(g<16)l>>>=v,h-=v,n.lens[n.have++]=g;else{if(16===g){for(i=v+2;h<i;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(l>>>=v,h-=v,0===n.have){e.msg="invalid bit length repeat",n.mode=16209;break}y=n.lens[n.have-1],_=3+(3&l),l>>>=2,h-=2}else if(17===g){for(i=v+3;h<i;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}l>>>=v,h-=v,y=0,_=3+(7&l),l>>>=3,h-=3}else{for(i=v+7;h<i;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}l>>>=v,h-=v,y=0,_=11+(127&l),l>>>=7,h-=7}if(n.have+_>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=16209;break}for(;_--;)n.lens[n.have++]=y}}if(16209===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=16209;break}if(n.lenbits=9,r={bits:n.lenbits},R=wu(1,n.lens,0,n.nlen,n.lencode,0,n.work,r),n.lenbits=r.bits,R){e.msg="invalid literal/lengths set",n.mode=16209;break}if(n.distbits=6,n.distcode=n.distdyn,r={bits:n.distbits},R=wu(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,r),n.distbits=r.bits,R){e.msg="invalid distances set",n.mode=16209;break}if(n.mode=16199,t===wp)break e;case 16199:n.mode=16200;case 16200:if(d>=6&&u>=258){e.next_out=c,e.avail_out=u,e.next_in=s,e.avail_in=d,n.hold=l,n.bits=h,wo(e,f),c=e.next_out,a=e.output,u=e.avail_out,s=e.next_in,o=e.input,d=e.avail_in,l=n.hold,h=n.bits,16191===n.mode&&(n.back=-1);break}for(n.back=0;v=(I=n.lencode[l&(1<<n.lenbits)-1])>>>24,E=I>>>16&255,g=65535&I,!(v<=h);){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(E&&0==(240&E)){for(S=v,b=E,T=g;v=(I=n.lencode[T+((l&(1<<S+b)-1)>>S)])>>>24,E=I>>>16&255,g=65535&I,!(S+v<=h);){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}l>>>=S,h-=S,n.back+=S}if(l>>>=v,h-=v,n.back+=v,n.length=g,0===E){n.mode=16205;break}if(32&E){n.back=-1,n.mode=16191;break}if(64&E){e.msg="invalid literal/length code",n.mode=16209;break}n.extra=15&E,n.mode=16201;case 16201:if(n.extra){for(i=n.extra;h<i;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;v=(I=n.distcode[l&(1<<n.distbits)-1])>>>24,E=I>>>16&255,g=65535&I,!(v<=h);){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(0==(240&E)){for(S=v,b=E,T=g;v=(I=n.distcode[T+((l&(1<<S+b)-1)>>S)])>>>24,E=I>>>16&255,g=65535&I,!(S+v<=h);){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}l>>>=S,h-=S,n.back+=S}if(l>>>=v,h-=v,n.back+=v,64&E){e.msg="invalid distance code",n.mode=16209;break}n.offset=g,n.extra=15&E,n.mode=16203;case 16203:if(n.extra){for(i=n.extra;h<i;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=16209;break}n.mode=16204;case 16204:if(0===u)break e;if(_=f-u,n.offset>_){if((_=n.offset-_)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=16209;break}_>n.wnext?(_-=n.wnext,A=n.wsize-_):A=n.wnext-_,_>n.length&&(_=n.length),m=n.window}else m=a,A=c-n.offset,_=n.length;_>u&&(_=u),u-=_,n.length-=_;do a[c++]=m[A++];while(--_);0===n.length&&(n.mode=16200);break;case 16205:if(0===u)break e;a[c++]=n.length,u--,n.mode=16200;break;case 16206:if(n.wrap){for(;h<32;){if(0===d)break e;d--,l|=o[s++]<<h,h+=8}if(f-=u,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=CP(n)?kt(n.check,a,f,c-f):C7(n.check,a,f,c-f)),f=u,4&n.wrap&&(CP(n)?l:wb(l))!==n.check){e.msg="incorrect data check",n.mode=16209;break}l=0,h=0}n.mode=16207;case 16207:if(n.wrap&&CP(n)){for(;h<32;){if(0===d)break e;d--,l+=o[s++]<<h,h+=8}if(4&n.wrap&&l!==(0xffffffff&n.total)){e.msg="incorrect length check",n.mode=16209;break}l=0,h=0}n.mode=16208;case 16208:R=w_;break e;case 16209:R=wv;break e;case 16210:return wE;default:return wm}return e.next_out=c,e.avail_out=u,e.next_in=s,e.avail_in=d,n.hold=l,n.bits=h,(n.wsize||f!==e.avail_out&&n.mode<16209&&(n.mode<16206||t!==wl))&&wD(e,e.output,e.next_out,f-e.avail_out),p-=e.avail_in,f-=e.avail_out,e.total_in+=p,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=CP(n)?kt(n.check,a,f,e.next_out-f):C7(n.check,a,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(16191===n.mode?128:0)+(16199===n.mode||16194===n.mode?256:0),(0===p&&0===f||t===wl)&&R===wf&&(R=wg),R},inflateEnd:e=>{if(wy(e))return wm;let t=e.state;return t.window&&(t.window=null),e.state=null,wf},inflateGetHeader:(e,t)=>{if(wy(e))return wm;let r=e.state;return 0==(2&r.wrap)?wm:(r.head=t,t.done=!1,wf)},inflateSetDictionary:(e,t)=>{let r,i;let n=t.length;return wy(e)?wm:0!==(r=e.state).wrap&&16190!==r.mode?wm:16190===r.mode&&(i=C7(i=1,t,n,0))!==r.check?wv:wD(e,t,n,n)?(r.mode=16210,wE):(r.havedict=1,wf)}},wM=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let wx=Object.prototype.toString,{Z_NO_FLUSH:wU,Z_FINISH:wB,Z_OK:wV,Z_STREAM_END:wF,Z_NEED_DICT:wj,Z_STREAM_ERROR:wG,Z_DATA_ERROR:wW,Z_MEM_ERROR:wH}=ki;function wY(e){this.options=kZ.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k1,this.strm.avail_out=0;let r=wL.inflateInit2(this.strm,t.windowBits);if(r!==wV||(this.header=new wM,wL.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=k2.string2buf(t.dictionary):"[object ArrayBuffer]"===wx.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=wL.inflateSetDictionary(this.strm,t.dictionary))!==wV)))throw Error(kr[r])}function wK(e,t){let r=new wY(t);if(r.push(e),r.err)throw r.msg||kr[r.err];return r.result}wY.prototype.push=function(e,t){let r,i,n;let o=this.strm,a=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(i=t===~~t?t:!0===t?wB:wU,"[object ArrayBuffer]"===wx.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(a),o.next_out=0,o.avail_out=a),(r=wL.inflate(o,i))===wj&&s&&((r=wL.inflateSetDictionary(o,s))===wV?r=wL.inflate(o,i):r===wW&&(r=wj));o.avail_in>0&&r===wF&&o.state.wrap>0&&0!==e[o.next_in];)wL.inflateReset(o),r=wL.inflate(o,i);switch(r){case wG:case wW:case wj:case wH:return this.onEnd(r),this.ended=!0,!1}if(n=o.avail_out,o.next_out&&(0===o.avail_out||r===wF)){if("string"===this.options.to){let e=k2.utf8border(o.output,o.next_out),t=o.next_out-e,r=k2.buf2string(o.output,e);o.next_out=t,o.avail_out=a-t,t&&o.output.set(o.output.subarray(e,e+t),0),this.onData(r)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out))}if(r!==wV||0!==n){if(r===wF)return r=wL.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},wY.prototype.onData=function(e){this.chunks.push(e)},wY.prototype.onEnd=function(e){e===wV&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=kZ.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};let{Deflate:wQ,deflate:wz,deflateRaw:wX,gzip:wJ}={Deflate:wi,deflate:wn,deflateRaw:function(e,t){return(t=t||{}).raw=!0,wn(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,wn(e,t)},constants:ki},{Inflate:wq,inflate:wZ,inflateRaw:w$,ungzip:w0}={Inflate:wY,inflate:wK,inflateRaw:function(e,t){return(t=t||{}).raw=!0,wK(e,t)},ungzip:wK,constants:ki};var w2=((ta=w2||{})[ta.ONE_BYTE=0]="ONE_BYTE",ta[ta.TWO_BYTE=1]="TWO_BYTE",ta);class w1{constructor(){Aa(this,"_sequence",0),Aa(this,"_startTime",Date.now()),Aa(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<65536?e:(this._startTime+=65536,this.startTime)}get sequence(){return this._sequence<0x100000000?this._sequence++:(this._sequence-=0x100000000,this.sequence)}serialize(e){let t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let r=new Uint8Array(4);r.set([1,0,0,0]);let i={id:0,length:4,data:r.buffer},n={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[i]};t.commonPacketHeader.extension=1,t.extension=n,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;E4("SHOW_DATASTREAM2_LOG")&&gA.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));let r=new ArrayBuffer(t.commonPacketHeader.length),i=new Uint8Array(r),n=new DataView(r),o=0;if(n.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,n.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,n.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){let e=this.serializeExtension(t.extension);i.set(new Uint8Array(e),o),o+=e.byteLength}if(i.set(new Uint8Array(t.payload),o),(o+=t.payload.byteLength)!==t.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(e){let t,r;if(e.byteLength<4)return new ArrayBuffer(0);let i=new DataView(e),n=0,o=i.getUint16(n,!0);n+=2;let a={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:i.getUint16(n+2,!0)<<16|i.getUint16(n,!0)};if(n+=4,E4("SHOW_DATASTREAM2_LOG")&&gA.debug("receive data header: ".concat(JSON.stringify(a))),i.getUint16(n,!0),n+=2,a.extension){r=this.deserializeExtension(e.slice(n)),n+=2+r.length,t=e.slice(n);let i=!1;if(r.datas.length>0){let e=r.datas.find(e=>0===e.id);e&&(i=1==(1&new DataView(e.data).getUint32(0,!0)))}t=i?this.decompress(t):t}else t=e.slice(8);return t}serializeExtension(e){let{profile:t,length:r,datas:i}=e,n=new ArrayBuffer(r+2),o=new Uint8Array(n),a=new DataView(n),s=0;if(a.setUint8(s++,t),a.setUint8(s++,r),i.forEach(e=>{t?(a.setUint8(s++,e.id),a.setUint8(s++,e.length)):a.setUint8(s++,e.id|e.length<<4),o.set(new Uint8Array(e.data),s),s+=e.data.byteLength}),s!==r+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(r+2));return n}deserializeExtension(e){let t=new DataView(e),r=0,i=t.getUint8(r);r++;let n=t.getUint8(r);r++;let o=i===w2.TWO_BYTE,a=[],s=new DataView(e,2),c=0;for(;c<n;){let e=0,t=0,r=new ArrayBuffer(0);o?(e=s.getUint8(c),c++,t=s.getUint8(c)):(e=15&s.getUint8(c),t=s.getUint8(c)>>4),c++,t>0&&(r=s.buffer.slice(c+2,c+2+t),c+=r.byteLength),a.push({id:e,length:t,data:r})}if(c!==n)throw Error("parse error");return{profile:i,length:n,datas:a}}decompress(e){return wZ(new Uint8Array(e))}compress(e){return wz(new Uint8Array(e))}}class w4 extends vP{constructor(e,t,r){super(),Aa(this,"ws",void 0),Aa(this,"requestId",1),Aa(this,"heartBeatTimer",void 0),Aa(this,"joinInfo",void 0),Aa(this,"clientId",void 0),Aa(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Aa(this,"onClose",e=>{this.emit("close"),this.dispose()}),Aa(this,"onMessage",e=>{let t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)}),this.joinInfo=e,this.clientId=t,this.ws=new ye("cross-channel-".concat(this.clientId),r),this.ws.on(Tt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Tt.CONNECTED,this.onOpen),this.ws.on(Tt.ON_MESSAGE,this.onMessage),this.ws.on(Tt.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new dJ((t,r)=>{let i=window.setTimeout(()=>{r(new gy(vA.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,n=>{window.clearTimeout(i),n.state&&0!==n.state?r(new gy(vA.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new gy(vA.WS_ABORT))})})}async request(e){if("closed"===this.ws.state)throw new gy(vA.WS_DISCONNECT);"connected"!==this.ws.state&&await new dJ((e,t)=>{this.ws.once(Tt.CLOSED,()=>t(new gy(vA.WS_ABORT))),this.ws.once(Tt.CONNECTED,e)});let t=this.sendMessage(e),r=new dJ((e,r)=>{let i=()=>{r(new gy(vA.WS_ABORT))};this.ws.once(Tt.RECONNECTING,i),this.ws.once(Tt.CLOSED,i),this.once("req_".concat(t),e),Et(3e3).then(()=>{this.removeAllListeners("req_".concat(t)),this.ws.off(Tt.RECONNECTING,i),this.ws.off(Tt.CLOSED,i),r(new gy(vA.TIMEOUT,"cross channel ws request timeout"))})}),i=await r;if(!i||200!==i.code)throw new gy(vA.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(Tt.REQUEST_NEW_URLS),this.ws.on(Tt.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class w6 extends vP{set state(e){e!==this._state&&(e!==T_.RELAY_STATE_FAILURE&&(this.errorCode=TA.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,r,i,n){super(),Aa(this,"joinInfo",void 0),Aa(this,"sid",void 0),Aa(this,"clientId",void 0),Aa(this,"cancelToken",mU.CancelToken.source()),Aa(this,"workerToken",void 0),Aa(this,"requestId",0),Aa(this,"signal",void 0),Aa(this,"prevChannelMediaConfig",void 0),Aa(this,"httpRetryConfig",void 0),Aa(this,"_resolution",void 0),Aa(this,"_state",T_.RELAY_STATE_IDLE),Aa(this,"errorCode",TA.RELAY_OK),Aa(this,"onStatus",e=>{gA.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",Tf.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",Tf.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=TA.SRC_TOKEN_EXPIRED,this.state=T_.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=TA.DEST_TOKEN_EXPIRED,this.state=T_.RELAY_STATE_FAILURE))}),Aa(this,"onReconnect",async()=>{gA.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Tf.NETWORK_DISCONNECTED),this.state=T_.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(e=>{this.state!==T_.RELAY_STATE_IDLE&&(gA.error("auto restart channel media relay failed",e.toString()),this.errorCode=TA.SERVER_CONNECTION_LOST,this.state=T_.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=Ei(),this.signal=new w4(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=n}async startChannelMediaRelay(e){if(this.state!==T_.RELAY_STATE_IDLE)throw new gy(vA.INVALID_OPERATION);this.state=T_.RELAY_STATE_CONNECTING,await this.connect(),gA.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new gy(vA.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new gy(vA.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new gy(vA.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==T_.RELAY_STATE_RUNNING)throw new gy(vA.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==T_.RELAY_STATE_RUNNING)throw new gy(vA.INVALID_OPERATION);let t=this.genMessage(Tp.SetVideoProfile);await this.signal.request(t),gA.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),gA.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=T_.RELAY_STATE_IDLE,this.dispose()}dispose(){gA.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mU.CancelToken.source(),this.state=T_.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await RC(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Tf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let t=this.genMessage(Tp.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),gA.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let r=this.genMessage(Tp.SetSdkProfile,e);await this.signal.request(r),gA.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let i=this.genMessage(Tp.SetSourceChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Tf.PACKET_JOINED_SRC_CHANNEL),gA.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let n=this.genMessage(Tp.SetSourceUserId,e);await this.signal.request(n),gA.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let o=this.genMessage(Tp.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Tf.PACKET_JOINED_DEST_CHANNEL),gA.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let a=this.genMessage(Tp.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",Tf.PACKET_SENT_TO_DEST_CHANNEL),this.state=T_.RELAY_STATE_RUNNING,gA.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let t=this.genMessage(Tp.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",Tf.PACKET_UPDATE_DEST_CHANNEL),gA.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(Tp.StopPacketTransfer);await this.signal.request(e),gA.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let r=[],i=[],n=[];this.requestId+=1;let o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:EQ,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.23.2-1"===o.sdkVersion&&(o.sdkVersion="0.0.1");let a=null,s=null;switch(e){case Tp.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Tp.SetSourceChannel:if(!(s=t&&t.getSrcChannelMediaInfo()))throw new gy(vA.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},o;case Tp.SetSourceUserId:if(!(s=t&&t.getSrcChannelMediaInfo()))throw new gy(vA.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:s.uid+""},o;case Tp.SetDestChannel:if(!(a=t&&t.getDestChannelMediaInfo()))throw new gy(vA.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{r.push(e.channelName),i.push(e.uid+""),n.push(e.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:n},o;case Tp.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Tp.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Tp.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Tp.UpdateDestChannel:if(!(a=t&&t.getDestChannelMediaInfo()))throw new gy(vA.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{r.push(e.channelName),i.push(e.uid+""),n.push(e.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:n},o;case Tp.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}function w3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function w8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w3(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w3(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class w5 extends vP{constructor(e,t,r,i){super(),Aa(this,"spec",void 0),Aa(this,"token",void 0),Aa(this,"websocket",void 0),Aa(this,"pingpongTimer",void 0),Aa(this,"reconnectMode","retry"),Aa(this,"serviceMode",void 0),Aa(this,"reqId",0),Aa(this,"commandReqId",0),Aa(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Aa(this,"handleWebSocketMessage",e=>{if(!e.data)return;let t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(gT.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===Tn.TRANSCODE?1:2}),this.emit(Td.PUBLISH_STREAM_STATUS,t))}),this.spec=t,this.token=e,this.serviceMode=i,this.websocket=new ye("live-streaming",r),this.websocket.on(Tt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Tt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Tt.REQUEST_NEW_URLS,(e,t)=>{vQ(this,Td.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(Tt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,r,i){this.reqId+=1,"request"===e&&(this.commandReqId+=1);let n=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new gy(vA.UNEXPECTED_ERROR);let a=w8({command:e,sdkVersion:"4.23.2-1"===EQ?"0.0.1":EQ,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new gy(vA.WS_DISCONNECT);let s=()=>new dJ((e,t)=>{this.websocket.once(Tt.CLOSED,()=>t(new gy(vA.WS_ABORT))),this.websocket.once(Tt.CONNECTED,e)});"connected"!==this.websocket.state&&await s(),a.clientRequest&&(a.clientRequest.workerToken=this.token);let c=new dJ((e,t)=>{let r=()=>{t(new gy(vA.WS_ABORT))};this.websocket.once(Tt.RECONNECTING,r),this.websocket.once(Tt.CLOSED,r),this.once("@".concat(o,"-").concat(this.spec.sid),t=>{e(t)})});i&&gT.workerEvent(this.spec.sid,w8(w8({},i),{},{requestId:n,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));let d=Date.now();this.websocket.sendMessage(a);let u=null;try{u=await c}catch(i){if("closed"===this.websocket.state)throw i;return await s(),await this.request(e,t,r)}return i&&gT.workerEvent(this.spec.sid,w8(w8({},i),{},{requestId:n,actionType:"response",payload:JSON.stringify(u.serverResponse),serverCode:u.code,success:200===u.code,responseTime:Date.now()-d})),200!==u.code&&this.handleResponseError(u),u}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e="4.23.2-1"===EQ?"0.0.1":EQ;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Tl.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void gA.warning("live stream response already exists stream");case Tl.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Tl.LIVE_STREAM_RESPONSE_BAD_STREAM:case Tl.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new gy(vA.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Tl.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new gy(vA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Tl.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new gy(vA.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Tl.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t=new gy(vA.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Td.WARNING,t,e.serverResponse.url)}case Tl.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t=new gy(vA.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Td.WARNING,t,e.serverResponse.url)}case Tl.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new gy(vA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Tl.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new gy(vA.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Tl.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t=new gy(vA.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Td.WARNING,t,e.serverResponse.url)}case Tl.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new gy(vA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Tl.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new gy(vA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Tl.LIVE_STREAM_RESPONSE_WORKER_LOST:case Tl.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new gy(vA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Tl.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new gy(vA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new gy(vA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Tl.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Tl.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Tl.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Tl.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new gy(vA.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(En)},6e3)}}function w9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function w7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w9(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w9(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class Oe extends vP{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E_,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E_;super(),Aa(this,"onLiveStreamWarning",void 0),Aa(this,"onLiveStreamError",void 0),Aa(this,"spec",void 0),Aa(this,"retryTimeout",1e4),Aa(this,"connection",void 0),Aa(this,"httpRetryConfig",void 0),Aa(this,"wsRetryConfig",void 0),Aa(this,"streamingTasks",new Map),Aa(this,"isStartingStreamingTask",!1),Aa(this,"taskMutex",new Ep("live-streaming")),Aa(this,"cancelToken",mU.CancelToken.source()),Aa(this,"transcodingConfig",void 0),Aa(this,"uapResponse",void 0),Aa(this,"lastTaskId",1),Aa(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=r,this.wsRetryConfig=t}async setTranscodingConfig(e){var t,r;let i=w7(w7({},Tc),e);66!==i.videoCodecProfile&&77!==i.videoCodecProfile&&100!==i.videoCodecProfile&&(gA.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(e=>w7(w7(w7({},To),e),{},{zOrder:e.zOrder?e.zOrder+1:1}))),vy((t=i).width)||vg(t.width,"config.width",0,1e4),vy(t.height)||vg(t.height,"config.height",0,1e4),vy(t.videoBitrate)||vg(t.videoBitrate,"config.videoBitrate",1,1e6),vy(t.videoFrameRate)||vg(t.videoFrameRate,"config.videoFrameRate"),vy(t.lowLatency)||vv(t.lowLatency,"config.lowLatency"),vy(t.audioSampleRate)||vE(t.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),vy(t.audioBitrate)||vg(t.audioBitrate,"config.audioBitrate",1,128),vy(t.audioChannels)||vE(t.audioChannels,"config.audioChannels",[1,2,3,4,5]),vy(t.videoGop)||vg(t.videoGop,"config.videoGop"),vy(t.videoCodecProfile)||vE(t.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),vy(t.userCount)||vg(t.userCount,"config.userCount",0,17),vy(t.backgroundColor)||vg(t.backgroundColor,"config.backgroundColor",0,0xffffff),vy(t.userConfigExtraInfo)||vb(t.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),t.transcodingUsers&&!vy(t.transcodingUsers)&&(vT(t.transcodingUsers,"config.transcodingUsers"),t.transcodingUsers.forEach((e,t)=>{Ti(e.uid),vy(e.x)||vg(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),vy(e.y)||vg(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),vy(e.width)||vg(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),vy(e.height)||vg(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),vy(e.zOrder)||vg(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),vy(e.alpha)||vg(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),vy(t.watermark)||Ts(t.watermark,"watermark"),vy(t.backgroundImage)||Ts(t.backgroundImage,"backgroundImage"),t.images&&!vy(t.images)&&(vT(t.images,"config.images"),t.images.forEach((e,t)=>{Ts(e,"images[".concat(t,"]"))}));let n=[];i.images&&n.push(...i.images.map(e=>w7(w7(w7({},Ta),e),{},{zOrder:255}))),i.backgroundImage&&(n.push(w7(w7(w7({},Ta),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(n.push(w7(w7(w7({},Ta),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=n,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(e=>w7({},e)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);let o=(i.userConfigs||[]).map(e=>"number"==typeof e.uid?dJ.resolve(e.uid):Rb(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await dJ.all(o)).forEach((e,t)=>{i.userConfigs&&i.userConfigs[t]&&(i.userConfigs[t].uid=e)}),this.transcodingConfig=i,this.connection)try{;let e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(d0(r=this.streamingTasks).call(r)).map(e=>e.taskId).join("#")});gA.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(t=>{gA.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then(()=>{gA.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))}).catch(e=>{gA.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)})})}}async startLiveStreamingTask(e,t,r){if(!this.transcodingConfig&&t===Tn.TRANSCODE)throw new gy(vA.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};gA.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));let n=await this.taskMutex.lock();if(!this.connection&&r)return void n();if(this.streamingTasks.get(e)&&!r)return n(),new gy(vA.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw n(),e}switch(t){case Tn.TRANSCODE:i.transcodingConfig=w7({},this.transcodingConfig);case Tn.RAW:}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let o=this.lastTaskId++;try{let a=new dJ((t,i)=>{Et(this.retryTimeout).then(()=>{if(r)return i(r);let t=this.statusError.get(e);return t?(this.statusError.delete(e),i(t)):void 0})}),s=await dJ.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===Tn.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),a]);this.isStartingStreamingTask=!1,gA.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:o}),n()}catch(i){if(n(),this.isStartingStreamingTask=!1,!i.data||!i.data.retry||r)throw i;return i.data.changeAddress&&this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,i)}}stopLiveStreamingTask(e){return new dJ((t,r)=>{let i=this.streamingTasks.get(e);if(!i||!this.connection)return new gy(vA.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let n=i.mode;i.abortTask=()=>{gA.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:n===Tn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(r=>{gA.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(r.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(r)})}resetAllTask(){var e;let t=Array.from(d0(e=this.streamingTasks).call(e));for(let e of(this.terminate(),t))this.startLiveStreamingTask(e.url,e.mode).catch(t=>{this.onLiveStreamError&&this.onLiveStreamError(e.url,t)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=mU.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new gy(vA.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await vQ(this,Tu.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new w5(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Td.WARNING,(e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)),this.connection.on(Td.PUBLISH_STREAM_STATUS,e=>this.handlePublishStreamServer(e)),this.connection.on(Td.REQUEST_NEW_ADDRESS,(t,r)=>{if(!this.connection)return r(new gy(vA.UNEXPECTED_ERROR,"can not get new live streaming address list"));vQ(this,Tu.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{this.uapResponse=e,t(e.addressList)}).catch(r)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){let t=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(t),i=e.reason;switch(e.code){case Tl.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Tl.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Tl.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Tl.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let i=new gy(vA.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return gA.error(i.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,i);if(!this.isStartingStreamingTask)return;this.statusError.set(t,i)}case Tl.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let e=new gy(vA.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case Tl.LIVE_STREAM_RESPONSE_WORKER_LOST:case Tl.LIVE_STREAM_RESPONSE_WORKER_QUIT:var n;if(!this.connection)return;for(let t of(this.connection.tryNextAddress(),Array.from(d0(n=this.streamingTasks).call(n))))t.abortTask?t.abortTask():(gA.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,new gy(vA.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{gA.debug("[".concat(this.spec.clientId,"] republish live stream success"),t.url)}).catch(e=>{gA.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}));return}}hasUrl(e){return this.streamingTasks.has(e)}}function Ot(e,t){switch(t){case 0:for(;128&Op(e););break;case 2:Os(e,Om(e));break;case 5:Os(e,4);break;case 1:Os(e,8);break;default:throw Error("Unimplemented type: "+t)}}new Uint8Array(new Float32Array(1).buffer);let Or=new Float64Array(1),Oi=new Uint8Array(Or.buffer);function On(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Oo=[];function Oa(){let e=Oo.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Os(e,t){if(e.offset+t>e.limit)throw Error("Skip past limit");e.offset+=t}function Oc(e){return e.offset>=e.limit}function Od(e,t){let r=e.bytes,i=e.offset,n=e.limit,o=i+t;if(o>r.length){let t=new Uint8Array(2*o);t.set(r),e.bytes=t}return e.offset=o,o>n&&(e.limit=o),i}function Ou(e,t){let r=e.offset;if(r+t>e.limit)throw Error("Read past limit");return e.offset+=t,r}function Ol(e,t){let r=Ou(e,t),i=String.fromCharCode,n=e.bytes,o="";for(let e=0;e<t;e++){let a,s,c,d,u=n[e+r];0==(128&u)?o+=i(u):192==(224&u)?e+1>=t?o+="\uFFFD":128!=(192&(a=n[e+r+1]))?o+="\uFFFD":(d=(31&u)<<6|63&a)<128?o+="\uFFFD":(o+=i(d),e++):224==(240&u)?e+2>=t?o+="\uFFFD":(a=n[e+r+1],32896!=(49344&(a|(s=n[e+r+2])<<8))?o+="\uFFFD":(d=(15&u)<<12|(63&a)<<6|63&s)<2048||d>=55296&&d<=57343?o+="\uFFFD":(o+=i(d),e+=2)):240==(248&u)?e+3>=t?o+="\uFFFD":(a=n[e+r+1],s=n[e+r+2],8421504!=(0xc0c0c0&(a|s<<8|(c=n[e+r+3])<<16))?o+="\uFFFD":(d=(7&u)<<18|(63&a)<<12|(63&s)<<6|63&c)<65536||d>1114111?o+="\uFFFD":(d-=65536,o+=i(55296+(d>>10),56320+(1023&d)),e+=3)):o+="\uFFFD"}return o}function Oh(e,t){let r=t.length,i=0;for(let e=0;e<r;e++){let n=t.charCodeAt(e);n>=55296&&n<=56319&&e+1<r&&(n=(n<<10)+t.charCodeAt(++e)-0x35fdc00),i+=n<128?1:n<2048?2:n<65536?3:4}Ov(e,i);let n=Od(e,i),o=e.bytes;for(let e=0;e<r;e++){let i=t.charCodeAt(e);i>=55296&&i<=56319&&e+1<r&&(i=(i<<10)+t.charCodeAt(++e)-0x35fdc00),i<128?o[n++]=i:(i<2048?o[n++]=i>>6&31|192:(i<65536?o[n++]=i>>12&15|224:(o[n++]=i>>18&7|240,o[n++]=i>>12&63|128),o[n++]=i>>6&63|128),o[n++]=63&i|128)}}function Op(e){return e.bytes[Ou(e,1)]}function Of(e,t){let r=Od(e,1);e.bytes[r]=t}function O_(e){let t=Ou(e,8),r=e.bytes;return Oi[0]=r[t++],Oi[1]=r[t++],Oi[2]=r[t++],Oi[3]=r[t++],Oi[4]=r[t++],Oi[5]=r[t++],Oi[6]=r[t++],Oi[7]=r[t++],Or[0]}function OA(e,t){let r=Od(e,8),i=e.bytes;Or[0]=t,i[r++]=Oi[0],i[r++]=Oi[1],i[r++]=Oi[2],i[r++]=Oi[3],i[r++]=Oi[4],i[r++]=Oi[5],i[r++]=Oi[6],i[r++]=Oi[7]}function Om(e){let t,r=0,i=0;do t=Op(e),r<32&&(i|=(127&t)<<r),r+=7;while(128&t);return i}function Ov(e,t){for(t>>>=0;t>=128;)Of(e,127&t|128),t>>>=7;Of(e,t)}function OE(e,t){let r=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,n=t.high>>>24,o=0===n?0===i?r<16384?r<128?1:2:r<2097152?3:4:i<16384?i<128?5:6:i<2097152?7:8:n<128?9:10,a=Od(e,o),s=e.bytes;switch(o){case 10:s[a+9]=n>>>7&1;case 9:s[a+8]=9!==o?128|n:127&n;case 8:s[a+7]=8!==o?i>>>21|128:i>>>21&127;case 7:s[a+6]=7!==o?i>>>14|128:i>>>14&127;case 6:s[a+5]=6!==o?i>>>7|128:i>>>7&127;case 5:s[a+4]=5!==o?128|i:127&i;case 4:s[a+3]=4!==o?r>>>21|128:r>>>21&127;case 3:s[a+2]=3!==o?r>>>14|128:r>>>14&127;case 2:s[a+1]=2!==o?r>>>7|128:r>>>7&127;case 1:s[a]=1!==o?128|r:127&r}}function Og(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}let OS=new Map([["moderation",1],["supervise",2]]);class Ob extends vP{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(TB.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=ae(t=e.map(e=>OS.get(e)||0)).call(t,(e,t)=>e+t),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),Aa(this,"name","AgoraRTCVideoContentInspect"),Aa(this,"_connectionState",Tx.CONNECTING),Aa(this,"_innerConnectionState",void 0),Aa(this,"sequence",0),Aa(this,"inspectStartTime",void 0),Aa(this,"workerManagerConnection",void 0),Aa(this,"workerConnection",void 0),Aa(this,"workerMessageLengthLimit",void 0),Aa(this,"inspectIntervalMinimum",void 0),Aa(this,"qualityRatio",void 0),Aa(this,"_connectInfo",void 0),Aa(this,"_cancelTokenSource",mU.CancelToken.source()),Aa(this,"_retryConfig",void 0),Aa(this,"wmSequence",0),Aa(this,"inspectInterval",void 0),Aa(this,"inspectTimer",null),Aa(this,"ossFilePrefix",void 0),Aa(this,"extraInfo",void 0),Aa(this,"_inspectType",void 0),Aa(this,"_inspectMode",void 0),Aa(this,"_quality",1),Aa(this,"qualityTimer",null),Aa(this,"_inspectId",void 0),Aa(this,"_needWorkUrlOnly",!1),Aa(this,"inspectImage",()=>{if(this.connectionState!==Tx.CONNECTED)throw new gy(vA.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Tx.CONNECTED?this.requestToInspectImage():gA.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Er(5,"inspect-"),this.workerMessageLengthLimit=E4("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=E4("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=E4("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new ye("worker-manager-"+this._inspectId,E_),this.on(TB.STATE_CHANGE,(e,t)=>{this._innerConnectionState=e,gA.debug("[".concat(this._inspectId,"] Inspect operation :").concat(TU[e]," ").concat(t||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new ye("worker-"+this._inspectId,E_),this.handleWorkerEvents()}async init(e,t){this.emit(TB.STATE_CHANGE,TU.CONNECT_AP),this._connectInfo=e;let r=this._cancelTokenSource.token;return this._retryConfig=t,new dJ((i,n)=>{this.on(TB.CONNECTION_STATE_CHANGE,(e,t)=>{t===Tx.CONNECTED&&i()}),this.requestAP(e,r,t).then(e=>{this.connectWorkerManager(e)}).catch(e=>{n(e)})})}async requestAP(e,t,r){let i=E4("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),n=await function(e,t,r,i){let{appId:n,areaCode:o,cname:a,sid:s,token:c,uid:d}=t,u="image_moderation_api",l={service_name:u,json_body:JSON.stringify({appId:n,areaCode:o,cname:a,command:"allocateEdge",requestId:++RA,seq:RA,sid:s,token:c,ts:Date.now(),uid:d+""})},h,p,f=e[0];return Em(async()=>{h=Date.now();let e=await y3(f,{data:l,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){let t=new gy(vA.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw gA.error(t.toString()),t}let t=JSON.parse(e.json_body);if(200!==t.code){let e=new gy(vA.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw gA.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){let e=new gy(vA.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw gA.error(e.toString()),e}let i=E4("VIDEO_INSPECT_WORKER_MANAGER_HOST"),n=E4("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map(e=>{let{address:t,wss:r}=e;if(t&&r)return"wss://".concat(t.replace(/\./g,"-"),".").concat(i,":").concat(n||r)}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,responseTime:p}},(t,r)=>(gT.apworkerEvent(s,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===r,responseTime:p,serverIp:e[r%e.length]}),!1),(t,r)=>(gT.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:u,responseTime:p,serverIp:e[r%e.length]}),!!(t.code!==vA.OPERATION_ABORTED&&t.code!==vA.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(r+1)%e.length],!0)),i)}(i,e,t,r);this.emit(TB.STATE_CHANGE,TU.AP_CONNECTED);let{addressList:o}=n;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(TB.STATE_CHANGE,TU.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Tt.CONNECTED,async()=>{this.emit(TB.STATE_CHANGE,TU.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2-1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Tt.CLOSED,()=>{this._innerConnectionState<TU.GET_WORKER_MANAGER_RESPONSE&&gA.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Tt.FAILED,()=>{this._innerConnectionState<TU.GET_WORKER_MANAGER_RESPONSE&&gA.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Tt.RECONNECTING,()=>{this._innerConnectionState<TU.GET_WORKER_MANAGER_RESPONSE&&gA.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Tt.ON_MESSAGE,async e=>{this.emit(TB.STATE_CHANGE,TU.GET_WORKER_MANAGER_RESPONSE);let t=this.workerManagerConnection.url;this.workerManagerConnection.close();let r=JSON.parse(e.data);if(200!==r.code)throw gA.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new gy(vA.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&t))throw gA.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new gy(vA.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{let e=E4("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,i=t.replace(/:\d+\/?$/,":".concat(e));this.emit(TB.STATE_CHANGE,TU.CONNECT_WORKER,i),this._needWorkUrlOnly?this.emit(TB.REQUEST_NEW_WORKER_URL,i):await this.connectWorker(i)}}),this.workerManagerConnection.on(Tt.WILL_RECONNECT,(e,t,r)=>{r(e)}),this.workerManagerConnection.on(Tt.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(Tt.CONNECTED,async()=>{this.emit(TB.STATE_CHANGE,TU.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Tx.CONNECTED}),this.workerConnection.on(Tt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let r=function(e){return function(e){let t={};e:for(;!Oc(e);){let r=Om(e);switch(r>>>3){case 0:break e;case 1:t.code=Om(e);break;case 2:t.msg=Ol(e,Om(e));break;case 3:{let r=function(e){let t=Om(e),r=e.limit;return e.limit=e.offset+t,r}(e);t.data=function(e){let t={};e:for(;!Oc(e);){let r=Om(e);switch(r>>>3){case 0:break e;case 1:t.requestId=Ol(e,Om(e));break;case 2:t.requestType=Om(e)>>>0;break;case 3:t.scorePorn=O_(e);break;case 4:t.scoreSexy=O_(e);break;case 5:t.scoreNeutral=O_(e);break;case 6:t.requestScene=Om(e)>>>0;break;case 7:t.scene=Om(e)>>>0;break;default:Ot(e,7&r)}}return t}(e),e.limit=r;break}default:Ot(e,7&r)}}return t}({bytes:e,offset:0,limit:e.length})}(new Uint8Array(e.data));if(E4("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&gA.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),200===r.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(TB.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var t;let e={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},i=ae(t=Object.keys(e)).call(t,(t,r)=>e[t]>e[r]?t:r,"porn"),n=Object.keys(e).find(e=>e===i);this.emit(TB.INSPECT_RESULT,n)}else this.emit(TB.INSPECT_RESULT,void 0,new gy(vA.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(TB.INSPECT_RESULT,void 0,new gy(vA.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else gA.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(TB.INSPECT_RESULT,void 0,new gy(vA.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Tt.CLOSED,()=>{this.connectionState=Tx.CLOSED}),this.workerConnection.on(Tt.FAILED,()=>{this.connectionState=Tx.CLOSED}),this.workerConnection.on(Tt.RECONNECTING,()=>{this.connectionState=this.connectionState===Tx.CONNECTED?Tx.RECONNECTING:Tx.CONNECTING}),this.workerConnection.on(Tt.WILL_RECONNECT,(e,t,r)=>{"recover"===e&&r(e),r("tryNext")}),this.workerConnection.on(Tt.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(TB.REQUEST_NEW_WORKER_URL,t=>{e([t])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e=>{this.connectWorkerManager(e,!0)}).catch(e=>{t(e)})})}async requestToInspectImage(){this.sequence++;let e=vX(this,TB.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(TB.INSPECT_RESULT,void 0,new gy(vA.INVALID_OPERATION,"Only the track being played can be inspected"));let r=await this.generateRequestData(e,t);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(TB.INSPECT_RESULT,void 0,new gy(vA.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){var r,i;let n,o,a;let{appId:s,cname:c,cid:d,vid:u,sid:l,uid:h}=t,p=Date.now(),f=await e.getCurrentFrameImage("image/jpeg",this.quality),_=await Sz(f,s,c),A=this.sequence+"-"+d+"-"+h+"-"+p+"-"+Er(12,""),m={appId:s,cid:d,cname:c,deviceId:"",elapse:{low:r=0|Number(p-this.inspectStartTime),high:r>>31,unsigned:r>=0},fileSize:_.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:_,networkType:6,osType:7,requestId:A,sdkVersion:"4.23.2-1",sequence:this.sequence,sid:l,timestamp:Cm(p),uid:h,vid:u,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete m.callbackData,void 0===this.ossFilePrefix&&delete m.ossFilePrefix;let v=(function(e,t){let r=e.appId;void 0!==r&&(Ov(t,10),Oh(t,r));let i=e.cid;void 0!==i&&(Ov(t,16),Ov(t,i));let n=e.cname;void 0!==n&&(Ov(t,26),Oh(t,n));let o=e.deviceId;void 0!==o&&(Ov(t,34),Oh(t,o));let a=e.elapse;void 0!==a&&(Ov(t,40),OE(t,a));let s=e.fileSize;void 0!==s&&(Ov(t,48),OE(t,On(s)));let c=e.height;void 0!==c&&(Ov(t,56),OE(t,On(c)));let d=e.jpg;void 0!==d&&(Ov(t,66),Ov(t,d.length),function(e,t){let r=Od(e,t.length);e.bytes.set(t,r)}(t,d));let u=e.networkType;void 0!==u&&(Ov(t,72),OE(t,On(u)));let l=e.osType;void 0!==l&&(Ov(t,80),OE(t,On(l)));let h=e.requestId;void 0!==h&&(Ov(t,90),Oh(t,h));let p=e.sdkVersion;void 0!==p&&(Ov(t,98),Oh(t,p));let f=e.sequence;void 0!==f&&(Ov(t,104),OE(t,On(f)));let _=e.sid;void 0!==_&&(Ov(t,114),Oh(t,_));let A=e.timestamp;void 0!==A&&(Ov(t,120),OE(t,A));let m=e.uid;void 0!==m&&(Ov(t,128),Ov(t,m));let v=e.vid;void 0!==v&&(Ov(t,136),Ov(t,v));let E=e.width;void 0!==E&&(Ov(t,144),OE(t,On(E)));let g=e.service;void 0!==g&&(Ov(t,152),Ov(t,g));let S=e.callbackData;void 0!==S&&(Ov(t,162),Oh(t,S));let b=e.jpgEncryption;void 0!==b&&(Ov(t,168),Ov(t,b));let T=e.requestType;void 0!==T&&(Ov(t,176),Ov(t,T));let y=e.scorePorn;void 0!==y&&(Ov(t,185),OA(t,y));let R=e.scoreSexy;void 0!==R&&(Ov(t,193),OA(t,R));let I=e.scoreNeutral;void 0!==I&&(Ov(t,201),OA(t,I));let C=e.scene;void 0!==C&&(Ov(t,208),Ov(t,C));let k=e.ossFilePrefix;void 0!==k&&(Ov(t,218),Oh(t,k));let w=e.serviceVendor;if(void 0!==w)for(let e of w){Ov(t,226);let r=Oa();(function(e,t){let r=e.service;void 0!==r&&(Ov(t,8),Ov(t,r));let i=e.vendor;void 0!==i&&(Ov(t,16),Ov(t,i));let n=e.token;void 0!==n&&(Ov(t,26),Oh(t,n));let o=e.callbackUrl;void 0!==o&&(Ov(t,34),Oh(t,o))})(e,r),Ov(t,r.limit),function(e,t){let r=Od(e,t.limit),i=e.bytes,n=t.bytes;for(let e=0,o=t.limit;e<o;e++)i[e+r]=n[e]}(t,r),function(e){Oo.push(e)}(r)}}(m,n=Oa()),o=(i=n).bytes,a=i.limit,o.length===a?o:o.subarray(0,a));if(v.byteLength<this.workerMessageLengthLimit){if(E4("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let e=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Og(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Og(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},m);delete e.jpg,gA.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return v}{let t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:s,cname:c,cid:d,vid:u,sid:l,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mU.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Tx.CLOSED,this.emit(TB.STATE_CHANGE,TU.CLOSED)}}var OT=iB(nA.Object.getOwnPropertySymbols),Oy=oD.indexOf,OR=i2([].indexOf),OI=!!OR&&1/OR([1],1,-0)<0;oS({target:"Array",proto:!0,forced:OI||!o6("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return OI?OR(this,e,t)||0:Oy(this,e,t)}});var OC=oM("Array").indexOf,Ok=Array.prototype,Ow=iB(function(e){var t=e.indexOf;return e===Ok||iY(Ok,e)&&t===Ok.indexOf?OC:t});let OO=class{get localCapabilities(){return v2(this._localCapabilities)}get rtpCapabilities(){return v2(this._rtpCapabilities)}get candidates(){return v2(this._candidates)}get iceParameters(){return v2(this._iceParameters)}get dtlsParameters(){return v2(this._dtlsParameters)}constructor(e){let t;Aa(this,"sessionDesc",void 0),Aa(this,"_localCapabilities",void 0),Aa(this,"_rtpCapabilities",void 0),Aa(this,"_candidates",void 0),Aa(this,"_iceParameters",void 0),Aa(this,"_dtlsParameters",void 0),Aa(this,"setup",void 0),Aa(this,"currentMidIndex",void 0),Aa(this,"cname","o/i14u9pJrxRKAsu"),Aa(this,"firefoxSsrcMidMap",new Map);let{remoteIceParameters:r,remoteDtlsParameters:i,candidates:n,remoteRTPCapabilities:o,localCapabilities:a,direction:s,setup:c,videoCodec:d,audioCodec:u}=e=v2(e);this.setup=c,t=s===Te.RECEIVE_ONLY?ge("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):ge("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=o,this._candidates=n,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=a;let l=s===Te.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=s===Te.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=s===Te.RECEIVE_ONLY?o.send.videoCodecs:yF(Tw.VIDEO,l,h,d),f=s===Te.RECEIVE_ONLY?o.send.audioCodecs:yF(Tw.AUDIO,l,h,u);for(let e of t.mediaDescriptions)e.attributes.iceUfrag=r.iceUfrag,e.attributes.icePwd=r.icePwd,e.attributes.fingerprints=i.fingerprints,e.attributes.candidates=n,e.attributes.setup=this.setup,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType&&(e.media.fmts=p.map(e=>e.payloadType.toString(10)),e.attributes.payloads=p,e.attributes.extmaps=l.videoExtensions),"audio"===e.media.mediaType&&(e.media.fmts=f.map(e=>e.payloadType.toString(10)),e.attributes.payloads=f,e.attributes.extmaps=l.audioExtensions,yV(e));this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}toString(){return gt(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,i,n){r=r.replace(/ /g,"-");let{ssrcs:o,ssrcGroups:a}=yk(t,this.cname,E4("SYNC_GROUP")?r:void 0),s=this.findPreloadMediaDesc(o);if(s){if(m1()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,s.attributes.mid),n&&(n.twcc||n.remb)){let e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,n),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{let t;let r=this.findAvailableMediaIndex(e,o,i);return -1===r?(t=this.createOrRecycleSendMedia(e,o,a,"sendonly",i,n),this.updateBundleMids()):((t=v2(this.sessionDesc.mediaDescriptions[r])).attributes.direction="sendonly",t.attributes.ssrcs=o,t.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[r]=this.mungSendMediaDesc(t,n)),m1()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,t.attributes.mid),{needExchangeSDP:!0,mid:t.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{e.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){let i=[];return e.forEach(e=>{let n=e._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(n),a,s=!1;-1===o?(s=!0,a=this.createOrRecycleRecvMedia(e,[],"recvonly",t,r),this.updateBundleMids()):(a=v2(this.sessionDesc.mediaDescriptions[o])).attributes.direction="recvonly",i.push({mid:a.attributes.mid,needCreateTransceiver:s})}),i}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:r,address:i,port:n,type:o,relatedAddress:a,relatedPort:s,priority:c}=new RTCIceCandidate(e),d={foundation:null!=t?t:"",componentId:"1",transport:null!=r?r:"",priority:c?c+"":"",connectionAddress:null!=i?i:"",port:n?n+"":"",type:o?o+"":"",relAddr:null!=a?a:"",relPort:s?s+"":"",extension:{}};this.candidates.some(e=>e.priority===d.priority&&e.connectionAddress===d.connectionAddress&&e.port===d.port)||(this._candidates.push(d),this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,i,n){let o=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,s=yF(o,a,this.localCapabilities.send,o===Tw.AUDIO?n:i),c=o===Tw.VIDEO?a.videoExtensions:a.audioExtensions,d="".concat(++this.currentMidIndex),u={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};u=this.mungRecvMediaDsec(u,e);let l=this.findFirstClosedMedia(o);if(l){let e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>o0(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>o0(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(i=>{let n=i.media.mediaType===e&&"0"!==i.media.port&&("sendonly"===i.attributes.direction||"sendrecv"===i.attributes.direction)&&0===i.attributes.ssrcs.length;if(m1()){if(n){let e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==i.attributes.mid&&"1"!==i.attributes.mid)||!(!e||e!==i.attributes.mid)}return!1}return n&&i.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let r=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&r})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=v2(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,i,n,o){let a=this.rtpCapabilities.send,s=e===Tw.VIDEO?a.videoCodecs:a.audioCodecs,c=e===Tw.VIDEO?a.videoExtensions:a.audioExtensions;m1()&&(n="".concat(++this.currentMidIndex));let d={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:n}};d=this.mungSendMediaDesc(d,o);let u=this.findFirstClosedMedia(e);if(u){let e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}mungRecvMediaDsec(e,t,r){let i=v2(e);return yO(i),yw(i,t),yN(i,t),yP(i),yD(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,t){let r=v2(e);return yD(r,t,this.localCapabilities.recv),yV(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==r){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return(null===(r=t.attributes)||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>m1()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}},ON=["sdp"];function OP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function OD(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?OP(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OP(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let OL=(b$((iT=class e extends TC{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,i){super(t,r),Aa(this,"direction",void 0),Aa(this,"name",void 0),Aa(this,"store",void 0),Aa(this,"spec",void 0),Aa(this,"peerConnection",void 0),Aa(this,"initialOffer",void 0),Aa(this,"transport",void 0),Aa(this,"statsFilter",void 0),Aa(this,"localCandidateCount",0),Aa(this,"_isInRestartIce",!1),Aa(this,"mutex",void 0),Aa(this,"onLocalCandidate",void 0),Aa(this,"remoteSDP",void 0),Aa(this,"pendingCandidates",[]),Aa(this,"localCapabilities",void 0),Aa(this,"isReady",!1),Aa(this,"restartCnt",0),Aa(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new Ep("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=i?i:Te.SEND_ONLY,this.name=this.direction===Te.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=EH(this.peerConnection,E4("STATS_UPDATE_INTERVAL"),void 0,m1()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{let t=await yM();if(this.localCapabilities=yB(t),e){let{sdp:t}=e,r=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},o=bW(e);for(i=0;i<o.length;i++)r=o[i],Ow(t).call(t,r)>=0||(n[r]=e[r]);return n}(e,t);if(OT){var o=OT(e);for(i=0;i<o.length;i++)r=o[i],Ow(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,ON),i=function(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=yT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(yU(t,e,"videoExtensions",r,i,n),yU(t,e,"videoCodecs",r,i,n),yU(t,e,"audioExtensions",r,i,n),yU(t,e,"audioCodecs",r,i,n),E4("RAISE_H264_BASELINE_PRIORITY")){let e=n.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){let t=n.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){gA.debug("raising H264 baseline profile priority");let r=n.videoCodecs[e];n.videoCodecs.splice(e,1),n.videoCodecs.splice(t,0,r)}-1!==t&&E4("FILTER_SEND_H264_BASELINE")&&(r.videoCodecs=r.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:r,recv:i,sendrecv:n}}({},{},t);this.remoteSDP=new OO({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let n=await this.peerConnection.createAnswer();if(!n.sdp)throw Error("Cannot get answer sdp when trying to establish PeerConnection.");let o=yy(n.sdp);await this.peerConnection.setLocalDescription(n);let a=await yx({},{},n.sdp);this.localCapabilities=yB(a);let s=this.peerConnection.getTransceivers()[0];return null!=s&&s.receiver&&s.receiver.transport&&this.tryBindTransportEvents(s.receiver.transport),OD(OD({},o),{},{sdp:n.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let e=await this.peerConnection.createOffer();if(!e.sdp)throw Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=yy(e.sdp);return this.initialOffer=e,OD(OD({},t),{},{sdp:e.sdp})}}catch(e){throw new vm(vA.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:t,iceParameters:r,dtlsParameters:i}=e,n=await yx({},{},t);this.remoteSDP=new OO({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:n,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let o=this.peerConnection.getTransceivers()[0];null!=o&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(e=>{this.peerConnection.addIceCandidate(e)}),this.pendingCandidates=[])}catch(e){throw new vm(vA.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,r){var i=this;return mi(function*(){let n=yield mn(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw Error("Cannot call P2PConnection.send before remote SDP created");let n=[],o=i.remoteSDP.receive(e,t,r);e.forEach((e,t)=>{if(o[t].needCreateTransceiver){let t=i.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});n.push(t),e._updateRtpTransceiver(t)}else{let r=i.peerConnection.getTransceivers().find(e=>e.mid===o[t].mid);if(!r)throw Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(o[t].mid));n.push(r),e._updateRtpTransceiver(r)}}),m1()&&!0===E4("SIMULCAST")&&(yield mn(i.applySimulcastForFirefox(n,e)));let a=o.map(e=>e.mid),s=yield mn(i.peerConnection.createOffer()),c=i.mungSendOfferSDP(s.sdp,e,a),d=ge(c),u=a.map(e=>{let t=d.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("Cannot extract ssrc from mediaDescription.");return yR(t,E4("USE_PUB_RTX"))}),l=n.map((e,t)=>{let r=a[t];return{localSSRC:u[t],id:r}});yield mn(i.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield l}catch(t){let e=i.remoteSDP.toString();throw yield mn(i.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield mn(i.peerConnection.setRemoteDescription({type:"answer",sdp:e})),yield mn(i.stopSending(a,!0)),t}yield mn(i.applySimulcastEncodings(n,e)),yield mn(i.applySendEncodings(n,e));let h=i.remoteSDP.toString(),p=i.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield mn(i.setRemoteDescription({type:"answer",sdp:h})),n.map((e,t)=>{let r=a[t];return{localSSRC:u[t],id:r}})}catch(e){throw e instanceof vm?e:new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{n()}})()}async stopSending(e,t){let r=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map(e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);let n=this.remoteSDP.toString();null==i||i(n),await this.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{r&&r()}}async receive(e,t,r,i){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:n,needExchangeSDP:o}=this.remoteSDP.send(e,t,r,i);if(o){let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(i.sdp,n,e);null==r||r(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),gA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else gA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));let a=this.peerConnection.getTransceivers().find(e=>e.mid===n);if(!a||null===a.mid)throw Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,r,i){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:n,needExchangeSDP:o}=this.remoteSDP.send(e,t,r,i);if(o){let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(i.sdp,n,e);null==r||r(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),gA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else gA.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();null==r||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===EX.Auto&&(this.store.p2pTransport=EX.SdRtn,gR.supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,gR.supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:t}=yy(e.sdp);return this.store.descriptionStart(),this.direction===Te.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Te.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let e=await this.peerConnection.createAnswer();if(!e.sdp)throw Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:t}=yy(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let n=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==o||o(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){let r=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===r.length&&(this.isVP8Simulcast(t)?m1()||await this.applySimulcastEncodings(r,[t]):await this.applySendEncodings(r,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let r=this.peerConnection.getTransceivers().find(e=>e.mid===t);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let{local:t,remote:r}=e[0].transport.iceTransport.getSelectedCandidatePair();return{local:OD(OD({},Ek),{},{candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port}),remote:OD(OD({},Ek),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;o0(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var t;e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else gA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){var i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o={iceServers:[]};return t.iceServers?o.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(vF(t.turnServer.servers)?o.iceServers=t.turnServer.servers:(o.iceServers&&o.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,r,n)),E4("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&t.turnServer.serversFromGateway&&o.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,n)),o0(i=[EX.Relay,EX.SdRtn]).call(i,r)&&(o.iceTransportPolicy="relay"),E4("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(o.iceTransportPolicy="relay")}))),E4("ENABLE_ENCODED_TRANSFORM")&&gR.supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),gA.debug("P2PConnection p2pTransport is ".concat(r)),o}static turnServerConfigToIceServers(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[],n=e.filter(e=>e.tcpport);gA.debug("P2PConnection turnServers is ".concat(n,", current index is ").concat(r));let o=n.length>r?n[r]:n[0];switch(t){case EX.SdRtn:let a=e.filter(e=>{var t;return o0(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL}),s=a.length>r?a[r]:a[0];s&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(ya(s.turnServerURL),":").concat(s.tcpport,"?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(ya(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}));break;case EX.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(ya(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(ya(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};let t=e.iceTransport;t&&(t.onstatechange=()=>{var t;let r=null==e?void 0:e.iceTransport.state;r&&(null===(t=this.onICETransportStateChange)||void 0===t||t.call(this,r))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){let{local:e,remote:r}=t.getSelectedCandidatePair();gA.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var r,i,n;if(!t&&(t=this.peerConnection.getSenders().find(t=>t.track===e._mediaStreamTrack)),!t)return gA.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return gA.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!gR.supportSetRtpSenderParameters)return gA.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let o={},a={};switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(e._encoderConfig){let{bitrateMax:t,frameRate:r,scaleResolutionDownBy:n}=e._encoderConfig;t&&(a.maxBitrate=1e3*t),o0(i=e._hints).call(i,gY.LOW_STREAM)&&(r&&(a.maxFramerate=yc(r)),n&&n>=1&&(a.scaleResolutionDownBy=n))}if(E4("DSCP_TYPE")&&vu()){let e=E4("DSCP_TYPE");o0(n=["very-low","low","medium","high"]).call(n,e)&&(a.networkPriority=e)}let s=t.getParameters(),c=null===(r=s.encodings)||void 0===r?void 0:r[0];m1()&&!c&&(o.encodings=[a]),c&&Object.assign(c,a),Object.assign(s,o),gA.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!gR.supportSetRtpSenderParameters||e.length!==t.length)return;for(let r=0;r<e.length;r++){let i=e[r],n=t[r];n instanceof S8&&!this.isVP8Simulcast(n)&&await this.updateRtpSenderEncodings(n,i.sender)}}catch(e){gA.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,r){let i=ge(e);return t.forEach((e,t)=>{let n=r[t],o=i.mediaDescriptions.find(e=>e.attributes.mid===n);o&&(yw(o,e),yL(o,e,this.store.codec))}),gt(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,r)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,e,t,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var r;null===(r=this.onSelectedLocalCandidateChanged)||void 0===r||r.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var r;null===(r=this.onSelectedRemoteCandidateChanged)||void 0===r||r.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var r,i,n,o,a;let c=e[s],d=t[s];if(d instanceof S8&&!o0(r=d._hints).call(r,gY.LOW_STREAM)&&null!==(i=d._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(n=d._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(o=d._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=d._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){let e={},t={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];let r=c.sender.getParameters();await c.sender.setParameters(Object.assign(r,e))}}}async applySimulcastEncodings(e,t){if(!m1()&&e.length===t.length)for(let r=0;r<e.length;r++){let i=t[r];if(i instanceof S8&&this.isVP8Simulcast(i)){let t=e[r],n={},o={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};n.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];let a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,n))}}}isVP8Simulcast(e){var t,r,i,n,o;return!!(e instanceof S8&&E4("SIMULCAST")&&"vp8"===this.store.codec&&!o0(t=e._hints).call(t,gY.LOW_STREAM)&&null!==(r=e._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=e._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(n=e._scalabilityMode)&&void 0!==n&&n.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,r,i){if(E4("SDP_LOGGING"))return gA.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(t," SDP during P2PConnection.").concat(i,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===r?"remote":"local",i)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);let n=this.remoteSDP.toString();null==i||i(n),await this.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length.");t.map(async e=>{e.direction="sendonly"});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e);let n=this.remoteSDP.toString();null==i||i(n),await this.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var r,i,n;if(t=null!==(r=t)&&void 0!==r?r:null===(i=this.currentRemoteDescription)||void 0===i?void 0:i.sdp){let r=null===(n=ge(t).mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===n?void 0:n.attributes.ssrcs;return null==r?void 0:r[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),o0(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,r){let i=ge(e),n=i.mediaDescriptions.find(e=>e.attributes.mid===t);return n&&r===Tw.AUDIO&&"audio"===n.media.mediaType&&yV(n),gt(i)}}).prototype,"establish",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"establish"),iT.prototype),b$(iT.prototype,"connect",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"connect"),iT.prototype),b$(iT.prototype,"receive",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"receive"),iT.prototype),b$(iT.prototype,"mockReceive",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"mockReceive"),iT.prototype),b$(iT.prototype,"stopReceiving",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"stopReceiving"),iT.prototype),b$(iT.prototype,"restartICE",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"restartICE"),iT.prototype),b$(iT.prototype,"close",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"close"),iT.prototype),b$(iT.prototype,"updateEncoderConfig",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"updateEncoderConfig"),iT.prototype),b$(iT.prototype,"updateSendParameters",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"updateSendParameters"),iT.prototype),b$(iT.prototype,"replaceTrack",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"replaceTrack"),iT.prototype),b$(iT.prototype,"muteLocal",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"muteLocal"),iT.prototype),b$(iT.prototype,"unmuteLocal",[OM],Object.getOwnPropertyDescriptor(iT.prototype,"unmuteLocal"),iT.prototype),iT);function OM(e,t,r){let i=e[t];if("function"!=typeof i)throw Error("Cannot use mutex on object property.");return r.value=async function(){let e=this.mutex,r=await e.lock("From P2PConnection.".concat(t));try{for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return await i.apply(this,o)}finally{r()}},r}let Ox=((ts={}).SEND_ONLY="SEND_ONLY",ts.RECEIVE_ONLY="RECEIVE_ONLY",ts);function OU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function OB(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?OU(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OU(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let OV=(iy=OF(Ox.SEND_ONLY),iR=OF(Ox.SEND_ONLY),iI=OF(),iC=OF(Ox.RECEIVE_ONLY),ik=OF(Ox.RECEIVE_ONLY),iw=OF(Ox.RECEIVE_ONLY),iO=OF(Ox.RECEIVE_ONLY),iN=OF(Ox.RECEIVE_ONLY),iP=OF(Ox.RECEIVE_ONLY),iD=OF(),iL=OF(Ox.RECEIVE_ONLY),b$((iM=class extends vP{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(TM.StateChange,t,this._state)}constructor(e,t){super(),Aa(this,"isPlanB",!1),Aa(this,"store",void 0),Aa(this,"statsUploader",void 0),Aa(this,"sendConnection",void 0),Aa(this,"recvConnection",void 0),Aa(this,"localTrackMap",new Map),Aa(this,"remoteUserMap",new Map),Aa(this,"localDataChannels",[]),Aa(this,"pendingLocalTracks",[]),Aa(this,"pendingRemoteTracks",[]),Aa(this,"statsCollector",void 0),Aa(this,"dtlsFailedCount",0),Aa(this,"sendMutex",void 0),Aa(this,"recvMutex",void 0),Aa(this,"_state",TL.Disconnected),Aa(this,"_restartStates",["disconnected","failed"]),Aa(this,"reconnectInterval",void 0),Aa(this,"uploadUnplinkStarted",!1),Aa(this,"uploadDownlinkStarted",!1),Aa(this,"uplinkStateUploadInterval",void 0),Aa(this,"downlinkStatsUploadInterval",void 0),Aa(this,"handleMuteLocalTrack",async(e,t,r)=>{let i=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{var n,o;if(!this.sendConnection||this.state!==TL.Connected)return void r(new vm(vA.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let i=this.filterTobeMutedTracks(e);if(0===i.length)return void t();let a=i.find(e=>"videoLowTrack"===e[0]);a&&a[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(i.map(e=>{let[,{id:t}]=e;return t}));let s=!1;s="video"===e.trackMediaType?!(null===(n=this.localTrackMap.get(TD.LocalAudioTrack))||void 0===n||!n.track._muted):void 0===(null===(o=this.localTrackMap.get(TD.LocalVideoTrack))||void 0===o?void 0:o.id);let c=this.createMuteMessage(i);await vz(this,TM.RequestMuteLocal,c);let d="video"===e.trackMediaType?TK.MUTE_LOCAL_VIDEO:TK.MUTE_LOCAL_AUDIO;await vz(this,TM.RequestP2PMuteLocal,{action:d,message:c,isMuteAll:s}),t()}catch(e){r(e)}finally{i()}}),Aa(this,"handleUnmuteLocalTrack",async(e,t,r)=>{let i=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==TL.Connected)return void r(new vm(vA.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let i=this.filterTobeUnmutedTracks(e);if(0===i.length)return void t();await this.sendConnection.unmuteLocal(i.map(e=>{let[,{id:t}]=e;return t}));let n=this.createUnmuteMessage(i),o="video"===e.trackMediaType?TK.UNMUTE_LOCAL_VIDEO:TK.UNMUTE_LOCAL_AUDIO;await vz(this,TM.RequestP2PMuteLocal,{action:o,message:n}),t()}catch(e){r(e)}finally{i()}}),Aa(this,"handleUpdateVideoEncoder",async(e,t,r,i)=>{let n;"boolean"==typeof i&&i||(n=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let r=this.localTrackMap.get(TD.LocalVideoTrack);if(!this.sendConnection||!r||r.track!==e||this.state!==TL.Connected)return void t();let{id:i,track:n}=r;i&&(await this.sendConnection.updateSendParameters(i,n),await this.sendConnection.updateEncoderConfig(i,n),this.emit(TM.UpdateVideoEncoder,n)),t()}catch(e){r(e)}finally{var o;null===(o=n)||void 0===o||o()}}),Aa(this,"handleUpdateVideoSendParameters",async(e,t,r)=>{let i=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let r=this.localTrackMap.get(TD.LocalVideoTrack);if(!this.sendConnection||!r||r.track!==e||this.state!==TL.Connected)return void t();let{id:i,track:n}=r;i&&await this.sendConnection.updateSendParameters(i,n),t()}catch(e){r(e)}finally{i()}}),Aa(this,"handleReplaceTrack",async(e,t,r,i)=>{var n,o;let a;gA.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof i&&i||(a=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{let r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(!this.sendConnection||!r||void 0===r[1].id||this.state!==TL.Connected)return void t();if(await (null===(n=this.sendConnection)||void 0===n?void 0:n.replaceTrack(e,r[1].id)),r[0]===TD.LocalVideoTrack&&gR.supportDualStreamEncoding){let t=this.localTrackMap.get(TD.LocalVideoLowTrack);if(t){let r=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r,await new dJ((e,r)=>{this.handleReplaceTrack(t.track,e,r,!0)})}}t()}catch(e){r(e)}finally{null===(o=a)||void 0===o||o()}}),Aa(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),Aa(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),Aa(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),Aa(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new I_(e),this.bindStatsUploaderEvents(),this.sendMutex=new Ep("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Ep("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))})},E4("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new vm(vA.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new vm(vA.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(gA.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new OL(e,this.store,Te.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=TL.New,this.sendConnection&&(gA.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new OL(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new vm(vA.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=TL.Connected}async addRemoteCandidate(e,t){if(t===Te.RECEIVE_ONLY){if(!this.sendConnection)throw new vm(vA.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new vm(vA.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var i=this;return mi(function*(){let n=yield mn(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==TL.Connected){i.throwIfTrackTypeNotMatch(e);let t=e.filter(e=>-1===i.pendingLocalTracks.indexOf(e));return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(t))}i.store.pubId=i.store.pubId+1,RL.markPublishStart(i.store.clientId,i.store.pubId);let n=i.filterTobePublishedTracks(e,t,r);if(0===n.length)return void(yield mn(i.tryToUnmuteAudio(e)));n.forEach(e=>{let{track:t,type:r}=e,n=Date.now();i.store.publish(t.getTrackId(),r===TD.LocalAudioTrack?"audio":"video",n)}),i.bindLocalTrackEvents(n);let o=yield mn(i.sendConnection.send(n.map(e=>{let{track:t}=e;return t}),i.store.codec,i.store.audioCodec)),a=(yield mn(o.next())).value,s=i.createGatewayPublishMessage(n,a);try{yield s}catch(e){throw o.throw(e),(null==e?void 0:e.code)===vA.WS_ABORT&&n.forEach(e=>{let{track:t}=e;-1===i.pendingLocalTracks.indexOf(t)&&i.pendingLocalTracks.push(t)}),i.unbindLocalTrackEvents(n),e}yield mn(o.next()),n.forEach(e=>{let{type:t}=e;i.statsCollector.addLocalStats(t)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(n,a),n.forEach(e=>{let{track:t,type:r}=e,n=Date.now();i.store.publish(t.getTrackId(),r===TD.LocalAudioTrack?"audio":"video",void 0,n)}),i.startUploadUplinkState()}finally{n()}})()}async unpublish(e){if(!this.sendConnection||this.state!==TL.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(t=>!o0(e).call(e,t)));let t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;let r=t.find(e=>"videoLowTrack"===e[0]);r&&r[1].track.close();let i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:r}]=e;return{type:t,track:r}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===TL.Connected)return r&&r[1].track.close(),i;e.forEach(e=>{let t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let e=[],t=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:n,ssrcs:o}]=r,a={stream_type:function(e,t){var r;let i;switch(t){case TD.LocalAudioTrack:i=Tm.Audio;break;case TD.LocalVideoTrack:i=o0(r=e._hints).call(r,gY.SCREEN_TRACK)?Tm.Screen:Tm.High;break;case TD.LocalVideoLowTrack:i=Tm.Low}return i}(n,i),ssrcs:o};n._muted||!n._enabled?e.push(a):t.push(a)}),e.length>0&&e.forEach(e=>{vz(this,TM.RequestMuteLocal,[e])}),t.length>0&&t.forEach(e=>{vz(this,TM.RequestUnmuteLocal,[e])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return mi(function*(){throw new vm(vA.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(gA.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await vQ(this,TM.RequestRePublish,this.pendingLocalTracks),this.emit(TM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new vm(vA.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,i){var n;if(!this.recvConnection)throw new vm(vA.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(n=this.remoteUserMap.get(e))&&void 0!==n&&n.has(t))return;let{track:o,mid:a,transceiver:s}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),i);t===Tw.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new bt(o,e.uid,e._uintid,this.store),gA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),s&&e._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new be(o,e.uid,e._uintid,this.store),gA.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),s&&e._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._videoTrack));let c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let d=this.pendingRemoteTracks.findIndex(r=>{let{user:i,kind:n}=r;return i.uid===e.uid&&t===n});-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(TM.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,i){if(!this.recvConnection)throw new vm(vA.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),i)}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(r=>{let{user:i,kind:n}=r;return void 0!==t?i.uid===e.uid&&t===n:i.uid===e.uid});if(i.forEach(e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.recvConnection||r||i.forEach(t=>{var r,i;let{kind:n}=t;n===Tw.AUDIO?(null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0):n===Tw.VIDEO&&(null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0)}),!this.recvConnection)return;let n=this.filterTobeUnSubscribedTracks(e,t);0!==n.length&&(await this.recvConnection.stopReceiving(n.map(e=>{let[,{id:t}]=e;return t})),this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),n.forEach(e=>{var t,i,n;let[o,{kind:a}]=e;a===Tw.VIDEO&&o._videoSSRC&&(null===(t=this.recvConnection)||void 0===t||t.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===Tw.VIDEO?(this.unbindRemoteTrackEvents(o._videoTrack),r||(null===(i=o._videoTrack)||void 0===i||i._destroy(),o._videoTrack=void 0)):a===Tw.AUDIO&&(this.unbindRemoteTrackEvents(o._audioTrack),!r&&(null===(n=o._audioTrack)||void 0===n||n._destroy(),o._audioTrack=void 0))}),n.forEach(e=>{let[,{kind:t}]=e;vz(this,TM.RequestP2PMuteRemote,t)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,t]=e;[Tw.VIDEO,Tw.AUDIO].forEach(e=>{t.has(e)?vz(this,TM.RequestP2PUnmuteRemote,e):vz(this,TM.RequestP2PMuteRemote,e)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new vm(vA.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new vm(vA.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new vm(vA.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new vm(vA.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void gA.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void gA.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===Tw.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==i&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void gA.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||gA.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(TD.LocalAudioTrack);if((null==t?void 0:t.track)instanceof S0){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==TD.LocalAudioTrack}).filter(t=>{let[r]=t;return!(e&&r===TD.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[r]=t;return!(e&&r===TD.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}reportPublishEvent(e,t,r,i,n){if(e){let r=this.localTrackMap.get(TD.LocalAudioTrack),o=i?this.localTrackMap.get(TD.LocalVideoLowTrack):this.localTrackMap.get(TD.LocalVideoTrack);gT.publish(this.store.sessionId,{eventElapse:RL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==r?void 0:r.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(gY.SCREEN_TRACK)),audio:!!r,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var o;r||(r=[]);let a=r.find(e=>e instanceof Sq),s=i?null===(o=this.localTrackMap.get(TD.LocalVideoTrack))||void 0===o?void 0:o.track:r.find(e=>e instanceof S8);gT.publish(this.store.sessionId,{eventElapse:RL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(gY.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,r,i){let n=i===Tw.VIDEO?r._videoSSRC:r._audioSSRC;n&&gT.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===Tw.VIDEO,audio:i===Tw.AUDIO,peerid:r.uid,subscribeRequestid:i===Tw.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:RL.measureFromSubscribeStart(this.store.clientId,n)})}reset(){gA.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ep("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ep("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(TD.LocalAudioTrack);if((null==e?void 0:e.track)instanceof S0){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=TL.Disconnected}getStats(e){var t,r;return e?null===(r=this.recvConnection)||void 0===r?void 0:r.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(TD.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(TD.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof S8||t&&t.track instanceof Sq?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(go(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(TD.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=pM(e).call(e,(e,t)=>e.level-t.level)}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(gA.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=TL.Reconnecting,E4("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{var t;let[r]=e;r._videoTrack&&r._videoTrack._player&&(null===(t=r._videoTrack._player.getVideoElement())||void 0===t||t.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:i}]=e;switch(r){case TD.LocalVideoTrack:o0(t=i._hints).call(t,gY.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case TD.LocalAudioTrack:i instanceof S0?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case TD.LocalVideoLowTrack:}}),this.emit(TM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(go(r).call(r)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(TM.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),gA.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:n}=r;if((e instanceof RF?e.uid:e)===i.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,i;if(e===Te.SEND_ONLY){if(!this.sendConnection)throw new vm(vA.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new vm(vA.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){let e=await i.restartICE(t);return i.isInRestartIce=!1,e}{let e=await i.restartICE();if(e){let t=await vQ(this,TM.RequestP2PRestartICE,{direction:Te.RECEIVE_ONLY,iceParameter:e});await i.restartICE(t),i.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(TD.LocalVideoTrack),r=this.localTrackMap.get(TD.LocalAudioTrack),i=e.videoSend.find(e=>{var r;return e.ssrc===(null==t||null===(r=t.ssrcs)||void 0===r?void 0:r[0].ssrcId)}),n=e.audioSend.find(e=>{var t;return e.ssrc===(null==r||null===(t=r.ssrcs)||void 0===t?void 0:t[0].ssrcId)});if(!i||!n)return 1;let o=vX(this,TM.NeedSignalRTT),a=i?i.rttMs:void 0,s=n?n.rttMs:void 0,c=a&&s?(a+s)/2:a||s,d=100*e.sendPacketLossRate*.7/50+.3*((c&&o?(c+o)/2:c||o)||0)/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,l=null==t?void 0:t.track;if(l&&l._encoderConfig&&-1===l._hints.indexOf(gY.SCREEN_TRACK)){let t=l._encoderConfig.bitrateMax,r=e.bitrate.actualEncoded;if(t&&r){let e=(1e3*t-r)/(1e3*t);return bP[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,n=i._audioSSRC,o=i._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===n),s=e.videoRecv.find(e=>e.ssrc===o);if(!a&&!s)return void(t+=1);let c=vX(this,TM.NeedSignalRTT),d=e.rtt,u=(d&&c?(d+c)/2:d||c)||0,l=a?a.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*u/1500;l&&(p=.6*h*100/50+.2*u/1500+.2*l/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new dJ((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){let i=[],n=this.getAllTracks();e=v$(e=e.filter(e=>-1===n.indexOf(e)));let o=!1,a=!1;for(let n of e){if(n instanceof S8&&(this.localTrackMap.has(TD.LocalVideoTrack)||o?new vm(vA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:n,type:TD.LocalVideoTrack}),o=!0),t)){let e=this.getLowVideoTrack(n,r);i.push({track:e,type:TD.LocalVideoLowTrack})}if(n instanceof Sq){let e=this.localTrackMap.get(TD.LocalAudioTrack);if(e){if(!(e.track instanceof S0))throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(n._bypassWebAudio)throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(n),this.bindLocalAudioTrackEvents(n,!0)}else if(a){let e=i.find(e=>{let{type:t}=e;return t===TD.LocalAudioTrack});if(!(e.track instanceof S0))throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(n._bypassWebAudio)throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(n)}else{if(!gR.webAudioMediaStreamDest||n instanceof S0||n._bypassWebAudio)i.push({track:n,type:TD.LocalAudioTrack});else{let e=new S0;e.addAudioTrack(n),i.push({track:e,type:TD.LocalAudioTrack})}a=!0}}}return i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();for(let i of e=v$(e=e.filter(e=>-1!==r.indexOf(e)))){if(i instanceof Sq){let e=this.localTrackMap.get(TD.LocalAudioTrack);if(!e)continue;e.track instanceof S0?(e.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),0===e.track.trackList.length&&(t.push([TD.LocalAudioTrack,e]),e.track.close())):t.push([TD.LocalAudioTrack,e])}if(i instanceof S8){let e=this.localTrackMap.get(TD.LocalVideoTrack);if(!e)continue;t.push([TD.LocalVideoTrack,e]);let r=this.localTrackMap.get(TD.LocalVideoLowTrack);r&&t.push([TD.LocalVideoLowTrack,r])}}return t}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:r}=e;switch(r){case TD.LocalVideoTrack:t.addListener(gH.GET_STATS,this.handleGetLocalVideoStats),t.addListener(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(gH.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(gH.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(gH.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case TD.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case TD.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof S0?e.trackList.forEach(e=>{e.addListener(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gH.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(gH.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(gH.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:r}]=e;return{track:r,type:t}})),e.forEach(e=>{let{track:t,type:r}=e;switch(r){case TD.LocalVideoTrack:t.off(gH.GET_STATS,this.handleGetLocalVideoStats),t.off(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(gH.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(gH.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(gH.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case TD.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case TD.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof S0?e.trackList.forEach(e=>{e.off(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gH.GET_STATS,this.handleGetLocalAudioStats),e.off(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(gH.GET_STATS,this.handleGetLocalAudioStats),e.off(gH.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gH.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gH.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(gH.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gH.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof be&&t.addListener(gH.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof bt&&t.addListener(gH.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(gH.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(Tw.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(Tw.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,r)=>{var i;let n,{track:o,type:a}=e;switch(a){case TD.LocalAudioTrack:n=Tm.Audio;break;case TD.LocalVideoTrack:n=o0(i=o._hints).call(i,gY.SCREEN_TRACK)?Tm.Screen:Tm.High;break;case TD.LocalVideoLowTrack:n=Tm.Low}return{kind:a===TD.LocalAudioTrack?Tw.AUDIO:Tw.VIDEO,stream_type:n,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let r,[i,{track:n,ssrcs:o,id:a}]=e;switch(i){case TD.LocalVideoTrack:r=o0(t=n._hints).call(t,gY.SCREEN_TRACK)?Tm.Screen:Tm.High;break;case TD.LocalAudioTrack:r=Tm.Audio;break;case TD.LocalVideoLowTrack:r=Tm.Low}return{stream_type:r,ssrcs:o,mid:a}})}assignLocalTracks(e,t){e.forEach((e,r)=>{let{track:i,type:n}=e;this.localTrackMap.set(n,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(TM.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),o0(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&("disconnected"===t&&await Et(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),gT.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:vx.TRACER}).onSuccess(),this.emit(TM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t,r;let i=Array.from(go(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=i.audioTrack)||void 0===r||r.emit(gq.FIRST_FRAME_DECODED),gT.firstRemoteFrame(this.store.sessionId,gE.FIRST_AUDIO_DECODE,gg.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:RL.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;let r=Array.from(go(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);r&&gT.firstRemoteFrame(this.store.sessionId,gE.FIRST_AUDIO_RECEIVED,gg.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:RL.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,r)=>{this.reportVideoFirstFrameDecoded(e,t,r)},e.onFirstVideoReceived=e=>{var t;let r=Array.from(go(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);r&&gT.firstRemoteFrame(this.store.sessionId,gE.FIRST_VIDEO_RECEIVED,gg.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:RL.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{let r="relay"===e.candidateType,i="relay"===t.candidateType;"unknown"!==t.candidateType&&r===i||this.emit(TM.ConnectionTypeChange,r),gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(yf(t))," -> ").concat(JSON.stringify(yf(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{gA.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(yf(t))," -> ").concat(JSON.stringify(yf(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(TM.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===Te.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,gA.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Te.SEND_ONLY?this.restartICE(e):vQ(this,TM.RequestP2PRestartICE,{direction:Te.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(-1===this.getAllTracks().indexOf(e))return t;let r=this.localTrackMap.get(TD.LocalAudioTrack);if(e instanceof Sq&&(null==r?void 0:r.track)instanceof S0)return r.track.isActive||t.push([TD.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(i&&(t.push(i),i[0]===TD.LocalVideoTrack)){let e=this.localTrackMap.get(TD.LocalVideoLowTrack);e&&t.push([TD.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(TD.LocalAudioTrack);if(e instanceof Sq&&(null==r?void 0:r.track)instanceof S0)return r.track.isActive&&t.push([TD.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(i){if(i[0]===TD.LocalVideoTrack){t.push(i);let e=this.localTrackMap.get(TD.LocalVideoLowTrack);e&&t.push([TD.LocalVideoLowTrack,e])}else t.push(i)}return t}createMuteMessage(e){return e.map(e=>{var t;let r,[i,{track:n,ssrcs:o,id:a}]=e;switch(i){case TD.LocalAudioTrack:r=Tm.Audio;break;case TD.LocalVideoTrack:r=o0(t=n._hints).call(t,gY.SCREEN_TRACK)?Tm.Screen:Tm.High;break;case TD.LocalVideoLowTrack:r=Tm.Low}return{stream_type:r,ssrcs:o,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let r,[i,{track:n,ssrcs:o,id:a}]=e;switch(i){case TD.LocalAudioTrack:r=Tm.Audio;break;case TD.LocalVideoTrack:r=o0(t=n._hints).call(t,gY.SCREEN_TRACK)?Tm.Screen:Tm.High;break;case TD.LocalVideoLowTrack:r=Tm.Low}return{stream_type:r,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let n=i.get(t);if(!n)return r;r.push([e,{kind:t,id:n}])}else Array.from(i.entries()).forEach(t=>{let[i,n]=t;r.push([e,{kind:i,id:n}])});return r}createUnsubscribeMessage(e){let t=[];return e.forEach(e=>{let[r,{kind:i,id:n}]=e;switch(i){case Tw.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Tw.VIDEO,ssrcId:r._videoSSRC}));case Tw.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Tw.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:r}]=e,i=this.remoteUserMap.get(t);i&&(i.delete(r),0===Array.from(i.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(TD.LocalVideoTrack),r=this.localTrackMap.get(TD.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new dJ((e,r)=>{this.handleUpdateVideoEncoder(t.track,e,r,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new dJ((e,t)=>{this.handleUpdateVideoEncoder(r.track,e,t,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Sq){let r=this.filterTobeUnmutedTracks(e[t]);if(0===r.length)continue;let i=this.createUnmuteMessage(r);return void await vz(this,TM.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(TM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(TM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Et(EA(this.dtlsFailedCount,E_)),this.emit(TM.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(TD.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof S8)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof S8).length>1)throw new vm(vA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof Sq).length>1&&(e.some(e=>e instanceof Sq&&e._bypassWebAudio)||!gR.webAudioMediaStreamDest))throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof S8&&this.pendingLocalTracks.some(e=>e instanceof S8))throw new vm(vA.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Sq&&this.pendingLocalTracks.some(e=>e instanceof Sq)&&(!gR.webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof Sq&&e._bypassWebAudio)))throw new vm(vA.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r;let i=!E4("DISABLE_DUAL_STREAM_USE_ENCODING")&&gR.supportDualStreamEncoding,n=OB(OB({},{width:160,height:120,framerate:15,bitrate:50}),t);r=i?e._mediaStreamTrack.clone():Ie(e,n);let o=Er(8,"track-low-"),a=new S8(r,OB(OB({},i&&{scaleResolutionDownBy:yp(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,o);return a.on(gX.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,gK.LOW_STREAM)}),a._hints.push(gY.LOW_STREAM),e.addListener(gH.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,i){var n;let o=Array.from(go(n=this.remoteUserMap).call(n)).find(t=>t._videoSSRC===e);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let n=this.store.keyMetrics,a=n.subscribe.find(e=>e.userId===o.uid&&"video"===e.type);gT.firstRemoteVideoDecode(this.store.sessionId,gE.FIRST_VIDEO_DECODE,gg.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:r,subscribeElapse:RL.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:n.requestAPEnd||0,apStart:n.requestAPStart||0,joinGwEnd:n.joinGatewayEnd||0,joinGwStart:n.joinGatewayStart||0,pcEnd:n.peerConnectionEnd||0,pcStart:n.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let n=i.get(t);if(!n)return!1;let o=await this.recvConnection.getRemoteSSRC(n);return void 0!==o&&o!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new vm(vA.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new vm(vA.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new vm(vA.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new vm(vA.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new vm(vA.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new vm(vA.NOT_SUPPORTED)}async preConnect(e){throw new vm(vA.NOT_SUPPORTED)}getEstablishParams(){throw new vm(vA.NOT_SUPPORTED)}async reSubscribe(e){throw new vm(vA.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new vm(vA.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===TD.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,gK.LOW_STREAM):r._updateRtpTransceiver(void 0)})}}).prototype,"p2pConnect",[iy],Object.getOwnPropertyDescriptor(iM.prototype,"p2pConnect"),iM.prototype),b$(iM.prototype,"unpublish",[iR],Object.getOwnPropertyDescriptor(iM.prototype,"unpublish"),iM.prototype),b$(iM.prototype,"unpublishLowStream",[iI],Object.getOwnPropertyDescriptor(iM.prototype,"unpublishLowStream"),iM.prototype),b$(iM.prototype,"subscribe",[iC],Object.getOwnPropertyDescriptor(iM.prototype,"subscribe"),iM.prototype),b$(iM.prototype,"mockSubscribe",[ik],Object.getOwnPropertyDescriptor(iM.prototype,"mockSubscribe"),iM.prototype),b$(iM.prototype,"unsubscribe",[iw],Object.getOwnPropertyDescriptor(iM.prototype,"unsubscribe"),iM.prototype),b$(iM.prototype,"muteRemote",[iO],Object.getOwnPropertyDescriptor(iM.prototype,"muteRemote"),iM.prototype),b$(iM.prototype,"unmuteRemote",[iN],Object.getOwnPropertyDescriptor(iM.prototype,"unmuteRemote"),iM.prototype),b$(iM.prototype,"hasRemoteMediaWithLock",[iP],Object.getOwnPropertyDescriptor(iM.prototype,"hasRemoteMediaWithLock"),iM.prototype),b$(iM.prototype,"disconnectForReconnect",[iD],Object.getOwnPropertyDescriptor(iM.prototype,"disconnectForReconnect"),iM.prototype),b$(iM.prototype,"remoteMediaSsrcChanged",[iL],Object.getOwnPropertyDescriptor(iM.prototype,"remoteMediaSsrcChanged"),iM.prototype),iM);function OF(e){return function(t,r,i){let n=t[r];if("function"!=typeof n)throw Error("Cannot use mutex on object property.");return i.value=async function(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];switch(e){case Ox.SEND_ONLY:{let e=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await n.apply(this,i)}finally{e()}}case Ox.RECEIVE_ONLY:{let e=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await n.apply(this,i)}finally{e()}}default:{let e=await this.sendMutex.lock("From P2PChannel2.".concat(r)),t=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await n.apply(this,i)}finally{e(),t()}}}},i}}class Oj extends vP{constructor(e,t){super(),Aa(this,"signal",void 0),Aa(this,"token",void 0),Aa(this,"tokenTimeout",void 0),Aa(this,"tokenInterval",void 0),Aa(this,"_sequence",0),Aa(this,"userMap",new Map),Aa(this,"encoder",new TextEncoder),this.signal=e,this.token=t;let r=()=>{this.signal.connectionState===b3.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*E4("P2P_TOKEN_INTERVAL"))};r()}async send(e,t,r,i,n){var o,a,s;if(0===this.userMap.size)return;let c=Array.from(d0(o=this.userMap).call(o))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),i=null!==(a=i)&&void 0!==a?a:Er(6,""),n=null!==(s=n)&&void 0!==s?s:this._sequence++;let d={_id:i,_type:e,_seq:n,_message:t,token:"".concat(this.token,"_").concat(c)};E4("SHOW_P2P_LOG")&&gA.debug("send message",d,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(d)).forEach(e=>{this.signal.request(b5.DATA_STREAM,{payload:v8(this.encoder.encode(e))})});let u=new dJ((t,n)=>{let o=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),a),this.off("res-@".concat(i),c),this.off(TY.ABORT,s),gA.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(i)),0===this.userMap.size?n(new vm(vA.INVALID_REMOTE_USER)):n(new vm(vA.TIMEOUT))},E4("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=()=>{o&&window.clearTimeout(o),this.off(TY.ABORT,s),r&&t()},s=()=>{o&&window.clearTimeout(o),this.off("res-@".concat(i,"_ack"),a),this.off("res-@".concat(i),c),n(new vm(vA.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(i)))};this.once(TY.ABORT,s),this.once("res-@".concat(i,"_ack"),a);let c=(r,c)=>{u=!0,o&&window.clearTimeout(o),this.off("res-@".concat(i,"_ack"),a),this.off(TY.ABORT,s),"success"===r?t(c):n(new vm(vA.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(i)))},u=!1;r||(this.once("res-@".concat(i),c),Et(E4("SIGNAL_REQUEST_TIMEOUT")).then(()=>{u||gA.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(i,", ").concat(d))}))});try{return await u}catch(o){if(o.code===vA.TIMEOUT)return await this.send(e,t,r,i,n);throw o}}onMessage(e){var t,r;let{_uid:i}=e,n,o=this.userMap.get(i);if(o)n=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==TH.CHECK)return;let{token:t}=e;o={uid:i,isStart:!0,token:t,splitMessageMap:n=new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,o),this.signal.emit(b7.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){let{id:t,total:o}=e,a=null!==(r=n.get(t))&&void 0!==r?r:[];if(a.push(e),n.has(t)||n.set(t,a),a.length!==o)return;{let r=pM(a).call(a,(e,t)=>e.index-t.index).map(e=>e.payload).join("");n.delete(t),(e=JSON.parse(r))._uid=i}}let{_type:a,token:s}=e;if(o0(t=[TH.ACK,TH.CHECK]).call(t,a))return a===TH.CHECK&&this.handleCheckToken(o,s),void this.receiveMessage(e);s==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(e):gA.debug('Receive unexpected message", '.concat(s,", cur_token: ").concat(o.token,"_").concat(this.token),e)}check(){let e={_id:Er(6,""),token:this.token,_type:TH.CHECK};E4("SHOW_P2P_LOG")&&gA.debug("send message",e),this.signal.request(b5.DATA_STREAM,{payload:v8(this.encoder.encode(JSON.stringify(e)))})}ack(e){let t={_id:e,_type:TH.ACK,token:this.token};E4("SHOW_P2P_LOG")&&gA.debug("send message",t),this.signal.request(b5.DATA_STREAM,{payload:v8(this.encoder.encode(JSON.stringify(t)))})}response(e,t,r){this.send(TH.RESPONSE,JSON.stringify({success:!r,message:t}),!0,e)}handleReceivedMessage(e){let t=()=>{this.userMap.forEach(e=>{let{receivedMessagesMap:t,nextExpectedSequenceNumber:r}=e;for(;t.has(r);){let i=t.get(r);t.delete(r),this.receiveMessage(i),e.nextExpectedSequenceNumber++}})};if(!e)return void t();let{_uid:r,_seq:i}=e,n=this.userMap.get(r),{receivedMessagesMap:o,isStart:a,nextExpectedSequenceNumber:s}=n;if(i<s)return this.ack(e._id),void gA.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(e._message));o.set(i,e),a&&i===s&&(this.receiveMessage(e),o.delete(s),n.nextExpectedSequenceNumber++,t())}receiveMessage(e){let{_id:t,_type:r,_message:i,_uid:n}=e;if(E4("SHOW_P2P_LOG")&&gA.debug("receive message",e),t){let o;switch(e._type!==TH.ACK&&(i&&(o=JSON.parse(i)),this.ack(e._id)),e._type){case TH.CANDIDATE:case TH.CONTROL:this.signal.emit(r,o,n);break;case TH.PUBLISH:case TH.UNPUBLISH:case TH.RESTART_ICE:case TH.CALL:o.uid=n,vQ(this.signal,r,o).then(t=>{this.response(e._id,t)}).catch(()=>{this.response(e._id,void 0,!0)});break;case TH.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case TH.RESPONSE:{let{success:e,message:r}=o;this.emit("res-@".concat(t),e?"success":"failed",r)}}}}splitMessage(e){if(e.length<Oj.MAX_MESSAGE_SIZE)return[e];let t=[],{remoteToken:r}=JSON.parse(e),i=Er(6,""),n=0,o=800,a=Math.ceil(e.length/o);for(;e.length>0;){let s={id:i,index:++n,total:a,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(s).length>Oj.MAX_MESSAGE_SIZE?o-=50:(t.push(s),e=e.slice(o))}return t.map(e=>JSON.stringify(e))}handleCheckToken(e,t){return e.token!==t?(gA.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{gA.debug("token timeout, ".concat(t)),this.reset(e.uid)},E4("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let e=await vQ(this.signal,TH.CALL,void 0),t=await this.send(TH.CALL,e);this.signal.emit(b8.P2P_CONNECTION,t,!0)}async reset(e,t){let r=this.userMap.get(e);r&&(this.emit(TY.ABORT),this.signal.emit(b7.ON_USER_OFFLINE,{uid:r.uid,reason:TQ.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(gA.debug("change local token from ".concat(t," to ").concat(t)),this.token=Er(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(TY.ABORT)}}Aa(Oj,"MAX_SIZE",1),Aa(Oj,"MAX_MESSAGE_SIZE",1024);class OG extends vP{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===b3.CONNECTED?this.emit(b8.WS_CONNECTED):e===b3.RECONNECTING?this.emit(b8.WS_RECONNECTING,this._websocketReconnectReason):e===b3.CLOSED&&this.emit(b8.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),Aa(this,"_disconnectedReason",void 0),Aa(this,"_websocketReconnectReason",void 0),Aa(this,"_connectionState",b3.CLOSED),Aa(this,"reconnectToken",void 0),Aa(this,"p2pToken",void 0),Aa(this,"websocket",void 0),Aa(this,"openConnectionTime",void 0),Aa(this,"clientId",void 0),Aa(this,"lastMsgTime",Date.now()),Aa(this,"uploadCache",[]),Aa(this,"uploadCacheInterval",void 0),Aa(this,"rttRolling",new EE(5)),Aa(this,"pingpongTimer",void 0),Aa(this,"pingpongTimeoutCount",0),Aa(this,"joinResponse",void 0),Aa(this,"multiIpOption",void 0),Aa(this,"initError",void 0),Aa(this,"spec",void 0),Aa(this,"store",void 0),Aa(this,"_external_signal",void 0),Aa(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(b8.ON_BINARY_DATA,e.data);let t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){let e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case b7.ON_DATA_STREAM:return void this.handleDataStream(t._message);case b7.MUTE_AUDIO:case b7.MUTE_VIDEO:case b7.ON_P2P_LOST:case b7.ON_USER_ONLINE:return;case b7.ON_USER_OFFLINE:let{uid:e}=t._message;return gA.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===b7.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===b7.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(vV.UID_BANNED);break;case 15:this.close(vV.IP_BANNED);break;case 16:this.close(vV.CHANNEL_BANNED)}if(t._type===b7.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case b6.ERR_LICENSE_MISSING:this.close(vV.LICENSE_MISSING);break;case b6.ERR_LICENSE_EXPIRED:this.close(vV.LICENSE_EXPIRED);break;case b6.ERR_LICENSE_MINUTES_EXCEEDED:this.close(vV.LICENSE_MINUTES_EXCEEDED);break;case b6.ERR_LICENSE_PERIOD_INVALID:this.close(vV.LICENSE_PERIOD_INVALID);break;case b6.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(vV.LICENSE_MULTIPLE_SDK_SERVICE);break;case b6.ERR_LICENSE_ILLEGAL:this.close(vV.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new T7("gateway-".concat(this.clientId),this.spec.retryConfig,!0,E4("JOIN_GATEWAY_USE_DUAL_DOMAIN"),E4("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===b3.CONNECTED&&this.reconnect("retry",vH.OFFLINE)}),this.p2pToken=Er(6,""),this._external_signal=new Oj(this,this.p2pToken)}async request(e,t,r,i){let n=Er(6,""),o=this.websocket.connectionID,a=()=>new dJ((e,t)=>{if(this.connectionState===b3.CONNECTED)return e();let r=()=>{this.off(b8.WS_CLOSED,i),e()},i=()=>{this.off(b8.WS_CONNECTED,r),t(new vm(vA.WS_ABORT))};this.once(b8.WS_CONNECTED,r),this.once(b8.WS_CLOSED,i)});if(this.connectionState!==b3.CONNECTING&&this.connectionState!==b3.RECONNECTING||e===b5.JOIN||e===b5.REJOIN||await a(),this.websocket.sendMessage({_id:n,_type:e,_message:t},!0),i)return;let s=new dJ((r,i)=>{let a=!1,s=(i,n)=>{a=!0,r({isSuccess:"success"===i,message:n||{}}),this.off(b8.WS_CLOSED,c),this.off(b8.WS_RECONNECTING,c),this.emit(b8.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(n),s);let c=()=>{i(new vm(vA.WS_ABORT,"type: ".concat(e))),this.off(b8.WS_CLOSED,c),this.off(b8.WS_RECONNECTING,c),this.off("res-@".concat(n),s)};this.once(b8.WS_CLOSED,c),this.once(b8.WS_RECONNECTING,c),Et(E4("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==o||a||(gA.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(b8.REQUEST_TIMEOUT,e,t))})}),c=null;try{c=await s}catch(i){if(this.connectionState===b3.CLOSED||e===b5.LEAVE)throw new vm(vA.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?i.throw():e===b5.JOIN||e===b5.REJOIN?null:(await a(),await this.request(e,t))}if(c.isSuccess)return c.message;let d=Number(c.message.error_code||c.message.code),u=Tq(d),l=new vm(vA.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(c.message.error_str),{code:d,data:c.message,desc:u.desc});return"success"===u.action?c.message:(gA.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===b6.ERR_TOO_MANY_BROADCASTERS?((e===b5.JOIN||e===b5.REJOIN)&&(this.initError=l,this.close()),l.throw()):"failed"===u.action?l.throw():"quit"===u.action?(this.initError=l,this.close(),l.throw()):(d===b6.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=c.message.option,gA.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",vH.MULTI_IP)):this.reconnect(u.action,vH.SERVER_ERROR),e===b5.JOIN||e===b5.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new dJ(r=>{let i=n=>{(!t||t(n))&&(this.off(e,i),r(n))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void gA.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(b9.WRTC_STATS,t)}upload(e,t){let r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(t){let e=E4("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==b3.CONNECTED)return;let e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},E4("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){this.websocket.sendMessage({_type:e,_message:t})}async sendExtensionMessage(e,t,r){return await this._external_signal.send(e,t,r)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dJ((t,r)=>{this.once(b8.WS_CONNECTED,()=>t(this.joinResponse)),this.once(b8.WS_CLOSED,()=>r(this.initError||new vm(vA.WS_ABORT))),this.connectionState=b3.CONNECTING,this.websocket.init(e).catch(r)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||vV.LEAVE,this.connectionState=b3.CLOSED,gA.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Er(6,""),this._external_signal.clear(),this._external_signal=new Oj(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(b8.ABORT_P2P_EXECUTION);let e=await vQ(this,b8.REQUEST_JOIN_INFO),t=await this.request(b5.JOIN,e);if(!t)return this.emit(b8.REPORT_JOIN_GATEWAY,vA.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(b8.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=b3.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;let r=v3(e.payload),i=(new TextDecoder).decode(r),n=JSON.parse(i);"total"in n&&"id"in n||o0(t=Object.values(TH)).call(t,n._type)?(n._uid=e.uid,this._external_signal.onMessage(n)):this.emit(b7.ON_DATA_STREAM,e)}catch(t){this.emit(b7.ON_DATA_STREAM,e)}}handleNotification(e){gA.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Tq(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(vV.UID_BANNED),void this.close()):void this.reconnect(t.action,vH.SERVER_ERROR);gA.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=E4("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(gA.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>E4("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",vH.TIMEOUT):this.request(b5.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let e=Date.now()-t;this.rttRolling.add(e),E4("REPORT_STATS")&&this.send(b5.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWebsocketEvents(){this.websocket.on(Tt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(b8.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Tt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Tt.CLOSED,()=>{this.connectionState=b3.CLOSED}),this.websocket.on(Tt.FAILED,()=>{this._disconnectedReason=vV.NETWORK_ERROR,this.connectionState=b3.CLOSED}),this.websocket.on(Tt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===b3.CONNECTED?this.connectionState=b3.RECONNECTING:this.connectionState=b3.CONNECTING}),this.websocket.on(Tt.WILL_RECONNECT,(e,t,r)=>{"retry"!==e?(gA.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):gA.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(e)}),this.websocket.on(Tt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(b8.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof vm&&e.code===vA.UNEXPECTED_RESPONSE&&e.data.code===b6.ERR_NO_AUTHORIZED)return gA.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",vH.SERVER_ERROR);gA.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",vH.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Tt.REQUEST_NEW_URLS,(e,t)=>{vQ(this,b8.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Tt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(b7.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function OW(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function OH(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?OW(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OW(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class OY{constructor(e){Aa(this,"sessionDesc",void 0),Aa(this,"localCapabilities",void 0),Aa(this,"rtpCapabilities",void 0),Aa(this,"candidates",void 0),Aa(this,"_originCandidates",void 0),Aa(this,"iceParameters",void 0),Aa(this,"dtlsParameters",void 0),Aa(this,"setup",void 0),Aa(this,"currentMidIndex",void 0),Aa(this,"cname",void 0);let{iceParameters:t,dtlsParameters:r,candidates:i,rtpCapabilities:n,setup:o,localCapabilities:a,sdkCodec:s,cname:c}=e=v2(e),d=ge("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=n,this.candidates=i,this._originCandidates=v2(i),this.iceParameters=t,this.dtlsParameters=r,this.setup=o,this.localCapabilities=a,this.cname=c;for(let e=0;e<d.mediaDescriptions.length;e++){let a=d.mediaDescriptions[e];if(a.attributes.iceUfrag=t.iceUfrag,a.attributes.icePwd=t.icePwd,a.attributes.fingerprints=r.fingerprints,a.attributes.candidates=i,a.attributes.setup=o,"video"===a.media.mediaType){a.media.fmts=n.videoCodecs.map(e=>e.payloadType.toString(10));let e=n.videoCodecs.filter(e=>{var t,r;return null===(t=e.rtpMap)||void 0===t?void 0:o0(r=t.encodingName.toLowerCase()).call(r,s)});0===e.length&&(e=n.videoCodecs),a.attributes.payloads=e,a.attributes.extmaps=n.videoExtensions}"audio"===a.media.mediaType&&(a.media.fmts=n.audioCodecs.map(e=>e.payloadType.toString(10)),a.attributes.payloads=n.audioCodecs,a.attributes.extmaps=n.audioExtensions),d.mediaDescriptions[e]=this.mungMediaDesc(a)}this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return gt(this.sessionDesc)}send(e,t,r){let{ssrcs:i,ssrcGroups:n}=yk(t,this.cname),o=this.sessionDesc.mediaDescriptions.find(t=>e===Tw.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType),a=i[0].attributes.label,s=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(n),{id:a,mslabel:s}}batchSend(e){return e.map(e=>{let{kind:t,ssrcMsg:r}=e;return this.send(t,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(t=>{let r=[],i=[],n=[];t.attributes.ssrcs.forEach(t=>{o0(e).call(e,t.attributes.label||"")?n.push(t):r.push(t)}),t.attributes.ssrcGroups.forEach(e=>{var t;o0(t=n.map(e=>e.ssrcId)).call(t,e.ssrcIds[0])||i.push(e)}),t.attributes.ssrcs=r,t.attributes.ssrcGroups=i})}mute(e){let t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,r){e.forEach((e,t)=>{let r=e._mediaStreamTrack,i=this.sessionDesc.mediaDescriptions.findIndex(e=>e.attributes.mid===r.kind),n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],e);this.sessionDesc.mediaDescriptions[i]=n})}stopReceiving(e){}updateCandidates(e){let t=this._originCandidates.filter(e=>"udp"===e.transport),r=[];if(t.forEach(e=>{r.push(OH(OH({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case TO.TCP_RELAY:this.candidates=r;break;case TO.UDP_TCP_RELAY:case TO.RELAY:this.candidates=[...t,...r];break;default:this.candidates=t}for(let e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=v2(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}mungRecvMediaDsec(e,t){let r=v2(e);return yw(r,t),yN(r,t),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==r){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,r){let i=this.sessionDesc.mediaDescriptions.find(t=>e===Tw.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid);if(i){var n;let e=i.attributes.ssrcs.find(e=>e.attributes.label===t);e&&(e.attributes.label=r,null===(n=e.attributes.msid)||void 0===n||n.replace(t,r))}}mungMediaDesc(e){let t=v2(e);return yO(t),function(e){let t=e.attributes.extmaps.find(e=>yg(e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach(e=>{let t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}(t),t}getSSRC(e){for(let t of this.sessionDesc.mediaDescriptions)for(let r of t.attributes.ssrcs)if(r.attributes.label===e)return[r]}}function OK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function OQ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?OK(Object(r),!0).forEach(function(t){Aa(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OK(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let Oz=(b$((ix=class e extends Tk{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return o0(t=Object.keys(E5)).call(t,e)}))]}constructor(t,r){super(t,r),Aa(this,"store",void 0),Aa(this,"peerConnection",void 0),Aa(this,"remoteSDP",void 0),Aa(this,"initialOffer",void 0),Aa(this,"statsFilter",void 0),Aa(this,"useRTX",!1),Aa(this,"localCapabilities",void 0),Aa(this,"localCandidateCount",0),Aa(this,"allCandidatesReceived",!1),Aa(this,"establishPromise",void 0),Aa(this,"mutex",void 0),this.store=r,this.mutex=new Ep("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=EH(this.peerConnection,E4("STATS_UPDATE_INTERVAL"),void 0,m1()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=yy(e.sdp),r=yT(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:E4("FILTER_VIDEO_FEC"),filterAudioFec:E4("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=e,OQ(OQ({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:e.sdp})}catch(e){throw new vm(vA.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new OY(OQ(OQ({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new vm(vA.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var r=this;return mi(function*(){let i=yield mn(r.mutex.lock());try{let i;if(!r.remoteSDP)throw Error("Cannot call P2PConnection.send before remote SDP created");let n=e.map(e=>r.peerConnection.addTrack(e._mediaStreamTrack)),o=yield mn(r.peerConnection.createOffer()),a=ge(o.sdp),s=e.map(e=>{let t=e._mediaStreamTrack,i=a.mediaDescriptions.find(e=>e.attributes.mid===t.kind);if(!i)throw Error("Cannot extract ssrc from mediaDescription.");return function(e,t,r){let i=e.attributes.ssrcs.filter(e=>e.attributes.label===t),n=e.attributes.ssrcGroups;if(0===i.length)throw Error("Cannot extract ssrc from plan-b SDP.");if(n&&i.length>1){let e=n.find(e=>-1!==e.ssrcIds.indexOf(i[0].ssrcId));return e?[{ssrcId:e.ssrcIds[0],rtx:r?e.ssrcIds[1]:void 0}]:[{ssrcId:i[0].ssrcId}]}return[{ssrcId:i[0].ssrcId}]}(i,t.id,r.useRTX)});try{i=yield s}catch(e){throw n.forEach(e=>{m0()&&e.replaceTrack(null),r.peerConnection.removeTrack(e)}),e}let c=r.mungSendOfferSDP(o.sdp,e);r.remoteSDP.receive(e,t,i);let d=r.remoteSDP.toString();return yield mn(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield mn(r.applySendEncodings(n,e)),yield mn(r.peerConnection.setRemoteDescription({type:"answer",sdp:d})),e.map((e,t)=>{let r=e._mediaStreamTrack.id;return{localSSRC:s[t],id:r}})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}})()}async stopSending(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getSenders().filter(t=>{var r;return -1!==e.indexOf((null===(r=t.track)||void 0===r?void 0:r.id)||"")});if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{m0()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)});let r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,r,i){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{id:r,mslabel:n}=this.remoteSDP.send(e,t,i),o=new dJ((t,i)=>{let o=setTimeout(()=>{i(Error("Cannot receive track, id: ".concat(r)))},1e4),a=i=>{let s=mz();if(("Safari"===s.name&&11===Number(s.version)||m4())&&i.track.id!==r&&i.streams[0].id===n){var c;let n=i.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,r,i.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(n)}if(i.track.id===r)return this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(i.track)};this.peerConnection.addEventListener("track",a)}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});let s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),{track:await o,id:r}}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter(t=>{var r;return -1!==e.indexOf((null===(r=t.track)||void 0===r?void 0:r.id)||"")});if(t.length!==e.length)throw Error("sender' length doesn't match mids' length.");t.map(e=>{if(m0()&&e.track)e.track.enabled=!1;else{let t=e.getParameters();t.encodings.forEach(e=>e.active=!1),e.setParameters(t)}})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter(t=>{var r;return -1!==e.indexOf((null===(r=t.track)||void 0===r?void 0:r.id)||"")});if(t.length!==e.length)throw Error("Senders' length doesn't match mids' length.");t.map(async e=>{if(m0()&&e.track)e.track.enabled=!0;else{let t=e.getParameters();t.encodings.forEach(e=>e.active=!0),await e.setParameters(t)}});let r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return mi(function*(){let r=yield mn(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw Error("Cannot restartICE before remoteSDP created.");let r=gR.supportPCSetConfiguration;if(e===TO.RELAY&&!r)return;if(r){let r=t.peerConnection.getConfiguration(),i=e===TO.RELAY?"relay":"all";r.iceTransportPolicy!==i&&(gA.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(r.iceTransportPolicy,"] to [").concat(i,"]")),r.iceTransportPolicy=i,t.peerConnection.setConfiguration(r))}e!==TO.RELAY&&t.remoteSDP.updateCandidates(e);let i=yield mn(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw Error("Cannot restartICE because restart offer SDP does not exist.");let n=yy(i.sdp),{remoteIceParameters:o}=yield n.iceParameters;t.remoteSDP.restartICE(o);let a=t.remoteSDP.toString();yield mn(t.peerConnection.setLocalDescription(i)),yield mn(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(e){gA.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{r()}})()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let e=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);let i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){let r=this.peerConnection.getSenders().filter(t=>{var r;return(null===(r=t.track)||void 0===r?void 0:r.id)===e});1===r.length&&await this.applySendEncodings(r,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let r=this.peerConnection.getSenders().find(e=>{var r;return(null===(r=e.track)||void 0===r?void 0:r.id)===t});r&&await r.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new vm(vA.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new vm(vA.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,gA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,gA.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},E4("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(vF(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),E4("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(e){let t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var r,i;if(!t&&(t=this.peerConnection.getSenders().find(t=>{var r;return(null===(r=t.track)||void 0===r?void 0:r.id)===e._mediaStreamTrack.id})),!t)return gA.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!gR.supportSetRtpSenderParameters)return gA.warn("Browser not support set rtp-sender parameters");let n={},o={};if(e instanceof S8)switch(e._optimizationMode){case"motion":n.degradationPreference="maintain-framerate";break;case"detail":n.degradationPreference="maintain-resolution";break;default:n.degradationPreference="balanced"}if(E4("DSCP_TYPE")&&vu()){let e=E4("DSCP_TYPE");o0(i=["very-low","low","medium","high"]).call(i,e)&&(o.networkPriority=e)}let a=t.getParameters(),s=null===(r=a.encodings)||void 0===r?void 0:r[0];s&&Object.assign(s,o),Object.assign(a,n),gA.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!gR.supportSetRtpSenderParameters||e.length!==t.length)return;for(let r=0;r<e.length;r++){let i=e[r],n=t[r];i&&n&&await this.updateRtpSenderEncodings(n,i)}}catch(e){gA.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){let r=ge(e);return t.forEach((e,t)=>{let i=e._mediaStreamTrack,n=r.mediaDescriptions.find(e=>e.attributes.mid===i.kind);n&&yw(n,e)}),gt(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,r)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,e,t,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var r;null===(r=this.onSelectedLocalCandidateChanged)||void 0===r||r.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var r;null===(r=this.onSelectedRemoteCandidateChanged)||void 0===r||r.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let t=this.remoteSDP.batchSend(e).map((t,r)=>{let{id:i,mslabel:n}=t,{kind:o}=e[r];return new dJ((e,t)=>{let r=setTimeout(()=>{t(Error("Cannot receive track, id: ".concat(i)))},1e4),a=t=>{let s=mz();if("Safari"===s.name&&11===Number(s.version)&&t.track.id!==i&&t.streams[0].id===n){var c;let n=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(o,i,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(r),void e({track:n,id:i})}if(t.track.id===i)return this.peerConnection.removeEventListener("track",a),clearTimeout(r),void e({track:t.track,id:i})};this.peerConnection.addEventListener("track",a)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await dJ.all(t)}catch(e){throw new vm(vA.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(gR.supportPCSetConfiguration){let r=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}}).prototype,"connect",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"connect"),ix.prototype),b$(ix.prototype,"stopSending",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"stopSending"),ix.prototype),b$(ix.prototype,"receive",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"receive"),ix.prototype),b$(ix.prototype,"stopReceiving",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"stopReceiving"),ix.prototype),b$(ix.prototype,"muteRemote",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"muteRemote"),ix.prototype),b$(ix.prototype,"unmuteRemote",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"unmuteRemote"),ix.prototype),b$(ix.prototype,"muteLocal",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"muteLocal"),ix.prototype),b$(ix.prototype,"unmuteLocal",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"unmuteLocal"),ix.prototype),b$(ix.prototype,"close",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"close"),ix.prototype),b$(ix.prototype,"updateEncoderConfig",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"updateEncoderConfig"),ix.prototype),b$(ix.prototype,"updateSendParameters",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"updateSendParameters"),ix.prototype),b$(ix.prototype,"replaceTrack",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"replaceTrack"),ix.prototype),b$(ix.prototype,"getRemoteSSRC",[OX],Object.getOwnPropertyDescriptor(ix.prototype,"getRemoteSSRC"),ix.prototype),ix);function OX(e,t,r){let i=e[t];if("function"!=typeof i)throw Error("Cannot use mutex on object property.");return r.value=async function(){let e=this.mutex,r=await e.lock("Locking from P2PConnection.".concat(t));try{for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return await i.apply(this,o)}finally{r()}},r}let OJ={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!gR.supportWebRTCEncodedTransform)return void gA.warning("browser not support audio encoded transform");if(bd.has(e)||!e.track)return;let r={track:e.track};if(m$()){if(!e.createEncodedStreams)return void gA.warning("browser not support createEncodedStreams() API");let n=null;try{n=e.createEncodedStreams()}catch(e){return void gA.error("create audio-encoded-streams error",e&&e.message)}let o=new TransformStream({transform(n,o){r.controller||(r.controller=o),e.track&&e.track.id!==r.track.id&&(gA.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let a=t.metadata&&t.metadata();a?function(e,t){let{chunk:r,controller:i}=t,n=E4("ENABLE_AUDIO_PTS_METADATA")?bs.AUDIO_64_BIT_PTS:bs.METADATA;r.data=function(e,t,r){let i=r.byteLength,n=i+1+2,o=3+n,a=new DataView(new ArrayBuffer(e.byteLength+o));a.setUint8(0,71),a.setUint16(1,n),a.setUint8(3,t),a.setUint16(4,i);for(let e=0;e<i;e++)a.setUint8(6+e,r[e]);let s=new Uint8Array(a.buffer);return s.set(new Uint8Array(e),o),s.buffer}(r.data,n,e),i.enqueue(r)}(a,{sender:e,chunk:n,controller:o}):o.enqueue(n)}});n.readable.pipeThrough(o).pipeTo(n.writable)}else if(m0()){if("undefined"==typeof RTCRtpScriptTransform)return void gA.warning("browser not support RTCRtpScriptTransform");let n=ba(),o=new MessageChannel;await new dJ(e=>n.onmessage=t=>{"registered"===t.data&&e(void 0)});let a=new RTCRtpScriptTransform(n,{name:"audio-metadata-tx",port:o.port2},[o.port2]);e.transform=a,await new dJ(e=>n.onmessage=t=>{"started"===t.data&&e(void 0)}),o.port1.onmessage=n=>{var a;if(n.data.transformed&&e.track&&(null===(a=e.track)||void 0===a?void 0:a.id)!==r.track.id)gA.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i);else if(n.data.getMetadata){let e=t.metadata&&t.metadata();e&&o.port1.postMessage({metadata:e})}},r.worker=n}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let t=bd.get(e);if(t){bd.delete(e);try{var r,n;null===(r=t.controller)||void 0===r||r.terminate(),null===(n=t.worker)||void 0===n||n.terminate()}catch(e){gA.warning(e&&e.message)}}}bd.set(e,r),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!gR.supportWebRTCEncodedTransform)return void gA.warning("browser not support audio encoded transform");if(bC.has(t))return;let i={track:t.track,onMetadata:r.onMetadata};if(m$()){if(!t.createEncodedStreams)return void gA.warning("browser not support createEncodedStreams() API");m8(mH.CHROME,87,116)||(r.enableTopn=!1);let o=null;try{o=t.createEncodedStreams()}catch(e){return void gA.error("create audio-encoded-streams error",e&&e.message)}let a=new TransformStream({transform(o,a){i.controller||(i.controller=a),t.track&&t.track.id!==i.track.id&&(gA.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",n),i.track=t.track,i.track.addEventListener("ended",n)),r.enableTopn?function(t,r,i){var n;let o=bc(new DataView(r.data));if(!o)return i.enqueue(r);let a=t.track.id;bk.set(a,t.track);let s=null===(n=o.tlv.find(e=>e.tag===bs.AUDIO_LEVEL))||void 0===n?void 0:n.value,c=0;"number"==typeof s&&(c=127-s);let{selected:d,speaker:u}=function(e,t){let r=bE.get(e);if(r||(r=function(e){let t=new b_;return bE.set(e,t),bg||(bg=new bv(E4("TOPN_SILENCE_THRESHOLD")||500)).on("ActiveSpeakerChanged",e=>{null!=e&&(bS=e)}),bg.addSpeakers([t]),t}(e)),bE.size<=3)return{selected:!0,speaker:r};if(!bg)throw Error("no active speaker detector");return bg.levelChanged(r.id,t),bb=bg.loudest.map(e=>e.id),bS&&!o0(bb).call(bb,bS)&&bb.length>=3&&bb.pop(),{selected:o0(bb).call(bb,r.id)||r.id===bS,speaker:r}}(t,Math.round(Math.pow(10,c/60)-1)),l=function(t,r,i){let n=bT.get(t)||new bR(t,r);return n.score=i,bT.set(t,n),function(t){if(by.set(t,!0),!e)return void(e=Date.now());let r=Date.now();r-e>1e3&&(by.get(t)?by.set(t,!1):(bI(t),by.delete(t)),e=r)}(t),n}(a,t.track,u.energyScore);l.addSample(d),l.active&&(r.data=o.frame.buffer,i.enqueue(r))}(t,o,a):r.enableMetadata?function(e,t,r){let i=bc(new DataView(e.data));if(!i)return t.enqueue(e);let n=i.tlv.find(e=>e.tag===bs.METADATA||e.tag===bs.AUDIO_64_BIT_PTS);n&&r&&n.value instanceof Uint8Array&&r(n.value),e.data=i.frame.buffer,t.enqueue(e)}(o,a,r.onMetadata):a.enqueue(o)}});o.readable.pipeThrough(a).pipeTo(o.writable)}else if(m0()){if("undefined"==typeof RTCRtpScriptTransform)return void gA.warning("browser not support RTCRtpScriptTransform");let e=ba(),r=new MessageChannel;await new dJ(t=>e.onmessage=e=>{"registered"===e.data&&t(void 0)});let o=new RTCRtpScriptTransform(e,{name:"audio-metadata-rx",port:r.port2},[r.port2]);t.transform=o,await new dJ(t=>e.onmessage=e=>{"started"===e.data&&t(void 0)}),r.port1.onmessage=e=>{var r;e.data.transformed&&t.track&&(null===(r=t.track)||void 0===r?void 0:r.id)!==i.track.id?(gA.debug("audio track changed: ".concat(i.track.id," => ").concat(t.track.id)),i.track.removeEventListener("ended",n),i.track=t.track,i.track.addEventListener("ended",n)):e.data.metadata&&i.onMetadata&&i.onMetadata(e.data.metadata)},i.worker=e}function n(){t.track.removeEventListener("ended",n),function(e){let t=bC.get(e);if(t){(function(e){let t=bE.get(e);t&&(bE.delete(e),bg&&(bg.removeSpeakers([t]),0===bE.size&&(bg.destroy(),bg=null)))})(e),bI(e.track.id),bC.delete(e);try{var r,i;null===(r=t.controller)||void 0===r||r.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){gA.warning(e&&e.message)}}}(t)}bC.set(t,i),t.track.addEventListener("ended",n)},interceptLocalVideoFrame:async function(e,t){if(!gR.supportWebRTCEncodedTransform)return void gA.warning("browser not support video encoded transform");if(bw.has(e)||!e.track)return;let r={track:e.track};if(m$()){if(!e.createEncodedStreams)return void gA.warning("browser not support createEncodedStreams() API");let n=null;try{n=e.createEncodedStreams()}catch(e){return void gA.error("create video-encoded-streams error",e&&e.message)}let o=[];t.on("sei-to-send",e=>{o.push(e)});let a=new TransformStream({transform(t,n){r.controller||(r.controller=n),e.track&&e.track.id!==r.track.id&&(gA.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let a=o.shift();a&&(t.data=function(e,t){let r=function(e){let t=e.length,r=[],i=0;for(;i<t;)i+2<t&&0===e[i]&&0===e[i+1]&&(0===e[i+2]||1===e[i+2]||2===e[i+2]||3===e[i+2])?(r.push(e[i],e[i+1],3,e[i+2]),i+=3):(r.push(e[i]),i++);return new Uint8Array(r)}(t),i=r.length,n=Math.floor(i/255),o=new Uint8Array(6+n+1+i+e.byteLength);o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=6,o[5]=101;let a=0;for(;a<n;)o[6+a]=255,a++;return o[6+a]=i%255,a++,o.set(r,6+a),o.set(new Uint8Array(e),6+a+i),o.buffer}(t.data,a)),n.enqueue(t)}});n.readable.pipeThrough(a).pipeTo(n.writable)}else{if(!m0())return;{if("undefined"==typeof RTCRtpScriptTransform)return void gA.warning("browser not support RTCRtpScriptTransform");let n=ba(),o=new MessageChannel;await new dJ(e=>n.onmessage=t=>{"registered"===t.data&&e(void 0)});let a=new RTCRtpScriptTransform(n,{name:"sei-tx",port:o.port2},[o.port2]);e.transform=a,await new dJ(e=>n.onmessage=t=>{"started"===t.data&&e(void 0)}),t.on("sei-to-send",e=>{o.port1.postMessage({sei:e})}),o.port1.onmessage=t=>{var n;t.data.transformed&&e.track&&(null===(n=e.track)||void 0===n?void 0:n.id)!==r.track.id&&(gA.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i))},r.worker=n}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let t=bw.get(e);if(t){bw.delete(e);try{var r,n;null===(r=t.controller)||void 0===r||r.terminate(),null===(n=t.worker)||void 0===n||n.terminate()}catch(e){gA.warning(e&&e.message)}}}bw.set(e,r),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!gR.supportWebRTCEncodedTransform)return void gA.warning("browser not support video encoded transform");if(!e.track)return;if(bO.has(e)){let r=bO.get(e);return void(r&&(r.onSei=t.onSei))}let r={track:e.track,onSei:t.onSei};if(m$()){if(!e.createEncodedStreams)return void gA.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void gA.error("create video-encoded-streams error",e&&e.message)}let n=new TransformStream({transform(t,n){r.controller||(r.controller=n),e.track&&e.track.id!==r.track.id&&(gA.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i));let o=function(e){let t=new DataView(e.data),r=0;for(;r+4<e.data.byteLength;){if(0===t.getUint8(r+0)&&0===t.getUint8(r+1)&&0===t.getUint8(r+2)&&1===t.getUint8(r+3)&&6===t.getUint8(r+4)){let i=r+6,n=0,o=0;for(;255===(o=t.getUint8(i++));)n+=255;n+=o;let a=function(e,t,r){let i=new Uint8Array(e,t,r),n=[],o=0;for(;n.length<r;)o+3<r&&0===i[o]&&0===i[o+1]&&3===i[o+2]&&(0===i[o+3]||1===i[o+3]||2===i[o+3]||3===i[o+3])?(n.push(i[o],i[o+1],i[o+3]),o+=4):(n.push(i[o]),o++);return new Uint8Array(n)}(e.data,i,n);return new Uint8Array(a)}r++}return null}(t);o&&r.onSei&&r.onSei(o),n.enqueue(t)}});t.readable.pipeThrough(n).pipeTo(t.writable)}else if(m0()){if("undefined"==typeof RTCRtpScriptTransform)return void gA.warning("browser not support RTCRtpScriptTransform");let t=ba(),n=new MessageChannel;await new dJ(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});let o=new RTCRtpScriptTransform(t,{name:"sei-rx",port:n.port2},[n.port2]);e.transform=o,await new dJ(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),n.port1.onmessage=t=>{var n;t.data.transformed&&e.track&&(null===(n=e.track)||void 0===n?void 0:n.id)!==r.track.id?(gA.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",i),r.track=e.track,r.track.addEventListener("ended",i)):t.data.sei&&r.onSei&&r.onSei(t.data.sei)},r.worker=t}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}!function(e){let t=bO.get(e);if(t){bO.delete(e);try{var r,i;null===(r=t.controller)||void 0===r||r.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){gA.warning(e&&e.message)}}}(e)}bO.set(e,r),e.track.addEventListener("ended",i)}};EK(),E1("PROCESS_ID","process-".concat(Er(8,""),"-").concat(Er(4,""),"-").concat(Er(4,""),"-").concat(Er(4,""),"-").concat(Er(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void gA.error("Error loading sdk config",e.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();gA.debug("Loading global parameters from cache",t),Object.keys(t).forEach(e=>{if(Object.prototype.hasOwnProperty.call(E2,e)){let{value:i,expires:n}=t[e];(!n||!(n<=r))&&(E3[e]=i,E2[e]=i)}})}catch(t){gA.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(E3.AREAS)&&E3.AREAS.length>0&&Rn(E3.AREAS,!0);let Oq=(e,t,r)=>{gA.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),E1(e,t,r)};yX({name:"ChannelMediaRelay",create:function(e){return new w6(e.joinInfo,e.clientId,e.websocketRetryConfig||E_,e.httpRetryConfig||E_,e.resolution)}},!1),yX({name:"LiveStreaming",create:function(e){return new Oe(e.joinInfo,e.websocketRetryConfig||E_,e.httpRetryConfig||E_)}},!1),yX({name:"ImageModeration",create:function(e){let{config:t}=e;return Cg(t),new CE(t)}},!1),yX({name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new gy(vA.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new gy(vA.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let t=[...new Set(e.inspectType)];t.forEach(e=>{var t;if(!o0(t=["supervise","moderation"]).call(t,e))throw new gy(vA.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new gy(vA.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Ob(t)}},!1),yX({name:"DataStream",create:(e,t)=>{let r=t?new bn(e):new bo(e);return r.useDataStream(new w1),r}},!1),yX({name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new OV(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new OG(r,t)}},!1),yX({name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new Oz(r,t)}},!1),yX({name:"InterceptFrame",create:()=>OJ},!1);let OZ=function(e){let t=new vP,r={getListeners:t.getListeners.bind(t),on:(e,r)=>{var i,n;return i=e,n=r,i===TF.SECURITY_POLICY_VIOLATION&&CO(n,!0),t.on.bind(t)(e,r)},addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return Ck(Ck({},e),r)}({__TRACK_LIST__:gG,VERSION:EQ,BUILD:E$,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Oq,getParameter:E4,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,r=await async function(e){let t;return gR.supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!r)return e;t.close(),t=null,e=function(e){let t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(r)}catch(e){throw new gy(vA.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){let e=gT.reportApiInvoke(null,{name:vM.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:vx.TRACER}),t=!1;try{let e=window.RTCPeerConnection,r=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,i=window.WebSocket;(t=!!(e&&r&&i))&&vd()&&m3(75)&&(new e).close()}catch(e){return gA.error("check system requirement failed: ",e),!1}let r=!1,i=mz();i.name===mH.CHROME&&Number(i.version)>=58&&("WebKit"!==mK.engine.name||function(){let e=mz();if(mZ()){if(e.os===mW.MAC_OS)return!0;if(e.os===mW.IOS){let e=mK.os.version&&mK.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3||e&&Number(e[0])>14)return!0}}return!1}())&&(r=!0),(i.name===mH.FIREFOX&&Number(i.version)>=56||i.name===mH.OPERA&&Number(i.version)>=45||i.name===mH.SAFARI&&Number(i.version)>=11||"WebKit"===i.name&&(m4()||va())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||vs()||mz().name===mH.QQ)&&(r=!0),gA.debug("checkSystemRequirements, api:",t,"browser",r);let n=t&&r;return e.onSuccess(n),n},getDevices:function(e){return Sw.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Sw.getRecordingDevices(e)},getCameras:function(e){return Sw.getCamerasDevices(e)},getElectronScreenSources:SS,getPlaybackDevices:function(e){return Sw.getSpeakers(e)},createClient:function(){var e,t;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},i=Er(5,"client-"),n=gT.reportApiInvoke(null,{id:i,name:vM.CREATE_CLIENT,options:[r],tag:vx.TRACER});try{;t=r,vE(t.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),vE(t.mode,"config.mode",["rtc","live","p2p"]),void 0!==t.audioCodec&&vE(t.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==t.proxyServer&&vb(t.proxyServer,"config.proxyServer",1,1e4),void 0!==t.turnServer&&vj(t.turnServer),void 0!==t.httpRetryConfig&&vU(t.httpRetryConfig),void 0!==t.websocketRetryConfig&&vU(t.websocketRetryConfig)}catch(e){throw n.onError(e),e}return(m7(16,0,!0)||ve(16,0,!0))&&("vp9"===r.codec&&(r.codec="vp8",gA.debug("browser not support vp9, force use vp8")),E1("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===r.audioCodec&&(r.audioCodec="opus"),n.onSuccess(),new CT(Cb(Cb({forceWaitGatewayResponse:!0},r),{},{role:o0(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=E4("CAMERA_CAPTURE_CONFIG"),r=Er(8,"track-cam-"),i=gT.reportApiInvoke(null,{id:r,tag:vx.TRACER,name:vM.CREATE_CAM_VIDEO_TRACK,options:[Sa({},e),t]});t&&(e.encoderConfig=t);let n=SH(e),o=null;gA.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{o=(await SR({video:n},r)).getVideoTracks()[0]||null}catch(e){throw i.onError(e),e}if(!o){let e=new vm(vA.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(e),e.throw(gA)}e.optimizationMode&&S9(r,o,e,gU(e.encoderConfig));let a=new S5(o,e,n,e.scalabiltyMode?gV(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return i.onSuccess(a.getTrackId()),gA.info("create camera video success, trackId:",r),a},createCustomVideoTrack:function(e){let t=Er(8,"track-cus-"),r=gT.reportApiInvoke(null,{id:t,tag:vx.TRACER,name:vM.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),i=new S8(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?gV(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[gY.CUSTOM_TRACK]);return r.onSuccess(i.getTrackId()),gA.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable",r="object"==typeof t?SY(t):void 0;r&&(t="auto");let i=Er(8,"track-scr-v-"),n=gT.reportApiInvoke(null,{id:i,tag:vx.TRACER,name:vM.CREATE_SCREEN_VIDEO_TRACK,options:[Sa({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let o=function(e){let t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&m$()&&(t.extensionId=e.extensionId);let{displaySurface:r,selfBrowserSurface:i,surfaceSwitching:n,systemAudio:o,preferCurrentTab:a}=e;(m6(107)||m5(107)||vt(93))&&(r&&(vE(r,"displaySurface",["browser","window","monitor"]),t.displaySurface=r),i?(vE(i,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=i):t.selfBrowserSurface="include",n&&(vE(n,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=n)),(m6(105)||m5(105)||vt(91))&&o&&(vE(o,"systemAudio",["exclude","include"]),t.systemAudio=o),(m6(94)||m5(94)||vt(80))&&a&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);let s=e.encoderConfig?gB(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:s?s.width:void 0,maxHeight:s?s.height:void 0},s&&(s.frameRate&&("number"==typeof s.frameRate?(t.mandatory.maxFrameRate=s.frameRate,t.mandatory.minFrameRate=s.frameRate):(t.mandatory.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||void 0,t.mandatory.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||void 0),t.frameRate=s.frameRate),s.width&&(t.width=s.width),s.height&&(t.height=s.height)),t}(e),a=null,s=null;if(!gR.supportShareAudio&&"enable"===t){let e=new vm(vA.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(e),e.throw(gA)}gA.info("start create screen video track with config",e,"withAudio",t,"trackId",i);let c=gR.supportShareAudio&&"disable"!==t;try{let e=await SR({screen:o,screenAudio:c?r||!0:void 0},i);a=e.getVideoTracks()[0]||null,s=e.getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!a){let e=new vm(vA.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(gA)}if(!s&&"enable"===t){a&&a.stop();let e=new vm(vA.SHARE_AUDIO_NOT_ALLOWED);return n.onError(e),e.throw(gA)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(S9(i,a,e,e.encoderConfig&&gB(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let d=new S8(a,e.encoderConfig?gB(e.encoderConfig):{},e.scalabiltyMode?gV(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[gY.SCREEN_TRACK]);if(!s)return n.onSuccess(d.getTrackId()),gA.info("create screen video track success","video:",d.getTrackId()),d;let u=new Sq(s,void 0,Er(8,"track-scr-a-"),!1);return n.onSuccess([d.getTrackId(),u.getTrackId()]),gA.info("create screen video track success","video:",d.getTrackId(),"audio:",u.getTrackId()),[d,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=E4("CAMERA_CAPTURE_CONFIG"),i=Er(8,"track-mic-"),n=Er(8,"track-cam-"),o=gT.reportApiInvoke(null,{id:"".concat(i,"-").concat(n),tag:vx.TRACER,name:vM.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);let a=SH(t),s=SK(e),c=null,d=null;gA.info("start create camera video track(".concat(n,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let e=await SR({audio:s,video:a},"".concat(i,"-").concat(n));c=e.getAudioTracks()[0],d=e.getVideoTracks()[0]}catch(e){throw o.onError(e),e}if(!c||!d){let e=new vm(vA.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(e),e.throw(gA)}t.optimizationMode&&S9(n,d,t,gU(t.encoderConfig));let u=new SZ(c,e,s,i),l=new S5(d,t,a,t.scalabiltyMode?gV(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return o.onSuccess([u.getTrackId(),l.getTrackId()]),gA.info("create camera video track(".concat(n,") and microphone audio track(").concat(i,") success")),[u,l]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Er(8,"track-mic-"),r=gT.reportApiInvoke(null,{id:t,tag:vx.TRACER,name:vM.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=SK(e),n=null;gA.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{n=(await SR({audio:i},t)).getAudioTracks()[0]||null}catch(e){throw r.onError(e),e}if(!n){let e=new vm(vA.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(e),e.throw(gA)}let o=new SZ(n,e,i,t);return r.onSuccess(o.getTrackId()),gA.info("create microphone audio track success, trackId:",t),o},createCustomAudioTrack:function(e){let t=Er(8,"track-cus-"),r=gT.reportApiInvoke(null,{id:t,tag:vx.TRACER,name:vM.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Sq(e.mediaStreamTrack,e.encoderConfig?gj(e.encoderConfig):{},t,!1);return gA.info("create custom audio track success with config",e,"trackId",i.getTrackId()),r.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:r,encoderConfig:i}=e,{source:n}=e,o={source:n instanceof AudioBuffer?"AudioBuffer":n instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":n,cacheOnlineFile:r,encoderConfig:i},a=Er(8,"track-buf-"),s=gT.reportApiInvoke(null,{id:a,tag:vx.TRACER,name:vM.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(E4("DISABLE_WEBAUDIO"))throw new vm(vA.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");gA.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",a);let c=n;if(!(n instanceof AudioBuffer))try{n=await async function(e,t){let r=null;if("string"==typeof e){let t=S1.get(e);if(t)return gA.debug("use cached audio resource: ",e),t;try{r=(await Em(()=>mU.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new vm(vA.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{let t=new dJ((t,r)=>{let i=new FileReader;i.onload=e=>{e.target?t(e.target.result):r(new vm(vA.READ_LOCAL_AUDIO_FILE_ERROR))},i.onerror=()=>{r(new vm(vA.READ_LOCAL_AUDIO_FILE_ERROR))},i.readAsArrayBuffer(e)});r=await t}let i=await function(e){let t=Sh();return new dJ((r,i)=>{t.decodeAudioData(e,e=>{r(e)},e=>{i(new vm(vA.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}(r);return"string"==typeof e&&t&&S1.set(e,i),i}(n,r)}catch(e){return s.onError(e),e.throw(gA)}let d=new S$(c,new S2(n),i?gj(i):{},a);return gA.info("create buffer source audio track success, trackId:",a),s.onSuccess(d.getTrackId()),d},setAppType:function(e){if(gA.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw gA.debug("Invalid appType"),new gy(vA.INVALID_PARAMS,"invalid app type",e);E1("APP_TYPE",Math.floor(e))},setLogLevel:function(e){gA.setLogLevel(e)},enableLogUpload:function(){E4("USE_NEW_LOG")?E1("UPLOAD_LOG",!0):gA.enableLogUpload()},disableLogUpload:function(){E4("USE_NEW_LOG")?E1("UPLOAD_LOG",!1):gA.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new RB},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=gT.reportApiInvoke(null,{tag:vx.TRACER,name:vM.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Sq||e instanceof bt)){let e=new gy(vA.INVALID_TRACK,"the parameter is not a audio track");return r.onError(e),e.throw()}t&&t<1e3&&(t=1e3);let i=e instanceof Sq?e.getTrackLabel():"remote_track",n=e.getVolumeLevel(),o=n,a=n,s=Date.now();return new dJ(n=>{let c=setInterval(()=>{let d=e.getVolumeLevel();o=d>o?d:o;let u=o-(a=d<a?d:a)>1e-4,l=Date.now()-s;if(u||l>t){clearInterval(c);let t={duration:l,deviceLabel:i,maxVolumeLevel:o,result:u};gA.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(t))),r.onSuccess(t),n(u)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=gT.reportApiInvoke(null,{tag:vx.TRACER,name:vM.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof S8||e instanceof be)){let e=new gy(vA.INVALID_TRACK,"the parameter is not a video track");return r.onError(e),e.throw()}t&&t<1e3&&(t=1e3);let i=e instanceof S8?e.getTrackLabel():"remote_track",n=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(m0()||mZ())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([n]),o.play();let a=document.createElement("canvas");a.width=160,a.height=120;let s=0,c=0;try{var d,u,l;let e,r,i,n=Date.now();s=await (d=o,u=t,l=a,r=0,i=null,new dJ((t,n)=>{setTimeout(()=>{e&&(e(),t(r))},u),e=S_(()=>{(function(){r>4&&e&&(e(),t(r));let o=l.getContext("2d");if(!o){let e=new gy(vA.UNEXPECTED_ERROR,"can not get canvas 2d context.");return gA.error(e.toString()),void n(e)}o.drawImage(d,0,0,160,120);let a=o.getImageData(0,0,l.width,l.height),s=Math.floor(a.data.length/3);if(i){for(let e=0;e<s;e+=3)if(a.data[e]!==i[e])return r+=1,void(i=a.data);i=a.data}else i=a.data})()},30)})),c=Date.now()-n}catch(e){throw r.onError(e),e}IM===mH.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;let h=s>4,p={duration:c,changedPicNum:s,deviceLabel:i,result:h};return gA.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),r.onSuccess(p),h},setArea:Rn,audioElementPlayCenter:SM,resumeAudioContext:function(){SM.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){CI.processExternalMediaAEC(e)},registerExtensions:function(e){let t=E4("PLUGIN_INFO")||[];e.forEach(e=>{"name"in e&&!o0(t).call(t,e.name)&&t.push(e.name);e.__registered__=!0,e.logger.hookLog=gA.extLog,e.reporter.hookApiInvoke=gT.extApiInvoke,e.parameters&&Object.keys(e.parameters).forEach(t=>{e.parameters[t]=E4(t)})}),Oq("PLUGIN_INFO",t)},ChannelMediaRelayError:TA,ChannelMediaRelayEvent:Tf,ChannelMediaRelayState:T_,RemoteStreamFallbackType:gz,RemoteStreamType:gQ,ConnectionDisconnectedReason:vV,AudienceLatencyLevelType:vB,AREAS:TS,preload:async function(e,t,r,i){return Iz(e,t,r,i)}});return Object.defineProperties(OZ,{onAudioAutoplayFailed:{get:()=>SN.onAudioAutoplayFailed,set:e=>{SN.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>SN.onAutoplayFailed,set:e=>{SN.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>OZ._onSecurityPolicyViolation,set(e){OZ._onSecurityPolicyViolation=e,CO(e)}},__CLIENT_LIST__:{get:()=>E4("SHOW_GLOBAL_CLIENT_LIST")?bD:[]}}),Sw.on(g9.CAMERA_DEVICE_CHANGED,e=>{gA.info("camera device changed",JSON.stringify(e)),OZ.onCameraChanged&&OZ.onCameraChanged(e),OZ.safeEmit(TF.CAMERA_CHANGED,e)}),Sw.on(g9.RECORDING_DEVICE_CHANGED,e=>{gA.info("microphone device changed",JSON.stringify(e)),OZ.onMicrophoneChanged&&OZ.onMicrophoneChanged(e),OZ.safeEmit(TF.MICROPHONE_CHANGED,e)}),Sw.on(g9.PLAYOUT_DEVICE_CHANGED,e=>{gA.debug("playout device changed",JSON.stringify(e)),OZ.onPlaybackDeviceChanged&&OZ.onPlaybackDeviceChanged(e),OZ.safeEmit(TF.PLAYBACK_DEVICE_CHANGED,e)}),SM.onAutoplayFailed=()=>{gA.info("detect audio element autoplay failed"),SN.onAudioAutoplayFailed&&SN.onAudioAutoplayFailed()},Sl.on("autoplay-failed",()=>{gA.info("detect webaudio autoplay failed"),SN.onAudioAutoplayFailed&&SN.onAudioAutoplayFailed(),OZ.safeEmit(TF.AUTOPLAY_FAILED)}),Sl.on(gw.STATE_CHANGE,(e,t)=>{gA.info("audio context state changed: ".concat(t," => ").concat(e)),OZ.onAudioContextStateChanged&&OZ.onAudioContextStateChanged(e,t),OZ.safeEmit(TF.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),vq.on(vK.NETWORK_STATE_CHANGE,(e,t)=>{gA.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=OZ),OZ},e.exports=n()},21556:function(e){var t,r;t=self,r=()=>(()=>{var e={6226:(e,t,r)=>{e.exports=r(2948)},4437:(e,t,r)=>{"use strict";var i=r(5602);e.exports=i},204:(e,t,r)=>{"use strict";var i=r(4454);r(3705),r(1935),r(1944),r(5539),e.exports=i},5003:(e,t,r)=>{"use strict";var i=r(4690);e.exports=i},5887:(e,t,r)=>{"use strict";var i=r(7263);e.exports=i},8641:(e,t,r)=>{"use strict";r(9727);var i=r(9068).Object,n=e.exports=function(e,t,r){return i.defineProperty(e,t,r)};i.defineProperty.sham&&(n.sham=!0)},8462:(e,t,r)=>{"use strict";r(6864),r(1997),r(6069),r(9927),r(8795),r(3233),r(8840),r(6028),r(1345);var i=r(9068);e.exports=i.Promise},3941:(e,t,r)=>{"use strict";r(1845),r(6069),r(1967),r(342),r(8861),r(3092),r(6538),r(459),r(2303),r(3236),r(1654),r(4833),r(316),r(6925),r(3135),r(9390),r(5938),r(8518),r(9786),r(6716);var i=r(9068);e.exports=i.Symbol},4101:(e,t,r)=>{"use strict";r(1997),r(6069),r(1345),r(459);var i=r(8248);e.exports=i.f("iterator")},7548:(e,t,r)=>{"use strict";r(8242),r(3135);var i=r(8248);e.exports=i.f("toPrimitive")},1685:(e,t,r)=>{"use strict";var i=r(4437);e.exports=i},1768:(e,t,r)=>{"use strict";var i=r(204);r(3361),r(1823),r(4163),r(6499),r(6714),r(5704),r(6206),r(1548),r(1666),e.exports=i},6228:(e,t,r)=>{"use strict";var i=r(5003);e.exports=i},4360:(e,t,r)=>{"use strict";var i=r(5887);e.exports=i},5935:(e,t,r)=>{"use strict";var i=r(9934),n=r(1028),o=TypeError;e.exports=function(e){if(i(e))return e;throw new o(n(e)+" is not a function")}},3164:(e,t,r)=>{"use strict";var i=r(7936),n=r(1028),o=TypeError;e.exports=function(e){if(i(e))return e;throw new o(n(e)+" is not a constructor")}},7844:(e,t,r)=>{"use strict";var i=r(9934),n=String,o=TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw new o("Can't set "+n(e)+" as a prototype")}},6888:e=>{"use strict";e.exports=function(){}},927:(e,t,r)=>{"use strict";var i=r(1727),n=TypeError;e.exports=function(e,t){if(i(t,e))return e;throw new n("Incorrect invocation")}},8879:(e,t,r)=>{"use strict";var i=r(9611),n=String,o=TypeError;e.exports=function(e){if(i(e))return e;throw new o(n(e)+" is not an object")}},8520:(e,t,r)=>{"use strict";var i=r(3747),n=r(8100),o=r(7165),a=function(e){return function(t,r,a){var s,c=i(t),d=o(c),u=n(a,d);if(e&&r!=r){for(;d>u;)if((s=c[u++])!=s)return!0}else for(;d>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},2503:(e,t,r)=>{"use strict";var i=r(9605),n=r(2537),o=r(108),a=r(2962),s=r(7165),c=r(7265),d=n([].push),u=function(e){var t=1===e,r=2===e,n=3===e,u=4===e,l=6===e,h=7===e,p=5===e||l;return function(f,_,A,m){for(var v,E,g=a(f),S=o(g),b=s(S),T=i(_,A),y=0,R=m||c,I=t?R(f,b):r||h?R(f,0):void 0;b>y;y++)if((p||y in S)&&(E=T(v=S[y],y,g),e)){if(t)I[y]=E;else if(E)switch(e){case 3:return!0;case 5:return v;case 6:return y;case 2:d(I,v)}else switch(e){case 4:return!1;case 7:d(I,v)}}return l?-1:n||u?u:I}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterReject:u(7)}},8388:(e,t,r)=>{"use strict";var i=r(9353),n=r(2442),o=r(5131),a=n("species");e.exports=function(e){return o>=51||!i(function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo})}},4030:(e,t,r)=>{"use strict";var i=r(8100),n=r(7165),o=r(981),a=Array,s=Math.max;e.exports=function(e,t,r){for(var c=n(e),d=i(t,c),u=i(void 0===r?c:r,c),l=a(s(u-d,0)),h=0;d<u;d++,h++)o(l,h,e[d]);return l.length=h,l}},2076:(e,t,r)=>{"use strict";var i=r(2537);e.exports=i([].slice)},1388:(e,t,r)=>{"use strict";var i=r(3527),n=r(7936),o=r(9611),a=r(2442)("species"),s=Array;e.exports=function(e){var t;return i(e)&&(n(t=e.constructor)&&(t===s||i(t.prototype))||o(t)&&null===(t=t[a]))&&(t=void 0),void 0===t?s:t}},7265:(e,t,r)=>{"use strict";var i=r(1388);e.exports=function(e,t){return new(i(e))(0===t?0:t)}},7670:(e,t,r)=>{"use strict";var i=r(2442)("iterator"),n=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){n=!0}};a[i]=function(){return this},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){try{if(!t&&!n)return!1}catch(e){return!1}var r=!1;try{var o={};o[i]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},4650:(e,t,r)=>{"use strict";var i=r(2537),n=i({}.toString),o=i("".slice);e.exports=function(e){return o(n(e),8,-1)}},6397:(e,t,r)=>{"use strict";var i=r(3220),n=r(9934),o=r(4650),a=r(2442)("toStringTag"),s=Object,c="Arguments"===o(function(){return arguments}());e.exports=i?o:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?r:c?o(t):"Object"===(i=o(t))&&n(t.callee)?"Arguments":i}},5895:(e,t,r)=>{"use strict";var i=r(9027),n=r(704),o=r(5396),a=r(1890);e.exports=function(e,t,r){for(var s=n(t),c=a.f,d=o.f,u=0;u<s.length;u++){var l=s[u];i(e,l)||r&&i(r,l)||c(e,l,d(t,l))}}},4853:(e,t,r)=>{"use strict";var i=r(9353);e.exports=!i(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},7474:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},7151:(e,t,r)=>{"use strict";var i=r(3794),n=r(1890),o=r(1567);e.exports=i?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},1567:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},981:(e,t,r)=>{"use strict";var i=r(1525),n=r(1890),o=r(1567);e.exports=function(e,t,r){var a=i(t);a in e?n.f(e,a,o(0,r)):e[a]=r}},3089:(e,t,r)=>{"use strict";var i=r(1890);e.exports=function(e,t,r){return i.f(e,t,r)}},1733:(e,t,r)=>{"use strict";var i=r(7151);e.exports=function(e,t,r,n){return n&&n.enumerable?e[t]=r:i(e,t,r),e}},543:(e,t,r)=>{"use strict";var i=r(5685),n=Object.defineProperty;e.exports=function(e,t){try{n(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}},3794:(e,t,r)=>{"use strict";var i=r(9353);e.exports=!i(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},9945:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports={all:t,IS_HTMLDDA:void 0===t&&void 0!==t}},3729:(e,t,r)=>{"use strict";var i=r(5685),n=r(9611),o=i.document,a=n(o)&&n(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},9939:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>0x1fffffffffffff)throw t("Maximum allowed index exceeded");return e}},8920:e=>{"use strict";e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},3:(e,t,r)=>{"use strict";var i=r(9207),n=r(4408);e.exports=!i&&!n&&"object"==typeof window&&"object"==typeof document},9207:e=>{"use strict";e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},8309:(e,t,r)=>{"use strict";var i=r(3642);e.exports=/ipad|iphone|ipod/i.test(i)&&"undefined"!=typeof Pebble},8816:(e,t,r)=>{"use strict";var i=r(3642);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)},4408:(e,t,r)=>{"use strict";var i=r(5685),n=r(4650);e.exports="process"===n(i.process)},9267:(e,t,r)=>{"use strict";var i=r(3642);e.exports=/web0s(?!.*chrome)/i.test(i)},3642:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},5131:(e,t,r)=>{"use strict";var i,n,o=r(5685),a=r(3642),s=o.process,c=o.Deno,d=s&&s.versions||c&&c.version,u=d&&d.v8;u&&(n=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!n&&a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(n=+i[1]),e.exports=n},270:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},7918:(e,t,r)=>{"use strict";var i=r(2537),n=Error,o=i("".replace),a=String(new n("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,c=s.test(a);e.exports=function(e,t){if(c&&"string"==typeof e&&!n.prepareStackTrace)for(;t--;)e=o(e,s,"");return e}},1794:(e,t,r)=>{"use strict";var i=r(7151),n=r(7918),o=r(4671),a=Error.captureStackTrace;e.exports=function(e,t,r,s){o&&(a?a(e,t):i(e,"stack",n(r,s)))}},4671:(e,t,r)=>{"use strict";var i=r(9353),n=r(1567);e.exports=!i(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",n(1,7)),7!==e.stack)})},4715:(e,t,r)=>{"use strict";var i=r(5685),n=r(145),o=r(7531),a=r(9934),s=r(5396).f,c=r(5703),d=r(9068),u=r(9605),l=r(7151),h=r(9027),p=function(e){var t=function(r,i,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,o)}return n(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,n,f,_,A,m,v,E,g,S=e.target,b=e.global,T=e.stat,y=e.proto,R=b?i:T?i[S]:(i[S]||{}).prototype,I=b?d:d[S]||l(d,S,{})[S],C=I.prototype;for(_ in t)n=!(r=c(b?_:S+(T?".":"#")+_,e.forced))&&R&&h(R,_),m=I[_],n&&(v=e.dontCallGetSet?(g=s(R,_))&&g.value:R[_]),A=n&&v?v:t[_],n&&typeof m==typeof A||(E=e.bind&&n?u(A,i):e.wrap&&n?p(A):y&&a(A)?o(A):A,(e.sham||A&&A.sham||m&&m.sham)&&l(E,"sham",!0),l(I,_,E),y&&(h(d,f=S+"Prototype")||l(d,f,{}),l(d[f],_,A),e.real&&C&&(r||!C[_])&&l(C,_,A)))}},9353:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},145:(e,t,r)=>{"use strict";var i=r(6229),n=Function.prototype,o=n.apply,a=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(o):function(){return a.apply(o,arguments)})},9605:(e,t,r)=>{"use strict";var i=r(7531),n=r(5935),o=r(6229),a=i(i.bind);e.exports=function(e,t){return n(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},6229:(e,t,r)=>{"use strict";var i=r(9353);e.exports=!i(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},3417:(e,t,r)=>{"use strict";var i=r(6229),n=Function.prototype.call;e.exports=i?n.bind(n):function(){return n.apply(n,arguments)}},8766:(e,t,r)=>{"use strict";var i=r(3794),n=r(9027),o=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,s=n(o,"name"),c=s&&(!i||i&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:s&&"something"===(function(){}).name,CONFIGURABLE:c}},7665:(e,t,r)=>{"use strict";var i=r(2537),n=r(5935);e.exports=function(e,t,r){try{return i(n(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},7531:(e,t,r)=>{"use strict";var i=r(4650),n=r(2537);e.exports=function(e){if("Function"===i(e))return n(e)}},2537:(e,t,r)=>{"use strict";var i=r(6229),n=Function.prototype,o=n.call,a=i&&n.bind.bind(o,o);e.exports=i?a:function(e){return function(){return o.apply(e,arguments)}}},7192:(e,t,r)=>{"use strict";var i=r(9068),n=r(5685),o=r(9934),a=function(e){return o(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?a(i[e])||a(n[e]):i[e]&&i[e][t]||n[e]&&n[e][t]}},610:(e,t,r)=>{"use strict";var i=r(6397),n=r(5752),o=r(4133),a=r(9234),s=r(2442)("iterator");e.exports=function(e){if(!o(e))return n(e,s)||n(e,"@@iterator")||a[i(e)]}},3029:(e,t,r)=>{"use strict";var i=r(3417),n=r(5935),o=r(8879),a=r(1028),s=r(610),c=TypeError;e.exports=function(e,t){var r=arguments.length<2?s(e):t;if(n(r))return o(i(r,e));throw new c(a(e)+" is not iterable")}},9647:(e,t,r)=>{"use strict";var i=r(2537),n=r(3527),o=r(9934),a=r(4650),s=r(1182),c=i([].push);e.exports=function(e){if(o(e))return e;if(n(e)){for(var t=e.length,r=[],i=0;i<t;i++){var d=e[i];"string"==typeof d?c(r,d):"number"!=typeof d&&"Number"!==a(d)&&"String"!==a(d)||c(r,s(d))}var u=r.length,l=!0;return function(e,t){if(l)return l=!1,t;if(n(this))return t;for(var i=0;i<u;i++)if(r[i]===e)return t}}}},5752:(e,t,r)=>{"use strict";var i=r(5935),n=r(4133);e.exports=function(e,t){var r=e[t];return n(r)?void 0:i(r)}},5685:function(e,t,r){"use strict";var i=function(e){return e&&e.Math===Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof r.g&&r.g)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9027:(e,t,r)=>{"use strict";var i=r(2537),n=r(2962),o=i({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(n(e),t)}},9775:e=>{"use strict";e.exports={}},2210:e=>{"use strict";e.exports=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}}},6395:(e,t,r)=>{"use strict";var i=r(7192);e.exports=i("document","documentElement")},9548:(e,t,r)=>{"use strict";var i=r(3794),n=r(9353),o=r(3729);e.exports=!i&&!n(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},108:(e,t,r)=>{"use strict";var i=r(2537),n=r(9353),o=r(4650),a=Object,s=i("".split);e.exports=n(function(){return!a("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?s(e,""):a(e)}:a},3698:(e,t,r)=>{"use strict";var i=r(2537),n=r(9934),o=r(5509),a=i(Function.toString);n(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},2071:(e,t,r)=>{"use strict";var i=r(9611),n=r(7151);e.exports=function(e,t){i(t)&&"cause"in t&&n(e,"cause",t.cause)}},4084:(e,t,r)=>{"use strict";var i,n,o,a=r(9033),s=r(5685),c=r(9611),d=r(7151),u=r(9027),l=r(5509),h=r(3287),p=r(9775),f="Object already initialized",_=s.TypeError,A=s.WeakMap;if(a||l.state){var m=l.state||(l.state=new A);m.get=m.get,m.has=m.has,m.set=m.set,i=function(e,t){if(m.has(e))throw new _(f);return t.facade=e,m.set(e,t),t},n=function(e){return m.get(e)||{}},o=function(e){return m.has(e)}}else{var v=h("state");p[v]=!0,i=function(e,t){if(u(e,v))throw new _(f);return t.facade=e,d(e,v,t),t},n=function(e){return u(e,v)?e[v]:{}},o=function(e){return u(e,v)}}e.exports={set:i,get:n,has:o,enforce:function(e){return o(e)?n(e):i(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=n(t)).type!==e)throw new _("Incompatible receiver, "+e+" required");return r}}}},9273:(e,t,r)=>{"use strict";var i=r(2442),n=r(9234),o=i("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[o]===e)}},3527:(e,t,r)=>{"use strict";var i=r(4650);e.exports=Array.isArray||function(e){return"Array"===i(e)}},9934:(e,t,r)=>{"use strict";var i=r(9945),n=i.all;e.exports=i.IS_HTMLDDA?function(e){return"function"==typeof e||e===n}:function(e){return"function"==typeof e}},7936:(e,t,r)=>{"use strict";var i=r(2537),n=r(9353),o=r(9934),a=r(6397),s=r(7192),c=r(3698),d=function(){},u=[],l=s("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=i(h.exec),f=!h.test(d),_=function(e){if(!o(e))return!1;try{return l(d,u,e),!0}catch(e){return!1}},A=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(h,c(e))}catch(e){return!0}};A.sham=!0,e.exports=!l||n(function(){var e;return _(_.call)||!_(Object)||!_(function(){e=!0})||e})?A:_},5703:(e,t,r)=>{"use strict";var i=r(9353),n=r(9934),o=/#|\.prototype\./,a=function(e,t){var r=c[s(e)];return r===u||r!==d&&(n(t)?i(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=a.data={},d=a.NATIVE="N",u=a.POLYFILL="P";e.exports=a},4133:e=>{"use strict";e.exports=function(e){return null==e}},9611:(e,t,r)=>{"use strict";var i=r(9934),n=r(9945),o=n.all;e.exports=n.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:i(e)||e===o}:function(e){return"object"==typeof e?null!==e:i(e)}},4081:e=>{"use strict";e.exports=!0},205:(e,t,r)=>{"use strict";var i=r(7192),n=r(9934),o=r(1727),a=r(16),s=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return n(t)&&o(t.prototype,s(e))}},9614:(e,t,r)=>{"use strict";var i=r(9605),n=r(3417),o=r(8879),a=r(1028),s=r(9273),c=r(7165),d=r(1727),u=r(3029),l=r(610),h=r(273),p=TypeError,f=function(e,t){this.stopped=e,this.result=t},_=f.prototype;e.exports=function(e,t,r){var A,m,v,E,g,S,b,T=r&&r.that,y=!(!r||!r.AS_ENTRIES),R=!(!r||!r.IS_RECORD),I=!(!r||!r.IS_ITERATOR),C=!(!r||!r.INTERRUPTED),k=i(t,T),w=function(e){return A&&h(A,"normal",e),new f(!0,e)},O=function(e){return y?(o(e),C?k(e[0],e[1],w):k(e[0],e[1])):C?k(e,w):k(e)};if(R)A=e.iterator;else if(I)A=e;else{if(!(m=l(e)))throw new p(a(e)+" is not iterable");if(s(m)){for(v=0,E=c(e);E>v;v++)if((g=O(e[v]))&&d(_,g))return g;return new f(!1)}A=u(e,m)}for(S=R?e.next:A.next;!(b=n(S,A)).done;){try{g=O(b.value)}catch(e){h(A,"throw",e)}if("object"==typeof g&&g&&d(_,g))return g}return new f(!1)}},273:(e,t,r)=>{"use strict";var i=r(3417),n=r(8879),o=r(5752);e.exports=function(e,t,r){var a,s;n(e);try{if(!(a=o(e,"return"))){if("throw"===t)throw r;return r}a=i(a,e)}catch(e){s=!0,a=e}if("throw"===t)throw r;if(s)throw a;return n(a),r}},4406:(e,t,r)=>{"use strict";var i=r(8176).IteratorPrototype,n=r(3010),o=r(1567),a=r(4196),s=r(9234),c=function(){return this};e.exports=function(e,t,r,d){var u=t+" Iterator";return e.prototype=n(i,{next:o(+!d,r)}),a(e,u,!1,!0),s[u]=c,e}},6483:(e,t,r)=>{"use strict";var i=r(4715),n=r(3417),o=r(4081),a=r(8766),s=r(9934),c=r(4406),d=r(3863),u=r(1350),l=r(4196),h=r(7151),p=r(1733),f=r(2442),_=r(9234),A=r(8176),m=a.PROPER,v=a.CONFIGURABLE,E=A.IteratorPrototype,g=A.BUGGY_SAFARI_ITERATORS,S=f("iterator"),b="keys",T="values",y="entries",R=function(){return this};e.exports=function(e,t,r,a,f,A,I){c(r,t,a);var C,k,w,O=function(e){if(e===f&&M)return M;if(!g&&e&&e in D)return D[e];switch(e){case b:case T:case y:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",P=!1,D=e.prototype,L=D[S]||D["@@iterator"]||f&&D[f],M=!g&&L||O(f),x="Array"===t&&D.entries||L;if(x&&(C=d(x.call(new e)))!==Object.prototype&&C.next&&(o||d(C)===E||(u?u(C,E):s(C[S])||p(C,S,R)),l(C,N,!0,!0),o&&(_[N]=R)),m&&f===T&&L&&L.name!==T&&(!o&&v?h(D,"name",T):(P=!0,M=function(){return n(L,this)})),f){if(k={values:O(T),keys:A?M:O(b),entries:O(y)},I)for(w in k)!g&&!P&&w in D||p(D,w,k[w]);else i({target:t,proto:!0,forced:g||P},k)}return o&&!I||D[S]===M||p(D,S,M,{name:f}),_[t]=M,k}},8176:(e,t,r)=>{"use strict";var i,n,o,a=r(9353),s=r(9934),c=r(9611),d=r(3010),u=r(3863),l=r(1733),h=r(2442),p=r(4081),f=h("iterator"),_=!1;[].keys&&("next"in(o=[].keys())?(n=u(u(o)))!==Object.prototype&&(i=n):_=!0),!c(i)||a(function(){var e={};return i[f].call(e)!==e})?i={}:p&&(i=d(i)),s(i[f])||l(i,f,function(){return this}),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:_}},9234:e=>{"use strict";e.exports={}},7165:(e,t,r)=>{"use strict";var i=r(1904);e.exports=function(e){return i(e.length)}},8836:e=>{"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var i=+e;return(i>0?r:t)(i)}},5996:(e,t,r)=>{"use strict";var i,n,o,a,s,c=r(5685),d=r(9605),u=r(5396).f,l=r(6727).set,h=r(5721),p=r(8816),f=r(8309),_=r(9267),A=r(4408),m=c.MutationObserver||c.WebKitMutationObserver,v=c.document,E=c.process,g=c.Promise,S=u(c,"queueMicrotask"),b=S&&S.value;if(!b){var T=new h,y=function(){var e,t;for(A&&(e=E.domain)&&e.exit();t=T.get();)try{t()}catch(e){throw T.head&&i(),e}e&&e.enter()};p||A||_||!m||!v?!f&&g&&g.resolve?((a=g.resolve(void 0)).constructor=g,s=d(a.then,a),i=function(){s(y)}):A?i=function(){E.nextTick(y)}:(l=d(l,c),i=function(){l(y)}):(n=!0,o=v.createTextNode(""),new m(y).observe(o,{characterData:!0}),i=function(){o.data=n=!n}),b=function(e){T.head||i(),T.add(e)}}e.exports=b},2157:(e,t,r)=>{"use strict";var i=r(5935),n=TypeError,o=function(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw new n("Bad Promise constructor");t=e,r=i}),this.resolve=i(t),this.reject=i(r)};e.exports.f=function(e){return new o(e)}},81:(e,t,r)=>{"use strict";var i=r(1182);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:i(e)}},3010:(e,t,r)=>{"use strict";var i,n=r(8879),o=r(7832),a=r(270),s=r(9775),c=r(6395),d=r(3729),u=r(3287),l="prototype",h="script",p=u("IE_PROTO"),f=function(){},_=function(e){return"<"+h+">"+e+"</"+h+">"},A=function(e){e.write(_("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}m="undefined"!=typeof document?document.domain&&i?A(i):(t=d("iframe"),r="java"+h+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(_("document.F=Object")),e.close(),e.F):A(i);for(var e,t,r,n=a.length;n--;)delete m[l][a[n]];return m()};s[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(f[l]=n(e),r=new f,f[l]=null,r[p]=e):r=m(),void 0===t?r:o.f(r,t)}},7832:(e,t,r)=>{"use strict";var i=r(3794),n=r(7956),o=r(1890),a=r(8879),s=r(3747),c=r(7508);t.f=i&&!n?Object.defineProperties:function(e,t){a(e);for(var r,i=s(t),n=c(t),d=n.length,u=0;d>u;)o.f(e,r=n[u++],i[r]);return e}},1890:(e,t,r)=>{"use strict";var i=r(3794),n=r(9548),o=r(7956),a=r(8879),s=r(1525),c=TypeError,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor,l="enumerable",h="configurable",p="writable";t.f=i?o?function(e,t,r){if(a(e),t=s(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&p in r&&!r[p]){var i=u(e,t);i&&i[p]&&(e[t]=r.value,r={configurable:h in r?r[h]:i[h],enumerable:l in r?r[l]:i[l],writable:!1})}return d(e,t,r)}:d:function(e,t,r){if(a(e),t=s(t),a(r),n)try{return d(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},5396:(e,t,r)=>{"use strict";var i=r(3794),n=r(3417),o=r(9106),a=r(1567),s=r(3747),c=r(1525),d=r(9027),u=r(9548),l=Object.getOwnPropertyDescriptor;t.f=i?l:function(e,t){if(e=s(e),t=c(t),u)try{return l(e,t)}catch(e){}if(d(e,t))return a(!n(o.f,e,t),e[t])}},7195:(e,t,r)=>{"use strict";var i=r(4650),n=r(3747),o=r(4582).f,a=r(4030),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"Window"===i(e)?function(e){try{return o(e)}catch(e){return a(s)}}(e):o(n(e))}},4582:(e,t,r)=>{"use strict";var i=r(97),n=r(270).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,n)}},6953:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},3863:(e,t,r)=>{"use strict";var i=r(9027),n=r(9934),o=r(2962),a=r(3287),s=r(4853),c=a("IE_PROTO"),d=Object,u=d.prototype;e.exports=s?d.getPrototypeOf:function(e){var t=o(e);if(i(t,c))return t[c];var r=t.constructor;return n(r)&&t instanceof r?r.prototype:t instanceof d?u:null}},1727:(e,t,r)=>{"use strict";var i=r(2537);e.exports=i({}.isPrototypeOf)},97:(e,t,r)=>{"use strict";var i=r(2537),n=r(9027),o=r(3747),a=r(8520).indexOf,s=r(9775),c=i([].push);e.exports=function(e,t){var r,i=o(e),d=0,u=[];for(r in i)!n(s,r)&&n(i,r)&&c(u,r);for(;t.length>d;)n(i,r=t[d++])&&(~a(u,r)||c(u,r));return u}},7508:(e,t,r)=>{"use strict";var i=r(97),n=r(270);e.exports=Object.keys||function(e){return i(e,n)}},9106:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,n=i&&!r.call({1:2},1);t.f=n?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},1350:(e,t,r)=>{"use strict";var i=r(7665),n=r(8879),o=r(7844);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=i(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return n(r),o(i),t?e(r,i):r.__proto__=i,r}}():void 0)},8516:(e,t,r)=>{"use strict";var i=r(3220),n=r(6397);e.exports=i?({}).toString:function(){return"[object "+n(this)+"]"}},8733:(e,t,r)=>{"use strict";var i=r(3417),n=r(9934),o=r(9611),a=TypeError;e.exports=function(e,t){var r,s;if("string"===t&&n(r=e.toString)&&!o(s=i(r,e))||n(r=e.valueOf)&&!o(s=i(r,e))||"string"!==t&&n(r=e.toString)&&!o(s=i(r,e)))return s;throw new a("Can't convert object to primitive value")}},704:(e,t,r)=>{"use strict";var i=r(7192),n=r(2537),o=r(4582),a=r(6953),s=r(8879),c=n([].concat);e.exports=i("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?c(t,r(e)):t}},9068:e=>{"use strict";e.exports={}},3183:e=>{"use strict";e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},4865:(e,t,r)=>{"use strict";var i=r(5685),n=r(3159),o=r(9934),a=r(5703),s=r(3698),c=r(2442),d=r(3),u=r(9207),l=r(4081),h=r(5131),p=n&&n.prototype,f=c("species"),_=!1,A=o(i.PromiseRejectionEvent),m=a("Promise",function(){var e=s(n),t=e!==String(n);if(!t&&66===h||l&&(!p.catch||!p.finally))return!0;if(!h||h<51||!/native code/.test(e)){var r=new n(function(e){e(1)}),i=function(e){e(function(){},function(){})};if((r.constructor={})[f]=i,!(_=r.then(function(){})instanceof i))return!0}return!t&&(d||u)&&!A});e.exports={CONSTRUCTOR:m,REJECTION_EVENT:A,SUBCLASSING:_}},3159:(e,t,r)=>{"use strict";var i=r(5685);e.exports=i.Promise},5712:(e,t,r)=>{"use strict";var i=r(8879),n=r(9611),o=r(2157);e.exports=function(e,t){if(i(e),n(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},7290:(e,t,r)=>{"use strict";var i=r(3159),n=r(7670),o=r(4865).CONSTRUCTOR;e.exports=o||!n(function(e){i.all(e).then(void 0,function(){})})},5721:e=>{"use strict";var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},e.exports=t},9823:(e,t,r)=>{"use strict";var i=r(4133),n=TypeError;e.exports=function(e){if(i(e))throw new n("Can't call method on "+e);return e}},4799:(e,t,r)=>{"use strict";var i=r(7192),n=r(3089),o=r(2442),a=r(3794),s=o("species");e.exports=function(e){var t=i(e);a&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},4196:(e,t,r)=>{"use strict";var i=r(3220),n=r(1890).f,o=r(7151),a=r(9027),s=r(8516),c=r(2442)("toStringTag");e.exports=function(e,t,r,d){var u=r?e:e&&e.prototype;u&&(a(u,c)||n(u,c,{configurable:!0,value:t}),d&&!i&&o(u,"toString",s))}},3287:(e,t,r)=>{"use strict";var i=r(3921),n=r(3440),o=i("keys");e.exports=function(e){return o[e]||(o[e]=n(e))}},5509:(e,t,r)=>{"use strict";var i=r(5685),n=r(543),o="__core-js_shared__",a=i[o]||n(o,{});e.exports=a},3921:(e,t,r)=>{"use strict";var i=r(4081),n=r(5509);(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.34.0",mode:i?"pure":"global",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.34.0/LICENSE",source:"https://github.com/zloirock/core-js"})},9022:(e,t,r)=>{"use strict";var i=r(8879),n=r(3164),o=r(4133),a=r(2442)("species");e.exports=function(e,t){var r,s=i(e).constructor;return void 0===s||o(r=i(s)[a])?t:n(r)}},5202:(e,t,r)=>{"use strict";var i=r(2537),n=r(6169),o=r(1182),a=r(9823),s=i("".charAt),c=i("".charCodeAt),d=i("".slice),u=function(e){return function(t,r){var i,u,l=o(a(t)),h=n(r),p=l.length;return h<0||h>=p?e?"":void 0:(i=c(l,h))<55296||i>56319||h+1===p||(u=c(l,h+1))<56320||u>57343?e?s(l,h):i:e?d(l,h,h+2):u-56320+(i-55296<<10)+65536}};e.exports={codeAt:u(!1),charAt:u(!0)}},4086:(e,t,r)=>{"use strict";var i=r(5131),n=r(9353),o=r(5685).String;e.exports=!!Object.getOwnPropertySymbols&&!n(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41})},9681:(e,t,r)=>{"use strict";var i=r(3417),n=r(7192),o=r(2442),a=r(1733);e.exports=function(){var e=n("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,s=o("toPrimitive");t&&!t[s]&&a(t,s,function(e){return i(r,this)},{arity:1})}},3203:(e,t,r)=>{"use strict";var i=r(7192),n=r(2537),o=i("Symbol"),a=o.keyFor,s=n(o.prototype.valueOf);e.exports=o.isRegisteredSymbol||function(e){try{return void 0!==a(s(e))}catch(e){return!1}}},9003:(e,t,r)=>{"use strict";for(var i=r(3921),n=r(7192),o=r(2537),a=r(205),s=r(2442),c=n("Symbol"),d=c.isWellKnownSymbol,u=n("Object","getOwnPropertyNames"),l=o(c.prototype.valueOf),h=i("wks"),p=0,f=u(c),_=f.length;p<_;p++)try{var A=f[p];a(c[A])&&s(A)}catch(e){}e.exports=function(e){if(d&&d(e))return!0;try{for(var t=l(e),r=0,i=u(h),n=i.length;r<n;r++)if(h[i[r]]==t)return!0}catch(e){}return!1}},5731:(e,t,r)=>{"use strict";var i=r(4086);e.exports=i&&!!Symbol.for&&!!Symbol.keyFor},6727:(e,t,r)=>{"use strict";var i,n,o,a,s=r(5685),c=r(145),d=r(9605),u=r(9934),l=r(9027),h=r(9353),p=r(6395),f=r(2076),_=r(3729),A=r(2891),m=r(8816),v=r(4408),E=s.setImmediate,g=s.clearImmediate,S=s.process,b=s.Dispatch,T=s.Function,y=s.MessageChannel,R=s.String,I=0,C={},k="onreadystatechange";h(function(){i=s.location});var w=function(e){if(l(C,e)){var t=C[e];delete C[e],t()}},O=function(e){return function(){w(e)}},N=function(e){w(e.data)},P=function(e){s.postMessage(R(e),i.protocol+"//"+i.host)};E&&g||(E=function(e){A(arguments.length,1);var t=u(e)?e:T(e),r=f(arguments,1);return C[++I]=function(){c(t,void 0,r)},n(I),I},g=function(e){delete C[e]},v?n=function(e){S.nextTick(O(e))}:b&&b.now?n=function(e){b.now(O(e))}:y&&!m?(a=(o=new y).port2,o.port1.onmessage=N,n=d(a.postMessage,a)):s.addEventListener&&u(s.postMessage)&&!s.importScripts&&i&&"file:"!==i.protocol&&!h(P)?(n=P,s.addEventListener("message",N,!1)):n=k in _("script")?function(e){p.appendChild(_("script"))[k]=function(){p.removeChild(this),w(e)}}:function(e){setTimeout(O(e),0)}),e.exports={set:E,clear:g}},8100:(e,t,r)=>{"use strict";var i=r(6169),n=Math.max,o=Math.min;e.exports=function(e,t){var r=i(e);return r<0?n(r+t,0):o(r,t)}},3747:(e,t,r)=>{"use strict";var i=r(108),n=r(9823);e.exports=function(e){return i(n(e))}},6169:(e,t,r)=>{"use strict";var i=r(8836);e.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}},1904:(e,t,r)=>{"use strict";var i=r(6169),n=Math.min;e.exports=function(e){return e>0?n(i(e),0x1fffffffffffff):0}},2962:(e,t,r)=>{"use strict";var i=r(9823),n=Object;e.exports=function(e){return n(i(e))}},681:(e,t,r)=>{"use strict";var i=r(3417),n=r(9611),o=r(205),a=r(5752),s=r(8733),c=r(2442),d=TypeError,u=c("toPrimitive");e.exports=function(e,t){if(!n(e)||o(e))return e;var r,c=a(e,u);if(c){if(void 0===t&&(t="default"),!n(r=i(c,e,t))||o(r))return r;throw new d("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},1525:(e,t,r)=>{"use strict";var i=r(681),n=r(205);e.exports=function(e){var t=i(e,"string");return n(t)?t:t+""}},3220:(e,t,r)=>{"use strict";var i={};i[r(2442)("toStringTag")]="z",e.exports="[object z]"===String(i)},1182:(e,t,r)=>{"use strict";var i=r(6397),n=String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return n(e)}},1028:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},3440:(e,t,r)=>{"use strict";var i=r(2537),n=0,o=Math.random(),a=i(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++n+o,36)}},16:(e,t,r)=>{"use strict";var i=r(4086);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7956:(e,t,r)=>{"use strict";var i=r(3794),n=r(9353);e.exports=i&&n(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},2891:e=>{"use strict";var t=TypeError;e.exports=function(e,r){if(e<r)throw new t("Not enough arguments");return e}},9033:(e,t,r)=>{"use strict";var i=r(5685),n=r(9934),o=i.WeakMap;e.exports=n(o)&&/native code/.test(String(o))},2134:(e,t,r)=>{"use strict";var i=r(9068),n=r(9027),o=r(8248),a=r(1890).f;e.exports=function(e){var t=i.Symbol||(i.Symbol={});n(t,e)||a(t,e,{value:o.f(e)})}},8248:(e,t,r)=>{"use strict";var i=r(2442);t.f=i},2442:(e,t,r)=>{"use strict";var i=r(5685),n=r(3921),o=r(9027),a=r(3440),s=r(4086),c=r(16),d=i.Symbol,u=n("wks"),l=c?d.for||d:d&&d.withoutSetter||a;e.exports=function(e){return o(u,e)||(u[e]=s&&o(d,e)?d[e]:l("Symbol."+e)),u[e]}},3533:(e,t,r)=>{"use strict";var i=r(4715),n=r(1727),o=r(3863),a=r(1350),s=r(5895),c=r(3010),d=r(7151),u=r(1567),l=r(2071),h=r(1794),p=r(9614),f=r(81),_=r(2442)("toStringTag"),A=Error,m=[].push,v=function(e,t){var r,i=n(E,this);a?r=a(new A,i?o(this):E):d(r=i?this:c(E),_,"Error"),void 0!==t&&d(r,"message",f(t)),h(r,v,r.stack,1),arguments.length>2&&l(r,arguments[2]);var s=[];return p(e,m,{that:s}),d(r,"errors",s),r};a?a(v,A):s(v,A,{name:!0});var E=v.prototype=c(A.prototype,{constructor:u(1,v),message:u(1,""),name:u(1,"AggregateError")});i({global:!0,constructor:!0,arity:2},{AggregateError:v})},6864:(e,t,r)=>{"use strict";r(3533)},1845:(e,t,r)=>{"use strict";var i=r(4715),n=r(9353),o=r(3527),a=r(9611),s=r(2962),c=r(7165),d=r(9939),u=r(981),l=r(7265),h=r(8388),p=r(2442),f=r(5131),_=p("isConcatSpreadable"),A=f>=51||!n(function(){var e=[];return e[_]=!1,e.concat()[0]!==e}),m=function(e){if(!a(e))return!1;var t=e[_];return void 0!==t?!!t:o(e)};i({target:"Array",proto:!0,arity:1,forced:!A||!h("concat")},{concat:function(e){var t,r,i,n,o,a=s(this),h=l(a,0),p=0;for(t=-1,i=arguments.length;t<i;t++)if(m(o=-1===t?a:arguments[t]))for(d(p+(n=c(o))),r=0;r<n;r++,p++)r in o&&u(h,p,o[r]);else d(p+1),u(h,p++,o);return h.length=p,h}})},1997:(e,t,r)=>{"use strict";var i=r(3747),n=r(6888),o=r(9234),a=r(4084),s=r(1890).f,c=r(6483),d=r(7474),u=r(4081),l=r(3794),h="Array Iterator",p=a.set,f=a.getterFor(h);e.exports=c(Array,"Array",function(e,t){p(this,{type:h,target:i(e),index:0,kind:t})},function(){var e=f(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=void 0,d(void 0,!0);switch(e.kind){case"keys":return d(r,!1);case"values":return d(t[r],!1)}return d([r,t[r]],!1)},"values");var _=o.Arguments=o.Array;if(n("keys"),n("values"),n("entries"),!u&&l&&"values"!==_.name)try{s(_,"name",{value:"values"})}catch(e){}},8242:()=>{},8791:(e,t,r)=>{"use strict";var i=r(4715),n=r(7192),o=r(145),a=r(3417),s=r(2537),c=r(9353),d=r(9934),u=r(205),l=r(2076),h=r(9647),p=r(4086),f=String,_=n("JSON","stringify"),A=s(/./.exec),m=s("".charAt),v=s("".charCodeAt),E=s("".replace),g=s(1..toString),S=/[\uD800-\uDFFF]/g,b=/^[\uD800-\uDBFF]$/,T=/^[\uDC00-\uDFFF]$/,y=!p||c(function(){var e=n("Symbol")("stringify detection");return"[null]"!==_([e])||"{}"!==_({a:e})||"{}"!==_(Object(e))}),R=c(function(){return'"\udf06\ud834"'!==_("\udf06\ud834")||'"\udead"'!==_("\udead")}),I=function(e,t){var r=l(arguments),i=h(t);if(d(i)||void 0!==e&&!u(e))return r[1]=function(e,t){if(d(i)&&(t=a(i,this,f(e),t)),!u(t))return t},o(_,null,r)},C=function(e,t,r){var i=m(r,t-1),n=m(r,t+1);return A(b,e)&&!A(T,n)||A(T,e)&&!A(b,i)?"\\u"+g(v(e,0),16):e};_&&i({target:"JSON",stat:!0,arity:3,forced:y||R},{stringify:function(e,t,r){var i=l(arguments),n=o(y?I:_,null,i);return R&&"string"==typeof n?E(n,S,C):n}})},8518:(e,t,r)=>{"use strict";var i=r(5685);r(4196)(i.JSON,"JSON",!0)},9786:()=>{},9727:(e,t,r)=>{"use strict";var i=r(4715),n=r(3794),o=r(1890).f;i({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!n},{defineProperty:o})},465:(e,t,r)=>{"use strict";var i=r(4715),n=r(4086),o=r(9353),a=r(6953),s=r(2962);i({target:"Object",stat:!0,forced:!n||o(function(){a.f(1)})},{getOwnPropertySymbols:function(e){var t=a.f;return t?t(s(e)):[]}})},6069:()=>{},8795:(e,t,r)=>{"use strict";var i=r(4715),n=r(3417),o=r(5935),a=r(2157),s=r(3183),c=r(9614);i({target:"Promise",stat:!0,forced:r(7290)},{allSettled:function(e){var t=this,r=a.f(t),i=r.resolve,d=r.reject,u=s(function(){var r=o(t.resolve),a=[],s=0,d=1;c(e,function(e){var o=s++,c=!1;d++,n(r,t,e).then(function(e){c||(c=!0,a[o]={status:"fulfilled",value:e},--d||i(a))},function(e){c||(c=!0,a[o]={status:"rejected",reason:e},--d||i(a))})}),--d||i(a)});return u.error&&d(u.value),r.promise}})},5840:(e,t,r)=>{"use strict";var i=r(4715),n=r(3417),o=r(5935),a=r(2157),s=r(3183),c=r(9614);i({target:"Promise",stat:!0,forced:r(7290)},{all:function(e){var t=this,r=a.f(t),i=r.resolve,d=r.reject,u=s(function(){var r=o(t.resolve),a=[],s=0,u=1;c(e,function(e){var o=s++,c=!1;u++,n(r,t,e).then(function(e){c||(c=!0,a[o]=e,--u||i(a))},d)}),--u||i(a)});return u.error&&d(u.value),r.promise}})},3233:(e,t,r)=>{"use strict";var i=r(4715),n=r(3417),o=r(5935),a=r(7192),s=r(2157),c=r(3183),d=r(9614),u=r(7290),l="No one promise resolved";i({target:"Promise",stat:!0,forced:u},{any:function(e){var t=this,r=a("AggregateError"),i=s.f(t),u=i.resolve,h=i.reject,p=c(function(){var i=o(t.resolve),a=[],s=0,c=1,p=!1;d(e,function(e){var o=s++,d=!1;c++,n(i,t,e).then(function(e){d||p||(p=!0,u(e))},function(e){d||p||(d=!0,a[o]=e,--c||h(new r(a,l)))})}),--c||h(new r(a,l))});return p.error&&h(p.value),i.promise}})},4168:(e,t,r)=>{"use strict";var i=r(4715),n=r(4081),o=r(4865).CONSTRUCTOR,a=r(3159),s=r(7192),c=r(9934),d=r(1733),u=a&&a.prototype;if(i({target:"Promise",proto:!0,forced:o,real:!0},{catch:function(e){return this.then(void 0,e)}}),!n&&c(a)){var l=s("Promise").prototype.catch;u.catch!==l&&d(u,"catch",l,{unsafe:!0})}},1282:(e,t,r)=>{"use strict";var i,n,o,a=r(4715),s=r(4081),c=r(4408),d=r(5685),u=r(3417),l=r(1733),h=r(1350),p=r(4196),f=r(4799),_=r(5935),A=r(9934),m=r(9611),v=r(927),E=r(9022),g=r(6727).set,S=r(5996),b=r(2210),T=r(3183),y=r(5721),R=r(4084),I=r(3159),C=r(4865),k=r(2157),w="Promise",O=C.CONSTRUCTOR,N=C.REJECTION_EVENT,P=C.SUBCLASSING,D=R.getterFor(w),L=R.set,M=I&&I.prototype,x=I,U=M,B=d.TypeError,V=d.document,F=d.process,j=k.f,G=j,W=!!(V&&V.createEvent&&d.dispatchEvent),H="unhandledrejection",Y=function(e){var t;return!(!m(e)||!A(t=e.then))&&t},K=function(e,t){var r,i,n,o=t.value,a=1===t.state,s=a?e.ok:e.fail,c=e.resolve,d=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&q(t),t.rejection=1),!0===s?r=o:(l&&l.enter(),r=s(o),l&&(l.exit(),n=!0)),r===e.promise?d(new B("Promise-chain cycle")):(i=Y(r))?u(i,r,c,d):c(r)):d(o)}catch(e){l&&!n&&l.exit(),d(e)}},Q=function(e,t){e.notified||(e.notified=!0,S(function(){for(var r,i=e.reactions;r=i.get();)K(r,e);e.notified=!1,t&&!e.rejection&&X(e)}))},z=function(e,t,r){var i,n;W?((i=V.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),d.dispatchEvent(i)):i={promise:t,reason:r},!N&&(n=d["on"+e])?n(i):e===H&&b("Unhandled promise rejection",r)},X=function(e){u(g,d,function(){var t,r=e.facade,i=e.value;if(J(e)&&(t=T(function(){c?F.emit("unhandledRejection",i,r):z(H,r,i)}),e.rejection=c||J(e)?2:1,t.error))throw t.value})},J=function(e){return 1!==e.rejection&&!e.parent},q=function(e){u(g,d,function(){var t=e.facade;c?F.emit("rejectionHandled",t):z("rejectionhandled",t,e.value)})},Z=function(e,t,r){return function(i){e(t,i,r)}},$=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Q(e,!0))},ee=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new B("Promise can't be resolved itself");var i=Y(t);i?S(function(){var r={done:!1};try{u(i,t,Z(ee,r,e),Z($,r,e))}catch(t){$(r,t,e)}}):(e.value=t,e.state=1,Q(e,!1))}catch(t){$({done:!1},t,e)}}};if(O&&(U=(x=function(e){v(this,U),_(e),u(i,this);var t=D(this);try{e(Z(ee,t),Z($,t))}catch(e){$(t,e)}}).prototype,(i=function(e){L(this,{type:w,done:!1,notified:!1,parent:!1,reactions:new y,rejection:!1,state:0,value:void 0})}).prototype=l(U,"then",function(e,t){var r=D(this),i=j(E(this,x));return r.parent=!0,i.ok=!A(e)||e,i.fail=A(t)&&t,i.domain=c?F.domain:void 0,0===r.state?r.reactions.add(i):S(function(){K(i,r)}),i.promise}),n=function(){var e=new i,t=D(e);this.promise=e,this.resolve=Z(ee,t),this.reject=Z($,t)},k.f=j=function(e){return e===x||void 0===e?new n(e):G(e)},!s&&A(I)&&M!==Object.prototype)){o=M.then,P||l(M,"then",function(e,t){var r=this;return new x(function(e,t){u(o,r,e,t)}).then(e,t)},{unsafe:!0});try{delete M.constructor}catch(e){}h&&h(M,U)}a({global:!0,constructor:!0,wrap:!0,forced:O},{Promise:x}),p(x,w,!1,!0),f(w)},6028:(e,t,r)=>{"use strict";var i=r(4715),n=r(4081),o=r(3159),a=r(9353),s=r(7192),c=r(9934),d=r(9022),u=r(5712),l=r(1733),h=o&&o.prototype;if(i({target:"Promise",proto:!0,real:!0,forced:!!o&&a(function(){h.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=d(this,s("Promise")),r=c(e);return this.then(r?function(r){return u(t,e()).then(function(){return r})}:e,r?function(r){return u(t,e()).then(function(){throw r})}:e)}}),!n&&c(o)){var p=s("Promise").prototype.finally;h.finally!==p&&l(h,"finally",p,{unsafe:!0})}},9927:(e,t,r)=>{"use strict";r(1282),r(5840),r(4168),r(1228),r(1739),r(1099)},1228:(e,t,r)=>{"use strict";var i=r(4715),n=r(3417),o=r(5935),a=r(2157),s=r(3183),c=r(9614);i({target:"Promise",stat:!0,forced:r(7290)},{race:function(e){var t=this,r=a.f(t),i=r.reject,d=s(function(){var a=o(t.resolve);c(e,function(e){n(a,t,e).then(r.resolve,i)})});return d.error&&i(d.value),r.promise}})},1739:(e,t,r)=>{"use strict";var i=r(4715),n=r(3417),o=r(2157);i({target:"Promise",stat:!0,forced:r(4865).CONSTRUCTOR},{reject:function(e){var t=o.f(this);return n(t.reject,void 0,e),t.promise}})},1099:(e,t,r)=>{"use strict";var i=r(4715),n=r(7192),o=r(4081),a=r(3159),s=r(4865).CONSTRUCTOR,c=r(5712),d=n("Promise"),u=o&&!s;i({target:"Promise",stat:!0,forced:o||s},{resolve:function(e){return c(u&&this===d?a:this,e)}})},8840:(e,t,r)=>{"use strict";var i=r(4715),n=r(2157);i({target:"Promise",stat:!0},{withResolvers:function(){var e=n.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}})},6716:()=>{},1345:(e,t,r)=>{"use strict";var i=r(5202).charAt,n=r(1182),o=r(4084),a=r(6483),s=r(7474),c="String Iterator",d=o.set,u=o.getterFor(c);a(String,"String",function(e){d(this,{type:c,string:n(e),index:0})},function(){var e,t=u(this),r=t.string,n=t.index;return n>=r.length?s(void 0,!0):(e=i(r,n),t.index+=e.length,s(e,!1))})},342:(e,t,r)=>{"use strict";r(2134)("asyncIterator")},3971:(e,t,r)=>{"use strict";var i=r(4715),n=r(5685),o=r(3417),a=r(2537),s=r(4081),c=r(3794),d=r(4086),u=r(9353),l=r(9027),h=r(1727),p=r(8879),f=r(3747),_=r(1525),A=r(1182),m=r(1567),v=r(3010),E=r(7508),g=r(4582),S=r(7195),b=r(6953),T=r(5396),y=r(1890),R=r(7832),I=r(9106),C=r(1733),k=r(3089),w=r(3921),O=r(3287),N=r(9775),P=r(3440),D=r(2442),L=r(8248),M=r(2134),x=r(9681),U=r(4196),B=r(4084),V=r(2503).forEach,F=O("hidden"),j="Symbol",G="prototype",W=B.set,H=B.getterFor(j),Y=Object[G],K=n.Symbol,Q=K&&K[G],z=n.RangeError,X=n.TypeError,J=n.QObject,q=T.f,Z=y.f,$=S.f,ee=I.f,et=a([].push),er=w("symbols"),ei=w("op-symbols"),en=w("wks"),eo=!J||!J[G]||!J[G].findChild,ea=function(e,t,r){var i=q(Y,t);i&&delete Y[t],Z(e,t,r),i&&e!==Y&&Z(Y,t,i)},es=c&&u(function(){return 7!==v(Z({},"a",{get:function(){return Z(this,"a",{value:7}).a}})).a})?ea:Z,ec=function(e,t){var r=er[e]=v(Q);return W(r,{type:j,tag:e,description:t}),c||(r.description=t),r},ed=function(e,t,r){e===Y&&ed(ei,t,r),p(e);var i=_(t);return p(r),l(er,i)?(r.enumerable?(l(e,F)&&e[F][i]&&(e[F][i]=!1),r=v(r,{enumerable:m(0,!1)})):(l(e,F)||Z(e,F,m(1,{})),e[F][i]=!0),es(e,i,r)):Z(e,i,r)},eu=function(e,t){p(e);var r=f(t);return V(E(r).concat(ef(r)),function(t){c&&!o(el,r,t)||ed(e,t,r[t])}),e},el=function(e){var t=_(e),r=o(ee,this,t);return!(this===Y&&l(er,t)&&!l(ei,t))&&(!(r||!l(this,t)||!l(er,t)||l(this,F)&&this[F][t])||r)},eh=function(e,t){var r=f(e),i=_(t);if(r!==Y||!l(er,i)||l(ei,i)){var n=q(r,i);return!n||!l(er,i)||l(r,F)&&r[F][i]||(n.enumerable=!0),n}},ep=function(e){var t=$(f(e)),r=[];return V(t,function(e){l(er,e)||l(N,e)||et(r,e)}),r},ef=function(e){var t=e===Y,r=$(t?ei:f(e)),i=[];return V(r,function(e){l(er,e)&&(!t||l(Y,e))&&et(i,er[e])}),i};d||(C(Q=(K=function(){if(h(Q,this))throw new X("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?A(arguments[0]):void 0,t=P(e),r=function(e){var i=void 0===this?n:this;i===Y&&o(r,ei,e),l(i,F)&&l(i[F],t)&&(i[F][t]=!1);var a=m(1,e);try{es(i,t,a)}catch(e){if(!(e instanceof z))throw e;ea(i,t,a)}};return c&&eo&&es(Y,t,{configurable:!0,set:r}),ec(t,e)})[G],"toString",function(){return H(this).tag}),C(K,"withoutSetter",function(e){return ec(P(e),e)}),I.f=el,y.f=ed,R.f=eu,T.f=eh,g.f=S.f=ep,b.f=ef,L.f=function(e){return ec(D(e),e)},c&&(k(Q,"description",{configurable:!0,get:function(){return H(this).description}}),s||C(Y,"propertyIsEnumerable",el,{unsafe:!0}))),i({global:!0,constructor:!0,wrap:!0,forced:!d,sham:!d},{Symbol:K}),V(E(en),function(e){M(e)}),i({target:j,stat:!0,forced:!d},{useSetter:function(){eo=!0},useSimple:function(){eo=!1}}),i({target:"Object",stat:!0,forced:!d,sham:!c},{create:function(e,t){return void 0===t?v(e):eu(v(e),t)},defineProperty:ed,defineProperties:eu,getOwnPropertyDescriptor:eh}),i({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:ep}),x(),U(K,j),N[F]=!0},8861:()=>{},5201:(e,t,r)=>{"use strict";var i=r(4715),n=r(7192),o=r(9027),a=r(1182),s=r(3921),c=r(5731),d=s("string-to-symbol-registry"),u=s("symbol-to-string-registry");i({target:"Symbol",stat:!0,forced:!c},{for:function(e){var t=a(e);if(o(d,t))return d[t];var r=n("Symbol")(t);return d[t]=r,u[r]=t,r}})},3092:(e,t,r)=>{"use strict";r(2134)("hasInstance")},6538:(e,t,r)=>{"use strict";r(2134)("isConcatSpreadable")},459:(e,t,r)=>{"use strict";r(2134)("iterator")},1967:(e,t,r)=>{"use strict";r(3971),r(5201),r(3274),r(8791),r(465)},3274:(e,t,r)=>{"use strict";var i=r(4715),n=r(9027),o=r(205),a=r(1028),s=r(3921),c=r(5731),d=s("symbol-to-string-registry");i({target:"Symbol",stat:!0,forced:!c},{keyFor:function(e){if(!o(e))throw TypeError(a(e)+" is not a symbol");if(n(d,e))return d[e]}})},3236:(e,t,r)=>{"use strict";r(2134)("matchAll")},2303:(e,t,r)=>{"use strict";r(2134)("match")},1654:(e,t,r)=>{"use strict";r(2134)("replace")},4833:(e,t,r)=>{"use strict";r(2134)("search")},316:(e,t,r)=>{"use strict";r(2134)("species")},6925:(e,t,r)=>{"use strict";r(2134)("split")},3135:(e,t,r)=>{"use strict";var i=r(2134),n=r(9681);i("toPrimitive"),n()},9390:(e,t,r)=>{"use strict";var i=r(7192),n=r(2134),o=r(4196);n("toStringTag"),o(i("Symbol"),"Symbol")},5938:(e,t,r)=>{"use strict";r(2134)("unscopables")},3705:(e,t,r)=>{"use strict";var i=r(2442),n=r(1890).f,o=i("metadata"),a=Function.prototype;void 0===a[o]&&n(a,o,{value:null})},1935:(e,t,r)=>{"use strict";r(2134)("asyncDispose")},1944:(e,t,r)=>{"use strict";r(2134)("dispose")},3361:(e,t,r)=>{"use strict";r(4715)({target:"Symbol",stat:!0},{isRegisteredSymbol:r(3203)})},6714:(e,t,r)=>{"use strict";r(4715)({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:r(3203)})},1823:(e,t,r)=>{"use strict";r(4715)({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:r(9003)})},5704:(e,t,r)=>{"use strict";r(4715)({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:r(9003)})},4163:(e,t,r)=>{"use strict";r(2134)("matcher")},6206:(e,t,r)=>{"use strict";r(2134)("metadataKey")},5539:(e,t,r)=>{"use strict";r(2134)("metadata")},6499:(e,t,r)=>{"use strict";r(2134)("observable")},1548:(e,t,r)=>{"use strict";r(2134)("patternMatch")},1666:(e,t,r)=>{"use strict";r(2134)("replaceAll")},7483:(e,t,r)=>{"use strict";r(1997);var i=r(8920),n=r(5685),o=r(4196),a=r(9234);for(var s in i)o(n[s],s),a[s]=a.Array},5602:(e,t,r)=>{"use strict";var i=r(8641);e.exports=i},2948:(e,t,r)=>{"use strict";var i=r(8462);r(7483),e.exports=i},4454:(e,t,r)=>{"use strict";var i=r(3941);r(7483),e.exports=i},4690:(e,t,r)=>{"use strict";var i=r(4101);r(7483),e.exports=i},7263:(e,t,r)=>{"use strict";var i=r(7548);e.exports=i},509:(e,t,r)=>{"use strict";var i=r(9985),n=r(3691),o=TypeError;e.exports=function(e){if(i(e))return e;throw new o(n(e)+" is not a function")}},2655:(e,t,r)=>{"use strict";var i=r(9429),n=r(3691),o=TypeError;e.exports=function(e){if(i(e))return e;throw new o(n(e)+" is not a constructor")}},3550:(e,t,r)=>{"use strict";var i=r(9985),n=String,o=TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw new o("Can't set "+n(e)+" as a prototype")}},7370:(e,t,r)=>{"use strict";var i=r(4201),n=r(5391),o=r(2560).f,a=i("unscopables"),s=Array.prototype;void 0===s[a]&&o(s,a,{configurable:!0,value:n(null)}),e.exports=function(e){s[a][e]=!0}},767:(e,t,r)=>{"use strict";var i=r(3622),n=TypeError;e.exports=function(e,t){if(i(t,e))return e;throw new n("Incorrect invocation")}},5027:(e,t,r)=>{"use strict";var i=r(8999),n=String,o=TypeError;e.exports=function(e){if(i(e))return e;throw new o(n(e)+" is not an object")}},4328:(e,t,r)=>{"use strict";var i=r(5290),n=r(7578),o=r(6310),a=function(e){return function(t,r,a){var s,c=i(t),d=o(c),u=n(a,d);if(e&&r!=r){for(;d>u;)if((s=c[u++])!=s)return!0}else for(;d>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},6004:(e,t,r)=>{"use strict";var i=r(8844);e.exports=i([].slice)},6431:(e,t,r)=>{"use strict";var i=r(4201)("iterator"),n=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){n=!0}};a[i]=function(){return this},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){try{if(!t&&!n)return!1}catch(e){return!1}var r=!1;try{var o={};o[i]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},6648:(e,t,r)=>{"use strict";var i=r(8844),n=i({}.toString),o=i("".slice);e.exports=function(e){return o(n(e),8,-1)}},926:(e,t,r)=>{"use strict";var i=r(3043),n=r(9985),o=r(6648),a=r(4201)("toStringTag"),s=Object,c="Arguments"===o(function(){return arguments}());e.exports=i?o:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?r:c?o(t):"Object"===(i=o(t))&&n(t.callee)?"Arguments":i}},8758:(e,t,r)=>{"use strict";var i=r(6812),n=r(9152),o=r(2474),a=r(2560);e.exports=function(e,t,r){for(var s=n(t),c=a.f,d=o.f,u=0;u<s.length;u++){var l=s[u];i(e,l)||r&&i(r,l)||c(e,l,d(t,l))}}},1748:(e,t,r)=>{"use strict";var i=r(3689);e.exports=!i(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},7807:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},5773:(e,t,r)=>{"use strict";var i=r(7697),n=r(2560),o=r(5684);e.exports=i?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},5684:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},2148:(e,t,r)=>{"use strict";var i=r(8702),n=r(2560);e.exports=function(e,t,r){return r.get&&i(r.get,t,{getter:!0}),r.set&&i(r.set,t,{setter:!0}),n.f(e,t,r)}},1880:(e,t,r)=>{"use strict";var i=r(9985),n=r(2560),o=r(8702),a=r(5014);e.exports=function(e,t,r,s){s||(s={});var c=s.enumerable,d=void 0!==s.name?s.name:t;if(i(r)&&o(r,d,s),s.global)c?e[t]=r:a(t,r);else{try{s.unsafe?e[t]&&(c=!0):delete e[t]}catch(e){}c?e[t]=r:n.f(e,t,{value:r,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return e}},5014:(e,t,r)=>{"use strict";var i=r(9037),n=Object.defineProperty;e.exports=function(e,t){try{n(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}},7697:(e,t,r)=>{"use strict";var i=r(3689);e.exports=!i(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},2659:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports={all:t,IS_HTMLDDA:void 0===t&&void 0!==t}},6420:(e,t,r)=>{"use strict";var i=r(9037),n=r(8999),o=i.document,a=n(o)&&n(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},6338:e=>{"use strict";e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},3265:(e,t,r)=>{"use strict";var i=r(6420)("span").classList,n=i&&i.constructor&&i.constructor.prototype;e.exports=n===Object.prototype?void 0:n},2532:(e,t,r)=>{"use strict";var i=r(8563),n=r(806);e.exports=!i&&!n&&"object"==typeof window&&"object"==typeof document},8563:e=>{"use strict";e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},3221:(e,t,r)=>{"use strict";var i=r(71);e.exports=/ipad|iphone|ipod/i.test(i)&&"undefined"!=typeof Pebble},4764:(e,t,r)=>{"use strict";var i=r(71);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)},806:(e,t,r)=>{"use strict";var i=r(9037),n=r(6648);e.exports="process"===n(i.process)},7486:(e,t,r)=>{"use strict";var i=r(71);e.exports=/web0s(?!.*chrome)/i.test(i)},71:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},3615:(e,t,r)=>{"use strict";var i,n,o=r(9037),a=r(71),s=o.process,c=o.Deno,d=s&&s.versions||c&&c.version,u=d&&d.v8;u&&(n=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!n&&a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(n=+i[1]),e.exports=n},2739:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},6610:(e,t,r)=>{"use strict";var i=r(8844),n=Error,o=i("".replace),a=String(new n("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,c=s.test(a);e.exports=function(e,t){if(c&&"string"==typeof e&&!n.prepareStackTrace)for(;t--;)e=o(e,s,"");return e}},5411:(e,t,r)=>{"use strict";var i=r(5773),n=r(6610),o=r(9599),a=Error.captureStackTrace;e.exports=function(e,t,r,s){o&&(a?a(e,t):i(e,"stack",n(r,s)))}},9599:(e,t,r)=>{"use strict";var i=r(3689),n=r(5684);e.exports=!i(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",n(1,7)),7!==e.stack)})},9989:(e,t,r)=>{"use strict";var i=r(9037),n=r(2474).f,o=r(5773),a=r(1880),s=r(5014),c=r(8758),d=r(5266);e.exports=function(e,t){var r,u,l,h,p,f=e.target,_=e.global,A=e.stat;if(r=_?i:A?i[f]||s(f,{}):(i[f]||{}).prototype)for(u in t){if(h=t[u],l=e.dontCallGetSet?(p=n(r,u))&&p.value:r[u],!d(_?u:f+(A?".":"#")+u,e.forced)&&void 0!==l){if(typeof h==typeof l)continue;c(h,l)}(e.sham||l&&l.sham)&&o(h,"sham",!0),a(r,u,h,e)}}},3689:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},1735:(e,t,r)=>{"use strict";var i=r(7215),n=Function.prototype,o=n.apply,a=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(o):function(){return a.apply(o,arguments)})},4071:(e,t,r)=>{"use strict";var i=r(6576),n=r(509),o=r(7215),a=i(i.bind);e.exports=function(e,t){return n(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},7215:(e,t,r)=>{"use strict";var i=r(3689);e.exports=!i(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},2615:(e,t,r)=>{"use strict";var i=r(7215),n=Function.prototype.call;e.exports=i?n.bind(n):function(){return n.apply(n,arguments)}},1236:(e,t,r)=>{"use strict";var i=r(7697),n=r(6812),o=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,s=n(o,"name"),c=s&&(!i||i&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:s&&"something"===(function(){}).name,CONFIGURABLE:c}},2743:(e,t,r)=>{"use strict";var i=r(8844),n=r(509);e.exports=function(e,t,r){try{return i(n(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},6576:(e,t,r)=>{"use strict";var i=r(6648),n=r(8844);e.exports=function(e){if("Function"===i(e))return n(e)}},8844:(e,t,r)=>{"use strict";var i=r(7215),n=Function.prototype,o=n.call,a=i&&n.bind.bind(o,o);e.exports=i?a:function(e){return function(){return o.apply(e,arguments)}}},6058:(e,t,r)=>{"use strict";var i=r(9037),n=r(9985);e.exports=function(e,t){var r;return arguments.length<2?n(r=i[e])?r:void 0:i[e]&&i[e][t]}},1664:(e,t,r)=>{"use strict";var i=r(926),n=r(4849),o=r(5726),a=r(9478),s=r(4201)("iterator");e.exports=function(e){if(!o(e))return n(e,s)||n(e,"@@iterator")||a[i(e)]}},5185:(e,t,r)=>{"use strict";var i=r(2615),n=r(509),o=r(5027),a=r(3691),s=r(1664),c=TypeError;e.exports=function(e,t){var r=arguments.length<2?s(e):t;if(n(r))return o(i(r,e));throw new c(a(e)+" is not iterable")}},4849:(e,t,r)=>{"use strict";var i=r(509),n=r(5726);e.exports=function(e,t){var r=e[t];return n(r)?void 0:i(r)}},9037:function(e,t,r){"use strict";var i=function(e){return e&&e.Math===Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof r.g&&r.g)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()},6812:(e,t,r)=>{"use strict";var i=r(8844),n=r(690),o=i({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(n(e),t)}},7248:e=>{"use strict";e.exports={}},920:e=>{"use strict";e.exports=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}}},2688:(e,t,r)=>{"use strict";var i=r(6058);e.exports=i("document","documentElement")},8506:(e,t,r)=>{"use strict";var i=r(7697),n=r(3689),o=r(6420);e.exports=!i&&!n(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},4413:(e,t,r)=>{"use strict";var i=r(8844),n=r(3689),o=r(6648),a=Object,s=i("".split);e.exports=n(function(){return!a("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?s(e,""):a(e)}:a},3457:(e,t,r)=>{"use strict";var i=r(9985),n=r(8999),o=r(9385);e.exports=function(e,t,r){var a,s;return o&&i(a=t.constructor)&&a!==r&&n(s=a.prototype)&&s!==r.prototype&&o(e,s),e}},6738:(e,t,r)=>{"use strict";var i=r(8844),n=r(9985),o=r(4091),a=i(Function.toString);n(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},2570:(e,t,r)=>{"use strict";var i=r(8999),n=r(5773);e.exports=function(e,t){i(t)&&"cause"in t&&n(e,"cause",t.cause)}},618:(e,t,r)=>{"use strict";var i,n,o,a=r(9834),s=r(9037),c=r(8999),d=r(5773),u=r(6812),l=r(4091),h=r(2713),p=r(7248),f="Object already initialized",_=s.TypeError,A=s.WeakMap;if(a||l.state){var m=l.state||(l.state=new A);m.get=m.get,m.has=m.has,m.set=m.set,i=function(e,t){if(m.has(e))throw new _(f);return t.facade=e,m.set(e,t),t},n=function(e){return m.get(e)||{}},o=function(e){return m.has(e)}}else{var v=h("state");p[v]=!0,i=function(e,t){if(u(e,v))throw new _(f);return t.facade=e,d(e,v,t),t},n=function(e){return u(e,v)?e[v]:{}},o=function(e){return u(e,v)}}e.exports={set:i,get:n,has:o,enforce:function(e){return o(e)?n(e):i(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=n(t)).type!==e)throw new _("Incompatible receiver, "+e+" required");return r}}}},3292:(e,t,r)=>{"use strict";var i=r(4201),n=r(9478),o=i("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[o]===e)}},9985:(e,t,r)=>{"use strict";var i=r(2659),n=i.all;e.exports=i.IS_HTMLDDA?function(e){return"function"==typeof e||e===n}:function(e){return"function"==typeof e}},9429:(e,t,r)=>{"use strict";var i=r(8844),n=r(3689),o=r(9985),a=r(926),s=r(6058),c=r(6738),d=function(){},u=[],l=s("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=i(h.exec),f=!h.test(d),_=function(e){if(!o(e))return!1;try{return l(d,u,e),!0}catch(e){return!1}},A=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(h,c(e))}catch(e){return!0}};A.sham=!0,e.exports=!l||n(function(){var e;return _(_.call)||!_(Object)||!_(function(){e=!0})||e})?A:_},5266:(e,t,r)=>{"use strict";var i=r(3689),n=r(9985),o=/#|\.prototype\./,a=function(e,t){var r=c[s(e)];return r===u||r!==d&&(n(t)?i(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=a.data={},d=a.NATIVE="N",u=a.POLYFILL="P";e.exports=a},5726:e=>{"use strict";e.exports=function(e){return null==e}},8999:(e,t,r)=>{"use strict";var i=r(9985),n=r(2659),o=n.all;e.exports=n.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:i(e)||e===o}:function(e){return"object"==typeof e?null!==e:i(e)}},3931:e=>{"use strict";e.exports=!1},734:(e,t,r)=>{"use strict";var i=r(6058),n=r(9985),o=r(3622),a=r(9525),s=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return n(t)&&o(t.prototype,s(e))}},8734:(e,t,r)=>{"use strict";var i=r(4071),n=r(2615),o=r(5027),a=r(3691),s=r(3292),c=r(6310),d=r(3622),u=r(5185),l=r(1664),h=r(2125),p=TypeError,f=function(e,t){this.stopped=e,this.result=t},_=f.prototype;e.exports=function(e,t,r){var A,m,v,E,g,S,b,T=r&&r.that,y=!(!r||!r.AS_ENTRIES),R=!(!r||!r.IS_RECORD),I=!(!r||!r.IS_ITERATOR),C=!(!r||!r.INTERRUPTED),k=i(t,T),w=function(e){return A&&h(A,"normal",e),new f(!0,e)},O=function(e){return y?(o(e),C?k(e[0],e[1],w):k(e[0],e[1])):C?k(e,w):k(e)};if(R)A=e.iterator;else if(I)A=e;else{if(!(m=l(e)))throw new p(a(e)+" is not iterable");if(s(m)){for(v=0,E=c(e);E>v;v++)if((g=O(e[v]))&&d(_,g))return g;return new f(!1)}A=u(e,m)}for(S=R?e.next:A.next;!(b=n(S,A)).done;){try{g=O(b.value)}catch(e){h(A,"throw",e)}if("object"==typeof g&&g&&d(_,g))return g}return new f(!1)}},2125:(e,t,r)=>{"use strict";var i=r(2615),n=r(5027),o=r(4849);e.exports=function(e,t,r){var a,s;n(e);try{if(!(a=o(e,"return"))){if("throw"===t)throw r;return r}a=i(a,e)}catch(e){s=!0,a=e}if("throw"===t)throw r;if(s)throw a;return n(a),r}},974:(e,t,r)=>{"use strict";var i=r(2013).IteratorPrototype,n=r(5391),o=r(5684),a=r(5997),s=r(9478),c=function(){return this};e.exports=function(e,t,r,d){var u=t+" Iterator";return e.prototype=n(i,{next:o(+!d,r)}),a(e,u,!1,!0),s[u]=c,e}},1934:(e,t,r)=>{"use strict";var i=r(9989),n=r(2615),o=r(3931),a=r(1236),s=r(9985),c=r(974),d=r(1868),u=r(9385),l=r(5997),h=r(5773),p=r(1880),f=r(4201),_=r(9478),A=r(2013),m=a.PROPER,v=a.CONFIGURABLE,E=A.IteratorPrototype,g=A.BUGGY_SAFARI_ITERATORS,S=f("iterator"),b="keys",T="values",y="entries",R=function(){return this};e.exports=function(e,t,r,a,f,A,I){c(r,t,a);var C,k,w,O=function(e){if(e===f&&M)return M;if(!g&&e&&e in D)return D[e];switch(e){case b:case T:case y:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",P=!1,D=e.prototype,L=D[S]||D["@@iterator"]||f&&D[f],M=!g&&L||O(f),x="Array"===t&&D.entries||L;if(x&&(C=d(x.call(new e)))!==Object.prototype&&C.next&&(o||d(C)===E||(u?u(C,E):s(C[S])||p(C,S,R)),l(C,N,!0,!0),o&&(_[N]=R)),m&&f===T&&L&&L.name!==T&&(!o&&v?h(D,"name",T):(P=!0,M=function(){return n(L,this)})),f){if(k={values:O(T),keys:A?M:O(b),entries:O(y)},I)for(w in k)!g&&!P&&w in D||p(D,w,k[w]);else i({target:t,proto:!0,forced:g||P},k)}return o&&!I||D[S]===M||p(D,S,M,{name:f}),_[t]=M,k}},2013:(e,t,r)=>{"use strict";var i,n,o,a=r(3689),s=r(9985),c=r(8999),d=r(5391),u=r(1868),l=r(1880),h=r(4201),p=r(3931),f=h("iterator"),_=!1;[].keys&&("next"in(o=[].keys())?(n=u(u(o)))!==Object.prototype&&(i=n):_=!0),!c(i)||a(function(){var e={};return i[f].call(e)!==e})?i={}:p&&(i=d(i)),s(i[f])||l(i,f,function(){return this}),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:_}},9478:e=>{"use strict";e.exports={}},6310:(e,t,r)=>{"use strict";var i=r(3126);e.exports=function(e){return i(e.length)}},8702:(e,t,r)=>{"use strict";var i=r(8844),n=r(3689),o=r(9985),a=r(6812),s=r(7697),c=r(1236).CONFIGURABLE,d=r(6738),u=r(618),l=u.enforce,h=u.get,p=String,f=Object.defineProperty,_=i("".slice),A=i("".replace),m=i([].join),v=s&&!n(function(){return 8!==f(function(){},"length",{value:8}).length}),E=String(String).split("String"),g=e.exports=function(e,t,r){"Symbol("===_(p(t),0,7)&&(t="["+A(p(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!a(e,"name")||c&&e.name!==t)&&(s?f(e,"name",{value:t,configurable:!0}):e.name=t),v&&r&&a(r,"arity")&&e.length!==r.arity&&f(e,"length",{value:r.arity});try{r&&a(r,"constructor")&&r.constructor?s&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var i=l(e);return a(i,"source")||(i.source=m(E,"string"==typeof t?t:"")),e};Function.prototype.toString=g(function(){return o(this)&&h(this).source||d(this)},"toString")},8828:e=>{"use strict";var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var i=+e;return(i>0?r:t)(i)}},231:(e,t,r)=>{"use strict";var i,n,o,a,s,c=r(9037),d=r(4071),u=r(2474).f,l=r(9886).set,h=r(4410),p=r(4764),f=r(3221),_=r(7486),A=r(806),m=c.MutationObserver||c.WebKitMutationObserver,v=c.document,E=c.process,g=c.Promise,S=u(c,"queueMicrotask"),b=S&&S.value;if(!b){var T=new h,y=function(){var e,t;for(A&&(e=E.domain)&&e.exit();t=T.get();)try{t()}catch(e){throw T.head&&i(),e}e&&e.enter()};p||A||_||!m||!v?!f&&g&&g.resolve?((a=g.resolve(void 0)).constructor=g,s=d(a.then,a),i=function(){s(y)}):A?i=function(){E.nextTick(y)}:(l=d(l,c),i=function(){l(y)}):(n=!0,o=v.createTextNode(""),new m(y).observe(o,{characterData:!0}),i=function(){o.data=n=!n}),b=function(e){T.head||i(),T.add(e)}}e.exports=b},8742:(e,t,r)=>{"use strict";var i=r(509),n=TypeError,o=function(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw new n("Bad Promise constructor");t=e,r=i}),this.resolve=i(t),this.reject=i(r)};e.exports.f=function(e){return new o(e)}},3841:(e,t,r)=>{"use strict";var i=r(4327);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:i(e)}},5391:(e,t,r)=>{"use strict";var i,n=r(5027),o=r(5255),a=r(2739),s=r(7248),c=r(2688),d=r(6420),u=r(2713),l="prototype",h="script",p=u("IE_PROTO"),f=function(){},_=function(e){return"<"+h+">"+e+"</"+h+">"},A=function(e){e.write(_("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}m="undefined"!=typeof document?document.domain&&i?A(i):(t=d("iframe"),r="java"+h+":",t.style.display="none",c.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(_("document.F=Object")),e.close(),e.F):A(i);for(var e,t,r,n=a.length;n--;)delete m[l][a[n]];return m()};s[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(f[l]=n(e),r=new f,f[l]=null,r[p]=e):r=m(),void 0===t?r:o.f(r,t)}},5255:(e,t,r)=>{"use strict";var i=r(7697),n=r(5648),o=r(2560),a=r(5027),s=r(5290),c=r(300);t.f=i&&!n?Object.defineProperties:function(e,t){a(e);for(var r,i=s(t),n=c(t),d=n.length,u=0;d>u;)o.f(e,r=n[u++],i[r]);return e}},2560:(e,t,r)=>{"use strict";var i=r(7697),n=r(8506),o=r(5648),a=r(5027),s=r(8360),c=TypeError,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor,l="enumerable",h="configurable",p="writable";t.f=i?o?function(e,t,r){if(a(e),t=s(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&p in r&&!r[p]){var i=u(e,t);i&&i[p]&&(e[t]=r.value,r={configurable:h in r?r[h]:i[h],enumerable:l in r?r[l]:i[l],writable:!1})}return d(e,t,r)}:d:function(e,t,r){if(a(e),t=s(t),a(r),n)try{return d(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},2474:(e,t,r)=>{"use strict";var i=r(7697),n=r(2615),o=r(9556),a=r(5684),s=r(5290),c=r(8360),d=r(6812),u=r(8506),l=Object.getOwnPropertyDescriptor;t.f=i?l:function(e,t){if(e=s(e),t=c(t),u)try{return l(e,t)}catch(e){}if(d(e,t))return a(!n(o.f,e,t),e[t])}},2741:(e,t,r)=>{"use strict";var i=r(4948),n=r(2739).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,n)}},7518:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},1868:(e,t,r)=>{"use strict";var i=r(6812),n=r(9985),o=r(690),a=r(2713),s=r(1748),c=a("IE_PROTO"),d=Object,u=d.prototype;e.exports=s?d.getPrototypeOf:function(e){var t=o(e);if(i(t,c))return t[c];var r=t.constructor;return n(r)&&t instanceof r?r.prototype:t instanceof d?u:null}},3622:(e,t,r)=>{"use strict";var i=r(8844);e.exports=i({}.isPrototypeOf)},4948:(e,t,r)=>{"use strict";var i=r(8844),n=r(6812),o=r(5290),a=r(4328).indexOf,s=r(7248),c=i([].push);e.exports=function(e,t){var r,i=o(e),d=0,u=[];for(r in i)!n(s,r)&&n(i,r)&&c(u,r);for(;t.length>d;)n(i,r=t[d++])&&(~a(u,r)||c(u,r));return u}},300:(e,t,r)=>{"use strict";var i=r(4948),n=r(2739);e.exports=Object.keys||function(e){return i(e,n)}},9556:(e,t)=>{"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,n=i&&!r.call({1:2},1);t.f=n?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},9385:(e,t,r)=>{"use strict";var i=r(2743),n=r(5027),o=r(3550);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=i(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return n(r),o(i),t?e(r,i):r.__proto__=i,r}}():void 0)},5899:(e,t,r)=>{"use strict";var i=r(2615),n=r(9985),o=r(8999),a=TypeError;e.exports=function(e,t){var r,s;if("string"===t&&n(r=e.toString)&&!o(s=i(r,e))||n(r=e.valueOf)&&!o(s=i(r,e))||"string"!==t&&n(r=e.toString)&&!o(s=i(r,e)))return s;throw new a("Can't convert object to primitive value")}},9152:(e,t,r)=>{"use strict";var i=r(6058),n=r(8844),o=r(2741),a=r(7518),s=r(5027),c=n([].concat);e.exports=i("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?c(t,r(e)):t}},9302:e=>{"use strict";e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},7073:(e,t,r)=>{"use strict";var i=r(9037),n=r(7919),o=r(9985),a=r(5266),s=r(6738),c=r(4201),d=r(2532),u=r(8563),l=r(3931),h=r(3615),p=n&&n.prototype,f=c("species"),_=!1,A=o(i.PromiseRejectionEvent),m=a("Promise",function(){var e=s(n),t=e!==String(n);if(!t&&66===h||l&&(!p.catch||!p.finally))return!0;if(!h||h<51||!/native code/.test(e)){var r=new n(function(e){e(1)}),i=function(e){e(function(){},function(){})};if((r.constructor={})[f]=i,!(_=r.then(function(){})instanceof i))return!0}return!t&&(d||u)&&!A});e.exports={CONSTRUCTOR:m,REJECTION_EVENT:A,SUBCLASSING:_}},7919:(e,t,r)=>{"use strict";var i=r(9037);e.exports=i.Promise},2945:(e,t,r)=>{"use strict";var i=r(5027),n=r(8999),o=r(8742);e.exports=function(e,t){if(i(e),n(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},562:(e,t,r)=>{"use strict";var i=r(7919),n=r(6431),o=r(7073).CONSTRUCTOR;e.exports=o||!n(function(e){i.all(e).then(void 0,function(){})})},8055:(e,t,r)=>{"use strict";var i=r(2560).f;e.exports=function(e,t,r){r in e||i(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},4410:e=>{"use strict";var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},e.exports=t},4684:(e,t,r)=>{"use strict";var i=r(5726),n=TypeError;e.exports=function(e){if(i(e))throw new n("Can't call method on "+e);return e}},4241:(e,t,r)=>{"use strict";var i=r(6058),n=r(2148),o=r(4201),a=r(7697),s=o("species");e.exports=function(e){var t=i(e);a&&t&&!t[s]&&n(t,s,{configurable:!0,get:function(){return this}})}},5997:(e,t,r)=>{"use strict";var i=r(2560).f,n=r(6812),o=r(4201)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!n(e,o)&&i(e,o,{configurable:!0,value:t})}},2713:(e,t,r)=>{"use strict";var i=r(3430),n=r(4630),o=i("keys");e.exports=function(e){return o[e]||(o[e]=n(e))}},4091:(e,t,r)=>{"use strict";var i=r(9037),n=r(5014),o="__core-js_shared__",a=i[o]||n(o,{});e.exports=a},3430:(e,t,r)=>{"use strict";var i=r(3931),n=r(4091);(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.34.0",mode:i?"pure":"global",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.34.0/LICENSE",source:"https://github.com/zloirock/core-js"})},6373:(e,t,r)=>{"use strict";var i=r(5027),n=r(2655),o=r(5726),a=r(4201)("species");e.exports=function(e,t){var r,s=i(e).constructor;return void 0===s||o(r=i(s)[a])?t:n(r)}},146:(e,t,r)=>{"use strict";var i=r(3615),n=r(3689),o=r(9037).String;e.exports=!!Object.getOwnPropertySymbols&&!n(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41})},9886:(e,t,r)=>{"use strict";var i,n,o,a,s=r(9037),c=r(1735),d=r(4071),u=r(9985),l=r(6812),h=r(3689),p=r(2688),f=r(6004),_=r(6420),A=r(1500),m=r(4764),v=r(806),E=s.setImmediate,g=s.clearImmediate,S=s.process,b=s.Dispatch,T=s.Function,y=s.MessageChannel,R=s.String,I=0,C={},k="onreadystatechange";h(function(){i=s.location});var w=function(e){if(l(C,e)){var t=C[e];delete C[e],t()}},O=function(e){return function(){w(e)}},N=function(e){w(e.data)},P=function(e){s.postMessage(R(e),i.protocol+"//"+i.host)};E&&g||(E=function(e){A(arguments.length,1);var t=u(e)?e:T(e),r=f(arguments,1);return C[++I]=function(){c(t,void 0,r)},n(I),I},g=function(e){delete C[e]},v?n=function(e){S.nextTick(O(e))}:b&&b.now?n=function(e){b.now(O(e))}:y&&!m?(a=(o=new y).port2,o.port1.onmessage=N,n=d(a.postMessage,a)):s.addEventListener&&u(s.postMessage)&&!s.importScripts&&i&&"file:"!==i.protocol&&!h(P)?(n=P,s.addEventListener("message",N,!1)):n=k in _("script")?function(e){p.appendChild(_("script"))[k]=function(){p.removeChild(this),w(e)}}:function(e){setTimeout(O(e),0)}),e.exports={set:E,clear:g}},7578:(e,t,r)=>{"use strict";var i=r(8700),n=Math.max,o=Math.min;e.exports=function(e,t){var r=i(e);return r<0?n(r+t,0):o(r,t)}},5290:(e,t,r)=>{"use strict";var i=r(4413),n=r(4684);e.exports=function(e){return i(n(e))}},8700:(e,t,r)=>{"use strict";var i=r(8828);e.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}},3126:(e,t,r)=>{"use strict";var i=r(8700),n=Math.min;e.exports=function(e){return e>0?n(i(e),0x1fffffffffffff):0}},690:(e,t,r)=>{"use strict";var i=r(4684),n=Object;e.exports=function(e){return n(i(e))}},8732:(e,t,r)=>{"use strict";var i=r(2615),n=r(8999),o=r(734),a=r(4849),s=r(5899),c=r(4201),d=TypeError,u=c("toPrimitive");e.exports=function(e,t){if(!n(e)||o(e))return e;var r,c=a(e,u);if(c){if(void 0===t&&(t="default"),!n(r=i(c,e,t))||o(r))return r;throw new d("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},8360:(e,t,r)=>{"use strict";var i=r(8732),n=r(734);e.exports=function(e){var t=i(e,"string");return n(t)?t:t+""}},3043:(e,t,r)=>{"use strict";var i={};i[r(4201)("toStringTag")]="z",e.exports="[object z]"===String(i)},4327:(e,t,r)=>{"use strict";var i=r(926),n=String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return n(e)}},3691:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},4630:(e,t,r)=>{"use strict";var i=r(8844),n=0,o=Math.random(),a=i(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++n+o,36)}},9525:(e,t,r)=>{"use strict";var i=r(146);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},5648:(e,t,r)=>{"use strict";var i=r(7697),n=r(3689);e.exports=i&&n(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},1500:e=>{"use strict";var t=TypeError;e.exports=function(e,r){if(e<r)throw new t("Not enough arguments");return e}},9834:(e,t,r)=>{"use strict";var i=r(9037),n=r(9985),o=i.WeakMap;e.exports=n(o)&&/native code/.test(String(o))},4201:(e,t,r)=>{"use strict";var i=r(9037),n=r(3430),o=r(6812),a=r(4630),s=r(146),c=r(9525),d=i.Symbol,u=n("wks"),l=c?d.for||d:d&&d.withoutSetter||a;e.exports=function(e){return o(u,e)||(u[e]=s&&o(d,e)?d[e]:l("Symbol."+e)),u[e]}},1064:(e,t,r)=>{"use strict";var i=r(6058),n=r(6812),o=r(5773),a=r(3622),s=r(9385),c=r(8758),d=r(8055),u=r(3457),l=r(3841),h=r(2570),p=r(5411),f=r(7697),_=r(3931);e.exports=function(e,t,r,A){var m="stackTraceLimit",v=A?2:1,E=e.split("."),g=E[E.length-1],S=i.apply(null,E);if(S){var b=S.prototype;if(!_&&n(b,"cause")&&delete b.cause,!r)return S;var T=i("Error"),y=t(function(e,t){var r=l(A?t:e,void 0),i=A?new S(e):new S;return void 0!==r&&o(i,"message",r),p(i,y,i.stack,2),this&&a(b,this)&&u(i,this,y),arguments.length>v&&h(i,arguments[v]),i});if(y.prototype=b,"Error"!==g?s?s(y,T):c(y,T,{name:!0}):f&&m in S&&(d(y,S,m),d(y,S,"prepareStackTrace")),c(y,S),!_)try{b.name!==g&&o(b,"name",g),b.constructor=y}catch(e){}return y}}},752:(e,t,r)=>{"use strict";var i=r(5290),n=r(7370),o=r(9478),a=r(618),s=r(2560).f,c=r(1934),d=r(7807),u=r(3931),l=r(7697),h="Array Iterator",p=a.set,f=a.getterFor(h);e.exports=c(Array,"Array",function(e,t){p(this,{type:h,target:i(e),index:0,kind:t})},function(){var e=f(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=void 0,d(void 0,!0);switch(e.kind){case"keys":return d(r,!1);case"values":return d(t[r],!1)}return d([r,t[r]],!1)},"values");var _=o.Arguments=o.Array;if(n("keys"),n("values"),n("entries"),!u&&l&&"values"!==_.name)try{s(_,"name",{value:"values"})}catch(e){}},1057:(e,t,r)=>{"use strict";var i=r(9989),n=r(9037),o=r(1735),a=r(1064),s="WebAssembly",c=n[s],d=7!==Error("e",{cause:7}).cause,u=function(e,t){var r={};r[e]=a(e,t,d),i({global:!0,constructor:!0,arity:1,forced:d},r)},l=function(e,t){if(c&&c[e]){var r={};r[e]=a(s+"."+e,t,d),i({target:s,stat:!0,constructor:!0,arity:1,forced:d},r)}};u("Error",function(e){return function(t){return o(e,this,arguments)}}),u("EvalError",function(e){return function(t){return o(e,this,arguments)}}),u("RangeError",function(e){return function(t){return o(e,this,arguments)}}),u("ReferenceError",function(e){return function(t){return o(e,this,arguments)}}),u("SyntaxError",function(e){return function(t){return o(e,this,arguments)}}),u("TypeError",function(e){return function(t){return o(e,this,arguments)}}),u("URIError",function(e){return function(t){return o(e,this,arguments)}}),l("CompileError",function(e){return function(t){return o(e,this,arguments)}}),l("LinkError",function(e){return function(t){return o(e,this,arguments)}}),l("RuntimeError",function(e){return function(t){return o(e,this,arguments)}})},1692:(e,t,r)=>{"use strict";var i=r(9989),n=r(2615),o=r(509),a=r(8742),s=r(9302),c=r(8734);i({target:"Promise",stat:!0,forced:r(562)},{all:function(e){var t=this,r=a.f(t),i=r.resolve,d=r.reject,u=s(function(){var r=o(t.resolve),a=[],s=0,u=1;c(e,function(e){var o=s++,c=!1;u++,n(r,t,e).then(function(e){c||(c=!0,a[o]=e,--u||i(a))},d)}),--u||i(a)});return u.error&&d(u.value),r.promise}})},5089:(e,t,r)=>{"use strict";var i=r(9989),n=r(3931),o=r(7073).CONSTRUCTOR,a=r(7919),s=r(6058),c=r(9985),d=r(1880),u=a&&a.prototype;if(i({target:"Promise",proto:!0,forced:o,real:!0},{catch:function(e){return this.then(void 0,e)}}),!n&&c(a)){var l=s("Promise").prototype.catch;u.catch!==l&&d(u,"catch",l,{unsafe:!0})}},6697:(e,t,r)=>{"use strict";var i,n,o,a=r(9989),s=r(3931),c=r(806),d=r(9037),u=r(2615),l=r(1880),h=r(9385),p=r(5997),f=r(4241),_=r(509),A=r(9985),m=r(8999),v=r(767),E=r(6373),g=r(9886).set,S=r(231),b=r(920),T=r(9302),y=r(4410),R=r(618),I=r(7919),C=r(7073),k=r(8742),w="Promise",O=C.CONSTRUCTOR,N=C.REJECTION_EVENT,P=C.SUBCLASSING,D=R.getterFor(w),L=R.set,M=I&&I.prototype,x=I,U=M,B=d.TypeError,V=d.document,F=d.process,j=k.f,G=j,W=!!(V&&V.createEvent&&d.dispatchEvent),H="unhandledrejection",Y=function(e){var t;return!(!m(e)||!A(t=e.then))&&t},K=function(e,t){var r,i,n,o=t.value,a=1===t.state,s=a?e.ok:e.fail,c=e.resolve,d=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&q(t),t.rejection=1),!0===s?r=o:(l&&l.enter(),r=s(o),l&&(l.exit(),n=!0)),r===e.promise?d(new B("Promise-chain cycle")):(i=Y(r))?u(i,r,c,d):c(r)):d(o)}catch(e){l&&!n&&l.exit(),d(e)}},Q=function(e,t){e.notified||(e.notified=!0,S(function(){for(var r,i=e.reactions;r=i.get();)K(r,e);e.notified=!1,t&&!e.rejection&&X(e)}))},z=function(e,t,r){var i,n;W?((i=V.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),d.dispatchEvent(i)):i={promise:t,reason:r},!N&&(n=d["on"+e])?n(i):e===H&&b("Unhandled promise rejection",r)},X=function(e){u(g,d,function(){var t,r=e.facade,i=e.value;if(J(e)&&(t=T(function(){c?F.emit("unhandledRejection",i,r):z(H,r,i)}),e.rejection=c||J(e)?2:1,t.error))throw t.value})},J=function(e){return 1!==e.rejection&&!e.parent},q=function(e){u(g,d,function(){var t=e.facade;c?F.emit("rejectionHandled",t):z("rejectionhandled",t,e.value)})},Z=function(e,t,r){return function(i){e(t,i,r)}},$=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Q(e,!0))},ee=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new B("Promise can't be resolved itself");var i=Y(t);i?S(function(){var r={done:!1};try{u(i,t,Z(ee,r,e),Z($,r,e))}catch(t){$(r,t,e)}}):(e.value=t,e.state=1,Q(e,!1))}catch(t){$({done:!1},t,e)}}};if(O&&(U=(x=function(e){v(this,U),_(e),u(i,this);var t=D(this);try{e(Z(ee,t),Z($,t))}catch(e){$(t,e)}}).prototype,(i=function(e){L(this,{type:w,done:!1,notified:!1,parent:!1,reactions:new y,rejection:!1,state:0,value:void 0})}).prototype=l(U,"then",function(e,t){var r=D(this),i=j(E(this,x));return r.parent=!0,i.ok=!A(e)||e,i.fail=A(t)&&t,i.domain=c?F.domain:void 0,0===r.state?r.reactions.add(i):S(function(){K(i,r)}),i.promise}),n=function(){var e=new i,t=D(e);this.promise=e,this.resolve=Z(ee,t),this.reject=Z($,t)},k.f=j=function(e){return e===x||void 0===e?new n(e):G(e)},!s&&A(I)&&M!==Object.prototype)){o=M.then,P||l(M,"then",function(e,t){var r=this;return new x(function(e,t){u(o,r,e,t)}).then(e,t)},{unsafe:!0});try{delete M.constructor}catch(e){}h&&h(M,U)}a({global:!0,constructor:!0,wrap:!0,forced:O},{Promise:x}),p(x,w,!1,!0),f(w)},3964:(e,t,r)=>{"use strict";r(6697),r(1692),r(5089),r(8829),r(2092),r(7905)},8829:(e,t,r)=>{"use strict";var i=r(9989),n=r(2615),o=r(509),a=r(8742),s=r(9302),c=r(8734);i({target:"Promise",stat:!0,forced:r(562)},{race:function(e){var t=this,r=a.f(t),i=r.reject,d=s(function(){var a=o(t.resolve);c(e,function(e){n(a,t,e).then(r.resolve,i)})});return d.error&&i(d.value),r.promise}})},2092:(e,t,r)=>{"use strict";var i=r(9989),n=r(2615),o=r(8742);i({target:"Promise",stat:!0,forced:r(7073).CONSTRUCTOR},{reject:function(e){var t=o.f(this);return n(t.reject,void 0,e),t.promise}})},7905:(e,t,r)=>{"use strict";var i=r(9989),n=r(6058),o=r(3931),a=r(7919),s=r(7073).CONSTRUCTOR,c=r(2945),d=n("Promise"),u=o&&!s;i({target:"Promise",stat:!0,forced:o||s},{resolve:function(e){return c(u&&this===d?a:this,e)}})},6265:(e,t,r)=>{"use strict";var i=r(9037),n=r(6338),o=r(3265),a=r(752),s=r(5773),c=r(5997),d=r(4201)("iterator"),u=a.values,l=function(e,t){if(e){if(e[d]!==u)try{s(e,d,u)}catch(t){e[d]=u}if(c(e,t,!0),n[t]){for(var r in a)if(e[r]!==a[r])try{s(e,r,a[r])}catch(t){e[r]=a[r]}}}};for(var h in n)l(i[h]&&i[h].prototype,h);l(o,"DOMTokenList")}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";let e;r.r(i),r.d(i,{AudioExtension:()=>I,AudioProcessor:()=>y,CreateAutoAdjuster:()=>P,Extension:()=>R,PromiseMutex:()=>M,Ticker:()=>D,VideoProcessor:()=>T,logger:()=>A,reporter:()=>E});var t=r(1685),n=r(1768),o=r(6228);function a(e){return(a="function"==typeof n&&"symbol"==typeof o?function(e){return typeof e}:function(e){return e&&"function"==typeof n&&e.constructor===n&&e!==n.prototype?"symbol":typeof e})(e)}var s=r(4360);function c(e,r,i){var n;return(n=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[s];if(void 0!==r){var i=r.call(e,"string");if("object"!==a(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r),(r="symbol"===a(n)?n:String(n))in e)?t(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}r(1057),r(752),r(6265);var d=r(6226),u=r.n(d);class l{constructor(){c(this,"_events",{}),c(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],i=this._indexOfListener(r,t);-1!==i&&r.splice(i,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(e=>e);for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(let r=0;r<t.length;r+=1){let n=t[r];n.once&&this.off(e,n.listener),n.listener.apply(this,i||[])}}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return -1}emitAsPromise(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return 0===this.getListeners(e).length?u().reject(Error("No promise event handler.")):new(u())((t,i)=>{this.emit(e,...r,t,i)})}emitAsPromiseNoResponse(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return 0===this.getListeners(e).length?u().resolve():new(u())((t,i)=>{this.emit(e,...r,t,i)})}}let h=Date.now(),p={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4};function f(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let _=e=>{for(let t in p)if(Object.prototype.hasOwnProperty.call(p,t)&&p[t]===e)return t;return"DEFAULT"},A=new class{constructor(){c(this,"logLevel",p.DEBUG),c(this,"hookLog",void 0)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}debug(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[p.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[p.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[p.WARNING].concat(t);this.log.apply(this,i)}error(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[p.ERROR].concat(t);this.log.apply(this,i)}log(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-h<100)return void setTimeout(()=>{this.log(...r)},Date.now()-h);let n=Math.max(0,Math.min(4,r[0]));if(r[0]=f()+" Agora-Extension [".concat(_(n),"]:"),null===(e=this.hookLog)||void 0===e||e.call(this,n,r),n<this.logLevel)return;let o=f()+" %cAgora-Extension [".concat(_(n),"]:"),a=[];switch(n){case p.DEBUG:a=[o,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,a);break;case p.INFO:a=[o,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,a);break;case p.WARNING:a=[o,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,a);break;case p.ERROR:a=[o,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,a)}}};function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let E=new class{constructor(){c(this,"apiInvokeMsgQueue",[]),c(this,"hookApiInvoke",void 0)}reportApiInvoke(e){var t;e.timeout=e.timeout||6e4,e.reportResult=void 0===e.reportResult||e.reportResult;let r=Date.now(),i=()=>({name:e.name,apiInvokeTime:r,options:e.options}),n=!1;(t=e.timeout,new(u())(e=>{window.setTimeout(e,t)})).then(()=>{n||(this.sendApiInvoke(v(v({},i()),{},{error:"API_INVOKE_TIMEOUT",success:!1})),A.debug("".concat(e.name," timeout")))});let o=Error("".concat(e.name,": this api invoke is end"));return{onSuccess:t=>{if(n)throw o;n=!0,this.sendApiInvoke(v(v({},i()),{},{success:!0},e.reportResult&&{result:t}))},onError:e=>{if(n)throw e;n=!0,this.sendApiInvoke(v(v({},i()),{},{success:!1,error:e.toString()}))}}}sendApiInvoke(e){this.hookApiInvoke?(this.hookApiInvoke([...this.apiInvokeMsgQueue,e]),this.apiInvokeMsgQueue=[]):this.apiInvokeMsgQueue.push(e)}};function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){c(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class b extends l{get enabled(){return this._enabled}output(e,t){if(this.outputTrack===e)return;let r=E.reportApiInvoke({name:"".concat(this.name,".output"),options:{track:null==e?void 0:e.toString()}});this.outputTrack=e,this.destination&&this.destination.updateInput({track:e,context:t}),r.onSuccess()}constructor(){super(),c(this,"inputTrack",void 0),c(this,"outputTrack",void 0),c(this,"_enabled",!0),c(this,"_source",void 0),c(this,"ID",function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,t).toLowerCase();return i.length===t?"".concat(r).concat(i):"".concat(r).concat(i)+e(t-i.length,"")}(6,"")),c(this,"destination",void 0),c(this,"context",void 0),c(this,"name",void 0)}enable(){if(this._enabled)return;let e=E.reportApiInvoke({name:"".concat(this.name,".enable"),options:!0});A.info("".concat(this.name,"-").concat(this.ID," enabled")),this._enabled=!0;try{var t;let r=null===(t=this.onEnableChange)||void 0===t?void 0:t.call(this,this._enabled);if(r instanceof u())return r.then(()=>{e.onSuccess()}).catch(t=>{throw e.onError(t),t});e.onSuccess()}catch(t){throw e.onError(t),t}}disable(){if(!this._enabled)return;let e=E.reportApiInvoke({name:"".concat(this.name,".enable"),options:!1});A.info("".concat(this.name,"-").concat(this.ID," disabled")),this._enabled=!1;try{var t;let r=null===(t=this.onEnableChange)||void 0===t?void 0:t.call(this,this._enabled);if(r instanceof u())return r.then(()=>{e.onSuccess()}).catch(t=>{throw e.onError(t),t});e.onSuccess()}catch(t){throw e.onError(t),t}}}class T extends b{get kind(){return"video"}pipe(e){let t=E.reportApiInvoke({name:"".concat(this.name,".pipe"),options:{processor:e.name}});if(this.destination===e)return t.onSuccess(),e;if(e._source){let r=Error("Processor ".concat(e.name," already being piped, please call ").concat(e._source.name,".unpipe() beforehand."));throw t.onError(r),r}return this.destination&&this.unpipe(),this.destination=e,e._source=this,this.context&&this.destination.updateInput({track:this.outputTrack,context:this.context}),t.onSuccess(),e}unpipe(){if(!this.destination)return;let e=E.reportApiInvoke({name:"".concat(this.name,".unpipe"),options:{processor:this.destination.name}});A.info("unpiping processor ".concat(this.destination.name,"-").concat(this.destination.ID));try{let e=this.destination;this.destination._source=void 0,this.destination=void 0,e.reset()}finally{e.onSuccess()}}updateInput(e){var t,r;e.context!==this.context&&(this.context=e.context,null===(t=this.onPiped)||void 0===t||t.call(this,this.context),this.destination&&this.destination.updateInput({track:this.outputTrack,context:e.context})),e.track&&this.inputTrack!==e.track&&(this.inputTrack=e.track,null===(r=this.onTrack)||void 0===r||r.call(this,e.track,this.context))}reset(){var e;this.context&&this.context.requestRevertConstraints(this),this.inputTrack=void 0,this.context=void 0,null===(e=this.onUnpiped)||void 0===e||e.call(this),this.destination&&this.destination.reset()}}class y extends b{constructor(){super(...arguments),c(this,"inputNode",void 0),c(this,"outputNode",void 0),c(this,"destination",void 0),c(this,"context",void 0)}get kind(){return"audio"}pipe(e){let t=E.reportApiInvoke({name:"".concat(this.name,".pipe"),options:{processor:e.name}});if(this.destination===e)return t.onSuccess(),e;if(e._source){let r=Error("Processor ".concat(e.name," already being piped, please call ").concat(e._source.name,".unpipe() beforehand."));throw t.onError(r),r}return this.destination&&this.unpipe(),this.destination=e,e._source=this,this.context&&this.destination.updateInput({track:this.outputTrack,node:this.outputNode,context:this.context}),t.onSuccess(),e}unpipe(){if(!this.destination)return;A.info("unpiping processor ".concat(this.destination.name,"-").concat(this.destination.ID));let e=E.reportApiInvoke({name:"".concat(this.name,".unpipe"),options:{processor:this.destination.name}});try{var t;let e=this.destination;null===(t=this.outputNode)||void 0===t||t.disconnect(),this.destination._source=void 0,this.destination=void 0,e.reset()}finally{e.onSuccess()}}output(e,t){if(e instanceof MediaStreamTrack)super.output(e,t);else if(e instanceof AudioNode){if(this.outputNode===e)return;let r=E.reportApiInvoke({name:"".concat(this.name,".output"),options:S(S({},e instanceof MediaStreamTrack&&{track:e.toString()}),e instanceof AudioNode&&{audioNode:e.toString()})});this.outputNode=e,this.destination&&this.destination.updateInput({node:e,context:t}),r.onSuccess()}}updateInput(e){var t,r,i;e.context!==this.context&&(this.context=e.context,null===(t=this.onPiped)||void 0===t||t.call(this,this.context),this.destination&&this.destination.updateInput({track:this.outputTrack,node:this.outputNode,context:e.context})),e.track&&this.inputTrack!==e.track&&(this.inputTrack=e.track,null===(r=this.onTrack)||void 0===r||r.call(this,e.track,this.context)),e.node&&this.inputNode!==e.node&&(this.inputNode=e.node,null===(i=this.onNode)||void 0===i||i.call(this,e.node,this.context))}reset(){var e;this.context&&this.context.requestRevertConstraints(this),this.inputTrack=void 0,this.inputNode=void 0,null===(e=this.onUnpiped)||void 0===e||e.call(this,this.context),this.context=void 0,this.destination&&this.destination.reset()}}class R{constructor(){c(this,"__registered__",!1),c(this,"logger",A),c(this,"reporter",E),c(this,"parameters",{})}createProcessor(){if(!this.__registered__)throw Error("Extension not registered yet!");return this._createProcessor()}static setLogLevel(e){A.setLogLevel(e)}}class I extends R{}r(3964);class C{constructor(e){c(this,"config",null),c(this,"procecssor",void 0),c(this,"frameDropped",[]),c(this,"mstId",null),c(this,"direction","local"),c(this,"presiousFramesDropped",0),c(this,"targetFramerate",0),c(this,"checkTimes",5),this.procecssor=e}async onProcessFrame(e,t){return!!await this.shouldDisableProcessor(e,t)&&(await this.disableProcessor(),!0)}getTrackFramerate(){return this.targetFramerate}setMediaStreamTrackInfo(e,t){this.targetFramerate=t||0}async disableProcessor(){console.warn("agora-extension-super-clarity is disabled automatically due to performance bottleneck"),await this.procecssor.disable()}}class k extends C{constructor(e,t){super(e),c(this,"counter",0),c(this,"totalProcessTime",0),c(this,"presiousCheckPoint",-1),this.config=t}setMediaStreamTrackInfo(e,t){super.setMediaStreamTrackInfo(e,t)}setConfig(e){var t;null!==(t=this.config)&&void 0!==t&&t.targetAverageTime&&e.targetAverageTime&&Math.abs(this.config.targetAverageTime-e.targetAverageTime)/this.config.targetAverageTime>.25&&(this.counter=0,this.totalProcessTime=0,this.presiousCheckPoint=-1),this.config=e}reset(){this.counter=0,this.presiousCheckPoint=-1,this.totalProcessTime=0}async shouldDisableProcessor(e,t){var r,i;if(-1===this.presiousCheckPoint)return this.presiousCheckPoint=e,this.totalProcessTime=t-e,this.counter=1,!1;let n=(null===(r=this.config)||void 0===r?void 0:r.checkDuration)||1e3;if(t-this.presiousCheckPoint<n)return this.totalProcessTime+=t-e,this.counter++,!1;let o=!1;return null!==(i=this.config)&&void 0!==i&&i.targetAverageTime&&this.totalProcessTime/this.counter>=this.config.targetAverageTime&&(o=!0),this.presiousCheckPoint=t,this.totalProcessTime=0,this.counter=0,o}}class w extends C{constructor(e,t){super(e),c(this,"counter",0),c(this,"presiousCheckPoint",-1),c(this,"framerate",[]),this.config=t}setMediaStreamTrackInfo(e,t){super.setMediaStreamTrackInfo(e,t)}setConfig(e){var t;null!==(t=this.config)&&void 0!==t&&t.targetFps&&e.targetFps&&Math.abs(this.config.targetFps-e.targetFps)/this.config.targetFps>.25&&(this.counter=0,this.presiousCheckPoint=-1,this.framerate=[]),this.config=e}reset(){this.counter=0,this.presiousCheckPoint=-1,this.framerate=[]}}class O extends w{constructor(){super(...arguments),c(this,"videoFrameRate",0)}setMediaStreamTrackInfo(e,t){if(t)this.videoFrameRate=t;else{let e="invalid framerate";console.warn(e),A.warning(e),this.videoFrameRate=15}super.setMediaStreamTrackInfo(e,t)}async shouldDisableProcessor(e,t){var r;e-this.presiousCheckPoint>1e3&&(this.presiousCheckPoint>-1&&this.framerate.push(this.counter),this.presiousCheckPoint=e,this.counter=0),this.counter++;let i=!0,n=this.framerate.length;if(this.framerate.length==((null===(r=this.config)||void 0===r?void 0:r.checkTimes)||5)){for(let e=0;e<n;e++)if(this.framerate[e]>.9*this.videoFrameRate){i=!1;break}this.framerate=[]}else i=!1;return i}}class N extends w{constructor(e,t){super(e,t),c(this,"receiver",null)}setMediaStreamTrackInfo(e,t){if(this.mstId=e,super.setMediaStreamTrackInfo(e,t),""===e)return;let r=__ARTC__.__CLIENT_LIST__.length;for(let t=0;t<r;t++){let r=__ARTC__.__CLIENT_LIST__[t]._p2pChannel.connection.peerConnection.getReceivers();for(let t=0;t<r.length;t++)if(e===r[t].track.id)return void(this.receiver=r[t])}}async shouldDisableProcessor(e,t){var r,i;if(e-this.presiousCheckPoint>1e3){if(!this.receiver)return!1;let t=0,r=0;(await this.receiver.getStats()).forEach(e=>{"inbound-rtp"===e.type&&"video"===e.kind&&(t=e.framesDropped,r=e.framesPerSecond)}),this.presiousCheckPoint>-1&&this.framerate.push(this.counter),this.presiousCheckPoint=e,this.counter=0,this.frameDropped.push(t-this.presiousFramesDropped),this.presiousFramesDropped=t,this.config&&Math.abs(this.config.targetFps-r)/this.config.targetFps>.25&&(this.config.targetFps=r)}this.counter++;let n=!0,o=this.framerate.length;if(this.framerate.length==((null===(r=this.config)||void 0===r?void 0:r.checkTimes)||5)){for(let e=0;e<o;e++)if(null!==(i=this.config)&&void 0!==i&&i.targetFps&&this.framerate[e]>.9*this.config.targetFps){n=!1;break}if(!n){n=!0;for(let e=0;e<o;e++)if(0===this.frameDropped[e]){n=!1;break}}this.framerate=[],this.frameDropped=[]}else n=!1;return n}}function P(e,t,r,i){if("cpu"===e.toLocaleLowerCase())return new k(r,i);if("gpu"===e.toLocaleLowerCase())return"local"===t.toLocaleLowerCase()?new O(r,i):new N(r,i);throw Error("ProcessorBackend is not supported!")}class D{get running(){return this._running}constructor(e,t){if(c(this,"type",void 0),c(this,"interval",void 0),c(this,"fn",void 0),c(this,"_running",!1),c(this,"_osc",void 0),!e||t<=0)throw Error();this.type=e,this.interval=t}add(e){this.fn=e}remove(){this.fn=void 0}start(){if(!this._running)switch(this._running=!0,this.type){case"Timer":{let e=()=>{setTimeout(()=>{this.fn&&this.fn(),this._running&&e()},this.interval)};e();break}case"RAF":{let e=t=>{requestAnimationFrame(r=>{r-t<this.interval?this._running&&e(t):(this.fn&&this.fn(),this._running&&e(r))})};e(performance.now());break}case"Oscillator":{let t;e||(e=new AudioContext);let r=e.createGain();r.gain.value=0,r.connect(e.destination);let i=()=>{this.fn&&this.fn(),t&&t.disconnect(),t=e.createOscillator(),this._osc=t,t.connect(r),this._running&&(t.onended=i,t.start(0),t.stop(e.currentTime+this.interval/1e3))};i()}}}stop(){this._running=!1,this._osc&&(this._osc.onended=null,this._osc=void 0)}}let L=1;class M{constructor(e){c(this,"lockingPromise",u().resolve()),c(this,"locks",0),c(this,"name",""),c(this,"lockId",void 0),this.lockId=L++,e&&(this.name=e)}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1;let r=new(u())(e=>{t=()=>{this.locks-=1,e()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),i}}})(),i})(),e.exports=r()},66811:function(e,t,r){e=r.nmd(e);var i,n,o,a=r(353434).Buffer;i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:this,n=function(t,r){"use strict";var i,n,o,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y={};y.isReady=!1,y.onready=null,y.onRuntimeInitialized=function(){y.isReady=!0,y.onready&&setTimeout(y.onready,0)},t&&t.OPUS_SCRIPT_LOCATION&&(y.locateFile=function(e){var r=t.OPUS_SCRIPT_LOCATION||"";return r[e]?r[e]:(r+=r&&!/\/$/.test(r)?"/":"")+e});var R={};for(o in y)y.hasOwnProperty(o)&&(R[o]=y[o]);var I=[],C="./this.program",k=function(e,t){throw t},w=!1,O=!1,N=!1,P=!1;w="object"==typeof window,O="function"==typeof importScripts,N="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,P=!w&&!N&&!O;var D="";if(N){D=O?r("path").dirname(D)+"/":"//",s=function(e,t){var i=en(e);return i?t?i:i.toString():(!d&&(d=r("fs")),!u&&(u=r("path")),e=u.normalize(e),d.readFileSync(e,t?null:"utf8"))},c=function(e){var t=s(e,!0);return!t.buffer&&(t=new Uint8Array(t)),V(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),I=process.argv.slice(2);e.exports=y,process.on("uncaughtException",function(e){if(!(e instanceof ec))throw e}),process.on("unhandledRejection",J);y.inspect=function(){return"[Emscripten Module object]"}}else P?("undefined"!=typeof read&&(s=function(e){var t=en(e);return t?er(t):read(e)}),c=function(e){var t;return(t=en(e))?t:"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(V("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?I=scriptArgs:"undefined"!=typeof arguments&&(I=arguments),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(w||O)&&(O?D=self.location.href:"undefined"!=typeof document&&document.currentScript&&(D=document.currentScript.src),D=0!==D.indexOf("blob:")?D.substr(0,D.lastIndexOf("/")+1):"",s=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(t){var r=en(e);if(r)return er(r);throw t}},O&&(c=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}catch(t){var r=en(e);if(r)return r;throw t}}));var L=y.print||console.log.bind(console),M=y.printErr||console.warn.bind(console);for(o in R)R.hasOwnProperty(o)&&(y[o]=R[o]);R=null,y.arguments&&(I=y.arguments),y.thisProgram&&y.thisProgram,y.quit&&y.quit;var x=0;y.wasmBinary&&(l=y.wasmBinary),y.noExitRuntime;var U={Memory:function(e){this.buffer=new ArrayBuffer(65536*e.initial)},Module:function(e){},Instance:function(e,t){this.exports=function(e){for(var t,r=new Uint8Array(123),i=25;i>=0;--i)r[48+i]=52+i,r[65+i]=i,r[97+i]=26+i;function n(e,t,i){for(var n,o,a=0,s=t,c=i.length,d=t+(3*c>>2)-("="==i[c-2])-("="==i[c-1]);a<c;a+=4)n=r[i.charCodeAt(a+1)],o=r[i.charCodeAt(a+2)],e[s++]=r[i.charCodeAt(a)]<<2|n>>4,s<d&&(e[s++]=n<<4|o>>2),s<d&&(e[s++]=o<<6|r[i.charCodeAt(a+3)])}r[43]=62,r[47]=63;var o=new ArrayBuffer(16),a=new Int32Array(o),s=new Float32Array(o),c=new Float64Array(o);function d(e){return a[e]}function u(e,t){a[e]=t}function l(){return c[0]}function h(e){c[0]=e}function p(e){s[2]=e}function f(){return s[2]}return function(e){var r,i,o=e.memory.buffer,s=new Int8Array(o),d=new Int16Array(o),u=new Int32Array(o),l=new Uint8Array(o),h=new Uint16Array(o),_=new Uint32Array(o),A=new Float32Array(o),m=new Float64Array(o),v=Math.imul,E=Math.fround,g=Math.abs,S=Math.clz32,b=Math.min,T=Math.max,y=Math.floor,R=Math.sqrt,I=e.abort,C=e.emscripten_resize_heap,k=e.emscripten_memcpy_big,w=e.fd_close,O=e.fd_write,I=e.abort,N=e.setTempRet0,P=e.fd_seek,D=5282864,L=0;function M(e){e|=0;var t=0,r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,h=0,p=0,f=0;D=f=D-16|0;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{l:{h:{if(e>>>0<=244){if(a=u[9852],3&(e=a>>>(r=(n=e>>>0<11?16:e+11&-8)>>>3|0)|0)){e=(r=u[(i=(n=((-1^e)&1)+r|0)<<3)+39456>>2])+8|0,t=u[r+8>>2],i=i+39448|0;p:{if((0|t)==(0|i)){u[9852]=e4(-2,n)&a;break p}u[t+12>>2]=i,u[i+8>>2]=t}t=n<<3,u[r+4>>2]=3|t,u[(r=r+t|0)+4>>2]=1|u[r+4>>2];break t}if((d=u[9854])>>>0>=n>>>0)break h;if(e){t=e=((e=(t=e<<r)&((e=2<<r)|0-e))&0-e)-1|0,t=(r=t>>>(e=e>>>12&16)|0)>>>5&8,t=(i=e|t)|(r=(e=r>>>t|0)>>>2&4),t|=r=(e=e>>>r|0)>>>1&2,r=u[(i=(t=(t|(r=(e=e>>>r|0)>>>1&1))+(e>>>r|0)|0)<<3)+39456>>2],e=u[r+8>>2],i=i+39448|0;f:{if((0|e)==(0|i)){a=e4(-2,t)&a,u[9852]=a;break f}u[e+12>>2]=i,u[i+8>>2]=e}if(e=r+8|0,u[r+4>>2]=3|n,i=r+n|0,t=(o=t<<3)-n|0,u[i+4>>2]=1|t,u[r+o>>2]=t,d){n=((o=d>>>3|0)<<3)+39448|0,r=u[9857],o=1<<o;_:{if(!(a&o)){u[9852]=o|a,o=n;break _}o=u[n+8>>2]}u[n+8>>2]=r,u[o+12>>2]=r,u[r+12>>2]=n,u[r+8>>2]=o}u[9857]=i,u[9854]=t;break t}if(!(c=u[9853]))break h;for(t=e=(0-c&c)-1|0,t=(r=t>>>(e=e>>>12&16)|0)>>>5&8,t=(i=e|t)|(r=(e=r>>>t|0)>>>2&4),t|=r=(e=e>>>r|0)>>>1&2,i=u[((t|(r=(e=e>>>r|0)>>>1&1))+(e>>>r|0)<<2)+39712>>2],r=(-8&u[i+4>>2])-n|0,t=i;;){A:if((e=u[t+16>>2])||(e=u[t+20>>2])){o=t=(-8&u[e+4>>2])-n|0,r=(t=r>>>0>t>>>0)?o:r,i=t?e:i,t=e;continue}break}if((h=i+n|0)>>>0<=i>>>0)break l;if(p=u[i+24>>2],(0|(o=u[i+12>>2]))!=(0|i)){e=u[i+8>>2],u[e+12>>2]=o,u[o+8>>2]=e;break r}if(!(e=u[(t=i+20|0)>>2])){if(!(e=u[i+16>>2]))break u;t=i+16|0}for(;;){if(s=t,o=e,e=u[(t=e+20|0)>>2])continue;if(t=o+16|0,!(e=u[o+16>>2]))break}u[s>>2]=0;break r}if(n=-1,e>>>0>0xffffffbf)break h;if(n=-8&(e=e+11|0),!(d=u[9853]))break h;s=31,n>>>0<=0xffffff&&(t=r=(t=e=e>>>8|0)<<(e=e+1048320>>>16&8),t<<=r=r+520192>>>16&4,s=((e=((i=t)<<(t=t+245760>>>16&2)>>>15|0)-(e|r|t)|0)<<1|n>>>e+21&1)+28|0),r=0-n|0,t=u[(s<<2)+39712>>2];m:{v:{E:{if(!t){e=0;break E}for(e=0,i=n<<((0|s)==31?0:25-(s>>>1|0)|0);;){g:if(!((a=(-8&u[t+4>>2])-n|0)>>>0>=r>>>0)){if(o=t,r=a)break g;r=0,e=t;break v}if(a=u[t+20>>2],t=u[((i>>>29&4)+t|0)+16>>2],e=a?(0|a)==(0|t)?e:a:e,i<<=1,!t)break}}if(!(e|o)){if(!(e=((e=2<<s)|0-e)&d))break h;i=(t=(t=e=(0-e&e)-1|0)>>>(e=e>>>12&16)|0)>>>5&8,i=(a=e|i)|(t=(e=t>>>i|0)>>>2&4),i|=t=(e=e>>>t|0)>>>1&2,e=u[((i|(t=(e=e>>>t|0)>>>1&1))+(e>>>t|0)<<2)+39712>>2]}if(!e)break m}for(;;){if(r=(i=(a=(-8&u[e+4>>2])-n|0)>>>0<r>>>0)?a:r,o=i?e:o,!(t=u[e+16>>2])&&(t=u[e+20>>2]),!(e=t))break}}if(!o|u[9854]-n>>>0<=r>>>0)break h;if((s=n+o|0)>>>0<=o>>>0)break l;if(c=u[o+24>>2],i=u[o+12>>2],(0|o)!=(0|i)){e=u[o+8>>2],u[e+12>>2]=i,u[i+8>>2]=e;break i}if(!(e=u[(t=o+20|0)>>2])){if(!(e=u[o+16>>2]))break d;t=o+16|0}for(;;){if(a=t,i=e,e=u[(t=e+20|0)>>2])continue;if(t=i+16|0,!(e=u[i+16>>2]))break}u[a>>2]=0;break i}if(n>>>0<=(e=u[9854])>>>0){r=u[9857],t=e-n|0;S:{if(t>>>0>=16){u[9854]=t,i=r+n|0,u[9857]=i,u[i+4>>2]=1|t,u[e+r>>2]=t,u[r+4>>2]=3|n;break S}u[9857]=0,u[9854]=0,u[r+4>>2]=3|e,u[(e=e+r|0)+4>>2]=1|u[e+4>>2]}e=r+8|0;break t}if(n>>>0<(i=u[9855])>>>0){r=i-n|0,u[9855]=r,t=n+(e=u[9858])|0,u[9858]=t,u[t+4>>2]=1|r,u[e+4>>2]=3|n,e=e+8|0;break t}if(e=0,t=d=n+47|0,u[9970]?r=u[9972]:(u[9973]=-1,u[9974]=-1,u[9971]=4096,u[9972]=4096,u[9970]=f+12&-16^0x55555558,u[9975]=0,u[9963]=0,r=4096),(o=(a=t+r|0)&(s=0-r|0))>>>0<=n>>>0||(r=u[9962])&&r>>>0<(c=o+(t=u[9960])|0)>>>0|t>>>0>=c>>>0)break t;if(4&l[39852])break a;b:{T:{if(r=u[9858])for(e=39856;;){if(t=u[e>>2],u[e+4>>2]+t>>>0>r>>>0?t>>>0<=r>>>0:0)break T;if(!(e=u[e+8>>2]))break}if((0|(i=eY(0)))==-1)break s;if(a=o,i&(r=(e=u[9971])-1|0)&&(a=(o-i|0)+(r+i&0-e)|0),a>>>0>0x7ffffffe|n>>>0>=a>>>0||(e=u[9962])&&e>>>0<(t=a+(r=u[9960])|0)>>>0|r>>>0>=t>>>0)break s;if((0|i)!=(0|(e=eY(a))))break b;break o}if((a=a-i&s)>>>0>0x7ffffffe)break s;if((0|(i=eY(a)))==(u[e>>2]+u[e+4>>2]|0))break c;e=i}if(!((0|e)==-1|n+48>>>0<=a>>>0)){if((r=(r=u[9972])+(d-a|0)&0-r)>>>0>0x7ffffffe){i=e;break o}if((0|eY(r))!=-1){a=r+a|0,i=e;break o}eY(0-a|0);break s}if(i=e,(0|e)!=-1)break o;break s}I()}o=0;break r}i=0;break i}if((0|i)!=-1)break o}u[9963]=4|u[9963]}if(o>>>0>0x7ffffffe)break n;if(t=(0|(i=eY(o)))==-1,t|i>>>0>=(e=eY(0))>>>0|(0|e)==-1||(a=e-i|0)>>>0<=n+40>>>0)break n}e=u[9960]+a|0,u[9960]=e,_[9961]<e>>>0&&(u[9961]=e);y:{R:{I:{if(r=u[9858]){for(e=39856;;){if(t=u[e>>2],(t+(o=u[e+4>>2])|0)==(0|i))break I;if(!(e=u[e+8>>2]))break}break R}for(!((e=u[9856])>>>0<=i>>>0?e:0)&&(u[9856]=i),e=0,u[9965]=a,u[9964]=i,u[9860]=-1,u[9861]=u[9970],u[9967]=0;;){if(t=(r=e<<3)+39448|0,u[r+39456>>2]=t,u[r+39460>>2]=t,(0|(e=e+1|0))==32)break}t=(e=a-40|0)-(r=i+8&7?-8-i&7:0)|0,u[9855]=t,r=r+i|0,u[9858]=r,u[r+4>>2]=1|t,u[(e+i|0)+4>>2]=40,u[9859]=u[9974];break y}if(8&u[e+12>>2]|(r>>>0<t>>>0|r>>>0>=i>>>0))break R;u[e+4>>2]=o+a,e=r+8&7?-8-r&7:0,t=r+e|0,u[9858]=t,e=(i=u[9855]+a|0)-e|0,u[9855]=e,u[t+4>>2]=1|e,u[(r+i|0)+4>>2]=40,u[9859]=u[9974];break y}(o=u[9856])>>>0>i>>>0&&(u[9856]=i),t=i+a|0,e=39856;C:{k:{w:{O:{N:{P:{for(;;){if(u[e>>2]!=(0|t)){if(e=u[e+8>>2])continue;break P}break}if(!(8&l[e+12|0]))break N}for(e=39856;;){if((t=u[e>>2])>>>0<=r>>>0&&(t=u[e+4>>2]+t|0)>>>0>r>>>0)break O;e=u[e+8>>2]}}if(u[e>>2]=i,u[e+4>>2]=u[e+4>>2]+a,u[(s=(i+8&7?-8-i&7:0)+i|0)+4>>2]=3|n,t=((a=(t+8&7?-8-t&7:0)+t|0)-s|0)-n|0,n=n+s|0,(0|r)==(0|a)){u[9858]=n,e=u[9855]+t|0,u[9855]=e,u[n+4>>2]=1|e;break k}if(u[9857]==(0|a)){u[9857]=n,e=u[9854]+t|0,u[9854]=e,u[n+4>>2]=1|e,u[e+n>>2]=e;break k}if((3&(e=u[a+4>>2]))==1){d=-8&e;D:{if(e>>>0<=255){if(e=((c=e>>>3|0)<<3)+39448|0,i=u[a+8>>2],(0|i)==(0|(r=u[a+12>>2]))){u[9852]=u[9852]&e4(-2,c);break D}u[i+12>>2]=r,u[r+8>>2]=i;break D}c=u[a+24>>2],i=u[a+12>>2];L:{if((0|a)!=(0|i)){e=u[a+8>>2],u[e+12>>2]=i,u[i+8>>2]=e;break L}M:if(!(r=u[(e=a+20|0)>>2])&&!(r=u[(e=a+16|0)>>2])){i=0;break L}for(;;){if(o=e,i=r,r=u[(e=r+20|0)>>2])continue;if(e=i+16|0,!(r=u[i+16>>2]))break}u[o>>2]=0}if(!c)break D;e=((r=u[a+28>>2])<<2)+39712|0;x:{if(u[e>>2]==(0|a)){if(u[e>>2]=i,i)break x;u[9853]=u[9853]&e4(-2,r);break D}if(u[(u[c+16>>2]==(0|a)?16:20)+c>>2]=i,!i)break D}if(u[i+24>>2]=c,(e=u[a+16>>2])&&(u[i+16>>2]=e,u[e+24>>2]=i),!(e=u[a+20>>2]))break D;u[i+20>>2]=e,u[e+24>>2]=i}a=a+d|0,t=t+d|0}if(u[a+4>>2]=-2&u[a+4>>2],u[n+4>>2]=1|t,u[t+n>>2]=t,t>>>0<=255){e=((r=t>>>3|0)<<3)+39448|0,r=1<<r,t=u[9852];U:{if(!(r&t)){u[9852]=r|t,r=e;break U}r=u[e+8>>2]}u[e+8>>2]=n,u[r+12>>2]=n,u[n+12>>2]=e,u[n+8>>2]=r;break k}e=31,t>>>0<=0xffffff&&(i=e=t>>>8|0,i=r=i<<(e=e+1048320>>>16&8),i<<=r=r+520192>>>16&4,e=((e=((o=i)<<(i=i+245760>>>16&2)>>>15|0)-(e|r|i)|0)<<1|t>>>e+21&1)+28|0),u[n+28>>2]=e,u[n+16>>2]=0,u[n+20>>2]=0,r=(e<<2)+39712|0,i=u[9853],o=1<<e;B:{if(!(i&o)){u[9853]=i|o,u[r>>2]=n;break B}for(e=t<<((0|e)==31?0:25-(e>>>1|0)|0),i=u[r>>2];;){if((-8&u[(r=i)+4>>2])==(0|t))break w;if(i=e>>>29|0,e<<=1,!(i=u[(o=(a=(4&i)+r|0)+16|0)>>2]))break}u[a+16>>2]=n}u[n+24>>2]=r,u[n+12>>2]=n,u[n+8>>2]=n;break k}for(s=(e=a-40|0)-(o=i+8&7?-8-i&7:0)|0,u[9855]=s,o=i+o|0,u[9858]=o,u[o+4>>2]=1|s,u[(e+i|0)+4>>2]=40,u[9859]=u[9974],u[(o=r+16>>>0>(e=((t-39&7?39-t&7:0)+t|0)-47|0)>>>0?r:e)+4>>2]=27,e=u[9967],s=u[9966],u[o+16>>2]=s,u[o+20>>2]=e,s=u[9965],e=u[9964],u[o+8>>2]=e,u[o+12>>2]=s,u[9966]=o+8,u[9965]=a,u[9964]=i,u[9967]=0,e=o+24|0;;){if(u[e+4>>2]=7,i=e+8|0,e=e+4|0,!(t>>>0>i>>>0))break}if((0|r)==(0|o))break y;if(u[o+4>>2]=-2&u[o+4>>2],a=o-r|0,u[r+4>>2]=1|a,u[o>>2]=a,a>>>0<=255){e=((t=a>>>3|0)<<3)+39448|0,t=1<<t,i=u[9852];V:{if(!(t&i)){u[9852]=t|i,t=e;break V}t=u[e+8>>2]}u[e+8>>2]=r,u[t+12>>2]=r,u[r+12>>2]=e,u[r+8>>2]=t;break y}e=31,u[r+16>>2]=0,u[r+20>>2]=0,a>>>0<=0xffffff&&(t=e=a>>>8|0,t<<=e=e+1048320>>>16&8,o=i=t<<(t=t+520192>>>16&4),e=((e=(o<<(i=i+245760>>>16&2)>>>15|0)-(e|t|i)|0)<<1|a>>>e+21&1)+28|0),u[r+28>>2]=e,t=(e<<2)+39712|0,i=u[9853],o=1<<e;F:{if(!(i&o)){u[9853]=i|o,u[t>>2]=r;break F}for(e=a<<((0|e)==31?0:25-(e>>>1|0)|0),i=u[t>>2];;){if((-8&u[(t=i)+4>>2])==(0|a))break C;if(i=e>>>29|0,e<<=1,!(i=u[(o=(s=(4&i)+t|0)+16|0)>>2]))break}u[s+16>>2]=r}u[r+24>>2]=t,u[r+12>>2]=r,u[r+8>>2]=r;break y}e=u[r+8>>2],u[e+12>>2]=n,u[r+8>>2]=n,u[n+24>>2]=0,u[n+12>>2]=r,u[n+8>>2]=e}e=s+8|0;break t}e=u[t+8>>2],u[e+12>>2]=r,u[t+8>>2]=r,u[r+24>>2]=0,u[r+12>>2]=t,u[r+8>>2]=e}if(n>>>0>=(e=u[9855])>>>0)break n;r=e-n|0,u[9855]=r,t=n+(e=u[9858])|0,u[9858]=t,u[t+4>>2]=1|r,u[e+4>>2]=3|n,e=e+8|0;break t}u[ti()>>2]=48,e=0;break t}j:if(c){e=((t=u[o+28>>2])<<2)+39712|0;G:{if(u[e>>2]==(0|o)){if(u[e>>2]=i,i)break G;d=e4(-2,t)&d,u[9853]=d;break j}if(u[(u[c+16>>2]==(0|o)?16:20)+c>>2]=i,!i)break j}if(u[i+24>>2]=c,(e=u[o+16>>2])&&(u[i+16>>2]=e,u[e+24>>2]=i),!(e=u[o+20>>2]))break j;u[i+20>>2]=e,u[e+24>>2]=i}W:{if(r>>>0<=15){e=r+n|0,u[o+4>>2]=3|e,u[(e=e+o|0)+4>>2]=1|u[e+4>>2];break W}if(u[o+4>>2]=3|n,u[s+4>>2]=1|r,u[r+s>>2]=r,r>>>0<=255){e=((r=r>>>3|0)<<3)+39448|0,r=1<<r,t=u[9852];H:{if(!(r&t)){u[9852]=r|t,r=e;break H}r=u[e+8>>2]}u[e+8>>2]=s,u[r+12>>2]=s,u[s+12>>2]=e,u[s+8>>2]=r;break W}e=31,r>>>0<=0xffffff&&(t=e=r>>>8|0,t<<=e=e+1048320>>>16&8,i=n=(i=t)<<(t=t+520192>>>16&4),e=((e=(i<<(n=n+245760>>>16&2)>>>15|0)-(e|t|n)|0)<<1|r>>>e+21&1)+28|0),u[s+28>>2]=e,u[s+16>>2]=0,u[s+20>>2]=0,t=(e<<2)+39712|0;Y:{n=1<<e;K:{if(!(d&n)){u[9853]=n|d,u[t>>2]=s;break K}for(e=r<<((0|e)==31?0:25-(e>>>1|0)|0),n=u[t>>2];;){if((-8&u[(t=n)+4>>2])==(0|r))break Y;if(n=e>>>29|0,e<<=1,!(n=u[(i=(a=(4&n)+t|0)+16|0)>>2]))break}u[a+16>>2]=s}u[s+24>>2]=t,u[s+12>>2]=s,u[s+8>>2]=s;break W}e=u[t+8>>2],u[e+12>>2]=s,u[t+8>>2]=s,u[s+24>>2]=0,u[s+12>>2]=t,u[s+8>>2]=e}e=o+8|0;break t}Q:if(p){e=((t=u[i+28>>2])<<2)+39712|0;z:{if(u[e>>2]==(0|i)){if(u[e>>2]=o,o)break z;u[9853]=e4(-2,t)&c;break Q}if(u[(u[p+16>>2]==(0|i)?16:20)+p>>2]=o,!o)break Q}if(u[o+24>>2]=p,(e=u[i+16>>2])&&(u[o+16>>2]=e,u[e+24>>2]=o),!(e=u[i+20>>2]))break Q;u[o+20>>2]=e,u[e+24>>2]=o}X:{if(r>>>0<=15){e=r+n|0,u[i+4>>2]=3|e,u[(e=e+i|0)+4>>2]=1|u[e+4>>2];break X}if(u[i+4>>2]=3|n,u[h+4>>2]=1|r,u[r+h>>2]=r,d){t=((n=d>>>3|0)<<3)+39448|0,e=u[9857],n=1<<n;J:{if(!(a&n)){u[9852]=n|a,n=t;break J}n=u[t+8>>2]}u[t+8>>2]=e,u[n+12>>2]=e,u[e+12>>2]=t,u[e+8>>2]=n}u[9857]=h,u[9854]=r}e=i+8|0}return D=f+16|0,0|e}function x(e,t,r,i,n,o){var a=0,c=0,l=0,p=0,f=E(0),_=0,m=0,g=0,b=0,T=0,y=0,R=0,C=0,k=0,w=0,O=0,N=0,P=0,L=0,M=0,U=0,B=0,F=0,j=0;D=c=D-192|0,u[(l=c)+136>>2]=0,a=-2;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{l:{_=(b=(0|(O=u[e+12>>2]))/50|0)>>3;h:if(!((0|_)>(0|n))){F=u[e>>2],g=u[e+4>>2],R=b>>2,p=b>>1,a=(0|n)<(0|(a=v((0|O)/25|0,3)))?n:a;q:{Z:{p:{$:{ee:{f:{et:{er:{if((0|r)<=1){a=(0|(n=u[e+64>>2]))>(0|a)?a:n;break er}if(t)break et}if(!(y=u[e+60>>2])){if((0|(n=v(u[e+8>>2],a)))<1)break h;eE(i,0,n<<2);break h}if((0|a)>(0|b)){for(n=a;;){if((0|(_=x(e,0,0,i,(0|n)<(0|b)?n:b,0)))<0){a=_;break h}if(i=(v(u[e+8>>2],_)<<2)+i|0,!((0|(n=n-_|0))>0))break}break h}if((0|a)>=(0|b)){m=a;break f}if((0|a)>(0|p)){m=p;break f}if((0|y)==1e3){m=a,y=1e3;break f}m=(0|a)>(0|R)&&(0|a)<(0|p)?R:a;break f}if(k=u[e+52>>2],y=u[e+56>>2],m=u[e+64>>2],eR(l+144|0,t,r),L=1,(0|(n=u[e+60>>2]))<1)break ee;if(!(u[e+68>>2]?0:!((0|n)==1002|(0|y)!=1002))){if((0|y)==1002){y=1002;break ee}if((0|n)!=1002)break ee}if(B=1,M=v(u[e+8>>2],R),D=c=N=c-((((0|y)==1002?M:1)<<2)+15&-16)|0,(0|y)==1002){x(e,0,0,N,(0|m)>(0|R)?R:m,0),y=1002,n=1;break $}if(n=(0|a)<(0|m),N=0,a=-1,!n)break p;break q}t=0}n=(0|y)==1002}if(T=n,n=(0|a)<(0|m),a=-1,n)break q;if(P=1,a=1,n=M=1,T)break Z}P=M,a=v(u[e+8>>2],(0|p)>(0|m)?p:m),n=0}M=n,w=C=c-(((n=a)<<1)+15&-16)|0,D=C;E:{if((0|y)==1002){U=!o,L=0,p=0,a=0,o=0,T=0;break E}g=e+g|0,1002==u[e+60>>2]&&e$(g),n=(0|v(m,1e3))/u[e+12>>2]|0,u[e+32>>2]=(0|n)>10?n:10;g:if(L){if(u[e+20>>2]=u[e+48>>2],(0|y)==1e3){switch(k-1101|0){case 0:u[e+28>>2]=8e3;break g;case 1:u[e+28>>2]=12e3;break g;default:break}if(u[e+28>>2]=16e3,(0|k)==1103)break g;e0(36419,35333,389),I()}u[e+28>>2]=16e3}for(T=e+16|0,p=t?o<<1:1,a=0,n=C;;){ei:if(function(e,t,r,i,n,o,a,c){var l=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,S=0,b=0,T=0,y=0,R=0,C=0,k=0;D=E=D-656|0,u[(f=E)+652>>2]=0,u[f+640>>2]=0,u[f+644>>2]=0;t:{r:{i:{n:{o:{if((l=u[t+4>>2])-1>>>0<2){if(i)for(;;){if(u[(v(p,4264)+e|0)+2388>>2]=0,(0|(p=p+1|0))==(0|l))break}u[e+8544>>2]<(0|l)&&(g=e1(e+4264|0),l=u[t+4>>2]),!((0|l)!=1|2!=u[e+8544>>2])&&(C=u[t+12>>2]==(0|v(u[e+2316>>2],1e3)));l:{if(!(u[e+2388>>2]|(0|l)<1))for(p=0;;){i=2,_=1;Z:{p:{$:{ee:{switch(0|(l=u[t+16>>2])){case 0:case 10:break Z;case 20:break $;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:break ee;default:break}if((0|l)==40)break p;if((0|l)!=60)break ee;i=4,_=3;break Z}e0(9390,9375,146),I()}i=4;break Z}i=4,_=2}if(u[(l=v(p,4264)+e|0)+2324>>2]=i,u[l+2392>>2]=_,(i=u[t+12>>2]>>10)>>>0>15|!(1<<i&34944))break l;if(g=function(e,t,r){var i=0,n=0,o=0;if(!(!(1<<t&69888)|t>>>0>16)){r:{switch((i=u[e+2324>>2])-2|0){case 0:case 2:break r;default:break}e0(6851,6829,44),I()}u[e+2332>>2]=v(t,5),i=v(v(t,327680)>>16,i);n:{o:if((u[e+2320>>2]==(0|r)?u[e+2316>>2]==(0|t):0)||(n=function(e,t,r,i){var n=0,o=0,a=0;t:{r:{e=n=eE(e,0,300);i:{if(i){o:{if((0|t)<=15999){if((0|t)==8e3|(0|t)==12e3)break o;break t}if((0|t)==16e3|(0|t)==48e3)break o;if((0|t)!=24e3)break t}if((0|r)!=16e3?!((0|r)==8e3|(0|r)==12e3):0)break t;i=(v((t>>>12|0)-((0|t)>16e3)>>((0|t)>24e3),3)+(r>>>12|0)|0)+2791|0;break i}if((0|t)!=12e3?!((0|t)==8e3|(0|t)==16e3):0)break r;d:{if((0|r)<=15999){if((0|r)==8e3|(0|r)==12e3)break d;break r}if((0|r)==16e3|(0|r)==24e3)break d;if((0|r)!=48e3)break r}i=(v(t>>>12|0,5)+((r>>>12|0)-((0|r)>16e3)>>((0|r)>24e3))|0)+2804|0}u[e+292>>2]=s[0|i],u[n+288>>2]=((65535&r)>>>0)/1e3,i=((65535&t)>>>0)/1e3|0,u[n+284>>2]=i,u[n+268>>2]=v(i,10);l:{if((0|t)<(0|r)){if(o=1,t<<1==(0|r)){u[n+264>>2]=1,o=0;break l}u[n+264>>2]=2;break l}if((0|t)>(0|r)){if(u[n+264>>2]=3,(0|(i=r<<2))==(0|v(t,3))){u[n+296>>2]=2320,u[n+276>>2]=18,u[n+280>>2]=3;break l}if((0|(e=v(r,3)))==t<<1){u[n+296>>2]=2384,u[n+276>>2]=18,u[n+280>>2]=2;break l}if(r<<1==(0|t)){u[n+296>>2]=2432,u[n+276>>2]=24,u[n+280>>2]=1;break l}if((0|e)==(0|t)){u[n+296>>2]=2464,u[n+276>>2]=36,u[n+280>>2]=1;break l}if((0|t)==(0|i)){u[n+296>>2]=2512,u[n+276>>2]=36,u[n+280>>2]=1;break l}if((0|v(r,6))==(0|t)){u[n+296>>2]=2560,u[n+276>>2]=36,u[n+280>>2]=1;break l}e0(2758,2778,154),I()}u[n+264>>2]=0}for(e=t<<o,i=r<<16>>16,a=(r>>>15|0)+1>>>1|0,t=(t<<(14|o))/(0|r)<<2;;){if(t=(r=t)+1|0,!(((v(r>>16,i)+v(r,a)|0)+(v(65535&r,i)>>16)|0)<(0|e)))break}return u[n+272>>2]=r,0}e0(2758,2778,101),I()}e0(2758,2778,94),I()}(e+2432|0,v(t,1e3),r,0),u[e+2320>>2]=r,u[e+2316>>2]==(0|t))){if(o=1,u[e+2328>>2]==(0|i))break n}if(r=4==u[e+2324>>2],u[e+2384>>2]=(0|t)==8?r?3026:3049:r?2992:3037,!o){u[e+2336>>2]=v(t,20),r=(-5&t)==8,u[e+2732>>2]=r?4456:6580,u[e+2340>>2]=r?10:16,r=6752;d:{switch(t-12|0){default:if(r=6737,(0|t)==8)break d;e0(6938,6829,89),I();case 0:break;case 4:break d}r=6746}u[e+2376>>2]=1,u[e+2380>>2]=r,u[e+4164>>2]=0,s[e+2312|0]=10,u[e+2308>>2]=100,eE(e+1284|0,0,1024)}u[e+2328>>2]=i,u[e+2316>>2]=t}return n}e0(6767,6829,43),I()}(l,i+1|0,u[t+8>>2])+g|0,l=u[t+4>>2],!((0|l)>(0|(p=p+1|0))))break}p=2,i=u[t>>2];et:{if((0|i)!=2){p=i;break et}if((0|l)!=2||1!=u[e+8540>>2]&&(l=2,1!=u[e+8544>>2]))break et;u[e+8536>>2]=0,u[e+8528>>2]=0,ed(e+6696|0,e+2432|0,300),l=u[t+4>>2],p=u[t>>2]}if(u[e+8544>>2]=l,u[e+8540>>2]=p,i=-200,u[t+8>>2]-8e3>>>0>4e4)break t;en:if(!(u[e+2388>>2]|(0|r)==1)){eo:if(!((0|l)<1)){for(;;){if(i=u[(_=v(m,4264)+e|0)+2392>>2],l=0,p=eN(n,1),(0|i)>0)for(A=_+2392|0;;){if(u[((l<<2)+_|0)+2404>>2]=p,i=u[A>>2],p=eN(n,1),!((0|(l=l+1|0))<(0|i)))break}if(u[_+2416>>2]=p,l=u[t+4>>2],!((0|l)>(0|(m=m+1|0))))break}if(A=0,(0|l)<=0)break eo;for(;;){u[(p=v(A,4264)+e|0)+2420>>2]=0,u[p+2424>>2]=0,u[p+2428>>2]=0;ea:if(u[p+2416>>2]){if((0|(l=u[p+2392>>2]))==1){u[p+2420>>2]=1;break ea}if(l=eO(n,u[(l<<2)+6688>>2],8),(0|(i=u[p+2392>>2]))<1)break ea;for(_=l+1|0,l=0;;){if(u[((l<<2)+p|0)+2420>>2]=_>>>l&1,(0|(l=l+1|0))==(0|i))break}}if(l=u[t+4>>2],!((0|l)>(0|(A=A+1|0))))break}}if(u[e+2392>>2]<1|r)break en;for(b=e+6684|0,_=0;;){if((0|l)>=1)for(m=_-1|0,S=b+(A=_<<2)|0,i=0;;){if(u[(A+(p=v(i,4264)+e|0)|0)+2420>>2]){es:if(!((0|l)!=2|i)){if(eM(n,f+640|0),u[S>>2])break es;e9(n,f+652|0)}T=p,y=n,R=_;g:if(!_||(l=2,!u[((m<<2)+p|0)+2420>>2])){l=0}et(T,y,R,1,l),ec(n,f,s[p+2765|0],s[p+2766|0],u[p+2328>>2]),l=u[t+4>>2]}if(!((0|l)>(0|(i=i+1|0))))break}if(!((0|(_=_+1|0))<u[e+2392>>2]))break}}if((0|l)!=2)break r;switch(0|r){case 0:if(eM(n,f+640|0),!u[((u[e+2388>>2]<<2)+e|0)+6668>>2])break n;break i;case 2:if(1==u[((u[e+2388>>2]<<2)+e|0)+2420>>2])break o;break;default:break}u[f+640>>2]=d[e+8528>>1],u[f+644>>2]=d[e+8530>>1];break r}e0(9390,9375,152),I()}e0(9284,9375,107),I()}if(eM(n,f+640|0),u[((u[e+2388>>2]<<2)+e|0)+6684>>2])break i}e9(n,f+652|0);break r}u[f+652>>2]=0}l=u[t+4>>2];ec:if(!(u[f+652>>2]|(0|l)!=2)){if(l=2,1!=u[e+8548>>2])break ec;eE(e+5548|0,0,1024),u[e+8428>>2]=0,s[e+6576|0]=10,u[e+6572>>2]=100,u[e+6640>>2]=1,l=u[t+4>>2]}_=1,i=f,m=(0|v(u[t+12>>2],l))>=(0|v(u[t>>2],u[t+8>>2]));ei:{if(!m){u[f>>2]=o,p=o,l=e+2328|0;break ei}E=p=E-((v(u[e+2328>>2]+2|0,l)<<1)+15&-16)|0,D=p,u[f>>2]=p,l=e+2328|0}A=((u[l>>2]<<1)+p|0)+4|0,u[i+4>>2]=A;ed:{S:{if(!r){_=!u[f+652>>2];break S}if(!u[e+8548>>2])break S;if(_=0,(0|r)!=2|(0|(l=u[t+4>>2]))!=2)break ed;_=1==u[((u[e+6652>>2]<<2)+e|0)+6684>>2]}l=u[t+4>>2]}eu:{el:if(!((0|l)<1)){if(i=((0|(l=u[e+2388>>2]))>0)<<1,i=(0|r)!=2|(0|l)<1?i:(0!=u[((l<<2)+e|0)+2416>>2])<<1,i=el(e,n,u[f>>2]+4|0,f+648|0,r,i,c),l=1,u[e+2388>>2]=u[e+2388>>2]+1,g=i+g|0,(0|(i=u[t+4>>2]))>=2)for(;;){T:{if(_){R=v(l,4264)+e|0,T=n,b=u[(l<<2)+f>>2]+4|0,k=f+648|0,y=r,i=u[e+2388>>2]-l|0,S=0;eh:if(!((0|i)<1)){if(S=(0!=u[((v(l,4264)+e|0)+(i<<2)|0)+2416>>2])<<1,(0|r)==2)break eh;S=u[e+8548>>2]?1:2}g=el(R,T,b,k,y,i=S,c)+g|0;break T}eE(u[(l<<2)+f>>2]+4|0,0,u[f+648>>2]<<1)}if(u[(i=v(l,4264)+e|0)+2388>>2]=u[i+2388>>2]+1,i=u[t+4>>2],!((0|i)>(0|(l=l+1|0))))break}if((0|i)!=2|2!=u[t>>2])break el;(function(e,t,r,i,n,o){var a=0,s=0,c=0,l=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,S=0;if(a=h[e+4>>1]|h[e+6>>1]<<16,d[t>>1]=a,d[t+2>>1]=a>>>16,a=h[e+8>>1]|h[e+10>>1]<<16,d[r>>1]=a,d[r+2>>1]=a>>>16,a=h[(a=(l=o<<1)+t|0)>>1]|h[a+2>>1]<<16,d[e+4>>1]=a,d[e+6>>1]=a>>>16,a=h[(a=r+l|0)>>1]|h[a+2>>1]<<16,d[e+8>>1]=a,d[e+10>>1]=a>>>16,s=65536/(0|(l=n<<3))|0,f=u[i+4>>2],_=u[i>>2],(0|n)>=1)for(A=(v(i=s<<16>>16,f-(c=d[e+2>>1])<<16>>16)>>15)+1>>1,m=(v(_-(p=d[e>>1])<<16>>16,i)>>15)+1>>1,E=(0|l)>1?l:1,i=0;;){if(g=a=(s=(n=i+1|0)<<1)+r|0,S=d[a>>1]<<8,a=(c=c+A|0)<<16>>16,a=(S+v(a,(s=d[t+s>>1])>>5)|0)+(v(s<<11&63488,a)>>16)|0,i=(d[(i=(i<<1)+t|0)+4>>1]+d[i>>1]|0)+(s<<1)|0,s=((i=(v(s=(p=p+m|0)<<16>>16,i>>7)+a|0)+(v(i<<9&65024,s)>>16)|0)>>7)+1>>1,d[g>>1]=(0|i)>8388479?32767:(0|s)>-32768?s:-32768,(0|E)==(0|(i=n)))break}if((0|o)>(0|l))for(n=f<<16>>16,s=_<<16>>16;;){if(c=l<<1,p=(i=(l=l+1|0)<<1)+r|0,a=(v((i=d[t+i>>1])>>5,n)+(d[p>>1]<<8)|0)+(v(i<<11&63488,n)>>16)|0,c=((i=(a+v((i=(d[(c=t+c|0)+4>>1]+d[c>>1]|0)+(i<<1)|0)>>7,s)|0)+(v(i<<9&65024,s)>>16)|0)>>7)+1>>1,d[p>>1]=(0|i)>8388479?32767:(0|c)>-32768?c:-32768,(0|o)==(0|l))break}if(d[e+2>>1]=f,d[e>>1]=_,(0|o)>=1)for(l=0;;){if(e=n=(i=(l=l+1|0)<<1)+t|0,n=d[n>>1],c=(0|(c=n+(s=d[(i=r+i|0)>>1])|0))<32767?c:32767,d[e>>1]=(0|c)>-32768?c:-32768,n=(0|(n=n-s|0))<32767?n:32767,d[i>>1]=(0|n)>-32768?n:-32768,(0|o)==(0|l))break}})(e+8528|0,p=u[f>>2],A,f+640|0,u[e+2316>>2],u[f+648>>2]),_=u[f+648>>2];break eu}i=u[e+8532>>2],d[p>>1]=i,d[p+2>>1]=i>>>16,i=((_=u[f+648>>2])<<1)+p|0,u[e+8532>>2]=h[i>>1]|h[i+2>>1]<<16}l=(0|v(u[t+8>>2],_))/(0|v(d[e+2316>>1],1e3))|0,u[a>>2]=l,c=n=E-((((i=(0|(A=u[t>>2]))==2)?l:1)<<1)+15&-16)|0,D=n,l=u[t+4>>2],!m&&(D=p=c-((E=v((m=u[e+2328>>2])+2|0,l)<<1)+15&-16)|0,c=ed(p,o,E),u[f+4>>2]=(c+(m<<1)|0)+4,u[f>>2]=c),n=i?n:o;ep:if(!((((0|l)>(0|A)?A:l)|0)<1)){for(i=0;;){m=eb((v(i,4264)+e|0)+2432|0,n,p+2|0,_),A=u[t>>2];ef:if((0|A)==2){if(l=0,(0|(_=u[a>>2]))<1)break ef;for(;;){if(d[((p=l<<1)+i<<1)+o>>1]=h[n+p>>1],(0|_)==(0|(l=l+1|0)))break}}if(g=g+m|0,(0|(i=i+1|0))>=(((0|(l=u[t+4>>2]))>(0|A)?A:l)|0))break ep;p=u[(i<<2)+f>>2],_=u[f+648>>2]}}e_:{y:{R:if(!((0|A)!=2|(0|l)!=1)){if(C)break y;if(l=0,(0|(i=u[a>>2]))<=0)break R;for(;;){if(d[(2|(p=l<<2))+o>>1]=h[o+p>>1],(0|(l=l+1|0))==(0|i))break}}i=g;break e_}if(i=eb(e+6696|0,n,u[f>>2]+2|0,u[f+648>>2])+g|0,(0|(p=u[a>>2]))<1)break e_;for(l=0;;){if(d[(l<<2|2)+o>>1]=h[(l<<1)+n>>1],(0|p)==(0|(l=l+1|0)))break}}l=0,l=2==u[e+4164>>2]?v(u[(u[e+2316>>2]-8&-4)+9412>>2],u[e+2308>>2]):l,u[t+20>>2]=l;eA:{if((0|r)==1){if((0|(p=u[e+8544>>2]))<1)break eA;for(l=0;;){if(s[(v(l,4264)+e|0)+2312|0]=10,(0|p)==(0|(l=l+1|0)))break}break eA}u[e+8548>>2]=u[f+652>>2]}}return D=f+656|0,i}(g,T,p,!a,l+144|0,n,l+140|0,u[e+44>>2])){if(!p){a=-3;break q}if(u[l+140>>2]=m,(0|(c=v(u[e+8>>2],m)))<1)break ei;eE(n,0,c<<1)}if(n=(v(c=u[l+140>>2],u[e+8>>2])<<1)+n|0,!((0|m)>(0|(a=a+c|0))))break}U=!o;ed:{S:{if(!(U&L)){o=0;break S}o=0;eu:if(!((((u[l+164>>2]+S(u[l+172>>2])|0)+(1001==u[e+56>>2]?20:0)|0)-15|0)>r<<3)){el:{if((0|y)==1001){if(!(p=eN(l+144|0,12)))break eu;a=eN(l+144|0,1),n=er(l+144|0,256)+2|0,c=S(u[l+172>>2]),g=u[l+164>>2];break el}p=1,a=eN(l+144|0,1),c=S(u[l+172>>2]),n=r-((c+(g=u[l+164>>2])|0)-25>>3)|0}o=(c=((c+g|0)-32|0)>(T=r-n|0)<<3)?0:n,u[l+148>>2]=u[l+148>>2]-o,r=c?0:T,U=1,p=c?0:p;break ed}U=1}a=0,p=0}if(L=(0|p)!=0,w=n=w-(((p?1:P)<<2)+15&-16)|0,D=n,T=17,!(B=!p&B)|(0|y)==1002)break E;x(e,0,0,n,(0|m)>(0|R)?R:m,0),N=n}c=e+F|0,n=13;em:{b:{T:{switch(k-1101|0){case 3:n=19;break T;case 4:n=21;break T;case 0:break T;case 1:case 2:break;default:break b}n=17}if(u[l+128>>2]=n,!Z(c,10012,l+128|0))break em;e0(36439,35333,491),I()}if(k)break t}if(u[l+112>>2]=u[e+48>>2],Z(c,10008,l+112|0))break l;ev:{if(!L){P=0,k=(0|a)!=0,D=g=w-16|0;break ev}if(D=g=w-((v(u[e+8>>2],R)<<2)+15&-16)|0,!a){P=0,k=0;break ev}if(u[l+96>>2]=0,Z(c,10010,l+96|0))break u;if(V(c,t+r|0,o,g,R,0,0),u[l+80>>2]=l+136,P=1,k=1,Z(c,4031,l+80|0))break d}if(u[l+64>>2]=T,Z(c,10010,l- -64|0))break c;ef:{if((0|y)!=1e3){if(n=u[e+60>>2],!(u[e+68>>2]|((0|y)==(0|n)|(0|n)<1))&&Z(c,4028,0))break s;w=V(c,U?t:0,r,i,(0|m)>(0|b)?b:m,l+144|0,0);break ef}if(d[l+132>>1]=65535,(0|(n=v(u[e+8>>2],m)))>=1&&eE(i,0,n<<2),!(1001!=u[e+60>>2]|(u[e+68>>2]?P:0))){if(u[l+48>>2]=0,Z(c,10010,l+48|0))break a;V(c,l+132|0,2,i,_,0,0)}w=0}eE:if(!(M||(0|(a=v(u[e+8>>2],m)))<1)){for(n=0;;){if(A[(b=(n<<2)+i|0)>>2]=A[b>>2]+E(E(d[(n<<1)+C>>1])*E(30517578125e-15)),(0|a)==(0|(n=n+1|0)))break}}if(u[l+32>>2]=l+132,Z(c,10015,l+32|0))break o;b=u[u[l+132>>2]+60>>2];eA:if(!(!p|k)){if(Z(c,4028,0))break n;if(u[l+16>>2]=0,Z(c,10010,l+16|0))break i;if(V(c,t+r|0,o,g,R,0,0),u[l>>2]=l+136,Z(c,4031,l))break r;if(T=48e3/u[e+12>>2]|0,(0|(t=u[e+8>>2]))<1)break eA;for(C=(v(t,_)<<2)+g|0,o=(v(m-_|0,t)<<2)+i|0,p=0,F=(0|O)<400;;){if(n=0,!F)for(;;){if(c=(a=v(t,n)+p<<2)+o|0,f=E((f=A[(v(n,T)<<2)+b>>2])*f),A[c>>2]=E(f*A[a+C>>2])+E(E(E(1)-f)*A[c>>2]),(0|_)==(0|(n=n+1|0)))break}if((0|(p=p+1|0))==(0|t))break}}k:if(P&&!((0|(c=u[e+8>>2]))<1)){for(t=(0|_)>1?_:1,p=0,T=(0|O)<400;;){if(n=0,!T)for(;;){if(u[(a=v(n,c)+p<<2)+i>>2]=u[a+g>>2],(0|(n=n+1|0))==(0|t))break}if((0|(p=p+1|0))==(0|c))break}if(T=48e3/u[e+12>>2]|0,(0|c)<1)break k;for(C=(n=v(c,_)<<2)+i|0,g=n+g|0,t=0,o=(0|O)<400;;){if(n=0,!o)for(;;){if(p=C+(a=v(n,c)+t<<2)|0,f=E((f=A[(v(n,T)<<2)+b>>2])*f),A[p>>2]=E(f*A[p>>2])+E(E(E(1)-f)*A[a+g>>2]),(0|_)==(0|(n=n+1|0)))break}if((0|c)==(0|(t=t+1|0)))break}}eg:if(B){if(a=u[e+8>>2],(0|m)>=(0|R)){if((0|(p=v(a,_)))>=1)for(n=0;;){if(u[(c=n<<2)+i>>2]=u[c+N>>2],(0|p)==(0|(n=n+1|0)))break}if(g=48e3/u[e+12>>2]|0,(0|a)<1)break eg;for(T=(n=p<<2)+i|0,C=n+N|0,t=0,o=(0|O)<400;;){if(n=0,!o)for(;;){if(p=T+(c=v(n,a)+t<<2)|0,f=E((f=A[(v(n,g)<<2)+b>>2])*f),A[p>>2]=E(f*A[p>>2])+E(E(E(1)-f)*A[c+C>>2]),(0|_)==(0|(n=n+1|0)))break}if((0|a)==(0|(t=t+1|0)))break}break eg}if(g=48e3/u[e+12>>2]|0,(0|a)<1)break eg;for(t=0,T=(0|O)<400;;){if(n=0,!T)for(;;){if(p=(c=v(n,a)+t<<2)+i|0,f=E((f=A[(v(n,g)<<2)+b>>2])*f),A[p>>2]=E(f*A[p>>2])+E(E(E(1)-f)*A[c+N>>2]),(0|_)==(0|(n=n+1|0)))break}if((0|a)==(0|(t=t+1|0)))break}}n=u[e+40>>2];eS:if(n){if(_=u[e+8>>2],j=eh(.6931471805599453*+E(E(0|n)*E(6488140788860619e-19))),(0|(b=v(m,_)))<1)break eS;for(f=E(j),n=0;;){if(A[(_=(n<<2)+i|0)>>2]=A[_>>2]*f,(0|b)==(0|(n=n+1|0)))break}}n=u[l+136>>2],_=u[l+172>>2],u[e+60>>2]=y,u[e+68>>2]=(1^k)&L,u[e+84>>2]=(0|r)<2?0:n^_,a=(0|w)<0?w:m}}return D=l+192|0,a}e0(36574,35333,493),I()}e0(36733,35333,502),I()}e0(36856,35333,505),I()}e0(37001,35333,509),I()}e0(37142,35333,516),I()}e0(36733,35333,531),I()}e0(37213,35333,549),I()}e0(37142,35333,556),I()}e0(36733,35333,557),I()}e0(36856,35333,560),I()}e0(36419,35333,488),I()}function U(e,t,r,i,n,o,a){var c=0,h=0,p=0,f=0,_=0,A=0,E=0,g=0,b=0,T=0,y=0,R=0,I=0,C=0,k=0,w=0;D=c=D-80|0,u[c+76>>2]=t,w=c+55|0,C=c+56|0,t=0;t:{r:for(;;){i:if(!((0|y)<0)){if((0x7fffffff-y|0)<(0|t)){u[ti()>>2]=61,y=-1;break i}y=t+y|0}o:{s:{c:{if(h=l[0|(t=E=u[c+76>>2])])for(;;){l:{h&=255;h:{if(!h){h=t;break h}if((0|h)!=37)break l;for(h=t;;){if(37!=l[t+1|0])break h;if(p=t+2|0,u[c+76>>2]=p,h=h+1|0,A=l[t+2|0],t=p,(0|A)!=37)break}}if(t=h-E|0,e&&e7(e,E,t),t)continue r;t=tr(s[u[c+76>>2]+1|0]),f=c,h=u[c+76>>2];$:{if(!(!t|36!=l[h+2|0])){k=1,t=h+3|0,I=s[h+1|0]-48|0;break $}t=h+1|0,I=-1}u[f+76>>2]=t,R=0,p=(A=s[0|t])-32|0;f:{if(p>>>0>31){h=t;break f}if(h=t,!(75913&(p=1<<p)))break f;for(;;){if(h=t+1|0,u[c+76>>2]=h,R|=p,(p=(A=s[t+1|0])-32|0)>>>0>=32)break f;if(t=h,!(75913&(p=1<<p)))break}}_:{if((0|A)==42){f=c;eo:{A:if(tr(s[h+1|0])&&36==l[(h=u[c+76>>2])+2|0]){u[((s[h+1|0]<<2)+n|0)-192>>2]=10,b=u[((s[h+1|0]<<3)+i|0)-384>>2],k=1,t=h+3|0;break eo}if(k)break c;k=0,b=0,e&&(t=u[r>>2],u[r>>2]=t+4,b=u[t>>2]),t=u[c+76>>2]+1|0}if(u[f+76>>2]=t,(0|b)>-1)break _;b=0-b|0,R|=8192;break _}if((0|(b=eJ(c+76|0)))<0)break c;t=u[c+76>>2]}_=-1;eb:if(46==l[0|t]){if(42==l[t+1|0]){ea:if(tr(s[t+2|0])&&36==l[(t=u[c+76>>2])+3|0]){u[((s[t+2|0]<<2)+n|0)-192>>2]=10,_=u[((s[t+2|0]<<3)+i|0)-384>>2],t=t+4|0,u[c+76>>2]=t;break eb}if(k)break c;e?(t=u[r>>2],u[r>>2]=t+4,_=u[t>>2]):_=0,t=u[c+76>>2]+2|0,u[c+76>>2]=t;break eb}u[c+76>>2]=t+1,_=eJ(c+76|0),t=u[c+76>>2]}for(h=0;;){if(p=h,T=-1,s[0|t]-65>>>0>57)break t;if(A=t+1|0,u[c+76>>2]=A,h=s[0|t],t=A,!((h=l[(v(p,58)+h|0)+991|0])-1>>>0<8))break}v:{E:{if((0|h)!=19){if(!h)break t;if((0|I)>=0){u[(I<<2)+n>>2]=h,g=u[(f=(I<<3)+i|0)>>2],f=u[f+4>>2],u[c+64>>2]=g,u[c+68>>2]=f;break E}if(!e)break o;ev(c- -64|0,h,r,a),A=u[c+76>>2];break v}if((0|I)>-1)break t}if(t=0,!e)continue r}g=-65537&R,h=8192&R?g:R,T=0,I=1028,R=C;g:{eT:{ey:{eR:{eI:{ec:{ei:{eC:{ed:{S:{ek:{eu:{el:{ew:{em:{switch(t=s[A-1|0],(t=p&&(15&t)==3?-33&t:t)-88|0){case 11:break g;case 9:case 13:case 14:case 15:break eT;case 27:break ei;case 12:case 17:break S;case 23:break ek;case 0:case 32:break eu;case 24:break el;case 22:break ew;case 29:break em;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 10:case 16:case 18:case 19:case 20:case 21:case 25:case 26:case 28:case 30:case 31:break s;default:break}switch(t-65|0){case 0:case 4:case 5:case 6:break eT;case 2:break eI;case 1:case 3:break s;default:break}if((0|t)==83)break ec;break s}p=f=u[c+64>>2],t=g=u[c+68>>2],I=1028;break ed}switch(t=0,255&p){case 0:case 1:case 6:u[u[c+64>>2]>>2]=y;continue r;case 2:g=(f=y)>>31,f=u[c+64>>2],u[f>>2]=y,u[f+4>>2]=g;continue r;case 3:d[u[c+64>>2]>>1]=y;continue r;case 4:s[u[c+64>>2]]=y;continue r;case 7:break;default:continue r}g=(f=y)>>31,f=u[c+64>>2],u[f>>2]=y,u[f+4>>2]=g;continue r}_=_>>>0>8?_:8,h|=8,t=120}if(g=u[c+64>>2],E=function(e,t,r,i){if(e|t)for(;;){if(s[0|(r=r-1|0)]=l[(15&e)+1520|0]|i,!((e=(15&t)<<28|e>>>4)|(t=t>>>4|0)))break}return r}(g,f=u[c+68>>2],C,32&t),!(8&h))break eC;if(f=u[c+64>>2],!(f|(g=u[c+68>>2])))break eC;I=(t>>>4|0)+1028|0,T=2;break eC}if(g=u[c+64>>2],E=function(e,t,r){if(e|t)for(;;){if(s[0|(r=r-1|0)]=7&e|48,!((e=(7&t)<<29|e>>>3)|(t=t>>>3|0)))break}return r}(g,f=u[c+68>>2],C),!(8&h))break eC;_=(0|(t=C-E|0))<(0|_)?_:t+1|0;break eC}if(t=g=u[c+68>>2],p=f=u[c+64>>2],(0|g)<-1?1:(0|g)<=-1){p=0-(f=p)|0,t=f=0-(f=(g=t)+((0|f)!=0)|0)|0,u[c+64>>2]=p,u[c+68>>2]=f,T=1,I=1028;break ed}if(2048&h){T=1,I=1029;break ed}I=(T=1&h)?1030:1028}E=function(e,t,r){var i=0,n=0,o=0,a=0;t:{if(t>>>0<1){o=e,a=i=t;break t}for(;;){if(r=r-1|0,o=function(e,t,r,i){return i=function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,u=0,l=0,h=0,p=0,f=0,_=0;t:{r:{i:{n:{o:{a:{s:{c:{d:{l:{if(o=t){if(!(s=r))break l;if(!(n=i))break d;if((o=S(n)-S(o)|0)>>>0<=31)break c;break r}if((0|(n=i))==1|n>>>0>1)break r;return o=((o=e)>>>0)/((s=r)>>>0)|0,L=0,o}if(s=i,!e)break s;if(!s||(n=s-1|0)&s)break a;return d=o>>>e5(s)|0,L=0,d}if(!(s-1&s))break o;s=0-(o=(S(s)+33|0)-S(o)|0)|0;break i}s=63-o|0,o=o+1|0;break i}return L=0,n=(o>>>0)/(s>>>0)|0}if((o=S(s)-S(o)|0)>>>0<31)break n;break r}if((0|s)==1)break t;return n=t,d=e,u=0,a=31&(c=e5(s)),(63&c)>>>0>=32?d=n>>>a|0:(u=n>>>a|0,d=((1<<a)-1&n)<<32-a|d>>>a),L=u,d}s=63-o|0,o=o+1|0}if(d=t,n=e,u=0,a=31&(c=63&o),(63&c)>>>0>=32?h=d>>>a|0:(u=d>>>a|0,h=((1<<a)-1&d)<<32-a|n>>>a),p=u,u=t,d=e,a=31&(c=63&s),(63&c)>>>0>=32?(n=d<<a,e=0):(n=(1<<a)-1&d>>>32-a|u<<a,e=d<<a),t=n,o)for(n=i-1|0,n=(0|(a=r-1|0))!=-1?n+1|0:n,s=a,d=n;;){if(c=(n=h)<<1,n=p<<1|n>>>31,l=h=c|t>>>31,u=n,p=i&(a=d-(((n=s)>>>0<(c=l)>>>0)+u|0)|0)>>31,h=(n=c)-(c=(l=a>>31)&r)|0,p=u-((n>>>0<c>>>0)+p|0)|0,n=t<<1|e>>>31,e=e<<1|f,t=0|n,_=0,l&=1,f=l,!(o=o-1|0))break}return L=t<<1|e>>>31|_,e<<1|l}e=0,t=0}return L=t,e}(e,t,r,i)}(e,i=t,10,0),a=i=L,n=e6(o,i,10,0),i=t,s[0|r]=e-n|48,n=i>>>0>9,e=o,t=i=a,!n)break}}if(n=o)for(;;){if(r=r-1|0,e=(n>>>0)/10|0,s[0|r]=n-v(e,10)|48,t=n>>>0>9,n=e,!t)break}return r}(p,f=t,C)}if(h=(0|_)>-1?-65537&h:h,p=f=u[c+64>>2],!(!!(f|(t=u[c+68>>2]))|_)){_=0,E=C;break s}_=(0|(t=!(p|t)+(C-E|0)|0))<(0|_)?_:t;break s}R=(t=function(e,t,r){var i=0,n=0;i=(0|r)!=0;t:{r:{i:if(!(!r|!(3&e))){for(n=255&t;;){if(l[0|e]==(0|n))break r;if(e=e+1|0,i=(0|(r=r-1|0))!=0,!r)break i;if(!(3&e))break}}if(!i)break t}o:if(!(l[0|e]==(255&t)|r>>>0<4)){for(n=v(255&t,0x1010101);;){if((-1^(i=u[e>>2]^n))&i-0x1010101&-0x7f7f7f80)break o;if(e=e+4|0,!((r=r-4|0)>>>0>3))break}}if(!r)break t;for(i=255&t;;){if(l[0|e]==(0|i))return e;if(e=e+1|0,!(r=r-1|0))break}}return 0}(E=(t=u[c+64>>2])||1038,0,_))||_+E|0,h=g,_=t?t-E|0:_;break s}if(p=u[c+64>>2],_)break eR;t=0,eH(e,32,b,0,h);break ey}u[c+12>>2]=0,u[c+8>>2]=u[c+64>>2],u[c+64>>2]=c+8,_=-1,p=c+8|0}t=0;I:{for(;;){if(!(A=u[p>>2]))break I;if(!((E=(0|(A=te(c+4|0,A)))<0)|_-t>>>0<A>>>0)){if(p=p+4|0,_>>>0>(t=t+A|0)>>>0)continue;break I}break}if(T=-1,E)break t}if(eH(e,32,b,t,h),!t){t=0;break ey}for(p=0,A=u[c+64>>2];;){if(!(E=u[A>>2])||(0|(p=(E=te(c+4|0,E))+p|0))>(0|t))break ey;if(e7(e,c+4|0,E),A=A+4|0,!(t>>>0>p>>>0))break}}eH(e,32,b,t,8192^h),t=(0|t)<(0|b)?b:t;continue r}t=0|tn[0|o](e,m[c+64>>3],b,_,h,t);continue r}f=u[c+64>>2],s[c+55|0]=f,_=1,E=w,h=g;break s}p=t+1|0,u[c+76>>2]=p,h=l[t+1|0],t=p}if(T=y,e)break t;if(!k)break o;for(t=1;;){if(h=u[(t<<2)+n>>2]){if(ev((t<<3)+i|0,h,r,a),T=1,(0|(t=t+1|0))!=10)continue;break t}break}if(T=1,t>>>0>=10)break t;for(;;){if(u[(t<<2)+n>>2])break c;if((0|(t=t+1|0))==10)break}break t}T=-1;break t}eH(e,32,t=(0|(p=(R=(0|_)<(0|(A=R-E|0))?A:_)+T|0))>(0|b)?p:b,p,h),e7(e,I,T),eH(e,48,t,p,65536^h),eH(e,48,R,A,0),e7(e,E,A),eH(e,32,t,p,8192^h);continue}break}T=0}return D=c+80|0,T}function B(e,t){var r=0,i=E(0),n=0,o=E(0),a=E(0),s=0,c=E(0),l=0,p=0,f=E(0),_=0,m=E(0),g=0,S=E(0),b=E(0),T=E(0),y=0,R=E(0),C=E(0),k=0,w=E(0),O=E(0),N=E(0),P=0,L=0,M=0,x=0,U=0,B=0,V=E(0),F=E(0),j=E(0),G=0,W=0,H=0,Y=E(0),K=0,Q=0,z=E(0),X=E(0),J=E(0),q=E(0),Z=E(0),$=E(0),ee=E(0),et=E(0),er=E(0),ei=E(0),en=0;for(D=U=D-32|0,g=u[e+8>>2],u[U>>2]=1,s=e+12|0,l=1;;){if(y=h[(2|(p=(r=n)<<2))+s>>1],n=r+1|0,l=v(d[s+p>>1],l),u[(n<<2)+U>>2]=l,(0|y)==1)break}K=(0|g)>0?g:0,W=d[((n<<2)+e|0)+10>>1];r:{for(;;){_=W,n=0,W=1,B=r,r&&(W=d[((B<<2)+e|0)+10>>1],n=B<<1);o:{switch(d[((n<<1)+e|0)+12>>1]-2|0){case 0:if((0|_)!=4)break r;if(n=0,r=t,(0|(p=u[(B<<2)+U>>2]))<=0)break o;for(;;){if(a=A[r>>2],i=A[r+32>>2],A[r+32>>2]=a-i,A[r>>2]=i+a,a=A[(s=r+36|0)>>2],i=A[r+4>>2],A[r+4>>2]=a+i,A[r+36>>2]=i-a,a=A[r+8>>2],i=A[r+40>>2],c=E(E(i+(o=A[(s=r+44|0)>>2]))*E(.7071067690849304)),A[r+40>>2]=a-c,f=A[(l=r+12|0)>>2],i=E(E(o-i)*E(.7071067690849304)),A[r+44>>2]=f-i,A[r+8>>2]=a+c,A[r+12>>2]=i+f,a=A[r+48>>2],i=A[r+16>>2],o=A[(s=r+52|0)>>2],A[r+48>>2]=i-o,c=A[(l=r+20|0)>>2],A[r+52>>2]=a+c,A[r+20>>2]=c-a,A[r+16>>2]=o+i,a=A[r+24>>2],i=A[(s=r+60|0)>>2],c=E(E(i-(o=A[r+56>>2]))*E(.7071067690849304)),A[r+56>>2]=a-c,f=A[(l=r+28|0)>>2],i=E(E(i+o)*E(-.7071067690849304)),A[r+60>>2]=f-i,A[r+28>>2]=i+f,A[r+24>>2]=a+c,r=r- -64|0,(0|p)==(0|(n=n+1|0)))break}break o;case 2:if(G=u[(B<<2)+U>>2],(0|_)==1){if(n=0,r=t,(0|G)<1)break o;for(;;){if(a=A[r>>2],o=E(a+(i=A[r+16>>2])),c=A[r+8>>2],S=E(c+(f=A[r+24>>2])),A[r+16>>2]=o-S,A[r>>2]=o+S,_=s=r+20|0,o=A[r+4>>2],C=E(o+(S=A[r+20>>2])),w=A[(s=r+12|0)>>2],T=E(w+(b=A[(l=r+28|0)>>2])),A[_>>2]=C-T,o=E(o-S),c=E(c-f),A[r+28>>2]=o+c,a=E(a-i),i=E(w-b),A[r+24>>2]=a-i,A[r+12>>2]=o-c,A[r+8>>2]=a+i,A[r+4>>2]=C+T,r=r+32|0,(0|G)==(0|(n=n+1|0)))break}break o}if((0|G)<1)break o;for(L=v(_,3),M=_<<1,x=v(k=G<<K,3),Q=k<<1,en=u[e+48>>2],H=0;;){if((0|_)>=1)for(r=(v(W,H)<<3)+t|0,P=0,s=n=en,l=n;;){if(a=A[(p=(_<<3)+r|0)+4>>2],i=A[p>>2],o=A[(y=(L<<3)+r|0)+4>>2],c=A[y>>2],f=A[l>>2],S=A[l+4>>2],C=A[n>>2],w=A[n+4>>2],b=A[s>>2],T=A[(g=(M<<3)+r|0)+4>>2],m=A[g>>2],R=A[s+4>>2],V=E(E(b*T)+E(m*R)),N=E(V+(O=A[r+4>>2])),A[r+4>>2]=N,b=E(E(m*b)-E(T*R)),m=E(b+(T=A[r>>2])),A[r>>2]=m,R=E(E(f*a)+E(i*S)),F=E(E(C*o)+E(c*w)),j=E(R+F),A[g+4>>2]=N-j,a=E(E(i*f)-E(a*S)),i=E(E(c*C)-E(o*w)),o=E(a+i),A[g>>2]=m-o,A[r>>2]=o+A[r>>2],A[r+4>>2]=j+A[r+4>>2],o=E(O-V),a=E(a-i),A[p+4>>2]=o-a,i=E(T-b),c=E(R-F),A[p>>2]=i+c,A[y+4>>2]=o+a,A[y>>2]=i-c,r=r+8|0,n=(x<<3)+n|0,s=(Q<<3)+s|0,l=(k<<3)+l|0,(0|(P=P+1|0))==(0|_))break}if((0|(H=H+1|0))==(0|G))break}break o;case 1:if((0|(x=u[(B<<2)+U>>2]))<1)break o;for(P=_<<1,M=u[e+48>>2],a=A[(M+(v(g=x<<K,_)<<3)|0)+4>>2],k=g<<1,L=0;;){for(r=(v(L,W)<<3)+t|0,l=s=M,y=_;;){if(i=A[(n=(_<<3)+r|0)>>2],o=A[l>>2],c=A[n+4>>2],f=A[l+4>>2],S=E(E(i*o)-E(c*f)),C=A[(p=(P<<3)+r|0)>>2],w=A[s>>2],b=A[p+4>>2],T=A[s+4>>2],m=E(E(C*w)-E(b*T)),R=E(S+m),A[n>>2]=A[r>>2]-E(R*E(.5)),i=E(E(o*c)+E(i*f)),o=E(E(w*b)+E(C*T)),c=E(i+o),A[n+4>>2]=A[r+4>>2]-E(c*E(.5)),A[r>>2]=R+A[r>>2],A[r+4>>2]=c+A[r+4>>2],i=E(a*E(i-o)),A[p>>2]=i+A[n>>2],o=E(a*E(S-m)),A[p+4>>2]=A[n+4>>2]-o,A[n>>2]=A[n>>2]-i,A[n+4>>2]=o+A[n+4>>2],r=r+8|0,s=(k<<3)+s|0,l=(g<<3)+l|0,!(y=y-1|0))break}if((0|x)==(0|(L=L+1|0)))break}break o;case 3:break;default:break o}if((0|(x=u[(B<<2)+U>>2]))<1)break o;for(y=u[e+48>>2],a=A[(n=y+((r=v(L=x<<K,_))<<4)|0)+4>>2],i=A[n>>2],o=A[(r=(r<<3)+y|0)+4>>2],c=A[r>>2],Q=_<<2,H=v(_,3),G=_<<1,M=0;;){if((0|_)>=1)for(n=(r=(v(M,W)<<3)+t|0)+(_<<3)|0,s=(G<<3)+r|0,l=(H<<3)+r|0,p=(Q<<3)+r|0,P=0;;){if(f=A[r>>2],S=A[r+4>>2],b=A[(k=((g=v(P,L))<<4)+y|0)>>2],T=A[s+4>>2],m=A[s>>2],R=A[k+4>>2],V=E(E(b*T)+E(m*R)),O=A[(k=v(g,24)+y|0)>>2],N=A[l+4>>2],F=A[l>>2],j=A[k+4>>2],Y=E(E(O*N)+E(F*j)),C=E(V+Y),z=A[(k=(g<<3)+y|0)>>2],X=A[n+4>>2],J=A[n>>2],q=A[k+4>>2],Z=E(E(z*X)+E(J*q)),$=A[(g=(g<<5)+y|0)>>2],ee=A[p+4>>2],et=A[p>>2],er=A[g+4>>2],ei=E(E($*ee)+E(et*er)),w=E(Z+ei),A[r+4>>2]=S+E(C+w),m=E(E(m*b)-E(T*R)),R=E(E(F*O)-E(N*j)),b=E(m+R),O=E(E(J*z)-E(X*q)),N=E(E(et*$)-E(ee*er)),T=E(O+N),A[r>>2]=f+E(b+T),m=E(m-R),R=E(O-N),O=E(E(a*m)+E(o*R)),N=E(S+E(E(i*C)+E(c*w))),A[n+4>>2]=O+N,F=E(f+E(E(i*b)+E(c*T))),V=E(V-Y),j=E(Z-ei),Y=E(E(a*V)+E(o*j)),A[n>>2]=F-Y,A[p+4>>2]=N-O,A[p>>2]=Y+F,m=E(E(a*R)-E(o*m)),S=E(S+E(E(c*C)+E(i*w))),A[s+4>>2]=m+S,C=E(E(o*V)-E(a*j)),f=E(f+E(E(c*b)+E(i*T))),A[s>>2]=C+f,A[l+4>>2]=S-m,A[l>>2]=f-C,p=p+8|0,l=l+8|0,s=s+8|0,n=n+8|0,r=r+8|0,(0|(P=P+1|0))==(0|_))break}if((0|x)==(0|(M=M+1|0)))break}}if(r=B-1|0,!((0|B)>0))break}D=U+32|0;return}e0(34088,34072,76),I()}function V(e,t,r,i,n,o,a){var c=0,p=0,f=0,m=0,g=0,b=0,y=0,C=0,k=0,w=0,O=0,N=0,P=0,L=E(0),M=0,x=0,U=0,B=0,V=0,F=0,j=E(0),W=0,H=0,Y=0,K=0,X=0,J=0,q=0,Z=0,$=0,et=0,en=0,es=0,ec=0,eu=0,el=0,ef=0,e_=0,ev=0,eg=0,eb=0,ey=0,eC=0,ek=0,ew=E(0);D=P=D-80|0,H=u[e+8>>2],u[(O=P)+12>>2]=0,u[O+8>>2]=0,M=u[e+12>>2],function(e){var t=0,r=0;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{l:{h:{q:{Z:{p:{$:{ee:{f:{if(u[e>>2]==(0|ej(48e3,960,0))){if(120!=u[e+4>>2])break f;if(u[e+8>>2]-1>>>0>=2)break ee;if(u[e+12>>2]-1>>>0>=2)break $;if(u[e+16>>2]<=0)break p;if(!(!(t=u[e+20>>2])|(0|t)==17)&&(e0(34405,34183,124),I()),(0|(r=u[e+24>>2]))<=(0|t))break Z;if((0|r)>=22)break q;if((0|(t=u[e+36>>2]))<=-1)break h;if(t)break l;if((0|(t=u[e+48>>2]))>=721)break u;if(t?(0|t)<=99:0)break d;if((0|(t=u[e+60>>2]))>=1024)break c;if(t?(0|t)<=14:0)break s;if((0|(t=u[e+64>>2]))>=1024)break a;if(t?(0|t)<=14:0)break o;if((0|(t=u[e+76>>2]))>=3)break n;if((0|t)<=-1)break i;if((0|(e=u[e+80>>2]))>=3)break r;if((0|e)<=-1)break t;return}e0(34111,34183,118),I()}e0(34203,34183,119),I()}e0(34240,34183,121),I()}e0(34297,34183,122),I()}e0(34368,34183,123),I()}e0(34457,34183,125),I()}e0(34495,34183,126),I()}e0(34527,34183,128),I()}e0(34559,34183,129),I()}e0(34603,34183,131),I()}e0(34663,34183,132),I()}e0(34752,34183,133),I()}e0(34805,34183,134),I()}e0(34899,34183,135),I()}e0(34956,34183,136),I()}e0(35058,34183,137),I()}e0(35103,34183,138),I()}e0(35148,34183,139),I()}e0(35197,34183,140),I()}(e),m=-1,b=u[e>>2],x=u[b+36>>2];t:if(!((0|x)<0)){for(c=(C=u[b+8>>2])<<3,F=c+(w=(((v(H,g=(J=u[b+4>>2])+2048|0)<<2)+e|0)+v(H,96)|0)+92|0)|0,e_=(Y=c+F|0)+c|0,n=v(u[e+16>>2],n),y=u[e+24>>2],q=u[b+32>>2],p=u[b+44>>2];;){if(p<<f!=(0|n)){if(c=(0|f)<(0|x),f=f+1|0,c)continue;break t}break}if(!i|r>>>0>1275)break t;for(N=u[e+20>>2],Z=C<<1,el=1<<f,x=(0|H)>1?H:1,c=0,k=0-n<<2;;){if(p=c<<2,m=((v(c,g)<<2)+e|0)+92|0,u[p+(O+24|0)>>2]=m,u[(O+16|0)+p>>2]=(m+k|0)- -8192,(0|x)==(0|(c=c+1|0)))break}if(!((0|r)>1?t:0)){(function(e,t,r){var i=0,n=0,o=0,a=0,s=E(0),c=0,l=E(0),h=0,p=0,f=0,_=0,m=0,g=0,S=0,b=0,y=E(0),C=0,k=0,w=0,O=E(0),N=0,P=0,L=0,M=0,x=0,U=E(0),B=0,V=0,F=0,j=0,G=0,W=E(0),H=0,Y=0,K=0,z=0,X=0,J=0,q=0,Z=0,$=0,et=0,er=0,en=0,ea=0,es=0,ec=0,eu=0,el=0,eh=0,ef=0,e_=0,eA=0,em=0,ev=0,eg=0,eb=0,ey=0,eR=0;for(D=o=h=D-4320|0,M=(0|(m=u[e+8>>2]))>1?m:1,G=0-t|0,_=u[e>>2],c=(g=u[_+4>>2])+2048|0,p=u[_+32>>2],b=u[_+8>>2];;){if(n=i<<2,a=((v(i,c)<<2)+e|0)+92|0,u[n+(o+4312|0)>>2]=a,u[(o+4304|0)+n>>2]=((G<<2)+a|0)- -8192,(0|M)==(0|(i=i+1|0)))break}B=((v(c,m)<<2)+e|0)+92|0,S=u[e+20>>2],P=u[e+52>>2];r:{if(!(u[e+56>>2]?0:!(S|(0|P)>4))){for(k=(i=b<<3)+(((C=v(m,96)+B|0)+i|0)+i|0)|0,O=P?E(.5):E(1.5),c=u[e+24>>2],L=(0|(i=u[_+12>>2]))>(0|c)?c:i,D=h=h-((v(t,m)<<2)+15&-16)|0;;){if((0|c)>(0|S))for(f=v(b,w),i=S;;){if(a=C+(n=i+f<<2)|0,s=A[n+k>>2],l=E(A[a>>2]-O),A[a>>2]=s>l?s:l,(0|c)==(0|(i=i+1|0)))break}if((0|M)==(0|(w=w+1|0)))break}if(w=(0|S)>(0|L)?S:L,n=u[e+40>>2],(0|m)>=1)for(b=0;;){if((0|S)<(0|L))for(k=v(t,b),f=S;;){if(a=((c=d[(f<<1)+p>>1])<<r)+k|0,i=0,(0|(c=d[((f=f+1|0)<<1)+p>>1]-c<<r))>=1)for(;;){if(V=(i+a<<2)+h|0,n=function(e){return v(e,1664525)+0x3c6ef35f|0}(n),A[V>>2]=n>>20,(0|c)==(0|(i=i+1|0)))break}if(eV((a<<2)+h|0,c,E(1),u[e+36>>2]),(0|f)==(0|w))break}if((0|(b=b+1|0))==(0|m))break}for(u[e+40>>2]=n,a=((g>>>1|0)-t<<2)- -8192|0,i=0;;){if(ep(n=u[(o+4312|0)+(i<<2)>>2],(t<<2)+n|0,a),(0|M)==(0|(i=i+1|0)))break}eo(_,h,o+4304|0,C,S,w,m,m,0,r,u[e+16>>2],0,u[e+36>>2]);break r}p:{if(!P){(function(e,t,r,i,n){var o=E(0),a=0,s=0,c=0,d=0,l=E(0),h=E(0),p=E(0),f=0,_=0,m=0,v=E(0),g=E(0),S=E(0),b=E(0),T=E(0),y=E(0),R=E(0);if(D=a=D-48|0,f=r>>1,c=u[e>>2],(0|r)>=4)for(m=(0|f)>2?f:2,s=1;;){if(_=(d=s<<3)+c|0,A[(s<<2)+t>>2]=E(A[_>>2]+E(E(A[_-4>>2]+A[(4|d)+c>>2])*E(.5)))*E(.5),(0|m)==(0|(s=s+1|0)))break}if(o=E(E(E(A[c+4>>2]*E(.5))+A[c>>2])*E(.5)),A[t>>2]=o,(0|i)==2){if(c=u[e+4>>2],(0|r)>=4){for(m=(0|f)>2?f:2,s=1;;){if(e=d=(s<<2)+t|0,o=A[d>>2],_=(d=s<<3)+c|0,A[e>>2]=o+E(E(A[_>>2]+E(E(A[_-4>>2]+A[(4|d)+c>>2])*E(.5)))*E(.5)),(0|m)==(0|(s=s+1|0)))break}o=A[t>>2]}A[t>>2]=o+E(E(E(A[c+4>>2]*E(.5))+A[c>>2])*E(.5))}if(s=0,eT(t,a+16|0,0,0,4,f,n),A[a+16>>2]=A[a+16>>2]*E(1.000100016593933),o=A[a+20>>2],A[a+20>>2]=o-E(E(o*E(.00800000037997961))*E(.00800000037997961)),o=A[a+24>>2],A[a+24>>2]=o-E(E(o*E(.01600000075995922))*E(.01600000075995922)),o=A[a+28>>2],A[a+28>>2]=o-E(E(o*E(.024000000208616257))*E(.024000000208616257)),o=A[a+32>>2],A[a+32>>2]=o-E(E(o*E(.03200000151991844))*E(.03200000151991844)),eS(a,a+16|0,4),o=E(A[a+8>>2]*E(.7289999127388)),A[a+8>>2]=o,l=E(A[a+12>>2]*E(.6560999155044556)),A[a+12>>2]=l,h=E(A[a+4>>2]*E(.809999942779541)),A[a+4>>2]=h,p=E(A[a>>2]*E(.8999999761581421)),A[a>>2]=p,(0|r)>=2)for(g=E(l+E(o*E(.800000011920929))),S=E(o+E(h*E(.800000011920929))),b=E(h+E(p*E(.800000011920929))),T=E(l*E(.800000011920929)),y=E(p+E(.800000011920929)),o=E(0),l=E(0),h=E(0),p=E(0);;){if(v=A[(c=(s<<2)+t|0)>>2],A[c>>2]=E(T*R)+E(E(g*o)+E(E(S*l)+E(E(b*h)+E(E(y*p)+v)))),R=o,o=l,l=h,h=p,p=v,(0|f)==(0|(s=s+1|0)))break}D=a+48|0})(o+4312|0,o+112|0,2048,m,i=u[e+36>>2]),function(e,t,r,i,n,o){var a=E(0),s=E(0),c=0,d=0,l=0,h=0,p=E(0),f=E(0),_=E(0),m=0,v=0,g=E(0),S=0,b=0,y=E(0),R=0;R=o=D;t:{if((0|r)>0){if((0|i)<=0)break t;if(D=o=c=o-(((h=r>>>2|0)<<2)+15&-16)|0,D=o=l=o-((-4&(d=r+i|0))+15&-16)|0,D=v=o-(((m=i>>>1|0)<<2)+15&-16)|0,h)for(o=0;;){if(u[(o<<2)+c>>2]=u[(o<<3)+e>>2],(0|h)==(0|(o=o+1|0)))break}if((0|d)>=4)for(d=(0|(o=d>>2))>1?o:1,o=0;;){if(u[(o<<2)+l>>2]=u[(o<<3)+t>>2],(0|d)==(0|(o=o+1|0)))break}if(Q(c,l,v,h,d=i>>2,o),s=E(1),h)for(o=0;;){if(s=E(s+E((a=A[(o<<2)+l>>2])*a)),(0|h)==(0|(o=o+1|0)))break}if(S=1,(0|i)>3)for(f=E(-1),o=0,_=E(-1);;){a=A[v+(c=o<<2)>>2];l:if(!(a>E(0)^1)){if(a=E(a*E(9999999960041972e-28)),a=E(a*a),E(p*a)>E(_*s)^1)break l;if(E(g*a)>E(f*s)){S=b,b=o,_=f,f=a,p=g,g=s;break l}S=o,_=a,p=s}if(y=E((a=A[(o+h<<2)+l>>2])*a),s=E(T(E(s+E(y-E((a=A[l+c>>2])*a))),E(1))),(0|d)==(0|(o=o+1|0)))break}q:{if(!m){h=r>>1;break q}for(h=r>>1,S<<=1,b<<=1,d=0;;){u[(i=v+(l=d<<2)|0)>>2]=0,c=o=d-b|0,o>>=31;$:if(!((o^o+c)>=3)||(c=o=d-S|0,!(((o>>=31)^o+c)>2))){if(s=E(0),(0|r)>=2)for(c=t+l|0,o=0;;){if(s=E(s+E(A[(l=o<<2)+e>>2]*A[l+c>>2])),(0|h)==(0|(o=o+1|0)))break}A[i>>2]=T(s,E(-1))}if((0|m)==(0|(d=d+1|0)))break}}if(s=E(1),(0|r)>1)for(o=0;;){if(s=E(s+E((a=A[(o<<2)+t>>2])*a)),(0|h)==(0|(o=o+1|0)))break}c=0;en:{if(!m){e=0;break en}for(f=E(-1),g=E(0),e=0,o=0,p=E(0),_=E(-1);;){a=A[v+(l=o<<2)>>2];eO:if(!(a>E(0)^1)){if(a=E(a*E(9999999960041972e-28)),a=E(a*a),E(p*a)>E(_*s)^1)break eO;if(E(g*a)>E(f*s)){e=o,_=f,f=a,p=g,g=s;break eO}_=a,p=s}if(y=E((a=A[(o+h<<2)+t>>2])*a),s=E(T(E(s+E(y-E((a=A[t+l>>2])*a))),E(1))),(0|m)==(0|(o=o+1|0)))break}if((0|e)<1|(m-1|0)<=(0|e))break en;if(c=-1,a=A[(o=(e<<2)+v|0)+4>>2],s=A[o-4>>2],p=A[o>>2],E(a-s)>E(E(p-s)*E(.699999988079071)))break en;c=E(s-a)>E(E(p-a)*E(.699999988079071))}u[n>>2]=(e<<1)+c,D=R;return}e0(34008,33995,302),I()}e0(33965,33995,303),I()}(o+1552|0,o+112|0,1328,620,o,i),r=720-u[o>>2]|0,u[e+48>>2]=r,W=E(1);break p}r=u[e+48>>2],W=E(.800000011920929)}for(w=(0|(i=(x=(0|(i=r<<1))<1024?i:1024)>>1))>1?i:1,D=n=k=h-((g<<2)+15&-16)|0,S=1024-x|0,b=1024-i|0,H=(o-(F=x<<2)|0)+4304|0,L=(0|g)/2|0,m=1024-r|0,z=(f=t+g|0)<<2,Y=(h=2048-t|0)<<2,D=j=n-(F+15&-16)|0,c=o+208|0,C=u[_+60>>2],X=2047-t<<2,J=2046-t<<2,q=2045-t<<2,Z=2044-t<<2,$=2043-t<<2,et=2042-t<<2,er=2041-t<<2,en=2040-t<<2,ea=2039-t<<2,es=2038-t<<2,ec=2037-t<<2,eu=2036-t<<2,el=2035-t<<2,eh=2034-t<<2,ef=2033-t<<2,e_=2032-t<<2,eA=2031-t<<2,em=2030-t<<2,ev=2029-t<<2,eg=2028-t<<2,eb=2027-t<<2,ey=2026-t<<2,eR=2025-t<<2,V=2024-t<<2,_=0;;){for(a=u[(o+4312|0)+(_<<2)>>2],i=0;;){if(u[(n=i<<2)+(o+112|0)>>2]=u[(n+a|0)+4e3>>2],(0|(i=i+1|0))==1048)break}et:{if(P){i=v(_,24);break et}for(eT(c,o,C,g,24,1024,u[e+36>>2]),A[o>>2]=A[o>>2]*E(1.000100016593933),i=1;;){if(U=s=A[(n=(i<<2)+o|0)>>2],y=E(s*E(-6400000711437315e-20)),s=E(0|i),A[n>>2]=U+E(E(y*s)*s),(0|(i=i+1|0))==25)break}eS(((i=v(_,24))<<2)+B|0,o,24)}if(function(e,t,r,i,n,o){var a=0,s=0,c=0,d=0,l=0,h=E(0),p=0,f=0,_=0;if(a=o=D-16|0,D=o,(0|e)!=(0|r)){if(D=d=o-((n<<2)+15&-16)|0,(0|n)>0)for(o=0;;){if(u[(o<<2)+d>>2]=u[((-1^o)+n<<2)+t>>2],(0|(o=o+1|0))==(0|n))break}if((0|i)>=4)for(f=i-3|0,_=0-n<<2;;){if(t=(o=s<<2)+e|0,u[a>>2]=u[t>>2],c=4|o,u[a+4>>2]=u[c+e>>2],l=8|o,u[a+8>>2]=u[l+e>>2],p=12|o,u[a+12>>2]=u[p+e>>2],ee(d,t+_|0,a,n),u[r+o>>2]=u[a>>2],u[r+c>>2]=u[a+4>>2],u[r+l>>2]=u[a+8>>2],u[r+p>>2]=u[a+12>>2],!((0|f)>(0|(s=s+4|0))))break}if((0|i)>(0|s))for(l=(0|n)<1;;){if(h=A[(c=s<<2)+e>>2],!l)for(t=s-n|0,o=0;;){if(h=E(h+E(A[(o<<2)+d>>2]*A[(t+o<<2)+e>>2])),(0|(o=o+1|0))==(0|n))break}if(A[r+c>>2]=h,(0|(s=s+1|0))==(0|i))break}D=a+16|0;return}e0(33804,33829,102),I()}(H,K=(i<<2)+B|0,j,x,24,u[e+36>>2]),ed(H,j,F),s=E(1),i=0,y=E(1),(0|r)>=1)for(;;){if(s=E(s+E((l=A[(i+S<<2)+c>>2])*l)),y=E(y+E((l=A[(i+b<<2)+c>>2])*l)),(0|w)==(0|(i=i+1|0)))break}if(i=ep(a,(t<<2)+a|0,Y),O=E(0),l=E(0),!(N=(0|f)<1))for(U=E(R(E((s>y?y:s)/s))),s=E(W*U),n=0,a=0;;){if(s=(p=(0|r)>(0|a))?s:E(U*s),p=m+(a=a-(p?0:r)|0)|0,A[(n+h<<2)+i>>2]=s*A[(p<<2)+c>>2],a=a+1|0,l=E(l+E((y=A[((p-t<<2)+i|0)+4096>>2])*y)),(0|f)==(0|(n=n+1|0)))break}u[o>>2]=u[i+X>>2],u[o+4>>2]=u[i+J>>2],u[o+8>>2]=u[i+q>>2],u[o+12>>2]=u[i+Z>>2],u[o+16>>2]=u[i+$>>2],u[o+20>>2]=u[i+et>>2],u[o+24>>2]=u[i+er>>2],u[o+28>>2]=u[i+en>>2],u[o+32>>2]=u[i+ea>>2],u[o+36>>2]=u[i+es>>2],u[o+40>>2]=u[i+ec>>2],u[o+44>>2]=u[i+eu>>2],u[o+48>>2]=u[i+el>>2],u[o+52>>2]=u[i+eh>>2],u[o+56>>2]=u[i+ef>>2],u[o+60>>2]=u[i+e_>>2],u[o+64>>2]=u[i+eA>>2],u[o+68>>2]=u[i+em>>2],u[o+72>>2]=u[i+ev>>2],u[o+76>>2]=u[i+eg>>2],u[o+80>>2]=u[i+eb>>2],u[o+84>>2]=u[i+ey>>2],u[o+88>>2]=u[i+eR>>2],u[o+92>>2]=u[i+V>>2],function(e,t,r,i,n,o,a){var s=0,c=E(0),d=0,l=0,h=0,p=E(0),f=0,_=0,m=E(0),v=0,g=0,S=0;if(d=a=D-16|0,D=a,!(3&n)){D=h=f=a-((n<<2)+15&-16)|0,D=h=h-(((s=i+n|0)<<2)+15&-16)|0,_=s,a=0,l=0;r:if(!((0|n)<=0)){for(;;){if(u[(a<<2)+f>>2]=u[((-1^a)+n<<2)+t>>2],(0|(a=a+1|0))==(0|n))break}if(a=0,l=0,(0|n)<=0)break r;for(;;){if(A[(a<<2)+h>>2]=-A[((-1^a)+n<<2)+o>>2],(0|(a=a+1|0))==(0|n))break}l=n}if((0|_)>(0|(a=l))&&eE((a<<2)+h|0,0,s-a<<2),s=0,(0|i)>=4)for(S=i-3|0;;){if(a=s<<2,u[d>>2]=u[a+e>>2],_=4|a,u[d+4>>2]=u[_+e>>2],v=8|a,u[d+8>>2]=u[v+e>>2],g=12|a,u[d+12>>2]=u[g+e>>2],ee(f,a+h|0,d,n),l=(n+s<<2)+h|0,c=A[d>>2],A[l>>2]=-c,A[r+a>>2]=c,p=E(A[d+4>>2]-E(c*A[t>>2])),A[d+4>>2]=p,A[l+4>>2]=-p,A[r+_>>2]=p,m=E(E(A[d+8>>2]-E(p*A[t>>2]))-E(c*A[t+4>>2])),A[d+8>>2]=m,A[l+8>>2]=-m,A[r+v>>2]=m,c=E(E(E(A[d+12>>2]-E(m*A[t>>2]))-E(p*A[t+4>>2]))-E(c*A[t+8>>2])),A[l+12>>2]=-c,A[r+g>>2]=c,!((0|S)>(0|(s=s+4|0))))break}if((0|i)>(0|s))for(l=(0|n)<1;;){if(c=A[(t=s<<2)+e>>2],a=0,!l)for(;;){if(c=E(c-E(A[(a<<2)+f>>2]*A[(a+s<<2)+h>>2])),(0|(a=a+1|0))==(0|n))break}if(A[(n+s<<2)+h>>2]=c,A[t+r>>2]=c,(0|(s=s+1|0))==(0|i))break}if(a=0,(0|n)>0)for(;;){if(u[(a<<2)+o>>2]=u[((-1^a)+i<<2)+r>>2],(0|(a=a+1|0))==(0|n))break}D=d+16|0;return}e0(33845,33829,160),I()}(n=(p=i- -8192|0)+(G<<2)|0,K,n,f,24,o,u[e+36>>2]),n=0;eb:{eN:{if(!N){for(;;){if(O=E(O+E((s=A[(n+h<<2)+i>>2])*s)),(0|f)==(0|(n=n+1|0)))break}if(E(O*E(.20000000298023224))<l)break eN;if(N)break eb;eE(i+Y|0,0,z);break eb}if(!(l>E(0)))break eb}if(l<O^1)break eb;if(s=E(R(E(E(l+E(1))/E(O+E(1))))),(0|g)>=1)for(l=E(E(1)-s),n=0;;){if(A[(a=(n+h<<2)+i|0)>>2]=A[a>>2]*E(E(1)-E(l*A[(n<<2)+C>>2])),(0|g)==(0|(n=n+1|0)))break}if(n=g,(0|t)<=0)break eb;for(;;){if(A[(a=(n+h<<2)+i|0)>>2]=s*A[a>>2],!((0|f)>(0|(n=n+1|0))))break}}if(n=0,a=u[e+60>>2],s=E(-A[e+68>>2]),ei(k,p,a,a,g,s,s,N=u[e+76>>2],N,0,0,u[e+36>>2]),(0|g)>=2)for(;;){if(a=n<<2,p=(-1^n)+g<<2,A[(a+i|0)- -8192>>2]=E(A[a+C>>2]*A[k+p>>2])+E(A[p+C>>2]*A[a+k>>2]),(0|L)==(0|(n=n+1|0)))break}if((0|M)==(0|(_=_+1|0)))break}}u[e+52>>2]=P+1,D=o+4320|0})(e,n,f),ea(O+16|0,i,n,H,u[e+16>>2],b+16|0,e+84|0,a),m=(0|n)/u[e+16>>2]|0;break t}if($=u[b+12>>2],c=0,u[e+56>>2]=0!=u[e+52>>2],!o&&(eR(O+32|0,t,r),o=O+32|0),K=1,!((0|M)!=1|(0|C)<1))for(;;){if(L=A[(p=(c<<2)+w|0)>>2],j=A[(c+C<<2)+w>>2],A[p>>2]=L>j?L:j,(0|C)==(0|(c=c+1|0)))break}c=((p=S(u[o+28>>2]))+u[o+20>>2]|0)-32|0,B=r<<3;d:{if((0|c)<(0|B)){if(K=0,t=0,(0|c)!=1)break d;if(!(K=eN(o,15))){K=0,c=1,t=0;break d}p=S(u[o+28>>2])}u[o+20>>2]=(B-p|0)+32,c=B,t=1}if(ev=t,L=E(0),!((c+16|0)>(0|B)|N)){t=!eN(o,1),L=E(0);Z:if(!t){c=er(o,6),c=eB(o,c+4|0)+(16<<c)|0,p=eB(o,3),((u[o+20>>2]+S(u[o+28>>2])|0)-30|0)<=(0|B)&&(en=eO(o,35246,2)),es=c-1|0,L=E(E(p+1|0)*E(.09375))}c=(u[o+20>>2]+S(u[o+28>>2])|0)-32|0}!(!f|(0|B)<(0|(c=c+3|0)))&&(W=eN(o,3),c=(u[o+20>>2]+S(u[o+28>>2])|0)-29|0),p=0,t=b,g=N,m=y,V=w,(0|c)<=(0|B)&&(p=eN(o,3)),function(e,t,r,i,n,o,a,s){var c=0,d=0,h=E(0),p=E(0),f=0,m=E(0),g=E(0),b=0,y=0,R=0,C=0;if(D=c=D-16|0,u[c+8>>2]=0,u[c+12>>2]=0,n?p=E(.149993896484375):(g=A[(d=s<<2)+24832>>2],p=A[d+24848>>2]),(0|t)<(0|r))for(b=(0|a)>1?a:1,y=(u[o+4>>2]<<3)+32|0,f=(v(s,84)+v(n,42)|0)+24496|0;;){for(R=f+(n=((0|t)<20?t:20)<<1)|0,C=(1|n)+f|0,n=0;;){s=(y-u[o+20>>2]|0)-S(u[o+28>>2])|0;a:{if((0|s)>=15){a=function(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0;t:{r:{i:{o=function(e,t){var r=0;return r=u[e+28>>2]>>>t|0,u[e+36>>2]=r,r=(t=1<<t)+(-1^(e=_[e+32>>2]/(r>>>0)|0))|0,t=(e=e+1|0)-t|0,r+(e>>>0<t>>>0?0:t)|0}(e,15);n:{if(o>>>0<t>>>0){s=t,n=0;break n}n=1,s=(i=v(16384-r|0,32736-t|0)>>>15|0)+1|0;a:if(i&&!((c=(a=s<<1)+t|0)>>>0>o>>>0)){for(;;){if(t=c,n=n+1|0,s=(i=v(a-2|0,r)>>>15|0)+1|0,!i)break a;if(!((c=(a=s<<1)+t|0)>>>0<=o>>>0))break}}if(!i&&(t=(-2&(i=o-t|0))+t|0,n=(i>>>1|0)+n|0),(i=(a=o>>>0<(i=t+s|0)>>>0)?t:i)>>>0>=32768)break i;if(i>>>0>o>>>0)break r;n=a?0-n|0:n}if(o>>>0>=(t=(t=i+s|0)>>>0<32768?t:32768)>>>0)break t;return eP(e,i,t,32768),n}e0(24287,24272,128),I()}e0(24314,24272,130),I()}e0(24339,24272,131),I()}(o,l[0|R]<<7,l[0|C]<<6);break a}if((0|s)>=2){a=(a=eO(o,24864,2))>>1^0-(1&a);break a}if(a=-1,(0|s)!=1)break a;a=0-eN(o,1)|0}if(s=(v(u[e+8>>2],n)+t<<2)+i|0,m=A[(d=(c+8|0)+(n<<2)|0)>>2],h=E(0|a),A[s>>2]=E(m+E(g*E(T(A[s>>2],E(-9)))))+h,A[d>>2]=E(m+h)-E(p*h),(0|b)==(0|(n=n+1|0)))break}if((0|r)==(0|(t=t+1|0)))break}D=c+16|0}(t,g,m,V,p,o,M,f),D=V=X=P-((C<<2)+15&-16)|0,p=u[o+4>>2]<<3,m=(u[o+20>>2]+S(u[o+28>>2])|0)-32|0,t=(0|f)!=0&p>>>0>=m+(1|(c=W?2:4))>>>0,k=0,U=(0|y)<=(0|N);er:if(!U){if((P=p-t|0)>>>0>=c+m>>>0&&(k=eN(o,c),m=(u[o+20>>2]+S(u[o+28>>2])|0)-32|0),u[(N<<2)+X>>2]=k,(0|y)==(0|(c=N+1|0)))break er;for(g=W?4:5,p=k;;){if(m+g>>>0<=P>>>0&&(k|=p=eN(o,g)^p,m=(u[o+20>>2]+S(u[o+28>>2])|0)-32|0),u[(c<<2)+X>>2]=p,(0|y)==(0|(c=c+1|0)))break}}c=0;A:if(t&&l[(p=(f<<3)+1664|0)+(k+(m=W<<2)|0)|0]!=l[((2|m)+k|0)+p|0]){c=eN(o,1)<<1}if(!U)for(m=(W<<2)+c|0,g=f<<3,c=N;;){if(u[(p=(c<<2)+X|0)>>2]=s[((u[p>>2]+m|0)+g|0)+1664|0],(0|y)==(0|(c=c+1|0)))break}ef=2,((u[o+20>>2]+S(u[o+28>>2])|0)-28|0)<=(0|B)&&(ef=eO(o,35249,5)),D=p=ec=V-(c=(C<<2)+15&-16)|0,function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,p=0,f=0,_=0;if((0|(n=u[e+8>>2]))>=1)for(p=((r<<1)+i|0)-1|0,f=u[e+104>>2],a=h[(s=u[e+32>>2])>>1];;){if(_=a<<16,a=d[((c=o+1|0)<<1)+s>>1],u[(o<<2)+t>>2]=v(l[(v(n,p)+o|0)+f|0]- -64|0,v(a-(_>>16)<<r,i))>>2,!((0|(o=c))<(0|(n=u[e+8>>2]))))break}}(b,p,f,M),t=6,et=r<<6,eu=V=p-c|0,D=V,p=eq(o);ea:{if(U){m=et;break ea}for(g=N,m=et;;){r=g+1|0,U=g<<2;m:{v:{E:{if(((t<<3)+p|0)<(0|m)){if(c=0,u[(P=U+ec|0)>>2]<=0)break v;g=(p=v(d[(r<<1)+q>>1]-d[(g<<1)+q>>1]|0,M)<<f)<<3,k=(0|(p=(0|p)>48?p:48))>(0|g)?g:p,g=t;break E}u[U+V>>2]=0;break m}for(;;){if(g=eN(o,g),p=eq(o),!g)break v;if(c=c+k|0,(0|(m=m-k|0))<=(p+8|0))break v;if(g=1,!(u[P>>2]>(0|c)))break}}u[U+V>>2]=c,t=(0|c)>0?(0|t)>2?t-1|0:2:t}if((0|y)==(0|(g=r)))break}}P=g=eu-((C<<2)+15&-16)|0,D=g,r=5,(p+48|0)<=(0|m)&&(r=eO(o,35253,7)),m=(0|y)>(0|$),p=(-1^eq(o))+et|0,c=0,q=m?$:y,$=W?el:0,D=t=P=P-(m=(C<<2)+15&-16)|0,eu=t=t-m|0,D=t,m=b,eg=N,eb=y,ey=O+12|0,eC=O+8|0,ek=p;eT:{if(f>>>0<2){U=0,k=0;break eT}if(U=0,k=0,!W)break eT;k=(U=((f<<3)+16|0)<=(0|p))<<3}for(r=function(e,t,r,i,n,o,a,s,c,p,f,_,A,m,E,g,S,b,T){var y=0,R=0,C=0,k=0,w=0,O=0,N=0,P=0,L=0,M=0,x=0,U=0,B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0,K=0,Q=0,z=0,X=0;z=y=D,K=((0|(c=(0|c)>0?c:0))>7)<<3,F=c-K|0,H=u[e+8>>2];t:if((0|m)==2){if((0|(G=l[(r-t|0)+24880|0]))>(0|F)){G=0;break t}W=((0|(c=F-G|0))>7)<<3,F=c-W|0}if(D=y=w=y-(c=(H<<2)+15&-16)|0,D=y=U=y-c|0,D=y=L=y-c|0,M=m<<3,D=j=y-c|0,!(Y=(0|t)>=(0|r)))for(N=E+3|0,O=v((o-E|0)-5|0,m),R=h[(P=u[e+32>>2])+(t<<1)>>1],c=t;;){if(o=R<<16,C=c<<2,k=v(o=(R=d[((y=c+1|0)<<1)+P>>1])-(o>>16)|0,3)<<E<<3>>4,u[L+C>>2]=(0|k)<(0|M)?M:k,u[C+j>>2]=(v(v((-1^c)+r|0,O),o)<<N>>6)-(o<<E==1?M:0),c=y,(0|r)==(0|y))break}V=(Q=u[e+48>>2])-1|0,x=1;a:{for(;;){if(B=x+V>>1,!Y){for(N=v(B,H),C=h[(O=u[e+32>>2])+(r<<1)>>1],P=u[e+52>>2],R=0,c=r,k=0;;){y=(o=v(v((o=C<<16>>16)-(C=d[((c=c-1|0)<<1)+O>>1])|0,m),l[(c+N|0)+P|0])<<E)>>2,k=!k,(0|o)>=4&&(y=(0|(y=u[(c<<2)+j>>2]+y|0))>0?y:0),y=u[(o=c<<2)+i>>2]+y|0;l:{if(!((0|y)<u[o+L>>2]?k:0)){y=(0|(o=u[n+o>>2]))>(0|y)?y:o,k=1;break l}y=(0|y)<(0|M)?0:M,k=0}if(R=R+y|0,!((0|t)<(0|c)))break}if(x=(c=(0|R)>(0|F))?x:B+1|0,(0|x)<=(0|(V=c?B-1|0:V)))continue;if(B=t,Y)break a;for(X=v(x,H),P=v(x-1|0,H),N=h[(V=u[e+32>>2])+(t<<1)>>1],O=u[e+52>>2],B=c=t;;){if(y=N<<16,y=v((N=d[((o=c+1|0)<<1)+V>>1])-(y>>16)|0,m),R=v(y,l[(c+P|0)+O|0])<<E,y=(0|x)>=(0|Q)?u[(c<<2)+n>>2]:v(l[(c+X|0)+O|0],y)<<E>>2,C=R>>2,(0|R)>=4&&(C=(0|(R=u[(c<<2)+j>>2]+C|0))>0?R:0),(0|y)>=1&&(y=(0|(y=u[(c<<2)+j>>2]+y|0))>0?y:0),k=u[(R=c<<2)+i>>2],C=((0|x)>1?k:0)+C|0,u[R+w>>2]=C,y=(y-C|0)+k|0,u[R+U>>2]=(0|y)>0?y:0,B=(0|k)>0?c:B,(0|(c=o))==(0|r))break}break a}if(x=(c=(0|F)<0)?x:B+1|0,!((0|x)<=(0|(V=c?B-1|0:V))))break}B=t}for(i=(0|m)>1,O=64,N=0,P=0;;){er:{if(k=O+N>>1,o=r,R=0,C=0,!Y){for(;;){y=(v(u[U+(c=(o=o-1|0)<<2)>>2],k)>>6)+u[c+w>>2]|0;eo:{if(!((0|y)<u[c+L>>2]?!C:0)){c=(0|(c=u[n+c>>2]))>(0|y)?y:c,C=1;break eo}c=(0|y)<(0|M)?0:M,C=0}if(R=R+c|0,!((0|t)<(0|o)))break}if(N=(c=(0|R)>(0|F))?N:k,O=c?k:O,(0|(P=P+1|0))!=6)continue;for(c=0,R=r,C=0;;){if(k=(0|(o=u[(y=(R=R-1|0)<<2)+w>>2]+(v(u[y+U>>2],N)>>6)|0))>=u[y+L>>2],O=y+f|0,y=(0|(o=C?o:k?o:(0|o)<(0|M)?0:M))<(0|(y=u[n+y>>2]))?o:y,u[O>>2]=y,c=c+y|0,C|=k,!((0|t)<(0|R)))break}break er}if(c=0,N=(y=(0|F)<0)?N:k,O=y?k:O,(0|(P=P+1|0))!=6)continue}break}k=r-1|0;eN:{ea:{if((0|B)>=(0|k)){o=r,y=G;break ea}for(V=t+2|0,U=M+8|0,C=r;;){if(R=d[(y=u[e+32>>2])+(C<<1)>>1],x=R-(N=d[((o=k)<<1)+y>>1])|0,w=u[(k=(j=o<<2)+f|0)>>2],P=((O=F-c|0)>>>0)/(R-(y=d[(t<<1)+y>>1])>>>0)|0,y=v(y-R|0,P)+O+(y-N)|0,R=(w+v(x,P)|0)+((0|y)>0?y:0)|0,(0|R)>=(((0|(y=u[L+j>>2]))>(0|U)?y:U)|0)){v:{E:{if(S){if(!((0|C)<=(0|V)|(v((0|C)>17?(0|b)<(0|C)?9:7:0,x)<<E<<3>>4<(0|R)?(0|o)<=(0|T):0))){em(g,0,1);break v}em(g,1,1);break E}if(!eN(g,1))break v}o=C,y=G;break eN}R=R-8|0,w=u[k>>2],c=c+8|0}if((0|(y=G))>=1&&(y=l[(o-t|0)+24880|0]),R=(0|R)<(0|M)?0:M,u[k>>2]=R,c=((c-(w+G|0)|0)+R|0)+y|0,G=y,!((0|B)<(0|(k=(C=o)-1|0))))break}}F=F+K|0}ey:{eR:{eI:{if((0|t)<(0|o)){ei:{eC:{ed:{S:{b=W;ek:{if((0|y)>=1){if(!S)break S;y=(0|o)>(0|(y=u[a>>2]))?y:o,u[a>>2]=y,eI(g,y-t|0,(o-t|0)+1|0),y=u[a>>2];break ek}u[a>>2]=0,y=0}if(y=(R=(0|y)>(0|t))?0:b,!W|!R)break eC;if(!S)break ed;em(g,u[s>>2],1);break ei}if(y=er(g,(o-t|0)+1|0)+t|0,u[a>>2]=y,y=(R=(0|t)<(0|y))?0:W,!W|!R)break eC}u[s>>2]=eN(g,1);break ei}u[s>>2]=0}for(B=E<<3,U=d[(k=u[e+32>>2])+(t<<1)>>1],O=v(w=((N=(F-c|0)+y|0)>>>0)/((R=d[(o<<1)+k>>1])-U>>>0)|0,U-R|0),R=U,c=t;;){if(C=R<<16,L=(c<<2)+f|0,R=d[((y=c+1|0)<<1)+k>>1],u[L>>2]=u[L>>2]+v(R-(C>>16)|0,w),c=y,(0|o)==(0|y))break}for(c=O+N|0,C=U,y=t;;){if(L=C<<16,w=(y<<2)+f|0,y=(0|c)<(0|(y=(C=d[((R=y+1|0)<<1)+k>>1])-(L>>16)|0))?c:y,u[w>>2]=y+u[w>>2],c=c-y|0,(0|(y=R))==(0|o))break}x=(0|m)>1?4:3,L=0;em:{for(;;){if((0|t)==(0|o))break em;if((0|(R=u[(y=f+(c=t<<2)|0)>>2]))<=-1)break eI;w=U<<16,C=R+L|0,w=(U=d[((N=t+1|0)<<1)+k>>1])-(w>>16)<<E;T:{if((0|w)>=2){P=0,R=(0|(R=C-u[n+c>>2]|0))>0?R:0,O=C-R|0,u[y>>2]=O,C=v(m,w),!(u[s>>2]|((0|w)==2|(0|m)!=2))&&(P=u[a>>2]>(0|t)),P=(C=C+P|0)<<3,g=((0|w)==2?P>>2:0)+v(C,-21)|0,j=O+(t=g+((w=v(d[u[e+56>>2]+(t<<1)>>1]+B|0,C))>>1)|0)|0;eP:{if((0|j)<C<<4){t=(w>>2)+t|0;break eP}if((0|v(C,24))<=(0|j))break eP;t=(w>>3)+t|0}w=c+_|0,C=(((0|(O=((C<<2)+O|0)+t|0))>0?O:0)>>>0)/(C>>>0)>>>3|0,u[w>>2]=C,O=u[y>>2],(0|v(m,C))>O>>3&&(C=O>>i>>3,u[w>>2]=C),C=(0|C)<8?C:8,u[w>>2]=C,u[c+A>>2]=(u[y>>2]+t|0)<=(0|v(C,P)),u[y>>2]=u[y>>2]-v(u[w>>2],M);break T}R=(0|(t=C-M|0))>0?t:0,u[y>>2]=C-R,u[c+_>>2]=0,u[c+A>>2]=1}if(R?(g=t=c+_|0,C=(0|(C=R>>>x|0))<(0|(w=8-(t=u[t>>2])|0))?C:w,u[g>>2]=t+C,t=v(C,M),u[c+A>>2]=(0|t)>=(R-L|0),L=R-t|0):L=0,u[y>>2]<=-1)break eR;if(t=N,!(u[c+_>>2]>-1))break}e0(24984,24941,514),I()}if(u[p>>2]=L,(0|r)>(0|o))for(c=o;;){if(R=(y=c<<2)+_|0,C=u[(t=f+y|0)>>2]>>i>>3,u[R>>2]=C,u[t>>2]!=(0|v(C,M)))break ey;if(u[t>>2]=0,u[A+y>>2]=u[R>>2]<1,(0|(c=c+1|0))==(0|r))break}return D=z,o}e0(24904,24941,391),I()}e0(24953,24941,442),I()}e0(24953,24941,513),I()}e0(25016,24941,524),I()}(m,eg,eb,V,ec,r,ey,eC,ek-k|0,O+4|0,P,g,t,M,f,o,0,0,0),function(e,t,r,i,n,o,a){var s=0,c=0,d=0,l=0,h=E(0);if((0|t)<(0|r))for(l=(0|a)>1?a:1;;){if(a=0,(0|(s=u[(c=(t<<2)+n|0)>>2]))>=1)for(;;){if(s=eB(o,s),d=(v(u[e+8>>2],a)+t<<2)+i|0,h=E(E(0|s)+E(.5)),s=u[c>>2],A[d>>2]=A[d>>2]+E(E(E(h*E(1<<14-s))*E(6103515625e-14))+E(-.5)),(0|l)==(0|(a=a+1|0)))break}if((0|r)==(0|(t=t+1|0)))break}}(b,N,y,w,g,o,M),m=(((0|J)/2|0)-n<<2)- -8192|0;;){if(ep(p=u[(O+24|0)+(c<<2)>>2],(n<<2)+p|0,m),(0|x)==(0|(c=c+1|0)))break}D=c=eu-((p=v(C,M))+15&-16)|0,D=m=c-((v(n,M)<<2)+15&-16)|0,!function(e,t,r,i,n,o,a,c,h,p,f,_,m,g,S,b,T,y,R,C,k,w,O){var N=0,P=0,L=0,M=0,x=0,U=0,B=0,V=0,F=0,j=0,W=E(0),H=E(0),Y=0,K=0,Q=0,X=0,J=0,q=0,Z=0,$=0,ee=0,et=0,er=0,ei=0,en=0,eo=E(0),ea=0,es=0,ec=0,eu=0,el=0,eh=0,ep=0,ef=0,e_=0,eA=0,em=0,ev=0,eE=0,eg=0,eS=0,eb=0,eT=0,ey=0,eR=0,eI=0,eC=0,ek=0,ew=0,eO=0,eN=0,eP=0,eD=0,eL=0,eM=0,ex=0,eU=0,eB=0,eV=0,eF=0,ej=0,eG=0,eW=0,eH=E(0),eY=0,eK=0,eQ=0,ez=0,eX=0,eJ=0,eZ=0,e$=0,e2=0,e1=0,e4=0,e6=0,e3=0,e8=0,e5=0,e9=0,e7=0,te=0,tt=0,tr=0,ti=0,tn=E(0);D=L=x=D-1568|0,U=1,Z=d[(eS=(Q=u[t+32>>2])+(r<<1)|0)>>1]<<y,D=M=F=L-((v(ea=o?2:1,(d[((u[t+8>>2]<<1)+Q|0)-2>>1]<<y)-Z|0)<<2)+15&-16)|0,X=(B=d[(((x=u[t+8>>2])<<1)+Q|0)-2>>1])<<y<<2,es=(0|e)!=0&(0|o)!=0&!_&(0|k)>7,em=!e|es,J=p?1<<y:1;t:{if(es){D=M=j=M-(((U=d[(x<<1)+Q>>1]-B<<y)<<2)+15&-16)|0;break t}j=n+X|0}if(D=M=eb=M-(x=(U<<2)+15&-16)|0,D=M=eT=M-x|0,D=M=ey=M-x|0,D=M=eR=M-x|0,D=ev=M-x|0,u[L+1532>>2]=T,u[L+1540>>2]=0,u[L+1520>>2]=m,u[L+1504>>2]=e,u[L+1512>>2]=t,x=u[C>>2],u[L+1556>>2]=O,u[L+1548>>2]=w,u[L+1524>>2]=f,u[L+1544>>2]=x,e=(0|J)>1,u[L+1560>>2]=e,u[L+1552>>2]=0,u[L+1508>>2]=em,(0|r)<(0|i)){for(e5=o?F:0,e9=(0|f)!=3|e,er=T+28|0,ei=T+8|0,e7=1^em,w=ea-1|0,eI=r+2|0,ec=r+1|0,eC=i-1|0,te=(x=0-Z<<2)+(X=(F+X|0)-(Z<<2)|0)|0,$=x+F|0,ek=-1<<J^-1,eu=r,f=1;;){O=eu,u[L+1516>>2]=O;o:{a:{if(eu=O+1|0,e=d[(Y=(O<<1)+Q|0)>>1]<<y,(0|(x=(d[(eu<<1)+Q>>1]<<y)-e|0))>0){M=S-(eE=eq(T))|0,u[L+1536>>2]=M-1,ew=b-((0|r)==(0|O)?0:eE)|0,K=0;c:if(!((0|R)<=(0|O))){if(b=R-O|0,b=(0|(b=u[(O<<2)+h>>2]+((0|ew)/(((0|b)<3?b:3)|0)|0)|0))>(0|M)?M:b,K=16383,(0|b)>16383)break c;K=(0|b)>0?b:0}b=e<<2,q=!em|(((d[Y>>1]<<y)-x|0)<d[eS>>1]<<y?(0|O)!=(0|ec):0)?q:f?O:q||O,e=o+b|0,eO=(0|O)!=(0|ec);l:if(!eO){if(p=(f=(U=d[(M=u[t+32>>2])+(ec<<1)>>1])-d[(r<<1)+M>>1]<<y)<<2,U=(f<<1)-(M=d[(eI<<1)+M>>1]-U<<y)<<2,ed(F+p|0,F+U|0,M=M-f<<2),!_)break l;ed(p+X|0,U+X|0,M)}ee=o?e:0,k=n+b|0,b=u[(eg=O<<2)+g>>2],u[L+1528>>2]=b,j=(B=u[t+12>>2]>(0|O))?j:0,en=(et=(0|O)==(0|eC))?0:j,V=-1;h:{if(!q){M=e=ek;break h}if(M=e=ek,!((0|b)<0|e9))break h;for(V=(0|(b=((d[(q<<1)+Q>>1]<<y)-Z|0)-x|0))>0?b:0,e=Z+V|0,b=q;;){if(M=b,!(d[((b=b-1|0)<<1)+Q>>1]<<y>(0|e)))break}for(p=e+x|0,f=q-1|0,U=((0|O)<(0|q)?q:O)-1|0;;){$:{if((0|U)==(0|(e=f))){e=U;break $}if(d[((f=e+1|0)<<1)+Q>>1]<<y<(0|p))continue}break}for(U=(0|e)<(0|M)?b:e,e=0,M=0;;){if(e=l[(f=v(b,ea))+a|0]|e,M=l[(f+w|0)+a|0]|M,f=(0|b)!=(0|U),b=b+1|0,!f)break}}if(j=es?j:en,k=B?k:F,p=B?ee:e5,!_)break a;if(!((0|m)!=(0|O)|e7)){if((0|Z)>=(0|(b=d[Y>>1]<<y)))break a;for(B=(0|(b=b-Z|0))>1?b:1,b=0;;){if(A[(U=F+(f=b<<2)|0)>>2]=E(A[U>>2]+A[f+X>>2])*E(.5),(0|B)==(0|(b=b+1|0)))break}break a}if((0|m)==(0|O))break a;f=V<<2,B=(U=(0|V)==-1)?0:F+f|0,b=K>>>1|0;_:{if((0|O)==(0|eC)){V=0,f=U?0:f+X|0,k=G(L+1504|0,k,x,b,J,B,y,0,E(1),j,e);break _}f=U?0:f+X|0,k=G(L+1504|0,k,x,b,J,B,y,(d[Y>>1]<<y<<2)+$|0,E(1),j,e),V=(d[Y>>1]<<y<<2)+te|0}b=G(L+1504|0,p,x,b,J,f,y,V,E(1),j,M);break o}e0(33508,33495,1495),I()}eo:{if(p){if(!(1^es|(0|m)<=(0|O))){for(W=A[c+eg>>2],H=A[(u[t+8>>2]+O<<2)+c>>2],eN=u[T+4>>2],eP=u[T>>2],N=u[(P=ei)+8>>2],b=u[P+12>>2],f=N,u[(N=eD=L+1496|0)>>2]=f,u[N+4>>2]=b,N=u[P+4>>2],f=b=u[P>>2],u[(b=L)+1488>>2]=f,u[b+1492>>2]=N,en=u[T+24>>2],u[(eL=b+1480|0)>>2]=u[er+16>>2],eM=b+1472|0,N=u[(P=er)+8>>2],b=u[P+12>>2],f=N,u[(N=eM)>>2]=f,u[N+4>>2]=b,N=u[P+4>>2],f=b=u[P>>2],u[(b=L)+1464>>2]=f,u[b+1468>>2]=N,ex=b+1408|0,el=b+1560|0,u[ex>>2]=u[el>>2],eU=b+1400|0,N=u[(P=ee=b+1552|0)>>2],b=u[P+4>>2],f=N,u[(N=eU)>>2]=f,u[N+4>>2]=b,b=u[(P=eh=L+1544|0)>>2],N=u[P+4>>2],f=b,u[(b=eB=L+1392|0)>>2]=f,u[b+4>>2]=N,N=u[(P=ep=L+1536|0)>>2],b=u[P+4>>2],f=N,u[(N=eV=L+1384|0)>>2]=f,u[N+4>>2]=b,b=u[(P=ef=L+1528|0)>>2],N=u[P+4>>2],f=b,u[(b=eF=L+1376|0)>>2]=f,u[b+4>>2]=N,N=u[(P=e_=L+1520|0)>>2],b=u[P+4>>2],f=N,u[(N=ej=L+1368|0)>>2]=f,u[N+4>>2]=b,b=u[(P=eA=L+1512|0)>>2],N=u[P+4>>2],f=b,u[(b=eG=L+1360|0)>>2]=f,u[b+4>>2]=N,N=u[(P=L)+1504>>2],b=u[P+1508>>2],f=N,u[(N=P)+1352>>2]=f,u[N+1356>>2]=b,f=ed(eb,k,_=x<<2),U=ed(eT,p,_),u[ee>>2]=-1,b=0,eW=e|M,e=0,eo=E((W<H?W:H)/E(3)),eH=E(H+eo),eo=E(W+eo),W=E(0),V=(0|V)==-1?0:(V<<2)+F|0,e=et?e:(d[Y>>1]<<y<<2)+$|0,tt=z(N+1504|0,k,p,x,K,J,V,y,e,j,eW),H=E(0);;){if(H=E(H+E(A[f+(e=b<<2)>>2]*A[e+k>>2])),(0|x)==(0|(b=b+1|0)))break}for(b=0;;){if(W=E(W+E(A[U+(e=b<<2)>>2]*A[e+p>>2])),(0|x)==(0|(b=b+1|0)))break}for(b=u[(P=T)+40>>2],N=u[P+44>>2],e=b,u[(b=eY=L+1456|0)>>2]=e,u[b+4>>2]=N,b=u[P+36>>2],e=N=u[P+32>>2],u[(N=eK=L+1448|0)>>2]=e,u[N+4>>2]=b,N=u[P+28>>2],e=b=u[P+24>>2],u[(b=eQ=L+1440|0)>>2]=e,u[b+4>>2]=N,b=u[P+20>>2],e=N=u[P+16>>2],u[(N=ez=L+1432|0)>>2]=e,u[N+4>>2]=b,b=u[(P=ei)>>2],N=u[P+4>>2],e=b,u[(b=eX=L+1424|0)>>2]=e,u[b+4>>2]=N,M=N=u[(P=T)>>2],e=b=u[P+4>>2],b=u[(P=eA)>>2],N=u[P+4>>2],P=b,u[(b=eJ=L+1296|0)>>2]=P,u[b+4>>2]=N,N=u[(P=e_)>>2],b=u[P+4>>2],P=N,u[(N=eZ=L+1304|0)>>2]=P,u[N+4>>2]=b,b=u[(P=ef)>>2],N=u[P+4>>2],P=b,u[(b=e$=L+1312|0)>>2]=P,u[b+4>>2]=N,N=u[(P=ep)>>2],b=u[P+4>>2],P=N,u[(N=e2=L+1320|0)>>2]=P,u[N+4>>2]=b,b=u[(P=eh)>>2],N=u[P+4>>2],P=b,u[(b=e1=L+1328|0)>>2]=P,u[b+4>>2]=N,N=u[(P=ee)>>2],b=u[P+4>>2],P=N,u[(N=e4=L+1336|0)>>2]=P,u[N+4>>2]=b,u[(e6=L+1344|0)>>2]=u[el>>2],u[(N=L)+1416>>2]=M,b=e,u[N+1420>>2]=b,P=N,b=u[N+1504>>2],N=u[N+1508>>2],e=b,u[(b=P)+1288>>2]=e,u[b+1292>>2]=N,tr=ed(ey,k,_),ti=ed(eR,p,_),!et&&ed(ev,(d[Y>>1]<<y<<2)+$|0,_),B=ed(L,e3=en+eP|0,e8=eN-en|0),u[T+4>>2]=eN,u[T>>2]=eP,N=u[(P=eD)>>2],b=u[P+4>>2],e=N,u[(N=ei)+8>>2]=e,u[N+12>>2]=b,b=u[(P=B)+1488>>2],N=u[P+1492>>2],e=b,u[(b=ei)>>2]=e,u[b+4>>2]=N,u[T+24>>2]=en,u[er+16>>2]=u[eL>>2],N=u[(P=eM)>>2],b=u[P+4>>2],e=N,u[(N=er)+8>>2]=e,u[N+12>>2]=b,b=u[(P=B)+1464>>2],N=u[P+1468>>2],e=b,u[(b=er)>>2]=e,u[b+4>>2]=N,N=u[(P=eG)>>2],b=u[P+4>>2],e=N,u[(N=eA)>>2]=e,u[N+4>>2]=b,b=u[(P=ej)>>2],N=u[P+4>>2],e=b,u[(b=e_)>>2]=e,u[b+4>>2]=N,N=u[(P=eF)>>2],b=u[P+4>>2],e=N,u[(N=ef)>>2]=e,u[N+4>>2]=b,b=u[(P=eV)>>2],N=u[P+4>>2],e=b,u[(b=ep)>>2]=e,u[b+4>>2]=N,N=u[(P=eB)>>2],b=u[P+4>>2],e=N,u[(N=eh)>>2]=e,u[N+4>>2]=b,b=u[(P=eU)>>2],N=u[P+4>>2],e=b,u[(b=ee)>>2]=e,u[b+4>>2]=N,u[el>>2]=u[ex>>2],N=u[(P=B)+1352>>2],b=u[P+1356>>2],e=N,u[(N=P)+1504>>2]=e,u[N+1508>>2]=b,M=ed(k,f,_),p=ed(p,U,_),!eO&&(e=(k=d[(b=u[t+32>>2])+(ec<<1)>>1])-d[(r<<1)+b>>1]<<y,ed((e<<2)+F|0,((e<<1)-(b=d[(eI<<1)+b>>1]-k<<y)<<2)+F|0,b-e<<2)),u[B+1552>>2]=1,b=0,e=0,H=E(eo*H),W=E(eH*W),tn=E(H+W),W=E(0),e=et?e:(d[Y>>1]<<y<<2)+$|0,k=z(B+1504|0,M,p,x,K,J,V,y,e,j,eW),H=E(0);;){if(H=E(H+E(A[f+(e=b<<2)>>2]*A[e+M>>2])),(0|x)==(0|(b=b+1|0)))break}for(b=0;;){if(W=E(W+E(A[U+(e=b<<2)>>2]*A[e+p>>2])),(0|x)==(0|(b=b+1|0)))break}!(E(E(eo*H)+E(eH*W))<=tn^1)&&(b=u[B+1416>>2],N=u[P+1420>>2],e=b,u[(b=T)>>2]=e,u[b+4>>2]=N,N=u[(P=eY)>>2],b=u[P+4>>2],e=N,u[(N=T)+40>>2]=e,u[N+44>>2]=b,b=u[(P=eK)>>2],N=u[P+4>>2],e=b,u[(b=T)+32>>2]=e,u[b+36>>2]=N,N=u[(P=eQ)>>2],b=u[P+4>>2],e=N,u[(N=T)+24>>2]=e,u[N+28>>2]=b,b=u[(P=ez)>>2],N=u[P+4>>2],e=b,u[(b=T)+16>>2]=e,u[b+20>>2]=N,N=u[(P=eX)>>2],b=u[P+4>>2],e=N,u[(N=ei)>>2]=e,u[N+4>>2]=b,b=u[(P=eJ)>>2],N=u[P+4>>2],e=b,u[(b=eA)>>2]=e,u[b+4>>2]=N,N=u[(P=eZ)>>2],b=u[P+4>>2],e=N,u[(N=e_)>>2]=e,u[N+4>>2]=b,b=u[(P=e$)>>2],N=u[P+4>>2],e=b,u[(b=ef)>>2]=e,u[b+4>>2]=N,N=u[(P=e2)>>2],b=u[P+4>>2],e=N,u[(N=ep)>>2]=e,u[N+4>>2]=b,b=u[(P=e1)>>2],N=u[P+4>>2],e=b,u[(b=eh)>>2]=e,u[b+4>>2]=N,N=u[(P=e4)>>2],b=u[P+4>>2],e=N,u[(N=ee)>>2]=e,u[N+4>>2]=b,u[el>>2]=u[e6>>2],b=u[(P=B)+1288>>2],N=u[P+1292>>2],e=b,u[(b=P)+1504>>2]=e,u[b+1508>>2]=N,ed(M,tr,_),ed(p,ti,_),!et&&ed((d[Y>>1]<<y<<2)+$|0,ev,_),ed(e3,B,e8),k=tt),_=0;break eo}_=0,u[L+1552>>2]=0,b=0,f=(0|V)==-1?0:(V<<2)+F|0,b=et?b:(d[Y>>1]<<y<<2)+$|0,k=z(L+1504|0,k,p,x,K,J,f,y,b,j,e|M);break eo}_=0,b=0,f=(0|V)==-1?0:(V<<2)+F|0,b=et?b:(d[Y>>1]<<y<<2)+$|0,k=G(L+1504|0,k,x,K,J,f,y,b,E(1),j,e|M)}b=k}if(s[a+(e=v(O,ea))|0]=k,s[(e+w|0)+a|0]=b,b=u[h+eg>>2],u[L+1560>>2]=0,b=(eE+ew|0)+b|0,f=x<<3<(0|K),(0|i)==(0|eu))break}x=u[L+1544>>2]}u[C>>2]=x,D=L+1568|0}(0,b,N,y,m,(0|M)==2?(n<<2)+m|0:0,c,0,P,$,ef,u[O+8>>2],u[O+12>>2],X,et-k|0,u[O+4>>2],o,f,r,e+40|0,0,u[e+36>>2],u[e+32>>2]);eI:{if(U){if(k=eB(o,1),eA(b,N,y,w,g,t,((B-u[o+20>>2]|0)-S(u[o+28>>2])|0)+32|0,o,M),!k)break eI;(function(e,t,r,i,n,o,a,s,c,h,p,f,_,m){var g=0,S=E(0),b=0,y=E(0),I=0,C=0,k=E(0),w=0,O=0,N=0,P=0,D=E(0),L=0,M=0,x=0,U=0,B=0,V=E(0),F=0,j=E(0),G=0,W=0;if((0|a)<(0|s))for(M=(0|(g=1<<i))>1?g:1,x=(0|n)>1?n:1,U=(0|i)==3,B=(0|i)==31;;){for(g=u[e+32>>2],a=(I=a)+1|0,N=I<<1,P=(w=d[g+(a<<1)>>1]-d[N+g>>1]|0)<<i,V=E(E(1)/E(R(+(0|P)))),D=E(E(eh(.6931471805599453*+E(E((u[(I<<2)+f>>2]+1>>>0)/(w>>>0)>>>i|0)*E(-.125))))*E(.5)),F=v(n,I),C=0;;){S=A[(g=v(C,b=u[e+8>>2])+I<<2)+p>>2],y=A[h+g>>2],j=A[c+g>>2],(0|n)==1&&(S=S>(k=A[(b=b+I<<2)+p>>2])?S:k,y=y>(k=A[h+b>>2])?y:k),G=eh(-.6931471805599453*+E(T(E(j-(S>y?y:S)),E(0))));a:if(!B){for(L=((v(o,C)<<2)+t|0)+(d[u[e+32>>2]+N>>1]<<i<<2)|0,W=(C+F|0)+r|0,S=E(G),S=E(S+S),S=U?E(S*E(1.4142135381698608)):S,S=E(V*(S>D?D:S)),y=E(-S),O=0,b=0;;){O=(g=l[0|W]>>>b&1)?O:1;c:if(!g){if(g=0,(0|w)<1)break c;for(;;){if(_=v(_,1664525)+0x3c6ef35f|0,A[((g<<i)+b<<2)+L>>2]=32768&_?S:y,O=1,(0|w)==(0|(g=g+1|0)))break}}if((0|M)==(0|(b=b+1|0)))break}if(!O)break a;eV(L,P,E(1),m)}if((0|x)==(0|(C=C+1|0)))break}if((0|a)==(0|s))break}})(b,m,c,f,M,n,N,y,w,F,Y,P,u[e+40>>2],u[e+36>>2]);break eI}eA(b,N,y,w,g,t,((B-u[o+20>>2]|0)-S(u[o+28>>2])|0)+32|0,o,M)}if(!(1^ev|(0|p)<1))for(c=0;;){if(u[(c<<2)+w>>2]=-0x3e200000,(0|p)==(0|(c=c+1|0)))break}for(eo(b,m,O+16|0,w,N,q,M,H,W,f,u[e+16>>2],K,u[e+36>>2]),c=0;;){if(m=(0|(p=u[e+60>>2]))>15?p:15,u[e+60>>2]=m,g=(0|(p=u[e+64>>2]))>15?p:15,u[e+64>>2]=g,ei(p=u[(O+16|0)+(c<<2)>>2],p,g,m,u[b+44>>2],A[e+72>>2],A[e+68>>2],u[e+80>>2],u[e+76>>2],u[b+60>>2],J,u[e+36>>2]),f&&ei(p=((m=u[b+44>>2])<<2)+p|0,p,u[e+60>>2],es,n-m|0,A[e+68>>2],L,u[e+76>>2],en,u[b+60>>2],J,u[e+36>>2]),(0|x)==(0|(c=c+1|0)))break}u[e+64>>2]=u[e+60>>2],c=u[e+68>>2],A[e+68>>2]=L,u[e+72>>2]=c,c=u[e+76>>2],u[e+76>>2]=en,u[e+80>>2]=c,u[e+60>>2]=es,f&&(u[e+80>>2]=en,A[e+72>>2]=L,u[e+64>>2]=es),(0|M)==1&&ed(w+(f=C<<2)|0,w,f);el:{if(W){if((0|C)<1)break el;for(p=(0|Z)>1?Z:1,f=0;;){if(L=A[(x=F+(c=f<<2)|0)>>2],j=A[c+w>>2],A[x>>2]=L<j?L:j,(0|(f=f+1|0))==(0|p))break}break el}if(ed(Y,F,f=C<<3),ed(F,w,f),(0|C)<1)break el;for(ew=u[e+52>>2]<10?E(E(0|el)*E(.0010000000474974513)):E(1),p=(0|Z)>1?Z:1,f=0;;){if(L=E(ew+A[(x=e_+(c=f<<2)|0)>>2]),j=A[c+w>>2],A[x>>2]=L<j?L:j,(0|(f=f+1|0))==(0|p))break}}if(f=0,(0|N)>0)for(;;){if(u[w+(c=f<<2)>>2]=0,u[c+Y>>2]=-0x3e200000,u[c+F>>2]=-0x3e200000,(0|N)==(0|(f=f+1|0)))break}if((0|y)<(0|C))for(f=y;;){if(u[w+(c=f<<2)>>2]=0,u[c+Y>>2]=-0x3e200000,u[c+F>>2]=-0x3e200000,(0|C)==(0|(f=f+1|0)))break}if(f=0,(0|N)>0)for(;;){if(u[w+(c=f+C<<2)>>2]=0,u[c+Y>>2]=-0x3e200000,u[c+F>>2]=-0x3e200000,(0|N)==(0|(f=f+1|0)))break}if((0|y)<(0|C))for(;;){if(u[w+(f=y+C<<2)>>2]=0,u[f+Y>>2]=-0x3e200000,u[f+F>>2]=-0x3e200000,(0|C)==(0|(y=y+1|0)))break}u[e+40>>2]=u[o+28>>2],ea(O+16|0,i,n,H,u[e+16>>2],b+16|0,e+84|0,a),u[e+52>>2]=0,m=-3,((u[o+20>>2]+S(u[o+28>>2])|0)-32|0)<=(0|B)&&(u[o+44>>2]&&(u[e+44>>2]=1),m=(0|n)/u[e+16>>2]|0)}return D=O+80|0,m}function F(e,t,r,i,n,o,a,s,c,l,h){var p=0,f=0,_=0,m=0,b=E(0),T=E(0),C=0,k=0,w=0,O=0,N=E(0),P=0,D=0,L=0,M=0;P=u[e+36>>2],m=u[e+28>>2],f=u[e+16>>2],D=u[e>>2],p=1,w=u[o>>2],L=u[e+8>>2],O=u[e+12>>2],_=(w-(c=d[u[L+56>>2]+(O<<1)>>1]+(c<<3)|0)|0)-32|0,C=c>>1,c=(0|n)==2&(0|l)!=0;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{l:{h:if(!((0|(c=(0|(c=(0|(c=(v(C=C+(c?-16:-4)|0,c=(n<<1)+(c?-2:-1)|0)+w|0)/(0|c)|0))>(0|_)?_:c))<64?c:64))>=4)||!((0|(p=(d[((7&c)<<1)+33760>>1]>>14-(c>>>3|0))+1&-2))>=257)){p=(0|f)>(0|O)?p:l?1:p;Z:{p:{$:{if(D){if(c=function(e,t,r,i,n){var o=E(0),a=E(0),s=E(0),c=E(0),d=E(0);t:{if(r){if(a=E(10000000036274937e-31),(0|i)<1){o=E(10000000036274937e-31);break t}for(r=0,o=E(10000000036274937e-31);;){if(s=A[(n=r<<2)+e>>2],d=E(s-(c=A[t+n>>2])),o=E(o+E(d*d)),s=E(s+c),a=E(a+E(s*s)),(0|i)==(0|(r=r+1|0)))break}break t}if((0|i)<1){o=E(10000000036274937e-31),a=E(10000000036274937e-31);break t}for(r=0;;){if(a=E(a+E((o=A[(r<<2)+e>>2])*o)),(0|i)==(0|(r=r+1|0)))break}for(a=E(a+E(10000000036274937e-31)),r=0,o=E(0);;){if(o=E(o+E((s=A[(r<<2)+t>>2])*s)),(0|i)==(0|(r=r+1|0)))break}o=E(o+E(10000000036274937e-31))}c=E(R(o)),o=E(c*c),d=E(R(a)),a=E(d*d),s=E(0);c:if(!(E(o+a)<E(1000000045813705e-33))){if(s=E(E(1.5707963705062866)-E(E(E(c*d)*E(o+E(a*E(.43157973885536194))))/E(E(o+E(a*E(.6784840226173401)))*E(o+E(a*E(.0859554186463356)))))),!(o>a^1))break c;s=E(E(E(E(E(c*d)*E(a+E(o*E(.43157973885536194))))/E(E(a+E(o*E(.6784840226173401)))*E(a+E(o*E(.0859554186463356)))))+E(1.5707963705062866))+E(-1.5707963705062866))}return(a=E(y(E(E(s*E(10430.3818359375))+E(.5)))),E(g(a))<E(0x80000000))?~~a:-0x80000000}(r,i,l,n,u[e+44>>2]),w=eq(m),(0|p)==1)break Z;f:{et:{if(l){if(e=u[e+48>>2])break et;e=v(c,p)- -8192>>14;break f}f=(_=(c=v(c,p))- -8192|0)>>14;_:{if((0|f)>=(0|p)||(0|c)<8192||!u[e+56>>2]){e=f;break _}if(c=v((_=((-16384&_)>>>0)/((e=p)>>>0)<<16)>>13,_>>16)+32768>>16,C=S(k=((v(c,((v((v(c,-626)+16384>>15)+8277|0,c)<<1)+32768&-65536)-0x1de30000>>16)+16384>>>15|0)-c<<16)- -0x80000000>>16),c=v((c=0x40000000-_|0)>>13,c>>16)+32768>>16,_=S(c=((v(c,((v((v(c,-626)+16384>>15)+8277|0,c)<<1)+32768&-65536)-0x1de30000>>16)+16384>>>15|0)-c<<16)- -0x80000000>>16),k=k<<C-17<<16>>16,c=c<<_-17<<16>>16,c=v((C-_<<11)-(v(k,(v(k,-2597)+16384>>15)+7932|0)+16384>>>15|0)+(v(c,(v(c,-2597)+16384>>15)+7932|0)+16384>>>15)<<16>>16,(n<<23)-8388608>>16)+16384>>15,(0|c)>(0|(_=u[o>>2])))break _;e=(0-_|0)>(0|c)?0:f}if((0|s)<2)break $;break d}e=((-1^e)>>>31|0)+((0|(c=(0|(c=v(c,p)+((((0|c)>8192?32767:-32767)|0)/(0|p)|0)|0))<0?0:c>>14))<(0|p)?c:p-1|0)|0}if((0|n)<=2)break d;f=v(c=(0|p)/2|0,3)+3|0,_=v(e,3),e_(m,(s=(0|e)>(0|c))?(f+(-1^c)|0)+e|0:_,s?(f-c|0)+e|0:_+3|0,c+f|0);break c}if(w=eq(m),(0|p)==1)break l;if(!(!l|(0|n)<3)){C=m,f=v(s=(c=(0|p)/2|0)+1|0,3),e=eZ(m,_=c+f|0);eb:{if((0|f)>(0|e)){e=(0|e)/3|0;break eb}e=e-(s<<1)|0}s=v(e,3),eP(C,(k=(0|e)>(0|c))?((-1^c)+f|0)+e|0:s,k?(f-c|0)+e|0:s+3|0,_);break c}if(l?0:(0|s)<=1)break p;e=er(m,p+1|0);break c}C=(k=p-e|0)+1|0,M=e+1|0,s=(_=(0|(c=p>>1))<(0|e))?C:M,f=v(c=c+1|0,c),e_(m,c=_?f-(v(k+2|0,C)>>1)|0:v(e,M)>>1,s+c|0,f);break c}s=m,e=eZ(m,i=v(l=(r=p>>1)+1|0,l));eD:{if((0|e)<v(r,l)>>1){r=v(e=(l=ez(e<<3|1)-1>>>1|0)+1|0,l)>>>1|0;break eD}r=l=p+1|0,e=r-(l=(l<<1)-ez((-1^e)+i<<3|1)>>>1|0)|0,r=i-(v(e,(p-l|0)+2|0)>>1)|0}eP(s,r,e+r|0,i),c=(l<<14>>>0)/(p>>>0)|0;break o}if(!l)break o;l=0,f=0;v:if(!((0|c)<8193)&&!(p=u[e+52>>2])){if(f=1,(0|n)<1)break v;for(f=!p,p=0;;){if(A[(c=(p<<2)+i|0)>>2]=-A[c>>2],(0|(p=p+1|0))==(0|n))break}}if((0|n)<1)break u;for(b=A[(O<<2)+P>>2],T=A[(u[L+8>>2]+O<<2)+P>>2],N=E(E(R(E(E(E(b*b)+E(10000000036274937e-31))+E(T*T))))+E(10000000036274937e-31)),T=E(T/N),b=E(b/N);;){if(A[(c=(p=l<<2)+r|0)>>2]=E(b*A[c>>2])+E(T*A[i+p>>2]),(0|(l=l+1|0))==(0|n))break}break u}e0(33776,33495,669),I()}if(f=0,!l)break s}n=0;es:if(!(u[o>>2]<17)){if(n=0,u[e+32>>2]<17)break es;if(D){em(m,f,2),n=f;break es}n=eN(m,2)}f=u[e+52>>2]?0:n;break s}eI(m,e,p+1|0)}if((0|e)<=-1)break a;if(e<<=14,c=(e>>>0)/(p>>>0)|0,!l|!D)break o;if(e>>>0<p>>>0){if(f=0,(0|n)<1)break s;for(b=A[(O<<2)+P>>2],T=A[(u[L+8>>2]+O<<2)+P>>2],N=E(E(R(E(E(E(b*b)+E(10000000036274937e-31))+E(T*T))))+E(10000000036274937e-31)),T=E(T/N),b=E(b/N),l=0;;){if(A[(p=r+(e=l<<2)|0)>>2]=E(b*A[p>>2])+E(T*A[e+i>>2]),(0|(l=l+1|0))==(0|n))break}break s}if((0|n)<1)break o;for(l=0;;){if(T=E(A[(p=r+(e=l<<2)|0)>>2]*E(.7071067690849304)),b=E(A[(e=e+i|0)>>2]*E(.7071067690849304)),A[p>>2]=T+b,A[e>>2]=b-T,(0|(l=l+1|0))==(0|n))break}break o}e=(n=eq(m))-w|0,u[o>>2]=u[o>>2]-e;break n}e0(33720,33495,838),I()}if(e=(l=eq(m))-w|0,u[o>>2]=u[o>>2]-e,l=16384,(0|c)==16384)break i;if(c)break r;f=c}u[h>>2]=u[h>>2]&(-1<<a^-1),n=-16384,i=32767,l=0,r=0;break t}u[h>>2]=u[h>>2]&(-1<<a^-1)<<a,r=32767,f=0,i=0,n=16384;break t}l=v((r=c<<16)>>13,r>>16)+32768>>16,p=S(i=((v(l,((v((v(l,-626)+16384>>15)+8277|0,l)<<1)+32768&-65536)-0x1de30000>>16)+16384>>>15|0)-l<<16)- -0x80000000>>16),l=v((l=0x40000000-r|0)>>13,l>>16)+32768>>16,o=p-(l=S(r=((v(l,((v((v(l,-626)+16384>>15)+8277|0,l)<<1)+32768&-65536)-0x1de30000>>16)+16384>>>15|0)-l<<16)- -0x80000000>>16))<<11,p=i<<p-17<<16>>16,l=r<<l-17<<16>>16,n=v(o-(v(p,(v(p,-2597)+16384>>15)+7932|0)+16384>>>15|0)+(v(l,(v(l,-2597)+16384>>15)+7932|0)+16384>>>15)<<16>>16,(n<<23)-8388608>>16)+16384>>15,f=0,l=c}u[t+20>>2]=e,u[t+16>>2]=l,u[t+12>>2]=n,u[t+8>>2]=r,u[t+4>>2]=i,u[t>>2]=f}function j(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,S=0,b=0,T=0,y=0;for(T=h=D,a=u[e+268>>2],D=h=h-((a+(c=u[e+276>>2])<<2)+15&-16)|0,f=ed(h,g=e+24|0,c<<2),S=(h=u[e+296>>2])+4|0,m=u[e+272>>2],o=h;;){(function(e,t,r,i,n){var o=0,a=0,s=0,c=0,l=0;if((0|n)>=1)for(o=u[e>>2],a=d[i+2>>1],s=d[i>>1],i=0;;){if(o=(d[(i<<1)+r>>1]<<8)+o|0,u[(i<<2)+t>>2]=o,l=u[e+4>>2],o<<=2,c=65532&o,o>>=16,u[e+4>>2]=(v(c,a)>>16)+v(a,o),o=(v(o,s)+l|0)+(v(s,c)>>16)|0,u[e>>2]=o,(0|n)==(0|(i=i+1|0)))break}})(e,(c<<2)+f|0,r,o,_=(0|i)<(0|a)?i:a),A=_<<16;r:{i:{n:{o:{switch((E=u[e+276>>2])-18|0){case 18:break i;case 6:break o;case 0:break;default:break n}if((0|A)<1)break r;for(y=(b=u[e+280>>2])<<16>>16,o=0;;){if(s=v(65535&o,y)>>16,l=d[(c=v(s,18)+S|0)>>1],p=(v(l,65535&(n=u[(a=(o>>16<<2)+f|0)>>2]))>>16)+v(n>>16,l)|0,l=d[c+2>>1],p=(p+v(l,(n=u[a+4>>2])>>16)|0)+(v(65535&n,l)>>16)|0,l=d[c+4>>1],p=(p+v(l,(n=u[a+8>>2])>>16)|0)+(v(65535&n,l)>>16)|0,l=d[c+6>>1],p=(p+v(l,(n=u[a+12>>2])>>16)|0)+(v(65535&n,l)>>16)|0,l=d[c+8>>1],p=(p+v(l,(n=u[a+16>>2])>>16)|0)+(v(65535&n,l)>>16)|0,l=d[c+10>>1],p=(p+v(l,(n=u[a+20>>2])>>16)|0)+(v(65535&n,l)>>16)|0,l=d[c+12>>1],p=(p+v(l,(n=u[a+24>>2])>>16)|0)+(v(65535&n,l)>>16)|0,l=d[c+14>>1],l=(p+v(l,(n=u[a+28>>2])>>16)|0)+(v(65535&n,l)>>16)|0,c=d[c+16>>1],l=(l+v(c,(n=u[a+32>>2])>>16)|0)+(v(65535&n,c)>>16)|0,s=d[(c=v((-1^s)+b|0,18)+S|0)>>1],l=(l+v(s,(n=u[a+68>>2])>>16)|0)+(v(65535&n,s)>>16)|0,s=d[c+2>>1],l=(l+v(s,(n=u[a+64>>2])>>16)|0)+(v(65535&n,s)>>16)|0,s=d[c+4>>1],l=(l+v(s,(n=u[a+60>>2])>>16)|0)+(v(65535&n,s)>>16)|0,s=d[c+6>>1],l=(l+v(s,(n=u[a+56>>2])>>16)|0)+(v(65535&n,s)>>16)|0,s=d[c+8>>1],l=(l+v(s,(n=u[a+52>>2])>>16)|0)+(v(65535&n,s)>>16)|0,s=d[c+10>>1],l=(l+v(s,(n=u[a+48>>2])>>16)|0)+(v(65535&n,s)>>16)|0,s=d[c+12>>1],l=(l+v(s,(n=u[a+44>>2])>>16)|0)+(v(65535&n,s)>>16)|0,s=d[c+14>>1],n=u[a+40>>2],c=d[c+16>>1],a=u[a+36>>2],c=((a=(((l+v(s,n>>16)|0)+(v(65535&n,s)>>16)|0)+v(c,a>>16)|0)+(v(65535&a,c)>>16)|0)>>5)+1>>1,d[t>>1]=(0|a)>2097119?32767:(0|c)>-32768?c:-32768,t=t+2|0,!((0|A)>(0|(o=o+m|0))))break}break r}if(c=0,(0|A)<=0)break r;for(;;){if(n=d[h+4>>1],s=(v(n,65535&(o=u[(a=(c>>16<<2)+f|0)+92>>2]+u[a>>2]|0))>>16)+v(o>>16,n)|0,n=d[h+6>>1],s=(s+v(n,(o=u[a+88>>2]+u[a+4>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+8>>1],s=(s+v(n,(o=u[a+84>>2]+u[a+8>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+10>>1],s=(s+v(n,(o=u[a+80>>2]+u[a+12>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+12>>1],s=(s+v(n,(o=u[a+76>>2]+u[a+16>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+14>>1],s=(s+v(n,(o=u[a+72>>2]+u[a+20>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+16>>1],s=(s+v(n,(o=u[a+68>>2]+u[a+24>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+18>>1],s=(s+v(n,(o=u[a+64>>2]+u[a+28>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+20>>1],s=(s+v(n,(o=u[a+60>>2]+u[a+32>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+22>>1],s=(s+v(n,(o=u[a+56>>2]+u[a+36>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+24>>1],n=(s+v(n,(o=u[a+52>>2]+u[a+40>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,o=d[h+26>>1],o=((a=(n+v(o,(a=u[a+48>>2]+u[a+44>>2]|0)>>16)|0)+(v(65535&a,o)>>16)|0)>>5)+1>>1,d[t>>1]=(0|a)>2097119?32767:(0|o)>-32768?o:-32768,t=t+2|0,!((0|A)>(0|(c=c+m|0))))break}break r}e0(2704,2724,139),I()}if(c=0,(0|A)<=0)break r;for(;;){if(n=d[h+4>>1],s=(v(n,65535&(o=u[(a=(c>>16<<2)+f|0)+140>>2]+u[a>>2]|0))>>16)+v(o>>16,n)|0,n=d[h+6>>1],s=(s+v(n,(o=u[a+136>>2]+u[a+4>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+8>>1],s=(s+v(n,(o=u[a+132>>2]+u[a+8>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+10>>1],s=(s+v(n,(o=u[a+128>>2]+u[a+12>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+12>>1],s=(s+v(n,(o=u[a+124>>2]+u[a+16>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+14>>1],s=(s+v(n,(o=u[a+120>>2]+u[a+20>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+16>>1],s=(s+v(n,(o=u[a+116>>2]+u[a+24>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+18>>1],s=(s+v(n,(o=u[a+112>>2]+u[a+28>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+20>>1],s=(s+v(n,(o=u[a+108>>2]+u[a+32>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+22>>1],s=(s+v(n,(o=u[a+104>>2]+u[a+36>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+24>>1],s=(s+v(n,(o=u[a+100>>2]+u[a+40>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+26>>1],s=(s+v(n,(o=u[a+96>>2]+u[a+44>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+28>>1],s=(s+v(n,(o=u[a+92>>2]+u[a+48>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+30>>1],s=(s+v(n,(o=u[a+88>>2]+u[a+52>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+32>>1],s=(s+v(n,(o=u[a+84>>2]+u[a+56>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+34>>1],s=(s+v(n,(o=u[a+80>>2]+u[a+60>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,n=d[h+36>>1],n=(s+v(n,(o=u[a+76>>2]+u[a+64>>2]|0)>>16)|0)+(v(65535&o,n)>>16)|0,o=d[h+38>>1],o=((a=(n+v(o,(a=u[a+72>>2]+u[a+68>>2]|0)>>16)|0)+(v(65535&a,o)>>16)|0)>>5)+1>>1,d[t>>1]=(0|a)>2097119?32767:(0|o)>-32768?o:-32768,t=t+2|0,!((0|A)>(0|(c=c+m|0))))break}}if((0|(i=i-_|0))>=2){ed(f,(_<<2)+f|0,E<<2),r=(_<<1)+r|0,o=u[e+296>>2],c=u[e+276>>2],a=u[e+268>>2];continue}break}ed(g,(_<<2)+f|0,E<<2),D=T}function G(e,t,r,i,n,o,a,s,c,h,p){var f=0,m=0,S=0,b=0,T=0,C=E(0),k=E(0),w=0,O=0,N=0,P=0,L=0,M=0,x=0,U=0;L=(r>>>0)/(n>>>0)|0,x=u[e>>2];t:{if((0|r)==1){if(o=0,u[e+32>>2]>=8){h=u[e+28>>2];n:{if(x){eL(h,o=A[t>>2]<E(0),1);break n}o=eB(h,1)}u[e+32>>2]=u[e+32>>2]-8}if(u[e+4>>2]&&(A[t>>2]=o?E(-1):E(1)),p=1,!s)break t;return u[s>>2]=u[t>>2],1}f=(0|(P=u[e+24>>2]))>0;s:{if(!o||!h||!((0|P)>0|(0|n)>1|!(1&L)&(0|P)!=0)){h=o;break s}ed(h,o,r<<2)}if(O=f?P:0,(0|P)>=1)for(;;){q:{if(x){if((0|m)==31)break q;for(N=(0|(o=(T=r>>m)>>1))>1?o:1,w=(b=1<<m)<<1,f=0;;){if(o=0,(0|T)>=2)for(;;){if(M=S=(v(o,w)+f<<2)+t|0,C=E(A[S>>2]*E(.7071067690849304)),k=E(A[(S=(((o<<1|1)<<m)+f<<2)+t|0)>>2]*E(.7071067690849304)),A[M>>2]=C+k,A[S>>2]=C-k,(0|N)==(0|(o=o+1|0)))break}if((0|b)==(0|(f=f+1|0)))break}}if(!h|(0|m)==31)break q;for(N=(0|(o=(T=r>>m)>>1))>1?o:1,w=(b=1<<m)<<1,f=0;;){if(o=0,(0|T)>=2)for(;;){if(M=S=(v(o,w)+f<<2)+h|0,C=E(A[S>>2]*E(.7071067690849304)),k=E(A[(S=(((o<<1|1)<<m)+f<<2)+h|0)>>2]*E(.7071067690849304)),A[M>>2]=C+k,A[S>>2]=C-k,(0|N)==(0|(o=o+1|0)))break}if((0|b)==(0|(f=f+1|0)))break}}if(p=l[(15&p)+33536|0]|l[(p>>4)+33536|0]<<2,(0|O)==(0|(m=m+1|0)))break}m=n>>O,T=L<<O;_:{if(!(1&T|(0|P)>-1)){for(L=P;;){if(!(!x|(0|m)<1))for(N=(0|(o=T>>1))>1?o:1,w=m<<1,f=0;;){if(o=0,(0|T)>=2)for(;;){if(b=S=(v(o,w)+f<<2)+t|0,C=E(A[S>>2]*E(.7071067690849304)),k=E(A[(S=(v(o<<1|1,m)+f<<2)+t|0)>>2]*E(.7071067690849304)),A[b>>2]=C+k,A[S>>2]=C-k,(0|N)==(0|(o=o+1|0)))break}if((0|m)==(0|(f=f+1|0)))break}if(b=T>>1,!(!h|(0|m)<1))for(N=(0|b)>1?b:1,w=m<<1,f=0;;){if(o=0,(0|T)>=2)for(;;){if(M=S=(v(o,w)+f<<2)+h|0,C=E(A[S>>2]*E(.7071067690849304)),k=E(A[(S=(v(o<<1|1,m)+f<<2)+h|0)>>2]*E(.7071067690849304)),A[M>>2]=C+k,A[S>>2]=C-k,(0|N)==(0|(o=o+1|0)))break}if((0|m)==(0|(f=f+1|0)))break}if(U=U+1|0,o=m<<1,p=p<<m|p,2&T)break _;if(f=(0|L)<-1,L=L+1|0,m=o,T=b,!f)break}break _}b=T,o=m}f=(0|n)==1;v:if(!((0|o)<2)){if(x&&eC(t,b>>O,o<<O,f),!h)break v;eC(h,b>>O,o<<O,f)}if(p=function e(t,r,i,n,o,a,s,c,h){var p=0,f=0,m=0,S=0,b=0,T=0,C=0,k=E(0),w=E(0),O=0,N=0,P=0,L=0;D=b=D-32|0,u[b+24>>2]=h,u[b+28>>2]=n,p=u[t+8>>2],p=l[0|(f=u[p+100>>2]+d[u[p+96>>2]+(u[t+12>>2]+v(u[p+8>>2],s+1|0)<<1)>>1]|0)],C=-1,O=u[t+28>>2],N=u[t+20>>2],P=u[t>>2];t:{if(!((0|s)==-1|(0|i)<3|(l[p+f|0]+12|0)>=(0|n))){p=s-1|0,i=((n=i>>>1|0)<<2)+r|0,(0|o)==1&&(u[b+24>>2]=1&h|h<<1),F(t,b,r,i,n,b+28|0,T=o+1>>1,o,p,0,b+24|0),k=E(u[b+8>>2]),w=E(u[b+4>>2]),h=u[b+20>>2],f=u[b+12>>2],C=u[b+16>>2],m=f;n:if(!(!(16383&C)|(0|o)<2)){if(m=f-(f>>5-s)|0,(0|C)>=8193)break n;m=(s=(n<<3>>6-s)+f|0)&s>>31}if(f=m,k=E(k*E(30517578125e-15)),w=E(w*E(30517578125e-15)),s=u[b+28>>2],h=u[t+32>>2]-h|0,u[t+32>>2]=h,S=a?(n<<2)+a|0:0,f=(s-f|0)/2|0,f=(0|(f=(0|s)<(0|f)?s:f))>0?f:0,(0|(s=s-f|0))<=(0|f)){m=u[b+24>>2],r=e(t,r,n,f,T,a,p,E(w*c),m),f=(u[t+32>>2]-h|0)+f|0,p=r|e(t,i,n,(C&&(0|f)>24?f-24|0:0)+s|0,T,S,p,E(k*c),m>>T)<<(o>>1);break t}m=u[b+24>>2],i=e(t,i,n,s,T,S,p,E(k*c),m>>T),s=(u[t+32>>2]-h|0)+s|0,p=e(t,r,n,((0|C)!=16384&&(0|s)>24?s-24|0:0)+f|0,T,a,p,E(w*c),m)|i<<(o>>1);break t}m=p=(n=(0|(s=n-1|0))>l[(S=p+1>>>1|0)+f|0])?p:S,m=(p=l[f+(n=((S=n?S:0)+p|0)+1>>>1|0)|0]<(0|s))?m:n,p=(S=l[f+(n=(m+(p=p?n:S)|0)+1>>>1|0)|0]<(0|s))?n:p,p=(S=l[f+(n=(p+(m=S?m:n)|0)+1>>>1|0)|0]<(0|s))?n:p,L=m=(S=l[f+(n=(p+(m=S?m:n)|0)+1>>1)|0]<(0|s))?m:n,p=(m=l[f+(n=(m+(S=S?n:p)|0)+1>>1)|0]<(0|s))?L:n,(n=m?n:S)&&(C=l[n+f|0]),(n=(s-C|0)>(l[p+f|0]-s|0)?p:n)&&(T=l[n+f|0]+1|0),p=u[t+32>>2]-T|0,u[t+32>>2]=p;d:{u:{if((0|p)>-1||(0|n)<1){s=n;break u}for(;;){if(p=p+T|0,u[t+32>>2]=p,!(s=n-1|0)){u[t+32>>2]=p;break d}if(p=p-(T=l[s+f|0]+1|0)|0,u[t+32>>2]=p,(0|p)>-1)break u;if(C=(0|n)>1,n=s,!C)break}}if(!s)break d;if(s=(0|s)>=8?(7&s|8)<<(s>>>3|0)-1:s,P){p=function(e,t,r,i,n,o,a,s,c){var d=0,l=0,h=E(0);l=c=D;t:{if((0|r)>0){if((0|t)<=1)break t;if(D=c=c-((t<<2)+27&-16)|0,J(e,t,1,n,r,i),h=function(e,t,r,i,n){var o=0,a=E(0),s=E(0),c=0,d=E(0),l=E(0),h=0,p=0,f=E(0),_=0,m=0,v=E(0),S=0,b=E(0);for(S=n=D,D=n=n-(o=(i<<2)+15&-16)|0,D=_=n-o|0,p=eE(n,0,(h=(0|i)>1?i:1)<<2),n=0;;){if(a=A[(c=(o=n<<2)+e|0)>>2],u[o+_>>2]=a<E(0),A[c>>2]=g(a),u[t+o>>2]=0,(0|h)==(0|(n=n+1|0)))break}if(a=E(0),(0|r)>i>>1){for(n=0;;){if(a=E(a+A[(n<<2)+e>>2]),(0|h)==(0|(n=n+1|0)))break}for(!(a<E(64)?!(a>E(10000000036274937e-31)^1):0)&&(u[e>>2]=0x3f800000,eE(e+4|0,0,(((0|i)>2?i:2)<<2)-4|0),a=E(1)),d=E(E(E(0|r)+E(.800000011920929))*E(E(1)/a)),o=0,a=E(0);;){m=(c=o<<2)+t|0,s=E(y(E(d*(l=A[e+c>>2]))));s:{if(E(g(s))<E(0x80000000)){n=~~s;break s}n=-0x80000000}if(u[m>>2]=n,s=E(0|n),A[c+p>>2]=s+s,f=E(f+E(l*s)),r=r-n|0,a=E(a+E(s*s)),(0|h)==(0|(o=o+1|0)))break}}d:{if((i+3|0)<(0|r)){l=A[p>>2],u[t>>2]=u[t>>2]+r,s=E(0|r),a=E(E(a+E(s*s))+E(l*s));break d}if((0|r)<1)break d;for(m=(0|i)>2?i:2,b=A[e>>2],i=0;;){for(v=E(a+E(1)),a=E(v+A[p>>2]),s=E(f+b),s=E(s*s),n=1,c=0;;){if(l=E(v+A[p+(o=n<<2)>>2]),d=E(f+A[e+o>>2]),d=E(d*d),a=(o=E(a*d)>E(s*l))?l:a,s=o?d:s,c=o?n:c,(0|m)==(0|(n=n+1|0)))break}if(s=A[(n=c<<2)+e>>2],a=A[(o=n+p|0)>>2],A[o>>2]=a+E(2),u[(n=t+n|0)>>2]=u[n>>2]+1,a=E(v+a),f=E(f+s),(0|(i=i+1|0))==(0|r))break}}for(n=0;;){if(c=(o=n<<2)+t|0,o=u[o+_>>2],u[c>>2]=o+(u[c>>2]^0-o),(0|h)==(0|(n=n+1|0)))break}return D=S,a}(e,c,r,t,o),function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,l=0;t:{if((0|r)>0){if((0|t)<=1)break t;for(o=(n=u[((c=t-1|0)<<2)+e>>2])>>31,o^=n+o,s=n>>>31|0;;){if(s=u[u[(((0|(n=t-(d=c-1|0)|0))<(0|o)?n:o)<<2)+27984>>2]+(((0|n)>(0|o)?n:o)<<2)>>2]+s|0,o=((l=(a=u[(d<<2)+e>>2])>>31)^a+l)+o|0,(0|a)<=-1&&(a=o+1|0,s=u[u[(((0|n)>(0|o)?a:n)<<2)+27984>>2]+(((0|n)>(0|a)?n:a)<<2)>>2]+s|0),n=(0|c)>1,c=d,!n)break}o=r+1|0,eI(i,s,u[u[(((n=(0|t)>(0|r))?o:t)<<2)+27984>>2]+(((0|t)>(0|o)?t:o)<<2)>>2]+u[u[(((0|t)<(0|r)?t:r)<<2)+27984>>2]+((n?t:r)<<2)>>2]|0);return}e0(27936,27959,459),I()}e0(28044,27959,444),I()}(c,t,r,o),s){for(a=E(E(E(1)/E(R(h)))*a),o=0;;){if(A[(s=o<<2)+e>>2]=a*E(u[s+c>>2]),(0|(o=o+1|0))==(0|t))break}J(e,t,-1,n,r,i)}if(i=1,(0|n)>=2)for(e=(0|(d=(t>>>0)/(n>>>0)|0))>1?d:1,i=0,r=0;;){for(t=v(r,d),o=0,s=0;;){if(s=u[(t+o<<2)+c>>2]|s,(0|(o=o+1|0))==(0|e))break}if(i=((0|s)!=0)<<r|i,(0|n)==(0|(r=r+1|0)))break}return D=l,i}e0(33204,33263,338),I()}e0(33273,33263,339),I()}(r,i,s,N,o,O,c,u[t+4>>2],u[t+44>>2]);break t}p=function(e,t,r,i,n,o,a){var s=0,c=0,d=0,l=0;l=s=D;t:{if((0|r)>0){if((0|t)<=1)break t;for(D=c=s-((t<<2)+15&-16)|0,a=E(E(E(1)/E(R(function(e,t,r,i){var n=0,o=0,a=E(0),s=0,c=E(0),d=0,l=0,h=0;n=r+1|0,o=er(i,u[u[(((o=(0|t)>(0|r))?n:t)<<2)+27984>>2]+(((0|t)>(0|n)?t:n)<<2)>>2]+u[u[(((0|t)<(0|r)?t:r)<<2)+27984>>2]+((o?t:r)<<2)>>2]|0);t:{if((0|r)>0){if((0|t)<2)break t;if((0|t)!=2)for(;;){d=t;o:{if((0|t)<=(0|r)){i=r,l=u[(s=d<<2)+27984>>2],h=o>>>0>=(n=u[(l+(r<<2)|0)+4>>2])>>>0?-1:0,n=o-(n&h)|0;s:{if(n>>>0<_[s+l>>2])for(;;){if(!((o=u[u[((t=t-1|0)<<2)+27984>>2]+s>>2])>>>0>n>>>0))break s}for(;;){if(i=(t=i)-1|0,!((o=u[(t<<2)+l>>2])>>>0>n>>>0))break}}i=((r+h|0)-t^h)<<16>>16,u[e>>2]=i,a=E(0|i),c=E(c+E(a*a)),r=t,o=n-o|0;break o}if(t=u[(n=d<<2)+u[(i=r<<2)+27988>>2]>>2],!(o>>>0<(i=u[u[i+27984>>2]+n>>2])>>>0|t>>>0<=o>>>0)){u[e>>2]=0,o=o-i|0;break o}for(s=t>>>0<=o>>>0?-1:0,i=o-(s&t)|0,t=r;;){if(!((o=u[u[((t=t-1|0)<<2)+27984>>2]+n>>2])>>>0>i>>>0))break}n=((r+s|0)-t^s)<<16>>16,u[e>>2]=n,a=E(0|n),c=E(c+E(a*a)),r=t,o=i-o|0}if(t=d-1|0,e=e+4|0,!((0|d)>3))break}return n=o>>>0>=(t=r<<1|1)>>>0,n=((r=r-n|0)-(t=(o=(i=o-((n=n?-1:0)&t)|0)+1|0)>>>1|0)^n)<<16>>16,u[e>>2]=n,i=i-(t?(-2&o)-1|0:0)|0,t=(t-i^0-i)<<16>>16,u[e+4>>2]=t,a=E(0|n),a=E(c+E(a*a)),c=E(0|t),E(a+E(c*c))}e0(27936,27959,469),I()}e0(33168,27959,470),I()}(c,t,r,o))))*a),o=0;;){if(A[(s=o<<2)+e>>2]=a*E(u[s+c>>2]),(0|(o=o+1|0))==(0|t))break}if(J(e,t,-1,n,r,i),i=1,(0|n)>=2)for(e=(0|(d=(t>>>0)/(n>>>0)|0))>1?d:1,i=0,r=0;;){for(t=v(r,d),o=0,s=0;;){if(s=u[(t+o<<2)+c>>2]|s,(0|(o=o+1|0))==(0|e))break}if(i=((0|s)!=0)<<r|i,(0|n)==(0|(r=r+1|0)))break}return D=l,i}e0(33337,33263,371),I()}e0(33398,33263,372),I()}(r,i,s,N,o,O,c);break t}if(!u[t+4>>2]){p=0;break t}if(T=(p=-1<<o^-1)&h,u[b+24>>2]=T,!T){p=0,eE(r,0,i<<2);break t}et:{if(a){if((0|i)>=1){for(n=u[t+40>>2],s=0;;){if(p=s<<2,n=v(n,1664525)+0x3c6ef35f|0,A[p+r>>2]=A[a+p>>2]+(32768&n?E(.00390625):E(-.00390625)),(0|(s=s+1|0))==(0|i))break}u[t+40>>2]=n}p=T;break et}if((0|i)<1)break et;for(n=u[t+40>>2],s=0;;){if(n=v(n,1664525)+0x3c6ef35f|0,A[(s<<2)+r>>2]=n>>20,(0|(s=s+1|0))==(0|i))break}u[t+40>>2]=n}eV(r,i,c,u[t+44>>2])}return D=b+32|0,p}(e,t,r,i,o,h,a,c,p),!u[e+4>>2])break t;(0|o)>=2&&function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,l=0;d=o=D,D=o=o-(((c=v(t,r))<<2)+15&-16)|0;t:{if(!i){if((0|r)<1)break t;for(a=(0|t)<1;;){if(!a)for(s=v(t,n),i=0;;){if(u[(v(r,i)+n<<2)+o>>2]=u[(i+s<<2)+e>>2],(0|(i=i+1|0))==(0|t))break}if((0|(n=n+1|0))==(0|r))break}break t}if((0|r)<1)break t;for(l=(r<<2)+33592|0,a=(0|t)<1;;){if(!a)for(s=v(u[(n<<2)+l>>2],t),i=0;;){if(u[(v(r,i)+n<<2)+o>>2]=u[(i+s<<2)+e>>2],(0|(i=i+1|0))==(0|t))break}if((0|(n=n+1|0))==(0|r))break}}ed(e,o,c<<2),D=d}(t,b>>O,o<<O,f);es:{if(!U){S=o;break es}for(w=0;;){if(b<<=1,T=p>>>(S=o>>1)|0,(0|o)>=2)for(m=(0|(h=b>>1))>1?h:1,N=-2&o,h=0;;){if(o=0,(0|b)>=2)for(;;){if(e=f=(v(o,N)+h<<2)+t|0,C=E(A[f>>2]*E(.7071067690849304)),k=E(A[(f=(v(o<<1|1,S)+h<<2)+t|0)>>2]*E(.7071067690849304)),A[e>>2]=C+k,A[f>>2]=C-k,(0|m)==(0|(o=o+1|0)))break}if((0|S)==(0|(h=h+1|0)))break}if(p|=T,o=S,(0|U)==(0|(w=w+1|0)))break}}if(m=0,(0|P)>0)for(;;){if(p=l[p+33552|0],(0|m)!=31)for(N=(0|(o=(T=r>>m)>>1))>1?o:1,w=(b=1<<m)<<1,h=0;;){if(o=0,(0|T)>=2)for(;;){if(e=f=(v(o,w)+h<<2)+t|0,C=E(A[f>>2]*E(.7071067690849304)),k=E(A[(f=(((o<<1|1)<<m)+h<<2)+t|0)>>2]*E(.7071067690849304)),A[e>>2]=C+k,A[f>>2]=C-k,(0|N)==(0|(o=o+1|0)))break}if((0|b)==(0|(h=h+1|0)))break}if((0|O)==(0|(m=m+1|0)))break}if(f=S<<O,!(!s|(0|r)<1))for(C=E(R(+(0|r))),o=0;;){if(A[(h=o<<2)+s>>2]=A[t+h>>2]*C,(0|(o=o+1|0))==(0|r))break}p=(-1<<f^-1)&p}return p}function W(e){var t=0,r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,l=0,h=0,p=0,f=E(0),m=E(0),g=0,S=0,b=0,T=0,y=0,R=0;r=u[e+8>>2],o=(r>>>0)/((t=u[e+12>>2])>>>0)|0,u[e+36>>2]=o,i=v(u[e+16>>2],20),a=u[i+37364>>2],u[e+48>>2]=a,h=u[e+24>>2],n=u[i+37360>>2],u[e+24>>2]=n,u[e+40>>2]=r-v(t,o),b=u[e+28>>2];t:{r:{i:{if(t>>>0<r>>>0){if(A[e+44>>2]=E(A[i+37368>>2]*E(t>>>0))/E(r>>>0),i=(n>>>0)/(t>>>0)|0,o=n-v(i,t)|0,o>>>0>(n=0xffffffff/(r>>>0)|0)>>>0|i>>>0>n>>>0)break r;if(n=v(r,i),n>>>0>(-1^(i=(v(r,o)>>>0)/(t>>>0)|0))>>>0)break r;if(n=(i+n|0)+7&-8,u[e+24>>2]=n,a=a>>>(i=t<<1>>>0<r>>>0)>>>(o=t<<2>>>0<r>>>0)>>>((s=t<<3)>>>0<r>>>0)|0,!(r>>>0<=s>>>0?!(i|o):0)&&(u[e+48>>2]=a),(r=a>>>(i=t<<4>>>0<r>>>0)|0)?!i:0)break i;a=r||1,u[e+48>>2]=a;break i}u[e+44>>2]=u[i+37372>>2]}r=v(t,n),o=v(n,a)+8|0;s:if(!(r>>>0<=o>>>0)||(i=1,!(0x1fffffff/(t>>>0)>>>0>=n>>>0))){if(i=0,r=o,0x1ffffff7/(a>>>0)>>>0<n>>>0)break r}if(_[e+80>>2]<r>>>0){if(!(t=eW(u[e+76>>2],r<<2)))break r;u[e+80>>2]=r,u[e+76>>2]=t}d=e;u:{l:{h:{if(!i){if(t=-4,r=u[e+24>>2],(0|(n=v(r,a=u[e+48>>2])+4|0))>-4)break h;o=u[e+16>>2];break l}if(r=u[e+24>>2],c=u[e+12>>2])for(o=0|-((0|r)/2),f=E(c>>>0),s=0;;){if(r)for(n=v(r,s),m=E(E(s>>>0)/f),i=u[v(u[e+16>>2],20)+37376>>2],a=u[e+76>>2],t=0;;){if(l=(t+n<<2)+a|0,t=t+1|0,A[l>>2]=ew(A[e+44>>2],E(E(o+t|0)-m),r,i),(0|t)==(0|r))break}if((0|c)==(0|(s=s+1|0)))break}t=u[e+16>>2]>8?4:5;break u}for(m=E(r>>>1>>>0),o=u[e+16>>2],i=u[v(o,20)+37376>>2],f=E(a>>>0),a=u[e+76>>2];;){if(A[((t<<2)+a|0)+16>>2]=ew(A[e+44>>2],E(E(E(0|t)/f)-m),r,i),(0|n)==(0|(t=t+1|0)))break}}t=(0|o)>8?6:7}if(u[d+84>>2]=t,t=(u[e+32>>2]+r|0)-1|0,t>>>0>(r=u[e+28>>2])>>>0){if(0x1fffffff/((r=u[e+20>>2])>>>0)>>>0<t>>>0||!(r=eW(u[e+72>>2],v(t,r)<<2)))break r;u[e+28>>2]=t,u[e+72>>2]=r,r=t}if(!u[e+56>>2]){if(!(t=v(u[e+20>>2],r)))return 0;return eE(u[e+72>>2],0,t<<2),0}if(h>>>0<(r=u[e+24>>2])>>>0){if(!(c=u[e+20>>2]))return 0;for(T=h-1|0,y=(c<<2)-4|0,R=u[e+68>>2];;){if(s=p<<2,d=(n=u[(o=(g=(c=c-1|0)<<2)+R|0)>>2])<<1,t=n+T|0)for(i=v(c,b),a=v(u[e+28>>2],c),r=u[e+72>>2];;){if(u[((n+(t=t-1|0)|0)+a<<2)+r>>2]=u[(t+i<<2)+r>>2],!t)break}S=y-s|0,d=d+h|0,n&&eE(u[e+72>>2]+v(u[e+28>>2],S)|0,0,n<<2),u[o>>2]=0,l=u[e+24>>2];ea:{if(l>>>0>d>>>0){if(a=d-1|0)for(o=l-2|0,s=d-2|0,n=v(u[e+28>>2],c),i=u[e+72>>2],t=0,r=0;;){if(u[((t+o|0)+n<<2)+i>>2]=u[((t+s|0)+n<<2)+i>>2],t=-1^r,(0|a)==(0|(r=r+1|0)))break}a>>>0<(t=l-1|0)>>>0&&eE(u[e+72>>2]+v(u[e+28>>2],S)|0,0,t-a<<2),t=u[e+60>>2]+g|0,u[t>>2]=u[t>>2]+(l-d>>>1|0);break ea}if(i=d-l>>>1|0,u[o>>2]=i,(0|(t=i-1|0))==(0-(r=u[e+24>>2])|0))break ea;for(a=(t=t+r|0)>>>0>1?t:1,o=v(u[e+28>>2],c),r=u[e+72>>2],t=0;;){if(u[((n=t+o|0)<<2)+r>>2]=u[(i+n<<2)+r>>2],(0|a)==(0|(t=t+1|0)))break}}if(p=p+1|0,!c)break}return 0}if(t=0,!u[e+20>>2]|r>>>0>=h>>>0)break t;for(p=u[e+68>>2],s=0;;){if(t=u[(c=(s<<2)+p|0)>>2],i=h-r>>>1|0,u[c>>2]=i,t=(d=t+i|0)-1|0,(0|t)!=(0-(r=u[e+24>>2])|0))for(a=(t=t+r|0)>>>0>1?t:1,o=v(u[e+28>>2],s),r=u[e+72>>2],t=0;;){if(u[((n=t+o|0)<<2)+r>>2]=u[(i+n<<2)+r>>2],(0|a)==(0|(t=t+1|0)))break}if(u[c>>2]=d,(s=s+1|0)>>>0>=_[e+20>>2])return 0;r=u[e+24>>2]}}u[e+24>>2]=h,u[e+84>>2]=8,t=1}return t}function H(e){e|=0;var t=0,r=0,i=0,n=0,o=0,a=0,s=0;t:{r:if(e){o=(i=e-8|0)+(e=-8&(t=u[e-4>>2]))|0;i:if(!(1&t)){if(!(3&t))break r;if(t=u[i>>2],(i=i-t|0)>>>0<(n=u[9856])>>>0)break r;if(e=e+t|0,u[9857]!=(0|i)){if(t>>>0<=255){if(t=((s=t>>>3|0)<<3)+39448|0,a=u[i+8>>2],(0|a)==(0|(r=u[i+12>>2]))){u[9852]=u[9852]&e4(-2,s);break i}u[a+12>>2]=r,u[r+8>>2]=a;break i}s=u[i+24>>2],r=u[i+12>>2];s:{if((0|r)!=(0|i)){t=u[i+8>>2],u[t+12>>2]=r,u[r+8>>2]=t;break s}u:if(!(n=u[(t=i+20|0)>>2])&&!(n=u[(t=i+16|0)>>2])){r=0;break s}for(;;){if(a=t,n=u[(t=(r=n)+20|0)>>2])continue;if(t=r+16|0,!(n=u[r+16>>2]))break}u[a>>2]=0}if(!s)break i;t=((n=u[i+28>>2])<<2)+39712|0;h:{if(u[t>>2]==(0|i)){if(u[t>>2]=r,r)break h;u[9853]=u[9853]&e4(-2,n);break i}if(u[(u[s+16>>2]==(0|i)?16:20)+s>>2]=r,!r)break i}if(u[r+24>>2]=s,(t=u[i+16>>2])&&(u[r+16>>2]=t,u[t+24>>2]=r),!(t=u[i+20>>2]))break i;u[r+20>>2]=t,u[t+24>>2]=r;break i}if((3&(t=u[o+4>>2]))!=3)break i;u[9854]=e,u[o+4>>2]=-2&t;break t}if(i>>>0>=o>>>0||!(1&(t=u[o+4>>2])))break r;p:{if(!(2&t)){if(u[9858]==(0|o)){if(u[9858]=i,e=u[9855]+e|0,u[9855]=e,u[i+4>>2]=1|e,u[9857]!=(0|i))break r;u[9854]=0,u[9857]=0;return}if(u[9857]==(0|o)){u[9857]=i,e=u[9854]+e|0,u[9854]=e;break t}e=(-8&t)+e|0;et:{if(t>>>0<=255){if(n=u[o+12>>2],r=u[o+8>>2],o=t>>>3|0,(0|r)==(0|n)){u[9852]=u[9852]&e4(-2,o);break et}u[r+12>>2]=n,u[n+8>>2]=r;break et}s=u[o+24>>2],r=u[o+12>>2];A:{if((0|o)!=(0|r)){t=u[o+8>>2],u[t+12>>2]=r,u[r+8>>2]=t;break A}eN:if(!(n=u[(t=o+20|0)>>2])&&!(n=u[(t=o+16|0)>>2])){r=0;break A}for(;;){if(a=t,n=u[(t=(r=n)+20|0)>>2])continue;if(t=r+16|0,!(n=u[r+16>>2]))break}u[a>>2]=0}if(!s)break et;t=((n=u[o+28>>2])<<2)+39712|0;eL:{if(u[t>>2]==(0|o)){if(u[t>>2]=r,r)break eL;u[9853]=u[9853]&e4(-2,n);break et}if(u[(u[s+16>>2]==(0|o)?16:20)+s>>2]=r,!r)break et}if(u[r+24>>2]=s,(t=u[o+16>>2])&&(u[r+16>>2]=t,u[t+24>>2]=r),!(t=u[o+20>>2]))break et;u[r+20>>2]=t,u[t+24>>2]=r}if(u[i+4>>2]=1|e,u[e+i>>2]=e,u[9857]!=(0|i))break p;u[9854]=e;return}u[o+4>>2]=-2&t,u[i+4>>2]=1|e,u[e+i>>2]=e}if(e>>>0<=255){e=((t=e>>>3|0)<<3)+39448|0,t=1<<t,n=u[9852];E:{if(!(t&n)){u[9852]=t|n,t=e;break E}t=u[e+8>>2]}u[e+8>>2]=i,u[t+12>>2]=i,u[i+12>>2]=e,u[i+8>>2]=t;return}t=31,u[i+16>>2]=0,u[i+20>>2]=0,e>>>0<=0xffffff&&(r=t=e>>>8|0,r=n=r<<(t=t+1048320>>>16&8),r<<=n=n+520192>>>16&4,t=((t=((a=r)<<(r=r+245760>>>16&2)>>>15|0)-(t|n|r)|0)<<1|e>>>t+21&1)+28|0),u[i+28>>2]=t,n=(t<<2)+39712|0;g:{eT:{r=u[9853],o=1<<t;ey:{if(!(r&o)){u[9853]=r|o,u[n>>2]=i;break ey}for(t=e<<((0|t)==31?0:25-(t>>>1|0)|0),r=u[n>>2];;){if(n=r,(-8&u[r+4>>2])==(0|e))break eT;if(r=t>>>29|0,t<<=1,!(r=u[(o=(a=(4&r)+n|0)+16|0)>>2]))break}u[a+16>>2]=i}u[i+24>>2]=n,u[i+12>>2]=i,u[i+8>>2]=i;break g}e=u[n+8>>2],u[e+12>>2]=i,u[n+8>>2]=i,u[i+24>>2]=0,u[i+12>>2]=n,u[i+8>>2]=e}i=u[9860]-1|0,u[9860]=i||-1}return}u[i+4>>2]=1|e,u[e+i>>2]=e}function Y(e,t){var r=0,i=0,n=0,o=0,a=0,s=0;o=e+t|0;t:{r:if(!(1&(r=u[e+4>>2]))){if(!(3&r))break t;if(t=(r=u[e>>2])+t|0,(0|(e=e-r|0))!=u[9857]){if(r>>>0<=255){if(r=((a=r>>>3|0)<<3)+39448|0,i=u[e+8>>2],(0|(n=u[e+12>>2]))==(0|i)){u[9852]=u[9852]&e4(-2,a);break r}u[i+12>>2]=n,u[n+8>>2]=i;break r}a=u[e+24>>2],i=u[e+12>>2];a:{if((0|i)!=(0|e)){r=u[e+8>>2],u[r+12>>2]=i,u[i+8>>2]=r;break a}d:if(!(n=u[(r=e+20|0)>>2])&&!(n=u[(r=e+16|0)>>2])){i=0;break a}for(;;){if(s=r,n=u[(r=(i=n)+20|0)>>2])continue;if(r=i+16|0,!(n=u[i+16>>2]))break}u[s>>2]=0}if(!a)break r;r=((n=u[e+28>>2])<<2)+39712|0;l:{if(u[r>>2]==(0|e)){if(u[r>>2]=i,i)break l;u[9853]=u[9853]&e4(-2,n);break r}if(u[(u[a+16>>2]==(0|e)?16:20)+a>>2]=i,!i)break r}if(u[i+24>>2]=a,(r=u[e+16>>2])&&(u[i+16>>2]=r,u[r+24>>2]=i),!(r=u[e+20>>2]))break r;u[i+20>>2]=r,u[r+24>>2]=i;break r}if((3&(r=u[o+4>>2]))!=3)break r;u[9854]=t,u[o+4>>2]=-2&r,u[e+4>>2]=1|t,u[o>>2]=t;return}r=u[o+4>>2];Z:{if(!(2&r)){if(u[9858]==(0|o)){if(u[9858]=e,t=u[9855]+t|0,u[9855]=t,u[e+4>>2]=1|t,u[9857]!=(0|e))break t;u[9854]=0,u[9857]=0;return}if(u[9857]==(0|o)){u[9857]=e,t=u[9854]+t|0,u[9854]=t,u[e+4>>2]=1|t,u[e+t>>2]=t;return}t=(-8&r)+t|0;f:{if(r>>>0<=255){if(n=u[o+12>>2],i=u[o+8>>2],o=r>>>3|0,(0|i)==(0|n)){u[9852]=u[9852]&e4(-2,o);break f}u[i+12>>2]=n,u[n+8>>2]=i;break f}a=u[o+24>>2],i=u[o+12>>2];_:{if((0|o)!=(0|i)){r=u[o+8>>2],u[r+12>>2]=i,u[i+8>>2]=r;break _}A:if(!(r=u[(n=o+20|0)>>2])&&!(r=u[(n=o+16|0)>>2])){i=0;break _}for(;;){if(s=n,i=r,r=u[(n=r+20|0)>>2])continue;if(n=i+16|0,!(r=u[i+16>>2]))break}u[s>>2]=0}if(!a)break f;r=((n=u[o+28>>2])<<2)+39712|0;eb:{if(u[r>>2]==(0|o)){if(u[r>>2]=i,i)break eb;u[9853]=u[9853]&e4(-2,n);break f}if(u[(u[a+16>>2]==(0|o)?16:20)+a>>2]=i,!i)break f}if(u[i+24>>2]=a,(r=u[o+16>>2])&&(u[i+16>>2]=r,u[r+24>>2]=i),!(r=u[o+20>>2]))break f;u[i+20>>2]=r,u[r+24>>2]=i}if(u[e+4>>2]=1|t,u[e+t>>2]=t,u[9857]!=(0|e))break Z;u[9854]=t;return}u[o+4>>2]=-2&r,u[e+4>>2]=1|t,u[e+t>>2]=t}if(t>>>0<=255){t=((r=t>>>3|0)<<3)+39448|0,r=1<<r,n=u[9852];eD:{if(!(r&n)){u[9852]=r|n,r=t;break eD}r=u[t+8>>2]}u[t+8>>2]=e,u[r+12>>2]=e,u[e+12>>2]=t,u[e+8>>2]=r;return}r=31,u[e+16>>2]=0,u[e+20>>2]=0,t>>>0<=0xffffff&&(i=r=t>>>8|0,i=n=i<<(r=r+1048320>>>16&8),i<<=n=n+520192>>>16&4,r=((r=((s=i)<<(i=i+245760>>>16&2)>>>15|0)-(r|n|i)|0)<<1|t>>>r+21&1)+28|0),u[e+28>>2]=r,n=(r<<2)+39712|0;E:{i=u[9853],o=1<<r;eM:{if(!(i&o)){u[9853]=i|o,u[n>>2]=e;break eM}for(r=t<<((0|r)==31?0:25-(r>>>1|0)|0),i=u[n>>2];;){if(n=i,(-8&u[i+4>>2])==(0|t))break E;if(i=r>>>29|0,r<<=1,!(i=u[(o=(s=(4&i)+n|0)+16|0)>>2]))break}u[s+16>>2]=e}u[e+24>>2]=n,u[e+12>>2]=e,u[e+8>>2]=e;return}t=u[n+8>>2],u[t+12>>2]=e,u[n+8>>2]=e,u[e+24>>2]=0,u[e+12>>2]=n,u[e+8>>2]=t}}function K(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,h=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,S=0,b=0,T=0,y=0,R=0;switch(D=a=D-320|0,r-10|0){default:e0(1994,2027,89),I();case 0:case 6:break}for(_=(0|r)==16?1968:1984;;){if(s=(c=d[(o<<1)+t>>1])>>8<<1,i=d[s+1698>>1],s=d[s+1696>>1],u[(a+224|0)+(l[o+_|0]<<2)>>2]=(v(i-s|0,255&c)+(s<<8)>>3)+1>>1,(0|(o=o+1|0))==(0|r))break}s=65536,u[a+160>>2]=65536,t=0-u[a+224>>2]|0,u[a+164>>2]=t,o=1,T=r>>1;n:if(!(y=(0|r)<4)){for(;;){n=(i=S=u[(a+224|0)+(o<<3)>>2])>>31,m=i,E=n,i=n=(i=t)>>31,b=(a+160|0)+((A=o+1|0)<<2)|0,h=i=e6(m,n=E,t,i),i=(n=L)>>>15|0,f=(p=(n=(32767&n)<<17|h>>>15)+1|0)>>>0<1?i+1|0:i,i=p,u[b>>2]=(s<<1)-((1&f)<<31|i>>>1),g=(c=o<<2)+(a+160|0)|0;a:if(!(o>>>0<2)){if(t=(c=u[(a+c|0)+152>>2])+t|0,n=(i=s)>>31,f=i=e6(s,n,m,i=E),i=(n=L)>>>15|0,p=(h=(n=(32767&n)<<17|f>>>15)+1|0)>>>0<1?i+1|0:i,i=h,u[g>>2]=t-((1&p)<<31|i>>>1),(0|o)==2)break a;for(;;){if(t=(a+160|0)+((s=o-1|0)<<2)|0,R=(_=u[((o<<2)+a|0)+148>>2])+u[t>>2]|0,n=(i=c)>>31,p=i=e6(c,n,m,i=E),i=(n=L)>>>15|0,h=(f=(n=(32767&n)<<17|p>>>15)+1|0)>>>0<1?i+1|0:i,i=f,u[t>>2]=R-((1&h)<<31|i>>>1),t=(0|o)>3,o=s,c=_,!t)break}}if(u[a+164>>2]=u[a+164>>2]-S,(0|A)==(0|T))break n;t=u[b>>2],s=u[g>>2],o=A}}s=65536,u[a+96>>2]=65536,t=0-u[a+228>>2]|0,u[a+100>>2]=t;c:if(!y){for(y=a+224|4,o=1;;){n=(i=S=u[(o<<3)+y>>2])>>31,m=i,E=n,i=n=(i=t)>>31,b=(a+96|0)+((A=o+1|0)<<2)|0,h=i=e6(m,n=E,t,i),i=(n=L)>>>15|0,f=(p=(n=(32767&n)<<17|h>>>15)+1|0)>>>0<1?i+1|0:i,i=p,u[b>>2]=(s<<1)-((1&f)<<31|i>>>1),g=(c=o<<2)+(a+96|0)|0;u:if(!(o>>>0<2)){if(t=(c=u[(a+c|0)+88>>2])+t|0,n=(i=s)>>31,f=i=e6(s,n,m,i=E),i=(n=L)>>>15|0,p=(h=(n=(32767&n)<<17|f>>>15)+1|0)>>>0<1?i+1|0:i,i=h,u[g>>2]=t-((1&p)<<31|i>>>1),(0|o)==2)break u;for(;;){if(t=(a+96|0)+((s=o-1|0)<<2)|0,R=(_=u[((o<<2)+a|0)+84>>2])+u[t>>2]|0,n=(i=c)>>31,p=i=e6(c,n,m,i=E),i=(n=L)>>>15|0,h=(f=(n=(32767&n)<<17|p>>>15)+1|0)>>>0<1?i+1|0:i,i=f,u[t>>2]=R-((1&h)<<31|i>>>1),t=(0|o)>3,o=s,c=_,!t)break}}if(u[a+100>>2]=u[a+100>>2]-S,(0|A)==(0|T))break c;t=u[b>>2],s=u[g>>2],o=A}}if((0|r)>=2)for(g=(0|T)>1?T:1,s=u[a+96>>2],t=u[a+160>>2],o=0;;){if(s=(A=u[(_=(c=o+1|0)<<2)+(a+96|0)>>2])-s|0,t=(_=u[(a+160|0)+_>>2])+t|0,u[(o<<2)+a>>2]=0-(s+t|0),u[((-1^o)+r<<2)+a>>2]=s-t,s=A,t=_,(0|g)==(0|(o=c)))break}(function(e,t,r,i,n){var o=0,a=0,s=0,c=0,l=0,h=0,p=0;h=(s=i-r|0)-1|0,p=(0|n)<1;t:{r:{for(;;){if(i=0,r=0,!p)for(;;){if(c=a=u[(i<<2)+t>>2],a>>=31,a^=a+c,c=a,r=(a=(0|r)<(0|a))?c:r,o=a?i:o,(0|n)==(0|(i=i+1|0)))break}if((0|(i=(0|s)==1?(1&r)+(r>>1)|0:(r>>h)+1>>1))>=32768){if(ex(t,n,65470-((((i=(0|i)<163838?i:163838)<<14)-0x1fffc000|0)/(v(o+1|0,i)>>2)|0)|0),(0|(l=l+1|0))!=10)continue;break r}break}if((0|l)==10)break r;if(i=0,(0|n)<=0)break t;for(o=(0|s)!=1;;){if(r=u[(i<<2)+t>>2],r=o?(r>>h)+1>>1:(1&r)+(r>>1)|0,d[(i<<1)+e>>1]=r,(0|n)==(0|(i=i+1|0)))break}break t}if((0|n)<1)break t;for(i=0,l=(0|s)!=1;;){o=u[(a=(i<<2)+t|0)>>2],c=(i<<1)+e|0;q:{if(!l){if(r=32767,(0|(o=(1&o)+(o>>1)|0))>32767)break q;r=(0|o)>-32768?o:-32768;break q}if(r=32767,(0|(o>>=h))>65534)break q;r=(0|(r=o+1>>1))>-32768?r:-32768}if(d[c>>1]=r,u[a>>2]=r<<16>>16<<s,(0|n)==(0|(i=i+1|0)))break}}})(e,a,12,17,r);Z:if(!X(e,r)){for(c=0;;){for(ex(a,r,(-2<<c)+65536|0),o=0;;){if(d[(o<<1)+e>>1]=(u[(o<<2)+a>>2]>>>4|0)+1>>>1,(0|(o=o+1|0))==(0|r))break}if(o=X(e,r),c>>>0>14)break Z;if(c=c+1|0,!!o)break}}D=a+320|0}function Q(e,t,r,i,n,o){var s,c,d,l,h,_,m,v,g,S,b,T,y=E(0),R=0,C=E(0),k=0,w=0,O=0,N=E(0),P=0,D=0,L=0,M=E(0),x=0,U=E(0),B=0,V=E(0),F=E(0),j=E(0),G=E(0),W=E(0),H=E(0),Y=E(0),K=E(0),Q=E(0),z=0,X=0,J=E(0),q=0,Z=0,$=0;if((0|n)>=1){r:if(!((0|n)<4)){if((0|i)>=3){for(q=n-3|0,B=i-3|0,Z=(0|i)==3,$=((X=1|(z=-4&i))+1|0)>=(0|i);;){;if(R=(o=(x=O<<2)+t|0)+12|0,C=A[o+8>>2],U=A[o+4>>2],M=A[o>>2],N=E(0),H=E(0),Y=E(0),K=E(0),o=e,w=0,k=0,P=0,D=0,L=0,!Z){for(;;){if(V=A[o>>2],y=A[R>>2],F=A[o+4>>2],j=A[R+4>>2],G=A[o+8>>2],Q=A[R+8>>2],W=A[o+12>>2],J=A[R+12>>2],N=E(E(E(E(N+E(V*y))+E(F*j))+E(G*Q))+E(W*J)),H=E(E(E(E(H+E(C*V))+E(y*F))+E(j*G))+E(Q*W)),Y=E(E(E(E(Y+E(U*V))+E(C*F))+E(y*G))+E(j*W)),K=E(E(E(E(K+E(M*V))+E(U*F))+E(C*G))+E(y*W)),R=R+16|0,o=o+16|0,M=j,C=J,U=Q,!((0|B)>(0|(w=w+4|0))))break}p(Y),P=a[2],p(H),D=a[2],p(N),L=a[2],N=y,p(K),k=a[2]}s:{;if((0|i)<=(0|z))break s;y=A[o>>2],p(E(E(y*(N=A[R>>2]))+(s=L,a[2]=s,f()))),L=a[2],p(E(E(C*y)+(c=D,a[2]=c,f()))),D=a[2],p(E(E(U*y)+(d=P,a[2]=d,f()))),P=a[2],p(E(E(M*y)+(l=k,a[2]=l,f()))),k=a[2],R=R+4|0,o=o+4|0}w=R;d:{;if((0|i)<=(0|X)){R=w;break d}y=A[o>>2],p(E(E(y*(M=A[w>>2]))+(h=L,a[2]=h,f()))),L=a[2],p(E(E(N*y)+(_=D,a[2]=_,f()))),D=a[2],p(E(E(C*y)+(m=P,a[2]=m,f()))),P=a[2],p(E(E(U*y)+(v=k,a[2]=v,f()))),k=a[2],o=o+4|0,R=w+4|0}if(!$){;p(E(E((y=A[o>>2])*A[R>>2])+(g=L,a[2]=g,f()))),L=a[2],p(E(E(M*y)+(S=D,a[2]=S,f()))),D=a[2],p(E(E(N*y)+(b=P,a[2]=b,f()))),P=a[2],p(E(E(C*y)+(T=k,a[2]=T,f()))),k=a[2]}if(u[r+x>>2]=k,u[(4|x)+r>>2]=P,u[(8|x)+r>>2]=D,u[(12|x)+r>>2]=L,!((0|q)>(0|(O=O+4|0))))break}break r}e0(34032,34057,69),I()}if((0|n)>(0|O))for(k=(0|i)<1;;){if(B=O<<2,C=E(0),!k)for(w=t+B|0,R=0;;){if(C=E(C+E(A[(o=R<<2)+e>>2]*A[o+w>>2])),(0|(R=R+1|0))==(0|i))break}if(A[r+B>>2]=C,(0|(O=O+1|0))==(0|n))break}return}e0(33965,33995,251),I()}function z(e,t,r,i,n,o,a,s,c,d,l){var h=E(0),p=0,f=0,_=0,m=E(0),v=0,g=0,S=E(0),b=E(0),T=0,y=0,I=0,C=E(0);D=p=D-32|0,u[p+24>>2]=l,u[p+28>>2]=n,n=u[e+28>>2],v=u[e>>2];t:{if((0|i)==1){if(i=0,(0|(l=u[e+32>>2]))>=8){n:{if(v){eL(n,i=A[t>>2]<E(0),1);break n}i=eB(n,1)}l=u[e+32>>2]-8|0,u[e+32>>2]=l}if(u[e+4>>2]&&(A[t>>2]=i?E(-1):E(1)),r)for(s=(i=r?2:1)>>>0>1?i:1,o=1;;){if(i=0,(0|l)>=8){u:{if(v){eL(n,i=A[r>>2]<E(0),1);break u}i=eB(n,1)}l=u[e+32>>2]-8|0,u[e+32>>2]=l}if(u[e+4>>2]&&(A[r>>2]=i?E(-1):E(1)),(0|s)==(0|(o=o+1|0)))break}if(s=1,!c)break t;u[c>>2]=u[t>>2];break t}F(e,p,t,r,i,p+28|0,o,o,s,1,p+24|0),h=E(E(u[p+8>>2])*E(30517578125e-15)),b=E(E(u[p+4>>2])*E(30517578125e-15)),_=u[p+28>>2],g=u[p+20>>2],f=u[p+16>>2],I=u[p>>2];q:{if((0|i)==2){T=((0|(y=-16385&f))!=0)<<3,u[e+32>>2]=u[e+32>>2]-(T+g|0),g=(f=(0|f)>8192)?t:r,f=f?r:t,T=_-T|0,_=0;p:if(y){if(v){eL(n,_=E(E(A[f>>2]*A[g+4>>2])-E(A[f+4>>2]*A[g>>2]))<E(0),1);break p}_=eB(n,1)}if(s=G(e,f,2,T,o,a,s,c,E(1),d,l),o=1-(_<<1)|0,A[g>>2]=A[f+4>>2]*E(0-o|0),A[g+4>>2]=A[f>>2]*E(0|o),!u[e+4>>2])break q;A[t>>2]=b*A[t>>2],A[t+4>>2]=b*A[t+4>>2],m=E(h*A[r>>2]),A[r>>2]=m,A[r+4>>2]=h*A[r+4>>2],h=A[t>>2],A[t>>2]=h-m,A[r>>2]=h+A[r>>2],h=A[t+4>>2],A[t+4>>2]=h-A[r+4>>2],A[r+4>>2]=h+A[r+4>>2];break q}if(l=u[p+12>>2],g=u[e+32>>2]-g|0,u[e+32>>2]=g,n=u[p+24>>2],l=(0|(l=(0|(l=(_-l|0)/2|0))>(0|_)?_:l))>0?l:0,v=_-l|0,(0|l)>=(0|v)){a=G(e,t,i,l,o,a,s,c,E(1),d,n),l=(u[e+32>>2]-g|0)+l|0,s=a|G(e,r,i,(f&&(0|l)>24?l-24|0:0)+v|0,o,0,s,0,h,0,n>>o);break q}_=G(e,r,i,v,o,0,s,0,h,0,n>>o),v=(u[e+32>>2]-g|0)+v|0,s=_|G(e,t,i,((0|f)!=16384&&(0|v)>24?v-24|0:0)+l|0,o,a,s,c,E(1),d,n)}if(!u[e+4>>2])break t;f:if((0|i)!=2){if(m=E(0),(0|i)>=1)for(e=0;;){if(S=E(S+E((h=A[(o=e<<2)+r>>2])*A[t+o>>2])),m=E(m+E(h*h)),(0|i)==(0|(e=e+1|0)))break}en:if(m=E(E(b*b)+m),h=E(b*S),h=E(h+h),!(!((S=E(m+h))<E(6000000284984708e-19))&&(h=E(m-h))<E(6000000284984708e-19)^1)){ed(r,t,i<<2);break f}if((0|i)<1)break t;for(S=E(E(1)/E(R(S))),C=E(E(1)/E(R(h))),e=0;;){if(h=E(b*A[(l=(o=e<<2)+t|0)>>2]),m=A[(o=r+o|0)>>2],A[l>>2]=C*E(h-m),A[o>>2]=S*E(h+m),(0|i)==(0|(e=e+1|0)))break}}if(!I|(0|i)<1)break t;for(e=0;;){if(A[(o=(e<<2)+r|0)>>2]=-A[o>>2],(0|i)==(0|(e=e+1|0)))break}}return D=p+32|0,s}function X(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,b=0,T=0,y=0,R=0,I=0,C=0,k=0;_=D-96|0;t:{if((0|t)>=1){for(;;){if(c=d[(a<<1)+e>>1],u[(a<<2)+_>>2]=c<<12,h=c+h|0,(0|(a=a+1|0))==(0|t))break}if((0|h)>4095)break t}if(a=(c=u[((h=t-1|0)<<2)+_>>2])+0xffef9e>>>0>0x1ffdf3c,l=0x40000000,(0|t)>=2)for(;;){if(1&a)return 0;if(i=(s=0-(c<<7)|0)>>31,f=s,g=i,s=e6(f,i,f,i),r=s=(r=a=0x40000000-(i=L)|0)>>31,i=r=e6(l,s=p,a,r),(0|(b=((0x3fffffff&(s=L))<<2|i>>>30)&-4))<107374)break t;for(m=h,h=0,E=S((c=a>>31)^a+c),i=((a=0x1fffffff/(0|(e=(c=a<<E-1)>>16))|0)>>15)+1>>1,c=0-((v(a=(A=a<<16)>>16,65535&c)>>16)+v(e,a)<<3)|0,r=(i=((v(c,i)+A|0)+v(c>>16,a)|0)+(v(65528&c,a)>>16)|0)>>31,T=i,y=r,C=(a=t>>>1|0)>>>0>1?a:1,R=31-E|0;;){a=u[(A=(h<<2)+_|0)>>2],r=(i=c=u[(I=((-1^h)+m<<2)+_|0)>>2])>>31,s=i=e6(c,r,f,i=g),i=(r=L)>>>30|0,t=(n=(r=(0x3fffffff&r)<<2|s>>>30)+1|0)>>>0<1?i+1|0:i,i=e=a-(t=(1&t)<<31|(i=n)>>>1)|0,r=(i=((((e=(0|e)>-1)?t:a)^-0x80000000)&(e?a:t))>-1?i:e?-0x80000000:0x7fffffff)>>31,l=i=e6(e=i,r,T,i=y),p=r=L,t=i,s=1&i,n=i=0,o=(1&(i=r))<<31|(r=t)>>>1,e=(0|E)!=31,r=t=i>>1,n=r+(t=n)|0,n=(s=(i=s)+o|0)>>>0<o>>>0?n+1|0:n,t=s;c:if(e){n=p,t=l,r=31&(o=R),(63&o)>>>0>=32?(i=n>>31,n>>=r):(i=n>>r,n=((1<<r)-1&n)<<32-r|t>>>r),s=(r=n+1|0)>>>0<1?i+1|0:i,t=(1&s)<<31|(i=r)>>>1,n=s>>1}if(r=n,r=(t=(s=l=t)- -0x80000000|0)>>>0<0x80000000?r+1|0:r)break t;if(u[A>>2]=l,n=(r=a)>>31,o=r=e6(a,n,f,r=g),r=(n=L)>>>30|0,t=(i=(n=(0x3fffffff&n)<<2|o>>>30)+1|0)>>>0<1?r+1|0:r,i=t=c-(a=(1&t)<<31|(r=i)>>>1)|0,n=(r=((((t=(0|t)>-1)?a:c)^-0x80000000)&(t?c:a))>-1?i:t?-0x80000000:0x7fffffff)>>31,l=r=e6(t=r,n,T,r=y),p=n=L,e?(n=p,t=l,o=31&(s=R),(63&s)>>>0>=32?(r=n>>31,n>>=o):(r=n>>o,n=((1<<o)-1&n)<<32-o|t>>>o),i=(o=n+1|0)>>>0<1?r+1|0:r,l=(1&i)<<31|(r=o)>>>1,o=n=i>>1):(t=1&(i=l),e=r=0,s=(1&(r=n=p))<<31|i>>>1,n=i=r>>1,o=(i=e)+n|0,l=t=s+(r=t)|0,o=t>>>0<s>>>0?o+1|0:o),p=o,t=(n=(i=l)- -0x80000000|0)>>>0<0x80000000?o+1|0:o,i=0,t)break t;if(u[I>>2]=l,(0|C)==(0|(h=h+1|0)))break}if(a=(c=u[((h=m-1|0)<<2)+_>>2])+0xffef9e>>>0>0x1ffdf3c,o=(t=b)>>31,l=t,p=o,!((0|(t=m))>1))break}if(a)break t;o=(t=0-(u[_>>2]<<7)|0)>>31,t=e6(f=t,o,f,o),r=0,o=(n=0x40000000-(n=(t=0x7fffffff&(o=L))+((0|i)!=0)|0)|0)>>31,n=t=e6(n,o,l,t=p),k=(0|(a=((0x3fffffff&(o=L))<<2|n>>>30)&-4))<107374?0:a}return k}function J(e,t,r,i,n,o){var a=E(0),s=0,c=E(0),d=E(0),l=E(0),h=0,p=0,f=0,_=0,m=0,g=0,S=0,b=0,T=0,y=0;t:if(!(!o|n<<1>=(0|t))){if(d=E(E(0|t)/E(v(u[(o<<2)+33188>>2],n)+t|0)),d=E(E(d*d)*E(.5)),b=eD(+E(d*E(1.5707963705062866))),T=eD(+E(E(E(1)-d)*E(1.5707963705062866))),o=0,i<<3<=(0|t))for(s=i>>2,n=1;;){if(o=n,n=n+1|0,!((v(v(o,o)+o|0,i)+s|0)<(0|t)))break}if((0|i)<1)break t;for(d=E(b),l=E(T),m=(_=(t>>>0)/(i>>>0)|0)-o|0,p=_-3|0,g=_-1|0,f=(o<<1^-1)+_|0,y=(0|r)>-1,r=0;;){h=v(r,_);o:{if(!y){s:if(o){if(t=0,n=S=(h<<2)+e|0,(0|m)>=1)for(;;){if(c=A[(s=(o<<2)+n|0)>>2],a=A[n>>2],A[s>>2]=E(a*d)+E(c*l),A[n>>2]=E(a*l)-E(c*d),n=n+4|0,(0|m)==(0|(t=t+1|0)))break}if((0|f)<0)break s;for(n=(f<<2)+S|0,t=f;;){if(c=A[(s=(o<<2)+n|0)>>2],a=A[n>>2],A[s>>2]=E(a*d)+E(c*l),A[n>>2]=E(a*l)-E(c*d),n=n-4|0,s=(0|t)>0,t=t-1|0,!s)break}}if(s=(h<<2)+e|0,(0|g)>=1)for(a=A[s>>2],t=0,n=s;;){if(c=A[n+4>>2],A[n>>2]=E(a*d)-E(c*l),a=E(E(a*l)+E(c*d)),A[n+4>>2]=a,n=n+4|0,(0|g)==(0|(t=t+1|0)))break}if((0|p)<0)break o;for(n=(p<<2)+s|0,t=p;;){if(a=A[n>>2],c=A[n+4>>2],A[n+4>>2]=E(a*l)+E(c*d),A[n>>2]=E(a*d)-E(c*l),n=n-4|0,s=(0|t)>0,t=t-1|0,!s)break}break o}if(h=(h<<2)+e|0,(0|g)>=1)for(a=A[h>>2],t=0,n=h;;){if(c=A[n+4>>2],A[n>>2]=E(a*d)+E(c*l),a=E(E(c*d)-E(a*l)),A[n+4>>2]=a,n=n+4|0,(0|g)==(0|(t=t+1|0)))break}if((0|p)>=0)for(n=(p<<2)+h|0,t=p;;){if(a=A[n+4>>2],c=A[n>>2],A[n+4>>2]=E(a*d)-E(c*l),A[n>>2]=E(c*d)+E(a*l),n=n-4|0,s=(0|t)>0,t=t-1|0,!s)break}if(!o)break o;if(t=0,n=h,(0|m)>=1)for(;;){if(a=A[(s=(o<<2)+n|0)>>2],c=A[n>>2],A[s>>2]=E(a*l)-E(c*d),A[n>>2]=E(c*l)+E(a*d),n=n+4|0,(0|m)==(0|(t=t+1|0)))break}if((0|f)<0)break o;for(n=(f<<2)+h|0,t=f;;){if(a=A[(s=(o<<2)+n|0)>>2],c=A[n>>2],A[s>>2]=E(a*l)-E(c*d),A[n>>2]=E(c*l)+E(a*d),n=n-4|0,s=(0|t)>0,t=t-1|0,!s)break}}if((0|i)==(0|(r=r+1|0)))break}}}function q(e,t){var r,i,n,o,s,d=0,l=0,h=0,p=0,f=0,_=0,A=0,E=0,S=0,b=0,T=0;D=f=D-48|0;t:{;r:{;r=+e,c[0]=r,h=0|a[1],A=0|a[0],l=h,_=0x7fffffff&h;i:{if(_>>>0<=0x400f6a7a){if((1048575&l)==598523)break i;if(_>>>0<=0x4002d97c){if((0|h)>0?1:(0|h)>=0){e+=-1.5707963267341256,d=e+-6077100506506192e-26,m[t>>3]=d,m[t+8>>3]=e-d+-6077100506506192e-26,l=1;break t}e+=1.5707963267341256,d=e+6077100506506192e-26,m[t>>3]=d,m[t+8>>3]=e-d+6077100506506192e-26,l=-1;break t}if((0|h)>0?1:(0|h)>=0){e+=-3.1415926534682512,d=e+-12154201013012384e-26,m[t>>3]=d,m[t+8>>3]=e-d+-12154201013012384e-26,l=2;break t}e+=3.1415926534682512,d=e+12154201013012384e-26,m[t>>3]=d,m[t+8>>3]=e-d+12154201013012384e-26,l=-2;break t}if(_>>>0<=0x401c463b){if(_>>>0<=0x4015fdbc){if((0|_)==0x4012d97c)break i;if((0|h)>0?1:(0|h)>=0){e+=-4.712388980202377,d=e+-18231301519518578e-26,m[t>>3]=d,m[t+8>>3]=e-d+-18231301519518578e-26,l=3;break t}e+=4.712388980202377,d=e+18231301519518578e-26,m[t>>3]=d,m[t+8>>3]=e-d+18231301519518578e-26,l=-3;break t}if((0|_)==0x401921fb)break i;if((0|h)>0?1:(0|h)>=0){e+=-6.2831853069365025,d=e+-2430840202602477e-25,m[t>>3]=d,m[t+8>>3]=e-d+-2430840202602477e-25,l=4;break t}e+=6.2831853069365025,d=e+2430840202602477e-25,m[t>>3]=d,m[t+8>>3]=e-d+2430840202602477e-25,l=-4;break t}if(_>>>0>0x413921fa)break r}d=.6366197723675814*e+0x18000000000000+-0x18000000000000,e=(E=e+-1.5707963267341256*d)-(b=6077100506506192e-26*d),m[t>>3]=e,S=_>>>20|0,i=+e,c[0]=i,p=0|a[1],a[0],p=(S-(p>>>20&2047)|0)<17,l=0x80000000>g(d)?~~d:-0x80000000;Z:{;if(p)break Z;if(T=E-(e=6077100506303966e-26*d),b=20222662487959506e-37*d-(E-T-e),e=T-b,m[t>>3]=e,n=+e,c[0]=n,p=0|a[1],a[0],(S-(p>>>20&2047)|0)<50){E=T;break Z}E=T-(e=20222662487111665e-37*d),b=84784276603689e-45*d-(T-E-e),e=E-b,m[t>>3]=e}m[t+8>>3]=E-e-b;break t}if(_>>>0>=0x7ff00000){e-=e,m[t>>3]=e,m[t+8>>3]=e,l=0;break t}for(p=1048575&h|0x41600000,o=0|A,a[0]=o,s=0|p,a[1]=s,e=+c[0],l=0,p=1;;){if(l=(f+16|0)+(l<<3)|0,d=+(0|(S=0x80000000>g(e)?~~e:-0x80000000)),m[l>>3]=d,e=(e-d)*0x1000000,l=1,S=1&p,p=0,!S)break}m[f+32>>3]=e;er:{if(0!=e){l=2;break er}for(p=1;;){if(p=(l=p)-1|0,0!=m[(f+16|0)+(l<<3)>>3])break}}if(l=function(e,t,r,i,n){var o=0,a=0,s=0,c=0,d=0,l=0,h=0,p=0,f=0,_=0,A=0,E=0,S=0,b=0,T=0,R=0,I=0,C=0,k=0,w=0;if(D=c=D-560|0,f=v(T=(0|(s=(r-3|0)/24|0))>0?s:0,-24)+r|0,p=u[6273],(p+(A=i-1|0)|0)>=0)for(a=i+p|0,r=T-A|0,s=0;;){if(o=(0|r)<0?0:+u[(r<<2)+25104>>2],m[(c+320|0)+(s<<3)>>3]=o,r=r+1|0,(0|(s=s+1|0))==(0|a))break}for(b=f-24|0,a=0,l=(0|p)>0?p:0,h=(0|i)<1;;){a:{if(h){o=0;break a}for(s=a+A|0,r=0,o=0;;){if(o+=m[(r<<3)+e>>3]*m[(c+320|0)+(s-r<<3)>>3],(0|i)==(0|(r=r+1|0)))break}}if(m[(a<<3)+c>>3]=o,r=(0|a)==(0|l),a=a+1|0,!!r)break}k=47-f|0,I=48-f|0,w=f-25|0,a=p;d:{for(;;){if(o=m[(a<<3)+c>>3],r=0,s=a,!(A=(0|a)<1))for(;;){l=(l=r<<2)+(c+480|0)|0,E=o,d=5960464477539063e-23*o;Z:{if(0x80000000>g(d)){h=~~d;break Z}h=-0x80000000}o=E+-0x1000000*(d=+(0|h));q:{if(0x80000000>g(o)){h=~~o;break q}h=-0x80000000}if(u[l>>2]=h,o=m[((s=s-1|0)<<3)+c>>3]+d,(0|a)==(0|(r=r+1|0)))break}o=eF(o,b),o+=-8*function(e){return y(e)}(.125*o);ee:{if(0x80000000>g(o)){S=~~o;break ee}S=-0x80000000}o-=+(0|S);et:{er:{_:{C=(0|b)<1;en:{if(!C){h=r=(s=(a<<2)+c|0)+476|0,s=r=u[s+476>>2],r>>=I,s=s-(r<<I)|0,u[h>>2]=s,S=r+S|0,_=s>>k;break en}if(b)break _;_=u[((a<<2)+c|0)+476>>2]>>23}if((0|_)<1)break et;break er}if(_=2,!(o>=.5^1))break er;_=0;break et}if(r=0,h=0,!A)for(;;){s=u[(A=(c+480|0)+(r<<2)|0)>>2],l=0xffffff;eb:{eN:if(!h){if(l=0x1000000,s)break eN;h=0;break eb}u[A>>2]=l-s,h=1}if((0|a)==(0|(r=r+1|0)))break}ea:if(!C){switch(0|w){case 0:u[(r=(s=(a<<2)+c|0)+476|0)>>2]=8388607&u[s+476>>2];break ea;case 1:break;default:break ea}u[(r=(s=(a<<2)+c|0)+476|0)>>2]=4194303&u[s+476>>2]}if(S=S+1|0,(0|_)!=2)break et;if(o=1-o,_=2,!h)break et;o-=eF(1,b)}if(0==o){s=0;v:if(!((0|p)>=(0|(r=a)))){for(;;){if(s=u[(c+480|0)+((r=r-1|0)<<2)>>2]|s,!((0|r)>(0|p)))break}if(!s)break v;for(f=b;;){if(f=f-24|0,!!u[(c+480|0)+((a=a-1|0)<<2)>>2])break}break d}for(r=1;;){if(s=r,r=r+1|0,!!u[(c+480|0)+(p-s<<2)>>2])break}for(l=a+s|0;;){if(s=i+a|0,a=a+1|0,m[(c+320|0)+(s<<3)>>3]=u[(T+a<<2)+25104>>2],r=0,o=0,(0|i)>=1)for(;;){if(o+=m[(r<<3)+e>>3]*m[(c+320|0)+(s-r<<3)>>3],(0|i)==(0|(r=r+1|0)))break}if(m[(a<<3)+c>>3]=o,!((0|a)<(0|l)))break}a=l;continue}break}o=eF(o,24-f|0);eR:{if(!(o>=0x1000000^1)){i=(i=a<<2)+(c+480|0)|0,E=o,d=5960464477539063e-23*o;ei:{if(0x80000000>g(d)){r=~~d;break ei}r=-0x80000000}o=E+-0x1000000*+(0|r);ec:{if(0x80000000>g(o)){s=~~o;break ec}s=-0x80000000}u[i>>2]=s,a=a+1|0;break eR}r=0x80000000>g(o)?~~o:-0x80000000,f=b}u[(c+480|0)+(a<<2)>>2]=r}o=eF(1,f);eu:if(!((0|a)<=-1)){for(r=a;;){if(m[(r<<3)+c>>3]=o*+u[(c+480|0)+(r<<2)>>2],o*=5960464477539063e-23,i=(0|r)>0,r=r-1|0,!i)break}if(l=0,(0|a)<0)break eu;for(p=(0|p)>0?p:0,s=a;;){for(e=l>>>0>p>>>0?p:l,h=a-s|0,r=0,o=0;;){if(o+=m[(r<<3)+27872>>3]*m[(r+s<<3)+c>>3],i=(0|e)!=(0|r),r=r+1|0,!i)break}if(m[(c+160|0)+(h<<3)>>3]=o,s=s-1|0,r=(0|a)!=(0|l),l=l+1|0,!r)break}}b:{T:{switch(0|n){case 3:ev:if(!((0|a)<1)){for(o=m[(c+160|0)+(a<<3)>>3],r=a;;){if(E=d=m[(s=(c+160|0)+((i=r-1|0)<<3)|0)>>3],d+=o,m[(c+160|0)+(r<<3)>>3]=o+(E-d),m[s>>3]=d,s=(0|r)>1,o=d,r=i,!s)break}if((0|a)<2)break ev;for(o=m[(c+160|0)+(a<<3)>>3],r=a;;){if(E=d=m[(s=(c+160|0)+((i=r-1|0)<<3)|0)>>3],d+=o,m[(c+160|0)+(r<<3)>>3]=o+(E-d),m[s>>3]=d,s=(0|r)>2,o=d,r=i,!s)break}if((0|a)<=1)break ev;for(;;){if(R+=m[(c+160|0)+(a<<3)>>3],r=(0|a)>2,a=a-1|0,!r)break}}if(o=m[c+160>>3],_)break T;m[t>>3]=o,o=m[c+168>>3],m[t+16>>3]=R,m[t+8>>3]=o;break b;case 0:if(o=0,(0|a)>=0)for(;;){if(o+=m[(c+160|0)+(a<<3)>>3],r=(0|a)>0,a=a-1|0,!r)break}m[t>>3]=_?-o:o;break b;case 1:case 2:break;default:break b}if(o=0,(0|a)>=0)for(r=a;;){if(o+=m[(c+160|0)+(r<<3)>>3],i=(0|r)>0,r=r-1|0,!i)break}if(m[t>>3]=_?-o:o,o=m[c+160>>3]-o,r=1,(0|a)>=1)for(;;){if(o+=m[(c+160|0)+(r<<3)>>3],i=(0|r)!=(0|a),r=r+1|0,!i)break}m[t+8>>3]=_?-o:o;break b}m[t>>3]=-o,o=m[c+168>>3],m[t+16>>3]=-R,m[t+8>>3]=-o}return D=c+560|0,7&S}(f+16|0,f,(_>>>20|0)-1046|0,l+1|0,1),e=m[f>>3],(0|h)<-1?1:(0|h)<=-1){m[t>>3]=-e,m[t+8>>3]=-m[f+8>>3],l=0-l|0;break t}m[t>>3]=e,m[t+8>>3]=m[f+8>>3]}return D=f+48|0,l}function Z(e,t,r){var i=0,n=0,o=0,a=0,s=0;D=i=D-16|0,u[i+12>>2]=r,n=-5;t:{r:{i:{n:{o:{a:{s:{switch(t-4027|0){default:switch(t-10007|0){case 3:if(t=u[i+12>>2],u[i+12>>2]=t+4,n=-1,(0|(t=u[t>>2]))<0|u[u[e>>2]+8>>2]<=(0|t))break t;u[e+20>>2]=t;break r;case 5:if(t=u[i+12>>2],u[i+12>>2]=t+4,n=-1,(0|(t=u[t>>2]))<1|u[u[e>>2]+8>>2]<(0|t))break t;u[e+24>>2]=t;break r;case 1:if(t=u[i+12>>2],u[i+12>>2]=t+4,n=-1,(t=u[t>>2])-1>>>0>1)break t;u[e+12>>2]=t;break r;case 0:break;case 9:break a;case 8:break s;default:break t}if(t=u[i+12>>2],u[i+12>>2]=t+4,!(t=u[t>>2])){n=-1;break t}u[t>>2]=u[e+44>>2],n=0,u[e+44>>2]=0;break t;case 0:if(t=u[i+12>>2],u[i+12>>2]=t+4,!(t=u[t>>2])){n=-1;break t}u[t>>2]=u[e+4>>2]/u[e+16>>2];break r;case 1:if(o=u[e+4>>2],n=0,r=u[e>>2],t=u[r+8>>2],a=(u[r+4>>2]<<2)+8288|0,r=u[e+8>>2],eE(e+40|0,0,(v(a,r)+(t<<5)|0)+52|0),(0|t)>=1)for(o=((v(o+2048|0,r)<<2)+e|0)+v(r,96)|0,o=(o+(r=t<<3)|0)+92|0,a=r+o|0,t<<=1,s=(0|t)>1?t:1,t=0;;){if(u[a+(r=t<<2)>>2]=-0x3e200000,u[r+o>>2]=-0x3e200000,(0|s)==(0|(t=t+1|0)))break}u[e+56>>2]=1;break t;case 2:case 3:case 5:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:break t;case 20:break i;case 19:break n;case 4:break o;case 6:break}if(t=u[i+12>>2],u[i+12>>2]=t+4,!(t=u[t>>2])){n=-1;break t}u[t>>2]=u[e+60>>2];break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,!(t=u[t>>2])){n=-1;break t}u[t>>2]=u[e>>2];break r}t=u[i+12>>2],u[i+12>>2]=t+4,u[e+28>>2]=u[t>>2];break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,!(t=u[t>>2])){n=-1;break t}u[t>>2]=u[e+40>>2];break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,n=-1,(t=u[t>>2])>>>0>1)break t;u[e+32>>2]=t;break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,!(t=u[t>>2])){n=-1;break t}u[t>>2]=u[e+32>>2]}n=0}return D=i+16|0,n}function $(e,t,r,i,n,o){var a=0,s=0,c=0,d=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,S=0,b=0;D=c=D-16|0,E=(m=u[e+24>>2])-1|0,f=u[e+72>>2],_=f+((S=v(g=u[e+28>>2],t))<<2)|0,b=u[e+88>>2],h=u[o>>2],p=u[i>>2],s=(a=t<<2)+u[e+68>>2]|0;t:{if(u[s>>2]){if(u[c+12>>2]=h,u[c+8>>2]=u[s>>2],u[e+56>>2]=1,d=0|tn[u[e+84>>2]](e,t,_,c+8|0,n,c+12|0),s=u[c+8>>2],a=u[e+60>>2]+a|0,(0|s)>(0|(l=u[a>>2]))&&(u[c+8>>2]=l,s=l),u[c+12>>2]=d,u[a>>2]=u[a>>2]-s,s=u[c+8>>2],(0|m)>=2)for(a=0;;){if(u[(a<<2)+_>>2]=u[(a+s<<2)+_>>2],(0|E)==(0|(a=a+1|0)))break}if(A=u[e+68>>2]+(t<<2)|0,d=u[A>>2]-s|0,u[A>>2]=d,d)for(a=0,l=u[c+8>>2];;){if(u[((s=a+E|0)<<2)+_>>2]=u[(s+l<<2)+_>>2],(0|d)==(0|(a=a+1|0)))break}if(h=h-(a=u[c+12>>2])|0,u[A>>2])break t;n=(v(u[e+92>>2],a)<<2)+n|0}if(!h|!p)break t;for(A=g-E|0,g=((m+S<<2)+f|0)-4|0;;){s=p>>>0>A>>>0?A:p,u[c+12>>2]=s,u[c+8>>2]=h;d:{if(r){if(a=0,!s)break d;for(;;){if(u[(a+E<<2)+_>>2]=u[(v(a,b)<<2)+r>>2],(0|s)==(0|(a=a+1|0)))break}break d}if(!s)break d;eE(g,0,s<<2)}if(u[e+56>>2]=1,l=u[e+24>>2],s=u[e+72>>2]+(v(u[e+28>>2],t)<<2)|0,m=0|tn[u[e+84>>2]](e,t,s,c+12|0,n,c+8|0),d=u[c+12>>2],a=u[e+60>>2]+(t<<2)|0,(0|d)>(0|(f=u[a>>2]))&&(u[c+12>>2]=f,d=f),u[c+8>>2]=m,u[a>>2]=u[a>>2]-d,a=d=u[c+12>>2],(0|l)>=2){for(l=l-1|0,a=0;;){if(u[(a<<2)+s>>2]=u[(a+d<<2)+s>>2],(0|l)==(0|(a=a+1|0)))break}a=u[c+12>>2]}if(p=p-d|0,!(h=h-(s=u[c+8>>2])|0))break t;if(r=r?(v(a,b)<<2)+r|0:0,n=(v(u[e+92>>2],s)<<2)+n|0,!p)break}}return u[i>>2]=u[i>>2]-p,u[o>>2]=u[o>>2]-h,D=c+16|0,(0|(a=u[e+84>>2]))==8}function ee(e,t,r,i){var n=E(0),o=0,a=E(0),s=E(0),c=E(0),d=E(0),u=E(0),l=E(0),h=E(0),p=E(0),f=0;if((0|i)>2){if(o=t+12|0,h=A[t+8>>2],a=A[t+4>>2],l=A[t>>2],(0|i)==3)t=0;else{for(f=i-3|0,s=A[r+12>>2],c=A[r+8>>2],d=A[r+4>>2],u=A[r>>2],t=0;;){if(n=A[e>>2],s=E(E(n*(p=A[o>>2]))+s),A[r+12>>2]=s,c=E(E(h*n)+c),A[r+8>>2]=c,d=E(E(a*n)+d),A[r+4>>2]=d,u=E(E(l*n)+u),A[r>>2]=u,n=A[e+4>>2],s=E(s+E(n*(l=A[o+4>>2]))),A[r+12>>2]=s,c=E(c+E(p*n)),A[r+8>>2]=c,d=E(d+E(h*n)),A[r+4>>2]=d,u=E(u+E(a*n)),A[r>>2]=u,n=A[e+8>>2],s=E(s+E(n*(a=A[o+8>>2]))),A[r+12>>2]=s,c=E(c+E(l*n)),A[r+8>>2]=c,d=E(d+E(p*n)),A[r+4>>2]=d,u=E(u+E(h*n)),A[r>>2]=u,n=A[e+12>>2],s=E(s+E(n*(h=A[o+12>>2]))),A[r+12>>2]=s,c=E(c+E(a*n)),A[r+8>>2]=c,d=E(d+E(l*n)),A[r+4>>2]=d,u=E(u+E(p*n)),A[r>>2]=u,o=o+16|0,e=e+16|0,!((0|f)>(0|(t=t+4|0))))break}t=-4&i}f=1|t,(0|t)<(0|i)&&(p=A[o>>2],n=A[e>>2],A[r>>2]=E(l*n)+A[r>>2],A[r+4>>2]=E(a*n)+A[r+4>>2],A[r+8>>2]=E(h*n)+A[r+8>>2],A[r+12>>2]=E(n*p)+A[r+12>>2],o=o+4|0,e=e+4|0),t=f+1|0,(0|i)>(0|f)&&(l=A[o>>2],n=A[e>>2],A[r>>2]=E(a*n)+A[r>>2],A[r+4>>2]=E(h*n)+A[r+4>>2],A[r+8>>2]=E(p*n)+A[r+8>>2],A[r+12>>2]=E(n*l)+A[r+12>>2],o=o+4|0,e=e+4|0),(0|t)<(0|i)&&(n=A[o>>2],a=A[e>>2],A[r>>2]=E(h*a)+A[r>>2],A[r+4>>2]=E(p*a)+A[r+4>>2],A[r+8>>2]=E(l*a)+A[r+8>>2],A[r+12>>2]=E(a*n)+A[r+12>>2]);return}e0(33925,33950,69),I()}function et(e,t,r,i,n){var o=0,a=0;D=o=D-48|0,a=e+2766|0;t:{if(!(u[((r<<2)+e|0)+2404>>2]?0:!i)){i=eO(t,6709,8)+2|0;break t}i=eO(t,6713,8)}s[0|a]=1&i,i=i>>>1|0,s[e+2765|0]=i;n:{if((0|n)==2){s[e+2736|0]=eO(t,7040,8);break n}s[e+2736|0]=eO(t,(i<<24>>21)+7008|0,8)<<3,s[e+2736|0]=eO(t,6752,8)+l[e+2736|0]}if(u[e+2324>>2]>=2)for(i=1;;){if(s[(e+i|0)+2736|0]=eO(t,7040,8),!((0|(i=i+1|0))<u[e+2324>>2]))break}if(r=e+2744|0,i=u[e+2732>>2],i=eO(t,u[i+16>>2]+v(d[i>>1],s[e+2765|0]>>1)|0,8),s[0|r]=i,eU(o+16|0,o,u[e+2732>>2],i<<24>>24),(0|(a=d[(r=u[e+2732>>2])+2>>1]))==u[e+2340>>2]){if(i=0,(0|a)>0)for(;;){l:{h:{switch(0|(r=eO(t,u[r+28>>2]+d[(o+16|0)+(i<<1)>>1]|0,8))){case 8:break h;case 0:break;default:break l}r=0-eO(t,6760,8)|0;break l}r=eO(t,6760,8)+8|0}if(s[((i=i+1|0)+e|0)+2744|0]=r-4,!(d[(r=u[e+2732>>2])+2>>1]>(0|i)))break}if(i=4,4==u[e+2324>>2]&&(i=eO(t,6715,8)),s[e+2767|0]=i,2==l[e+2765|0]){$:{ee:if(!((0|n)!=2|2!=u[e+2396>>2]||(i=eO(t,2960,8))<<16<1)){r=(h[e+2400>>1]+i|0)-9|0,d[e+2762>>1]=r;break $}d[(i=e+2762|0)>>1]=v(eO(t,2928,8),u[e+2316>>2]>>>1|0),r=eO(t,u[e+2380>>2],8)+h[i>>1]|0,d[i>>1]=r}d[e+2400>>1]=r,s[e+2764|0]=eO(t,u[e+2384>>2],8),i=e+2768|0,r=eO(t,7081,8),s[0|i]=r,i=1;f:if(!(u[e+2324>>2]<1)){if(s[e+2740|0]=eO(t,u[(r<<24>>22)+7152>>2],8),u[e+2324>>2]<2)break f;for(;;){if(s[(e+i|0)+2740|0]=eO(t,u[(s[e+2768|0]<<2)+7152>>2],8),!((0|(i=i+1|0))<u[e+2324>>2]))break}}i=0,!n&&(i=eO(t,6706,8)),s[e+2769|0]=i}u[e+2396>>2]=s[e+2765|0],s[e+2770|0]=eO(t,6737,8),D=o+48|0;return}e0(7468,7530,82),I()}function er(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,h=0,p=0,f=0;if(t>>>0>1){h=t-1|0;r:{if(h>>>0>=256){if(n=u[e+28>>2],s=24-S(h)|0,t=(n>>>0)/((i=(r=h>>>s|0)+1|0)>>>0)|0,u[e+36>>2]=t,c=o=u[e+32>>2],p=((i=(a=(o=(o>>>0)/(t>>>0)|0)+1|0)-i|0)>>>0>a>>>0?0:i)+(r-o|0)|0,i=c-(r=v(r-p|0,t))|0,u[e+32>>2]=i,r=p?t:n-r|0,u[e+28>>2]=r,r>>>0<=8388608)for(n=u[e+24>>2],o=u[e+40>>2],a=u[e+20>>2],f=u[e+4>>2];;){if(c=r<<8,u[e+28>>2]=c,a=a+8|0,u[e+20>>2]=a,t=0,n>>>0<f>>>0&&(d=n+1|0,u[e+24>>2]=d,t=l[u[e>>2]+n|0],n=d),u[e+40>>2]=t,i=((o<<8|t)>>>1&255|i<<8&0x7fffff00)^255,u[e+32>>2]=i,d=r>>>0<32769,o=t,r=c,!d)break}c=p<<s,i=u[e+12>>2],t=u[e+16>>2];s:{if(s>>>0<=t>>>0){a=t;break s}for(r=u[e+8>>2],o=u[e+4>>2];;){if(n=0,r>>>0<o>>>0&&(r=r+1|0,u[e+8>>2]=r,n=l[u[e>>2]+(o-r|0)|0]),i=n<<t|i,n=(0|t)<17,t=a=t+8|0,!n)break}}if(u[e+16>>2]=a-s,u[e+12>>2]=i>>>s,u[e+20>>2]=u[e+20>>2]+s,h>>>0>=(s=(-1<<s^-1)&i|c)>>>0)break r;return u[e+44>>2]=1,h}if(r=((n=u[e+28>>2])>>>0)/(t>>>0)|0,u[e+36>>2]=r,c=i=u[e+32>>2],d=(-1^(i=(i>>>0)/(r>>>0)|0))+t|0,o=(i=i+1|0)-t|0,i=c-(t=v((-1^(s=d+(i>>>0<o>>>0?0:o)|0))+t|0,r))|0,u[e+32>>2]=i,r=s?r:n-t|0,u[e+28>>2]=r,r>>>0>8388608)break r;for(n=u[e+24>>2],o=u[e+40>>2],a=u[e+20>>2],f=u[e+4>>2];;){if(c=r<<8,u[e+28>>2]=c,a=a+8|0,u[e+20>>2]=a,t=0,n>>>0<f>>>0&&(d=n+1|0,u[e+24>>2]=d,t=l[u[e>>2]+n|0],n=d),u[e+40>>2]=t,i=((o<<8|t)>>>1&255|i<<8&0x7fffff00)^255,u[e+32>>2]=i,d=r>>>0<32769,o=t,r=c,!d)break}}return s}e0(6958,6982,203),I()}function ei(e,t,r,i,n,o,a,s,c,d,u,l){var h=E(0),p=E(0),f=E(0),_=E(0),m=0,g=E(0),S=0,b=0,T=0,y=0,R=E(0),I=E(0),C=E(0),k=E(0),w=E(0),O=E(0),N=E(0),P=E(0),D=E(0);t:{if(!(o!=E(0)|a!=E(0))){if((0|e)==(0|t))break t;ep(e,t,n<<2);return}if(S=-2-(l=(0|i)>15?i:15)|0,b=-1^l,T=1-l|0,y=0-l|0,R=E(A[(i=v(c,12))+1624>>2]*a),I=E(A[i+1620>>2]*a),C=E(A[i+1616>>2]*a),i=o==a&&(0|s)==(0|c)?0:u,(0|(i=(0|l)==(0|(c=(0|r)>15?r:15))?i:u))>=1){for(k=E(A[(u=v(s,12))+1624>>2]*o),w=E(A[u+1620>>2]*o),O=E(A[u+1616>>2]*o),s=2-l|0,h=A[(T<<2)+t>>2],p=A[(y<<2)+t>>2],f=A[(b<<2)+t>>2],o=A[(S<<2)+t>>2],u=0;;){if(m=(r=u<<2)+e|0,g=E(o+(_=A[(s+u<<2)+t>>2])),o=E((o=A[r+d>>2])*o),g=E(g*E(R*o)),N=E(E(h+f)*E(I*o)),P=E(p*E(C*o)),D=A[t+r>>2],r=(u-c<<2)+t|0,o=E(E(1)-o),A[m>>2]=g+E(N+E(P+E(E(E(D+E(A[r>>2]*E(O*o)))+E(E(w*o)*E(A[r+4>>2]+A[r-4>>2])))+E(E(k*o)*E(A[r+8>>2]+A[r-8>>2]))))),o=f,f=p,p=h,h=_,(0|(u=u+1|0))==(0|i))break}m=i}if(a==E(0)){if((0|e)==(0|t))break t;ep((u=i<<2)+e|0,t+u|0,n-i<<2);return}if((0|(i=n-m|0))<1)break t;for(e=(u=m<<2)+e|0,d=2-l|0,f=A[(r=t+u|0)+(S<<2)>>2],o=A[(b<<2)+r>>2],h=A[(y<<2)+r>>2],p=A[(T<<2)+r>>2],u=0;;){if(t=u<<2,_=A[(d+u<<2)+r>>2],A[t+e>>2]=E(R*E(f+_))+E(E(I*E(o+p))+E(E(C*h)+A[t+r>>2])),f=o,o=h,h=p,p=_,(0|(u=u+1|0))==(0|i))break}}}function en(e,t,r,i,n){var o=0,a=0,c=0,p=0,f=0,_=0,A=0;if((0|(c=u[e+2316>>2]))!=u[e+4252>>2]&&(u[e+4252>>2]=c,u[(a=e+4244|0)>>2]=65536,u[a+4>>2]=65536,u[(a=e+4256|0)>>2]=2,u[a+4>>2]=20,u[e+4172>>2]=u[e+2328>>2]<<7),i){!function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,b=0,T=0,y=0,R=0,C=0,k=0,w=0,O=0,N=0,P=0,L=0,M=0,x=0,U=0,B=0,V=0,F=0,j=0,G=0;D=n=D+-64|0,D=o=b=n-((u[e+2328>>2]+u[e+2336>>2]<<2)+15&-16)|0,D=_=o-((u[e+2336>>2]<<1)+15&-16)|0,p=n,u[n+8>>2]=u[e+4244>>2]>>6,M=(L=u[e+4248>>2])>>6,u[n+12>>2]=M,u[e+2376>>2]&&(d[(o=e+4210|0)>>1]=0,d[o+2>>1]=0,d[o+4>>1]=0,d[o+6>>1]=0,d[(o=e+4202|0)>>1]=0,d[o+2>>1]=0,d[o+4>>1]=0,d[o+6>>1]=0,d[(o=e+4194|0)>>1]=0,d[o+2>>1]=0,d[o+4>>1]=0,d[o+6>>1]=0,d[(o=e+4186|0)>>1]=0,d[o+2>>1]=0,d[o+4>>1]=0,d[o+6>>1]=0),function(e,t,r,i,n,o,a,s){var c=0,l=0,h=0,p=0,f=0,_=0,A=0;A=c=D,D=h=c-((a<<2)+15&-16)|0;t:{if((0|a)<=0){p=(a<<1)+h|0;break t}for(p=v(s-2|0,a),f=(c=u[o>>2])<<16>>16,_=(c>>15)+1>>1;;){if(c=((v(65535&(c=u[(l+p<<2)+n>>2]),f)>>16)+v(c>>16,f)|0)+v(c,_)|0,d[(l<<1)+h>>1]=(0|c)>8388607?32767:(0|c)<-8388608?-32768:c>>>8|0,(0|(l=l+1|0))==(0|a))break}if(p=(a<<1)+h|0,(0|a)<1)break t;for(_=v(s-1|0,a),f=(l=u[o+4>>2])<<16>>16,o=(l>>15)+1>>1,l=0;;){if(c=((v(65535&(c=u[(l+_<<2)+n>>2]),f)>>16)+v(c>>16,f)|0)+v(o,c)|0,d[(l<<1)+p>>1]=(0|c)>8388607?32767:(0|c)<-8388608?-32768:c>>>8|0,(0|(l=l+1|0))==(0|a))break}}ek(e,t,h,a),ek(r,i,p,a),D=A}(p+52|0,p+60|0,p+48|0,p+56|0,c=e+4|0,p+8|0,u[e+2332>>2],u[e+2324>>2]),R=h[e+4228>>1],C=u[e+4260>>2],N=u[e+4256>>2],o=u[e+4160>>2],s=u[e+4164>>2],g=u[p+56>>2],k=u[p+52>>2],T=u[p+60>>2],P=u[p+48>>2],eG(a=e+4186|0,u[e+2340>>2],64881),ed(p+16|0,a,(n=u[e+2340>>2])<<1),f=d[(w=((0|o)<1?o:1)<<1)+((0|s)==2?2234:2238)>>1];r:if(!u[e+4160>>2]){if(2==u[e+4164>>2]){o=16384-(h[e+4184>>1]+(h[e+4182>>1]+(h[e+4180>>1]+(h[e+4176>>1]+h[e+4178>>1]|0)|0)|0)|0)|0,R=v(d[e+4240>>1],(o<<16>>16>3277?o:3277)&65535)>>>14|0;break r}f=(v((n=(0|(n=(0|(n=X(a,n)))<0x8000000?n:0x8000000))>4194304?n:4194304)<<3&65528,f)>>16)+v(n>>>13&65535,f)>>14,n=u[e+2340>>2],R=16384}if(o=u[e+2336>>2],(0|(a=(o-(m=(u[e+4172>>2]>>7)+1>>1)|0)-n|0))>2){U=u[e+4224>>2],eg(_+(s=(a=a-2|0)<<1)|0,(e+s|0)+1348|0,p+16|0,o-a|0,n,i),A=S(s=(i=(n=u[e+4248>>2])>>31)^i+n),n<<=A-1,y=((E=0x1fffffff/(0|(i=n>>16))|0)>>15)+1>>1,E<<=16,i=0-((v(O=65535&n,n=E>>16)>>16)+v(i,n)<<3)|0,n=((v(i,y)+E|0)+v(i>>16,n)|0)+(v(65528&i,n)>>16)|0,i=16-A|0;o:{if(s>>>0<=65535){s=0x7fffffff>>>(i=0-i|0)|0,A=-0x80000000>>i,i=((0|n)>(0|s)?s:(0|n)<(0|A)?A:n)<<i;break o}i=n>>i}if(n=(O=u[e+2340>>2])+a|0,(0|n)<(0|(y=u[e+2336>>2])))for(i=65535&(a=(0|i)<0x3fffffff?i:0x3fffffff),s=a>>16;;){if(a=d[(n<<1)+_>>1],u[(n<<2)+b>>2]=(v(a,i)>>16)+v(s,a),!((0|y)>(0|(n=n+1|0))))break}if((0|(x=u[e+2324>>2]))>=1){for(N=((((0|(n=v(N-(k>>g<P>>T)|0,C)))>128?n:128)<<2)+c|0)-512|0,g=d[w+2230>>1],k=v(d[e+2316>>1],4608),P=f<<16>>16,n=h[e+4184>>1],i=h[e+4182>>1],s=h[e+4180>>1],f=h[e+4178>>1],A=h[e+4176>>1],C=u[e+2332>>2],w=l[e+2765|0],T=0;;){l:{if((0|C)<=0){a=R<<16>>16,_=n<<16>>16,i=i<<16>>16,s=s<<16>>16,f=f<<16>>16,A=A<<16>>16;break l}for(a=R<<16>>16,_=n<<16>>16,i=i<<16>>16,s=s<<16>>16,f=f<<16>>16,A=A<<16>>16,n=((o-m<<2)+b|0)+8|0,E=0;;){if(m=v((c=u[n>>2])>>16,A)+(v(65535&c,A)>>16)|0,m=(m+v((c=u[n-4>>2])>>16,f)|0)+(v(65535&c,f)>>16)|0,m=(m+v((c=u[n-8>>2])>>16,s)|0)+(v(65535&c,s)>>16)|0,m=(m+v((c=u[n-12>>2])>>16,i)|0)+(v(65535&c,i)>>16)|0,m=(m+v((c=u[n-16>>2])>>16,_)|0)+(v(65535&c,_)>>16)|0,c=u[((U=v(U,0xbb38435)+0x3619636b|0)>>>23&508)+N>>2],u[(o<<2)+b>>2]=((m+v(c>>16,a)|0)+(v(65535&c,a)>>16)<<2)+8,o=o+1|0,n=n+4|0,(0|C)==(0|(E=E+1|0)))break}}if(n=(0|(n=(n=u[e+4172>>2])+v(n>>16,655)+(v(65535&n,655)>>>16)|0))<(0|k)?n:k,u[e+4172>>2]=n,m=(n>>7)+1>>1,R=w?v(a,P)>>>15|0:R,n=v(_,g)>>>15|0,i=v(i,g)>>>15|0,s=v(s,g)>>>15|0,f=v(f,g)>>>15|0,A=v(A,g)>>>15|0,(0|x)==(0|(T=T+1|0)))break}d[e+4184>>1]=n,d[e+4182>>1]=i,d[e+4180>>1]=s,d[e+4178>>1]=f,d[e+4176>>1]=A}if(o=u[e+1288>>2],a=u[e+1284>>2],u[(i=((y<<2)+b|0)+-64|0)>>2]=a,u[i+4>>2]=o,o=u[(n=e+1340|0)>>2],a=u[n+4>>2],u[i+56>>2]=o,u[i+60>>2]=a,a=u[(n=e+1332|0)>>2],o=u[n+4>>2],u[i+48>>2]=a,u[i+52>>2]=o,o=u[(n=e+1324|0)>>2],a=u[n+4>>2],u[i+40>>2]=o,u[i+44>>2]=a,a=u[(n=e+1316|0)>>2],o=u[n+4>>2],u[i+32>>2]=a,u[i+36>>2]=o,o=u[(n=e+1308|0)>>2],a=u[n+4>>2],u[i+24>>2]=o,u[i+28>>2]=a,a=u[(n=e+1300|0)>>2],o=u[n+4>>2],u[i+16>>2]=a,u[i+20>>2]=o,o=u[(n=e+1292|0)>>2],a=u[n+4>>2],u[i+8>>2]=o,u[i+12>>2]=a,(0|O)>=10){if((0|(B=u[e+2328>>2]))>=1)for(V=O>>>1|0,C=M<<16>>16,F=(L>>21)+1>>1,o=u[i+28>>2],a=u[i+36>>2],_=u[i+44>>2],s=u[i+52>>2],n=u[i+60>>2],N=d[p+34>>1],g=d[p+32>>1],k=d[p+30>>1],T=d[p+28>>1],x=d[p+26>>1],P=d[p+24>>1],w=d[p+22>>1],y=d[p+20>>1],L=d[p+18>>1],M=d[p+16>>1],j=(0|O)<11,f=0;;){if(G=(v(n>>16,M)+V|0)+(v(65535&n,M)>>16)|0,A=u[(n=(f<<2)+i|0)+56>>2],E=u[n+48>>2],c=u[n+40>>2],b=u[n+32>>2],n=u[n+24>>2],o=(((((((((((((((((G+v(A>>16,L)|0)+(v(65535&A,L)>>16)|0)+v(s>>16,y)|0)+(v(65535&s,y)>>16)|0)+v(E>>16,w)|0)+(v(65535&E,w)>>16)|0)+v(_>>16,P)|0)+(v(65535&_,P)>>16)|0)+v(c>>16,x)|0)+(v(65535&c,x)>>16)|0)+v(a>>16,T)|0)+(v(65535&a,T)>>16)|0)+v(b>>16,k)|0)+(v(65535&b,k)>>16)|0)+v(o>>16,g)|0)+(v(65535&o,g)>>16)|0)+v(n>>16,N)|0)+(v(65535&n,N)>>16)|0,s=f+16|0,n=10,!j)for(;;){if(_=d[(p+16|0)+(n<<1)>>1],o=(v(_,(a=u[((-1^n)+s<<2)+i>>2])>>16)+o|0)+(v(65535&a,_)>>16)|0,(0|O)==(0|(n=n+1|0)))break}n=u[(a=(s<<2)+i|0)>>2],_=n+(o=((0|(o=(0|o)>-0x8000000?o:-0x8000000))<0x7ffffff?o:0x7ffffff)<<4)|0;et:{if((0|_)>=0){n=(n&o)>-1?_:-0x80000000;break et}n=(n|o)>-1?0x7fffffff:_}if(u[a>>2]=n,o=(v(n>>16,C)+v(n,F)|0)+(v(65535&n,C)>>16)|0,d[(f<<1)+r>>1]=(0|o)>8388479?32767:(0|o)<-8388736?-32768:(o>>>7|0)+1>>>1|0,o=b,a=c,_=E,s=A,(0|B)==(0|(f=f+1|0)))break}o=u[(n=(B<<2)+i|0)+4>>2],i=a=u[n>>2],u[(a=r=e+1284|0)>>2]=i,u[a+4>>2]=o,a=u[n+60>>2],i=o=u[n+56>>2],u[(o=r)+56>>2]=i,u[o+60>>2]=a,o=u[n+52>>2],i=a=u[n+48>>2],u[(a=r)+48>>2]=i,u[a+52>>2]=o,a=u[n+44>>2],i=o=u[n+40>>2],u[(o=r)+40>>2]=i,u[o+44>>2]=a,o=u[n+36>>2],i=a=u[n+32>>2],u[(a=r)+32>>2]=i,u[a+36>>2]=o,a=u[n+28>>2],i=o=u[n+24>>2],u[(o=r)+24>>2]=i,u[o+28>>2]=a,o=u[n+20>>2],i=a=u[n+16>>2],u[(a=r)+16>>2]=i,u[a+20>>2]=o,a=u[n+12>>2],i=o=u[n+8>>2],u[(o=r)+8>>2]=i,u[o+12>>2]=a,d[e+4228>>1]=R,u[e+4224>>2]=U,u[t+12>>2]=m,u[t+8>>2]=m,u[t+4>>2]=m,u[t>>2]=m,D=p- -64|0;return}e0(2279,2268,350),I()}e0(2242,2268,294),I()}(e,t,r,n),u[e+4160>>2]=u[e+4160>>2]+1;return}i=s[e+2765|0],u[e+4164>>2]=i;i:{if((0|i)==2){r=u[e+2324>>2];o:if(r&&!((0|(a=u[(p=((r<<2)+t|0)-4|0)>>2]))<1)){for(f=e+4176|0,A=u[e+2332>>2],c=0;;){if((0|o)<(0|(i=(((d[(i=v(n=(-1^c)+r|0,10)+t|0)+98>>1]+d[i+96>>1]|0)+d[i+100>>1]|0)+d[i+102>>1]|0)+d[i+104>>1]|0))&&(o=v(n<<16>>16,10)+t|0,d[f+8>>1]=h[o+104>>1],a=h[o+100>>1]|h[o+102>>1]<<16,_=o=h[o+96>>1]|h[o+98>>1]<<16,d[(o=f)>>1]=_,d[o+2>>1]=_>>>16,d[o+4>>1]=a,d[o+6>>1]=a>>>16,u[e+4172>>2]=u[(n<<2)+t>>2]<<8,a=u[p>>2],o=i),(0|(c=c+1|0))==(0|r))break o;if(!((0|v(c,A))<(0|a)))break}}if(u[(i=e+4176|0)>>2]=0,u[i+4>>2]=0,d[e+4184>>1]=0,d[e+4180>>1]=o,(0|o)<=11468){d[(n=e+4182|0)>>1]=0,d[n+2>>1]=0,d[i>>1]=0,d[i+2>>1]=0,d[e+4180>>1]=v(0xb33400/(((0|o)>1?o:1)>>>0)<<16>>16,o<<16>>16)>>>10;break i}if((0|o)<15566)break i;d[(i=e+4182|0)>>1]=0,d[i+2>>1]=0,d[(i=e+4176|0)>>1]=0,d[i+2>>1]=0,d[e+4180>>1]=v(0xf334000/(o>>>0)|0,o<<16>>16)>>>14;break i}u[(o=e+4176|0)>>2]=0,u[o+4>>2]=0,d[e+4184>>1]=0,u[e+4172>>2]=v(c<<16>>16,4608),r=u[e+2324>>2]}ed(e+4186|0,t- -64|0,u[e+2340>>2]<<1),d[e+4240>>1]=u[t+136>>2],a=u[(o=(r<<2)+t|0)+8>>2],o=u[o+12>>2],t=a,u[(a=e+4244|0)>>2]=t,u[a+4>>2]=o,u[e+4260>>2]=u[e+2332>>2],u[e+4256>>2]=r}function eo(e,t,r,i,n,o,a,s,c,d,l,h,p){var f=0,_=0,m=0,g=0,S=0,b=0,T=0,y=0,R=0,I=0;R=f=D,y=u[e+8>>2],S=u[e+4>>2],D=m=f-(((g=(_=u[e+44>>2])<<d)<<2)+15&-16)|0,T=u[e+36>>2]-(c?0:d)|0,b=1<<d,f=c?b:1,c=c?_:g;t:{if(!((0|a)!=1|(0|s)!=2)){if(ey(e,t,m,i,n,o,b,l,h),s=ed(u[r+4>>2]+((0|S)/2<<2)|0,m,g<<2),(0|f)<1)break t;for(a=e- -64|0,d=0;;){if(es(a,(d<<2)+s|0,u[r>>2]+(v(c,d)<<2)|0,u[e+60>>2],S,T,f,p),(0|f)==(0|(d=d+1|0)))break}if((0|f)<1)break t;for(s=e- -64|0,d=0;;){if(es(s,(d<<2)+m|0,u[r+4>>2]+(v(c,d)<<2)|0,u[e+60>>2],S,T,f,p),(0|f)==(0|(d=d+1|0)))break}break t}if(!((0|s)==1?(0|a)==2:0)){for(I=(0|s)>1?s:1,a=e- -64|0,_=0;;){if(ey(e,(v(_,g)<<2)+t|0,m,(v(_,y)<<2)+i|0,n,o,b,l,h),(0|f)>=1)for(s=(_<<2)+r|0,d=0;;){if(es(a,(d<<2)+m|0,u[s>>2]+(v(c,d)<<2)|0,u[e+60>>2],S,T,f,p),(0|f)==(0|(d=d+1|0)))break}if((0|I)==(0|(_=_+1|0)))break}break t}if(d=u[r>>2],ey(e,t,m,i,n,o,b,l,h),ey(e,(g<<2)+t|0,_=((0|S)/2<<2)+d|0,(y<<2)+i|0,n,o,b,l,h),d=0,(0|g)>0)for(;;){if(A[(a=m+(s=d<<2)|0)>>2]=E(A[a>>2]*E(.5))+E(A[s+_>>2]*E(.5)),(0|g)==(0|(d=d+1|0)))break}if((0|f)<1)break t;for(s=e- -64|0,d=0;;){if(es(s,(d<<2)+m|0,u[r>>2]+(v(c,d)<<2)|0,u[e+60>>2],S,T,f,p),(0|f)==(0|(d=d+1|0)))break}}D=R}function ea(e,t,r,i,n,o,a,s){var c=E(0),d=E(0),l=0,h=0,p=0,f=0,_=0,m=E(0),g=0,S=0,b=E(0),T=0;if(_=l=D,!((0|i)!=2|(0|n)!=1|s)){if(c=A[a+4>>2],d=A[a>>2],(0|r)>=1)for(h=u[e+4>>2],p=u[e>>2],m=A[o>>2],s=0;;){if(b=A[h+(l=s<<2)>>2],i=s<<3,d=E(d+E(A[l+p>>2]+E(10000000031710769e-46))),A[i+t>>2]=d*E(30517578125e-15),c=E(c+E(b+E(10000000031710769e-46))),A[(4|i)+t>>2]=c*E(30517578125e-15),c=E(m*c),d=E(m*d),(0|(s=s+1|0))==(0|r))break}A[a+4>>2]=c,A[a>>2]=d,D=_;return}if(!s){for(T=(0|i)>1?i:1,g=(0|r)/(0|n)|0,D=h=l-((r<<2)+15&-16)|0,d=A[o>>2],o=0;;){l=(s=f<<2)+t|0,p=u[e+s>>2],c=A[(S=a+s|0)>>2];a:{if((0|n)<=1){if(s=0,(0|r)<=0)break a;for(;;){if(c=E(c+E(A[(s<<2)+p>>2]+E(10000000031710769e-46))),A[(v(i,s)<<2)+l>>2]=c*E(30517578125e-15),c=E(d*c),(0|(s=s+1|0))==(0|r))break}break a}if(o=1,s=0,(0|r)<1)break a;for(;;){if(c=E(c+E(A[p+(o=s<<2)>>2]+E(10000000031710769e-46))),A[o+h>>2]=c,c=E(d*c),o=1,(0|(s=s+1|0))==(0|r))break}}A[S>>2]=c;u:if(o){if(s=0,(0|g)<1)break u;for(;;){if(A[(v(i,s)<<2)+l>>2]=A[(v(n,s)<<2)+h>>2]*E(30517578125e-15),(0|g)==(0|(s=s+1|0)))break}}if((0|T)==(0|(f=f+1|0)))break}D=_;return}e0(35264,34183,279),I()}function es(e,t,r,i,n,o,a,s){var c=0,l=0,h=E(0),p=E(0),f=E(0),_=E(0),m=0,g=0,S=0,b=0,T=0,y=E(0),R=E(0),I=0,C=0;if(m=(s=u[e>>2])>>1,l=u[e+24>>2],(0|o)>=1)for(;;){if(m=(s=m)>>1,l=(s<<2)+l|0,(0|(c=c+1|0))==(0|o))break}c=(n<<1&-4)+r|0,b=u[((o<<2)+e|0)+8>>2];i:{if((0|s)<=3){B(b,c);break i}for(I=(0|(g=s>>2))>1?g:1,o=0,e=(v(m-1|0,a)<<2)+t|0,S=u[b+44>>2],C=0-(T=a<<1)<<2;;){if(a=d[S>>1]<<3,f=A[e>>2],_=A[(o<<2)+l>>2],h=A[t>>2],p=A[(o+g<<2)+l>>2],A[(4|a)+c>>2]=E(f*_)+E(h*p),A[a+c>>2]=E(_*h)-E(f*p),S=S+2|0,e=e+C|0,t=(T<<2)+t|0,(0|I)==(0|(o=o+1|0)))break}if(B(b,c),(0|s)<4)break i;for(S=(0|(o=g+1>>1))>1?o:1,t=(m<<2)+c|0,o=0;;){if(f=A[(e=t-4|0)>>2],_=A[(t=t-8|0)>>2],h=A[c+4>>2],p=A[(o<<2)+l>>2],y=A[c>>2],R=A[(o+g<<2)+l>>2],A[c>>2]=E(h*p)+E(y*R),A[e>>2]=E(h*R)-E(y*p),h=A[(g+(e=-1^o)<<2)+l>>2],p=A[(e+m<<2)+l>>2],A[t>>2]=E(f*h)+E(_*p),A[c+4>>2]=E(f*p)-E(_*h),c=c+8|0,(0|S)==(0|(o=o+1|0)))break}}if(m=(0|n)/2|0,(0|n)>=2)for(l=(c=n<<2)+r|0,c=i+c|0,o=0;;){if(f=A[r>>2],_=A[(c=c-4|0)>>2],h=A[(l=l-4|0)>>2],p=A[i>>2],A[r>>2]=E(f*_)-E(h*p),A[l>>2]=E(h*_)+E(f*p),i=i+4|0,r=r+4|0,(0|m)==(0|(o=o+1|0)))break}}function ec(e,t,r,i,n){var o=0,a=0,c=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0;D=p=D-160|0,A=8,a=eO(e,v(r>>1,9)+7744|0,8);t:{r:{if((-16&n)<(0|n)){if((0|n)==120)break r;e0(8554,8596,59),I()}if((0|n)<16)break t;A=n>>4}for(E=v(a,18)+7552|0;;){if(u[(_=p+(a=f<<2)|0)>>2]=0,c=(p+80|0)+a|0,o=eO(e,E,8),u[c>>2]=o,a=0,(0|o)==17){for(;;){if(o=eO(e,((0|(a=a+1|0))==10)+7714|0,8),u[c>>2]=o,(0|o)!=17)break}u[_>>2]=a}if((0|A)==(0|(f=f+1|0)))break}for(a=0;;){o=(a<<16>>11)+t|0,c=u[(p+80|0)+(a<<2)>>2];c:{if((0|c)>=1){!function(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0;s=e;t:{r:if(!((0|r)<1)){if(i=eO(t,l[r+8416|0]+8256|0,8),n=r-i|0,(0|(r=i<<16))<1){i=0;break r}if(r>>=16,a=eO(t,l[r+8416|0]+8096|0,8),i=r-a|0,(0|(r=a<<16))<=0)break r;if(r>>=16,a=eO(t,l[r+8416|0]+7936|0,8),o=r-a|0,(0|(r=a<<16))<1)break r;r>>=16,a=eO(t,l[r+8416|0]+7776|0,8),d[e>>1]=a,r=r-a|0;break t}d[e>>1]=0,r=0}d[s+2>>1]=r,s=e,r=o<<16;n:{if((0|r)>=1){r>>=16,o=eO(t,l[r+8416|0]+7776|0,8),d[e+4>>1]=o,r=r-o|0;break n}d[e+4>>1]=0,r=0}d[s+6>>1]=r,r=0,s=e;a:{s:{if((0|(i<<=16))<=0){o=e+8|0;break s}if(c=e,o=e+8|0,i=eO(t,l[(r=i>>16)+8416|0]+7936|0,8),r=r-i|0,(0|(i<<=16))<1)break s;i>>=16,a=eO(t,l[i+8416|0]+7776|0,8),d[c+8>>1]=a,i=i-a|0;break a}d[o>>1]=0,i=0}d[s+10>>1]=i,s=e,r<<=16;d:{if((0|r)>=1){r>>=16,i=eO(t,l[r+8416|0]+7776|0,8),d[e+12>>1]=i,r=r-i|0;break d}d[e+12>>1]=0,r=0}d[s+14>>1]=r,i=0,r=0,s=e;l:{h:{q:if(!((0|(n<<=16))>=1)||(n=eO(t,l[(r=n>>16)+8416|0]+8096|0,8),r=r-n|0,!((0|(n<<=16))>0))){o=e+16|0;break h}if(c=e,o=e+16|0,n=eO(t,l[(i=n>>16)+8416|0]+7936|0,8),i=i-n|0,(0|(n<<=16))<1)break h;n>>=16,a=eO(t,l[n+8416|0]+7776|0,8),d[c+16>>1]=a,n=n-a|0;break l}d[o>>1]=0,n=0}d[s+18>>1]=n,s=e,i<<=16;p:{if((0|i)>=1){i>>=16,n=eO(t,l[i+8416|0]+7776|0,8),d[e+20>>1]=n,i=i-n|0;break p}d[e+20>>1]=0,i=0}d[s+22>>1]=i,i=0,s=e;ee:{f:{if((0|(r<<=16))<=0){n=e+24|0;break f}if(c=e,n=e+24|0,r>>=16,o=eO(t,l[r+8416|0]+7936|0,8),i=r-o|0,(0|(r=o<<16))<1)break f;r>>=16,o=eO(t,l[r+8416|0]+7776|0,8),d[c+24>>1]=o,r=r-o|0;break ee}d[n>>1]=0,r=0}if(d[s+26>>1]=r,(0|(r=i<<16))>=1){r>>=16,t=eO(t,l[r+8416|0]+7776|0,8),d[e+28>>1]=t,d[e+30>>1]=r-t;return}d[e+28>>1]=0,d[e+30>>1]=0}(o,e,c);break c}d[o>>1]=0,d[o+2>>1]=0,d[o+4>>1]=0,d[o+6>>1]=0,d[o+24>>1]=0,d[o+26>>1]=0,d[o+28>>1]=0,d[o+30>>1]=0,d[o+16>>1]=0,d[o+18>>1]=0,d[o+20>>1]=0,d[o+22>>1]=0,d[o+8>>1]=0,d[o+10>>1]=0,d[o+12>>1]=0,d[o+14>>1]=0}if((0|A)==(0|(a=a+1|0)))break}for(;;){if((0|(c=u[(g=m<<2)+p>>2]))>=1){for(E=(m<<16>>11)+t|0,f=0;;){for(a=d[(_=(f<<1)+E|0)>>1],o=0;;){if(a=eO(e,6704,8)+(a<<1)|0,(0|c)==(0|(o=o+1|0)))break}if(d[_>>1]=a,(0|(f=f+1|0))==16)break}u[(a=(p+80|0)+g|0)>>2]=u[a>>2]|c<<5}if((0|(m=m+1|0))==(0|A))break}}(function(e,t,r,i,n,o){var a=0,c=0,p=0;if(D=a=D-16|0,s[a+15|0]=0,(0|r)>=8)for(p=v((i<<1)+n<<16>>16,7)+8448|0,i=(0|(r=r+8>>4))>1?r:1;;){if((0|(r=u[(c<<2)+o>>2]))>=1)for(r&=31,s[a+14|0]=l[(r>>>0<6?r:6)+p|0],r=0;;){if(d[(n=(r<<1)+t|0)>>1]>=1&&(d[n>>1]=v((eO(e,a+14|0,8)<<1)-1|0,h[n>>1])),(0|(r=r+1|0))==16)break}if(t=t+32|0,(0|(c=c+1|0))==(0|i))break}D=a+16|0})(e,t,n,r,i,p+80|0),D=p+160|0}function ed(e,t,r){var i=0,n=0,o=0;if(r>>>0>=512)return k(0|e,0|t,0|r),e;n=e+r|0;r:{if(!((e^t)&3)){n:{if((0|r)<1||!(3&e)){r=e;break n}for(r=e;;){if(s[0|r]=l[0|t],t=t+1|0,n>>>0<=(r=r+1|0)>>>0)break n;if(!(3&r))break}}i=-4&n;c:if(!(i>>>0<64)&&!((o=i+-64|0)>>>0<r>>>0)){for(;;){if(u[r>>2]=u[t>>2],u[r+4>>2]=u[t+4>>2],u[r+8>>2]=u[t+8>>2],u[r+12>>2]=u[t+12>>2],u[r+16>>2]=u[t+16>>2],u[r+20>>2]=u[t+20>>2],u[r+24>>2]=u[t+24>>2],u[r+28>>2]=u[t+28>>2],u[r+32>>2]=u[t+32>>2],u[r+36>>2]=u[t+36>>2],u[r+40>>2]=u[t+40>>2],u[r+44>>2]=u[t+44>>2],u[r+48>>2]=u[t+48>>2],u[r+52>>2]=u[t+52>>2],u[r+56>>2]=u[t+56>>2],u[r+60>>2]=u[t+60>>2],t=t- -64|0,!(o>>>0>=(r=r- -64|0)>>>0))break}}if(r>>>0>=i>>>0)break r;for(;;){if(u[r>>2]=u[t>>2],t=t+4|0,!(i>>>0>(r=r+4|0)>>>0))break}break r}if(n>>>0<4||(i=n-4|0)>>>0<e>>>0){r=e;break r}for(r=e;;){if(s[0|r]=l[0|t],s[r+1|0]=l[t+1|0],s[r+2|0]=l[t+2|0],s[r+3|0]=l[t+3|0],t=t+4|0,!(i>>>0>=(r=r+4|0)>>>0))break}}if(r>>>0<n>>>0)for(;;){if(s[0|r]=l[0|t],t=t+1|0,(0|n)==(0|(r=r+1|0)))break}return e}function eu(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0;for(p=a=D,D=s=a-(((n=u[e+268>>2])<<2)+31&-16)|0,a=u[e+36>>2],o=u[e+32>>2],u[s+8>>2]=o,u[s+12>>2]=a,o=u[e+28>>2],a=u[e+24>>2],u[s>>2]=a,u[s+4>>2]=o,f=s+16|0,_=u[e+272>>2];;){if(ef(e,f,r,c=(0|i)<(0|n)?i:n),a=0,(0|(l=c<<17))>=1)for(;;){if(o=(h=v(65535&a,12)>>>16|0)<<3,n=(a>>16<<1)+s|0,A=((v(d[o+2610>>1],d[n+2>>1])+v(d[o+2608>>1],d[n>>1])|0)+v(d[o+2612>>1],d[n+4>>1])|0)+v(d[o+2614>>1],d[n+6>>1])|0,o=((n=(((A+v(d[(o=11-h<<3)+2614>>1],d[n+8>>1])|0)+v(d[o+2612>>1],d[n+10>>1])|0)+v(d[o+2610>>1],d[n+12>>1])|0)+v(d[o+2608>>1],d[n+14>>1])|0)>>14)+1>>1,d[t>>1]=(0|n)>0x3fffbfff?32767:(0|o)>-32768?o:-32768,t=t+2|0,!((0|l)>(0|(a=a+_|0))))break}if((0|(i=i-c|0))>=1){a=u[(n=(c<<2)+s|0)+4>>2],o=u[n>>2],u[s>>2]=o,u[s+4>>2]=a,o=u[n+12>>2],a=u[n+8>>2],u[s+8>>2]=a,u[s+12>>2]=o,r=(c<<1)+r|0,n=u[e+268>>2];continue}break}a=u[(n=(c<<2)+s|0)+4>>2],o=u[n>>2],u[e+24>>2]=o,u[e+28>>2]=a,o=u[n+12>>2],a=u[n+8>>2],u[e+32>>2]=a,u[e+36>>2]=o,D=p}function el(e,t,r,i,n,o,a){var c=0,p=0,f=0;D=c=D-144|0,f=u[e+2328>>2],p=c,u[c+136>>2]=0;t:{r:{if(f-1>>>0<320){n:{o:{switch(0|n){case 2:if(1!=u[((u[e+2388>>2]<<2)+e|0)+2420>>2])break o;break;case 0:break;default:break o}if(D=c=c-((f+15&0x7ffffff0)<<1)|0,et(e,t,u[e+2388>>2],n,o),ec(t,c,s[0|(n=e+2765|0)],s[e+2766|0],u[e+2328>>2]),!function(e,t,r){var i=0,n=0,o=0,a=0,c=0,p=0,f=0;D=n=D+-64|0,function(e,t,r,i,n){var o=0,a=0,c=0,d=0,l=0;if((0|n)>=1)for(;;){o=s[t+c|0],l=r;i:{if(!(i|c)){o=(0|o)>(0|(a=s[0|r]-16|0))?o:a;break i}if((0|(o=o-4|0))>(0|(d=(a=s[0|r])+8|0))){o=((o<<1)-d|0)+a|0;break i}o=o+a|0}if(o=(o=o<<24>>24>0?o:0)<<24>>24<63?o:63,s[0|l]=o,o&=255,o=(v(o,7281)>>>16|0)+v(o,29)|0,u[(c<<2)+e>>2]=function(e){var t=0,r=0,i=0;t=0;t:if(!((0|e)<0)){if(t=0x7fffffff,(0|e)>3966)break t;t=127&e,i=1<<(r=e>>>7|0),e=(0|e)<=2047?(v(v(128-t|0,t),-174)>>16)+t<<r>>7:v((v(v(128-t|0,t),-174)>>16)+t|0,i>>>7|0),t=i+e|0}return t}((o>>>0<1877?o:1877)+2090|0),(0|(c=c+1|0))==(0|n))break}}(t+16|0,e+2736|0,e+2312|0,(0|r)==2,u[e+2324>>2]),function(e,t,r){var i=0,n=0,o=0,a=0,c=0,p=0,f=0,_=0;if(D=a=D-80|0,eU(a+32|0,a- -64|0,r,s[0|t]),!(f=(0|(c=(n=h[r+2>>1])<<16>>16))<1))for(p=d[r+4>>1];;){if(i=(o=s[t+n|0])<<10,o=(0|o)>0?i-102|0:(102|i)&o>>31,i=n-1|0,_=(v(o>>16,p)+(v(l[i+(a- -64|0)|0],_<<16>>16)>>8)|0)+(v(65534&o,p)>>16)|0,d[(i<<1)+a>>1]=_,o=(0|n)>1,n=i,!o)break}if(!f)for(o=(n=v(s[0|t],c))+u[r+8>>2]|0,p=u[r+12>>2]+(n<<1)|0,n=0;;){if(t=(i=n<<1)+e|0,i=(0|(i=((d[i+a>>1]<<14)/d[i+p>>1]|0)+(l[n+o|0]<<7)|0))>0?i:0,d[t>>1]=(0|i)<32767?i:32767,!((0|(n=n+1|0))<(0|(c=d[r+2>>1]))))break}!function(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0,u=0,l=0,p=0,f=0,_=0,A=0,m=0,v=0;f=(r<<1)+t|0,p=((_=r-1|0)<<1)+e|0,v=(0|r)<2;t:{for(;;){if(o=d[e>>1],i=o-(u=d[t>>1])|0,n=1,a=0,!v)for(;;){if(s=o<<16,c=s=((o=d[(l=n<<1)+e>>1])-(s>>16)|0)-d[t+l>>1]|0,i=(s=(0|i)>(0|s))?c:i,a=s?n:a,(0|(n=n+1|0))==(0|r))break}if(c=n=32768-((o=d[f>>1])+d[p>>1]|0)|0,(((n=(0|i)>(0|n))?c:i)|0)>-1)break t;i=n?r:a;o:{if(!i){d[e>>1]=u;break o}s:{c:{if((0|r)!=(0|i)){if((0|i)>=1)break c;u=0;break s}d[p>>1]=-32768-o;break o}if(n=1,(0|i)==1)break s;for(;;){if(u=d[(n<<1)+t>>1]+u|0,(0|(n=n+1|0))==(0|i))break}}s=(l=d[(A=(c=i<<1)+t|0)>>1]>>1)+u|0,a=32768;l:if(!((0|r)<=(0|i))){if(a=32768-o|0,(0|(n=_))<=(0|i))break l;for(;;){if(a=a-d[(n<<1)+t>>1]|0,!((0|(n=n-1|0))>(0|i)))break}}u=(n=e+c|0)-2|0,i=((i=d[n>>1]+d[u>>1]|0)>>1)+(1&i)|0,a=a-l|0;q:{if((0|s)>(0|a)){if(c=o=s,(0|i)>(0|o))break q;c=(0|i)<(0|a)?a:i;break q}if(c=o=a,(0|i)>(0|o))break q;c=(0|i)<(0|s)?s:i}i=(o=c)-l|0,d[u>>1]=i,d[n>>1]=h[A>>1]+i}if((0|(m=m+1|0))==20)break}if(function(e,t){var r=0,i=0,n=0,o=0,a=0;if(i=1,(0|t)>=1){if((0|t)!=1)for(;;){o=d[(i<<1)+e>>1],r=i;n:{for(;;){if((0|o)>=(0|(n=d[((a=r-1|0)<<1)+e>>1])))break n;if(d[(r<<1)+e>>1]=n,n=(0|r)>1,r=a,!n)break}r=0}if(d[(r<<1)+e>>1]=o,(0|(i=i+1|0))==(0|t))break}return}e0(8629,8617,144),I()}(e,r),n=d[e>>1],i=(0|(i=d[t>>1]))<(0|n)?n:i,d[e>>1]=i,!(s=(0|r)<2))for(n=1;;){if(c=o=(a=n<<1)+e|0,o=d[o>>1],i=(0|(i=(0|(i=(0|(i=d[t+a>>1]+(i<<16>>16)|0))<32767?i:32767))>-32768?i:-32768))<(0|o)?o:i,d[c>>1]=i,(0|(n=n+1|0))==(0|r))break}if(n=d[p>>1],i=(0|(i=32768-d[f>>1]|0))>(0|n)?n:i,d[p>>1]=i,s)break t;for(n=r-2|0;;){if(r=o=(a=n<<1)+e|0,o=d[o>>1],i=(0|(i=(i<<16>>16)-d[(t+a|0)+2>>1]|0))>(0|o)?o:i,d[r>>1]=i,a=(0|n)>0,n=n-1|0,!a)break}}}(e,u[r+36>>2],c),D=a+80|0}(n+32|0,e+2744|0,u[e+2732>>2]),K(p=t- -64|0,n+32|0,u[e+2340>>2],u[e+4168>>2]),f=t+32|0;t:{r:{if(1==u[e+2376>>2]){s[e+2767|0]=4;break r}if((0|(a=s[e+2767|0]))>3)break r;if((0|(c=u[e+2340>>2]))>=1)for(r=0;;){if(o=d[((i=r<<1)+e|0)+2344>>1],d[n+i>>1]=(v(d[(n+32|0)+i>>1]-o|0,a)>>>2|0)+o,(0|c)==(0|(r=r+1|0)))break}K(f,n,c,u[e+4168>>2]);break t}ed(f,p,u[e+2340>>2]<<1)}r=u[e+2340>>2],ed(e+2344|0,n+32|0,r<<1),u[e+4160>>2]&&(eG(f,r,63570),eG(p,u[e+2340>>2],63570));s:{if(2==l[e+2765|0]){if(function(e,t,r,i,n){var o=0,a=0,c=0,d=0,l=0,h=0,p=0;t:{r:{if((0|i)==8){if((0|n)==4){d=8704,l=11;break r}if((0|n)==2){d=8653,l=3;break r}e0(8888,8939,54),I()}if((0|n)==4){d=8752,l=34;break r}if((0|n)!=2)break t;d=8672,l=12}for(i<<=16,p=(o=i>>15)+e|0,c=v(i>>16,18),i=0;;){h=(i<<2)+r|0,e=s[(v(i,l)+t|0)+d|0]+p|0,u[h>>2]=e;c:{if((0|o)>(0|c)){if(a=o,(0|e)>(0|o))break c;a=(0|e)<(0|c)?c:e;break c}if(a=c,(0|e)>(0|c))break c;a=(0|e)<(0|o)?o:e}if(u[h>>2]=a,(0|n)==(0|(i=i+1|0)))break}return}e0(8888,8939,63),I()}(d[e+2762>>1],s[e+2764|0],t,u[e+2316>>2],u[e+2324>>2]),(0|(a=u[e+2324>>2]))>=1)for(c=u[(s[e+2768|0]<<2)+7456>>2],o=0;;){if(r=v(o,10)+t|0,i=v(s[(e+o|0)+2740|0],5)+c|0,d[r+96>>1]=s[0|i]<<7,d[r+98>>1]=s[i+1|0]<<7,d[r+100>>1]=s[i+2|0]<<7,d[r+102>>1]=s[i+3|0]<<7,d[r+104>>1]=s[i+4|0]<<7,(0|a)==(0|(o=o+1|0)))break}r=d[(s[e+2769|0]<<1)+6728>>1];break s}r=0,eE(eE(t,0,u[e+2324>>2]<<2)+96|0,0,v(u[e+2324>>2],10)),s[e+2768|0]=0}u[t+136>>2]=r,D=n- -64|0}(e,p,o),!function(e,t,r,i,n){var o=0,a=0,c=0,h=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,b=0,T=0,y=0,R=0,C=0,k=0,w=0,O=0,N=0,P=0,M=0,x=0,U=0,B=0;if(x=A=D-32|0,D=A,D=A=O=A-((u[e+2336>>2]<<1)+15&-16)|0,D=A=k=A-(((c=u[e+2328>>2])+u[e+2336>>2]<<2)+15&-16)|0,D=A=N=A-((p=u[e+2332>>2]<<2)+15&-16)|0,D=g=A-(p+79&-16)|0,m=s[e+2767|0],(0|c)>=1)for(b=d[((s[e+2765|0]<<1&-4)+(s[e+2766|0]<<1)|0)+6720>>1]<<4,h=s[e+2770|0],c=0;;){C=(o=(c<<2)+e|0)+4|0,A=(p=d[(c<<1)+i>>1])<<14,u[C>>2]=A,h=v(h,0xbb38435)+0x3619636b|0,a=o;i:{if((0|p)>=1)A=A-1280|0;else{if((0|p)>-1)break i;A|=1280}u[a+4>>2]=A}if(A=A+b|0,u[o+4>>2]=(0|h)<0?0-A|0:A,h=h+p|0,!((0|(c=c+1|0))<u[e+2328>>2]))break}o=u[e+1288>>2],i=f=u[(a=e)+1284>>2],u[(f=g)>>2]=i,u[f+4>>2]=o,o=u[(a=a+1340|0)>>2],f=u[a+4>>2],i=o,u[(o=g)+56>>2]=i,u[o+60>>2]=f,f=u[(a=e+1332|0)>>2],o=u[a+4>>2],i=f,u[(f=g)+48>>2]=i,u[f+52>>2]=o,o=u[(a=e+1324|0)>>2],f=u[a+4>>2],i=o,u[(o=g)+40>>2]=i,u[o+44>>2]=f,f=u[(a=e+1316|0)>>2],o=u[a+4>>2],i=f,u[(f=g)+32>>2]=i,u[f+36>>2]=o,o=u[(a=e+1308|0)>>2],f=u[a+4>>2],i=o,u[(o=g)+24>>2]=i,u[o+28>>2]=f,f=u[(a=e+1300|0)>>2],o=u[a+4>>2],i=f,u[(f=g)+16>>2]=i,u[f+20>>2]=o,o=u[(a=e+1292|0)>>2],f=u[a+4>>2],i=o,u[(o=g)+8>>2]=i,u[o+12>>2]=f;a:{if(u[e+2324>>2]>=1)for(w=e+4|0,C=u[e+2336>>2],B=(0|m)<4,P=r;;){A=ed(x,U=((y<<4&-32)+t|0)+32|0,u[e+2340>>2]<<1),h=S(i=(c=(R=u[(M=(y<<2)+t|0)+16>>2])>>31)^c+R),o=((c=0x1fffffff/(0|(p=(b=R<<h-1)>>16))|0)>>15)+1>>1,p=0-((v(c=(m=c<<16)>>16,65535&b)>>16)+v(c,p)<<3)|0,p=((v(p,o)+m|0)+v(p>>16,c)|0)+(v(65528&p,c)>>16)|0,m=15-h|0,T=v(y,10),_=l[e+2765|0];d:{if(i>>>0<=131071){m=0x7fffffff>>>(i=0-m|0)|0,a=-0x80000000>>i,E=((0|p)>(0|m)?m:(0|p)<(0|a)?a:p)<<i;break d}E=p>>m}if(T=t+T|0,i=65536,(0|R)!=(0|(p=u[e>>2]))){i=S((i=p>>31)^i+p),p<<=i-1,m=p,a=f=(p=v(p>>16,c)+(v(65535&p,c)>>16)|0)>>31,o=f=(o=b)>>31,a=o=e6(p,f=a,b,o),c=(v((b=m-(((0x1fffffff&(f=L))<<3|a>>>29)&-8)|0)>>16,c)+p|0)+(v(65535&b,c)>>16)|0,h=(p=i-h|0)+13|0,p=p+29|0;h:{if((0|p)<=15){h=0x7fffffff>>>(p=0-h|0)|0,i=-0x80000000>>p,i=((0|c)>(0|h)?h:(0|i)>(0|c)?i:c)<<p;break h}i=(0|p)<48?c>>h:0}for(b=65535&i,m=i>>16,c=0;;){if(o=p=(c<<2)+g|0,h=(p=u[p>>2])<<16>>16,u[o>>2]=((v(b,h)>>16)+v(h,m)|0)+v((p>>15)+1>>1,i),(0|(c=c+1|0))==16)break}}u[e>>2]=R;p:{$:{ee:{if(!(!u[e+4160>>2]|2!=u[e+4164>>2]|((255&_)==2|y>>>0>1))){d[(a=T)+96>>1]=0,d[a+98>>1]=0,d[a+100>>1]=0,d[a+102>>1]=0,d[a+104>>1]=0,d[a+100>>1]=4096,a=u[e+2308>>2],u[M>>2]=a;break ee}if((255&_)!=2){h=u[e+2332>>2],i=w;break $}a=u[M>>2]}er:{if(!((0|y)==2&B?0:y)){if(p=u[e+2336>>2],(0|(c=(p-a|0)-(h=u[e+2340>>2])|0))<=2)break a;if(c=c-2|0,(0|y)==2&&(ed(((p<<1)+e|0)+1348|0,r,u[e+2332>>2]<<2),p=u[e+2336>>2],h=u[e+2340>>2]),eg((c<<1)+O|0,((v(u[e+2332>>2],y)+c<<1)+e|0)+1348|0,U,p-c|0,h,n),!y&&(E=(v(c=d[t+136>>1],65535&E)>>16)+v(E>>16,c)<<2),(0|a)<-1)break er;for(h=a+1|0,i=65535&E,b=E>>16,m=u[e+2336>>2],c=0;;){if(o=(C+(p=-1^c)<<2)+k|0,p=d[(p+m<<1)+O>>1],u[o>>2]=(v(p,i)>>16)+v(p,b),p=(0|c)==(0|h),c=c+1|0,!!p)break}break er}if((0|i)==65536|(0|a)<-1)break er;for(b=a+1|0,m=65535&i,_=i>>16,c=0;;){if(o=p=((-1^c)+C<<2)+k|0,h=(p=u[p>>2])<<16>>16,u[o>>2]=((v(m,h)>>16)+v(h,_)|0)+v((p>>15)+1>>1,i),p=(0|c)!=(0|b),c=c+1|0,!p)break}}if((0|(h=u[e+2332>>2]))<1)break p;for(c=((C-a<<2)+k|0)+8|0,i=d[T+104>>1],b=d[T+102>>1],m=d[T+100>>1],_=d[T+98>>1],T=d[T+96>>1],p=0;;){if(o=N+(a=p<<2)|0,f=v((E=u[c>>2])>>16,T)+(v(65535&E,T)>>16)|0,f=(f+v((E=u[c-4>>2])>>16,_)|0)+(v(65535&E,_)>>16)|0,f=(f+v((E=u[c-8>>2])>>16,m)|0)+(v(65535&E,m)>>16)|0,f=(f+v((E=u[c-12>>2])>>16,b)|0)+(v(65535&E,b)>>16)|0,E=u[c-16>>2],a=(u[a+w>>2]+((f+v(E>>16,i)|0)+(v(65535&E,i)>>16)<<1)|0)+4|0,u[o>>2]=a,u[(C<<2)+k>>2]=a<<1,C=C+1|0,c=c+4|0,(0|(p=p+1|0))==(0|h))break}i=N}if(T=i,(0|h)<1)break p;for(i=R>>>6<<16>>16,a=(b=u[e+2340>>2])>>>1|0,E=(R>>21)+1>>1,p=0;;){switch(b-10|0){default:e0(9010,8991,199),I();case 0:case 6:break}_=d[A>>1],o=(v(_,(h=u[(c=(m=p<<2)+g|0)+60>>2])>>16)+a|0)+(v(65535&h,_)>>16)|0,_=d[A+2>>1],o=(o+v(_,(h=u[c+56>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+4>>1],o=(o+v(_,(h=u[c+52>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+6>>1],o=(o+v(_,(h=u[c+48>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+8>>1],o=(o+v(_,(h=u[c+44>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+10>>1],o=(o+v(_,(h=u[c+40>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+12>>1],o=(o+v(_,(h=u[c+36>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+14>>1],o=(o+v(_,(h=u[c+32>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+16>>1],o=(o+v(_,(h=u[c+28>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+18>>1],h=(o+v(_,(h=u[c+24>>2])>>16)|0)+(v(65535&h,_)>>16)|0,(0|b)==16&&(R=d[A+20>>1],o=(v(R,(_=u[c+20>>2])>>16)+h|0)+(v(65535&_,R)>>16)|0,_=d[A+22>>1],o=(o+v(_,(h=u[c+16>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+24>>1],o=(o+v(_,(h=u[c+12>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+26>>1],o=(o+v(_,(h=u[c+8>>2])>>16)|0)+(v(65535&h,_)>>16)|0,_=d[A+28>>1],o=(o+v(_,(h=u[c+4>>2])>>16)|0)+(v(65535&h,_)>>16)|0,h=d[A+30>>1],h=(o+v(h,(c=u[c>>2])>>16)|0)+(v(65535&c,h)>>16)|0),o=((_=p+16|0)<<2)+g|0,c=((0|(c=(0|h)>-0x8000000?h:-0x8000000))<0x7ffffff?c:0x7ffffff)<<4,m=c+(h=u[m+T>>2])|0;m:{if((0|m)>=0){c=(c&h)>-1?m:-0x80000000;break m}c=(c|h)>-1?0x7fffffff:m}if(u[o>>2]=c,c=(v(c>>16,i)+v(c,E)|0)+(v(65535&c,i)>>16)|0,d[(p<<1)+P>>1]=(0|c)>8388479?32767:(0|c)<-8388736?-32768:(c>>>7|0)+1>>>1|0,h=u[e+2332>>2],!((0|h)>(0|(p=p+1|0))))break}}if(o=u[(f=A=g+(c=h<<2)|0)>>2],a=u[f+4>>2],i=o,u[(o=g)>>2]=i,u[o+4>>2]=a,o=u[f+60>>2],i=a=u[f+56>>2],u[(a=g)+56>>2]=i,u[a+60>>2]=o,a=u[f+52>>2],i=o=u[f+48>>2],u[(o=g)+48>>2]=i,u[o+52>>2]=a,o=u[f+44>>2],i=a=u[f+40>>2],u[(a=g)+40>>2]=i,u[a+44>>2]=o,a=u[f+36>>2],i=o=u[f+32>>2],u[(o=g)+32>>2]=i,u[o+36>>2]=a,o=u[f+28>>2],i=a=u[f+24>>2],u[(a=g)+24>>2]=i,u[a+28>>2]=o,a=u[f+20>>2],i=o=u[f+16>>2],u[(o=g)+16>>2]=i,u[o+20>>2]=a,o=u[f+12>>2],i=a=u[f+8>>2],u[(a=g)+8>>2]=i,u[a+12>>2]=o,P=(h<<1)+P|0,w=c+w|0,!((0|(y=y+1|0))<u[e+2324>>2]))break}o=u[(f=g)>>2],a=u[f+4>>2],t=o,u[(o=A=e+1284|0)>>2]=t,u[o+4>>2]=a,o=u[f+60>>2],e=a=u[f+56>>2],u[(a=A)+56>>2]=e,u[a+60>>2]=o,a=u[f+52>>2],e=o=u[f+48>>2],u[(o=A)+48>>2]=e,u[o+52>>2]=a,o=u[f+44>>2],e=a=u[f+40>>2],u[(a=A)+40>>2]=e,u[a+44>>2]=o,a=u[f+36>>2],e=o=u[f+32>>2],u[(o=A)+32>>2]=e,u[o+36>>2]=a,o=u[f+28>>2],e=a=u[f+24>>2],u[(a=A)+24>>2]=e,u[a+28>>2]=o,a=u[f+20>>2],e=o=u[f+16>>2],u[(o=A)+16>>2]=e,u[o+20>>2]=a,o=u[f+12>>2],e=a=u[f+8>>2],u[(a=A)+8>>2]=e,u[a+12>>2]=o,D=x+32|0;return}e0(8959,8991,144),I()}(e,p,r,c,a),en(e,p,r,0,a),u[e+4160>>2]=0,c=s[0|n],u[e+4164>>2]=c,c>>>0>=3)break r;u[e+2376>>2]=0;break n}s[e+2765|0]=u[e+4164>>2],en(e,p,r,1,a)}if(a=u[e+2336>>2],(0|a)<(0|(c=u[e+2328>>2])))break t;return t=(n=e+1348|0)+(c<<1)|0,ed((c=a-c<<1)+ep(n,t,c)|0,r,u[e+2328>>2]<<1),!function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,b=0,T=0,y=0,R=0,C=0,k=0,w=0,O=0,N=0,P=0,L=0,M=0,x=0,U=0,B=0,V=0;if(D=l=_=D-32|0,(0|(c=u[e+2316>>2]))!=u[e+4156>>2]){if(a=32767/((o=u[e+2340>>2])+1|0)|0,(0|o)>=1)for(;;){if(s=s+a|0,d[((n<<1)+e|0)+4052>>1]=s,(0|o)==(0|(n=n+1|0)))break}u[e+4156>>2]=c,u[(o=e+4148|0)>>2]=0,u[o+4>>2]=3176576}n:{o:{if(!u[e+4160>>2]){s:if(!u[e+4164>>2]){if(n=0,(0|(a=u[e+2340>>2]))>0)for(;;){if(f=o=(s=(n<<1)+e|0)+4052|0,o=d[o>>1],s=d[s+2344>>1]-o|0,d[f>>1]=(v(s>>>16|0,16348)+(v(65535&s,16348)>>>16|0)|0)+o,(0|a)==(0|(n=n+1|0)))break}A=e+2772|0,n=0,c=u[e+2324>>2];u:{if((0|c)<=0){o=0;break u}for(o=0,s=0;;){if(f=a=u[((n<<2)+t|0)+16>>2],s=(a=(0|s)<(0|a))?f:s,o=a?n:o,(0|c)==(0|(n=n+1|0)))break}}if(ep((((n=u[e+2332>>2])<<2)+e|0)+2772|0,A,v((c<<2)-4|0,n)),ed(A,((v(o,n=u[e+2332>>2])<<2)+e|0)+4|0,n<<2),(0|(a=u[e+2324>>2]))<1)break s;for(n=u[e+4148>>2],s=0;;){if(n=v((o=u[((s<<2)+t|0)+16>>2]-n|0)>>16,4634)+n+(v(65535&o,4634)>>>16)|0,u[e+4148>>2]=n,(0|a)==(0|(s=s+1|0)))break}}if(!u[e+4160>>2])break o}D=c=_-((i<<2)+79&-16)|0,o=(s=u[e+4248>>2])<<16>>16,o=(s=((v(o,65535&(n=d[e+4228>>1]))>>16)+v(n>>16,o)|0)+v((s>>15)+1>>1,n)|0)>>16,n=u[e+4148>>2];Z:{if(!((0|n)<8388609?(0|s)<=2097151:0)){if(n>>=16,n=v(n,n)-(v(o,o)<<5)|0,t=0,(0|n)<1)break Z;o=24-(s=S(n))|0;$:if(o){if(n>>>0<=127){n=n<<0-o|n>>>56-s;break $}n=n<<s+8|n>>>o}t=-65536&v(v(127&n,0xd50000)>>>16|65536,(1&s?32768:46214)>>>(s>>>1)|0);break Z}if(a=n<<16>>16,t=s<<16>>16,n=((v(a,n>>16)-(((v(t,65535&s)>>16)+v(t,o)|0)+v((s>>15)+1>>>1|0,s)<<5)|0)+(v(65535&n,a)>>16)|0)+v((n>>15)+1>>1,n)|0,t=0,(0|n)<1)break Z;o=24-(s=S(n))|0;f:if(o){if(n>>>0<=127){n=n<<0-o|n>>>56-s;break f}n=n<<s+8|n>>>o}t=v(127&n,0xd50000)>>>16|0,t=(n=(1&s?32768:46214)>>>(s>>>1)|0)+(v(n,t)>>>16|0)<<8}for(a=c- -64|0,s=255;;){if(s=(n=s)>>1,!((0|i)<(0|n)))break}if(o=u[e+4152>>2],(0|i)>=1)for(s=0;;){if(o=v(o,0xbb38435)+0x3619636b|0,u[(s<<2)+a>>2]=u[(((o>>24&n)<<2)+e|0)+2772>>2],(0|(s=s+1|0))==(0|i))break}u[e+4152>>2]=o,K(l,e+4052|0,u[e+2340>>2],u[e+4168>>2]),a=u[(n=e+4140|0)>>2],o=u[n+4>>2],u[c+56>>2]=a,u[c+60>>2]=o,o=u[(n=e+4132|0)>>2],a=u[n+4>>2],u[c+48>>2]=o,u[c+52>>2]=a,a=u[(n=e+4124|0)>>2],o=u[n+4>>2],u[c+40>>2]=a,u[c+44>>2]=o,o=u[(n=e+4116|0)>>2],a=u[n+4>>2],u[c+32>>2]=o,u[c+36>>2]=a,a=u[(n=e+4108|0)>>2],o=u[n+4>>2],u[c+24>>2]=a,u[c+28>>2]=o,o=u[(n=e+4100|0)>>2],a=u[n+4>>2],u[c+16>>2]=o,u[c+20>>2]=a,a=u[(n=e+4092|0)>>2],o=u[n+4>>2],u[c+8>>2]=a,u[c+12>>2]=o,o=u[(n=f=e+4084|0)>>2],a=u[n+4>>2],u[c>>2]=o,u[c+4>>2]=a;eo:{switch((m=u[e+2340>>2])-10|0){case 0:case 6:break eo;default:break}e0(2041,2108,149),I()}if((0|i)>=1)for(B=m>>>1|0,A=t<<10>>16,V=(t>>21)+1>>1,e=u[c+28>>2],o=u[c+36>>2],a=u[c+44>>2],t=u[c+52>>2],n=u[c+60>>2],E=d[l+30>>1],g=d[l+28>>1],b=d[l+26>>1],T=d[l+24>>1],y=d[l+22>>1],R=d[l+20>>1],C=d[l+18>>1],k=d[l+16>>1],w=d[l+14>>1],O=d[l+12>>1],N=d[l+10>>1],P=d[l+8>>1],L=d[l+6>>1],M=d[l+4>>1],x=d[l+2>>1],U=d[l>>1],s=0;;){h=(v(n>>16,U)+B|0)+(v(65535&n,U)>>16)|0,h=(((h+v((_=u[(n=(s<<2)+c|0)+56>>2])>>16,x)|0)+(v(65535&_,x)>>16)|0)+v(t>>16,M)|0)+(v(65535&t,M)>>16)|0,h=(((h+v((t=u[n+48>>2])>>16,L)|0)+(v(65535&t,L)>>16)|0)+v(a>>16,P)|0)+(v(65535&a,P)>>16)|0,h=(((h+v((a=u[n+40>>2])>>16,N)|0)+(v(65535&a,N)>>16)|0)+v(o>>16,O)|0)+(v(65535&o,O)>>16)|0,h=(((h+v((o=u[n+32>>2])>>16,w)|0)+(v(65535&o,w)>>16)|0)+v(e>>16,k)|0)+(v(65535&e,k)>>16)|0,e=(h+v((e=u[n+24>>2])>>16,C)|0)+(v(65535&e,C)>>16)|0,h=s+16|0,(0|m)==16&&(p=(v((p=u[n+20>>2])>>16,R)+e|0)+(v(65535&p,R)>>16)|0,p=(p+v((e=u[n+16>>2])>>16,y)|0)+(v(65535&e,y)>>16)|0,p=(p+v((e=u[n+12>>2])>>16,T)|0)+(v(65535&e,T)>>16)|0,p=(p+v((e=u[n+8>>2])>>16,b)|0)+(v(65535&e,b)>>16)|0,e=u[n+4>>2],n=u[n>>2],e=(((p+v(e>>16,g)|0)+(v(65535&e,g)>>16)|0)+v(n>>16,E)|0)+(v(65535&n,E)>>16)|0),n=((0|(n=(0|e)>-0x8000000?e:-0x8000000))<0x7ffffff?n:0x7ffffff)<<4,p=n+(h=u[(e=(h<<2)+c|0)>>2])|0;eN:{if((0|p)>=0){n=(n&h)>-1?p:-0x80000000;break eN}n=(n|h)>-1?0x7fffffff:p}if(u[e>>2]=n,h=(s<<1)+r|0,e=(v(n>>16,A)+v(n,V)|0)+(v(65535&n,A)>>16)|0,e=(0|(e=d[h>>1]+((0|e)>8388479?32767:(0|e)<-8388736?-32768:(e>>7)+1>>1)|0))>-32768?e:-32768,d[h>>1]=(0|e)<32767?e:32767,e=o,o=a,a=t,t=_,(0|(s=s+1|0))==(0|i))break}o=u[(n=(i<<2)+c|0)+4>>2],e=a=u[n>>2],u[(a=f)>>2]=e,u[a+4>>2]=o,a=u[n+60>>2],e=o=u[n+56>>2],u[(o=f)+56>>2]=e,u[o+60>>2]=a,o=u[n+52>>2],e=a=u[n+48>>2],u[(a=f)+48>>2]=e,u[a+52>>2]=o,a=u[n+44>>2],e=o=u[n+40>>2],u[(o=f)+40>>2]=e,u[o+44>>2]=a,o=u[n+36>>2],e=a=u[n+32>>2],u[(a=f)+32>>2]=e,u[a+36>>2]=o,a=u[n+28>>2],e=o=u[n+24>>2],u[(o=f)+24>>2]=e,u[o+28>>2]=a,o=u[n+20>>2],e=a=u[n+16>>2],u[(a=f)+16>>2]=e,u[a+20>>2]=o,a=u[n+12>>2],e=o=u[n+8>>2],u[(o=f)+8>>2]=e,u[o+12>>2]=a;break n}eE(e+4084|0,0,u[e+2340>>2]<<2)}D=l+32|0}(e,p,r,f),!function(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0;D=o=D-16|0;t:{if(u[e+4160>>2]){ek(e+4232|0,e+4236|0,t,r),u[e+4220>>2]=1;break t}i:if(u[e+4220>>2]){ek(o+8|0,o+12|0,t,r),i=u[o+12>>2],a=u[e+4236>>2];n:{if((0|i)>(0|a)){u[(n=e+4232|0)>>2]=u[n>>2]>>i-a;break n}if((0|i)>=(0|a))break n;u[o+8>>2]=u[o+8>>2]>>a-i}if(i=u[e+4232>>2],(0|i)>=(0|(n=u[o+8>>2])))break i;if(s=S(i),c=i<<s-1,u[e+4232>>2]=c,a=0,n>>=(0|(i=25-s|0))>0?i:0,u[o+8>>2]=n,i=0,(0|(n=(0|c)/(((0|n)>1?n:1)|0)|0))>=1){s=24-(i=S(n))|0;s:if(s){if(n>>>0<=127){n=n<<0-s|n>>>56-i;break s}n=n<<i+8|n>>>s}i=(i=(1&i?32768:46214)>>>(i>>>1)|0)+(v(v(127&n,0xd50000)>>>16|0,i)>>>16|0)<<4}if(n=(65536-i|0)/(0|r)|0,(0|r)<1)break i;for(s=n<<2;;){if(c=n=(a<<1)+t|0,n=d[n>>1],d[c>>1]=(v(n,65532&i)>>>16|0)+v(i>>>16|0,n),(0|(i=i+s|0))>65536)break i;if(!((0|(a=a+1|0))<(0|r)))break}}u[e+4220>>2]=0}D=o+16|0}(e,r,f),u[e+2308>>2]=u[((u[e+2324>>2]<<2)+p|0)-4>>2],u[i>>2]=f,D=p+144|0,0}e0(9077,9126,58),I()}e0(9146,9126,94),I()}e0(9221,9126,107),I()}function eh(e){var t,r=0,i=0,n=0,o=0,s=0,d=0,u=0;t=+e,c[0]=t,r=0|a[1],o=0|a[0],s=r>>>31|0;t:{r:{i:{n:{n=e;o:{a:{r=0x7fffffff&(d=r);s:{if(r>>>0>=0x4086232b){if(d=o=function(e){var t,r=0,i=0;return t=+e,c[0]=t,r=0|a[1],i=0|a[0],L=r,i}(e),o=0x7fffffff&(r=L),(0|o)==0x7ff00000&(0|(r=d))!=0|o>>>0>0x7ff00000)return e;if(!(e>709.782712893384^1))return 898846567431158e293*e;if(!(e<-745.1332191019411)|e<-708.3964185322641^1)break s;break r}if(r>>>0<0x3fd62e43)break n;if(r>>>0<0x3ff0a2b2)break a}if(0x80000000>g(i=1.4426950408889634*e+m[(s<<3)+25072>>3])){r=~~i;break o}r=-0x80000000;break o}r=(1^s)-s|0}e=n+-.6931471803691238*(i=+(0|r)),n=e-(u=19082149292705877e-26*i);break i}if(r>>>0<=0x3e300000)break t;r=0,n=e}if(i=n*n,i=n-i*(i*(i*(i*(41381367970572385e-24*i+-16533902205465252e-22)+6613756321437934e-20)+-.0027777777777015593)+.16666666666666602),i=e+(n*i/(2-i)-u)+1,!r)break r;i=eF(i,r)}return i}return e+1}function ep(e,t,r){var i=0;t:if((0|e)!=(0|t)){if((t-e|0)-r>>>0<=0-(r<<1)>>>0)return ed(e,t,r);i=(e^t)&3;i:{n:{if(e>>>0<t>>>0){if(i){i=e;break i}if(!(3&e)){i=e;break n}for(i=e;;){if(!r)break t;if(s[0|i]=l[0|t],t=t+1|0,r=r-1|0,!(3&(i=i+1|0)))break}break n}d:if(!i){if(e+r&3)for(;;){if(!r)break t;if(s[0|(i=(r=r-1|0)+e|0)]=l[t+r|0],!(3&i))break}if(r>>>0<=3)break d;for(;;){if(u[(r=r-4|0)+e>>2]=u[t+r>>2],!(r>>>0>3))break}}if(!r)break t;for(;;){if(s[(r=r-1|0)+e|0]=l[t+r|0],!r)break}break t}if(r>>>0<=3)break i;for(;;){if(u[i>>2]=u[t>>2],t=t+4|0,i=i+4|0,!((r=r-4|0)>>>0>3))break}}if(!r)break t;for(;;){if(s[0|i]=l[0|t],i=i+1|0,t=t+1|0,!(r=r-1|0))break}}return e}function ef(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,E=0,g=0,S=0;if((0|i)>=1){for(l=u[e+20>>2],s=u[e+16>>2],n=u[e+12>>2],a=u[e+8>>2],c=u[e+4>>2],o=u[e>>2];;){if(o=(A=(h=(v(65535&(h=(_=d[(f<<1)+r>>1]<<10)-o|0),1746)>>>16|0)+v(h>>16,1746)|0)+o|0)-c|0,c=(o=(m=(v(65535&o,14986)>>>16|0)+v(o>>16,14986)|0)+c|0)-a|0,p=f<<2,a=((o=(v(c>>16,-26453)+(v(65535&c,-26453)>>16)|0)+o|0)>>9)+1>>1,d[p+t>>1]=(0|o)>0x1fffdff?32767:(0|a)>-32768?a:-32768,S=(2|p)+t|0,n=(E=(p=(v(65535&(a=_-n|0),6854)>>>16|0)+v(a>>16,6854)|0)+n|0)-s|0,s=(n=(g=(v(65535&n,25769)>>>16|0)+v(n>>16,25769)|0)+s|0)-l|0,l=((n=(v(s>>16,-9994)+(v(65535&s,-9994)>>16)|0)+n|0)>>9)+1>>1,d[S>>1]=(0|n)>0x1fffdff?32767:(0|l)>-32768?l:-32768,l=n+s|0,a=o+c|0,s=E+g|0,c=A+m|0,n=_+p|0,o=_+h|0,(0|(f=f+1|0))==(0|i))break}u[e+20>>2]=l,u[e+16>>2]=s,u[e+12>>2]=n,u[e+8>>2]=a,u[e+4>>2]=c,u[e>>2]=o}}function e_(e,t,r,i){var n=0,o=0,a=0;n=((o=u[e+28>>2])>>>0)/(i>>>0)|0,a=e;t:{if(t){u[e+32>>2]=u[e+32>>2]+(v(t-i|0,n)+o|0),i=v(r-t|0,n);break t}i=v(r-i|0,n)+o|0}if(u[a+28>>2]=i,i>>>0<=8388608)for(t=u[e+32>>2];;){o=t>>>23|0;o:{if((0|o)!=255){if(i=t>>>31|0,(0|(n=u[e+40>>2]))>=0&&(t=-1,r=u[e+24>>2],_[e+4>>2]>r+u[e+8>>2]>>>0&&(u[e+24>>2]=r+1,s[u[e>>2]+r|0]=i+n,t=0),u[e+44>>2]=u[e+44>>2]|t),t=u[e+36>>2])for(r=i-1|0;;){if(i=-1,n=u[e+24>>2],_[e+4>>2]>n+u[e+8>>2]>>>0&&(u[e+24>>2]=n+1,s[u[e>>2]+n|0]=r,i=0,t=u[e+36>>2]),t=t-1|0,u[e+36>>2]=t,u[e+44>>2]=u[e+44>>2]|i,!t)break}u[e+40>>2]=255&o,i=u[e+28>>2],t=u[e+32>>2];break o}u[e+36>>2]=u[e+36>>2]+1}if(i<<=8,u[e+28>>2]=i,t=t<<8&0x7fffff00,u[e+32>>2]=t,u[e+20>>2]=u[e+20>>2]+8,!(i>>>0<8388609))break}}function eA(e,t,r,i,n,o,a,s,c){var d=0,l=0,h=0,p=0,f=0,_=0,m=0;f=(0|c)>1?c:1,_=(0|t)>=(0|r);t:if(!(_|(0|a)<(0|c))){for(l=t;;){if(!(u[(m=(d=l<<2)+n|0)>>2]>7|u[o+d>>2])){for(d=0;;){if(h=eB(s,1),A[(p=(v(u[e+8>>2],d)+l<<2)+i|0)>>2]=A[p>>2]+E(E(E(E(0|h)+E(-.5))*E(1<<13-u[m>>2]))*E(6103515625e-14)),(0|f)==(0|(d=d+1|0)))break}a=a-f|0}if((0|(l=l+1|0))>=(0|r))break t;if(!((0|a)>=(0|c)))break}}o:if(!((0|a)<(0|c)|_)){for(;;){l=(h=t<<2)+n|0;s:if(!(u[l>>2]>7)){if(d=0,1!=u[o+h>>2])break s;for(;;){if(h=eB(s,1),A[(p=(v(u[e+8>>2],d)+t<<2)+i|0)>>2]=A[p>>2]+E(E(E(E(0|h)+E(-.5))*E(1<<13-u[l>>2]))*E(6103515625e-14)),(0|f)==(0|(d=d+1|0)))break}a=a-f|0}if((0|r)<=(0|(t=t+1|0)))break o;if(!((0|a)>=(0|c)))break}}}function em(e,t,r){var i=0,n=0,o=0;r=(i=u[e+28>>2])>>>r|0,i=i-r|0;t:{if(!t){r=i;break t}u[e+32>>2]=u[e+32>>2]+i}if(u[e+28>>2]=r,r>>>0<=8388608)for(t=u[e+32>>2];;){o=t>>>23|0;o:{if((0|o)!=255){if(r=t>>>31|0,(0|(i=u[e+40>>2]))>=0&&(t=-1,n=u[e+24>>2],_[e+4>>2]>n+u[e+8>>2]>>>0&&(u[e+24>>2]=n+1,s[u[e>>2]+n|0]=r+i,t=0),u[e+44>>2]=u[e+44>>2]|t),t=u[e+36>>2])for(n=r-1|0;;){if(r=-1,i=u[e+24>>2],_[e+4>>2]>i+u[e+8>>2]>>>0&&(u[e+24>>2]=i+1,s[u[e>>2]+i|0]=n,r=0,t=u[e+36>>2]),t=t-1|0,u[e+36>>2]=t,u[e+44>>2]=u[e+44>>2]|r,!t)break}u[e+40>>2]=255&o,r=u[e+28>>2],t=u[e+32>>2];break o}u[e+36>>2]=u[e+36>>2]+1}if(r<<=8,u[e+28>>2]=r,t=t<<8&0x7fffff00,u[e+32>>2]=t,u[e+20>>2]=u[e+20>>2]+8,!(r>>>0<8388609))break}}function ev(e,t,r,i){t:if(!(t>>>0>20)){switch(t-9|0){case 0:t=u[r>>2],u[r>>2]=t+4,u[e>>2]=u[t>>2];return;case 1:t=u[r>>2],u[r>>2]=t+4,r=(t=u[t>>2])>>31,u[e>>2]=t,u[e+4>>2]=r;return;case 2:t=u[r>>2],u[r>>2]=t+4,r=u[t>>2],u[e>>2]=r,u[e+4>>2]=0;return;case 3:t=u[r>>2]+7&-8,u[r>>2]=t+8,r=u[t+4>>2],t=u[t>>2],u[e>>2]=t,u[e+4>>2]=r;return;case 4:t=u[r>>2],u[r>>2]=t+4,t=(r=d[t>>1])>>31,u[e>>2]=r,u[e+4>>2]=t;return;case 5:t=u[r>>2],u[r>>2]=t+4,t=h[t>>1],u[e>>2]=t,u[e+4>>2]=0;return;case 6:t=u[r>>2],u[r>>2]=t+4,t=(r=s[0|t])>>31,u[e>>2]=r,u[e+4>>2]=t;return;case 7:t=u[r>>2],u[r>>2]=t+4,t=l[0|t],u[e>>2]=t,u[e+4>>2]=0;return;case 8:t=u[r>>2]+7&-8,u[r>>2]=t+8,m[e>>3]=m[t>>3];return;case 9:break;default:break t}tn[0|i](e,r)}}function eE(e,t,r){var i=0,n=0,o=0,a=0,c=0;t:if(r){if(s[(i=e+r|0)-1|0]=t,s[0|e]=t,r>>>0<3)break t;if(s[i-2|0]=t,s[e+1|0]=t,s[i-3|0]=t,s[e+2|0]=t,r>>>0<7)break t;if(s[i-4|0]=t,s[e+3|0]=t,r>>>0<9)break t;if(i=(n=0-e&3)+e|0,t=v(255&t,0x1010101),u[i>>2]=t,u[(r=(n=r-n&-4)+i|0)-4>>2]=t,n>>>0<9)break t;if(u[i+8>>2]=t,u[i+4>>2]=t,u[r-8>>2]=t,u[r-12>>2]=t,n>>>0<25)break t;if(u[i+24>>2]=t,u[i+20>>2]=t,u[i+16>>2]=t,u[i+12>>2]=t,u[r-16>>2]=t,u[r-20>>2]=t,u[r-24>>2]=t,u[r-28>>2]=t,(r=n-(a=4&i|24)|0)>>>0<32)break t;for(o=e6(t,0,1,1),c=n=L,t=i+a|0;;){if(u[t+24>>2]=o,n=c,u[t+28>>2]=n,u[t+16>>2]=o,u[t+20>>2]=n,u[t+8>>2]=o,u[t+12>>2]=n,u[t>>2]=o,u[t+4>>2]=n,t=t+32|0,!((r=r-32|0)>>>0>31))break}}return e}function eg(e,t,r,i,n,o){var a=0,s=0,c=0,u=0,l=0,h=0,p=0;t:{r:{if((0|n)>5){if(1&n)break r;if((0|i)<(0|n))break t;if((0|i)>(0|n))for(p=(0|n)<7,o=n;;){if(c=(s=(h=o<<1)+t|0)-2|0,u=((((v(d[r+2>>1],d[s-4>>1])+v(d[r>>1],d[c>>1])|0)+v(d[r+4>>1],d[s-6>>1])|0)+v(d[r+6>>1],d[s-8>>1])|0)+v(d[r+8>>1],d[s-10>>1])|0)+v(d[r+10>>1],d[s-12>>1])|0,a=6,!p)for(;;){if(u=(v(d[(l=a<<1)+r>>1],d[c-l>>1])+u|0)+v(d[(2|l)+r>>1],d[((-1^a)<<1)+c>>1])|0,!((0|(a=a+2|0))<(0|n)))break}if(a=(0|(a=((d[s>>1]<<12)-u>>11)+1>>1))>-32768?a:-32768,d[e+h>>1]=(0|a)<32767?a:32767,(0|(o=o+1|0))==(0|i))break}eE(e,0,n<<1);return}e0(2119,2144,67),I()}e0(2171,2144,68),I()}e0(2202,2144,69),I()}function eS(e,t,r){var i=E(0),n=0,o=E(0),a=0,s=0,c=0,d=E(0),u=E(0),l=0,h=0,p=0;o=A[t>>2],e=eE(e,0,r<<2);t:if(A[t>>2]!=E(0)){for(l=(0|r)>0?r:0,s=1;;){if((0|n)==(0|l))break t;if(r=0,i=E(0),n)for(;;){if(i=E(i+E(A[(r<<2)+e>>2]*A[(n-r<<2)+t>>2])),(0|n)==(0|(r=r+1|0)))break}if(i=E(E(-E(i+A[((c=n+1|0)<<2)+t>>2]))/o),A[(n<<2)+e>>2]=i,n)for(h=s>>>1|0,r=0;;){if(p=a=(r<<2)+e|0,d=A[a>>2],u=A[(a=((-1^r)+n<<2)+e|0)>>2],A[p>>2]=d+E(i*u),A[a>>2]=u+E(i*d),(0|h)==(0|(r=r+1|0)))break}if(s=s+1|0,n=c,!((o=E(o-E(o*E(i*i))))<E(A[t>>2]*E(.0010000000474974513))^1))break}}}function eb(e,t,r,i){var n=0,o=0,a=0;t:{if((0|(n=u[e+284>>2]))<=(0|i)){if((0|(a=u[e+292>>2]))>(0|n))break t;o=e+168|0,n=n-a<<1,ed(o+(a<<1)|0,r,n);i:{switch(u[e+264>>2]-1|0){case 0:(function(e,t,r,i){ef(e,t,r,i)})(e,t,o,u[e+284>>2]),function(e,t,r,i){ef(e,t,r,i)}(e,(u[e+288>>2]<<1)+t|0,r+n|0,i-u[e+284>>2]|0);break i;case 1:eu(e,t,o,u[e+284>>2]),eu(e,(u[e+288>>2]<<1)+t|0,r+n|0,i-u[e+284>>2]|0);break i;case 2:j(e,t,o,u[e+284>>2]),j(e,(u[e+288>>2]<<1)+t|0,r+n|0,i-u[e+284>>2]|0);break i;default:break}ed(ed(t,o,u[e+284>>2]<<1)+(u[e+288>>2]<<1)|0,r+n|0,i-u[e+284>>2]<<1)}return ed(o,(i-(e=u[e+292>>2])<<1)+r|0,e<<1),0}e0(2825,2778,184),I()}e0(2865,2778,186),I()}function eT(e,t,r,i,n,o,a){var s=0,c=0,d=E(0),u=0,l=0;l=s=D,D=s=s-((o<<2)+15&-16)|0;t:{if((0|o)>0){if((0|i)<=-1)break t;if(i){for(u=ed(s,e,o<<2),s=0;;){if(d=A[(c=s<<2)+r>>2],A[c+u>>2]=A[e+c>>2]*d,A[u+(c=(-1^s)+o<<2)>>2]=d*A[e+c>>2],(0|(s=s+1|0))==(0|i))break}e=u}if(Q(e,e,t,r=o-n|0,n+1|0,a),c=0,(0|n)>=0)for(;;){if(d=E(0),(0|(s=c+r|0))<(0|o))for(;;){if(d=E(d+E(A[(s<<2)+e>>2]*A[(s-c<<2)+e>>2])),(0|(s=s+1|0))==(0|o))break}if(A[(s=(c<<2)+t|0)>>2]=d+A[s>>2],s=(0|n)!=(0|c),c=c+1|0,!s)break}return D=l,0}e0(33874,33829,228),I()}e0(33896,33829,229),I()}function ey(e,t,r,i,n,o,a,s,c){var l=0,h=0,p=0,f=0,_=0,m=0,g=E(0);if(m=v(u[e+44>>2],a),l=v(d[(f=u[e+32>>2])+(o<<1)>>1],a),(0|s)!=1&&(l=(0|(e=(0|m)/(0|s)|0))>(0|l)?l:e),_=c?0:o,n=(s=v(p=d[((h=c?0:n)<<1)+f>>1],a))<<2,o=r,(0|s)>=1)for(e=0,o=eE(r,0,n);;){if(o=o+4|0,(0|s)==(0|(e=e+1|0)))break}if((0|_)>(0|h))for(e=t+n|0,t=h;;){for(g=E(eh(.6931471805599453*+E(b(E(A[(s=t<<2)+i>>2]+A[s+24384>>2]),E(32))))),s=v(a,p),n=v(p=d[((t=t+1|0)<<1)+f>>1],a);;){if(A[o>>2]=A[e>>2]*g,o=o+4|0,e=e+4|0,!((0|(s=s+1|0))<(0|n)))break}if((0|t)==(0|_))break}(0|_)<(0|h)&&(e0(33464,33495,263),I()),eE(((o=c?0:l)<<2)+r|0,0,m-o<<2)}function eR(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0,d=0;u[e+24>>2]=0,u[e+28>>2]=128,u[e+16>>2]=0,u[e+20>>2]=9,u[e+8>>2]=0,u[e+12>>2]=0,u[e+4>>2]=r,u[e>>2]=t,r&&(u[e+24>>2]=1,i=l[0|t],n=1),u[e+44>>2]=0,u[e+40>>2]=i,u[e+28>>2]=32768,u[e+20>>2]=17,o=i>>>1^127,u[e+32>>2]=o;r:{if(r>>>0<=n>>>0){a=n;break r}a=n+1|0,u[e+24>>2]=a,s=l[t+n|0]}u[e+40>>2]=s,u[e+28>>2]=8388608,u[e+20>>2]=25,c=((i<<8|s)>>>1&255|o<<8)^255,u[e+32>>2]=c,n=0,d=e;n:{if(r>>>0<=a>>>0){o=a,i=0;break n}o=a+1|0,u[e+24>>2]=o,i=l[t+a|0]}u[d+40>>2]=i,u[e+28>>2]=-0x80000000,u[e+20>>2]=33,s=((s<<8|i)>>>1&255|c<<8)^255,u[e+32>>2]=s,r>>>0>o>>>0&&(u[e+24>>2]=o+1,n=l[t+o|0]),u[e+40>>2]=n,u[e+32>>2]=((i<<8|n)>>>1&255|s<<8)^255}function eI(e,t,r){var i=0,n=0,o=0,a=0,c=0;t:{if(r>>>0>1){if((i=r-1|0)>>>0>=256){if(e_(e,r=t>>>(n=24-S(i)|0)|0,r+1|0,(i>>>n|0)+1|0),!n)break t;c=(-1<<n^-1)&t,t=u[e+12>>2],i=n+(r=u[e+16>>2])|0;n:{if(i>>>0<33){o=r;break n}for(;;){if(i=-1,a=u[e+4>>2],a>>>0>(o=u[e+8>>2])+u[e+24>>2]>>>0&&(i=o+1|0,u[e+8>>2]=i,s[u[e>>2]+(a-i|0)|0]=t,i=0),u[e+44>>2]=u[e+44>>2]|i,t=t>>>8|0,i=(0|r)>15,r=o=r-8|0,!i)break}i=n+o|0}u[e+16>>2]=i,u[e+12>>2]=c<<o|t,u[e+20>>2]=u[e+20>>2]+n;return}e_(e,t,t+1|0,r);return}e0(8490,8514,180),I()}e0(8528,8514,198),I()}function eC(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,l=0;if(d=o=D,D=o=o-(((c=v(t,r))<<2)+15&-16)|0,(0|r)>0){r:{if(!i){for(a=(0|t)<1;;){if(!a)for(s=v(t,n),i=0;;){if(u[(i+s<<2)+o>>2]=u[(v(r,i)+n<<2)+e>>2],(0|(i=i+1|0))==(0|t))break}if((0|(n=n+1|0))==(0|r))break}break r}for(l=(r<<2)+33592|0,a=(0|t)<1;;){if(!a)for(s=v(u[(n<<2)+l>>2],t),i=0;;){if(u[(i+s<<2)+o>>2]=u[(v(r,i)+n<<2)+e>>2],(0|(i=i+1|0))==(0|t))break}if((0|(n=n+1|0))==(0|r))break}}ed(e,o,c<<2),D=d;return}e0(33568,33495,591),I()}function ek(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0;l=i-1|0,s=31-(h=S(i))|0;t:{if((0|i)<2){o=i;break t}for(o=i;;){if(c=d[(2|(a=n<<1))+r>>1],a=d[r+a>>1],o=(v(c,c)+v(a,a)>>>s|0)+o|0,!((0|l)>(0|(n=n+2|0))))break}n=-2&i}if(a=0,(0|i)>(0|n)&&(o=(v(n=d[(n<<1)+r>>1],n)>>>s|0)+o|0),s=(0|(n=34-(S(o)+h|0)|0))>0?n:0,(0|i)<2)n=0;else{for(n=0;;){if(c=d[(2|(o=n<<1))+r>>1],o=d[r+o>>1],a=(v(c,c)+v(o,o)>>>s|0)+a|0,!((0|l)>(0|(n=n+2|0))))break}n=-2&i}(0|n)<(0|i)&&(a=(v(r=d[(n<<1)+r>>1],r)>>>s|0)+a|0),u[t>>2]=s,u[e>>2]=a}function ew(e,t,r,i){var n=0,o=0,s=0,d=0,l=E(0),h=0,p=E(0),f=0,_=0,A=0,v=0,S=0;if((s=g(n=+t))<1e-6)return e;if(!(.5*(d=+(0|r))<s)){t=E(e*t),r=u[i>>2],l=E(E(g(E((n+n)/d)))*E(u[i+4>>2])),p=E(y(l));i:{if(E(g(p))<E(0x80000000)){i=~~p;break i}i=-0x80000000}s=m[(r=r+(i<<3)|0)+8>>3],d=m[r>>3],A=m[r+16>>3],h=m[r+24>>3],v=function(e){var t,r=0,i=0;D=r=D-16|0,t=+e,c[0]=t,i=0|a[1],a[0],i&=0x7fffffff;t:{if(i>>>0<=0x3fe921fb){if(i>>>0<0x3e500000)break t;e=eK(e,0,0);break t}if(i>>>0>=0x7ff00000){e-=e;break t}switch(3&q(e,r)){case 0:e=eK(m[r>>3],m[r+8>>3],1);break t;case 1:e=eX(m[r>>3],m[r+8>>3]);break t;case 2:e=-eK(m[r>>3],m[r+8>>3],1);break t;default:break}e=-eX(m[r>>3],m[r+8>>3])}return D=r+16|0,e}(n=3.141592653589793*+t)*+e/n,t=E(l-E(0|i)),e=E(t*t),f=.1666666667*(o=+E(t*e)),S=h*(_=f-.1666666667*(n=+t)),o=(h=.5*+e)+n-.5*o,l=E(v*(S+(A*o+(d*(n=h+-.3333333333*n-f)+s*(1-_-o-n)))))}return l}function eO(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0,d=0,h=0;for(o=(i=u[e+28>>2])>>>r|0,n=u[e+32>>2],r=-1;;){if(a=i,!(n>>>0<(i=v(l[(r=r+1|0)+t|0],o))>>>0))break}if(t=a-i|0,u[e+28>>2]=t,o=n-i|0,u[e+32>>2]=o,t>>>0<=8388608)for(n=u[e+24>>2],a=u[e+40>>2],c=u[e+20>>2],h=u[e+4>>2];;){if(d=t<<8,u[e+28>>2]=d,c=c+8|0,u[e+20>>2]=c,i=0,n>>>0<h>>>0&&(s=n+1|0,u[e+24>>2]=s,i=l[u[e>>2]+n|0],n=s),u[e+40>>2]=i,o=(o<<8&0x7fffff00|(a<<8|i)>>>1&255)^255,u[e+32>>2]=o,s=t>>>0<32769,a=i,t=d,!s)break}return r}function eN(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,h=0;if(t=(r=u[e+28>>2])>>>t|0,!(a=t>>>0>(i=u[e+32>>2])>>>0)&&(i=i-t|0,u[e+32>>2]=i),r=a?t:r-t|0,u[e+28>>2]=r,r>>>0<=8388608)for(n=u[e+24>>2],c=u[e+40>>2],s=u[e+20>>2],h=u[e+4>>2];;){if(d=r<<8,u[e+28>>2]=d,s=s+8|0,u[e+20>>2]=s,t=0,n>>>0<h>>>0&&(o=n+1|0,u[e+24>>2]=o,t=l[u[e>>2]+n|0],n=o),u[e+40>>2]=t,i=(i<<8&0x7fffff00|(c<<8|t)>>>1&255)^255,u[e+32>>2]=i,o=r>>>0<32769,c=t,r=d,!o)break}return a}function eP(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0;if(i=v(n=u[e+36>>2],i-r|0),o=u[e+32>>2]-i|0,u[e+32>>2]=o,r=t?v(r-t|0,n):u[e+28>>2]-i|0,u[e+28>>2]=r,r>>>0<=8388608)for(i=u[e+24>>2],n=u[e+40>>2],s=u[e+20>>2],d=u[e+4>>2];;){if(c=r<<8,u[e+28>>2]=c,s=s+8|0,u[e+20>>2]=s,t=0,i>>>0<d>>>0&&(a=i+1|0,u[e+24>>2]=a,t=l[u[e>>2]+i|0],i=a),u[e+40>>2]=t,o=(o<<8&0x7fffff00|(n<<8|t)>>>1&255)^255,u[e+32>>2]=o,a=r>>>0<32769,n=t,r=c,!a)break}}function eD(e){var t,r=0,i=0,n=0;D=r=D-16|0,t=+e,c[0]=t,n=0|a[1],a[0],n&=0x7fffffff;t:{if(n>>>0<=0x3fe921fb){if(i=1,n>>>0<0x3e46a09e)break t;i=eX(e,0);break t}if(i=e-e,n>>>0>=0x7ff00000)break t;switch(3&q(e,r)){case 0:i=eX(m[r>>3],m[r+8>>3]);break t;case 1:i=-eK(m[r>>3],m[r+8>>3],1);break t;case 2:i=-eX(m[r>>3],m[r+8>>3]);break t;default:break}i=eK(m[r>>3],m[r+8>>3],1)}return D=r+16|0,i}function eL(e,t,r){var i=0,n=0,o=0,a=0,c=0;if(r){a=u[e+12>>2],i=(o=u[e+16>>2])+r|0;r:{if(i>>>0<33){n=o;break r}for(;;){if(i=-1,c=u[e+4>>2],c>>>0>(n=u[e+8>>2])+u[e+24>>2]>>>0&&(i=n+1|0,u[e+8>>2]=i,s[u[e>>2]+(c-i|0)|0]=a,i=0),u[e+44>>2]=u[e+44>>2]|i,a=a>>>8|0,i=(0|o)>15,o=n=o-8|0,!i)break}i=r+n|0}u[e+16>>2]=i,u[e+12>>2]=t<<n|a,u[e+20>>2]=u[e+20>>2]+r;return}e0(8528,8514,198),I()}function eM(e,t){var r=0,i=0,n=0,o=0,a=0;r=eO(e,6656,8),n=eO(e,6734,8),a=eO(e,6741,8),i=eO(e,6734,8),i=d[(r=i+v(v(o=(0|r)/5|0,-5)+r|0,3)<<1)+6626>>1],i=(v(65535&(i=i-(r=d[r+6624>>1])|0),6554)>>>16|0)+v(i>>16,6554)|0,e=v(eO(e,6741,8)<<17>>16|1,i)+r|0,u[t+4>>2]=e,n=d[(r=v(o,3)+n<<1)+6626>>1],n=n-(r=d[r+6624>>1])|0,u[t>>2]=(v(v(n>>16,6554)+(v(65535&n,6554)>>>16|0)|0,a<<17>>16|1)+r|0)-e}function ex(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0;if(n=r>>16,o=t-1|0,(0|t)>=2)for(s=r-65536|0,t=0;;){if(c=i=(t<<2)+e|0,a=(i=u[i>>2])<<16>>16,u[c>>2]=((v(a,65535&r)>>16)+v(n,a)|0)+v((i>>15)+1>>1,r),n=(r=((v(r,s)>>15)+1>>1)+r|0)>>16,(0|o)==(0|(t=t+1|0)))break}e=t=(o<<2)+e|0,i=(t=u[t>>2])<<16>>16,u[e>>2]=((v(i,65535&r)>>16)+v(i,n)|0)+v((t>>15)+1>>1,r)}function eU(e,t,r,i){var n=0,o=0,a=0;if((0|(n=d[r+2>>1]))>=1)for(o=u[r+24>>2]+((0|v(65535&n,i))/2|0)|0,i=0;;){if(n=l[0|o],d[(i<<1)+e>>1]=v(n>>>1&7,9),s[t+i|0]=l[u[r+20>>2]+(v(d[r+2>>1]-1|0,1&n)+i|0)|0],d[((a=1|i)<<1)+e>>1]=v(n>>>5|0,9),s[t+a|0]=l[u[r+20>>2]+(v(d[r+2>>1]-1|0,n>>>4&1)+a|0)|0],o=o+1|0,!((0|(i=i+2|0))<d[r+2>>1]))break}}function eB(e,t){var r=0,i=0,n=0,o=0,a=0,s=0;n=u[e+12>>2],r=u[e+16>>2];t:{if(r>>>0>=t>>>0){a=r;break t}for(i=u[e+8>>2],s=u[e+4>>2];;){if(o=0,i>>>0<s>>>0&&(i=i+1|0,u[e+8>>2]=i,o=l[u[e>>2]+(s-i|0)|0]),n=o<<r|n,o=(0|r)<17,r=a=r+8|0,!o)break}}return u[e+16>>2]=a-t,u[e+12>>2]=n>>>t,u[e+20>>2]=u[e+20>>2]+t,(-1<<t^-1)&n}function eV(e,t,r,i){var n=0,o=E(0),a=E(0);t:if(!((0|t)<1)){for(;;){if(o=E(o+E((a=A[(n<<2)+e>>2])*a)),(0|(n=n+1|0))==(0|t))break}if((0|t)<1)break t;for(o=E(E(E(1)/E(R(E(o+E(10000000036274937e-31)))))*r),n=0;;){if(A[e>>2]=o*A[e>>2],e=e+4|0,(0|(n=n+1|0))==(0|t))break}}}function eF(e,t){var r;t:{if((0|t)>=1024){if(e*=898846567431158e293,(0|t)<2047){t=t-1023|0;break t}e*=898846567431158e293,t=((0|t)<3069?t:3069)-2046|0;break t}if((0|t)>-1023)break t;if(e*=22250738585072014e-324,(0|t)>-2045){t=t+1022|0;break t}e*=22250738585072014e-324,t=((0|t)>-3066?t:-3066)+2044|0}return t=t+1023<<20,a[0]=0,r=0|t,a[1]=r,e*+c[0]}function ej(e,t,r){var i=0;t:{r:if(i=(0|e)!=48e3,!(((0|t)==960?!i:0)|((0x7fffffff&t)==480?!i:0))){if(e=(0|e)!=48e3,((0x3fffffff&t)==240?!e:0)|((0x1fffffff&t)==120?!e:0))break r;if(t=0,!r)break t;u[r>>2]=-1;break t}if(t=9424,!r)break t;return u[r>>2]=0,9424}return t}function eG(e,t,r){var i=0,n=0,o=0;if(i=t-1|0,(0|t)>=2)for(o=r-65536|0,t=0;;){if(d[(n=(t<<1)+e|0)>>1]=(v(d[n>>1],r)>>>15|0)+1>>>1,r=((v(r,o)>>15)+1>>1)+r|0,(0|i)==(0|(t=t+1|0)))break}d[(t=(i<<1)+e|0)>>1]=(v(d[t>>1],r)>>>15|0)+1>>>1}function eW(e,t){var r=0,i=0;return e?t>>>0>=0xffffffc0?(u[ti()>>2]=48,0):(r=function(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,l=0;i=3&(a=u[e+4>>2]),r=(o=-8&a)+e|0;r:{if(!i){if(i=0,t>>>0<256||t+4>>>0<=o>>>0&&(i=e,o-t>>>0<=u[9972]<<1>>>0))break r;return 0}o:{if(t>>>0<=o>>>0){if((i=o-t|0)>>>0<16)break o;u[e+4>>2]=1&a|t|2,u[(t=e+t|0)+4>>2]=3|i,u[r+4>>2]=1|u[r+4>>2],Y(t,i);break o}if(i=0,u[9858]==(0|r)){if((r=u[9855]+o|0)>>>0<=t>>>0)break r;u[e+4>>2]=1&a|t|2,i=e+t|0,t=r-t|0,u[i+4>>2]=1|t,u[9855]=t,u[9858]=i;break o}if(u[9857]==(0|r)){if((r=u[9854]+o|0)>>>0<t>>>0)break r;i=r-t|0;d:{if(i>>>0>=16){u[e+4>>2]=1&a|t|2,u[(t=e+t|0)+4>>2]=1|i,u[(r=e+r|0)>>2]=i,u[r+4>>2]=-2&u[r+4>>2];break d}u[e+4>>2]=1&a|r|2,u[(t=e+r|0)+4>>2]=1|u[t+4>>2],i=0,t=0}u[9857]=t,u[9854]=i;break o}if(2&(n=u[r+4>>2])||(s=(-8&n)+o|0)>>>0<t>>>0)break r;d=s-t|0;l:{if(n>>>0<=255){if(i=u[r+12>>2],r=u[r+8>>2],o=((n=n>>>3|0)<<3)+39448|0,(0|r)==(0|i)){u[9852]=u[9852]&e4(-2,n);break l}u[r+12>>2]=i,u[i+8>>2]=r;break l}c=u[r+24>>2],n=u[r+12>>2];Z:{if((0|n)!=(0|r)){i=u[r+8>>2],u[i+12>>2]=n,u[n+8>>2]=i;break Z}ee:if(!(o=u[(i=r+20|0)>>2])&&!(o=u[(i=r+16|0)>>2])){n=0;break Z}for(;;){if(l=i,o=u[(i=(n=o)+20|0)>>2])continue;if(i=n+16|0,!(o=u[n+16>>2]))break}u[l>>2]=0}if(!c)break l;i=((o=u[r+28>>2])<<2)+39712|0;et:{if(u[i>>2]==(0|r)){if(u[i>>2]=n,n)break et;u[9853]=u[9853]&e4(-2,o);break l}if(u[(u[c+16>>2]==(0|r)?16:20)+c>>2]=n,!n)break l}if(u[n+24>>2]=c,(i=u[r+16>>2])&&(u[n+16>>2]=i,u[i+24>>2]=n),!(r=u[r+20>>2]))break l;u[n+20>>2]=r,u[r+24>>2]=n}if(d>>>0<=15){u[e+4>>2]=1&a|s|2,u[(t=e+s|0)+4>>2]=1|u[t+4>>2];break o}u[e+4>>2]=1&a|t|2,u[(t=e+t|0)+4>>2]=3|d,u[(r=e+s|0)+4>>2]=1|u[r+4>>2],Y(t,d)}i=e}return i}(e-8|0,t>>>0<11?16:t+11&-8))?r+8|0:(r=M(t))?(i=(3&(i=u[e-4>>2])?-4:-8)+(-8&i)|0,ed(r,e,t>>>0>i>>>0?i:t),H(e),r):0:M(t)}function eH(e,t,r,i,n){var o=0;if(D=o=D-256|0,!(73728&n|(0|r)<=(0|i))){if(eE(o,255&t,(i=(r=r-i|0)>>>0<256)?r:256),!i)for(;;){if(e7(e,o,256),!((r=r-256|0)>>>0>255))break}e7(e,o,r)}D=o+256|0}function eY(e){var t=0,r=0;t=u[9756],e=t+(r=e+3&-4)|0;t:if(!((e>>>0<=t>>>0?(0|r)>=1:0)||function(){return o.byteLength/65536|0}()<<16>>>0<e>>>0&&!(0|C(0|e)))){return u[9756]=e,t}return u[ti()>>2]=48,-1}function eK(e,t,r){var i=0,n=0,o=0;return(o=(i=e*e)*i*i*(158969099521155e-24*i+-25050760253406863e-24)+(i*(27557313707070068e-22*i+-1984126982985795e-19)+.00833333333332249),n=i*e,r)?e-(i*(.5*t-n*o)-t+.16666666666666632*n):n*(i*o+-.16666666666666632)+e}function eQ(e,t){var r=0,i=0,n=0;r=0;r:if(e){if(i=e6(e,0,t,0),n=L,r=i,(e|t)>>>0<65536)break r;r=n?-1:i}return!(!(e=M(i=r))|!(3&l[e-4|0]))&&eE(e,0,i),e}function ez(e){var t=0,r=0,i=0,n=0,o=0;for(i=1<<(r=31-S(e)>>1);;){if(o=t=(n<<1)+i<<r,t=e>>>0<t>>>0,e=e-(t?0:o)|0,n=(t?0:i)+n|0,t=(0|r)>0,i=i>>>1|0,r=r-1|0,!t)break}return n}function eX(e,t){var r=0,i=0,n=0,o=0;return o=1-(n=1-(i=.5*(r=e*e)))-i,i=r*r,n+(o+(r*(r*(r*(2480158728947673e-20*r+-.001388888888887411)+.0416666666666666)+i*i*(r*(-11359647557788195e-27*r+2087572321298175e-24)+-27557314351390663e-23))-e*t))}function eJ(e){var t=0,r=0,i=0;if(tr(s[u[e>>2]]))for(;;){if(i=s[0|(t=u[e>>2])],u[e>>2]=t+1,r=(v(r,10)+i|0)-48|0,!tr(s[t+1|0]))break}return r}function eq(e){var t=0,r=0,i=0;return r=u[e+20>>2]<<3,t=S(e=u[e+28>>2]),i=e=e>>>16-t|0,(((r+(t<<3)|0)-(i>>>0>_[((e=(e>>>12|0)-8|0)<<2)+24240>>2])|0)-e|0)-256|0}function eZ(e,t){var r=0;return r=_[e+28>>2]/(t>>>0)|0,u[e+36>>2]=r,r=(-1^(e=_[e+32>>2]/(r>>>0)|0))+t|0,t=(e=e+1|0)-t|0,r+(e>>>0<t>>>0?0:t)|0}function e$(e){var t=0;return e1(e),t=e1(e+4264|0),u[e+8536>>2]=0,u[e+8528>>2]=0,u[e+8532>>2]=0,u[e+8548>>2]=0,t}function e0(e,t,r){var i=0;D=i=D-16|0,u[i+8>>2]=e,u[i+4>>2]=r,u[i>>2]=t,function(e,t,r){var i=0;D=i=D-16|0,u[i+12>>2]=r,r=function(e,t,r){return function(e,t,r,i,n){var o=0,a=0,c=0;D=o=D-208|0,u[o+204>>2]=r,r=0,eE(o+160|0,0,40),u[o+200>>2]=u[o+204>>2];t:{if((0|U(0,t,o+200|0,o+80|0,o+160|0,i,n))<0){t=-1;break t}u[e+76>>2]>=0&&(r=function(e){return 1}(e)),a=u[e>>2],s[e+74|0]<=0&&(u[e>>2]=-33&a),a&=32;o:{if(u[e+48>>2]){n=U(e,t,o+200|0,o+80|0,o+160|0,i,n);break o}if(u[e+48>>2]=80,u[e+16>>2]=o+80,u[e+28>>2]=o,u[e+20>>2]=o,c=u[e+44>>2],u[e+44>>2]=o,n=t=U(e,t,o+200|0,o+80|0,o+160|0,i,n),!c)break o;tn[u[e+36>>2]](e,0,0),u[e+48>>2]=0,u[e+44>>2]=c,u[e+28>>2]=0,u[e+16>>2]=0,i=u[e+20>>2],u[e+20>>2]=0,n=i?t:-1}if(i=u[e>>2],u[e>>2]=a|i,t=n,t=32&i?-1:t,!r)break t}return D=o+208|0,t}(e,t,r,0,0)}(e,t,r),D=i+16|0}(u[256],1536,i),I(),I()}function e2(e){var t=0;return((u[(t=ej(48e3,960,0))+8>>2]<<5)+v((u[t+4>>2]<<2)+8288|0,e)|0)+92|0}function e1(e){var t,r;return eE(e+4|0,0,4260),u[e+4168>>2]=0,u[e>>2]=65536,u[e+2376>>2]=1,!function(e){var t=0,r=0,i=0,n=0;if(n=32767/((t=u[e+2340>>2])+1|0)|0,(0|t)>=1)for(;;){if(i=n+i|0,d[((r<<1)+e|0)+4052>>1]=i,(0|t)==(0|(r=r+1|0)))break}u[(e=e+4148|0)>>2]=0,u[e+4>>2]=3176576}(e),r=0,u[(r=(t=e)+4244|0)>>2]=65536,u[r+4>>2]=65536,u[(r=t+4256|0)>>2]=2,u[r+4>>2]=20,u[t+4172>>2]=u[t+2328>>2]<<7,0}function e4(e,t){var r=0;return(-1>>>(r=31&t)&e)<<r|(-1<<(t=0-t&31)&e)>>>t}function e6(e,t,r,i){var n,o,a,s,c,d;return n=e,o=t,a=r,s=i,c=0,d=0,s=(v(c=a>>>16|0,d=n>>>16|0)+v(o,a)|0)+v(s,n)|0,a&=65535,n&=65535,L=(s=s+((a=((o=v(a,n))>>>16|0)+v(a,d)|0)>>>16|0)|0)+((a=v(n,c)+(65535&a)|0)>>>16|0)|0,i=65535&o|a<<16}function e3(e,t,r,i){ef(e,t,r,i)}function e8(e){return e?(u[ti()>>2]=e,-1):0}function e5(e){return e?31-S(e-1^e)|0:32}function e9(e,t){u[t>>2]=eO(e,6681,8)}function e7(e,t,r){!(32&l[0|e])&&!function(e,t,r){var i=0,n=0,o=0;i=u[r+16>>2];t:{if(!i){if(function(e){var t=0;return(t=l[e+74|0],s[e+74|0]=t|t-1,8&(t=u[e>>2]))?(u[e>>2]=32|t,-1):(u[e+4>>2]=0,u[e+8>>2]=0,t=u[e+44>>2],u[e+28>>2]=t,u[e+20>>2]=t,u[e+16>>2]=u[e+48>>2]+t,0)}(r))break t;i=u[r+16>>2]}if(i-(o=u[r+20>>2])>>>0<t>>>0)return 0|tn[u[r+36>>2]](r,e,t);o:{if(s[r+75|0]<0){i=0;break o}for(n=t;;){if(!(i=n)){i=0;break o}if(10==l[(n=i-1|0)+e|0])break}if((n=0|tn[u[r+36>>2]](r,e,i))>>>0<i>>>0)break t;e=e+i|0,t=t-i|0,o=u[r+20>>2]}ed(o,e,t),u[r+20>>2]=u[r+20>>2]+t,n=t+i|0};}(t,r,e)}function te(e,t){return e?function(e,t,r){r=1;t:{if(e){if(t>>>0<=127)break t;i:{if(!u[u[function(){return 39176}()+172>>2]>>2]){if((-128&t)==57216)break t;break i}if(t>>>0<=2047)return s[e+1|0]=63&t|128,s[0|e]=t>>>6|192,2;if(!((-8192&t)!=57344?t>>>0>=55296:0))return s[e+2|0]=63&t|128,s[0|e]=t>>>12|224,s[e+1|0]=t>>>6&63|128,3;if(t-65536>>>0<=1048575)return s[e+3|0]=63&t|128,s[0|e]=t>>>18|240,s[e+2|0]=t>>>6&63|128,s[e+1|0]=t>>>12&63|128,4}u[ti()>>2]=25,r=-1}return r}return s[0|e]=t,1}(e,t,0):0}function tt(e){return u[e>>2]=8552,0}function tr(e){return e-48>>>0<10}function ti(){return 39404}r=0,n(t=l,1024,"eJgAAC0rICAgMFgweAAobnVsbCk="),n(t,1056,"EQAKABEREQAAAAAFAAAAAAAACQAAAAALAAAAAAAAAAARAA8KERERAwoHAAEACQsLAAAJBgsAAAsABhEAAAARERE="),n(t,1137,"CwAAAAAAAAAAEQAKChEREQAKAAACAAkLAAAACQALAAAL"),n(t,1195,"DA=="),n(t,1207,"DAAAAAAMAAAAAAkMAAAAAAAMAAAM"),n(t,1253,"Dg=="),n(t,1265,"DQAAAAQNAAAAAAkOAAAAAAAOAAAO"),n(t,1311,"EA=="),n(t,1323,"DwAAAAAPAAAAAAkQAAAAAAAQAAAQAAASAAAAEhIS"),n(t,1378,"EgAAABISEgAAAAAAAAk="),n(t,1427,"Cw=="),n(t,1439,"CgAAAAAKAAAAAAkLAAAAAAALAAAL"),n(t,1485,"DA=="),n(t,1497,"DAAAAAAMAAAAAAkMAAAAAAAMAAAMAAAwMTIzNDU2Nzg5QUJDREVGRmF0YWwgKGludGVybmFsKSBlcnJvciBpbiAlcywgbGluZSAlZDogJXMKAGFzc2VydGlvbiBmYWlsZWQ6IDAAY2VsdC9jZWx0LmMAAAAAAAAAAJ0+AEBePgDABD4AgO0+AECJPgAAAAAAwEw/AADNPQ=="),n(t,1665,"/wD/AP8A/wD/AP4BAAH/AP4A/QIAAf8A/gD9AwAB/wAg/h/2H+of2B/CH6gfiB9iHzofCh/YHqAeYh4iHtwdkB1CHe4clhw6HNgbchsKG5waKhq0GToZvBg8GLYXLhegFhAWfhXoFE4UsBMQE24SyBEeEXQQxg8WD2QOrg34DEAMhAvICgoKSgmKCMYHAgc+BngFsgTqAyIDWgKSAcoAAAA2/27+pv3e/Bb8TvuI+sL5/vg6+Hb3tvb29Tj1fPTA8wjzUvKc8erwOvCM7+LuOO6S7fDsUOyy6xjrgurw6WDp0uhK6MTnROfG5kzm1uVk5fbkjuQo5MbjauMS477icOIk4t7hnuFg4Sjh9uDG4J7geOBY4D7gKOAW4ArgAuAA4A=="),n(t,1969,"DwgHBAsMAwINCgUGCQ4BAAkGAwQFCAECB2Fzc2VydGlvbiBmYWlsZWQ6IGQ9PTEwIHx8IGQ9PTE2AHNpbGsvTkxTRjJBLmMAYXNzZXJ0aW9uIGZhaWxlZDogcHNEZWMtPkxQQ19vcmRlciA9PSAxMCB8fCBwc0RlYy0+TFBDX29yZGVyID09IDE2AHNpbGsvQ05HLmMAYXNzZXJ0aW9uIGZhaWxlZDogZCA+PSA2AHNpbGsvTFBDX2FuYWx5c2lzX2ZpbHRlci5jAGFzc2VydGlvbiBmYWlsZWQ6IChkICYgMSkgPT0gMABhc3NlcnRpb24gZmFpbGVkOiBkIDw9IGxlbgAAuH6aeZp5Zma4fjNzYXNzZXJ0aW9uIGZhaWxlZDogaWR4ID4gMABzaWxrL1BMQy5jAGFzc2VydGlvbiBmYWlsZWQ6IHBzRGVjLT5MUENfb3JkZXIgPj0gMTAAKq/Vyc//QAARAGP/YQEQ/qMAJyu9Vtn/BgBbAFb/ugAXAID8wBjYTe3/3P9mAKf/6P9IAUn8CAolPgAAAAAAAIfHPclAAIAAhv8kADYBAP1IAjMkRUUMAIAAEgBy/yABi/+f/BsQezgAAAAAAAAAAGgCDcj2/ycAOgDS/6z/eAC4AMX+4/0EBQQVQCMAAAAA5j7GxPP/AAAUABoABQDh/9X//P9BAFoABwBj/wj/1P9RAi8GNArHDAAAAAAAAAAA5FcFxQMA8v/s//H/AgAZACUAGQDw/7n/lf+x/zIAJAFvAtYDCAW4BQAAAAAAAAAAlGtnxBEADAAIAAEA9v/q/+L/4P/q/wMALABkAKgA8wA9AX0BrQHHAQAAAAAAAAAAvQCo/WkCZ3d1AGH/0vsIdDQA3QCo9nRu/P8RAury5WbQ//YCjPClXbD/iQN17wZTnf/MA4LvZkeV/8cDi/AnO5n/gANh8q4upf8FA8/0XiK5/2MCofeYFtL/qQGh+rQLYXNzZXJ0aW9uIGZhaWxlZDogMABzaWxrL3Jlc2FtcGxlcl9wcml2YXRlX2Rvd25fRklSLmMAYXNzZXJ0aW9uIGZhaWxlZDogMABzaWxrL3Jlc2FtcGxlci5jAAYAAwAHAwABCgACBhIKDAQAAgAAAAkEBwQAAwwHB2Fzc2VydGlvbiBmYWlsZWQ6IGluTGVuID49IFMtPkZzX2luX2tIegBhc3NlcnRpb24gZmFpbGVkOiBTLT5pbnB1dERlbGF5IDw9IFMtPkZzX2luX2tIeg=="),n(t,2928,"/fr06dS2loN4bmJVSDwxKCAZEw8NCwkIBwYFBAMCAQDS0M7Lx8G3qI5oSjQlGxQOCgYEAg=="),n(t,2992,"38m3p5iKfG9iWE9GPjgyLCcjHxsYFRIQDgwKCAYEAwIBALywm4p3YUMrGgoApXdQPS8jGxQOCQQAcT8AAAAAAAwjPFNshJ20zuQPIDdNZX2Xr8nhEypCWXKJorjR5gwZMkhheJOsyN8aLEVacoeftM3hDRY1UGqCnLTN5A8ZLEBac46oxN4TGD5SZHiRqL7WFh8yT2d4l6rL4xUdLUFqfJarxOAeMUtheY6lutHlExk0Rl10j6bA2xoiPkthdpGnwtkZIThGW3GPpcTfFSIzSGF1kavE3hQdMkNadZCoxd0WHzBCX3WSqMTeGCEzTXSGnrTI4BUcRldqfJWqwtkaITVAU3WYrczhGyJBX2yBm67S4RQaSGNxg5qwyNsiKz1OXXKbsc3lFx02YXyKo7PR5R4mOFl2gZ6yyOcVHTE/VW+Oo8HeGzBNZ4Wes8TX6B0vSmN8l7DG3O0hKj1MXXmbrs/hHTVXcIiaqrzQ4xgeNFSDlqa6y+UlMEBUaHacscnmUQsKCQoJCgnvCO8ICgn8CBcJ7whICxQKWgk/CQoJ4gjiCOII4giSCLcJJAkkCQoJCgkKCSQJJAk/CTIJkAzOCiQJJAkKCeIIrQifCNUIkgicCaoJPwlaCVoJWglaCT8JZwkKCZcN8AtPCJ8I4gjiCOII7wgKCdUI0gxFDBQKWgnHCK0InwiSCJIIQggAEAUPrQg8CjwKZwkKCVoJPwkaCGoMrAw/Ca0I+QmCCSQJCgl3CK0ICg2gDaYKkgjVCJwJMgk/CZ8INQgyCXQJFwk/CVoJdAl0CXQJnAk/CcMOLQ6CCd8JPwniCOII/AifCAAItgyZDJkKHguPCRcJ/Aj8COIITwi/DOQMwQr2Co8J1QjVCMcITwg1CDkLpQtJCj8JZwkyCZIIxwjHCEIImQx9DEkKFAriCIUIxwitCK0IXQhqDO4MtApnCeII4gjiCO8IkghCCEUMyAycCQ0I7wjECT8JtwmCCYUIsw3SDAoJjApXCqoJPwlaCSQJTwhfDc8N3gvwC/wIngetCOII4gjiCEwNJg0nCH8KOQsyCXQJ4giqCewJsA6gDZ4HZApRC98JWgk/CZwJ1QjUC8gMtApIC7QKaghPCO8IugjHCG8OSQ7pB7EHZAqMChQKxAkXCT8JhwxVDTIJGghIC0gLJAm3CccIdwgKDSYNHgvcChcJagjiCO8IQggNCBcJ/AiFCHcIhQg/CUkKjAqMCvkJZwmCCa0I1QitCK0IJAl0CS8KjAreC6wM9gpIC6oJGgj8CAoJMglMCa0IaghPCO8IxAnpCukKPAoUCj8JXA6BDroILgeFCMEKpgpxCtEJnwjpClgMpgr5CR4L0QmFCFoJrQiFCNSylIFsYFVST009Ozk4MzEwLSopKCYkIh8eFQwKAwEA//X07Onh2cu+sK+hlYh9cmZbUUc8NCsjHBQTEgwLBQCzioyUl5WZl6N0Q1I7XEhkWVw="),n(t,4112,"EAAAAABjQiQkIiQiIiIiU0UkNCJ0ZkZERLBmREQiQVVEVCR0jZiLqoS7uNiJhPmouYtoZmRERLLaubmq9Ni7u6r0u7vbimebuLmJdLebmIiE2bi4qqTZq5uL9Km4uaqk2N/aitaPvNqo9I2Im6qoitzbi6TbytiJqLr2uYt0udu5imRkhmRmIkREZESoy93aqKeaiGhGpPariYuJm9rbi//+/e4OAwIBAP/+/NojAwIBAP/++tA7BAIBAP/+9sJHCgIBAP/87LdSCAIBAP/867RaEQIBAP/44KthHgQBAP/+7K1fJQcB"),n(t,4352,"////gwaR///////sXQ9g///////CUxlH3f////+iSSJCov///9J+SSs5rf///8l9RzA6gv///6ZuSTk+aNL///t7QTdEZKv/AAAAAAAAAAD6AAMABgADAAMAAwAEAAMAAwADAM0BAAAgAAoAFC5kAfALAAAwDQAAsA8AAPAPAAAQEAAAsBAAAAARAABQEQAABxcmNkVVZHSDk6KywdDf7w0ZKTdFU2Jwf46dq7vL3OwPFSIzPU5can6ImKe5zeHwChUkMj9PX25+jZ2tvc3d7REUJTM7Tllre4aWpLjN4PAKDyAzQ1FgcIGOnq29zNzsCBUlM0FPYnF+ipuos8DR2gwPIjc/TldsdoOUp7nL2+wQEyAkOE9bbHaImqu6zNztCxwrOkpZaXiHlqW0xNPi8QYQIS48S1xre4mcqbnH1uELEx4sOUpZaXmHmKm6ytrqDBMdLjlHWGR4hJSltsfY6REXIy44TVxqe4aYp7nM3u0OES01P0tZa3OEl6u8zt3wCRAdKDhHWGd3iZqrvc3e7RATJDA5TFdpdoSWp7nK2uwMER02R1FeaH6IlaS2yd3tDxwvPk9hc4GOm6i0wtDf7ggOHi0+Tl5vf4+fr8DP3+8RHjE+T1xrd4SRoK6+zNzrDhMkLT1MW2x5ipqsvc3e7gwSHy08TFtre4qaq7vM3ewNER8rNUZTZ3KDlae5y9ztERYjKjpOXW59i5uqvM7g8AgPIjJDU2Nzg5KissHR4O8NEClCSVZfb4CJlqO3zuHxERklND9LXGZ3hJCgr7/U5xMfMUFTZHWFk6Guu8jV4/ISHzREWGd1foqVo7HAz9/vEB0vPUxaaneFk6GwwdHg8A8VIzI9SVZhbneBja/G2u1JDm0LbQttC20LbQttC20LbQttC20LbQuTC5MLbQseC5AMDQycC/AL8AvCC8ILwguTC5MLwgucC0gLHgseC6YKUA+uD6ULhwyHDHYL8AseCzIMrAxtCx4LPAr5CdwKbQu8DX0MwgsfDMsLSAttC20LbQttC0gLSAtIC0gLSAvBCr4TvhN2C/UNOQ3wCw0M6QpYDFgMnAseC9EJ7AnBCkgLTBE1EIwKwQqcC8ILbQseC6ULywttC20LbQttC0gLpgokDssLnAvwC/ALOQv2CvALkAznC6UL2wzbDKUL7gyvC2sUlhPsCQoNxg05DX0MFgwwDaULjApXCn8K6QoeC3EK2RM2FAcSTBGcCVEL5wuHDGEMfwq0CkgLHgvpCh4LjAoyDEgLkwttC20LbQttC5MLkwuTC5MLbQttC5MLkwuTC2oQhwylCx8MwgtIC0gLbQucCzkLZAvLC5wLwgt9DDkLsA6wDqwMHwylC0gLbQtIC5wLdgvpCukKHgtIC0gLZAoOD64PhwwyDKwMdgvnC5MLkwsNDB4L6QrpCukK6QoUCgUP8A8dDbwNFgy0CsILdgsyDA0MHgseC1cKVwoeC/YKGxQeE5kMBQ9xDWEMUQtVDXsNjAoUCnEKtAoeC/YKwQoNEM0O2wxYDG0LSAtIC20L6Qq0CukKtArpCh4LSAv2CtkTvhPnC9kNrAzwCw0MgAsfDFELtAq0CrQKHgvpCjwK1RDVECwL3wmHDDANMA0DDAMMMA3wCx4LVwoUCqYKwQrwC2QL9gpIC7QKfwpRCx8MTgxODJAMYQzwC8ILkwseCxcRKg9tC0gLHgtICx4LHgtIC0gLSAseC0gLbQtICx4LpQtkC2QLpQulC/ALMgyQDE4M8AvCC5wLnAucC20LtAqFEDUQ7gwTDW0LkwtIC6ULpQseC+kKtAoeCx4LHgvpCvAPrg8fDMILbQttC20LSAttC20LHgseCx4L6QpIC9wKBxLfEWEMcQ2HDKULUQveCzIMtAp/Cn8Kfwq0CukKjAo1EK0QzQ5JDqYK3ApIC0gLwgucC20LHgt/Cn8K6QpIC3cQ4g3BCh4LHgtIC0gLSAttC20LSAttC20LbQuTC0gLNhQ5E9UIaA3NDpcNEw0eC+4Mlw1ODFELnAm3CcEKbQt7DWUOMgx9DB0N5wuHDIcMpQuQDA0MbQttC38K7AmCCaULwgvpCukKtArpCh4LnAvwCx8MTgxODE4MHwzCC8ILgAs5C38KpgrcCsILaA3ZDR0NrAzwC8ILkwttC0gLHgvLC4ALUQvCC8ILnAvLCx8M8AvwC8ILSAseC20LbQtIC1APfw/CC30MHQ2QDNsM2wyXDXgOcQ2mCoUInAkUCi8K4czJuLevnpqZh3dzcW5tY2JfT0Q0MjAtKyAfGxIKAwD/++vm1MnEtqemo5eKfG5oWk5MRkU5LSIYFQsGBQQDAK+UoLCyra6ksa7EtsbAtkQ+QjxIdVVadoiXjqCOmw=="),n(t,6135,"AWRmZkREJCJgpGueubS5i2ZAQiQiIgABINCLjb+YuZtoYKtopmZmZoQBAAAAABAQAFBtTmu5i2dl0NSNi62Ze2ckAAAAAAAAATAAAAAAAAAgRId7d3dnRWJEZ3h2dmZHYoaInbi2mYuG0Kj4S72PeWsgMSIiIgARAtLri3u5iWmGYodotmS3q4ZkRkRGQkIig0CmZkQkAgEAhqZmRCIiQoTU9p6La2tXZmTbfXqJdmeEcoeJaatqMiKk1o2PuZd5Z8AiAAAAAAAB0G1Ku4b5n4lmbpp2V2V3ZQACACQkQkQjYKRmZCQAAiGniq5mZFQCAmRreHckxRgA//799AwDAgEA//784CYDAgEA//770TkEAgEA//70w0UEAgEA//vouFQHAgEA//7wulYOAgEA//7vslseBQEA//jjsWQTAgE="),n(t,6464,"////nASa///////jZg9c///////VUxhI7P////+WTCE/1v///755TSs3uf////WJRys7i/////+DQjJCa8L//6Z0TDc1ff//AAAAAAAAAABkAAMAKAADAAMAAwAFAA4ADgAKAAsAAwAIAAkABwADAFsBAAAgABAAZiarAZARAACQEwAAkBcAANAXAADwFwAA8BgAAEAZAACQGQAAAAAAAFzKvti235rinOZ47Hr0zPw0A4YLiBNkGWYdSiBCJ6Q1+ff29fTq0srJyMWuUjs4NzYuFgwLCgkHAEAAy5YA18OmfW5SAAAAABsaAAAeGgAAeACAQADongoA5gDz3cC1AGQA8AAgAGQAzTwAMAAgq1UAwIBAAM2aZjMA1auAVSsA4MCggGBAIABkKBAHAwEAYXNzZXJ0aW9uIGZhaWxlZDogZnNfa0h6ID09IDggfHwgZnNfa0h6ID09IDEyIHx8IGZzX2tIeiA9PSAxNgBzaWxrL2RlY29kZXJfc2V0X2ZzLmMAYXNzZXJ0aW9uIGZhaWxlZDogcHNEZWMtPm5iX3N1YmZyID09IE1BWF9OQl9TVUJGUiB8fCBwc0RlYy0+bmJfc3ViZnIgPT0gTUFYX05CX1NVQkZSLzIAYXNzZXJ0aW9uIGZhaWxlZDogMABhc3NlcnRpb24gZmFpbGVkOiBfZnQ+MQBjZWx0L2VudGRlYy5j"),n(t,7008,"4HAsDwMCAQD+7cCERhcEAP/84ps9CwI="),n(t,7040,"+vXqy0cyKiYjIR8dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQCzYwBHOCseFQwG"),n(t,7104,"x6WQfG1gVEc9MyogFw8IAPHh08e7r6SZjoR7cmlgWFBIQDkyLCYhHRgUEAwJBQIArBsAAMAbAADQGwAAAAAAAAQGGAcFAAACAAAMHCkN/PcPKhkOAf4+Kff2JUH8A/oEQgf4EA4m/SEAAAAAAAAAAA0WJxcM/yRAG/r5CjcrEQEBCAEBBvVKNff0N0z0CP0DXRv8Gic7A/gCAE0LCfgWLPoHKAkaAwn5FGX5BAP4KhoA8SFEAhf+Ny7+DwP/FRAp+hs9JwX1KlgEAf48QQb8//tJOAH3E14d9wAMYwYECO1mLvMDAg0DAgnrVEju9S5o6ggSJjAXAPBGU+sLBfV1Fvj6F3X0AwP4XxwE9g9NPPH/BHwC/AMmVBjnAg0qDR8V/Dgu//8jT/MT+UFY9/IUBFEx4xQASwPvBfcsXPgB/RZFH/pfKfQFJ0MQ/AEA+ng33PMsegToUQULAwcCAAkKWAAcAAAwHAAAgBwAAGFzc2VydGlvbiBmYWlsZWQ6IHBzRGVjLT5wc05MU0ZfQ0ItPm9yZGVyID09IHBzRGVjLT5MUENfb3JkZXIAc2lsay9kZWNvZGVfaW5kaWNlcy5jAH0zGhIPDAsKCQgHBgUEAwIBAMZpLRYPDAsKCQgHBgUEAwIBANWidFM7KyAYEg8MCQcGBQMCAO+7dDscEAsKCQgHBgUEAwIBAPrlvIdWMx4TDQoIBgUEAwIBAPnr1bmcgGdTQjUqIRoVEQ0KAP75686kdk0uGxAKBwUEAwIBAP/9+e/cv5x3VTklFw8KBgQCAP/9+/bt38uzmHxiSzcoHRUPAP/+/ffcompDKhwSDAkGBAMC"),n(t,7744,"8b6yhFdKKQ4A38GdjGo5JxI="),n(t,7776,"gADWKgDrgBUA9LhICwD41oAqBwD44apQGQUA++zGfjYSAwD67tOfUiMPBQD658uogFg1GQYA/O7YuZRsRygSBAD98+HHpoBaOR8NAwD+9unUt5NtSSwXCgIA//rw38amgFo6IRAGAQD/+/Tn0rWSbksuGQwFAQD//fju3cSkgFw8IxIIAwEA//358uXQtJJuTDAbDgcDAQ=="),n(t,7936,"gQDPMgDsgRQA9blICgD51YEqBgD64qlXGwQA++nCgj4UBAD67M+gYy8RAwD/8Nm2g1EpCwEA//7pyZ9rPRQCAQD/+enOqoBWMhcHAQD/+u7ZupRsRicSBgEA//zz4simgFo4Hg0EAQD//PXn0bSSbkwvGQsEAQD//fjt28KjgF0+JRMIAwEA//768eLNsZFvTzMeDwYCAQ=="),n(t,8096,"gQDLNgDqgRcA9bhJCgD614EpBQD86K1WGAMA/fDIgTgPAgD99NmkXiYKAQD99eK9hEcbBwEA/fbny59pOBcGAQD/+OvVs4VVLxMFAQD//vPdwp91RiUMAgEA//746tCrgFUwFggCAQD//vrw3L2Va0MkEAYCAQD//vvz48mmgFo3HQ0FAgEA//789urVt5NtSSsWCgQCAQ=="),n(t,8256,"ggDIOgDnghoA9LhMDAD51oIrBgD86K1XGAMA/fHLgzgOAgD+9t2nXiMIAQD++ejBgkEXBQEA//vv06JjLQ8EAQD/+/PfuoNKIQsDAQD//PXmyp5pORgIAgEA//3369azhFQsEwcCAQD//vrw38SfcEUkDwYCAQD//v3159GwiF03GwsDAgEA//79/O/dwp51TCoSBAMCAQ=="),n(t,8418,"AgUJDhQbIyw2QU1aaHeH"),n(t,8448,"/jFDTVJdY8YLEhgfJC3/LkJOV15o0A4VICozQv9eaG1wc3b4NUVQWF9mYXNzZXJ0aW9uIGZhaWxlZDogX2Z0PjEAY2VsdC9lbnRlbmMuYwBhc3NlcnRpb24gZmFpbGVkOiBfYml0cz4wAGFzc2VydGlvbiBmYWlsZWQ6IGZyYW1lX2xlbmd0aCA9PSAxMiAqIDEwAHNpbGsvZGVjb2RlX3B1bHNlcy5jAHNpbGsvc29ydC5jAGFzc2VydGlvbiBmYWlsZWQ6IEwgPiAwAAABAAAAAQ=="),n(t,8674,"Af8B/wL+Av4D/QABAAH/Av8C/gP+Aw=="),n(t,8705,"Av///wAAAQEAAQABAAAAAAABAAAAAAABAAAAAQAAAAAA/wIBAAEBAAD//wAAAAAAAAH/AAH/AP8B/gL+/gL9AgP9/AP8BAT7Bfr7BvkGBQj3AAABAAAAAAAAAP8BAAAB/wAB//8B/wIB/wL+/gL+AgID/QABAAAAAAAAAQABAAAB/wEAAAIB/wL//wL/AgL/A/7+/gMAAQAAAQAB/wL/Av8CA/4D/v4EBP0F/fwG/AYF+wj6+/kJYXNzZXJ0aW9uIGZhaWxlZDogbmJfc3ViZnIgPT0gUEVfTUFYX05CX1NVQkZSID4+IDEAc2lsay9kZWNvZGVfcGl0Y2guYwBhc3NlcnRpb24gZmFpbGVkOiBzdGFydF9pZHggPiAwAHNpbGsvZGVjb2RlX2NvcmUuYwBhc3NlcnRpb24gZmFpbGVkOiBwc0RlYy0+TFBDX29yZGVyID09IDEwIHx8IHBzRGVjLT5MUENfb3JkZXIgPT0gMTYAYXNzZXJ0aW9uIGZhaWxlZDogTCA+IDAgJiYgTCA8PSBNQVhfRlJBTUVfTEVOR1RIAHNpbGsvZGVjb2RlX2ZyYW1lLmMAYXNzZXJ0aW9uIGZhaWxlZDogcHNEZWMtPnByZXZTaWduYWxUeXBlID49IDAgJiYgcHNEZWMtPnByZXZTaWduYWxUeXBlIDw9IDIAYXNzZXJ0aW9uIGZhaWxlZDogcHNEZWMtPmx0cF9tZW1fbGVuZ3RoID49IHBzRGVjLT5mcmFtZV9sZW5ndGgAYXNzZXJ0aW9uIGZhaWxlZDogZGVjQ29udHJvbC0+bkNoYW5uZWxzSW50ZXJuYWwgPT0gMSB8fCBkZWNDb250cm9sLT5uQ2hhbm5lbHNJbnRlcm5hbCA9PSAyAHNpbGsvZGVjX0FQSS5jAGFzc2VydGlvbiBmYWlsZWQ6IDAAAAAGAAAABAAAAAMAAACAuwAAeAAAABUAAAAVAAAAAJpZPwAAAAAAAIA/AACAP0AlAAADAAAACAAAAHgAAAALAAAAcCUAAGAmAACQJgAAgAcAAAMAAABwKAAAkFwAAMBdAAB4XgAAsCgAAIgBAADQRAAAsEUAAEBHAAAAAAAAAAABAAIAAwAEAAUABgAHAAgACgAMAA4AEAAUABgAHAAiACgAMAA8AE4AZA=="),n(t,9605,"WlBLRT84MSgiHRQSCgAAAAAAAAAAbmRaVE5HQTozLScgGhQMAAAAAAAAdm5nXVZQS0ZBOzUvKB8XDwQAAAAAfndwaF9ZU05IQjw2LycgGREMAQAAhn94cmdhW1VOSEI8Ni8pIx0XEAoBkImCfHFrZV9YUkxGQDkzLSchGg8BmJGKhHt1b2liXFZQSkM9NzErJBQBopuUjoV/eXNsZmBaVE1HQTs1Lh4BrKWemI+Jg312cGpkXldRS0U/OC0UyMjIyMjIyMjGwby3sq2oo56ZlIFo"),n(t,9840,"CAAIAAgACAAQABAAEAAVABUAGAAdACIAJAAAAAAAAABqHI04UrseOghp3DqC7Vc7iWOyOwMqBTww3Dk8tD53PByjnjzR8sU8/obxPJurED0FrSo9hMJGPVPmZD0RiYI9h5+TPcuypT3Rvrg9Or/MPVSv4T0Uivc9DiUHPtn0Ej5fMR8+aNcrPorjOD4wUkY+lB9UPr9HYj6OxnA+sJd/PlJbhz5gD48+mOWWPnnbnj5w7qY+2BuvPvtgtz4Ru78+RifIPrei0D54Ktk+lLvhPgxT6j7e7fI+Bon7Pr4QAj8fWgY/JJ8KP1DeDj8rFhM/QUUXPyVqGz9zgx8/zo8jP+aNJz90fCs/P1ovPxkmMz/n3jY/mYM6PzMTPj/FjEE/d+9EP386SD8nbUs/zoZOP+WGUT/xbFQ/jjhXP2npWT9Ff1w/+vleP3NZYT+vnWM/wcZlP8/UZz8RyGk/0qBrP25fbT9QBG8/9I9wP+YCcj+9XXM/H6F0P7/NdT9X5HY/sOV3P5fSeD/jq3k/c3J6Pycnez/nyns/nV58PzXjfD+cWX0/vcJ9P4Yffj/ecH4/q7d+P8/0fj8mKX8/hlV/P756fz+WmX8/zLJ/PxTHfz8c138/guN/P93sfz+2838/ivh/P8j7fz/W/X8/B/9/P6X/fz/o/38//f9/PwAAgD/gAQAAh4gIO/////8FAGAAAwAgAAQACAACAAQABAAB"),n(t,10396,"8EcAALBL"),n(t,10416,"//9/P47/fz9q/n8/k/x/Pwf6fz/I9n8/1vJ/PzDufz/W6H8/yOJ/Pwfcfz+T1H8/a8x/P4/Dfz8Aun8/va9/P8ekfz8dmX8/wIx/P7B/fz/scX8/dmN/P0tUfz9uRH8/3jN/P5oifz+jEH8/+v1+P53qfj+N1n4/y8F+P1asfj8uln4/U39+P8Znfj+GT34/lDZ+P+8cfj+YAn4/j+d9P9PLfT9mr30/RpJ9P3R0fT/xVX0/vDZ9P9UWfT889nw/8tR8P/ayfD9JkHw/62x8P9tIfD8bJHw/qf57P4fYez+0sXs/MIp7P/xhez8XOXs/gg97Pz3lej9Iuno/oo56P01iej9INXo/lAd6PzDZeT8dqnk/Wnp5P+lJeT/IGHk/+eZ4P3u0eD9OgXg/c014P+oYeD+y43c/za13Pzp3dz/5P3c/Cgh3P27Pdj8llnY/L1x2P4whdj885nU/QKp1P5dtdT9CMHU/QfJ0P5SzdD87dHQ/NzR0P4fzcz8ssnM/JnBzP3Ytcz8a6nI/FKZyP2Rhcj8KHHI/BdZxP1ePcT8ASHE///9wP1W3cD8CbnA/BiRwP2LZbz8Vjm8/IEJvP4T1bj8/qG4/U1puP8ALbj+GvG0/pWxtPx0cbT/vymw/G3lsP6EmbD+A02s/u39rP1Araz9A1mo/jIBqPzIqaj8102k/k3tpP00jaT9kymg/2HBoP6gWaD/Vu2c/YGBnP0gEZz+Pp2Y/M0pmPzbsZT+XjWU/Vy5lP3fOZD/1bWQ/1AxkPxKrYz+xSGM/sOViPxCCYj/RHWI/87hhP3dTYT9c7WA/pIZgP04fYD9bt18/y05fP57lXj/Ve14/cBFeP26mXT/SOl0/ms5cP8ZhXD9Z9Fs/UYZbP64XWz9yqFo/nThaPy7IWT8nV1k/h+VYP09zWD9/AFg/F41XPxgZVz+CpFY/Vi9WP5O5VT86Q1U/S8xUP8dUVD+u3FM/AWRTP7/qUj/pcFI/f/ZRP4J7UT/y/1A/z4NQPxoHUD/SiU8/+gtPP5CNTj+UDk4/CY9NP+0OTT9Bjkw/BQ1MPzuLSz/hCEs/+YVKP4MCSj9/fkk/7vlIP890SD8k70c/7WhHPyniRj/aWkY/ANNFP5tKRT+swUQ/MjhEPy+uQz+iI0M/jZhCP+8MQj/IgEE/GvRAP+VmQD8o2T8/5Uo/Pxu8Pj/MLD4/95w9P50MPT++ezw/XOo7P3VYOz8Kxjo/HTM6P62fOT+7Czk/R3c4P1HiNz/aTDc/47Y2P2sgNj90iTU//fE0PwdaND+TwTM/oCgzPzCPMj9C9TE/2FoxP/G/MD+OJDA/r4gvP1XsLj+BTy4/MrItP2kULT8ndiw/a9crPzc4Kz+LmCo/Z/gpP8xXKT+6tig/MhUoPzNzJz+/0CY/1i0mP3mKJT+n5iQ/YUIkP6mdIz99+CI/31IiP8+sIT9NBiE/W18gP/i3Hz8lEB8/4mcePzC/HT8QFh0/gWwcP4TCGz8aGBs/Q20aPwDCGT9RFhk/NmoYP7G9Fz/BEBc/Z2MWP6O1FT92BxU/4VgUP+SpEz9/+hI/s0oSP4CaET/n6RA/6DgQP4SHDz+71Q4/jiMOP/5wDT8Kvgw/swoMP/pWCz/fogo/Y+4JP4Y5CT9JhAg/rM4HP68YBz9UYgY/m6sFP4P0BD8PPQQ/PYUDPw/NAj+GFAI/oVsBP2GiAD+P0f8+p13+Pg7p/D7Cc/s+xv35PhuH+D7BD/c+upf1PgYf9D6opfI+nivxPuyw7z6RNe4+kLnsPug86z6av+k+qUHoPhXD5j7fQ+U+CMTjPpFD4j58wuA+yEDfPni+3T6MO9w+BrjaPuYz2T4ur9c+3ynWPvmj1D59HdM+bpbRPswO0D6Xhs4+0v3MPn10yz6Z6sk+J2DIPijVxj6fScU+ir3DPuwwwj7Go8A+GRa/PuaHvT4t+bs+8Wm6PjLauD7xSbc+L7m1Pu4ntD4vlrI+8gOxPjlxrz4E3q0+VkqsPi+2qj6QIak+eoynPu/2pT7vYKQ+fMqiPpczoT5AnJ8+egSePkRsnD6h05o+kTqZPhahlz4wB5Y+4WyUPinSkj4LN5E+h5uPPp7/jT5RY4w+osaKPpEpiT4gjIc+UO6FPiJQhD6XsYI+sBKBPt7mfj6pp3s+w2d4Pi8ndT7u5XE+BKRuPnNhaz48Hmg+YtpkPuiVYT7PUF4+GgtbPszEVz7mfVQ+azZRPl3uTT6/pUo+klxHPtoSRD6XyEA+zn09PoAyOj6u5jY+XZozPo1NMD5CAC0+fbIpPkJkJj6RFSM+bsYfPtt2HD7aJhk+bdYVPpiFEj5bNA8+uuILPreQCD5UPgU+lOsBPvAw/T0GivY9ceLvPTM66T1PkeI9z+fbPbU91T0Dk849wOfHPfI7wT2cj7o9w+KzPWw1rT2bh6Y9VdmfPZ8qmT1+e5I99suLPQschT2H13w9RnZvPV0UYj3WsVQ9uU5HPRDrOT3lhiw9QCIfPSy9ET2yVwQ9tePtPGAX0zx2Srg8C32dPDKvgjz6wU88/iQaPCoPyTuZpzs7Ln3WudJGcbur3uO7pownvIEpXbzhYom8oDCkvOz9vryzytm84Jb0vDGxB72TFhW9jHsivRPgL70eRD29padKvZ0KWL3+bGW9vs5yveoXgL0byIa97XeNvVwnlL1j1pq9/YShvSYzqL3Z4K69EY61vco6vL3+5sK9qpLJvcg90L1U6Na9SpLdvaQ75L1d5Oq9cozxvd0z+L2a2v69UsACvvwSBr5HZQm+MrcMvroIEL7dWRO+mKoWvur6Gb7QSh2+R5ogvk7pI77hNye+AIYqvqbTLb7TIDG+g200vrW5N75lBTu+k1A+vjqbQb5a5US+8C5Ivvl3S750wE6+XQhSvrNPVb5zlli+nNxbvioiX74bZ2K+batlvh/vaL4sMmy+lHRvvlS2cr5q93W+0zd5vo13fL6Wtn++dXqBvkUZg765t4S+0FWGvojzh77hkIm+2i2LvnDKjL6kZo6+dAKQvt+dkb7kOJO+gdOUvrZtlr6BB5i+4qCZvtc5m75f0py+eWqeviMCoL5emaG+JjCjvn3GpL5gXKa+zvGnvsaGqb5HG6u+UK+svuBCrr711a++j2ixvq36sr5NjLS+bh22vhCut74wPrm+z826vupcvL6C672+lHm/vh8Hwb4jlMK+nyDEvpGsxb74N8e+08LIviJNyr7i1su+E2DNvrXozr7FcNC+QvjRvi1/076DBdW+Q4vWvm0Q2L7/lNm++Rjbvlmc3L4dH96+RqHfvtMi4b7Bo+K+ECTkvr6j5b7MIue+OKHovgAf6r4knOu+ohjtvnqU7r6rD/C+M4rxvhIE875GffS+z/X1vqpt977Z5Pi+WFv6vijR+75HRv2+tbr+vjgXAL+70AC/5IkBv7JCAr8l+wK/O7MDv/ZqBL9TIgW/U9kFv/WPBr84Rge/HfwHv6KxCL/HZgm/jBsKv/DPCr/zgwu/kzcMv9HqDL+snQ2/JFAOvzgCD7/osw+/MmUQvxgWEb+XxhG/sHYSv2MmE7+u1RO/kYQUvw0zFb8f4RW/yI4Wvwg8F7/d6Be/SJUYv0hBGb/c7Bm/BJgav8BCG78P7Ru/8JYcv2NAHb9o6R2//pEevyU6H7/c4R+/I4kgv/ovIb9f1iG/Unwiv9QhI7/jxiO/f2skv6cPJb9csyW/nVYmv2j5Jr+/mye/oD0ovwvfKL//fym/fSAqv4PAKr8RYCu/J/8rv8SdLL/oOy2/ktktv8N2Lr95Ey+/tK8vv3NLML+35jC/f4Exv8sbMr+ZtTK/6k4zv73nM78SgDS/6Bc1vz+vNb8WRja/btw2v0VyN7+cBzi/cZw4v8UwOb+WxDm/5lc6v7LqOr/8fDu/wg48vwOgPL/BMD2/+sA9v61QPr/b3z6/g24/v6X8P79AikC/UxdBv+CjQb/kL0K/YLtCv1NGQ7++0EO/nlpEv/bjRL/CbEW/BfVFv7x8Rr/oA0e/iYpHv50QSL8llki/IBtJv46fSb9vI0q/waZKv4YpS7+8q0u/Yy1Mv3quTL8CL02/+q5Nv2IuTr85rU6/fitPvzOpT79VJlC/5qJQv+QeUb9QmlG/KBVSv22PUr8eCVO/O4JTv8P6U7+3clS/FupUv99gVb8S11W/sExWv7fBVr8nNle/AKpXv0IdWL/sj1i//gFZv3hzWb9Z5Fm/olRav1HEWr9mM1u/4qFbv8MPXL8KfVy/t+lcv8hVXb8+wV2/GCxev1eWXr/5/16//2hfv2jRX78zOWC/YqBgv/MGYb/lbGG/OtJhv/A2Yr8Im2K/gP5iv1lhY7+Sw2O/LCVkvyWGZL9+5mS/N0Zlv06lZb/FA2a/mmFmv82+Zr9eG2e/TXdnv5rSZ79ELWi/S4dov67gaL9vOWm/i5FpvwTpab/ZP2q/CZZqv5Trar97QGu/vJRrv1noa79PO2y/oI1sv0vfbL9PMG2/rYBtv2XQbb91H26/321uv6G7br+7CG+/LlVvv/igb78b7G+/lTZwv2eAcL+QyXC/DxJxv+ZZcb8ToXG/l+dxv3Etcr+gcnK/JrdyvwH7cr8yPnO/uIBzv5TCc7/EA3S/SUR0vyKEdL9Qw3S/0gF1v6g/db/SfHW/ULl1vyH1db9FMHa/vWp2v4ikdr+m3Xa/FhZ3v9lNd7/vhHe/V7t3vxHxd78dJni/elp4vyqOeL8rwXi/ffN4vyEleb8WVnm/XIZ5v/K1eb/a5Hm/EhN6v5pAer9zbXq/nZl6vxbFer/f73q/+Bl7v2FDe78abHu/IpR7v3q7e78g4nu/Fwh8v1wtfL/wUXy/03V8vwWZfL+Gu3y/Vd18v3P+fL/fHn2/mj59v6Ndfb/6e32/n5l9v5K2fb/T0n2/Yu59vz8Jfr9pI36/4Tx+v6dVfr+6bX6/G4V+v8mbfr/EsX6/Dcd+v6Lbfr+F736/tQJ/vzIVf7/8Jn+/Ezh/v3ZIf78nWH+/JGd/v251f78Fg3+/6I9/vxmcf7+Vp3+/X7J/v3S8f7/XxX+/hc5/v4HWf7/I3X+/XeR/vz3qf79q73+/4/N/v6n3f7+7+n+/Gf1/v8T+f7+7/3+/+v9/Pzn+fz+p+X8/S/J/Px7ofz8j238/Wct/P8G4fz9bo38/KIt/Pydwfz9aUn8/vzF/P1gOfz8l6H4/Jr9+P1yTfj/IZH4/aTN+P0H/fT9PyH0/lo59PxRSfT/LEn0/vNB8P+eLfD9NRHw/7/l7P82sez/pXHs/Qwp7P920ej+2XHo/0QF6Py6keT/OQ3k/suB4P9x6eD9MEng/BKd3PwQ5dz9PyHY/5FR2P8bedT/2ZXU/dep0P0RsdD9l63M/2mdzP6Phcj/CWHI/Oc1xPwk/cT80rnA/uxpwP6CEbz/k624/ilBuP5OybT8BEm0/1W5sPxHJaz+3IGs/yXVqP0nIaT85GGk/m2VoP2+wZz+6+GY/fD5mP7iBZT9vwmQ/pABkP1o8Yz+RdWI/TKxhP47gYD9ZEmA/rkFfP5FuXj8DmV0/CMFcP6DmWz/PCVs/mCpaP/tIWT/9ZFg/n35XP+WVVj/QqlU/Y71UP6HNUz+M21I/J+dRP3XwUD95908/NPxOP6v+TT/f/kw/1PxLP4z4Sj8K8kk/UulIP2XeRz9H0UY/+8FFP4SwRD/lnEM/IIdCPzpvQT80VUA/Ezk/P9gaPj+I+jw/Jtg7P7SzOj82jTk/r2Q4PyI6Nz+TDTY/Bd80P3yuMz/5ezI/gkcxPxkRMD/C2C4/f54tP1ZiLD9IJCs/WuQpP5CiKD/rXic/cRkmPyXSJD8JiSM/Iz4iP3XxID8Eox8/0lIeP+QAHT89rRs/4VcaP9MAGT8ZqBc/tE0WP6rxFD/9kxM/sjQSP8zTED9QcQ8/Qg0OP6SnDD98QAs/zdcJP5ptCD/pAQc/vZQFPxkmBD8DtgI/fkQBPxyj/z5uuvw++s75Psrg9j7k7/M+UfzwPhoG7j5HDes+4BHoPu0T5T53E+I+hxDfPiQL3D5YA9k+KvnVPqTs0j7N3c8+r8zMPlK5yT6/o8Y+/ovDPhhywD4WVr0+ADi6PuAXtz699bM+odGwPpWrrT6ig6o+z1mnPicupD6yAKE+edGdPoWgmj7fbZc+jzmUPqADkT4azI0+BZOKPmtYhz5WHIQ+zd6APrY/ez4Qv3Q+uztuPsm1Zz5NLWE+WaJaPv8UVD5RhU0+Y/NGPkZfQD4NyTk+yjAzPpCWLD5y+iU+glwfPtK8GD52GxI+f3gLPgHUBD4dXPw9cg3vPSm84T1maNQ9ThLHPQi6uT24X6w9hAOfPZKlkT0HRoQ9EsptPXoFUz2RPjg9pHUdPfyqAj3Kvc88ViOaPGEOSTzFp7s7PXpWuglG8bsS3WO8UIqnvEEk3bzjXQm9IygkvZbwPr3ytlm96np0vRqeh71C/ZS9yFqivYa2r71XEL29FmjKvZu9173DEOW9aWHyvWWv/71KfQa+aCENvvrDE77tZBq+LgQhvqyhJ75TPS6+ENc0vtJuO76GBEK+GZhIvnkpT76UuFW+VkVcvq7PYr6JV2m+1txvvoBfdr5433y+VK6BvoHrhL44J4i+cmGLviSajr5F0ZG+zQaVvrM6mL7ubJu+dJ2evj3Mob5A+aS+cySovs9Nq75Jda6+2pqxvni+tL4b4Le+uv+6vksdvr7HOMG+JVLEvltpx75hfsq+MJHNvryh0L4AsNO+8bvWvofF2b66zNy+gdHfvtPT4r6p0+W++tDovr3L677qw+6+eLnxvmCs9L6anPe+HIr6vt90/b5tLgC/A6EBvy0SA7/mgQS/LPAFv/pcB79MyAi/HjIKv2yaC78yAQ2/bGYOvxfKD78tLBG/rIwSv5DrE7/VSBW/dqQWv3H+F7/AVhm/Yq0av1ECHL+KVR2/Cacev8v2H7/MRCG/CZEiv3zbI78kJCW//WomvwKwJ78w8yi/hDQqv/pzK7+PsSy/P+0tvwcnL7/jXjC/0JQxv8rIMr/O+jO/2io1v+hYNr/3hDe/Aq84vwfXOb8D/Tq/8SA8v89CPb+aYj6/T4A/v+mbQL9otUG/xsxCvwHiQ78X9US/AwZGv8QUR79WIUi/titJv+EzSr/UOUu/jT1Mvwk/Tb9EPk6/PTtPv/A1UL9aLlG/eSRSv0oYU7/KCVS/9/hUv87lVb9N0Fa/cLhXvzeeWL+cgVm/oGJavz5BW791HVy/Qfdcv6LOXb+Uo16/FHZfvyJGYL+6E2G/2d5hv3+nYr+pbWO/VDFkv37yZL8msWW/SW1mv+UmZ7/43We/gJJov3tEab/o82m/w6BqvwxLa7/A8mu/3pdsv2Q6bb9Q2m2/oHduv1MSb79mqm+/2T9wv6nScL/VYnG/W/Bxvzp7cr9xA3O//Yhzv94LdL8RjHS/lgl1v2uEdb+P/HW/AHJ2v73kdr/GVHe/GMJ3v7IseL+TlHi/u/l4vyhceb/Zu3m/zRh6vwJzer95ynq/Lx97vyRxe79YwHu/yQx8v3ZWfL9fnXy/guF8v+Aifb93YX2/R519v0/Wfb+ODH6/BEB+v7Bwfr+Snn6/qcl+v/Xxfr91F3+/KTp/vxBaf78rd3+/eJF/v/iof7+qvX+/j89/v6Xef7/t6n+/ZvR/vxH7f7/t/n+/6v9/P+X4fz+m5n8/Lcl/P3ygfz+VbH8/eS1/Pyzjfj+xjX4/Cy1+Pz/BfT9SSn0/SMh8Pyg7fD/3ons/vf96P4BRej9ImHk/HtR4PwkFeD8TK3c/RkZ2P6xWdT9OXHQ/OFdzP3ZHcj8TLXE/HAhwP57Ybj+lnm0/QFpsP34Laz9rsmk/GU9oP5bhZj/yaWU/PuhjP4tcYj/qxmA/bSdfPyZ+XT8oy1s/hQ5aP1NIWD+jeFY/i59UPyC9Uj920VA/o9xOP73eTD/b10o/E8hIP3yvRj8ujkQ/QWRCP84xQD/s9j0/tLM7P0JoOT+tFDc/ELk0P4ZVMj8p6i8/FXctP2X8Kj81eig/ofAlP8ZfIz/AxyA/rCgeP6mCGz/U1Rg/SiIWPypoEz+TpxA/pOANP3sTCz85QAg//WYFP+eHAj8tRv8+W3H5PpeR8z4kp+0+RbLnPjyz4T5Mqts+upfVPsl7zz6+Vsk+3yjDPnDyvD63s7Y++2ywPoEeqj6SyKM+c2udPmwHlz7FnJA+xyuKPrm0gz7Hb3o+IWttPhFcYD4pQ1M+/SBGPiD2OD4mwys+pIgePi1HET5X/wM+bmPtPcK90j3aDrg93ledPfuZgj28rE89ZRwaPZkKyTwqpzs8wXjWui1EcbxX1+O8TIEnvZQPXb0VSom9WgakvW27vr0iaNm9Tgv0veNRB74vmBS+99chvqUQL76mQTy+ZGpJvk2KVr7NoGO+UK1wvkWvfb4NU4W+nsiLvg04kr4SoZi+ZgOfvr9epb7Ysqu+af+xvitEuL7YgL6+KrXEvtvgyr6lA9G+RR3XvnUt3b7xM+O+djDpvsAi776NCvW+m+f6vtNcAL84QAO/2x0Gv5v1CL9axwu/95IOv1RYEb9QFxS/zc8Wv6yBGb/QLBy/GtEev21uIb+rBCS/t5Mmv3QbKb/Hmyu/kxQuv7uFML8m7zK/t1A1v1WqN7/j+zm/SkU8v26GPr83v0C/i+9Cv1MXRb91Nke/2kxJv2taS78QX02/s1pPvz5NUb+aNlO/sxZVv3LtVr/Fuli/lX5av9A4XL9i6V2/OJBfv0AtYb9nwGK/nElkv87IZb/rPWe/46hov6cJar8nYGu/VKxsvx/ubb96JW+/WFJwv6t0cb9njHK/f5lzv+ebdL+Vk3W/foB2v5Zid7/UOXi/LwZ5v57Heb8Xfnq/lCl7vw3Ke796X3y/1el8vxhpfb8+3X2/QEZ+vxykfr/M9n6/TT5/v5x6f7+2q3+/mdF/v0Psf7+0+3+/pv9/P5Tjfz+cmn8/zCR/PziCfj/9sn0/P7d8PyqPez/zOno/1Lp4PxEPdz/2N3U/1TVzPwgJcT/xsW4/+TBsP5CGaT8vs2Y/U7djP4STYD9OSF0/RdZZPwM+Vj8rgFI/ZZ1OP16WSj/Ma0Y/ah5CP/muPT9AHjk/DW00PzKcLz+HrCo/654lPz90ID9tLRs/YcsVPw1PED9ouQo/awsFPy6M/j7d1PI+8fLmPn/o2j6mt84+iGLCPk7rtT4qVKk+UZ+cPv3Ojz5t5YI+zslrPmKfUT4wUDc+0+AcPvFVAj5iaM89fACaPST7SD0bpLs883dWu2Q98by7wGO9Z12nvRS93L0D+wi+c38jvjTnPb6kLVi+Jk5yvhIihr6JBZO+NM+fvtV8rL4zDLm+GnvFvlvH0b7N7t2+UO/pvsfG9b6QuQC/JnkGvyQhDL+NsBG/ZiYXv7qBHL+YwSG/FeUmv0rrK79W0zC/W5w1v4NFOr/9zT6//DRDv7x5R799m0u/hJlPvx9zU7+hJ1e/Y7Zav8YeXr8wYGG/D3pkv9hrZ78HNWq/H9Vsv6lLb783mHG/Yrpzv8mxdb8Wfne/9h55vyGUer9V3Xu/Wfp8v/rqfb8Or36/dEZ/vw+xf7/O7n+//////////////////////wAAAAAAAAAAKQApACkAUgBSAHsApADIAN4="),n(t,17674,"KQApACkAKQB7AHsAewCkAKQA8AAKARsBJwEpACkAKQApACkAKQApACkAewB7AHsAewDwAPAA8AAKAQoBMQE+AUgBUAF7AHsAewB7AHsAewB7AHsA8ADwAPAA8AAxATEBMQE+AT4BVwFfAWYBbAHwAPAA8ADwAPAA8ADwAPAAMQExATEBMQFXAVcBVwFfAV8BcgF4AX4BgwE="),n(t,17840,"KAcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcoDxccHyIkJicpKissLS4vLzEyMzQ1Njc3OTo7PD0+Pz9BQkNERUZHRygUISkwNTk9QEJFR0lLTE5QUlVXWVtcXmBiZWdpa2xucHJ1d3l7fH6AKBcnMzxDSU9TV1teYWRmaWtvc3Z5fH6Bg4eLjpGUlpmbn6OmqayusbMjHDFBTllja3J4foSIjZGVmZ+lq7C0ub3Ax83T2Nzh5ejv9fsVITpPYXB9iZSdpq62vcPJz9nj6/P7ESM/Vmp7i5ilsbvFztbe5u36GR83S1tpdYCKkpqhqK60ub7I0Nfe5evw9f8QJEFZboCQn625xM/Z4ury+gspSmeAl6y/0eHx/wkrT26Ko7rP4/YMJ0dje5CktsbW5PH9CSxRcY6owNbr/wcxWn+gv9z3BjNfhqrL6gcvV3ubuNTtBjRhia7Q8AU5apfA5wU7b57K8wU3Z5O74AU8caHO+ARBeq/gBEN/tuoAAAAAAAAAAODg4ODg4ODgoKCgoLm5ubKyqIY9JeDg4ODg4ODg8PDw8M/Pz8bGt5BCKKCgoKCgoKCgubm5ucHBwbe3rIpAJvDw8PDw8PDwz8/Pz8zMzMHBtI9CKLm5ubm5ubm5wcHBwcHBwbe3rIpBJ8/Pz8/Pz8/PzMzMzMnJyby8sI1CKMHBwcHBwcHBwcHBwcLCwri4rYtBJ8zMzMzMzMzMycnJycbGxru7r4xCKA=="),n(t,18418,"YADAACABgAEgAIAA4ABAAaABQACgAAABYAHAAQgAaADIACgBiAEoAIgA6ABIAagBSACoAAgBaAHIARAAcADQADABkAEwAJAA8ABQAbABUACwABABcAHQARgAeADYADgBmAE4AJgA+ABYAbgBWAC4ABgBeAHYAQQAZADEACQBhAEkAIQA5ABEAaQBRACkAAQBZAHEAQwAbADMACwBjAEsAIwA7ABMAawBTACsAAwBbAHMARQAdADUADQBlAE0AJQA9ABUAbQBVAC0ABQBdAHUARwAfADcADwBnAE8AJwA/ABcAbwBXAC8ABwBfAHcAQEAYQDBACEBgQEhAIEA4QBBAaEBQQChAAEBYQHBAQkAaQDJACkBiQEpAIkA6QBJAakBSQCpAAkBaQHJAREAcQDRADEBkQExAJEA8QBRAbEBUQCxABEBcQHRARkAeQDZADkBmQE5AJkA+QBZAbkBWQC5ABkBeQHZAQUAZQDFACUBhQElAIUA5QBFAaUBRQClAAUBZQHFAQ0AbQDNAC0BjQEtAI0A7QBNAa0BTQCtAA0BbQHNARUAdQDVADUBlQE1AJUA9QBVAbUBVQC1ABUBdQHVAR0AfQDdAD0BnQE9AJ0A/QBdAb0BXQC9AB0BfQHdAQIAYgDCACIBggEiAIIA4gBCAaIBQgCiAAIBYgHCAQoAagDKACoBigEqAIoA6gBKAaoBSgCqAAoBagHKARIAcgDSADIBkgEyAJIA8gBSAbIBUgCyABIBcgHSARoAegDaADoBmgE6AJoA+gBaAboBWgC6ABoBegHaAQYAZgDGACYBhgEmAIYA5gBGAaYBRgCmAAYBZgHGAQ4AbgDOAC4BjgEuAI4A7gBOAa4BTgCuAA4BbgHOARYAdgDWADYBlgE2AJYA9gBWAbYBVgC2ABYBdgHWAR4AfgDeAD4BngE+AJ4A/gBeAb4BXgC+AB4BfgHeAQMAYwDDACMBgwEjAIMA4wBDAaMBQwCjAAMBYwHDAQsAawDLACsBiwErAIsA6wBLAasBSwCrAAsBawHLARMAcwDTADMBkwEzAJMA8wBTAbMBUwCzABMBcwHTARsAewDbADsBmwE7AJsA+wBbAbsBWwC7ABsBewHbAQcAZwDHACcBhwEnAIcA5wBHAacBRwCnAAcBZwHHAQ8AbwDPAC8BjwEvAI8A7wBPAa8BTwCvAA8BbwHPARcAdwDXADcBlwE3AJcA9wBXAbcBVwC3ABcBdwHXAR8AfwDfAD8BnwE/AJ8A/wBfAb8BXwC/AB8BfwHfAQAAgD8AAACAY/p/P791VryL6X8/CnHWvHnNfz/nziC9L6Z/PzpeVr2vc38/E/KFvfk1fz8qr6C9Eu1+PzNlu739mH4/BBPWvbw5fj9zt/C9Vc99P6ioBb7LWX0/u+8SviXZfD9cMCC+Z018P/VpLb6Ytns/85s6vr4Uez/CxUe+4md6P83mVL4JsHk/gv5hvjzteD9NDG++hB94P5wPfL7qRnc/7oOEvndjdj8++oq+NnV1P3Vqkb4wfHQ/TNSXvnF4cz96N56+A2pyP7eTpL70UHE/vOiqvk8tcD9BNrG+If9uPwF8t752xm0/tLm9vl6DbD8V78O+5zVrP94byr4e3mk/yT/QvhJ8aD+SWta+1A9nP/Nr3L50mWU/qnPivgEZZD9xcei+jY5iPwdl7r4o+mA/J070vuZbXz+QLPq+17NdPwAAAL8PAlw/G+QCv6BGWj93wgW/noFYP/aaCL8ds1Y/d20LvzHbVD/aOQ6/7/lSPwAAEb9sD1E/yr8Tv70bTz8YeRa/+B5NP80rGb80GUs/ytcbv4gKST/xfB6/CvNGPyQbIb/R0kQ/RrIjv/epQj86Qia/k3hAP+PKKL+9Pj4/JUwrv4/8Oz/jxS2/IrI5PwE4ML+QXzc/ZaIyv/MENT/zBDW/ZaIyP5BfN78BODA/IrI5v+PFLT+P/Du/JUwrP70+Pr/jyig/k3hAvzpCJj/3qUK/RrIjP9HSRL8kGyE/CvNGv/F8Hj+ICkm/ytcbPzQZS7/NKxk/+B5Nvxh5Fj+9G0+/yr8TP2wPUb8AABE/7/lSv9o5Dj8x21S/d20LPx2zVr/2mgg/noFYv3fCBT+gRlq/G+QCPw8CXL8AAAA/17Ndv5As+j7mW1+/J070Pij6YL8HZe4+jY5iv3Fx6D4BGWS/qnPiPnSZZb/za9w+1A9nv5Ja1j4SfGi/yT/QPh7eab/eG8o+5zVrvxXvwz5eg2y/tLm9PnbGbb8BfLc+If9uv0E2sT5PLXC/vOiqPvRQcb+3k6Q+A2pyv3o3nj5xeHO/TNSXPjB8dL91apE+NnV1vz76ij53Y3a/7oOEPupGd7+cD3w+hB94v00Mbz487Xi/gv5hPgmweb/N5lQ+4md6v8LFRz6+FHu/85s6Ppi2e7/1aS0+Z018v1wwID4l2Xy/u+8SPstZfb+oqAU+Vc99v3O38D28OX6/BBPWPf2Yfr8zZbs9Eu1+vyqvoD35NX+/E/KFPa9zf786XlY9L6Z/v+fOID15zX+/CnHWPIvpf7+/dVY8Y/p/vwAwjSQAAIC/v3VWvGP6f78Kcda8i+l/v+fOIL15zX+/Ol5WvS+mf78T8oW9r3N/vyqvoL35NX+/M2W7vRLtfr8EE9a9/Zh+v3O38L28OX6/qKgFvlXPfb+77xK+y1l9v1wwIL4l2Xy/9WktvmdNfL/zmzq+mLZ7v8LFR76+FHu/zeZUvuJner+C/mG+CbB5v00Mb7487Xi/nA98voQfeL/ug4S+6kZ3vz76ir53Y3a/dWqRvjZ1db9M1Je+MHx0v3o3nr5xeHO/t5OkvgNqcr+86Kq+9FBxv0E2sb5PLXC/AXy3viH/br+0ub2+dsZtvxXvw75eg2y/3hvKvuc1a7/JP9C+Ht5pv5Ja1r4SfGi/82vcvtQPZ7+qc+K+dJllv3Fx6L4BGWS/B2Xuvo2OYr8nTvS+KPpgv5As+r7mW1+/AAAAv9ezXb8b5AK/DwJcv3fCBb+gRlq/9poIv56BWL93bQu/HbNWv9o5Dr8x21S/AAARv+/5Ur/KvxO/bA9Rvxh5Fr+9G0+/zSsZv/geTb/K1xu/NBlLv/F8Hr+ICkm/JBshvwrzRr9GsiO/0dJEvzpCJr/3qUK/48oov5N4QL8lTCu/vT4+v+PFLb+P/Du/ATgwvyKyOb9lojK/kF83v/MENb/zBDW/kF83v2WiMr8isjm/ATgwv4/8O7/jxS2/vT4+vyVMK7+TeEC/48oov/epQr86Qia/0dJEv0ayI78K80a/JBshv4gKSb/xfB6/NBlLv8rXG7/4Hk2/zSsZv70bT78YeRa/bA9Rv8q/E7/v+VK/AAARvzHbVL/aOQ6/HbNWv3dtC7+egVi/9poIv6BGWr93wgW/DwJcvxvkAr/Xs12/AAAAv+ZbX7+QLPq+KPpgvydO9L6NjmK/B2XuvgEZZL9xcei+dJllv6pz4r7UD2e/82vcvhJ8aL+SWta+Ht5pv8k/0L7nNWu/3hvKvl6DbL8V78O+dsZtv7S5vb4h/26/AXy3vk8tcL9BNrG+9FBxv7zoqr4DanK/t5OkvnF4c796N56+MHx0v0zUl742dXW/dWqRvndjdr8++oq+6kZ3v+6DhL6EH3i/nA98vjzteL9NDG++CbB5v4L+Yb7iZ3q/zeZUvr4Ue7/CxUe+mLZ7v/ObOr5nTXy/9WktviXZfL9cMCC+y1l9v7vvEr5Vz32/qKgFvrw5fr9zt/C9/Zh+vwQT1r0S7X6/M2W7vfk1f78qr6C9r3N/vxPyhb0vpn+/Ol5WvXnNf7/nziC9i+l/vwpx1rxj+n+/v3VWvAAAgL8AMA2lY/p/v791VjyL6X+/CnHWPHnNf7/nziA9L6Z/vzpeVj2vc3+/E/KFPfk1f78qr6A9Eu1+vzNluz39mH6/BBPWPbw5fr9zt/A9Vc99v6ioBT7LWX2/u+8SPiXZfL9cMCA+Z018v/VpLT6Ytnu/85s6Pr4Ue7/CxUc+4md6v83mVD4JsHm/gv5hPjzteL9NDG8+hB94v5wPfD7qRne/7oOEPndjdr8++oo+NnV1v3VqkT4wfHS/TNSXPnF4c796N54+A2pyv7eTpD70UHG/vOiqPk8tcL9BNrE+If9uvwF8tz52xm2/tLm9Pl6DbL8V78M+5zVrv94byj4e3mm/yT/QPhJ8aL+SWtY+1A9nv/Nr3D50mWW/qnPiPgEZZL9xceg+jY5ivwdl7j4o+mC/J070PuZbX7+QLPo+17NdvwAAAD8PAly/G+QCP6BGWr93wgU/noFYv/aaCD8ds1a/d20LPzHbVL/aOQ4/7/lSvwAAET9sD1G/yr8TP70bT78YeRY/+B5Nv80rGT80GUu/ytcbP4gKSb/xfB4/CvNGvyQbIT/R0kS/RrIjP/epQr86QiY/k3hAv+PKKD+9Pj6/JUwrP4/8O7/jxS0/IrI5vwE4MD+QXze/ZaIyP/MENb/zBDU/ZaIyv5BfNz8BODC/IrI5P+PFLb+P/Ds/JUwrv70+Pj/jyii/k3hAPzpCJr/3qUI/RrIjv9HSRD8kGyG/CvNGP/F8Hr+ICkk/ytcbvzQZSz/NKxm/+B5NPxh5Fr+9G08/yr8Tv2wPUT8AABG/7/lSP9o5Dr8x21Q/d20Lvx2zVj/2mgi/noFYP3fCBb+gRlo/G+QCvw8CXD8AAAC/17NdP5As+r7mW18/J070vij6YD8HZe6+jY5iP3Fx6L4BGWQ/qnPivnSZZT/za9y+1A9nP5Ja1r4SfGg/yT/Qvh7eaT/eG8q+5zVrPxXvw75eg2w/tLm9vnbGbT8BfLe+If9uP0E2sb5PLXA/vOiqvvRQcT+3k6S+A2pyP3o3nr5xeHM/TNSXvjB8dD91apG+NnV1Pz76ir53Y3Y/7oOEvupGdz+cD3y+hB94P00Mb7487Xg/gv5hvgmweT/N5lS+4md6P8LFR76+FHs/85s6vpi2ez/1aS2+Z018P1wwIL4l2Xw/u+8SvstZfT+oqAW+Vc99P3O38L28OX4/BBPWvf2Yfj8zZbu9Eu1+PyqvoL35NX8/E/KFva9zfz86Xla9L6Z/P+fOIL15zX8/CnHWvIvpfz+/dVa8Y/p/PwDIU6UAAIA/v3VWPGP6fz8KcdY8i+l/P+fOID15zX8/Ol5WPS+mfz8T8oU9r3N/PyqvoD35NX8/M2W7PRLtfj8EE9Y9/Zh+P3O38D28OX4/qKgFPlXPfT+77xI+y1l9P1wwID4l2Xw/9WktPmdNfD/zmzo+mLZ7P8LFRz6+FHs/zeZUPuJnej+C/mE+CbB5P00Mbz487Xg/nA98PoQfeD/ug4Q+6kZ3Pz76ij53Y3Y/dWqRPjZ1dT9M1Jc+MHx0P3o3nj5xeHM/t5OkPgNqcj+86Ko+9FBxP0E2sT5PLXA/AXy3PiH/bj+0ub0+dsZtPxXvwz5eg2w/3hvKPuc1az/JP9A+Ht5pP5Ja1j4SfGg/82vcPtQPZz+qc+I+dJllP3Fx6D4BGWQ/B2XuPo2OYj8nTvQ+KPpgP5As+j7mW18/AAAAP9ezXT8b5AI/DwJcP3fCBT+gRlo/9poIP56BWD93bQs/HbNWP9o5Dj8x21Q/AAARP+/5Uj/KvxM/bA9RPxh5Fj+9G08/zSsZP/geTT/K1xs/NBlLP/F8Hj+ICkk/JBshPwrzRj9GsiM/0dJEPzpCJj/3qUI/48ooP5N4QD8lTCs/vT4+P+PFLT+P/Ds/ATgwPyKyOT9lojI/kF83P/MENT/zBDU/kF83P2WiMj8isjk/ATgwP4/8Oz/jxS0/vT4+PyVMKz+TeEA/48ooP/epQj86QiY/0dJEP0ayIz8K80Y/JBshP4gKST/xfB4/NBlLP8rXGz/4Hk0/zSsZP70bTz8YeRY/bA9RP8q/Ez/v+VI/AAARPzHbVD/aOQ4/HbNWP3dtCz+egVg/9poIP6BGWj93wgU/DwJcPxvkAj/Xs10/AAAAP+ZbXz+QLPo+KPpgPydO9D6NjmI/B2XuPgEZZD9xceg+dJllP6pz4j7UD2c/82vcPhJ8aD+SWtY+Ht5pP8k/0D7nNWs/3hvKPl6DbD8V78M+dsZtP7S5vT4h/24/AXy3Pk8tcD9BNrE+9FBxP7zoqj4DanI/t5OkPnF4cz96N54+MHx0P0zUlz42dXU/dWqRPndjdj8++oo+6kZ3P+6DhD6EH3g/nA98PjzteD9NDG8+CbB5P4L+YT7iZ3o/zeZUPr4Uez/CxUc+mLZ7P/ObOj5nTXw/9WktPiXZfD9cMCA+y1l9P7vvEj5Vz30/qKgFPrw5fj9zt/A9/Zh+PwQT1j0S7X4/M2W7Pfk1fz8qr6A9r3N/PxPyhT0vpn8/Ol5WPXnNfz/nziA9i+l/Pwpx1jxj+n8/v3VWPAAAMABgAJAAwAAQAEAAcACgANAAIABQAIAAsADgAAQANABkAJQAxAAUAEQAdACkANQAJABUAIQAtADkAAgAOABoAJgAyAAYAEgAeACoANgAKABYAIgAuADoAAwAPABsAJwAzAAcAEwAfACsANwALABcAIwAvADsAAEAMQBhAJEAwQARAEEAcQChANEAIQBRAIEAsQDhAAUANQBlAJUAxQAVAEUAdQClANUAJQBVAIUAtQDlAAkAOQBpAJkAyQAZAEkAeQCpANkAKQBZAIkAuQDpAA0APQBtAJ0AzQAdAE0AfQCtAN0ALQBdAI0AvQDtAAIAMgBiAJIAwgASAEIAcgCiANIAIgBSAIIAsgDiAAYANgBmAJYAxgAWAEYAdgCmANYAJgBWAIYAtgDmAAoAOgBqAJoAygAaAEoAegCqANoAKgBaAIoAugDqAA4APgBuAJ4AzgAeAE4AfgCuAN4ALgBeAI4AvgDuAAMAMwBjAJMAwwATAEMAcwCjANMAIwBTAIMAswDjAAcANwBnAJcAxwAXAEcAdwCnANcAJwBXAIcAtwDnAAsAOwBrAJsAywAbAEsAewCrANsAKwBbAIsAuwDrAA8APwBvAJ8AzwAfAE8AfwCvAN8ALwBfAI8AvwDvAPAAAACJiIg7AQAAAAUAMAADABAABAAEAAQAAQ=="),n(t,23740,"sFoAALBL"),n(t,23762,"GAAwAEgAYAAIACAAOABQAGgAEAAoAEAAWABwAAQAHAA0AEwAZAAMACQAPABUAGwAFAAsAEQAXAB0AAEAGQAxAEkAYQAJACEAOQBRAGkAEQApAEEAWQBxAAUAHQA1AE0AZQANACUAPQBVAG0AFQAtAEUAXQB1AAIAGgAyAEoAYgAKACIAOgBSAGoAEgAqAEIAWgByAAYAHgA2AE4AZgAOACYAPgBWAG4AFgAuAEYAXgB2AAMAGwAzAEsAYwALACMAOwBTAGsAEwArAEMAWwBzAAcAHwA3AE8AZwAPACcAPwBXAG8AFwAvAEcAXwB3AHgAAACIiAg8AgAAAAUAGAADAAgAAgAEAAQAAQ=="),n(t,24044,"0FwAALBL"),n(t,24066,"DAAYACQAMAAEABAAHAAoADQACAAUACAALAA4AAEADQAZACUAMQAFABEAHQApADUACQAVACEALQA5AAIADgAaACYAMgAGABIAHgAqADYACgAWACIALgA6AAMADwAbACcAMwAHABMAHwArADcACwAXACMALwA7ADwAAACJiIg8AwAAAAUADAADAAQABAAB"),n(t,24229,"XgAAsEsAAAAAAACViwAAN5gAAP+lAAAEtQAAZ8UAAEXXAADB6gAA//8AAGNlbHQvbGFwbGFjZS5jAGFzc2VydGlvbiBmYWlsZWQ6IGZsPDMyNzY4AGFzc2VydGlvbiBmYWlsZWQ6IGZsPD1mbQBhc3NlcnRpb24gZmFpbGVkOiBmbTxJTUlOKGZsK2ZzLDMyNzY4KQ=="),n(t,24386,"zkAAAMhAAAC4QAAAqkAAAKJAAACaQAAAkEAAAIxAAACcQAAAlkAAAJJAAACOQAAAnEAAAJRAAACKQAAAkEAAAIxAAACUQAAAmEAAAI5AAABwQAAAcEAAAHBAAABwQAAAcEA="),n(t,24496,"SH9BgUKAQYBAgD6AQIBAgFxOXE9cTlpPdClzKHIohBqEGpERoQywCrELGLMwijaHNoQ1hjiFN4Q3hD1yRmBKWEtYV0pZQltDZDtsMngoeiVhK04yU05UUVhLVkpXR1pJXUpdSm0ociR1InUijxGREpITogylCrIHvQa+CLEJF7I2cz9mQmJFY0pZR1tJW05ZVlBcQl1AZjtnPGg8dTR7LIojhR9hJk0tPVpdPGkqayluLXQmcSZwJnwahBuIE4wUmw6fEJ4Sqg2xCrsIwAavCZ8KFbI7bkdWS1VUU1tCWElXSFxLYkhpOms2czRyN3A4gTOEKJYhjB1iI00qKnlgQmwrbyh1LHsgeCR3IX8hhiKLFZMXmBSeGZoaphWtELgNuAqWDYsPFrI/ckpSVFNcUmc+YEhgQ2VJa0hxN3Y0fTR2NHU3hzGJJ50gkR1hIU0oAABmPwAATD8AACY/AAAAPwCGaz8AFC4/AHC9PgDQTD4CAQ=="),n(t,24881,"CA0QExUXGBobHB0eHyAgISIiIyQkJSVhc3NlcnRpb24gZmFpbGVkOiBjb2RlZEJhbmRzID4gc3RhcnQAY2VsdC9yYXRlLmMAYXNzZXJ0aW9uIGZhaWxlZDogYml0c1tqXSA+PSAwAGFzc2VydGlvbiBmYWlsZWQ6IGViaXRzW2pdID49IDAAYXNzZXJ0aW9uIGZhaWxlZDogQyplYml0c1tqXTw8QklUUkVTID09IGJpdHNbal0="),n(t,25078,"4D8AAAAAAADgvwMAAAAEAAAABAAAAAYAAACD+aIARE5uAPwpFQDRVycA3TT1AGLbwAA8mZUAQZBDAGNR/gC73qsAt2HFADpuJADSTUIASQbgAAnqLgAcktEA6x3+ACmxHADoPqcA9TWCAES7LgCc6YQAtCZwAEF+XwDWkTkAU4M5AJz0OQCLX4QAKPm9APgfOwDe/5cAD5gFABEv7wAKWosAbR9tAM9+NgAJyycARk+3AJ5mPwAt6l8Auid1AOXrxwA9e/EA9zkHAJJSigD7a+oAH7FfAAhdjQAwA1YAe/xGAPCrawAgvM8ANvSaAOOpHQBeYZEACBvmAIWZZQCgFF8AjUBoAIDY/wAnc00ABgYxAMpWFQDJqHMAe+JgAGuMwAAZxEcAzWfDAAno3ABZgyoAi3bEAKYclgBEr90AGVfRAKU+BQAFB/8AM34/AMIy6ACYT94Au30yACY9wwAea+8An/heADUfOgB/8soA8YcdAHyQIQBqJHwA1W76ADAtdwAVO0MAtRTGAMMZnQCtxMIALE1BAAwAXQCGfUYA43EtAJvGmgAzYgAAtNJ8ALSnlwA3VdUA1z72AKMQGABNdvwAZJ0qAHDXqwBjfPgAerBXABcV5wDASVYAO9bZAKeEOAAkI8sA1op3AFpUIwAAH7kA8QobABnO3wCfMf8AZh5qAJlXYQCs+0cAfn/YACJltwAy6IkA5r9gAO/EzQBsNgkAXT/UABbe1wBYO94A3puSANIiKAAohugA4lhNAMbKMgAI4xYA4H3LABfAUADzHacAGOBbAC4TNACDEmIAg0gBAPWOWwCtsH8AHunyAEhKQwAQZ9MAqt3YAK5fQgBqYc4ACiikANOZtAAGpvIAXHd/AKPCgwBhPIgAinN4AK+MWgBv170ALaZjAPS/ywCNge8AJsFnAFXKRQDK2TYAKKjSAMJhjQASyXcABCYUABJGmwDEWcQAyMVEAE2ykQAAF/MA1EOtAClJ5QD91RAAAL78AB6UzABwzu4AEz71AOzxgACz58MAx/goAJMFlADBcT4ALgmzAAtF8wCIEpwAqyB7AC61nwBHksIAezIvAAxVbQByp5AAa+cfADHLlgB5FkoAQXniAPTfiQDolJcA4uaEAJkxlwCI7WsAX182ALv9DgBImrQAZ6RsAHFyQgCNXTIAnxW4ALzlCQCNMSUA93Q5ADAFHAANDAEASwhoACzuWABHqpAAdOcCAL3WJAD3faYAbkhyAJ8W7wCOlKYAtJH2ANFTUQDPCvIAIJgzAPVLfgCyY2gA3T5fAEBdAwCFiX8AVVIpADdkwABt2BAAMkgyAFtMdQBOcdQARVRuAAsJwQAq9WkAFGbVACcHnQBdBFAAtDvbAOp2xQCH+RcASWt9AB0nugCWaSkAxsysAK0UVACQ4moAiNmJACxyUAAEpL4AdweUAPMwcAAA/CcA6nGoAGbCSQBk4D0Al92DAKM/lwBDlP0ADYaMADFB3gCSOZ0A3XCMABe35wAI3zsAFTcrAFyAoABagJMAEBGSAA/o2ABsgK8A2/9LADiQDwBZGHYAYqUVAGHLuwDHibkAEEC9ANLyBABJdScA67b2ANsiuwAKFKoAiSYvAGSDdgAJOzMADpQaAFE6qgAdo8IAr+2uAFwmEgBtwk0ALXqcAMBWlwADP4MACfD2ACtAjABtMZkAObQHAAwgFQDYw1sA9ZLEAMatSwBOyqUApzfNAOapNgCrkpQA3UJoABlj3gB2jO8AaItSAPzbNwCuoasA3xUxAACuoQAM+9oAZE1mAO0FtwApZTAAV1a/AEf/OgBq+bkAdb7zACiT3wCrgDAAZoz2AATLFQD6IgYA2eQdAD2zpABXG48ANs0JAE5C6QATvqQAMyO1APCqGgBPZagA0sGlAAs/DwBbeM0AI/l2AHuLBACJF3IAxqZTAG9u4gDv6wAAm0pYAMTatwCqZroAds/PANECHQCx8S0AjJnBAMOtdwCGSNoA912gAMaA9ACs8C8A3eyaAD9cvADQ3m0AkMcfACrbtgCjJToAAK+aAK1TkwC2VwQAKS20AEuAfgDaB6cAdqoOAHtZoQAWEioA3LctAPrl/QCJ2/4Aib79AOR2bAAGqfwAPoBwAIVuFQD9h/8AKD4HAGFnMwAqGIYATb3qALPnrwCPbW4AlWc5ADG/WwCE10gAMN8WAMctQwAlYTUAyXDOADDLuAC/bP0ApACiAAVs5ABa3aAAIW9HAGIS0gC5XIQAcGFJAGtW4ACZUgEAUFU3AB7VtwAz8cQAE25fAF0w5ACFLqkAHbLDAKEyNgAIt6QA6rHUABb3IQCPaeQAJ/93AAwDgACNQC0AT82gACClmQCzotMAL10KALT5QgAR2ssAfb7QAJvbwQCrF70AyqKBAAhqXAAuVRcAJwBVAH8U8ADhB4YAFAtkAJZBjQCHvt4A2v0qAGsltgB7iTQABfP+ALm/ngBoak8ASiqoAE/EWgAt+LwA11qYAPTHlQANTY0AIDqmAKRXXwAUP7EAgDiVAMwgAQBx3YYAyd62AL9g9QBNZREAAQdrAIywrACywNAAUVVIAB77DgCVcsMAowY7AMBANQAG3HsA4EXMAE4p+gDWysgA6PNBAHxk3gCbZNgA2b4xAKSXwwB3WNQAaePFAPDaEwC6OjwARhhGAFV1XwDSvfUAbpLGAKwuXQAORO0AHD5CAGHEhwAp/ekA59bzACJ8ygBvkTUACODFAP/XjQBuauIAsP3GAJMIwQB8XXQAa62yAM1unQA+cnsAxhFqAPfPqQApc98Atcm6ALcAUQDisg0AdLokAOV9YAB02IoADRUsAIEYDAB+ZpQAASkWAJ96dgD9/b4AVkXvANl+NgDs2RMAi7q5AMSX/AAxqCcA8W7DAJTFNgDYqFYAtKi1AM/MDgASiS0Ab1c0ACxWiQCZzuMA1iC5AGteqgA+KpwAEV/MAP0LSgDh9PsAjjttAOKGLADp1IQA/LSpAO/u0QAuNckALzlhADghRAAb2cgAgfwKAPtKagAvHNgAU7SEAE6ZjABUIswAKlXcAMDG1gALGZYAGnC4AGmVZAAmWmAAP1LuAH8RDwD0tREA/Mv1ADS8LQA0vO4A6F3MAN1eYABnjpsAkjPvAMkXuABhWJsA4Ve8AFGDxgDYPhAA3XFIAC0c3QCvGKEAISxGAFnz1wDZepgAnlTAAE+G+gBWBvwA5XmuAIkiNgA4rSIAZ5PcAFXoqgCCJjgAyuebAFENpACZM7EAqdcOAGkFSABlsvAAf4inAIhMlwD50TYAIZKzAHuCSgCYzyEAQJ/cANxHVQDhdDoAZ+tCAP6d3wBe1F8Ae2ekALqsegBV9qIAK4gjAEG6VQBZbggAISqGADlHgwCJ4+YA5Z7UAEn7QAD/VukAHA/KAMVZigCU+isA08HFAA/FzwDbWq4AR8WGAIVDYgAhhjsALHmUABBhhwAqTHsAgCwaAEO/EgCIJpAAeDyJAKjE5ADl23sAxDrCACb06gD3Z4oADZK/AGWjKwA9k7EAvXwLAKRR3AAn3WMAaeHdAJqUGQCoKZUAaM4oAAnttABEnyAATpjKAHCCYwB+fCMAD7kyAKf1jgAUVucAIfEIALWdKgBvfk0ApRlRALX5qwCC39YAlt1hABY2AgDEOp8Ag6KhAHLtbQA5jXoAgripAGsyXABGJ1sAADTtANIAdwD89FUAAVlNAOBxgA=="),n(t,27875,"QPsh+T8AAAAALUR0PgAAAICYRvg8AAAAYFHMeDsAAACAgxvwOQAAAEAgJXo4AAAAgCKC4zYAAAAAHfNpNWFzc2VydGlvbiBmYWlsZWQ6IF9rPjAAY2VsdC9jd3JzLmM="),n(t,27984,"sG0AAHBwAAAscwAA5HUAAJh4AABIewAA9H0AAFx/AAAYgAAAjIAAANiAAAAQgQAAMIEAAEiBAABUgQAAYXNzZXJ0aW9uIGZhaWxlZDogX24+PTI="),n(t,28080,"AQ=="),n(t,28788,"AQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAADAAAABQAAAAcAAAAJAAAACwAAAA0AAAAPAAAAEQAAABMAAAAVAAAAFwAAABkAAAAbAAAAHQAAAB8AAAAhAAAAIwAAACUAAAAnAAAAKQAAACsAAAAtAAAALwAAADEAAAAzAAAANQAAADcAAAA5AAAAOwAAAD0AAAA/AAAAQQAAAEMAAABFAAAARwAAAEkAAABLAAAATQAAAE8AAABRAAAAUwAAAFUAAABXAAAAWQAAAFsAAABdAAAAXwAAAGEAAABjAAAAZQAAAGcAAABpAAAAawAAAG0AAABvAAAAcQAAAHMAAAB1AAAAdwAAAHkAAAB7AAAAfQAAAH8AAACBAAAAgwAAAIUAAACHAAAAiQAAAIsAAACNAAAAjwAAAJEAAACTAAAAlQAAAJcAAACZAAAAmwAAAJ0AAACfAAAAoQAAAKMAAAClAAAApwAAAKkAAACrAAAArQAAAK8AAACxAAAAswAAALUAAAC3AAAAuQAAALsAAAC9AAAAvwAAAMEAAADDAAAAxQAAAMcAAADJAAAAywAAAM0AAADPAAAA0QAAANMAAADVAAAA1wAAANkAAADbAAAA3QAAAN8AAADhAAAA4wAAAOUAAADnAAAA6QAAAOsAAADtAAAA7wAAAPEAAADzAAAA9QAAAPcAAAD5AAAA+wAAAP0AAAD/AAAAAQEAAAMBAAAFAQAABwEAAAkBAAALAQAADQEAAA8BAAARAQAAEwEAABUBAAAXAQAAGQEAABsBAAAdAQAAHwEAACEBAAAjAQAAJQEAACcBAAApAQAAKwEAAC0BAAAvAQAAMQEAADMBAAA1AQAANwEAADkBAAA7AQAAPQEAAD8BAABBAQAAQwEAAEUBAABHAQAASQEAAEsBAABNAQAATwEAAFEBAABTAQAAVQEAAFcBAABZAQAAWwEAAF0BAABfAQAADQAAABkAAAApAAAAPQAAAFUAAABxAAAAkQAAALUAAADdAAAACQEAADkBAABtAQAApQEAAOEBAAAhAgAAZQIAAK0CAAD5AgAASQMAAJ0DAAD1AwAAUQQAALEEAAAVBQAAfQUAAOkFAABZBgAAzQYAAEUHAADBBwAAQQgAAMUIAABNCQAA2QkAAGkKAAD9CgAAlQsAADEMAADRDAAAdQ0AAB0OAADJDgAAeQ8AAC0QAADlEAAAoREAAGESAAAlEwAA7RMAALkUAACJFQAAXRYAADUXAAARGAAA8RgAANUZAAC9GgAAqRsAAJkcAACNHQAAhR4AAIEfAACBIAAAhSEAAI0iAACZIwAAqSQAAL0lAADVJgAA8ScAABEpAAA1KgAAXSsAAIksAAC5LQAA7S4AACUwAABhMQAAoTIAAOUzAAAtNQAAeTYAAMk3AAAdOQAAdToAANE7AAAxPQAAlT4AAP0/AABpQQAA2UIAAE1EAADFRQAAQUcAAMFIAABFSgAAzUsAAFlNAADpTgAAfVAAABVSAACxUwAAUVUAAPVWAACdWAAASVoAAPlbAACtXQAAZV8AACFhAADhYgAApWQAAG1mAAA5aAAACWoAAN1rAAC1bQAAkW8AAHFxAABVcwAAPXUAACl3AAAZeQAADXsAAAV9AAABfwAAAYEAAAWDAAANhQAAGYcAACmJAAA9iwAAVY0AAHGPAACRkQAAtZMAAN2VAAAJmAAAOZoAAG2cAAClngAA4aAAACGjAABlpQAAracAAPmpAABJrAAAna4AAPWwAABRswAAsbUAABW4AAB9ugAA6bwAAFm/AADNwQAARcQAAMHGAABByQAAxcsAAE3OAADZ0AAAadMAAP3VAACV2AAAMdsAANHdAAB14AAAHeMAAMnlAAB56AAALesAAOXtAACh8AAAPwAAAIEAAADnAAAAeQEAAD8CAABBAwAAhwQAABkGAAD/BwAAQQoAAOcMAAD5DwAAfxMAAIEXAAAHHAAAGSEAAL8mAAABLQAA5zMAAHk7AAC/QwAAwUwAAIdWAAAZYQAAf2wAAMF4AADnhQAA+ZMAAP+iAAABswAAB8QAABnWAAA/6QAAgf0AAOcSAQB5KQEAP0EBAEFaAQCHdAEAGZABAP+sAQBBywEA5+oBAPkLAgB/LgIAgVICAAd4AgAZnwIAv8cCAAHyAgDnHQMAeUsDAL96AwDBqwMAh94DABkTBAB/SQQAwYEEAOe7BAD59wQA/zUFAAF2BQAHuAUAGfwFAD9CBgCBigYA59QGAHkhBwA/cAcAQcEHAIcUCAAZaggA/8EIAEEcCQDneAkA+dcJAH85CgCBnQoABwQLABltCwC/2AsAAUcMAOe3DAB5Kw0Av6ENAMEaDgCHlg4AGRUPAH+WDwDBGhAA56EQAPkrEQD/uBEAAUkSAAfcEgAZchMAPwsUAIGnFADnRhUAeekVAD+PFgBBOBcAh+QXABmUGAD/RhkAQf0ZAOe2GgD5cxsAfzQcAIH4HAAHwB0AGYseAL9ZHwABLCAA5wEhAHnbIQC/uCIAwZkjAId+JAAZZyUAf1MmAMFDJwDnNygA+S8pAP8rKgABLCsABzAsABk4LQA/RC4AgVQvAOdoMAB5gTEAP54yAEG/MwCH5DQAGQ42AP87NwBBbjgA56Q5APnfOgB/HzwAgWM9AAesPgAZ+T8Av0pBAAGhQgDn+0MAeVtFAL+/RgDBKEgAh5ZJABkJSwB/gEwAwfxNAOd9TwD5A1EA/45SAAEfVAAHtFUAGU5XAD/tWACBkVoA5zpcAHnpXQA/nV8AQVZhAIcUYwAZ2GQA/6BmAEFvaADnQmoA+RtsAH/6bQBBAQAAqQIAAAkFAADBCAAAQQ4AAAkWAACpIAAAwS4AAAFBAAApWAAACXUAAIGYAACBwwAACfcAACk0AQABfAEAwc8BAKkwAgAJoAIAQR8DAMGvAwAJUwQAqQoFAEHYBQCBvQYAKbwHAAnWCAABDQoAAWMLAAnaDAApdA4AgTMQAEEaEgCpKhQACWcWAMHRGABBbRsACTweAKlAIQDBfSQAAfYnACmsKwAJoy8Agd0zAIFeOAAJKT0AKUBCAAGnRwDBYE0AqXBTAAnaWQBBoGAAwcZnAAlRbwCpQncAQZ9/AIFqiAApqJEACVybAAGKpQABNrAACWS7ACkYxwCBVtMAQSPgAKmC7QAJefsAwQoKAUE8GQEJEikBqZA5AcG8SgEBm1wBKTBvAQmBggGBkpYBgWmrAQkLwQEpfNcBAcLuAcHhBgKp4B8CCcQ5AkGRVALBTXACCf+MAqmqqgJBVskCgQfpAinECQMJkisDAXdOAwF5cgMJnpcDKey9A4Fp5QNBHA4EqQo4BAk7YwTBs48EQXu9BAmY7ASpEB0FwetOBQEwggUp5LYFCQ/tBYG3JAaB5F0GCZ2YBino1AYBzRIHwVJSB6mAkwcJXtYHQfIaCMFEYQgJXakIqULzCEH9PgmBlIwJKRDcCQl4LQoB1IAKASzWCgmILQsp8IYLgWziC0EFQAypwp8MCa0BDcHMZQ1BKswNCc40DqnAnw7BCg0PAbV8DynI7g8JTWMQgUzaEIHPUxEJ388RKYROEgHIzxLBs1MTqVDaEwmoYxRBw+8Uwat+FQlrEBapCqUWQZQ8F4ER1xcpjHQYCQ4VGQGhuBkBT18aCSIJGykkthuBX2YcQd4ZHamq0B0Jz4oewVVIH0FJCSAJtM0gqaCVIcEZYSIBKjAjKdwCJAk72SSBUbMlkwYAAEUOAAAPHAAAETMAAFtXAAANjgAAd90AADlNAQBj5gEAlbMCAB/BAwAhHQUAq9cGAN0CCQAHswsAyf4OADP/EgDlzxcAL48dADFeJAD7YCwArb41AJehQABZN00AA7FbADVDbAA/Jn8AQZaUAEvTrAB9IcgAJ8nmAOkWCQHTWy8Bhe1ZAU8miQFRZb0Bmw73AU2LNgK3SXwCeb3IAqNfHAPVrncDXy/bA2FrRwTr8rwEHVw8BUdDxgUJS1sGcxz8BiVnqQdv4WMIcUgsCTtgAwrt8+kK19XgC5nf6AxD8gIOdfYvD3/ccBCBnMYRizYyE72ytBRnIU8WKZsCGBNB0BnFPLkbj8C+HZEH4h/bVSQijfiGJPdFCye5nbIp42h+LBUacC+fLYkyoSnLNSueNzldJdA8h2OWQEkHjESzybJIZW4MTa/DmlGxol9We+9cWy2ZlGAXmghm2fe6a4PDrXG1GeN3vyJdfh0jAABxTQAAkZwAAP0mAQBlDAIA6XcDAJmiBQA11ggALXANAOHkEwAhwxwA7bcoAHWSOABZSE0AKfpnACX4iQA9x7QAUSbqALETLAHd0nwBhfLeAclSVQK5K+MCFRSMA00IVATBcT8FQS5TBs2XlAeVjAkJOXe4CklXqAwFyuAOXRNqETEnTRTRspMXvSZIG6XAdR+plSgk2ZxtKfW5Ui9tyOY1oaY5PWFBXEWtn2BOte5ZWBmOXGNpHH5v5YPVfP+9AAABqAEAj2sDAPGeBgA/IwwAwT0VAI+2IwDx/DkA/1FbAAH6iwAPddEAcb8yAT+auAHB3G0CD89fA3GOngT/ez0GAbZTCI+c/ArxYVgOP6eMEsElxRePZTQe8YEUJv/7py8BnDo7D2IiSXGGwFk/ioJtwVjjhAEOBACRIQkAESwTAEHuJQBBT0cAkUOAABH33QABRnMBAZJaAhEBuAORNbwFQY+nCEEGzgwRspsSkQ+aGgEadiUBTAc0kZ5XRxGdrGBBppGBI1EWAMWeMgAXuWsAmfbYAGuJoAENxP4CHwFQBSHZHQkzbDAP1aKkGKdnCCcp/X08e7XnWx13HYmvoC3JrY57AInmGQE5ll4CPRbYBLVjdwnhKMYRIQM0IHVIgjh9V1dgv1uvAoHYJwb3hF4N6f6tG3+L6zaBt+VoFwOcwcEM/w45aoUiGe6RS4F4K54z4QlUYXNzZXJ0aW9uIGZhaWxlZDogX24+MQAADwAAAAoAAAAFAAAAYXNzZXJ0aW9uIGZhaWxlZDogSz4wCmFsZ19xdWFudCgpIG5lZWRzIGF0IGxlYXN0IG9uZSBwdWxzZQBjZWx0L3ZxLmMAYXNzZXJ0aW9uIGZhaWxlZDogTj4xCmFsZ19xdWFudCgpIG5lZWRzIGF0IGxlYXN0IHR3byBkaW1lbnNpb25zAGFzc2VydGlvbiBmYWlsZWQ6IEs+MAphbGdfdW5xdWFudCgpIG5lZWRzIGF0IGxlYXN0IG9uZSBwdWxzZQBhc3NlcnRpb24gZmFpbGVkOiBOPjEKYWxnX3VucXVhbnQoKSBuZWVkcyBhdCBsZWFzdCB0d28gZGltZW5zaW9ucwBhc3NlcnRpb24gZmFpbGVkOiBzdGFydCA8PSBlbmQAY2VsdC9iYW5kcy5jAGFzc2VydGlvbiBmYWlsZWQ6IE4gPiAwAAAAAAAAAQEBAgMDAwIDAwMCAwMDAAMMDzAzPD/Aw8zP8PP8/2Fzc2VydGlvbiBmYWlsZWQ6IHN0cmlkZT4wAAAAAAAAAQAAAAAAAAADAAAAAAAAAAIAAAABAAAABwAAAAAAAAAEAAAAAwAAAAYAAAABAAAABQAAAAIAAAAPAAAAAAAAAAgAAAAHAAAADAAAAAMAAAALAAAABAAAAA4AAAABAAAACQAAAAYAAAANAAAAAgAAAAoAAAAFAAAAYXNzZXJ0aW9uIGZhaWxlZDogaXRoZXRhPj0w"),n(t,33761,"QMpFG0z/UoJas2Kia2B1YXNzZXJ0aW9uIGZhaWxlZDogcW4gPD0gMjU2AGFzc2VydGlvbiBmYWlsZWQ6IHggIT0geQBjZWx0L2NlbHRfbHBjLmMAYXNzZXJ0aW9uIGZhaWxlZDogKG9yZCYzKT09MABhc3NlcnRpb24gZmFpbGVkOiBuPjAAYXNzZXJ0aW9uIGZhaWxlZDogb3ZlcmxhcD49MABhc3NlcnRpb24gZmFpbGVkOiBsZW4+PTMALi9jZWx0L3BpdGNoLmgAYXNzZXJ0aW9uIGZhaWxlZDogbWF4X3BpdGNoPjAAY2VsdC9waXRjaC5jAGFzc2VydGlvbiBmYWlsZWQ6IGxlbj4wAGFzc2VydGlvbiBmYWlsZWQ6IGxlbj49MwAuL2NlbHQvcGl0Y2guaABjZWx0L2tpc3NfZmZ0LmMAYXNzZXJ0aW9uIGZhaWxlZDogbT09NABhc3NlcnRpb24gZmFpbGVkOiBzdC0+bW9kZSA9PSBvcHVzX2N1c3RvbV9tb2RlX2NyZWF0ZSg0ODAwMCwgOTYwLCBOVUxMKQBjZWx0L2NlbHRfZGVjb2Rlci5jAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5vdmVybGFwID09IDEyMABhc3NlcnRpb24gZmFpbGVkOiBzdC0+Y2hhbm5lbHMgPT0gMSB8fCBzdC0+Y2hhbm5lbHMgPT0gMgBhc3NlcnRpb24gZmFpbGVkOiBzdC0+c3RyZWFtX2NoYW5uZWxzID09IDEgfHwgc3QtPnN0cmVhbV9jaGFubmVscyA9PSAyAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5kb3duc2FtcGxlID4gMABhc3NlcnRpb24gZmFpbGVkOiBzdC0+c3RhcnQgPT0gMCB8fCBzdC0+c3RhcnQgPT0gMTcAYXNzZXJ0aW9uIGZhaWxlZDogc3QtPnN0YXJ0IDwgc3QtPmVuZABhc3NlcnRpb24gZmFpbGVkOiBzdC0+ZW5kIDw9IDIxAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5hcmNoID49IDAAYXNzZXJ0aW9uIGZhaWxlZDogc3QtPmFyY2ggPD0gT1BVU19BUkNITUFTSwBhc3NlcnRpb24gZmFpbGVkOiBzdC0+bGFzdF9waXRjaF9pbmRleCA8PSBQTENfUElUQ0hfTEFHX01BWABhc3NlcnRpb24gZmFpbGVkOiBzdC0+bGFzdF9waXRjaF9pbmRleCA+PSBQTENfUElUQ0hfTEFHX01JTiB8fCBzdC0+bGFzdF9waXRjaF9pbmRleCA9PSAwAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5wb3N0ZmlsdGVyX3BlcmlvZCA8IE1BWF9QRVJJT0QAYXNzZXJ0aW9uIGZhaWxlZDogc3QtPnBvc3RmaWx0ZXJfcGVyaW9kID49IENPTUJGSUxURVJfTUlOUEVSSU9EIHx8IHN0LT5wb3N0ZmlsdGVyX3BlcmlvZCA9PSAwAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5wb3N0ZmlsdGVyX3BlcmlvZF9vbGQgPCBNQVhfUEVSSU9EAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5wb3N0ZmlsdGVyX3BlcmlvZF9vbGQgPj0gQ09NQkZJTFRFUl9NSU5QRVJJT0QgfHwgc3QtPnBvc3RmaWx0ZXJfcGVyaW9kX29sZCA9PSAwAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5wb3N0ZmlsdGVyX3RhcHNldCA8PSAyAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5wb3N0ZmlsdGVyX3RhcHNldCA+PSAwAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5wb3N0ZmlsdGVyX3RhcHNldF9vbGQgPD0gMgBhc3NlcnRpb24gZmFpbGVkOiBzdC0+cG9zdGZpbHRlcl90YXBzZXRfb2xkID49IDAAAgEAGRcCAH58d21XKRMJBAIAYXNzZXJ0aW9uIGZhaWxlZDogYWNjdW09PTAAYXNzZXJ0aW9uIGZhaWxlZDogcGNtX2NvdW50ID09IGZyYW1lX3NpemUAc3JjL29wdXNfZGVjb2Rlci5jAGFzc2VydGlvbiBmYWlsZWQ6IHJldD09ZnJhbWVfc2l6ZS1wYWNrZXRfZnJhbWVfc2l6ZQBhc3NlcnRpb24gZmFpbGVkOiByZXQ9PXBhY2tldF9mcmFtZV9zaXplAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5jaGFubmVscyA9PSAxIHx8IHN0LT5jaGFubmVscyA9PSAyAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5GcyA9PSA0ODAwMCB8fCBzdC0+RnMgPT0gMjQwMDAgfHwgc3QtPkZzID09IDE2MDAwIHx8IHN0LT5GcyA9PSAxMjAwMCB8fCBzdC0+RnMgPT0gODAwMABhc3NlcnRpb24gZmFpbGVkOiBzdC0+RGVjQ29udHJvbC5BUElfc2FtcGxlUmF0ZSA9PSBzdC0+RnMAYXNzZXJ0aW9uIGZhaWxlZDogc3QtPkRlY0NvbnRyb2wuaW50ZXJuYWxTYW1wbGVSYXRlID09IDAgfHwgc3QtPkRlY0NvbnRyb2wuaW50ZXJuYWxTYW1wbGVSYXRlID09IDE2MDAwIHx8IHN0LT5EZWNDb250cm9sLmludGVybmFsU2FtcGxlUmF0ZSA9PSAxMjAwMCB8fCBzdC0+RGVjQ29udHJvbC5pbnRlcm5hbFNhbXBsZVJhdGUgPT0gODAwMABhc3NlcnRpb24gZmFpbGVkOiBzdC0+RGVjQ29udHJvbC5uQ2hhbm5lbHNBUEkgPT0gc3QtPmNoYW5uZWxzAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5EZWNDb250cm9sLm5DaGFubmVsc0ludGVybmFsID09IDAgfHwgc3QtPkRlY0NvbnRyb2wubkNoYW5uZWxzSW50ZXJuYWwgPT0gMSB8fCBzdC0+RGVjQ29udHJvbC5uQ2hhbm5lbHNJbnRlcm5hbCA9PSAyAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5EZWNDb250cm9sLnBheWxvYWRTaXplX21zID09IDAgfHwgc3QtPkRlY0NvbnRyb2wucGF5bG9hZFNpemVfbXMgPT0gMTAgfHwgc3QtPkRlY0NvbnRyb2wucGF5bG9hZFNpemVfbXMgPT0gMjAgfHwgc3QtPkRlY0NvbnRyb2wucGF5bG9hZFNpemVfbXMgPT0gNDAgfHwgc3QtPkRlY0NvbnRyb2wucGF5bG9hZFNpemVfbXMgPT0gNjAAYXNzZXJ0aW9uIGZhaWxlZDogc3QtPmFyY2ggPj0gMABhc3NlcnRpb24gZmFpbGVkOiBzdC0+YXJjaCA8PSBPUFVTX0FSQ0hNQVNLAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5zdHJlYW1fY2hhbm5lbHMgPT0gMSB8fCBzdC0+c3RyZWFtX2NoYW5uZWxzID09IDIAYXNzZXJ0aW9uIGZhaWxlZDogMABhc3NlcnRpb24gZmFpbGVkOiAob3B1c19jdXN0b21fZGVjb2Rlcl9jdGwoY2VsdF9kZWMsIDEwMDEyLCAoKCh2b2lkKSgoZW5kYmFuZCkgPT0gKG9wdXNfaW50MzIpMCkpLCAob3B1c19pbnQzMikoZW5kYmFuZCkpKSkgPT0gT1BVU19PSwBhc3NlcnRpb24gZmFpbGVkOiAob3B1c19jdXN0b21fZGVjb2Rlcl9jdGwoY2VsdF9kZWMsIDEwMDA4LCAoKCh2b2lkKSgoc3QtPnN0cmVhbV9jaGFubmVscykgPT0gKG9wdXNfaW50MzIpMCkpLCAob3B1c19pbnQzMikoc3QtPnN0cmVhbV9jaGFubmVscykpKSkgPT0gT1BVU19PSwBhc3NlcnRpb24gZmFpbGVkOiAob3B1c19jdXN0b21fZGVjb2Rlcl9jdGwoY2VsdF9kZWMsIDEwMDEwLCAoKCh2b2lkKSgoMCkgPT0gKG9wdXNfaW50MzIpMCkpLCAob3B1c19pbnQzMikoMCkpKSkgPT0gT1BVU19PSwBhc3NlcnRpb24gZmFpbGVkOiAob3B1c19jdXN0b21fZGVjb2Rlcl9jdGwoY2VsdF9kZWMsIDQwMzEsICgoJnJlZHVuZGFudF9ybmcpICsgKCgmcmVkdW5kYW50X3JuZykgLSAob3B1c191aW50MzIqKSgmcmVkdW5kYW50X3JuZykpKSkpID09IE9QVVNfT0sAYXNzZXJ0aW9uIGZhaWxlZDogKG9wdXNfY3VzdG9tX2RlY29kZXJfY3RsKGNlbHRfZGVjLCAxMDAxMCwgKCgodm9pZCkoKHN0YXJ0X2JhbmQpID09IChvcHVzX2ludDMyKTApKSwgKG9wdXNfaW50MzIpKHN0YXJ0X2JhbmQpKSkpID09IE9QVVNfT0sAYXNzZXJ0aW9uIGZhaWxlZDogKG9wdXNfY3VzdG9tX2RlY29kZXJfY3RsKGNlbHRfZGVjLCA0MDI4KSkgPT0gT1BVU19PSwBhc3NlcnRpb24gZmFpbGVkOiAob3B1c19jdXN0b21fZGVjb2Rlcl9jdGwoY2VsdF9kZWMsIDEwMDE1LCAoKCZjZWx0X21vZGUpICsgKCgmY2VsdF9tb2RlKSAtIChjb25zdCBPcHVzQ3VzdG9tTW9kZSoqKSgmY2VsdF9tb2RlKSkpKSkgPT0gT1BVU19PSwAAAAAIAAAABAAAAOF6VD/2KFw/zJIAABAAAAAEAAAAmplZP65HYT/MkgAAIAAAAAQAAADBymE/w/VoP8ySAAAwAAAACAAAALgeZT+DwGo/1JIAAEAAAAAIAAAAqMZrP9ejcD/UkgAAUAAAABAAAAAxCGw/16NwP9ySAABgAAAAEAAAANejcD+F63E/3JIAAIAAAAAQAAAAMzNzPzMzcz/ckgAAoAAAABAAAACPwnU/j8J1P9ySAADAAAAAIAAAANnOdz/Zznc/5JIAAAABAAAgAAAAmpl5P5qZeT/kkgAA8JIAACAAAAAQlAAAIAAAADCVAAAgAAAAUJYAAEAAAAAAAAAAJZHguiDq7z8AAAAAAADwPyWR4Log6u8/3ksrz82o7z9aH/+a5jzvP1XPF7Xap+4/vqBk9qLr7T/XkG46uArtP4voz2UHCOw/td5vtOPm6j9YAHQU96rpPyJyVTQxWOg/UMWuabXy5j9Y5LYByH7lP5RFJ2y7AOQ/RytKS9184j+po+NqZPfgP6qpl6W+6N4/FsR6gkjv2z9LZsyPhQnZPz/p4VfuPdY/wmpufT+S0z+gvqdqaQvRPytyXzkIW80/J5liL5D3yD+hB8qvF/HEP8pirICMSsE/IsW+bFQKvD9hhQCFH0G2P4/ecB+5NbE/Q4TJnk7DqT8he3vfEXiiP/NHKOi855g/We0O5+l1jj8hAg6hSs1+PwAAAAAAAAAAwVNMzh7i7z8AAAAAAADwP8FTTM4e4u8/z0LImg2J7z8MbeeYf/buP4gSLXk8Le4/mk30twwx7T+1sMC6ngbsP8yZDhlms+o/3Hksx3U96T9RqyK7VqvnP5U2yU3cA+Y/davnpPdN5D93AJvei5DiPxOB6h9E0uA/xgDD0dky3j9TPgRVo9faP9kIYcE/ndc/qGoG4Z+M1D9uJH0YKa3RP1rvefZDCc4/GwBgK1cuyT9RlmsbkM7EP4vsWq3Z68A/6dYpXn4Kuz/fF/rUby61PwYNgUwAOLA/yr1E5fQvqD+mFfjtmHihP0v1U9J5Q5g/lM+f9I0BkD8Abjc9/6iDP95pGUbNmXU/4IWMy+EoYz/8qfHSTWJAPwAAAAAAAAAAuaajkCLa7z8AAAAAAADwP7mmo5Ai2u8/hQsW2ntp7z9ERs1417DuPyZTw4bAtO0/M9ouXVZ77D+pzhc5EwzrP6nqcSGHb+k/cuaRHgqv5z/W0WnEadTlP8CnpBSV6eM/OaAA5Ur44T/qgxvfzQngP1Vq1TJCTdw/Q13e+5+s2D8PWvbBhT7VPx8F28pDDdI/oGc3IxhBzj+Mi3rz4frIP/CuSIb7TMQ/dOMnH8w3wD/uYYrNIm+5PztOVcoAirM/6GEuyuhXrT8kM80qInmlP7tpbfnMgp4/Iix0b4/vlD8+Ed0W2YyLP13CX5umMoE/UAiy2AUHdD+ByCq+BBtlP9zuq5Ov21I/G8qaom1GNz8="),n(t,38480,"yFEM0oT07z8AAAAAAADwP8hRDNKE9O8/9pUH6SnS7z/a08TxMpnvP9T9ENkPSu8/fp+7blvl7j9hwT+d2WvuPx3X8SV13u0/an9v7Dw+7T/J6jXBYIzsP3ckRQEuyus/Hrx+2gv56j860L80dxrqP/UlI4D+L+k/8kBDgz076D8OB1Pe2D3nP/fyr6N5OeY/TMjFIMkv5T/OuHiRbCLkP/+ZWhkBE+M/L5wx7RcD4j9j2QbNMvTgP01ahnKBz98/zY9k+zW+3T8VxjeQBbfbP+AHrag9vNk/YDMKk/PP1z/zHfzEAfTVP0qFZ/gFKtQ/5808FGBz0j+NyjQ3MtHQP9jRevDBiM4/ryd4Eiqbyz/ISJPeedrIP7XPWyMfR8Y/PVdCFB/hwz+1zQFAHajBP026kLvGNr8/LgwmONRzuz9mkgUKxAS4P4BUFsd55rQ/YkhOJm4Vsj+kFYSXhRuvP+yy6yCnlqo/l6hBRZOTpj8+eC/vWAmjP9XnrEfI3Z8/bM9NFzl2mj/08djo/8mVPw8LtaZ5x5E/VRds+h67jD/+pLEosveGPzy3lup+JYI/pfu1zFROfD9nH1R3n8J1PwXEfxU7dXA/dH+znJ1vaD/T8PMAksBhP/dS2/qnI1k/P8Gs7XlAUT/xQgCR+sJGP3uyzVM+gDw/JlGSIvCPMD/HVG5gehQhP32Jfzcgqws/8WjjiLX45D4="),n(t,39024,"MJxQAAAAAAAF"),n(t,39044,"AQ=="),n(t,39068,"AgAAAAMAAADomw=="),n(t,39092,"Ag=="),n(t,39107,"//////8="),n(t,39348,"EJw=");var tn=((i=[null,function(e){return 0|w(0|function(e){return e}(u[(e|=0)+60>>2]))},function(e,t,r){e|=0,t|=0,r|=0;var i=0,n=0,o=0,a=0,s=0,c=0,d=0;D=i=D-32|0,n=u[e+28>>2],u[i+16>>2]=n,o=u[e+20>>2],u[i+28>>2]=r,u[i+24>>2]=t,t=o-n|0,u[i+20>>2]=t,c=t+r|0,d=2,t=i+16|0;t:{r:{i:{if(!e8(0|O(u[e+60>>2],i+16|0,2,i+12|0)))for(;;){if((0|c)==(0|(n=u[i+12>>2])))break i;if((0|n)<=-1)break r;if(s=((o=(a=u[t+4>>2])>>>0<n>>>0)<<3)+t|0,a=n-(o?a:0)|0,u[s>>2]=a+u[s>>2],u[(s=(o?12:4)+t|0)>>2]=u[s>>2]-a,c=c-n|0,t=o?t+8|0:t,d=d-o|0,!!e8(0|O(u[e+60>>2],0|t,0|d,i+12|0)))break}if((0|c)!=-1)break r}t=u[e+44>>2],u[e+28>>2]=t,u[e+20>>2]=t,u[e+16>>2]=u[e+48>>2]+t,e=r;break t}if(u[e+28>>2]=0,u[e+16>>2]=0,u[e+20>>2]=0,u[e>>2]=32|u[e>>2],e=0,(0|d)==2)break t;e=r-u[t+4>>2]|0}return D=i+32|0,0|(n=e)},function(e,t,r,i){e|=0,t|=0,r|=0,i|=0;var n=0;return D=n=D-16|0,e=e8(function(e,t,r,i,n){return 0|P(0|e,0|t,0|r,0|i,0|n)}(u[e+60>>2],t,r,255&i,n+8|0)),D=n+16|0,r=u[n+12>>2],L=e?-1:r,t=u[n+8>>2],(e?-1:t)|0},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=0,s=0,c=0,d=0,l=0,h=0,p=0,f=0,_=0,m=0,g=0,S=0,b=0,T=0,y=0,R=0,I=0,C=0,k=0;t<<=2,g=t+u[e+64>>2]|0,d=u[g>>2],S=u[e+60>>2]+t|0,a=u[S>>2],b=u[i>>2];t:if(!((0|a)>=(0|b))){for(f=u[e+12>>2],y=u[e+40>>2],R=u[e+36>>2],I=u[e+92>>2],C=u[e+76>>2],T=(0|(i=u[o>>2]))>0?i:0,k=(0|(_=u[e+24>>2]))<1;;){if((0|s)==(0|T)){s=T;break t}m=0;n:{if(k){l=0,h=0,p=0;break n}for(i=(a<<2)+r|0,t=(v(d,_)<<2)+C|0,o=0,p=0,h=0,l=0;;){if(l+=+E(A[t+(e=o<<2)>>2]*A[e+i>>2]),m+=+E(A[(c=12|e)+t>>2]*A[i+c>>2]),p+=+E(A[(c=8|e)+t>>2]*A[i+c>>2]),e|=4,h+=+E(A[t+e>>2]*A[e+i>>2]),!((0|_)>(0|(o=o+4|0))))break}}if(A[(v(s,I)<<2)+n>>2]=l+h+p+m,d=(e=d+y|0)-(e>>>0<f>>>0?0:f)|0,s=s+1|0,!((0|b)>(0|(a=(a+R|0)+(e>>>0>=f>>>0)|0))))break}}return u[S>>2]=a,u[g>>2]=d,0|s},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=0,s=0,c=0,d=0,l=E(0),h=0,p=0,f=0,_=0,m=0,g=0,S=0,b=0,T=0,y=0;t<<=2,h=t+u[e+64>>2]|0,c=u[h>>2],p=u[e+60>>2]+t|0,a=u[p>>2],f=u[i>>2];t:if(!((0|a)>=(0|f))){for(d=u[e+12>>2],m=u[e+40>>2],g=u[e+36>>2],S=u[e+92>>2],b=u[e+76>>2],_=(0|(i=u[o>>2]))>0?i:0,T=(0|(t=u[e+24>>2]))<1;;){if((0|s)==(0|_)){s=_;break t}if(l=E(0),!T)for(o=(a<<2)+r|0,y=(v(t,c)<<2)+b|0,e=0;;){if(l=E(l+E(A[y+(i=e<<2)>>2]*A[i+o>>2])),(0|t)==(0|(e=e+1|0)))break}if(A[(v(s,S)<<2)+n>>2]=l,c=(e=c+m|0)-(e>>>0<d>>>0?0:d)|0,s=s+1|0,!((0|f)>(0|(a=(a+g|0)+(e>>>0>=d>>>0)|0))))break}}return u[p>>2]=a,u[h>>2]=c,0|s},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=E(0),s=0,c=E(0),d=0,l=0,h=0,p=0,f=0,_=0,m=0,g=0,S=0,b=0,T=0,y=0,R=0,I=E(0),C=0,k=0,w=0,O=E(0),N=0,P=0,D=0,L=0,M=0;t<<=2,S=t+u[e+64>>2]|0,f=u[S>>2],b=u[e+60>>2]+t|0,d=u[b>>2],T=u[i>>2];t:if(!((0|d)>=(0|T))){for(C=u[e+40>>2],k=u[e+36>>2],w=u[e+92>>2],y=(0|(i=u[o>>2]))>0?i:0,O=E((l=u[e+12>>2])>>>0),N=(0|(R=u[e+24>>2]))<1;;){if((0|p)==(0|y)){p=y;break t}t=i=v(f,o=u[e+48>>2]),i=(i>>>0)/(l>>>0)|0,c=E(E(t-v(l,i)>>>0)/O);n:{if(N){s=0,h=0,_=0,m=0;break n}for(P=(d<<2)+r|0,D=4-i|0,L=u[e+76>>2],i=0,m=0,_=0,h=0,s=0;;){if(a=A[(i<<2)+P>>2],_+=+E(a*A[(t=(v(o,i=i+1|0)+D<<2)+L|0)>>2]),m+=+E(a*A[t+4>>2]),h+=+E(a*A[t-4>>2]),s+=+E(a*A[t-8>>2]),(0|i)==(0|R))break}}if(a=E(c*E(.16666999459266663)),I=E(c*E(c*a)),M=s*(g=+E(I-a)),a=E(c*E(c*E(.5))),h=M+h*(s=+E(E(c+a)-E(c*a))),g=1-g-s,s=+E(E(a+E(c*E(-.3333300054073334)))-I),A[(v(p,w)<<2)+n>>2]=h+_*+E(g-s)+m*s,f=(i=f+C|0)-(i>>>0<l>>>0?0:l)|0,p=p+1|0,!((0|T)>(0|(d=(d+k|0)+(i>>>0>=l>>>0)|0))))break}}return u[b>>2]=d,u[S>>2]=f,0|p},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=E(0),s=E(0),c=E(0),d=0,l=0,h=0,p=0,f=E(0),_=E(0),m=E(0),g=0,S=0,b=0,T=0,y=0,R=E(0),I=E(0),C=0,k=0,w=0,O=E(0),N=0,P=0,D=0,L=0,M=E(0);t<<=2,g=t+u[e+64>>2]|0,p=u[g>>2],S=u[e+60>>2]+t|0,d=u[S>>2],b=u[i>>2];t:if(!((0|d)>=(0|b))){for(C=u[e+40>>2],k=u[e+36>>2],w=u[e+92>>2],T=(0|(i=u[o>>2]))>0?i:0,O=E((l=u[e+12>>2])>>>0),N=(0|(y=u[e+24>>2]))<1;;){if((0|h)==(0|T)){h=T;break t}t=i=v(p,o=u[e+48>>2]),i=(i>>>0)/(l>>>0)|0,s=E(E(t-v(l,i)>>>0)/O);n:{if(N){c=E(0),f=E(0),_=E(0),m=E(0);break n}for(P=(d<<2)+r|0,D=4-i|0,L=u[e+76>>2],i=0,m=E(0),_=E(0),f=E(0),c=E(0);;){if(a=A[(i<<2)+P>>2],_=E(_+E(a*A[(t=(v(o,i=i+1|0)+D<<2)+L|0)>>2])),m=E(m+E(a*A[t+4>>2])),f=E(f+E(a*A[t-4>>2])),c=E(c+E(a*A[t-8>>2])),(0|i)==(0|y))break}}if(a=E(s*E(.16666999459266663)),R=E(s*E(s*a)),I=E(R-a),M=E(I*c),a=E(s*E(s*E(.5))),c=E(E(s+a)-E(s*a)),a=E(E(a+E(s*E(-.3333300054073334)))-R),A[(v(h,w)<<2)+n>>2]=E(E(M+E(c*f))+E(_*E(1-+I-+c-+a)))+E(a*m),p=(i=p+C|0)-(i>>>0<l>>>0?0:l)|0,h=h+1|0,!((0|b)>(0|(d=(d+k|0)+(i>>>0>=l>>>0)|0))))break}}return u[S>>2]=d,u[g>>2]=p,0|h},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=0,s=0,c=0,d=0,l=0,h=0,p=0;s=(r=t<<2)+u[e+64>>2]|0,a=u[s>>2],t=0,c=u[e+60>>2]+r|0,r=u[c>>2],d=u[i>>2];t:if(!((0|r)>=(0|d))){for(i=u[e+12>>2],l=u[e+40>>2],h=u[e+36>>2],p=u[e+92>>2],o=(0|(t=u[o>>2]))>0?t:0,t=0;;){if((0|t)==(0|o)){t=o;break t}if(u[(v(t,p)<<2)+n>>2]=0,a=(e=a+l|0)-(e>>>0<i>>>0?0:i)|0,t=t+1|0,!((0|d)>(0|(r=(r+h|0)+(e>>>0>=i>>>0)|0))))break}}return u[c>>2]=r,u[s>>2]=a,0|t}]).set=function(e,t){this[e]=t},i.get=function(e){return this[e]},i);return{__wasm_call_ctors:function(){},opus_decoder_create:function(e,t,r){e|=0,t|=0,r|=0;var i=0,n=0;D=n=D-16|0;t:{r:{i:{n:{if((0|e)<=15999){if((0|e)==8e3|(0|e)==12e3)break n;break i}if((0|e)==16e3|(0|e)==48e3)break n;if((0|e)!=24e3)break i}if(t-1>>>0<2)break r}if(!r)break t;u[r>>2]=-1;break t}if(!tt(n+12|0)&&(u[n+12>>2]=u[n+12>>2]+3&-4,i=(e2(t)+u[n+12>>2]|0)+88|0),!(i=M(i))){if(i=0,!r)break t;u[r>>2]=-7;break t}if(e=function(e,t,r){var i=0,n=0,o=0;D=i=D-16|0,o=-1;t:{r:{if((0|t)<=15999){if((0|t)==8e3|(0|t)==12e3)break r;break t}if((0|t)==16e3|(0|t)==48e3)break r;if((0|t)!=24e3)break t}if(r-1>>>0>1)break t;if(o=0,!tt(i+12|0)&&(u[i+12>>2]=u[i+12>>2]+3&-4,o=(e2(r)+u[i+12>>2]|0)+88|0),e=eE(e,0,o),o=-3,tt(i+8|0))break t;if(n=u[i+8>>2]+3&-4,u[i+8>>2]=n,u[e+48>>2]=r,u[e+8>>2]=r,u[e+4>>2]=88,u[e+24>>2]=t,u[e+12>>2]=t,u[e+16>>2]=r,n=n+88|0,u[e>>2]=n,e$(e+88|0)||function(e,t,r){var i=0,n=0;if(i=-1,n=ej(48e3,960,0),r>>>0<=2){if(!e)return -7;i=eE(e,0,(v((u[n+4>>2]<<2)+8288|0,r)+(u[n+8>>2]<<5)|0)+92|0),u[i>>2]=n,e=u[n+4>>2],u[i+16>>2]=1,u[i+20>>2]=0,u[i+12>>2]=r,u[i+8>>2]=r,u[i+4>>2]=e,n=u[n+12>>2],u[i+28>>2]=1,u[i+32>>2]=(0|r)==1,u[i+36>>2]=0,u[i+24>>2]=n,Z(i,4028,0),r=function(e){var t=0;t:{r:{i:{n:{if((0|e)<=15999){if((0|e)==8e3)break n;if((0|e)!=12e3)break i;return 4}if((0|e)==16e3)break r;if(t=1,(0|e)==48e3)break t;if((0|e)!=24e3)break i;return 2}return 6}e0(1579,1599,84),I()}t=3}return t}(t),u[i+16>>2]=r,i=r?0:-1}return i}(n=e+n|0,t,r))break t;o=0,u[i>>2]=0,Z(n,10016,i),u[e+64>>2]=((65535&t)>>>0)/400,u[e+60>>2]=0,u[e+44>>2]=0}return D=i+16|0,o}(i,e,t),r&&(u[r>>2]=e),!e)break t;H(i),i=0}return D=n+16|0,0|i},opus_decode_float:function(e,t,r,i,n,o){return(e|=0,t|=0,r|=0,i|=0,o|=0,(0|(n|=0))<1)?-1:0|function e(t,r,i,n,o,a,c,p,f){var m=0,S=0,b=0,T=0,y=0,R=0,C=0;D=T=D-112|0;t:{r:{i:{n:{o:{a:{s:{if((b=u[t+8>>2])-1>>>0<2){S=u[t+12>>2];d:{if((0|S)<=15999){if((0|S)==8e3|(0|S)==12e3)break d;break t}if((0|S)==16e3|(0|S)==24e3)break d;if((0|S)!=48e3)break t}if(u[t+24>>2]!=(0|S))break s;m=u[t+28>>2];l:{if((0|m)<=11999){if(!m|(0|m)==8e3)break l;break r}if((0|m)==12e3)break l;if((0|m)!=16e3)break r}if(u[t+16>>2]!=(0|b))break a;if(_[t+20>>2]>=3)break o;if((m=u[t+32>>2])>>>0>20|!(1<<m&1049601))break n;break i}e0(35445,35333,84),I()}e0(35611,35333,86),I()}e0(35863,35333,88),I()}e0(35925,35333,89),I()}if((0|m)==40|(0|m)==60)break i;e0(36063,35333,90),I()}q:{Z:{p:{$:{ee:{f:{et:{if((0|(m=u[t+44>>2]))>-1){if(m)break et;if(m=-1,u[t+48>>2]-1>>>0>=2)break f;if(a>>>0>1||!(a?0:!(!r|!i))&&(0|o)%(((65535&S)>>>0)/400|0)|0)break q;if(!(i?r:0)){if((0|(S=x(t,0,0,n,o,0)))<0){m=S;break q}for(;;){if((0|o)>(0|S)){if(S=((a=(0|(m=x(t,0,0,(v(u[t+8>>2],S)<<2)+n|0,o-S|0,0)))<0)?0:m)+S|0,!a)continue;break q}break}if((0|o)!=(0|S))break ee;break Z}if((0|i)<0)break q;R=96&(m=l[0|r]),C=128&m;eN:{if(C){y=(m=m>>>5&3)?m+1102|0:1101;break eN}if(y=16&m?1105:1104,(0|R)==96)break eN;y=(m>>>5&3)+1101|0}if(S=function(e,t){if(128&(e=l[0|e]))return(t<<(e>>>3&3))/400|0;if((96&e)==96)return 8&e?(0|t)/50|0:(0|t)/100|0;return(0|(e=e>>>3&3))==3?(0|v(t,60))/1e3|0:(t<<e)/100|0}(r,S),m=l[0|r],(0|(b=function(e,t,r,i,n,o,a,c){var p=0,f=0,_=0,A=0,m=0,E=0,g=0,S=0,b=0,T=0,y=0,R=0;S=-1;t:if(!(!o|(0|t)<0)){if(S=-4,!t)break t;b=l[0|e];r:{if(128&b){A=(48e3<<(b>>>3&3)>>>0)/400|0;break r}if(A=8&b?960:480,(96&b)==96)break r;if(A=2880,(0|(f=b>>>3&3))==3)break r;A=(48e3<<f>>>0)/100|0}_=1,f=e+1|0,m=p=t-1|0,T=E=3&b;n:{o:{a:{s:{switch(0|E){case 1:if(r){_=2,E=1,T=0,m=p;break a}if(1&p)break t;m=p>>>1|0,d[o>>1]=m,_=2,T=0;break o;case 2:if((0|t)<=1)return d[o>>1]=65535,-4;if((E=l[0|f])>>>0>=252){if(_=2,(0|t)<=2)return d[o>>1]=65535,-4;E=(l[e+2|0]<<2)+E|0}if(d[o>>1]=E,(0|E)>(0|(p=p-_|0)))break t;m=p-E|0,f=f+_|0,E=0,_=2,T=0;break s;case 0:break s;default:break}if((0|t)<2||!(_=63&(g=l[e+1|0]))|v(_,A)>>>0>5760)break t;E=e+2|0,t=t-2|0,T=0;p:{if(!(64&g)){f=E;break p}for(;;){if((0|t)<1)break t;if(T=T+(f=((m=(0|(f=l[0|E]))==255)?-2:f)&255)|0,t=(-1^f)+t|0,E=f=E+1|0,!m)break}if((0|t)<0)break t}if(E=g>>>7^1,128&g){if(_>>>0<2){p=t,m=t;break s}for(R=_-1|0,g=0,m=t,p=t;;){if(y=(g<<1)+o|0,(0|p)<=0)return d[y>>1]=65535,-4;if(A=1,(t=l[0|f])>>>0>=252){if((0|p)<=1)return d[y>>1]=65535,-4;A=2,t=(l[f+1|0]<<2)+t|0}if(d[y>>1]=t,(0|(p=p-A|0))<(0|t))break t;if(f=f+A|0,m=(m-A|0)-t|0,(0|R)==(0|(g=g+1|0)))break}if((0|m)>=0)break s;break t}if(r){m=p,p=t;break a}if((0|v(m=(0|t)/(0|_)|0,_))!=(0|t))break t;if(_>>>0<2)break o;for(A=_-1|0,p=0;;){if(d[(p<<1)+o>>1]=m,(0|A)==(0|(p=p+1|0)))break}p=t}if(!r)break o}A=((_<<1)+o|0)-2|0,t=65535,r=-1;eb:if(!((0|p)<1)){if((g=l[0|f])>>>0<252){t=g,r=1;break eb}if(r=-1,(0|p)<2)break eb;t=(l[f+1|0]<<2)+g|0,r=2}if(d[A>>1]=t,(0|(A=t<<16>>16))<0||(0|A)>(0|(p=p-r|0)))break t;if(f=r+f|0,E){if((0|v(_,A))>(0|p))break t;if(_>>>0<2)break n;if(d[o>>1]=t,t=1,(0|(S=_-1|0))==1)break n;for(r=(S<<1)+o|0;;){if(d[(t<<1)+o>>1]=h[r>>1],(0|S)==(0|(t=t+1|0)))break}break n}if((r+A|0)>(0|m))break t;break n}if((0|m)>1275)break t;d[((_<<1)+o|0)-2>>1]=m}if(a&&(u[a>>2]=f-e),_)for(t=0;;){if(n&&(u[(t<<2)+n>>2]=f),f=d[(t<<1)+o>>1]+f|0,(0|_)==(0|(t=t+1|0)))break}c&&(u[c>>2]=(T-e|0)+f),i&&(s[0|i]=b),S=_}return S}(r,i,c,T+107|0,0,T,T+108|0,p)))<0){m=b;break q}if(i=C?1002:(0|R)==96?1001:1e3,c=4&m?2:1,r=u[T+108>>2]+r|0,a){if(!(1002!=u[t+56>>2]?!((0|i)==1002|(0|o)<(0|S)):0)){m=e(t,0,0,n,o,0,0,0,f);break q}if(a=o-S|0){if(b=u[t+72>>2],(0|(m=e(t,0,0,n,a,0,0,0,f)))<=-1){u[t+72>>2]=b;break q}if((0|a)!=(0|m))break $}if(u[t+64>>2]=S,u[t+52>>2]=y,u[t+56>>2]=i,u[t+48>>2]=c,(0|(m=x(t,r,d[T>>1],(v(u[t+8>>2],a)<<2)+n|0,S,1)))>=0)break Z;break q}if(m=-2,(0|v(S,b))>(0|o))break q;u[t+64>>2]=S,u[t+52>>2]=y,u[t+56>>2]=i,u[t+48>>2]=c,a=0;es:{if((0|b)<1){m=0;break es}for(m=0;;){if((0|(i=x(t,r,d[(c=(a<<1)+T|0)>>1],(v(u[t+8>>2],m)<<2)+n|0,o-m|0,0)))<0){m=i;break q}if((0|i)!=(0|S))break p;if(m=m+S|0,r=d[c>>1]+r|0,(0|b)==(0|(a=a+1|0)))break}}if(u[t+72>>2]=m,f){(function(e,t,r,i){var n=E(0),o=0,a=0,s=0,c=0,d=E(0),u=0,l=E(0),h=0,p=0,f=0,_=0,m=E(0),S=E(0),b=E(0);if(!(!i|!e|((0|t)<1|(0|r)<1))){if((0|(s=v(t,r)))>=1)for(;;){if(u=c=(o<<2)+e|0,d=(a=((c=(n=A[c>>2])>E(2))?E(2):n)<E(-2))?E(-2):E(2),A[u>>2]=c?d:a?d:n,(0|s)==(0|(o=o+1|0)))break}for(;;){for(c=(o=f<<2)+e|0,l=A[(_=i+o|0)>>2],o=0;;){if(!!((d=E(l*(n=A[(a=(v(r,o)<<2)+c|0)>>2])))>=E(0))||(A[a>>2]=n+E(n*d),(0|(o=o+1|0))==(0|t)))break}for(S=A[c>>2],s=0;;){c:{h=s;d:if(!((0|(a=s))>=(0|t))){for(;;){if((n=A[(v(r,a)<<2)+c>>2])>E(1)|n<E(-1))break d;if((0|(a=a+1|0))==(0|t))break}d=E(0);break c}if((0|t)==(0|a)){d=E(0);break c}for(u=a>>31&a,n=E(g(d=A[(v(r,a)<<2)+c>>2])),s=a;;){q:{if((0|(o=s))<1){o=u;break q}if(E(d*A[(v(s=o-1|0,r)<<2)+c>>2])>=E(0))continue}break}s=a;p:if(!((0|t)<=(0|a))){for(;;){if(E(d*(l=A[(v(r,s)<<2)+c>>2]))>=E(0)^1)break p;if(a=(u=(l=E(g(l)))>n)?s:a,n=u?l:n,(0|(s=s+1|0))==(0|t))break}s=t}if(p=0,p=o?p:E(d*A[c>>2])>=E(0),n=E(E(n+E(-1))/E(n*n)),n=E(n+E(n*E(2399999914359796e-22))),d=d>E(0)?E(-n):n,(0|o)<(0|s))for(;;){if(n=A[(u=(v(r,o)<<2)+c|0)>>2],A[u>>2]=n+E(n*E(d*n)),(0|s)==(0|(o=o+1|0)))break}if(!(1^p|(0|a)<2|(0|a)<=(0|h)))for(l=E(S-A[c>>2]),b=E(l/E(0|a));;){if(p=o=(v(r,h)<<2)+c|0,l=E(l-b),m=(u=((o=(n=E(l+A[o>>2]))>E(1))?E(1):n)<E(-1))?E(-1):E(1),A[p>>2]=o?m:u?m:n,(0|(h=h+1|0))==(0|a))break}if((0|t)!=(0|s))continue}break}if(A[_>>2]=d,(0|(f=f+1|0))==(0|r))break}}})(n,m,u[t+8>>2],t+76|0);break q}u[t+76>>2]=0,u[t+80>>2]=0;break q}e0(36272,35333,92),I()}e0(36304,35333,93),I()}e0(36348,35333,95),I()}e0(35291,35333,652),I()}e0(35352,35333,689),I()}e0(35404,35333,724),I()}u[t+72>>2]=o,m=o}return D=T+112|0,m}e0(35669,35333,87),I()}e0(35502,35333,85),I()}(e,t,r,i,n,o,0,0,0)},opus_decoder_ctl:function(e,t,r){e|=0,t|=0,r|=0;var i=0,n=0,o=0;D=i=D-48|0,o=u[e+4>>2],n=u[e>>2],u[i+44>>2]=r,n=e+n|0,r=-5;t:{switch(t-4009|0){case 0:if(r=u[i+44>>2],u[i+44>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+52>>2],r=0;break t;case 22:if(r=u[i+44>>2],u[i+44>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+84>>2],r=0;break t;case 19:u[e+64>>2]=0,u[e+68>>2]=0,u[e+48>>2]=0,u[e+52>>2]=0,u[e+80>>2]=0,u[e+84>>2]=0,u[e+72>>2]=0,u[e+76>>2]=0,u[e+56>>2]=0,u[e+60>>2]=0,r=0,Z(n,4028,0),e$(e+o|0),u[e+48>>2]=u[e+8>>2],u[e+64>>2]=u[e+12>>2]/400;break t;case 20:if(r=u[i+44>>2],u[i+44>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+12>>2],r=0;break t;case 24:if(r=u[i+44>>2],u[i+44>>2]=r+4,!(r=u[r>>2])){r=-1;break t}if(1002==u[e+60>>2]){u[i>>2]=r,r=Z(n,4033,i);break t}u[r>>2]=u[e+36>>2],r=0;break t;case 36:if(r=u[i+44>>2],u[i+44>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+40>>2],r=0;break t;case 25:if(t=u[i+44>>2],u[i+44>>2]=t+4,r=-1,(t=u[t>>2])+32768>>>0>65535)break t;u[e+40>>2]=t,r=0;break t;case 30:if(r=u[i+44>>2],u[i+44>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+72>>2],r=0;break t;case 37:if(e=u[i+44>>2],u[i+44>>2]=e+4,r=-1,(e=u[e>>2])>>>0>1)break t;u[i+16>>2]=e,r=Z(n,4046,i+16|0);break t;case 38:break;default:break t}if(e=u[i+44>>2],u[i+44>>2]=e+4,!(e=u[e>>2])){r=-1;break t}u[i+32>>2]=e,r=Z(n,4047,i+32|0)}return D=i+48|0,0|r},opus_decoder_destroy:function(e){H(e|=0)},speex_resampler_init:function(e,t,r,i,n){return 0|function(e,t,r,i,n,o,a){var s=0,c=0;t:{r:if(!e|!t|!r||!(o>>>0<11)){if(!a)break t;return u[a>>2]=3,0}if(!(s=eQ(96,1))){if(s=0,!a)break t;return u[a>>2]=1,0}u[s>>2]=0,u[s+4>>2]=0,u[s+44>>2]=0x3f800000,u[s+16>>2]=-1,u[s+88>>2]=1,u[s+92>>2]=1,u[s+20>>2]=e,u[s+32>>2]=160,u[s+8>>2]=0,u[s+12>>2]=0,e<<=2,c=eQ(e,1),u[s+60>>2]=c;o:if(c){if(c=eQ(e,1),u[s+68>>2]=c,!c)break o;if(e=eQ(e,1),u[s+64>>2]=e,!e)break o;u[s+16>>2]=o,function(e,t,r,i,n){var o=0,a=0,s=0,c=0,d=0;a=3;t:if(!(!t|!r)&&(u[e>>2]!=(0|i)|u[e+4>>2]!=(0|n)|u[e+8>>2]!=(0|t)||(a=0,u[e+12>>2]!=(0|r)))){for(u[e+8>>2]=t,u[e+4>>2]=n,u[e>>2]=i,s=u[e+12>>2],u[e+12>>2]=r,o=t,i=r;;){if(n=i,i=(o>>>0)%(i>>>0)|0,o=n,!i)break}i=(r>>>0)/(n>>>0)|0,u[e+12>>2]=i,u[e+8>>2]=(t>>>0)/(n>>>0);n:if(!(!s|!u[e+20>>2])){for(d=u[e+64>>2],n=0;;){if(a=5,r=0xffffffff/(i>>>0)|0,c=o=u[(t=(n<<2)+d|0)>>2],o=(o>>>0)/(s>>>0)|0,r>>>0<(c=c-v(s,o)|0)>>>0|r>>>0<o>>>0)break t;if(o=v(i,o),o>>>0>(-1^(i=(v(i,c)>>>0)/(s>>>0)|0))>>>0)break t;if(i=i+o|0,u[t>>2]=i,(o=u[e+12>>2])>>>0<=i>>>0&&(u[t>>2]=o-1),(n=n+1|0)>>>0>=_[e+20>>2])break n;i=u[e+12>>2]}}if(!u[e+52>>2])return 0;a=W(e)};}(s,t,r,i,n),e=W(s);a:{if(!e){u[s+52>>2]=1;break a}H(u[s+72>>2]),H(u[s+76>>2]),H(u[s+60>>2]),H(u[s+68>>2]),H(u[s+64>>2]),H(s),s=0}if(!a)break t;return u[a>>2]=e,s}a&&(u[a>>2]=1),H(u[s+76>>2]),H(u[s+60>>2]),H(u[s+68>>2]),H(u[s+64>>2]),H(s),s=0}return s}(e|=0,t|=0,r|=0,t,r,i|=0,n|=0)},speex_resampler_destroy:function(e){H(u[(e|=0)+72>>2]),H(u[e+76>>2]),H(u[e+60>>2]),H(u[e+68>>2]),H(u[e+64>>2]),H(e)},speex_resampler_process_interleaved_float:function(e,t,r,i,n){e|=0,t|=0,r|=0,i|=0,n|=0;var o=0,a=0,s=0,c=0,d=0,l=0;if(s=u[e+92>>2],c=u[r>>2],d=u[n>>2],o=u[e+20>>2],u[e+92>>2]=o,l=u[e+88>>2],u[e+88>>2]=o,o)for(o=0;;){u[n>>2]=d,u[r>>2]=c;i:{if(t){a=o<<2,$(e,o,a+t|0,r,i+a|0,n);break i}$(e,o,0,r,(o<<2)+i|0,n)}if(!((o=o+1|0)>>>0<_[e+20>>2]))break}return u[e+92>>2]=s,u[e+88>>2]=l,8==u[e+84>>2]|0},__errno_location:ti,stackSave:function(){return 0|D},stackRestore:function(e){e|=0,D=e},stackAlloc:function(e){return e|=0,D=e=D-e&-16,0|e},malloc:M,free:H,__indirect_function_table:tn,dynCall_jiji:function(e,t,r,i,n){return e|=0,t|=0,r|=0,i|=0,n|=0,e=function(e,t,r,i,n){return i=0|tn[0|e](t,r,i,n)}(e,t,r,i,n),N(0|(r=L)),0|e}}}(e)}(eo)},instantiate:function(e,t){return{then:function(t){var r=new U.Module(e);t({instance:new U.Instance(r)})}}},RuntimeError:Error};l=[],"object"!=typeof U&&J("no native wasm support detected");var B=!1;function V(e,t){!e&&J("Assertion failed: "+t)}var F="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function j(e,t,r){for(var i=t+r,n=t;e[n]&&!(n>=i);)++n;if(n-t>16&&e.subarray&&F)return F.decode(e.subarray(t,n));for(var o="";t<n;){var a=e[t++];if(!(128&a)){o+=String.fromCharCode(a);continue}var s=63&e[t++];if((224&a)==192){o+=String.fromCharCode((31&a)<<6|s);continue}var c=63&e[t++];if((a=(240&a)==224?(15&a)<<12|s<<6|c:(7&a)<<18|s<<12|c<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var d=a-65536;o+=String.fromCharCode(55296|d>>10,56320|1023&d)}}return o}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var G=y.INITIAL_MEMORY||0x1000000;(h=y.wasmMemory?y.wasmMemory:new U.Memory({initial:G/65536,maximum:G/65536}))&&(p=h.buffer),G=p.byteLength,p=i=p,y.HEAP8=new Int8Array(i),y.HEAP16=new Int16Array(i),y.HEAP32=v=new Int32Array(i),y.HEAPU8=_=new Uint8Array(i),y.HEAPU16=new Uint16Array(i),y.HEAPU32=new Uint32Array(i),y.HEAPF32=new Float32Array(i),y.HEAPF64=new Float64Array(i);var W=[],H=[],Y=[],K=[];H.push({func:function(){es()}});var Q=0,z=null,X=null;function J(e){throw y.onAbort&&y.onAbort(e),M(e+=""),B=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new U.RuntimeError(e)}y.preloadedImages={},y.preloadedAudios={};var q="data:application/octet-stream;base64,";function Z(e){var t,r;return t=e,r=q,String.prototype.startsWith?t.startsWith(r):0===t.indexOf(r)}var $="<<< WASM_BINARY_FILE >>>";if(!Z($)){;n=$,$=y.locateFile?y.locateFile(n,D):D+n}function ee(e){for(;e.length>0;){var t=e.shift();if("function"==typeof t){t(y);continue}var r=t.func;"number"==typeof r?void 0===t.arg?b.get(r)():b.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}}var et={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=et.buffers[e];0===t||10===t?((1===e?L:M)(j(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return et.varargs+=4,v[et.varargs-4>>2]},getStr:function(e){var t,r;return(t=e)?j(_,t,void 0):""},get64:function(e,t){return e}};function er(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];i>255&&(i&=255),t.push(String.fromCharCode(i))}return t.join("")}var ei="function"==typeof atob?atob:function(e){var t,r,i,n,o,a,s,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=c.indexOf(e.charAt(u++)),o=c.indexOf(e.charAt(u++)),a=c.indexOf(e.charAt(u++)),s=c.indexOf(e.charAt(u++)),t=n<<2|o>>4,r=(15&o)<<4|a>>2,i=(3&a)<<6|s,d+=String.fromCharCode(t),64!==a&&(d+=String.fromCharCode(r)),64!==s&&(d+=String.fromCharCode(i));while(u<e.length);return d};function en(e){if(!!Z(e))return function(e){if("boolean"==typeof N&&N){var t;try{t=a.from(e,"base64")}catch(r){t=new a(e,"base64")}return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}try{for(var r=ei(e),i=new Uint8Array(r.length),n=0;n<r.length;++n)i[n]=r.charCodeAt(n);return i}catch(e){throw Error("Converting base64 string to bytes failed.")}}(e.slice(q.length))}var eo={abort:function(){J()},emscripten_memcpy_big:function(e,t,r){_.copyWithin(e,t,t+r)},emscripten_resize_heap:function(e){var t;t=0,J("OOM")},fd_close:function(e){return 0},fd_seek:function(e,t,r,i,n){},fd_write:function(e,t,r,i){for(var n=0,o=0;o<r;o++){for(var a=v[t+8*o>>2],s=v[t+(8*o+4)>>2],c=0;c<s;c++)et.printChar(e,_[a+c]);n+=s}return v[i>>2]=n,0},getTempRet0:function(){return x},memory:h,setTempRet0:function(e){x=e}},ea=function(){var e,t={env:eo,wasi_snapshot_preview1:eo};function r(e,t){var r=e.exports;y.asm=r,b=y.asm.__indirect_function_table,!function(e){if(Q--,y.monitorRunDependencies&&y.monitorRunDependencies(Q),0==Q&&(null!==z&&(clearInterval(z),z=null),X)){var t=X;X=null,t()}}(0)}if(e=0,Q++,y.monitorRunDependencies&&y.monitorRunDependencies(Q),y.instantiateWasm)try{return y.instantiateWasm(t,r)}catch(e){return M("Module.instantiateWasm callback failed with error: "+e),!1}var i=function(e,t){try{n=function(e){try{if(e==$&&l)return new Uint8Array(l);var t=en(e);if(t)return t;if(c)return c(e);throw"sync fetching of the wasm failed: you can preload it to Module['wasmBinary'] manually, or emcc.py will do that for you when generating HTML (but not JS)"}catch(e){J(e)}}(e),i=new U.Module(n),r=new U.Instance(i,t)}catch(e){var r,i,n,o=e.toString();throw M("failed to compile wasm module: "+o),(o.indexOf("imported Memory")>=0||o.indexOf("memory import")>=0)&&M("Memory size incompatibility issues may be due to changing INITIAL_MEMORY at runtime to something too large. Use ALLOW_MEMORY_GROWTH to allow any size memory (and also make sure not to set INITIAL_MEMORY at runtime to something smaller than it was at compile time)."),e}return[r,i]}($,t);return r(i[0],i[1]),y.asm}(),es=y.___wasm_call_ctors=ea.__wasm_call_ctors;function ec(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function ed(e){if(e=e||I,Q>0)return;if(!function(){if(y.preRun)for("function"==typeof y.preRun&&(y.preRun=[y.preRun]);y.preRun.length;)(function(e){W.unshift(e)})(y.preRun.shift());ee(W)}(),!(Q>0))y.setStatus?(y.setStatus("Running..."),setTimeout(function(){setTimeout(function(){y.setStatus("")},1),t()},1)):t();function t(){if(!T)T=!0,y.calledRun=!0,!B&&(ee(H),ee(Y),y.onRuntimeInitialized&&y.onRuntimeInitialized(),!function(){if(y.postRun)for("function"==typeof y.postRun&&(y.postRun=[y.postRun]);y.postRun.length;)(function(e){K.unshift(e)})(y.postRun.shift());ee(K)}())}}if(y._opus_decoder_create=ea.opus_decoder_create,y._opus_decode_float=ea.opus_decode_float,y._opus_decoder_ctl=ea.opus_decoder_ctl,y._opus_decoder_destroy=ea.opus_decoder_destroy,y._speex_resampler_init=ea.speex_resampler_init,y._speex_resampler_destroy=ea.speex_resampler_destroy,y._speex_resampler_process_interleaved_float=ea.speex_resampler_process_interleaved_float,y.___errno_location=ea.__errno_location,y.stackSave=ea.stackSave,y.stackRestore=ea.stackRestore,y.stackAlloc=ea.stackAlloc,y._malloc=ea.malloc,y._free=ea.free,y.dynCall_jiji=ea.dynCall_jiji,X=function e(){!T&&ed(),!T&&(X=e)},y.run=ed,y.preInit)for("function"==typeof y.preInit&&(y.preInit=[y.preInit]);y.preInit.length>0;)y.preInit.pop()();return ed(),y},"function"==typeof define&&define.amd?define(["require"],function(e){return o=n(i,e)}):e.exports?(o=n("undefined"!=typeof process&&process&&process.env?process.env:i,e.require),e.exports=o):(o=n(i),i.OpusDecoderLib=o)},299570:function(e,t,r){e=r.nmd(e);var i,n,o,a=r(353434).Buffer;i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:this,n=function(t,r){"use strict";var i,n,o,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y={};y.isReady=!1,y.onready=null,y.onRuntimeInitialized=function(){y.isReady=!0,y.onready&&setTimeout(y.onready,0)},t&&t.OPUS_SCRIPT_LOCATION&&(y.locateFile=function(e){var r=t.OPUS_SCRIPT_LOCATION||"";return r[e]?r[e]:(r+=r&&!/\/$/.test(r)?"/":"")+e});var R={};for(o in y)y.hasOwnProperty(o)&&(R[o]=y[o]);var I=[],C="./this.program",k=function(e,t){throw t},w=!1,O=!1,N=!1,P=!1;w="object"==typeof window,O="function"==typeof importScripts,N="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,P=!w&&!N&&!O;var D="";if(N){D=O?r("path").dirname(D)+"/":"//",s=function(e,t){var i=en(e);return i?t?i:i.toString():(!d&&(d=r("fs")),!u&&(u=r("path")),e=u.normalize(e),d.readFileSync(e,t?null:"utf8"))},c=function(e){var t=s(e,!0);return!t.buffer&&(t=new Uint8Array(t)),V(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),I=process.argv.slice(2);e.exports=y,process.on("uncaughtException",function(e){if(!(e instanceof ec))throw e}),process.on("unhandledRejection",J);y.inspect=function(){return"[Emscripten Module object]"}}else P?("undefined"!=typeof read&&(s=function(e){var t=en(e);return t?er(t):read(e)}),c=function(e){var t;return(t=en(e))?t:"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(V("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?I=scriptArgs:"undefined"!=typeof arguments&&(I=arguments),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(w||O)&&(O?D=self.location.href:"undefined"!=typeof document&&document.currentScript&&(D=document.currentScript.src),D=0!==D.indexOf("blob:")?D.substr(0,D.lastIndexOf("/")+1):"",s=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(t){var r=en(e);if(r)return er(r);throw t}},O&&(c=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}catch(t){var r=en(e);if(r)return r;throw t}}));var L=y.print||console.log.bind(console),M=y.printErr||console.warn.bind(console);for(o in R)R.hasOwnProperty(o)&&(y[o]=R[o]);R=null,y.arguments&&(I=y.arguments),y.thisProgram&&y.thisProgram,y.quit&&y.quit;var x=0;y.wasmBinary&&(l=y.wasmBinary),y.noExitRuntime;var U={Memory:function(e){this.buffer=new ArrayBuffer(65536*e.initial)},Module:function(e){},Instance:function(e,t){this.exports=function(e){for(var t,r=new Uint8Array(123),i=25;i>=0;--i)r[48+i]=52+i,r[65+i]=i,r[97+i]=26+i;function n(e,t,i){for(var n,o,a=0,s=t,c=i.length,d=t+(3*c>>2)-("="==i[c-2])-("="==i[c-1]);a<c;a+=4)n=r[i.charCodeAt(a+1)],o=r[i.charCodeAt(a+2)],e[s++]=r[i.charCodeAt(a)]<<2|n>>4,s<d&&(e[s++]=n<<4|o>>2),s<d&&(e[s++]=o<<6|r[i.charCodeAt(a+3)])}r[43]=62,r[47]=63;var o=new ArrayBuffer(16),a=new Int32Array(o),s=new Float32Array(o),c=new Float64Array(o);function d(e){return a[e]}function u(e,t){a[e]=t}function l(){return c[0]}function h(e){c[0]=e}function p(e){s[2]=e}function f(){return s[2]}return function(e){var r,i,o=e.memory.buffer,s=new Int8Array(o),d=new Int16Array(o),u=new Int32Array(o),l=new Uint8Array(o),_=new Uint16Array(o),A=new Uint32Array(o),m=new Float32Array(o),v=new Float64Array(o),E=Math.imul,g=Math.fround,S=Math.abs,b=Math.clz32,T=Math.min,y=Math.max,R=Math.floor,I=Math.ceil,C=Math.sqrt,k=e.abort,w=e.emscripten_resize_heap,O=e.emscripten_memcpy_big,N=e.fd_close,P=e.fd_write,k=e.abort,D=e.setTempRet0,L=e.fd_seek,M=5296384,x=0;function U(e,t,r,i,n,o,a,c,h,p,f,_,A){var v=0,I=0,w=0,O=g(0),N=g(0),P=0,D=0,L=0,x=g(0),V=0,j=0,W=0,Y=0,K=g(0),Q=0,z=g(0),X=0,J=0,q=0,Z=0,$=0,ee=0,et=g(0),er=0,ei=0,en=0,eo=0,ec=0,ed=0,el=0,eh=0,ep=0,ef=0,eA=0,em=g(0),eE=g(0),eg=g(0),eS=0,eb=0,ey=0;M=w=M-624|0,u[(I=w)+616>>2]=0,u[e+18136>>2]=0,v=-1;t:if(!((0|r)<1)&&!((0|(j=(0|n)<1276?n:1276))<1)&&((0|j)!=1||(v=-2,u[e+144>>2]!=(0|E(r,10))))){D=u[e>>2]+e|0,V=u[e+4>>2],en=2051!=u[e+108>>2]?u[e+116>>2]:en,v=u[e+168>>2],u[I+416>>2]=I+612,H(D,10015,I+416|0),u[I+544>>2]=0,L=(0|o)<(0|v)?o:v;n:{o:{a:{s:{c:{d:if(!(u[e+44>>2]<7)&&!((0|(X=u[e+144>>2]))<16e3)){if(ed=1,(0|(o=E(u[e+112>>2],r)))>=1)for(v=0;;){if(x=(O=m[(v<<2)+t>>2])>x?x:O,N=O<N?N:O,(0|(v=v+1|0))==(0|o))break}if(W=u[e+7640>>2],J=u[e+7636>>2],function(e,t,r,i,n,o,a,c,l,h,p,f){var _=g(0),A=g(0),v=0,b=0,I=0,w=g(0),O=g(0),N=g(0),P=g(0),D=g(0),L=0,x=g(0),U=g(0),B=g(0),V=g(0),F=0,j=0,W=g(0),H=g(0),Y=g(0),K=0,Q=g(0),z=0,X=g(0),J=0,q=g(0),Z=g(0),$=g(0),ee=g(0),et=g(0),er=g(0),ei=g(0),en=g(0),eo=g(0),ea=g(0),es=g(0),ec=0,ed=g(0),el=0,eh=0,ep=g(0),ef=0,eA=g(0),em=0,eE=g(0),eg=g(0),eS=0,eb=g(0),ey=g(0),eR=g(0),eI=g(0),eC=0,ek=0,ew=0,eO=0,eN=g(0),eP=g(0),eD=g(0),eL=g(0),ex=0,eU=0,eB=g(0);if(M=v=M-11360|0,r){if(b=(0|E(l,95))/50|0,i&=-2,(0|(eh=(eC=(0|i)>(0|b)?b:i)-(el=u[e+7440>>2])|0))>=1)for(ek=e+7464|0,ex=e+3852|0,eU=e+4812|0,ew=e+7592|0,ef=e+2892|0,em=(0|l)/50|0,_=g(g(5699999746866524e-19)/g(1<<((0|h)>8?h:8)-8)),eE=g(_*_),eB=g(eE*g(3));;){l=(0|eh)>(0|em),!u[e+7460>>2]&&(u[e+7460>>2]=1,u[e+5772>>2]=240),L=l?em:eh,ec=u[e+7436>>2],l=u[e+8>>2];o:{if((0|l)!=16e3){if(I=el,(0|l)!=48e3)break o;L=(0|L)/2|0,I=(0|el)/2|0;break o}L=(0|E(L,3))/2|0,I=(0|E(el,3))/2|0}j=u[t+72>>2],b=(((i=u[e+5772>>2])<<2)+e|0)+2892|0,eo=g(e_(p,r,b,ew,(0|(i=720-i|0))>(0|L)?L:i,I,o,a,c,l)+m[e+7456>>2]),m[e+7456>>2]=eo,l=u[e+5772>>2]+L|0;s:{if((0|l)<=719){u[e+5772>>2]=l;break s}for(l=ec+1|0,eg=g(g(1)/g(((0|ec)<100?l:100)|0)),ea=g(g(1)/g(((0|ec)<25?l:25)|0)),W=g(g(1)/g(((0|ec)<10?l:10)|0)),K=u[e+7444>>2],u[e+7444>>2]=K+((0|K)>98?-99:1),F=function(e,t,r,i){var n=g(0),o=g(0),a=g(0);if((0|(t=E(t,r)))>=1)for(r=0;;){if(a=(n=m[(r<<2)+e>>2])>a?a:n,o=n<o?o:n,(0|(r=r+1|0))==(0|t))break}return n=g(-a),g(g(1)/g(1<<i))>=(n<o?o:n)}(ef,720,1,h),l=0;;){if(i=(v+5760|0)+(l<<3)|0,_=m[(b=l<<2)+48944>>2],b=b+ef|0,m[i>>2]=_*m[b>>2],m[i+4>>2]=_*m[b+960>>2],m[(b=(v+5760|0)+((i=479-l|0)<<3)|0)>>2]=_*m[(i<<2)+ef>>2],m[b+4>>2]=_*m[(719-l<<2)+ef>>2],(0|(l=l+1|0))==240)break}if(ev(ef,eU,960),_=e_(p,r,ex,ew,(i=L+(l=u[e+5772>>2])|0)-720|0,(I-l|0)+720|0,o,a,c,u[e+8>>2]),u[e+5772>>2]=i-480,m[e+7456>>2]=_,z=(J=(K<<6)+e|0)+7604|0,F){I=(l=((l=u[e+7444>>2])+((0|l)<2?98:-2)<<6)+e|0)+7660|0,b=u[I>>2],i=u[I+4>>2],I=b,u[(b=z)+56>>2]=I,u[b+60>>2]=i,i=u[(I=l+7652|0)>>2],b=u[I+4>>2],I=i,u[(i=z)+48>>2]=I,u[i+52>>2]=b,b=u[(I=l+7644|0)>>2],i=u[I+4>>2],I=b,u[(b=z)+40>>2]=I,u[b+44>>2]=i,i=u[(I=l+7636|0)>>2],b=u[I+4>>2],I=i,u[(i=z)+32>>2]=I,u[i+36>>2]=b,b=u[(I=l+7628|0)>>2],i=u[I+4>>2],I=b,u[(b=z)+24>>2]=I,u[b+28>>2]=i,i=u[(I=l+7620|0)>>2],b=u[I+4>>2],I=i,u[(i=z)+16>>2]=I,u[i+20>>2]=b,b=u[(I=l+7612|0)>>2],i=u[I+4>>2],I=b,u[(b=z)+8>>2]=I,u[b+12>>2]=i,i=u[(I=l+7604|0)>>2],b=u[I+4>>2],l=i,u[(i=z)>>2]=l,u[i+4>>2]=b;break s}if(function(e,t,r){var i=0,n=0,o=g(0),a=0,s=0,c=0,l=g(0);if((0|t)!=(0|r)){if((0|(n=u[e>>2]))>=1)for(o=m[e+4>>2],c=u[e+44>>2];;){if(l=m[(a=(i<<3)+t|0)>>2],m[(s=(d[(i<<1)+c>>1]<<3)+r|0)+4>>2]=o*m[a+4>>2],m[s>>2]=o*l,(0|n)==(0|(i=i+1|0)))break}G(e,r);return}tO(42376,42433,580),k()}(j,v+5760|0,v+1920|0),l=1,(B=m[v+1920>>2])!=B){u[z>>2]=0;break s}for(;;){N=m[(i=((0-l<<3)+v|0)+5760|0)>>2],_=g(N-(O=m[(b=(v+1920|0)+(l<<3)|0)>>2])),w=m[b+4>>2],A=g(w+(V=m[i+4>>2])),P=g(0),j=b=(i=l<<2)+e|0,F=b,x=g(O+N),N=g(x*x),O=g(w-V),w=g(O*O),U=g(0);q:if(!(g(N+w)<g(1000000045813705e-33))){if(U=g((O<g(0)?g(-1.5707963705062866):g(1.5707963705062866))-g(g(g(O*x)*g(g(N*g(.43157973885536194))+w))/g(g(g(N*g(.6784840226173401))+w)*g(g(N*g(.0859554186463356))+w)))),!(N<w^1))break q;U=O<g(0)?g(-1.5707963705062866):g(1.5707963705062866),O=g(x*O),U=g(g(U+g(g(O*g(N+g(w*g(.43157973885536194))))/g(g(N+g(w*g(.6784840226173401)))*g(N+g(w*g(.0859554186463356))))))-(O<g(0)?g(-1.5707963705062866):g(1.5707963705062866)))}U=g(U*g(.15915493667125702)),x=g(U-m[(L=b+12|0)>>2]),N=g(x-m[(I=b+972|0)>>2]),O=g(_*_),w=g(A*A);Z:if(!(g(O+w)<g(1000000045813705e-33))){if(!(O>w^1)){P=g((_<g(0)?g(-1.5707963705062866):g(1.5707963705062866))-g(g(g(_*A)*g(O+g(w*g(.43157973885536194))))/g(g(O+g(w*g(.6784840226173401)))*g(O+g(w*g(.0859554186463356))))));break Z}P=_<g(0)?g(-1.5707963705062866):g(1.5707963705062866),_=g(_*A),P=g(g(P+g(g(_*g(g(O*g(.43157973885536194))+w))/g(g(g(O*g(.6784840226173401))+w)*g(g(O*g(.0859554186463356))+w))))-(_<g(0)?g(-1.5707963705062866):g(1.5707963705062866)))}if(O=g(P*g(.15915493667125702)),w=g(O-U),K=tL(_=g(w-x)),I=i+v|0,A=g(N-g(0|tL(N))),_=g(_-g(0|K)),m[I>>2]=g(S(A))+g(S(_)),N=m[(b=b+1932|0)>>2],_=g(_*_),_=g(_*_),m[(v+1e4|0)+i>>2]=g(g(1)/g(g(_*g(62341.81640625))+g(1)))+g(-.014999999664723873),A=g(A*A),m[(v+960|0)+i>>2]=g(g(1)/g(g(g(g(g(N+g(A*A))+g(_+_))*g(.25))*g(62341.81640625))+g(1)))+g(-.014999999664723873),m[j+12>>2]=O,m[F+972>>2]=w,m[b>>2]=_,(0|(l=l+1|0))==240)break}for(l=2,_=m[v+10008>>2];;){if(N=m[(b=(i=l<<2)+(v+960|0)|0)>>2],O=m[(i+v|0)+9996>>2],_=g((_<(O=(A=m[(v+1e4|0)+((i=l+1|0)<<2)>>2])<O?O:A)?_:O)+g(-.10000000149011612)),m[b>>2]=(_<N?N:_)*g(.8999999761581421),_=A,(0|(l=i))==239)break}for(u[(eS=J+7620|0)>>2]=0,!(F=u[e+7436>>2])&&(u[e+7008>>2]=0x501502f9,u[e+7012>>2]=0x501502f9,u[e+7080>>2]=-0x2feafd07,u[e+7084>>2]=-0x2feafd07,u[e+7088>>2]=-0x2feafd07,u[e+7092>>2]=-0x2feafd07,u[e+7016>>2]=0x501502f9,u[e+7020>>2]=0x501502f9,u[e+7096>>2]=-0x2feafd07,u[e+7100>>2]=-0x2feafd07,u[e+7024>>2]=0x501502f9,u[e+7028>>2]=0x501502f9,u[e+7104>>2]=-0x2feafd07,u[e+7108>>2]=-0x2feafd07,u[e+7032>>2]=0x501502f9,u[e+7036>>2]=0x501502f9,u[e+7112>>2]=-0x2feafd07,u[e+7116>>2]=-0x2feafd07,u[e+7040>>2]=0x501502f9,u[e+7044>>2]=0x501502f9,u[e+7048>>2]=0x501502f9,u[e+7052>>2]=0x501502f9,u[e+7120>>2]=-0x2feafd07,u[e+7124>>2]=-0x2feafd07,u[e+7056>>2]=0x501502f9,u[e+7060>>2]=0x501502f9,u[e+7136>>2]=-0x2feafd07,u[e+7140>>2]=-0x2feafd07,u[e+7128>>2]=-0x2feafd07,u[e+7132>>2]=-0x2feafd07,u[e+7064>>2]=0x501502f9,u[e+7068>>2]=0x501502f9,u[e+7072>>2]=0x501502f9,u[e+7144>>2]=-0x2feafd07,u[e+7148>>2]=-0x2feafd07,u[e+7076>>2]=0x501502f9),_=g(B+B),w=g(_*_),_=g((_=m[v+1924>>2])+_),w=g(w+g(_*_)),P=g((_=m[v+1928>>2])*_),P=g(P+g((_=m[v+5752>>2])*_)),P=g(P+g((_=m[v+1932>>2])*_)),w=g(w+g(P+g((_=m[v+5756>>2])*_))),P=g((_=m[v+1936>>2])*_),P=g(P+g((_=m[v+5744>>2])*_)),P=g(P+g((_=m[v+1940>>2])*_)),w=g(w+g(P+g((_=m[v+5748>>2])*_))),P=g((_=m[v+1944>>2])*_),P=g(P+g((_=m[v+5736>>2])*_)),P=g(P+g((_=m[v+1948>>2])*_)),x=g(g(eM(+g(g(w+g(P+g((_=m[v+5740>>2])*_)))+g(1000000013351432e-25))))*g(.7213475108146667)),m[v+9888>>2]=x,U=g(0),I=0,l=4,X=g(0),H=g(0),Y=g(0),ed=g(0),q=g(0),Z=g(0);;){if(N=g(0),O=g(0),A=g(0),(0|(L=u[(j=(K=I+1|0)<<2)+49904>>2]))>(0|l))for(;;){if(w=g((_=m[(i=(v+1920|0)+(l<<3)|0)>>2])*_),w=g(w+g((_=m[(b=((0-l<<3)+v|0)+5760|0)>>2])*_)),w=g(w+g((_=m[i+4>>2])*_)),_=g(w+g((_=m[b+4>>2])*_)),A=g(A+_),O=g(O+g(_*g(y(m[(i=l<<2)+(v+960|0)>>2],g(0))))),N=g(N+g(g(_+_)*g(g(.5)-m[i+v>>2]))),(0|L)==(0|(l=l+1|0)))break}if(!(A==A?!(A<g(1e9)^1):0)){u[z>>2]=0;break s}m[(l=(i=I<<2)+(E(u[e+7432>>2],72)+e|0)|0)+5856>>2]=A,b=(v+9888|0)+j|0,V=g(A+g(1000000013351432e-25)),_=g(eM(+V)),m[b>>2]=_*g(.7213475108146667),m[(v+11200|0)+i>>2]=_,m[l+6432>>2]=_;en:{if(F){w=m[(l=e+i|0)+7008>>2],P=m[l+7080>>2];break en}m[(l=e+i|0)+7080>>2]=_,m[l+7008>>2]=_,w=_,P=_}b=(l=e+i|0)+7008|0,j=l+7080|0;A:if(!(+P>+w+7.5^1)){if(!(g(P-_)>g(_-w)^1)){P=g(P+g(-.009999999776482582)),m[j>>2]=P;break A}w=g(w+g(.009999999776482582)),m[b>>2]=w}A=g(A+g(10000000036274937e-31));eb:{if(!(_>P^1)){m[j>>2]=_,w=w<(P=g(_+g(-15)))?P:w,m[b>>2]=w,P=_;break eb}if(_<w^1)break eb;m[b>>2]=_,P=(w=g(_+g(15)))<P?w:P,m[j>>2]=P,w=_}if(V=g(C(V)),N=g(N/A),A=g(O/A),b=l+5776|0,O=m[l+5856>>2],B=m[l+5928>>2],Q=m[l+6e3>>2],$=m[l+6072>>2],ee=m[l+6144>>2],et=m[l+6216>>2],er=m[l+6288>>2],ei=m[l+6360>>2],O=g(T(g(g(g(g(g(g(g(g(g(g(C(O))+g(0))+g(C(B)))+g(C(Q)))+g(C($)))+g(C(ee)))+g(C(et)))+g(C(er)))+g(C(ei)))/g(C(+g(g(g(g(g(g(g(g(g(O+g(0))+B)+Q)+$)+ee)+et)+er)+ei)*g(8))+1e-15))),g(.9900000095367432))),O=g(O*O),O=g(O*O),A=A>(B=g(m[b>>2]*O))?A:B,m[(v+11280|0)+i>>2]=A,U=g(U+A),_=g(g(_-w)/g(g(P-w)+g(9999999747378752e-21))),U=I>>>0>=9?g(U-m[(i+v|0)+11244>>2]):U,Z=g(Z+V),H=g(H+N),ed=g(ed+O),q=g(q+_),m[b>>2]=A,X=(_=g(g(g(g(I-18|0)*g(.029999999329447746))+g(1))*U))<X?X:_,Y=g(Y+g(A*g(I-8|0))),l=L,(0|(I=K))==18)break}for(m[v+9808>>2]=x,A=g(x+g(-2.5)),m[v+9728>>2]=A,i=1,b=4,N=x;;){if(_=g((L=u[(l=i<<2)+49904>>2])-b|0),O=g(g(_+_)*g(.25)),N=g(N+O),N=(_=m[(v+9888|0)+l>>2])>N?N:_,m[(v+9808|0)+l>>2]=N,A=g(A-O),A=(_=g(_+g(-2.5)))<A?A:_,m[(v+9728|0)+l>>2]=A,b=L,(0|(i=i+1|0))==19)break}for(i=16,b=192,_=m[v+9796>>2],A=m[v+9876>>2];;){if(L=(i=(l=i)<<2)+(v+9808|0)|0,N=g(b-(I=u[i+49904>>2])|0),N=g(g(N+N)*g(.25)),A=g(A+N),A=A<(O=m[L>>2])?A:O,m[L>>2]=A,_=g(_-N),_=_>(N=m[(i=(v+9728|0)+i|0)>>2])?_:N,m[i>>2]=_,i=l-1|0,b=I,!l)break}for(l=0;;){en=g(0),b=(l+J|0)+7648|0,eO=R(+g(g(g(y(g(m[(i=l<<2)+(v+9728|0)>>2]-x),g(0)))+g(y(g(x-g(m[(v+9808|0)+i>>2]+g(2.5))),g(0))))*g(64))+.5);v:{if(0x80000000>S(eO)){i=~~eO;break v}i=-0x80000000}if(s[0|b]=(0|i)<255?i:255,b=0,(0|(l=l+1|0))!=19){x=m[(v+9888|0)+(l<<2)>>2];continue}break}for(;;){for(N=m[(l=E(b,72)+e|0)+6500>>2],O=m[l+6496>>2],w=m[l+6448>>2],P=m[l+6444>>2],U=m[l+6440>>2],x=m[l+6436>>2],V=m[l+6432>>2],B=m[l+6492>>2],Q=m[l+6488>>2],$=m[l+6484>>2],ee=m[l+6480>>2],et=m[l+6476>>2],er=m[l+6472>>2],ei=m[l+6468>>2],eA=m[l+6464>>2],es=m[l+6460>>2],eb=m[l+6456>>2],ep=m[l+6452>>2],_=g(0x38d7ea4000000),i=0;;){if(A=g(V-m[(l=E(i,72)+e|0)+6432>>2]),D=g(g(A*A)+g(0)),A=g(x-m[l+6436>>2]),D=g(D+g(A*A)),A=g(U-m[l+6440>>2]),D=g(D+g(A*A)),A=g(P-m[l+6444>>2]),D=g(D+g(A*A)),A=g(w-m[l+6448>>2]),D=g(D+g(A*A)),A=g(ep-m[l+6452>>2]),D=g(D+g(A*A)),A=g(eb-m[l+6456>>2]),D=g(D+g(A*A)),A=g(es-m[l+6460>>2]),D=g(D+g(A*A)),A=g(eA-m[l+6464>>2]),D=g(D+g(A*A)),A=g(ei-m[l+6468>>2]),D=g(D+g(A*A)),A=g(er-m[l+6472>>2]),D=g(D+g(A*A)),A=g(et-m[l+6476>>2]),D=g(D+g(A*A)),A=g(ee-m[l+6480>>2]),D=g(D+g(A*A)),A=g($-m[l+6484>>2]),D=g(D+g(A*A)),A=g(Q-m[l+6488>>2]),D=g(D+g(A*A)),A=g(B-m[l+6492>>2]),D=g(D+g(A*A)),A=g(O-m[l+6496>>2]),D=g(D+g(A*A)),A=g(N-m[l+6500>>2]),A=g(D+g(A*A)),_=(0|i)==(0|b)?_:_<A?_:A,(0|(i=i+1|0))==8)break}if(en=g(en+_),(0|(b=b+1|0))==8)break}for(w=g(0),V=(0|ec)<2?g(0):g(g(1)-eg),B=g(en*g(.125)),ec=u[e+5852>>2],I=0,j=4,F=0,P=g(0),O=g(0),N=g(0);;){if(_=g(0),(0|(l=j))<(0|(L=u[((K=I+1|0)<<2)+49904>>2])))for(;;){if(x=g((A=m[(i=(v+1920|0)+(l<<3)|0)>>2])*A),x=g(x+g((A=m[(b=((0-l<<3)+v|0)+5760|0)>>2])*A)),x=g(x+g((A=m[i+4>>2])*A)),_=g(_+g(x+g((A=m[b+4>>2])*A))),(0|L)==(0|(l=l+1|0)))break}if(A=_<(A=g(V*m[(l=((i=I<<2)+e|0)+7152|0)>>2]))?A:_,m[l>>2]=A,l=I>>>0<11,U=g(O+_),x=g(N+_),!((P=_<P?P:_)<g(_*g(1e9))^1)&&(Q=_>A?_:A,A=g(L-j|0),F=g(eE*A)<_?K:Q>g(eB*A)?K:F),O=l?U:O,N=l?N:x,u[(v+10960|0)+i>>2]=g(w*((0|I)<(0|ec)?g(.009999999776482582):g(.05000000074505806)))>_,w=_<(A=g(w*g(.05000000074505806)))?A:_,j=L,(0|(I=K))==18)break}48e3==u[e+8>>2]&&(A=g(V*m[e+7224>>2]),A=(_=g(eo*g(27777778450399637e-20)))<A?A:_,m[e+7224>>2]=A,P=_>A?_:A,A=(l=(0|ec)==20)?g(10):g(30),F=(g(g(eE*A)*g(160))<_^1?!(P>g(g(eE*g(A*g(3)))*g(160))):0)?F:20,u[v+11032>>2]=g((l?g(.009999999776482582):g(.05000000074505806))*w)>_,N=g(_+N)),_=g(B/g(18)),m[J+7644>>2]=N>O?g(O/N):g(1);ed:{if((0|F)==20){F=u[v+11032>>2]?18:20;break ed}if((l=F-1|0)>>>0>17)break ed;F=u[(v+10960|0)+(l<<2)>>2]?l:F}for(eb=g(C(_)),A=g(m[e+7424>>2]+g(-.003000000026077032)),A=(_=g(g(eT(+Z))*g(20)))<A?A:_,m[e+7424>>2]=A,N=g(g(g(1)-ea)*m[e+7428>>2]),m[e+7428>>2]=g(A+g(-30))>_?g(ea+N):N,I=u[e+7436>>2],i=0,_=m[v+11204>>2],A=m[v+11200>>2],N=m[v+11260>>2],O=m[v+11256>>2],w=m[v+11252>>2],P=m[v+11248>>2],U=m[v+11244>>2],x=m[v+11240>>2],V=m[v+11236>>2],B=m[v+11232>>2],Q=m[v+11228>>2],$=m[v+11224>>2],ee=m[v+11220>>2],et=m[v+11216>>2],er=m[v+11212>>2],ei=m[v+11208>>2];;){if(l=i<<6,m[(v+11168|0)+(i<<2)>>2]=g(g(g(g(g(g(g(g(g(g(g(g(g(g(g(g(A*m[l+49984>>2])+g(0))+g(_*m[(4|l)+49984>>2]))+g(ei*m[(8|l)+49984>>2]))+g(er*m[(12|l)+49984>>2]))+g(et*m[(16|l)+49984>>2]))+g(ee*m[(20|l)+49984>>2]))+g($*m[(24|l)+49984>>2]))+g(Q*m[(28|l)+49984>>2]))+g(B*m[(32|l)+49984>>2]))+g(V*m[(36|l)+49984>>2]))+g(x*m[(40|l)+49984>>2]))+g(U*m[(44|l)+49984>>2]))+g(P*m[(48|l)+49984>>2]))+g(w*m[(52|l)+49984>>2]))+g(O*m[(56|l)+49984>>2]))+g(N*m[(60|l)+49984>>2]),(0|(i=i+1|0))==8)break}for(L=0;;){for(b=L<<4,_=g(0),l=0;;){if(i=(l<<2)+e|0,_=g(_+g(g(m[(l+b<<2)+49984>>2]*g(.5))*g(m[i+7080>>2]+m[i+7008>>2]))),(0|(l=l+1|0))==16)break}if(m[(v+9968|0)+(L<<2)>>2]=_,(0|(L=L+1|0))==8)break}P=g(H/g(18)),m[eS>>2]=P+g(g(g(1)-P)*((0|I)<10?g(.5):g(q/g(18)))),_=g(X/g(9)),_=_>(A=g(m[e+5848>>2]*g(.800000011920929)))?_:A,m[e+5848>>2]=_,m[(i=J+7612|0)>>2]=Y*g(.015625),b=(0|I)<9999?I+1|0:1e4,u[e+7436>>2]=b,u[e+7432>>2]=(u[e+7432>>2]+1|0)%8,m[(L=J+7608|0)>>2]=_,U=m[e+7260>>2],x=m[e+7228>>2],es=g(x+(V=m[e+7292>>2])),A=m[v+11168>>2],X=g(A+(ep=m[e+7324>>2])),en=m[e+7356>>2],D=g(g(g(U*g(.6969299912452698))+g(g(es*g(.49195000529289246))-g(X*g(.12298999726772308))))-g(en*g(1.4349000453948975))),m[v+11056>>2]=D,B=m[e+7264>>2],Q=m[e+7232>>2],H=g(Q+($=m[e+7296>>2])),N=m[v+11172>>2],q=g(N+(Y=m[e+7328>>2])),Z=m[e+7360>>2],ey=g(g(g(B*g(.6969299912452698))+g(g(H*g(.49195000529289246))-g(q*g(.12298999726772308))))-g(Z*g(1.4349000453948975))),m[v+11060>>2]=ey,ee=m[e+7268>>2],et=m[e+7236>>2],eo=g(et+(er=m[e+7300>>2])),O=m[v+11176>>2],eg=g(O+(ea=m[e+7332>>2])),eN=m[e+7364>>2],eR=g(g(g(ee*g(.6969299912452698))+g(g(eo*g(.49195000529289246))-g(eg*g(.12298999726772308))))-g(eN*g(1.4349000453948975))),m[v+11064>>2]=eR,eP=m[e+7272>>2],ei=m[e+7240>>2],eA=m[e+7304>>2],w=m[v+11180>>2],eD=m[e+7336>>2],eL=m[e+7368>>2],eI=g(g(g(eP*g(.6969299912452698))+g(g(g(ei+eA)*g(.49195000529289246))-g(g(w+eD)*g(.12298999726772308))))-g(eL*g(1.4349000453948975))),m[v+11068>>2]=eI,_=g(g(1)-W),m[e+7368>>2]=g(W*w)+g(eL*_),m[e+7364>>2]=g(W*O)+g(_*eN),m[e+7360>>2]=g(W*N)+g(_*Z),m[e+7356>>2]=g(W*A)+g(_*en),m[v+11096>>2]=g(g(eg*g(.5345199704170227))-g(eo*g(.26725998520851135)))-g(ee*g(.5345199704170227)),m[v+11092>>2]=g(g(q*g(.5345199704170227))-g(H*g(.26725998520851135)))-g(B*g(.5345199704170227)),X=g(g(g(X*g(.5345199704170227))-g(es*g(.26725998520851135)))-g(U*g(.5345199704170227))),m[v+11088>>2]=X,en=g(g(g(w-eD)*g(.6324599981307983))+g(g(ei-eA)*g(.31622999906539917))),m[v+11084>>2]=en,H=g(g(g(O-ea)*g(.6324599981307983))+g(g(et-er)*g(.31622999906539917))),m[v+11080>>2]=H,Y=g(g(g(N-Y)*g(.6324599981307983))+g(g(Q-$)*g(.31622999906539917))),m[v+11076>>2]=Y,q=g(g(g(A-ep)*g(.6324599981307983))+g(g(x-V)*g(.31622999906539917))),m[v+11072>>2]=q,l=(0|I)<3?20:F,ep=g(ed/g(18)),es=m[e+7388>>2];ew:{if((0|b)<=5){_=m[e+7420>>2],H=m[e+7412>>2],Y=m[e+7408>>2],ed=m[e+7404>>2],Z=m[e+7400>>2],eo=m[e+7396>>2],ea=m[e+7392>>2];break ew}es=g(g(D*g(W*D))+g(_*es)),m[e+7388>>2]=es,ea=g(g(ey*g(W*ey))+g(_*m[e+7392>>2])),m[e+7392>>2]=ea,eo=g(g(eR*g(W*eR))+g(_*m[e+7396>>2])),m[e+7396>>2]=eo,Z=g(g(eI*g(W*eI))+g(_*m[e+7400>>2])),m[e+7400>>2]=Z,ed=g(g(q*g(W*q))+g(_*m[e+7404>>2])),m[e+7404>>2]=ed,Y=g(g(Y*g(W*Y))+g(_*m[e+7408>>2])),m[e+7408>>2]=Y,H=g(g(H*g(W*H))+g(_*m[e+7412>>2])),m[e+7412>>2]=H,m[e+7416>>2]=g(en*g(W*en))+g(_*m[e+7416>>2]),_=g(g(X*g(W*X))+g(_*m[e+7420>>2])),m[e+7420>>2]=_}m[v+11056>>2]=A-m[v+9968>>2],m[v+11060>>2]=N-m[v+9972>>2],m[v+11064>>2]=O-m[v+9976>>2],m[v+11068>>2]=w-m[v+9980>>2],m[e+7260>>2]=x,m[e+7328>>2]=$,m[e+7228>>2]=A,m[e+7296>>2]=B,m[e+7264>>2]=Q,m[e+7332>>2]=er,m[e+7232>>2]=N,m[e+7300>>2]=ee,m[e+7268>>2]=et,m[e+7336>>2]=eA,m[e+7236>>2]=O,m[e+7304>>2]=eP,m[e+7272>>2]=ei,m[e+7240>>2]=w,m[e+7324>>2]=V,m[e+7292>>2]=U,b=u[e+7308>>2],u[e+7308>>2]=u[e+7276>>2],u[e+7340>>2]=b,u[e+7276>>2]=u[e+7244>>2],u[e+7244>>2]=u[v+11184>>2],u[e+7344>>2]=u[e+7312>>2],u[e+7312>>2]=u[e+7280>>2],u[e+7280>>2]=u[e+7248>>2],u[e+7248>>2]=u[v+11188>>2],u[e+7348>>2]=u[e+7316>>2],u[e+7316>>2]=u[e+7284>>2],u[e+7284>>2]=u[e+7252>>2],u[e+7252>>2]=u[v+11192>>2],u[e+7352>>2]=u[e+7320>>2],u[e+7320>>2]=u[e+7288>>2],u[e+7288>>2]=u[e+7256>>2],u[e+7256>>2]=u[v+11196>>2],m[v+11132>>2]=g(C(_))+g(-1.9187949895858765),m[v+11124>>2]=g(C(H))+g(-1.260756015777588),m[v+11120>>2]=g(C(Y))+g(-2.1633129119873047),m[v+11116>>2]=g(C(ed))+g(-3.7732150554656982),m[v+11112>>2]=g(C(Z))+g(-1.599784016609192),m[v+11108>>2]=g(C(eo))+g(-1.7706340551376343),m[v+11104>>2]=g(C(ea))+g(-3.475287914276123),m[v+11100>>2]=g(C(es))+g(-5.6849470138549805),m[v+11128>>2]=eb+g(-.7799999713897705),m[v+11136>>2]=m[L>>2]+g(-.15472300350666046),_=m[eS>>2],m[v+11144>>2]=ep+g(-.7437170147895813),m[v+11140>>2]=_+g(-.7246429920196533),m[v+11148>>2]=m[i>>2]+g(.06921599805355072),m[v+11152>>2]=m[e+7428>>2]+g(-.06792999804019928),eu(43872,v+9600|0,v+11056|0),function(e,t,r){var i=g(0),n=0,o=0,a=g(0),c=0,d=0,l=0,h=0,p=0,f=0,_=0,A=0,v=0,b=g(0),T=g(0);M=l=M-512|0,c=u[e+16>>2];t:if(!((0|c)<1)){for(h=E(c,3),_=u[e+12>>2],o=u[e>>2];;){if(m[(l+256|0)+(n<<2)>>2]=s[n+o|0],(0|c)==(0|(n=n+1|0)))break}if((0|c)<1)break t;for(A=u[e+4>>2],o=0,d=(0|_)<1;;){if(!d){for(i=m[(f=(l+256|0)+(o<<2)|0)>>2],n=0;;){if(i=g(i+g(m[(n<<2)+r>>2]*g(s[(E(n,h)+o|0)+A|0]))),(0|_)==(0|(n=n+1|0)))break}m[f>>2]=i}if((0|c)==(0|(o=o+1|0)))break}for(f=u[e+8>>2],o=0;;){for(i=m[(d=(l+256|0)+(o<<2)|0)>>2],n=0;;){if(i=g(i+g(m[(n<<2)+t>>2]*g(s[(E(n,h)+o|0)+f|0]))),(0|c)==(0|(n=n+1|0)))break}if(m[d>>2]=i,(0|c)==(0|(o=o+1|0)))break}if(n=0,(0|c)<=0)break t;for(;;){i=g(1),a=g(g(m[(o=(l+256|0)+(n<<2)|0)>>2]*g(.0078125))*g(.5));d:if(!(a<g(8)^1)){if(i=g(0),a>g(-8)^1)break d;if(i=g(.5),a!=a)break d;a=(p=a<g(0))?g(-a):a,i=g(R(g(g(a*g(25))+g(.5))));u:{if(g(S(i))<g(0x80000000)){d=~~i;break u}d=-0x80000000}i=m[(d<<2)+48128>>2],a=g(a+g(g(0|d)*g(-.03999999910593033))),i=g(i+g(g(g(1)-g(i*a))*g(a*g(g(1)-g(i*i))))),i=g(g((p?g(-i):i)*g(.5))+g(.5))}if(m[o>>2]=i,(0|c)==(0|(n=n+1|0)))break}if((0|c)<1)break t;for(o=u[e>>2],n=0;;){if(m[(l+128|0)+(n<<2)>>2]=s[(n+c|0)+o|0],(0|c)==(0|(n=n+1|0)))break}if((0|c)<1)break t;for(d=c+A|0,o=0,v=(0|_)<1;;){if(!v){for(i=m[(p=(l+128|0)+(o<<2)|0)>>2],n=0;;){if(i=g(i+g(m[(n<<2)+r>>2]*g(s[(E(n,h)+o|0)+d|0]))),(0|_)==(0|(n=n+1|0)))break}m[p>>2]=i}if((0|c)==(0|(o=o+1|0)))break}for(d=c+f|0,o=0;;){for(i=m[(p=(l+128|0)+(o<<2)|0)>>2],n=0;;){if(i=g(i+g(m[(n<<2)+t>>2]*g(s[(E(n,h)+o|0)+d|0]))),(0|c)==(0|(n=n+1|0)))break}if(m[p>>2]=i,(0|c)==(0|(o=o+1|0)))break}if(n=0,(0|c)<=0)break t;for(;;){i=g(1),a=g(g(m[(o=(l+128|0)+(n<<2)|0)>>2]*g(.0078125))*g(.5));et:if(!(a<g(8)^1)){if(i=g(0),a>g(-8)^1)break et;if(i=g(.5),a!=a)break et;a=(p=a<g(0))?g(-a):a,i=g(R(g(g(a*g(25))+g(.5))));er:{if(g(S(i))<g(0x80000000)){d=~~i;break er}d=-0x80000000}i=m[(d<<2)+48128>>2],a=g(a+g(g(0|d)*g(-.03999999910593033))),i=g(i+g(g(g(1)-g(i*a))*g(a*g(g(1)-g(i*i))))),i=g(g((p?g(-i):i)*g(.5))+g(.5))}if(m[o>>2]=i,(0|c)==(0|(n=n+1|0)))break}if((0|c)<1)break t;for(o=c<<1,d=u[e>>2],n=0;;){if(m[(n<<2)+l>>2]=s[(n+o|0)+d|0],(0|c)==(0|(n=n+1|0)))break}if(n=0,(0|c)<=0)break t;for(;;){if(m[(o=n<<2)+(l+384|0)>>2]=m[t+o>>2]*m[(l+128|0)+o>>2],(0|c)==(0|(n=n+1|0)))break}if((0|c)<1)break t;for(A=A+(e=c<<1)|0,o=0,p=(0|_)<1;;){if(!p){for(i=m[(d=(o<<2)+l|0)>>2],n=0;;){if(i=g(i+g(m[(n<<2)+r>>2]*g(s[(E(n,h)+o|0)+A|0]))),(0|_)==(0|(n=n+1|0)))break}m[d>>2]=i}if((0|c)==(0|(o=o+1|0)))break}for(f=e+f|0,o=0;;){for(i=m[(_=(o<<2)+l|0)>>2],n=0;;){if(i=g(i+g(m[(l+384|0)+(n<<2)>>2]*g(s[(E(n,h)+o|0)+f|0]))),(0|c)==(0|(n=n+1|0)))break}if(m[_>>2]=i,(0|c)==(0|(o=o+1|0)))break}if(n=0,(0|c)<=0)break t;for(;;){b=g((i=m[(h=n<<2)+(l+256|0)>>2])*m[t+h>>2]),T=g(g(1)-i),i=g(1),a=g(m[(h=l+h|0)>>2]*g(.0078125));eD:if(!(a<g(8)^1)){if(i=g(-1),a>g(-8)^1)break eD;if(i=g(0),a!=a)break eD;a=(f=a<g(0))?g(-a):a,i=g(R(g(g(a*g(25))+g(.5))));m:{if(g(S(i))<g(0x80000000)){o=~~i;break m}o=-0x80000000}i=m[(o<<2)+48128>>2],a=g(a+g(g(0|o)*g(-.03999999910593033))),i=g(i+g(g(g(1)-g(i*a))*g(a*g(g(1)-g(i*i))))),i=f?g(-i):i}if(m[h>>2]=b+g(T*i),(0|c)==(0|(n=n+1|0)))break}if((0|c)<1)break t;ev(t,l,c<<2)}M=l+512|0}(48016,ek,v+9600|0),eu(48096,v+11048|0,ek),u[J+7640>>2]=u[v+11052>>2],i=u[v+11048>>2],u[J+7636>>2]=l,u[J+7624>>2]=i,u[e+5852>>2]=l,m[J+7616>>2]=P,u[z>>2]=1}if(el=el+em|0,!((0|(eh=eh-em|0))>0))break}u[e+7440>>2]=eC-n}(function(e,t,r){var i=0,n=0,o=g(0),a=0,s=0,c=g(0),d=g(0),l=0,h=0,p=0,f=g(0),_=g(0),A=g(0),v=0,E=g(0),S=g(0);if(n=u[e+8>>2],i=u[e+7452>>2]+((0|r)/((0|n)/400|0)|0)|0,u[e+7452>>2]=i,l=u[e+7444>>2],s=p=u[e+7448>>2],(0|i)>=8&&(s=(((h=(i-((0|i)<15?i:15)|0)+7|0)>>>3|0)+p|0)+1|0,u[e+7448>>2]=s,u[e+7452>>2]=(i-(-8&h)|0)-8),(0|s)>=100&&(u[e+7448>>2]=s-100),h=6,i=p+1|0,s=u[(a=(i=((r=(0|(i=(i=(0|l)==(0|p)?p:((0|n)/50|0)>=(0|r)?p:(0|i)==100?0:i)-((0|i)==(0|l))|0))<0?99:i)<<6)+e|0)+7660|0)>>2],n=u[a+4>>2],u[t+56>>2]=s,u[t+60>>2]=n,n=u[(a=i+7652|0)>>2],s=u[a+4>>2],u[t+48>>2]=n,u[t+52>>2]=s,s=u[(a=i+7644|0)>>2],n=u[a+4>>2],u[t+40>>2]=s,u[t+44>>2]=n,n=u[(a=i+7636|0)>>2],s=u[a+4>>2],u[t+32>>2]=n,u[t+36>>2]=s,s=u[(a=i+7628|0)>>2],n=u[a+4>>2],u[t+24>>2]=s,u[t+28>>2]=n,n=u[(a=i+7620|0)>>2],s=u[a+4>>2],u[t+16>>2]=n,u[t+20>>2]=s,s=u[(a=i+7612|0)>>2],n=u[a+4>>2],u[t+8>>2]=s,u[t+12>>2]=n,n=u[(a=i+7604|0)>>2],s=u[a+4>>2],u[t>>2]=n,u[t+4>>2]=s,n){l=(0|(i=l-p|0))<0,s=i+100|0,o=m[t+4>>2],c=g(1),n=(0|(v=r+1|0))==100?0:v,p=u[e+7444>>2];n:{if((0|n)==(0|p)){d=o;break n}if(c=m[(h=(n<<6)+e|0)+7608>>2],a=u[t+32>>2],h=(0|(h=u[h+7636>>2]))<(0|a)?a:h,u[t+32>>2]=h,d=o>c?o:c,o=g(o+c),(0|p)==(0|(n=(0|(n=n+1|0))==100?0:n))){h=5,c=g(2);break n}if(c=m[(a=(n<<6)+e|0)+7608>>2],h=(0|h)>(0|(a=u[a+7636>>2]))?h:a,u[t+32>>2]=h,d=c<d?d:c,o=g(o+c),(0|p)==(0|(n=(0|(n=n+1|0))==100?0:n))){h=4,c=g(3);break n}c=m[(n=(n<<6)+e|0)+7608>>2],n=u[n+7636>>2],u[t+32>>2]=(0|n)<(0|h)?h:n,d=c<d?d:c,o=g(o+c),h=3,c=g(4)}for(a=l?s:i,l=0,i=r;;){if((0|p)==(0|(i=(0|i)<1?99:i-1|0))||(s=u[t+32>>2],n=u[((i<<6)+e|0)+7636>>2],u[t+32>>2]=(0|n)<(0|s)?s:n,(0|h)==(0|(l=l+1|0))))break}o=g(o/c),d=g(d+g(-.20000000298023224)),m[t+4>>2]=o>d?o:d,i=l=r,(0|a)>=16&&(v=(l=((0|r)>94?-95:5)+r|0)+1|0,i=((0|r)>98?-99:1)+r|0),o=g(y(E=m[((s=e+7604|0)+(i<<6)|0)+36>>2],g(.10000000149011612))),d=g(m[((l<<6)+s|0)+20>>2]*o),l=(0|v)==100?0:v;l:{if((0|p)==(0|l)){c=g(1);break l}for(c=g(1);;){if((0|p)==(0|(i=(0|(i=i+1|0))==100?0:i)))break l;if(A=g(g(E-(f=m[((i<<6)+s|0)+36>>2]))*g(10)),_=_<(S=g(g(d+A)/o))?S:_,c=c>(A=g(g(d-A)/o))?A:c,f=g(y(f,g(.10000000149011612))),d=g(d+g(m[((l<<6)+s|0)+20>>2]*f)),o=g(o+f),(0|p)==(0|(l=(0|(l=l+1|0))==100?0:l)))break}}if(o=g(d/o),m[t+20>>2]=o,_=(d=o>_?o:_)<g(1)?d:g(1),f=(o=o<c?o:c)>g(0)?o:g(0),(0|a)<=9){if(d=f,c=_,(0|(i=u[e+7436>>2]))>=2)for(p=(0|(i=(0|i)>15?15:i-1|0))>1?i:1,i=0;;){if(c=(o=m[(((r=(0|r)<1?99:r-1|0)<<6)+e|0)+7624>>2])<c?c:o,d=o>d?d:o,(0|p)==(0|(i=i+1|0)))break}o=g(g(1)-g(g(0|a)*g(.10000000149011612))),A=g(E*g(.10000000149011612)),_=g(_+g(o*g(g(T(g(A+c),g(1)))-_))),f=g(f+g(o*g(g(y(g(d-A),g(0)))-f)))}m[t+28>>2]=_,m[t+24>>2]=f}})(e,f,n),M=v+11360|0}(e+188|0,u[I+612>>2],a,c,r,h,p,f,X,L,_,I+544|0),O=g(-x),o=0,g(g(1)/g(1<<L))>=(O<N?N:O))break n;if(m[I+580>>2]>g(.10000000149011612)^1)break o;if(x=g(m[e+18128>>2]*g(.9990000128746033)),(0|(o=E(u[e+112>>2],r)))<1)break c;for(v=0,O=g(0);;){if(O=g(O+g((N=m[(v<<2)+t>>2])*N)),(0|(v=v+1|0))==(0|o))break}if(K=g(0|o),g(O/K)<x)break a;for(v=0,O=g(0);;){if(O=g(O+g((N=m[(v<<2)+t>>2])*N)),(0|(v=v+1|0))==(0|o))break}break s}W=-1,u[e+7648>>2]&&tW(e+188|0),J=-1;break o}if(O=g(0),K=g(0|o),g(g(0)/K)<x)break a}x=g(O/K)}m[e+18128>>2]=x}u[e+140>>2]=-1,ed=0,o=1}if(eb=o,u[e+18120>>2]=0,u[I+544>>2]){if(-1e3==u[e+124>>2]){o=e;et:{er:{if((0|(v=u[e+14228>>2]))!=1002){if(v)break er;v=I+564|0;break et}v=I+572|0;break et}v=I+568|0}eA=R(+g(g(g(1)-m[v>>2])*g(100))+.5);f:{if(0x80000000>S(eA)){v=~~eA;break f}v=-0x80000000}u[o+140>>2]=v}a=e,o=u[I+576>>2],v=1101;eo:if(!((0|o)<13)){if(v=1102,(0|o)<15)break eo;if(v=1103,(0|o)<17)break eo;v=(0|o)<19?1104:1105}u[a+18120>>2]=v}O=g(0),!(1==u[e+120>>2]|2!=u[e+112>>2])&&(O=function(e,t,r,i){var n=g(0),o=g(0),a=g(0),s=g(0),c=g(0),d=g(0),u=g(0),l=0,h=g(0),p=g(0),f=g(0),_=g(0),A=g(0),v=0;l=(0|r)/(0|t)|0,h=g(g(g(-25)/g(((0|l)>50?l:50)|0))+g(1));t:{r:{if((0|t)>=4){for(v=t-3|0,r=0;;){if(n=m[(t=r<<3)+e>>2],o=m[(4|t)+e>>2],a=m[(8|t)+e>>2],s=m[(12|t)+e>>2],c=m[(16|t)+e>>2],p=m[(20|t)+e>>2],f=m[(24|t)+e>>2],_=m[(28|t)+e>>2],A=g(A+g(g(g(g(n*o)+g(a*s))+g(c*p))+g(f*_))),d=g(d+g(g(g(g(o*o)+g(s*s))+g(p*p))+g(_*_))),u=g(u+g(g(g(g(n*n)+g(a*a))+g(c*c))+g(f*f))),!((0|v)>(0|(r=r+4|0))))break}if(u<g(1e9)^1)break r}if(d<g(1e9)^1)break r;if(d==d&u==u)break t}d=g(0),A=g(0),u=g(0)}n=g(y(g((n=m[i+8>>2])+g(h*g(d-n))),g(0))),m[i+8>>2]=n,a=g(y(g((o=m[i+4>>2])+g(h*g(A-o))),g(0))),m[i+4>>2]=a,o=g(y(g((o=m[i>>2])+g(h*g(u-o))),g(0))),m[i>>2]=o;a:{if(!((n<o?o:n)>g(7999999797903001e-19))){n=m[i+16>>2];break a}o=g(C(o)),s=g(C(n)),a=(n=g(o*s))>a?a:n,m[i+4>>2]=a,o=g(C(o)),s=g(C(s)),n=g(a/g(n+g(10000000036274937e-31))),c=m[i+12>>2],n=g(g(g(g(S(g(o-s)))/g(g(o+g(10000000036274937e-31))+s))*g(C(g(g(1)-g(n*n)))))-c),o=g(0|l),n=g(c+g(n/o)),m[i+12>>2]=n,n=n<(o=g(m[i+16>>2]+g(g(-.019999999552965164)/o)))?o:n,m[i+16>>2]=n}return g(T(g(n*g(20)),g(1)))}(t,r,u[e+144>>2],e+14260|0)),o=r||u[e+144>>2]/400|0;eb:{eN:{if((0|(v=u[e+164>>2]))!=-1e3){if((0|v)==-1)break eN;a=u[e+144>>2];break eb}v=E(a=u[e+144>>2],u[e+112>>2])+((0|E(a,60))/(0|o)|0)|0;break eb}v=(E(j,a=u[e+144>>2])<<3)/(0|o)|0}u[e+160>>2]=v,o=(0|a)/(0|r)|0;eL:{eD:{m:{c=u[e+148>>2];v:if(c||(j=(0|(v=(((0|(h=(0|E(a,12))/(0|r)|0))/2|0)+((0|E(v,12))/8|0)|0)/(0|h)|0))<(0|j)?v:j,v=(E(h,j)<<3)/12|0,u[e+160>>2]=v,h=1,!((0|j)<2))){eM:if(!((0|j)<3|(0|E(o,24))>(0|v))){if(X=E(o,j),(0|o)>49)break m;if((0|X)<300)break eM;if((0|v)>=2400)break eD}h=j}v=(v=u[e+14240>>2])||1101,a=0,r=u[e+14224>>2],w=(0|o)>100?1002:r||1e3,j=(t=(0|o)==25&(0|w)!=1e3)?50:o;es:{if((0|j)>16){r=j;break es}if(!((0|j)==10|(0|w)!=1e3?(0|n)!=1:0)){t=(0|j)<13,w=1e3,r=(0|j)==12?25:16;break es}a=50/(0|j)|0,t=3,r=50}eR:if((!((0|v)>=1104)||(n=1103,(0|w)!=1e3))&&((0|v)!=1102||(n=1101,(0|w)!=1002))){n=(0|v)<1105&&(0|w)==1001?1104:v}if(j=u[e+14192>>2],v=0,(0|r)<=399){for(;;){if(v=v+1|0,!((0|(r<<=1))<400))break}v<<=3}r=i;ed:{switch(w-1e3|0){case 0:v=v-16|(n<<5)+96&224;break ed;case 2:v=(((0|n)>1102?n:1102)<<5)- -64&96|v|128;break ed;default:break}v=v+240|n<<4|96}if(s[0|r]=((0|j)==2)<<2|t|v,v=t>>>0<2,(0|t)==3&&(s[i+1|0]=a),v=v?1:2,u[e+148>>2])break t;e=(0|h)>(0|v)?h:v,v=ts(i,v,e)?-3:e;break t}if(el=X<<3,p=u[e+40>>2],ee=u[e+44>>2],h=u[e+112>>2],f=v,(0|o)==50)break eL;ep=1,f=E(E(h,-40)-20|0,o-50|0)+v|0;break eL}el=X<<3,p=u[e+40>>2],ee=u[e+44>>2],h=u[e+112>>2],f=v}Y=(0|E(f=c?f:(0|-((0|f)/12))+f|0,Z=ee+90|0))/100|0,er=E(p,12)+20|0,P=(0|E(Y,p))/(0|er)|0,f=127;ew:{switch(u[e+124>>2]-3001|0){case 1:f=0;break ew;case 0:break ew;default:break}if((0|(f=u[e+140>>2]))>=0){if(f=E(f,327)>>8,2049!=u[e+108>>2])break ew;f=(0|f)<115?f:115;break ew}f=2048==u[e+108>>2]?115:48}_=u[e+120>>2];ex:{eh:{if((0|_)!=-1e3){if((0|h)!=2)break eh;u[e+14192>>2]=_,h=_;break ex}if((0|h)!=2)break eh;h=((E(E(f,f),2e3)>>>14|0)+(2==u[e+14192>>2]?16e3:18e3)|0)<(Y-P|0)?2:1}u[e+14192>>2]=h}Y=!(u[I+544>>2]|ed)&0!=u[e+184>>2],u[e+56>>2]=Y,_=ep?E(E(h,-40)-20|0,o-50|0)+v|0:v,_=(0|E(Z,_=c?_:(0|-((0|_)/12))+_|0))/100|0,Q=(0|E(_,p))/(0|er)|0,$=u[e+108>>2];ep:{if((0|$)==2051){_=1002,u[e+14224>>2]=1002,Y=e+14224|0,$=((0|a)/100|0)>(0|r);break ep}P=u[e+136>>2];ef:{if((0|P)==-1e3){q=e,Q=_-Q|0,N=g(g(1)-O),x=g(g(O*g(1e4))+g(N*g(1e4)));e_:{if(g(S(x))<g(0x80000000)){P=~~x;break e_}P=-0x80000000}eo=P,O=g(g(O*g(44e3))+g(N*g(64e3)));R:{if(g(S(O))<g(0x80000000)){_=~~O;break R}_=-0x80000000}if(_=eo+(E(_-P|0,E(f,f))>>14)|0,_=(0|$)==2048?_+8e3|0:_,P=(0|Q)<(((0|(P=u[e+14228>>2]))==1002?_-4e3|0:(0|P)>0?_+4e3|0:_)|0)?1e3:1002,u[q+14224>>2]=P,!(!u[e+48>>2]|128-f>>4>=(0|p))&&(u[e+14224>>2]=1e3,P=1e3),(0|j)>=(0|(_=(0|E(ep?9e3:6e3,r))/(a<<3)|0))?!((0|f)>100&Y):0)break ef;P=(0|_)>(0|j)?1002:1e3}u[e+14224>>2]=P}if(Y=e+14224|0,$=(0|(a=(0|a)/100|0))>(0|r),(0|r)>=(0|a)){_=P;break ep}if(_=1002,(0|P)==1002){_=P;break ep}u[Y>>2]=1002}u[e+176>>2]&&(u[Y>>2]=1002,_=1002),Q=0;eU:{C:{k:if(!((0|(P=u[e+14228>>2]))<1)){if(!((0|_)!=1002?(0|P)==1002:0)){if((0|_)!=1002)break k;if(a=1002,(0|P)==1002)break C}a=1002,ef=1;O:{if((0|_)!=1002){eh=1,a=_;break O}if(q=0,$)break eU;u[Y>>2]=P,ef=0,Q=1,a=P}q=1;break eU}a=_}ef=1,q=0}P:{eB:if(!((0|h)!=1|2!=u[e+14232>>2]|(u[e+68>>2]|(0|P)==1002))&&(0|a)!=1002){h=2,u[e+14192>>2]=2,u[e+68>>2]=1;break P}u[e+68>>2]=0}$=e+V|0,v=ep?E(E(h,-40)-20|0,o-50|0)+v|0:v,h=(0|E(Z,v=c?v:(0|-((0|v)/12))+v|0))/100|0,eo=e;eg:{eV:{eF:{ej:{eG:{D:{eW:{if((-2&a)==1e3){if(c=1,_=1002,Z=0,p=h=(h=(0|ee)<=1?(h<<2)/5|0:h)-((0|E(h,p))/(E(p,6)+10|0)|0)|0,(0|a)!=1002)break eW;break D}if(_=1002,(0|a)==1002){if(Z=0,c=1,(0|ee)>4)break D;h=(0|E(h,9))/10|0;break D}p=h-((0|E(h,p))/(0|er)|0)|0}if(h=p,Z=0,(0|P)==1002&&(eX($,u[e+180>>2],I+440|0),Z=1,a=u[e+14224>>2]),c=1,(0|a)==1002)break D;if(c=0,u[e+84>>2]?0:!u[e+14252>>2])break eG;_=a}v=E(f,f),p=(E(v,2e3)>>14)+12e3|0,f=(E(v,2500)>>14)+11e3|0;M:{eH:{if(!(a=u[e+14252>>2])){if(v=1105,V=1,((u[e+14244>>2]<1105?2e3:-2e3)+p|0)<=(0|h))break eF;if(a)break M;if(u[e+14244>>2]<1104)break eH;f=f-1e3|0;break M}if((0|h)<(0|p))break M;u[e+14240>>2]=1105,u[e+14244>>2]=1105,v=1105;break eV}f=f+1e3|0}if((0|h)>=(0|f)){v=1104,V=1;break eF}if(!a){if(v=1103,V=0,((u[e+14244>>2]<1103?9700:8300)|0)<=(0|h))break eF;if(v=9e3,a)break ej;v=u[e+14244>>2]<1102?9700:8300;break ej}if(v=9e3,(0|h)<9e3)break ej;u[e+14240>>2]=1103,u[e+14244>>2]=1103,v=1103;break eV}v=u[e+14240>>2];break eg}v=(0|h)<(0|v)?1101:1103,V=0}if(u[eo+14240>>2]=v,u[e+14244>>2]=v,a|c|(u[e+88>>2]|1^V))break eV;v=1103,u[e+14240>>2]=1103}a=_}(0|v)>(0|(p=u[e+132>>2]))&&(u[e+14240>>2]=p,v=p),(0|(p=u[e+128>>2]))!=-1e3&&(u[e+14240>>2]=p,v=p),!((0|a)==1002|(0|X)>1874)&&(v=(0|v)<1103?v:1103,u[e+14240>>2]=v),a=u[e+144>>2];eY:{if((0|a)>24e3){V=v;break eY}V=1104;eK:{eQ:{ez:{eX:{if((0|v)<=1104){if((0|a)>=16001){V=v;break eY}if((0|v)>1103)break eX;if((0|a)<12001)break ez;V=v;break eY}if(u[e+14240>>2]=1104,(0|a)>=16001)break eY}if(V=1103,u[e+14240>>2]=1103,(0|a)>=12001)break eY;break eQ}if((0|v)>1102)break eQ;if((0|a)>8e3){V=v;break eY}if(V=v,(0|v)!=1102)break eY;break eK}if(V=1102,u[e+14240>>2]=1102,(0|a)>8e3)break eY}V=1101,u[e+14240>>2]=1101}if(!(!(v=u[e+18120>>2])|(0|p)!=-1e3)){_=e,P=v,p=u[e+14192>>2];eJ:{eq:{if((0|E(p,18e3))>=(0|h)){if(f=0,!c)break eq;c=1,a=1101;break eJ}if((0|E(p,24e3))<(0|h)){f=c;break eq}if(f=c,a=1102,!(1^c))break eJ}c=f,a=(0|E(p,3e4))<(0|h)?(0|E(p,44e3))<(0|h)?1105:1104:1103}v=(0|a)<(0|v)?P:a,u[_+18120>>2]=v,V=(0|v)>(0|V)?V:v,u[e+14240>>2]=V}v=0;W:if(!(!u[e+48>>2]|c)&&(a=u[e+40>>2])){c=125-((0|a)<25?a:25)|0,f=(0|(p=u[e+52>>2]))==1,_=(0|a)<6,v=V;eZ:{for(;;){if(P=u[(a=v<<3)+41864>>2],a=u[a+41868>>2],a=E((P-(f?a:0)|0)+(p?0:a)|0,c),(0|h)>(0|(a=(E(65535&a,655)>>>16|0)+E(a>>16,655)|0))|_)break eZ;if((0|v)>1101){v=v-1|0,u[e+14240>>2]=v;continue}break}u[e+14240>>2]=V,v=0;break W}v=(0|a)<(0|h)}u[e+52>>2]=v,u[I+400>>2]=L,H(D,4036,I+400|0),!((0|(v=u[e+14224>>2]))!=1002|1102!=u[e+14240>>2])&&(u[e+14240>>2]=1103);e$:{Y:{K:{e0:{e2:{Q:{if(u[e+176>>2]){_=1101,u[e+14240>>2]=1101;break Q}if(_=u[e+14240>>2],(0|v)!=1e3)break Q;if((0|_)>1103)break e2}if(!((0|v)!=1001|(0|_)>1103)&&(u[Y>>2]=1e3,v=1e3),(0|(a=(0|(c=u[e+144>>2]))/50|0))<(0|r))break e0;p=v;break K}if(p=1001,u[e+14224>>2]=1001,(0|(a=(0|(c=u[e+144>>2]))/50|0))<(0|r)|((0|E(c,3))/50|0)<(0|r))break Y;break e$}if(p=1e3,(0|v)!=1e3)break Y}if((0|(f=(0|(v=E(c,3)))/50|0))>=(0|r))break e$;if((0|p)!=1e3)break Y;if(((c<<1)/25|0)==(0|r)){a=(0|c)/25|0;break Y}a=((0|v)/25|0)==(0|r)?f:a}v=(0|r)/(0|a)|0,(0|J)!=-1&&(u[e+7640>>2]=W,u[e+7636>>2]=J),v=function(e,t,r,i,n,o,a,s,c){var d=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0,b=0;p=d=M-304|0,M=d,_=r-1|0,l=(0|r)==2?3:(_<<1)+2|0,!(u[e+148>>2]|-1==u[e+164>>2])&&(o=(0|o)>(0|(h=(0|E(u[e+160>>2],3))/((0|E(u[e+144>>2],24))/(0|E(r,i))|0)|0))?h:o),M=A=d-(E(l=(0|(l=(o-l|0)/(0|r)|0))<1276?l+1|0:1276,r)+15&-16)|0,function(e){u[e+4>>2]=0}(p),g=u[e+136>>2],u[e+136>>2]=u[e+14224>>2],S=u[e+128>>2],u[e+128>>2]=u[e+14240>>2],b=u[e+120>>2],d=u[e+14192>>2],u[e+120>>2]=d,m=u[e+68>>2];r:{if(m){u[e+120>>2]=1;break r}u[e+14232>>2]=d}n:{if((0|r)>=1)for(d=0;;){if(u[e+68>>2]=0,u[e+18132>>2]=(0|d)<(0|_),!(!a|(0|d)!=(0|_))&&(u[e+136>>2]=1002),f=-3,h=E(d,l)+A|0,(0|(v=U(e,(E(u[e+112>>2],E(i,d))<<2)+t|0,i,h,l,s,0,0,0,0,0,0,c)))<0||(0|function(e,t,r){return e0(e,t,r,0)}(p,h,v))<0)break n;if((0|(d=d+1|0))==(0|r))break}if((0|(f=ea(p,0,r,n,o,0,!u[e+148>>2])))<0){f=-3;break n}u[e+128>>2]=S,u[e+136>>2]=g,u[e+120>>2]=b,u[e+68>>2]=m}return M=p+304|0,f}(e,t,v,a,i,n,Q,L,A);break t}u[e+14248>>2]&&(u[e+14248>>2]=0,eh=1,q=1,Z=2),v=u[e+160>>2],J=0;e1:{if(!q){P=0,n=0;break e1}if(P=0,n=0,(0|p)==1002)break e1;n=E(a=u[e+14192>>2],40)+20|0,p=(0|E(E(n,200-o|0)+v|0,3))/3200|0,n=P=(0|(J=(a<<3|4)<(0|(n=(0|(n=(((0|E((j<<3)-(n<<1)|0,240))/((48e3/(0|o)|0)+240|0)|0)+n|0)/8|0))>(0|p)?p:n))?(0|n)<257?n:257:0))!=0}eo=n,tS(I+440|0,ec=i+1|0,V=j-1|0),L=n=w-((E(ee=r+en|0,u[e+112>>2])<<2)+15&-16)|0,M=n,p=ev(n,(q=e+14280|0)+(E(w=u[e+112>>2],u[e+172>>2]-en|0)<<2)|0,E(w,en)<<2),Q=(0|E(r,v))/(c<<3)|0,a=e;e4:{if(1002==u[e+14224>>2]){v=tE(60)<<8;break e4}v=u[$+8>>2]}v=E((v=v-(n=u[e+14200>>2])|0)>>16,983)+n+(E(65535&v,983)>>>16)|0,u[a+14200>>2]=v,W=e+14208|0,w=th(v>>8),v=(E(en,a=u[e+112>>2])<<2)+p|0,n=u[e+144>>2];e6:{if(2048==u[e+108>>2]){if(n=(0|E(w<<16>>16,2471))/((0|n)/1e3|0)|0,(0|r)<1)break e6;for(f=(c=((E(w=n<<16>>16,n>>16)+(E(65535&n,w)>>16)|0)+E((n>>15)+1>>1,n)|0)-8388608|0)<<16>>16,ei=65535&(n=(w=E(n,-471)+0x10000000|0)>>6),er=w>>22,et=g(g(((E(f,ei)>>16)+E(er,f)|0)+E((c>>15)+1>>1,n)|0)*g(3725290298461914e-24)),c=E((w>>21)+1>>1,n),em=g(g((c+E(er,n=n<<16>>16)|0)+(E(n,ei)>>16)|0)*g(3725290298461914e-24)),eE=g(g(0|w)*g(3725290298461914e-24)),n=0,eg=g(g(0-(w<<1)|0)*g(3725290298461914e-24)),N=m[e+14212>>2],x=m[e+14208>>2];;){if(z=O=g(eE*(K=m[(w=E(n,a)<<2)+t>>2])),O=g(x+O),z=g(g(z-g(em*O))+g(10000000031710769e-46)),m[e+14212>>2]=z,x=g(g(eg*K)+g(N-g(et*O))),m[e+14208>>2]=x,m[v+w>>2]=O,N=z,(0|(n=n+1|0))==(0|r))break}if((0|a)!=2)break e6;for(c=v+4|0,f=t+4|0,N=m[e+14220>>2],x=m[e+14216>>2],n=0;;){if(z=O=g(eE*(K=m[(w=n<<3)+f>>2])),O=g(x+O),z=g(g(z-g(em*O))+g(10000000031710769e-46)),m[e+14220>>2]=z,x=g(g(eg*K)+g(N-g(et*O))),m[e+14216>>2]=x,m[c+w>>2]=O,N=z,(0|(n=n+1|0))==(0|r))break}break e6}if(N=g(g(18.900001525878906)/g(0|n)),x=g(g(1)-N),O=m[W>>2],(0|a)!=2){if(n=0,(0|r)>0)for(;;){if(K=m[(w=n<<2)+t>>2],m[v+w>>2]=K-O,O=g(g(x*O)+g(g(N*K)+g(10000000031710769e-46))),(0|(n=n+1|0))==(0|r))break}m[W>>2]=O;break e6}if(K=m[e+14216>>2],(0|r)>=1)for(n=0;;){if(z=m[(c=4|(w=n<<3))+t>>2],et=m[t+w>>2],m[v+w>>2]=et-O,m[c+v>>2]=z-K,O=g(g(x*O)+g(g(N*et)+g(10000000031710769e-46))),K=g(g(x*K)+g(g(N*z)+g(10000000031710769e-46))),(0|(n=n+1|0))==(0|r))break}m[e+14216>>2]=K,m[e+14208>>2]=O}e3:if(A){if(O=g(0),(0|(w=E(r,a)))>=1)for(n=0;;){if(O=g(O+g((N=m[(n<<2)+v>>2])*N)),(0|w)==(0|(n=n+1|0)))break}if(O==O?!(O<g(1e9)^1):0)break e3;ex(v,0,w<<2),u[W+8>>2]=0,u[W+12>>2]=0,u[W>>2]=0,u[W+4>>2]=0}x=g(1);e8:{if(1002!=u[Y>>2]){n=1,er=L,M=f=L-((E(r,a)<<1)+15&-16)|0,K=m[I+580>>2],ey=u[I+544>>2],Q=E((((0|(v=j-J|0))<(0|Q)?v:Q)<<3)-8|0,o);e5:{e9:{e7:{te:{tt:{tr:{if((0|(W=u[Y>>2]))==1001){if(a=(u[e+52>>2]<<1)+(u[e+144>>2]==(0|E(r,50))?2:1)|0,A=u[e+148>>2],(0|(v=(0|Q)/(0|(w=u[e+14192>>2]))|0))<12e3)break tr;if(n=2,(0|v)<16e3)break tr;if(n=3,(0|v)<2e4)break tr;if(n=4,(0|v)<24e3)break tr;if(n=5,(0|v)<32e3)break tr;if(n=6,(0|v)<64e3)break tr;n=u[(a<<2)+50840>>2]+((v-64e3|0)/2|0)|0;break tt}if(u[e+36>>2]=Q,A=u[e+14256>>2])break te;a=Q;break e5}L=u[(c=(n=E(n,20))+50720|0)>>2],a<<=2,ei=E(L-v|0,u[(n=n+50700|0)+a>>2]),n=u[n>>2],n=(ei+E(u[a+c>>2],v-n|0)|0)/(L-n|0)|0}if(n=A?n:n+100|0,n=E((0|_)==1104?n+300|0:n,w),a=(0|w)==2&&(0|v)>11999?n-1e3|0:n,u[e+36>>2]=a,!(A=u[e+14256>>2]))break e7;Q=a}if(u[e+148>>2])break e9;a=Q;break e5}x=g(g(1)-g(eI(.6931471805599453*+g(g(a-Q|0)*g(9765625e-10)))));break e5}if(u[e+176>>2]){a=Q;break e5}z=g(8e3),c=13;ti:{tn:{switch((eS=u[e+14240>>2])-1101|0){case 0:break ti;case 1:break;default:break tn}z=g(12e3),c=15;break ti}z=g(16e3),c=17}if(N=g(0),(0|(ei=u[e+112>>2]))>=1)for(L=0;;){for(a=E(L,21),v=0;;){if(et=O=m[(a+v<<2)+A>>2],O=(w=((n=O<g(.5))?O:g(.5))>g(-2))?g(.5):g(-2),N=g(N+((O=w&&n?et:O)>g(0)?g(O*g(.5)):O)),(0|(v=v+1|0))==(0|c))break}if((0|ei)==(0|(L=L+1|0)))break}v=(0-(Q<<1)|0)/3|0,O=g(z*g(g(g(N/g(0|c))*g(0|ei))+g(.20000000298023224)));to:{if(g(S(O))<g(0x80000000)){n=~~O;break to}n=-0x80000000}v=(0|n)>(0|v)?n:v,a=Q+(v=(-2&eS)==1104?(0|E(v,3))/5|0:v)|0,u[e+36>>2]=a}w=u[e+112>>2],u[e+8>>2]=w,c=u[e+14192>>2],u[e+12>>2]=c,n=u[e+144>>2],u[e+32>>2]=(0|E(r,1e3))/(0|n),v=8e3,A=8e3;ta:{switch(_-1101|0){default:if(A=12e3,v=16e3,(0|_)==1103|(0|W)==1001)break ta;tO(50496,50583,1755),k();case 0:break ta;case 1:break}v=12e3,A=12e3}u[e+28>>2]=v,u[e+20>>2]=16e3,u[e+24>>2]=(0|W)==1001?16e3:8e3;ts:if((0|W)==1e3&&!((0|(el=ep?(X<<4)/3|0:el))>7999)){if(u[e+20>>2]=12e3,u[e+28>>2]=A,(0|el)>6999)break ts;u[e+28>>2]=8e3,u[e+20>>2]=8e3}A=K>=g(.10000000149011612),v=V<<3,u[e- -64>>2]=v,L=u[e+148>>2],u[e+60>>2]=!L;tc:{td:{tu:{tl:{if(!(1^P|(0|J)<2)){if(v=(J<<3^-1)+v|0,u[e+64>>2]=v,(0|W)!=1001)break tc;if(v=v-20|0,u[e+64>>2]=v,!L)break td;break tl}if(!L)break tu;if((0|W)!=1001)break tc}a=1,L=(u[e+52>>2]<<1)+((0|E(r,50))==(0|n)?2:1)|0,P=e;th:{tp:if(!((0|(v=((0|E(n,v))/(0|r)|0)/(0|c)|0))<12e3)){if(a=2,(0|v)<16e3)break tp;if(a=3,(0|v)<2e4)break tp;if(a=4,(0|v)<24e3)break tp;if(a=5,(0|v)<32e3)break tp;if(a=6,(0|v)<64e3)break tp;a=u[(L<<2)+50840>>2]+((v-64e3|0)/2|0)|0;break th}W=u[(X=(a=E(a,20))+50720|0)>>2],L<<=2,Q=E(W-v|0,u[(a=a+50700|0)+L>>2]),a=u[a>>2],a=(Q+E(u[L+X>>2],v-a|0)|0)/(W-a|0)|0}a=E((0|_)==1104?a+300|0:a,c),u[P+64>>2]=(0|E((0|c)==2&&(0|v)>11999?a-1e3|0:a,r))/(0|n);break tc}if((0|W)!=1001)break tc}a=(0|E(r,a))/(0|n)|0,u[e+64>>2]=(0|a)>(0|v)?v:a}if(a=e+8|0,A=ey?A:-1,Z){if(v=0,u[I+432>>2]=0,c=(0|n)/400|0,X=((L=E((u[e+172>>2]-c|0)-u[e+116>>2]|0,w)<<2)+e|0)+14280|0,W=u[I+612>>2],eF(X,X,g(0),g(1),u[W+4>>2],c,w,u[W+60>>2],n),ex(q,0,L),(0|(n=E(w=u[e+172>>2],u[e+112>>2])))>=1)for(;;){if(O=(O=g(m[((v<<2)+e|0)+14280>>2]*g(32768)))>g(-32768)?O:g(-32768),d[(v<<1)+f>>1]=tL(O<g(32767)?O:g(32767)),(0|(v=v+1|0))==(0|n))break}F($,a,f,w,0,I+432|0,Z,A),u[e+72>>2]=0,w=u[e+112>>2]}if((0|(n=E(r,w)))>=1)for(w=E(w,en),v=0;;){if(O=(O=g(m[(v+w<<2)+p>>2]*g(32768)))>g(-32768)?O:g(-32768),d[(v<<1)+f>>1]=tL(O<g(32767)?O:g(32767)),(0|(v=v+1|0))==(0|n))break}v=-3;tf:{if(!F($,a,f,r,I+440|0,I+620|0,0,A)){v=u[e+80>>2];t_:{tA:{if((0|(n=u[e+14224>>2]))==1e3){if((0|v)==8e3){_=1101;break t_}if((0|v)==16e3)break tA;if((0|v)!=12e3)break t_;_=1102;break t_}if((0|v)==16e3)break t_;tO(50602,50583,1863),k()}_=1103}tm:{if(u[e+96>>2]){if(v=u[e+18132>>2],u[e+72>>2]=!v,!u[I+620>>2])break tm;if(v)break tf;u[e+14248>>2]=1,eh=0,v=E(n=u[e+14192>>2],40)+20|0,w=(0|E(u[e+160>>2]+E(v,200-o|0)|0,3))/3200|0,eo=(0|(J=(n<<3|4)<(0|(v=(0|(v=(((0|E((j<<3)-(v<<1)|0,240))/((48e3/(0|o)|0)+240|0)|0)+v|0)/8|0))>(0|w)?w:v))?(0|v)<257?v:257:0))!=0;break tf}if(u[e+72>>2]=0,u[I+620>>2])break tf}if(v=0,u[e+18136>>2]=0,t=u[e+14192>>2],(0|(e=u[e+144>>2]/(0|r)|0))<=399){for(;;){if(v=v+1|0,!((0|(e<<=1))<400))break}v<<=3}tv:{switch(n-1e3|0){case 0:e=v-16|(_<<5)+96&224;break tv;case 2:e=(((0|_)>1102?_:1102)<<5)- -64&96|v|128;break tv;default:break}e=v+240|_<<4|96}s[0|i]=e|((0|t)==2)<<2,v=1}break e8}L=er}v=21,(n=_-1101|0)>>>0<=3&&(v=u[(n<<2)+50860>>2]),u[I+384>>2]=v,H(D,10012,I+384|0),u[I+368>>2]=u[e+14192>>2],H(D,10008,I+368|0),u[I+352>>2]=-1,H(D,4002,I+352|0);tE:{if(1e3==u[e+14224>>2]){M=f=L-(((0|E(v=u[e+112>>2],u[e+144>>2]))/400<<2)+15&-16)|0;break tE}u[I+336>>2]=0,H(D,4006,I+336|0),u[I+320>>2]=!u[e+76>>2]<<1,H(D,10002,I+320|0),v=u[e+148>>2],n=u[e+14224>>2];tg:{tS:{tb:{if((0|n)==1001){if(!v){v=u[e+112>>2],M=f=L-(((o=(0|E(v,w=u[e+144>>2]))/400|0)<<2)+15&-16)|0,n=1001;break tg}u[I+256>>2]=u[e+160>>2]-u[e+36>>2],H(D,4002,I+256|0),u[I+240>>2]=0,H(D,4020,I+240|0);break tb}if(!v)break tS;u[I+304>>2]=1,H(D,4006,I+304|0),u[I+288>>2]=u[e+152>>2],H(D,4020,I+288|0),u[I+272>>2]=u[e+160>>2],H(D,4002,I+272|0)}n=u[Y>>2]}if(v=u[e+112>>2],M=f=L-(((o=(0|E(v,w=u[e+144>>2]))/400|0)<<2)+15&-16)|0,(0|n)==1e3)break tE}if((0|(a=u[e+14228>>2]))==(0|n)|(0|a)<1)break tE;ev(f,((E(u[e+172>>2]+((0|-((0|w)/400))-en|0)|0,v)<<2)+e|0)+14280|0,o<<2)}w=E((n=u[e+172>>2])-ee|0,v);tT:{if((0|w)>=1){w<<=2,eC(q,(n=e+14280|0)+(E(r,v)<<2)|0,w),ev(n+w|0,p,E(v,ee)<<2);break tT}ev(q,(E(ee-n|0,v)<<2)+p|0,E(n,v)<<2)}if(!((O=m[e+14204>>2])<g(1)^1?!(x<g(1)):0)&&(v=u[I+612>>2],eF(p,p,O,x,u[v+4>>2],r,u[e+112>>2],u[v+60>>2],u[e+144>>2])),m[e+14204>>2]=x,o=u[e+14224>>2],!(1!=u[e+14192>>2]?(0|o)==1001:0)){n=e,v=16384;ty:if(!((0|h)>32e3)){if(v=0,(0|h)<16e3)break ty;v=16384-((65536e3-(h<<11)|0)/(h-14e3|0)|0)|0}u[n+92>>2]=v}tR:if(!(u[e+14256>>2]|2!=u[e+112>>2])){if(n=d[e+14196>>1],(0|(h=u[e+92>>2]))>16383?(0|n)>=16384:0)break tR;if(x=g(g(1)-g(g(0|h)*g(6103515625e-14))),v=0,w=u[I+612>>2],A=48e3/u[e+144>>2]|0,(0|(a=u[w+4>>2]/(0|A)|0))>0){for(K=g(g(1)-g(g(0|n)*g(6103515625e-14))),c=u[w+60>>2];;){if(z=O=m[(w=p+(n=v<<3)|0)>>2],N=g((N=m[(E(A,v)<<2)+c>>2])*N),et=g(g(x*N)+g(K*g(g(1)-N))),O=g(et*g(g(O-(N=m[(n=(4|n)+p|0)>>2]))*g(.5))),m[w>>2]=z-O,m[n>>2]=N+O,(0|(v=v+1|0))==(0|a))break}v=a}if((0|r)>(0|v))for(;;){if(z=O=m[(w=p+(n=v<<3)|0)>>2],O=g(x*g(g(O-(N=m[(n=(4|n)+p|0)>>2]))*g(.5))),m[w>>2]=z-O,m[n>>2]=N+O,(0|(v=v+1|0))==(0|r))break}d[e+14196>>1]=h}tI:{tC:if(!((0|o)==1002|(b(u[I+468>>2])+(u[I+460>>2]+((0|o)==1001?5:-15)|0)|0)>V<<3)){if((0|o)==1001&&eP(I+440|0,eo,12),!eo)break tC;if(a=1,eP(I+440|0,eh,1),n=(v=u[I+460>>2]+b(u[I+468>>2])|0)-21|0,o=v-32|0,o=(0|(n=(0|(n=(0|(n=V-(((0|(v=u[Y>>2]))==1001?n:o)+7>>3)|0))<(0|J)?n:J))>2?n:2))<257?n:257,c=0,(0|v)!=1001)break tI;eW(I+440|0,o-2|0,256);break tI}a=0,u[e+14248>>2]=0,c=1,o=0}A=u[Y>>2];tk:{if((0|A)==1e3){v=u[I+468>>2],n=u[I+460>>2],es(I+440|0),w=v=(b(v)+n|0)-25>>3;break tk}tI(I+440|0,v=V-o|0),w=0}tw:{if(!(1e3!=u[Y>>2]|a)){n=eh,h=0;break tw}if(u[I+224>>2]=I+544,H(D,10022,I+224|0),1001==u[Y>>2]&&(u[I+432>>2]=u[e+100>>2],u[I+436>>2]=u[e+104>>2],u[I+208>>2]=I+432,H(D,10028,I+208|0)),h=0,!(a&(n=eh)))break tw;if(u[I+192>>2]=0,H(D,10010,I+192|0),u[I+176>>2]=0,H(D,4006,I+176|0),u[I+160>>2]=-1,H(D,4002,I+160|0),(0|B(D,p,u[e+144>>2]/200|0,v+ec|0,o,0))<0){v=-3;break e8}u[I+144>>2]=I+616,H(D,4031,I+144|0),H(D,4028,0),n=1,h=1}u[I+128>>2]=(0|A)==1002?0:17,H(D,10010,I+128|0),A=u[Y>>2];tO:if((0|A)!=1e3){if(!((0|(L=u[e+14228>>2]))==(0|A)|(0|L)<1)&&(H(D,4028,0),B(D,f,u[e+144>>2]/400|0,I+432|0,2,0),u[I+112>>2]=0,H(D,10002,I+112|0)),((u[I+460>>2]+b(u[I+468>>2])|0)-32|0)>v<<3)break tO;if(!(!u[e+148>>2]|(!h|1001!=u[Y>>2]))&&(u[I+96>>2]=u[e+160>>2]-u[e+36>>2],H(D,4002,I+96|0)),u[I+80>>2]=u[e+148>>2],H(D,4006,I+80|0),(0|(w=B(D,p,r,0,v,I+440|0)))<0){v=-3;break e8}if(!u[e+148>>2]|(!h|1001!=u[Y>>2]))break tO;eC(w+ec|0,v+ec|0,o),v=o+v|0}tN:{if(!(n|c)){if(n=u[e+144>>2],H(D,4028,0),u[I+64>>2]=0,H(D,10010,I- -64|0),u[I+48>>2]=0,H(D,10002,I+48|0),u[I+32>>2]=0,H(D,4006,I+32|0),u[I+16>>2]=-1,H(D,4002,I+16|0),A=(0|n)/400|0,n=(0|n)/200|0,1001==u[e+14224>>2]&&(tI(I+440|0,w),v=w),c=r-n|0,B(D,(E(u[e+112>>2],c-A|0)<<2)+p|0,A,I+432|0,2,0),(0|B(D,(E(u[e+112>>2],c)<<2)+p|0,n,v+ec|0,o,0))<0)break tN;u[I>>2]=I+616,H(D,4031,I)}if(A=u[e+14192>>2],c=u[e+14224>>2],v=0,(0|(n=u[e+144>>2]/(0|r)|0))<=399){for(;;){if(v=v+1|0,!((0|(n<<=1))<400))break}v<<=3}n=i;tP:{switch(c-1e3|0){case 0:v=v-16|(_<<5)+96&224;break tP;case 2:v=(((0|_)>1102?_:1102)<<5)- -64&96|v|128;break tP;default:break}v=v+240|_<<4|96}s[0|n]=v|((0|A)==2)<<2,A=u[I+468>>2],u[e+18136>>2]=A^u[I+616>>2],v=1002,v=ef?u[Y>>2]:v,u[e+14228>>2]=v,u[e+14252>>2]=0,u[e+14236>>2]=r,c=u[e+14192>>2],u[e+14232>>2]=c;tD:{if(!(!u[e+184>>2]|!(u[I+544>>2]|ed))){tL:{if(!(1^eb|m[I+580>>2]<g(.10000000149011612)^1)){if(x=m[e+18128>>2],O=g(0),(0|(n=E(u[e+112>>2],r)))>=1)for(v=0;;){if(O=g(O+g((N=m[(v<<2)+t>>2])*N)),(0|(v=v+1|0))==(0|n))break}ed=g(g(O/g(0|n))*g(316.2300109863281))<=x}if(ed){if(v=u[e+18124>>2],u[e+18124>>2]=v+1,(0|v)<10)break tD;if((0|v)<30)break tL;u[e+18124>>2]=10;break tD}u[e+18124>>2]=0;break tD}if(v=0,u[e+18136>>2]=0,t=u[e+14224>>2],(0|(e=u[e+144>>2]/(0|r)|0))<=399){for(;;){if(v=v+1|0,!((0|(e<<=1))<400))break}v<<=3}tM:{switch(t-1e3|0){case 0:e=v-16|(_<<5)+96&224;break tM;case 2:e=(((0|_)>1102?_:1102)<<5)- -64&96|v|128;break tM;default:break}e=v+240|_<<4|96}s[0|i]=e|((0|c)==2)<<2,v=1;break e8}u[e+18124>>2]=0}tx:{if(((u[I+460>>2]+b(A)|0)-32|0)>V<<3){s[0|ec]=0,u[e+18136>>2]=0,w=1;break tx}if(1e3!=u[Y>>2]|a|(0|w)<3)break tx;for(;;){if(l[i+w|0])break tx;if(v=(0|w)>3,w=w-1|0,!v)break}w=2}r=(o+w|0)+1|0;tU:{if(u[e+148>>2]){j=r;break tU}if(v=-3,ts(i,r,j))break e8}v=j;break e8}v=-3}}return M=I+624|0,v}function B(e,t,r,i,n,o){var a=g(0),c=0,h=g(0),p=0,f=g(0),A=0,v=0,I=0,w=0,O=0,N=0,P=0,D=0,L=0,x=0,U=0,B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0,K=0,z=0,X=0,J=0,q=g(0),Z=0,et=0,er=0,ei=0,en=0,eo=0,ea=g(0),ec=0,eu=0,el=0,eh=0,ep=0,e_=0,eA=0,eE=0,eg=0,eS=0,eb=0,eT=0,ey=0,ek=0,ew=0,eO=0,eD=0,eL=0,eU=0,eB=0,eV=0,eF=g(0),ej=0,eG=0,eH=g(0),eY=0,eK=g(0),eQ=g(0),eX=0,eJ=g(0),eq=g(0);M=en=M-192|0,I=u[e+8>>2],A=u[e+4>>2],u[(N=en)+28>>2]=15,u[N+24>>2]=0,u[N+20>>2]=0,u[N+16>>2]=0,u[N+4>>2]=0,w=u[e+36>>2],x=u[e+32>>2],L=u[e>>2],D=u[L+32>>2],F=u[L+4>>2],K=u[L+8>>2],u[N+12>>2]=0,c=-1;t:if(!(!t|(0|n)<2)&&!((0|(U=u[L+36>>2]))<0)){for(er=E(u[e+28>>2],r),H=u[L+44>>2];;){if(H<<O!=(0|er)){if(r=(0|O)<(0|U),O=O+1|0,r)continue;break t}break}n:{if(!o){eO=1,p=1,P=0;break n}eO=tR(o),p=(r=u[o+20>>2]+b(u[o+28>>2])|0)-32|0,P=r-28>>3}a:{s:{if(!u[e+48>>2]){U=F+1024|0,Y=(G=(0|n)<1275?n:1275)-P|0,r=u[e+40>>2];d:{if(u[e+44>>2]){if((0|r)==-1)break s;H=u[L>>2],Z=(ec=(E(r,er)+(H>>4)|0)/(H>>3)|0)>>6;break d}if((0|r)==-1)break s;H=u[L>>2],Z=(G=(0|(H=(0|(H=((E(r,er)+((0|p)>1?p:0)|0)+(H<<2)|0)/(H<<3)|0))>(0|G)?G:H))>2?H:2)-P|0}c=r;break a}tO(42472,42508,1547),k()}Z=Y}r=E(A,U),eA=3-O|0,U=E(G,400),!o&&(tS(N+32|0,i,G),o=N+32|0),eT=e+244|0,r<<=2,eg=E(A,K),i=U>>eA;h:if(!(!u[e+52>>2]|(0|ec)<1)&&!((0|Y)<=(0|(U=(0|(U=((0|p)==1)<<1))>(0|(H=(ec<<1)-u[e+208>>2]>>6))?U:H)))){tI(o,G=P+U|0),Y=U}U=r+eT|0,W=eg<<2,v=(0|i)<(0|c),z=E(I,40),X=400>>>O|0,V=u[L+12>>2],ei=J=en-((E(A,n=F+er|0)<<2)+15&-16)|0,M=J,q=m[e+224>>2],ey=u[e+28>>2],en=(0|E(er-F|0,I))/(0|ey)|0;q:{Z:{if((0|en)>=1){for(r=0;;){if(f=(a=m[(r<<2)+t>>2])>f?f:a,h=a<h?h:a,(0|en)==(0|(r=r+1|0)))break}if(((a=g(-f))<h?h:a)<q)break q;for(r=0,f=g(0),h=g(0);;){if(f=(a=m[(r<<2)+t>>2])>f?f:a,h=a<h?h:a,(0|en)==(0|(r=r+1|0)))break}break Z}if(q>g(0))break q}q=(a=g(-f))<h?h:a}B=E(A,F),H=U+W|0,v=v?i:c,j=(0|c)==-1,eD=z+20|0,z=X-50|0,eS=1,f=g(0),c=(0|E(I,F))/(0|ey)|0;f:{if((0|c)<1){h=g(0);break f}for(en=(en<<2)+t|0,r=0,h=g(0);;){if(f=(a=m[(r<<2)+en>>2])>f?f:a,h=a<h?h:a,(0|c)==(0|(r=r+1|0)))break}}r=B<<2,en=W+H|0,c=j?i:v,i=E(z,eD),v=(0|w)>(0|V),B=G<<3,a=(a=g(-f))<h?h:a,m[e+224>>2]=a,a=a<q?q:a;_:{if((0|p)!=1){z=0;break _}if(eP(o,p=g(g(1)/g(1<<u[e+60>>2]))>=a,15),1^p){z=0,p=1;break _}z=1;A:{if((0|ec)<1){p=B;break A}Y=2,tI(o,Z=(0|(p=P+2|0))>(0|G)?G:p),B=p=(G=Z)<<3}u[o+20>>2]=(p-b(u[o+28>>2])|0)+32,eS=0}for(P=r+eT|0,eT=W+en|0,eu=1<<O,ep=c-i|0,j=v?V:w,ey=(0|A)>1?A:1,i=L+16|0,F=(F<<2)+J|0,r=0;;){if(function(e,t,r,i,n,o,a,s){var c=g(0),d=g(0),u=0,l=g(0),h=g(0);d=m[a>>2],l=m[o>>2];t:{if(!((0|n)!=1|s|m[o+4>>2]!=g(0))){if((0|r)<1)break t;for(o=0;;){if(c=g(m[(E(i,o)<<2)+e>>2]*g(32768)),m[(o<<2)+t>>2]=c-d,d=g(l*c),(0|(o=o+1|0))==(0|r))break}break t}u=(0|r)/(0|n)|0,(0|n)!=1&&ex(t,0,r<<2);o:if(!((0|u)<1)){for(o=0;;){if(m[(E(n,o)<<2)+t>>2]=m[(E(i,o)<<2)+e>>2]*g(32768),(0|u)==(0|(o=o+1|0)))break}if(!s|(0|u)<1)break o;for(o=0;;){if(s=e=(E(n,o)<<2)+t|0,h=(i=((e=(c=m[e>>2])>g(65536))?g(65536):c)<g(-65536))?g(-65536):g(65536),m[s>>2]=e?h:i?h:c,(0|u)==(0|(o=o+1|0)))break}}if((0|r)<1)break t;for(o=0;;){if(c=m[(e=(o<<2)+t|0)>>2],m[e>>2]=c-d,d=g(l*c),(0|(o=o+1|0))==(0|r))break}}m[a>>2]=d}((c=r<<2)+t|0,(E(r,n)<<2)+F|0,er,A,u[e+28>>2],i,(e+c|0)+192|0,0!=u[e+16>>2]&a>g(65536)),(0|ey)==(0|(r=r+1|0)))break}r=0,!(u[e+20>>2]|(!(0!=u[e+64>>2]&(0|Y)>3|(0|E(I,12))<(0|Y))|(x|z)))&&(r=u[e+24>>2]>4),ej=u[e+100>>2],eb=e+120|0,eL=function(e,t,r,i,n,o,a,s,c,d,l,h){var p=0,f=g(0),_=0,A=0,v=0,b=g(0),T=0,I=g(0),w=0,O=0,N=0,P=0,D=0,L=0,x=g(0),U=0,B=0,V=0;for(M=p=M-16|0,O=u[e>>2],w=u[O+4>>2],T=_=p-((E(A=n+1024|0,i)<<2)+15&-16)|0,M=_,v=p,u[p+12>>2]=(A<<2)+_,u[p+8>>2]=_,P=(0|i)>1?i:1,N=n<<2,D=n+w|0,_=(w<<2)+t|0,p=0;;){if(ev(ev(u[(v+8|0)+(p<<2)>>2],(p<<12)+r|0,4096)+4096|0,(E(p,D)<<2)+_|0,N),(0|P)==(0|(p=p+1|0)))break}r:{if(d){M=p=(_=T)-((A<<1&-4)+15&-16)|0,function(e,t,r,i,n){var o=g(0),a=0,s=0,c=0,d=0,l=g(0),h=g(0),p=g(0),f=0,_=0,A=0,v=g(0),E=g(0),S=g(0),b=g(0),T=g(0),y=g(0),R=g(0);if(M=a=M-48|0,f=r>>1,c=u[e>>2],(0|r)>=4)for(A=(0|f)>2?f:2,s=1;;){if(_=(d=s<<3)+c|0,m[(s<<2)+t>>2]=g(m[_>>2]+g(g(m[_-4>>2]+m[(4|d)+c>>2])*g(.5)))*g(.5),(0|A)==(0|(s=s+1|0)))break}if(o=g(g(g(m[c+4>>2]*g(.5))+m[c>>2])*g(.5)),m[t>>2]=o,(0|i)==2){if(c=u[e+4>>2],(0|r)>=4){for(A=(0|f)>2?f:2,s=1;;){if(e=d=(s<<2)+t|0,o=m[d>>2],_=(d=s<<3)+c|0,m[e>>2]=o+g(g(m[_>>2]+g(g(m[_-4>>2]+m[(4|d)+c>>2])*g(.5)))*g(.5)),(0|A)==(0|(s=s+1|0)))break}o=m[t>>2]}m[t>>2]=o+g(g(g(m[c+4>>2]*g(.5))+m[c>>2])*g(.5))}if(s=0,function(e,t,r,i,n,o,a){var s=0,c=0,d=g(0),u=0,l=0;l=s=M,M=s=s-((o<<2)+15&-16)|0;t:{if((0|o)>0){if((0|i)<=-1)break t;if(i){for(u=ev(s,e,o<<2),s=0;;){if(d=m[(c=s<<2)+r>>2],m[c+u>>2]=m[e+c>>2]*d,m[u+(c=(-1^s)+o<<2)>>2]=d*m[e+c>>2],(0|(s=s+1|0))==(0|i))break}e=u}if($(e,e,t,r=o-n|0,n+1|0,a),c=0,(0|n)>=0)for(;;){if(d=g(0),(0|(s=c+r|0))<(0|o))for(;;){if(d=g(d+g(m[(s<<2)+e>>2]*m[(s-c<<2)+e>>2])),(0|(s=s+1|0))==(0|o))break}if(m[(s=(c<<2)+t|0)>>2]=d+m[s>>2],s=(0|n)!=(0|c),c=c+1|0,!s)break}return M=l,0}tO(9687,9671,228),k()}tO(9709,9671,229),k()}(t,a+16|0,0,0,4,f,n),m[a+16>>2]=m[a+16>>2]*g(1.000100016593933),o=m[a+20>>2],m[a+20>>2]=o-g(g(o*g(.00800000037997961))*g(.00800000037997961)),o=m[a+24>>2],m[a+24>>2]=o-g(g(o*g(.01600000075995922))*g(.01600000075995922)),o=m[a+28>>2],m[a+28>>2]=o-g(g(o*g(.024000000208616257))*g(.024000000208616257)),o=m[a+32>>2],m[a+32>>2]=o-g(g(o*g(.03200000151991844))*g(.03200000151991844)),function(e,t,r){var i=g(0),n=0,o=g(0),a=0,s=0,c=0,d=g(0),u=g(0),l=0,h=0,p=0;o=m[t>>2],e=ex(e,0,r<<2);t:if(m[t>>2]!=g(0)){for(l=(0|r)>0?r:0,s=1;;){if((0|n)==(0|l))break t;if(r=0,i=g(0),n)for(;;){if(i=g(i+g(m[(r<<2)+e>>2]*m[(n-r<<2)+t>>2])),(0|n)==(0|(r=r+1|0)))break}if(i=g(g(-g(i+m[((c=n+1|0)<<2)+t>>2]))/o),m[(n<<2)+e>>2]=i,n)for(h=s>>>1|0,r=0;;){if(p=a=(r<<2)+e|0,d=m[a>>2],u=m[(a=((-1^r)+n<<2)+e|0)>>2],m[p>>2]=d+g(i*u),m[a>>2]=u+g(i*d),(0|h)==(0|(r=r+1|0)))break}if(s=s+1|0,n=c,!((o=g(o-g(o*g(i*i))))<g(m[t>>2]*g(.0010000000474974513))^1))break}}}(a,a+16|0,4),o=g(m[a+8>>2]*g(.7289999127388)),m[a+8>>2]=o,l=g(m[a+12>>2]*g(.6560999155044556)),m[a+12>>2]=l,h=g(m[a+4>>2]*g(.809999942779541)),m[a+4>>2]=h,p=g(m[a>>2]*g(.8999999761581421)),m[a>>2]=p,(0|r)>=2)for(E=g(l+g(o*g(.800000011920929))),S=g(o+g(h*g(.800000011920929))),b=g(h+g(p*g(.800000011920929))),T=g(l*g(.800000011920929)),y=g(p+g(.800000011920929)),o=g(0),l=g(0),h=g(0),p=g(0);;){if(v=m[(c=(s<<2)+t|0)>>2],m[c>>2]=g(T*R)+g(g(E*o)+g(g(S*l)+g(g(b*h)+g(g(y*p)+v)))),R=o,o=l,l=h,h=p,p=v,(0|f)==(0|(s=s+1|0)))break}M=a+48|0}(v+8|0,p,A,i,u[e+72>>2]),!function(e,t,r,i,n,o){var a=g(0),s=g(0),c=0,d=0,l=0,h=0,p=g(0),f=g(0),_=g(0),A=0,v=0,E=g(0),S=0,b=0,T=g(0),R=0;R=o=M;t:{if((0|r)>0){if((0|i)<=0)break t;if(M=o=c=o-(((h=r>>>2|0)<<2)+15&-16)|0,M=o=l=o-((-4&(d=r+i|0))+15&-16)|0,M=v=o-(((A=i>>>1|0)<<2)+15&-16)|0,h)for(o=0;;){if(u[(o<<2)+c>>2]=u[(o<<3)+e>>2],(0|h)==(0|(o=o+1|0)))break}if((0|d)>=4)for(d=(0|(o=d>>2))>1?o:1,o=0;;){if(u[(o<<2)+l>>2]=u[(o<<3)+t>>2],(0|d)==(0|(o=o+1|0)))break}if($(c,l,v,h,d=i>>2,o),s=g(1),h)for(o=0;;){if(s=g(s+g((a=m[(o<<2)+l>>2])*a)),(0|h)==(0|(o=o+1|0)))break}if(S=1,(0|i)>3)for(f=g(-1),o=0,_=g(-1);;){a=m[v+(c=o<<2)>>2];l:if(!(a>g(0)^1)){if(a=g(a*g(9999999960041972e-28)),a=g(a*a),g(p*a)>g(_*s)^1)break l;if(g(E*a)>g(f*s)){S=b,b=o,_=f,f=a,p=E,E=s;break l}S=o,_=a,p=s}if(T=g((a=m[(o+h<<2)+l>>2])*a),s=g(y(g(s+g(T-g((a=m[l+c>>2])*a))),g(1))),(0|d)==(0|(o=o+1|0)))break}q:{if(!A){h=r>>1;break q}for(h=r>>1,S<<=1,b<<=1,d=0;;){u[(i=v+(l=d<<2)|0)>>2]=0,c=o=d-b|0,o>>=31;$:if(!((o^o+c)>=3)||(c=o=d-S|0,!(((o>>=31)^o+c)>2))){if(s=g(0),(0|r)>=2)for(c=t+l|0,o=0;;){if(s=g(s+g(m[(l=o<<2)+e>>2]*m[l+c>>2])),(0|h)==(0|(o=o+1|0)))break}m[i>>2]=y(s,g(-1))}if((0|A)==(0|(d=d+1|0)))break}}if(s=g(1),(0|r)>1)for(o=0;;){if(s=g(s+g((a=m[(o<<2)+t>>2])*a)),(0|h)==(0|(o=o+1|0)))break}c=0;en:{if(!A){e=0;break en}for(f=g(-1),E=g(0),e=0,o=0,p=g(0),_=g(-1);;){a=m[v+(l=o<<2)>>2];eO:if(!(a>g(0)^1)){if(a=g(a*g(9999999960041972e-28)),a=g(a*a),g(p*a)>g(_*s)^1)break eO;if(g(E*a)>g(f*s)){e=o,_=f,f=a,p=E,E=s;break eO}_=a,p=s}if(T=g((a=m[(o+h<<2)+t>>2])*a),s=g(y(g(s+g(T-g((a=m[t+l>>2])*a))),g(1))),(0|A)==(0|(o=o+1|0)))break}if((0|e)<1|(A-1|0)<=(0|e))break en;if(c=-1,a=m[(o=(e<<2)+v|0)+4>>2],s=m[o-4>>2],p=m[o>>2],g(a-s)>g(g(p-s)*g(.699999988079071)))break en;c=g(s-a)>g(g(p-a)*g(.699999988079071))}u[n>>2]=(e<<1)+c,M=R;return}tO(9781,9768,302),k()}tO(9738,9768,303),k()}(p+2048|0,p,n,979,v+4|0,u[e+72>>2]),u[v+4>>2]=1024-u[v+4>>2],f=function(e,t,r,i,n,o,a,s){var c=g(0),d=g(0),l=g(0),h=0,p=0,f=0,_=g(0),A=0,v=0,S=g(0),b=0,T=g(0),R=0,I=0,k=g(0),w=g(0),O=0,N=0,P=0,D=0,L=g(0),x=0,U=0,B=0,V=g(0),F=g(0),j=g(0),G=g(0),W=g(0);if(h=u[n>>2]/2|0,A=(0|h)<(0|(R=(0|t)/2|0))?h:R-1|0,u[n>>2]=A,h=(p=R<<2)+e|0,b=(0|i)/2|0,x=0|-((0|o)/2),I=(f=M)-(p+19&-16)|0,(0|i)>=2)for(f=h-(A<<2)|0,o=0;;){if(k=g(k+g((c=m[h+(e=o<<2)>>2])*m[e+f>>2])),_=g(_+g(c*c)),(0|b)==(0|(o=o+1|0)))break}if(m[I>>2]=_,(0|t)>=2)for(o=1,c=_;;){if(l=g(c+g((d=m[h-(e=o<<2)>>2])*d)),c=g(l-g((c=m[(b-o<<2)+h>>2])*c)),m[e+I>>2]=y(c,g(0)),e=(0|o)!=(0|R),o=o+1|0,!e)break}for(U=(O=7)<<1,B=E(O,3),V=g(a*g(.5)),N=A<<1,T=g(k/g(C(g(g(_*(w=m[(A<<2)+I>>2]))+g(1))))),F=g(T*g(.8500000238418579)),j=g(T*g(.8999999761581421)),G=g(T*g(.699999988079071)),p=2,s=A;;){if(o=p<<1,(0|O)<=(0|(v=(p+N>>>0)/(o>>>0)|0))){c:{if((0|p)==2){o=(0|(o=A+v|0))>(0|R)?A:o;break c}o=(E(u[(p<<2)+9808>>2],N)+p>>>0)/(o>>>0)|0}P=o<<2,D=v<<2,c=g(0);u:{if((0|i)<2){d=g(0);break u}for(f=h-P|0,t=h-D|0,o=0,d=g(0);;){if(c=g(c+g((l=m[h+(e=o<<2)>>2])*m[e+f>>2])),d=g(d+g(l*m[e+t>>2])),(0|b)==(0|(o=o+1|0)))break}}d=g(g(d+c)*g(.5)),L=g(g(m[I+D>>2]+m[I+P>>2])*g(.5)),l=g(C(g(g(_*L)+g(1)))),W=l=g(d/l),S=F,e=o=v+x|0,c=a,o>>=31,o^=o+e;q:if(!((0|o)<2)){if(c=g(0),(0|o)!=2)break q;c=(0|E(E(p,p),5))<(0|A)?V:g(0)}S=g(y(g(S-c),g(.4000000059604645)));Z:if(!((0|v)<(0|B))){if(S=g(y(g(G-c),g(.30000001192092896))),(0|v)>=(0|U))break Z;S=g(y(g(j-c),g(.5)))}if(!(W>(c=S)^1)&&(s=v,w=L,k=d,T=l),(0|(p=p+1|0))!=16)continue}break}c=g(0),_=g(1),!(w<=(d=g(y(k,g(0)))))&&(_=g(d/g(w+g(1))));ee:{if((0|i)<2){d=g(0),l=g(0);break ee}for(f=(h-(s<<2)|0)+4|0,o=0;;){if(c=g(c+g(m[h+(e=o<<2)>>2]*m[e+f>>2])),(0|b)==(0|(o=o+1|0)))break}if(d=g(0),(0|i)<=1){l=g(0);break ee}for(f=h-(s<<2)|0,o=0;;){if(d=g(d+g(m[h+(e=o<<2)>>2]*m[e+f>>2])),(0|b)==(0|(o=o+1|0)))break}if(l=g(0),(0|i)<2)break ee;for(f=((-1^s)<<2)+h|0,o=0;;){if(l=g(l+g(m[h+(e=o<<2)>>2]*m[e+f>>2])),(0|b)==(0|(o=o+1|0)))break}}return o=1,o=(o=g(l-c)>g(g(d-c)*g(.699999988079071))?o:g(c-l)>g(g(d-l)*g(.699999988079071))?-1:0)+(s<<1)|0,u[n>>2]=(0|r)>(0|o)?r:o,_>T?T:_}(p,1024,15,n,v+4|0,u[e+104>>2],m[e+108>>2],u[e+72>>2]),u[v+4>>2]>=1023&&(u[v+4>>2]=1022),f=g(f*g(.699999988079071)),f=(0|(p=u[e+56>>2]))>2?g(f*g(.5)):f,f=(0|p)>8?g(0):(0|p)>4?g(f*g(.5)):f;break r}u[v+4>>2]=15,f=g(0)}if(p=u[v+4>>2],d=_=p-(i=u[e+104>>2])|0,f=u[h>>2]?g(f*m[h+40>>2]):f,_>>=31,b=(0|E(_^_+d,10))>(0|p)?g(.4000000059604645):g(.20000000298023224),b=(0|l)<25?g(b+g(.10000000149011612)):b,I=(0|l)<35?g(b+g(.10000000149011612)):b,I=(b=m[e+108>>2])>g(.4000000059604645)?g(I+g(-.10000000149011612)):I,!(f<((I=b>g(.550000011920929)?g(I+g(-.10000000149011612)):I)>g(.20000000298023224)?I:g(.20000000298023224)))){U=1,f=g(R(g(g(g((g(S(g(f-b)))<g(.10000000149011612)?b:f)*g(32))/g(3))+g(.5))));c:{if(g(S(f))<g(0x80000000)){p=~~f;break c}p=-0x80000000}x=g(g((L=(0|(p=(0|p)>7?7:p-1|0))>0?p:0)+1|0)*g(.09375))}for(B=4096-N|0,_=w<<2,b=g(-x),d=(0|n)<1025,V=0-n<<2,p=0;;){A=u[O+44>>2],u[e+104>>2]=(0|i)>15?i:15,l=((E(p,w)<<2)+e|0)+244|0,i=ev((E(p,D)<<2)+t|0,l,_),(A=A-w|0)&&(h=u[e+104>>2],f=g(-m[e+108>>2]),T=u[e+112>>2],em(i+_|0,u[(v+8|0)+(p<<2)>>2]+4096|0,h,h,A,f,f,T,T,0,0,u[e+72>>2])),em((h=A<<2)+(i+_|0)|0,(u[(T=(v+8|0)+(p<<2)|0)>>2]+h|0)+4096|0,u[e+104>>2],u[v+4>>2],n-A|0,g(-m[e+108>>2]),b,u[e+112>>2],o,u[O+60>>2],w,u[e+72>>2]),ev(l,(A=n<<2)+i|0,_),i=(p<<12)+r|0;h:{if(!d){ev(i,u[T>>2]+A|0,4096);break h}ev((eC(i,i+A|0,B)+V|0)+4096|0,u[T>>2]+4096|0,N)}if((0|P)!=(0|(p=p+1|0))){i=u[e+104>>2];continue}break}return m[s>>2]=x,u[a>>2]=u[v+4>>2],u[c>>2]=L,M=v+16|0,U}(e,J,P,A,er,ej,N+28|0,N+24|0,N+80|0,r,Y,eb),eH=m[N+24>>2];ea:if(!(!(eH>g(.4000000059604645))&&(t=0,m[e+108>>2]>g(.4000000059604645)^1)||u[eb>>2]&&(t=0,+m[e+124>>2]>.3^1))){eU=+u[N+28>>2],t=eU>1.26*(eB=+u[e+104>>2])|.79*eB>eU}eG=t;m:{if(!eL){if((p+16|0)>(0|B)|x)break m;eP(o,0,1);break m}eP(o,1,1),eW(o,i=27-(c=b(t=(r=u[N+28>>2])+1|0))|0,6),e4(o,(-16<<i)+t|0,31-c|0),u[N+28>>2]=r,e4(o,u[N+80>>2],3),eR(o,ej,42528,2)}eV=1,!(u[e+64>>2]|u[e+24>>2]<1)&&(r=0,et=function(e,t,r,i,n,o,a){var s=0,c=g(0),d=g(0),h=0,p=0,f=0,_=g(0),A=g(0),v=g(0),b=0,I=0,w=0,O=0,N=g(0),P=0,D=g(0),L=0,x=0,U=g(0),B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0;P=h=M,M=h=h-((t<<2)+15&-16)|0,u[a>>2]=0,b=(0|t)/2|0;t:{r:{i:if(!((0|r)<1)){for(D=o?g(.03125):g(.0625),L=b-5|0,x=E(b,6)-102|0,U=g(0|b),B=+(0|b),V=(0|t)<1,F=h,j=h,G=h,W=h,H=h,Y=(0|t)<36;;){if(!V)for(f=E(t,w),_=g(0),s=0,A=g(0);;){if(c=g(_+(d=m[(s+f<<2)+e>>2])),m[(s<<2)+h>>2]=c,_=g(g(A+c)-g(d+d)),A=g(d+g(c*g(-.5))),(0|(s=s+1|0))==(0|t))break}u[h>>2]=0,u[h+4>>2]=0,u[(s=F)+40>>2]=0,u[s+44>>2]=0,u[j+32>>2]=0,u[s+36>>2]=0,u[G+24>>2]=0,u[s+28>>2]=0,u[W+16>>2]=0,u[s+20>>2]=0,u[H+8>>2]=0,u[s+12>>2]=0,s=0,_=g(0),d=g(0),N=g(0),c=g(0),p=(0|t)>1,v=c;s:if(p){for(;;){if(v=g((c=m[(f=s<<3)+h>>2])*c),c=g(v+g((c=m[(4|f)+h>>2])*c)),d=g(d+g(D*g(c-d))),m[(s<<2)+h>>2]=d,_=g(_+c),(0|b)==(0|(s=s+1|0)))break}if(s=b,A=g(0),N=_,v=c=g(0),!p)break s;for(;;){if(c=g(c+g(g(m[(p=((f=s-1|0)<<2)+h|0)>>2]-c)*g(.125))),m[p>>2]=c,A=c<A?A:c,p=(0|s)>1,s=f,!p)break}v=A}if(c=v,d=N,(_=m[h>>2])!=_)break r;if((d=g(U/g(g(C(.5*+g(d*c)*B))+g(10000000036274937e-31))))!=d)break t;if(f=0,!Y)for(c=g(d*g(64)),s=12;;){d=g(R(g(c*g(m[(s<<2)+h>>2]+g(10000000036274937e-31))))),I=(p=g(T(d,g(127)))<g(0))?0:127,I=d>g(127)?I:p?I:+d;h:{if(0x80000000>S(I)){p=~~I;break h}p=-0x80000000}if(f=l[p+42832|0]+f|0,!((0|L)>(0|(s=s+4|0))))break}if((0|O)<(0|(s=(f<<8)/(0|x)|0))&&(u[n>>2]=w,O=s),(0|(w=w+1|0))==(0|r))break}if(s=(0|O)>200,!o|O-201>>>0>398)break i;u[a>>2]=1,s=0}return m[i>>2]=C(y(+g(g(T(g(y(g(g(C(+(0|E(O,27))))+g(-42)),g(0))),g(163)))*g(.006899999920278788))+-.139,0)),M=P,s}tO(42960,42508,369),k()}tO(42998,42508,370),k()}(J,n,A,N+12|0,N+16|0,r=!x|(0|Z)>14?r:2!=u[e+184>>2],N+4|0)),i=L;es:{g:{if(!(!O|((u[o+20>>2]+b(u[o+28>>2])|0)-29|0)>(0|B))){if(et)break g;eV=0}M=r=X=ei-((E(A,er)<<2)+15&-16)|0,M=r=ei=r-(t=(eg<<2)+15&-16)|0,M=r=n=r-t|0,M=c=z=r-(((eo=E(I,K))<<2)+15&-16)|0,ek=1,et=0,ew=0;break es}M=r=X=ei-((E(A,er)<<2)+15&-16)|0,M=r=ei=r-(t=(eg<<2)+15&-16)|0,M=r=n=r-t|0,M=c=z=r-(((eo=E(I,K))<<2)+15&-16)|0,t=u[e+24>>2];ey:{if((0|t)<8){eV=0;break ey}if(eV=0,eN(L,0,J,X,I,A,O,u[e+28>>2],u[e+72>>2]),ez(L,X,ei,j,I,O,u[e+72>>2]),e9(L,j,w,ei,z,I),eE=1,(0|eo)<1)break ey;for(a=g(g(0|O)*g(.5)),r=0;;){if(m[(t=(r<<2)+z|0)>>2]=a+m[t>>2],(0|eo)==(0|(r=r+1|0)))break}}ew=eu}eN(i,ew,J,X,I,A,O,u[e+28>>2],u[e+72>>2]);ec:{ei:{if((a=m[X>>2])==a){if((0|I)==1)break ei;if(a=m[(er<<2)+X>>2],t=0,a==a)break ec}tO(42531,42508,1729),k()}if(t=0,(0|A)!=2)break ec;u[N+16>>2]=0,t=1}if(eX=t,ez(L,X,ei,j,I,O,u[e+72>>2]),!(!u[e+64>>2]|(0|w)<3))for(r=2;;){if(a=m[(t=(r<<2)+ei|0)>>2],a=a<(h=g(m[ei>>2]*g(9999999747378752e-20)))?a:h,m[t>>2]=a>g(10000000036274937e-31)?a:g(10000000036274937e-31),(0|w)==(0|(r=r+1|0)))break}e9(L,j,w,ei,n,I),el=r=c-((eo<<2)+15&-16)|0,M=r,eh=ex(r,0,eY=w<<2),a=g(0);ek:{eu:if(!x){if(p=u[e+236>>2],a=g(0),!p)break eu;if(t=u[e+64>>2])break ek;el:{ew:{em:if(!((0|I)<1)){for(t=(0|(r=u[e+92>>2]))>2?r:2,e_=_[D>>1],v=0,i=0,h=g(0),f=g(0);;){for(P=E(v,K),c=e_,r=0;;){if(ea=a=m[(r+P<<2)+p>>2],a=(W=((F=a<g(.25))?a:g(.25))>g(-2))?g(.25):g(-2),a=(a=W&&F?ea:a)>g(0)?g(a*g(.5)):a,h=g(h+g(a*g((r<<1|1)-t|0))),F=c<<16,f=g(f+g(a*g(0|(F=(c=d[((r=r+1|0)<<1)+D>>1])-(F>>16)|0)))),i=i+F|0,(0|t)==(0|r))break}if((0|(v=v+1|0))==(0|I))break}if(r=0,(0|i)<=0)break em;for(a=(a=g(g(g(h*g(6))/g(0|E(t+1|0,E(t-1|0,E(t,I)))))*g(.5)))<g(.03099999949336052)?a:g(.03099999949336052),h=g(f/g(0|i)),i=d[(t<<1)+D>>1]/2<<16>>16;;){if(c=r,!(d[((r=r+1|0)<<1)+D>>1]<(0|i)))break}for(q=a>g(-.03099999949336052)?a:g(-.03099999949336052),f=g(h+g(.20000000298023224)),r=0,F=0;;){if(h=g(f+g(q*g(r-c|0))),a=m[p+(i=r<<2)>>2],(0|I)==2&&(a=a>(eF=m[(r+K<<2)+p>>2])?a:eF),!((a=g((a<g(0)?a:g(0))-h))>g(.25)^1)&&(m[i+eh>>2]=a+g(-.25),F=F+1|0),(0|(r=r+1|0))==(0|t))break}if((0|F)<3)break el;if(a=g(f+g(.25)),f=g(0),!(a>g(0)^1))break ew;for(r=0;;){if(m[(c=(r<<2)+eh|0)>>2]=y(g(m[c>>2]+g(-.25)),g(0)),(0|(r=r+1|0))==(0|t))break}f=a;break el}tO(42604,42508,1770),k()}ex(eh,0,t<<2),q=g(0)}eJ=g(q*g(64)),a=g(f+g(.20000000298023224))}if(eF=a,t=u[e+64>>2])break ek;if(h=g(0),(0|w)>(0|x))for(q=ek?g(0):g(g(0|O)*g(.5)),a=g(-10),r=x;;){if(a=g(a+g(-1)),a=a>(f=g(m[(r<<2)+n>>2]-q))?a:f,(0|I)==2&&(a=a>(f=g(m[(r+K<<2)+n>>2]-q))?a:f),h=g(h+a),(0|w)==(0|(r=r+1|0)))break}a=m[e+240>>2],eK=g(T(g(y(g(g(h/g(w-x|0))-a),g(-1.5))),g(3))),m[e+240>>2]=a+g(eK*g(.019999999552965164)),t=0}!eE&&ev(z,n,eo<<2);I:if(O){r=(u[o+20>>2]+b(u[o+28>>2])|0)-29|0;eE:if(!((0|B)<(0|r)|et)){if(et=0,t|x|u[e+24>>2]<5)break eE;r=1,a=m[U>>2];tB:{eA:{if((0|I)==1){if(m[N+80>>2]=a,(0|w)<2)break tB;for(;;){if(a=g(a+g(-1)),a=a>(h=m[U+(t=r<<2)>>2])?a:h,m[(N+80|0)+t>>2]=a,(0|w)==(0|(r=r+1|0)))break}break eA}if(a=a>(h=m[(K<<2)+U>>2])?a:h,m[N+80>>2]=a,(0|w)<2)break tB;for(;;){if(a=g(a+g(-1)),h=m[U+(t=r<<2)>>2],a=a>(h=h>(f=m[(r+K<<2)+U>>2])?h:f)?a:h,m[(N+80|0)+t>>2]=a,(0|w)==(0|(r=r+1|0)))break}}if((0|w)<2)break tB;for(r=w-2|0;;){if(a=m[(t=(N+80|0)+(r<<2)|0)>>2],h=g(m[t+4>>2]+g(-1)),m[t>>2]=a>h?a:h,t=(0|r)>0,r=r-1|0,!t)break}}for(F=(0|I)>1?I:1,c=w-1|0,i=0,W=(0|w)<4,a=g(0);;){if(!W)for(t=E(i,K),r=2;;){if(a=g(a+g(y(g(g(y(m[(t+r<<2)+n>>2],g(0)))-g(y(m[(N+80|0)+(r<<2)>>2],g(0)))),g(0)))),(0|c)==(0|(r=r+1|0)))break}if((0|F)==(0|(i=i+1|0)))break}if(!(g(a/g(0|E(w-3|0,I)))>g(1)^1)){if(eN(L,eu,J,X,I,A,O,u[e+28>>2],u[e+72>>2]),ez(L,X,ei,j,I,O,u[e+72>>2]),e9(L,j,w,ei,n,I),(0|eo)>=1)for(a=g(g(0|O)*g(.5)),r=0;;){if(m[(t=(r<<2)+z|0)>>2]=a+m[t>>2],(0|eo)==(0|(r=r+1|0)))break}u[N+12>>2]=0x3e4ccccd,ew=eu,et=1}r=(u[o+20>>2]+b(u[o+28>>2])|0)-29|0}if((0|r)>(0|B))break I;eP(o,et,3)}M=t=W=el-((E(I,er)<<2)+15&-16)|0,function(e,t,r,i,n,o,a){var s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,v=0,S=0,b=g(0);for(_=(0|o)>1?o:1,A=E(u[e+44>>2],a),p=u[e+32>>2];;){if((0|n)>=1)for(v=E(c,A),S=E(u[e+8>>2],c),h=d[p>>1],l=0;;){if(o=E(a,h),(0|o)<(0|(f=E(h=d[((l=(s=l)+1|0)<<1)+p>>1],a))))for(b=g(g(1)/g(m[(s+S<<2)+i>>2]+g(10000000272452012e-43)));;){if(m[(s=o+v<<2)+r>>2]=b*m[t+s>>2],!((0|f)>(0|(o=o+1|0))))break}if((0|n)==(0|l))break}if((0|_)==(0|(c=c+1|0)))break}}(L,X,t,ei,j,I,eu),c=0,!((0|E(I,15))>(0|Z)|x|u[e+24>>2]<2)&&(c=!u[e+64>>2]),M=t=eE=t-(r=(K<<2)+15&-16)|0,M=t=t-r|0,M=i=v=t-r|0,eq=function(e,t,r,i,n,o,a,s,c,h,p,f,A,v,b,T,I,C,k,w,O){var N=g(0),P=0,D=g(0),L=0,x=0,U=g(0),B=g(0),V=g(0),F=0,j=0,G=g(0),W=0,H=g(0),Y=0,K=0,Q=g(0),z=0,X=0,J=0,q=g(0),Z=0,$=0,ee=0,et=0,er=g(0);if(Z=L=M,M=L=j=L-(P=(E(r,o)<<2)+15&-16)|0,M=F=W=L-P|0,L=0,X=ex(a,0,r<<2),!(x=(0|n)<1))for(N=g(9-s|0),a=0;;){if(P=a<<2,s=a+5|0,m[W+P>>2]=g(g(0|E(s,s))*g(.006200000178068876))+g(g(g(g(g(d[(a<<1)+c>>1])*g(.0625))+g(.5))+N)-m[P+32928>>2]),(0|(a=a+1|0))==(0|n))break}z=(0|o)>1?o:1,H=g(-31.899999618530273);i:{n:{o:{a:{for(;;){if(!x){for(P=E(r,L),a=0;;){if(H=(N=g(m[(a+P<<2)+e>>2]-m[(a<<2)+W>>2]))<H?H:N,(0|(a=a+1|0))==(0|n))break}if((0|z)!=(0|(L=L+1|0)))continue;if(M=a=(L=F)-(P=(r<<2)+15&-16)|0,M=P=a-P|0,(0|n)<1)break a;for(s=0;;){if(m[(x=s<<2)+a>>2]=m[e+x>>2]-m[x+W>>2],(0|(s=s+1|0))==(0|n))break}if(!((0|o)!=2|(0|n)<1))for(s=0;;){if(N=m[(c=(x=s<<2)+a|0)>>2],D=g(m[(r+s<<2)+e>>2]-m[x+W>>2]),m[c>>2]=N>D?N:D,(0|(s=s+1|0))==(0|n))break}if(c=ev(P,a,n<<2),(0|n)>1)break o;Y=n-2|0,K=0;break n}if((0|z)==(0|(L=L+1|0)))break}M=a=(L=F)-(P=(r<<2)+15&-16)|0,M=P=a-P|0}ev(P,a,n<<2),Y=n-2|0,J=(0|o)==2;break i}for(N=m[a>>2],P=1;;){if(D=m[(s=(P<<2)+a|0)>>2],N=(N=g(N+g(-2)))<D?D:N,m[s>>2]=N,(0|(P=P+1|0))==(0|n))break}if(Y=n-2|0,K=0,(0|n)<=1)break n;for(P=Y;;){if(N=m[(s=(P<<2)+a|0)>>2],D=g(m[s+4>>2]+g(-3)),m[s>>2]=N>D?N:D,s=(0|P)>0,P=P-1|0,!s)break}K=1}if(J=(0|o)==2,(0|n)<1)break i;for(N=g(y(g(H+g(-12)),g(0))),P=0;;){D=m[(s=P<<2)+a>>2],D=g(R(g(g(m[s+c>>2]-(N>D?N:D))+g(.5))));$:{if(g(S(D))<g(0x80000000)){L=~~D;break $}L=-0x80000000}if(F=s+O|0,s=(0|(x=L))>0?0:0-x|0,u[F>>2]=32>>>((0|s)<5?s:5),(0|(P=P+1|0))==(0|n))break}}f:{if(!((0|v)<1|(0|b)<51|I)){for($=n-3|0,c=0,ee=(0|n)>4,et=n-1<<2,I=0;;){if(L=j+(a=(s=E(r,I))<<2)|0,Q=m[(O=t+a|0)>>2],a=u[O>>2],u[L>>2]=a,D=Q,a=1,K)for(;;){if(U=m[(P=(a+s<<2)+t|0)-4>>2],D=g(D+g(1.5)),D=(N=m[P>>2])>D?D:N,m[(a<<2)+L>>2]=D,c=g(U+g(.5))<N?a:c,(0|(a=a+1|0))==(0|n))break}if((0|c)>=1)for(N=m[(c<<2)+L>>2],a=c;;){if(D=m[(x=((P=a-1|0)<<2)+L|0)>>2],N=g(N+g(2)),N=(N=N<(U=m[(s+P<<2)+t>>2])?N:U)>D?D:N,m[x>>2]=N,x=(0|a)>1,a=P,!x)break}if(a=2,ee)for(;;){N=m[(x=(P=(a+s<<2)+t|0)-8|0)>>2],x=N>(D=m[x+4>>2]),U=m[P+4>>2],F=U>(B=m[P+8>>2]),V=x?N:D,q=F?U:B,G=(x=(N=x?D:N)>(D=F?B:U))?V:q,N=x?N:D,er=D=m[(F=(a<<2)+L|0)>>2],U=m[P>>2],P=U>(B=x?q:V)^1;eN:{if(!P){if(V=N>U?U:N,!(N>B^1))break eN;V=B>G?G:B;break eN}if(V=N>B?B:N,!(N>U^1))break eN;V=U<G?U:G}if(!(g(V+g(-1))<er)){eD:{if(!P){if(V=N>U?U:N,!(N>B^1))break eD;V=B>G?G:B;break eD}if(V=N>B?B:N,!(N>U^1))break eD;V=U<G?U:G}D=g((N=V)+g(-1))}if(m[F>>2]=D,(0|Y)==(0|(a=a+1|0)))break}if(a=Q>(N=m[O+4>>2]),U=m[L>>2],B=a?Q:N,D=m[O+8>>2],N=a?N:Q,N=g((D>B?B:N<D?D:N)+g(-1)),m[L>>2]=N<U?U:N,D=m[L+4>>2],m[L+4>>2]=N<D?D:N,O=a=(Y<<2)+L|0,B=m[a>>2],N=m[(a=(s+$<<2)+t|0)>>2],G=(P=N>(D=m[a+4>>2]))?N:D,U=m[a+8>>2],N=P?D:N,N=g((U>G?G:N<U?U:N)+g(-1)),m[O>>2]=N<B?B:N,D=m[(a=L+et|0)>>2],m[a>>2]=N<D?D:N,a=0,(0|n)>=1)for(;;){if(N=m[(s=L+(P=a<<2)|0)>>2],D=m[P+W>>2],m[s>>2]=N>D?N:D,(0|(a=a+1|0))==(0|n))break}if((0|z)==(0|(I=I+1|0)))break}eM:{es:{if(!J){if((0|i)>=(0|n))break eM;for(a=i;;){if(m[(P=j+(L=a<<2)|0)>>2]=y(g(m[e+L>>2]-m[P>>2]),g(0)),(0|(a=a+1|0))==(0|n))break}break es}if((0|i)>=(0|n))break eM;for(a=i;;){if(N=m[(P=j+(t=r+a<<2)|0)>>2],N=N>(D=g(m[(L=j+(s=a<<2)|0)>>2]+g(-4)))?N:D,m[P>>2]=N,D=m[L>>2],N=(N=g(N+g(-4)))<D?D:N,m[L>>2]=N,m[L>>2]=g(g(y(g(m[e+s>>2]-N),g(0)))+g(y(g(m[e+t>>2]-m[P>>2]),g(0))))*g(.5),(0|(a=a+1|0))==(0|n))break}}if(!(t=(0|i)<(0|n)))break eM;for(a=i;;){if(N=m[(P=j+(L=a<<2)|0)>>2],D=m[C+L>>2],m[P>>2]=N>D?N:D,(0|(a=a+1|0))==(0|n))break}if(!t)break eM;for(a=i;;){N=g(R(g(g(g(eI(.6931471805599453*+((N=m[j+(L=a<<2)>>2])<g(4)?N:g(4))))*g(13))+g(.5))));ec:{if(g(S(N))<g(0x80000000)){P=~~N;break ec}P=-0x80000000}if(u[w+L>>2]=P,(0|(a=a+1|0))==(0|n))break}}if(!(h|(t=(0|i)>=(0|n))|!f&(0|p)!=0))for(a=i;;){if(m[(L=(a<<2)+j|0)>>2]=m[L>>2]*g(.5),(0|(a=a+1|0))==(0|n))break}if(!t)for(a=i;;){N=g(2);eu:if(!((0|a)>=8)||(N=g(.5),!((0|a)<12))){m[(L=(a<<2)+j|0)>>2]=m[L>>2]*N}if((0|(a=a+1|0))==(0|n))break}ew:if(u[k>>2]&&!((0|(P=(0|n)<19?n:19))<=(0|i))){for(a=i;;){if(m[(L=(a<<2)+j|0)>>2]=m[L>>2]+g(g(l[(a+k|0)+44|0])*g(.015625)),(0|P)==(0|(a=a+1|0)))break}}if(P=0,t)break f;for(c=(b<<1)/3|0,t=0,s=_[(i<<1)+A>>1],F=(!p|!h&(0|f)!=0)^1;;){N=(N=m[(a=j+(x=i<<2)|0)>>2])<g(4)?N:g(4),m[a>>2]=N,a=s<<16,P=E((s=d[((L=i+1|0)<<1)+A>>1])-(a>>16)|0,o)<<v;T:{if((0|P)<=5){P=E(P,a=g(S(N))<g(0x80000000)?~~N:-0x80000000)<<3;break T}if((0|P)>=49){N=g(N*g(8));ep:{if(g(S(N))<g(0x80000000)){a=~~N;break ep}a=-0x80000000}P=(E(P,a)<<3)/8|0;break T}N=g(g(N*g(0|P))/g(6));ef:{if(g(S(N))<g(0x80000000)){a=~~N;break ef}a=-0x80000000}P=E(a,48)}if(!((P=P+t|0)>>6<=(0|c)|F)){P=c<<6,u[(i<<2)+X>>2]=P-t;break f}if(u[x+X>>2]=a,i=L,t=P,(0|n)==(0|L))break}break f}if(P=0,(0|i)>=(0|n))break f;for(;;){if(u[(i<<2)+w>>2]=13,(0|n)==(0|(i=i+1|0)))break}}return u[T>>2]=P,M=Z,H}(n,z,K,x,w,I,eE,u[e+60>>2],u[L+56>>2],et,u[e+44>>2],u[e+52>>2],D,O,Z,N+8|0,u[e+64>>2],eh,eb,t,i),M=i=J=i-r|0;eV:{if(c){if(el=function(e,t,r,i,n,o,a,c,l,h,p){var f=0,_=0,A=0,v=0,b=0,T=0,R=0,I=0,C=0,k=0,w=0,O=0,N=g(0),P=0,D=0,L=0,x=g(0),U=0,B=0,V=g(0),F=0,j=0,G=0,W=g(0);if(U=f=M,k=1,M=A=w=f-(_=(t<<2)+15&-16)|0,f=u[e+32>>2],P=t-1|0,M=A=O=A-(v=(d[f+(t<<1)>>1]-d[(P<<1)+f>>1]<<c<<2)+15&-16)|0,M=A=B=A-v|0,M=A=D=A-_|0,M=L=A-_|0,(0|t)>=1){for(x=g(g(y(g(g(.5)-l),g(-.25)))*g(.03999999910593033)),V=g(x*g((r?c:0)|0)),F=1<<c,j=E(a,h),G=0-(c<<1)|0,W=g(x*g(c+1|0));;){if(a=(((_=d[(T<<1)+f>>1])<<c)+j<<2)+o|0,A=ev(O,a,v=(_=(h=d[((I=T+1|0)<<1)+f>>1]-_|0)<<c)<<2),l=g(0),f=0,!(b=(0|_)<1))for(;;){if(l=g(l+g(S(m[(f<<2)+A>>2]))),(0|_)==(0|(f=f+1|0)))break}N=g(l+g(V*l)),f=0,a=0;o:if(r){if(a=0,(0|h)==1)break o;if(e3(a=ev(B,A,v),_>>c,F),v=0,l=g(0),!b)for(;;){if(l=g(l+g(S(m[(v<<2)+a>>2]))),(0|(v=v+1|0))==(0|_))break}if(l=g(l+g(W*l)),a=0,N>l^1)break o;N=l,a=-1}if((0|(R=(!r&(C=(0|h)!=1))+c|0))>=1)for(;;){if(e3(A,_>>f,1<<f),v=f+1|0,h=r?(-1^f)+c|0:v,f=0,l=g(0),!b)for(;;){if(l=g(l+g(S(m[(f<<2)+A>>2]))),(0|_)==(0|(f=f+1|0)))break}if(N=(f=N>(l=g(l+g(g(x*g(0|h))*l))))?l:N,a=f?v:a,(0|R)==(0|(f=v)))break}if(_=(T<<2)+w|0,f=a<<1,f=r?f:0-f|0,u[_>>2]=f,!(((0|f)!=(0|G)?f:0)|C)&&(u[_>>2]=f-1),(0|t)!=(0|I)){f=u[e+32>>2],T=I;continue}break}I=u[w>>2]}o=f=I-(b=s[(e=r<<2)+(T=(c<<3)+1744|0)|0]<<1)|0,C=u[p>>2],f>>=31,f=E(C,f^f+o),a=_=I-(R=s[(1|e)+T|0]<<1)|0,_>>=31,_=(o=r?0:n)+E(_^_+a,C)|0;Z:{if((0|t)<=1){a=_;break Z}for(;;){if(A=n+f|0,O=h=(a=u[w+(v=k<<2)>>2])-b|0,v=u[p+v>>2],h>>=31,O=E(v,h^h+O),f=O+((0|(h=n+_|0))>(0|f)?f:h)|0,h=a=a-R|0,a>>=31,_=a=E(a^a+h,v)+((0|_)>(0|A)?A:_)|0,(0|(k=k+1|0))==(0|t))break}}v=1,h=_=I-(R=s[(2|e)+T|0]<<1)|0,_>>=31,_=E(_^_+h,C),h=A=I-(T=s[(3|e)+T|0]<<1)|0,A>>=31,A=E(A^A+h,C)+o|0,k=(0|a)>(0|f)?f:a;ee:{if((0|t)<=1){f=A;break ee}for(;;){if(f=n+_|0,o=b=(h=u[w+(a=v<<2)>>2])-R|0,a=u[a+p>>2],b>>=31,o=E(a,b^b+o),_=o+((0|_)<(0|(b=n+A|0))?_:b)|0,o=h=h-T|0,h>>=31,A=f=E(h^h+o,a)+((0|f)<(0|A)?f:A)|0,(0|(v=v+1|0))==(0|t))break}}if(v=1,_=((T=(0|r)!=0&(((0|f)>(0|_)?_:f)|0)<(0|k))?2:0)|e,e=f=I-(b=s[_+(A=(c<<3)+1744|0)|0]<<1)|0,f>>=31,f=E(f^f+e,C),e=_=I-(R=s[(1|_)+A|0]<<1)|0,_>>=31,_=E(_^_+e,C)+(r?0:n)|0,(0|t)<=1)return u[(P<<2)+i>>2]=(0|f)>=(0|_),M=U,T;for(;;){if(A=v<<2,a=n+_|0,u[D+A>>2]=(0|f)>=(0|a),h=n+f|0,u[A+L>>2]=(0|_)<=(0|h),e=r=(c=u[A+w>>2])-R|0,A=u[p+A>>2],r>>=31,_=E(A,r^r+e)+((0|h)<(0|_)?h:_)|0,e=h=c-b|0,h>>=31,f=E(h^h+e,A)+((0|a)>(0|f)?f:a)|0,(0|(v=v+1|0))==(0|t))break}if(_=(0|f)>=(0|_),u[(P<<2)+i>>2]=_,(0|t)>=2)for(f=t-2|0;;){if(_=u[((A=f<<2)+((0|_)==1?L:D)|0)+4>>2],u[i+A>>2]=_,A=(0|f)>0,f=f-1|0,!A)break}return M=U,T}(L,j,et,J,(0|(r=20480/(0|Z)|0))<78?80:r+2|0,W,er,O,m[N+12>>2],u[N+16>>2],t),(0|w)<=(0|V))break eV;for(r=((j<<2)+J|0)-4|0;;){if(u[(V<<2)+J>>2]=u[r>>2],(0|(V=V+1|0))==(0|w))break}break eV}if(!(!x|!u[N+4>>2])){if(el=0,(0|w)<1)break eV;for(r=0;;){if(u[(r<<2)+J>>2]=1,(0|w)==(0|(r=r+1|0)))break}break eV}if(!(!x|(0|Z)>14|2==u[e+184>>2])){if(el=et,(0|w)<1)break eV;ex(J,0,eY);break eV}if(el=0,(0|w)<1)break eV;for(r=0;;){if(u[(r<<2)+J>>2]=et,(0|w)==(0|(r=r+1|0)))break}}for(ek=e+100|0,z=(0|I)>1?I:1,eh=F=i-((eo<<2)+15&-16)|0,M=F,p=0;;){if(!(X=(0|w)<=(0|x)))for(i=E(p,K),r=x;;){if(!(g(S(g((a=m[(c=n+(t=r+i<<2)|0)>>2])-m[t+U>>2])))<g(2)^1)&&(m[c>>2]=a+g(m[t+eT>>2]*g(-.25))),(0|w)==(0|(r=r+1|0)))break}if((0|z)==(0|(p=p+1|0)))break}(function(e,t,r,i,n,o,a,s,c,d,l,h,p,f,_,A,v){var y=0,R=0,I=0,C=0,k=0,w=0,O=g(0),N=0,P=0,D=0,L=g(0),x=0,U=0,B=g(0),V=0,F=0,j=0;M=k=P=M-96|0,D=1;t:if(!p){if(D=0,_)break t;if(p=E(r-t|0,d),m[f>>2]>g(p<<1)^1)break t;D=(0|h)>(0|p)}for(B=g(g(g(m[f>>2]*g(a>>>0))*g(0|A))/g(d<<9)),R=(0|d)>1?d:1,w=u[e+8>>2];;){if((0|t)<(0|i))for(N=E(C,w),p=t;;){if(O=g(m[(A=p+N<<2)+n>>2]-m[o+A>>2]),L=g(L+g(O*O)),(0|(p=p+1|0))==(0|i))break}if((0|R)==(0|(C=C+1|0)))break}N=u[c+20>>2],C=u[c+28>>2],R=u[(I=c)+16>>2],y=u[I+20>>2],i=R,u[(R=k)+88>>2]=i,u[R+92>>2]=y,R=u[I+12>>2],i=y=u[I+8>>2],u[(y=k)+80>>2]=i,u[y+84>>2]=R,y=u[I+4>>2],i=R=u[I>>2],u[(R=k)+72>>2]=i,u[R+76>>2]=y,i=u[I+24>>2],R=u[I+40>>2],p=y=u[I+36>>2],u[(y=k)+56>>2]=p,u[y+60>>2]=R,u[y- -64>>2]=u[I+44>>2],y=u[I+32>>2],p=R=u[I+28>>2],u[(R=k)+48>>2]=p,u[R+52>>2]=y,M=p=A=P-((E(d,w)<<2)+15&-16)|0,x=p=p-((w=E(u[e+8>>2],d)<<2)+15&-16)|0,M=p,A=ev(A,o,w),O=(r-t|0)>10?g(T(g(g(0|h)*g(.125)),g(16))):g(16),P=0,_=(C=(N=b(C)+N|0)-29>>>0>a>>>0)?0:_,w=_|(C=C?0:D),D=g(S(B))<g(0x80000000)?~~B:-0x80000000,O=v?g(3):O,N=N-32|0,w&&(P=ed(e,t,r,n,A,a,N,E(l,84)+33082|0,p,c,d,l,1,O,v)),L=g(T(L,g(200)));c:{d:{if(!C){if(j=tR(c),h=u[c>>2],u[k+40>>2]=u[c+20>>2],y=u[c+12>>2],R=u[I+16>>2],C=y,u[(y=k)+32>>2]=C,u[y+36>>2]=R,y=u[I+8>>2],C=R=u[I+4>>2],u[(R=k)+24>>2]=C,u[R+28>>2]=y,V=u[I+24>>2],y=u[(I=(C=I+28|0)+8|0)>>2],R=u[I+4>>2],I=y,u[(y=k)+8>>2]=I,u[y+12>>2]=R,u[y+16>>2]=u[C+16>>2],R=u[(I=C)>>2],y=u[I+4>>2],I=R,u[(R=k)>>2]=I,u[R+4>>2]=y,M=x=x-(((w=V-i|0)||1)+15&-16)|0,x=ev(x,F=i+h|0,w),y=u[(I=R)+88>>2],R=u[I+92>>2],U=y,u[(y=c)+16>>2]=U,u[y+20>>2]=R,y=u[I+84>>2],U=R=u[I+80>>2],u[(R=c)+8>>2]=U,u[R+12>>2]=y,R=u[I+76>>2],U=y=u[I+72>>2],u[(y=c)>>2]=U,u[y+4>>2]=R,u[y+24>>2]=i,u[C+16>>2]=u[I- -64>>2],y=u[I+60>>2],i=R=u[I+56>>2],u[(R=C)+8>>2]=i,u[R+12>>2]=y,R=u[I+52>>2],i=y=u[I+48>>2],u[(y=C)>>2]=i,u[y+4>>2]=R,i=ed(e,t,r,n,o,a,N,E(l,84)+33040|0,s,c,d,l,0,O,v),!_||(0|i)<=(0|P)&&((0|i)!=(0|P)||(tR(c)+D|0)<=(0|j)))break d;u[c>>2]=h,u[(i=c+4|0)+16>>2]=u[k+40>>2],R=u[k+32>>2],y=u[I+36>>2],t=R,u[(R=c)+12>>2]=t,u[R+16>>2]=y,R=u[I+28>>2],t=y=u[I+24>>2],u[(y=c)+4>>2]=t,u[y+8>>2]=R,u[y+24>>2]=V,u[C+16>>2]=u[I+16>>2],y=u[I+12>>2],t=R=u[I+8>>2],u[(R=C)+8>>2]=t,u[R+12>>2]=y,R=u[I+4>>2],t=y=u[I>>2],u[(y=C)>>2]=t,u[y+4>>2]=R,ev(F,x,w),ev(o,A,E(i=d<<2,u[e+8>>2])),ev(s,p,E(u[e+8>>2],i));break c}ev(o,A,E(i=d<<2,u[e+8>>2])),ev(s,p,E(u[e+8>>2],i));break c}L=g(L+g(g((O=m[(l<<2)+33376>>2])*O)*m[f>>2]))}m[f>>2]=L,M=k+96|0})(L,x,w,j,n,U,B,F,o,I,O,Y,u[e+12>>2],e+84|0,u[e+24>>2]>3,u[e+56>>2],u[e+64>>2]),e_=0,t=u[o+4>>2]<<3,c=(u[o+20>>2]+b(u[o+28>>2])|0)-32|0,V=(0|O)!=0&t>>>0>=c+(1|(r=et?2:4))>>>0,P=0;eH:if(!X){i=(x<<2)+J|0,A=t-V|0;x:{if(A>>>0>=r+c>>>0){eP(o,u[i>>2],r),c=(u[o+20>>2]+b(u[o+28>>2])|0)-32|0,P=u[i>>2];break x}u[i>>2]=0,P=0}if((0|w)==(0|(r=x+1|0)))break eH;for(i=et?4:5,p=P;;){t=(r<<2)+J|0;tV:{if(i+c>>>0<=A>>>0){eP(o,u[t>>2]^p,i),P|=p=u[t>>2],c=(u[o+20>>2]+b(u[o+28>>2])|0)-32|0;break tV}u[t>>2]=p}if((0|w)==(0|(r=r+1|0)))break}}tF:if(V&&l[(r=(O<<3)+1744|0)+(P+(t=et<<2)|0)|0]!=l[((2|t)+P|0)+r|0]){eP(o,el,1),e_=el<<1}if(!X)for(c=(et<<2)+e_|0,i=O<<3,r=x;;){if(u[(t=(r<<2)+J|0)>>2]=s[((u[t>>2]+c|0)+i|0)+1744|0],(0|w)==(0|(r=r+1|0)))break}if(((u[o+20>>2]+b(u[o+28>>2])|0)-28|0)<=(0|B)){eQ:{if(u[e+64>>2]){r=2,u[e+80>>2]=2,u[e+100>>2]=0;break eQ}t=e;eX:{V:{tj:{if(x){if(!u[e+24>>2])break V;if(et)break tj;r=3;break eX}if(!((0|(r=u[e+24>>2]))>2?!((0|E(I,10))>(0|Y)|ew):0)){if(!r)break V;break tj}r=function(e,t,r,i,n,o,a,s,c,l,h){var p=0,f=0,A=0,v=g(0),S=0,b=0,T=0,y=0,R=0,I=0,C=0,w=0,O=0,N=0,P=0,D=0,L=0,M=0,x=0,U=g(0);t:{r:{if((0|s)>0){f=(y=u[e+32>>2])+(s<<1)|0;n:if(!((0|E(d[f>>1]-d[f-2>>1]|0,l))<9)){for(P=E(u[e+44>>2],l),D=(0|c)>1?c:1,L=_[y>>1];;){for(M=(E(R,P)<<2)+t|0,I=L,S=0;;){if(p=I<<16,I=d[((N=S+1|0)<<1)+y>>1],p>>=16,(0|(A=E(I-p|0,l)))>=9){for(x=(E(l,p)<<2)+M|0,U=g(0|A),C=0,f=0,b=0,p=0;;){if(C=((v=g(g((v=m[(p<<2)+x>>2])*v)*U))<g(.015625))+C|0,f=(v<g(.0625))+f|0,b=(v<g(.25))+b|0,(0|A)==(0|(p=p+1|0)))break}w=E(p=u[(S<<2)+h>>2],((f<<1>=(0|A))+(b<<1>=(0|A))|0)+(C<<1>=(0|A))|0)+w|0,O=p+O|0,T=(u[e+8>>2]-4|0)<(0|S)?((f+b<<5>>>0)/(A>>>0)|0)+T|0:T}if((0|(S=N))==(0|s))break}if((0|D)==(0|(R=R+1|0)))break}if(a){p=(p=T?(T>>>0)/(E((s-u[e+8>>2]|0)+4|0,c)>>>0)|0:0)+u[n>>2]>>1,u[n>>2]=p;q:{switch(u[o>>2]){case 2:p=p+4|0;break q;case 0:break;default:break q}p=p-4|0}u[o>>2]=(0|p)>22?2:(0|p)>18}if((0|O)<=0)break r;if((0|w)<=-1)break t;if(f=u[r>>2]+((w<<8>>>0)/(O>>>0)|0)>>1,u[r>>2]=f,p=3,(0|(f=(E(f,3)-(i<<7)|0)+448|0))<318)break n;if(p=2,(0|f)<1022)break n;p=(0|f)<1534}return p}tO(41813,41800,489),k()}tO(41837,41800,545),k()}tO(41865,41800,546),k()}(L,W,e+88|0,u[e+80>>2],e+96|0,ek,(0|eL)!=0,j,I,eu,v);break eX}r=2;break eX}r=0}u[t+80>>2]=r}eR(o,r,42630,5)}if(u[e+64>>2]&&(u[eE>>2]=(0|Z)>26?8:(0|Z)/3|0),eh=Z=eh-((K<<2)+15&-16)|0,M=Z,function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,h=0,p=0,f=0;if((0|(n=u[e+8>>2]))>=1)for(h=((r<<1)+i|0)-1|0,p=u[e+104>>2],a=_[(s=u[e+32>>2])>>1];;){if(f=a<<16,a=d[((c=o+1|0)<<1)+s>>1],u[(o<<2)+t>>2]=E(l[(E(n,h)+o|0)+p|0]- -64|0,E(a-(f>>16)<<r,i))>>2,!((0|(o=c))<(0|(n=u[e+8>>2]))))break}}(L,Z,O,I),v=B<<3,i=0,c=tR(o),!X)for(Y=6,j=x;;){j=(r=j)+1|0,V=eE+(p=r<<2)|0,t=0;tG:if(!(((Y<<3)+c|0)>=(v-i|0))){tW:{if(u[(B=p+Z|0)>>2]<=0){p=0;break tW}for(c=(r=E(d[(j<<1)+D>>1]-d[(r<<1)+D>>1]|0,I)<<O)<<3,P=(0|(r=(0|r)>48?r:48))>(0|c)?c:r,p=Y,r=0;;){if(eP(o,(0|(A=u[V>>2]))>(0|r),p),c=tR(o),(0|r)>=(0|A)){p=r;break tW}if(t=t+P|0,(c+8|0)<(v-(i=i+P|0)|0)){if(p=1,r=r+1|0,u[B>>2]<=(0|t))break tW;continue}break}Y=(0|Y)>2?Y-1|0:2;break tG}if(!p)break tG;Y=(0|Y)>2?Y-1|0:2}if(u[V>>2]=t,(0|w)==(0|j))break}if((0|I)==2){if(O){for(P=_[(D=u[L+32>>2])>>1],f=g(10000000036274937e-31),p=0,q=g(10000000036274937e-31);;){if((0|(r=P<<16>>16<<O))<(0|(t=(P=d[((p=p+1|0)<<1)+D>>1])<<O)))for(;;){if(a=m[(r<<2)+W>>2],q=g(q+g(g(S(g(a+(h=m[(r+er<<2)+W>>2]))))+g(S(g(a-h))))),f=g(f+g(g(S(a))+g(S(h)))),(0|(r=r+1|0))==(0|t))break}if((0|p)==13)break}r=d[D+26>>1]<<O+1,u[N+20>>2]=g(g(q*g(.7071070075035095))*g(r+(O>>>0<2?5:13)|0))>g(f*g(0|r))}r=(0|(r=function(e,t,r,i,n){var o=0;t:if(!((0|i)<1)){for(;;){if(m[(o<<2)+t>>2]>e)break t;if((0|(o=o+1|0))==(0|i))break}o=i}i:{n:if(!((0|n)<(0|o)&&g(m[(i=n<<2)+t>>2]+m[r+i>>2])>e)){if((0|n)<=(0|o)||g(m[(i=(n<<2)-4|0)+t>>2]-m[r+i>>2])<e^1)break i}o=n}return o}(g((0|ep)/1e3|0),42640,42736,21,u[e+232>>2])))<(0|x)?x:r,u[e+232>>2]=(0|r)>(0|w)?w:r}if(p=5,(c+48|0)<=(v-i|0)){B=o;Q:{if(!(u[e+64>>2]?0:(0|x)<=0)){u[e+228>>2]=0,p=5;break Q}v=u[e+232>>2],q=m[N+12>>2],f=g(4);tH:if(!((0|ep)<64e3)){if(f=g(5),(0|ep)>79999)break tH;f=g(g(g(ep-64e3>>10)*g(.0625))+g(4))}if((0|I)==2){for(A=_[(V=u[L+32>>2])>>1],h=g(0),D=0;;){if(r=A<<16,a=g(0),A=d[((D=D+1|0)<<1)+V>>1],r>>=16,(0|(c=A-r<<O))>=1)for(r<<=O,p=(r<<2)+W|0,P=(r+er<<2)+W|0,r=0;;){if(a=g(a+g(m[p+(t=r<<2)>>2]*m[t+P>>2])),(0|c)==(0|(r=r+1|0)))break}if(h=g(h+a),(0|D)==8)break}if(h=ea=g(T(g(S(g(h*g(.125)))),g(1))),(0|v)>=9)for(A=_[V+16>>1],D=8,h=ea;;){if(r=A<<16,a=g(0),A=d[((D=D+1|0)<<1)+V>>1],r>>=16,(0|(c=A-r<<O))>=1)for(r<<=O,p=(r<<2)+W|0,P=(r+er<<2)+W|0,r=0;;){if(a=g(a+g(m[p+(t=r<<2)>>2]*m[t+P>>2])),(0|c)==(0|(r=r+1|0)))break}if(h=(a=g(S(a)))>h?h:a,(0|v)==(0|D))break}eB=eM(+g(g(1.0010000467300415)-g(ea*ea))),a=g(T(g(S(h)),g(1))),eU=eM(+g(g(1.0010000467300415)-g(a*a))),a=g(m[e+228>>2]+g(.25)),h=g(1.4426950408889634*eB),ea=g(h*g(.5)),eQ=g(1.4426950408889634*eU),ea=g((ea>eQ?ea:eQ)*g(-.5)),m[e+228>>2]=a<ea?a:ea,f=g(f+g(y(g(h*g(.75)),g(-4))))}for(c=w-1|0,p=2-w|0,a=g(0),P=0;;){if((0|w)>=2)for(t=E(u[L+8>>2],P),r=0;;){if(a=g(a+g(m[(t+r<<2)+n>>2]*g((r<<1)+p|0))),(0|c)==(0|(r=r+1|0)))break}if((0|z)==(0|(P=P+1|0)))break}r=(a=g(g(g(a/g(0|E(c,I)))+g(1))/g(6)))>g(2),h=(t=a<g(-2))?r?g(2):g(-2):g(2),a=g(g(g(f-(t?h:r?h:a))-eJ)-g(q+q)),u[eb>>2]&&(h=g(m[e+128>>2]+g(.05000000074505806)),r=(h=g(h+h))>g(2),f=(t=h<g(-2))?r?g(2):g(-2):g(2),a=g(a-(t?f:r?f:h))),a=g(R(g(a+g(.5))));tY:{if(g(S(a))<g(0x80000000)){r=~~a;break tY}r=-0x80000000}p=(0|(r=(0|r)<10?r:10))>0?r:0}eR(B,p,42820,7),c=tR(o)}if((0|ec)>=1){r=1275>>>eA|0,n=u[L+36>>2],t=x?(0|(t=(E(I,-72)+ec|0)-32|0))>0?t:0:ec-(eD<<3)|0,A=(0|r)>(0|G),D=n-O|0,t=(P=u[e+52>>2])?(u[e+216>>2]>>D)+t|0:t,el=r=A?G:r;tK:{e5:{e9:{if(!x){V=u[L+32>>2],n=u[e+92>>2],G=u[L+8>>2],A=d[V+((v=n||G)<<1)>>1]<<O,Y=u[e+236>>2],j=u[e+64>>2],h=m[e+228>>2],B=u[e+232>>2],a=m[N+12>>2],eA=u[N+8>>2],A=(0|I)==2?(d[(((0|v)>(0|B)?B:v)<<1)+V>>1]<<O)+A|0:A,e_=u[eb>>2],n=t;tt:if(e_){if(f=m[e+136>>2],n=t,.4>+f^1)break tt;eu=t,f=g(g(g(.4000000059604645)-f)*g(A<<3));tr:{if(g(S(f))<g(0x80000000)){n=~~f;break tr}n=-0x80000000}n=eu-n|0}if((0|I)==2){eu=n,f=g(g(g(g(0|(v=(d[((v=(0|v)>(0|B)?B:v)<<1)+V>>1]<<O)-v|0))*g(.800000011920929))/g(0|A))*g(0|n)),h=(h=g(g((h<g(1)?h:g(1))+g(-.10000000149011612))*g(v<<3)))>f?f:h;tQ:{if(g(S(h))<g(0x80000000)){v=~~h;break tQ}v=-0x80000000}n=eu-v|0}n=((-19<<O)+eA|0)+n|0,h=g(g(a+g(-.04399999976158142))*g(0|n));tz:{if(g(S(h))<g(0x80000000)){v=~~h;break tz}v=-0x80000000}if(n=v+n|0,!(!e_|j)){h=g(A<<3),f=g(m[e+124>>2]+g(-.15000000596046448)),f=g(g(h*g(1.2000000476837158))*(f<g(0)?g(-.11999999731779099):g(f+g(-.11999999731779099))));to:{if(g(S(f))<g(0x80000000)){v=~~f;break to}v=-0x80000000}h=g(h*g(.800000011920929));tX:{if(g(S(h))<g(0x80000000)){B=~~h;break tX}B=-0x80000000}n=v+((eG?B:0)+n|0)|0}if(!(v=!Y|(0|j)!=0)){j=B=(0|n)/4|0,h=g(eF*g(A<<3));tJ:{if(g(S(h))<g(0x80000000)){A=~~h;break tJ}A=-0x80000000}n=(0|(n=A+n|0))<(0|B)?j:n}A=n>>2,B=n,h=g(eq*g(E(d[((G<<1)+V|0)-4>>1]<<O,I)<<3));tc:{if(g(S(h))<g(0x80000000)){V=~~h;break tc}V=-0x80000000}if(n=(0|n)<(0|(A=(0|A)<(0|V)?V:A))?B:A,!(!P|1^v)){h=g(g(n-t|0)*g(.6700000166893005));tl:{if(g(S(h))<g(0x80000000)){n=~~h;break tl}n=-0x80000000}n=n+t|0}if(v=n,Y|a<g(.20000000298023224)^1)break e5;if(a=g(g(((0|(A=(0|(A=96e3-ep|0))<32e3?A:32e3))<0?g(0):g(g(0|A)*g(3099999958067201e-21)))*eK)*g(0|n)),!(g(S(a))<g(0x80000000)))break e9;v=~~a+n|0;break e5}t=(((0|(n=u[e+188>>2]))<100?96>>>eA|0:0)+t|0)-((0|n)>100?144>>>eA|0:0)|0,h=g(g((a=m[N+12>>2])+g(-.25))*g(400));th:{if(g(S(h))<g(0x80000000)){n=~~h;break th}n=-0x80000000}t=t+n|0,n=a>g(.699999988079071)?(0|t)>400?t:400:t,t=(0|(t=((i+c|0)+63>>6)+2|0))>(0|(i=(i+eO|0)+359>>6))?t:i;break tK}v=n- -0x80000000|0}t<<=1,n=(0|t)<(0|(n=v))?t:n,t=((i+c|0)+63>>6)+2|0}c=(0|(t=(0|t)>(0|(c=(n=n+c|0)+32>>6))?t:c))>(0|r)?el:t,a=g(.0010000000474974513),(0|(t=u[e+220>>2]))<=969&&(u[e+220>>2]=t+1,a=g(g(1)/g(t+21|0))),t=eS?c:2;tq:if(P){c=u[e+208>>2]+((eS?c<<6:128)-ec|0)|0,u[e+208>>2]=c,v=e,i=((eS?n-ec|0:0)<<D)-u[e+216>>2]|0,a=g(a*g(i-(n=u[e+212>>2])|0));tZ:{if(g(S(a))<g(0x80000000)){i=~~a;break tZ}i=-0x80000000}if(n=i+n|0,u[v+212>>2]=n,u[e+216>>2]=0-n,(0|c)>-1)break tq;u[e+208>>2]=0,t=(eS?0|-((0|c)/64):0)+t|0}tI(o,G=(0|t)>(0|r)?r:t)}M=r=eh-(t=(K<<2)+15&-16)|0,M=c=n=r-t|0,A=i=c-t|0,M=i,c=(V=G<<6)+(-1^tR(o))|0,P=0,B=L,Y=x,j=w,ek=e+232|0,eO=N+20|0,v=c,t=0;t$:if(!(O>>>0<2)){if(t=0,!et)break t$;t=(P=((O<<3)+16|0)<=(0|c))<<3}if(D=v-t|0,eD=N+80|0,eh=n,el=r,eu=i,e_=I,eG=O,ec=o,eL=u[e+92>>2],u[eb>>2]){eA=v=u[e+152>>2],c=13;tf:if(!((0|E(I,32e3))>(0|ep))){if(c=16,(0|E(I,48e3))>(0|ep))break tf;if(c=18,(0|E(I,6e4))>(0|ep))break tf;c=(0|E(I,8e4))>(0|ep)?19:20}c=(0|c)<(0|v)?eA:c}else c=w-1|0;for(p=c=function(e,t,r,i,n,o,a,s,c,h,p,f,A,m,v,g,S,b,T){var y=0,R=0,I=0,C=0,w=0,O=0,N=0,P=0,D=0,L=0,x=0,U=0,B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0,K=0,Q=0,z=0,X=0;z=y=M,K=((0|(c=(0|c)>0?c:0))>7)<<3,F=c-K|0,H=u[e+8>>2];t:if((0|m)==2){if((0|(G=l[(r-t|0)+42192|0]))>(0|F)){G=0;break t}W=((0|(c=F-G|0))>7)<<3,F=c-W|0}if(M=y=w=y-(c=(H<<2)+15&-16)|0,M=y=U=y-c|0,M=y=D=y-c|0,L=m<<3,M=j=y-c|0,!(Y=(0|t)>=(0|r)))for(N=v+3|0,O=E((o-v|0)-5|0,m),R=_[(P=u[e+32>>2])+(t<<1)>>1],c=t;;){if(o=R<<16,I=c<<2,C=E(o=(R=d[((y=c+1|0)<<1)+P>>1])-(o>>16)|0,3)<<v<<3>>4,u[D+I>>2]=(0|C)<(0|L)?L:C,u[I+j>>2]=(E(E((-1^c)+r|0,O),o)<<N>>6)-(o<<v==1?L:0),c=y,(0|r)==(0|y))break}V=(Q=u[e+48>>2])-1|0,x=1;a:{for(;;){if(B=x+V>>1,!Y){for(N=E(B,H),I=_[(O=u[e+32>>2])+(r<<1)>>1],P=u[e+52>>2],R=0,c=r,C=0;;){y=(o=E(E((o=I<<16>>16)-(I=d[((c=c-1|0)<<1)+O>>1])|0,m),l[(c+N|0)+P|0])<<v)>>2,C=!C,(0|o)>=4&&(y=(0|(y=u[(c<<2)+j>>2]+y|0))>0?y:0),y=u[(o=c<<2)+i>>2]+y|0;l:{if(!((0|y)<u[o+D>>2]?C:0)){y=(0|(o=u[n+o>>2]))>(0|y)?y:o,C=1;break l}y=(0|y)<(0|L)?0:L,C=0}if(R=R+y|0,!((0|t)<(0|c)))break}if(x=(c=(0|R)>(0|F))?x:B+1|0,(0|x)<=(0|(V=c?B-1|0:V)))continue;if(B=t,Y)break a;for(X=E(x,H),P=E(x-1|0,H),N=_[(V=u[e+32>>2])+(t<<1)>>1],O=u[e+52>>2],B=c=t;;){if(y=N<<16,y=E((N=d[((o=c+1|0)<<1)+V>>1])-(y>>16)|0,m),R=E(y,l[(c+P|0)+O|0])<<v,y=(0|x)>=(0|Q)?u[(c<<2)+n>>2]:E(l[(c+X|0)+O|0],y)<<v>>2,I=R>>2,(0|R)>=4&&(I=(0|(R=u[(c<<2)+j>>2]+I|0))>0?R:0),(0|y)>=1&&(y=(0|(y=u[(c<<2)+j>>2]+y|0))>0?y:0),C=u[(R=c<<2)+i>>2],I=((0|x)>1?C:0)+I|0,u[R+w>>2]=I,y=(y-I|0)+C|0,u[R+U>>2]=(0|y)>0?y:0,B=(0|C)>0?c:B,(0|(c=o))==(0|r))break}break a}if(x=(c=(0|F)<0)?x:B+1|0,!((0|x)<=(0|(V=c?B-1|0:V))))break}B=t}for(i=(0|m)>1,O=64,N=0,P=0;;){er:{if(C=O+N>>1,o=r,R=0,I=0,!Y){for(;;){y=(E(u[U+(c=(o=o-1|0)<<2)>>2],C)>>6)+u[c+w>>2]|0;eo:{if(!((0|y)<u[c+D>>2]?!I:0)){c=(0|(c=u[n+c>>2]))>(0|y)?y:c,I=1;break eo}c=(0|y)<(0|L)?0:L,I=0}if(R=R+c|0,!((0|t)<(0|o)))break}if(N=(c=(0|R)>(0|F))?N:C,O=c?C:O,(0|(P=P+1|0))!=6)continue;for(c=0,R=r,I=0;;){if(C=(0|(o=u[(y=(R=R-1|0)<<2)+w>>2]+(E(u[y+U>>2],N)>>6)|0))>=u[y+D>>2],O=y+p|0,y=(0|(o=I?o:C?o:(0|o)<(0|L)?0:L))<(0|(y=u[n+y>>2]))?o:y,u[O>>2]=y,c=c+y|0,I|=C,!((0|t)<(0|R)))break}break er}if(c=0,N=(y=(0|F)<0)?N:C,O=y?C:O,(0|(P=P+1|0))!=6)continue}break}C=r-1|0;eN:{ea:{if((0|B)>=(0|C)){o=r,y=G;break ea}for(V=t+2|0,U=L+8|0,I=r;;){if(R=d[(y=u[e+32>>2])+(I<<1)>>1],x=R-(N=d[((o=C)<<1)+y>>1])|0,w=u[(C=(j=o<<2)+p|0)>>2],P=((O=F-c|0)>>>0)/(R-(y=d[(t<<1)+y>>1])>>>0)|0,y=E(y-R|0,P)+O+(y-N)|0,R=(w+E(x,P)|0)+((0|y)>0?y:0)|0,(0|R)>=(((0|(y=u[D+j>>2]))>(0|U)?y:U)|0)){v:{E:{if(S){if(!((0|I)<=(0|V)|(E((0|I)>17?(0|b)<(0|I)?9:7:0,x)<<v<<3>>4<(0|R)?(0|o)<=(0|T):0))){eP(g,0,1);break v}eP(g,1,1);break E}if(!eZ(g,1))break v}o=I,y=G;break eN}R=R-8|0,w=u[C>>2],c=c+8|0}if((0|(y=G))>=1&&(y=l[(o-t|0)+42192|0]),R=(0|R)<(0|L)?0:L,u[C>>2]=R,c=((c-(w+G|0)|0)+R|0)+y|0,G=y,!((0|B)<(0|(C=(I=o)-1|0))))break}}F=F+K|0}ey:{eR:{eI:{if((0|t)<(0|o)){ei:{eC:{ed:{S:{b=W;ek:{if((0|y)>=1){if(!S)break S;y=(0|o)>(0|(y=u[a>>2]))?y:o,u[a>>2]=y,eW(g,y-t|0,(o-t|0)+1|0),y=u[a>>2];break ek}u[a>>2]=0,y=0}if(y=(R=(0|y)>(0|t))?0:b,!W|!R)break eC;if(!S)break ed;eP(g,u[s>>2],1);break ei}if(y=ef(g,(o-t|0)+1|0)+t|0,u[a>>2]=y,y=(R=(0|t)<(0|y))?0:W,!W|!R)break eC}u[s>>2]=eZ(g,1);break ei}u[s>>2]=0}for(B=v<<3,U=d[(C=u[e+32>>2])+(t<<1)>>1],O=E(w=((N=(F-c|0)+y|0)>>>0)/((R=d[(o<<1)+C>>1])-U>>>0)|0,U-R|0),R=U,c=t;;){if(I=R<<16,D=(c<<2)+p|0,R=d[((y=c+1|0)<<1)+C>>1],u[D>>2]=u[D>>2]+E(R-(I>>16)|0,w),c=y,(0|o)==(0|y))break}for(c=O+N|0,I=U,y=t;;){if(D=I<<16,w=(y<<2)+p|0,y=(0|c)<(0|(y=(I=d[((R=y+1|0)<<1)+C>>1])-(D>>16)|0))?c:y,u[w>>2]=y+u[w>>2],c=c-y|0,(0|(y=R))==(0|o))break}x=(0|m)>1?4:3,D=0;em:{for(;;){if((0|t)==(0|o))break em;if((0|(R=u[(y=p+(c=t<<2)|0)>>2]))<=-1)break eI;w=U<<16,I=R+D|0,w=(U=d[((N=t+1|0)<<1)+C>>1])-(w>>16)<<v;T:{if((0|w)>=2){P=0,R=(0|(R=I-u[n+c>>2]|0))>0?R:0,O=I-R|0,u[y>>2]=O,I=E(m,w),!(u[s>>2]|((0|w)==2|(0|m)!=2))&&(P=u[a>>2]>(0|t)),P=(I=I+P|0)<<3,g=((0|w)==2?P>>2:0)+E(I,-21)|0,j=O+(t=g+((w=E(d[u[e+56>>2]+(t<<1)>>1]+B|0,I))>>1)|0)|0;eP:{if((0|j)<I<<4){t=(w>>2)+t|0;break eP}if((0|E(I,24))<=(0|j))break eP;t=(w>>3)+t|0}w=c+f|0,I=(((0|(O=((I<<2)+O|0)+t|0))>0?O:0)>>>0)/(I>>>0)>>>3|0,u[w>>2]=I,O=u[y>>2],(0|E(m,I))>O>>3&&(I=O>>i>>3,u[w>>2]=I),I=(0|I)<8?I:8,u[w>>2]=I,u[c+A>>2]=(u[y>>2]+t|0)<=(0|E(I,P)),u[y>>2]=u[y>>2]-E(u[w>>2],L);break T}R=(0|(t=I-L|0))>0?t:0,u[y>>2]=I-R,u[c+f>>2]=0,u[c+A>>2]=1}if(R?(g=t=c+f|0,I=(0|(I=R>>>x|0))<(0|(w=8-(t=u[t>>2])|0))?I:w,u[g>>2]=t+I,t=E(I,L),u[c+A>>2]=(0|t)>=(R-D|0),D=R-t|0):D=0,u[y>>2]<=-1)break eR;if(t=N,!(u[c+f>>2]>-1))break}tO(42296,42253,514),k()}if(u[h>>2]=D,(0|r)>(0|o))for(c=o;;){if(R=(y=c<<2)+f|0,I=u[(t=p+y|0)>>2]>>i>>3,u[R>>2]=I,u[t>>2]!=(0|E(I,L)))break ey;if(u[t>>2]=0,u[A+y>>2]=u[R>>2]<1,(0|(c=c+1|0))==(0|r))break}return M=z,o}tO(42216,42253,391),k()}tO(42265,42253,442),k()}tO(42265,42253,513),k()}tO(42328,42253,524),k()}(B,Y,j,eE,Z,p,ek,eO,D,eD,eh,el,eu,e_,eG,ec,1,eL,u[e+64>>2]?1:c),(D=u[e+92>>2])&&(p=(0|(p=D+1|0))<(0|(D=(0|c)<(0|(D=D-1|0))?D:c))?p:D),D=G<<3,u[e+92>>2]=p,function(e,t,r,i,n,o,a,s){var c=0,d=0,l=g(0),h=0,p=0,f=0,_=0,A=0,v=0,b=0,T=g(0),y=g(0);if((0|t)<(0|r))for(v=(0|s)>1?s:1;;){if((0|(d=u[(_=(t<<2)+o|0)>>2]))>=1)for(b=(p=65536<<d>>16)-1|0,T=g(0|p),c=u[e+8>>2],s=0;;){f=a,l=g(R(g(g(m[(E(s,c)+t<<2)+n>>2]+g(.5))*T)));o:{if(g(S(l))<g(0x80000000)){c=~~l;break o}c=-0x80000000}if(e4(f,h=(0|(c=(0|c)<(0|p)?c:b))>0?c:0,d),f=d=(A=E(c=u[e+8>>2],s)+t<<2)+i|0,y=m[d>>2],d=u[_>>2],l=g(g(g(g(g(0|h)+g(.5))*g(1<<14-d))*g(6103515625e-14))+g(-.5)),m[f>>2]=y+l,m[(h=n+A|0)>>2]=m[h>>2]-l,(0|v)==(0|(s=s+1|0)))break}if((0|r)==(0|(t=t+1|0)))break}}(L,x,w,U,F,r,o,I),p=0,M=A=A-(eo+15&-16)|0,function(e,t,r,i,n,o,a,c,h,p,f,_,A,v,S,b,T,y,R,I,C,w,O){var N=0,P=0,D=0,L=0,x=0,U=0,B=0,V=0,F=0,j=0,G=g(0),W=g(0),H=0,Y=0,K=0,z=0,X=0,J=0,q=0,Z=0,$=0,et=0,er=0,ei=0,en=0,eo=g(0),ea=0,es=0,ec=0,ed=0,eu=0,el=0,eh=0,ep=0,ef=0,e_=0,eA=0,em=0,eE=0,eg=0,eS=0,eb=0,eT=0,ey=0,eR=0,eI=0,eC=0,ek=0,ew=0,eO=0,eN=0,eP=0,eD=0,eL=0,eM=0,ex=0,eU=0,eB=0,eV=0,eF=0,ej=0,eG=0,eW=0,eH=g(0),eY=0,eK=0,eQ=0,ez=0,eX=0,eJ=0,eq=0,eZ=0,e$=0,e0=0,e2=0,e1=0,e4=0,e6=0,e3=0,e8=0,e5=0,e9=0,e7=0,te=0,tt=0,tr=g(0);M=D=x=M-1568|0,U=1,q=d[(eS=(K=u[t+32>>2])+(r<<1)|0)>>1]<<y,M=L=F=D-((E(ea=o?2:1,(d[((u[t+8>>2]<<1)+K|0)-2>>1]<<y)-q|0)<<2)+15&-16)|0,z=(B=d[(((x=u[t+8>>2])<<1)+K|0)-2>>1])<<y<<2,es=(0|e)!=0&(0|o)!=0&!_&(0|C)>7,eA=!e|es,X=p?1<<y:1;t:{if(es){M=L=j=L-(((U=d[(x<<1)+K>>1]-B<<y)<<2)+15&-16)|0;break t}j=n+z|0}if(M=L=eb=L-(x=(U<<2)+15&-16)|0,M=L=eT=L-x|0,M=L=ey=L-x|0,M=L=eR=L-x|0,M=em=L-x|0,u[D+1532>>2]=T,u[D+1540>>2]=c,u[D+1520>>2]=A,u[D+1504>>2]=e,u[D+1512>>2]=t,x=u[I>>2],u[D+1556>>2]=O,u[D+1548>>2]=w,u[D+1524>>2]=f,u[D+1544>>2]=x,e=(0|X)>1,u[D+1560>>2]=e,u[D+1552>>2]=0,u[D+1508>>2]=eA,(0|r)<(0|i)){for(e3=o?F:0,e8=(0|f)!=3|e,er=T+28|0,ei=T+8|0,e5=1^eA,w=ea-1|0,eI=r+2|0,ec=r+1|0,eC=i-1|0,e9=(x=0-q<<2)+(z=(F+z|0)-(q<<2)|0)|0,Z=x+F|0,ek=-1<<X^-1,ed=r,f=1;;){O=ed,u[D+1516>>2]=O;o:{a:{if(ed=O+1|0,e=d[(H=(O<<1)+K|0)>>1]<<y,(0|(x=(d[(ed<<1)+K>>1]<<y)-e|0))>0){L=S-(eE=tR(T))|0,u[D+1536>>2]=L-1,ew=b-((0|r)==(0|O)?0:eE)|0,Y=0;c:if(!((0|R)<=(0|O))){if(b=R-O|0,b=(0|(b=u[(O<<2)+h>>2]+((0|ew)/(((0|b)<3?b:3)|0)|0)|0))>(0|L)?L:b,Y=16383,(0|b)>16383)break c;Y=(0|b)>0?b:0}b=e<<2,J=!eA|(((d[H>>1]<<y)-x|0)<d[eS>>1]<<y?(0|O)!=(0|ec):0)?J:f?O:J||O,e=o+b|0,eO=(0|O)!=(0|ec);l:if(!eO){if(p=(f=(U=d[(L=u[t+32>>2])+(ec<<1)>>1])-d[(r<<1)+L>>1]<<y)<<2,U=(f<<1)-(L=d[(eI<<1)+L>>1]-U<<y)<<2,ev(F+p|0,F+U|0,L=L-f<<2),!_)break l;ev(p+z|0,U+z|0,L)}$=o?e:0,C=n+b|0,b=u[(eg=O<<2)+v>>2],u[D+1528>>2]=b,j=(B=u[t+12>>2]>(0|O))?j:0,en=(et=(0|O)==(0|eC))?0:j,V=-1;h:{if(!J){L=e=ek;break h}if(L=e=ek,!((0|b)<0|e8))break h;for(V=(0|(b=((d[(J<<1)+K>>1]<<y)-q|0)-x|0))>0?b:0,e=q+V|0,b=J;;){if(L=b,!(d[((b=b-1|0)<<1)+K>>1]<<y>(0|e)))break}for(p=e+x|0,f=J-1|0,U=((0|O)<(0|J)?J:O)-1|0;;){$:{if((0|U)==(0|(e=f))){e=U;break $}if(d[((f=e+1|0)<<1)+K>>1]<<y<(0|p))continue}break}for(U=(0|e)<(0|L)?b:e,e=0,L=0;;){if(e=l[(f=E(b,ea))+a|0]|e,L=l[(f+w|0)+a|0]|L,f=(0|b)!=(0|U),b=b+1|0,!f)break}}if(j=es?j:en,C=B?C:F,p=B?$:e3,!_)break a;if(!((0|A)!=(0|O)|e5)){if((0|q)>=(0|(b=d[H>>1]<<y)))break a;for(B=(0|(b=b-q|0))>1?b:1,b=0;;){if(m[(U=F+(f=b<<2)|0)>>2]=g(m[U>>2]+m[f+z>>2])*g(.5),(0|B)==(0|(b=b+1|0)))break}break a}if((0|A)==(0|O))break a;f=V<<2,B=(U=(0|V)==-1)?0:F+f|0,b=Y>>>1|0;_:{if((0|O)==(0|eC)){V=0,f=U?0:f+z|0,C=Q(D+1504|0,C,x,b,X,B,y,0,g(1),j,e);break _}f=U?0:f+z|0,C=Q(D+1504|0,C,x,b,X,B,y,(d[H>>1]<<y<<2)+Z|0,g(1),j,e),V=(d[H>>1]<<y<<2)+e9|0}b=Q(D+1504|0,p,x,b,X,f,y,V,g(1),j,L);break o}tO(41890,41800,1495),k()}eo:{if(p){if(!(1^es|(0|A)<=(0|O))){for(G=m[c+eg>>2],W=m[(u[t+8>>2]+O<<2)+c>>2],eN=u[T+4>>2],eP=u[T>>2],N=u[(P=ei)+8>>2],b=u[P+12>>2],f=N,u[(N=eD=D+1496|0)>>2]=f,u[N+4>>2]=b,N=u[P+4>>2],f=b=u[P>>2],u[(b=D)+1488>>2]=f,u[b+1492>>2]=N,en=u[T+24>>2],u[(eL=b+1480|0)>>2]=u[er+16>>2],eM=b+1472|0,N=u[(P=er)+8>>2],b=u[P+12>>2],f=N,u[(N=eM)>>2]=f,u[N+4>>2]=b,N=u[P+4>>2],f=b=u[P>>2],u[(b=D)+1464>>2]=f,u[b+1468>>2]=N,ex=b+1408|0,eu=b+1560|0,u[ex>>2]=u[eu>>2],eU=b+1400|0,N=u[(P=$=b+1552|0)>>2],b=u[P+4>>2],f=N,u[(N=eU)>>2]=f,u[N+4>>2]=b,b=u[(P=el=D+1544|0)>>2],N=u[P+4>>2],f=b,u[(b=eB=D+1392|0)>>2]=f,u[b+4>>2]=N,N=u[(P=eh=D+1536|0)>>2],b=u[P+4>>2],f=N,u[(N=eV=D+1384|0)>>2]=f,u[N+4>>2]=b,b=u[(P=ep=D+1528|0)>>2],N=u[P+4>>2],f=b,u[(b=eF=D+1376|0)>>2]=f,u[b+4>>2]=N,N=u[(P=ef=D+1520|0)>>2],b=u[P+4>>2],f=N,u[(N=ej=D+1368|0)>>2]=f,u[N+4>>2]=b,b=u[(P=e_=D+1512|0)>>2],N=u[P+4>>2],f=b,u[(b=eG=D+1360|0)>>2]=f,u[b+4>>2]=N,N=u[(P=D)+1504>>2],b=u[P+1508>>2],f=N,u[(N=P)+1352>>2]=f,u[N+1356>>2]=b,f=ev(eb,C,_=x<<2),U=ev(eT,p,_),u[$>>2]=-1,b=0,eW=e|L,e=0,eo=g((G<W?G:W)/g(3)),eH=g(W+eo),eo=g(G+eo),G=g(0),V=(0|V)==-1?0:(V<<2)+F|0,e=et?e:(d[H>>1]<<y<<2)+Z|0,e7=ee(N+1504|0,C,p,x,Y,X,V,y,e,j,eW),W=g(0);;){if(W=g(W+g(m[f+(e=b<<2)>>2]*m[e+C>>2])),(0|x)==(0|(b=b+1|0)))break}for(b=0;;){if(G=g(G+g(m[U+(e=b<<2)>>2]*m[e+p>>2])),(0|x)==(0|(b=b+1|0)))break}for(b=u[(P=T)+40>>2],N=u[P+44>>2],e=b,u[(b=eY=D+1456|0)>>2]=e,u[b+4>>2]=N,b=u[P+36>>2],e=N=u[P+32>>2],u[(N=eK=D+1448|0)>>2]=e,u[N+4>>2]=b,N=u[P+28>>2],e=b=u[P+24>>2],u[(b=eQ=D+1440|0)>>2]=e,u[b+4>>2]=N,b=u[P+20>>2],e=N=u[P+16>>2],u[(N=ez=D+1432|0)>>2]=e,u[N+4>>2]=b,b=u[(P=ei)>>2],N=u[P+4>>2],e=b,u[(b=eX=D+1424|0)>>2]=e,u[b+4>>2]=N,L=N=u[(P=T)>>2],e=b=u[P+4>>2],b=u[(P=e_)>>2],N=u[P+4>>2],P=b,u[(b=eJ=D+1296|0)>>2]=P,u[b+4>>2]=N,N=u[(P=ef)>>2],b=u[P+4>>2],P=N,u[(N=eq=D+1304|0)>>2]=P,u[N+4>>2]=b,b=u[(P=ep)>>2],N=u[P+4>>2],P=b,u[(b=eZ=D+1312|0)>>2]=P,u[b+4>>2]=N,N=u[(P=eh)>>2],b=u[P+4>>2],P=N,u[(N=e$=D+1320|0)>>2]=P,u[N+4>>2]=b,b=u[(P=el)>>2],N=u[P+4>>2],P=b,u[(b=e0=D+1328|0)>>2]=P,u[b+4>>2]=N,N=u[(P=$)>>2],b=u[P+4>>2],P=N,u[(N=e2=D+1336|0)>>2]=P,u[N+4>>2]=b,u[(e1=D+1344|0)>>2]=u[eu>>2],u[(N=D)+1416>>2]=L,b=e,u[N+1420>>2]=b,P=N,b=u[N+1504>>2],N=u[N+1508>>2],e=b,u[(b=P)+1288>>2]=e,u[b+1292>>2]=N,te=ev(ey,C,_),tt=ev(eR,p,_),!et&&ev(em,(d[H>>1]<<y<<2)+Z|0,_),B=ev(D,e4=en+eP|0,e6=eN-en|0),u[T+4>>2]=eN,u[T>>2]=eP,N=u[(P=eD)>>2],b=u[P+4>>2],e=N,u[(N=ei)+8>>2]=e,u[N+12>>2]=b,b=u[(P=B)+1488>>2],N=u[P+1492>>2],e=b,u[(b=ei)>>2]=e,u[b+4>>2]=N,u[T+24>>2]=en,u[er+16>>2]=u[eL>>2],N=u[(P=eM)>>2],b=u[P+4>>2],e=N,u[(N=er)+8>>2]=e,u[N+12>>2]=b,b=u[(P=B)+1464>>2],N=u[P+1468>>2],e=b,u[(b=er)>>2]=e,u[b+4>>2]=N,N=u[(P=eG)>>2],b=u[P+4>>2],e=N,u[(N=e_)>>2]=e,u[N+4>>2]=b,b=u[(P=ej)>>2],N=u[P+4>>2],e=b,u[(b=ef)>>2]=e,u[b+4>>2]=N,N=u[(P=eF)>>2],b=u[P+4>>2],e=N,u[(N=ep)>>2]=e,u[N+4>>2]=b,b=u[(P=eV)>>2],N=u[P+4>>2],e=b,u[(b=eh)>>2]=e,u[b+4>>2]=N,N=u[(P=eB)>>2],b=u[P+4>>2],e=N,u[(N=el)>>2]=e,u[N+4>>2]=b,b=u[(P=eU)>>2],N=u[P+4>>2],e=b,u[(b=$)>>2]=e,u[b+4>>2]=N,u[eu>>2]=u[ex>>2],N=u[(P=B)+1352>>2],b=u[P+1356>>2],e=N,u[(N=P)+1504>>2]=e,u[N+1508>>2]=b,L=ev(C,f,_),p=ev(p,U,_),!eO&&(e=(C=d[(b=u[t+32>>2])+(ec<<1)>>1])-d[(r<<1)+b>>1]<<y,ev((e<<2)+F|0,((e<<1)-(b=d[(eI<<1)+b>>1]-C<<y)<<2)+F|0,b-e<<2)),u[B+1552>>2]=1,b=0,e=0,W=g(eo*W),G=g(eH*G),tr=g(W+G),G=g(0),e=et?e:(d[H>>1]<<y<<2)+Z|0,C=ee(B+1504|0,L,p,x,Y,X,V,y,e,j,eW),W=g(0);;){if(W=g(W+g(m[f+(e=b<<2)>>2]*m[e+L>>2])),(0|x)==(0|(b=b+1|0)))break}for(b=0;;){if(G=g(G+g(m[U+(e=b<<2)>>2]*m[e+p>>2])),(0|x)==(0|(b=b+1|0)))break}!(g(g(eo*W)+g(eH*G))<=tr^1)&&(b=u[B+1416>>2],N=u[P+1420>>2],e=b,u[(b=T)>>2]=e,u[b+4>>2]=N,N=u[(P=eY)>>2],b=u[P+4>>2],e=N,u[(N=T)+40>>2]=e,u[N+44>>2]=b,b=u[(P=eK)>>2],N=u[P+4>>2],e=b,u[(b=T)+32>>2]=e,u[b+36>>2]=N,N=u[(P=eQ)>>2],b=u[P+4>>2],e=N,u[(N=T)+24>>2]=e,u[N+28>>2]=b,b=u[(P=ez)>>2],N=u[P+4>>2],e=b,u[(b=T)+16>>2]=e,u[b+20>>2]=N,N=u[(P=eX)>>2],b=u[P+4>>2],e=N,u[(N=ei)>>2]=e,u[N+4>>2]=b,b=u[(P=eJ)>>2],N=u[P+4>>2],e=b,u[(b=e_)>>2]=e,u[b+4>>2]=N,N=u[(P=eq)>>2],b=u[P+4>>2],e=N,u[(N=ef)>>2]=e,u[N+4>>2]=b,b=u[(P=eZ)>>2],N=u[P+4>>2],e=b,u[(b=ep)>>2]=e,u[b+4>>2]=N,N=u[(P=e$)>>2],b=u[P+4>>2],e=N,u[(N=eh)>>2]=e,u[N+4>>2]=b,b=u[(P=e0)>>2],N=u[P+4>>2],e=b,u[(b=el)>>2]=e,u[b+4>>2]=N,N=u[(P=e2)>>2],b=u[P+4>>2],e=N,u[(N=$)>>2]=e,u[N+4>>2]=b,u[eu>>2]=u[e1>>2],b=u[(P=B)+1288>>2],N=u[P+1292>>2],e=b,u[(b=P)+1504>>2]=e,u[b+1508>>2]=N,ev(L,te,_),ev(p,tt,_),!et&&ev((d[H>>1]<<y<<2)+Z|0,em,_),ev(e4,B,e6),C=e7),_=0;break eo}_=0,u[D+1552>>2]=0,b=0,f=(0|V)==-1?0:(V<<2)+F|0,b=et?b:(d[H>>1]<<y<<2)+Z|0,C=ee(D+1504|0,C,p,x,Y,X,f,y,b,j,e|L);break eo}_=0,b=0,f=(0|V)==-1?0:(V<<2)+F|0,b=et?b:(d[H>>1]<<y<<2)+Z|0,C=Q(D+1504|0,C,x,Y,X,f,y,b,g(1),j,e|L)}b=C}if(s[a+(e=E(O,ea))|0]=C,s[(e+w|0)+a|0]=b,b=u[h+eg>>2],u[D+1560>>2]=0,b=(eE+ew|0)+b|0,f=x<<3<(0|Y),(0|i)==(0|ed))break}x=u[D+1544>>2]}u[I>>2]=x,M=D+1568|0}(1,L,x,w,W,(0|I)==2?(er<<2)+W|0:0,A,ei,n,ew,u[e+80>>2],u[N+20>>2],u[e+232>>2],J,V-t|0,u[N+80>>2],o,O,c,e+76|0,u[e+24>>2],u[e+72>>2],u[e+68>>2]),P&&e4(o,u[e+116>>2]<2,1),function(e,t,r,i,n,o,a,s,c,d){var l=0,h=0,p=0,f=0,_=0,A=0,v=g(0),S=0,b=0,T=0;S=(0|d)>1?d:1,b=(0|t)>=(0|r);t:if(!(b|(0|s)<(0|d))){for(h=t;;){if(!(u[(T=(l=h<<2)+o|0)>>2]>7|u[a+l>>2])){for(p=u[e+8>>2],l=0;;){if(e4(c,1^(f=m[(E(l,p)+h<<2)+n>>2]<g(0)),1),A=(_=E(p=u[e+8>>2],l)+h<<2)+i|0,v=g(g((f?g(-.5):g(.5))*g(1<<13-u[T>>2]))*g(6103515625e-14)),m[A>>2]=m[A>>2]+v,m[(f=n+_|0)>>2]=m[f>>2]-v,(0|S)==(0|(l=l+1|0)))break}s=s-S|0}if((0|(h=h+1|0))>=(0|r))break t;if(!((0|s)>=(0|d)))break}}o:if(!((0|s)<(0|d)|b)){for(;;){if(!(u[(A=(l=t<<2)+o|0)>>2]>7|1!=u[a+l>>2])){for(h=u[e+8>>2],l=0;;){if(e4(c,1^(p=m[(E(l,h)+t<<2)+n>>2]<g(0)),1),_=(f=E(h=u[e+8>>2],l)+t<<2)+i|0,v=g(g((p?g(-.5):g(.5))*g(1<<13-u[A>>2]))*g(6103515625e-14)),m[_>>2]=m[_>>2]+v,m[(p=n+f|0)>>2]=m[p>>2]-v,(0|S)==(0|(l=l+1|0)))break}s=s-S|0}if((0|r)<=(0|(t=t+1|0)))break o;if(!((0|s)>=(0|d)))break}}}(L,x,w,U,F,r,i,((D-u[o+20>>2]|0)-b(u[o+28>>2])|0)+32|0,o,I),i=ex(eT,0,W=eg<<2);;){if(!X)for(n=E(p,K),r=x;;){if(v=i+(t=r+n<<2)|0,h=(c=((t=(a=m[t+F>>2])>g(.5))?g(.5):a)<g(-.5))?g(-.5):g(.5),m[v>>2]=t?h:c?h:a,(0|w)==(0|(r=r+1|0)))break}if((0|z)==(0|(p=p+1|0)))break}if(!(!(1^eS)|(0|eo)<1))for(r=0;;){if(u[(r<<2)+U>>2]=-0x3e200000,(0|eo)==(0|(r=r+1|0)))break}r=u[N+28>>2],u[e+112>>2]=ej,m[e+108>>2]=eH,u[e+104>>2]=r,eX&&ev(U+(r=K<<2)|0,U,r);t0:{if(et){if(r=0,(0|eg)<=0)break t0;for(;;){if(a=m[(c=H+(t=r<<2)|0)>>2],h=m[t+U>>2],m[c>>2]=a<h?a:h,(0|eg)==(0|(r=r+1|0)))break}break t0}ev(en,H,W),ev(H,U,W)}for(i=(0|x)<1,n=0;;){if(!i)for(c=E(n,K),r=0;;){if(u[U+(t=r+c<<2)>>2]=0,u[t+en>>2]=-0x3e200000,u[t+H>>2]=-0x3e200000,(0|x)==(0|(r=r+1|0)))break}if((0|w)<(0|K))for(c=E(n,K),r=w;;){if(u[U+(t=r+c<<2)>>2]=0,u[t+en>>2]=-0x3e200000,u[t+H>>2]=-0x3e200000,(0|K)==(0|(r=r+1|0)))break}if((0|ey)==(0|(n=n+1|0)))break}r=0,r=!et&(-1^eV)?r:u[e+116>>2]+1|0,u[e+116>>2]=r,u[e+76>>2]=u[o+28>>2],es(o),c=u[o+44>>2]?-3:G}return M=N+192|0,c}function V(e){e|=0;var t=0,r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,h=0,p=0,f=0;M=f=M-16|0;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{l:{h:{if(e>>>0<=244){if(a=u[13232],3&(e=a>>>(r=(n=e>>>0<11?16:e+11&-8)>>>3|0)|0)){e=(r=u[(i=(n=((-1^e)&1)+r|0)<<3)+52976>>2])+8|0,t=u[r+8>>2],i=i+52968|0;p:{if((0|t)==(0|i)){u[13232]=tD(-2,n)&a;break p}u[t+12>>2]=i,u[i+8>>2]=t}t=n<<3,u[r+4>>2]=3|t,u[(r=r+t|0)+4>>2]=1|u[r+4>>2];break t}if((d=u[13234])>>>0>=n>>>0)break h;if(e){t=e=((e=(t=e<<r)&((e=2<<r)|0-e))&0-e)-1|0,t=(r=t>>>(e=e>>>12&16)|0)>>>5&8,t=(i=e|t)|(r=(e=r>>>t|0)>>>2&4),t|=r=(e=e>>>r|0)>>>1&2,r=u[(i=(t=(t|(r=(e=e>>>r|0)>>>1&1))+(e>>>r|0)|0)<<3)+52976>>2],e=u[r+8>>2],i=i+52968|0;f:{if((0|e)==(0|i)){a=tD(-2,t)&a,u[13232]=a;break f}u[e+12>>2]=i,u[i+8>>2]=e}if(e=r+8|0,u[r+4>>2]=3|n,i=r+n|0,t=(o=t<<3)-n|0,u[i+4>>2]=1|t,u[r+o>>2]=t,d){n=((o=d>>>3|0)<<3)+52968|0,r=u[13237],o=1<<o;_:{if(!(a&o)){u[13232]=o|a,o=n;break _}o=u[n+8>>2]}u[n+8>>2]=r,u[o+12>>2]=r,u[r+12>>2]=n,u[r+8>>2]=o}u[13237]=i,u[13234]=t;break t}if(!(c=u[13233]))break h;for(t=e=(0-c&c)-1|0,t=(r=t>>>(e=e>>>12&16)|0)>>>5&8,t=(i=e|t)|(r=(e=r>>>t|0)>>>2&4),t|=r=(e=e>>>r|0)>>>1&2,i=u[((t|(r=(e=e>>>r|0)>>>1&1))+(e>>>r|0)<<2)+53232>>2],r=(-8&u[i+4>>2])-n|0,t=i;;){A:if((e=u[t+16>>2])||(e=u[t+20>>2])){o=t=(-8&u[e+4>>2])-n|0,r=(t=r>>>0>t>>>0)?o:r,i=t?e:i,t=e;continue}break}if((h=i+n|0)>>>0<=i>>>0)break l;if(p=u[i+24>>2],(0|(o=u[i+12>>2]))!=(0|i)){e=u[i+8>>2],u[e+12>>2]=o,u[o+8>>2]=e;break r}if(!(e=u[(t=i+20|0)>>2])){if(!(e=u[i+16>>2]))break u;t=i+16|0}for(;;){if(s=t,o=e,e=u[(t=e+20|0)>>2])continue;if(t=o+16|0,!(e=u[o+16>>2]))break}u[s>>2]=0;break r}if(n=-1,e>>>0>0xffffffbf)break h;if(n=-8&(e=e+11|0),!(d=u[13233]))break h;s=31,n>>>0<=0xffffff&&(t=r=(t=e=e>>>8|0)<<(e=e+1048320>>>16&8),t<<=r=r+520192>>>16&4,s=((e=((i=t)<<(t=t+245760>>>16&2)>>>15|0)-(e|r|t)|0)<<1|n>>>e+21&1)+28|0),r=0-n|0,t=u[(s<<2)+53232>>2];m:{v:{E:{if(!t){e=0;break E}for(e=0,i=n<<((0|s)==31?0:25-(s>>>1|0)|0);;){g:if(!((a=(-8&u[t+4>>2])-n|0)>>>0>=r>>>0)){if(o=t,r=a)break g;r=0,e=t;break v}if(a=u[t+20>>2],t=u[((i>>>29&4)+t|0)+16>>2],e=a?(0|a)==(0|t)?e:a:e,i<<=1,!t)break}}if(!(e|o)){if(!(e=((e=2<<s)|0-e)&d))break h;i=(t=(t=e=(0-e&e)-1|0)>>>(e=e>>>12&16)|0)>>>5&8,i=(a=e|i)|(t=(e=t>>>i|0)>>>2&4),i|=t=(e=e>>>t|0)>>>1&2,e=u[((i|(t=(e=e>>>t|0)>>>1&1))+(e>>>t|0)<<2)+53232>>2]}if(!e)break m}for(;;){if(r=(i=(a=(-8&u[e+4>>2])-n|0)>>>0<r>>>0)?a:r,o=i?e:o,!(t=u[e+16>>2])&&(t=u[e+20>>2]),!(e=t))break}}if(!o|u[13234]-n>>>0<=r>>>0)break h;if((s=n+o|0)>>>0<=o>>>0)break l;if(c=u[o+24>>2],i=u[o+12>>2],(0|o)!=(0|i)){e=u[o+8>>2],u[e+12>>2]=i,u[i+8>>2]=e;break i}if(!(e=u[(t=o+20|0)>>2])){if(!(e=u[o+16>>2]))break d;t=o+16|0}for(;;){if(a=t,i=e,e=u[(t=e+20|0)>>2])continue;if(t=i+16|0,!(e=u[i+16>>2]))break}u[a>>2]=0;break i}if(n>>>0<=(e=u[13234])>>>0){r=u[13237],t=e-n|0;S:{if(t>>>0>=16){u[13234]=t,i=r+n|0,u[13237]=i,u[i+4>>2]=1|t,u[e+r>>2]=t,u[r+4>>2]=3|n;break S}u[13237]=0,u[13234]=0,u[r+4>>2]=3|e,u[(e=e+r|0)+4>>2]=1|u[e+4>>2]}e=r+8|0;break t}if(n>>>0<(i=u[13235])>>>0){r=i-n|0,u[13235]=r,t=n+(e=u[13238])|0,u[13238]=t,u[t+4>>2]=1|r,u[e+4>>2]=3|n,e=e+8|0;break t}if(e=0,t=d=n+47|0,u[13350]?r=u[13352]:(u[13353]=-1,u[13354]=-1,u[13351]=4096,u[13352]=4096,u[13350]=f+12&-16^0x55555558,u[13355]=0,u[13343]=0,r=4096),(o=(a=t+r|0)&(s=0-r|0))>>>0<=n>>>0||(r=u[13342])&&r>>>0<(c=o+(t=u[13340])|0)>>>0|t>>>0>=c>>>0)break t;if(4&l[53372])break a;b:{T:{if(r=u[13238])for(e=53376;;){if(t=u[e>>2],u[e+4>>2]+t>>>0>r>>>0?t>>>0<=r>>>0:0)break T;if(!(e=u[e+8>>2]))break}if((0|(i=tA(0)))==-1)break s;if(a=o,i&(r=(e=u[13351])-1|0)&&(a=(o-i|0)+(r+i&0-e)|0),a>>>0>0x7ffffffe|n>>>0>=a>>>0||(e=u[13342])&&e>>>0<(t=a+(r=u[13340])|0)>>>0|r>>>0>=t>>>0)break s;if((0|i)!=(0|(e=tA(a))))break b;break o}if((a=a-i&s)>>>0>0x7ffffffe)break s;if((0|(i=tA(a)))==(u[e>>2]+u[e+4>>2]|0))break c;e=i}if(!((0|e)==-1|n+48>>>0<=a>>>0)){if((r=(r=u[13352])+(d-a|0)&0-r)>>>0>0x7ffffffe){i=e;break o}if((0|tA(r))!=-1){a=r+a|0,i=e;break o}tA(0-a|0);break s}if(i=e,(0|e)!=-1)break o;break s}k()}o=0;break r}i=0;break i}if((0|i)!=-1)break o}u[13343]=4|u[13343]}if(o>>>0>0x7ffffffe)break n;if(t=(0|(i=tA(o)))==-1,t|i>>>0>=(e=tA(0))>>>0|(0|e)==-1||(a=e-i|0)>>>0<=n+40>>>0)break n}e=u[13340]+a|0,u[13340]=e,A[13341]<e>>>0&&(u[13341]=e);y:{R:{I:{if(r=u[13238]){for(e=53376;;){if(t=u[e>>2],(t+(o=u[e+4>>2])|0)==(0|i))break I;if(!(e=u[e+8>>2]))break}break R}for(!((e=u[13236])>>>0<=i>>>0?e:0)&&(u[13236]=i),e=0,u[13345]=a,u[13344]=i,u[13240]=-1,u[13241]=u[13350],u[13347]=0;;){if(t=(r=e<<3)+52968|0,u[r+52976>>2]=t,u[r+52980>>2]=t,(0|(e=e+1|0))==32)break}t=(e=a-40|0)-(r=i+8&7?-8-i&7:0)|0,u[13235]=t,r=r+i|0,u[13238]=r,u[r+4>>2]=1|t,u[(e+i|0)+4>>2]=40,u[13239]=u[13354];break y}if(8&u[e+12>>2]|(r>>>0<t>>>0|r>>>0>=i>>>0))break R;u[e+4>>2]=o+a,e=r+8&7?-8-r&7:0,t=r+e|0,u[13238]=t,e=(i=u[13235]+a|0)-e|0,u[13235]=e,u[t+4>>2]=1|e,u[(r+i|0)+4>>2]=40,u[13239]=u[13354];break y}(o=u[13236])>>>0>i>>>0&&(u[13236]=i),t=i+a|0,e=53376;C:{k:{w:{O:{N:{P:{for(;;){if(u[e>>2]!=(0|t)){if(e=u[e+8>>2])continue;break P}break}if(!(8&l[e+12|0]))break N}for(e=53376;;){if((t=u[e>>2])>>>0<=r>>>0&&(t=u[e+4>>2]+t|0)>>>0>r>>>0)break O;e=u[e+8>>2]}}if(u[e>>2]=i,u[e+4>>2]=u[e+4>>2]+a,u[(s=(i+8&7?-8-i&7:0)+i|0)+4>>2]=3|n,t=((a=(t+8&7?-8-t&7:0)+t|0)-s|0)-n|0,n=n+s|0,(0|r)==(0|a)){u[13238]=n,e=u[13235]+t|0,u[13235]=e,u[n+4>>2]=1|e;break k}if(u[13237]==(0|a)){u[13237]=n,e=u[13234]+t|0,u[13234]=e,u[n+4>>2]=1|e,u[e+n>>2]=e;break k}if((3&(e=u[a+4>>2]))==1){d=-8&e;D:{if(e>>>0<=255){if(e=((c=e>>>3|0)<<3)+52968|0,i=u[a+8>>2],(0|i)==(0|(r=u[a+12>>2]))){u[13232]=u[13232]&tD(-2,c);break D}u[i+12>>2]=r,u[r+8>>2]=i;break D}c=u[a+24>>2],i=u[a+12>>2];L:{if((0|a)!=(0|i)){e=u[a+8>>2],u[e+12>>2]=i,u[i+8>>2]=e;break L}M:if(!(r=u[(e=a+20|0)>>2])&&!(r=u[(e=a+16|0)>>2])){i=0;break L}for(;;){if(o=e,i=r,r=u[(e=r+20|0)>>2])continue;if(e=i+16|0,!(r=u[i+16>>2]))break}u[o>>2]=0}if(!c)break D;e=((r=u[a+28>>2])<<2)+53232|0;x:{if(u[e>>2]==(0|a)){if(u[e>>2]=i,i)break x;u[13233]=u[13233]&tD(-2,r);break D}if(u[(u[c+16>>2]==(0|a)?16:20)+c>>2]=i,!i)break D}if(u[i+24>>2]=c,(e=u[a+16>>2])&&(u[i+16>>2]=e,u[e+24>>2]=i),!(e=u[a+20>>2]))break D;u[i+20>>2]=e,u[e+24>>2]=i}a=a+d|0,t=t+d|0}if(u[a+4>>2]=-2&u[a+4>>2],u[n+4>>2]=1|t,u[t+n>>2]=t,t>>>0<=255){e=((r=t>>>3|0)<<3)+52968|0,r=1<<r,t=u[13232];U:{if(!(r&t)){u[13232]=r|t,r=e;break U}r=u[e+8>>2]}u[e+8>>2]=n,u[r+12>>2]=n,u[n+12>>2]=e,u[n+8>>2]=r;break k}e=31,t>>>0<=0xffffff&&(i=e=t>>>8|0,i=r=i<<(e=e+1048320>>>16&8),i<<=r=r+520192>>>16&4,e=((e=((o=i)<<(i=i+245760>>>16&2)>>>15|0)-(e|r|i)|0)<<1|t>>>e+21&1)+28|0),u[n+28>>2]=e,u[n+16>>2]=0,u[n+20>>2]=0,r=(e<<2)+53232|0,i=u[13233],o=1<<e;B:{if(!(i&o)){u[13233]=i|o,u[r>>2]=n;break B}for(e=t<<((0|e)==31?0:25-(e>>>1|0)|0),i=u[r>>2];;){if((-8&u[(r=i)+4>>2])==(0|t))break w;if(i=e>>>29|0,e<<=1,!(i=u[(o=(a=(4&i)+r|0)+16|0)>>2]))break}u[a+16>>2]=n}u[n+24>>2]=r,u[n+12>>2]=n,u[n+8>>2]=n;break k}for(s=(e=a-40|0)-(o=i+8&7?-8-i&7:0)|0,u[13235]=s,o=i+o|0,u[13238]=o,u[o+4>>2]=1|s,u[(e+i|0)+4>>2]=40,u[13239]=u[13354],u[(o=r+16>>>0>(e=((t-39&7?39-t&7:0)+t|0)-47|0)>>>0?r:e)+4>>2]=27,e=u[13347],s=u[13346],u[o+16>>2]=s,u[o+20>>2]=e,s=u[13345],e=u[13344],u[o+8>>2]=e,u[o+12>>2]=s,u[13346]=o+8,u[13345]=a,u[13344]=i,u[13347]=0,e=o+24|0;;){if(u[e+4>>2]=7,i=e+8|0,e=e+4|0,!(t>>>0>i>>>0))break}if((0|r)==(0|o))break y;if(u[o+4>>2]=-2&u[o+4>>2],a=o-r|0,u[r+4>>2]=1|a,u[o>>2]=a,a>>>0<=255){e=((t=a>>>3|0)<<3)+52968|0,t=1<<t,i=u[13232];V:{if(!(t&i)){u[13232]=t|i,t=e;break V}t=u[e+8>>2]}u[e+8>>2]=r,u[t+12>>2]=r,u[r+12>>2]=e,u[r+8>>2]=t;break y}e=31,u[r+16>>2]=0,u[r+20>>2]=0,a>>>0<=0xffffff&&(t=e=a>>>8|0,t<<=e=e+1048320>>>16&8,o=i=t<<(t=t+520192>>>16&4),e=((e=(o<<(i=i+245760>>>16&2)>>>15|0)-(e|t|i)|0)<<1|a>>>e+21&1)+28|0),u[r+28>>2]=e,t=(e<<2)+53232|0,i=u[13233],o=1<<e;F:{if(!(i&o)){u[13233]=i|o,u[t>>2]=r;break F}for(e=a<<((0|e)==31?0:25-(e>>>1|0)|0),i=u[t>>2];;){if((-8&u[(t=i)+4>>2])==(0|a))break C;if(i=e>>>29|0,e<<=1,!(i=u[(o=(s=(4&i)+t|0)+16|0)>>2]))break}u[s+16>>2]=r}u[r+24>>2]=t,u[r+12>>2]=r,u[r+8>>2]=r;break y}e=u[r+8>>2],u[e+12>>2]=n,u[r+8>>2]=n,u[n+24>>2]=0,u[n+12>>2]=r,u[n+8>>2]=e}e=s+8|0;break t}e=u[t+8>>2],u[e+12>>2]=r,u[t+8>>2]=r,u[r+24>>2]=0,u[r+12>>2]=t,u[r+8>>2]=e}if(n>>>0>=(e=u[13235])>>>0)break n;r=e-n|0,u[13235]=r,t=n+(e=u[13238])|0,u[13238]=t,u[t+4>>2]=1|r,u[e+4>>2]=3|n,e=e+8|0;break t}u[tY()>>2]=48,e=0;break t}j:if(c){e=((t=u[o+28>>2])<<2)+53232|0;G:{if(u[e>>2]==(0|o)){if(u[e>>2]=i,i)break G;d=tD(-2,t)&d,u[13233]=d;break j}if(u[(u[c+16>>2]==(0|o)?16:20)+c>>2]=i,!i)break j}if(u[i+24>>2]=c,(e=u[o+16>>2])&&(u[i+16>>2]=e,u[e+24>>2]=i),!(e=u[o+20>>2]))break j;u[i+20>>2]=e,u[e+24>>2]=i}W:{if(r>>>0<=15){e=r+n|0,u[o+4>>2]=3|e,u[(e=e+o|0)+4>>2]=1|u[e+4>>2];break W}if(u[o+4>>2]=3|n,u[s+4>>2]=1|r,u[r+s>>2]=r,r>>>0<=255){e=((r=r>>>3|0)<<3)+52968|0,r=1<<r,t=u[13232];H:{if(!(r&t)){u[13232]=r|t,r=e;break H}r=u[e+8>>2]}u[e+8>>2]=s,u[r+12>>2]=s,u[s+12>>2]=e,u[s+8>>2]=r;break W}e=31,r>>>0<=0xffffff&&(t=e=r>>>8|0,t<<=e=e+1048320>>>16&8,i=n=(i=t)<<(t=t+520192>>>16&4),e=((e=(i<<(n=n+245760>>>16&2)>>>15|0)-(e|t|n)|0)<<1|r>>>e+21&1)+28|0),u[s+28>>2]=e,u[s+16>>2]=0,u[s+20>>2]=0,t=(e<<2)+53232|0;Y:{n=1<<e;K:{if(!(d&n)){u[13233]=n|d,u[t>>2]=s;break K}for(e=r<<((0|e)==31?0:25-(e>>>1|0)|0),n=u[t>>2];;){if((-8&u[(t=n)+4>>2])==(0|r))break Y;if(n=e>>>29|0,e<<=1,!(n=u[(i=(a=(4&n)+t|0)+16|0)>>2]))break}u[a+16>>2]=s}u[s+24>>2]=t,u[s+12>>2]=s,u[s+8>>2]=s;break W}e=u[t+8>>2],u[e+12>>2]=s,u[t+8>>2]=s,u[s+24>>2]=0,u[s+12>>2]=t,u[s+8>>2]=e}e=o+8|0;break t}Q:if(p){e=((t=u[i+28>>2])<<2)+53232|0;z:{if(u[e>>2]==(0|i)){if(u[e>>2]=o,o)break z;u[13233]=tD(-2,t)&c;break Q}if(u[(u[p+16>>2]==(0|i)?16:20)+p>>2]=o,!o)break Q}if(u[o+24>>2]=p,(e=u[i+16>>2])&&(u[o+16>>2]=e,u[e+24>>2]=o),!(e=u[i+20>>2]))break Q;u[o+20>>2]=e,u[e+24>>2]=o}X:{if(r>>>0<=15){e=r+n|0,u[i+4>>2]=3|e,u[(e=e+i|0)+4>>2]=1|u[e+4>>2];break X}if(u[i+4>>2]=3|n,u[h+4>>2]=1|r,u[r+h>>2]=r,d){t=((n=d>>>3|0)<<3)+52968|0,e=u[13237],n=1<<n;J:{if(!(a&n)){u[13232]=n|a,n=t;break J}n=u[t+8>>2]}u[t+8>>2]=e,u[n+12>>2]=e,u[e+12>>2]=t,u[e+8>>2]=n}u[13237]=h,u[13234]=r}e=i+8|0}return M=f+16|0,0|e}function F(e,t,r,i,n,o,a,c){var h=0,p=0,f=0,T=0,y=0,R=0,I=0,w=0,O=0,N=0,P=0,D=0,L=0,U=0,B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0,Q=0,z=0,X=0,J=0,ee=0,et=0,ei=0,en=0,ea=0,es=0,ed=0,eu=0,eh=0,ef=0,e_=0,eA=0,em=0,eb=0;if(M=w=O=M-32|0,u[t+68>>2]&&(u[e+14728>>2]=1,u[e+4664>>2]=1),u[e+5748>>2]=0,u[e+15812>>2]=0,!function(e){var t=0,r=0,i=0;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{if(e){t=u[e+8>>2];h:{if((0|t)<=23999){if((0|t)==8e3|(0|t)==12e3)break h;if((0|t)!=16e3)break t;break h}if((0|t)<=44099){if((0|t)==24e3|(0|t)==32e3)break h;break t}if((0|t)==48e3)break h;if((0|t)!=44100)break t}if(((0|(t=u[e+20>>2]))!=12e3?!((0|t)==8e3|(0|t)==16e3):0)||((0|(r=u[e+12>>2]))!=12e3?!((0|r)==8e3|(0|r)==16e3):0)||(0|t)<(0|(i=u[e+16>>2]))|(0|t)>(0|r)|((0|i)!=12e3?!((0|i)==8e3|(0|i)==16e3):0)||(0|r)<(0|i))break t;f:{switch((t=u[e+24>>2])-10|0){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:break u;case 0:case 10:break f;default:break}if((0|t)==40)break f;if((0|t)!=60)break u}if(A[e+32>>2]>=101)break d;if(A[e+48>>2]>=2)break c;if(A[e+52>>2]>=2)break s;if(A[e+40>>2]>=2)break a;if((t=u[e>>2])-1>>>0>=2)break o;if((r=u[e+4>>2])-1>>>0>=2)break n;if((0|t)<(0|r))break i;if(A[e+36>>2]>=11)break r;return 0}tO(1952,1989,41),k()}tO(2016,1989,69),k()}tO(2016,1989,73),k()}tO(2016,1989,77),k()}tO(2016,1989,81),k()}tO(2016,1989,85),k()}tO(2016,1989,89),k()}tO(2016,1989,93),k()}tO(2016,1989,97),k()}tO(2016,1989,101),k()}tO(2016,1989,62),k()}(t)){ee=e+10064|0,u[t+88>>2]=0;i:if(!(u[t+4>>2]<=u[e+20196>>2])){if(I=tC(ee,u[e+5092>>2]),u[e+20144>>2]=1,u[e+20148>>2]=0,u[e+20136>>2]=0,u[e+20140>>2]=0,u[e+20128>>2]=0,u[e+20152>>2]=1,u[e+20156>>2]=16384,2!=u[e+20192>>2])break i;ev(e+15840|0,e+5776|0,300),L=u[e+4>>2],y=u[e>>2],u[e+10064>>2]=y,u[e+10068>>2]=L}F=u[t+24>>2];n:{if((0|F)!=u[e+4612>>2]){h=u[t+4>>2],U=1;break n}U=(0|(h=u[t+4>>2]))!=u[e+20196>>2]}p=u[t>>2],u[e+20196>>2]=h,u[e+20192>>2]=p,f=E(i,100),P=(0|f)/(0|(p=u[t+8>>2]))|0;a:{s:{c:{d:{if(a){if((0|P)!=1)break a;(0|a)==2&&(y=u[e+28>>2],L=u[e+24>>2],u[w+24>>2]=L,u[w+28>>2]=y,L=u[e+20>>2],y=u[e+16>>2],u[w+16>>2]=y,u[w+20>>2]=L,R=u[e+4576>>2]),p=0;h:{if((0|h)>0){T=(0|a)!=2,V=w;break h}u[t+24>>2]=10,et=u[t+36>>2],u[t+36>>2]=0;break d}Z:{for(;;){if(f=tC(h=E(p,10064)+e|0,u[h+5092>>2]),!T&&(y=u[w+20>>2],L=u[w+16>>2],u[h+16>>2]=L,u[h+20>>2]=y,L=u[V+28>>2],y=u[V+24>>2],u[h+24>>2]=y,u[h+28>>2]=L,u[h+32>>2]=R),!f){if(h=u[t+4>>2],(0|h)<=(0|(p=p+1|0)))break Z;continue}break}tO(17522,17507,222),k()}if(F=u[t+24>>2],u[t+24>>2]=10,et=u[t+36>>2],I=0,u[t+36>>2]=0,(0|h)<1)break d;for(;;){if(u[(p=E(I,10064)+e|0)+4680>>2]=1,u[p+4668>>2]=0,(0|(I=I+1|0))==(0|h))break}I=0;break d}if((0|E(p,P))!=(0|f)|(0|i)<0)break s;if(p=E(p,F),F=0,(0|E(i,1e3))>(0|p))break c}et:{er:{_:{en:if(!((0|h)<1)){for(T=-1^U,f=0;;){if(h=0,p=E(f,10064)+e|0,h=(0|f)==1?u[e+4576>>2]:h,I=function(e,t,r,i,n){var o=0,a=0,c=0,d=0,l=0,h=0,p=0;u[e+6076>>2]=u[t+48>>2],u[e+4676>>2]=u[t+52>>2],a=u[t+8>>2],u[e+4556>>2]=a,u[e+4564>>2]=u[t+12>>2],u[e+4568>>2]=u[t+16>>2],u[e+4572>>2]=u[t+20>>2],u[e+6088>>2]=u[t+40>>2],u[e+5752>>2]=u[t>>2],o=u[t+4>>2],u[e+5760>>2]=i,u[e+4536>>2]=r,u[e+5756>>2]=o;t:{r:{if(!(!u[e+4668>>2]|u[e+4680>>2])){if(t=0,u[e+4560>>2]==(0|a)||(0|(n=u[e+4576>>2]))<1)break r;return eO(e,n)}if(l=n,h=function(e,t){var r=0,i=0,n=0,o=0;if(!(r=u[e+4576>>2])&&(r=u[e+32>>2]),!(i=r<<16))return r=u[e+4572>>2],(((0|(e=u[e+4556>>2]))>(0|r)?r:e)|0)/1e3|0;if(i=E(i>>16,1e3),n=u[e+4556>>2],o=u[e+4564>>2],!(u[e+4568>>2]<=(0|i)?!((0|i)>(0|n)|(0|o)<(0|i)):0))return r=(0|n)<(0|o)?n:o,(((0|(e=u[e+4568>>2]))<(0|r)?r:e)|0)/1e3|0;(0|(n=u[e+24>>2]))>=256&&(u[e+28>>2]=0);s:{c:if(u[t+64>>2]?!0:u[e+4536>>2]){if((0|(o=u[e+4572>>2]))<(0|i)){l:{h:{if(u[e+28>>2]){if(u[t+64>>2])break h;if((0|n)>0)break l;break s}if(u[e+16>>2]=0,u[e+20>>2]=0,u[e+24>>2]=256,!u[t+64>>2])break l}return u[e+28>>2]=0,(0|r)==16?12:8}return u[e+28>>2]=-2,r}if((0|i)<(0|o)){if(u[t+64>>2])return u[e+16>>2]=0,u[e+20>>2]=0,u[e+24>>2]=0,u[e+28>>2]=1,(0|r)==8?12:16;if(!u[e+28>>2])break s;return u[e+28>>2]=1,r}if(u[e+28>>2]>-1)break c;u[e+28>>2]=1}return r}return u[t+88>>2]=1,e=u[t+56>>2],u[t+56>>2]=e-((0|E(e,5))/(u[t+24>>2]+5|0)|0),r}(e,t),d=eO(e,n=(p=n)?l:h),a=0,(0|(r=u[t+24>>2]))!=u[e+4612>>2]){o:{switch(r-10|0){default:if((0|r)==40|(0|r)==60)break o;break;case 0:case 10:break o;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:break}a=-103}c:{if((0|r)<=10){if(u[e+5744>>2]=1,u[e+4580>>2]=(0|r)==10?2:1,i=n<<16>>16,u[e+4584>>2]=E(i,r<<16>>16),u[e+4548>>2]=E(i,14),8==u[e+4576>>2]){u[e+4688>>2]=2169;break c}u[e+4688>>2]=2157;break c}if(u[e+4580>>2]=4,u[e+5744>>2]=(r>>>0)/20,i=n<<16>>16,u[e+4584>>2]=E(i,20),u[e+4548>>2]=E(i,24),8==u[e+4576>>2]){u[e+4688>>2]=2146;break c}u[e+4688>>2]=2112}u[e+4608>>2]=0,u[e+4612>>2]=r}h:{q:{Z:{p:{if(!(!(1<<n&69888)|n>>>0>16)){ee:{switch((r=u[e+4580>>2])-2|0){case 0:case 2:break ee;default:break}tO(6692,6671,242),k()}et:{if(u[e+4576>>2]==(0|n)){o=u[e+4584>>2],i=u[e+4588>>2];break et}u[e+7168>>2]=0,u[e+7172>>2]=0,u[e+5748>>2]=0,u[e+5740>>2]=0,u[e+16>>2]=0,u[e+20>>2]=0,u[e+4608>>2]=0,u[e+7176>>2]=0,ex(e+148|0,0,4384),i=10,s[e+7168|0]=10,u[e+4664>>2]=1,u[e+4544>>2]=100,u[e+4576>>2]=n,s[e+4541|0]=0,u[e+4492>>2]=65536,u[e+4476>>2]=100;_:{if((0|n)==8){u[e+4688>>2]=(0|r)==4?2146:2169,o=3576;break _}u[e+4688>>2]=(0|r)==4?2112:2157,o=(i=(0|n)==12)?3576:5700,i=i?10:16}if(u[e+4692>>2]=o,u[e+4640>>2]=i,i=E(n,5),u[e+4588>>2]=i,u[e+4596>>2]=n<<1,u[e+4592>>2]=E(n,20),u[e+4552>>2]=E(n,18),o=E(E(n,327680)>>16,r),u[e+4584>>2]=o,u[e+4548>>2]=E((0|r)==4?24:14,n),(0|n)==16){u[e+4684>>2]=5872,i=80;break et}if((0|n)==12){u[e+4684>>2]=5866,i=60;break et}u[e+4684>>2]=5857}if((0|E(r,i))!=(0|o))break p;if((r=u[t+36>>2])>>>0>=11)break Z;eO:{i=e;eb:{if(!r){u[e+4652>>2]=52429,u[e+4644>>2]=0,u[e+4648>>2]=6,u[e+4636>>2]=12,u[e+4660>>2]=2,u[e+4628>>2]=1,u[e+4632>>2]=0,o=E(n,3);break eb}if((0|r)<=1){u[e+4652>>2]=49807,u[e+4644>>2]=1,u[e+4648>>2]=8,u[e+4636>>2]=14,u[e+4660>>2]=3,u[e+4628>>2]=1,u[e+4632>>2]=0;break q}if((0|r)!=2)break eO;u[e+4652>>2]=52429,u[e+4644>>2]=0,u[e+4648>>2]=6,u[e+4636>>2]=12,u[e+4660>>2]=2,u[e+4628>>2]=2,u[e+4632>>2]=0,o=E(n,3)}u[i+4600>>2]=o,i=6;break h}if((0|r)<=3){u[e+4652>>2]=49807,u[e+4644>>2]=1,u[e+4648>>2]=8,u[e+4636>>2]=14,u[e+4660>>2]=4,u[e+4628>>2]=2,u[e+4632>>2]=0;break q}if((0|r)<=5){u[e+4652>>2]=48497,u[e+4644>>2]=1,u[e+4648>>2]=10,u[e+4636>>2]=16,u[e+4660>>2]=6,u[e+4628>>2]=2,u[e+4632>>2]=1,o=E(n,5),u[e+4600>>2]=o,c=E(n,983),i=10;break h}if((0|r)<=7){u[e+4652>>2]=47186,u[e+4644>>2]=1,u[e+4648>>2]=12,u[e+4636>>2]=20,u[e+4660>>2]=8,u[e+4628>>2]=3,u[e+4632>>2]=1,o=E(n,5),u[e+4600>>2]=o,c=E(n,983),i=12;break h}u[e+4652>>2]=45875,u[e+4644>>2]=2,u[e+4648>>2]=16,u[e+4636>>2]=24,u[e+4660>>2]=16,u[e+4628>>2]=4,u[e+4632>>2]=1,o=E(n,5),u[e+4600>>2]=o,c=E(n,983),i=16;break h}tO(6609,6671,241),k()}tO(6765,6671,302),k()}tO(6863,6671,315),k()}o=E(n,5),u[e+4600>>2]=o,i=8}if(u[e+4672>>2]=c,u[e+4624>>2]=r,u[e+4604>>2]=E(n,5)+(o<<1),n=(0|i)<(0|(n=u[e+4640>>2]))?i:n,u[e+4648>>2]=n,(0|n)>=17)break t;n=u[t+32>>2],u[e+4616>>2]=n,r=u[e+6092>>2],t=u[t+44>>2],u[e+6092>>2]=t,t&&(i=e,t=r?(0|(t=(E(n>>16,-26214)-(E(65535&n,26214)>>>16|0)|0)+7|0))>2?t:2:7,u[i+6096>>2]=t),t=a+d|0,u[e+4668>>2]=1}return t}tO(6917,6671,393),k()}(p,t,u[e+20208>>2],f,h))break er;eb:if(!(!u[p+4664>>2]&T)){if(h=0,u[e+5744>>2]<1)break eb;for(;;){if(u[((h<<2)+p|0)+4724>>2]=0,!((0|(h=h+1|0))<u[e+5744>>2]))break}}if(u[p+6080>>2]=u[p+6076>>2],h=u[t+4>>2],!((0|h)>(0|(f=f+1|0))))break}if(I=0,(0|h)!=1)break en;h=u[e+4576>>2];break _}if((0|(h=u[e+4576>>2]))!=u[e+14640>>2])break et}es=(W=(0|P)>1?P>>1:1)<<1,ed=W-1|0,eu=e+10212|0,L=e+17232|0,ei=e+14784|0,eh=e+15164|0,ef=e+5100|0,e_=e+20128|0,j=e+20180|0,eA=e+14788|0,Y=e+20162|0,Q=e+15160|0,z=e+15840|0,G=e+5096|0,H=e+5776|0,en=E(P,10),X=E(en,h),M=B=O-(((0|E(X,u[e+4556>>2]))/(0|E(h,1e3))<<1)+15&-16)|0,U=0;ea:{for(;;){f=u[e+5740>>2],D=(0|E(T=(0|(h=u[e+4584>>2]-f|0))<(0|X)?h:X,u[e+4556>>2]))/(0|E(u[e+4576>>2],1e3))|0;eD:{m:{v:{E:{eM:{es:{switch(u[t>>2]-1|0){case 1:switch(u[t+4>>2]-1|0){case 1:if(p=u[e+5748>>2],h=0,!(R=(0|D)<1))for(;;){if(d[(h<<1)+B>>1]=_[(h<<2)+r>>1],(0|D)==(0|(h=h+1|0)))break}if(!(1!=u[e+20200>>2]|p)&&ev(z,H,300),h=ej(H,((f<<1)+G|0)+4|0,B,D),u[e+5740>>2]=u[e+5740>>2]+T,p=u[e+15804>>2],f=u[e+14648>>2]-p|0,f=(0|f)<(0|(T=E(u[e+14640>>2],en)))?f:T,T=h+I|0,h=0,!R)for(;;){if(d[(h<<1)+B>>1]=_[(h<<2|2)+r>>1],(0|D)==(0|(h=h+1|0)))break}h=ej(z,((p<<1)+Q|0)+4|0,B,D),u[e+15804>>2]=u[e+15804>>2]+f,I=h+T|0,h=u[e+5740>>2];break es;case 0:break;default:break eM}if(h=0,(0|D)>=1)for(;;){if(p=d[(2|(p=h<<2))+r>>1]+d[r+p>>1]|0,d[(h<<1)+B>>1]=(p>>>1|0)+(1&p),(0|D)==(0|(h=h+1|0)))break}I=ej(H,((f<<1)+G|0)+4|0,B,D)+I|0;eu:if(!(u[e+5748>>2]|2!=u[e+20200>>2])){if(I=ej(z,((u[e+15804>>2]<<1)+Q|0)+4|0,B,D)+I|0,(0|(R=u[e+4584>>2]))<1)break eu;for(N=u[e+15804>>2],P=u[e+5740>>2],h=0;;){if(d[(f=(P+(p=h+2|0)<<1)+G|0)>>1]=d[(p+N<<1)+Q>>1]+d[f>>1]>>>1,(0|R)==(0|(h=h+1|0)))break}}h=u[e+5740>>2]+T|0,u[e+5740>>2]=h;break es;case 0:break;default:break eM}if(1!=u[t+4>>2])break eM;p=ej(H,((f<<1)+G|0)+4|0,ev(B,r,D<<1),D),h=u[e+5740>>2]+T|0,u[e+5740>>2]=h,I=p+I|0}if(em=u[t>>2],u[e+20208>>2]=0,p=u[e+4584>>2],y=0,(0|p)>(0|h))break ea;if((0|h)!=(0|p))break E;if(h=u[t+4>>2],u[e+15804>>2]!=u[e+14648>>2]?(0|h)!=1:0)break v;if(u[e+5748>>2]|a)break eD;if(N=0,d[w+14>>1]=0,s[w+14|0]=0-(256>>>E(u[e+5744>>2]+1|0,h)|0),eR(n,0,w+14|0,8),(0|(T=u[t+4>>2]))<=0)break m;for(;;){if(h=0,p=0,(0|(f=u[(R=E(N,10064)+e|0)+5744>>2]))>=1)for(;;){if(p=u[((h<<2)+R|0)+4724>>2]<<h|p,(0|f)==(0|(h=h+1|0)))break}if(s[R+4723|0]=(0|p)>0,!(!p|(0|f)<2)&&(eR(n,p-1|0,u[(f<<2)+5808>>2],8),T=u[t+4>>2]),!((0|(N=N+1|0))<(0|T)))break}break m}tO(17672,17507,320),k()}tO(17758,17507,336),k()}tO(17857,17507,337),k()}if(f=0,u[e+5744>>2]>0)for(;;){if((0|T)>=1)for(N=f-1|0,J=f+j|0,P=eA+(R=f<<2)|0,O=E(f,6)+Y|0,p=0;;){if(u[(R+(h=E(p,10064)+e|0)|0)+4724>>2]){ef:if(!((0|T)!=2|p)){if(e8(n,O),u[P>>2])break ef;tj(n,s[0|J])}y=h,V=n,eb=f;t2:if(!f||(T=2,!u[((N<<2)+h|0)+4724>>2])){T=0}ec(y,V,eb,1,T),K(n,s[(T=E(f,36)+h|0)+6129|0],s[T+6130|0],(E(f,320)+h|0)+6208|0,u[h+4584>>2]),T=u[t+4>>2]}if(!((0|T)>(0|(p=p+1|0))))break}if(!((0|(f=f+1|0))<u[e+5744>>2]))break}if(h=0,(0|T)>0)for(;;){if(u[(p=E(h,10064)+e|0)+4724>>2]=0,u[p+4728>>2]=0,u[p+4732>>2]=0,!((0|(h=h+1|0))<u[t+4>>2]))break}u[e+20184>>2]=(u[n+20>>2]+b(u[n+28>>2])|0)-32}(function(e){var t=0,r=0,i=0,n=0,o=0,a=0;if(2==l[e+4541|0]){t=tE((0|E(u[e+4576>>2],65536e3))/u[e+4544>>2]|0),r=u[e+4696>>2],i=tE(3932160),a=tE(3932160),n=0-(r<<2)|0,o=u[e+8>>2],r=(E(r=r<<16>>16,65532&n)>>16)+E(n>>16,r)|0,t=(0|(t=(0|(t=(((t-(o>>8)|0)+E(r>>16,t-i<<16>>16)|0)+(E(65535&r,t-a<<16>>16)>>16)|0)-2048|0))<0?E(t,3):t))>-51?t:-51,t=E(d[e+4532>>1],(0|t)<51?t:51),u[e+8>>2]=E(t>>16,6554)+o+(E(65535&t,6554)>>>16),t=tE(60),r=tE(100),i=u[e+8>>2],n=e;r:{i:{if(t<<8>r<<8){if(tE(60)<<8<(0|i)){t=tE(60)<<8;break r}if(u[e+8>>2]>=tE(100)<<8)break i;t=tE(100)<<8;break r}if(tE(100)<<8<(0|i)){t=tE(100)<<8;break r}if(u[e+8>>2]>=tE(60)<<8)break i;t=tE(60)<<8;break r}t=u[e+8>>2]}u[n+8>>2]=t}})(e),h=u[t+28>>2],p=(0|E(h,f=u[t+24>>2]))/1e3|0,p=E((T=(0|(p=a?p:p-u[e+20184>>2]|0))/u[e+5744>>2]|0)<<16>>16,(0|f)==10?100:50)-(u[e+20188>>2]<<1)|0;eE:if(!a&&!((0|(f=u[e+5748>>2]))<1)){p=((u[e+20184>>2]+((E(f,T)-u[n+20>>2]|0)-b(u[n+28>>2])|0)<<1)+p|0)- -64|0}tB:{if((0|h)>=5001){if(O=h,(0|h)<(0|p))break tB;O=(0|p)>5e3?p:5e3;break tB}if(O=5e3,(0|p)>5e3)break tB;O=(0|h)>(0|p)?h:p}t1:{if(2==u[t+4>>2]){(function(e,t,r,i,n,o,a,c,h,p,f){var A=0,m=0,v=0,g=0,S=0,T=0,y=0,R=0,I=0,C=0,k=0,w=0,O=0,N=0,P=0,D=0,L=0;if(T=A=M-16|0,M=A,O=t-4|0,M=R=N=A-(((v=f+2|0)<<1)+15&-16)|0,(0|f)>=-1)for(k=(0|v)>1?v:1,A=0;;){if(m=d[(S=(v=A<<1)-4|0)+r>>1],g=(S=d[t+S>>1])+m|0,d[v+O>>1]=(g>>>1|0)+(1&g),I=v+N|0,v=(0|(v=((v=S-m|0)>>1)+(1&v)|0))>-32768?v:-32768,d[I>>1]=(0|v)<32767?v:32767,(0|k)==(0|(A=A+1|0)))break}I=u[e+4>>2],d[O>>1]=I,d[O+2>>1]=I>>>16,g=u[e+8>>2],u[N>>2]=g,I=O+(A=f<<1)|0,u[e+4>>2]=_[I>>1]|_[I+2>>1]<<16,I=A+N|0,u[e+8>>2]=_[I>>1]|_[I+2>>1]<<16,M=S=R=R-(v=A+15&-16)|0,A=0,C=y=S-v|0,M=y;i:{if((0|f)<=0){M=v=C=C-(A=(f<<1)+15&-16)|0,M=w=v-A|0;break i}for(k=g>>>16|0,v=_[O>>1];;){if(I=d[(S=A<<1)+t>>1]+(v<<16>>16)|0,m=(((v=d[((A=A+1|0)<<1)+O>>1])<<1)+I>>>1|0)+1>>>1|0,d[S+R>>1]=m,d[S+y>>1]=v-m,(0|f)==(0|A))break}if(M=v=C=C-(A=(f<<1)+15&-16)|0,M=w=v-A|0,(0|f)<1)break i;for(v=0;;){if(A=k,m=(((k=d[(N+(S=v<<1)|0)+4>>1])+(g<<16>>16)|0)+(A<<16>>16<<1)>>>1|0)+1>>>1|0,d[S+C>>1]=m,d[S+w>>1]=A-m,g=A,(0|(v=v+1|0))==(0|f))break}}v=(A=(0|E(p,10))==(0|f))?328:655,S=E(S=c<<16>>16,S),c=eo(T+4|0,R,C,e+12|0,f,v=(E(v,65535&S)>>>16|0)+E(S>>>16|0,v)|0),u[T+8>>2]=c,D=eo(T,y,w,e+20|0,f,v),u[T+12>>2]=D,g=b(S=(0|(k=(A?-1200:-600)+a|0))>1?k:1),y=m=S<<g-1,w=(0|(A=u[T>>2]+E(d[T+4>>1],3)|0))<65536?A:65536,R=b((R=(A=(C=E(w,3))+851968|0)>>31)^A+R),A<<=R-1,L=A,P=a=A>>31,I=a=(m=(E(A=0x1fffffff/(A>>16)<<16>>16,65535&m)>>16)+E(m>>16,A)|0)>>31,P=I=tM(L,a=P,m,I),m=(E((y=y-(((0x1fffffff&(a=x))<<3|P>>>29)&-8)|0)>>16,A)+m|0)+(E(65535&y,A)>>16)|0,A=E(p<<16>>16,600)+2e3|0,a=o,g=(g-R|0)+10|0;s:{if((0|g)<=-1){R=0x7fffffff>>>(g=0-g|0)|0,y=-0x80000000>>g,m=((0|m)>(0|R)?R:(0|m)<(0|y)?y:m)<<g;break s}m=(0|g)<32?m>>g:0}u[a>>2]=m;d:{if((0|A)>(0|m)){u[o>>2]=A,m=S-A|0,u[o+4>>2]=m,R=b((g=(m=(m<<1)-A|0)>>31)^m+g),L=g=m<<R-1,y=b((y=(m=(E(y=A<<16>>16,65535&(m=C+65536|0))>>16)+E(m>>16,y)|0)>>31)^m+y),a=I=(g=(E(m=0x1fffffff/((C=m<<y-1)>>16)<<16>>16,65535&g)>>16)+E(g>>16,m)|0)>>31,P=I=C>>31,a=P=tM(g,I=a,C,P),m=(E((C=L-(((0x1fffffff&(I=x))<<3|a>>>29)&-8)|0)>>16,m)+g|0)+(E(65535&C,m)>>16)|0,g=(R-y|0)+13|0;l:{if((0|g)<=-1){R=0x7fffffff>>>(g=0-g|0)|0,y=-0x80000000>>g,m=((0|m)>(0|R)?R:(0|m)<(0|y)?y:m)<<g;break l}m=(0|g)<32?m>>g:0}m=(0|(m=(0|m)>0?m:0))<16384?m:16384;break d}u[o+4>>2]=S-m,m=16384}m=m-(g=d[e+28>>1])|0,d[e+28>>1]=(E(m>>>16|0,v)+(E(65535&m,v<<16>>16)>>>16|0)|0)+g,a=0,s[0|n]=0;q:{Z:{p:{$:{ee:{f:{if(h){u[T+8>>2]=0,u[T+12>>2]=0,eS(T+8|0,i);break f}v=S<<3;er:{if(!_[e+30>>1]){en:{if((0|E(A,13))>(0|v)){A=d[e+28>>1];break en}if(((E(A=d[e+28>>1],65535&w)>>16)+E(w>>16,A)|0)>818)break er}u[T+12>>2]=E(D<<16>>16,A)>>14,u[T+8>>2]=E(c<<16>>16,A)>>14,eS(T+8|0,i),u[T+8>>2]=0,u[T+12>>2]=0,u[o+4>>2]=0,u[o>>2]=S,s[0|n]=1;break ee}A:{if((0|E(A,11))>(0|v)){A=d[e+28>>1];break A}if(((E(A=d[e+28>>1],65535&w)>>16)+E(w>>16,A)|0)>327)break er}u[T+12>>2]=E(D<<16>>16,A)>>14,u[T+8>>2]=E(c<<16>>16,A)>>14,eS(T+8|0,i),u[T+8>>2]=0,u[T+12>>2]=0;break f}if((0|A)>=15566){eS(T+8|0,i),a=16384;break f}u[T+12>>2]=E(D<<16>>16,A)>>14,u[T+8>>2]=E(c<<16>>16,A)>>14,eS(T+8|0,i),a=d[e+28>>1]}if(1!=l[0|n])break $}if(A=_[e+32>>1]+(f-(p<<3)|0)|0,d[e+32>>1]=A,(0|E(p,5))>A<<16>>16){s[0|n]=0;break Z}d[e+32>>1]=1e4;break p}d[e+32>>1]=0}if(l[0|n])break q}if(u[o+4>>2]>0)break q;u[o+4>>2]=1,u[o>>2]=(0|S)>2?k-1|0:1}if(v=65536/(0|(A=p<<3))|0,c=u[T+12>>2],h=u[T+8>>2],(0|p)>=1)for(w=(E(v=v<<16>>16,65535&(m=a-(S=d[e+30>>1])|0))>>16)+E(m>>16,v)<<10,p=(E(c-(m=d[e+2>>1])<<16>>16,v)>>15)+1>>1,o=(E(h-(g=d[e>>1])<<16>>16,v)>>15)+1>>1,n=(0|A)>1?A:1,v=0,k=0-g|0,R=0-m|0,S<<=10;;){if(m=v<<1,y=d[N+(v=(g=v+1|0)<<1)>>1],S=S+w|0,C=(R=R-p|0)<<16>>16,v=d[v+O>>1],I=((E(y,S>>16)+E(C,v>>5)|0)+(E(64512&S,y)>>16)|0)+(E(v<<11&63488,C)>>16)|0,v=(d[t+m>>1]+d[m+O>>1]|0)+(v<<1)|0,i=(m+r|0)-2|0,m=((v=(E(m=(k=k-o|0)<<16>>16,v>>7)+I|0)+(E(v<<9&65024,m)>>16)|0)>>7)+1>>1,d[i>>1]=(0|v)>8388479?32767:(0|m)>-32768?m:-32768,(0|(v=g))==(0|n))break}if((0|f)>(0|A))for(R=a>>6,y=a<<10&64512,m=0-(c<<16)>>16,g=0-(h<<16)>>16;;){if(i=((v=A<<1)+r|0)-2|0,k=d[N+(S=(A=A+1|0)<<1)>>1],S=d[S+O>>1],v=(d[t+v>>1]+d[v+O>>1]|0)+(S<<1)|0,S=((v=((((E(R,k)+E(S>>5,m)|0)+(E(y,k)>>16)|0)+(E(S<<11&63488,m)>>16)|0)+E(v>>7,g)|0)+(E(v<<9&65024,g)>>16)|0)>>7)+1>>1,d[i>>1]=(0|v)>8388479?32767:(0|S)>-32768?S:-32768,(0|f)==(0|A))break}d[e+30>>1]=a,d[e+2>>1]=c,d[e>>1]=h,M=T+16|0})(e_,ef,eh,E(h=u[e+5748>>2],6)+Y|0,h+j|0,w+16|0,O,u[e+4532>>2],u[t+60>>2],u[e+4576>>2],u[e+4584>>2]),h=u[e+5748>>2];C:{if(!l[j+h|0]){1==u[e+20212>>2]&&(u[(y=L)>>2]=0,u[y+4>>2]=0,u[y+8>>2]=0,u[e+10080>>2]=0,u[e+10084>>2]=0,ex(eu,0,4384),s[e+17232|0]=10,u[e+14540>>2]=100,u[e+14608>>2]=100,s[e+14605|0]=0,u[e+14728>>2]=1,u[e+14556>>2]=65536),e5(ee,c);break C}s[h+ei|0]=0}if(a)break t1;if(e8(n,E(u[e+5748>>2],6)+Y|0),l[ei+(h=u[e+5748>>2])|0])break t1;tj(n,s[h+j|0]);break t1}u[e+5096>>2]=u[e+20132>>2],y=(u[e+4584>>2]<<1)+G|0,u[e+20132>>2]=_[y>>1]|_[y+2>>1]<<16}if(J=E(D,em),e5(e,c),(0|(R=u[t+4>>2]))>=1)for(P=!U&(0|W)==2,h=0;;){T=(0|E(f=u[t+56>>2],3))/5|0;P:if(!P){if(T=f,(0|W)!=3)break P;if(T=(f<<1)/5|0,!U)break P;if(T=f,(0|U)!=1)break P;T=(0|E(f,3))/4|0}N=(0|U)==(0|ed)&0!=u[t+52>>2];eB:{if((0|R)==1){p=O;break eB}if(p=u[(w+16|0)+(h<<2)>>2],u[w+20>>2]<1|h)break eB;T=T-((0|f)/(0|es)|0)|0,N=0}if((0|p)>=1){(function(e,t){var r=0,i=0,n=0;u[e+4608>>2]=t,r=u[e+4576>>2],t=2==u[e+4580>>2]?((0|-((0|r)/16))+t|0)-2e3|0:t,n=17024,i=106;r:{switch(r-8|0){case 4:n=17136,i=154;break r;case 0:break r;default:break}n=17296,i=190}r=0,(0|(t=(0|(t=((t+200|0)/400|0)-10|0))<(0|i)?t:i))>=1&&(r=E(l[t+n|0],21)),u[e+4716>>2]=r})(f=E(h,10064)+e|0,p),y=o,V=n,p=0;eV:if(!(u[e+5748>>2]<=(0|h))&&(!h||(p=1,!u[e+20212>>2]))){p=2}I=function(e,t,r,i,n,o){var a=0,c=0,h=0,p=0,f=0,A=0,T=0,y=0,R=0,I=0,w=0,O=0,N=0,P=0,D=0,L=0,U=0,B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0,Q=0,z=0,X=0,J=0,ee=0,et=0,ei=g(0),en=0,eo=0,ea=0,es=0,ed=0,eu=0,eh=0,ef=0;if(M=p=M-13584|0,u[p+40>>2]=0,u[p+44>>2]=0,u[p+32>>2]=0,u[p+36>>2]=0,f=u[e+4620>>2],s[e+4770|0]=3&f,u[e+4620>>2]=f+1,f=u[e+4592>>2],function(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0;if(M=o=M-32|0,p=u[e+12>>2]){i=262144-((f=u[e+8>>2])<<10)|0;r:{if((0|i)<=262143){if(s=i>>16,n=64512&i){if(h=s+1|0,i=n<<16>>16,n>>>0>=32768){c=u[(n=E(h,12))+5896>>2],l=c-u[(a=E(s,12))+5896>>2]|0,u[o+24>>2]=(E(l>>16,i)+c|0)+(E(65535&l,i)>>16),l=(c=u[n+5892>>2])-u[a+5892>>2]|0,u[o+20>>2]=(E(l>>16,i)+c|0)+(E(65535&l,i)>>16),a=(n=u[n+5888>>2])-u[a+5888>>2]|0,u[o+16>>2]=(E(a>>16,i)+n|0)+(E(65535&a,i)>>16),h=u[(n=h<<3)+5956>>2],s<<=3,a=h-u[s+5956>>2]|0,u[o+12>>2]=(E(a>>16,i)+h|0)+(E(65535&a,i)>>16),s=(n=u[n+5952>>2])-u[s+5952>>2]|0,u[o+8>>2]=(E(s>>16,i)+n|0)+(E(65535&s,i)>>16);break r}n=E(h,12),c=u[(a=E(s,12))+5896>>2],l=u[n+5896>>2]-c|0,u[o+24>>2]=(E(l>>16,i)+c|0)+(E(65535&l,i)>>16),c=u[a+5892>>2],l=u[n+5892>>2]-c|0,u[o+20>>2]=(E(l>>16,i)+c|0)+(E(65535&l,i)>>16),c=u[n+5888>>2],a=c-(n=u[a+5888>>2])|0,u[o+16>>2]=(E(a>>16,i)+n|0)+(E(65535&a,i)>>16),n=h<<3,s<<=3,h=u[s+5956>>2],a=u[n+5956>>2]-h|0,u[o+12>>2]=(E(a>>16,i)+h|0)+(E(65535&a,i)>>16),s=u[s+5952>>2],n=u[n+5952>>2]-s|0,u[o+8>>2]=(E(n>>16,i)+s|0)+(E(65535&n,i)>>16);break r}i=E(s,12),u[o+24>>2]=u[i+5896>>2],n=u[(a=i+5888|0)>>2],i=u[a+4>>2],u[o+16>>2]=n,u[o+20>>2]=i,i=u[(a=(s<<3)+5952|0)>>2],n=u[a+4>>2],u[o+8>>2]=i,u[o+12>>2]=n;break r}u[o+24>>2]=u[1486],i=u[1485],n=u[1484],u[o+16>>2]=n,u[o+20>>2]=i,n=u[1497],i=u[1496],u[o+8>>2]=i,u[o+12>>2]=n}i=(0|(i=p+f|0))>0?i:0,u[e+8>>2]=(0|i)<256?i:256,function(e,t,r,i,n,o){var a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0;if((0|o)>=1)for(p=16383&(s=0-u[r+4>>2]|0),f=16383&(r=0-u[r>>2]|0),_=s<<2>>16,A=r<<2>>16,a=u[i+4>>2],c=u[i>>2];;){if(r=d[(m=h<<1)+e>>1],c=(s=(E(r,(s=u[t>>2])>>16)+c|0)+(E(65535&s,r)>>16)<<2)>>16,l=E(A,c)+a|0,v=(l+(E(A,a=65532&s)>>16)|0)+((E(c,f)+(E(a,f)>>>16|0)>>13)+1>>1)|0,u[i>>2]=v,l=u[t+4>>2],a=(E(c,_)+(E(a,_)>>16)|0)+((E(c,p)+(E(a,p)>>>16|0)>>13)+1>>1)|0,u[i+4>>2]=a,c=(E(l>>16,r)+(E(65535&l,r)>>16)|0)+v|0,u[i>>2]=c,a=((E(65535&(l=u[t+8>>2]),r)>>16)+E(l>>16,r)|0)+a|0,u[i+4>>2]=a,r=s+16383>>14,d[n+m>>1]=(0|s)>0x1fffc000?32767:(0|r)>-32768?r:-32768,(0|(h=h+1|0))==(0|o))break}}(t,o+16|0,o+8|0,e,t,r)}M=o+32|0}(e+16|0,e+5098|0,u[e+4584>>2]),I=(R=f<<2)+(W=e+7180|0)|0,T=I+((A=E(u[e+4576>>2],5))<<2)|0,(0|(y=u[e+4584>>2]))>=1)for(f=y;;){if(m[((a=f-1|0)<<2)+T>>2]=d[((f<<1)+e|0)+5096>>1],c=(0|f)>1,f=a,!c)break}m[T>>2]=m[T>>2]+g(9999999974752427e-22),m[(a=(A+(f=y>>3)<<2)+I|0)>>2]=m[a>>2]+g(9999999974752427e-22),m[(a=((f<<1)+A<<2)+I|0)>>2]=m[a>>2]+g(-9999999974752427e-22),m[(a=(E(f,3)+A<<2)+I|0)>>2]=m[a>>2]+g(-9999999974752427e-22),m[(a=((f<<2)+A<<2)+I|0)>>2]=m[a>>2]+g(9999999974752427e-22),m[(a=(E(f,5)+A<<2)+I|0)>>2]=m[a>>2]+g(9999999974752427e-22),m[(a=(E(f,6)+A<<2)+I|0)>>2]=m[a>>2]+g(-9999999974752427e-22),m[(f=(E(f,7)+A<<2)+I|0)>>2]=m[f>>2]+g(-9999999974752427e-22);i:if(!u[e+4680>>2]){if(D=e+4736|0,function(e,t,r,i,n){var o=0,a=0,c=0,h=0,p=g(0),f=0,A=0,v=0;if(M=o=M-1744|0,c=u[e+4548>>2],a=(h=u[e+4596>>2])+u[e+4584>>2]|0,(0|c)<=(0|(A=a+(f=u[e+4592>>2])|0))){eY(o,a=((a<<2)+i|0)-(c<<2)|0,1,h),v=(c=(h=u[e+4596>>2])<<2)+o|0,c=c+a|0,eY((a=u[e+4548>>2]-(h<<1)<<2)+ev(v,c,a)|0,c+a|0,2,h),tT(o+1664|0,o,u[e+4548>>2],u[e+4648>>2]+1|0),p=m[o+1664>>2],m[o+1664>>2]=p+g(g(p*g(.0010000000474974513))+g(1)),p=eV(o+1536|0,o+1664|0,u[e+4648>>2]),m[t+704>>2]=m[o+1664>>2]/(p>g(1)?p:g(1)),e6(o+1600|0,o+1536|0,u[e+4648>>2]),tl(o+1600|0,u[e+4648>>2],g(.9900000095367432)),er(r,o+1600|0,i-(f<<2)|0,A,u[e+4648>>2]);r:{if(!(!l[e+4765|0]|u[e+4664>>2])){if(!function(e,t,r,i,n,o,a,c,l,h,p,f){var A=0,v=0,b=0,T=0,y=0,R=0,I=g(0),C=0,w=0,O=0,N=0,P=0,D=0,L=g(0),x=0,U=0,B=0,V=0,F=0,j=0,G=g(0),W=0,H=0,Y=0,K=g(0),Q=0,z=g(0),X=0,J=g(0),q=g(0),Z=g(0),ee=0;M=T=M-11552|0;t:{r:{i:{n:{o:{a:{s:{c:{if(!(!(1<<l&69888)|l>>>0>16)){if((0|h)<=-1)break c;if((0|h)>=3)break s;C=(R=(y=E(p,5))+20|0)<<3,w=E(l,R);u:{if((0|l)==16){if((0|w)>=1)for(A=w;;){if(N=(T+2720|0)+((v=A-1|0)<<1)|0,b=(0|(b=tL(m[(v<<2)+e>>2])))>-32768?b:-32768,d[N>>1]=(0|b)<32767?b:32767,b=(0|A)>1,A=v,!b)break}if(u[T+8544>>2]=0,u[T+8548>>2]=0,e1(T+8544|0,T+8896|0,T+2720|0,w),(0|y)<-19)break u;for(A=C;;){if(m[(T+10176|0)+((v=A-1|0)<<2)>>2]=d[(T+8896|0)+(v<<1)>>1],b=(0|A)>1,A=v,!b)break}break u}if((0|l)==12){if((0|w)>=1)for(A=w;;){if(N=(T+2720|0)+((v=A-1|0)<<1)|0,b=(0|(b=tL(m[(v<<2)+e>>2])))>-32768?b:-32768,d[N>>1]=(0|b)<32767?b:32767,b=(0|A)>1,A=v,!b)break}if(u[(N=T+8560|0)>>2]=0,u[N+4>>2]=0,u[T+8552>>2]=0,u[T+8556>>2]=0,u[T+8544>>2]=0,u[T+8548>>2]=0,function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0,b=0,T=0,y=0;for(M=a=M-1936|0,s=u[(o=e)>>2],n=u[o+4>>2],u[a>>2]=s,u[a+4>>2]=n,s=u[o+12>>2],n=u[o+8>>2],u[a+8>>2]=n,u[a+12>>2]=s,T=o+16|0,p=d[3144],m=d[3145],f=d[3143],_=d[3142],y=a+16|0;;){if(ta(T,y,r,6280,l=(0|i)<480?i:480),(0|l)>=3)for(n=u[a>>2],o=a,s=l;;){if(A=E(n>>16,_)+(E(65535&n,_)>>16)|0,c=(n=u[o+4>>2])>>16,h=65535&n,v=(E(65535&(n=u[o+8>>2]),m)>>16)+E(n>>16,m)|0,g=(n=u[o+12>>2])>>16,S=65535&n,b=((A=((v+((E(c,f)+A|0)+(E(f,h)>>16)|0)|0)+E(g,p)|0)+(E(S,p)>>16)|0)>>5)+1>>1,d[t>>1]=(0|A)>2097119?32767:(0|b)>-32768?b:-32768,h=(((E(f,g)+(E(f,S)>>16)|0)+E(c,p)|0)+v|0)+(E(p,h)>>16)|0,h=((c=(h+E((c=u[o+16>>2])>>16,_)|0)+(E(65535&c,_)>>16)|0)>>5)+1>>1,d[t+2>>1]=(0|c)>2097119?32767:(0|h)>-32768?h:-32768,t=t+4|0,o=o+12|0,c=(0|s)>5,s=s-3|0,!c)break}if((0|(i=i-l|0))>=1){s=u[(o=(l<<2)+a|0)>>2],n=u[o+4>>2],u[a>>2]=s,u[a+4>>2]=n,s=u[o+12>>2],n=u[o+8>>2],u[a+8>>2]=n,u[a+12>>2]=s,r=(l<<1)+r|0;continue}break}s=u[(o=(l<<2)+a|0)>>2],n=u[o+4>>2],t=s,u[(s=e)>>2]=t,u[s+4>>2]=n,s=u[o+12>>2],t=n=u[o+8>>2],u[(n=e)+8>>2]=t,u[n+12>>2]=s,M=a+1936|0}(T+8544|0,T+8896|0,T+2720|0,w),(0|y)<-19)break u;for(A=C;;){if(m[(T+10176|0)+((v=A-1|0)<<2)>>2]=d[(T+8896|0)+(v<<1)>>1],b=(0|A)>1,A=v,!b)break}break u}if((0|l)!=8)break a;if((0|y)<-19)break u;for(A=C;;){if(N=(T+8896|0)+((v=A-1|0)<<1)|0,b=(0|(b=tL(m[(v<<2)+e>>2])))>-32768?b:-32768,d[N>>1]=(0|b)<32767?b:32767,b=(0|A)>1,A=v,!b)break}}R<<=2,u[T+8544>>2]=0,u[T+8548>>2]=0,e1(T+8544|0,T+8576|0,T+8896|0,C);er:if(!((0|y)<-19)){for(A=R;;){if(m[(T+9536|0)+((v=A-1|0)<<2)>>2]=d[(T+8576|0)+(v<<1)>>1],b=(0|A)>1,A=v,!b)break}if((0|y)<-19)break er;for(A=R;;){L=m[((A<<2)+T|0)+9528>>2],I=m[(b=(T+9536|0)+((v=A-1|0)<<2)|0)>>2];eo:{if(g(S(I))<g(0x80000000)){y=~~I;break eo}y=-0x80000000}L=g(L+g(0|y)),I=g(32767);eb:if(!(L>g(32767))){if(I=g(-32768),L<g(-32768))break eb;I=L}eO:{if(g(S(I))<g(0x80000000)){y=~~I;break eO}y=-0x80000000}if(m[b>>2]=0|y,b=(0|A)>2,A=v,!b)break}}if(y=0,ex(T+6160|0,0,E(p,596)),(0|p)>=2)for(C=(0|(A=p>>1))>1?A:1,R=(T+9536|0)+(R<<2)|0,A=T+9856|0;;){if((w=A+160|0)>>>0>R>>>0)break o;if((v=A-32|0)>>>0<T+9536>>>0)break n;if(A+128>>>0>R>>>0)break i;for($(A,A-288|0,T+5888|0,40,65,f),I=m[T+6144>>2],O=tn(A,40),P=tn(v,40),H=+I,O=O+P+16e4,m[T+6192>>2]=m[T+6192>>2]+g((H+H)/O),A=9;;){if(N=b=(T+6160|0)+(A<<2)|0,I=m[b>>2],H=(P=+m[((0-A<<2)+T|0)+6176>>2])+P,X=(P=+m[(b=v-4|0)>>2])*P,O+=X-(P=+m[v+156>>2])*P,m[N>>2]=I+g(H/O),v=b,(0|(A=A+1|0))==73)break}if(A=w,(0|C)==(0|(y=y+1|0)))break}for(U=l<<1,Y=E(l,5),j=(F=E(l,18))-1|0,b=p<<2,A=72;;){if(I=m[(v=(T+6160|0)+(A<<2)|0)>>2],m[v>>2]=I+g(g(I*g(0|A))*g(-244140625e-12)),v=A>>>0>8,A=A-1|0,!v)break}(function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=g(0),l=g(0),h=0;t:{r:{if((0|i)>0){if((0|r)<=0)break r;if((0|r)<(0|i))break t;for(;;){if(u[(n<<2)+t>>2]=n,(0|(n=n+1|0))==(0|i))break}if(a=1,(0|i)>1)for(;;){d=m[(a<<2)+e>>2],n=a;s:{for(;;){if((l=m[(o=(s=n-1|0)<<2)+e>>2])<d^1)break s;if(m[(c=n<<2)+e>>2]=l,u[t+c>>2]=u[t+o>>2],o=(0|n)>1,n=s,!o)break}n=0}if(m[(n<<=2)+e>>2]=d,u[t+n>>2]=a,(0|(a=a+1|0))==(0|i))break}if((0|r)>(0|i))for(a=i-2|0,h=((i<<2)+e|0)-4|0,c=i;;){if(!((d=m[(c<<2)+e>>2])>m[h>>2]^1)){o=n=a;h:if(!((0|i)<2)){for(;;){if((l=m[(s=n<<2)+e>>2])<d^1){o=n;break h}if(m[(o=s+4|0)+e>>2]=l,u[t+o>>2]=u[t+s>>2],o=-1,s=(0|n)>0,n=n-1|0,!s)break}}m[(n=(o<<2)+4|0)+e>>2]=d,u[t+n>>2]=c}if((0|(c=c+1|0))==(0|r))break}return}tO(9912,9936,50),k()}tO(9958,9936,51),k()}tO(9982,9936,52),k()})(T+6192|0,T+5744|0,65,v=(h<<1)+4|0);v:{I=m[T+6192>>2];E:{if(!(I<g(.20000000298023224)^1)){ex(t,0,b);break E}es:if(!((0|h)<-1)){for(I=g(I*a),y=(0|v)>1?v:1,A=0;;){if(m[((b=A<<2)+T|0)+6192>>2]>I^1){v=A;break es}if(u[(b=(T+5744|0)+b|0)>>2]=(u[b>>2]<<1)+16,(0|y)==(0|(A=A+1|0)))break}}if(A=0,(0|v)<=0)break r;for(ex(T+5462|0,0,274);;){if(d[(T+5440|0)+(u[(T+5744|0)+(A<<2)>>2]<<1)>>1]=1,(0|v)==(0|(A=A+1|0)))break}for(A=146,b=_[T+5730>>1];;){if(y=_[(v=(T+5440|0)+(A<<1)|0)-4>>1],d[v>>1]=_[v>>1]+(b+y|0),v=16,R=A>>>0>16,b=y,A=A-1|0,!R)break}for(;;){if(d[(T+5440|0)+((A=v+1|0)<<1)>>1]>=1&&(u[(T+5744|0)+(B<<2)>>2]=v,B=B+1|0),v=A,(0|A)==144)break}for(v=146,b=_[T+5728>>1],y=_[T+5730>>1];;){if(R=b,N=b+y|0,b=_[(A=(T+5440|0)+(v<<1)|0)-6>>1],d[A>>1]=_[A>>1]+(b+N|0),A=16,w=v>>>0>16,y=R,v=v-1|0,!w)break}for(R=0;;){if(d[(T+5440|0)+(A<<1)>>1]>=1&&(d[(T+5440|0)+(R<<1)>>1]=A-2,R=R+1|0),(0|(A=A+1|0))==147)break}if(w=0,ex(T+6160|0,0,2384),(0|p)>=1)for(v=(0|l)==8?e+640|0:T+10816|0,C=(0|R)<1;;){if(O=tn(v,40),!C)for(P=O+1,A=0;;){if(I=g(0),!((O=e7(y=v-(b=d[(T+5440|0)+(A<<1)>>1]<<2)|0,v,40))>0^1)&&(I=g((O+O)/(P+tn(y,40)))),m[((T+6160|0)+E(w,596)|0)+b>>2]=I,(0|R)==(0|(A=A+1|0)))break}if(v=v+160|0,(0|(w=w+1|0))==(0|p))break}if(J=a=(0|o)<1?g(0):g(3.32192809488736*eT(+g(0|(o=(0|l)==12?(o<<1)/3|0:o>>>((0|l)==16)|0)))),(0|B)>=1){for(w=(A=(0|p)==4)&&(0|l)==8&&(0|h)>0?11:3,y=A?10048:10007,R=A?11:3,K=g(0|p),q=g(K*c),z=g(K*g(.20000000298023224)),D=-1,c=g(-1e3),a=g(0),V=(0|p)<1,Q=(0|o)<1,o=0;;){for(b=u[(T+5744|0)+(x<<2)>>2],v=0;;){if(u[(C=(T+5840|0)+(v<<2)|0)>>2]=0,I=g(0),A=0,!V){for(;;){if(I=g(m[((T+6160|0)+E(A,596)|0)+(s[(E(A,R)+v|0)+y|0]+b<<2)>>2]+I),(0|(A=A+1|0))==(0|p))break}m[C>>2]=I}if((0|w)==(0|(v=v+1|0)))break}for(I=g(-1e3),A=0,v=0;;){if(I=(C=(L=m[(T+5840|0)+(A<<2)>>2])>I)?L:I,v=C?A:v,(0|w)==(0|(A=A+1|0)))break}if(G=g(3.32192809488736*eT(+g(0|b))),L=g(I-g(z*G)),Z=I,!Q&&(G=g(G-J),G=g(G*G),L=g(L-g(g(G*g(z*m[n>>2]))/g(G+g(.5))))),a=(A=c<L&I>q)?Z:a,c=A?L:c,D=A?b:D,o=A?v:o,(0|(x=x+1|0))==(0|B))break}if((0|D)!=-1)break v}u[(N=t)>>2]=0,u[N+4>>2]=0,u[N+8>>2]=0,u[N+12>>2]=0}u[n>>2]=0,d[r>>1]=0,s[0|i]=0,A=1;break t}m[n>>2]=a/K,ee=r;y:{if((0|l)<=8){if(A=0,(0|p)>0)for(;;){if(v=(0|(v=s[(E(A,R)+o|0)+y|0]+D|0))>16?v:16,u[(A<<2)+t>>2]=(0|v)<144?v:144,(0|(A=A+1|0))==(0|p))break}A=D-16|0;break y}tB:{if((0|l)==12){A=((A=E(D<<16>>16,3))>>1)+(1&A)|0;break tB}A=D<<1}t1:{if((0|U)>=(0|F)){if(x=U,(0|A)>(0|U))break t1;x=(0|A)<(0|j)?j:A;break t1}if(x=j,(0|A)>=(0|F))break t1;x=(0|A)<(0|U)?U:A}switch(V=10016,D=10040,R=12,n=12,p-2|0){default:tO(10770,10329,518),k();case 2:D=(h<<3)+10240|0,R=s[h+10264|0],V=10096,n=34;break;case 0:break}for(j=(0|(A=x+2|0))<(0|j)?A:j,Q=0-(B=(0|(A=x-2|0))>(0|U)?A:U)<<2,o=l=E(l,80)+e|0,y=0;;){if(b=s[(1|(A=y<<1))+D|0],$(o,(o+Q|0)-(b<<2)|0,T+2720|0,Y,b+(A=1-(C=s[A+D|0])|0)|0,f),!(v=(0|b)<(0|C)))for(w=(v?C:b)+A|0,A=0,v=C;;){if(u[(T+11456|0)+(A<<2)>>2]=u[(T+2720|0)+(b-v<<2)>>2],v=v+1|0,(0|w)==(0|(A=A+1|0)))break}if((0|R)>=1)for(w=E(n,y),C=(T+11456|0)+(0-C<<2)|0,A=0;;){if(W=u[(b=(s[(A+w|0)+V|0]<<2)+C|0)>>2],N=u[b+4>>2],u[(v=(E(y,680)+T|0)+E(A,20)|0)>>2]=W,u[v+4>>2]=N,u[v+16>>2]=u[b+16>>2],W=u[b+12>>2],N=u[b+8>>2],u[v+8>>2]=N,u[v+12>>2]=W,(0|R)==(0|(A=A+1|0)))break}if(o=(Y<<2)+o|0,(0|(y=y+1|0))==(0|p))break}switch(V=10016,D=10040,R=12,e=12,p-2|0){default:tO(10770,10329,584),k();case 2:D=(h<<3)+10240|0,R=s[h+10264|0],V=10096,e=34;break;case 0:break}for(o=l,y=0;;){if(O=tn(v=o-(B+(C=s[D+(A=y<<1)|0])<<2)|0,Y)+.001,m[T+11456>>2]=O,(0|C)<(0|(b=s[(1|A)+D|0])))for(A=1,w=(b-C|0)+1|0;;){if(P=O-(P=+m[(Y-A<<2)+v>>2])*P,O=P+(O=+m[v-(b=A<<2)>>2])*O,m[(T+11456|0)+b>>2]=O,(0|w)==(0|(A=A+1|0)))break}if((0|R)>=1)for(w=E(e,y),C=(T+11456|0)+(0-C<<2)|0,A=0;;){if(W=u[(b=(s[(A+w|0)+V|0]<<2)+C|0)>>2],N=u[b+4>>2],u[(v=((T+2720|0)+E(y,680)|0)+E(A,20)|0)>>2]=W,u[v+4>>2]=N,u[v+16>>2]=u[b+16>>2],W=u[b+12>>2],N=u[b+8>>2],u[v+8>>2]=N,u[v+12>>2]=W,(0|R)==(0|(A=A+1|0)))break}if(o=(Y<<2)+o|0,(0|(y=y+1|0))==(0|p))break}L:{if((0|p)!=4){D=10016,e=12,C=12;break L}D=10096,e=34,C=s[h+10264|0]}if(O=tn(l,E(p,Y)),o=0,(0|B)<=(0|j))for(c=g(g(.05000000074505806)/g(0|x)),H=O+1,L=g(-1e3),V=(0|p)<1,w=0;;){if(R=0,(0|C)>0)for(;;){I=g(0);t4:if(!V){for(O=0,A=0,P=H;;){if(y=w<<2,b=E(R,20),P+=+m[y+(b+((v=E(A,680))+(T+2720|0)|0)|0)>>2],O+=+m[((v+T|0)+b|0)+y>>2],(0|(A=A+1|0))==(0|p))break}if(O>0^1)break t4;I=g(g(g(1)-g(c*g(0|R)))*g((O+O)/P))}if(!(I>L^1)&&(x=(A=(s[R+10096|0]+B|0)<(0|F))?B:x,L=A?I:L,o=A?R:o),(0|C)==(0|(R=R+1|0)))break}if(w=w+1|0,A=(0|B)<(0|j),B=B+1|0,!A)break}if((0|p)>=1)for(A=0;;){y=(A<<2)+t|0,v=s[(E(e,A)+o|0)+D|0]+x|0,u[y>>2]=v;eY:{if((0|U)>(0|F)){if((0|(b=U))<(0|v))break eY;b=(0|v)<(0|F)?F:v;break eY}if((0|(b=F))<(0|v))break eY;b=(0|v)<(0|U)?U:v}if(u[y>>2]=b,(0|(A=A+1|0))==(0|p))break}A=x-U|0}if(d[ee>>1]=A,s[0|i]=o,A=0,d[r>>1]>-1)break t;tO(10737,10329,474),k()}tO(10267,10329,112),k()}tO(10366,10329,115),k()}tO(10418,10329,116),k()}tO(10470,10329,151),k()}tO(10500,10329,173),k()}tO(10580,10329,178),k()}tO(10622,10329,179),k()}tO(10701,10329,241),k()}return M=T+11552|0,A}(r,t+228|0,e+4762|0,e+4764|0,e+10060|0,u[e+4544>>2],g(g(u[e+4652>>2])*g(152587890625e-16)),g(g(g(g(g(g(u[e+4648>>2])*g(-.004000000189989805))+g(.6000000238418579))+g(g(g(u[e+4532>>2])*g(.10000000149011612))*g(-.00390625)))+g(g(s[e+4541|0]>>1)*g(-.15000000596046448)))+g(g(g(u[e+4712>>2])*g(.10000000149011612))*g(-30517578125e-15))),u[e+4576>>2],u[e+4644>>2],u[e+4580>>2],n)){s[e+4765|0]=2;break r}s[e+4765|0]=1;break r}u[t+228>>2]=0,u[t+232>>2]=0,u[t+236>>2]=0,u[t+240>>2]=0,u[e+10060>>2]=0,s[e+4764|0]=0,d[e+4762>>1]=0}M=o+1744|0;return}tO(10821,10883,59),k()}(e,p+8480|0,p+5792|0,I,u[e+5092>>2]),f=(p+5792|0)+R|0,function(e,t,r,i){var n=0,o=g(0),a=0,c=0,h=0,p=g(0),f=g(0),_=0,A=g(0),b=0,T=g(0),y=0,R=g(0),I=0,w=0,O=0,N=0,P=g(0),D=g(0),L=g(0),x=0,U=0,B=0;M=_=M-1184|0,b=u[e+4600>>2],n=u[e+4716>>2],o=g(g(g(u[e+4700>>2]+u[e+4696>>2]|0)*g(.5))*g(30517578125e-15)),m[t+696>>2]=o,f=g(0|n),A=g(f*g(.0078125)),p=g(1/(eI(+g(g(A+g(-20))*g(-.25)))+1)),m[t+700>>2]=p,!u[e+4676>>2]&&(T=g(g(g(u[e+4532>>2])*g(-.00390625))+g(1)),A=g(A-g(T*g(T*g(g(g(o*g(.5))+g(.5))*g(p+p))))));r:{if(2==l[e+4765|0]){s[e+4766|0]=0,P=g(A+g((o=m[e+10060>>2])+o));break r}if(R=g(g(g(g(f*g(-.4000000059604645))*g(.0078125))+g(6))*g(g(1)-o)),a=(0|(n=E(d[e+4580>>1],5)))/2|0,o=g(0),(0|n)>=2)for(T=g(0|(c=u[e+4576>>2]<<1)),p=g(0),n=0,h=c<<2;;){if(f=g(3.32192809488736*eT(+g(T+g(tn(r,c))))),o=n?g(o+g(S(g(f-p)))):o,r=r+h|0,p=f,(0|a)==(0|(n=n+1|0)))break}if(P=g(R+A),!(g(g(a-1|0)*g(.6000000238418579))<o^1)){s[e+4766|0]=0;break r}s[e+4766|0]=1}r=u[e+4580>>2];s:{if((0|r)<1){n=0;break s}for(y=i-(b<<2)|0,o=g(m[t+704>>2]*g(.0010000000474974513)),L=g(g(.9399999976158142)/g(g(o*o)+g(1))),f=g(g(g(u[e+4672>>2])*g(152587890625e-16))+g(m[t+700>>2]*g(.009999999776482582))),D=g(g(1)-g(f*f)),R=g(-f);;){a=E(n=u[e+4576>>2],3),eY(_+224|0,y,1,r=(u[e+4604>>2]-a|0)/2|0),ev((c=r<<2)+(_+224|0)|0,c+y|0,E(n,12)),eY((n=r+a<<2)+(_+224|0)|0,n+y|0,2,r),h=u[e+4588>>2],r=u[e+4636>>2],n=u[e+4604>>2];u:{if(u[e+4672>>2]>=1){(function(e,t,r,i,n){var o=0,a=0,s=0,c=0,d=0,u=0,l=0,h=0,p=0,f=0,_=0,A=0,E=0,g=0,S=0;if(M=o=M-416|0,ex(o+208|0,0,200),o=ex(o,0,200),!(1&n)){if((0|i)>=1)for(l=(a=n<<3)+o|0,g=(o+208|0)+a|0,h=+r,S=(0|n)<1;;){if(c=+m[(d<<2)+t>>2],a=0,!S)for(;;){if(_=v[(f=(p=8|(s=a<<3))+(o+208|0)|0)>>3],v[(o+208|0)+s>>3]=c,s=o+s|0,A=v[o+208>>3],v[s>>3]=v[s>>3]+c*A,E=v[(o+208|0)+((a=a+2|0)<<3)>>3],c=u+(_-c)*h,v[f>>3]=c,v[(s=o+p|0)>>3]=A*c+v[s>>3],c=_+(E-c)*h,u=E,!((0|n)>(0|a)))break}if(v[g>>3]=c,u=v[o+208>>3],v[l>>3]=v[l>>3]+c*u,(0|(d=d+1|0))==(0|i))break}if(a=0,(0|n)>=0)for(;;){if(m[(a<<2)+e>>2]=v[(a<<3)+o>>3],s=(0|n)!=(0|a),a=a+1|0,!s)break}M=o+416|0;return}tO(10944,10981,49),k()})(_+112|0,_+224|0,f,n,r);break u}tT(_+112|0,_+224|0,n,r+1|0)}if(o=m[_+112>>2],m[_+112>>2]=o+g(g(o*g(29999999242136255e-21))+g(1)),o=eV(_,_+112|0,u[e+4636>>2]),e6(r=(E(I,96)+t|0)+244|0,_,u[e+4636>>2]),i=(I<<2)+t|0,p=g(C(o)),m[i>>2]=p,c=u[e+4636>>2],u[e+4672>>2]>=1){if(o=g(m[((c<<2)+r|0)-4>>2]*R),(0|c)>=2)for(n=c-2|0;;){if(o=g(g(o+m[(n<<2)+r>>2])*R),a=(0|n)>0,n=n-1|0,!a)break}m[i>>2]=p*g(g(1)/g(g(1)-o))}x=h<<2,tl(r,c,L),a=u[e+4636>>2];p:{if(u[e+4672>>2]>=1){if(w=a-1|0,!(N=(0|a)<2))for(o=m[(w<<2)+r>>2],n=w;;){if(o=g(m[(h=((c=n-1|0)<<2)+r|0)>>2]-g(f*o)),m[h>>2]=o,h=(0|n)>1,n=c,!h)break}if(c=(0|a)<1)break p;if(A=g(D/g(g(f*(o=m[r>>2]))+g(1))),m[r>>2]=A*o,b=1,(0|a)!=1){for(;;){if(m[(n=(b<<2)+r|0)>>2]=A*m[n>>2],(0|(b=b+1|0))==(0|a))break}if(c)break p;b=(0|a)==1}for(U=(w<<2)+r|0,O=0,c=0;;){for(o=g(-1),n=0;;){if(o=(h=(p=g(S(m[(n<<2)+r>>2])))>o)?p:o,c=h?n:c,(0|a)==(0|(n=n+1|0)))break}if(o<=g(3.999000072479248))break p;if(!N)for(p=m[r>>2],n=1;;){if(T=m[(h=(n<<2)+r|0)>>2],m[h-4>>2]=p+g(f*T),p=T,(0|a)==(0|(n=n+1|0)))break}for(p=g(g(1)/A),n=0;;){if(m[(h=(n<<2)+r|0)>>2]=p*m[h>>2],(0|a)==(0|(n=n+1|0)))break}if(tl(r,a,g(g(.9900000095367432)-g(g(g(g(g(0|O)*g(.10000000149011612))+g(.800000011920929))*g(o+g(-3.999000072479248)))/g(o*g(c+1|0))))),!N)for(o=m[U>>2],n=w;;){if(o=g(m[(i=((h=n-1|0)<<2)+r|0)>>2]-g(f*o)),m[i>>2]=o,i=(0|n)>1,n=h,!i)break}if(A=g(D/g(g(f*(o=m[r>>2]))+g(1))),m[r>>2]=A*o,n=1,!b)for(;;){if(m[(h=(n<<2)+r|0)>>2]=A*m[h>>2],(0|a)==(0|(n=n+1|0)))break}if((0|(O=O+1|0))==10)break}break p}if(i=0,c=0,(0|a)<1)break p;for(;;){for(o=g(-1),n=0;;){if(o=(h=(p=g(S(m[(n<<2)+r>>2])))>o)?p:o,c=h?n:c,(0|a)==(0|(n=n+1|0)))break}if(o<=g(3.999000072479248))break p;if(tl(r,a,g(g(.9900000095367432)-g(g(g(g(g(0|i)*g(.10000000149011612))+g(.800000011920929))*g(o+g(-3.999000072479248)))/g(o*g(c+1|0))))),(0|(i=i+1|0))==10)break}}if(y=y+x|0,r=u[e+4580>>2],!((0|r)>(0|(I=I+1|0))))break}if(n=0,B=eJ(+g(P*g(-.1599999964237213))),(0|r)<1)break s;for(c=(0|r)>0,o=g(B);;){if(m[(a=(n<<2)+t|0)>>2]=g(m[a>>2]*o)+g(1.2483305931091309),(0|(n=n+1|0))==(0|r))break}n=c}T=g(u[e+4532>>2]),p=g(g(T*g(.00390625))*g(g(g(g(g(g(u[e+4696>>2])*g(30517578125e-15))+g(-1))*g(.5))+g(1))*g(4))),b=l[e+4765|0];E:{eM:{es:{if((0|b)==2){if(n)for(f=g(g(.20000000298023224)/g(u[e+4576>>2])),a=0;;){if(c=(a<<2)+t|0,o=g(f+g(g(3)/g(u[c+228>>2]))),m[c+628>>2]=o+g(-1),m[c+644>>2]=g(g(1)-o)-g(p*o),(0|(a=a+1|0))==(0|r))break}p=g(g(g(T*g(-.26249998807907104))*g(.00390625))+g(-.25));break es}if(o=g(g(1.2999999523162842)/g(u[e+4576>>2])),f=g(o+g(-1)),m[t+628>>2]=f,m[t+644>>2]=g(g(1)-o)+g(g(p*o)*g(-.6000000238418579)),(0|r)<=1){if(!n)break E;p=g(-.25),f=g(0);break eM}if(m[t+632>>2]=f,u[t+648>>2]=u[t+644>>2],a=2,p=g(-.25),(0|r)==2)break es;for(h=t+628|0,i=t+644|0;;){if(u[h+(c=a<<2)>>2]=u[t+628>>2],u[i+c>>2]=u[t+644>>2],(0|(a=a+1|0))==(0|r))break}}if((0|b)==2){if(!n)break E;f=g(g(C(m[e+10060>>2]))*g(g(g(g(1)-g(g(g(1)-m[t+700>>2])*m[t+696>>2]))*g(.20000000298023224))+g(.30000001192092896)));break eM}if(f=g(0),!n)break E}for(n=0;;){if(o=g((o=m[e+7172>>2])+g(g(f-o)*g(.4000000059604645))),m[e+7172>>2]=o,m[(a=(n<<2)+t|0)+676>>2]=o,o=g((o=m[e+7176>>2])+g(g(p-o)*g(.4000000059604645))),m[e+7176>>2]=o,m[a+660>>2]=o,(0|(n=n+1|0))==(0|r))break}}M=_+1184|0}(e,p+8480|0,f,I),function(e,t,r,i,n){var o=0,a=0,c=0,h=0,p=g(0);M=o=M-2064|0;t:{r:{c=u[e+4580>>2];i:{if((0|c)>=1){for(;;){if(m[(h=a<<2)+(o+1568|0)>>2]=g(1)/m[t+h>>2],(0|c)==(0|(a=a+1|0)))break}if(2==l[e+4765|0])break i;if((0|c)<1)break r;for(a=i-((n=u[e+4640>>2])<<2)|0,h=u[e+4588>>2],i=0,r=o;;){if(function(e,t,r,i){var n=0,o=0,a=0,s=0;if(s=65532&i)for(;;){if(m[(n=o<<2)+e>>2]=m[t+n>>2]*r,m[(a=4|n)+e>>2]=m[t+a>>2]*r,m[(a=8|n)+e>>2]=m[t+a>>2]*r,m[(n|=12)+e>>2]=m[t+n>>2]*r,!(s>>>0>(o=o+4|0)>>>0))break}if((0|i)>(0|o))for(;;){if(m[(n=o<<2)+e>>2]=m[t+n>>2]*r,(0|(o=o+1|0))==(0|i))break}}(r,a,m[(o+1568|0)+(i<<2)>>2],n+h|0),a=((h=u[e+4588>>2])<<2)+a|0,r=(h+(n=u[e+4640>>2])<<2)+r|0,!((0|(i=i+1|0))<(0|(c=u[e+4580>>2]))))break}break r}if(2!=l[e+4765|0])break r}if((u[t+228>>2]+2|0)<=(u[e+4592>>2]-u[e+4640>>2]|0)){(function(e,t,r,i,n,o){var a=g(0),s=0,c=0,d=g(0),l=0;if((0|o)>=1)for(l=n+5|0;;){if(!function(e,t,r,i){var n=0,o=g(0),a=0,s=0,c=0,d=0,u=0,l=0,h=g(0);a=tn(c=((u=4)<<2)+e|0,t),m[i>>2]=a;t:if(!((0|r)<2)){for(n=1;;){if(h=g((o=m[c-(n<<2)>>2])*o),a+=+g(h-g((o=m[(t-n<<2)+c>>2])*o)),m[(E(r,n)+n<<2)+i>>2]=a,(0|(n=n+1|0))==(0|r))break}if((0|r)<2)break t;for(e=((r<<2)+e|0)-8|0,s=1;;){if(n=(E(r,s)<<2)+i|0,o=g(a=e7(c,e,t)),m[n>>2]=o,m[(s<<2)+i>>2]=o,n=1,(r-s|0)>=2)for(;;){if(l=n+s|0,o=g(m[c-(d=n<<2)>>2]*m[e-d>>2]),a+=+g(o-g(m[(d=t-n<<2)+c>>2]*m[e+d>>2])),o=g(a),m[(E(l,r)+n<<2)+i>>2]=o,m[(E(r,n)+l<<2)+i>>2]=o,(0|u)==(0|(n=n+1|0)))break}if(u=u-1|0,e=e-4|0,(0|(s=s+1|0))==(0|r))break}}}(c=(r-(u[(s<<2)+i>>2]<<2)|0)-8|0,n,5,e),function(e,t,r,i,n){var o=0;if((0|i)>=1)for(e=((i<<2)+e|0)-4|0;;){if(m[(o<<2)+n>>2]=e7(e,t,r),e=e-4|0,(0|(o=o+1|0))==(0|i))break}}(c,r,n,5,t),a=g(tn(r,l)),d=g(g(g(m[e>>2]+m[e+96>>2])*g(.014999999664723873))+g(1)),ti(e,a=g(g(1)/(a>d?a:d)),25),ti(t,a,5),t=t+20|0,e=e+100|0,r=(n<<2)+r|0,(0|(s=s+1|0))==(0|o))break}})(o+1664|0,o+1584|0,r,a=t+228|0,u[e+4588>>2],c),function(e,t,r,i,n,o,a,s,c,l){var h=0,p=0,f=0,_=0;if(M=p=M-528|0,(0|(_=E(c,25)))>0)for(;;){if(u[(f=h<<2)+(p+80|0)>>2]=tL(g(m[o+f>>2]*g(131072))),(0|_)==(0|(h=h+1|0)))break}i:{if((0|c)>=1){for(o=(0|(h=E(c,5)))>1?h:1,h=0;;){if(u[(f=h<<2)+p>>2]=tL(g(m[a+f>>2]*g(131072))),(0|(h=h+1|0))==(0|o))break}if(eE(p+480|0,t,r,i,p+524|0,p+80|0,p,s,c,l),(0|c)<1)break i;for(f=(0|(h=E(c,5)))>1?h:1,h=0;;){if(m[(h<<2)+e>>2]=g(d[(p+480|0)+(h<<1)>>1])*g(6103515625e-14),(0|f)==(0|(h=h+1|0)))break}break i}eE(p+480|0,t,r,i,p+524|0,p+80|0,p,s,c,l)}m[n>>2]=g(u[p+524>>2])*g(.0078125),M=p+528|0}(h=t+144|0,e+4740|0,e+4768|0,e+4656|0,t+708|0,o+1664|0,o+1584|0,u[e+4588>>2],u[e+4580>>2],u[e+5092>>2]),function(e,t,r){var i=0,n=g(0),o=0;o=e+4769|0,i=0;t:if(!r){if(i=2,(n=g(g(m[t+708>>2]*g(u[e+5744>>2]+u[e+4616>>2]|0))*g(.10000000149011612)))>g(2))break t;if(i=0,n<g(0))break t;if(i=~~n,g(S(n))<g(0x80000000))break t;i=-0x80000000}s[0|o]=i,m[t+224>>2]=g(d[(i<<1)+5848>>1])*g(6103515625e-14)}(e,t,n),function(e,t,r,i,n,o,a,s){var c=g(0),d=0,l=0,h=0,p=0,f=0,_=0,A=0,v=g(0);if(d=M-32|0,(0|a)>=1)for(A=(0|(_=o+s|0))<1;;){if(v=m[(s=f<<2)+n>>2],h=u[i+s>>2],s=E(f,20)+r|0,u[d+16>>2]=u[s+16>>2],p=u[s+4>>2],l=u[s>>2],u[d>>2]=l,u[d+4>>2]=p,l=u[s+12>>2],p=u[s+8>>2],u[d+8>>2]=p,u[d+12>>2]=l,!A)for(s=t-(h<<2)|0,p=0;;){if(h=(l=p<<2)+e|0,c=m[(l=t+l|0)>>2],l=u[l>>2],u[h>>2]=l,c=g(c-g(m[d>>2]*m[s+8>>2])),m[h>>2]=c,c=g(c-g(m[d+4>>2]*m[s+4>>2])),m[h>>2]=c,c=g(c-g(m[d+8>>2]*m[s>>2])),m[h>>2]=c,c=g(c-g(m[d+12>>2]*m[s-4>>2])),m[h>>2]=c,m[h>>2]=v*g(c-g(m[d+16>>2]*m[s-8>>2])),s=s+4|0,(0|_)==(0|(p=p+1|0)))break}if(t=(o<<2)+t|0,e=(_<<2)+e|0,(0|(f=f+1|0))==(0|a))break}}(o,i-((c=u[e+4640>>2])<<2)|0,h,a,o+1568|0,u[e+4588>>2],u[e+4580>>2],c);break t}tO(16745,16862,62),k()}ex(t+144|0,0,E(c,20)),u[t+708>>2]=0,u[e+4656>>2]=0}p=g(.009999999776482582),r=e,n=o+1536|0,i=o,!u[e+4664>>2]&&(p=m[t+700>>2],p=g(g(g(eJ(+g(m[t+708>>2]/g(3))))/g(1e4))/g(g(p*g(.75))+g(.25)))),function(e,t,r,i){var n=0,o=0,a=0,c=0,h=g(0),p=g(0),f=0,_=0,A=0;M=n=M-1696|0,s[e+4767|0]=4,h=q(n+1632|0,r,i,c=(a=u[e+4640>>2])+u[e+4588>>2]|0,u[e+4580>>2],a);t:if(!(!u[e+4632>>2]|u[e+4664>>2]|4!=u[e+4580>>2])){for(o=3,i=q(n+1536|0,(c<<3)+r|0,i,c,2,u[e+4640>>2]),t_(t,n+1536|0,u[e+4640>>2]),f=e+4500|0,_=c<<1,h=g(h-i),p=g(34028234663852886e22);;){tc(n+1600|0,f,t,a=o,u[e+4640>>2]),function(e,t,r,i){var n=0;if(M=n=M-32|0,Z(n,t,r,i),(0|r)>=1)for(t=0;;){if(m[(t<<2)+e>>2]=g(d[(t<<1)+n>>1])*g(244140625e-12),(0|r)==(0|(t=t+1|0)))break}M=n+32|0}(n+1536|0,n+1600|0,u[e+4640>>2],u[e+5092>>2]),er(n,n+1536|0,r,_,u[e+4640>>2]),A=tn(((o=u[e+4640>>2])<<2)+n|0,c-o|0),i=g(A+tn((((o=u[e+4640>>2])<<2)+n|0)+(c<<2)|0,c-o|0));i:{if(!(h>i^1)){s[e+4767|0]=a,h=i;break i}if(i>p)break t}if(o=a-1|0,p=i,!a)break}}o:if((4!=l[e+4767|0]||(t_(t,n+1632|0,u[e+4640>>2]),4!=l[e+4767|0]))&&(4==u[e+4580>>2]?!u[e+4632>>2]|u[e+4664>>2]:!0)){tO(16554,16719,103),k()}M=n+1696|0}(r,n,i,p),function(e,t,r,i){var n=0;M=n=M+-64|0,!function(e,t,r,i){var n=0,o=0,a=0,c=0,h=0,p=0,f=0,A=0;M=o=M-96|0;t:{r:{if(!(4!=l[e+4767|0]?1!=u[e+4632>>2]:0)){if((0|(a=(n=(E(n=d[e+4532>>1],-5)+(E(n,59246)>>16)|0)+3146|0)+(2==u[e+4580>>2]?n>>1:0)|0))<=0)break r;eG(o+32|0,r,u[e+4640>>2]);o:if(1==u[e+4632>>2]&&!((0|(n=s[e+4767|0]))>3)){if(tc(o- -64|0,i,r,n,u[e+4640>>2]),eG(o,o- -64|0,u[e+4640>>2]),f=1,(0|(c=u[e+4640>>2]))<1)break o;for(A=E(n=s[e+4767|0],n)<<27>>16,n=0;;){if(d[(p=(h=n<<1)+(o+32|0)|0)>>1]=(d[p>>1]>>>1)+(E(d[o+h>>1],A)>>>16),(0|c)==(0|(n=n+1|0)))break}}!function(e,t,r,i,n,o,a){var c=0,h=0,p=0,f=0,A=0,m=0,v=0,g=0,S=0,T=0,y=0,R=0,I=0,C=0,w=0,O=0,N=0,P=0,D=0,L=0,U=0,B=0;if(f=c=M-128|0,M=c,a>>>0<3){if(el(t,u[r+36>>2],d[r+2>>1]),M=c=c-((_[r>>1]<<2)+15&524272)|0,function(e,t,r,i,n,o){var a=0,s=0,c=0,h=0,p=0,f=0,A=0,m=0;if(!(1&o)){if((0|n)>=1)for(A=(0|o)<2;;){if(p=o,a=0,s=0,!A)for(;;){if(h=a=(c=E(_[(h=(c=p-1|0)<<1)+t>>1]-(l[r+c|0]<<7)<<16>>16,d[i+h>>1]))-(a>>1)|0,a>>=31,m=(a^a+h)+s|0,c=s=(h=E(_[(s=(a=p-2|0)<<1)+t>>1]-(l[r+a|0]<<7)<<16>>16,d[i+s>>1]))-(c>>1)|0,s>>=31,s=(s^s+c)+m|0,c=(0|p)>3,p=a,a=h,!c)break}if(u[(f<<2)+e>>2]=s,r=r+o|0,i=(o<<1)+i|0,(0|(f=f+1|0))==(0|n))break}return}tO(15720,15761,49),k()}(c,t,u[r+8>>2],u[r+12>>2],d[r>>1],d[r+2>>1]),M=h=R=c-(p=(o<<2)+15&-16)|0,eg(c,h,d[r>>1],o),M=c=S=h-p|0,M=I=c-(o<<4)|0,(0|o)>=1)for(N=a>>>1|0,P=n<<14>>16;;){if(y=u[(O=T<<2)+R>>2],(0|(C=d[r+2>>1]))>=1)for(D=(c=E(y,C))+u[r+8>>2]|0,L=u[r+12>>2]+(c<<1)|0,a=0;;){h=d[L+(c=a<<1)>>1],d[(f+80|0)+c>>1]=E(_[t+c>>1]-(l[a+D|0]<<7)<<16>>16,h)>>>14,A=b((A=(p=d[i+c>>1])>>31)^p+A),p<<=A-1,U=p,g=b(h=E(h,h)),w=m=(p=(E(h=0x1fffffff/((v=h<<g-1)>>16)<<16>>16,65535&p)>>16)+E(p>>16,h)|0)>>31,B=m=v>>31,w=tM(p,m=w,v,B),h=(E((v=U-(((0x1fffffff&(m=x))<<3|w>>>29)&-8)|0)>>16,h)+p|0)+(E(65535&v,h)>>16)|0,A=(p=A-g|0)+8|0,c=(f+48|0)+c|0,p=p+29|0;a:{if((0|p)<=20){A=0x7fffffff>>>(p=0-A|0)|0,g=-0x80000000>>p,h=((0|h)>(0|A)?A:(0|h)<(0|g)?g:h)<<p;break a}h=(0|p)<53?h>>A:0}if(d[c>>1]=h,(0|C)==(0|(a=a+1|0)))break}if(tt(f,f+32|0,r,y),u[(a=S+O|0)>>2]=function(e,t,r,i,n,o,a,c,h,p){var f=0,A=0,m=0,v=0,g=0,S=0,b=0,T=0,y=0,R=0,I=0,C=0,k=0,w=0,O=0,N=0,P=0;for(M=f=M-320|0,b=a<<16>>16,a=-10;;){A=a<<10;r:{if((0|a)>=1){v=922|A,A=A-102|0;break r}if(!a){v=922|A;break r}m=A+1024|0,v=(0|a)==-1?m:102|m,A|=102}if(u[(m=(a<<2)+40|0)+f>>2]=E(v<<16>>16,b)>>16,u[(f+80|0)+m>>2]=E(A<<16>>16,b)>>16,(0|(a=a+1|0))==10)break}if(d[f+224>>1]=0,u[f+192>>2]=0,(0|p)<1)I=0;else{for(I=h<<16>>16,h=p,b=1;;){O=h,h=h-1|0;c:{d:{u:{w=(0|b)<1;l:if(!w){for(k=d[(a=h<<1)+n>>1]+o|0,m=_[t+a>>1],C=l[i+h|0],S=d[r+a>>1],a=0;;){v=E(d[(T=(f+224|0)+(a<<1)|0)>>1],C)>>8,A=(0|(A=(0|(A=E(m-v<<16>>16,c)>>16))>-10?A:-10))<9?A:9,s[((f+240|0)+(a<<4)|0)+h|0]=A,y=u[(g=(A<<2)+40|0)+(f+80|0)>>2]+v|0,d[T>>1]=y,T=a+b|0,v=u[f+g>>2]+v|0,d[(f+224|0)+(T<<1)>>1]=v;q:{if((0|A)>=3){if((0|A)==3){R=280,g=l[k+7|0];break q}R=(A=E(A,43))+151|0,g=A+108|0;break q}if((0|A)<=-4){if((0|A)==-4){R=l[k+1|0],g=280;break q}R=(A=E(A,-43))+65|0,g=A+108|0;break q}R=l[(A=A+k|0)+5|0],g=l[A+4|0]}if(N=A=(f+192|0)+(a<<2)|0,P=(A=u[A>>2])+E(I,g)|0,g=m-y<<16>>16,u[N>>2]=P+E(E(g,g),S),g=E(R,I)+A|0,A=m-v<<16>>16,u[(f+192|0)+(T<<2)>>2]=g+E(E(A,A),S),(0|b)==(0|(a=a+1|0)))break}if((0|b)>=3){if(A=0,a=u[f+208>>2],(0|a)<(0|(m=u[f+192>>2])))break u;S=a,a=m;break d}if(a=0,w)break l;for(;;){if(s[((f+240|0)+(a+b<<4)|0)+h|0]=l[((f+240|0)+(a<<4)|0)+h|0]+1,(0|b)==(0|(a=a+1|0)))break}}if(b<<=1,(0|(a=b))>3)break c;for(;;){if(s[((f+240|0)+(a<<4)|0)+h|0]=l[((f+240|0)+(a-b<<4)|0)+h|0],(0|(a=a+1|0))==4)break}break c}u[f+208>>2]=m,u[f+192>>2]=a,A=_[f+224>>1],d[f+224>>1]=_[f+232>>1],d[f+232>>1]=A,A=4,S=m}u[f+176>>2]=a,u[f+160>>2]=S,u[f+304>>2]=A,m=1,A=u[f+212>>2],v=u[f+196>>2];_:{if((0|A)>=(0|v)){T=A,A=v;break _}u[f+212>>2]=v,u[f+196>>2]=A,m=_[f+226>>1],d[f+226>>1]=_[f+234>>1],d[f+234>>1]=m,m=5,T=v}u[f+180>>2]=A,u[f+164>>2]=T,u[f+308>>2]=m,m=2,v=u[f+216>>2],g=u[f+200>>2];eo:{if((0|v)>=(0|g)){y=v,v=g;break eo}u[f+216>>2]=g,u[f+200>>2]=v,m=_[f+228>>1],d[f+228>>1]=_[f+236>>1],d[f+236>>1]=m,m=6,y=g}u[f+184>>2]=v,u[f+168>>2]=y,u[f+312>>2]=m,R=3,m=u[f+220>>2],C=u[f+204>>2];eO:{if((0|m)>=(0|C)){g=m,m=C;break eO}u[f+220>>2]=C,u[f+204>>2]=m,g=_[f+230>>1],d[f+230>>1]=_[f+238>>1],d[f+238>>1]=g,R=7,g=C}for(u[f+188>>2]=m,u[f+172>>2]=g,u[f+316>>2]=R;;){if(C=(y=(0|g)<(0|(S=(T=(0|y)<(0|(S=(R=(0|S)>(0|T))?T:S)))?y:S)))?g:S,g=a=(A=(0|v)>(0|(a=(S=(0|A)>(0|(a=(0|a)>0?a:0)))?A:a)))?v:a,(0|C)<(((a=(0|a)<(0|m))?m:g)|0)){A=(a=a?3:A?2:S)<<2,v=(m=y?3:T?2:R)<<2,u[(A|f+304)>>2]=4^u[(v|f+304)>>2],S=4|m,u[(f+192|A)>>2]=u[(f+192|0)+(S<<2)>>2],u[(f+176|A)>>2]=0,d[(f+224|a<<1)>>1]=_[(f+224|S<<1)>>1],u[(f+160|v)>>2]=0x7fffffff,g=u[(A=(f+240|0)+(m<<4)|0)>>2],m=u[A+4>>2],u[(a=(f+240|0)+(a<<4)|0)>>2]=g,u[a+4>>2]=m,g=u[A+12>>2],m=u[A+8>>2],u[a+8>>2]=m,u[a+12>>2]=g,m=u[f+188>>2],g=u[f+172>>2],v=u[f+184>>2],y=u[f+168>>2],A=u[f+180>>2],T=u[f+164>>2],a=u[f+176>>2],S=u[f+160>>2];continue}break}s[0|(a=(f+240|0)+h|0)]=l[0|a]+(u[f+304>>2]>>>2|0),s[0|(A=a+16|0)]=l[a+16|0]+(u[f+308>>2]>>>2|0),s[0|(A=a+48|0)]=l[a+48|0]+(u[f+316>>2]>>>2|0),g=a,s[0|(a=a+32|0)]=l[g+32|0]+(u[f+312>>2]>>>2|0)}if(!((0|O)>1))break}a=u[f+220>>2],A=u[f+216>>2],b=u[f+212>>2],m=u[f+208>>2],v=u[f+204>>2],h=u[f+200>>2],S=u[f+196>>2],I=u[f+192>>2]}return t=(m=(0|(b=(v=(0|b)<(0|(m=(h=(0|(v=(S=(0|v)<(0|(h=(I=(0|(S=(T=(0|I)>(0|S))?S:I))>(0|h))?h:S)))?v:h))>(0|m))?m:v)))?b:m))>(0|A))?6:v?5:h?4:S?3:I?2:T,A=(m=(0|(b=m?A:b))>(0|a))?7:t,(0|p)>0&&ev(e,(f+240|0)+((3&A)<<4)|0,p),s[0|e]=l[0|e]+(A>>>2|0),M=f+320|0,m?a:b}((T<<4)+I|0,f+80|0,f+48|0,f+32|0,f,u[r+32>>2],d[r+4>>1],d[r+6>>1],n,d[r+2>>1]),c=u[r+16>>2]+E(d[r>>1],N)|0,m=a,h=y?l[(c=c+y|0)-1|0]:256,u[m>>2]=E(0x4000000-(tE(h-l[0|c]|0)<<16)>>16,P)+u[a>>2],(0|(T=T+1|0))==(0|o))break}return eg(S,f+124|0,o,1),c=u[f+124>>2],s[0|e]=u[(c<<2)+R>>2],ev(e+1|0,(c<<4)+I|0,d[r+2>>1]),function(e,t,r){var i=0,n=0,o=0,a=0,c=0,h=0,p=0,f=0;if(M=a=M-80|0,tt(a+32|0,a- -64|0,r,s[0|t]),!(p=(0|(c=(n=_[r+2>>1])<<16>>16))<1))for(h=d[r+4>>1];;){if(i=(o=s[t+n|0])<<10,o=(0|o)>0?i-102|0:(102|i)&o>>31,i=n-1|0,f=(E(o>>16,h)+(E(l[i+(a- -64|0)|0],f<<16>>16)>>8)|0)+(E(65534&o,h)>>16)|0,d[(i<<1)+a>>1]=f,o=(0|n)>1,n=i,!o)break}if(!p)for(o=(n=E(s[0|t],c))+u[r+8>>2]|0,h=u[r+12>>2]+(n<<1)|0,n=0;;){if(t=(i=n<<1)+e|0,i=(0|(i=((d[i+a>>1]<<14)/d[i+h>>1]|0)+(l[n+o|0]<<7)|0))>0?i:0,d[t>>1]=(0|i)<32767?i:32767,!((0|(n=n+1|0))<(0|(c=d[r+2>>1]))))break}el(e,u[r+36>>2],c),M=a+80|0}(t,e,r),M=f+128|0,c=u[S>>2]}tO(15776,15829,63),k()}(e+4744|0,r,u[e+4692>>2],o+32|0,a,u[e+4660>>2],s[e+4765|0]),Z(n=t+32|0,r,u[e+4640>>2],u[e+5092>>2]);s:{if(f){tc(o- -64|0,i,r,s[e+4767|0],u[e+4640>>2]),Z(t,o- -64|0,u[e+4640>>2],u[e+5092>>2]);break s}if((0|(e=u[e+4640>>2]))>=17)break t;ev(t,n,e<<1)}M=o+96|0;return}tO(15848,15951,51),k()}tO(15972,15951,63),k()}tO(16006,15951,104),k()}(e,n,r,i),r=u[e+4640>>2];t:if(!((0|r)<1)){for(e=0;;){if(m[(e<<2)+t>>2]=g(d[(e<<1)+n>>1])*g(244140625e-12),(0|r)==(0|(e=e+1|0)))break}if((0|r)<1)break t;for(e=0;;){if(m[((e<<2)+t|0)- -64>>2]=g(d[((e<<1)+n|0)+32>>1])*g(244140625e-12),(0|r)==(0|(e=e+1|0)))break}}M=n- -64|0}(e,a=t+16|0,o+1536|0,e+4500|0),function(e,t,r,i,n,o,a){var s=g(0),c=0,d=0,u=0,l=0;M=c=M-768|0,er(c,r,t,u=(d=n+a|0)<<1,a),s=m[i>>2],l=(a<<2)+c|0,m[e>>2]=tn(l,n)*+g(s*s),s=m[i+4>>2],d=(d<<2)+l|0,m[e+4>>2]=tn(d,n)*+g(s*s),(0|o)==4&&(er(c,r- -64|0,(u<<2)+t|0,u,a),s=m[i+8>>2],m[e+8>>2]=tn(l,n)*+g(s*s),s=m[i+12>>2],m[e+12>>2]=tn(d,n)*+g(s*s)),M=c+768|0}(t+712|0,o,a,t,u[e+4588>>2],u[e+4580>>2],u[e+4640>>2]),r=u[(i=o+1560|0)>>2],t=u[i+4>>2],i=r,u[(r=e+4524|0)>>2]=i,u[r+4>>2]=t,t=u[(i=o+1552|0)>>2],r=u[i+4>>2],i=t,u[(t=e+4516|0)>>2]=i,u[t+4>>2]=r,t=u[o+1548>>2],i=r=u[o+1544>>2],u[(r=e+4508|0)>>2]=i,u[r+4>>2]=t,r=u[o+1540>>2],t=u[o+1536>>2],u[e+4500>>2]=t,u[e+4504>>2]=r,M=o+2064|0}(e,p+8480|0,f,I,i),function(e,t,r){var i=0,n=0,o=0,a=g(0),c=0,h=0,p=g(0),f=0;M=c=M-16|0;t:{if(2!=l[e+4765|0]){o=u[e+4580>>2];break t}if(h=eI(+g(g(m[t+708>>2]+g(-12))*g(-.25))),(0|(o=u[e+4580>>2]))<1)break t;for(a=g(g(g(1/(h+1))*g(-.5))+g(1));;){if(m[(n=(i<<2)+t|0)>>2]=a*m[n>>2],(0|o)==(0|(i=i+1|0)))break}}i=0,n=u[e+4588>>2],h=eJ(+g(g(g(g(u[e+4716>>2])*g(-.0078125))+g(21))*g(.33000001311302185)));n:if(!((0|o)<=0)){for(p=g(h/+(0|n));;){if(a=g(C(g(g((a=m[(n=(i<<2)+t|0)>>2])*a)+g(m[n+712>>2]*p)))),m[n>>2]=a<g(32767)?a:g(32767),(0|o)==(0|(i=i+1|0)))break}if(i=0,(0|o)<=0)break n;for(;;){f=c+(n=i<<2)|0,a=g(m[t+n>>2]*g(65536));s:{if(g(S(a))<g(0x80000000)){n=~~a;break s}n=-0x80000000}if(u[f>>2]=n,(0|o)==(0|(i=i+1|0)))break}}if(ev(t+728|0,c,o<<2),s[t+744|0]=l[e+7168|0],eD(e+4736|0,c,e+7168|0,(0|r)==2,u[e+4580>>2]),(0|(o=u[e+4580>>2]))>=1)for(i=0;;){if(m[(n=i<<2)+t>>2]=g(u[n+c>>2])*g(152587890625e-16),(0|o)==(0|(i=i+1|0)))break}n=l[e+4765|0];l:{if((0|n)!=2){i=s[e+4766|0];break l}i=g(m[t+708>>2]+g(g(u[e+4712>>2])*g(30517578125e-15)))>g(1)^1,s[e+4766|0]=i}m[t+692>>2]=g(g(g(d[((n<<24>>24<<1&-4)+(i<<1)|0)+5840>>1])*g(9765625e-10))*g(.800000011920929))+g(g(g(g(g(g(u[e+4628>>2])*g(-.05000000074505806))+g(1.2000000476837158))+g(g(g(u[e+4532>>2])*g(.20000000298023224))*g(-.00390625)))+g(m[t+696>>2]*g(-.10000000149011612)))-g(m[t+700>>2]*g(.20000000298023224))),M=c+16|0}(e,p+8480|0,i),!(!u[e+6092>>2]|u[e+4532>>2]<78)){if(f=u[e+5748>>2],u[((f<<2)+e|0)+4724>>2]=1,ev(p+9232|0,e+148|0,4352),T=(E(f,36)+e|0)+6100|0,c=_[(c=e+4768|0)>>1]|_[c+2>>1]<<16,d[T+32>>1]=c,d[T+34>>1]=c>>>16,a=_[(h=e+4760|0)>>1]|_[h+2>>1]<<16,c=_[h+4>>1]|_[h+6>>1]<<16,h=a,d[(a=T)+24>>1]=h,d[a+26>>1]=h>>>16,d[a+28>>1]=c,d[a+30>>1]=c>>>16,c=_[(h=e+4752|0)>>1]|_[h+2>>1]<<16,a=_[h+4>>1]|_[h+6>>1]<<16,h=c,d[(c=T)+16>>1]=h,d[c+18>>1]=h>>>16,d[c+20>>1]=a,d[c+22>>1]=a>>>16,a=_[(h=e+4744|0)>>1]|_[h+2>>1]<<16,c=_[h+4>>1]|_[h+6>>1]<<16,h=a,d[(a=T)+8>>1]=h,d[a+10>>1]=h>>>16,d[a+12>>1]=c,d[a+14>>1]=c>>>16,a=_[e+4740>>1]|_[e+4742>>1]<<16,h=c=_[e+4736>>1]|_[e+4738>>1]<<16,d[(c=T)>>1]=h,d[c+2>>1]=h>>>16,d[c+4>>1]=a,d[c+6>>1]=a>>>16,ev(p+48|0,p+8480|0,(f=u[e+4580>>2])<<2),h=p+1344|0,A=e+4540|0,R=(0|i)==2,a=u[e+5748>>2],!(u[((a<<2)+e|0)+4720>>2]?a:0)&&(s[e+4540|0]=l[e+7168|0],f=l[0|T]+l[e+6096|0]|0,s[0|T]=f<<24>>24<63?f:63,f=u[e+4580>>2]),function(e,t,r,i,n){var o=0,a=0,c=0,d=0,l=0;if((0|n)>=1)for(;;){o=s[t+c|0],l=r;i:{if(!(i|c)){o=(0|o)>(0|(a=s[0|r]-16|0))?o:a;break i}if((0|(o=o-4|0))>(0|(d=(a=s[0|r])+8|0))){o=((o<<1)-d|0)+a|0;break i}o=o+a|0}if(o=(o=o<<24>>24>0?o:0)<<24>>24<63?o:63,s[0|l]=o,o&=255,o=(E(o,7281)>>>16|0)+E(o,29)|0,u[(c<<2)+e>>2]=th((o>>>0<1877?o:1877)+2090|0),(0|(c=c+1|0))==(0|n))break}}(h,c,A,R,f),(0|(c=u[e+4580>>2]))>=1)for(f=0;;){if(m[(a=f<<2)+(p+8480|0)>>2]=g(u[(p+1344|0)+a>>2])*g(152587890625e-16),(0|c)==(0|(f=f+1|0)))break}ep(e,p+8480|0,T,p+9232|0,(E(u[e+5748>>2],320)+e|0)+6208|0,I),ev(p+8480|0,p+48|0,u[e+4580>>2]<<2)}for(w=tw(D,u[e+4580>>2]),a=u[(h=r)+40>>2],c=u[h+44>>2],A=a,u[(a=H=p+5784|0)>>2]=A,u[a+4>>2]=c,a=u[h+36>>2],A=c=u[h+32>>2],u[(c=Y=p+5776|0)>>2]=A,u[c+4>>2]=a,c=u[h+28>>2],A=a=u[h+24>>2],u[(a=Q=p+5768|0)>>2]=A,u[a+4>>2]=c,a=u[h+20>>2],A=c=u[h+16>>2],u[(c=z=p+5760|0)>>2]=A,u[c+4>>2]=a,c=u[h+12>>2],A=a=u[h+8>>2],u[(a=X=p+5752|0)>>2]=A,u[a+4>>2]=c,a=u[h+4>>2],c=u[h>>2],u[p+5744>>2]=c,u[p+5748>>2]=a,ev(p+9232|0,L=e+148|0,4352),es=e+4736|0,J=(0|i)==2,ed=n-5|0,j=e+7168|0,V=e+4772|0,ee=u[e+5768>>2],et=_[e+5772>>1],eu=l[e+4770|0],y=256,G=-1,R=-1;;){f=(0|w)==(0|G);u:{if(f){A=F;break u}if((0|R)==(0|w)){A=U;break u}if(O&&(c=u[p+5748>>2],h=a=u[p+5744>>2],u[(a=r)>>2]=h,u[a+4>>2]=c,c=u[(h=H)>>2],a=u[h+4>>2],h=c,u[(c=r)+40>>2]=h,u[c+44>>2]=a,a=u[(h=Y)>>2],c=u[h+4>>2],h=a,u[(a=r)+32>>2]=h,u[a+36>>2]=c,c=u[(h=Q)>>2],a=u[h+4>>2],h=c,u[(c=r)+24>>2]=h,u[c+28>>2]=a,a=u[(h=z)>>2],c=u[h+4>>2],h=a,u[(a=r)+16>>2]=h,u[a+20>>2]=c,c=u[(h=X)>>2],a=u[h+4>>2],h=c,u[(c=r)+8>>2]=h,u[c+12>>2]=a,ev(L,p+9232|0,4352),d[e+5772>>1]=et,s[e+4770|0]=eu,u[e+5768>>2]=ee),ep(e,p+8480|0,D,L,V,I),!((0|O)!=6|P)&&(a=u[(h=r)+16>>2],c=u[h+20>>2],A=a,u[(a=p+5736|0)>>2]=A,u[a+4>>2]=c,a=u[h+12>>2],A=c=u[h+8>>2],u[(c=p+5728|0)>>2]=A,u[c+4>>2]=a,c=u[h+4>>2],a=u[h>>2],u[p+5720>>2]=a,u[p+5724>>2]=c,N=u[h+24>>2],a=u[h+40>>2],A=c=u[h+36>>2],u[(c=p+5704|0)>>2]=A,u[c+4>>2]=a,u[p+5712>>2]=u[h+44>>2],c=u[h+32>>2],a=u[h+28>>2],u[p+5696>>2]=a,u[p+5700>>2]=c),ec(e,r,u[e+5748>>2],0,i),K(r,s[e+4765|0],s[e+4766|0],V,u[e+4584>>2]),!(P|(0|(A=(u[r+20>>2]+b(u[r+28>>2])|0)-32|0))<=(0|n)|(0|O)!=6)&&(a=u[p+5724>>2],h=c=u[p+5720>>2],u[(c=r)>>2]=h,u[c+4>>2]=a,a=u[(h=p+5736|0)>>2],c=u[h+4>>2],h=a,u[(a=r)+16>>2]=h,u[a+20>>2]=c,c=u[(h=p+5728|0)>>2],a=u[h+4>>2],h=c,u[(c=r)+8>>2]=h,u[c+12>>2]=a,u[c+24>>2]=N,u[c+44>>2]=u[p+5712>>2],a=u[(h=p+5704|0)>>2],c=u[h+4>>2],h=a,u[(a=r)+36>>2]=h,u[a+40>>2]=c,a=u[p+5700>>2],h=c=u[p+5696>>2],u[(c=r)+28>>2]=h,u[c+32>>2]=a,c=l[p+9224|0],s[e+7168|0]=c,(0|(a=u[e+4580>>2]))>=1&&ex(es,4,a),!J&&(s[0|D]=c),u[e+5768>>2]=ee,d[e+5772>>1]=et,(0|(a=u[e+4584>>2]))>=1&&ex(V,0,a),ec(e,r,u[e+5748>>2],0,i),K(r,s[e+4765|0],s[e+4766|0],V,u[e+4584>>2]),A=(u[r+20>>2]+b(u[r+28>>2])|0)-32|0),o|O)break u;if((0|n)>=(0|A))break i}et:{er:{_:{en:{eo:{A:{if((0|O)==6){if(!P|!((0|n)<(0|A)|f))break i;if(c=u[p+5724>>2],i=a=u[p+5720>>2],u[(a=r)>>2]=i,u[a+4>>2]=c,c=u[(h=p+5736|0)>>2],a=u[h+4>>2],i=c,u[(c=r)+16>>2]=i,u[c+20>>2]=a,a=u[(h=p+5728|0)>>2],c=u[h+4>>2],i=a,u[(a=r)+8>>2]=i,u[a+12>>2]=c,u[a+24>>2]=N,u[a+44>>2]=u[p+5712>>2],c=u[(h=p+5704|0)>>2],a=u[h+4>>2],i=c,u[(c=r)+36>>2]=i,u[c+40>>2]=a,c=u[p+5700>>2],i=a=u[p+5696>>2],u[(a=r)+28>>2]=i,u[a+32>>2]=c,N>>>0>=1276)break A;ev(u[r>>2],p+48|0,N),ev(L,p+1344|0,4352),s[0|j]=eh;break i}eb:{eN:{ea:{eL:{if((0|n)<(0|A)){if(O>>>0<2|P)break eL;ei=g(m[p+9172>>2]*g(1.5)),m[p+9172>>2]=ei>g(1.5)?ei:g(1.5),en=0,s[e+4766|0]=0,w=-1;break ea}if((0|A)>=(0|ed))break i;if(!f){if(c=u[(h=r)+16>>2],a=u[h+20>>2],T=c,u[(c=p+5736|0)>>2]=T,u[c+4>>2]=a,c=u[h+12>>2],T=a=u[h+8>>2],u[(a=p+5728|0)>>2]=T,u[a+4>>2]=c,a=u[h+4>>2],c=u[h>>2],u[p+5720>>2]=c,u[p+5724>>2]=a,N=u[h+24>>2],c=u[h+40>>2],T=a=u[h+36>>2],u[(a=p+5704|0)>>2]=T,u[a+4>>2]=c,u[p+5712>>2]=u[h+44>>2],a=u[h+32>>2],c=u[h+28>>2],u[p+5696>>2]=c,u[p+5700>>2]=a,N>>>0>=1276)break eo;ev(p+48|0,u[r>>2],N),ev(p+1344|0,L,4352),eh=l[0|j]}if(B=y<<16>>16,P=1,!en)break en;F=A,A=U,G=w;break eb}if(eo=y<<16>>16,en=1,P)break eN;U=A}if((0|(ea=u[e+4580>>2]))<1)break _;for(A=0,T=R=u[e+4588>>2];;){if(a=0,f=E(A,R),(0|f)<(0|E(h=A+1|0,R)))for(;;){if(ef=c=s[(e+f|0)+4772|0],c>>=31,a=(c^c+ef)+a|0,(0|T)==(0|(f=f+1|0)))break}es:{g:if(!O||!(u[(f=A<<2)+p>>2]<=(0|a)|u[(p+32|0)+f>>2])){d[(p+24|0)+(A<<1)>>1]=y,u[(A<<2)+p>>2]=a;break es}u[(p+32|0)+f>>2]=1}if(T=T+R|0,(0|ea)==(0|(A=h)))break}break _}if(w=R=w,!P)break er}if(c=(a=((0|E(f=eo-B|0,n-F|0))/(A-F|0)|0)+B|0)<<16>>16,f>>=2,(0|c)>(0|(y=B+f|0)))break et;y=(0|(f=eo-f|0))>(0|c)?f:a;break et}tO(16895,16942,251),k()}tO(16972,16942,281),k()}y=(E(65535&(f=th(((A-n<<7)/u[e+4584>>2]|0)+2048|0)),B)>>>16|0)+E(f>>16,B)|0,F=A,A=U,G=w;break et}A=U}R=w,y=y<<16>>16<16384?y<<1:32767}if(f=0,(0|(T=u[e+4580>>2]))>=1)for(;;){if(c=y,c=u[(a=f<<2)+(p+32|0)>>2]?_[(p+24|0)+(f<<1)>>1]:c,h=(p+1328|0)+a|0,a=(0|(a=(E(c=c<<16>>16,65535&(a=u[(p+a|0)+9208>>2]))>>16)+E(a>>16,c)|0))>-8388608?a:-8388608,u[h>>2]=((0|a)<8388607?a:8388607)<<8,(0|T)==(0|(f=f+1|0)))break}if(s[e+7168|0]=l[p+9224|0],eD(D,p+1328|0,j,J,T),w=tw(D,u[e+4580>>2]),f=0,(0|(c=u[e+4580>>2]))>=1)for(;;){if(m[(a=f<<2)+(p+8480|0)>>2]=g(u[(p+1328|0)+a>>2])*g(152587890625e-16),(0|c)==(0|(f=f+1|0)))break}O=O+1|0,U=A}}return eC(W,((u[e+4584>>2]<<2)+e|0)+7180|0,u[e+4592>>2]+E(u[e+4576>>2],5)<<2),f=0,!u[e+4680>>2]&&(f=u[((u[e+4580>>2]<<2)+p|0)+8704>>2],u[e+4664>>2]=0,s[e+4541|0]=l[e+4765|0],u[e+4544>>2]=f,f=(u[r+20>>2]+b(u[r+28>>2])|0)-25>>3),u[t>>2]=f,M=p+13584|0,0}(f,y,V,p,T,N),R=u[t+4>>2]}if(u[(p=E(h,10064)+e|0)+5740>>2]=0,u[p+4668>>2]=0,u[p+5748>>2]=u[p+5748>>2]+1,!((0|R)>(0|(h=h+1|0))))break}P=J<<1,i=i-D|0,O=u[e+5748>>2],u[e+20212>>2]=s[(j+O|0)-1|0];ej:if(!(u[e+5744>>2]!=(0|O)|u[o>>2]<1)){if(N=0,h=0,(0|R)>=1)for(;;){if(p=h<<1,h=0,(0|(T=u[(f=E(N,10064)+e|0)+5744>>2]))>=1)for(;;){if(p=(s[(h+f|0)+4720|0]|p)<<1,(0|T)==(0|(h=h+1|0)))break}if(h=s[f+4723|0]|p,(0|(N=N+1|0))==(0|R))break}if(!a&&function(e,t,r){var i=0,n=0,o=0;if(r>>>0<9){if(i=8-r|0,n=(-1<<r^-1)<<i,u[e+24>>2]){s[0|(r=u[e>>2])]=l[0|r]&(-1^n)|t<<i;return}if((0|(o=u[e+40>>2]))>=0){u[e+40>>2]=(-1^n)&o|t<<i;return}if(A[e+28>>2]<=-0x80000000>>>r>>>0){u[e+32>>2]=u[e+32>>2]&(n<<23^-1)|t<<31-r;return}u[e+44>>2]=-1;return}tO(7059,7019,217),k()}(n,h,E(O+1|0,R)),!(!u[e+6080>>2]|(u[e+16144>>2]?0:1!=u[t+4>>2]))&&(u[o>>2]=0),p=u[t+24>>2],h=(0|(h=(u[e+20188>>2]+(u[o>>2]<<3)|0)+(0|-((0|E(p,u[t+28>>2]))/1e3))|0))>0?h:0,u[e+20188>>2]=(0|h)<1e4?h:1e4,h=u[e+20204>>2],u[e+4532>>2]<((E(h<<16>>16,3188)>>16)+13|0)){u[e+20204>>2]=0,u[e+20208>>2]=1;break ej}u[e+20208>>2]=0,u[e+20204>>2]=h+p}if(r=r+P|0,U=U+1|0,!i)break}y=u[e+20208>>2]}f=u[t+4>>2],u[e+20200>>2]=f,h=y,u[t+76>>2]=h,ea=(0|(h=u[e+4576>>2]))==16?!u[e+28>>2]:ea,u[t+80>>2]=ea,u[t+72>>2]=E(h<<16>>16,1e3),h=0,h=u[t+60>>2]?h:d[e+20156>>1],u[t+84>>2]=h;t6:if(a){if(u[t+36>>2]=et,u[t+24>>2]=F,(0|f)<1)break t6;for(h=0;;){if(u[(p=E(h,10064)+e|0)+4680>>2]=0,u[p+4668>>2]=0,(0|f)==(0|(h=h+1|0)))break}}h=s[e+4765|0],u[t+92>>2]=h,u[t+96>>2]=d[((h<<1&-4)+(s[e+4766|0]<<1)|0)+5840>>1]}return M=w+32|0,I}tO(17545,17507,262),k()}tO(17487,17507,241),k()}tO(17487,17507,235),k()}tO(17487,17507,206),k()}tO(17487,17507,170),k()}function j(e,t,r,i,n,o,a){var c=0,h=0,p=0,f=0,_=0,A=0,m=0,g=0,S=0,T=0,y=0,R=0,I=0,C=0,k=0,w=0;M=c=M-80|0,u[c+76>>2]=t,w=c+55|0,C=c+56|0,t=0;t:{r:for(;;){i:if(!((0|y)<0)){if((0x7fffffff-y|0)<(0|t)){u[tY()>>2]=61,y=-1;break i}y=t+y|0}o:{s:{c:{if(h=l[0|(t=m=u[c+76>>2])])for(;;){l:{h&=255;h:{if(!h){h=t;break h}if((0|h)!=37)break l;for(h=t;;){if(37!=l[t+1|0])break h;if(p=t+2|0,u[c+76>>2]=p,h=h+1|0,A=l[t+2|0],t=p,(0|A)!=37)break}}if(t=h-m|0,e&&tV(e,m,t),t)continue r;t=tH(s[u[c+76>>2]+1|0]),f=c,h=u[c+76>>2];$:{if(!(!t|36!=l[h+2|0])){k=1,t=h+3|0,I=s[h+1|0]-48|0;break $}t=h+1|0,I=-1}u[f+76>>2]=t,R=0,p=(A=s[0|t])-32|0;f:{if(p>>>0>31){h=t;break f}if(h=t,!(75913&(p=1<<p)))break f;for(;;){if(h=t+1|0,u[c+76>>2]=h,R|=p,(p=(A=s[t+1|0])-32|0)>>>0>=32)break f;if(t=h,!(75913&(p=1<<p)))break}}_:{if((0|A)==42){f=c;eo:{A:if(tH(s[h+1|0])&&36==l[(h=u[c+76>>2])+2|0]){u[((s[h+1|0]<<2)+n|0)-192>>2]=10,S=u[((s[h+1|0]<<3)+i|0)-384>>2],k=1,t=h+3|0;break eo}if(k)break c;k=0,S=0,e&&(t=u[r>>2],u[r>>2]=t+4,S=u[t>>2]),t=u[c+76>>2]+1|0}if(u[f+76>>2]=t,(0|S)>-1)break _;S=0-S|0,R|=8192;break _}if((0|(S=ty(c+76|0)))<0)break c;t=u[c+76>>2]}_=-1;eb:if(46==l[0|t]){if(42==l[t+1|0]){ea:if(tH(s[t+2|0])&&36==l[(t=u[c+76>>2])+3|0]){u[((s[t+2|0]<<2)+n|0)-192>>2]=10,_=u[((s[t+2|0]<<3)+i|0)-384>>2],t=t+4|0,u[c+76>>2]=t;break eb}if(k)break c;e?(t=u[r>>2],u[r>>2]=t+4,_=u[t>>2]):_=0,t=u[c+76>>2]+2|0,u[c+76>>2]=t;break eb}u[c+76>>2]=t+1,_=ty(c+76|0),t=u[c+76>>2]}for(h=0;;){if(p=h,T=-1,s[0|t]-65>>>0>57)break t;if(A=t+1|0,u[c+76>>2]=A,h=s[0|t],t=A,!((h=l[(E(p,58)+h|0)+1071|0])-1>>>0<8))break}v:{E:{if((0|h)!=19){if(!h)break t;if((0|I)>=0){u[(I<<2)+n>>2]=h,g=u[(f=(I<<3)+i|0)>>2],f=u[f+4>>2],u[c+64>>2]=g,u[c+68>>2]=f;break E}if(!e)break o;eL(c- -64|0,h,r,a),A=u[c+76>>2];break v}if((0|I)>-1)break t}if(t=0,!e)continue r}g=-65537&R,h=8192&R?g:R,T=0,I=1116,R=C;g:{eT:{ey:{eR:{eI:{ec:{ei:{eC:{ed:{S:{ek:{eu:{el:{ew:{em:{switch(t=s[A-1|0],(t=p&&(15&t)==3?-33&t:t)-88|0){case 11:break g;case 9:case 13:case 14:case 15:break eT;case 27:break ei;case 12:case 17:break S;case 23:break ek;case 0:case 32:break eu;case 24:break el;case 22:break ew;case 29:break em;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 10:case 16:case 18:case 19:case 20:case 21:case 25:case 26:case 28:case 30:case 31:break s;default:break}switch(t-65|0){case 0:case 4:case 5:case 6:break eT;case 2:break eI;case 1:case 3:break s;default:break}if((0|t)==83)break ec;break s}p=f=u[c+64>>2],t=g=u[c+68>>2],I=1116;break ed}switch(t=0,255&p){case 0:case 1:case 6:u[u[c+64>>2]>>2]=y;continue r;case 2:g=(f=y)>>31,f=u[c+64>>2],u[f>>2]=y,u[f+4>>2]=g;continue r;case 3:d[u[c+64>>2]>>1]=y;continue r;case 4:s[u[c+64>>2]]=y;continue r;case 7:break;default:continue r}g=(f=y)>>31,f=u[c+64>>2],u[f>>2]=y,u[f+4>>2]=g;continue r}_=_>>>0>8?_:8,h|=8,t=120}if(g=u[c+64>>2],m=function(e,t,r,i){if(e|t)for(;;){if(s[0|(r=r-1|0)]=l[(15&e)+1600|0]|i,!((e=(15&t)<<28|e>>>4)|(t=t>>>4|0)))break}return r}(g,f=u[c+68>>2],C,32&t),!(8&h))break eC;if(f=u[c+64>>2],!(f|(g=u[c+68>>2])))break eC;I=(t>>>4|0)+1116|0,T=2;break eC}if(g=u[c+64>>2],m=function(e,t,r){if(e|t)for(;;){if(s[0|(r=r-1|0)]=7&e|48,!((e=(7&t)<<29|e>>>3)|(t=t>>>3|0)))break}return r}(g,f=u[c+68>>2],C),!(8&h))break eC;_=(0|(t=C-m|0))<(0|_)?_:t+1|0;break eC}if(t=g=u[c+68>>2],p=f=u[c+64>>2],(0|g)<-1?1:(0|g)<=-1){p=0-(f=p)|0,t=f=0-(f=(g=t)+((0|f)!=0)|0)|0,u[c+64>>2]=p,u[c+68>>2]=f,T=1,I=1116;break ed}if(2048&h){T=1,I=1117;break ed}I=(T=1&h)?1118:1116}m=function(e,t,r){var i=0,n=0,o=0,a=0;t:{if(t>>>0<1){o=e,a=i=t;break t}for(;;){if(r=r-1|0,o=function(e,t,r,i){return i=function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,u=0,l=0,h=0,p=0,f=0,_=0;t:{r:{i:{n:{o:{a:{s:{c:{d:{l:{if(o=t){if(!(s=r))break l;if(!(n=i))break d;if((o=b(n)-b(o)|0)>>>0<=31)break c;break r}if((0|(n=i))==1|n>>>0>1)break r;return o=((o=e)>>>0)/((s=r)>>>0)|0,x=0,o}if(s=i,!e)break s;if(!s||(n=s-1|0)&s)break a;return d=o>>>tB(s)|0,x=0,d}if(!(s-1&s))break o;s=0-(o=(b(s)+33|0)-b(o)|0)|0;break i}s=63-o|0,o=o+1|0;break i}return x=0,n=(o>>>0)/(s>>>0)|0}if((o=b(s)-b(o)|0)>>>0<31)break n;break r}if((0|s)==1)break t;return n=t,d=e,u=0,a=31&(c=tB(s)),(63&c)>>>0>=32?d=n>>>a|0:(u=n>>>a|0,d=((1<<a)-1&n)<<32-a|d>>>a),x=u,d}s=63-o|0,o=o+1|0}if(d=t,n=e,u=0,a=31&(c=63&o),(63&c)>>>0>=32?h=d>>>a|0:(u=d>>>a|0,h=((1<<a)-1&d)<<32-a|n>>>a),p=u,u=t,d=e,a=31&(c=63&s),(63&c)>>>0>=32?(n=d<<a,e=0):(n=(1<<a)-1&d>>>32-a|u<<a,e=d<<a),t=n,o)for(n=i-1|0,n=(0|(a=r-1|0))!=-1?n+1|0:n,s=a,d=n;;){if(c=(n=h)<<1,n=p<<1|n>>>31,l=h=c|t>>>31,u=n,p=i&(a=d-(((n=s)>>>0<(c=l)>>>0)+u|0)|0)>>31,h=(n=c)-(c=(l=a>>31)&r)|0,p=u-((n>>>0<c>>>0)+p|0)|0,n=t<<1|e>>>31,e=e<<1|f,t=0|n,_=0,l&=1,f=l,!(o=o-1|0))break}return x=t<<1|e>>>31|_,e<<1|l}e=0,t=0}return x=t,e}(e,t,r,i)}(e,i=t,10,0),a=i=x,n=tM(o,i,10,0),i=t,s[0|r]=e-n|48,n=i>>>0>9,e=o,t=i=a,!n)break}}if(n=o)for(;;){if(r=r-1|0,e=(n>>>0)/10|0,s[0|r]=n-E(e,10)|48,t=n>>>0>9,n=e,!t)break}return r}(p,f=t,C)}if(h=(0|_)>-1?-65537&h:h,p=f=u[c+64>>2],!(!!(f|(t=u[c+68>>2]))|_)){_=0,m=C;break s}_=(0|(t=!(p|t)+(C-m|0)|0))<(0|_)?_:t;break s}R=(t=function(e,t,r){var i=0,n=0;i=(0|r)!=0;t:{r:{i:if(!(!r|!(3&e))){for(n=255&t;;){if(l[0|e]==(0|n))break r;if(e=e+1|0,i=(0|(r=r-1|0))!=0,!r)break i;if(!(3&e))break}}if(!i)break t}o:if(!(l[0|e]==(255&t)|r>>>0<4)){for(n=E(255&t,0x1010101);;){if((-1^(i=u[e>>2]^n))&i-0x1010101&-0x7f7f7f80)break o;if(e=e+4|0,!((r=r-4|0)>>>0>3))break}}if(!r)break t;for(i=255&t;;){if(l[0|e]==(0|i))return e;if(e=e+1|0,!(r=r-1|0))break}}return 0}(m=(t=u[c+64>>2])||1126,0,_))||_+m|0,h=g,_=t?t-m|0:_;break s}if(p=u[c+64>>2],_)break eR;t=0,tf(e,32,S,0,h);break ey}u[c+12>>2]=0,u[c+8>>2]=u[c+64>>2],u[c+64>>2]=c+8,_=-1,p=c+8|0}t=0;I:{for(;;){if(!(A=u[p>>2]))break I;if(!((m=(0|(A=tF(c+4|0,A)))<0)|_-t>>>0<A>>>0)){if(p=p+4|0,_>>>0>(t=t+A|0)>>>0)continue;break I}break}if(T=-1,m)break t}if(tf(e,32,S,t,h),!t){t=0;break ey}for(p=0,A=u[c+64>>2];;){if(!(m=u[A>>2])||(0|(p=(m=tF(c+4|0,m))+p|0))>(0|t))break ey;if(tV(e,c+4|0,m),A=A+4|0,!(t>>>0>p>>>0))break}}tf(e,32,S,t,8192^h),t=(0|t)<(0|S)?S:t;continue r}t=0|tK[0|o](e,v[c+64>>3],S,_,h,t);continue r}f=u[c+64>>2],s[c+55|0]=f,_=1,m=w,h=g;break s}p=t+1|0,u[c+76>>2]=p,h=l[t+1|0],t=p}if(T=y,e)break t;if(!k)break o;for(t=1;;){if(h=u[(t<<2)+n>>2]){if(eL((t<<3)+i|0,h,r,a),T=1,(0|(t=t+1|0))!=10)continue;break t}break}if(T=1,t>>>0>=10)break t;for(;;){if(u[(t<<2)+n>>2])break c;if((0|(t=t+1|0))==10)break}break t}T=-1;break t}tf(e,32,t=(0|(p=(R=(0|_)<(0|(A=R-m|0))?A:_)+T|0))>(0|S)?p:S,p,h),tV(e,I,T),tf(e,48,t,p,65536^h),tf(e,48,R,A,0),tV(e,m,A),tf(e,32,t,p,8192^h);continue}break}T=0}return M=c+80|0,T}function G(e,t){var r=0,i=g(0),n=0,o=g(0),a=g(0),s=0,c=g(0),l=0,h=0,p=g(0),f=0,A=g(0),v=0,S=g(0),b=g(0),T=g(0),y=0,R=g(0),I=g(0),C=0,w=g(0),O=g(0),N=g(0),P=0,D=0,L=0,x=0,U=0,B=0,V=g(0),F=g(0),j=g(0),G=0,W=0,H=0,Y=g(0),K=0,Q=0,z=g(0),X=g(0),J=g(0),q=g(0),Z=g(0),$=g(0),ee=g(0),et=g(0),er=g(0),ei=g(0),en=0;for(M=U=M-32|0,v=u[e+8>>2],u[U>>2]=1,s=e+12|0,l=1;;){if(y=_[(2|(h=(r=n)<<2))+s>>1],n=r+1|0,l=E(d[s+h>>1],l),u[(n<<2)+U>>2]=l,(0|y)==1)break}K=(0|v)>0?v:0,W=d[((n<<2)+e|0)+10>>1];r:{for(;;){f=W,n=0,W=1,B=r,r&&(W=d[((B<<2)+e|0)+10>>1],n=B<<1);o:{switch(d[((n<<1)+e|0)+12>>1]-2|0){case 0:if((0|f)!=4)break r;if(n=0,r=t,(0|(h=u[(B<<2)+U>>2]))<=0)break o;for(;;){if(a=m[r>>2],i=m[r+32>>2],m[r+32>>2]=a-i,m[r>>2]=i+a,a=m[(s=r+36|0)>>2],i=m[r+4>>2],m[r+4>>2]=a+i,m[r+36>>2]=i-a,a=m[r+8>>2],i=m[r+40>>2],c=g(g(i+(o=m[(s=r+44|0)>>2]))*g(.7071067690849304)),m[r+40>>2]=a-c,p=m[(l=r+12|0)>>2],i=g(g(o-i)*g(.7071067690849304)),m[r+44>>2]=p-i,m[r+8>>2]=a+c,m[r+12>>2]=i+p,a=m[r+48>>2],i=m[r+16>>2],o=m[(s=r+52|0)>>2],m[r+48>>2]=i-o,c=m[(l=r+20|0)>>2],m[r+52>>2]=a+c,m[r+20>>2]=c-a,m[r+16>>2]=o+i,a=m[r+24>>2],i=m[(s=r+60|0)>>2],c=g(g(i-(o=m[r+56>>2]))*g(.7071067690849304)),m[r+56>>2]=a-c,p=m[(l=r+28|0)>>2],i=g(g(i+o)*g(-.7071067690849304)),m[r+60>>2]=p-i,m[r+28>>2]=i+p,m[r+24>>2]=a+c,r=r- -64|0,(0|h)==(0|(n=n+1|0)))break}break o;case 2:if(G=u[(B<<2)+U>>2],(0|f)==1){if(n=0,r=t,(0|G)<1)break o;for(;;){if(a=m[r>>2],o=g(a+(i=m[r+16>>2])),c=m[r+8>>2],S=g(c+(p=m[r+24>>2])),m[r+16>>2]=o-S,m[r>>2]=o+S,f=s=r+20|0,o=m[r+4>>2],I=g(o+(S=m[r+20>>2])),w=m[(s=r+12|0)>>2],T=g(w+(b=m[(l=r+28|0)>>2])),m[f>>2]=I-T,o=g(o-S),c=g(c-p),m[r+28>>2]=o+c,a=g(a-i),i=g(w-b),m[r+24>>2]=a-i,m[r+12>>2]=o-c,m[r+8>>2]=a+i,m[r+4>>2]=I+T,r=r+32|0,(0|G)==(0|(n=n+1|0)))break}break o}if((0|G)<1)break o;for(D=E(f,3),L=f<<1,x=E(C=G<<K,3),Q=C<<1,en=u[e+48>>2],H=0;;){if((0|f)>=1)for(r=(E(W,H)<<3)+t|0,P=0,s=n=en,l=n;;){if(a=m[(h=(f<<3)+r|0)+4>>2],i=m[h>>2],o=m[(y=(D<<3)+r|0)+4>>2],c=m[y>>2],p=m[l>>2],S=m[l+4>>2],I=m[n>>2],w=m[n+4>>2],b=m[s>>2],T=m[(v=(L<<3)+r|0)+4>>2],A=m[v>>2],R=m[s+4>>2],V=g(g(b*T)+g(A*R)),N=g(V+(O=m[r+4>>2])),m[r+4>>2]=N,b=g(g(A*b)-g(T*R)),A=g(b+(T=m[r>>2])),m[r>>2]=A,R=g(g(p*a)+g(i*S)),F=g(g(I*o)+g(c*w)),j=g(R+F),m[v+4>>2]=N-j,a=g(g(i*p)-g(a*S)),i=g(g(c*I)-g(o*w)),o=g(a+i),m[v>>2]=A-o,m[r>>2]=o+m[r>>2],m[r+4>>2]=j+m[r+4>>2],o=g(O-V),a=g(a-i),m[h+4>>2]=o-a,i=g(T-b),c=g(R-F),m[h>>2]=i+c,m[y+4>>2]=o+a,m[y>>2]=i-c,r=r+8|0,n=(x<<3)+n|0,s=(Q<<3)+s|0,l=(C<<3)+l|0,(0|(P=P+1|0))==(0|f))break}if((0|(H=H+1|0))==(0|G))break}break o;case 1:if((0|(x=u[(B<<2)+U>>2]))<1)break o;for(P=f<<1,L=u[e+48>>2],a=m[(L+(E(v=x<<K,f)<<3)|0)+4>>2],C=v<<1,D=0;;){for(r=(E(D,W)<<3)+t|0,l=s=L,y=f;;){if(i=m[(n=(f<<3)+r|0)>>2],o=m[l>>2],c=m[n+4>>2],p=m[l+4>>2],S=g(g(i*o)-g(c*p)),I=m[(h=(P<<3)+r|0)>>2],w=m[s>>2],b=m[h+4>>2],T=m[s+4>>2],A=g(g(I*w)-g(b*T)),R=g(S+A),m[n>>2]=m[r>>2]-g(R*g(.5)),i=g(g(o*c)+g(i*p)),o=g(g(w*b)+g(I*T)),c=g(i+o),m[n+4>>2]=m[r+4>>2]-g(c*g(.5)),m[r>>2]=R+m[r>>2],m[r+4>>2]=c+m[r+4>>2],i=g(a*g(i-o)),m[h>>2]=i+m[n>>2],o=g(a*g(S-A)),m[h+4>>2]=m[n+4>>2]-o,m[n>>2]=m[n>>2]-i,m[n+4>>2]=o+m[n+4>>2],r=r+8|0,s=(C<<3)+s|0,l=(v<<3)+l|0,!(y=y-1|0))break}if((0|x)==(0|(D=D+1|0)))break}break o;case 3:break;default:break o}if((0|(x=u[(B<<2)+U>>2]))<1)break o;for(y=u[e+48>>2],a=m[(n=y+((r=E(D=x<<K,f))<<4)|0)+4>>2],i=m[n>>2],o=m[(r=(r<<3)+y|0)+4>>2],c=m[r>>2],Q=f<<2,H=E(f,3),G=f<<1,L=0;;){if((0|f)>=1)for(n=(r=(E(L,W)<<3)+t|0)+(f<<3)|0,s=(G<<3)+r|0,l=(H<<3)+r|0,h=(Q<<3)+r|0,P=0;;){if(p=m[r>>2],S=m[r+4>>2],b=m[(C=((v=E(P,D))<<4)+y|0)>>2],T=m[s+4>>2],A=m[s>>2],R=m[C+4>>2],V=g(g(b*T)+g(A*R)),O=m[(C=E(v,24)+y|0)>>2],N=m[l+4>>2],F=m[l>>2],j=m[C+4>>2],Y=g(g(O*N)+g(F*j)),I=g(V+Y),z=m[(C=(v<<3)+y|0)>>2],X=m[n+4>>2],J=m[n>>2],q=m[C+4>>2],Z=g(g(z*X)+g(J*q)),$=m[(v=(v<<5)+y|0)>>2],ee=m[h+4>>2],et=m[h>>2],er=m[v+4>>2],ei=g(g($*ee)+g(et*er)),w=g(Z+ei),m[r+4>>2]=S+g(I+w),A=g(g(A*b)-g(T*R)),R=g(g(F*O)-g(N*j)),b=g(A+R),O=g(g(J*z)-g(X*q)),N=g(g(et*$)-g(ee*er)),T=g(O+N),m[r>>2]=p+g(b+T),A=g(A-R),R=g(O-N),O=g(g(a*A)+g(o*R)),N=g(S+g(g(i*I)+g(c*w))),m[n+4>>2]=O+N,F=g(p+g(g(i*b)+g(c*T))),V=g(V-Y),j=g(Z-ei),Y=g(g(a*V)+g(o*j)),m[n>>2]=F-Y,m[h+4>>2]=N-O,m[h>>2]=Y+F,A=g(g(a*R)-g(o*A)),S=g(S+g(g(c*I)+g(i*w))),m[s+4>>2]=A+S,I=g(g(o*V)-g(a*j)),p=g(p+g(g(c*b)+g(i*T))),m[s>>2]=I+p,m[l+4>>2]=S-A,m[l>>2]=p-I,h=h+8|0,l=l+8|0,s=s+8|0,n=n+8|0,r=r+8|0,(0|(P=P+1|0))==(0|f))break}if((0|x)==(0|(L=L+1|0)))break}}if(r=B-1|0,!((0|B)>0))break}M=U+32|0;return}tO(42449,42433,76),k()}function W(e,t,r,i,n,o,a,s,c,l,h){var p=0,f=0,_=0,A=0,v=g(0),T=g(0),y=0,I=0,w=0,O=0,N=g(0),P=0,D=0,L=0,M=0;P=u[e+36>>2],A=u[e+28>>2],f=u[e+16>>2],D=u[e>>2],p=1,w=u[o>>2],L=u[e+8>>2],O=u[e+12>>2],_=(w-(c=d[u[L+56>>2]+(O<<1)>>1]+(c<<3)|0)|0)-32|0,y=c>>1,c=(0|n)==2&(0|l)!=0;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{l:{h:if(!((0|(c=(0|(c=(0|(c=(E(y=y+(c?-16:-4)|0,c=(n<<1)+(c?-2:-1)|0)+w|0)/(0|c)|0))>(0|_)?_:c))<64?c:64))>=4)||!((0|(p=(d[((7&c)<<1)+42144>>1]>>14-(c>>>3|0))+1&-2))>=257)){p=(0|f)>(0|O)?p:l?1:p;Z:{p:{$:{if(D){if(c=function(e,t,r,i,n){var o=g(0),a=g(0),s=g(0),c=g(0),d=g(0);t:{if(r){if(a=g(10000000036274937e-31),(0|i)<1){o=g(10000000036274937e-31);break t}for(r=0,o=g(10000000036274937e-31);;){if(s=m[(n=r<<2)+e>>2],d=g(s-(c=m[t+n>>2])),o=g(o+g(d*d)),s=g(s+c),a=g(a+g(s*s)),(0|i)==(0|(r=r+1|0)))break}break t}if((0|i)<1){o=g(10000000036274937e-31),a=g(10000000036274937e-31);break t}for(r=0;;){if(a=g(a+g((o=m[(r<<2)+e>>2])*o)),(0|i)==(0|(r=r+1|0)))break}for(a=g(a+g(10000000036274937e-31)),r=0,o=g(0);;){if(o=g(o+g((s=m[(r<<2)+t>>2])*s)),(0|i)==(0|(r=r+1|0)))break}o=g(o+g(10000000036274937e-31))}c=g(C(o)),o=g(c*c),d=g(C(a)),a=g(d*d),s=g(0);c:if(!(g(o+a)<g(1000000045813705e-33))){if(s=g(g(1.5707963705062866)-g(g(g(c*d)*g(o+g(a*g(.43157973885536194))))/g(g(o+g(a*g(.6784840226173401)))*g(o+g(a*g(.0859554186463356)))))),!(o>a^1))break c;s=g(g(g(g(g(c*d)*g(a+g(o*g(.43157973885536194))))/g(g(a+g(o*g(.6784840226173401)))*g(a+g(o*g(.0859554186463356)))))+g(1.5707963705062866))+g(-1.5707963705062866))}return(a=g(R(g(g(s*g(10430.3818359375))+g(.5)))),g(S(a))<g(0x80000000))?~~a:-0x80000000}(r,i,l,n,u[e+44>>2]),w=tR(A),(0|p)==1)break Z;f:{et:{if(l){if(e=u[e+48>>2])break et;e=E(c,p)- -8192>>14;break f}f=(_=(c=E(c,p))- -8192|0)>>14;_:{if((0|f)>=(0|p)||(0|c)<8192||!u[e+56>>2]){e=f;break _}if(c=E((_=((-16384&_)>>>0)/((e=p)>>>0)<<16)>>13,_>>16)+32768>>16,y=b(I=((E(c,((E((E(c,-626)+16384>>15)+8277|0,c)<<1)+32768&-65536)-0x1de30000>>16)+16384>>>15|0)-c<<16)- -0x80000000>>16),c=E((c=0x40000000-_|0)>>13,c>>16)+32768>>16,_=b(c=((E(c,((E((E(c,-626)+16384>>15)+8277|0,c)<<1)+32768&-65536)-0x1de30000>>16)+16384>>>15|0)-c<<16)- -0x80000000>>16),I=I<<y-17<<16>>16,c=c<<_-17<<16>>16,c=E((y-_<<11)-(E(I,(E(I,-2597)+16384>>15)+7932|0)+16384>>>15|0)+(E(c,(E(c,-2597)+16384>>15)+7932|0)+16384>>>15)<<16>>16,(n<<23)-8388608>>16)+16384>>15,(0|c)>(0|(_=u[o>>2])))break _;e=(0-_|0)>(0|c)?0:f}if((0|s)<2)break $;break d}e=((-1^e)>>>31|0)+((0|(c=(0|(c=E(c,p)+((((0|c)>8192?32767:-32767)|0)/(0|p)|0)|0))<0?0:c>>14))<(0|p)?c:p-1|0)|0}if((0|n)<=2)break d;f=E(c=(0|p)/2|0,3)+3|0,_=E(e,3),ew(A,(s=(0|e)>(0|c))?(f+(-1^c)|0)+e|0:_,s?(f-c|0)+e|0:_+3|0,c+f|0);break c}if(w=tR(A),(0|p)==1)break l;if(!(!l|(0|n)<3)){y=A,f=E(s=(c=(0|p)/2|0)+1|0,3),e=tk(A,_=c+f|0);eb:{if((0|f)>(0|e)){e=(0|e)/3|0;break eb}e=e-(s<<1)|0}s=E(e,3),e$(y,(I=(0|e)>(0|c))?((-1^c)+f|0)+e|0:s,I?(f-c|0)+e|0:s+3|0,_);break c}if(l?0:(0|s)<=1)break p;e=ef(A,p+1|0);break c}y=(I=p-e|0)+1|0,M=e+1|0,s=(_=(0|(c=p>>1))<(0|e))?y:M,f=E(c=c+1|0,c),ew(A,c=_?f-(E(I+2|0,y)>>1)|0:E(e,M)>>1,s+c|0,f);break c}s=A,e=tk(A,i=E(l=(r=p>>1)+1|0,l));eD:{if((0|e)<E(r,l)>>1){r=E(e=(l=tg(e<<3|1)-1>>>1|0)+1|0,l)>>>1|0;break eD}r=l=p+1|0,e=r-(l=(l<<1)-tg((-1^e)+i<<3|1)>>>1|0)|0,r=i-(E(e,(p-l|0)+2|0)>>1)|0}e$(s,r,e+r|0,i),c=(l<<14>>>0)/(p>>>0)|0;break o}if(!l)break o;l=0,f=0;v:if(!((0|c)<8193)&&!(p=u[e+52>>2])){if(f=1,(0|n)<1)break v;for(f=!p,p=0;;){if(m[(c=(p<<2)+i|0)>>2]=-m[c>>2],(0|(p=p+1|0))==(0|n))break}}if((0|n)<1)break u;for(v=m[(O<<2)+P>>2],T=m[(u[L+8>>2]+O<<2)+P>>2],N=g(g(C(g(g(g(v*v)+g(10000000036274937e-31))+g(T*T))))+g(10000000036274937e-31)),T=g(T/N),v=g(v/N);;){if(m[(c=(p=l<<2)+r|0)>>2]=g(v*m[c>>2])+g(T*m[i+p>>2]),(0|(l=l+1|0))==(0|n))break}break u}tO(42160,41800,669),k()}if(f=0,!l)break s}n=0;es:if(!(u[o>>2]<17)){if(n=0,u[e+32>>2]<17)break es;if(D){eP(A,f,2),n=f;break es}n=eZ(A,2)}f=u[e+52>>2]?0:n;break s}eW(A,e,p+1|0)}if((0|e)<=-1)break a;if(e<<=14,c=(e>>>0)/(p>>>0)|0,!l|!D)break o;if(e>>>0<p>>>0){if(f=0,(0|n)<1)break s;for(v=m[(O<<2)+P>>2],T=m[(u[L+8>>2]+O<<2)+P>>2],N=g(g(C(g(g(g(v*v)+g(10000000036274937e-31))+g(T*T))))+g(10000000036274937e-31)),T=g(T/N),v=g(v/N),l=0;;){if(m[(p=r+(e=l<<2)|0)>>2]=g(v*m[p>>2])+g(T*m[e+i>>2]),(0|(l=l+1|0))==(0|n))break}break s}if((0|n)<1)break o;for(l=0;;){if(T=g(m[(p=r+(e=l<<2)|0)>>2]*g(.7071067690849304)),v=g(m[(e=e+i|0)>>2]*g(.7071067690849304)),m[p>>2]=T+v,m[e>>2]=v-T,(0|(l=l+1|0))==(0|n))break}break o}e=(n=tR(A))-w|0,u[o>>2]=u[o>>2]-e;break n}tO(42104,41800,838),k()}if(e=(l=tR(A))-w|0,u[o>>2]=u[o>>2]-e,l=16384,(0|c)==16384)break i;if(c)break r;f=c}u[h>>2]=u[h>>2]&(-1<<a^-1),n=-16384,i=32767,l=0,r=0;break t}u[h>>2]=u[h>>2]&(-1<<a^-1)<<a,r=32767,f=0,i=0,n=16384;break t}l=E((r=c<<16)>>13,r>>16)+32768>>16,p=b(i=((E(l,((E((E(l,-626)+16384>>15)+8277|0,l)<<1)+32768&-65536)-0x1de30000>>16)+16384>>>15|0)-l<<16)- -0x80000000>>16),l=E((l=0x40000000-r|0)>>13,l>>16)+32768>>16,o=p-(l=b(r=((E(l,((E((E(l,-626)+16384>>15)+8277|0,l)<<1)+32768&-65536)-0x1de30000>>16)+16384>>>15|0)-l<<16)- -0x80000000>>16))<<11,p=i<<p-17<<16>>16,l=r<<l-17<<16>>16,n=E(o-(E(p,(E(p,-2597)+16384>>15)+7932|0)+16384>>>15|0)+(E(l,(E(l,-2597)+16384>>15)+7932|0)+16384>>>15)<<16>>16,(n<<23)-8388608>>16)+16384>>15,f=0,l=c}u[t+20>>2]=e,u[t+16>>2]=l,u[t+12>>2]=n,u[t+8>>2]=r,u[t+4>>2]=i,u[t>>2]=f}function H(e,t,r){var i=0,n=0,o=0,a=0;M=i=M-16|0,u[i+12>>2]=r,r=-5;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{l:{h:{q:{Z:{p:{$:{ee:{f:{et:{er:{_:{en:{switch(t-4002|0){default:switch(t-10002|0){case 6:break p;case 0:break er;case 10:break _;case 8:break en;case 24:break i;case 22:break n;case 13:break a;case 26:break s;case 20:break c;case 14:break d;default:break t}case 1:case 2:case 3:case 5:case 6:case 7:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 27:case 28:case 30:case 31:case 32:case 33:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:break t;case 26:break u;case 45:break l;case 44:break h;case 35:break q;case 34:break Z;case 0:break $;case 4:break ee;case 18:break f;case 12:break et;case 8:break;case 29:break o}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=-1,(t=u[t>>2])>>>0>10)break t;u[e+24>>2]=t;break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=-1,(0|(t=u[t>>2]))<0|u[u[e>>2]+8>>2]<=(0|t))break t;u[e+32>>2]=t;break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=-1,(0|(t=u[t>>2]))<1|u[u[e>>2]+8>>2]<(0|t))break t;u[e+36>>2]=t;break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=-1,(t=u[t>>2])>>>0>2)break t;u[e+12>>2]=!t,u[e+20>>2]=(0|t)!=2;break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=-1,(t=u[t>>2])>>>0>100)break t;u[e+56>>2]=t;break r}r=u[i+12>>2],u[i+12>>2]=r+4,u[e+52>>2]=u[r>>2];break r}r=u[i+12>>2],u[i+12>>2]=r+4,u[e+44>>2]=u[r>>2];break r}if(r=u[i+12>>2],u[i+12>>2]=r+4,(0|(t=u[r>>2]))<=500&&(r=-1,(0|t)!=-1))break t;r=E(u[e+4>>2],26e4),u[e+40>>2]=(0|t)<(0|r)?t:r;break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=-1,(t=u[t>>2])-1>>>0>1)break t;u[e+8>>2]=t;break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=-1,(t=u[t>>2])-8>>>0>16)break t;u[e+60>>2]=t;break r}r=u[i+12>>2],u[i+12>>2]=r+4,u[u[r>>2]>>2]=u[e+60>>2];break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=-1,(t=u[t>>2])>>>0>1)break t;u[e+68>>2]=t;break r}if(r=u[i+12>>2],u[i+12>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+68>>2];break r}if(r=0,t=u[e+4>>2],o=u[e>>2],n=u[o+4>>2],ex(e+76|0,0,E(t,((n<<2)+((a=u[o+8>>2])<<4)|0)+4096|0)+168|0),(0|(o=E(u[o+8>>2],t)))>=1)for(n=(E(n+1024|0,t)<<2)+e|0,n=(n+(t=E(t,a)<<2)|0)+244|0,a=t+n|0;;){if(u[a+(t=r<<2)>>2]=-0x3e200000,u[t+n>>2]=-0x3e200000,(0|o)==(0|(r=r+1|0)))break}r=0,u[e+216>>2]=0,u[e+96>>2]=0,u[e+100>>2]=0,u[e+88>>2]=256,u[e+80>>2]=2,u[e+84>>2]=0x3f800000;break t}r=u[i+12>>2],u[i+12>>2]=r+4,u[e+48>>2]=u[r>>2];break r}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=0,!(t=u[t>>2]))break t;o=u[t+4>>2],n=u[t>>2],u[e+120>>2]=n,u[e+124>>2]=o,n=u[t+60>>2],o=u[t+56>>2],u[e+176>>2]=o,u[e+180>>2]=n,o=u[t+52>>2],n=u[t+48>>2],u[e+168>>2]=n,u[e+172>>2]=o,n=u[t+44>>2],o=u[t+40>>2],u[e+160>>2]=o,u[e+164>>2]=n,o=u[t+36>>2],n=u[t+32>>2],u[e+152>>2]=n,u[e+156>>2]=o,n=u[t+28>>2],o=u[t+24>>2],u[e+144>>2]=o,u[e+148>>2]=n,o=u[t+20>>2],n=u[t+16>>2],u[e+136>>2]=n,u[e+140>>2]=o,n=u[t+12>>2],o=u[t+8>>2],u[e+128>>2]=o,u[e+132>>2]=n;break t}if(t=u[i+12>>2],u[i+12>>2]=t+4,r=0,!(t=u[t>>2]))break t;o=u[t+4>>2],n=u[t>>2],u[e+184>>2]=n,u[e+188>>2]=o;break t}if(r=u[i+12>>2],u[i+12>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e>>2];break r}if(r=u[i+12>>2],u[i+12>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+76>>2];break r}r=u[i+12>>2],u[i+12>>2]=r+4,u[e+64>>2]=u[r>>2];break r}r=u[i+12>>2],u[i+12>>2]=r+4,u[e+236>>2]=u[r>>2]}r=0}return M=i+16|0,r}function Y(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0,b=0,T=0,y=0;for(T=h=M,a=u[e+268>>2],M=h=h-((a+(c=u[e+276>>2])<<2)+15&-16)|0,f=ev(h,g=e+24|0,c<<2),S=(h=u[e+296>>2])+4|0,m=u[e+272>>2],o=h;;){ta(e,(c<<2)+f|0,r,o,_=(0|i)<(0|a)?i:a),A=_<<16;r:{i:{n:{o:{switch((v=u[e+276>>2])-18|0){case 18:break i;case 6:break o;case 0:break;default:break n}if((0|A)<1)break r;for(y=(b=u[e+280>>2])<<16>>16,o=0;;){if(s=E(65535&o,y)>>16,l=d[(c=E(s,18)+S|0)>>1],p=(E(l,65535&(n=u[(a=(o>>16<<2)+f|0)>>2]))>>16)+E(n>>16,l)|0,l=d[c+2>>1],p=(p+E(l,(n=u[a+4>>2])>>16)|0)+(E(65535&n,l)>>16)|0,l=d[c+4>>1],p=(p+E(l,(n=u[a+8>>2])>>16)|0)+(E(65535&n,l)>>16)|0,l=d[c+6>>1],p=(p+E(l,(n=u[a+12>>2])>>16)|0)+(E(65535&n,l)>>16)|0,l=d[c+8>>1],p=(p+E(l,(n=u[a+16>>2])>>16)|0)+(E(65535&n,l)>>16)|0,l=d[c+10>>1],p=(p+E(l,(n=u[a+20>>2])>>16)|0)+(E(65535&n,l)>>16)|0,l=d[c+12>>1],p=(p+E(l,(n=u[a+24>>2])>>16)|0)+(E(65535&n,l)>>16)|0,l=d[c+14>>1],l=(p+E(l,(n=u[a+28>>2])>>16)|0)+(E(65535&n,l)>>16)|0,c=d[c+16>>1],l=(l+E(c,(n=u[a+32>>2])>>16)|0)+(E(65535&n,c)>>16)|0,s=d[(c=E((-1^s)+b|0,18)+S|0)>>1],l=(l+E(s,(n=u[a+68>>2])>>16)|0)+(E(65535&n,s)>>16)|0,s=d[c+2>>1],l=(l+E(s,(n=u[a+64>>2])>>16)|0)+(E(65535&n,s)>>16)|0,s=d[c+4>>1],l=(l+E(s,(n=u[a+60>>2])>>16)|0)+(E(65535&n,s)>>16)|0,s=d[c+6>>1],l=(l+E(s,(n=u[a+56>>2])>>16)|0)+(E(65535&n,s)>>16)|0,s=d[c+8>>1],l=(l+E(s,(n=u[a+52>>2])>>16)|0)+(E(65535&n,s)>>16)|0,s=d[c+10>>1],l=(l+E(s,(n=u[a+48>>2])>>16)|0)+(E(65535&n,s)>>16)|0,s=d[c+12>>1],l=(l+E(s,(n=u[a+44>>2])>>16)|0)+(E(65535&n,s)>>16)|0,s=d[c+14>>1],n=u[a+40>>2],c=d[c+16>>1],a=u[a+36>>2],c=((a=(((l+E(s,n>>16)|0)+(E(65535&n,s)>>16)|0)+E(c,a>>16)|0)+(E(65535&a,c)>>16)|0)>>5)+1>>1,d[t>>1]=(0|a)>2097119?32767:(0|c)>-32768?c:-32768,t=t+2|0,!((0|A)>(0|(o=o+m|0))))break}break r}if(c=0,(0|A)<=0)break r;for(;;){if(n=d[h+4>>1],s=(E(n,65535&(o=u[(a=(c>>16<<2)+f|0)+92>>2]+u[a>>2]|0))>>16)+E(o>>16,n)|0,n=d[h+6>>1],s=(s+E(n,(o=u[a+88>>2]+u[a+4>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+8>>1],s=(s+E(n,(o=u[a+84>>2]+u[a+8>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+10>>1],s=(s+E(n,(o=u[a+80>>2]+u[a+12>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+12>>1],s=(s+E(n,(o=u[a+76>>2]+u[a+16>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+14>>1],s=(s+E(n,(o=u[a+72>>2]+u[a+20>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+16>>1],s=(s+E(n,(o=u[a+68>>2]+u[a+24>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+18>>1],s=(s+E(n,(o=u[a+64>>2]+u[a+28>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+20>>1],s=(s+E(n,(o=u[a+60>>2]+u[a+32>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+22>>1],s=(s+E(n,(o=u[a+56>>2]+u[a+36>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+24>>1],n=(s+E(n,(o=u[a+52>>2]+u[a+40>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,o=d[h+26>>1],o=((a=(n+E(o,(a=u[a+48>>2]+u[a+44>>2]|0)>>16)|0)+(E(65535&a,o)>>16)|0)>>5)+1>>1,d[t>>1]=(0|a)>2097119?32767:(0|o)>-32768?o:-32768,t=t+2|0,!((0|A)>(0|(c=c+m|0))))break}break r}tO(6400,6420,139),k()}if(c=0,(0|A)<=0)break r;for(;;){if(n=d[h+4>>1],s=(E(n,65535&(o=u[(a=(c>>16<<2)+f|0)+140>>2]+u[a>>2]|0))>>16)+E(o>>16,n)|0,n=d[h+6>>1],s=(s+E(n,(o=u[a+136>>2]+u[a+4>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+8>>1],s=(s+E(n,(o=u[a+132>>2]+u[a+8>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+10>>1],s=(s+E(n,(o=u[a+128>>2]+u[a+12>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+12>>1],s=(s+E(n,(o=u[a+124>>2]+u[a+16>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+14>>1],s=(s+E(n,(o=u[a+120>>2]+u[a+20>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+16>>1],s=(s+E(n,(o=u[a+116>>2]+u[a+24>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+18>>1],s=(s+E(n,(o=u[a+112>>2]+u[a+28>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+20>>1],s=(s+E(n,(o=u[a+108>>2]+u[a+32>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+22>>1],s=(s+E(n,(o=u[a+104>>2]+u[a+36>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+24>>1],s=(s+E(n,(o=u[a+100>>2]+u[a+40>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+26>>1],s=(s+E(n,(o=u[a+96>>2]+u[a+44>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+28>>1],s=(s+E(n,(o=u[a+92>>2]+u[a+48>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+30>>1],s=(s+E(n,(o=u[a+88>>2]+u[a+52>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+32>>1],s=(s+E(n,(o=u[a+84>>2]+u[a+56>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+34>>1],s=(s+E(n,(o=u[a+80>>2]+u[a+60>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,n=d[h+36>>1],n=(s+E(n,(o=u[a+76>>2]+u[a+64>>2]|0)>>16)|0)+(E(65535&o,n)>>16)|0,o=d[h+38>>1],o=((a=(n+E(o,(a=u[a+72>>2]+u[a+68>>2]|0)>>16)|0)+(E(65535&a,o)>>16)|0)>>5)+1>>1,d[t>>1]=(0|a)>2097119?32767:(0|o)>-32768?o:-32768,t=t+2|0,!((0|A)>(0|(c=c+m|0))))break}}if((0|(i=i-_|0))>=2){ev(f,(_<<2)+f|0,v<<2),r=(_<<1)+r|0,o=u[e+296>>2],c=u[e+276>>2],a=u[e+268>>2];continue}break}ev(g,(_<<2)+f|0,v<<2),M=T}function K(e,t,r,i,n){var o=0,a=0,c=0,d=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0,b=0,T=0,y=0,R=0,I=0,C=0,w=0,O=0;M=o=M-32|0,p=o,u[o+24>>2]=0,u[o+28>>2]=0,u[o+16>>2]=0,u[o+20>>2]=0,u[o+8>>2]=0,u[o+12>>2]=0,u[o>>2]=0,u[o+4>>2]=0;t:{r:{i:{if((0|(c=-16&n))<(0|n)){if((0|n)!=120)break i;s[i+120|0]=0,s[i+121|0]=0,s[i+122|0]=0,s[i+123|0]=0,s[i+124|0]=0,s[i+125|0]=0,s[i+126|0]=0,s[i+127|0]=0,c=128,s[i+128|0]=0,s[i+129|0]=0,s[i+130|0]=0,s[i+131|0]=0,s[i+132|0]=0,s[i+133|0]=0,s[i+134|0]=0,s[i+135|0]=0,M=d=v=o-512|0,S=8;break r}if(S=n>>4,M=d=v=o-(c<<2)|0,(0|n)>15)break r;M=a=g=d-(o=(S<<2)+15&-16)|0,M=T=a-o|0;break t}tO(9312,9354,89),k()}for(o=0;;){if(h=a=s[i+o|0],a>>=31,u[(o<<2)+v>>2]=a^a+h,f=((a=1|o)<<2)+v|0,h=a=s[i+a|0],a>>=31,u[f>>2]=a^a+h,f=((a=2|o)<<2)+v|0,h=a=s[i+a|0],a>>=31,u[f>>2]=a^a+h,f=((a=3|o)<<2)+v|0,h=a=s[i+a|0],a>>=31,u[f>>2]=a^a+h,!((0|c)>(0|(o=o+4|0))))break}for(M=a=g=d-(o=(S<<2)+15&-16)|0,M=T=a-o|0,w=l[8120],C=l[8119],y=l[8118],m=l[8117],a=0,o=v;;){for(u[(b=T+(c=I<<2)|0)>>2]=0,O=c+g|0,c=u[o+4>>2],d=u[o>>2];;){A=1;c:{d:{if((0|m)<(0|(c=c+d|0))){h=_,c=a;break d}if(u[p>>2]=c,(0|m)<(0|(h=u[o+12>>2]+u[o+8>>2]|0))){h=_;break d}if(u[p+4>>2]=h,(0|m)<(0|(a=u[o+20>>2]+u[o+16>>2]|0)))break d;if(u[p+8>>2]=a,(0|m)<(0|(a=u[o+28>>2]+u[o+24>>2]|0)))break d;if(u[p+12>>2]=a,(0|m)<(0|(a=u[o+36>>2]+u[o+32>>2]|0)))break d;if(u[p+16>>2]=a,(0|m)<(0|(a=u[o+44>>2]+u[o+40>>2]|0)))break d;if(u[p+20>>2]=a,(0|m)<(0|(a=u[o+52>>2]+u[o+48>>2]|0)))break d;if(u[p+24>>2]=a,(0|m)<(0|(a=u[o+60>>2]+u[o+56>>2]|0)))break d;u[p+28>>2]=a,R=0;break c}R=1}d=c+h|0;h:{if((0|y)<(0|d)){f=h,d=c;break h}if(u[p>>2]=d,(0|y)<(0|(f=u[p+12>>2]+u[p+8>>2]|0))){f=h;break h}if(u[p+4>>2]=f,(0|y)<(0|(a=u[p+20>>2]+u[p+16>>2]|0)))break h;if(u[p+8>>2]=a,(0|y)<(0|(a=u[p+28>>2]+u[p+24>>2]|0)))break h;u[p+12>>2]=a,A=0}c=-1,a=d+f|0;p:{if((0|C)<(0|a)){_=f,a=d;break p}if(u[p>>2]=a,(0|C)<(0|(_=u[p+12>>2]+u[p+8>>2]|0))){_=f;break p}u[p+4>>2]=_,c=0}d=A+R|0;f:if(!((0|w)>=(0|(h=a+_|0)))||(u[O>>2]=h,(0|c)!=(0|d))){u[b>>2]=u[b>>2]+1,d=u[o>>2]>>1,u[o>>2]=d,c=u[o+4>>2]>>1,u[o+4>>2]=c,u[o+8>>2]=u[o+8>>2]>>1,u[o+12>>2]=u[o+12>>2]>>1,u[o+16>>2]=u[o+16>>2]>>1,u[o+20>>2]=u[o+20>>2]>>1,u[o+24>>2]=u[o+24>>2]>>1,u[o+28>>2]=u[o+28>>2]>>1,u[o+32>>2]=u[o+32>>2]>>1,u[o+36>>2]=u[o+36>>2]>>1,u[o+40>>2]=u[o+40>>2]>>1,u[o+44>>2]=u[o+44>>2]>>1,u[o+48>>2]=u[o+48>>2]>>1,u[o+52>>2]=u[o+52>>2]>>1,u[o+56>>2]=u[o+56>>2]>>1,u[o+60>>2]=u[o+60>>2]>>1;continue}break}if(o=o- -64|0,b=1,(0|(I=I+1|0))==(0|S))break}}for(A=0x7fffffff,m=E(y=t>>1,9),f=0,R=0;;){if(c=l[(f+m|0)+8528|0],b)for(_=(h=E(f,18))+8337|0,o=0;;){if(a=_,u[T+(d=o<<2)>>2]<=0&&(a=(u[d+g>>2]+h|0)+8320|0),c=l[0|a]+c|0,(0|S)==(0|(o=o+1|0)))break}if(R=(o=(0|c)<(0|A))?f:R,A=o?c:A,(0|(f=f+1|0))==9)break}eR(e,R,E(y,9)+8496|0,8);A:if(b){for(_=E(R,18)+8128|0,c=0;;){o=u[T+(d=c<<2)>>2];eb:{if(!o){eR(e,u[d+g>>2],_,8);break eb}if(eR(e,17,_,8),(0|o)>=2)for(a=o-1|0,o=0;;){if(eR(e,17,8290,8),(0|a)==(0|(o=o+1|0)))break}eR(e,u[d+g>>2],8290,8)}if((0|S)==(0|(c=c+1|0)))break}if(!b)break A;for(o=0;;){if(u[(o<<2)+g>>2]>=1&&function(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0;r=u[t+4>>2]+u[t>>2]|0,i=r+(d=u[t+12>>2]+u[t+8>>2]|0)|0,n=u[t+20>>2]+u[t+16>>2]|0,o=i+(p=n+(h=u[t+28>>2]+u[t+24>>2]|0)|0)|0,a=u[t+36>>2]+u[t+32>>2]|0,s=a+(f=u[t+44>>2]+u[t+40>>2]|0)|0,c=u[t+52>>2]+u[t+48>>2]|0,(0|(v=o+(m=s+(A=c+(_=u[t+60>>2]+u[t+56>>2]|0)|0)|0)|0))>=1&&eR(e,o,l[v+9200|0]+9040|0,8),(0|o)>=1&&eR(e,i,l[o+9200|0]+8880|0,8),(0|i)>=1&&eR(e,r,l[i+9200|0]+8720|0,8),(0|r)>=1&&eR(e,u[t>>2],l[r+9200|0]+8560|0,8),(0|d)>=1&&eR(e,u[t+8>>2],l[d+9200|0]+8560|0,8),(0|p)>=1&&eR(e,n,l[p+9200|0]+8720|0,8),(0|n)>=1&&eR(e,u[t+16>>2],l[n+9200|0]+8560|0,8),(0|h)>=1&&eR(e,u[t+24>>2],l[h+9200|0]+8560|0,8),(0|m)>=1&&eR(e,s,l[m+9200|0]+8880|0,8),(0|s)>=1&&eR(e,a,l[s+9200|0]+8720|0,8),(0|a)>=1&&eR(e,u[t+32>>2],l[a+9200|0]+8560|0,8),(0|f)>=1&&eR(e,u[t+40>>2],l[f+9200|0]+8560|0,8),(0|A)>=1&&eR(e,c,l[A+9200|0]+8720|0,8),(0|c)>=1&&eR(e,u[t+48>>2],l[c+9200|0]+8560|0,8),(0|_)>=1&&eR(e,u[t+56>>2],l[_+9200|0]+8560|0,8)}(e,(o<<6)+v|0),(0|S)==(0|(o=o+1|0)))break}if(!b)break A;for(A=0;;){if((0|(h=u[(A<<2)+T>>2]))>=1)for(f=(A<<4)+i|0,_=0;;){if(a=o=s[_+f|0],o>>=31,d=(o^o+a)<<24>>24,(0|(o=h))!=1)for(;;){if(eR(e,d>>>(a=o-1|0)&1,5824,8),c=(0|o)>2,o=a,!c)break}if(eR(e,1&d,5824,8),(0|(_=_+1|0))==16)break}if((0|S)==(0|(A=A+1|0)))break}}(function(e,t,r,i,n,o){var a=0,c=0,d=0;if(M=a=M-16|0,s[a+15|0]=0,(0|r)>=8)for(d=E((i<<1)+n<<16>>16,7)+9232|0,i=(0|(r=r+8>>4))>1?r:1;;){if((0|(r=u[(c<<2)+o>>2]))>=1)for(r&=31,s[a+14|0]=l[(r>>>0<6?r:6)+d|0],r=0;;){if((n=l[t+r|0])&&eR(e,(n<<24>>24>>>7|0)+1&255,a+14|0,8),(0|(r=r+1|0))==16)break}if(t=t+16|0,(0|(c=c+1|0))==(0|i))break}M=a+16|0})(e,i,n,t,r,g),M=p+32|0}function Q(e,t,r,i,n,o,a,s,c,h,p){var f=0,_=0,v=0,b=0,T=0,y=g(0),I=g(0),w=0,O=0,N=0,P=0,D=0,L=0,x=0,U=0;D=(r>>>0)/(n>>>0)|0,x=u[e>>2];t:{if((0|r)==1){if(o=0,u[e+32>>2]>=8){h=u[e+28>>2];n:{if(x){e4(h,o=m[t>>2]<g(0),1);break n}o=tr(h,1)}u[e+32>>2]=u[e+32>>2]-8}if(u[e+4>>2]&&(m[t>>2]=o?g(-1):g(1)),p=1,!s)break t;return u[s>>2]=u[t>>2],1}f=(0|(P=u[e+24>>2]))>0;s:{if(!o||!h||!((0|P)>0|(0|n)>1|!(1&D)&(0|P)!=0)){h=o;break s}ev(h,o,r<<2)}if(O=f?P:0,(0|P)>=1)for(;;){q:{if(x){if((0|_)==31)break q;for(N=(0|(o=(T=r>>_)>>1))>1?o:1,w=(b=1<<_)<<1,f=0;;){if(o=0,(0|T)>=2)for(;;){if(L=v=(E(o,w)+f<<2)+t|0,y=g(m[v>>2]*g(.7071067690849304)),I=g(m[(v=(((o<<1|1)<<_)+f<<2)+t|0)>>2]*g(.7071067690849304)),m[L>>2]=y+I,m[v>>2]=y-I,(0|N)==(0|(o=o+1|0)))break}if((0|b)==(0|(f=f+1|0)))break}}if(!h|(0|_)==31)break q;for(N=(0|(o=(T=r>>_)>>1))>1?o:1,w=(b=1<<_)<<1,f=0;;){if(o=0,(0|T)>=2)for(;;){if(L=v=(E(o,w)+f<<2)+h|0,y=g(m[v>>2]*g(.7071067690849304)),I=g(m[(v=(((o<<1|1)<<_)+f<<2)+h|0)>>2]*g(.7071067690849304)),m[L>>2]=y+I,m[v>>2]=y-I,(0|N)==(0|(o=o+1|0)))break}if((0|b)==(0|(f=f+1|0)))break}}if(p=l[(15&p)+41920|0]|l[(p>>4)+41920|0]<<2,(0|O)==(0|(_=_+1|0)))break}_=n>>O,T=D<<O;_:{if(!(1&T|(0|P)>-1)){for(D=P;;){if(!(!x|(0|_)<1))for(N=(0|(o=T>>1))>1?o:1,w=_<<1,f=0;;){if(o=0,(0|T)>=2)for(;;){if(b=v=(E(o,w)+f<<2)+t|0,y=g(m[v>>2]*g(.7071067690849304)),I=g(m[(v=(E(o<<1|1,_)+f<<2)+t|0)>>2]*g(.7071067690849304)),m[b>>2]=y+I,m[v>>2]=y-I,(0|N)==(0|(o=o+1|0)))break}if((0|_)==(0|(f=f+1|0)))break}if(b=T>>1,!(!h|(0|_)<1))for(N=(0|b)>1?b:1,w=_<<1,f=0;;){if(o=0,(0|T)>=2)for(;;){if(L=v=(E(o,w)+f<<2)+h|0,y=g(m[v>>2]*g(.7071067690849304)),I=g(m[(v=(E(o<<1|1,_)+f<<2)+h|0)>>2]*g(.7071067690849304)),m[L>>2]=y+I,m[v>>2]=y-I,(0|N)==(0|(o=o+1|0)))break}if((0|_)==(0|(f=f+1|0)))break}if(U=U+1|0,o=_<<1,p=p<<_|p,2&T)break _;if(f=(0|D)<-1,D=D+1|0,_=o,T=b,!f)break}break _}b=T,o=_}f=(0|n)==1;v:if(!((0|o)<2)){if(x&&eH(t,b>>O,o<<O,f),!h)break v;eH(h,b>>O,o<<O,f)}if(p=function e(t,r,i,n,o,a,s,c,h){var p=0,f=0,_=0,v=0,b=0,T=0,y=0,I=g(0),w=g(0),O=0,N=0,P=0,D=0;M=b=M-32|0,u[b+24>>2]=h,u[b+28>>2]=n,p=u[t+8>>2],p=l[0|(f=u[p+100>>2]+d[u[p+96>>2]+(u[t+12>>2]+E(u[p+8>>2],s+1|0)<<1)>>1]|0)],y=-1,O=u[t+28>>2],N=u[t+20>>2],P=u[t>>2];t:{if(!((0|s)==-1|(0|i)<3|(l[p+f|0]+12|0)>=(0|n))){p=s-1|0,i=((n=i>>>1|0)<<2)+r|0,(0|o)==1&&(u[b+24>>2]=1&h|h<<1),W(t,b,r,i,n,b+28|0,T=o+1>>1,o,p,0,b+24|0),I=g(u[b+8>>2]),w=g(u[b+4>>2]),h=u[b+20>>2],f=u[b+12>>2],y=u[b+16>>2],_=f;n:if(!(!(16383&y)|(0|o)<2)){if(_=f-(f>>5-s)|0,(0|y)>=8193)break n;_=(s=(n<<3>>6-s)+f|0)&s>>31}if(f=_,I=g(I*g(30517578125e-15)),w=g(w*g(30517578125e-15)),s=u[b+28>>2],h=u[t+32>>2]-h|0,u[t+32>>2]=h,v=a?(n<<2)+a|0:0,f=(s-f|0)/2|0,f=(0|(f=(0|s)<(0|f)?s:f))>0?f:0,(0|(s=s-f|0))<=(0|f)){_=u[b+24>>2],r=e(t,r,n,f,T,a,p,g(w*c),_),f=(u[t+32>>2]-h|0)+f|0,p=r|e(t,i,n,(y&&(0|f)>24?f-24|0:0)+s|0,T,v,p,g(I*c),_>>T)<<(o>>1);break t}_=u[b+24>>2],i=e(t,i,n,s,T,v,p,g(I*c),_>>T),s=(u[t+32>>2]-h|0)+s|0,p=e(t,r,n,((0|y)!=16384&&(0|s)>24?s-24|0:0)+f|0,T,a,p,g(w*c),_)|i<<(o>>1);break t}_=p=(n=(0|(s=n-1|0))>l[(v=p+1>>>1|0)+f|0])?p:v,_=(p=l[f+(n=((v=n?v:0)+p|0)+1>>>1|0)|0]<(0|s))?_:n,p=(v=l[f+(n=(_+(p=p?n:v)|0)+1>>>1|0)|0]<(0|s))?n:p,p=(v=l[f+(n=(p+(_=v?_:n)|0)+1>>>1|0)|0]<(0|s))?n:p,D=_=(v=l[f+(n=(p+(_=v?_:n)|0)+1>>1)|0]<(0|s))?_:n,p=(_=l[f+(n=(_+(v=v?n:p)|0)+1>>1)|0]<(0|s))?D:n,(n=_?n:v)&&(y=l[n+f|0]),(n=(s-y|0)>(l[p+f|0]-s|0)?p:n)&&(T=l[n+f|0]+1|0),p=u[t+32>>2]-T|0,u[t+32>>2]=p;d:{u:{if((0|p)>-1||(0|n)<1){s=n;break u}for(;;){if(p=p+T|0,u[t+32>>2]=p,!(s=n-1|0)){u[t+32>>2]=p;break d}if(p=p-(T=l[s+f|0]+1|0)|0,u[t+32>>2]=p,(0|p)>-1)break u;if(y=(0|n)>1,n=s,!y)break}}if(!s)break d;if(s=(0|s)>=8?(7&s|8)<<(s>>>3|0)-1:s,P){p=function(e,t,r,i,n,o,a,s,c){var d=0,l=0,h=g(0);l=c=M;t:{if((0|r)>0){if((0|t)<=1)break t;if(M=c=c-((t<<2)+27&-16)|0,ei(e,t,1,n,r,i),h=function(e,t,r,i,n){var o=0,a=g(0),s=g(0),c=0,d=g(0),l=g(0),h=0,p=0,f=g(0),_=0,A=0,v=g(0),E=0,b=g(0);for(E=n=M,M=n=n-(o=(i<<2)+15&-16)|0,M=_=n-o|0,p=ex(n,0,(h=(0|i)>1?i:1)<<2),n=0;;){if(a=m[(c=(o=n<<2)+e|0)>>2],u[o+_>>2]=a<g(0),m[c>>2]=S(a),u[t+o>>2]=0,(0|h)==(0|(n=n+1|0)))break}if(a=g(0),(0|r)>i>>1){for(n=0;;){if(a=g(a+m[(n<<2)+e>>2]),(0|h)==(0|(n=n+1|0)))break}for(!(a<g(64)?!(a>g(10000000036274937e-31)^1):0)&&(u[e>>2]=0x3f800000,ex(e+4|0,0,(((0|i)>2?i:2)<<2)-4|0),a=g(1)),d=g(g(g(0|r)+g(.800000011920929))*g(g(1)/a)),o=0,a=g(0);;){A=(c=o<<2)+t|0,s=g(R(g(d*(l=m[e+c>>2]))));s:{if(g(S(s))<g(0x80000000)){n=~~s;break s}n=-0x80000000}if(u[A>>2]=n,s=g(0|n),m[c+p>>2]=s+s,f=g(f+g(l*s)),r=r-n|0,a=g(a+g(s*s)),(0|h)==(0|(o=o+1|0)))break}}d:{if((i+3|0)<(0|r)){l=m[p>>2],u[t>>2]=u[t>>2]+r,s=g(0|r),a=g(g(a+g(s*s))+g(l*s));break d}if((0|r)<1)break d;for(A=(0|i)>2?i:2,b=m[e>>2],i=0;;){for(v=g(a+g(1)),a=g(v+m[p>>2]),s=g(f+b),s=g(s*s),n=1,c=0;;){if(l=g(v+m[p+(o=n<<2)>>2]),d=g(f+m[e+o>>2]),d=g(d*d),a=(o=g(a*d)>g(s*l))?l:a,s=o?d:s,c=o?n:c,(0|A)==(0|(n=n+1|0)))break}if(s=m[(n=c<<2)+e>>2],a=m[(o=n+p|0)>>2],m[o>>2]=a+g(2),u[(n=t+n|0)>>2]=u[n>>2]+1,a=g(v+a),f=g(f+s),(0|(i=i+1|0))==(0|r))break}}for(n=0;;){if(c=(o=n<<2)+t|0,o=u[o+_>>2],u[c>>2]=o+(u[c>>2]^0-o),(0|h)==(0|(n=n+1|0)))break}return M=E,a}(e,c,r,t,o),function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,l=0;t:{if((0|r)>0){if((0|t)<=1)break t;for(o=(n=u[((c=t-1|0)<<2)+e>>2])>>31,o^=n+o,s=n>>>31|0;;){if(s=u[u[(((0|(n=t-(d=c-1|0)|0))<(0|o)?n:o)<<2)+36320>>2]+(((0|n)>(0|o)?n:o)<<2)>>2]+s|0,o=((l=(a=u[(d<<2)+e>>2])>>31)^a+l)+o|0,(0|a)<=-1&&(a=o+1|0,s=u[u[(((0|n)>(0|o)?a:n)<<2)+36320>>2]+(((0|n)>(0|a)?n:a)<<2)>>2]+s|0),n=(0|c)>1,c=d,!n)break}o=r+1|0,eW(i,s,u[u[(((n=(0|t)>(0|r))?o:t)<<2)+36320>>2]+(((0|t)>(0|o)?t:o)<<2)>>2]+u[u[(((0|t)<(0|r)?t:r)<<2)+36320>>2]+((n?t:r)<<2)>>2]|0);return}tO(36272,36295,459),k()}tO(36380,36295,444),k()}(c,t,r,o),s){for(a=g(g(g(1)/g(C(h)))*a),o=0;;){if(m[(s=o<<2)+e>>2]=a*g(u[s+c>>2]),(0|(o=o+1|0))==(0|t))break}ei(e,t,-1,n,r,i)}if(i=1,(0|n)>=2)for(e=(0|(d=(t>>>0)/(n>>>0)|0))>1?d:1,i=0,r=0;;){for(t=E(r,d),o=0,s=0;;){if(s=u[(t+o<<2)+c>>2]|s,(0|(o=o+1|0))==(0|e))break}if(i=((0|s)!=0)<<r|i,(0|n)==(0|(r=r+1|0)))break}return M=l,i}tO(41540,41599,338),k()}tO(41609,41599,339),k()}(r,i,s,N,o,O,c,u[t+4>>2],u[t+44>>2]);break t}p=function(e,t,r,i,n,o,a){var s=0,c=0,d=0,l=0;l=s=M;t:{if((0|r)>0){if((0|t)<=1)break t;for(M=c=s-((t<<2)+15&-16)|0,a=g(g(g(1)/g(C(function(e,t,r,i){var n=0,o=0,a=g(0),s=0,c=g(0),d=0,l=0,h=0;n=r+1|0,o=ef(i,u[u[(((o=(0|t)>(0|r))?n:t)<<2)+36320>>2]+(((0|t)>(0|n)?t:n)<<2)>>2]+u[u[(((0|t)<(0|r)?t:r)<<2)+36320>>2]+((o?t:r)<<2)>>2]|0);t:{if((0|r)>0){if((0|t)<2)break t;if((0|t)!=2)for(;;){d=t;o:{if((0|t)<=(0|r)){i=r,l=u[(s=d<<2)+36320>>2],h=o>>>0>=(n=u[(l+(r<<2)|0)+4>>2])>>>0?-1:0,n=o-(n&h)|0;s:{if(n>>>0<A[s+l>>2])for(;;){if(!((o=u[u[((t=t-1|0)<<2)+36320>>2]+s>>2])>>>0>n>>>0))break s}for(;;){if(i=(t=i)-1|0,!((o=u[(t<<2)+l>>2])>>>0>n>>>0))break}}i=((r+h|0)-t^h)<<16>>16,u[e>>2]=i,a=g(0|i),c=g(c+g(a*a)),r=t,o=n-o|0;break o}if(t=u[(n=d<<2)+u[(i=r<<2)+36324>>2]>>2],!(o>>>0<(i=u[u[i+36320>>2]+n>>2])>>>0|t>>>0<=o>>>0)){u[e>>2]=0,o=o-i|0;break o}for(s=t>>>0<=o>>>0?-1:0,i=o-(s&t)|0,t=r;;){if(!((o=u[u[((t=t-1|0)<<2)+36320>>2]+n>>2])>>>0>i>>>0))break}n=((r+s|0)-t^s)<<16>>16,u[e>>2]=n,a=g(0|n),c=g(c+g(a*a)),r=t,o=i-o|0}if(t=d-1|0,e=e+4|0,!((0|d)>3))break}return n=o>>>0>=(t=r<<1|1)>>>0,n=((r=r-n|0)-(t=(o=(i=o-((n=n?-1:0)&t)|0)+1|0)>>>1|0)^n)<<16>>16,u[e>>2]=n,i=i-(t?(-2&o)-1|0:0)|0,t=(t-i^0-i)<<16>>16,u[e+4>>2]=t,a=g(0|n),a=g(c+g(a*a)),c=g(0|t),g(a+g(c*c))}tO(36272,36295,469),k()}tO(41504,36295,470),k()}(c,t,r,o))))*a),o=0;;){if(m[(s=o<<2)+e>>2]=a*g(u[s+c>>2]),(0|(o=o+1|0))==(0|t))break}if(ei(e,t,-1,n,r,i),i=1,(0|n)>=2)for(e=(0|(d=(t>>>0)/(n>>>0)|0))>1?d:1,i=0,r=0;;){for(t=E(r,d),o=0,s=0;;){if(s=u[(t+o<<2)+c>>2]|s,(0|(o=o+1|0))==(0|e))break}if(i=((0|s)!=0)<<r|i,(0|n)==(0|(r=r+1|0)))break}return M=l,i}tO(41673,41599,371),k()}tO(41734,41599,372),k()}(r,i,s,N,o,O,c);break t}if(!u[t+4>>2]){p=0;break t}if(T=(p=-1<<o^-1)&h,u[b+24>>2]=T,!T){p=0,ex(r,0,i<<2);break t}et:{if(a){if((0|i)>=1){for(n=u[t+40>>2],s=0;;){if(p=s<<2,n=E(n,1664525)+0x3c6ef35f|0,m[p+r>>2]=m[a+p>>2]+(32768&n?g(.00390625):g(-.00390625)),(0|(s=s+1|0))==(0|i))break}u[t+40>>2]=n}p=T;break et}if((0|i)<1)break et;for(n=u[t+40>>2],s=0;;){if(n=E(n,1664525)+0x3c6ef35f|0,m[(s<<2)+r>>2]=n>>20,(0|(s=s+1|0))==(0|i))break}u[t+40>>2]=n}(function(e,t,r,i){var n=0,o=g(0),a=g(0);t:if(!((0|t)<1)){for(;;){if(o=g(o+g((a=m[(n<<2)+e>>2])*a)),(0|(n=n+1|0))==(0|t))break}if((0|t)<1)break t;for(o=g(g(g(1)/g(C(g(o+g(10000000036274937e-31)))))*r),n=0;;){if(m[e>>2]=o*m[e>>2],e=e+4|0,(0|(n=n+1|0))==(0|t))break}}})(r,i,c,u[t+44>>2])}return M=b+32|0,p}(e,t,r,i,o,h,a,c,p),!u[e+4>>2])break t;(0|o)>=2&&function(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,l=0;d=o=M,M=o=o-(((c=E(t,r))<<2)+15&-16)|0;t:{if(!i){if((0|r)<1)break t;for(a=(0|t)<1;;){if(!a)for(s=E(t,n),i=0;;){if(u[(E(r,i)+n<<2)+o>>2]=u[(i+s<<2)+e>>2],(0|(i=i+1|0))==(0|t))break}if((0|(n=n+1|0))==(0|r))break}break t}if((0|r)<1)break t;for(l=(r<<2)+41976|0,a=(0|t)<1;;){if(!a)for(s=E(u[(n<<2)+l>>2],t),i=0;;){if(u[(E(r,i)+n<<2)+o>>2]=u[(i+s<<2)+e>>2],(0|(i=i+1|0))==(0|t))break}if((0|(n=n+1|0))==(0|r))break}}ev(e,o,c<<2),M=d}(t,b>>O,o<<O,f);es:{if(!U){v=o;break es}for(w=0;;){if(b<<=1,T=p>>>(v=o>>1)|0,(0|o)>=2)for(_=(0|(h=b>>1))>1?h:1,N=-2&o,h=0;;){if(o=0,(0|b)>=2)for(;;){if(e=f=(E(o,N)+h<<2)+t|0,y=g(m[f>>2]*g(.7071067690849304)),I=g(m[(f=(E(o<<1|1,v)+h<<2)+t|0)>>2]*g(.7071067690849304)),m[e>>2]=y+I,m[f>>2]=y-I,(0|_)==(0|(o=o+1|0)))break}if((0|v)==(0|(h=h+1|0)))break}if(p|=T,o=v,(0|U)==(0|(w=w+1|0)))break}}if(_=0,(0|P)>0)for(;;){if(p=l[p+41936|0],(0|_)!=31)for(N=(0|(o=(T=r>>_)>>1))>1?o:1,w=(b=1<<_)<<1,h=0;;){if(o=0,(0|T)>=2)for(;;){if(e=f=(E(o,w)+h<<2)+t|0,y=g(m[f>>2]*g(.7071067690849304)),I=g(m[(f=(((o<<1|1)<<_)+h<<2)+t|0)>>2]*g(.7071067690849304)),m[e>>2]=y+I,m[f>>2]=y-I,(0|N)==(0|(o=o+1|0)))break}if((0|b)==(0|(h=h+1|0)))break}if((0|O)==(0|(_=_+1|0)))break}if(f=v<<O,!(!s|(0|r)<1))for(y=g(C(+(0|r))),o=0;;){if(m[(h=o<<2)+s>>2]=m[t+h>>2]*y,(0|(o=o+1|0))==(0|r))break}p=(-1<<f^-1)&p}return p}function z(e){var t=0,r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,l=0,h=0,p=0,f=g(0),_=g(0),v=0,S=0,b=0,T=0,y=0,R=0;r=u[e+8>>2],o=(r>>>0)/((t=u[e+12>>2])>>>0)|0,u[e+36>>2]=o,i=E(u[e+16>>2],20),a=u[i+50884>>2],u[e+48>>2]=a,h=u[e+24>>2],n=u[i+50880>>2],u[e+24>>2]=n,u[e+40>>2]=r-E(t,o),b=u[e+28>>2];t:{r:{i:{if(t>>>0<r>>>0){if(m[e+44>>2]=g(m[i+50888>>2]*g(t>>>0))/g(r>>>0),i=(n>>>0)/(t>>>0)|0,o=n-E(i,t)|0,o>>>0>(n=0xffffffff/(r>>>0)|0)>>>0|i>>>0>n>>>0)break r;if(n=E(r,i),n>>>0>(-1^(i=(E(r,o)>>>0)/(t>>>0)|0))>>>0)break r;if(n=(i+n|0)+7&-8,u[e+24>>2]=n,a=a>>>(i=t<<1>>>0<r>>>0)>>>(o=t<<2>>>0<r>>>0)>>>((s=t<<3)>>>0<r>>>0)|0,!(r>>>0<=s>>>0?!(i|o):0)&&(u[e+48>>2]=a),(r=a>>>(i=t<<4>>>0<r>>>0)|0)?!i:0)break i;a=r||1,u[e+48>>2]=a;break i}u[e+44>>2]=u[i+50892>>2]}r=E(t,n),o=E(n,a)+8|0;s:if(!(r>>>0<=o>>>0)||(i=1,!(0x1fffffff/(t>>>0)>>>0>=n>>>0))){if(i=0,r=o,0x1ffffff7/(a>>>0)>>>0<n>>>0)break r}if(A[e+80>>2]<r>>>0){if(!(t=tu(u[e+76>>2],r<<2)))break r;u[e+80>>2]=r,u[e+76>>2]=t}d=e;u:{l:{h:{if(!i){if(t=-4,r=u[e+24>>2],(0|(n=E(r,a=u[e+48>>2])+4|0))>-4)break h;o=u[e+16>>2];break l}if(r=u[e+24>>2],c=u[e+12>>2])for(o=0|-((0|r)/2),f=g(c>>>0),s=0;;){if(r)for(n=E(r,s),_=g(g(s>>>0)/f),i=u[E(u[e+16>>2],20)+50896>>2],a=u[e+76>>2],t=0;;){if(l=(t+n<<2)+a|0,t=t+1|0,m[l>>2]=eQ(m[e+44>>2],g(g(o+t|0)-_),r,i),(0|t)==(0|r))break}if((0|c)==(0|(s=s+1|0)))break}t=u[e+16>>2]>8?5:6;break u}for(_=g(r>>>1>>>0),o=u[e+16>>2],i=u[E(o,20)+50896>>2],f=g(a>>>0),a=u[e+76>>2];;){if(m[((t<<2)+a|0)+16>>2]=eQ(m[e+44>>2],g(g(g(0|t)/f)-_),r,i),(0|n)==(0|(t=t+1|0)))break}}t=(0|o)>8?7:8}if(u[d+84>>2]=t,t=(u[e+32>>2]+r|0)-1|0,t>>>0>(r=u[e+28>>2])>>>0){if(0x1fffffff/((r=u[e+20>>2])>>>0)>>>0<t>>>0||!(r=tu(u[e+72>>2],E(t,r)<<2)))break r;u[e+28>>2]=t,u[e+72>>2]=r,r=t}if(!u[e+56>>2]){if(!(t=E(u[e+20>>2],r)))return 0;return ex(u[e+72>>2],0,t<<2),0}if(h>>>0<(r=u[e+24>>2])>>>0){if(!(c=u[e+20>>2]))return 0;for(T=h-1|0,y=(c<<2)-4|0,R=u[e+68>>2];;){if(s=p<<2,d=(n=u[(o=(v=(c=c-1|0)<<2)+R|0)>>2])<<1,t=n+T|0)for(i=E(c,b),a=E(u[e+28>>2],c),r=u[e+72>>2];;){if(u[((n+(t=t-1|0)|0)+a<<2)+r>>2]=u[(t+i<<2)+r>>2],!t)break}S=y-s|0,d=d+h|0,n&&ex(u[e+72>>2]+E(u[e+28>>2],S)|0,0,n<<2),u[o>>2]=0,l=u[e+24>>2];ea:{if(l>>>0>d>>>0){if(a=d-1|0)for(o=l-2|0,s=d-2|0,n=E(u[e+28>>2],c),i=u[e+72>>2],t=0,r=0;;){if(u[((t+o|0)+n<<2)+i>>2]=u[((t+s|0)+n<<2)+i>>2],t=-1^r,(0|a)==(0|(r=r+1|0)))break}a>>>0<(t=l-1|0)>>>0&&ex(u[e+72>>2]+E(u[e+28>>2],S)|0,0,t-a<<2),t=u[e+60>>2]+v|0,u[t>>2]=u[t>>2]+(l-d>>>1|0);break ea}if(i=d-l>>>1|0,u[o>>2]=i,(0|(t=i-1|0))==(0-(r=u[e+24>>2])|0))break ea;for(a=(t=t+r|0)>>>0>1?t:1,o=E(u[e+28>>2],c),r=u[e+72>>2],t=0;;){if(u[((n=t+o|0)<<2)+r>>2]=u[(i+n<<2)+r>>2],(0|a)==(0|(t=t+1|0)))break}}if(p=p+1|0,!c)break}return 0}if(t=0,!u[e+20>>2]|r>>>0>=h>>>0)break t;for(p=u[e+68>>2],s=0;;){if(t=u[(c=(s<<2)+p|0)>>2],i=h-r>>>1|0,u[c>>2]=i,t=(d=t+i|0)-1|0,(0|t)!=(0-(r=u[e+24>>2])|0))for(a=(t=t+r|0)>>>0>1?t:1,o=E(u[e+28>>2],s),r=u[e+72>>2],t=0;;){if(u[((n=t+o|0)<<2)+r>>2]=u[(i+n<<2)+r>>2],(0|a)==(0|(t=t+1|0)))break}if(u[c>>2]=d,(s=s+1|0)>>>0>=A[e+20>>2])return 0;r=u[e+24>>2]}}u[e+24>>2]=h,u[e+84>>2]=9,t=1}return t}function X(e){e|=0;var t=0,r=0,i=0,n=0,o=0,a=0,s=0;t:{r:if(e){o=(i=e-8|0)+(e=-8&(t=u[e-4>>2]))|0;i:if(!(1&t)){if(!(3&t))break r;if(t=u[i>>2],(i=i-t|0)>>>0<(n=u[13236])>>>0)break r;if(e=e+t|0,u[13237]!=(0|i)){if(t>>>0<=255){if(t=((s=t>>>3|0)<<3)+52968|0,a=u[i+8>>2],(0|a)==(0|(r=u[i+12>>2]))){u[13232]=u[13232]&tD(-2,s);break i}u[a+12>>2]=r,u[r+8>>2]=a;break i}s=u[i+24>>2],r=u[i+12>>2];s:{if((0|r)!=(0|i)){t=u[i+8>>2],u[t+12>>2]=r,u[r+8>>2]=t;break s}u:if(!(n=u[(t=i+20|0)>>2])&&!(n=u[(t=i+16|0)>>2])){r=0;break s}for(;;){if(a=t,n=u[(t=(r=n)+20|0)>>2])continue;if(t=r+16|0,!(n=u[r+16>>2]))break}u[a>>2]=0}if(!s)break i;t=((n=u[i+28>>2])<<2)+53232|0;h:{if(u[t>>2]==(0|i)){if(u[t>>2]=r,r)break h;u[13233]=u[13233]&tD(-2,n);break i}if(u[(u[s+16>>2]==(0|i)?16:20)+s>>2]=r,!r)break i}if(u[r+24>>2]=s,(t=u[i+16>>2])&&(u[r+16>>2]=t,u[t+24>>2]=r),!(t=u[i+20>>2]))break i;u[r+20>>2]=t,u[t+24>>2]=r;break i}if((3&(t=u[o+4>>2]))!=3)break i;u[13234]=e,u[o+4>>2]=-2&t;break t}if(i>>>0>=o>>>0||!(1&(t=u[o+4>>2])))break r;p:{if(!(2&t)){if(u[13238]==(0|o)){if(u[13238]=i,e=u[13235]+e|0,u[13235]=e,u[i+4>>2]=1|e,u[13237]!=(0|i))break r;u[13234]=0,u[13237]=0;return}if(u[13237]==(0|o)){u[13237]=i,e=u[13234]+e|0,u[13234]=e;break t}e=(-8&t)+e|0;et:{if(t>>>0<=255){if(n=u[o+12>>2],r=u[o+8>>2],o=t>>>3|0,(0|r)==(0|n)){u[13232]=u[13232]&tD(-2,o);break et}u[r+12>>2]=n,u[n+8>>2]=r;break et}s=u[o+24>>2],r=u[o+12>>2];A:{if((0|o)!=(0|r)){t=u[o+8>>2],u[t+12>>2]=r,u[r+8>>2]=t;break A}eN:if(!(n=u[(t=o+20|0)>>2])&&!(n=u[(t=o+16|0)>>2])){r=0;break A}for(;;){if(a=t,n=u[(t=(r=n)+20|0)>>2])continue;if(t=r+16|0,!(n=u[r+16>>2]))break}u[a>>2]=0}if(!s)break et;t=((n=u[o+28>>2])<<2)+53232|0;eL:{if(u[t>>2]==(0|o)){if(u[t>>2]=r,r)break eL;u[13233]=u[13233]&tD(-2,n);break et}if(u[(u[s+16>>2]==(0|o)?16:20)+s>>2]=r,!r)break et}if(u[r+24>>2]=s,(t=u[o+16>>2])&&(u[r+16>>2]=t,u[t+24>>2]=r),!(t=u[o+20>>2]))break et;u[r+20>>2]=t,u[t+24>>2]=r}if(u[i+4>>2]=1|e,u[e+i>>2]=e,u[13237]!=(0|i))break p;u[13234]=e;return}u[o+4>>2]=-2&t,u[i+4>>2]=1|e,u[e+i>>2]=e}if(e>>>0<=255){e=((t=e>>>3|0)<<3)+52968|0,t=1<<t,n=u[13232];E:{if(!(t&n)){u[13232]=t|n,t=e;break E}t=u[e+8>>2]}u[e+8>>2]=i,u[t+12>>2]=i,u[i+12>>2]=e,u[i+8>>2]=t;return}t=31,u[i+16>>2]=0,u[i+20>>2]=0,e>>>0<=0xffffff&&(r=t=e>>>8|0,r=n=r<<(t=t+1048320>>>16&8),r<<=n=n+520192>>>16&4,t=((t=((a=r)<<(r=r+245760>>>16&2)>>>15|0)-(t|n|r)|0)<<1|e>>>t+21&1)+28|0),u[i+28>>2]=t,n=(t<<2)+53232|0;g:{eT:{r=u[13233],o=1<<t;ey:{if(!(r&o)){u[13233]=r|o,u[n>>2]=i;break ey}for(t=e<<((0|t)==31?0:25-(t>>>1|0)|0),r=u[n>>2];;){if(n=r,(-8&u[r+4>>2])==(0|e))break eT;if(r=t>>>29|0,t<<=1,!(r=u[(o=(a=(4&r)+n|0)+16|0)>>2]))break}u[a+16>>2]=i}u[i+24>>2]=n,u[i+12>>2]=i,u[i+8>>2]=i;break g}e=u[n+8>>2],u[e+12>>2]=i,u[n+8>>2]=i,u[i+24>>2]=0,u[i+12>>2]=n,u[i+8>>2]=e}i=u[13240]-1|0,u[13240]=i||-1}return}u[i+4>>2]=1|e,u[e+i>>2]=e}function J(e,t){var r=0,i=0,n=0,o=0,a=0,s=0;o=e+t|0;t:{r:if(!(1&(r=u[e+4>>2]))){if(!(3&r))break t;if(t=(r=u[e>>2])+t|0,(0|(e=e-r|0))!=u[13237]){if(r>>>0<=255){if(r=((a=r>>>3|0)<<3)+52968|0,i=u[e+8>>2],(0|(n=u[e+12>>2]))==(0|i)){u[13232]=u[13232]&tD(-2,a);break r}u[i+12>>2]=n,u[n+8>>2]=i;break r}a=u[e+24>>2],i=u[e+12>>2];a:{if((0|i)!=(0|e)){r=u[e+8>>2],u[r+12>>2]=i,u[i+8>>2]=r;break a}d:if(!(n=u[(r=e+20|0)>>2])&&!(n=u[(r=e+16|0)>>2])){i=0;break a}for(;;){if(s=r,n=u[(r=(i=n)+20|0)>>2])continue;if(r=i+16|0,!(n=u[i+16>>2]))break}u[s>>2]=0}if(!a)break r;r=((n=u[e+28>>2])<<2)+53232|0;l:{if(u[r>>2]==(0|e)){if(u[r>>2]=i,i)break l;u[13233]=u[13233]&tD(-2,n);break r}if(u[(u[a+16>>2]==(0|e)?16:20)+a>>2]=i,!i)break r}if(u[i+24>>2]=a,(r=u[e+16>>2])&&(u[i+16>>2]=r,u[r+24>>2]=i),!(r=u[e+20>>2]))break r;u[i+20>>2]=r,u[r+24>>2]=i;break r}if((3&(r=u[o+4>>2]))!=3)break r;u[13234]=t,u[o+4>>2]=-2&r,u[e+4>>2]=1|t,u[o>>2]=t;return}r=u[o+4>>2];Z:{if(!(2&r)){if(u[13238]==(0|o)){if(u[13238]=e,t=u[13235]+t|0,u[13235]=t,u[e+4>>2]=1|t,u[13237]!=(0|e))break t;u[13234]=0,u[13237]=0;return}if(u[13237]==(0|o)){u[13237]=e,t=u[13234]+t|0,u[13234]=t,u[e+4>>2]=1|t,u[e+t>>2]=t;return}t=(-8&r)+t|0;f:{if(r>>>0<=255){if(n=u[o+12>>2],i=u[o+8>>2],o=r>>>3|0,(0|i)==(0|n)){u[13232]=u[13232]&tD(-2,o);break f}u[i+12>>2]=n,u[n+8>>2]=i;break f}a=u[o+24>>2],i=u[o+12>>2];_:{if((0|o)!=(0|i)){r=u[o+8>>2],u[r+12>>2]=i,u[i+8>>2]=r;break _}A:if(!(r=u[(n=o+20|0)>>2])&&!(r=u[(n=o+16|0)>>2])){i=0;break _}for(;;){if(s=n,i=r,r=u[(n=r+20|0)>>2])continue;if(n=i+16|0,!(r=u[i+16>>2]))break}u[s>>2]=0}if(!a)break f;r=((n=u[o+28>>2])<<2)+53232|0;eb:{if(u[r>>2]==(0|o)){if(u[r>>2]=i,i)break eb;u[13233]=u[13233]&tD(-2,n);break f}if(u[(u[a+16>>2]==(0|o)?16:20)+a>>2]=i,!i)break f}if(u[i+24>>2]=a,(r=u[o+16>>2])&&(u[i+16>>2]=r,u[r+24>>2]=i),!(r=u[o+20>>2]))break f;u[i+20>>2]=r,u[r+24>>2]=i}if(u[e+4>>2]=1|t,u[e+t>>2]=t,u[13237]!=(0|e))break Z;u[13234]=t;return}u[o+4>>2]=-2&r,u[e+4>>2]=1|t,u[e+t>>2]=t}if(t>>>0<=255){t=((r=t>>>3|0)<<3)+52968|0,r=1<<r,n=u[13232];eD:{if(!(r&n)){u[13232]=r|n,r=t;break eD}r=u[t+8>>2]}u[t+8>>2]=e,u[r+12>>2]=e,u[e+12>>2]=t,u[e+8>>2]=r;return}r=31,u[e+16>>2]=0,u[e+20>>2]=0,t>>>0<=0xffffff&&(i=r=t>>>8|0,i=n=i<<(r=r+1048320>>>16&8),i<<=n=n+520192>>>16&4,r=((r=((s=i)<<(i=i+245760>>>16&2)>>>15|0)-(r|n|i)|0)<<1|t>>>r+21&1)+28|0),u[e+28>>2]=r,n=(r<<2)+53232|0;E:{i=u[13233],o=1<<r;eM:{if(!(i&o)){u[13233]=i|o,u[n>>2]=e;break eM}for(r=t<<((0|r)==31?0:25-(r>>>1|0)|0),i=u[n>>2];;){if(n=i,(-8&u[i+4>>2])==(0|t))break E;if(i=r>>>29|0,r<<=1,!(i=u[(o=(s=(4&i)+n|0)+16|0)>>2]))break}u[s+16>>2]=e}u[e+24>>2]=n,u[e+12>>2]=e,u[e+8>>2]=e;return}t=u[n+8>>2],u[t+12>>2]=e,u[n+8>>2]=e,u[e+24>>2]=0,u[e+12>>2]=n,u[e+8>>2]=t}}function q(e,t,r,i,n,o){var a=0,s=0,c=0,d=0,u=0,l=0,h=0,p=0,f=0,_=0,A=0,S=0,b=0,T=0,y=0,R=0,I=0,w=0,O=0,N=0,P=g(0),D=g(0),L=g(0),x=0;if(M=s=M-992|0,(0|(a=E(i,n)))<385){if(T=tn(t,a),ex(s+800|0,0,192),(0|n)>=1)for(;;){if(a=1,(0|o)>=1)for(d=(E(i,f)<<2)+t|0;;){if(v[(l=(p=(a<<3)+s|0)+792|0)>>3]=e7(d,(a<<2)+d|0,i-a|0)+v[p+792>>3],l=(0|o)!=(0|a),a=a+1|0,!l)break}if((0|(f=f+1|0))==(0|n))break}ev(s+608|0,s+800|0,192),O=9999999747378752e-21*T,u=T+O+9999999717180685e-25,v[s+192>>3]=u,v[s+400>>3]=u;a:{s:{if((0|o)<1){h=1;break s}for(N=+r,l=0,R=2,y=1,I=1;;){if((0|n)>=1)for(b=(S=i-l|0)-1|0,A=0;;){if(c=+(P=m[(d=(E(i,A)<<2)+t|0)+(b<<2)>>2]),u=+(D=m[(l<<2)+d>>2]),a=0,l)for(;;){if(p=(f=a<<3)+(s+800|0)|0,r=m[((-1^a)+l<<2)+d>>2],v[p>>3]=v[p>>3]-+g(D*r),p=(s+608|0)+f|0,L=m[(a+S<<2)+d>>2],v[p>>3]=v[p>>3]-+g(P*L),u+=(h=v[s+f>>3])*+r,c+=h*+L,(0|l)==(0|(a=a+1|0)))break}for(a=0;;){if(v[(p=(f=a<<3)+(s+400|0)|0)>>3]=v[p>>3]-u*+m[(l-a<<2)+d>>2],v[(f=(s+192|0)+f|0)>>3]=v[f>>3]-c*+m[(a+b<<2)+d>>2],(0|y)==(0|(a=a+1|0)))break}if((0|(A=A+1|0))==(0|n))break}if(u=v[(b=l<<3)+(s+608|0)>>3],c=v[(s+800|0)+b>>3],a=0,l)for(;;){if(h=v[(a<<3)+s>>3],u+=h*v[(d=(-1^a)+l<<3)+(s+800|0)>>3],c+=h*v[(s+608|0)+d>>3],(0|l)==(0|(a=a+1|0)))break}if(v[(a=(p=l+1|0)<<3)+(s+400|0)>>3]=c,v[(S=(s+192|0)+a|0)>>3]=u,a=0,h=v[s+192>>3],_=w=v[s+400>>3],l)for(;;){if(c=v[(a<<3)+s>>3],_+=c*v[(f=(d=a+1|0)<<3)+(s+400|0)>>3],h+=c*v[(s+192|0)+f>>3],u+=c*v[(s+192|0)+(l-a<<3)>>3],(0|l)==(0|(a=d)))break}if(A=1,!(N>=(_=I*(1-(c=-2*u/(_+h))*c))^1)&&(A=0,c=C(1-(_=N)/I),c=u>0?-c:c),0x7ffffffe&p)for(f=y>>>1|0,a=0;;){if(x=d=(a<<3)+s|0,u=v[d>>3],h=v[(d=((-1^a)+l<<3)+s|0)>>3],v[x>>3]=u+c*h,v[d>>3]=h+c*u,(0|f)==(0|(a=a+1|0)))break}v[s+b>>3]=c;en:{if(A){for(u=v[S>>3],v[S>>3]=u+c*w,v[s+400>>3]=w+c*u,a=1;;){if(l=d=(s+192|0)+(p-a<<3)|0,u=v[d>>3],h=v[(d=(s+400|0)+(a<<3)|0)>>3],v[l>>3]=u+c*h,v[d>>3]=h+c*u,(0|R)==(0|(a=a+1|0)))break}break en}for((0|o)>(0|p)&&ex((p<<3)+s|0,0,o-p<<3),a=0;;){if(m[(a<<2)+e>>2]=-g(v[(a<<3)+s>>3]),(0|(a=a+1|0))==(0|o))break}if(a=0,(0|n)>0)for(;;){if(T-=tn((E(i,a)<<2)+t|0,o),(0|(a=a+1|0))==(0|n))break}c=_*T;break a}if(R=R+1|0,y=y+1|0,I=_,(0|(l=p))==(0|o))break}if(h=1,u=v[s+400>>3],(0|o)<1)break s;for(a=0;;){if(_=v[(s+400|0)+((d=a+1|0)<<3)>>3],c=v[(a<<3)+s>>3],m[(a<<2)+e>>2]=-g(c),u+=c*_,h+=c*c,(0|(a=d))==(0|o))break}}c=u-O*h}return M=s+992|0,g(c)}tO(16463,16523,55),k()}function Z(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0,b=0,T=0,y=0,R=0;switch(M=a=M-320|0,r-10|0){default:tO(15418,15451,89),k();case 0:case 6:break}for(_=(0|r)==16?15392:15408;;){if(s=(c=d[(o<<1)+t>>1])>>8<<1,i=d[s+15122>>1],s=d[s+15120>>1],u[(a+224|0)+(l[o+_|0]<<2)>>2]=(E(i-s|0,255&c)+(s<<8)>>3)+1>>1,(0|(o=o+1|0))==(0|r))break}s=65536,u[a+160>>2]=65536,t=0-u[a+224>>2]|0,u[a+164>>2]=t,o=1,T=r>>1;n:if(!(y=(0|r)<4)){for(;;){n=(i=S=u[(a+224|0)+(o<<3)>>2])>>31,m=i,v=n,i=n=(i=t)>>31,b=(a+160|0)+((A=o+1|0)<<2)|0,h=i=tM(m,n=v,t,i),i=(n=x)>>>15|0,f=(p=(n=(32767&n)<<17|h>>>15)+1|0)>>>0<1?i+1|0:i,i=p,u[b>>2]=(s<<1)-((1&f)<<31|i>>>1),g=(c=o<<2)+(a+160|0)|0;a:if(!(o>>>0<2)){if(t=(c=u[(a+c|0)+152>>2])+t|0,n=(i=s)>>31,f=i=tM(s,n,m,i=v),i=(n=x)>>>15|0,p=(h=(n=(32767&n)<<17|f>>>15)+1|0)>>>0<1?i+1|0:i,i=h,u[g>>2]=t-((1&p)<<31|i>>>1),(0|o)==2)break a;for(;;){if(t=(a+160|0)+((s=o-1|0)<<2)|0,R=(_=u[((o<<2)+a|0)+148>>2])+u[t>>2]|0,n=(i=c)>>31,p=i=tM(c,n,m,i=v),i=(n=x)>>>15|0,h=(f=(n=(32767&n)<<17|p>>>15)+1|0)>>>0<1?i+1|0:i,i=f,u[t>>2]=R-((1&h)<<31|i>>>1),t=(0|o)>3,o=s,c=_,!t)break}}if(u[a+164>>2]=u[a+164>>2]-S,(0|A)==(0|T))break n;t=u[b>>2],s=u[g>>2],o=A}}s=65536,u[a+96>>2]=65536,t=0-u[a+228>>2]|0,u[a+100>>2]=t;c:if(!y){for(y=a+224|4,o=1;;){n=(i=S=u[(o<<3)+y>>2])>>31,m=i,v=n,i=n=(i=t)>>31,b=(a+96|0)+((A=o+1|0)<<2)|0,h=i=tM(m,n=v,t,i),i=(n=x)>>>15|0,f=(p=(n=(32767&n)<<17|h>>>15)+1|0)>>>0<1?i+1|0:i,i=p,u[b>>2]=(s<<1)-((1&f)<<31|i>>>1),g=(c=o<<2)+(a+96|0)|0;u:if(!(o>>>0<2)){if(t=(c=u[(a+c|0)+88>>2])+t|0,n=(i=s)>>31,f=i=tM(s,n,m,i=v),i=(n=x)>>>15|0,p=(h=(n=(32767&n)<<17|f>>>15)+1|0)>>>0<1?i+1|0:i,i=h,u[g>>2]=t-((1&p)<<31|i>>>1),(0|o)==2)break u;for(;;){if(t=(a+96|0)+((s=o-1|0)<<2)|0,R=(_=u[((o<<2)+a|0)+84>>2])+u[t>>2]|0,n=(i=c)>>31,p=i=tM(c,n,m,i=v),i=(n=x)>>>15|0,h=(f=(n=(32767&n)<<17|p>>>15)+1|0)>>>0<1?i+1|0:i,i=f,u[t>>2]=R-((1&h)<<31|i>>>1),t=(0|o)>3,o=s,c=_,!t)break}}if(u[a+100>>2]=u[a+100>>2]-S,(0|A)==(0|T))break c;t=u[b>>2],s=u[g>>2],o=A}}if((0|r)>=2)for(g=(0|T)>1?T:1,s=u[a+96>>2],t=u[a+160>>2],o=0;;){if(s=(A=u[(_=(c=o+1|0)<<2)+(a+96|0)>>2])-s|0,t=(_=u[(a+160|0)+_>>2])+t|0,u[(o<<2)+a>>2]=0-(s+t|0),u[((-1^o)+r<<2)+a>>2]=s-t,s=A,t=_,(0|g)==(0|(o=c)))break}(function(e,t,r,i,n){var o=0,a=0,s=0,c=0,l=0,h=0,p=0;h=(s=i-r|0)-1|0,p=(0|n)<1;t:{r:{for(;;){if(i=0,r=0,!p)for(;;){if(c=a=u[(i<<2)+t>>2],a>>=31,a^=a+c,c=a,r=(a=(0|r)<(0|a))?c:r,o=a?i:o,(0|n)==(0|(i=i+1|0)))break}if((0|(i=(0|s)==1?(1&r)+(r>>1)|0:(r>>h)+1>>1))>=32768){if(te(t,n,65470-((((i=(0|i)<163838?i:163838)<<14)-0x1fffc000|0)/(E(o+1|0,i)>>2)|0)|0),(0|(l=l+1|0))!=10)continue;break r}break}if((0|l)==10)break r;if(i=0,(0|n)<=0)break t;for(o=(0|s)!=1;;){if(r=u[(i<<2)+t>>2],r=o?(r>>h)+1>>1:(1&r)+(r>>1)|0,d[(i<<1)+e>>1]=r,(0|n)==(0|(i=i+1|0)))break}break t}if((0|n)<1)break t;for(i=0,l=(0|s)!=1;;){o=u[(a=(i<<2)+t|0)>>2],c=(i<<1)+e|0;q:{if(!l){if(r=32767,(0|(o=(1&o)+(o>>1)|0))>32767)break q;r=(0|o)>-32768?o:-32768;break q}if(r=32767,(0|(o>>=h))>65534)break q;r=(0|(r=o+1>>1))>-32768?r:-32768}if(d[c>>1]=r,u[a>>2]=r<<16>>16<<s,(0|n)==(0|(i=i+1|0)))break}}})(e,a,12,17,r);Z:if(!et(e,r)){for(c=0;;){for(te(a,r,(-2<<c)+65536|0),o=0;;){if(d[(o<<1)+e>>1]=(u[(o<<2)+a>>2]>>>4|0)+1>>>1,(0|(o=o+1|0))==(0|r))break}if(o=et(e,r),c>>>0>14)break Z;if(c=c+1|0,!!o)break}}M=a+320|0}function $(e,t,r,i,n,o){var s,c,d,l,h,_,A,v,E,S,b,T,y=g(0),R=0,I=g(0),C=0,w=0,O=0,N=g(0),P=0,D=0,L=0,M=g(0),x=0,U=g(0),B=0,V=g(0),F=g(0),j=g(0),G=g(0),W=g(0),H=g(0),Y=g(0),K=g(0),Q=g(0),z=0,X=0,J=g(0),q=0,Z=0,$=0;if((0|n)>=1){r:if(!((0|n)<4)){if((0|i)>=3){for(q=n-3|0,B=i-3|0,Z=(0|i)==3,$=((X=1|(z=-4&i))+1|0)>=(0|i);;){;if(R=(o=(x=O<<2)+t|0)+12|0,I=m[o+8>>2],U=m[o+4>>2],M=m[o>>2],N=g(0),H=g(0),Y=g(0),K=g(0),o=e,w=0,C=0,P=0,D=0,L=0,!Z){for(;;){if(V=m[o>>2],y=m[R>>2],F=m[o+4>>2],j=m[R+4>>2],G=m[o+8>>2],Q=m[R+8>>2],W=m[o+12>>2],J=m[R+12>>2],N=g(g(g(g(N+g(V*y))+g(F*j))+g(G*Q))+g(W*J)),H=g(g(g(g(H+g(I*V))+g(y*F))+g(j*G))+g(Q*W)),Y=g(g(g(g(Y+g(U*V))+g(I*F))+g(y*G))+g(j*W)),K=g(g(g(g(K+g(M*V))+g(U*F))+g(I*G))+g(y*W)),R=R+16|0,o=o+16|0,M=j,I=J,U=Q,!((0|B)>(0|(w=w+4|0))))break}p(Y),P=a[2],p(H),D=a[2],p(N),L=a[2],N=y,p(K),C=a[2]}s:{;if((0|i)<=(0|z))break s;y=m[o>>2],p(g(g(y*(N=m[R>>2]))+(s=L,a[2]=s,f()))),L=a[2],p(g(g(I*y)+(c=D,a[2]=c,f()))),D=a[2],p(g(g(U*y)+(d=P,a[2]=d,f()))),P=a[2],p(g(g(M*y)+(l=C,a[2]=l,f()))),C=a[2],R=R+4|0,o=o+4|0}w=R;d:{;if((0|i)<=(0|X)){R=w;break d}y=m[o>>2],p(g(g(y*(M=m[w>>2]))+(h=L,a[2]=h,f()))),L=a[2],p(g(g(N*y)+(_=D,a[2]=_,f()))),D=a[2],p(g(g(I*y)+(A=P,a[2]=A,f()))),P=a[2],p(g(g(U*y)+(v=C,a[2]=v,f()))),C=a[2],o=o+4|0,R=w+4|0}if(!$){;p(g(g((y=m[o>>2])*m[R>>2])+(E=L,a[2]=E,f()))),L=a[2],p(g(g(M*y)+(S=D,a[2]=S,f()))),D=a[2],p(g(g(N*y)+(b=P,a[2]=b,f()))),P=a[2],p(g(g(I*y)+(T=C,a[2]=T,f()))),C=a[2]}if(u[r+x>>2]=C,u[(4|x)+r>>2]=P,u[(8|x)+r>>2]=D,u[(12|x)+r>>2]=L,!((0|q)>(0|(O=O+4|0))))break}break r}tO(9872,9897,69),k()}if((0|n)>(0|O))for(C=(0|i)<1;;){if(B=O<<2,I=g(0),!C)for(w=t+B|0,R=0;;){if(I=g(I+g(m[(o=R<<2)+e>>2]*m[o+w>>2])),(0|(R=R+1|0))==(0|i))break}if(m[r+B>>2]=I,(0|(O=O+1|0))==(0|n))break}return}tO(9738,9768,251),k()}function ee(e,t,r,i,n,o,a,s,c,d,l){var h=g(0),p=0,f=0,_=0,A=g(0),v=0,E=0,S=g(0),b=g(0),T=0,y=0,R=0,I=g(0);M=p=M-32|0,u[p+24>>2]=l,u[p+28>>2]=n,n=u[e+28>>2],v=u[e>>2];t:{if((0|i)==1){if(i=0,(0|(l=u[e+32>>2]))>=8){n:{if(v){e4(n,i=m[t>>2]<g(0),1);break n}i=tr(n,1)}l=u[e+32>>2]-8|0,u[e+32>>2]=l}if(u[e+4>>2]&&(m[t>>2]=i?g(-1):g(1)),r)for(s=(i=r?2:1)>>>0>1?i:1,o=1;;){if(i=0,(0|l)>=8){u:{if(v){e4(n,i=m[r>>2]<g(0),1);break u}i=tr(n,1)}l=u[e+32>>2]-8|0,u[e+32>>2]=l}if(u[e+4>>2]&&(m[r>>2]=i?g(-1):g(1)),(0|s)==(0|(o=o+1|0)))break}if(s=1,!c)break t;u[c>>2]=u[t>>2];break t}W(e,p,t,r,i,p+28|0,o,o,s,1,p+24|0),h=g(g(u[p+8>>2])*g(30517578125e-15)),b=g(g(u[p+4>>2])*g(30517578125e-15)),_=u[p+28>>2],E=u[p+20>>2],f=u[p+16>>2],R=u[p>>2];q:{if((0|i)==2){T=((0|(y=-16385&f))!=0)<<3,u[e+32>>2]=u[e+32>>2]-(T+E|0),E=(f=(0|f)>8192)?t:r,f=f?r:t,T=_-T|0,_=0;p:if(y){if(v){e4(n,_=g(g(m[f>>2]*m[E+4>>2])-g(m[f+4>>2]*m[E>>2]))<g(0),1);break p}_=tr(n,1)}if(s=Q(e,f,2,T,o,a,s,c,g(1),d,l),o=1-(_<<1)|0,m[E>>2]=m[f+4>>2]*g(0-o|0),m[E+4>>2]=m[f>>2]*g(0|o),!u[e+4>>2])break q;m[t>>2]=b*m[t>>2],m[t+4>>2]=b*m[t+4>>2],A=g(h*m[r>>2]),m[r>>2]=A,m[r+4>>2]=h*m[r+4>>2],h=m[t>>2],m[t>>2]=h-A,m[r>>2]=h+m[r>>2],h=m[t+4>>2],m[t+4>>2]=h-m[r+4>>2],m[r+4>>2]=h+m[r+4>>2];break q}if(l=u[p+12>>2],E=u[e+32>>2]-E|0,u[e+32>>2]=E,n=u[p+24>>2],l=(0|(l=(0|(l=(_-l|0)/2|0))>(0|_)?_:l))>0?l:0,v=_-l|0,(0|l)>=(0|v)){a=Q(e,t,i,l,o,a,s,c,g(1),d,n),l=(u[e+32>>2]-E|0)+l|0,s=a|Q(e,r,i,(f&&(0|l)>24?l-24|0:0)+v|0,o,0,s,0,h,0,n>>o);break q}_=Q(e,r,i,v,o,0,s,0,h,0,n>>o),v=(u[e+32>>2]-E|0)+v|0,s=_|Q(e,t,i,((0|f)!=16384&&(0|v)>24?v-24|0:0)+l|0,o,a,s,c,g(1),d,n)}if(!u[e+4>>2])break t;f:if((0|i)!=2){if(A=g(0),(0|i)>=1)for(e=0;;){if(S=g(S+g((h=m[(o=e<<2)+r>>2])*m[t+o>>2])),A=g(A+g(h*h)),(0|i)==(0|(e=e+1|0)))break}en:if(A=g(g(b*b)+A),h=g(b*S),h=g(h+h),!(!((S=g(A+h))<g(6000000284984708e-19))&&(h=g(A-h))<g(6000000284984708e-19)^1)){ev(r,t,i<<2);break f}if((0|i)<1)break t;for(S=g(g(1)/g(C(S))),I=g(g(1)/g(C(h))),e=0;;){if(h=g(b*m[(l=(o=e<<2)+t|0)>>2]),A=m[(o=r+o|0)>>2],m[l>>2]=I*g(h-A),m[o>>2]=S*g(h+A),(0|i)==(0|(e=e+1|0)))break}}if(!R|(0|i)<1)break t;for(e=0;;){if(m[(o=(e<<2)+r|0)>>2]=-m[o>>2],(0|i)==(0|(e=e+1|0)))break}}return M=p+32|0,s}function et(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0,T=0,y=0,R=0,I=0,C=0,k=0;_=M-96|0;t:{if((0|t)>=1){for(;;){if(c=d[(a<<1)+e>>1],u[(a<<2)+_>>2]=c<<12,h=c+h|0,(0|(a=a+1|0))==(0|t))break}if((0|h)>4095)break t}if(a=(c=u[((h=t-1|0)<<2)+_>>2])+0xffef9e>>>0>0x1ffdf3c,l=0x40000000,(0|t)>=2)for(;;){if(1&a)return 0;if(i=(s=0-(c<<7)|0)>>31,f=s,g=i,s=tM(f,i,f,i),r=s=(r=a=0x40000000-(i=x)|0)>>31,i=r=tM(l,s=p,a,r),(0|(S=((0x3fffffff&(s=x))<<2|i>>>30)&-4))<107374)break t;for(m=h,h=0,v=b((c=a>>31)^a+c),i=((a=0x1fffffff/(0|(e=(c=a<<v-1)>>16))|0)>>15)+1>>1,c=0-((E(a=(A=a<<16)>>16,65535&c)>>16)+E(e,a)<<3)|0,r=(i=((E(c,i)+A|0)+E(c>>16,a)|0)+(E(65528&c,a)>>16)|0)>>31,T=i,y=r,C=(a=t>>>1|0)>>>0>1?a:1,R=31-v|0;;){a=u[(A=(h<<2)+_|0)>>2],r=(i=c=u[(I=((-1^h)+m<<2)+_|0)>>2])>>31,s=i=tM(c,r,f,i=g),i=(r=x)>>>30|0,t=(n=(r=(0x3fffffff&r)<<2|s>>>30)+1|0)>>>0<1?i+1|0:i,i=e=a-(t=(1&t)<<31|(i=n)>>>1)|0,r=(i=((((e=(0|e)>-1)?t:a)^-0x80000000)&(e?a:t))>-1?i:e?-0x80000000:0x7fffffff)>>31,l=i=tM(e=i,r,T,i=y),p=r=x,t=i,s=1&i,n=i=0,o=(1&(i=r))<<31|(r=t)>>>1,e=(0|v)!=31,r=t=i>>1,n=r+(t=n)|0,n=(s=(i=s)+o|0)>>>0<o>>>0?n+1|0:n,t=s;c:if(e){n=p,t=l,r=31&(o=R),(63&o)>>>0>=32?(i=n>>31,n>>=r):(i=n>>r,n=((1<<r)-1&n)<<32-r|t>>>r),s=(r=n+1|0)>>>0<1?i+1|0:i,t=(1&s)<<31|(i=r)>>>1,n=s>>1}if(r=n,r=(t=(s=l=t)- -0x80000000|0)>>>0<0x80000000?r+1|0:r)break t;if(u[A>>2]=l,n=(r=a)>>31,o=r=tM(a,n,f,r=g),r=(n=x)>>>30|0,t=(i=(n=(0x3fffffff&n)<<2|o>>>30)+1|0)>>>0<1?r+1|0:r,i=t=c-(a=(1&t)<<31|(r=i)>>>1)|0,n=(r=((((t=(0|t)>-1)?a:c)^-0x80000000)&(t?c:a))>-1?i:t?-0x80000000:0x7fffffff)>>31,l=r=tM(t=r,n,T,r=y),p=n=x,e?(n=p,t=l,o=31&(s=R),(63&s)>>>0>=32?(r=n>>31,n>>=o):(r=n>>o,n=((1<<o)-1&n)<<32-o|t>>>o),i=(o=n+1|0)>>>0<1?r+1|0:r,l=(1&i)<<31|(r=o)>>>1,o=n=i>>1):(t=1&(i=l),e=r=0,s=(1&(r=n=p))<<31|i>>>1,n=i=r>>1,o=(i=e)+n|0,l=t=s+(r=t)|0,o=t>>>0<s>>>0?o+1|0:o),p=o,t=(n=(i=l)- -0x80000000|0)>>>0<0x80000000?o+1|0:o,i=0,t)break t;if(u[I>>2]=l,(0|C)==(0|(h=h+1|0)))break}if(a=(c=u[((h=m-1|0)<<2)+_>>2])+0xffef9e>>>0>0x1ffdf3c,o=(t=S)>>31,l=t,p=o,!((0|(t=m))>1))break}if(a)break t;o=(t=0-(u[_>>2]<<7)|0)>>31,t=tM(f=t,o,f,o),r=0,o=(n=0x40000000-(n=(t=0x7fffffff&(o=x))+((0|i)!=0)|0)|0)>>31,n=t=tM(n,o,l,t=p),k=(0|(a=((0x3fffffff&(o=x))<<2|n>>>30)&-4))<107374?0:a}return k}function er(e,t,r,i,n){var o=0,a=0,s=0;t:{if((0|i)>=(0|n)){i:{switch(n-6|0){case 0:if((0|i)<7)break i;for(a=6;;){if(s=(o=a<<2)+e|0,o=r+o|0,m[s>>2]=m[o>>2]-g(g(g(g(g(g(m[o-4>>2]*m[t>>2])+g(m[o-8>>2]*m[t+4>>2]))+g(m[o-12>>2]*m[t+8>>2]))+g(m[o-16>>2]*m[t+12>>2]))+g(m[o-20>>2]*m[t+16>>2]))+g(m[o-24>>2]*m[t+20>>2])),(0|(a=a+1|0))==(0|i))break}break i;case 2:if((0|i)<9)break i;for(a=8;;){if(s=(o=a<<2)+e|0,o=r+o|0,m[s>>2]=m[o>>2]-g(g(g(g(g(g(g(g(m[o-4>>2]*m[t>>2])+g(m[o-8>>2]*m[t+4>>2]))+g(m[o-12>>2]*m[t+8>>2]))+g(m[o-16>>2]*m[t+12>>2]))+g(m[o-20>>2]*m[t+16>>2]))+g(m[o-24>>2]*m[t+20>>2]))+g(m[o-28>>2]*m[t+24>>2]))+g(m[o-32>>2]*m[t+28>>2])),(0|(a=a+1|0))==(0|i))break}break i;case 4:if((0|i)<11)break i;for(a=10;;){if(s=(o=a<<2)+e|0,o=r+o|0,m[s>>2]=m[o>>2]-g(g(g(g(g(g(g(g(g(g(m[o-4>>2]*m[t>>2])+g(m[o-8>>2]*m[t+4>>2]))+g(m[o-12>>2]*m[t+8>>2]))+g(m[o-16>>2]*m[t+12>>2]))+g(m[o-20>>2]*m[t+16>>2]))+g(m[o-24>>2]*m[t+20>>2]))+g(m[o-28>>2]*m[t+24>>2]))+g(m[o-32>>2]*m[t+28>>2]))+g(m[o-36>>2]*m[t+32>>2]))+g(m[o-40>>2]*m[t+36>>2])),(0|(a=a+1|0))==(0|i))break}break i;case 6:if((0|i)<13)break i;for(a=12;;){if(s=(o=a<<2)+e|0,o=r+o|0,m[s>>2]=m[o>>2]-g(g(g(g(g(g(g(g(g(g(g(g(m[o-4>>2]*m[t>>2])+g(m[o-8>>2]*m[t+4>>2]))+g(m[o-12>>2]*m[t+8>>2]))+g(m[o-16>>2]*m[t+12>>2]))+g(m[o-20>>2]*m[t+16>>2]))+g(m[o-24>>2]*m[t+20>>2]))+g(m[o-28>>2]*m[t+24>>2]))+g(m[o-32>>2]*m[t+28>>2]))+g(m[o-36>>2]*m[t+32>>2]))+g(m[o-40>>2]*m[t+36>>2]))+g(m[o-44>>2]*m[t+40>>2]))+g(m[o-48>>2]*m[t+44>>2])),(0|(a=a+1|0))==(0|i))break}break i;case 10:break;default:break t}if((0|i)<17)break i;for(a=16;;){if(s=(o=a<<2)+e|0,o=r+o|0,m[s>>2]=m[o>>2]-g(g(g(g(g(g(g(g(g(g(g(g(g(g(g(g(m[o-4>>2]*m[t>>2])+g(m[o-8>>2]*m[t+4>>2]))+g(m[o-12>>2]*m[t+8>>2]))+g(m[o-16>>2]*m[t+12>>2]))+g(m[o-20>>2]*m[t+16>>2]))+g(m[o-24>>2]*m[t+20>>2]))+g(m[o-28>>2]*m[t+24>>2]))+g(m[o-32>>2]*m[t+28>>2]))+g(m[o-36>>2]*m[t+32>>2]))+g(m[o-40>>2]*m[t+36>>2]))+g(m[o-44>>2]*m[t+40>>2]))+g(m[o-48>>2]*m[t+44>>2]))+g(m[o-52>>2]*m[t+48>>2]))+g(m[o-56>>2]*m[t+52>>2]))+g(m[o-60>>2]*m[t+56>>2]))+g(m[o+-64>>2]*m[t+60>>2])),(0|(a=a+1|0))==(0|i))break}}ex(e,0,n<<2);return}tO(9580,9614,218),k()}tO(9651,9614,242),k()}function ei(e,t,r,i,n,o){var a=g(0),s=0,c=g(0),d=g(0),l=g(0),h=0,p=0,f=0,_=0,A=0,v=0,S=0,b=0,T=0,y=0;t:if(!(!o|n<<1>=(0|t))){if(d=g(g(0|t)/g(E(u[(o<<2)+41524>>2],n)+t|0)),d=g(g(d*d)*g(.5)),b=e2(+g(d*g(1.5707963705062866))),T=e2(+g(g(g(1)-d)*g(1.5707963705062866))),o=0,i<<3<=(0|t))for(s=i>>2,n=1;;){if(o=n,n=n+1|0,!((E(E(o,o)+o|0,i)+s|0)<(0|t)))break}if((0|i)<1)break t;for(d=g(b),l=g(T),A=(_=(t>>>0)/(i>>>0)|0)-o|0,p=_-3|0,v=_-1|0,f=(o<<1^-1)+_|0,y=(0|r)>-1,r=0;;){h=E(r,_);o:{if(!y){s:if(o){if(t=0,n=S=(h<<2)+e|0,(0|A)>=1)for(;;){if(c=m[(s=(o<<2)+n|0)>>2],a=m[n>>2],m[s>>2]=g(a*d)+g(c*l),m[n>>2]=g(a*l)-g(c*d),n=n+4|0,(0|A)==(0|(t=t+1|0)))break}if((0|f)<0)break s;for(n=(f<<2)+S|0,t=f;;){if(c=m[(s=(o<<2)+n|0)>>2],a=m[n>>2],m[s>>2]=g(a*d)+g(c*l),m[n>>2]=g(a*l)-g(c*d),n=n-4|0,s=(0|t)>0,t=t-1|0,!s)break}}if(s=(h<<2)+e|0,(0|v)>=1)for(a=m[s>>2],t=0,n=s;;){if(c=m[n+4>>2],m[n>>2]=g(a*d)-g(c*l),a=g(g(a*l)+g(c*d)),m[n+4>>2]=a,n=n+4|0,(0|v)==(0|(t=t+1|0)))break}if((0|p)<0)break o;for(n=(p<<2)+s|0,t=p;;){if(a=m[n>>2],c=m[n+4>>2],m[n+4>>2]=g(a*l)+g(c*d),m[n>>2]=g(a*d)-g(c*l),n=n-4|0,s=(0|t)>0,t=t-1|0,!s)break}break o}if(h=(h<<2)+e|0,(0|v)>=1)for(a=m[h>>2],t=0,n=h;;){if(c=m[n+4>>2],m[n>>2]=g(a*d)+g(c*l),a=g(g(c*d)-g(a*l)),m[n+4>>2]=a,n=n+4|0,(0|v)==(0|(t=t+1|0)))break}if((0|p)>=0)for(n=(p<<2)+h|0,t=p;;){if(a=m[n+4>>2],c=m[n>>2],m[n+4>>2]=g(a*d)-g(c*l),m[n>>2]=g(c*d)+g(a*l),n=n-4|0,s=(0|t)>0,t=t-1|0,!s)break}if(!o)break o;if(t=0,n=h,(0|A)>=1)for(;;){if(a=m[(s=(o<<2)+n|0)>>2],c=m[n>>2],m[s>>2]=g(a*l)-g(c*d),m[n>>2]=g(c*l)+g(a*d),n=n+4|0,(0|A)==(0|(t=t+1|0)))break}if((0|f)<0)break o;for(n=(f<<2)+h|0,t=f;;){if(a=m[(s=(o<<2)+n|0)>>2],c=m[n>>2],m[s>>2]=g(a*l)-g(c*d),m[n>>2]=g(c*l)+g(a*d),n=n-4|0,s=(0|t)>0,t=t-1|0,!s)break}}if((0|i)==(0|(r=r+1|0)))break}}}function en(e,t){var r,i,n=0,o=0,s=0,d=0,l=0,p=0,f=0,_=0,A=0,m=0,g=0;M=l=M-48|0;t:{;r:{h(+e),s=0|a[1],f=0|a[0],o=s,p=0x7fffffff&s;i:{if(p>>>0<=0x400f6a7a){if((1048575&o)==598523)break i;if(p>>>0<=0x4002d97c){if((0|s)>0?1:(0|s)>=0){e+=-1.5707963267341256,n=e+-6077100506506192e-26,v[t>>3]=n,v[t+8>>3]=e-n+-6077100506506192e-26,o=1;break t}e+=1.5707963267341256,n=e+6077100506506192e-26,v[t>>3]=n,v[t+8>>3]=e-n+6077100506506192e-26,o=-1;break t}if((0|s)>0?1:(0|s)>=0){e+=-3.1415926534682512,n=e+-12154201013012384e-26,v[t>>3]=n,v[t+8>>3]=e-n+-12154201013012384e-26,o=2;break t}e+=3.1415926534682512,n=e+12154201013012384e-26,v[t>>3]=n,v[t+8>>3]=e-n+12154201013012384e-26,o=-2;break t}if(p>>>0<=0x401c463b){if(p>>>0<=0x4015fdbc){if((0|p)==0x4012d97c)break i;if((0|s)>0?1:(0|s)>=0){e+=-4.712388980202377,n=e+-18231301519518578e-26,v[t>>3]=n,v[t+8>>3]=e-n+-18231301519518578e-26,o=3;break t}e+=4.712388980202377,n=e+18231301519518578e-26,v[t>>3]=n,v[t+8>>3]=e-n+18231301519518578e-26,o=-3;break t}if((0|p)==0x401921fb)break i;if((0|s)>0?1:(0|s)>=0){e+=-6.2831853069365025,n=e+-2430840202602477e-25,v[t>>3]=n,v[t+8>>3]=e-n+-2430840202602477e-25,o=4;break t}e+=6.2831853069365025,n=e+2430840202602477e-25,v[t>>3]=n,v[t+8>>3]=e-n+2430840202602477e-25,o=-4;break t}if(p>>>0>0x413921fa)break r}n=.6366197723675814*e+0x18000000000000+-0x18000000000000,e=(_=e+-1.5707963267341256*n)-(m=6077100506506192e-26*n),v[t>>3]=e,A=p>>>20|0,h(+e),d=0|a[1],a[0],d=(A-(d>>>20&2047)|0)<17,o=0x80000000>S(n)?~~n:-0x80000000;Z:if(!d){if(g=_-(e=6077100506303966e-26*n),m=20222662487959506e-37*n-(_-g-e),e=g-m,v[t>>3]=e,h(+e),d=0|a[1],a[0],(A-(d>>>20&2047)|0)<50){_=g;break Z}_=g-(e=20222662487111665e-37*n),m=84784276603689e-45*n-(g-_-e),e=_-m,v[t>>3]=e}v[t+8>>3]=_-e-m;break t}if(p>>>0>=0x7ff00000){e-=e,v[t>>3]=e,v[t+8>>3]=e,o=0;break t}for(d=1048575&s|0x41600000,r=0|f,a[0]=r,i=0|d,a[1]=i,e=+c[0],o=0,d=1;;){if(o=(l+16|0)+(o<<3)|0,n=+(0|(A=0x80000000>S(e)?~~e:-0x80000000)),v[o>>3]=n,e=(e-n)*0x1000000,o=1,A=1&d,d=0,!A)break}v[l+32>>3]=e;er:{if(0!=e){o=2;break er}for(d=1;;){if(d=(o=d)-1|0,0!=v[(l+16|0)+(o<<3)>>3])break}}if(o=function(e,t,r,i,n){var o=0,a=0,s=0,c=0,d=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,g=0,b=0,T=0,y=0,I=0,C=0,k=0,w=0;if(M=c=M-560|0,f=E(T=(0|(s=(r-3|0)/24|0))>0?s:0,-24)+r|0,p=u[8357],(p+(A=i-1|0)|0)>=0)for(a=i+p|0,r=T-A|0,s=0;;){if(o=(0|r)<0?0:+u[(r<<2)+33440>>2],v[(c+320|0)+(s<<3)>>3]=o,r=r+1|0,(0|(s=s+1|0))==(0|a))break}for(b=f-24|0,a=0,l=(0|p)>0?p:0,h=(0|i)<1;;){a:{if(h){o=0;break a}for(s=a+A|0,r=0,o=0;;){if(o+=v[(r<<3)+e>>3]*v[(c+320|0)+(s-r<<3)>>3],(0|i)==(0|(r=r+1|0)))break}}if(v[(a<<3)+c>>3]=o,r=(0|a)==(0|l),a=a+1|0,!!r)break}k=47-f|0,I=48-f|0,w=f-25|0,a=p;d:{for(;;){if(o=v[(a<<3)+c>>3],r=0,s=a,!(A=(0|a)<1))for(;;){l=(l=r<<2)+(c+480|0)|0,m=o,d=5960464477539063e-23*o;Z:{if(0x80000000>S(d)){h=~~d;break Z}h=-0x80000000}o=m+-0x1000000*(d=+(0|h));q:{if(0x80000000>S(o)){h=~~o;break q}h=-0x80000000}if(u[l>>2]=h,o=v[((s=s-1|0)<<3)+c>>3]+d,(0|a)==(0|(r=r+1|0)))break}o=to(o,b),o+=-8*function(e){return R(e)}(.125*o);ee:{if(0x80000000>S(o)){g=~~o;break ee}g=-0x80000000}o-=+(0|g);et:{er:{_:{C=(0|b)<1;en:{if(!C){h=r=(s=(a<<2)+c|0)+476|0,s=r=u[s+476>>2],r>>=I,s=s-(r<<I)|0,u[h>>2]=s,g=r+g|0,_=s>>k;break en}if(b)break _;_=u[((a<<2)+c|0)+476>>2]>>23}if((0|_)<1)break et;break er}if(_=2,!(o>=.5^1))break er;_=0;break et}if(r=0,h=0,!A)for(;;){s=u[(A=(c+480|0)+(r<<2)|0)>>2],l=0xffffff;eb:{eN:if(!h){if(l=0x1000000,s)break eN;h=0;break eb}u[A>>2]=l-s,h=1}if((0|a)==(0|(r=r+1|0)))break}ea:if(!C){switch(0|w){case 0:u[(r=(s=(a<<2)+c|0)+476|0)>>2]=8388607&u[s+476>>2];break ea;case 1:break;default:break ea}u[(r=(s=(a<<2)+c|0)+476|0)>>2]=4194303&u[s+476>>2]}if(g=g+1|0,(0|_)!=2)break et;if(o=1-o,_=2,!h)break et;o-=to(1,b)}if(0==o){s=0;v:if(!((0|p)>=(0|(r=a)))){for(;;){if(s=u[(c+480|0)+((r=r-1|0)<<2)>>2]|s,!((0|r)>(0|p)))break}if(!s)break v;for(f=b;;){if(f=f-24|0,!!u[(c+480|0)+((a=a-1|0)<<2)>>2])break}break d}for(r=1;;){if(s=r,r=r+1|0,!!u[(c+480|0)+(p-s<<2)>>2])break}for(l=a+s|0;;){if(s=i+a|0,a=a+1|0,v[(c+320|0)+(s<<3)>>3]=u[(T+a<<2)+33440>>2],r=0,o=0,(0|i)>=1)for(;;){if(o+=v[(r<<3)+e>>3]*v[(c+320|0)+(s-r<<3)>>3],(0|i)==(0|(r=r+1|0)))break}if(v[(a<<3)+c>>3]=o,!((0|a)<(0|l)))break}a=l;continue}break}o=to(o,24-f|0);eR:{if(!(o>=0x1000000^1)){i=(i=a<<2)+(c+480|0)|0,m=o,d=5960464477539063e-23*o;ei:{if(0x80000000>S(d)){r=~~d;break ei}r=-0x80000000}o=m+-0x1000000*+(0|r);ec:{if(0x80000000>S(o)){s=~~o;break ec}s=-0x80000000}u[i>>2]=s,a=a+1|0;break eR}r=0x80000000>S(o)?~~o:-0x80000000,f=b}u[(c+480|0)+(a<<2)>>2]=r}o=to(1,f);eu:if(!((0|a)<=-1)){for(r=a;;){if(v[(r<<3)+c>>3]=o*+u[(c+480|0)+(r<<2)>>2],o*=5960464477539063e-23,i=(0|r)>0,r=r-1|0,!i)break}if(l=0,(0|a)<0)break eu;for(p=(0|p)>0?p:0,s=a;;){for(e=l>>>0>p>>>0?p:l,h=a-s|0,r=0,o=0;;){if(o+=v[(r<<3)+36208>>3]*v[(r+s<<3)+c>>3],i=(0|e)!=(0|r),r=r+1|0,!i)break}if(v[(c+160|0)+(h<<3)>>3]=o,s=s-1|0,r=(0|a)!=(0|l),l=l+1|0,!r)break}}b:{T:{switch(0|n){case 3:ev:if(!((0|a)<1)){for(o=v[(c+160|0)+(a<<3)>>3],r=a;;){if(m=d=v[(s=(c+160|0)+((i=r-1|0)<<3)|0)>>3],d+=o,v[(c+160|0)+(r<<3)>>3]=o+(m-d),v[s>>3]=d,s=(0|r)>1,o=d,r=i,!s)break}if((0|a)<2)break ev;for(o=v[(c+160|0)+(a<<3)>>3],r=a;;){if(m=d=v[(s=(c+160|0)+((i=r-1|0)<<3)|0)>>3],d+=o,v[(c+160|0)+(r<<3)>>3]=o+(m-d),v[s>>3]=d,s=(0|r)>2,o=d,r=i,!s)break}if((0|a)<=1)break ev;for(;;){if(y+=v[(c+160|0)+(a<<3)>>3],r=(0|a)>2,a=a-1|0,!r)break}}if(o=v[c+160>>3],_)break T;v[t>>3]=o,o=v[c+168>>3],v[t+16>>3]=y,v[t+8>>3]=o;break b;case 0:if(o=0,(0|a)>=0)for(;;){if(o+=v[(c+160|0)+(a<<3)>>3],r=(0|a)>0,a=a-1|0,!r)break}v[t>>3]=_?-o:o;break b;case 1:case 2:break;default:break b}if(o=0,(0|a)>=0)for(r=a;;){if(o+=v[(c+160|0)+(r<<3)>>3],i=(0|r)>0,r=r-1|0,!i)break}if(v[t>>3]=_?-o:o,o=v[c+160>>3]-o,r=1,(0|a)>=1)for(;;){if(o+=v[(c+160|0)+(r<<3)>>3],i=(0|r)!=(0|a),r=r+1|0,!i)break}v[t+8>>3]=_?-o:o;break b}v[t>>3]=-o,o=v[c+168>>3],v[t+16>>3]=-y,v[t+8>>3]=-o}return M=c+560|0,7&g}(l+16|0,l,(p>>>20|0)-1046|0,o+1|0,1),e=v[l>>3],(0|s)<-1?1:(0|s)<=-1){v[t>>3]=-e,v[t+8>>3]=-v[l+8>>3],o=0-o|0;break t}v[t>>3]=e,v[t+8>>3]=v[l+8>>3]}return M=l+48|0,o}function eo(e,t,r,i,n,o){var a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0;M=_=M-16|0,eK(_+4|0,_+12|0,t,n),eK(_,_+8|0,r,n),a=u[_+12>>2],l=(l=(0|a)>(0|(p=u[_+8>>2]))?a:p)+(1&l)|0,u[_>>2]=u[_>>2]>>l-p,a=u[_+4>>2]>>l-a,u[_+4>>2]=(0|a)>1?a:1,p=b((n=(t=function(e,t,r,i){var n=0,o=0,a=0;if((0|i)>=1)for(;;){if(a=(E(d[(o=n<<1)+t>>1],d[e+o>>1])>>r)+a|0,(0|(n=n+1|0))==(0|i))break}return a}(t,r,l,n))>>31)^t+n),m=a=t<<p-1,c=b((r=(n=u[_+4>>2])>>31)^r+n),s=h=(a=(E(r=0x1fffffff/((f=n<<c-1)>>16)<<16>>16,65535&a)>>16)+E(a>>16,r)|0)>>31,A=h=f>>31,A=s=tM(a,h=s,f,s=A),r=(E((f=m-(((0x1fffffff&(h=x))<<3|A>>>29)&-8)|0)>>16,r)+a|0)+(E(65535&f,r)>>16)|0,s=o,a=(p-c|0)+16|0;t:{if((0|a)<=-1){p=0x7fffffff>>>(a=0-a|0)|0,c=-0x80000000>>a,r=((0|r)>(0|p)?p:(0|r)<(0|c)?c:r)<<a;break t}r=(0|a)<32?r>>a:0}a=(p=(E(r=(0|(r=(0|r)>-16384?r:-16384))<16384?r:16384,65535&r)>>16)+E(r>>16,r)|0)>>31,a^=a+p,s=(0|o)>(0|a)?s:a,o=l>>1,c=0,a=u[i>>2],A=i,m=a;i:{if((0|n)<=0){h=E(l=s<<16>>16,0-a>>16);break i}g=0-(h=24-(c=b(n))|0)|0,v=f=(1&c?32768:46214)>>>(c>>>1)|0,l=n;o:if(h){if(l=n<<g|n>>>56-c,n>>>0<=127)break o;l=n<<c+8|n>>>h}v=((E(E(127&l,0xd50000)>>>16|0,v)>>>16|0)+f<<o)-a>>16,l=s<<16>>16,s=n;a:if(h){if(s=n<<g|n>>>56-c,n>>>0<=127)break a;s=n<<c+8|n>>>h}c=(E(E(127&s,0xd50000)>>>16|0,f)>>>16|0)+f|0,h=E(l,v)}a=(m+h|0)+(E((c<<o)-a&65535,l)>>16)|0,u[A>>2]=a,s=u[_>>2]-(E(t>>16,r)+(E(65535&t,r)>>16)<<4)|0,n=s+((E(t=p<<16>>16,65535&n)>>16)+E(n>>16,t)<<6)|0,u[_>>2]=n,A=i,i=t=u[i+4>>2];s:{if((0|n)<1){p=0;break s}s=0-(f=24-(p=b(n))|0)|0,c=n;d:if(f){if(c=n<<s|n>>>56-p,n>>>0<=127)break d;c=n<<p+8|n>>>f}h=E(127&c,0xd50000)>>>16|0,h=(c=(1&p?32768:46214)>>>(p>>>1)|0)+(E(c,h)>>>16|0)|0;u:if(f){if(n>>>0<=127){n=n<<s|n>>>56-p;break u}n=n<<p+8|n>>>f}S=(E(E(127&n,0xd50000)>>>16|0,c)>>>16|0)+c|0,p=h<<o}n=S,n=(i+E(p-t>>16,l)|0)+(E((n<<o)-t&65535,l)>>16)|0,u[A+4>>2]=n,t=b((i=n>>31)^i+n),c=i=n<<t-1,l=b(n=(0|a)>1?a:1),h=s=(i=(E(n=0x1fffffff/((o=n<<l-1)>>16)<<16>>16,65535&i)>>16)+E(i>>16,n)|0)>>31,A=s=o>>31,h=A=tM(i,s=h,o,A),n=(E((o=c-(((0x1fffffff&(s=x))<<3|h>>>29)&-8)|0)>>16,n)+i|0)+(E(65535&o,n)>>16)|0,i=(t-l|0)+15|0;h:{if((0|i)<=-1){t=0x7fffffff>>>(i=0-i|0)|0,l=-0x80000000>>i,n=((0|t)<(0|n)?t:(0|n)<(0|l)?l:n)<<i;break h}n=(0|i)<32?n>>i:0}return n=(0|n)>0?n:0,u[e>>2]=(0|n)<32767?n:32767,M=_+16|0,r}function ea(e,t,r,i,n,o,a){var c=0,h=0,p=0,f=0,A=0,m=0,v=0,g=0;c=-1;t:if(!((0|t)<0|(0|t)>=(0|r)|u[e+4>>2]<(0|r))){f=r-t|0,A=((t<<1)+e|0)+200|0,h=o?d[((f<<1)+A|0)-2>>1]>251?2:1:0;n:{o:{a:{switch(f-1|0){case 0:if(c=-2,(0|(h=(d[A>>1]+h|0)+1|0))>(0|n))break t;s[0|i]=252&l[0|e],c=i+1|0;break a;case 1:if(p=(c=_[A>>1])<<16>>16,(0|(m=_[A+2>>1]))==(0|c)){if(c=-2,(0|(h=(p<<1|1)+h|0))>(0|n))break t;s[0|i]=252&l[0|e]|1,c=i+1|0;break a}if(c=-2,(0|(h=((((m<<16>>16)+h|0)+p|0)+((0|p)>251)|0)+2|0))>(0|n))break t;s[0|i]=252&l[0|e]|2,c=(c=i+1|0)+tP(d[A>>1],c)|0;break a;default:break}if(c=i,(0|f)>2)break o}if(!a|(0|n)<=(0|h))break n}m=o?d[((f<<1)+A|0)-2>>1]>251?4:3:2,c=1,p=d[A>>1];q:{Z:if(!((0|f)<=1)){for(h=65535&p;;){if(_[(c<<1)+A>>1]==(0|h)){if((0|f)!=(0|(c=c+1|0)))continue;break Z}break}if(c=1,h=(p+m|0)+((0|p)>251?2:1)|0,v=f-1|0,(0|(m=(-1^t)+r|0))>=2)for(;;){if(h=((p=d[(c<<1)+A>>1])+h|0)+((0|p)>251?2:1)|0,(0|m)==(0|(c=c+1|0)))break}if(c=-2,(0|(h=d[(v<<1)+A>>1]+h|0))>(0|n))break t;c=l[0|e],p=-128|f,s[i+1|0]=p,s[0|i]=3|c,c=0;break q}if(c=-2,(0|(h=E(p,f)+m|0))>(0|n))break t;c=l[0|e],s[i+1|0]=f,s[0|i]=3|c,p=f,c=1}v=c,c=i+2|0;et:if(a&&(m=n-h|0)){if(s[i+1|0]=64|p,g=(m-1|0)/255|0,(0|m)>=256)for(ex(c,255,p=(0|g)>1?g:1),h=0;;){if(c=c+1|0,(0|p)==(0|(h=h+1|0)))break}s[0|c]=(E(g,-255)+m|0)-1,c=c+1|0,h=n}if((0|f)<2|v)break n;for(p=(0|(r=(-1^t)+r|0))>1?r:1,r=0;;){if(c=tP(d[(r<<1)+A>>1],c)+c|0,(0|p)==(0|(r=r+1|0)))break}}if(o&&(c=tP(d[((f<<1)+A|0)-2>>1],c)+c|0),(0|f)>=1)for(e=((t<<2)+e|0)+8|0,t=0;;){if(r=(t<<1)+A|0,c=eC(c,u[(t<<2)+e>>2],d[r>>1])+d[r>>1]|0,(0|f)==(0|(t=t+1|0)))break}!(!a|i+n>>>0<=c>>>0)&&ex(c,0,(n-c|0)+i|0),c=h}return c}function es(e){var t=0,r=0,i=0,n=0,o=0,a=0,c=0;t=0x7fffffff>>>(n=b(r=u[e+28>>2]))|0,o=t+(i=u[e+32>>2])&-0x80000000>>n;t:{r:{if(r+i>>>0<=(t|o)>>>0){o=i+(t=t>>>1|0)&(-1^t),n=n+1|0;break r}if(!n)break t}for(a=n;;){c=o>>>23|0;o:{if((0|c)!=255){if(i=o>>>31|0,(0|(r=u[e+40>>2]))>=0&&(t=-1,n=u[e+24>>2],A[e+4>>2]>n+u[e+8>>2]>>>0&&(u[e+24>>2]=n+1,s[u[e>>2]+n|0]=r+i,t=0),u[e+44>>2]=u[e+44>>2]|t),t=u[e+36>>2])for(n=i-1|0;;){if(i=-1,r=u[e+24>>2],A[e+4>>2]>r+u[e+8>>2]>>>0&&(u[e+24>>2]=r+1,s[u[e>>2]+r|0]=n,i=0,t=u[e+36>>2]),t=t-1|0,u[e+36>>2]=t,u[e+44>>2]=u[e+44>>2]|i,!t)break}u[e+40>>2]=255&c;break o}u[e+36>>2]=u[e+36>>2]+1}if(o=o<<8&0x7fffff00,t=(0|a)>8,a=n=a-8|0,!t)break}}t=-1,i=u[e+40>>2];h:{q:{Z:{if((0|i)<=-1){if(t=u[e+36>>2])break Z;break h}if(r=u[e+24>>2],A[e+4>>2]>r+u[e+8>>2]>>>0&&(u[e+24>>2]=r+1,s[u[e>>2]+r|0]=i,t=0),u[e+44>>2]=u[e+44>>2]|t,!(t=u[e+36>>2]))break q}for(;;){if(i=-1,r=u[e+24>>2],A[e+4>>2]>r+u[e+8>>2]>>>0&&(u[e+24>>2]=r+1,s[u[e>>2]+r|0]=255,i=0,t=u[e+36>>2]),t=t-1|0,u[e+36>>2]=t,u[e+44>>2]=u[e+44>>2]|i,!t)break}}u[e+40>>2]=0}i=u[e+12>>2],o=u[e+16>>2];et:{if((0|o)<=7){a=u[e+44>>2];break et}for(t=o;;){if(r=-1,a=u[e+4>>2],a>>>0>(o=u[e+8>>2])+u[e+24>>2]>>>0&&(r=o+1|0,u[e+8>>2]=r,s[u[e>>2]+(a-r|0)|0]=i,r=0),a=u[e+44>>2]|r,u[e+44>>2]=a,i=i>>>8|0,r=(0|t)>15,t=o=t-8|0,!r)break}}eo:if(!a){if(ex((t=u[e+24>>2])+u[e>>2]|0,0,(u[e+4>>2]-t|0)-u[e+8>>2]|0),(0|o)<1)break eo;if(t=u[e+8>>2],t>>>0>=(r=u[e+4>>2])>>>0){u[e+44>>2]=-1;return}n=0-n|0,!(u[e+24>>2]+t>>>0<r>>>0|(0|o)<=(0|n))&&(u[e+44>>2]=-1,i=(-1<<n^-1)&i),s[0|(e=u[e>>2]+((-1^t)+r|0)|0)]=l[0|e]|i}}function ec(e,t,r,i,n){var o=0,a=0,c=0,h=0,p=0;M=c=M-48|0;t:{r:{if((o=(s[(r=i?(E(r,36)+e|0)+6100|0:e+4736|0)+29|0]<<1)+s[r+30|0]|0)>>>0<6){if((0|o)<=1?i:0)break r;n:{if(!((0|o)<2?!i:0)){eR(t,o-2|0,5829,8);break n}eR(t,o,5833,8)}i=s[0|r];a:{if((0|n)==2){eR(t,i,7328,8);break a}eR(t,i>>3,(s[r+29|0]<<3)+7296|0,8),eR(t,7&l[0|r],5872,8)}if(u[e+4580>>2]>=2)for(i=1;;){if(eR(t,s[r+i|0],7328,8),!((0|(i=i+1|0))<u[e+4580>>2]))break}if(i=u[e+4692>>2],eR(t,s[r+8|0],u[i+16>>2]+E(d[i>>1],s[r+29|0]>>1)|0,8),tt(c+16|0,c,u[e+4692>>2],s[r+8|0]),(0|(a=d[(o=u[e+4692>>2])+2>>1]))!=u[e+4640>>2])break t;if(i=0,(0|a)>0)for(;;){a=i,p=s[(h=(i=i+1|0)+r|0)+8|0];h:{if((0|p)>=4){eR(t,8,u[o+28>>2]+d[(c+16|0)+(a<<1)>>1]|0,8),eR(t,s[h+8|0]-4|0,5880,8);break h}if((0|p)<=-4){eR(t,0,u[o+28>>2]+d[(c+16|0)+(a<<1)>>1]|0,8),eR(t,-4-s[h+8|0]|0,5880,8);break h}eR(t,p+4|0,u[o+28>>2]+d[(c+16|0)+(a<<1)>>1]|0,8)}if(!(d[(o=u[e+4692>>2])+2>>1]>(0|i)))break}4==u[e+4580>>2]&&eR(t,s[r+31|0],5835,8);$:if(2==l[r+29|0]){ee:if((0|n)!=2|2!=u[e+5768>>2]||(a=(i=d[r+26>>1]-d[e+5772>>1]|0)+9|0,eR(t,(i=i+8|0)>>>0>19?0:a,2080,8),!(i>>>0<20))){i=d[r+26>>1],eR(t,a=(0|i)/(0|(o=u[e+4576>>2]>>1))|0,2048,8),eR(t,i-E(a<<16>>16,o<<16>>16)|0,u[e+4684>>2],8)}if(d[e+5772>>1]=_[r+26>>1],eR(t,s[r+28|0],u[e+4688>>2],8),eR(t,s[r+32|0],7369,8),u[e+4580>>2]>=1)for(i=0;;){if(eR(t,s[(r+i|0)+4|0],u[(s[r+32|0]<<2)+7440>>2],8),!((0|(i=i+1|0))<u[e+4580>>2]))break}if(n)break $;eR(t,s[r+33|0],5826,8)}u[e+5768>>2]=s[r+29|0],eR(t,s[r+34|0],5857,8),M=c+48|0;return}tO(7919,7971,59),k()}tO(7993,7971,60),k()}tO(8047,7971,93),k()}function ed(e,t,r,i,n,o,a,c,d,h,p,f,_,v,T){var I=0,C=g(0),w=g(0),O=0,N=g(0),P=g(0),D=g(0),L=0,x=g(0),U=g(0),B=0,V=g(0),F=0,j=0,G=0,W=0,H=0,Y=0,K=0;if(M=I=M-16|0,u[I+8>>2]=0,u[I+12>>2]=0,(a+3|0)<=(0|o)&&eP(h,_,3),_?N=g(.149993896484375):(V=m[(_=f<<2)+33376>>2],N=m[_+33392>>2]),(0|t)<(0|r))for(F=(0|p)>1?p:1,j=E(p,3),G=o+32|0,o=u[e+8>>2],f=t;;){for(W=(0|T)!=0&(0|f)>1,H=E(f-r|0,j),Y=(_=((0|f)<20?f:20)<<1)+c|0,K=(1|_)+c|0,p=0;;){C=m[(_=E(o,p)+f<<2)+i>>2],o=C<(P=g(g(y(w=m[n+_>>2],g(-28)))-v))^1,D=g(V*g(y(w,g(-9)))),w=m[(L=(I+8|0)+(p<<2)|0)>>2],x=g(g(C-D)-w),U=g(R(g(x+g(.5))));s:{if(g(S(U))<g(0x80000000)){_=~~U;break s}_=-0x80000000}if(!(o|(0|_)>-1)){C=g(P-C);u:{if(g(S(C))<g(0x80000000)){o=~~C;break u}o=-0x80000000}_=_+o|0,_&=_>>31}u[I+4>>2]=_,a=(G-u[h+20>>2]|0)-b(u[h+28>>2])|0,o=_;h:if((0|t)!=(0|f)&&!((0|(O=a+H|0))>23)){if(o=(0|_)<1?_:1,u[I+4>>2]=o,(0|O)>15)break h;o=(0|o)>-1?o:-1,u[I+4>>2]=o}W&&(o=o>>31&o,u[I+4>>2]=o);Z:{if((0|a)>=15){(function(e,t,r,i){var n=0,o=0,a=0,c=0,d=0,l=0;t:{r:{if(c=u[t>>2]){o=1,n=E(16384-i|0,32736-r|0)>>>15|0,d=(a=c>>31)^a+c;o:if(!(!n|(0|d)<2)){for(;;){if(n=E(l=n<<1,i)>>>15|0,r=(r+l|0)+2|0,(0|d)<=(0|(o=o+1|0)))break o;if(!n)break}}s:{if(!n){i=o+a|0,n=(0|(n=d-o|0))<(0|(o=((c>>>31|32768)-r>>1)-1|0))?n:o,u[t>>2]=i+n^a,r=(0|(n=(r+a|0)+(n<<1|1)|0))!=32768;break s}n=((o=n+1|0)&(-1^a))+r|0,r=o}if(r+n>>>0>=32769)break r;if(!r)break t}!function(e,t,r,i){var n=0,o=0,a=0;n=-1<<i,i=(o=u[e+28>>2])>>>i|0,a=e;t:{if(t){u[e+32>>2]=u[e+32>>2]+(E(t+n|0,i)+o|0),i=E(r-t|0,i);break t}i=E(r+n|0,i)+o|0}if(u[a+28>>2]=i,i>>>0<=8388608)for(t=u[e+32>>2];;){o=t>>>23|0;o:{if((0|o)!=255){if(i=t>>>31|0,(0|(r=u[e+40>>2]))>=0&&(t=-1,n=u[e+24>>2],A[e+4>>2]>n+u[e+8>>2]>>>0&&(u[e+24>>2]=n+1,s[u[e>>2]+n|0]=r+i,t=0),u[e+44>>2]=u[e+44>>2]|t),t=u[e+36>>2])for(n=i-1|0;;){if(i=-1,r=u[e+24>>2],A[e+4>>2]>r+u[e+8>>2]>>>0&&(u[e+24>>2]=r+1,s[u[e>>2]+r|0]=n,i=0,t=u[e+36>>2]),t=t-1|0,u[e+36>>2]=t,u[e+44>>2]=u[e+44>>2]|i,!t)break}u[e+40>>2]=255&o,i=u[e+28>>2],t=u[e+32>>2];break o}u[e+36>>2]=u[e+36>>2]+1}if(i<<=8,u[e+28>>2]=i,t=t<<8&0x7fffff00,u[e+32>>2]=t,u[e+20>>2]=u[e+20>>2]+8,!(i>>>0<8388609))break}}(e,n,r+n|0,15);return}tO(32848,32879,88),k()}tO(32894,32879,89),k()})(h,I+4|0,l[0|Y]<<7,l[0|K]<<6);break Z}if((0|a)>=2){o=(0|(o=(0|o)<1?o:1))>-1?o:-1,u[I+4>>2]=o,eR(h,o<<1^o>>31,33408,2);break Z}if((0|a)==1){o=o>>31&o,u[I+4>>2]=o,eP(h,0-o|0,1);break Z}u[I+4>>2]=-1}if(a=E(p,o=u[e+8>>2])+f<<2,C=g(0|(O=u[I+4>>2])),m[d+a>>2]=x-C,m[n+a>>2]=g(w+D)+C,m[L>>2]=g(w+C)-g(N*C),a=_=_-O|0,_>>=31,B=(_^_+a)+B|0,(0|F)==(0|(p=p+1|0)))break}if((0|(f=f+1|0))==(0|r))break}return M=I+16|0,T?0:B}function eu(e,t,r){var i=g(0),n=g(0),o=0,a=0,c=0,d=0,l=0,h=0,p=0;c=u[e+12>>2];t:if(!((0|c)<1)){for(l=u[e+8>>2],a=u[e>>2];;){if(m[(o<<2)+t>>2]=s[o+a|0],(0|c)==(0|(o=o+1|0)))break}if((0|c)<1)break t;for(h=u[e+4>>2],a=0,p=(0|l)<1;;){if(!p)for(i=m[(d=(a<<2)+t|0)>>2],o=0;;){if(i=g(i+g(m[(o<<2)+r>>2]*g(s[(E(o,c)+a|0)+h|0]))),m[d>>2]=i,(0|l)==(0|(o=o+1|0)))break}if((0|c)==(0|(a=a+1|0)))break}if((0|c)<1)break t;for(o=0;;){if(m[(a=(o<<2)+t|0)>>2]=m[a>>2]*g(.0078125),(0|c)==(0|(o=o+1|0)))break}}s:{if(u[e+16>>2]){if(o=0,(0|c)<=0)break s;for(;;){i=g(1),n=g(m[(a=(o<<2)+t|0)>>2]*g(.5));u:if(!(n<g(8)^1)){if(i=g(0),n>g(-8)^1)break u;if(i=g(.5),n!=n)break u;n=(l=n<g(0))?g(-n):n,i=g(R(g(g(n*g(25))+g(.5))));l:{if(g(S(i))<g(0x80000000)){d=~~i;break l}d=-0x80000000}i=m[(d<<2)+48128>>2],n=g(n+g(g(0|d)*g(-.03999999910593033))),i=g(i+g(g(g(1)-g(i*n))*g(n*g(g(1)-g(i*i))))),i=g(g((l?g(-i):i)*g(.5))+g(.5))}if(m[a>>2]=i,(0|c)==(0|(o=o+1|0)))break}break s}if(o=0,(0|c)<=0)break s;for(;;){i=g(1),n=m[(a=(o<<2)+t|0)>>2];Z:if(!(n<g(8)^1)){if(i=g(-1),n>g(-8)^1)break Z;if(i=g(0),n!=n)break Z;n=(l=n<g(0))?g(-n):n,i=g(R(g(g(n*g(25))+g(.5))));p:{if(g(S(i))<g(0x80000000)){d=~~i;break p}d=-0x80000000}i=m[(d<<2)+48128>>2],n=g(n+g(g(0|d)*g(-.03999999910593033))),i=g(i+g(g(g(1)-g(i*n))*g(n*g(g(1)-g(i*i))))),i=l?g(-i):i}if(m[a>>2]=i,(0|c)==(0|(o=o+1|0)))break}}}function el(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0,u=0,l=0,h=0,p=0,f=0,A=0,m=0,v=0;p=(r<<1)+t|0,h=((f=r-1|0)<<1)+e|0,v=(0|r)<2;t:{for(;;){if(o=d[e>>1],i=o-(u=d[t>>1])|0,n=1,a=0,!v)for(;;){if(s=o<<16,c=s=((o=d[(l=n<<1)+e>>1])-(s>>16)|0)-d[t+l>>1]|0,i=(s=(0|i)>(0|s))?c:i,a=s?n:a,(0|(n=n+1|0))==(0|r))break}if(c=n=32768-((o=d[p>>1])+d[h>>1]|0)|0,(((n=(0|i)>(0|n))?c:i)|0)>-1)break t;i=n?r:a;o:{if(!i){d[e>>1]=u;break o}s:{c:{if((0|r)!=(0|i)){if((0|i)>=1)break c;u=0;break s}d[h>>1]=-32768-o;break o}if(n=1,(0|i)==1)break s;for(;;){if(u=d[(n<<1)+t>>1]+u|0,(0|(n=n+1|0))==(0|i))break}}s=(l=d[(A=(c=i<<1)+t|0)>>1]>>1)+u|0,a=32768;l:if(!((0|r)<=(0|i))){if(a=32768-o|0,(0|(n=f))<=(0|i))break l;for(;;){if(a=a-d[(n<<1)+t>>1]|0,!((0|(n=n-1|0))>(0|i)))break}}u=(n=e+c|0)-2|0,i=((i=d[n>>1]+d[u>>1]|0)>>1)+(1&i)|0,a=a-l|0;q:{if((0|s)>(0|a)){if(c=o=s,(0|i)>(0|o))break q;c=(0|i)<(0|a)?a:i;break q}if(c=o=a,(0|i)>(0|o))break q;c=(0|i)<(0|s)?s:i}i=(o=c)-l|0,d[u>>1]=i,d[n>>1]=_[A>>1]+i}if((0|(m=m+1|0))==20)break}if(function(e,t){var r=0,i=0,n=0,o=0,a=0;if(i=1,(0|t)>=1){if((0|t)!=1)for(;;){o=d[(i<<1)+e>>1],r=i;n:{for(;;){if((0|o)>=(0|(n=d[((a=r-1|0)<<1)+e>>1])))break n;if(d[(r<<1)+e>>1]=n,n=(0|r)>1,r=a,!n)break}r=0}if(d[(r<<1)+e>>1]=o,(0|(i=i+1|0))==(0|t))break}return}tO(15671,15659,144),k()}(e,r),n=d[e>>1],i=(0|(i=d[t>>1]))<(0|n)?n:i,d[e>>1]=i,!(s=(0|r)<2))for(n=1;;){if(c=o=(a=n<<1)+e|0,o=d[o>>1],i=(0|(i=(0|(i=(0|(i=d[t+a>>1]+(i<<16>>16)|0))<32767?i:32767))>-32768?i:-32768))<(0|o)?o:i,d[c>>1]=i,(0|(n=n+1|0))==(0|r))break}if(n=d[h>>1],i=(0|(i=32768-d[p>>1]|0))>(0|n)?n:i,d[h>>1]=i,s)break t;for(n=r-2|0;;){if(r=o=(a=n<<1)+e|0,o=d[o>>1],i=(0|(i=(i<<16>>16)-d[(t+a|0)+2>>1]|0))>(0|o)?o:i,d[r>>1]=i,a=(0|n)>0,n=n-1|0,!a)break}}}function eh(e,t,r,i,n,o){var a=0,s=0,c=0,d=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0,b=0;M=c=M-16|0,v=(m=u[e+24>>2])-1|0,f=u[e+72>>2],_=f+((S=E(g=u[e+28>>2],t))<<2)|0,b=u[e+88>>2],h=u[o>>2],p=u[i>>2],s=(a=t<<2)+u[e+68>>2]|0;t:{if(u[s>>2]){if(u[c+12>>2]=h,u[c+8>>2]=u[s>>2],u[e+56>>2]=1,d=0|tK[u[e+84>>2]](e,t,_,c+8|0,n,c+12|0),s=u[c+8>>2],a=u[e+60>>2]+a|0,(0|s)>(0|(l=u[a>>2]))&&(u[c+8>>2]=l,s=l),u[c+12>>2]=d,u[a>>2]=u[a>>2]-s,s=u[c+8>>2],(0|m)>=2)for(a=0;;){if(u[(a<<2)+_>>2]=u[(a+s<<2)+_>>2],(0|v)==(0|(a=a+1|0)))break}if(A=u[e+68>>2]+(t<<2)|0,d=u[A>>2]-s|0,u[A>>2]=d,d)for(a=0,l=u[c+8>>2];;){if(u[((s=a+v|0)<<2)+_>>2]=u[(s+l<<2)+_>>2],(0|d)==(0|(a=a+1|0)))break}if(h=h-(a=u[c+12>>2])|0,u[A>>2])break t;n=(E(u[e+92>>2],a)<<2)+n|0}if(!h|!p)break t;for(A=g-v|0,g=((m+S<<2)+f|0)-4|0;;){s=p>>>0>A>>>0?A:p,u[c+12>>2]=s,u[c+8>>2]=h;d:{if(r){if(a=0,!s)break d;for(;;){if(u[(a+v<<2)+_>>2]=u[(E(a,b)<<2)+r>>2],(0|s)==(0|(a=a+1|0)))break}break d}if(!s)break d;ex(g,0,s<<2)}if(u[e+56>>2]=1,l=u[e+24>>2],s=u[e+72>>2]+(E(u[e+28>>2],t)<<2)|0,m=0|tK[u[e+84>>2]](e,t,s,c+12|0,n,c+8|0),d=u[c+12>>2],a=u[e+60>>2]+(t<<2)|0,(0|d)>(0|(f=u[a>>2]))&&(u[c+12>>2]=f,d=f),u[c+8>>2]=m,u[a>>2]=u[a>>2]-d,a=d=u[c+12>>2],(0|l)>=2){for(l=l-1|0,a=0;;){if(u[(a<<2)+s>>2]=u[(a+d<<2)+s>>2],(0|l)==(0|(a=a+1|0)))break}a=u[c+12>>2]}if(p=p-d|0,!(h=h-(s=u[c+8>>2])|0))break t;if(r=r?(E(a,b)<<2)+r|0:0,n=(E(u[e+92>>2],s)<<2)+n|0,!p)break}}return u[i>>2]=u[i>>2]-p,u[o>>2]=u[o>>2]-h,M=c+16|0,(0|(a=u[e+84>>2]))==9}function ep(e,t,r,i,n,o){var a=0,c=0,h=0,p=0,f=0,_=0,A=0,v=0;M=c=M-1008|0;t:{r:if(!((0|(f=u[e+4580>>2]))<1)){for(v=(0|(_=u[e+4636>>2]))<1;;){if(!v)for(p=E(A,24),a=0;;){if(d[(c+48|0)+((h=a+p|0)<<1)>>1]=tL(g(m[((h<<2)+t|0)+244>>2]*g(8192))),(0|_)==(0|(a=a+1|0)))break}if((0|(A=A+1|0))==(0|f))break}if(p=0,(0|f)<=0)break r;for(;;){if(_=tL(g(m[(h=(a=p<<2)+t|0)+644>>2]*g(16384))),u[(c+32|0)+a>>2]=65535&tL(g(m[h+628>>2]*g(16384)))|_<<16,u[(c+16|0)+a>>2]=tL(g(m[h+660>>2]*g(16384))),u[a+c>>2]=tL(g(m[h+676>>2]*g(16384))),(0|f)==(0|(p=p+1|0)))break}if(_=tL(g(m[t+692>>2]*g(1024))),(0|f)<1)break t;for(h=(0|(a=E(f,5)))>1?a:1,a=0;;){if(d[(c+240|0)+(a<<1)>>1]=tL(g(m[((a<<2)+t|0)+144>>2]*g(16384))),(0|h)==(0|(a=a+1|0)))break}break t}_=tL(g(m[t+692>>2]*g(1024)))}a=0,h=u[e+4640>>2];c:if(!((0|h)<=0)){for(;;){if(d[(c+288|0)+(a<<1)>>1]=tL(g(m[((a<<2)+t|0)+16>>2]*g(4096))),(0|h)==(0|(a=a+1|0)))break}if(a=0,(0|h)<=0)break c;for(;;){if(d[((a<<1)+c|0)+320>>1]=tL(g(m[((a<<2)+t|0)+80>>2]*g(4096))),(0|h)==(0|(a=a+1|0)))break}}if(a=0,(0|f)>0)for(;;){if(u[(h=a<<2)+(c+352|0)>>2]=tL(g(m[t+h>>2]*g(65536))),(0|f)==(0|(a=a+1|0)))break}if(a=0,p=0,p=2==l[r+29|0]?d[(s[r+33|0]<<1)+5848>>1]:p,(0|(h=u[e+4584>>2]))>=1)for(;;){if(d[(c+368|0)+(a<<1)>>1]=tL(m[(a<<2)+o>>2]),(0|h)==(0|(a=a+1|0)))break}$:{if(!(u[e+4672>>2]<1?u[e+4628>>2]<=1:0)){!function(e,t,r,i,n,o,a,c,h,p,f,_,A,m,v){var g=0,S=0,T=0,y=0,R=0,I=0,C=0,w=0,O=0,N=0,P=0,D=0,L=0,U=0,B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0,K=0,Q=0,z=0,X=0,J=0,q=0,Z=0,$=0,ee=0,et=0,er=0;if(U=g=M-176|0,M=g,V=u[t+4328>>2],B=g=g-(E(u[e+4628>>2],1300)+15&-16)|0,M=g,L=ex(g,0,E(C=u[e+4628>>2],1300)),(0|C)>=1)for(T=t+4224|0,S=t+3840|0,w=u[((u[e+4592>>2]<<2)+t|0)+1276>>2],N=u[t+4324>>2],P=u[t+4320>>2],F=l[r+34|0];;){if(u[(g=E(y,1300)+L|0)+1296>>2]=0,R=y+F&3,u[g+1292>>2]=R,u[g+1288>>2]=R,u[g+1284>>2]=N,u[g+1280>>2]=P,u[g+1024>>2]=w,I=u[S+4>>2],O=u[S>>2],u[g>>2]=O,u[g+4>>2]=I,O=u[S+12>>2],I=u[S+8>>2],u[g+8>>2]=I,u[g+12>>2]=O,I=u[S+20>>2],O=u[S+16>>2],u[g+16>>2]=O,u[g+20>>2]=I,O=u[S+28>>2],I=u[S+24>>2],u[g+24>>2]=I,u[g+28>>2]=O,I=u[S+36>>2],O=u[S+32>>2],u[g+32>>2]=O,u[g+36>>2]=I,O=u[S+44>>2],I=u[S+40>>2],u[g+40>>2]=I,u[g+44>>2]=O,I=u[S+52>>2],O=u[S+48>>2],u[g+48>>2]=O,u[g+52>>2]=I,O=u[S+60>>2],I=u[S+56>>2],u[g+56>>2]=I,u[g+60>>2]=O,ev(g+1184|0,T,96),(0|C)==(0|(y=y+1|0)))break}N=l[r+29|0],T=s[r+30|0],u[U+172>>2]=0,D=(0|(y=u[e+4588>>2]))<40?y:40;i:{if((0|N)==2){if((0|(R=u[e+4580>>2]))<1)break i;for(g=0;;){if(D=(0|(S=u[(g<<2)+A>>2]-3|0))>(0|D)?D:S,(0|R)==(0|(g=g+1|0)))break}break i}if((0|V)<1)break i;D=(0|(g=V-3|0))>(0|D)?D:g}w=l[r+31|0],M=R=H=B-(((S=(g=u[e+4592>>2])+u[e+4584>>2]|0)<<2)+15&-16)|0,M=S=Q=R-((S<<1)+15&-16)|0,M=F=S-((y<<2)+15&-16)|0,u[t+4332>>2]=g,u[t+4336>>2]=g,j=(g<<1)+t|0;a:{if((0|(P=u[e+4580>>2]))>=1){for(et=d[((N<<24>>24<<1&-4)+(T<<1)|0)+5840>>1],er=(q=(255&w)==4)?3:1,Z=v<<16>>16,v=0;;){P=u[(G=v<<2)+h>>2],u[t+4348>>2]=0,Y=1,$=((v>>>1|q)<<5)+o|0;d:if((255&N)==2){if(N=2,V=u[(v<<2)+A>>2],v&er)break d;u:if((0|v)==2){if(S=0,g=0,(0|(C=u[e+4628>>2]))>=2)for(R=u[L+1296>>2],y=1;;){if(I=T=u[(E(y,1300)+L|0)+1296>>2],R=(T=(0|R)>(0|T))?I:R,g=T?y:g,(0|C)==(0|(y=y+1|0)))break}if((0|C)>0)for(;;){if((0|g)!=(0|S)&&(u[(y=E(S,1300)+L|0)+1296>>2]=u[y+1296>>2]+0x7ffffff),(0|C)==(0|(S=S+1|0)))break}if((0|D)<1){K=0;break u}for(T=u[U+172>>2]+D|0,K=0,S=0;;){if(y=S-D|0,T=(0|(R=(T-1|0)%40|0))<0?R+40|0:R,R=(E(g,1300)+L|0)+(T<<2)|0,s[y+n|0]=(u[R+544>>2]>>>9|0)+1>>>1,N=(w=u[_+4>>2])<<16>>16,C=((E(N,65535&(C=u[R+704>>2]))>>16)+E(C>>16,N)|0)+E((w>>15)+1>>1,C)|0,d[(y<<1)+j>>1]=(0|C)>0x1fffdfff?32767:(0|C)<-0x20002000?-32768:(C>>>13|0)+1>>>1|0,u[((u[t+4336>>2]+y<<2)+t|0)+1280>>2]=u[R+1024>>2],(0|D)==(0|(S=S+1|0)))break}}if(S=u[e+4592>>2],(0|(g=(S-V|0)-(y=u[e+4640>>2])|0))<=2)break a;eU(((g=g-2|0)<<1)+Q|0,(E(u[e+4588>>2],v)+g<<1)+t|0,$,S-g|0,y,u[e+5092>>2]),g=u[e+4592>>2],u[t+4348>>2]=1,u[t+4332>>2]=g,N=l[r+29|0],Y=0}R=b(S=(0|(w=u[(z=_+G|0)>>2]))>1?w:1),T=((C=0x1fffffff/(0|(y=(g=S<<R-1)>>16))|0)>>15)+1>>1,C<<=16,y=0-((E(I=65535&g,g=C>>16)>>16)+E(g,y)<<3)|0,g=((E(y,T)+C|0)+E(y>>16,g)|0)+(E(65528&y,g)>>16)|0,y=15-R|0,ee=u[A+G>>2],B=u[e+4628>>2];f:{if(S>>>0<=131071){y=0x7fffffff>>>(S=0-y|0)|0,R=-0x80000000>>S,T=((0|g)>(0|y)?y:(0|g)<(0|R)?R:g)<<S;break f}T=g>>y}if(W=P<<15,(0|(R=u[e+4588>>2]))>=1)for(y=(g=(T>>4)+1|0)<<15>>16,C=(g>>16)+1>>1,g=0;;){if(S=d[(g<<1)+i>>1],u[(g<<2)+F>>2]=(E(S>>16,y)+E(S,C)|0)+(E(65535&S,y)>>16),(0|R)==(0|(g=g+1|0)))break}P>>=2,W&=-65536,X=E(v,48),J=E(v,10),I=N<<24;en:if(!Y){if(T=v?T:E(T>>16,Z)+(E(65535&T,Z)>>16)<<2,(0|(g=((y=u[t+4332>>2])-ee|0)-2|0))>=(0|y))break en;for(C=65535&T,T>>=16;;){if(S=d[(g<<1)+Q>>1],u[(g<<2)+H>>2]=(E(C,S)>>16)+E(S,T),(0|y)==(0|(g=g+1|0)))break}}if(Y=P|W,W=c+X|0,X=a+J|0,J=I>>24,(0|w)!=(0|(g=u[t+4344>>2]))){y=b((S=g>>31)^g+S),P=S=g<<y-1,R=b((g=w>>31)^g+w),T=O=(S=(E(g=0x1fffffff/((C=w<<R-1)>>16)<<16>>16,65535&S)>>16)+E(S>>16,g)|0)>>31,I=O=C>>31,T=I=tM(S,O=T,C,I),g=(E((C=P-(((0x1fffffff&(O=x))<<3|T>>>29)&-8)|0)>>16,g)+S|0)+(E(65535&C,g)>>16)|0,y=(S=y-R|0)+13|0,S=S+29|0;eb:{if((0|S)<=15){y=0x7fffffff>>>(S=0-y|0)|0,R=-0x80000000>>S,g=((0|g)>(0|y)?y:(0|g)<(0|R)?R:g)<<S;break eb}g=(0|S)<48?g>>y:0}if((0|(S=u[e+4592>>2]))>=1)for(C=65535&g,T=g>>16,S=u[t+4336>>2]-S|0;;){if(I=y=((S<<2)+t|0)+1280|0,R=(y=u[y>>2])<<16>>16,u[I>>2]=((E(C,R)>>16)+E(R,T)|0)+E((y>>15)+1>>1,g),!((0|(S=S+1|0))<u[t+4336>>2]))break}eD:if(!(u[t+4348>>2]|(255&N)!=2)){if(S=((y=u[t+4332>>2])-ee|0)-2|0,(0|S)>=(0|(C=y-D|0)))break eD;for(T=65535&g,w=g>>16;;){if(I=y=(S<<2)+H|0,R=(y=u[y>>2])<<16>>16,u[I>>2]=((E(T,R)>>16)+E(R,w)|0)+E((y>>15)+1>>1,g),(0|C)==(0|(S=S+1|0)))break}}if((0|B)>=1)for(S=65535&g,y=g>>16,P=0;;){for(T=(R=u[(C=E(P,1300)+L|0)+1280>>2])<<16>>16,u[C+1280>>2]=(E(y,T)+(E(S,T)>>16)|0)+E((R>>15)+1>>1,g),T=(R=u[C+1284>>2])<<16>>16,u[C+1284>>2]=((E(T,S)>>16)+E(y,T)|0)+E((R>>15)+1>>1,g),T=0;;){if(I=R=(T<<2)+C|0,w=(R=u[R>>2])<<16>>16,u[I>>2]=((E(w,S)>>16)+E(y,w)|0)+E((R>>15)+1>>1,g),R=0,(0|(T=T+1|0))==16)break}for(T=0;;){if(I=w=((T<<2)+C|0)+1184|0,N=(w=u[w>>2])<<16>>16,u[I>>2]=((E(N,S)>>16)+E(y,N)|0)+E((w>>15)+1>>1,g),(0|(T=T+1|0))==24)break}for(;;){if(I=w=(T=(R<<2)+C|0)+864|0,N=(w=u[T+864>>2])<<16>>16,u[I>>2]=((E(N,S)>>16)+E(y,N)|0)+E((w>>15)+1>>1,g),I=T=T+1024|0,w=(T=u[T>>2])<<16>>16,u[I>>2]=((E(w,S)>>16)+E(y,w)|0)+E((T>>15)+1>>1,g),(0|(R=R+1|0))==40)break}if((0|B)==(0|(P=P+1|0)))break}u[t+4344>>2]=u[z>>2],B=u[e+4628>>2],w=u[z>>2],R=u[e+4588>>2]}if(function(e,t,r,i,n,o,a,c,l,h,p,f,_,A,m,v,g,S,b,T,y,R,I,C,w,O){var N=0,P=0,D=0,L=0,x=0,U=0,B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0,K=0,Q=0,z=0,X=0,J=0,q=0,Z=0,$=0,ee=0,et=0,er=0,ei=0,en=0,eo=0,ea=0,es=0,ec=0,ed=0,eu=0,el=0,eh=0,ep=0,ef=0,e_=0,eA=0,em=0,eE=0,eg=0,eS=0,eb=0,eT=0,ey=0,eR=0,eI=0,eC=0,ek=0,ew=0,eO=0;e_=N=M;t:{if((0|C)>0){if(M=x=N-(E(C,56)+15&-16)|0,(0|b)>=1)for(eA=v>>6,H=E(U=g<<16>>16,S<<16>>16),z=E((Y=S+944|0)<<16>>16,U),em=E(0-((X=S-944|0)<<16)>>16,U),eE=S-80|0,J=m>>16,eg=y>>1,eS=1&y,eb=R>>1,q=_>>16,eT=512-(N=g>>>1|0)|0,K=N-512|0,Z=m<<16>>16,$=A<<16>>16,m=I<<16>>16,ee=_<<16>>16,ey=((et=y-1|0)<<1)+p|0,F=((u[e+4336>>2]-f<<2)+e|0)+1284|0,B=((u[e+4332>>2]-f<<2)+a|0)+8|0,eR=(0|r)!=2,eI=(0|y)<3,eC=(0|g)<2049,ek=(0|T)>0;;){o:{if(eR){W=0;break o}_=d[h>>1],r=E(_,(g=u[B>>2])>>16)+(E(65535&g,_)>>16)|0,_=d[h+2>>1],r=(r+E(_,(g=u[B-4>>2])>>16)|0)+(E(65535&g,_)>>16)|0,_=d[h+4>>1],r=(r+E(_,(g=u[B-8>>2])>>16)|0)+(E(65535&g,_)>>16)|0,_=d[h+6>>1],r=(r+E(_,(g=u[B-12>>2])>>16)|0)+(E(65535&g,_)>>16)|0,_=d[h+8>>1],W=((r+E(_,(g=u[B-16>>2])>>16)|0)+(E(65535&g,_)>>16)<<1)+4|0,B=B+4|0}j=0;s:{if((0|f)<1){er=0;break s}g=u[F-4>>2],_=u[F-8>>2]+u[F>>2]|0,er=W-(((E(g>>16,q)+E(_>>16,ee)|0)+(E(65535&_,ee)>>16)|0)+(E(65535&g,q)>>16)<<2)|0,F=F+4|0}for(ew=V+15|0,eO=(G=V<<2)+i|0,ei=d[l+18>>1],en=d[l+16>>1],eo=d[l+14>>1],ea=d[l+12>>1],es=d[l+10>>1],ec=d[l+8>>1],ed=d[l+6>>1],eu=d[l+4>>1],el=d[l+2>>1],eh=d[l>>1];;){if(u[(P=E(j,1300)+t|0)+1288>>2]=E(u[P+1288>>2],0xbb38435)+0x3619636b,r=(E((_=u[(g=(ew<<2)+P|0)>>2])>>16,eh)+eb|0)+(E(65535&_,eh)>>16)|0,r=(r+E((_=u[g-4>>2])>>16,el)|0)+(E(65535&_,el)>>16)|0,r=(r+E((_=u[g-8>>2])>>16,eu)|0)+(E(65535&_,eu)>>16)|0,r=(r+E((_=u[g-12>>2])>>16,ed)|0)+(E(65535&_,ed)>>16)|0,r=(r+E((_=u[g-16>>2])>>16,ec)|0)+(E(65535&_,ec)>>16)|0,r=(r+E((_=u[g-20>>2])>>16,es)|0)+(E(65535&_,es)>>16)|0,r=(r+E((_=u[g-24>>2])>>16,ea)|0)+(E(65535&_,ea)>>16)|0,r=(r+E((_=u[g-28>>2])>>16,eo)|0)+(E(65535&_,eo)>>16)|0,r=(r+E((_=u[g-32>>2])>>16,en)|0)+(E(65535&_,en)>>16)|0,_=(r+E((_=u[g-36>>2])>>16,ei)|0)+(E(65535&_,ei)>>16)|0,(0|R)==16&&(r=d[l+20>>1],r=(E(r,(N=u[g-40>>2])>>16)+_|0)+(E(65535&N,r)>>16)|0,N=d[l+22>>1],r=(r+E(N,(_=u[g-44>>2])>>16)|0)+(E(65535&_,N)>>16)|0,N=d[l+24>>1],r=(r+E(N,(_=u[g-48>>2])>>16)|0)+(E(65535&_,N)>>16)|0,N=d[l+26>>1],r=(r+E(N,(_=u[g-52>>2])>>16)|0)+(E(65535&_,N)>>16)|0,_=d[l+28>>1],r=(r+E(_,(g=u[g-56>>2])>>16)|0)+(E(65535&g,_)>>16)|0,_=d[l+30>>1],_=(r+E(_,(g=u[P+G>>2])>>16)|0)+(E(65535&g,_)>>16)|0),eS)break t;if(Q=_<<4,_=u[P+1184>>2],g=(u[P+1284>>2]+E(_>>16,m)|0)+(E(65535&_,m)>>16)|0,u[P+1184>>2]=g,v=(E(N=d[p>>1],g>>16)+eg|0)+(E(65535&g,N)>>16)|0,g=(E((g=u[P+1188>>2]-g|0)>>16,m)+_|0)+(E(65535&g,m)>>16)|0,_=2,!eI)for(;;){if(I=u[(T=(N=P+1184|0)+((A=_-1|0)<<2)|0)>>2],r=u[(L=(D=_<<2)+N|0)>>2],u[T>>2]=g,T=u[(4|D)+N>>2],A=d[(A<<1)+p>>1],N=(E((N=r-g|0)>>16,m)+I|0)+(E(65535&N,m)>>16)|0,u[L>>2]=N,A=(E(g>>16,A)+v|0)+(E(65535&g,A)>>16)|0,v=(A+E(g=d[(_<<1)+p>>1],N>>16)|0)+(E(65535&N,g)>>16)|0,g=(E((g=T-N|0)>>16,m)+r|0)+(E(65535&g,m)>>16)|0,!((0|y)>(0|(_=_+2|0))))break}u[((et<<2)+P|0)+1184>>2]=g;q:{Z:{p:{$:{ep=u[eO>>2],N=65535&(_=u[P+1280>>2]),_>>=16,r=d[ey>>1],A=((E($,N)>>16)+E($,_)|0)+((E(r,g>>16)+v|0)+(E(65535&g,r)>>16)<<1)<<2,ef=u[w>>2],g=u[((ef<<2)+P|0)+1024>>2],g=ep-((((Q+er|0)-A|0)-(v=((E(_,J)+(E(N,J)>>16)|0)+E(g>>16,Z)|0)+(E(65535&g,Z)>>16)<<2)>>3)+1>>1)|0,_=g=(r=(0|(g=(0|(g=(T=u[P+1288>>2]<0)?0-g|0:g))>-31744?g:-31744))<30720?g:30720)-S|0;ee:if(!eC){if(_=g-K|0,(0|g)>(0|K))break ee;if((0|g)>=(0|eT))break $;_=g+K|0}if((0|(g=_))>=1024){D=E((_=(-1024&g)+eE|0)<<16>>16,U),L=E((N=_+1024|0)<<16>>16,U);break q}switch(D=H,L=z,_=S,N=Y,(g>>10)+1|0){case 1:break q;case 0:break p;default:break Z}}if(D=H,L=z,_=S,N=Y,(0|g)>=0)break q}D=em,L=H,_=X,N=S;break q}D=E(0-((_=(-1024&g|80)+S|0)<<16)>>16,U),L=E(0-((N=_+1024|0)<<16)>>16,U)}if(I=u[P+1296>>2],g=E(j,56)+x|0,D=E(P=r-_<<16>>16,P)+D>>10,P=(r=(0|D)<(0|(L=E(r=r-N<<16>>16,r)+L>>10)))?N:_,u[g+28>>2]=P,_=r?_:N,u[g>>2]=_,u[g+32>>2]=(r?L:D)+I,u[g+4>>2]=(r?D:L)+I,_<<=4,_=(T?0-_|0:_)+W|0,u[g+24>>2]=_,N=P<<4,N=(T?0-N|0:N)+W|0,u[g+52>>2]=N,_=_+Q|0,u[g+8>>2]=_,N=N+Q|0,u[g+36>>2]=N,_=_-(r=ep<<4)|0,u[g+16>>2]=_,N=N-r|0,u[g+44>>2]=N,_=_-A|0,u[g+12>>2]=_,N=N-A|0,u[g+40>>2]=N,u[g+20>>2]=_-v,u[g+48>>2]=N-v,(0|(j=j+1|0))==(0|C))break}if(g=0,_=(0|(_=(ef-1|0)%40|0))<0?_+40|0:_,u[w>>2]=_,v=(_+O|0)%40|0,r=0,!(T=(0|C)<2))for(N=u[x+4>>2],_=1;;){if(I=A=u[(E(_,56)+x|0)+4>>2],N=(A=(0|A)<(0|N))?I:N,r=A?_:r,(0|C)==(0|(_=_+1|0)))break}for(v<<=2,N=u[(D=v+(E(r,1300)+t|0)|0)+384>>2];;){if(u[((E(g,1300)+t|0)+v|0)+384>>2]!=(0|N)&&(u[(_=E(g,56)+x|0)+4>>2]=u[_+4>>2]+0x7ffffff,r=_,u[(_=_+32|0)>>2]=u[r+32>>2]+0x7ffffff),(0|C)==(0|(g=g+1|0)))break}if(_=u[x+32>>2],N=u[x+4>>2],r=0,g=1,A=0,!T)for(;;){if(L=I=u[(T=E(g,56)+x|0)+4>>2],N=(I=(0|I)>(0|N))?L:N,L=T=u[T+32>>2],_=(T=(0|_)>(0|T))?L:_,A=I?g:A,r=T?g:r,(0|C)==(0|(g=g+1|0)))break}for((0|_)<(0|N)&&(ev((E(A,1300)+t|0)+G|0,(E(r,1300)+t|0)+G|0,1300-G|0),g=E(A,56)+x|0,_=E(r,56)+x|0,u[g+24>>2]=u[_+52>>2],A=u[_+48>>2],r=u[_+44>>2],u[g+16>>2]=r,u[g+20>>2]=A,r=u[_+40>>2],A=u[_+36>>2],u[g+8>>2]=A,u[g+12>>2]=r,A=u[_+32>>2],r=u[_+28>>2],u[g>>2]=r,u[g+4>>2]=A),!((0|O)>(0|V)?!ek:0)&&(s[(g=V-O|0)+n|0]=(u[D+544>>2]>>>9|0)+1>>>1,r=(g<<1)+o|0,N=(_=u[c+v>>2])<<16>>16,g=((E(N,65535&(g=u[D+704>>2]))>>16)+E(g>>16,N)|0)+E((_>>15)+1>>1,g)|0,d[r>>1]=(0|g)>8388479?32767:(0|g)<-8388736?-32768:(g>>>7|0)+1>>>1|0,u[((u[e+4336>>2]-O<<2)+e|0)+1280>>2]=u[D+1024>>2],u[(u[e+4332>>2]-O<<2)+a>>2]=u[D+864>>2]),u[e+4336>>2]=u[e+4336>>2]+1,u[e+4332>>2]=u[e+4332>>2]+1,A=V+16|0,N=0;;){if(g=E(N,1300)+t|0,_=E(N,56)+x|0,u[g+1280>>2]=u[_+12>>2],u[g+1284>>2]=u[_+16>>2],r=u[_+8>>2],u[(A<<2)+g>>2]=r,u[((u[w>>2]<<2)+g|0)+704>>2]=r,r=u[_>>2],u[((u[w>>2]<<2)+g|0)+544>>2]=r,u[((u[w>>2]<<2)+g|0)+864>>2]=u[_+24>>2]<<1,u[((u[w>>2]<<2)+g|0)+1024>>2]=u[_+20>>2],r=u[g+1288>>2]+((r>>9)+1>>1)|0,u[g+1288>>2]=r,u[((u[w>>2]<<2)+g|0)+384>>2]=r,u[g+1296>>2]=u[_+4>>2],(0|(N=N+1|0))==(0|C))break}if(u[(u[w>>2]<<2)+c>>2]=eA,(0|(V=V+1|0))==(0|b))break}for(m=0,N=b<<2;;){if(A=u[(_=N+(g=E(m,1300)+t|0)|0)>>2],r=u[_+4>>2],u[g>>2]=A,u[g+4>>2]=r,A=u[_+60>>2],r=u[_+56>>2],u[g+56>>2]=r,u[g+60>>2]=A,r=u[_+52>>2],A=u[_+48>>2],u[g+48>>2]=A,u[g+52>>2]=r,A=u[_+44>>2],r=u[_+40>>2],u[g+40>>2]=r,u[g+44>>2]=A,r=u[_+36>>2],A=u[_+32>>2],u[g+32>>2]=A,u[g+36>>2]=r,A=u[_+28>>2],r=u[_+24>>2],u[g+24>>2]=r,u[g+28>>2]=A,r=u[_+20>>2],A=u[_+16>>2],u[g+16>>2]=A,u[g+20>>2]=r,A=u[_+12>>2],r=u[_+8>>2],u[g+8>>2]=r,u[g+12>>2]=A,(0|C)==(0|(m=m+1|0)))break}M=e_;return}tO(16226,16207,364),k()}tO(16271,16207,422),k()}(t,L,J,F,n,j,H,U,$,X,W,V,Y,u[p+G>>2],u[f+G>>2],w,m,et,R,K,u[e+4636>>2],u[e+4640>>2],u[e+4672>>2],B,U+172|0,D),n=(y=u[e+4588>>2])+n|0,j=j+(g=y<<1)|0,(0|(v=v+1|0))<(0|(P=u[e+4580>>2]))){K=K+1|0,i=i+g|0,N=l[r+29|0];continue}break}C=u[e+4628>>2]}if(R=0,(0|C)>=2)for(S=u[L+1296>>2],g=1;;){if(i=T=u[(E(g,1300)+L|0)+1296>>2],S=(T=(0|S)>(0|T))?i:S,R=T?g:R,(0|C)==(0|(g=g+1|0)))break}if(w=E(R,1300)+L|0,s[r+34|0]=u[w+1292>>2],(0|D)>=1){for(C=u[U+172>>2]+D|0,T=(g=u[((P<<2)+_|0)-4>>2])<<10>>16,N=(g>>21)+1>>1,g=0;;){if(S=g-D|0,y=((C=(0|(y=(C-1|0)%40|0))<0?y+40|0:y)<<2)+w|0,s[S+n|0]=(u[y+544>>2]>>>9|0)+1>>>1,R=(E((R=u[y+704>>2])>>16,T)+E(R,N)|0)+(E(65535&R,T)>>16)|0,d[(S<<1)+j>>1]=(0|R)>8388479?32767:(0|R)<-8388736?-32768:(R>>>7|0)+1>>>1|0,u[((u[t+4336>>2]+S<<2)+t|0)+1280>>2]=u[y+1024>>2],(0|D)==(0|(g=g+1|0)))break}y=u[e+4588>>2]}T=u[(g=(y<<2)+w|0)+4>>2],I=u[g>>2],u[t+3840>>2]=I,u[t+3844>>2]=T,I=u[g+60>>2],r=T=u[g+56>>2],u[(T=t+3896|0)>>2]=r,u[T+4>>2]=I,T=u[g+52>>2],r=I=u[g+48>>2],u[(I=t+3888|0)>>2]=r,u[I+4>>2]=T,I=u[g+44>>2],r=T=u[g+40>>2],u[(T=t+3880|0)>>2]=r,u[T+4>>2]=I,T=u[g+36>>2],r=I=u[g+32>>2],u[(I=t+3872|0)>>2]=r,u[I+4>>2]=T,I=u[g+28>>2],r=T=u[g+24>>2],u[(T=t+3864|0)>>2]=r,u[T+4>>2]=I,T=u[g+20>>2],r=I=u[g+16>>2],u[(I=t+3856|0)>>2]=r,u[I+4>>2]=T,I=u[g+12>>2],r=T=u[g+8>>2],u[(T=t+3848|0)>>2]=r,u[T+4>>2]=I,ev(t+4224|0,w+1184|0,96),u[t+4320>>2]=u[w+1280>>2],u[t+4324>>2]=u[w+1284>>2],u[t+4328>>2]=u[((u[e+4580>>2]<<2)+A|0)-4>>2],g=eC(t,(u[e+4584>>2]<<1)+t|0,u[e+4592>>2]<<1)+1280|0,eC(g,(u[e+4584>>2]<<2)+g|0,u[e+4592>>2]<<2),M=U+176|0;return}tO(16175,16207,253),k()}(e,i,r,c+368|0,n,c+288|0,c+240|0,c+48|0,c,c+16|0,c+32|0,c+352|0,t+228|0,_,p);break $}!function(e,t,r,i,n,o,a,c,h,p,f,_,A,m,v){var g=0,S=0,T=0,y=0,R=0,I=0,C=0,w=0,O=0,N=0,P=0,D=0,L=0,U=0,B=0,V=0,F=0,j=0,G=0,W=0,H=0,Y=0,K=0,Q=0,z=0,X=0,J=0,q=0,Z=0,$=0,ee=0,et=0,er=0,ei=0,en=0,eo=0,ea=0,es=0,ec=0,ed=0,eu=0,el=0,eh=0,ep=0,ef=0,e_=0,eA=0,em=0,ev=0,eE=0,eg=0,eS=0,eb=0,eT=0,ey=0,eR=0,eI=0,ek=0;e_=g=M,u[t+4340>>2]=s[r+34|0],j=u[t+4328>>2],R=l[r+31|0],O=s[r+29|0],w=s[r+30|0],y=u[e+4592>>2],M=g=W=g-(((S=y+(T=u[e+4584>>2])|0)<<2)+15&-16)|0,M=S=z=g-((S<<1)+15&-16)|0,M=X=S-(((g=u[e+4588>>2])<<2)+15&-16)|0,u[t+4332>>2]=y,u[t+4336>>2]=y;t:{r:{i:{if((0|(S=u[e+4580>>2]))>=1){for(et=E(V=m<<16>>16,(J=(P=d[((O<<1&-4)+(w<<1)|0)+5840>>1])+944|0)<<16>>16),eA=E(0-((er=P-944|0)<<16)>>16,V),em=(ei=(255&R)==4)?3:1,ev=P-80|0,eE=t+3900|0,eg=512-(S=m>>>1|0)|0,q=S-512|0,en=v<<16>>16,Z=(y<<1)+t|0,$=E(P,V),eS=(0|m)<2049,eb=U=t+3840|0;;){B=u[(w=N<<2)+h>>2],u[t+4348>>2]=0,R=1,C=((N>>>1|ei)<<5)+o|0;a:if((255&O)==2){if(O=2,j=u[(N<<2)+A>>2],N&em)break a;if(y=u[e+4592>>2],(0|(S=(y-j|0)-(m=u[e+4640>>2])|0))<=2)break i;eU(((S=S-2|0)<<1)+z|0,(E(g,N)+S<<1)+t|0,C,y-S|0,m,u[e+5092>>2]),u[t+4348>>2]=1,u[t+4332>>2]=u[e+4592>>2],O=l[r+29|0],R=0}m=b(S=(0|(v=u[(I=_+w|0)>>2]))>1?v:1),H=((T=0x1fffffff/(0|(y=(g=S<<m-1)>>16))|0)>>15)+1>>1,T<<=16,y=0-((E(D=65535&g,g=T>>16)>>16)+E(g,y)<<3)|0,g=((E(y,H)+T|0)+E(y>>16,g)|0)+(E(65528&y,g)>>16)|0,y=15-m|0,L=u[A+w>>2];s:{if(S>>>0<=131071){y=0x7fffffff>>>(S=0-y|0)|0,m=-0x80000000>>S,T=((0|g)>(0|y)?y:(0|m)>(0|g)?m:g)<<S;break s}T=g>>y}if((0|(G=u[e+4588>>2]))>=1)for(y=(g=(T>>4)+1|0)<<15>>16,m=(g>>16)+1>>1,g=0;;){if(S=d[(g<<1)+i>>1],u[(g<<2)+X>>2]=(E(S>>16,y)+E(m,S)|0)+(E(65535&S,y)>>16),(0|G)==(0|(g=g+1|0)))break}l:if(!R){if(T=N?T:E(T>>16,en)+(E(65535&T,en)>>16)<<2,(0|(g=((y=u[t+4332>>2])-L|0)-2|0))>=(0|y))break l;for(m=65535&T,T>>=16;;){if(S=d[(g<<1)+z>>1],u[(g<<2)+W>>2]=(E(S,m)>>16)+E(S,T),(0|y)==(0|(g=g+1|0)))break}}if((0|(g=u[t+4344>>2]))!=(0|v)){y=b((S=g>>31)^g+S),H=S=g<<y-1,m=b((g=v>>31)^v+g),D=R=(S=(E(g=0x1fffffff/((T=v<<m-1)>>16)<<16>>16,65535&S)>>16)+E(S>>16,g)|0)>>31,v=R=T>>31,T=v=tM(S,R=D,T,v),g=(E((T=H-(((0x1fffffff&(R=x))<<3|T>>>29)&-8)|0)>>16,g)+S|0)+(E(65535&T,g)>>16)|0,y=(S=y-m|0)+13|0,S=S+29|0;p:{if((0|S)<=15){y=0x7fffffff>>>(S=0-y|0)|0,m=-0x80000000>>S,y=((0|g)>(0|y)?y:(0|m)>(0|g)?m:g)<<S;break p}y=(0|S)<48?g>>y:0}if((0|(g=u[e+4592>>2]))>=1)for(T=65535&y,v=y>>16,g=u[t+4336>>2]-g|0;;){if(R=S=((g<<2)+t|0)+1280|0,m=(S=u[S>>2])<<16>>16,u[R>>2]=((E(T,m)>>16)+E(m,v)|0)+E((S>>15)+1>>1,y),!((0|(g=g+1|0))<u[t+4336>>2]))break}et:if(!(u[t+4348>>2]|(255&O)!=2)&&!((0|(g=((T=u[t+4332>>2])-L|0)-2|0))>=(0|T))){for(v=65535&y,R=y>>16;;){if(D=S=(g<<2)+W|0,m=(S=u[S>>2])<<16>>16,u[D>>2]=((E(v,m)>>16)+E(m,R)|0)+E((S>>15)+1>>1,y),(0|T)==(0|(g=g+1|0)))break}}for(m=65535&y,S=(g=u[t+4320>>2])<<16>>16,T=y>>16,u[t+4320>>2]=((E(m,S)>>16)+E(T,S)|0)+E((g>>15)+1>>1,y),S=(g=u[t+4324>>2])<<16>>16,u[t+4324>>2]=((E(S,m)>>16)+E(S,T)|0)+E((g>>15)+1>>1,y),g=0,S=0;;){if(D=v=((S<<2)+t|0)+3840|0,R=(v=u[v>>2])<<16>>16,u[D>>2]=((E(R,m)>>16)+E(T,R)|0)+E((v>>15)+1>>1,y),(0|(S=S+1|0))==16)break}for(;;){if(R=S=((g<<2)+t|0)+4224|0,v=(S=u[S>>2])<<16>>16,u[R>>2]=((E(v,m)>>16)+E(v,T)|0)+E((S>>15)+1>>1,y),(0|(g=g+1|0))==24)break}u[t+4344>>2]=u[I>>2],G=u[e+4588>>2],v=u[I>>2]}if((0|G)>=1)for(Y=E(N,10)+a|0,L=0,eT=(eo=(255&O)!=2)|(0|j)>0,ea=((g=B>>2)|B<<15)>>16,es=(S=u[f+w>>2])>>16,ey=(B=u[e+4636>>2])>>1,eR=1&B,eI=(ec=u[e+4640>>2])>>1,ed=v<<10>>16,eu=g<<16>>16,el=S<<16>>16,ek=(v>>21)+1>>1,v=E(N,48)+c|0,H=v+((g=B-1|0)<<1)|0,D=((g<<2)+t|0)+4224|0,K=((u[t+4336>>2]-j<<2)+t|0)+1284|0,F=((u[t+4332>>2]-j<<2)+W|0)+8|0,eh=d[p+w>>1],g=u[t+4340>>2],I=eE;;){if(u[t+4340>>2]=E(g,0xbb38435)+0x3619636b,S=d[C>>1],m=(E(S,(g=u[I>>2])>>16)+eI|0)+(E(65535&g,S)>>16)|0,S=d[C+2>>1],m=(m+E(S,(g=u[I-4>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+4>>1],m=(m+E(S,(g=u[I-8>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+6>>1],m=(m+E(S,(g=u[I-12>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+8>>1],m=(m+E(S,(g=u[I-16>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+10>>1],m=(m+E(S,(g=u[I-20>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+12>>1],m=(m+E(S,(g=u[I-24>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+14>>1],m=(m+E(S,(g=u[I-28>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+16>>1],m=(m+E(S,(g=u[I-32>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+18>>1],Q=(m+E(S,(g=u[I-36>>2])>>16)|0)+(E(65535&g,S)>>16)|0,(0|ec)==16&&(S=d[C+20>>1],m=(E(S,(g=u[I-40>>2])>>16)+Q|0)+(E(65535&g,S)>>16)|0,S=d[C+22>>1],m=(m+E(S,(g=u[I-44>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+24>>1],m=(m+E(S,(g=u[I-48>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+26>>1],m=(m+E(S,(g=u[I-52>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+28>>1],m=(m+E(S,(g=u[I-56>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[C+30>>1],Q=(m+E(S,(g=u[I-60>>2])>>16)|0)+(E(65535&g,S)>>16)|0),ee=0,!eo&&(S=d[Y>>1],m=E(S,(g=u[F>>2])>>16)+(E(65535&g,S)>>16)|0,S=d[Y+2>>1],m=(m+E(S,(g=u[F-4>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[Y+4>>1],m=(m+E(S,(g=u[F-8>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[Y+6>>1],m=(m+E(S,(g=u[F-12>>2])>>16)|0)+(E(65535&g,S)>>16)|0,S=d[Y+8>>1],ee=((m+E(S,(g=u[F-16>>2])>>16)|0)+(E(65535&g,S)>>16)|0)+2|0,F=F+4|0),eR)break r;if(S=u[t+4224>>2],g=u[t+4324>>2],u[t+4224>>2]=g,T=(E(y=d[v>>1],g>>16)+ey|0)+(E(65535&g,y)>>16)|0,g=2,(0|B)>=3)for(;;){if(y=u[(w=(m=t+4224|0)+((R=g-1|0)<<2)|0)>>2],u[w>>2]=S,O=u[(w=(g<<2)+m|0)>>2],m=d[(R<<1)+v>>1],u[w>>2]=y,m=(E(S>>16,m)+T|0)+(E(65535&S,m)>>16)|0,T=(m+E(S=d[(g<<1)+v>>1],y>>16)|0)+(E(65535&y,S)>>16)|0,S=O,!((0|B)>(0|(g=g+2|0))))break}if(u[D>>2]=S,!eT)break t;y=65535&(g=u[t+4320>>2]),g>>=16,m=d[H>>1],w=((E(eh,y)>>16)+E(eh,g)|0)+((E(m,S>>16)+T|0)+(E(65535&S,m)>>16)<<1)|0,m=E(g,es)+(E(y,es)>>16)|0,g=((Q<<2)-w|0)-(O=(m+E((g=u[((u[t+4336>>2]<<2)+t|0)+1276>>2])>>16,el)|0)+(E(65535&g,el)>>16)|0)|0;eL:{if((0|j)>=1){m=(g<<1)+ee|0,g=u[K-4>>2],S=u[K-8>>2]+u[K>>2]|0,g=m-(((E(g>>16,ea)+E(S>>16,eu)|0)+(E(65535&S,eu)>>16)|0)+(E(65535&g,ea)>>16)<<1)>>2,K=K+4|0;break eL}g>>=1}m:{v:{E:{eM:{g=u[(ep=(L<<2)+X|0)>>2]-(g+1>>1)|0,S=g=(m=(0|(g=(0|(g=u[t+4340>>2]<0?0-g|0:g))>-31744?g:-31744))<30720?g:30720)-P|0;es:if(!eS){if(S=g-q|0,(0|g)>(0|q))break es;if((0|g)>=(0|eg))break eM;S=g+q|0}if((0|(g=S))>=1024){T=E((S=(-1024&g)+ev|0)<<16>>16,V),R=E((y=S+1024|0)<<16>>16,V);break m}switch(S=P,y=J,T=$,R=et,(g>>10)+1|0){case 1:break m;case 0:break E;default:break v}}if(S=P,y=J,T=$,R=et,(0|g)>=0)break m}S=er,y=P,T=eA,R=$;break m}T=E(0-((S=(-1024&g|80)+P|0)<<16)>>16,V),R=E(0-((y=S+1024|0)<<16)>>16,V)}if(ef=n+L|0,R=E(g=m-y<<16>>16,g)+R|0,g=(0|R)<(E(g=m-S<<16>>16,g)+T|0)?y:S,s[0|ef]=(g>>>9|0)+1>>>1,g<<=4,S=(E((g=(y=(ee<<1)+(u[t+4340>>2]<0?0-g|0:g)|0)+(Q<<4)|0)>>16,ed)+E(g,ek)|0)+(E(65534&g,ed)>>16)|0,d[(L<<1)+Z>>1]=(0|S)>8388479?32767:(0|S)<-8388736?-32768:(S>>>7|0)+1>>>1|0,u[I+4>>2]=g,g=g-(u[ep>>2]<<4)|0,u[t+4324>>2]=g,g=g-(w<<2)|0,u[t+4320>>2]=g,u[((u[t+4336>>2]<<2)+t|0)+1280>>2]=g-(O<<2),g=u[t+4332>>2],u[(g<<2)+W>>2]=y<<1,u[t+4332>>2]=g+1,u[t+4336>>2]=u[t+4336>>2]+1,g=u[t+4340>>2]+s[0|ef]|0,u[t+4340>>2]=g,I=I+4|0,(0|G)==(0|(L=L+1|0)))break}if(v=u[(R=(g=(G<<2)+t|0)+3896|0)>>2],T=u[R+4>>2],m=v,u[(v=eb)+56>>2]=m,u[v+60>>2]=T,T=u[(R=g+3888|0)>>2],v=u[R+4>>2],m=T,u[(T=U)+48>>2]=m,u[T+52>>2]=v,v=u[(R=g+3880|0)>>2],T=u[R+4>>2],m=v,u[(v=U)+40>>2]=m,u[v+44>>2]=T,T=u[(R=g+3872|0)>>2],v=u[R+4>>2],m=T,u[(T=U)+32>>2]=m,u[T+36>>2]=v,v=u[(R=g+3864|0)>>2],T=u[R+4>>2],m=v,u[(v=U)+24>>2]=m,u[v+28>>2]=T,T=u[(R=g+3856|0)>>2],v=u[R+4>>2],m=T,u[(T=U)+16>>2]=m,u[T+20>>2]=v,v=u[(R=g+3848|0)>>2],T=u[R+4>>2],m=v,u[(v=U)+8>>2]=m,u[v+12>>2]=T,T=u[(R=g+3840|0)>>2],v=u[R+4>>2],m=T,u[(T=U)>>2]=m,u[T+4>>2]=v,S=u[e+4580>>2],(0|S)>(0|(N=N+1|0))){n=(g=u[e+4588>>2])+n|0,i=(S=g<<1)+i|0,Z=S+Z|0,O=l[r+29|0];continue}break}T=u[e+4584>>2],y=u[e+4592>>2]}u[t+4328>>2]=u[((S<<2)+A|0)-4>>2],g=eC(t,(T<<1)+t|0,y<<1)+1280|0,eC(g,(u[e+4584>>2]<<2)+g|0,u[e+4592>>2]<<2),M=e_;return}tO(16318,16350,146),k()}tO(16361,16350,250),k()}tO(16408,16350,258),k()}(e,i,r,c+368|0,n,c+288|0,c+240|0,c+48|0,c,c+16|0,c+32|0,c+352|0,t+228|0,_,p)}M=c+1008|0}function ef(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,h=0,p=0,f=0;if(t>>>0>1){h=t-1|0;r:{if(h>>>0>=256){if(n=u[e+28>>2],s=24-b(h)|0,t=(n>>>0)/((i=(r=h>>>s|0)+1|0)>>>0)|0,u[e+36>>2]=t,c=o=u[e+32>>2],p=((i=(a=(o=(o>>>0)/(t>>>0)|0)+1|0)-i|0)>>>0>a>>>0?0:i)+(r-o|0)|0,i=c-(r=E(r-p|0,t))|0,u[e+32>>2]=i,r=p?t:n-r|0,u[e+28>>2]=r,r>>>0<=8388608)for(n=u[e+24>>2],o=u[e+40>>2],a=u[e+20>>2],f=u[e+4>>2];;){if(c=r<<8,u[e+28>>2]=c,a=a+8|0,u[e+20>>2]=a,t=0,n>>>0<f>>>0&&(d=n+1|0,u[e+24>>2]=d,t=l[u[e>>2]+n|0],n=d),u[e+40>>2]=t,i=((o<<8|t)>>>1&255|i<<8&0x7fffff00)^255,u[e+32>>2]=i,d=r>>>0<32769,o=t,r=c,!d)break}c=p<<s,i=u[e+12>>2],t=u[e+16>>2];s:{if(s>>>0<=t>>>0){a=t;break s}for(r=u[e+8>>2],o=u[e+4>>2];;){if(n=0,r>>>0<o>>>0&&(r=r+1|0,u[e+8>>2]=r,n=l[u[e>>2]+(o-r|0)|0]),i=n<<t|i,n=(0|t)<17,t=a=t+8|0,!n)break}}if(u[e+16>>2]=a-s,u[e+12>>2]=i>>>s,u[e+20>>2]=u[e+20>>2]+s,h>>>0>=(s=(-1<<s^-1)&i|c)>>>0)break r;return u[e+44>>2]=1,h}if(r=((n=u[e+28>>2])>>>0)/(t>>>0)|0,u[e+36>>2]=r,c=i=u[e+32>>2],d=(-1^(i=(i>>>0)/(r>>>0)|0))+t|0,o=(i=i+1|0)-t|0,i=c-(t=E((-1^(s=d+(i>>>0<o>>>0?0:o)|0))+t|0,r))|0,u[e+32>>2]=i,r=s?r:n-t|0,u[e+28>>2]=r,r>>>0>8388608)break r;for(n=u[e+24>>2],o=u[e+40>>2],a=u[e+20>>2],f=u[e+4>>2];;){if(c=r<<8,u[e+28>>2]=c,a=a+8|0,u[e+20>>2]=a,t=0,n>>>0<f>>>0&&(d=n+1|0,u[e+24>>2]=d,t=l[u[e>>2]+n|0],n=d),u[e+40>>2]=t,i=((o<<8|t)>>>1&255|i<<8&0x7fffff00)^255,u[e+32>>2]=i,d=r>>>0<32769,o=t,r=c,!d)break}}return s}tO(9274,9298,203),k()}function e_(e,t,r,i,n,o,a,s,c,d){var l=g(0),h=0,p=g(0),f=g(0),_=g(0),A=g(0),v=0,S=g(0),b=g(0),T=g(0),y=0;if(v=h=M,!n)return M=v,g(0);r:{if((0|d)==48e3){o<<=1,n<<=1;break r}if((0|d)!=16e3)break r;o=(o<<1)/3|0,n=(n<<1)/3|0}if(y=h=h-((n<<2)+15&-16)|0,M=h,tK[0|e](t,h,n,o,a,s,c),l=(0|s)==-2?g(g(30517578125e-15)/g(0|c)):(0|s)>-1?g(152587890625e-16):g(30517578125e-15),(0|n)>=1)for(s=0;;){if(m[(o=(s<<2)+h|0)>>2]=l*m[o>>2],(0|(s=s+1|0))==(0|n))break}c:{if((0|d)==48e3){if(d=(0|n)/2|0,(0|n)<2)break c;for(s=0;;){if(l=m[h+(o=s<<3)>>2],f=g(g(l-(p=m[i>>2]))*g(.6074370741844177)),m[i>>2]=l+f,l=m[(4|o)+h>>2],A=g(g(l-(_=m[i+4>>2]))*g(.15062999725341797)),m[i+4>>2]=l+A,S=m[i+8>>2],b=g(g(g(-l)-S)*g(.15062999725341797)),m[i+8>>2]=b-l,l=g(p+f),m[(s<<2)+r>>2]=g(g(_+l)+A)*g(.5),l=g(g(l+S)+b),T=g(T+g(l*l)),(0|d)==(0|(s=s+1|0)))break}break c}if((0|d)!=16e3){if((0|d)!=24e3)break c;ev(r,h,n<<2);break c}if(M=c=(t=y)-(((e=E(n,3))<<2)+15&-16)|0,(0|n)>=1)for(s=0;;){if(o=E(s,12)+c|0,d=u[(s<<2)+h>>2],u[o+8>>2]=d,u[o+4>>2]=d,u[o>>2]=d,(0|(s=s+1|0))==(0|n))break}if(o=(0|e)/2|0,(0|e)>=2)for(s=0;;){if(l=m[(h=s<<3)+c>>2],f=g(g(l-(p=m[i>>2]))*g(.6074370741844177)),m[i>>2]=l+f,l=m[(4|h)+c>>2],A=g(g(l-(_=m[i+4>>2]))*g(.15062999725341797)),m[i+4>>2]=l+A,m[i+8>>2]=g(g(g(-l)-m[i+8>>2])*g(.15062999725341797))-l,m[(s<<2)+r>>2]=g(g(_+g(p+f))+A)*g(.5),(0|(s=s+1|0))==(0|o))break}}return M=v,T}function eA(e,t,r,i){var n=0,o=0,a=0;t:{r:{e=n=ex(e,0,300);i:{if(i){o:{if((0|t)<=15999){if((0|t)==8e3|(0|t)==12e3)break o;break t}if((0|t)==16e3|(0|t)==48e3)break o;if((0|t)!=24e3)break t}if((0|r)!=16e3?!((0|r)==8e3|(0|r)==12e3):0)break t;i=(E((t>>>12|0)-((0|t)>16e3)>>((0|t)>24e3),3)+(r>>>12|0)|0)+6487|0;break i}if((0|t)!=12e3?!((0|t)==8e3|(0|t)==16e3):0)break r;d:{if((0|r)<=15999){if((0|r)==8e3|(0|r)==12e3)break d;break r}if((0|r)==16e3|(0|r)==24e3)break d;if((0|r)!=48e3)break r}i=(E(t>>>12|0,5)+((r>>>12|0)-((0|r)>16e3)>>((0|r)>24e3))|0)+6500|0}u[e+292>>2]=s[0|i],u[n+288>>2]=((65535&r)>>>0)/1e3,i=((65535&t)>>>0)/1e3|0,u[n+284>>2]=i,u[n+268>>2]=E(i,10);l:{if((0|t)<(0|r)){if(o=1,t<<1==(0|r)){u[n+264>>2]=1,o=0;break l}u[n+264>>2]=2;break l}if((0|t)>(0|r)){if(u[n+264>>2]=3,(0|(i=r<<2))==(0|E(t,3))){u[n+296>>2]=6e3,u[n+276>>2]=18,u[n+280>>2]=3;break l}if((0|(e=E(r,3)))==t<<1){u[n+296>>2]=6064,u[n+276>>2]=18,u[n+280>>2]=2;break l}if(r<<1==(0|t)){u[n+296>>2]=6112,u[n+276>>2]=24,u[n+280>>2]=1;break l}if((0|e)==(0|t)){u[n+296>>2]=6144,u[n+276>>2]=36,u[n+280>>2]=1;break l}if((0|t)==(0|i)){u[n+296>>2]=6192,u[n+276>>2]=36,u[n+280>>2]=1;break l}if((0|E(r,6))==(0|t)){u[n+296>>2]=6240,u[n+276>>2]=36,u[n+280>>2]=1;break l}tO(6454,6474,154),k()}u[n+264>>2]=0}for(e=t<<o,i=r<<16>>16,a=(r>>>15|0)+1>>>1|0,t=(t<<(14|o))/(0|r)<<2;;){if(t=(r=t)+1|0,!(((E(r>>16,i)+E(r,a)|0)+(E(65535&r,i)>>16)|0)<(0|e)))break}return u[n+272>>2]=r,0}tO(6454,6474,101),k()}tO(6454,6474,94),k()}function em(e,t,r,i,n,o,a,s,c,d,u,l){var h=g(0),p=g(0),f=g(0),_=g(0),A=0,v=g(0),S=0,b=0,T=0,y=0,R=g(0),I=g(0),C=g(0),k=g(0),w=g(0),O=g(0),N=g(0),P=g(0),D=g(0);t:{if(!(o!=g(0)|a!=g(0))){if((0|e)==(0|t))break t;eC(e,t,n<<2);return}if(S=-2-(l=(0|i)>15?i:15)|0,b=-1^l,T=1-l|0,y=0-l|0,R=g(m[(i=E(c,12))+1704>>2]*a),I=g(m[i+1700>>2]*a),C=g(m[i+1696>>2]*a),i=o==a&&(0|s)==(0|c)?0:u,(0|(i=(0|l)==(0|(c=(0|r)>15?r:15))?i:u))>=1){for(k=g(m[(u=E(s,12))+1704>>2]*o),w=g(m[u+1700>>2]*o),O=g(m[u+1696>>2]*o),s=2-l|0,h=m[(T<<2)+t>>2],p=m[(y<<2)+t>>2],f=m[(b<<2)+t>>2],o=m[(S<<2)+t>>2],u=0;;){if(A=(r=u<<2)+e|0,v=g(o+(_=m[(s+u<<2)+t>>2])),o=g((o=m[r+d>>2])*o),v=g(v*g(R*o)),N=g(g(h+f)*g(I*o)),P=g(p*g(C*o)),D=m[t+r>>2],r=(u-c<<2)+t|0,o=g(g(1)-o),m[A>>2]=v+g(N+g(P+g(g(g(D+g(m[r>>2]*g(O*o)))+g(g(w*o)*g(m[r+4>>2]+m[r-4>>2])))+g(g(k*o)*g(m[r+8>>2]+m[r-8>>2]))))),o=f,f=p,p=h,h=_,(0|(u=u+1|0))==(0|i))break}A=i}if(a==g(0)){if((0|e)==(0|t))break t;eC((u=i<<2)+e|0,t+u|0,n-i<<2);return}if((0|(i=n-A|0))<1)break t;for(e=(u=A<<2)+e|0,d=2-l|0,f=m[(r=t+u|0)+(S<<2)>>2],o=m[(b<<2)+r>>2],h=m[(y<<2)+r>>2],p=m[(T<<2)+r>>2],u=0;;){if(t=u<<2,_=m[(d+u<<2)+r>>2],m[t+e>>2]=g(R*g(f+_))+g(g(I*g(o+p))+g(g(C*h)+m[t+r>>2])),f=o,o=h,h=p,p=_,(0|(u=u+1|0))==(0|i))break}}}function ev(e,t,r){var i=0,n=0,o=0;if(r>>>0>=512)return O(0|e,0|t,0|r),e;n=e+r|0;r:{if(!((e^t)&3)){n:{if((0|r)<1||!(3&e)){r=e;break n}for(r=e;;){if(s[0|r]=l[0|t],t=t+1|0,n>>>0<=(r=r+1|0)>>>0)break n;if(!(3&r))break}}i=-4&n;c:if(!(i>>>0<64)&&!((o=i+-64|0)>>>0<r>>>0)){for(;;){if(u[r>>2]=u[t>>2],u[r+4>>2]=u[t+4>>2],u[r+8>>2]=u[t+8>>2],u[r+12>>2]=u[t+12>>2],u[r+16>>2]=u[t+16>>2],u[r+20>>2]=u[t+20>>2],u[r+24>>2]=u[t+24>>2],u[r+28>>2]=u[t+28>>2],u[r+32>>2]=u[t+32>>2],u[r+36>>2]=u[t+36>>2],u[r+40>>2]=u[t+40>>2],u[r+44>>2]=u[t+44>>2],u[r+48>>2]=u[t+48>>2],u[r+52>>2]=u[t+52>>2],u[r+56>>2]=u[t+56>>2],u[r+60>>2]=u[t+60>>2],t=t- -64|0,!(o>>>0>=(r=r- -64|0)>>>0))break}}if(r>>>0>=i>>>0)break r;for(;;){if(u[r>>2]=u[t>>2],t=t+4|0,!(i>>>0>(r=r+4|0)>>>0))break}break r}if(n>>>0<4||(i=n-4|0)>>>0<e>>>0){r=e;break r}for(r=e;;){if(s[0|r]=l[0|t],s[r+1|0]=l[t+1|0],s[r+2|0]=l[t+2|0],s[r+3|0]=l[t+3|0],t=t+4|0,!(i>>>0>=(r=r+4|0)>>>0))break}}if(r>>>0<n>>>0)for(;;){if(s[0|r]=l[0|t],t=t+1|0,(0|n)==(0|(r=r+1|0)))break}return e}function eE(e,t,r,i,n,o,a,c,h,p){var f=0,_=0,A=0,m=0,v=0,g=0,S=0,b=0,T=0,y=0,R=0,I=0,C=0,k=0,w=0,O=0,N=0;for(M=_=M-16|0,y=(0|h)<1,T=0x7fffffff;;){A=u[i>>2];r:{if(y){S=0,g=0,p=A;break r}for(R=s[b+7916|0],I=u[(f=b<<2)+7904>>2],C=u[f+7824>>2],k=u[f+7520>>2],f=0,g=0,S=0,m=a,v=o;;){if(!function(e,t,r,i,n,o,a,c,d,h,p,f){var _=0,A=0,m=0,v=0,g=0,S=0,b=0,T=0,y=0,R=0,I=0;if(_=u[o+8>>2],A=u[o+4>>2],v=u[o>>2],m=u[o+12>>2],o=u[o+16>>2],u[r>>2]=0x7fffffff,u[t>>2]=0x7fffffff,s[0|e]=0,(0|f)>=1)for(S=o<<8,b=m<<7,T=v<<7,y=A<<7,R=_<<7,I=h<<16>>16,v=0;;){m=s[0|a],A=s[a+1|0],_=s[a+2|0],h=s[a+3|0],o=s[a+4|0],g=E(m,u[n>>2])+((((E(A,u[n+4>>2])-T|0)+E(_,u[n+8>>2])|0)+E(h,u[n+12>>2])|0)+E(o,u[n+16>>2])<<1)|0,g=E(g>>16,m)+(E(65535&g,m)>>16)|0,m=E(u[n+24>>2],A)+(((E(u[n+28>>2],_)-y|0)+E(u[n+32>>2],h)|0)+E(u[n+36>>2],o)<<1)|0,m=(g+E(m>>16,A)|0)+(E(65535&m,A)>>16)|0,A=E(u[n+48>>2],_)+((E(u[n+52>>2],h)-R|0)+E(u[n+56>>2],o)<<1)|0,m=(m+E(A>>16,_)|0)+(E(65535&A,_)>>16)|0,_=E(u[n+96>>2],o)-S|0,A=E(u[n+72>>2],h)+(E(u[n+76>>2],o)-b<<1)|0,o=((((m+E(_>>16,o)|0)+E(A>>16,h)|0)+(E(65535&_,o)>>16)|0)+(E(65535&A,h)>>16)|0)+32801|0;i:if(!((0|o)<0||(0|(h=E((tE(o=(((0|(h=(_=l[c+v|0])-p|0))>0?h:0)<<11)+o|0)<<16)-0x7800000>>16,I)+(l[d+v|0]<<2)|0))>u[r>>2])){u[r>>2]=h,u[t>>2]=o,s[0|e]=v,u[i>>2]=_}if(a=a+5|0,(0|(v=v+1|0))==(0|f))break}}((_+12|0)+f|0,_+8|0,_+4|0,_,v,m,C,I,k,c,th(6229-A|0)-51|0,R),w=(0|(g=u[_+4>>2]+g|0))>-1,O=(0|(S=u[_+8>>2]+S|0))>-1,p=0,(tE(u[_>>2]+51|0)+A|0)>=896&&(p=(tE(u[_>>2]+51|0)+A|0)-896|0),g=w?g:0x7fffffff,S=O?S:0x7fffffff,m=m+20|0,v=v+100|0,A=p,(0|(f=f+1|0))==(0|h))break}}if((0|g)<=(0|T)&&(s[0|r]=b,ev(t,_+12|0,h),N=p,T=g),(0|(b=b+1|0))==3)break}if((0|h)>=1)for(A=u[(s[0|r]<<2)+7824>>2],v=0;;){if(f=E(v,10)+e|0,m=t+v|0,d[f>>1]=s[E(s[0|m],5)+A|0]<<7,d[f+2>>1]=s[(E(s[0|m],5)+A|0)+1|0]<<7,d[f+4>>1]=s[(E(s[0|m],5)+A|0)+2|0]<<7,d[f+6>>1]=s[(E(s[0|m],5)+A|0)+3|0]<<7,d[f+8>>1]=s[(E(s[0|m],5)+A|0)+4|0]<<7,(0|(v=v+1|0))==(0|h))break}u[i>>2]=N,u[n>>2]=E((tE(S>>((0|h)==2?1:2))<<16)-0x7800000>>16,-3),M=_+16|0}function eg(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,l=0,h=0;t:{r:{if((0|i)>0){if((0|r)<=0)break r;if((0|r)<(0|i))break t;for(;;){if(u[(n<<2)+t>>2]=n,(0|(n=n+1|0))==(0|i))break}if(a=1,(0|i)>1)for(;;){s=u[(a<<2)+e>>2],n=a;s:{for(;;){if((0|(l=u[(o=(c=n-1|0)<<2)+e>>2]))<=(0|s))break s;if(u[(d=n<<2)+e>>2]=l,u[t+d>>2]=u[t+o>>2],o=(0|n)>1,n=c,!o)break}n=0}if(u[(n<<=2)+e>>2]=s,u[t+n>>2]=a,(0|(a=a+1|0))==(0|i))break}if((0|r)>(0|i))for(a=i-2|0,h=((i<<2)+e|0)-4|0,s=i;;){if((0|(d=u[(s<<2)+e>>2]))<u[h>>2]){o=n=a;h:if(!((0|i)<2)){for(;;){if((0|d)>=(0|(o=u[(c=n<<2)+e>>2]))){o=n;break h}if(u[(l=c+4|0)+e>>2]=o,u[t+l>>2]=u[t+c>>2],o=-1,c=(0|n)>0,n=n-1|0,!c)break}}u[(n=(o<<2)+4|0)+e>>2]=d,u[t+n>>2]=s}if((0|(s=s+1|0))==(0|r))break}return}tO(15635,15659,51),k()}tO(15671,15659,52),k()}tO(15695,15659,53),k()}function eS(e,t){var r=0,i=0,n=0,o=0,a=0,c=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0,b=0;for(m=1;;){f=(n<<2)+e|0,_=c=E(n,3)+t|0,i=0x7fffffff,n=0;r:{i:{for(;;){if(v=n+1|0,a=d[(n<<1)+5744>>1],g=E(65535&(o=d[(v<<1)+5744>>1]-a|0),6554)>>>16|0,A=(o=E(S=o>>16,6554)+g|0)+a|0,h=r=u[f>>2]-A|0,r>>=31,(0|(r^=r+h))>=(0|i)){n=l[0|c];break r}if(s[0|c]=n,s[_+1|0]=0,p=E(o,3)+a|0,h=i=u[f>>2]-p|0,i>>=31,(0|r)<=(0|(i^=i+h))){p=A;break r}if(s[0|c]=n,s[_+1|0]=1,b=E(o,5)+a|0,h=r=u[f>>2]-b|0,r>>=31,(0|(r^=r+h))>=(0|i))break r;if(s[0|c]=n,s[_+1|0]=2,p=E(o,7)+a|0,h=i=u[f>>2]-p|0,i>>=31,(0|(A=i^i+h))>=(0|r))break i;if(s[0|c]=n,s[_+1|0]=3,r=o=u[f>>2]-(E(o,9)+a|0)|0,o>>=31,(0|A)<=(0|(i=o^o+r)))break r;if(p=(E(S,58986)+E(g,9)|0)+a|0,s[0|c]=n,s[_+1|0]=4,(0|(n=v))==15)break}n=14;break r}p=b}if(a=(n<<24>>24)/3|0,s[c+2|0]=a,s[0|c]=E(a,-3)+n,u[f>>2]=p,n=1,a=m,m=0,!a)break}u[e>>2]=u[e>>2]-u[e+4>>2]}function eb(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0;for(p=a=M,M=s=a-(((n=u[e+268>>2])<<2)+31&-16)|0,a=u[e+36>>2],o=u[e+32>>2],u[s+8>>2]=o,u[s+12>>2]=a,o=u[e+28>>2],a=u[e+24>>2],u[s>>2]=a,u[s+4>>2]=o,f=s+16|0,_=u[e+272>>2];;){if(ek(e,f,r,c=(0|i)<(0|n)?i:n),a=0,(0|(l=c<<17))>=1)for(;;){if(o=(h=E(65535&a,12)>>>16|0)<<3,n=(a>>16<<1)+s|0,A=((E(d[o+6306>>1],d[n+2>>1])+E(d[o+6304>>1],d[n>>1])|0)+E(d[o+6308>>1],d[n+4>>1])|0)+E(d[o+6310>>1],d[n+6>>1])|0,o=((n=(((A+E(d[(o=11-h<<3)+6310>>1],d[n+8>>1])|0)+E(d[o+6308>>1],d[n+10>>1])|0)+E(d[o+6306>>1],d[n+12>>1])|0)+E(d[o+6304>>1],d[n+14>>1])|0)>>14)+1>>1,d[t>>1]=(0|n)>0x3fffbfff?32767:(0|o)>-32768?o:-32768,t=t+2|0,!((0|l)>(0|(a=a+_|0))))break}if((0|(i=i-c|0))>=1){a=u[(n=(c<<2)+s|0)+4>>2],o=u[n>>2],u[s>>2]=o,u[s+4>>2]=a,o=u[n+12>>2],a=u[n+8>>2],u[s+8>>2]=a,u[s+12>>2]=o,r=(c<<1)+r|0,n=u[e+268>>2];continue}break}a=u[(n=(c<<2)+s|0)+4>>2],o=u[n>>2],u[e+24>>2]=o,u[e+28>>2]=a,o=u[n+12>>2],a=u[n+8>>2],u[e+32>>2]=a,u[e+36>>2]=o,M=p}function eT(e){var t,r,i,n=0,o=0,s=0,d=0,u=0,l=0,p=0,f=0,_=0,A=0,m=0,v=0,E=0;h(+e),o=0|a[1],s=0|a[0],u=o;t:{;r:{i:{n:if(((0|o)>0?!1:!((0|o)>=0))||!((n=u)>>>0>1048575)){if(!((n=0x7fffffff&(o=u))|s))return -1/(e*e);if((0|(n=u))>-1)break i;return(e-e)/0}if(n>>>0>0x7fefffff)break t;if(o=0x3ff00000,_=-1023,(0|n)!=0x3ff00000){o=n;break r}if(s)break r;return 0}h(+(0x40000000000000*e)),o=0|a[1],s=0|a[0],_=-1077}d=.30102999566361177*(A=+(((n=o+614242|0)>>>20|0)+_|0)),n=(1048575&n)+0x3fe6a09e|0|(o=0),t=0|s,a[0]=t,r=0|n,a[1]=r,p=.5*(e=+c[0]+-1)*e,h(+(e-p)),n=0|a[1],a[0],a[0]=0,i=0|n,a[1]=i,m=d+(l=.4342944818781689*(f=+c[0])),v=l+(d-m),E=e-f-p,e/=e+2,e=m+(v+(.4342944818781689*(e=E+(l=e)*(p+((e=(d=e*e)*d)*(e*(.15313837699209373*e+.22222198432149784)+.3999999999940942)+d*(e*(e*(.14798198605116586*e+.1818357216161805)+.2857142874366239)+.6666666666666735))))+(3694239077158931e-28*A+(e+f)*25082946711645275e-27)))}return e}function ey(e,t,r,i){var n=0,o=0,a=0,s=0,c=0;u[(n=i<<2)+t>>2]=65536,u[r+n>>2]=65536,n=0;t:if(!((0|i)<=0)){for(;;){if(o=n<<2,a=(i+n<<2)+e|0,s=((-1^n)+i<<2)+e|0,u[o+t>>2]=0-(u[a>>2]+u[s>>2]|0),u[r+o>>2]=u[a>>2]-u[s>>2],(0|(n=n+1|0))==(0|i))break}if((0|i)<=0)break t;for(n=i;;){if(s=a=(o=(e=n-1|0)<<2)+t|0,c=u[a>>2],a=n<<2,u[s>>2]=c-u[a+t>>2],u[(o=r+o|0)>>2]=u[o>>2]+u[r+a>>2],o=(0|n)>1,n=e,!o)break}if(s=2,(0|i)<2)break t;for(;;){if((0|s)<(0|(n=i)))for(;;){if(u[(o=(e=(n<<2)+t|0)-8|0)>>2]=u[o>>2]-u[e>>2],!((0|s)<(0|(n=n-1|0))))break}if(a=2,u[(e=(n=(s<<2)+t|0)-8|0)>>2]=u[e>>2]-(u[n>>2]<<1),n=(0|i)!=(0|s),s=s+1|0,!n)break}for(;;){if((0|a)<(0|(n=i)))for(;;){if(u[(o=(e=(n<<2)+r|0)-8|0)>>2]=u[o>>2]-u[e>>2],!((0|a)<(0|(n=n-1|0))))break}if(u[(e=(n=(a<<2)+r|0)-8|0)>>2]=u[e>>2]-(u[n>>2]<<1),n=(0|i)!=(0|a),a=a+1|0,!n)break}}}function eR(e,t,r,i){var n=0,o=0;i=(n=u[e+28>>2])>>>i|0,o=e;t:{if((0|t)>=1){r=(t=t+r|0)-1|0,u[e+32>>2]=(u[e+32>>2]+n|0)-E(l[0|r],i),i=E(l[0|r]-l[0|t]|0,i);break t}i=n-E(l[t+r|0],i)|0}if(u[o+28>>2]=i,i>>>0<=8388608)for(t=u[e+32>>2];;){o=t>>>23|0;o:{if((0|o)!=255){if(i=t>>>31|0,(0|(r=u[e+40>>2]))>=0&&(t=-1,n=u[e+24>>2],A[e+4>>2]>n+u[e+8>>2]>>>0&&(u[e+24>>2]=n+1,s[u[e>>2]+n|0]=r+i,t=0),u[e+44>>2]=u[e+44>>2]|t),t=u[e+36>>2])for(n=i-1|0;;){if(i=-1,r=u[e+24>>2],A[e+4>>2]>r+u[e+8>>2]>>>0&&(u[e+24>>2]=r+1,s[u[e>>2]+r|0]=n,i=0,t=u[e+36>>2]),t=t-1|0,u[e+36>>2]=t,u[e+44>>2]=u[e+44>>2]|i,!t)break}u[e+40>>2]=255&o,i=u[e+28>>2],t=u[e+32>>2];break o}u[e+36>>2]=u[e+36>>2]+1}if(i<<=8,u[e+28>>2]=i,t=t<<8&0x7fffff00,u[e+32>>2]=t,u[e+20>>2]=u[e+20>>2]+8,!(i>>>0<8388609))break}}function eI(e){var t=0,r=0,i=0,n=0,o=0,s=0,c=0;h(+e),t=0|a[1],n=0|a[0],o=t>>>31|0;t:{r:{i:{n:{i=e;o:{a:{t=0x7fffffff&(s=t);s:{if(t>>>0>=0x4086232b){if(s=n=function(e){var t=0,r=0;return h(+e),t=0|a[1],r=0|a[0],x=t,r}(e),n=0x7fffffff&(t=x),(0|n)==0x7ff00000&(0|(t=s))!=0|n>>>0>0x7ff00000)return e;if(!(e>709.782712893384^1))return 898846567431158e293*e;if(!(e<-745.1332191019411)|e<-708.3964185322641^1)break s;break r}if(t>>>0<0x3fd62e43)break n;if(t>>>0<0x3ff0a2b2)break a}if(0x80000000>S(r=1.4426950408889634*e+v[(o<<3)+10928>>3])){t=~~r;break o}t=-0x80000000;break o}t=(1^o)-o|0}e=i+-.6931471803691238*(r=+(0|t)),i=e-(c=19082149292705877e-26*r);break i}if(t>>>0<=0x3e300000)break t;t=0,i=e}if(r=i*i,r=i-r*(r*(r*(r*(41381367970572385e-24*r+-16533902205465252e-22)+6613756321437934e-20)+-.0027777777777015593)+.16666666666666602),r=e+(i*r/(2-r)-c)+1,!t)break r;r=to(r,t)}return r}return e+1}function eC(e,t,r){var i=0;t:if((0|e)!=(0|t)){if((t-e|0)-r>>>0<=0-(r<<1)>>>0)return ev(e,t,r);i=(e^t)&3;i:{n:{if(e>>>0<t>>>0){if(i){i=e;break i}if(!(3&e)){i=e;break n}for(i=e;;){if(!r)break t;if(s[0|i]=l[0|t],t=t+1|0,r=r-1|0,!(3&(i=i+1|0)))break}break n}d:if(!i){if(e+r&3)for(;;){if(!r)break t;if(s[0|(i=(r=r-1|0)+e|0)]=l[t+r|0],!(3&i))break}if(r>>>0<=3)break d;for(;;){if(u[(r=r-4|0)+e>>2]=u[t+r>>2],!(r>>>0>3))break}}if(!r)break t;for(;;){if(s[(r=r-1|0)+e|0]=l[t+r|0],!r)break}break t}if(r>>>0<=3)break i;for(;;){if(u[i>>2]=u[t>>2],t=t+4|0,i=i+4|0,!((r=r-4|0)>>>0>3))break}}if(!r)break t;for(;;){if(s[0|i]=l[0|t],i=i+1|0,t=t+1|0,!(r=r-1|0))break}}return e}function ek(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,_=0,A=0,m=0,v=0,g=0,S=0;if((0|i)>=1){for(l=u[e+20>>2],s=u[e+16>>2],n=u[e+12>>2],a=u[e+8>>2],c=u[e+4>>2],o=u[e>>2];;){if(o=(A=(h=(E(65535&(h=(_=d[(f<<1)+r>>1]<<10)-o|0),1746)>>>16|0)+E(h>>16,1746)|0)+o|0)-c|0,c=(o=(m=(E(65535&o,14986)>>>16|0)+E(o>>16,14986)|0)+c|0)-a|0,p=f<<2,a=((o=(E(c>>16,-26453)+(E(65535&c,-26453)>>16)|0)+o|0)>>9)+1>>1,d[p+t>>1]=(0|o)>0x1fffdff?32767:(0|a)>-32768?a:-32768,S=(2|p)+t|0,n=(v=(p=(E(65535&(a=_-n|0),6854)>>>16|0)+E(a>>16,6854)|0)+n|0)-s|0,s=(n=(g=(E(65535&n,25769)>>>16|0)+E(n>>16,25769)|0)+s|0)-l|0,l=((n=(E(s>>16,-9994)+(E(65535&s,-9994)>>16)|0)+n|0)>>9)+1>>1,d[S>>1]=(0|n)>0x1fffdff?32767:(0|l)>-32768?l:-32768,l=n+s|0,a=o+c|0,s=v+g|0,c=A+m|0,n=_+p|0,o=_+h|0,(0|(f=f+1|0))==(0|i))break}u[e+20>>2]=l,u[e+16>>2]=s,u[e+12>>2]=n,u[e+8>>2]=a,u[e+4>>2]=c,u[e>>2]=o}}function ew(e,t,r,i){var n=0,o=0,a=0;n=((o=u[e+28>>2])>>>0)/(i>>>0)|0,a=e;t:{if(t){u[e+32>>2]=u[e+32>>2]+(E(t-i|0,n)+o|0),i=E(r-t|0,n);break t}i=E(r-i|0,n)+o|0}if(u[a+28>>2]=i,i>>>0<=8388608)for(t=u[e+32>>2];;){o=t>>>23|0;o:{if((0|o)!=255){if(i=t>>>31|0,(0|(n=u[e+40>>2]))>=0&&(t=-1,r=u[e+24>>2],A[e+4>>2]>r+u[e+8>>2]>>>0&&(u[e+24>>2]=r+1,s[u[e>>2]+r|0]=i+n,t=0),u[e+44>>2]=u[e+44>>2]|t),t=u[e+36>>2])for(r=i-1|0;;){if(i=-1,n=u[e+24>>2],A[e+4>>2]>n+u[e+8>>2]>>>0&&(u[e+24>>2]=n+1,s[u[e>>2]+n|0]=r,i=0,t=u[e+36>>2]),t=t-1|0,u[e+36>>2]=t,u[e+44>>2]=u[e+44>>2]|i,!t)break}u[e+40>>2]=255&o,i=u[e+28>>2],t=u[e+32>>2];break o}u[e+36>>2]=u[e+36>>2]+1}if(i<<=8,u[e+28>>2]=i,t=t<<8&0x7fffff00,u[e+32>>2]=t,u[e+20>>2]=u[e+20>>2]+8,!(i>>>0<8388609))break}}function eO(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0;c=r=M-304|0,M=r,i=u[e+4576>>2];t:if((0|i)!=(0|t)||(o=0,u[e+4560>>2]!=u[e+4556>>2])){if(!i){o=eA(e+5776|0,u[e+4556>>2],E(t,1e3),1);break t}if(l=E(u[e+4580>>2],10)+5|0,a=E(l,i),h=s=r-((((0|(o=E(t,l)))<(0|a)?a:o)<<1)+15&-16)|0,M=s,(0|a)>=1)for(r=a;;){if(p=((i=r-1|0)<<1)+s|0,n=(0|(n=tL(m[((i<<2)+e|0)+7180>>2])))>-32768?n:-32768,d[p>>1]=(0|n)<32767?n:32767,n=(0|r)>1,r=i,!n)break}if(i=eA(c,E(d[e+4576>>1],1e3),u[e+4556>>2],0),M=r=h-(((n=E(u[e+4556>>2]/1e3|0,l))<<1)+15&-16)|0,a=ej(c,r,s,a)+i|0,t=a+eA(i=e+5776|0,u[e+4556>>2],E(t<<16>>16,1e3),1)|0,n=ej(i,s,r,n),(0|o)>=1)for(;;){if(m[(((r=o-1|0)<<2)+e|0)+7180>>2]=d[(r<<1)+s>>1],i=(0|o)>1,o=r,!i)break}o=t+n|0}return u[e+4560>>2]=u[e+4556>>2],M=c+304|0,o}function eN(e,t,r,i,n,o,a,s,c){var l=0,h=0,p=0,f=0,_=0,A=0,v=0,S=0,b=0,T=0,y=g(0);for(h=u[e+44>>2],f=u[e+4>>2],t?v=u[e+36>>2]:(h<<=a,t=1,v=u[e+36>>2]-a|0),S=(0|o)>1?o:1,b=e- -64|0,T=f+(l=E(t,h))|0;;){if((0|t)>=1)for(p=E(l,_),A=(E(_,T)<<2)+r|0,a=0;;){if(!function(e,t,r,i,n,o,a,s){var c=0,l=0,h=0,p=0,f=0,_=g(0),A=g(0),v=0,S=0,b=g(0),T=0,y=g(0),R=0,I=0,C=0,k=0,w=g(0),O=0;if(C=s=M,l=(v=u[e>>2])>>1,b=m[(R=u[((o<<2)+e|0)+8>>2])+4>>2],S=u[e+24>>2],(0|o)>=1)for(e=0;;){if(v=l,l>>=1,S=(v<<2)+S|0,(0|o)==(0|(e=e+1|0)))break}o=((e=n<<1&-4)+((h=l<<2)+t|0)|0)-4|0,M=s=h=s-(h+15&-16)|0,I=n+3>>2,t=e+t|0,M=f=s-(((p=v>>2)<<3)+15&-16)|0;i:{if((0|n)<1){s=0,e=h;break i}for(s=(0|I)>1?I:1,T=(c=e+i|0)-4|0,O=0-l<<2,e=h;;){if(_=m[T>>2],A=m[c>>2],m[e>>2]=g(_*m[(l<<2)+t>>2])+g(A*m[o>>2]),m[e+4>>2]=g(A*m[t>>2])-g(_*m[o+O>>2]),T=T-8|0,c=c+8|0,o=o-8|0,t=t+8|0,e=e+8|0,(0|(k=k+1|0))==(0|s))break}}if((0|(c=p-I|0))>(0|s)){for(;;){if(u[e>>2]=u[o>>2],u[e+4>>2]=u[t>>2],o=o-8|0,t=t+8|0,e=e+8|0,!((0|c)>(0|(s=s+1|0))))break}s=c}if((0|s)<(0|p))for(c=((n<<2)+i|0)-4|0,T=0-l<<2;;){if(m[e>>2]=g(m[c>>2]*m[o>>2])-g(m[i>>2]*m[t+T>>2]),m[e+4>>2]=g(m[c>>2]*m[t>>2])+g(m[i>>2]*m[(l<<2)+o>>2]),c=c-8|0,i=i+8|0,o=o-8|0,t=t+8|0,e=e+8|0,(0|p)==(0|(s=s+1|0)))break}if((0|v)<=3){G(R,f),M=C;return}for(t=(0|p)>1?p:1,e=0;;){if(o=(d[u[R+44>>2]+(e<<1)>>1]<<3)+f|0,_=m[(e+p<<2)+S>>2],A=m[h>>2],y=m[(e<<2)+S>>2],w=m[h+4>>2],m[o+4>>2]=b*g(g(_*A)+g(y*w)),m[o>>2]=b*g(g(y*A)-g(_*w)),h=h+8|0,(0|t)==(0|(e=e+1|0)))break}if(G(R,f),(0|v)>=4)for(t=(0|p)>1?p:1,e=0,o=(E(l-1|0,a)<<2)+r|0,l=0-(s=a<<1)<<2;;){if(_=m[f+4>>2],A=m[(e+p<<2)+S>>2],b=m[f>>2],y=m[(e<<2)+S>>2],m[r>>2]=g(_*A)-g(b*y),m[o>>2]=g(A*b)+g(_*y),f=f+8|0,o=o+l|0,r=(s<<2)+r|0,(0|t)==(0|(e=e+1|0)))break}M=C}(b,(E(a,h)<<2)+A|0,(a+p<<2)+i|0,u[e+60>>2],f,v,t,c),(0|(a=a+1|0))==(0|t))break}if((0|S)==(0|(_=_+1|0)))break}if(!((0|n)!=1|(0|o)!=2|(0|l)<1))for(a=0;;){if(m[(t=(a<<2)+i|0)>>2]=g(m[t>>2]*g(.5))+g(m[(a+l<<2)+i>>2]*g(.5)),(0|l)==(0|(a=a+1|0)))break}if((0|s)!=1)for(h=(0|n)>1?n:1,p=(0|l)/(0|s)|0,f=l-p<<2,y=g(0|s),e=0;;){if(A=E(e,l),a=0,(0|p)>=1)for(;;){if(m[(t=(a+A<<2)+i|0)>>2]=m[t>>2]*y,(0|p)==(0|(a=a+1|0)))break}if(ex((p+A<<2)+i|0,0,f),(0|h)==(0|(e=e+1|0)))break}}function eP(e,t,r){var i=0,n=0,o=0;r=(i=u[e+28>>2])>>>r|0,i=i-r|0;t:{if(!t){r=i;break t}u[e+32>>2]=u[e+32>>2]+i}if(u[e+28>>2]=r,r>>>0<=8388608)for(t=u[e+32>>2];;){o=t>>>23|0;o:{if((0|o)!=255){if(r=t>>>31|0,(0|(i=u[e+40>>2]))>=0&&(t=-1,n=u[e+24>>2],A[e+4>>2]>n+u[e+8>>2]>>>0&&(u[e+24>>2]=n+1,s[u[e>>2]+n|0]=r+i,t=0),u[e+44>>2]=u[e+44>>2]|t),t=u[e+36>>2])for(n=r-1|0;;){if(r=-1,i=u[e+24>>2],A[e+4>>2]>i+u[e+8>>2]>>>0&&(u[e+24>>2]=i+1,s[u[e>>2]+i|0]=n,r=0,t=u[e+36>>2]),t=t-1|0,u[e+36>>2]=t,u[e+44>>2]=u[e+44>>2]|r,!t)break}u[e+40>>2]=255&o,r=u[e+28>>2],t=u[e+32>>2];break o}u[e+36>>2]=u[e+36>>2]+1}if(r<<=8,u[e+28>>2]=r,t=t<<8&0x7fffff00,u[e+32>>2]=t,u[e+20>>2]=u[e+20>>2]+8,!(r>>>0<8388609))break}}function eD(e,t,r,i,n){var o=0,a=0,c=0,d=0,h=0,p=0,f=0;if((0|n)>=1)for(;;){tE(u[(p=(h<<2)+t|0)>>2]),a=e+h|0,o=(c=E((tE(u[p>>2])<<16)-0x82a0000>>16,2251))>>>16|0,s[0|a]=o,s[0|r]>c<<8>>24&&(o=o+1|0,s[0|a]=o),c=(o=o<<24>>24>0?o:0)<<24>>24<63?o:63,s[0|a]=c,o=s[0|r];n:{if(!(i|h)){d=o-4|0,c&=255,o=(0|o)>67?63:(0|c)<(0|d)?d:c,s[0|a]=o,s[0|r]=o;break n}o=c-o|0,s[0|a]=o,c=s[0|r]+8|0,(0|c)<(0|(d=o<<24>>24))&&(o=((d-c|0)+1>>>1|0)+c|0,s[0|a]=o),o=(o=o<<24>>24>-4?o:-4)<<24>>24<36?o:36,s[0|a]=o,f=r,d=o<<24>>24;s:{if((0|d)>(0|c)){o=l[0|r]+((d<<1)-c|0)|0,s[0|r]=o,o=o<<24>>24<63?o:63;break s}o=l[0|r]+o|0}s[0|f]=o,s[0|a]=l[0|a]+4,o=l[0|r]}if(a=(E(a=o<<24>>24,7281)>>16)+E(a,29)|0,u[p>>2]=th(((0|a)<1877?a:1877)+2090|0),(0|(h=h+1|0))==(0|n))break}}function eL(e,t,r,i){t:if(!(t>>>0>20)){switch(t-9|0){case 0:t=u[r>>2],u[r>>2]=t+4,u[e>>2]=u[t>>2];return;case 1:t=u[r>>2],u[r>>2]=t+4,r=(t=u[t>>2])>>31,u[e>>2]=t,u[e+4>>2]=r;return;case 2:t=u[r>>2],u[r>>2]=t+4,r=u[t>>2],u[e>>2]=r,u[e+4>>2]=0;return;case 3:t=u[r>>2]+7&-8,u[r>>2]=t+8,r=u[t+4>>2],t=u[t>>2],u[e>>2]=t,u[e+4>>2]=r;return;case 4:t=u[r>>2],u[r>>2]=t+4,t=(r=d[t>>1])>>31,u[e>>2]=r,u[e+4>>2]=t;return;case 5:t=u[r>>2],u[r>>2]=t+4,t=_[t>>1],u[e>>2]=t,u[e+4>>2]=0;return;case 6:t=u[r>>2],u[r>>2]=t+4,t=(r=s[0|t])>>31,u[e>>2]=r,u[e+4>>2]=t;return;case 7:t=u[r>>2],u[r>>2]=t+4,t=l[0|t],u[e>>2]=t,u[e+4>>2]=0;return;case 8:t=u[r>>2]+7&-8,u[r>>2]=t+8,v[e>>3]=v[t>>3];return;case 9:break;default:break t}tK[0|i](e,r)}}function eM(e){var t,r,i=0,n=0,o=0,s=0,d=0,u=0,l=0,p=0,f=0,_=0,A=0;h(+e),n=0|a[1],s=0|a[0],d=n;t:{;r:{i:{n:if(((0|n)>0?!1:!((0|n)>=0))||!((i=d)>>>0>1048575)){if(!((i=0x7fffffff&(n=d))|s))return -1/(e*e);if((0|(i=d))>-1)break i;return(e-e)/0}if(i>>>0>0x7fefffff)break t;if(n=0x3ff00000,u=-1023,(0|i)!=0x3ff00000){n=i;break r}if(s)break r;return 0}h(+(0x40000000000000*e)),n=0|a[1],s=0|a[0],u=-1077}p=.6931471803691238*(o=+(((i=n+614242|0)>>>20|0)+u|0)),i=(1048575&i)+0x3fe6a09e|0|(n=0),t=0|s,a[0]=t,r=0|i,a[1]=r,f=e=+c[0]+-1,_=19082149292705877e-26*o,A=o=e/(e+2),l=.5*e*e,o*=o,e=o*o,e=p+(f+(_+A*(l+(e*(e*(.15313837699209373*e+.22222198432149784)+.3999999999940942)+o*(e*(e*(.14798198605116586*e+.1818357216161805)+.2857142874366239)+.6666666666666735)))-l))}return e}function ex(e,t,r){var i=0,n=0,o=0,a=0,c=0;t:if(r){if(s[(i=e+r|0)-1|0]=t,s[0|e]=t,r>>>0<3)break t;if(s[i-2|0]=t,s[e+1|0]=t,s[i-3|0]=t,s[e+2|0]=t,r>>>0<7)break t;if(s[i-4|0]=t,s[e+3|0]=t,r>>>0<9)break t;if(i=(n=0-e&3)+e|0,t=E(255&t,0x1010101),u[i>>2]=t,u[(r=(n=r-n&-4)+i|0)-4>>2]=t,n>>>0<9)break t;if(u[i+8>>2]=t,u[i+4>>2]=t,u[r-8>>2]=t,u[r-12>>2]=t,n>>>0<25)break t;if(u[i+24>>2]=t,u[i+20>>2]=t,u[i+16>>2]=t,u[i+12>>2]=t,u[r-16>>2]=t,u[r-20>>2]=t,u[r-24>>2]=t,u[r-28>>2]=t,(r=n-(a=4&i|24)|0)>>>0<32)break t;for(o=tM(t,0,1,1),c=n=x,t=i+a|0;;){if(u[t+24>>2]=o,n=c,u[t+28>>2]=n,u[t+16>>2]=o,u[t+20>>2]=n,u[t+8>>2]=o,u[t+12>>2]=n,u[t>>2]=o,u[t+4>>2]=n,t=t+32|0,!((r=r-32|0)>>>0>31))break}}return e}function eU(e,t,r,i,n,o){var a=0,s=0,c=0,u=0,l=0,h=0,p=0;t:{r:{if((0|n)>5){if(1&n)break r;if((0|i)<(0|n))break t;if((0|i)>(0|n))for(p=(0|n)<7,o=n;;){if(c=(s=(h=o<<1)+t|0)-2|0,u=((((E(d[r+2>>1],d[s-4>>1])+E(d[r>>1],d[c>>1])|0)+E(d[r+4>>1],d[s-6>>1])|0)+E(d[r+6>>1],d[s-8>>1])|0)+E(d[r+8>>1],d[s-10>>1])|0)+E(d[r+10>>1],d[s-12>>1])|0,a=6,!p)for(;;){if(u=(E(d[(l=a<<1)+r>>1],d[c-l>>1])+u|0)+E(d[(2|l)+r>>1],d[((-1^a)<<1)+c>>1])|0,!((0|(a=a+2|0))<(0|n)))break}if(a=(0|(a=((d[s>>1]<<12)-u>>11)+1>>1))>-32768?a:-32768,d[e+h>>1]=(0|a)<32767?a:32767,(0|(o=o+1|0))==(0|i))break}ex(e,0,n<<1);return}tO(16065,16090,67),k()}tO(16117,16090,68),k()}tO(16148,16090,69),k()}function eB(e,t,r){var i=0,n=0,o=0,a=0;if(n=t<<4,i=u[(r<<2)+e>>2],(0|r)!=8){if((0|r)>=1)for(t=t<<20>>16,o=(n>>15)+1>>1;;){if(i=u[((n=r-1|0)<<2)+e>>2]+((E(i>>16,t)+E(i,o)|0)+(E(65535&i,t)>>16)|0)|0,a=(0|r)>1,r=n,!a)break}return i}return r=t<<20>>16,t=(n>>15)+1>>1,i=u[e+28>>2]+((E(r,i>>16)+E(i,t)|0)+(E(65535&i,r)>>16)|0)|0,i=((u[e+24>>2]+E(t,i)|0)+E(i>>16,r)|0)+(E(65535&i,r)>>16)|0,i=((u[e+20>>2]+E(i,t)|0)+E(i>>16,r)|0)+(E(65535&i,r)>>16)|0,i=((u[e+16>>2]+E(i,t)|0)+E(i>>16,r)|0)+(E(65535&i,r)>>16)|0,i=((u[e+12>>2]+E(i,t)|0)+E(i>>16,r)|0)+(E(65535&i,r)>>16)|0,i=((u[e+8>>2]+E(i,t)|0)+E(i>>16,r)|0)+(E(65535&i,r)>>16)|0,i=((u[e+4>>2]+E(i,t)|0)+E(i>>16,r)|0)+(E(65535&i,r)>>16)|0,((u[e>>2]+E(i,t)|0)+E(i>>16,r)|0)+(E(65535&i,r)>>16)|0}function eV(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0,d=0,u=0;if(M=a=M-400|0,r>>>0<=24){for(;;){if(n=(i<<4)+a|0,o=+m[(i<<2)+t>>2],v[n>>3]=o,v[n+8>>3]=o,n=(0|r)!=(0|i),i=i+1|0,!n)break}if(r)for(t=0,d=r;;){n=((t=(i=t)+1|0)<<4)+a|0,s=v[a+8>>3],o=-v[n>>3]/(s>9999999717180685e-25?s:9999999717180685e-25),m[(i<<2)+e>>2]=o;o:if(!((0|r)<=(0|i))){if(c=v[n>>3],v[n>>3]=c+o*s,v[a+8>>3]=s+o*c,i=1,(0|d)==1)break o;for(;;){if(u=n=(t+i<<4)+a|0,s=v[n>>3],c=v[(n=(i<<4)+a|0)+8>>3],v[u>>3]=s+o*c,v[n+8>>3]=c+o*s,(0|d)==(0|(i=i+1|0)))break}}if(d=d-1|0,(0|t)==(0|r))break}return M=a+400|0,g(o=v[a+8>>3])}tO(9497,9557,44),k()}function eF(e,t,r,i,n,o,a,s,c){var d=g(0),u=0,l=0;l=(0|n)/(0|(u=48e3/(0|c)|0))|0;t:{if((0|a)!=1){if(n=0,(0|l)<=0)break t;for(;;){if(c=n<<3,d=g((d=m[(E(n,u)<<2)+s>>2])*d),d=g(g(d*i)+g(g(g(1)-d)*r)),m[c+t>>2]=m[e+c>>2]*d,m[(c|=4)+t>>2]=m[e+c>>2]*d,(0|l)==(0|(n=n+1|0)))break}break t}if((0|l)<1)break t;for(n=0;;){if(c=n<<2,d=g((d=m[(E(n,u)<<2)+s>>2])*d),m[c+t>>2]=m[e+c>>2]*g(g(d*i)+g(g(g(1)-d)*r)),(0|l)==(0|(n=n+1|0)))break}}for(u=(0|a)>1?a:1,s=0;;){if((0|o)>(0|(n=l)))for(;;){if(m[(c=E(n,a)+s<<2)+t>>2]=m[e+c>>2]*i,(0|o)==(0|(n=n+1|0)))break}if((0|u)==(0|(s=s+1|0)))break}}function ej(e,t,r,i){var n=0,o=0,a=0;t:{if((0|(n=u[e+284>>2]))<=(0|i)){if((0|(a=u[e+292>>2]))>(0|n))break t;o=e+168|0,n=n-a<<1,ev(o+(a<<1)|0,r,n);i:{switch(u[e+264>>2]-1|0){case 0:(function(e,t,r,i){ek(e,t,r,i)})(e,t,o,u[e+284>>2]),function(e,t,r,i){ek(e,t,r,i)}(e,(u[e+288>>2]<<1)+t|0,r+n|0,i-u[e+284>>2]|0);break i;case 1:eb(e,t,o,u[e+284>>2]),eb(e,(u[e+288>>2]<<1)+t|0,r+n|0,i-u[e+284>>2]|0);break i;case 2:Y(e,t,o,u[e+284>>2]),Y(e,(u[e+288>>2]<<1)+t|0,r+n|0,i-u[e+284>>2]|0);break i;default:break}ev(ev(t,o,u[e+284>>2]<<1)+(u[e+288>>2]<<1)|0,r+n|0,i-u[e+284>>2]<<1)}return ev(o,(i-(e=u[e+292>>2])<<1)+r|0,e<<1),0}tO(6521,6474,184),k()}tO(6561,6474,186),k()}function eG(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0;t:{if((0|r)>0){if(i=1,1&r)break t;if(o=d[t>>1],o=(n=131072/(((0|(n=d[t+2>>1]-o|0))>1?n:1)>>>0)|0)+(131072/(((0|o)>1?o:1)>>>0)|0)|0,d[e>>1]=o>>>0<32767?o:32767,a=r-1|0,(0|r)>=3)for(;;){if(c=(r=i<<1)+e|0,n=n+(r=131072/(((0|(r=d[(s=(o=r+2|0)+t|0)>>1]-d[t+r>>1]|0))>1?r:1)>>>0)|0)|0,d[c>>1]=n>>>0<32767?n:32767,r=(n=131072/(((0|(n=d[((i=i+2|0)<<1)+t>>1]-d[s>>1]|0))>1?n:1)>>>0)|0)+r|0,d[e+o>>1]=r>>>0<32767?r:32767,!((0|i)<(0|a)))break}e=(i=a<<1)+e|0,i=(131072/(((0|(i=32768-d[t+i>>1]|0))>1?i:1)>>>0)|0)+n|0,d[e>>1]=i>>>0<32767?i:32767;return}tO(15465,15489,51),k()}tO(15519,15489,52),k()}function eW(e,t,r){var i=0,n=0,o=0,a=0,c=0;t:{if(r>>>0>1){if((i=r-1|0)>>>0>=256){if(ew(e,r=t>>>(n=24-b(i)|0)|0,r+1|0,(i>>>n|0)+1|0),!n)break t;c=(-1<<n^-1)&t,t=u[e+12>>2],i=n+(r=u[e+16>>2])|0;n:{if(i>>>0<33){o=r;break n}for(;;){if(i=-1,a=u[e+4>>2],a>>>0>(o=u[e+8>>2])+u[e+24>>2]>>>0&&(i=o+1|0,u[e+8>>2]=i,s[u[e>>2]+(a-i|0)|0]=t,i=0),u[e+44>>2]=u[e+44>>2]|i,t=t>>>8|0,i=(0|r)>15,r=o=r-8|0,!i)break}i=n+o|0}u[e+16>>2]=i,u[e+12>>2]=c<<o|t,u[e+20>>2]=u[e+20>>2]+n;return}ew(e,t,t+1|0,r);return}tO(6995,7019,180),k()}tO(7033,7019,198),k()}function eH(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0,l=0;if(d=o=M,M=o=o-(((c=E(t,r))<<2)+15&-16)|0,(0|r)>0){r:{if(!i){for(a=(0|t)<1;;){if(!a)for(s=E(t,n),i=0;;){if(u[(i+s<<2)+o>>2]=u[(E(r,i)+n<<2)+e>>2],(0|(i=i+1|0))==(0|t))break}if((0|(n=n+1|0))==(0|r))break}break r}for(l=(r<<2)+41976|0,a=(0|t)<1;;){if(!a)for(s=E(u[(n<<2)+l>>2],t),i=0;;){if(u[(i+s<<2)+o>>2]=u[(E(r,i)+n<<2)+e>>2],(0|(i=i+1|0))==(0|t))break}if((0|(n=n+1|0))==(0|r))break}}ev(e,o,c<<2),M=d;return}tO(41952,41800,591),k()}function eY(e,t,r,i){var n=g(0),o=g(0),a=0,s=g(0),c=0;t:{if(r-1>>>0<2){if(3&i)break t;if((0|i)>=1)for(n=g(g(3.1415927410125732)/g(i+1|0)),s=g(g(2)-g(n*n)),n=(r=(0|r)<2)?n:g(s*g(.5)),o=r?g(0):g(1);;){if(m[(r=c<<2)+e>>2]=g(o+n)*g(m[t+r>>2]*g(.5)),m[(a=4|r)+e>>2]=n*m[t+a>>2],a=8|r,o=g(g(s*n)-o),m[a+e>>2]=g(n+o)*g(m[t+a>>2]*g(.5)),m[(r|=12)+e>>2]=o*m[t+r>>2],n=g(g(s*o)-n),!((0|(c=c+4|0))<(0|i)))break}return}tO(9375,9424,48),k()}tO(9459,9424,51),k()}function eK(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0;l=i-1|0,s=31-(h=b(i))|0;t:{if((0|i)<2){o=i;break t}for(o=i;;){if(c=d[(2|(a=n<<1))+r>>1],a=d[r+a>>1],o=(E(c,c)+E(a,a)>>>s|0)+o|0,!((0|l)>(0|(n=n+2|0))))break}n=-2&i}if(a=0,(0|i)>(0|n)&&(o=(E(n=d[(n<<1)+r>>1],n)>>>s|0)+o|0),s=(0|(n=34-(b(o)+h|0)|0))>0?n:0,(0|i)<2)n=0;else{for(n=0;;){if(c=d[(2|(o=n<<1))+r>>1],o=d[r+o>>1],a=(E(c,c)+E(o,o)>>>s|0)+a|0,!((0|l)>(0|(n=n+2|0))))break}n=-2&i}(0|n)<(0|i)&&(a=(E(r=d[(n<<1)+r>>1],r)>>>s|0)+a|0),u[t>>2]=s,u[e>>2]=a}function eQ(e,t,r,i){var n=0,o=0,s=0,c=0,d=g(0),l=0,p=g(0),f=0,_=0,A=0,m=0,E=0;if((s=S(n=+t))<1e-6)return e;if(!(.5*(c=+(0|r))<s)){t=g(e*t),r=u[i>>2],d=g(g(S(g((n+n)/c)))*g(u[i+4>>2])),p=g(R(d));i:{if(g(S(p))<g(0x80000000)){i=~~p;break i}i=-0x80000000}s=v[(r=r+(i<<3)|0)+8>>3],c=v[r>>3],A=v[r+16>>3],l=v[r+24>>3],m=function(e){var t=0,r=0;M=t=M-16|0,h(+e),r=0|a[1],a[0],r&=0x7fffffff;t:{if(r>>>0<=0x3fe921fb){if(r>>>0<0x3e500000)break t;e=tm(e,0,0);break t}if(r>>>0>=0x7ff00000){e-=e;break t}switch(3&en(e,t)){case 0:e=tm(v[t>>3],v[t+8>>3],1);break t;case 1:e=tb(v[t>>3],v[t+8>>3]);break t;case 2:e=-tm(v[t>>3],v[t+8>>3],1);break t;default:break}e=-tb(v[t>>3],v[t+8>>3])}return M=t+16|0,e}(n=3.141592653589793*+t)*+e/n,t=g(d-g(0|i)),e=g(t*t),f=.1666666667*(o=+g(t*e)),E=l*(_=f-.1666666667*(n=+t)),o=(l=.5*+e)+n-.5*o,d=g(m*(E+(A*o+(c*(n=l+-.3333333333*n-f)+s*(1-_-o-n)))))}return d}function ez(e,t,r,i,n,o,a){var s=0,c=0,l=g(0),h=0,p=0,f=0,A=g(0),v=0,S=0,b=0,T=0,y=0;for(v=(0|n)>1?n:1,S=u[e+44>>2]<<o,h=u[e+32>>2];;){if((0|i)>=1)for(b=E(s,S),T=E(u[e+8>>2],s),c=_[h>>1],a=0;;){if(n=c<<16,l=g(0),c=d[((p=a+1|0)<<1)+h>>1],n>>=16,(0|(f=c-n<<o))>=1)for(y=((n<<o)+b<<2)+t|0,n=0;;){if(l=g(l+g((A=m[(n<<2)+y>>2])*A)),(0|f)==(0|(n=n+1|0)))break}if(m[(a+T<<2)+r>>2]=C(g(l+g(10000000272452012e-43))),(0|(a=p))==(0|i))break}if((0|v)==(0|(s=s+1|0)))break}}function eX(e,t,r){var i=0;t:if(!(tC(e=ex(e,0,20216),t)||tC(e+10064|0,t))){return u[e+20192>>2]=1,u[e+20196>>2]=1,u[r>>2]=1,u[r+4>>2]=1,u[r+8>>2]=u[e+4556>>2],u[r+12>>2]=u[e+4564>>2],u[r+16>>2]=u[e+4568>>2],u[r+20>>2]=u[e+4572>>2],u[r+24>>2]=u[e+4612>>2],u[r+28>>2]=u[e+4608>>2],u[r+32>>2]=u[e+4616>>2],u[r+36>>2]=u[e+4624>>2],u[r+40>>2]=u[e+6088>>2],u[r+48>>2]=u[e+6076>>2],u[r+52>>2]=u[e+4676>>2],i=u[e+4576>>2],u[r+72>>2]=E(i<<16>>16,1e3),u[r+76>>2]=u[e+4536>>2],t=0,t=(0|i)==16?!u[e+28>>2]:t,u[r+80>>2]=t,0}tO(17487,17507,85),k()}function eJ(e){var t=0,r=0,i=0,n=0,o=0;t:{h(+e),t=0|a[1],a[0],i=t,t&=0x7fffffff;r:{if(t>>>0>=0x408ff000){if(!((0|i)<0|t>>>0<0x40900000))return 898846567431158e293*e;if(t>>>0>=0x7ff00000)return -1/e;if(e<=-1075^1)break t;if(r=0,(0|(t=i))<-1?1:(0|t)<=-1)break r;break t}if(t>>>0>0x3c8fffff)break t;r=e+1}return r}return h(+(r=e+0x180000000000)),a[1],n=v[(i=(t=(0|a[0])+128|0)<<4&4080)+11024>>3],to(n+n*(e=e-(r+-0x180000000000)-v[(8|i)+11024>>3])*(e*(e*(e*(.0013333559164630223*e+.009618129842126066)+.0555041086648214)+.2402265069591)+.6931471805599453),(-256&t)/256|0)}function eq(e,t,r,i,n){var o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0;if((0|n)>=2){for(n>>=1,f=(0|n)>1?n:1,o=u[t+4>>2],a=u[t>>2],n=0;;){if(h=(c=(E(65535&(c=(l=d[(2|(s=n<<2))+e>>1]<<10)-o|0),10788)>>>16|0)+E(c>>16,10788)|0)+o|0,a=(o=d[e+s>>1]<<10)-a|0,p=n<<1,o=h+(s=(E(a>>16,-24290)+(E(65535&a,-24290)>>16)|0)+o|0)|0,d[p+r>>1]=(0|o)>0x3fffbff?32767:(0|o)<-0x4000400?-32768:(o>>>10|0)+1>>>1|0,o=h-s|0,d[i+p>>1]=(0|o)>0x3fffbff?32767:(0|o)<-0x4000400?-32768:(o>>>10|0)+1>>>1|0,o=c+l|0,a=a+s|0,(0|f)==(0|(n=n+1|0)))break}u[t+4>>2]=o,u[t>>2]=a}}function eZ(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,h=0;if(t=(r=u[e+28>>2])>>>t|0,!(a=t>>>0>(i=u[e+32>>2])>>>0)&&(i=i-t|0,u[e+32>>2]=i),r=a?t:r-t|0,u[e+28>>2]=r,r>>>0<=8388608)for(n=u[e+24>>2],c=u[e+40>>2],s=u[e+20>>2],h=u[e+4>>2];;){if(d=r<<8,u[e+28>>2]=d,s=s+8|0,u[e+20>>2]=s,t=0,n>>>0<h>>>0&&(o=n+1|0,u[e+24>>2]=o,t=l[u[e>>2]+n|0],n=o),u[e+40>>2]=t,i=(i<<8&0x7fffff00|(c<<8|t)>>>1&255)^255,u[e+32>>2]=i,o=r>>>0<32769,c=t,r=d,!o)break}return a}function e$(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,d=0;if(i=E(n=u[e+36>>2],i-r|0),o=u[e+32>>2]-i|0,u[e+32>>2]=o,r=t?E(r-t|0,n):u[e+28>>2]-i|0,u[e+28>>2]=r,r>>>0<=8388608)for(i=u[e+24>>2],n=u[e+40>>2],s=u[e+20>>2],d=u[e+4>>2];;){if(c=r<<8,u[e+28>>2]=c,s=s+8|0,u[e+20>>2]=s,t=0,i>>>0<d>>>0&&(a=i+1|0,u[e+24>>2]=a,t=l[u[e>>2]+i|0],i=a),u[e+40>>2]=t,o=(o<<8&0x7fffff00|(n<<8|t)>>>1&255)^255,u[e+32>>2]=o,a=r>>>0<32769,n=t,r=c,!a)break}}function e0(e,t,r,i){var n=0,o=0,a=0,c=0;M=o=M-16|0,n=-4;t:if(!((0|r)<1)){r:{if(!u[e+4>>2]){s[0|e]=l[0|t],u[e+296>>2]=function(e,t){if(128&(e=l[0|e]))return(t<<(e>>>3&3))/400|0;if((96&e)==96)return 8&e?(0|t)/50|0:(0|t)/100|0;return(0|(e=e>>>3&3))==3?(0|E(t,60))/1e3|0:(t<<e)/100|0}(t,8e3);break r}if((l[0|t]^l[0|e])>>>0>3)break t}if((0|(a=function(e,t){var r=0;if(r=1,(0|t)<1)return -1;r:{switch((3&l[0|e])-1|0){case 0:case 1:return 2;case 2:break;default:break r}if(r=-4,(0|t)<2)break r;r=63&l[e+1|0]}return r}(t,r)))<1)break t;if(c=u[e+4>>2],(0|E(u[e+296>>2],c+a|0))>960||(0|(n=function(e,t,r,i,n,o,a,c){var h=0,p=0,f=0,A=0,m=0,v=0,g=0,S=0,b=0,T=0,y=0,R=0;S=-1;t:if(!(!o|(0|t)<0)){if(S=-4,!t)break t;b=l[0|e];r:{if(128&b){A=(48e3<<(b>>>3&3)>>>0)/400|0;break r}if(A=8&b?960:480,(96&b)==96)break r;if(A=2880,(0|(p=b>>>3&3))==3)break r;A=(48e3<<p>>>0)/100|0}f=1,p=e+1|0,m=h=t-1|0,T=v=3&b;n:{o:{a:{s:{switch(0|v){case 1:if(r){f=2,v=1,T=0,m=h;break a}if(1&h)break t;m=h>>>1|0,d[o>>1]=m,f=2,T=0;break o;case 2:if((0|t)<=1)return d[o>>1]=65535,-4;if((v=l[0|p])>>>0>=252){if(f=2,(0|t)<=2)return d[o>>1]=65535,-4;v=(l[e+2|0]<<2)+v|0}if(d[o>>1]=v,(0|v)>(0|(h=h-f|0)))break t;m=h-v|0,p=p+f|0,v=0,f=2,T=0;break s;case 0:break s;default:break}if((0|t)<2||!(f=63&(g=l[e+1|0]))|E(f,A)>>>0>5760)break t;v=e+2|0,t=t-2|0,T=0;p:{if(!(64&g)){p=v;break p}for(;;){if((0|t)<1)break t;if(T=T+(p=((m=(0|(p=l[0|v]))==255)?-2:p)&255)|0,t=(-1^p)+t|0,v=p=v+1|0,!m)break}if((0|t)<0)break t}if(v=g>>>7^1,128&g){if(f>>>0<2){h=t,m=t;break s}for(R=f-1|0,g=0,m=t,h=t;;){if(y=(g<<1)+o|0,(0|h)<=0)return d[y>>1]=65535,-4;if(A=1,(t=l[0|p])>>>0>=252){if((0|h)<=1)return d[y>>1]=65535,-4;A=2,t=(l[p+1|0]<<2)+t|0}if(d[y>>1]=t,(0|(h=h-A|0))<(0|t))break t;if(p=p+A|0,m=(m-A|0)-t|0,(0|R)==(0|(g=g+1|0)))break}if((0|m)>=0)break s;break t}if(r){m=h,h=t;break a}if((0|E(m=(0|t)/(0|f)|0,f))!=(0|t))break t;if(f>>>0<2)break o;for(A=f-1|0,h=0;;){if(d[(h<<1)+o>>1]=m,(0|A)==(0|(h=h+1|0)))break}h=t}if(!r)break o}A=((f<<1)+o|0)-2|0,t=65535,r=-1;eb:if(!((0|h)<1)){if((g=l[0|p])>>>0<252){t=g,r=1;break eb}if(r=-1,(0|h)<2)break eb;t=(l[p+1|0]<<2)+g|0,r=2}if(d[A>>1]=t,(0|(A=t<<16>>16))<0||(0|A)>(0|(h=h-r|0)))break t;if(p=r+p|0,v){if((0|E(f,A))>(0|h))break t;if(f>>>0<2)break n;if(d[o>>1]=t,t=1,(0|(S=f-1|0))==1)break n;for(r=(S<<1)+o|0;;){if(d[(t<<1)+o>>1]=_[r>>1],(0|S)==(0|(t=t+1|0)))break}break n}if((r+A|0)>(0|m))break t;break n}if((0|m)>1275)break t;d[((f<<1)+o|0)-2>>1]=m}if(f)for(t=0;;){if(n&&(u[(t<<2)+n>>2]=p),p=d[(t<<1)+o>>1]+p|0,(0|f)==(0|(t=t+1|0)))break}i&&(s[0|i]=b),S=f}return S}(t,r,i,o+15|0,((c<<2)+e|0)+8|0,((c<<1)+e|0)+200|0,0,0)))<1)break t;u[e+4>>2]=u[e+4>>2]+a,n=0}return M=o+16|0,n}function e2(e){var t=0,r=0,i=0;M=t=M-16|0,h(+e),i=0|a[1],a[0],i&=0x7fffffff;t:{if(i>>>0<=0x3fe921fb){if(r=1,i>>>0<0x3e46a09e)break t;r=tb(e,0);break t}if(r=e-e,i>>>0>=0x7ff00000)break t;switch(3&en(e,t)){case 0:r=tb(v[t>>3],v[t+8>>3]);break t;case 1:r=-tm(v[t>>3],v[t+8>>3],1);break t;case 2:r=-tb(v[t>>3],v[t+8>>3]);break t;default:break}r=tm(v[t>>3],v[t+8>>3],1)}return M=t+16|0,r}function e1(e,t,r,i){var n=0,o=0,a=0,s=0,c=0,l=0,h=0;if((0|i)>=2){for(i>>=1,h=(0|i)>1?i:1,n=u[e+4>>2],o=u[e>>2],i=0;;){if(c=(s=(E((o=(s=d[(a=i<<2)+r>>1]<<10)-o|0)>>16,-25727)+(E(65535&o,-25727)>>16)|0)+s|0)+n|0,l=((c=c+(n=(E(65535&(n=(a=d[(2|a)+r>>1]<<10)-n|0),9872)>>>16|0)+E(n>>16,9872)|0)|0)>>10)+1>>1,d[(i<<1)+t>>1]=(0|c)>0x3fffbff?32767:(0|l)>-32768?l:-32768,n=n+a|0,o=o+s|0,(0|h)==(0|(i=i+1|0)))break}u[e+4>>2]=n,u[e>>2]=o}}function e4(e,t,r){var i=0,n=0,o=0,a=0,c=0;if(r){a=u[e+12>>2],i=(o=u[e+16>>2])+r|0;r:{if(i>>>0<33){n=o;break r}for(;;){if(i=-1,c=u[e+4>>2],c>>>0>(n=u[e+8>>2])+u[e+24>>2]>>>0&&(i=n+1|0,u[e+8>>2]=i,s[u[e>>2]+(c-i|0)|0]=a,i=0),u[e+44>>2]=u[e+44>>2]|i,a=a>>>8|0,i=(0|o)>15,o=n=o-8|0,!i)break}i=r+n|0}u[e+16>>2]=i,u[e+12>>2]=t<<n|a,u[e+20>>2]=u[e+20>>2]+r;return}tO(7033,7019,198),k()}function e6(e,t,r){var i=0,n=0,o=0,a=0,s=g(0),c=0,d=0,u=g(0),l=g(0),h=0,p=0;if(a=1,(0|r)>=1)for(;;){if(s=m[(c=o<<2)+t>>2],0x7ffffffe&(d=o+1|0))for(h=a>>>1|0,i=0;;){if(p=n=(i<<2)+e|0,u=m[n>>2],l=m[(n=((-1^i)+o<<2)+e|0)>>2],m[p>>2]=u+g(s*l),m[n>>2]=l+g(s*u),(0|h)==(0|(i=i+1|0)))break}if(m[e+c>>2]=-s,a=a+1|0,(0|(o=d))==(0|r))break}}function e3(e,t,r){var i=0,n=0,o=g(0),a=g(0),s=0,c=0,d=0,u=0;if((0|r)>=1)for(s=(0|(i=t>>1))>1?i:1,c=r<<1,i=0,d=(0|t)<2;;){if(t=0,!d)for(;;){if(u=n=(E(t,c)+i<<2)+e|0,o=g(m[n>>2]*g(.7071067690849304)),a=g(m[(n=(E(t<<1|1,r)+i<<2)+e|0)>>2]*g(.7071067690849304)),m[u>>2]=o+a,m[n>>2]=o-a,(0|s)==(0|(t=t+1|0)))break}if((0|(i=i+1|0))==(0|r))break}}function e8(e,t){var r=0;t:{r:{if((0|(r=s[t+5|0]+E(s[t+2|0],5)|0))<25){if(eR(e,r,5776,8),(0|(r=s[0|t]))>=3)break r;if(s[t+1|0]>=5)break t;if(eR(e,r,5854,8),eR(e,s[t+1|0],5861,8),(0|(r=s[t+3|0]))>2)break r;if(s[t+4|0]>4)break t;eR(e,r,5854,8),eR(e,s[t+4|0],5861,8);return}tO(7150,7175,44),k()}tO(7201,7175,47),k()}tO(7236,7175,48),k()}function e5(e,t){var r=0;!function(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,A=0,m=0,v=0,g=0,S=0,T=0,y=0,R=0;if(h=n=M-48|0,M=n,(0|(r=u[e+4584>>2]))<321){if((-8&r)==(0|r)){if(u[h>>2]=0,s=(i=r>>3)+(a=r>>2)|0,u[h+4>>2]=s,c=i+s|0,u[h+8>>2]=c,l=a+c|0,u[h+12>>2]=l,M=o=n-(((A=r>>1)+l<<1)+15&-16)|0,eq(t,e+36|0,o,(l<<1)+o|0,u[e+4584>>2]),eq(o,e+44|0,o,(c<<1)+o|0,A),eq(o,e+52|0,o,(s<<1)+o|0,a),c=d[(i=((n=i-1|0)<<1)+o|0)>>1]>>1,d[i>>1]=c,(0|r)>=16)for(i=c;;){if(t=r=((a=n-1|0)<<1)+o|0,r=d[r>>1]>>1,d[t>>1]=r,d[(n<<1)+o>>1]=i-r,s=(0|n)>1,i=r,n=a,!s)break}for(n=e+92|0,d[o>>1]=_[o>>1]-_[n>>1],d[e+92>>1]=c;;){r=u[e+4584>>2],A=(n=p<<2)+(h+32|0)|0,l=u[(l=(g=e+n|0)+60|0)>>2],u[A>>2]=l,v=(0|(f=r>>((i=4-p|0)>>>0<3?i:3)))>3;a:{if(!v){t=(0|l)>-1?l:0x7fffffff,n=0;break a}for(a=(0|(c=f>>2))>1?c:1,s=u[(m=n+h|0)>>2],n=0,r=0;;){if(r=E(i=d[(n+s<<1)+o>>1]>>3,i)+r|0,(0|a)==(0|(n=n+1|0)))break}if(t=(0|(n=r+l|0))>-1?n:0x7fffffff,n=0,!v)break a;for(s=u[m>>2],r=0;;){if(r=E(i=d[((n+c|0)+s<<1)+o>>1]>>3,i)+r|0,(0|a)==(0|(n=n+1|0)))break}if(t=(0|(n=t+r|0))>-1?n:0x7fffffff,n=0,f=(0|f)<4)break a;for(s=c<<1,l=u[m>>2],r=0;;){if(r=E(i=d[((n+s|0)+l<<1)+o>>1]>>3,i)+r|0,(0|a)==(0|(n=n+1|0)))break}if(t=(0|(n=t+r|0))>-1?n:0x7fffffff,n=0,f)break a;for(s=E(c,3),c=u[m>>2],r=0;;){if(n=E(i=d[((r+s|0)+c<<1)+o>>1]>>3,i)+n|0,(0|a)==(0|(r=r+1|0)))break}}if(r=(n>>>1|0)+t|0,u[A>>2]=(0|r)>-1?r:0x7fffffff,u[g+60>>2]=n,(0|(p=p+1|0))==4)break}n=0,(0|(r=u[e+144>>2]))<=999&&(u[e+144>>2]=r+1,n=32767/((r>>4)+1|0)|0),r=128,o=0x7fffffff/(0|(a=(0|(i=(f=u[h+32>>2])+u[e+128>>2]|0))>-1?i:0x7fffffff))|0,i=128,s=u[e+96>>2];q:if(!(s<<3<(0|a))){if(i=1024,(0|a)<(0|s))break q;i=(i=(E(i=s<<16>>16,o>>16)+E((s>>15)+1>>1,o)|0)+(E(65535&o,i)>>16)|0)>>16<<11|i>>>5&2047}t=a=e+112|0,o=o-(a=u[e+112>>2])|0,i=(E(i=((0|i)>(0|n)?i:n)<<16>>16,o>>16)+a|0)+(E(65535&o,i)>>16)|0,u[t>>2]=i,o=(0|(i=0x7fffffff/(0|i)|0))<0xffffff?i:0xffffff,u[e+96>>2]=o,i=0x7fffffff/(0|(a=(0|(i=(v=u[h+36>>2])+u[e+132>>2]|0))>-1?i:0x7fffffff))|0,s=u[e+100>>2];Z:if(!(s<<3<(0|a))){if(r=1024,(0|a)<(0|s))break Z;r=(r=(E(r=s<<16>>16,i>>16)+E((s>>15)+1>>1,i)|0)+(E(65535&i,r)>>16)|0)>>16<<11|r>>>5&2047}t=a=e+116|0,i=i-(a=u[e+116>>2])|0,r=(E(r=((0|r)>(0|n)?r:n)<<16>>16,i>>16)+a|0)+(E(65535&i,r)>>16)|0,u[t>>2]=r,r=0x7fffffff/(0|r)|0,u[e+100>>2]=(0|r)<0xffffff?r:0xffffff,a=0x7fffffff/(0|(s=(0|(r=(m=u[h+40>>2])+u[e+136>>2]|0))>-1?r:0x7fffffff))|0,r=128,i=128,c=u[e+104>>2];p:if(!(c<<3<(0|s))){if(i=1024,(0|s)<(0|c))break p;i=(i=(E(i=c<<16>>16,a>>16)+E((c>>15)+1>>1,a)|0)+(E(65535&a,i)>>16)|0)>>16<<11|i>>>5&2047}t=s=e+120|0,a=a-(s=u[e+120>>2])|0,i=(E(i=((0|i)>(0|n)?i:n)<<16>>16,a>>16)+s|0)+(E(65535&a,i)>>16)|0,u[t>>2]=i,i=0x7fffffff/(0|i)|0,u[e+104>>2]=(0|i)<0xffffff?i:0xffffff,i=0x7fffffff/(0|(a=(0|(i=(S=u[h+44>>2])+u[e+140>>2]|0))>-1?i:0x7fffffff))|0,s=u[e+108>>2];$:if(!(s<<3<(0|a))){if(r=1024,(0|a)<(0|s))break $;r=(r=(E(r=s<<16>>16,i>>16)+E((s>>15)+1>>1,i)|0)+(E(65535&i,r)>>16)|0)>>16<<11|r>>>5&2047}for(n=((0|r)>(0|n)?r:n)<<16>>16,i=i-(r=u[e+124>>2])|0,a=e+124|0,n=(E(i>>16,n)+r|0)+(E(65535&i,n)>>16)|0,u[a>>2]=n,n=0x7fffffff/(0|n)|0,u[e+108>>2]=(0|n)<0xffffff?n:0xffffff,i=f,s=0,a=0,n=0;;){r=i-o|0;f:{if((0|r)>=1){if(c=n<<2,i=(((l=i>>>0<8388608)?i<<8:i)|0)/((l?o:o>>8)+1|0)|0,u[c+(h+16|0)>>2]=i,a=(l=E(i=(tE(i)<<16)-0x4000000>>16,i))+a|0,(0|r)<=1048575){l=0-(t=24-(o=b(r))|0)|0,p=r;_:if(t){if(p=r<<l|r>>>56-o,r>>>0<=127)break _;p=r<<o+8|r>>>t}g=E(127&p,0xd50000)>>>16|0,A=E((p=(1&o?32768:46214)>>>(o>>>1)|0)+(E(p,g)>>>16|0)>>>10|0,i);en:if(t){if(r>>>0<=127){r=r<<l|r>>>56-o;break en}r=r<<o+8|r>>>t}i=E((E(E(127&r,0xd50000)>>>16|0,p)>>>16|0)+p<<6&65472,i)+(A<<16)>>16}s=(E((r=u[c+1936>>2])>>16,i)+s|0)+(E(65535&r,i)>>16)|0;break f}u[(h+16|0)+(n<<2)>>2]=256}if((0|(n=n+1|0))!=4){i=u[(r=n<<2)+(h+32|0)>>2],o=u[(e+r|0)+96>>2];continue}break}if(n=(0|a)/4|0,r=-128,(0|a)>=4){i=24-(r=b(n))|0;eN:if(i){if(n>>>0<=127){n=n<<0-i|n>>>56-r;break eN}n=n<<r+8|n>>>i}t=E(127&n,0xd50000)>>>16|0,r=(E(E((n=(1&r?32768:46214)>>>(r>>>1)|0)+(E(n,t)>>>16|0)|0,196608)>>16,45e3)>>16)-128|0}n=tp(r),u[e+4712>>2]=(tp(s)<<1)-32768,r=u[e+4584>>2],i=u[e+4576>>2],o=(((v-u[e+100>>2]>>4<<1)+(f-u[e+96>>2]>>4)|0)+E(m-u[e+104>>2]>>4,3)|0)+(S-u[e+108>>2]>>4<<2)>>((0|r)==(0|E(i,20)));eL:{if((0|o)<=0){n>>=1;break eL}if((0|o)>16383)break eL;n=n<<16>>16,o=((s=(1&(o=b(a=o<<16))?32768:46214)>>>(o>>>1)|0)+(E((T=0,y=E(127&tD(a,o+8|0),0xd50000)>>>16|0,(R=(0|o)==24)?T:y),s)>>>16|0)|0)+32768|0,n=(E(n,65535&o)>>16)+E(o>>>16|0,n)|0}return o=n>>7,u[e+4532>>2]=(0|o)<255?o:255,t=o=e+76|0,o=u[e+76>>2],a=u[h+16>>2]-o|0,n=E(n<<16>>16,n)>>((0|E(i,10))==(0|r)?21:20),r=(E(n,a>>16)+o|0)+(E(65535&a,n)>>16)|0,u[t>>2]=r,u[e+4696>>2]=tp(E(tE(r),3)-5120>>4),t=r=e+80|0,r=u[e+80>>2],r=(E((i=u[h+20>>2]-r|0)>>16,n)+r|0)+(E(65535&i,n)>>16)|0,u[t>>2]=r,u[e+4700>>2]=tp(E(tE(r),3)-5120>>4),t=r=e+84|0,r=u[e+84>>2],r=(E((i=u[h+24>>2]-r|0)>>16,n)+r|0)+(E(65535&i,n)>>16)|0,u[t>>2]=r,u[e+4704>>2]=tp(E(tE(r),3)-5120>>4),t=r=e+88|0,r=u[e+88>>2],n=(E((i=u[h+28>>2]-r|0)>>16,n)+r|0)+(E(65535&i,n)>>16)|0,u[t>>2]=n,u[e+4708>>2]=tp(E(tE(n),3)-5120>>4),M=h+48|0}tO(1846,1835,106),k()}tO(1776,1835,104),k()}(e,e+5098|0),r=u[e+4532>>2];t:{r:{i:{if(!t){if((0|r)<13)break i;u[e+4532>>2]=12;break i}if((0|r)>12)break r}if(t=0,s[e+4765|0]=0,r=u[e+6084>>2],u[e+6084>>2]=r+1,(0|r)>=10){if((0|r)<30)break t;u[e+6084>>2]=10}u[e+6080>>2]=0;break t}u[e+6080>>2]=0,u[e+6084>>2]=0,t=1,s[e+4765|0]=1}s[(u[e+5748>>2]+e|0)+4720|0]=t}function e9(e,t,r,i,n,o){var a=0,s=0,c=0,d=0;for(c=(0|o)>1?o:1;;){if((0|t)>=1)for(d=E(u[e+8>>2],a),o=0;;){if(m[(s=o+d<<2)+n>>2]=g(1.4426950408889634*eM(+m[i+s>>2]))-m[(o<<2)+32928>>2],(0|(o=o+1|0))==(0|t))break}if((0|t)<(0|r))for(s=E(u[e+8>>2],a),o=t;;){if(u[(o+s<<2)+n>>2]=-0x3ea00000,(0|(o=o+1|0))==(0|r))break}if((0|c)==(0|(a=a+1|0)))break}}function e7(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0;if((0|r)>3){for(s=r-3|0;;){if(o=4|(i=n<<2),c=+m[e+i>>2]*+m[t+i>>2]+ +m[e+o>>2]*+m[t+o>>2],o=8|i,i|=12,a+=c+ +m[o+e>>2]*+m[t+o>>2]+ +m[i+e>>2]*+m[t+i>>2],!((0|s)>(0|(n=n+4|0))))break}n=-4&r}if((0|r)>(0|n))for(;;){if(a+=+m[(i=n<<2)+e>>2]*+m[t+i>>2],(0|(n=n+1|0))==(0|r))break}return a}function te(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0;if(n=r>>16,o=t-1|0,(0|t)>=2)for(s=r-65536|0,t=0;;){if(c=i=(t<<2)+e|0,a=(i=u[i>>2])<<16>>16,u[c>>2]=((E(a,65535&r)>>16)+E(n,a)|0)+E((i>>15)+1>>1,r),n=(r=((E(r,s)>>15)+1>>1)+r|0)>>16,(0|o)==(0|(t=t+1|0)))break}e=t=(o<<2)+e|0,i=(t=u[t>>2])<<16>>16,u[e>>2]=((E(i,65535&r)>>16)+E(i,n)|0)+E((t>>15)+1>>1,r)}function tt(e,t,r,i){var n=0,o=0,a=0;if((0|(n=d[r+2>>1]))>=1)for(o=u[r+24>>2]+((0|E(65535&n,i))/2|0)|0,i=0;;){if(n=l[0|o],d[(i<<1)+e>>1]=E(n>>>1&7,9),s[t+i|0]=l[u[r+20>>2]+(E(d[r+2>>1]-1|0,1&n)+i|0)|0],d[((a=1|i)<<1)+e>>1]=E(n>>>5|0,9),s[t+a|0]=l[u[r+20>>2]+(E(d[r+2>>1]-1|0,n>>>4&1)+a|0)|0],o=o+1|0,!((0|(i=i+2|0))<d[r+2>>1]))break}}function tr(e,t){var r=0,i=0,n=0,o=0,a=0,s=0;n=u[e+12>>2],r=u[e+16>>2];t:{if(r>>>0>=t>>>0){a=r;break t}for(i=u[e+8>>2],s=u[e+4>>2];;){if(o=0,i>>>0<s>>>0&&(i=i+1|0,u[e+8>>2]=i,o=l[u[e>>2]+(s-i|0)|0]),n=o<<r|n,o=(0|r)<17,r=a=r+8|0,!o)break}}return u[e+16>>2]=a-t,u[e+12>>2]=n>>>t,u[e+20>>2]=u[e+20>>2]+t,(-1<<t^-1)&n}function ti(e,t,r){var i=0,n=0,o=0,a=0;if(a=65532&r)for(;;){if(m[(o=(i=n<<2)+e|0)>>2]=m[o>>2]*t,m[(o=(4|i)+e|0)>>2]=m[o>>2]*t,m[(o=(8|i)+e|0)>>2]=m[o>>2]*t,m[(i=(12|i)+e|0)>>2]=m[i>>2]*t,!(a>>>0>(n=n+4|0)>>>0))break}if((0|r)>(0|n))for(;;){if(m[(i=(n<<2)+e|0)>>2]=m[i>>2]*t,(0|(n=n+1|0))==(0|r))break}}function tn(e,t){var r=0,i=0,n=0,o=0,a=0,s=0;if((0|t)>3){for(s=t-3|0;;){if(n=(r=+m[(o=i<<2)+e>>2])*r,n+=(r=+m[(4|o)+e>>2])*r,n+=(r=+m[(8|o)+e>>2])*r,a+=n+(r=+m[(12|o)+e>>2])*r,!((0|s)>(0|(i=i+4|0))))break}i=-4&t}if((0|t)>(0|i))for(;;){if(a+=(r=+m[(i<<2)+e>>2])*r,(0|(i=i+1|0))==(0|t))break}return a}function to(e,t){var r;t:{if((0|t)>=1024){if(e*=898846567431158e293,(0|t)<2047){t=t-1023|0;break t}e*=898846567431158e293,t=((0|t)<3069?t:3069)-2046|0;break t}if((0|t)>-1023)break t;if(e*=22250738585072014e-324,(0|t)>-2045){t=t+1022|0;break t}e*=22250738585072014e-324,t=((0|t)>-3066?t:-3066)+2044|0}return t=t+1023<<20,a[0]=0,r=0|t,a[1]=r,e*+c[0]}function ta(e,t,r,i,n){var o=0,a=0,s=0,c=0,l=0;if((0|n)>=1)for(o=u[e>>2],a=d[i+2>>1],s=d[i>>1],i=0;;){if(o=(d[(i<<1)+r>>1]<<8)+o|0,u[(i<<2)+t>>2]=o,l=u[e+4>>2],o<<=2,c=65532&o,o>>=16,u[e+4>>2]=(E(c,a)>>16)+E(a,o),o=(E(o,s)+l|0)+(E(s,c)>>16)|0,u[e>>2]=o,(0|n)==(0|(i=i+1|0)))break}}function ts(e,t,r){var i=0,n=0;M=i=M-304|0,n=-1;t:if(!((0|t)<1)){if(n=0,(0|t)==(0|r))break t;if(n=-1,(0|t)>(0|r))break t;if(u[i+4>>2]=0,n=e0(i,eC((e+r|0)-t|0,e,t),t,0))break t;n=(t=ea(i,0,u[i+4>>2],e,r,0,1))&t>>31}return M=i+304|0,n}function tc(e,t,r,i,n){var o=0,a=0,s=0;t:{if((0|i)>-1){if((0|i)>4)break t;if((0|n)>0)for(;;){if(s=_[(a=o<<1)+t>>1],d[e+a>>1]=(E(_[r+a>>1]-s<<16>>16,i)>>>2|0)+s,(0|(o=o+1|0))==(0|n))break}return}tO(15552,15584,45),k()}tO(15603,15584,46),k()}function td(e,t,r){var i=0;t:{r:if(i=(0|e)!=48e3,!(((0|t)==960?!i:0)|((0x7fffffff&t)==480?!i:0))){if(e=(0|e)!=48e3,((0x3fffffff&t)==240?!e:0)|((0x1fffffff&t)==120?!e:0))break r;if(t=0,!r)break t;u[r>>2]=-1;break t}if(t=17996,!r)break t;return u[r>>2]=0,17996}return t}function tu(e,t){var r=0,i=0;return e?t>>>0>=0xffffffc0?(u[tY()>>2]=48,0):(r=function(e,t){var r=0,i=0,n=0,o=0,a=0,s=0,c=0,d=0,l=0;i=3&(a=u[e+4>>2]),r=(o=-8&a)+e|0;r:{if(!i){if(i=0,t>>>0<256||t+4>>>0<=o>>>0&&(i=e,o-t>>>0<=u[13352]<<1>>>0))break r;return 0}o:{if(t>>>0<=o>>>0){if((i=o-t|0)>>>0<16)break o;u[e+4>>2]=1&a|t|2,u[(t=e+t|0)+4>>2]=3|i,u[r+4>>2]=1|u[r+4>>2],J(t,i);break o}if(i=0,u[13238]==(0|r)){if((r=u[13235]+o|0)>>>0<=t>>>0)break r;u[e+4>>2]=1&a|t|2,i=e+t|0,t=r-t|0,u[i+4>>2]=1|t,u[13235]=t,u[13238]=i;break o}if(u[13237]==(0|r)){if((r=u[13234]+o|0)>>>0<t>>>0)break r;i=r-t|0;d:{if(i>>>0>=16){u[e+4>>2]=1&a|t|2,u[(t=e+t|0)+4>>2]=1|i,u[(r=e+r|0)>>2]=i,u[r+4>>2]=-2&u[r+4>>2];break d}u[e+4>>2]=1&a|r|2,u[(t=e+r|0)+4>>2]=1|u[t+4>>2],i=0,t=0}u[13237]=t,u[13234]=i;break o}if(2&(n=u[r+4>>2])||(s=(-8&n)+o|0)>>>0<t>>>0)break r;d=s-t|0;l:{if(n>>>0<=255){if(i=u[r+12>>2],r=u[r+8>>2],o=((n=n>>>3|0)<<3)+52968|0,(0|r)==(0|i)){u[13232]=u[13232]&tD(-2,n);break l}u[r+12>>2]=i,u[i+8>>2]=r;break l}c=u[r+24>>2],n=u[r+12>>2];Z:{if((0|n)!=(0|r)){i=u[r+8>>2],u[i+12>>2]=n,u[n+8>>2]=i;break Z}ee:if(!(o=u[(i=r+20|0)>>2])&&!(o=u[(i=r+16|0)>>2])){n=0;break Z}for(;;){if(l=i,o=u[(i=(n=o)+20|0)>>2])continue;if(i=n+16|0,!(o=u[n+16>>2]))break}u[l>>2]=0}if(!c)break l;i=((o=u[r+28>>2])<<2)+53232|0;et:{if(u[i>>2]==(0|r)){if(u[i>>2]=n,n)break et;u[13233]=u[13233]&tD(-2,o);break l}if(u[(u[c+16>>2]==(0|r)?16:20)+c>>2]=n,!n)break l}if(u[n+24>>2]=c,(i=u[r+16>>2])&&(u[n+16>>2]=i,u[i+24>>2]=n),!(r=u[r+20>>2]))break l;u[n+20>>2]=r,u[r+24>>2]=n}if(d>>>0<=15){u[e+4>>2]=1&a|s|2,u[(t=e+s|0)+4>>2]=1|u[t+4>>2];break o}u[e+4>>2]=1&a|t|2,u[(t=e+t|0)+4>>2]=3|d,u[(r=e+s|0)+4>>2]=1|u[r+4>>2],J(t,d)}i=e}return i}(e-8|0,t>>>0<11?16:t+11&-8))?r+8|0:(r=V(t))?(i=(3&(i=u[e-4>>2])?-4:-8)+(-8&i)|0,ev(r,e,t>>>0>i>>>0?i:t),X(e),r):0:V(t)}function tl(e,t,r){var i=g(0),n=0,o=0;n=t-1|0;t:{if((0|t)<2){i=r;break t}for(t=0,i=r;;){if(m[(o=(t<<2)+e|0)>>2]=i*m[o>>2],i=g(i*r),(0|n)==(0|(t=t+1|0)))break}}m[(t=(n<<2)+e|0)>>2]=i*m[t>>2]}function th(e){var t=0,r=0,i=0;t=0;t:if(!((0|e)<0)){if(t=0x7fffffff,(0|e)>3966)break t;t=127&e,i=1<<(r=e>>>7|0),e=(0|e)<=2047?(E(E(128-t|0,t),-174)>>16)+t<<r>>7:E((E(E(128-t|0,t),-174)>>16)+t|0,i>>>7|0),t=i+e|0}return t}function tp(e){var t=0;t:{if((0|e)<=-1){if(t=0,(0|e)<-191)break t;return u[(t=(e=0-e|0)>>>3&0x1ffffffc)+1024>>2]-E(d[t+1056>>1],31&e)|0}if(t=32767,(0|e)>191)break t;t=E(d[(t=e>>>3&0x1ffffffc)+1056>>1],31&e)+u[t+1088>>2]|0}return t}function tf(e,t,r,i,n){var o=0;if(M=o=M-256|0,!(73728&n|(0|r)<=(0|i))){if(ex(o,255&t,(i=(r=r-i|0)>>>0<256)?r:256),!i)for(;;){if(tV(e,o,256),!((r=r-256|0)>>>0>255))break}tV(e,o,r)}M=o+256|0}function t_(e,t,r){var i=0,n=0,o=0;if(M=i=M+-64|0,(0|r)>=1)for(;;){if(u[(o=n<<2)+i>>2]=tL(g(m[t+o>>2]*g(65536))),(0|(n=n+1|0))==(0|r))break}!function(e,t,r){var i=0,n=0,o=0,a=0,s=0,c=0,l=0,h=0,p=0,f=0,A=0,m=0,v=0,E=0,g=0,S=0,b=0;M=a=M-144|0,u[a+12>>2]=a+16,u[a+8>>2]=a+80,ey(t,a+80|0,a+16|0,h=r>>1),A=a+80|0,(0|(i=eB(a+80|0,v=d[7560],h)))<=-1&&(d[e>>1]=0,A=a+16|0,i=eB(a+16|0,v,h),m=1);r:for(;;){for(c=1,l=v;;){n:{E=eB(A,n=d[(b=c<<1)+15120>>1],h);o:{a:{if(s=(0|i)>0,!((0|i)<0|(0-o|0)<(0|E)?!((0|o)<=(0|E)?!s:0):0)){f=eB(A,p=((o=n+l|0)>>1)+(1&o)|0,h);d:{u:if(!s){if(o=-256,(0|f)<=-1)break u;s=p,g=f;break d}g=(o=(0|f)<1&(0|i)>-1)?f:E,i=o?i:f,s=o?p:n,l=o?l:p,o=o?-256:-128}if((0|(n=eB(A,f=((n=s+l|0)>>1)+(1&n)|0,h)))<=-1|(0|i)>0)break a;g=n,s=f;break o}if(s=(0|c)<128,o=0,l=n,i=E,c=c+1|0,s)continue;if(S>>>0>=16){if(i=32768/(r+1|0)|0,d[e>>1]=i,c=2,(0|r)<2)break n;if(i<<=1,d[e+2>>1]=i,(0|r)==2)break n;for(;;){if(i=_[e>>1]+i|0,d[(c<<1)+e>>1]=i,(0|(c=c+1|0))==(0|r))break}break n}if(te(t,r,(-2<<S)+65536|0),ey(t,a+80|0,a+16|0,h),m=0,A=a+80|0,S=c=S+1|0,(0|(i=eB(a+80|0,v,h)))>-1)continue r;d[e>>1]=0,m=1,A=a+16|0,i=eB(a+16|0,v,h),S=c;continue r}g=(p=(0|n)<1&(0|i)>-1)?n:g,i=p?i:n,l=p?l:f,o=p?o:64|o,s=p?f:s}n=eB(A,((n=l+s|0)>>1)+(1&n)|0,h);q:{if(!((0|n)<=-1|(0|i)>0)){s=n;break q}s=(l=(0|n)<1&(0|i)>-1)?n:g,i=l?i:n,o=l?o:o+32|0}n=i-s|0,s=i>>31;p:{if((s^i+s)>=65536){o=((0|i)/(n>>5)|0)+o|0;break p}if(!n)break p;o=(((i<<5)+(n>>1)|0)/(0|n)|0)+o|0}if(i=(c<<8)+o|0,d[(m<<1)+e>>1]=(0|i)<32767?i:32767,(0|(m=m+1|0))>=(0|r))break n;o=!E,i=4096-(m<<12&8192)|0,l=d[b+15118>>1],A=u[(a+8|0)+((1&m)<<2)>>2];continue}break}break}M=a+144|0}(e,i,r),M=i- -64|0}function tA(e){var t=0,r=0;t=u[13136],e=t+(r=e+3&-4)|0;t:if(!((e>>>0<=t>>>0?(0|r)>=1:0)||function(){return o.byteLength/65536|0}()<<16>>>0<e>>>0&&!(0|w(0|e)))){return u[13136]=e,t}return u[tY()>>2]=48,-1}function tm(e,t,r){var i=0,n=0,o=0;return(o=(i=e*e)*i*i*(158969099521155e-24*i+-25050760253406863e-24)+(i*(27557313707070068e-22*i+-1984126982985795e-19)+.00833333333332249),n=i*e,r)?e-(i*(.5*t-n*o)-t+.16666666666666632*n):n*(i*o+-.16666666666666632)+e}function tv(e,t){var r=0,i=0,n=0;r=0;r:if(e){if(i=tM(e,0,t,0),n=x,r=i,(e|t)>>>0<65536)break r;r=n?-1:i}return!(!(e=V(i=r))|!(3&l[e-4|0]))&&ex(e,0,i),e}function tE(e){var t=0,r=0;r=24-(t=b(e))|0;t:if(r){if(e>>>0<=127){e=e<<0-r|e>>>56-t;break t}e=e<<t+8|e>>>r}return((e&=127)-(t<<7)+(E(E(128-e|0,e),179)>>>16)|0)+3968|0}function tg(e){var t=0,r=0,i=0,n=0,o=0;for(i=1<<(r=31-b(e)>>1);;){if(o=t=(n<<1)+i<<r,t=e>>>0<t>>>0,e=e-(t?0:o)|0,n=(t?0:i)+n|0,t=(0|r)>0,i=i>>>1|0,r=r-1|0,!t)break}return n}function tS(e,t,r){u[e+24>>2]=0,u[e+28>>2]=-0x80000000,u[e+16>>2]=0,u[e+20>>2]=33,u[e+8>>2]=0,u[e+12>>2]=0,u[e>>2]=t,u[e+32>>2]=0,u[e+36>>2]=0,u[e+40>>2]=-1,u[e+44>>2]=0,u[e+4>>2]=r}function tb(e,t){var r=0,i=0,n=0,o=0;return o=1-(n=1-(i=.5*(r=e*e)))-i,i=r*r,n+(o+(r*(r*(r*(2480158728947673e-20*r+-.001388888888887411)+.0416666666666666)+i*i*(r*(-11359647557788195e-27*r+2087572321298175e-24)+-27557314351390663e-23))-e*t))}function tT(e,t,r,i){var n=0,o=0;if((0|(n=(0|r)<(0|i)?r:i))>=1)for(i=0;;){if(m[(o=i<<2)+e>>2]=e7(t,t+o|0,r-i|0),(0|n)==(0|(i=i+1|0)))break}}function ty(e){var t=0,r=0,i=0;if(tH(s[u[e>>2]]))for(;;){if(i=s[0|(t=u[e>>2])],u[e>>2]=t+1,r=(E(r,10)+i|0)-48|0,!tH(s[t+1|0]))break}return r}function tR(e){var t=0,r=0,i=0;return r=u[e+20>>2]<<3,t=b(e=u[e+28>>2]),i=e=e>>>16-t|0,(((r+(t<<3)|0)-(i>>>0>A[((e=(e>>>12|0)-8|0)<<2)+32816>>2])|0)-e|0)-256|0}function tI(e,t){var r=0,i=0;(r=u[e+8>>2])+u[e+24>>2]>>>0>t>>>0&&(tO(7097,7019,238),k()),eC(((i=u[e>>2])+t|0)-r|0,(u[e+4>>2]+i|0)-r|0,r),u[e+4>>2]=t}function tC(e,t){var r,i;return u[(e=ex(e,0,10064))+5092>>2]=t,t=tE(3932160),u[e+4664>>2]=1,t=(t<<8)-524288|0,u[e+12>>2]=t,u[e+8>>2]=t,i=0,u[(i=r=e+36|0)>>2]=0,u[i+4>>2]=0,u[i+56>>2]=0,u[i+60>>2]=5e3,u[i+32>>2]=0,u[i+36>>2]=0,u[i+24>>2]=0,u[i+28>>2]=0,u[i+16>>2]=0,u[i+20>>2]=0,u[i+8>>2]=0,u[i+12>>2]=0,u[i+96>>2]=25,u[i+100>>2]=16,u[i+80>>2]=858993,u[i+84>>2]=1342177,u[(i=i- -64|0)>>2]=2500,u[i+4>>2]=1600,u[(i=r)+104>>2]=12,u[i+108>>2]=15,u[i+88>>2]=1789569,u[i+92>>2]=50,u[i+72>>2]=1200,u[i+76>>2]=429496,u[i+40>>2]=25600,u[i+44>>2]=25600,u[i+48>>2]=25600,u[i+52>>2]=25600,0}function tk(e,t){var r=0;return r=A[e+28>>2]/(t>>>0)|0,u[e+36>>2]=r,r=(-1^(e=A[e+32>>2]/(r>>>0)|0))+t|0,t=(e=e+1|0)-t|0,r+(e>>>0<t>>>0?0:t)|0}function tw(e,t){var r=0,i=0;if((0|t)>=1)for(;;){if(i=s[e+r|0]+(i<<8)|0,(0|(r=r+1|0))==(0|t))break}return i}function tO(e,t,r){var i=0;M=i=M-16|0,u[i+8>>2]=e,u[i+4>>2]=r,u[i>>2]=t,function(e,t,r){var i=0;M=i=M-16|0,u[i+12>>2]=r,r=function(e,t,r){return function(e,t,r,i,n){var o=0,a=0,c=0;M=o=M-208|0,u[o+204>>2]=r,r=0,ex(o+160|0,0,40),u[o+200>>2]=u[o+204>>2];t:{if((0|j(0,t,o+200|0,o+80|0,o+160|0,i,n))<0){t=-1;break t}u[e+76>>2]>=0&&(r=function(e){return 1}(e)),a=u[e>>2],s[e+74|0]<=0&&(u[e>>2]=-33&a),a&=32;o:{if(u[e+48>>2]){n=j(e,t,o+200|0,o+80|0,o+160|0,i,n);break o}if(u[e+48>>2]=80,u[e+16>>2]=o+80,u[e+28>>2]=o,u[e+20>>2]=o,c=u[e+44>>2],u[e+44>>2]=o,n=t=j(e,t,o+200|0,o+80|0,o+160|0,i,n),!c)break o;tK[u[e+36>>2]](e,0,0),u[e+48>>2]=0,u[e+44>>2]=c,u[e+28>>2]=0,u[e+16>>2]=0,i=u[e+20>>2],u[e+20>>2]=0,n=i?t:-1}if(i=u[e>>2],u[e>>2]=a|i,t=n,t=32&i?-1:t,!r)break t}return M=o+208|0,t}(e,t,r,0,0)}(e,t,r),M=i+16|0}(u[278],1616,i),k(),k()}function tN(e){var t=0;return E(((u[(t=td(48e3,960,0))+4>>2]<<2)+(u[t+8>>2]<<4)|0)+4096|0,e)+244|0}function tP(e,t){var r=0;return(0|e)<=251?(s[0|t]=e,1):(r=-4|e,s[0|t]=r,s[t+1|0]=e-(255&r)>>>2,2)}function tD(e,t){var r=0;return(-1>>>(r=31&t)&e)<<r|(-1<<(t=0-t&31)&e)>>>t}function tL(e){return g(S(e=function(e){return function(e){var t=g(0),r=g(0);if(t=g(R(e)),!((r=g(e-t))<g(.5))){if(e=g(I(e)),r>g(.5))return e;r=g(t*g(.5)),t=g(r-g(R(r)))==g(0)?t:e}return t}(e)}(e)))<g(0x80000000)?~~e:-0x80000000}function tM(e,t,r,i){var n,o,a,s,c,d;return n=e,o=t,a=r,s=i,c=0,d=0,s=(E(c=a>>>16|0,d=n>>>16|0)+E(o,a)|0)+E(s,n)|0,a&=65535,n&=65535,x=(s=s+((a=((o=E(a,n))>>>16|0)+E(a,d)|0)>>>16|0)|0)+((a=E(n,c)+(65535&a)|0)>>>16|0)|0,i=65535&o|a<<16}function tx(e,t,r,i){ek(e,t,r,i)}function tU(e){return e?(u[tY()>>2]=e,-1):0}function tB(e){return e?31-b(e-1^e)|0:32}function tV(e,t,r){!(32&l[0|e])&&!function(e,t,r){var i=0,n=0,o=0;i=u[r+16>>2];t:{if(!i){if(function(e){var t=0;return(t=l[e+74|0],s[e+74|0]=t|t-1,8&(t=u[e>>2]))?(u[e>>2]=32|t,-1):(u[e+4>>2]=0,u[e+8>>2]=0,t=u[e+44>>2],u[e+28>>2]=t,u[e+20>>2]=t,u[e+16>>2]=u[e+48>>2]+t,0)}(r))break t;i=u[r+16>>2]}if(i-(o=u[r+20>>2])>>>0<t>>>0)return 0|tK[u[r+36>>2]](r,e,t);o:{if(s[r+75|0]<0){i=0;break o}for(n=t;;){if(!(i=n)){i=0;break o}if(10==l[(n=i-1|0)+e|0])break}if((n=0|tK[u[r+36>>2]](r,e,i))>>>0<i>>>0)break t;e=e+i|0,t=t-i|0,o=u[r+20>>2]}ev(o,e,t),u[r+20>>2]=u[r+20>>2]+t,n=t+i|0};}(t,r,e)}function tF(e,t){return e?function(e,t,r){r=1;t:{if(e){if(t>>>0<=127)break t;i:{if(!u[u[function(){return 52696}()+172>>2]>>2]){if((-128&t)==57216)break t;break i}if(t>>>0<=2047)return s[e+1|0]=63&t|128,s[0|e]=t>>>6|192,2;if(!((-8192&t)!=57344?t>>>0>=55296:0))return s[e+2|0]=63&t|128,s[0|e]=t>>>12|224,s[e+1|0]=t>>>6&63|128,3;if(t-65536>>>0<=1048575)return s[e+3|0]=63&t|128,s[0|e]=t>>>18|240,s[e+2|0]=t>>>6&63|128,s[e+1|0]=t>>>12&63|128,4}u[tY()>>2]=25,r=-1}return r}return s[0|e]=t,1}(e,t,0):0}function tj(e,t){eR(e,t,5801,8)}function tG(e){return u[e>>2]=20216,0}function tW(e){ex(e+12|0,0,13992)}function tH(e){return e-48>>>0<10}function tY(){return 52924}r=0,n(t=l,1025,"QAAAbCIAAEIPAAASBgAATQIAANs="),n(t,1056,"7QAAAJkAAABJAAAAHgAAAAwAAAAH"),n(t,1089,"QAAAk10AAL1wAADteQAAsn0AACR/AABIzQAALSsgICAwWDB4AChudWxsKQAAAAARAAoAERERAAAAAAUAAAAAAAAJAAAAAAsAAAAAAAAAABEADwoREREDCgcAAQAJCwsAAAkGCwAACwAGEQAAABEREQ=="),n(t,1217,"CwAAAAAAAAAAEQAKChEREQAKAAACAAkLAAAACQALAAAL"),n(t,1275,"DA=="),n(t,1287,"DAAAAAAMAAAAAAkMAAAAAAAMAAAM"),n(t,1333,"Dg=="),n(t,1345,"DQAAAAQNAAAAAAkOAAAAAAAOAAAO"),n(t,1391,"EA=="),n(t,1403,"DwAAAAAPAAAAAAkQAAAAAAAQAAAQAAASAAAAEhIS"),n(t,1458,"EgAAABISEgAAAAAAAAk="),n(t,1507,"Cw=="),n(t,1519,"CgAAAAAKAAAAAAkLAAAAAAALAAAL"),n(t,1565,"DA=="),n(t,1577,"DAAAAAAMAAAAAAkMAAAAAAAMAAAMAAAwMTIzNDU2Nzg5QUJDREVGRmF0YWwgKGludGVybmFsKSBlcnJvciBpbiAlcywgbGluZSAlZDogJXMKAGFzc2VydGlvbiBmYWlsZWQ6IDAAY2VsdC9jZWx0LmMAAAAAAAAAAJ0+AEBePgDABD4AgO0+AECJPgAAAAAAwEw/AADNPQ=="),n(t,1745,"/wD/AP8A/wD/AP4BAAH/AP4A/QIAAf8A/gD9AwAB/2Fzc2VydGlvbiBmYWlsZWQ6IE1BWF9GUkFNRV9MRU5HVEggPj0gcHNFbmNDLT5mcmFtZV9sZW5ndGgAc2lsay9WQUQuYwBhc3NlcnRpb24gZmFpbGVkOiBwc0VuY0MtPmZyYW1lX2xlbmd0aCA9PSA4ICogc2lsa19SU0hJRlQoIHBzRW5jQy0+ZnJhbWVfbGVuZ3RoLCAzICkAAAAAAAAwdQAAcBcAACDR//8g0f//YXNzZXJ0aW9uIGZhaWxlZDogZW5jQ29udHJvbCAhPSBOVUxMAHNpbGsvY2hlY2tfY29udHJvbF9pbnB1dC5jAGFzc2VydGlvbiBmYWlsZWQ6IDA="),n(t,2048,"/fr06dS2loN4bmJVSDwxKCAZEw8NCwkIBwYFBAMCAQDS0M7Lx8G3qI5oSjQlGxQOCgYEAg=="),n(t,2112,"38m3p5iKfG9iWE9GPjgyLCcjHxsYFRIQDgwKCAYEAwIBALywm4p3YUMrGgoApXdQPS8jGxQOCQQAcT8AAAAAAAwjPFNshJ20zuQPIDdNZX2Xr8nhEypCWXKJorjR5gwZMkhheJOsyN8aLEVacoeftM3hDRY1UGqCnLTN5A8ZLEBac46oxN4TGD5SZHiRqL7WFh8yT2d4l6rL4xUdLUFqfJarxOAeMUtheY6lutHlExk0Rl10j6bA2xoiPkthdpGnwtkZIThGW3GPpcTfFSIzSGF1kavE3hQdMkNadZCoxd0WHzBCX3WSqMTeGCEzTXSGnrTI4BUcRldqfJWqwtkaITVAU3WYrczhGyJBX2yBm67S4RQaSGNxg5qwyNsiKz1OXXKbsc3lFx02YXyKo7PR5R4mOFl2gZ6yyOcVHTE/VW+Oo8HeGzBNZ4Wes8TX6B0vSmN8l7DG3O0hKj1MXXmbrs/hHTVXcIiaqrzQ4xgeNFSDlqa6y+UlMEBUaHacscnmUQsKCQoJCgnvCO8ICgn8CBcJ7whICxQKWgk/CQoJ4gjiCOII4giSCLcJJAkkCQoJCgkKCSQJJAk/CTIJkAzOCiQJJAkKCeIIrQifCNUIkgicCaoJPwlaCVoJWglaCT8JZwkKCZcN8AtPCJ8I4gjiCOII7wgKCdUI0gxFDBQKWgnHCK0InwiSCJIIQggAEAUPrQg8CjwKZwkKCVoJPwkaCGoMrAw/Ca0I+QmCCSQJCgl3CK0ICg2gDaYKkgjVCJwJMgk/CZ8INQgyCXQJFwk/CVoJdAl0CXQJnAk/CcMOLQ6CCd8JPwniCOII/AifCAAItgyZDJkKHguPCRcJ/Aj8COIITwi/DOQMwQr2Co8J1QjVCMcITwg1CDkLpQtJCj8JZwkyCZIIxwjHCEIImQx9DEkKFAriCIUIxwitCK0IXQhqDO4MtApnCeII4gjiCO8IkghCCEUMyAycCQ0I7wjECT8JtwmCCYUIsw3SDAoJjApXCqoJPwlaCSQJTwhfDc8N3gvwC/wIngetCOII4gjiCEwNJg0nCH8KOQsyCXQJ4giqCewJsA6gDZ4HZApRC98JWgk/CZwJ1QjUC8gMtApIC7QKaghPCO8IugjHCG8OSQ7pB7EHZAqMChQKxAkXCT8JhwxVDTIJGghIC0gLJAm3CccIdwgKDSYNHgvcChcJagjiCO8IQggNCBcJ/AiFCHcIhQg/CUkKjAqMCvkJZwmCCa0I1QitCK0IJAl0CS8KjAreC6wM9gpIC6oJGgj8CAoJMglMCa0IaghPCO8IxAnpCukKPAoUCj8JXA6BDroILgeFCMEKpgpxCtEJnwjpClgMpgr5CR4L0QmFCFoJrQiFCNSylIFsYFVST009Ozk4MzEwLSopKCYkIh8eFQwKAwEA//X07Onh2cu+sK+hlYh9cmZbUUc8NCsjHBQTEgwLBQCzioyUl5WZl6N0Q1I7XEhkWVw="),n(t,3232,"EAAAAABjQiQkIiQiIiIiU0UkNCJ0ZkZERLBmREQiQVVEVCR0jZiLqoS7uNiJhPmouYtoZmRERLLaubmq9Ni7u6r0u7vbimebuLmJdLebmIiE2bi4qqTZq5uL9Km4uaqk2N/aitaPvNqo9I2Im6qoitzbi6TbytiJqLr2uYt0udu5imRkhmRmIkREZESoy93aqKeaiGhGpPariYuJm9rbi//+/e4OAwIBAP/+/NojAwIBAP/++tA7BAIBAP/+9sJHCgIBAP/87LdSCAIBAP/867RaEQIBAP/44KthHgQBAP/+7K1fJQcB"),n(t,3472,"////gwaR///////sXQ9g///////CUxlH3f////+iSSJCov///9J+SSs5rf///8l9RzA6gv///6ZuSTk+aNL///t7QTdEZKv/AAAAAAAAAAD6AAMABgADAAMAAwAEAAMAAwADAM0BAAAgAAoAFC5kAYAIAADACQAAQAwAAIAMAACgDAAAQA0AAJANAADgDQAABxcmNkVVZHSDk6KywdDf7w0ZKTdFU2Jwf46dq7vL3OwPFSIzPU5can6ImKe5zeHwChUkMj9PX25+jZ2tvc3d7REUJTM7Tllre4aWpLjN4PAKDyAzQ1FgcIGOnq29zNzsCBUlM0FPYnF+ipuos8DR2gwPIjc/TldsdoOUp7nL2+wQEyAkOE9bbHaImqu6zNztCxwrOkpZaXiHlqW0xNPi8QYQIS48S1xre4mcqbnH1uELEx4sOUpZaXmHmKm6ytrqDBMdLjlHWGR4hJSltsfY6REXIy44TVxqe4aYp7nM3u0OES01P0tZa3OEl6u8zt3wCRAdKDhHWGd3iZqrvc3e7RATJDA5TFdpdoSWp7nK2uwMER02R1FeaH6IlaS2yd3tDxwvPk9hc4GOm6i0wtDf7ggOHi0+Tl5vf4+fr8DP3+8RHjE+T1xrd4SRoK6+zNzrDhMkLT1MW2x5ipqsvc3e7gwSHy08TFtre4qaq7vM3ewNER8rNUZTZ3KDlae5y9ztERYjKjpOXW59i5uqvM7g8AgPIjJDU2Nzg5KissHR4O8NEClCSVZfb4CJlqO3zuHxERklND9LXGZ3hJCgr7/U5xMfMUFTZHWFk6Guu8jV4/ISHzREWGd1foqVo7HAz9/vEB0vPUxaaneFk6GwwdHg8A8VIzI9SVZhbneBja/G2u1JDm0LbQttC20LbQttC20LbQttC20LbQuTC5MLbQseC5AMDQycC/AL8AvCC8ILwguTC5MLwgucC0gLHgseC6YKUA+uD6ULhwyHDHYL8AseCzIMrAxtCx4LPAr5CdwKbQu8DX0MwgsfDMsLSAttC20LbQttC0gLSAtIC0gLSAvBCr4TvhN2C/UNOQ3wCw0M6QpYDFgMnAseC9EJ7AnBCkgLTBE1EIwKwQqcC8ILbQseC6ULywttC20LbQttC0gLpgokDssLnAvwC/ALOQv2CvALkAznC6UL2wzbDKUL7gyvC2sUlhPsCQoNxg05DX0MFgwwDaULjApXCn8K6QoeC3EK2RM2FAcSTBGcCVEL5wuHDGEMfwq0CkgLHgvpCh4LjAoyDEgLkwttC20LbQttC5MLkwuTC5MLbQttC5MLkwuTC2oQhwylCx8MwgtIC0gLbQucCzkLZAvLC5wLwgt9DDkLsA6wDqwMHwylC0gLbQtIC5wLdgvpCukKHgtIC0gLZAoOD64PhwwyDKwMdgvnC5MLkwsNDB4L6QrpCukK6QoUCgUP8A8dDbwNFgy0CsILdgsyDA0MHgseC1cKVwoeC/YKGxQeE5kMBQ9xDWEMUQtVDXsNjAoUCnEKtAoeC/YKwQoNEM0O2wxYDG0LSAtIC20L6Qq0CukKtArpCh4LSAv2CtkTvhPnC9kNrAzwCw0MgAsfDFELtAq0CrQKHgvpCjwK1RDVECwL3wmHDDANMA0DDAMMMA3wCx4LVwoUCqYKwQrwC2QL9gpIC7QKfwpRCx8MTgxODJAMYQzwC8ILkwseCxcRKg9tC0gLHgtICx4LHgtIC0gLSAseC0gLbQtICx4LpQtkC2QLpQulC/ALMgyQDE4M8AvCC5wLnAucC20LtAqFEDUQ7gwTDW0LkwtIC6ULpQseC+kKtAoeCx4LHgvpCvAPrg8fDMILbQttC20LSAttC20LHgseCx4L6QpIC9wKBxLfEWEMcQ2HDKULUQveCzIMtAp/Cn8Kfwq0CukKjAo1EK0QzQ5JDqYK3ApIC0gLwgucC20LHgt/Cn8K6QpIC3cQ4g3BCh4LHgtIC0gLSAttC20LSAttC20LbQuTC0gLNhQ5E9UIaA3NDpcNEw0eC+4Mlw1ODFELnAm3CcEKbQt7DWUOMgx9DB0N5wuHDIcMpQuQDA0MbQttC38K7AmCCaULwgvpCukKtArpCh4LnAvwCx8MTgxODE4MHwzCC8ILgAs5C38KpgrcCsILaA3ZDR0NrAzwC8ILkwttC0gLHgvLC4ALUQvCC8ILnAvLCx8M8AvwC8ILSAseC20LbQtIC1APfw/CC30MHQ2QDNsM2wyXDXgOcQ2mCoUInAkUCi8K4czJuLevnpqZh3dzcW5tY2JfT0Q0MjAtKyAfGxIKAwD/++vm1MnEtqemo5eKfG5oWk5MRkU5LSIYFQsGBQQDAK+UoLCyra6ksa7EtsbAtkQ+QjxIdVVadoiXjqCOmw=="),n(t,5255,"AWRmZkREJCJgpGueubS5i2ZAQiQiIgABINCLjb+YuZtoYKtopmZmZoQBAAAAABAQAFBtTmu5i2dl0NSNi62Ze2ckAAAAAAAAATAAAAAAAAAgRId7d3dnRWJEZ3h2dmZHYoaInbi2mYuG0Kj4S72PeWsgMSIiIgARAtLri3u5iWmGYodotmS3q4ZkRkRGQkIig0CmZkQkAgEAhqZmRCIiQoTU9p6La2tXZmTbfXqJdmeEcoeJaatqMiKk1o2PuZd5Z8AiAAAAAAAB0G1Ku4b5n4lmbpp2V2V3ZQACACQkQkQjYKRmZCQAAiGniq5mZFQCAmRreHckxRgA//799AwDAgEA//784CYDAgEA//770TkEAgEA//70w0UEAgEA//vouFQHAgEA//7wulYOAgEA//7vslseBQEA//jjsWQTAgE="),n(t,5584,"////nASa///////jZg9c///////VUxhI7P////+WTCE/1v///755TSs3uf////WJRys7i/////+DQjJCa8L//6Z0TDc1ff//AAAAAAAAAABkAAMAKAADAAMAAwAFAA4ADgAKAAsAAwAIAAkABwADAFsBAAAgABAAZiarASAOAAAgEAAAIBQAAGAUAACAFAAAgBUAANAVAAAgFgAAAAAAAFzKvti235rinOZ47Hr0zPw0A4YLiBNkGWYdSiBCJ6Q1+ff29fTq0srJyMWuUjs4NzYuFgwLCgkHAEAAy5YA18OmfW5SAAAAAKsWAACuFgAAeACAQADongoA5gDz3cC1AGQA8AAgAGQAzTwAMAAgq1UAwIBAAM2aZjMA1auAVSsA4MCggGBAIABkKBAHAwEAAApn8g5WzeQdCmfyDnVSggxZmgQZdVKCDEYRMQrtA2IURhExCtoC1wf5xq0P2gLXByK2UgXa+qQKIrZSBQAAAABG8y4eK+NLDh9mgBgcLB0K2mFIEu2c9AbsMBML45ClBO2kHQIK32sDAAAAAAAAAAAqr9XJz/9AABEAY/9hARD+owAnK71W2f8GAFsAVv+6ABcAgPzAGNhN7f/c/2YAp//o/0gBSfwICiU+AAAAAAAAh8c9yUAAgACG/yQANgEA/UgCMyRFRQwAgAASAHL/IAGL/5/8GxB7OAAAAAAAAAAAaAINyPb/JwA6ANL/rP94ALgAxf7j/QQFBBVAIwAAAADmPsbE8/8AABQAGgAFAOH/1f/8/0EAWgAHAGP/CP/U/1ECLwY0CscMAAAAAAAAAADkVwXFAwDy/+z/8f8CABkAJQAZAPD/uf+V/7H/MgAkAW8C1gMIBbgFAAAAAAAAAACUa2fEEQAMAAgAAQD2/+r/4v/g/+r/AwAsAGQAqADzAD0BfQGtAccBE/WV5lkS8ykfBlQg"),n(t,6304,"vQCo/WkCZ3d1AGH/0vsIdDQA3QCo9nRu/P8RAury5WbQ//YCjPClXbD/iQN17wZTnf/MA4LvZkeV/8cDi/AnO5n/gANh8q4upf8FA8/0XiK5/2MCofeYFtL/qQGh+rQLYXNzZXJ0aW9uIGZhaWxlZDogMABzaWxrL3Jlc2FtcGxlcl9wcml2YXRlX2Rvd25fRklSLmMAYXNzZXJ0aW9uIGZhaWxlZDogMABzaWxrL3Jlc2FtcGxlci5jAAYAAwAHAwABCgACBhIKDAQAAgAAAAkEBwQAAwwHB2Fzc2VydGlvbiBmYWlsZWQ6IGluTGVuID49IFMtPkZzX2luX2tIegBhc3NlcnRpb24gZmFpbGVkOiBTLT5pbnB1dERlbGF5IDw9IFMtPkZzX2luX2tIegBhc3NlcnRpb24gZmFpbGVkOiBmc19rSHogPT0gOCB8fCBmc19rSHogPT0gMTIgfHwgZnNfa0h6ID09IDE2AHNpbGsvY29udHJvbF9jb2RlYy5jAGFzc2VydGlvbiBmYWlsZWQ6IHBzRW5jLT5zQ21uLm5iX3N1YmZyID09IDIgfHwgcHNFbmMtPnNDbW4ubmJfc3ViZnIgPT0gNABhc3NlcnRpb24gZmFpbGVkOiAoIHBzRW5jLT5zQ21uLnN1YmZyX2xlbmd0aCAqIHBzRW5jLT5zQ21uLm5iX3N1YmZyICkgPT0gcHNFbmMtPnNDbW4uZnJhbWVfbGVuZ3RoAGFzc2VydGlvbiBmYWlsZWQ6IENvbXBsZXhpdHkgPj0gMCAmJiBDb21wbGV4aXR5IDw9IDEwAGFzc2VydGlvbiBmYWlsZWQ6IHBzRW5jQy0+cGl0Y2hFc3RpbWF0aW9uTFBDT3JkZXIgPD0gTUFYX0ZJTkRfUElUQ0hfTFBDX09SREVSAGFzc2VydGlvbiBmYWlsZWQ6IF9mdD4xAGNlbHQvZW50ZW5jLmMAYXNzZXJ0aW9uIGZhaWxlZDogX2JpdHM+MABhc3NlcnRpb24gZmFpbGVkOiBfbmJpdHM8PUVDX1NZTV9CSVRTAGFzc2VydGlvbiBmYWlsZWQ6IF90aGlzLT5vZmZzK190aGlzLT5lbmRfb2Zmczw9X3NpemUAYXNzZXJ0aW9uIGZhaWxlZDogbiA8IDI1AHNpbGsvc3RlcmVvX2VuY29kZV9wcmVkLmMAYXNzZXJ0aW9uIGZhaWxlZDogaXhbIG4gXVsgMCBdIDwgMwBhc3NlcnRpb24gZmFpbGVkOiBpeFsgbiBdWyAxIF0gPCBTVEVSRU9fUVVBTlRfU1VCX1NURVBTAAAAAADgcCwPAwIBAP7twIRGFwQA//zimz0LAg=="),n(t,7328,"+vXqy0cyKiYjIR8dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQCzYwBHOCseFQwG"),n(t,7392,"x6WQfG1gVEc9MyogFw8IAPHh08e7r6SZjoR7cmlgWFBIQDkyLCYhHRgUEAwJBQIAzBwAAOAcAADwHAAAD4OKipubra0="),n(t,7472,"RV1zdoOKjYqWlpuWm6CmoIOAho2NjZGRkZabm5uboKCgoKamra22wLbAwMDNwM3gHB0AADAdAABAHQAAAAAAAAQGGAcFAAACAAAMHCkN/PcPKhkOAf4+Kff2JUH8A/oEQgf4EA4m/SEAAAAAAAAAAA0WJxcM/yRAG/r5CjcrEQEBCAEBBvVKNff0N0z0CP0DXRv8Gic7A/gCAE0LCfgWLPoHKAkaAwn5FGX5BAP4KhoA8SFEAhf+Ny7+DwP/FRAp+hs9JwX1KlgEAf48QQb8//tJOAH3E14d9wAMYwYECO1mLvMDAg0DAgnrVEju9S5o6ggSJjAXAPBGU+sLBfV1Fvj6F3X0AwP4XxwE9g9NPPH/BHwC/AMmVBjnAg0qDR8V/Dgu//8jT/MT+UFY9/IUBFEx4xQASwPvBfcsXPgB/RZFH/pfKfQFJ0MQ/AEA+ng33PMsegToUQULAwcCAAkKWHAdAACgHQAA8B0AAC4CWlddW1Ji"),n(t,7856,"bXh2DHFzdXdjO1dvP29wUH58fXyBeX4XhH9/f35/eoWChmV2d5F+Vnx4e3eqrWttnB4AALAeAADAHgAACBAgYXNzZXJ0aW9uIGZhaWxlZDogdHlwZU9mZnNldCA+PSAwICYmIHR5cGVPZmZzZXQgPCA2AHNpbGsvZW5jb2RlX2luZGljZXMuYwBhc3NlcnRpb24gZmFpbGVkOiBlbmNvZGVfTEJSUiA9PSAwIHx8IHR5cGVPZmZzZXQgPj0gMgBhc3NlcnRpb24gZmFpbGVkOiBwc0VuY0MtPnBzTkxTRl9DQi0+b3JkZXIgPT0gcHNFbmNDLT5wcmVkaWN0TFBDT3JkZXIACAoMEAAAAAAAAAB9MxoSDwwLCgkIBwYFBAMCAQDGaS0WDwwLCgkIBwYFBAMCAQDVonRTOysgGBIPDAkHBgUDAgDvu3Q7HBALCgkIBwYFBAMCAQD65byHVjMeEw0KCAYFBAMCAQD569W5nIBnU0I1KiEaFRENCgD++evOpHZNLhsQCgcFBAMCAQD//fnv3L+cd1U5JRcPCgYEAgD//fv27d/Ls5h8Yks3KB0VDwD//v333KJqQyocEgwJBgQDAg=="),n(t,8320,"HzlroM3N////////////////RS9Db6bN////////////////UkpPX22AkaCtzc3N4P//4P/gfUo7RWGNtv//////////////rXNVSUxcc5GtzeDg////////poZxZmVma3Z9ipGbprbAwM2W4LaGZVNPVWF4ka3N4P///////+DAlnhlXFldZnaGoLbA4ODg/+DgtpuGdm1oZmpvdoORoK2D"),n(t,8496,"8b6yhFdKKQ4A38GdjGo5JxI="),n(t,8528,"g0qNT1CKX2iGX2NbfV1Me3N7"),n(t,8560,"gADWKgDrgBUA9LhICwD41oAqBwD44apQGQUA++zGfjYSAwD67tOfUiMPBQD658uogFg1GQYA/O7YuZRsRygSBAD98+HHpoBaOR8NAwD+9unUt5NtSSwXCgIA//rw38amgFo6IRAGAQD/+/Tn0rWSbksuGQwFAQD//fju3cSkgFw8IxIIAwEA//358uXQtJJuTDAbDgcDAQ=="),n(t,8720,"gQDPMgDsgRQA9blICgD51YEqBgD64qlXGwQA++nCgj4UBAD67M+gYy8RAwD/8Nm2g1EpCwEA//7pyZ9rPRQCAQD/+enOqoBWMhcHAQD/+u7ZupRsRicSBgEA//zz4simgFo4Hg0EAQD//PXn0bSSbkwvGQsEAQD//fjt28KjgF0+JRMIAwEA//768eLNsZFvTzMeDwYCAQ=="),n(t,8880,"gQDLNgDqgRcA9bhJCgD614EpBQD86K1WGAMA/fDIgTgPAgD99NmkXiYKAQD99eK9hEcbBwEA/fbny59pOBcGAQD/+OvVs4VVLxMFAQD//vPdwp91RiUMAgEA//746tCrgFUwFggCAQD//vrw3L2Va0MkEAYCAQD//vvz48mmgFo3HQ0FAgEA//789urVt5NtSSsWCgQCAQ=="),n(t,9040,"ggDIOgDnghoA9LhMDAD51oIrBgD86K1XGAMA/fHLgzgOAgD+9t2nXiMIAQD++ejBgkEXBQEA//vv06JjLQ8EAQD/+/PfuoNKIQsDAQD//PXmyp5pORgIAgEA//3369azhFQsEwcCAQD//vrw38SfcEUkDwYCAQD//v3159GwiF03GwsDAgEA//79/O/dwp51TCoSBAMCAQ=="),n(t,9202,"AgUJDhQbIyw2QU1aaHeH"),n(t,9232,"/jFDTVJdY8YLEhgfJC3/LkJOV15o0A4VICozQv9eaG1wc3b4NUVQWF9mYXNzZXJ0aW9uIGZhaWxlZDogX2Z0PjEAY2VsdC9lbnRkZWMuYwBhc3NlcnRpb24gZmFpbGVkOiBmcmFtZV9sZW5ndGggPT0gMTIgKiAxMABzaWxrL2VuY29kZV9wdWxzZXMuYwBhc3NlcnRpb24gZmFpbGVkOiB3aW5fdHlwZSA9PSAxIHx8IHdpbl90eXBlID09IDIAc2lsay9mbG9hdC9hcHBseV9zaW5lX3dpbmRvd19GTFAuYwBhc3NlcnRpb24gZmFpbGVkOiAoIGxlbmd0aCAmIDMgKSA9PSAwAGFzc2VydGlvbiBmYWlsZWQ6IG9yZGVyID49IDAgJiYgb3JkZXIgPD0gU0lMS19NQVhfT1JERVJfTFBDAHNpbGsvZmxvYXQvc2NodXJfRkxQLmMAYXNzZXJ0aW9uIGZhaWxlZDogT3JkZXIgPD0gbGVuZ3RoAHNpbGsvZmxvYXQvTFBDX2FuYWx5c2lzX2ZpbHRlcl9GTFAuYwBhc3NlcnRpb24gZmFpbGVkOiAwAGNlbHQvY2VsdF9scGMuYwBhc3NlcnRpb24gZmFpbGVkOiBuPjAAYXNzZXJ0aW9uIGZhaWxlZDogb3ZlcmxhcD49MABhc3NlcnRpb24gZmFpbGVkOiBtYXhfcGl0Y2g+MABjZWx0L3BpdGNoLmMAYXNzZXJ0aW9uIGZhaWxlZDogbGVuPjA="),n(t,9816,"AwAAAAIAAAADAAAAAgAAAAUAAAACAAAAAwAAAAIAAAADAAAAAgAAAAUAAAACAAAAAwAAAAIAAABhc3NlcnRpb24gZmFpbGVkOiBsZW4+PTMALi9jZWx0L3BpdGNoLmgAYXNzZXJ0aW9uIGZhaWxlZDogSyA+IDAAc2lsay9mbG9hdC9zb3J0X0ZMUC5jAGFzc2VydGlvbiBmYWlsZWQ6IEwgPiAwAGFzc2VydGlvbiBmYWlsZWQ6IEwgPj0gSwAAAQAAAAEAAAAAAAH/Af8C/gL+A/0AAQAB/wL/Av4D/gP9B/4HAAAAAAAC////AAABAQABAAEAAAAAAAEAAAAAAAEAAAABAAAAAAD/AgEAAQEAAP//AAAAAAAAAf8AAf8A/wH+Av7+Av0CA/38A/wEBPsF+vsG+QYFCPcAAAEAAAAAAAAA/wEAAAH/AAH//wH/AgH/Av7+Av4CAgP9AAEAAAAAAAABAAEAAAH/AQAAAgH/Av//Av8CAv8D/v7+AwABAAABAAH/Av8C/wID/gP+/gQE/QX9/Ab8BgX7CPr7+QkAAAAAAAAAAPsI/wb/BvwK+gr+Bv8G+wr3DP0H/gf5DRAYImFzc2VydGlvbiBmYWlsZWQ6IEZzX2tIeiA9PSA4IHx8IEZzX2tIeiA9PSAxMiB8fCBGc19rSHogPT0gMTYAc2lsay9mbG9hdC9waXRjaF9hbmFseXNpc19jb3JlX0ZMUC5jAGFzc2VydGlvbiBmYWlsZWQ6IGNvbXBsZXhpdHkgPj0gU0lMS19QRV9NSU5fQ09NUExFWABhc3NlcnRpb24gZmFpbGVkOiBjb21wbGV4aXR5IDw9IFNJTEtfUEVfTUFYX0NPTVBMRVgAYXNzZXJ0aW9uIGZhaWxlZDogRnNfa0h6ID09IDgAYXNzZXJ0aW9uIGZhaWxlZDogdGFyZ2V0X3B0ciArIHNmX2xlbmd0aF84a0h6IDw9IGZyYW1lXzRrSHogKyBmcmFtZV9sZW5ndGhfNGtIegBhc3NlcnRpb24gZmFpbGVkOiBiYXNpc19wdHIgPj0gZnJhbWVfNGtIegBhc3NlcnRpb24gZmFpbGVkOiBiYXNpc19wdHIgKyBzZl9sZW5ndGhfOGtIeiA8PSBmcmFtZV80a0h6ICsgZnJhbWVfbGVuZ3RoXzRrSHoAYXNzZXJ0aW9uIGZhaWxlZDogbGVuZ3RoX2Rfc3JjaCA+IDAAYXNzZXJ0aW9uIGZhaWxlZDogKmxhZ0luZGV4ID49IDAAYXNzZXJ0aW9uIGZhaWxlZDogbmJfc3ViZnIgPT0gUEVfTUFYX05CX1NVQkZSID4+IDEAYXNzZXJ0aW9uIGZhaWxlZDogYnVmX2xlbiA+PSBwc0VuYy0+c0Ntbi5waXRjaF9MUENfd2luX2xlbmd0aABzaWxrL2Zsb2F0L2ZpbmRfcGl0Y2hfbGFnc19GTFAuYw=="),n(t,10934,"4D8AAAAAAADgv2Fzc2VydGlvbiBmYWlsZWQ6ICggb3JkZXIgJiAxICkgPT0gMABzaWxrL2Zsb2F0L3dhcnBlZF9hdXRvY29ycmVsYXRpb25fRkxQLmMAAAAAXT1/Zp6g5j8AAAAAAIg5PUQXdfpSsOY/AAAAAAAA2Dz+2Qt1EsDmPwAAAAAAeCi9v3bU3dzP5j8AAAAAAMAePSkaZTyy3+Y/AAAAAAAA2LzjOlmYku/mPwAAAAAAALy8hpNR+X3/5j8AAAAAANgvvaMt9GZ0D+c/AAAAAACILL3DX+zodR/nPwAAAAAAwBM9Bc/qhoIv5z8AAAAAADA4vVKBpUiaP+c/AAAAAADAAL38zNc1vU/nPwAAAAAAiC898WdCVutf5z8AAAAAAOADPUhtq7EkcOc/AAAAAADQJ704Xd5PaYDnPwAAAAAAAN28AB2sOLmQ5z8AAAAAAADjPHgB63MUoec/AAAAAAAA7bxg0HYJe7HnPwAAAAAAQCA9M8EwAe3B5z8AAAAAAACgPDaG/2Jq0uc/AAAAAACQJr07Ts828+LnPwAAAAAA4AK96MORhIfz5z8AAAAAAFgkvU4bPlQnBOg/AAAAAAAAMz0aB9Gt0hToPwAAAAAAAA89fs1MmYkl6D8AAAAAAMAhvdBCuR5MNug/AAAAAADQKT21yiNGGkfoPwAAAAAAEEc9vFufF/RX6D8AAAAAAGAiPa+RRJvZaOg/AAAAAADEMr2VozHZynnoPwAAAAAAACO9uGWK2ceK6D8AAAAAAIAqvQBYeKTQm+g/AAAAAAAA7bwjoipC5azoPwAAAAAAKDM9+hnWugW+6D8AAAAAALRCPYNDtRYyz+g/AAAAAADQLr1MZgheauDoPwAAAAAAUCC9B3gVma7x6D8AAAAAACgoPQ4sKND+Auk/AAAAAACwHL2W/5ELWxTpPwAAAAAA4AW9+S+qU8Ml6T8AAAAAAED1PErGzbA3N+k/AAAAAAAgFz2umF8ruEjpPwAAAAAAAAm9y1LIy0Ra6T8AAAAAAGglPSFvdprda+k/AAAAAADQNr0qTt6fgn3pPwAAAAAAAAG9oyN65DOP6T8AAAAAAAAtPQQGynDxoOk/AAAAAACkOL2J/1NNu7LpPwAAAAAAXDU9W/GjgpHE6T8AAAAAALgmPcW4Sxl01uk/AAAAAAAA7LyOI+MZY+jpPwAAAAAA0Bc9AvMHjV766T8AAAAAAEAWPU3lXXtmDOo/AAAAAAAA9bz2uI7teh7qPwAAAAAA4Ak9Jy5K7Jsw6j8AAAAAANgqPV0KRoDJQuo/AAAAAADwGr2bJT6yA1XqPwAAAAAAYAs9E2L0ikpn6j8AAAAAAIg4PaezMBOeeeo/AAAAAAAgET2NLsFT/ovqPwAAAAAAwAY90vx5VWue6j8AAAAAALgpvbhvNSHlsOo/AAAAAABwKz2B89O/a8PqPwAAAAAAANk8gCc8Ov/V6j8AAAAAAADkPKPSWpmf6Oo/AAAAAACQLL1n8yLmTPvqPwAAAAAAUBY9kLeNKQcO6z8AAAAAANQvPamJmmzOIOs/AAAAAABwEj1LGk+4ojPrPwAAAAAAR00950e3FYRG6z8AAAAAADg4vTpZ5Y1yWes/AAAAAAAAmDxqxfEpbmzrPwAAAAAA0Ao9UF778nZ/6z8AAAAAAIDePLJJJ/KMkus/AAAAAADABL0DBqEwsKXrPwAAAAAAcA29Zm+at+C46z8AAAAAAJANPf/BS5AezOs/AAAAAACgAj1vofPDad/rPwAAAAAAeB+9uB3XW8Ly6z8AAAAAAKAQvemyQWEoBuw/AAAAAABAEb3gUoXdmxnsPwAAAAAA4As97mT62Rwt7D8AAAAAAEAJvS/Q/1+rQOw/AAAAAADQDr0V/fp4R1TsPwAAAAAAZjk9y9BXLvFn7D8AAAAAABAavbbBiImoe+w/AAAAAIBFWL0z5waUbY/sPwAAAAAASBq938RRV0Cj7D8AAAAAAADLPJSQ79wgt+w/AAAAAABAAT2JFm0uD8vsPwAAAAAAIPA8EsRdVQvf7D8AAAAAAGDzPDurW1sV8+w/AAAAAACQBr28iQdKLQftPwAAAAAAoAk9+sgIK1Mb7T8AAAAAAOAVvYWKDQiHL+0/AAAAAAAoHT0DosrqyEPtPwAAAAAAoAE9kaT73BhY7T8AAAAAAADfPKHmYuh2bO0/AAAAAACgA71Og8kW44DtPwAAAAAA2Ay9kGD/cV2V7T8AAAAAAMD0PK4y2wPmqe0/AAAAAACQ/zwlgzrWfL7tPwAAAAAAgOk8RbQB8yHT7T8AAAAAACD1vL8FHGTV5+0/AAAAAABwHb3smnszl/ztPwAAAAAAFBa9Xn0Za2cR7j8AAAAAAEgLPeej9RRGJu4/AAAAAADOQD1c7hY7MzvuPwAAAAAAaAw9tD+L5y5Q7j8AAAAAADAJvWhtZyQ5Ze4/AAAAAAAA5bxETMf7UXruPwAAAAAA+Ae9JrfNd3mP7j8AAAAAAHDzvOiQpKKvpO4/AAAAAADQ5TzkynyG9LnuPwAAAAAAGhY9DWiOLUjP7j8AAAAAAFD1PBSFGKKq5O4/AAAAAABAxjwTWmHuG/ruPwAAAAAAgO68BkG2HJwP7z8AAAAAAIj6vGO5azcrJe8/AAAAAACQLL11ct1IyTrvPwAAAAAAAKo8JEVuW3ZQ7z8AAAAAAPD0vP1EiHkyZu8/AAAAAACAyjw4vpyt/XvvPwAAAAAAvPo8gjwkAtiR7z8AAAAAAGDUvI6QnoHBp+8/AAAAAAAMC70R1ZI2ur3vPwAAAAAA4MC8lHGPK8LT7z8AAAAAgN4Qve4jKmvZ6e8/AAAAAABD7jwAAAAAAADwPwAAAAAAAAAAvrxa+hoL8D8AAAAAAECzvAMz+6k9FvA/AAAAAAAXEr2CAjsUaCHwPwAAAAAAQLo8bIB3Ppos8D8AAAAAAJjvPMq7ES7UN/A/AAAAAABAx7yJf27oFUPwPwAAAAAAMNg8Z1T2cl9O8D8AAAAAAD8avVqFFdOwWfA/AAAAAACEAr2VHzwOCmXwPwAAAAAAYPE8GvfdKWtw8D8AAAAAACQVPS2ocivUe/A/AAAAAACg6bzQm3UYRYfwPwAAAAAAQOY8yAdm9r2S8D8AAAAAAHgAvYPzxso+nvA/AAAAAAAAmLwwOR+bx6nwPwAAAAAAoP88/Ij5bFi18D8AAAAAAMj6vIps5EXxwPA/AAAAAADA2TwWSHIrkszwPwAAAAAAIAU92F05IzvY8D8AAAAAAND6vPPR0zLs4/A/AAAAAACsGz2mqd9fpe/wPwAAAAAA6AS98NL+r2b78D8AAAAAADANvUsj1ygwB/E/AAAAAABQ8TxbWxLQARPxPwAAAAAAAOw8+Speq9se8T8AAAAAALwWPdUxbMC9KvE/AAAAAABA6Dx9BPIUqDbxPwAAAAAA0A696S2prppC8T8AAAAAAODoPDgxT5OVTvE/AAAAAABA6zxxjqXImFrxPwAAAAAAMAU938NxVKRm8T8AAAAAADgDPRFSfTy4cvE/AAAAAADUKD2fu5WG1H7xPwAAAAAA0AW9k42MOPmK8T8AAAAAAIgcvWZdN1gml/E/AAAAAADwET2ny2/rW6PxPwAAAAAASBA944cT+Jmv8T8AAAAAADlHvVRdBITgu/E/AAAAAADkJD1DHCiVL8jxPwAAAAAAIAq9srloMYfU8T8AAAAAAIDjPDFAtF7n4PE/AAAAAADA6jw42fwiUO3xPwAAAAAAkAE99804hMH58T8AAAAAAHgbvY+NYog7BvI/AAAAAACULT0eqHg1vhLyPwAAAAAAANg8Qd19kUkf8j8AAAAAADQrPSMTeaLdK/I/AAAAAAD4GT3nYXVuejjyPwAAAAAAyBm9JxSC+x9F8j8AAAAAADACPQKmsk/OUfI/AAAAAABIE72wzh5xhV7yPwAAAAAAcBI9Fn3iZUVr8j8AAAAAANARPQ/gHTQOePI/AAAAAADuMT0+Y/Xh34TyPwAAAAAAwBS9MLuRdbqR8j8AAAAAANgTvQnfH/WdnvI/AAAAAACwCD2bDtFmiqvyPwAAAAAAfCK9Otra0H+48j8AAAAAADQqPfkadzl+xfI/AAAAAACAEL3ZAuSmhdLyPwAAAAAA0A69eRVkH5bf8j8AAAAAACD0vM8uPqmv7PI/AAAAAACYJL0iiL1K0vnyPwAAAAAAMBa9JbYxCv4G8z8AAAAAADYyvQul7u0yFPM/AAAAAIDfcL2410z8cCHzPwAAAAAASCK9oumoO7gu8z8AAAAAAJglvWYXZLIIPPM/AAAAAADQHj0n+uNmYknzPwAAAAAAANy8D5+SX8VW8z8AAAAAANgwvbmI3qIxZPM/AAAAAADIIj05qjo3p3HzPwAAAAAAYCA9/nQeIyZ/8z8AAAAAAGAWvTjYBW2ujPM/AAAAAADgCr3DPnEbQJrzPwAAAAAAckS9IKDlNNun8z8AAAAAACAIPZVu7L9/tfM/AAAAAACAPj3yqBPDLcPzPwAAAAAAgO88IuHtROXQ8z8AAAAAAKAXvbs0Ekym3vM/AAAAAAAwJj3MThzfcOzzPwAAAAAApki9jH6sBEX68z8AAAAAANw8vbugZ8MiCPQ/AAAAAAC4JT2VLvchChb0PwAAAAAAwB49RkYJJ/sj9D8AAAAAAGATvSCpUNn1MfQ/AAAAAACYIz3ruYQ/+j/0PwAAAAAAAPo8GYlhYAhO9D8AAAAAAMD2vAHSp0IgXPQ/AAAAAADAC70WAB3tQWr0PwAAAAAAgBK9JjOLZm149D8AAAAAAOAwPQA8wbWihvQ/AAAAAABALb0Er5Lh4ZT0PwAAAAAAIAw9ctPX8Cqj9D8AAAAAAFAevQG4bep9sfQ/AAAAAACABz3hKTbV2r/0PwAAAAAAgBO9MsEXuEHO9D8AAAAAAIAAPdvd/Zmy3PQ/AAAAAABwLD2Wq9iBLev0PwAAAAAA4By9Ai2ddrL59D8AAAAAACAZPcExRX9BCPU/AAAAAADACL0qZs+i2hb1PwAAAAAAAPq86lE/6H0l9T8AAAAAAAhKPdpOnVYrNPU/AAAAAADYJr0arPb04kL1PwAAAAAARDK925RdyqRR9T8AAAAAADxIPWsR6d1wYPU/AAAAAACwJD3eKbU2R2/1PwAAAAAAWkE9DsTi2yd+9T8AAAAAAOApvW/Hl9QSjfU/AAAAAAAII71MC/8nCJz1PwAAAAAA7E09J1RI3Qer9T8AAAAAAADEvPR6qPsRuvU/AAAAAAAIMD0LRlmKJsn1PwAAAAAAyCa9P46ZkEXY9T8AAAAAAJpGPeEgrRVv5/U/AAAAAABAG73K69wgo/b1PwAAAAAAcBc9uNx2ueEF9j8AAAAAAPgmPRX3zeYqFfY/AAAAAAAAAT0xVTqwfiT2PwAAAAAA0BW9tSkZHd0z9j8AAAAAANASvRPDzDRGQ/Y/AAAAAACA6rz6jrz+uVL2PwAAAAAAYCi9lzNVgjhi9j8AAAAAAP5xPY4yCMfBcfY/AAAAAAAgN71+qUzUVYH2PwAAAAAAgOY8cZSesfSQ9j8AAAAAAHgpvQAg/h/2H+of2B/CH6gfiB9iHzofCh/YHqAeYh4iHtwdkB1CHe4clhw6HNgbchsKG5waKhq0GToZvBg8GLYXLhegFhAWfhXoFE4UsBMQE24SyBEeEXQQxg8WD2QOrg34DEAMhAvICgoKSgmKCMYHAgc+BngFsgTqAyIDWgKSAcoAAAA2/27+pv3e/Bb8TvuI+sL5/vg6+Hb3tvb29Tj1fPTA8wjzUvKc8erwOvCM7+LuOO6S7fDsUOyy6xjrgurw6WDp0uhK6MTnROfG5kzm1uVk5fbkjuQo5MbjauMS477icOIk4t7hnuFg4Sjh9uDG4J7geOBY4D7gKOAW4ArgAuAA4A=="),n(t,15393,"DwgHBAsMAwINCgUGCQ4BAAkGAwQFCAECB2Fzc2VydGlvbiBmYWlsZWQ6IGQ9PTEwIHx8IGQ9PTE2AHNpbGsvTkxTRjJBLmMAYXNzZXJ0aW9uIGZhaWxlZDogRCA+IDAAc2lsay9OTFNGX1ZRX3dlaWdodHNfbGFyb2lhLmMAYXNzZXJ0aW9uIGZhaWxlZDogKCBEICYgMSApID09IDAAYXNzZXJ0aW9uIGZhaWxlZDogaWZhY3RfUTIgPj0gMABzaWxrL2ludGVycG9sYXRlLmMAYXNzZXJ0aW9uIGZhaWxlZDogaWZhY3RfUTIgPD0gNABhc3NlcnRpb24gZmFpbGVkOiBLID4gMABzaWxrL3NvcnQuYwBhc3NlcnRpb24gZmFpbGVkOiBMID4gMABhc3NlcnRpb24gZmFpbGVkOiBMID49IEsAYXNzZXJ0aW9uIGZhaWxlZDogKCBMUENfb3JkZXIgJiAxICkgPT0gMABzaWxrL05MU0ZfVlEuYwBhc3NlcnRpb24gZmFpbGVkOiBzaWduYWxUeXBlID49IDAgJiYgc2lnbmFsVHlwZSA8PSAyAHNpbGsvTkxTRl9lbmNvZGUuYwBhc3NlcnRpb24gZmFpbGVkOiBwc0VuY0MtPnVzZUludGVycG9sYXRlZE5MU0ZzID09IDEgfHwgcHNFbmNDLT5pbmRpY2VzLk5MU0ZJbnRlcnBDb2VmX1EyID09ICggMSA8PCAyICkAc2lsay9wcm9jZXNzX05MU0ZzLmMAYXNzZXJ0aW9uIGZhaWxlZDogTkxTRl9tdV9RMjAgPiAwAGFzc2VydGlvbiBmYWlsZWQ6IHBzRW5jQy0+cHJlZGljdExQQ09yZGVyIDw9IE1BWF9MUENfT1JERVIAYXNzZXJ0aW9uIGZhaWxlZDogZCA+PSA2AHNpbGsvTFBDX2FuYWx5c2lzX2ZpbHRlci5jAGFzc2VydGlvbiBmYWlsZWQ6IChkICYgMSkgPT0gMABhc3NlcnRpb24gZmFpbGVkOiBkIDw9IGxlbgBhc3NlcnRpb24gZmFpbGVkOiBzdGFydF9pZHggPiAwAHNpbGsvTlNRX2RlbF9kZWMuYwBhc3NlcnRpb24gZmFpbGVkOiBuU3RhdGVzRGVsYXllZERlY2lzaW9uID4gMABhc3NlcnRpb24gZmFpbGVkOiAoIHNoYXBpbmdMUENPcmRlciAmIDEgKSA9PSAwAGFzc2VydGlvbiBmYWlsZWQ6IHN0YXJ0X2lkeCA+IDAAc2lsay9OU1EuYwBhc3NlcnRpb24gZmFpbGVkOiAoIHNoYXBpbmdMUENPcmRlciAmIDEgKSA9PSAwAGFzc2VydGlvbiBmYWlsZWQ6IGxhZyA+IDAgfHwgc2lnbmFsVHlwZSAhPSBUWVBFX1ZPSUNFRABhc3NlcnRpb24gZmFpbGVkOiBzdWJmcl9sZW5ndGggKiBuYl9zdWJmciA8PSBNQVhfRlJBTUVfU0laRQBzaWxrL2Zsb2F0L2J1cmdfbW9kaWZpZWRfRkxQLmMAYXNzZXJ0aW9uIGZhaWxlZDogcHNFbmNDLT5pbmRpY2VzLk5MU0ZJbnRlcnBDb2VmX1EyID09IDQgfHwgKCBwc0VuY0MtPnVzZUludGVycG9sYXRlZE5MU0ZzICYmICFwc0VuY0MtPmZpcnN0X2ZyYW1lX2FmdGVyX3Jlc2V0ICYmIHBzRW5jQy0+bmJfc3ViZnIgPT0gTUFYX05CX1NVQkZSICkAc2lsay9mbG9hdC9maW5kX0xQQ19GTFAuYwBhc3NlcnRpb24gZmFpbGVkOiBwc0VuYy0+c0Ntbi5sdHBfbWVtX2xlbmd0aCAtIHBzRW5jLT5zQ21uLnByZWRpY3RMUENPcmRlciA+PSBwc0VuY0N0cmwtPnBpdGNoTFsgMCBdICsgTFRQX09SREVSIC8gMgBzaWxrL2Zsb2F0L2ZpbmRfcHJlZF9jb2Vmc19GTFAuYwBhc3NlcnRpb24gZmFpbGVkOiBzUmFuZ2VFbmNfY29weTIub2ZmcyA8PSAxMjc1AHNpbGsvZmxvYXQvZW5jb2RlX2ZyYW1lX0ZMUC5jAGFzc2VydGlvbiBmYWlsZWQ6IHBzUmFuZ2VFbmMtPm9mZnMgPD0gMTI3NQ=="),n(t,17025,"Dyc0PURKT1RYXF9jZmlsb3J1d3p8foGDhYeJi46PkZOVl5mbnZ6goqOlp6iqq62usLGztLa3ubq7vb7AwcLExcfIycvMzc/Q0dPU1dfY2dvc3d/g4ePk5ufo6uvs7u/x8vP19vj5+vz9/wAAAAAAAAAcKzQ7QUZKTlFVV1pdX2JkZmlrbW9xc3R2eHp7fX+AgoOFhoiJioyNj5CRk5SVl5iZmpydnp+goqOkpaanqKmrrK2ur7CxsrO0tba3uLm6u7y8vb6/wMHCw8TFxsfIycrLy8zNzs/Q0dLT1NXW1tfY2drb3N3e3+Dg4eLj5OXm5+jp6uvs7O3u7/Dx8vP09fb3+Pn6+/z9/v8AAAAAAAAAAAgdKTE4PkJGSk1QU1ZYW11fYWNlZ2lrbG5wcXN0dnd5ent9fn+BgoOEhoeIiYqMjY6PkJGSk5SVlpeYmZqcnZ6fn6ChoqOkpaanqKmqq6usra6vsLGxsrO0tbW2t7i5ubq7vL29vr/AwMHCw8PExcbGx8jIycrLy8zNzs7P0NHR0tPT1NXW1tfY2Nna29vc3d3e3+Dg4eLi4+Tl5ebn6Ojp6urr7O3t7u/w8PHy8/P09fb29/j5+fr7/P3/YXNzZXJ0aW9uIGZhaWxlZDogMABzaWxrL2VuY19BUEkuYwBhc3NlcnRpb24gZmFpbGVkOiAhcmV0AGFzc2VydGlvbiBmYWlsZWQ6IGVuY0NvbnRyb2wtPm5DaGFubmVsc0ludGVybmFsID09IDEgfHwgcHNFbmMtPnN0YXRlX0Z4eFsgMCBdLnNDbW4uZnNfa0h6ID09IHBzRW5jLT5zdGF0ZV9GeHhbIDEgXS5zQ21uLmZzX2tIegBhc3NlcnRpb24gZmFpbGVkOiBlbmNDb250cm9sLT5uQ2hhbm5lbHNBUEkgPT0gMSAmJiBlbmNDb250cm9sLT5uQ2hhbm5lbHNJbnRlcm5hbCA9PSAxAGFzc2VydGlvbiBmYWlsZWQ6IHBzRW5jLT5zdGF0ZV9GeHhbIDAgXS5zQ21uLmlucHV0QnVmSXggPT0gcHNFbmMtPnN0YXRlX0Z4eFsgMCBdLnNDbW4uZnJhbWVfbGVuZ3RoAGFzc2VydGlvbiBmYWlsZWQ6IGVuY0NvbnRyb2wtPm5DaGFubmVsc0ludGVybmFsID09IDEgfHwgcHNFbmMtPnN0YXRlX0Z4eFsgMSBdLnNDbW4uaW5wdXRCdWZJeCA9PSBwc0VuYy0+c3RhdGVfRnh4WyAxIF0uc0Ntbi5mcmFtZV9sZW5ndGgAAACAuwAAeAAAABUAAAAVAAAAAJpZPwAAAAAAAIA/AACAP8BGAAADAAAACAAAAHgAAAALAAAA8EYAAOBHAAAQSAAAgAcAAAMAAADwSQAAEH4AAEB/AAD4fwAAMEoAAIgBAABQZgAAMGcAAMBo"),n(t,18114,"AQACAAMABAAFAAYABwAIAAoADAAOABAAFAAYABwAIgAoADAAPABOAGQ="),n(t,18181,"WlBLRT84MSgiHRQSCgAAAAAAAAAAbmRaVE5HQTozLScgGhQMAAAAAAAAdm5nXVZQS0ZBOzUvKB8XDwQAAAAAfndwaF9ZU05IQjw2LycgGREMAQAAhn94cmdhW1VOSEI8Ni8pIx0XEAoBkImCfHFrZV9YUkxGQDkzLSchGg8BmJGKhHt1b2liXFZQSkM9NzErJBQBopuUjoV/eXNsZmBaVE1HQTs1Lh4BrKWemI+Jg312cGpkXldRS0U/OC0UyMjIyMjIyMjGwby3sq2oo56ZlIFo"),n(t,18416,"CAAIAAgACAAQABAAEAAVABUAGAAdACIAJAAAAAAAAABqHI04UrseOghp3DqC7Vc7iWOyOwMqBTww3Dk8tD53PByjnjzR8sU8/obxPJurED0FrSo9hMJGPVPmZD0RiYI9h5+TPcuypT3Rvrg9Or/MPVSv4T0Uivc9DiUHPtn0Ej5fMR8+aNcrPorjOD4wUkY+lB9UPr9HYj6OxnA+sJd/PlJbhz5gD48+mOWWPnnbnj5w7qY+2BuvPvtgtz4Ru78+RifIPrei0D54Ktk+lLvhPgxT6j7e7fI+Bon7Pr4QAj8fWgY/JJ8KP1DeDj8rFhM/QUUXPyVqGz9zgx8/zo8jP+aNJz90fCs/P1ovPxkmMz/n3jY/mYM6PzMTPj/FjEE/d+9EP386SD8nbUs/zoZOP+WGUT/xbFQ/jjhXP2npWT9Ff1w/+vleP3NZYT+vnWM/wcZlP8/UZz8RyGk/0qBrP25fbT9QBG8/9I9wP+YCcj+9XXM/H6F0P7/NdT9X5HY/sOV3P5fSeD/jq3k/c3J6Pycnez/nyns/nV58PzXjfD+cWX0/vcJ9P4Yffj/ecH4/q7d+P8/0fj8mKX8/hlV/P756fz+WmX8/zLJ/PxTHfz8c138/guN/P93sfz+2838/ivh/P8j7fz/W/X8/B/9/P6X/fz/o/38//f9/PwAAgD/gAQAAh4gIO/////8FAGAAAwAgAAQACAACAAQABAAB"),n(t,18972,"cGkAADBt"),n(t,18992,"//9/P47/fz9q/n8/k/x/Pwf6fz/I9n8/1vJ/PzDufz/W6H8/yOJ/Pwfcfz+T1H8/a8x/P4/Dfz8Aun8/va9/P8ekfz8dmX8/wIx/P7B/fz/scX8/dmN/P0tUfz9uRH8/3jN/P5oifz+jEH8/+v1+P53qfj+N1n4/y8F+P1asfj8uln4/U39+P8Znfj+GT34/lDZ+P+8cfj+YAn4/j+d9P9PLfT9mr30/RpJ9P3R0fT/xVX0/vDZ9P9UWfT889nw/8tR8P/ayfD9JkHw/62x8P9tIfD8bJHw/qf57P4fYez+0sXs/MIp7P/xhez8XOXs/gg97Pz3lej9Iuno/oo56P01iej9INXo/lAd6PzDZeT8dqnk/Wnp5P+lJeT/IGHk/+eZ4P3u0eD9OgXg/c014P+oYeD+y43c/za13Pzp3dz/5P3c/Cgh3P27Pdj8llnY/L1x2P4whdj885nU/QKp1P5dtdT9CMHU/QfJ0P5SzdD87dHQ/NzR0P4fzcz8ssnM/JnBzP3Ytcz8a6nI/FKZyP2Rhcj8KHHI/BdZxP1ePcT8ASHE///9wP1W3cD8CbnA/BiRwP2LZbz8Vjm8/IEJvP4T1bj8/qG4/U1puP8ALbj+GvG0/pWxtPx0cbT/vymw/G3lsP6EmbD+A02s/u39rP1Araz9A1mo/jIBqPzIqaj8102k/k3tpP00jaT9kymg/2HBoP6gWaD/Vu2c/YGBnP0gEZz+Pp2Y/M0pmPzbsZT+XjWU/Vy5lP3fOZD/1bWQ/1AxkPxKrYz+xSGM/sOViPxCCYj/RHWI/87hhP3dTYT9c7WA/pIZgP04fYD9bt18/y05fP57lXj/Ve14/cBFeP26mXT/SOl0/ms5cP8ZhXD9Z9Fs/UYZbP64XWz9yqFo/nThaPy7IWT8nV1k/h+VYP09zWD9/AFg/F41XPxgZVz+CpFY/Vi9WP5O5VT86Q1U/S8xUP8dUVD+u3FM/AWRTP7/qUj/pcFI/f/ZRP4J7UT/y/1A/z4NQPxoHUD/SiU8/+gtPP5CNTj+UDk4/CY9NP+0OTT9Bjkw/BQ1MPzuLSz/hCEs/+YVKP4MCSj9/fkk/7vlIP890SD8k70c/7WhHPyniRj/aWkY/ANNFP5tKRT+swUQ/MjhEPy+uQz+iI0M/jZhCP+8MQj/IgEE/GvRAP+VmQD8o2T8/5Uo/Pxu8Pj/MLD4/95w9P50MPT++ezw/XOo7P3VYOz8Kxjo/HTM6P62fOT+7Czk/R3c4P1HiNz/aTDc/47Y2P2sgNj90iTU//fE0PwdaND+TwTM/oCgzPzCPMj9C9TE/2FoxP/G/MD+OJDA/r4gvP1XsLj+BTy4/MrItP2kULT8ndiw/a9crPzc4Kz+LmCo/Z/gpP8xXKT+6tig/MhUoPzNzJz+/0CY/1i0mP3mKJT+n5iQ/YUIkP6mdIz99+CI/31IiP8+sIT9NBiE/W18gP/i3Hz8lEB8/4mcePzC/HT8QFh0/gWwcP4TCGz8aGBs/Q20aPwDCGT9RFhk/NmoYP7G9Fz/BEBc/Z2MWP6O1FT92BxU/4VgUP+SpEz9/+hI/s0oSP4CaET/n6RA/6DgQP4SHDz+71Q4/jiMOP/5wDT8Kvgw/swoMP/pWCz/fogo/Y+4JP4Y5CT9JhAg/rM4HP68YBz9UYgY/m6sFP4P0BD8PPQQ/PYUDPw/NAj+GFAI/oVsBP2GiAD+P0f8+p13+Pg7p/D7Cc/s+xv35PhuH+D7BD/c+upf1PgYf9D6opfI+nivxPuyw7z6RNe4+kLnsPug86z6av+k+qUHoPhXD5j7fQ+U+CMTjPpFD4j58wuA+yEDfPni+3T6MO9w+BrjaPuYz2T4ur9c+3ynWPvmj1D59HdM+bpbRPswO0D6Xhs4+0v3MPn10yz6Z6sk+J2DIPijVxj6fScU+ir3DPuwwwj7Go8A+GRa/PuaHvT4t+bs+8Wm6PjLauD7xSbc+L7m1Pu4ntD4vlrI+8gOxPjlxrz4E3q0+VkqsPi+2qj6QIak+eoynPu/2pT7vYKQ+fMqiPpczoT5AnJ8+egSePkRsnD6h05o+kTqZPhahlz4wB5Y+4WyUPinSkj4LN5E+h5uPPp7/jT5RY4w+osaKPpEpiT4gjIc+UO6FPiJQhD6XsYI+sBKBPt7mfj6pp3s+w2d4Pi8ndT7u5XE+BKRuPnNhaz48Hmg+YtpkPuiVYT7PUF4+GgtbPszEVz7mfVQ+azZRPl3uTT6/pUo+klxHPtoSRD6XyEA+zn09PoAyOj6u5jY+XZozPo1NMD5CAC0+fbIpPkJkJj6RFSM+bsYfPtt2HD7aJhk+bdYVPpiFEj5bNA8+uuILPreQCD5UPgU+lOsBPvAw/T0GivY9ceLvPTM66T1PkeI9z+fbPbU91T0Dk849wOfHPfI7wT2cj7o9w+KzPWw1rT2bh6Y9VdmfPZ8qmT1+e5I99suLPQschT2H13w9RnZvPV0UYj3WsVQ9uU5HPRDrOT3lhiw9QCIfPSy9ET2yVwQ9tePtPGAX0zx2Srg8C32dPDKvgjz6wU88/iQaPCoPyTuZpzs7Ln3WudJGcbur3uO7pownvIEpXbzhYom8oDCkvOz9vryzytm84Jb0vDGxB72TFhW9jHsivRPgL70eRD29padKvZ0KWL3+bGW9vs5yveoXgL0byIa97XeNvVwnlL1j1pq9/YShvSYzqL3Z4K69EY61vco6vL3+5sK9qpLJvcg90L1U6Na9SpLdvaQ75L1d5Oq9cozxvd0z+L2a2v69UsACvvwSBr5HZQm+MrcMvroIEL7dWRO+mKoWvur6Gb7QSh2+R5ogvk7pI77hNye+AIYqvqbTLb7TIDG+g200vrW5N75lBTu+k1A+vjqbQb5a5US+8C5Ivvl3S750wE6+XQhSvrNPVb5zlli+nNxbvioiX74bZ2K+batlvh/vaL4sMmy+lHRvvlS2cr5q93W+0zd5vo13fL6Wtn++dXqBvkUZg765t4S+0FWGvojzh77hkIm+2i2LvnDKjL6kZo6+dAKQvt+dkb7kOJO+gdOUvrZtlr6BB5i+4qCZvtc5m75f0py+eWqeviMCoL5emaG+JjCjvn3GpL5gXKa+zvGnvsaGqb5HG6u+UK+svuBCrr711a++j2ixvq36sr5NjLS+bh22vhCut74wPrm+z826vupcvL6C672+lHm/vh8Hwb4jlMK+nyDEvpGsxb74N8e+08LIviJNyr7i1su+E2DNvrXozr7FcNC+QvjRvi1/076DBdW+Q4vWvm0Q2L7/lNm++Rjbvlmc3L4dH96+RqHfvtMi4b7Bo+K+ECTkvr6j5b7MIue+OKHovgAf6r4knOu+ohjtvnqU7r6rD/C+M4rxvhIE875GffS+z/X1vqpt977Z5Pi+WFv6vijR+75HRv2+tbr+vjgXAL+70AC/5IkBv7JCAr8l+wK/O7MDv/ZqBL9TIgW/U9kFv/WPBr84Rge/HfwHv6KxCL/HZgm/jBsKv/DPCr/zgwu/kzcMv9HqDL+snQ2/JFAOvzgCD7/osw+/MmUQvxgWEb+XxhG/sHYSv2MmE7+u1RO/kYQUvw0zFb8f4RW/yI4Wvwg8F7/d6Be/SJUYv0hBGb/c7Bm/BJgav8BCG78P7Ru/8JYcv2NAHb9o6R2//pEevyU6H7/c4R+/I4kgv/ovIb9f1iG/Unwiv9QhI7/jxiO/f2skv6cPJb9csyW/nVYmv2j5Jr+/mye/oD0ovwvfKL//fym/fSAqv4PAKr8RYCu/J/8rv8SdLL/oOy2/ktktv8N2Lr95Ey+/tK8vv3NLML+35jC/f4Exv8sbMr+ZtTK/6k4zv73nM78SgDS/6Bc1vz+vNb8WRja/btw2v0VyN7+cBzi/cZw4v8UwOb+WxDm/5lc6v7LqOr/8fDu/wg48vwOgPL/BMD2/+sA9v61QPr/b3z6/g24/v6X8P79AikC/UxdBv+CjQb/kL0K/YLtCv1NGQ7++0EO/nlpEv/bjRL/CbEW/BfVFv7x8Rr/oA0e/iYpHv50QSL8llki/IBtJv46fSb9vI0q/waZKv4YpS7+8q0u/Yy1Mv3quTL8CL02/+q5Nv2IuTr85rU6/fitPvzOpT79VJlC/5qJQv+QeUb9QmlG/KBVSv22PUr8eCVO/O4JTv8P6U7+3clS/FupUv99gVb8S11W/sExWv7fBVr8nNle/AKpXv0IdWL/sj1i//gFZv3hzWb9Z5Fm/olRav1HEWr9mM1u/4qFbv8MPXL8KfVy/t+lcv8hVXb8+wV2/GCxev1eWXr/5/16//2hfv2jRX78zOWC/YqBgv/MGYb/lbGG/OtJhv/A2Yr8Im2K/gP5iv1lhY7+Sw2O/LCVkvyWGZL9+5mS/N0Zlv06lZb/FA2a/mmFmv82+Zr9eG2e/TXdnv5rSZ79ELWi/S4dov67gaL9vOWm/i5FpvwTpab/ZP2q/CZZqv5Trar97QGu/vJRrv1noa79PO2y/oI1sv0vfbL9PMG2/rYBtv2XQbb91H26/321uv6G7br+7CG+/LlVvv/igb78b7G+/lTZwv2eAcL+QyXC/DxJxv+ZZcb8ToXG/l+dxv3Etcr+gcnK/JrdyvwH7cr8yPnO/uIBzv5TCc7/EA3S/SUR0vyKEdL9Qw3S/0gF1v6g/db/SfHW/ULl1vyH1db9FMHa/vWp2v4ikdr+m3Xa/FhZ3v9lNd7/vhHe/V7t3vxHxd78dJni/elp4vyqOeL8rwXi/ffN4vyEleb8WVnm/XIZ5v/K1eb/a5Hm/EhN6v5pAer9zbXq/nZl6vxbFer/f73q/+Bl7v2FDe78abHu/IpR7v3q7e78g4nu/Fwh8v1wtfL/wUXy/03V8vwWZfL+Gu3y/Vd18v3P+fL/fHn2/mj59v6Ndfb/6e32/n5l9v5K2fb/T0n2/Yu59vz8Jfr9pI36/4Tx+v6dVfr+6bX6/G4V+v8mbfr/EsX6/Dcd+v6Lbfr+F736/tQJ/vzIVf7/8Jn+/Ezh/v3ZIf78nWH+/JGd/v251f78Fg3+/6I9/vxmcf7+Vp3+/X7J/v3S8f7/XxX+/hc5/v4HWf7/I3X+/XeR/vz3qf79q73+/4/N/v6n3f7+7+n+/Gf1/v8T+f7+7/3+/+v9/Pzn+fz+p+X8/S/J/Px7ofz8j238/Wct/P8G4fz9bo38/KIt/Pydwfz9aUn8/vzF/P1gOfz8l6H4/Jr9+P1yTfj/IZH4/aTN+P0H/fT9PyH0/lo59PxRSfT/LEn0/vNB8P+eLfD9NRHw/7/l7P82sez/pXHs/Qwp7P920ej+2XHo/0QF6Py6keT/OQ3k/suB4P9x6eD9MEng/BKd3PwQ5dz9PyHY/5FR2P8bedT/2ZXU/dep0P0RsdD9l63M/2mdzP6Phcj/CWHI/Oc1xPwk/cT80rnA/uxpwP6CEbz/k624/ilBuP5OybT8BEm0/1W5sPxHJaz+3IGs/yXVqP0nIaT85GGk/m2VoP2+wZz+6+GY/fD5mP7iBZT9vwmQ/pABkP1o8Yz+RdWI/TKxhP47gYD9ZEmA/rkFfP5FuXj8DmV0/CMFcP6DmWz/PCVs/mCpaP/tIWT/9ZFg/n35XP+WVVj/QqlU/Y71UP6HNUz+M21I/J+dRP3XwUD95908/NPxOP6v+TT/f/kw/1PxLP4z4Sj8K8kk/UulIP2XeRz9H0UY/+8FFP4SwRD/lnEM/IIdCPzpvQT80VUA/Ezk/P9gaPj+I+jw/Jtg7P7SzOj82jTk/r2Q4PyI6Nz+TDTY/Bd80P3yuMz/5ezI/gkcxPxkRMD/C2C4/f54tP1ZiLD9IJCs/WuQpP5CiKD/rXic/cRkmPyXSJD8JiSM/Iz4iP3XxID8Eox8/0lIeP+QAHT89rRs/4VcaP9MAGT8ZqBc/tE0WP6rxFD/9kxM/sjQSP8zTED9QcQ8/Qg0OP6SnDD98QAs/zdcJP5ptCD/pAQc/vZQFPxkmBD8DtgI/fkQBPxyj/z5uuvw++s75Psrg9j7k7/M+UfzwPhoG7j5HDes+4BHoPu0T5T53E+I+hxDfPiQL3D5YA9k+KvnVPqTs0j7N3c8+r8zMPlK5yT6/o8Y+/ovDPhhywD4WVr0+ADi6PuAXtz699bM+odGwPpWrrT6ig6o+z1mnPicupD6yAKE+edGdPoWgmj7fbZc+jzmUPqADkT4azI0+BZOKPmtYhz5WHIQ+zd6APrY/ez4Qv3Q+uztuPsm1Zz5NLWE+WaJaPv8UVD5RhU0+Y/NGPkZfQD4NyTk+yjAzPpCWLD5y+iU+glwfPtK8GD52GxI+f3gLPgHUBD4dXPw9cg3vPSm84T1maNQ9ThLHPQi6uT24X6w9hAOfPZKlkT0HRoQ9EsptPXoFUz2RPjg9pHUdPfyqAj3Kvc88ViOaPGEOSTzFp7s7PXpWuglG8bsS3WO8UIqnvEEk3bzjXQm9IygkvZbwPr3ytlm96np0vRqeh71C/ZS9yFqivYa2r71XEL29FmjKvZu9173DEOW9aWHyvWWv/71KfQa+aCENvvrDE77tZBq+LgQhvqyhJ75TPS6+ENc0vtJuO76GBEK+GZhIvnkpT76UuFW+VkVcvq7PYr6JV2m+1txvvoBfdr5433y+VK6BvoHrhL44J4i+cmGLviSajr5F0ZG+zQaVvrM6mL7ubJu+dJ2evj3Mob5A+aS+cySovs9Nq75Jda6+2pqxvni+tL4b4Le+uv+6vksdvr7HOMG+JVLEvltpx75hfsq+MJHNvryh0L4AsNO+8bvWvofF2b66zNy+gdHfvtPT4r6p0+W++tDovr3L677qw+6+eLnxvmCs9L6anPe+HIr6vt90/b5tLgC/A6EBvy0SA7/mgQS/LPAFv/pcB79MyAi/HjIKv2yaC78yAQ2/bGYOvxfKD78tLBG/rIwSv5DrE7/VSBW/dqQWv3H+F7/AVhm/Yq0av1ECHL+KVR2/Cacev8v2H7/MRCG/CZEiv3zbI78kJCW//WomvwKwJ78w8yi/hDQqv/pzK7+PsSy/P+0tvwcnL7/jXjC/0JQxv8rIMr/O+jO/2io1v+hYNr/3hDe/Aq84vwfXOb8D/Tq/8SA8v89CPb+aYj6/T4A/v+mbQL9otUG/xsxCvwHiQ78X9US/AwZGv8QUR79WIUi/titJv+EzSr/UOUu/jT1Mvwk/Tb9EPk6/PTtPv/A1UL9aLlG/eSRSv0oYU7/KCVS/9/hUv87lVb9N0Fa/cLhXvzeeWL+cgVm/oGJavz5BW791HVy/Qfdcv6LOXb+Uo16/FHZfvyJGYL+6E2G/2d5hv3+nYr+pbWO/VDFkv37yZL8msWW/SW1mv+UmZ7/43We/gJJov3tEab/o82m/w6BqvwxLa7/A8mu/3pdsv2Q6bb9Q2m2/oHduv1MSb79mqm+/2T9wv6nScL/VYnG/W/Bxvzp7cr9xA3O//Yhzv94LdL8RjHS/lgl1v2uEdb+P/HW/AHJ2v73kdr/GVHe/GMJ3v7IseL+TlHi/u/l4vyhceb/Zu3m/zRh6vwJzer95ynq/Lx97vyRxe79YwHu/yQx8v3ZWfL9fnXy/guF8v+Aifb93YX2/R519v0/Wfb+ODH6/BEB+v7Bwfr+Snn6/qcl+v/Xxfr91F3+/KTp/vxBaf78rd3+/eJF/v/iof7+qvX+/j89/v6Xef7/t6n+/ZvR/vxH7f7/t/n+/6v9/P+X4fz+m5n8/Lcl/P3ygfz+VbH8/eS1/Pyzjfj+xjX4/Cy1+Pz/BfT9SSn0/SMh8Pyg7fD/3ons/vf96P4BRej9ImHk/HtR4PwkFeD8TK3c/RkZ2P6xWdT9OXHQ/OFdzP3ZHcj8TLXE/HAhwP57Ybj+lnm0/QFpsP34Laz9rsmk/GU9oP5bhZj/yaWU/PuhjP4tcYj/qxmA/bSdfPyZ+XT8oy1s/hQ5aP1NIWD+jeFY/i59UPyC9Uj920VA/o9xOP73eTD/b10o/E8hIP3yvRj8ujkQ/QWRCP84xQD/s9j0/tLM7P0JoOT+tFDc/ELk0P4ZVMj8p6i8/FXctP2X8Kj81eig/ofAlP8ZfIz/AxyA/rCgeP6mCGz/U1Rg/SiIWPypoEz+TpxA/pOANP3sTCz85QAg//WYFP+eHAj8tRv8+W3H5PpeR8z4kp+0+RbLnPjyz4T5Mqts+upfVPsl7zz6+Vsk+3yjDPnDyvD63s7Y++2ywPoEeqj6SyKM+c2udPmwHlz7FnJA+xyuKPrm0gz7Hb3o+IWttPhFcYD4pQ1M+/SBGPiD2OD4mwys+pIgePi1HET5X/wM+bmPtPcK90j3aDrg93ledPfuZgj28rE89ZRwaPZkKyTwqpzs8wXjWui1EcbxX1+O8TIEnvZQPXb0VSom9WgakvW27vr0iaNm9Tgv0veNRB74vmBS+99chvqUQL76mQTy+ZGpJvk2KVr7NoGO+UK1wvkWvfb4NU4W+nsiLvg04kr4SoZi+ZgOfvr9epb7Ysqu+af+xvitEuL7YgL6+KrXEvtvgyr6lA9G+RR3XvnUt3b7xM+O+djDpvsAi776NCvW+m+f6vtNcAL84QAO/2x0Gv5v1CL9axwu/95IOv1RYEb9QFxS/zc8Wv6yBGb/QLBy/GtEev21uIb+rBCS/t5Mmv3QbKb/Hmyu/kxQuv7uFML8m7zK/t1A1v1WqN7/j+zm/SkU8v26GPr83v0C/i+9Cv1MXRb91Nke/2kxJv2taS78QX02/s1pPvz5NUb+aNlO/sxZVv3LtVr/Fuli/lX5av9A4XL9i6V2/OJBfv0AtYb9nwGK/nElkv87IZb/rPWe/46hov6cJar8nYGu/VKxsvx/ubb96JW+/WFJwv6t0cb9njHK/f5lzv+ebdL+Vk3W/foB2v5Zid7/UOXi/LwZ5v57Heb8Xfnq/lCl7vw3Ke796X3y/1el8vxhpfb8+3X2/QEZ+vxykfr/M9n6/TT5/v5x6f7+2q3+/mdF/v0Psf7+0+3+/pv9/P5Tjfz+cmn8/zCR/PziCfj/9sn0/P7d8PyqPez/zOno/1Lp4PxEPdz/2N3U/1TVzPwgJcT/xsW4/+TBsP5CGaT8vs2Y/U7djP4STYD9OSF0/RdZZPwM+Vj8rgFI/ZZ1OP16WSj/Ma0Y/ah5CP/muPT9AHjk/DW00PzKcLz+HrCo/654lPz90ID9tLRs/YcsVPw1PED9ouQo/awsFPy6M/j7d1PI+8fLmPn/o2j6mt84+iGLCPk7rtT4qVKk+UZ+cPv3Ojz5t5YI+zslrPmKfUT4wUDc+0+AcPvFVAj5iaM89fACaPST7SD0bpLs883dWu2Q98by7wGO9Z12nvRS93L0D+wi+c38jvjTnPb6kLVi+Jk5yvhIihr6JBZO+NM+fvtV8rL4zDLm+GnvFvlvH0b7N7t2+UO/pvsfG9b6QuQC/JnkGvyQhDL+NsBG/ZiYXv7qBHL+YwSG/FeUmv0rrK79W0zC/W5w1v4NFOr/9zT6//DRDv7x5R799m0u/hJlPvx9zU7+hJ1e/Y7Zav8YeXr8wYGG/D3pkv9hrZ78HNWq/H9Vsv6lLb783mHG/Yrpzv8mxdb8Wfne/9h55vyGUer9V3Xu/Wfp8v/rqfb8Or36/dEZ/vw+xf7/O7n+//////////////////////wAAAAAAAAAAKQApACkAUgBSAHsApADIAN4="),n(t,26250,"KQApACkAKQB7AHsAewCkAKQA8AAKARsBJwEpACkAKQApACkAKQApACkAewB7AHsAewDwAPAA8AAKAQoBMQE+AUgBUAF7AHsAewB7AHsAewB7AHsA8ADwAPAA8AAxATEBMQE+AT4BVwFfAWYBbAHwAPAA8ADwAPAA8ADwAPAAMQExATEBMQFXAVcBVwFfAV8BcgF4AX4BgwE="),n(t,26416,"KAcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcoDxccHyIkJicpKissLS4vLzEyMzQ1Njc3OTo7PD0+Pz9BQkNERUZHRygUISkwNTk9QEJFR0lLTE5QUlVXWVtcXmBiZWdpa2xucHJ1d3l7fH6AKBcnMzxDSU9TV1teYWRmaWtvc3Z5fH6Bg4eLjpGUlpmbn6OmqayusbMjHDFBTllja3J4foSIjZGVmZ+lq7C0ub3Ax83T2Nzh5ejv9fsVITpPYXB9iZSdpq62vcPJz9nj6/P7ESM/Vmp7i5ilsbvFztbe5u36GR83S1tpdYCKkpqhqK60ub7I0Nfe5evw9f8QJEFZboCQn625xM/Z4ury+gspSmeAl6y/0eHx/wkrT26Ko7rP4/YMJ0dje5CktsbW5PH9CSxRcY6owNbr/wcxWn+gv9z3BjNfhqrL6gcvV3ubuNTtBjRhia7Q8AU5apfA5wU7b57K8wU3Z5O74AU8caHO+ARBeq/gBEN/tuoAAAAAAAAAAODg4ODg4ODgoKCgoLm5ubKyqIY9JeDg4ODg4ODg8PDw8M/Pz8bGt5BCKKCgoKCgoKCgubm5ucHBwbe3rIpAJvDw8PDw8PDwz8/Pz8zMzMHBtI9CKLm5ubm5ubm5wcHBwcHBwbe3rIpBJ8/Pz8/Pz8/PzMzMzMnJyby8sI1CKMHBwcHBwcHBwcHBwcLCwri4rYtBJ8zMzMzMzMzMycnJycbGxru7r4xCKA=="),n(t,26994,"YADAACABgAEgAIAA4ABAAaABQACgAAABYAHAAQgAaADIACgBiAEoAIgA6ABIAagBSACoAAgBaAHIARAAcADQADABkAEwAJAA8ABQAbABUACwABABcAHQARgAeADYADgBmAE4AJgA+ABYAbgBWAC4ABgBeAHYAQQAZADEACQBhAEkAIQA5ABEAaQBRACkAAQBZAHEAQwAbADMACwBjAEsAIwA7ABMAawBTACsAAwBbAHMARQAdADUADQBlAE0AJQA9ABUAbQBVAC0ABQBdAHUARwAfADcADwBnAE8AJwA/ABcAbwBXAC8ABwBfAHcAQEAYQDBACEBgQEhAIEA4QBBAaEBQQChAAEBYQHBAQkAaQDJACkBiQEpAIkA6QBJAakBSQCpAAkBaQHJAREAcQDRADEBkQExAJEA8QBRAbEBUQCxABEBcQHRARkAeQDZADkBmQE5AJkA+QBZAbkBWQC5ABkBeQHZAQUAZQDFACUBhQElAIUA5QBFAaUBRQClAAUBZQHFAQ0AbQDNAC0BjQEtAI0A7QBNAa0BTQCtAA0BbQHNARUAdQDVADUBlQE1AJUA9QBVAbUBVQC1ABUBdQHVAR0AfQDdAD0BnQE9AJ0A/QBdAb0BXQC9AB0BfQHdAQIAYgDCACIBggEiAIIA4gBCAaIBQgCiAAIBYgHCAQoAagDKACoBigEqAIoA6gBKAaoBSgCqAAoBagHKARIAcgDSADIBkgEyAJIA8gBSAbIBUgCyABIBcgHSARoAegDaADoBmgE6AJoA+gBaAboBWgC6ABoBegHaAQYAZgDGACYBhgEmAIYA5gBGAaYBRgCmAAYBZgHGAQ4AbgDOAC4BjgEuAI4A7gBOAa4BTgCuAA4BbgHOARYAdgDWADYBlgE2AJYA9gBWAbYBVgC2ABYBdgHWAR4AfgDeAD4BngE+AJ4A/gBeAb4BXgC+AB4BfgHeAQMAYwDDACMBgwEjAIMA4wBDAaMBQwCjAAMBYwHDAQsAawDLACsBiwErAIsA6wBLAasBSwCrAAsBawHLARMAcwDTADMBkwEzAJMA8wBTAbMBUwCzABMBcwHTARsAewDbADsBmwE7AJsA+wBbAbsBWwC7ABsBewHbAQcAZwDHACcBhwEnAIcA5wBHAacBRwCnAAcBZwHHAQ8AbwDPAC8BjwEvAI8A7wBPAa8BTwCvAA8BbwHPARcAdwDXADcBlwE3AJcA9wBXAbcBVwC3ABcBdwHXAR8AfwDfAD8BnwE/AJ8A/wBfAb8BXwC/AB8BfwHfAQAAgD8AAACAY/p/P791VryL6X8/CnHWvHnNfz/nziC9L6Z/PzpeVr2vc38/E/KFvfk1fz8qr6C9Eu1+PzNlu739mH4/BBPWvbw5fj9zt/C9Vc99P6ioBb7LWX0/u+8SviXZfD9cMCC+Z018P/VpLb6Ytns/85s6vr4Uez/CxUe+4md6P83mVL4JsHk/gv5hvjzteD9NDG++hB94P5wPfL7qRnc/7oOEvndjdj8++oq+NnV1P3Vqkb4wfHQ/TNSXvnF4cz96N56+A2pyP7eTpL70UHE/vOiqvk8tcD9BNrG+If9uPwF8t752xm0/tLm9vl6DbD8V78O+5zVrP94byr4e3mk/yT/QvhJ8aD+SWta+1A9nP/Nr3L50mWU/qnPivgEZZD9xcei+jY5iPwdl7r4o+mA/J070vuZbXz+QLPq+17NdPwAAAL8PAlw/G+QCv6BGWj93wgW/noFYP/aaCL8ds1Y/d20LvzHbVD/aOQ6/7/lSPwAAEb9sD1E/yr8Tv70bTz8YeRa/+B5NP80rGb80GUs/ytcbv4gKST/xfB6/CvNGPyQbIb/R0kQ/RrIjv/epQj86Qia/k3hAP+PKKL+9Pj4/JUwrv4/8Oz/jxS2/IrI5PwE4ML+QXzc/ZaIyv/MENT/zBDW/ZaIyP5BfN78BODA/IrI5v+PFLT+P/Du/JUwrP70+Pr/jyig/k3hAvzpCJj/3qUK/RrIjP9HSRL8kGyE/CvNGv/F8Hj+ICkm/ytcbPzQZS7/NKxk/+B5Nvxh5Fj+9G0+/yr8TP2wPUb8AABE/7/lSv9o5Dj8x21S/d20LPx2zVr/2mgg/noFYv3fCBT+gRlq/G+QCPw8CXL8AAAA/17Ndv5As+j7mW1+/J070Pij6YL8HZe4+jY5iv3Fx6D4BGWS/qnPiPnSZZb/za9w+1A9nv5Ja1j4SfGi/yT/QPh7eab/eG8o+5zVrvxXvwz5eg2y/tLm9PnbGbb8BfLc+If9uv0E2sT5PLXC/vOiqPvRQcb+3k6Q+A2pyv3o3nj5xeHO/TNSXPjB8dL91apE+NnV1vz76ij53Y3a/7oOEPupGd7+cD3w+hB94v00Mbz487Xi/gv5hPgmweb/N5lQ+4md6v8LFRz6+FHu/85s6Ppi2e7/1aS0+Z018v1wwID4l2Xy/u+8SPstZfb+oqAU+Vc99v3O38D28OX6/BBPWPf2Yfr8zZbs9Eu1+vyqvoD35NX+/E/KFPa9zf786XlY9L6Z/v+fOID15zX+/CnHWPIvpf7+/dVY8Y/p/vwAwjSQAAIC/v3VWvGP6f78Kcda8i+l/v+fOIL15zX+/Ol5WvS+mf78T8oW9r3N/vyqvoL35NX+/M2W7vRLtfr8EE9a9/Zh+v3O38L28OX6/qKgFvlXPfb+77xK+y1l9v1wwIL4l2Xy/9WktvmdNfL/zmzq+mLZ7v8LFR76+FHu/zeZUvuJner+C/mG+CbB5v00Mb7487Xi/nA98voQfeL/ug4S+6kZ3vz76ir53Y3a/dWqRvjZ1db9M1Je+MHx0v3o3nr5xeHO/t5OkvgNqcr+86Kq+9FBxv0E2sb5PLXC/AXy3viH/br+0ub2+dsZtvxXvw75eg2y/3hvKvuc1a7/JP9C+Ht5pv5Ja1r4SfGi/82vcvtQPZ7+qc+K+dJllv3Fx6L4BGWS/B2Xuvo2OYr8nTvS+KPpgv5As+r7mW1+/AAAAv9ezXb8b5AK/DwJcv3fCBb+gRlq/9poIv56BWL93bQu/HbNWv9o5Dr8x21S/AAARv+/5Ur/KvxO/bA9Rvxh5Fr+9G0+/zSsZv/geTb/K1xu/NBlLv/F8Hr+ICkm/JBshvwrzRr9GsiO/0dJEvzpCJr/3qUK/48oov5N4QL8lTCu/vT4+v+PFLb+P/Du/ATgwvyKyOb9lojK/kF83v/MENb/zBDW/kF83v2WiMr8isjm/ATgwv4/8O7/jxS2/vT4+vyVMK7+TeEC/48oov/epQr86Qia/0dJEv0ayI78K80a/JBshv4gKSb/xfB6/NBlLv8rXG7/4Hk2/zSsZv70bT78YeRa/bA9Rv8q/E7/v+VK/AAARvzHbVL/aOQ6/HbNWv3dtC7+egVi/9poIv6BGWr93wgW/DwJcvxvkAr/Xs12/AAAAv+ZbX7+QLPq+KPpgvydO9L6NjmK/B2XuvgEZZL9xcei+dJllv6pz4r7UD2e/82vcvhJ8aL+SWta+Ht5pv8k/0L7nNWu/3hvKvl6DbL8V78O+dsZtv7S5vb4h/26/AXy3vk8tcL9BNrG+9FBxv7zoqr4DanK/t5OkvnF4c796N56+MHx0v0zUl742dXW/dWqRvndjdr8++oq+6kZ3v+6DhL6EH3i/nA98vjzteL9NDG++CbB5v4L+Yb7iZ3q/zeZUvr4Ue7/CxUe+mLZ7v/ObOr5nTXy/9WktviXZfL9cMCC+y1l9v7vvEr5Vz32/qKgFvrw5fr9zt/C9/Zh+vwQT1r0S7X6/M2W7vfk1f78qr6C9r3N/vxPyhb0vpn+/Ol5WvXnNf7/nziC9i+l/vwpx1rxj+n+/v3VWvAAAgL8AMA2lY/p/v791VjyL6X+/CnHWPHnNf7/nziA9L6Z/vzpeVj2vc3+/E/KFPfk1f78qr6A9Eu1+vzNluz39mH6/BBPWPbw5fr9zt/A9Vc99v6ioBT7LWX2/u+8SPiXZfL9cMCA+Z018v/VpLT6Ytnu/85s6Pr4Ue7/CxUc+4md6v83mVD4JsHm/gv5hPjzteL9NDG8+hB94v5wPfD7qRne/7oOEPndjdr8++oo+NnV1v3VqkT4wfHS/TNSXPnF4c796N54+A2pyv7eTpD70UHG/vOiqPk8tcL9BNrE+If9uvwF8tz52xm2/tLm9Pl6DbL8V78M+5zVrv94byj4e3mm/yT/QPhJ8aL+SWtY+1A9nv/Nr3D50mWW/qnPiPgEZZL9xceg+jY5ivwdl7j4o+mC/J070PuZbX7+QLPo+17NdvwAAAD8PAly/G+QCP6BGWr93wgU/noFYv/aaCD8ds1a/d20LPzHbVL/aOQ4/7/lSvwAAET9sD1G/yr8TP70bT78YeRY/+B5Nv80rGT80GUu/ytcbP4gKSb/xfB4/CvNGvyQbIT/R0kS/RrIjP/epQr86QiY/k3hAv+PKKD+9Pj6/JUwrP4/8O7/jxS0/IrI5vwE4MD+QXze/ZaIyP/MENb/zBDU/ZaIyv5BfNz8BODC/IrI5P+PFLb+P/Ds/JUwrv70+Pj/jyii/k3hAPzpCJr/3qUI/RrIjv9HSRD8kGyG/CvNGP/F8Hr+ICkk/ytcbvzQZSz/NKxm/+B5NPxh5Fr+9G08/yr8Tv2wPUT8AABG/7/lSP9o5Dr8x21Q/d20Lvx2zVj/2mgi/noFYP3fCBb+gRlo/G+QCvw8CXD8AAAC/17NdP5As+r7mW18/J070vij6YD8HZe6+jY5iP3Fx6L4BGWQ/qnPivnSZZT/za9y+1A9nP5Ja1r4SfGg/yT/Qvh7eaT/eG8q+5zVrPxXvw75eg2w/tLm9vnbGbT8BfLe+If9uP0E2sb5PLXA/vOiqvvRQcT+3k6S+A2pyP3o3nr5xeHM/TNSXvjB8dD91apG+NnV1Pz76ir53Y3Y/7oOEvupGdz+cD3y+hB94P00Mb7487Xg/gv5hvgmweT/N5lS+4md6P8LFR76+FHs/85s6vpi2ez/1aS2+Z018P1wwIL4l2Xw/u+8SvstZfT+oqAW+Vc99P3O38L28OX4/BBPWvf2Yfj8zZbu9Eu1+PyqvoL35NX8/E/KFva9zfz86Xla9L6Z/P+fOIL15zX8/CnHWvIvpfz+/dVa8Y/p/PwDIU6UAAIA/v3VWPGP6fz8KcdY8i+l/P+fOID15zX8/Ol5WPS+mfz8T8oU9r3N/PyqvoD35NX8/M2W7PRLtfj8EE9Y9/Zh+P3O38D28OX4/qKgFPlXPfT+77xI+y1l9P1wwID4l2Xw/9WktPmdNfD/zmzo+mLZ7P8LFRz6+FHs/zeZUPuJnej+C/mE+CbB5P00Mbz487Xg/nA98PoQfeD/ug4Q+6kZ3Pz76ij53Y3Y/dWqRPjZ1dT9M1Jc+MHx0P3o3nj5xeHM/t5OkPgNqcj+86Ko+9FBxP0E2sT5PLXA/AXy3PiH/bj+0ub0+dsZtPxXvwz5eg2w/3hvKPuc1az/JP9A+Ht5pP5Ja1j4SfGg/82vcPtQPZz+qc+I+dJllP3Fx6D4BGWQ/B2XuPo2OYj8nTvQ+KPpgP5As+j7mW18/AAAAP9ezXT8b5AI/DwJcP3fCBT+gRlo/9poIP56BWD93bQs/HbNWP9o5Dj8x21Q/AAARP+/5Uj/KvxM/bA9RPxh5Fj+9G08/zSsZP/geTT/K1xs/NBlLP/F8Hj+ICkk/JBshPwrzRj9GsiM/0dJEPzpCJj/3qUI/48ooP5N4QD8lTCs/vT4+P+PFLT+P/Ds/ATgwPyKyOT9lojI/kF83P/MENT/zBDU/kF83P2WiMj8isjk/ATgwP4/8Oz/jxS0/vT4+PyVMKz+TeEA/48ooP/epQj86QiY/0dJEP0ayIz8K80Y/JBshP4gKST/xfB4/NBlLP8rXGz/4Hk0/zSsZP70bTz8YeRY/bA9RP8q/Ez/v+VI/AAARPzHbVD/aOQ4/HbNWP3dtCz+egVg/9poIP6BGWj93wgU/DwJcPxvkAj/Xs10/AAAAP+ZbXz+QLPo+KPpgPydO9D6NjmI/B2XuPgEZZD9xceg+dJllP6pz4j7UD2c/82vcPhJ8aD+SWtY+Ht5pP8k/0D7nNWs/3hvKPl6DbD8V78M+dsZtP7S5vT4h/24/AXy3Pk8tcD9BNrE+9FBxP7zoqj4DanI/t5OkPnF4cz96N54+MHx0P0zUlz42dXU/dWqRPndjdj8++oo+6kZ3P+6DhD6EH3g/nA98PjzteD9NDG8+CbB5P4L+YT7iZ3o/zeZUPr4Uez/CxUc+mLZ7P/ObOj5nTXw/9WktPiXZfD9cMCA+y1l9P7vvEj5Vz30/qKgFPrw5fj9zt/A9/Zh+PwQT1j0S7X4/M2W7Pfk1fz8qr6A9r3N/PxPyhT0vpn8/Ol5WPXnNfz/nziA9i+l/Pwpx1jxj+n8/v3VWPAAAMABgAJAAwAAQAEAAcACgANAAIABQAIAAsADgAAQANABkAJQAxAAUAEQAdACkANQAJABUAIQAtADkAAgAOABoAJgAyAAYAEgAeACoANgAKABYAIgAuADoAAwAPABsAJwAzAAcAEwAfACsANwALABcAIwAvADsAAEAMQBhAJEAwQARAEEAcQChANEAIQBRAIEAsQDhAAUANQBlAJUAxQAVAEUAdQClANUAJQBVAIUAtQDlAAkAOQBpAJkAyQAZAEkAeQCpANkAKQBZAIkAuQDpAA0APQBtAJ0AzQAdAE0AfQCtAN0ALQBdAI0AvQDtAAIAMgBiAJIAwgASAEIAcgCiANIAIgBSAIIAsgDiAAYANgBmAJYAxgAWAEYAdgCmANYAJgBWAIYAtgDmAAoAOgBqAJoAygAaAEoAegCqANoAKgBaAIoAugDqAA4APgBuAJ4AzgAeAE4AfgCuAN4ALgBeAI4AvgDuAAMAMwBjAJMAwwATAEMAcwCjANMAIwBTAIMAswDjAAcANwBnAJcAxwAXAEcAdwCnANcAJwBXAIcAtwDnAAsAOwBrAJsAywAbAEsAewCrANsAKwBbAIsAuwDrAA8APwBvAJ8AzwAfAE8AfwCvAN8ALwBfAI8AvwDvAPAAAACJiIg7AQAAAAUAMAADABAABAAEAAQAAQ=="),n(t,32316,"MHwAADBt"),n(t,32338,"GAAwAEgAYAAIACAAOABQAGgAEAAoAEAAWABwAAQAHAA0AEwAZAAMACQAPABUAGwAFAAsAEQAXAB0AAEAGQAxAEkAYQAJACEAOQBRAGkAEQApAEEAWQBxAAUAHQA1AE0AZQANACUAPQBVAG0AFQAtAEUAXQB1AAIAGgAyAEoAYgAKACIAOgBSAGoAEgAqAEIAWgByAAYAHgA2AE4AZgAOACYAPgBWAG4AFgAuAEYAXgB2AAMAGwAzAEsAYwALACMAOwBTAGsAEwArAEMAWwBzAAcAHwA3AE8AZwAPACcAPwBXAG8AFwAvAEcAXwB3AHgAAACIiAg8AgAAAAUAGAADAAgAAgAEAAQAAQ=="),n(t,32620,"UH4AADBt"),n(t,32642,"DAAYACQAMAAEABAAHAAoADQACAAUACAALAA4AAEADQAZACUAMQAFABEAHQApADUACQAVACEALQA5AAIADgAaACYAMgAGABIAHgAqADYACgAWACIALgA6AAMADwAbACcAMwAHABMAHwArADcACwAXACMALwA7ADwAAACJiIg8AwAAAAUADAADAAQABAAB"),n(t,32804,"gH8AADBtAAAAAAAAlYsAADeYAAD/pQAABLUAAGfFAABF1wAAweoAAP//AABhc3NlcnRpb24gZmFpbGVkOiBmbCtmczw9MzI3NjgAY2VsdC9sYXBsYWNlLmMAYXNzZXJ0aW9uIGZhaWxlZDogZnM+MA=="),n(t,32930,"zkAAAMhAAAC4QAAAqkAAAKJAAACaQAAAkEAAAIxAAACcQAAAlkAAAJJAAACOQAAAnEAAAJRAAACKQAAAkEAAAIxAAACUQAAAmEAAAI5AAABwQAAAcEAAAHBAAABwQAAAcEA="),n(t,33040,"SH9BgUKAQYBAgD6AQIBAgFxOXE9cTlpPdClzKHIohBqEGpERoQywCrELGLMwijaHNoQ1hjiFN4Q3hD1yRmBKWEtYV0pZQltDZDtsMngoeiVhK04yU05UUVhLVkpXR1pJXUpdSm0ociR1InUijxGREpITogylCrIHvQa+CLEJF7I2cz9mQmJFY0pZR1tJW05ZVlBcQl1AZjtnPGg8dTR7LIojhR9hJk0tPVpdPGkqayluLXQmcSZwJnwahBuIE4wUmw6fEJ4Sqg2xCrsIwAavCZ8KFbI7bkdWS1VUU1tCWElXSFxLYkhpOms2czRyN3A4gTOEKJYhjB1iI00qKnlgQmwrbyh1LHsgeCR3IX8hhiKLFZMXmBSeGZoaphWtELgNuAqWDYsPFrI/ckpSVFNcUmc+YEhgQ2VJa0hxN3Y0fTR2NHU3hzGJJ50gkR1hIU0oAABmPwAATD8AACY/AAAAPwCGaz8AFC4/AHC9PgDQTD4CAQ=="),n(t,33424,"AwAAAAQAAAAEAAAABgAAAIP5ogBETm4A/CkVANFXJwDdNPUAYtvAADyZlQBBkEMAY1H+ALveqwC3YcUAOm4kANJNQgBJBuAACeouAByS0QDrHf4AKbEcAOg+pwD1NYIARLsuAJzphAC0JnAAQX5fANaROQBTgzkAnPQ5AItfhAAo+b0A+B87AN7/lwAPmAUAES/vAApaiwBtH20Az342AAnLJwBGT7cAnmY/AC3qXwC6J3UA5evHAD178QD3OQcAklKKAPtr6gAfsV8ACF2NADADVgB7/EYA8KtrACC8zwA29JoA46kdAF5hkQAIG+YAhZllAKAUXwCNQGgAgNj/ACdzTQAGBjEAylYVAMmocwB74mAAa4zAABnERwDNZ8MACejcAFmDKgCLdsQAphyWAESv3QAZV9EApT4FAAUH/wAzfj8AwjLoAJhP3gC7fTIAJj3DAB5r7wCf+F4ANR86AH/yygDxhx0AfJAhAGokfADVbvoAMC13ABU7QwC1FMYAwxmdAK3EwgAsTUEADABdAIZ9RgDjcS0Am8aaADNiAAC00nwAtKeXADdV1QDXPvYAoxAYAE12/ABknSoAcNerAGN8+AB6sFcAFxXnAMBJVgA71tkAp4Q4ACQjywDWincAWlQjAAAfuQDxChsAGc7fAJ8x/wBmHmoAmVdhAKz7RwB+f9gAImW3ADLoiQDmv2AA78TNAGw2CQBdP9QAFt7XAFg73gDem5IA0iIoACiG6ADiWE0AxsoyAAjjFgDgfcsAF8BQAPMdpwAY4FsALhM0AIMSYgCDSAEA9Y5bAK2wfwAe6fIASEpDABBn0wCq3dgArl9CAGphzgAKKKQA05m0AAam8gBcd38Ao8KDAGE8iACKc3gAr4xaAG/XvQAtpmMA9L/LAI2B7wAmwWcAVcpFAMrZNgAoqNIAwmGNABLJdwAEJhQAEkabAMRZxADIxUQATbKRAAAX8wDUQ60AKUnlAP3VEAAAvvwAHpTMAHDO7gATPvUA7PGAALPnwwDH+CgAkwWUAMFxPgAuCbMAC0XzAIgSnACrIHsALrWfAEeSwgB7Mi8ADFVtAHKnkABr5x8AMcuWAHkWSgBBeeIA9N+JAOiUlwDi5oQAmTGXAIjtawBfXzYAu/0OAEiatABnpGwAcXJCAI1dMgCfFbgAvOUJAI0xJQD3dDkAMAUcAA0MAQBLCGgALO5YAEeqkAB05wIAvdYkAPd9pgBuSHIAnxbvAI6UpgC0kfYA0VNRAM8K8gAgmDMA9Ut+ALJjaADdPl8AQF0DAIWJfwBVUikAN2TAAG3YEAAySDIAW0x1AE5x1ABFVG4ACwnBACr1aQAUZtUAJwedAF0EUAC0O9sA6nbFAIf5FwBJa30AHSe6AJZpKQDGzKwArRRUAJDiagCI2YkALHJQAASkvgB3B5QA8zBwAAD8JwDqcagAZsJJAGTgPQCX3YMAoz+XAEOU/QANhowAMUHeAJI5nQDdcIwAF7fnAAjfOwAVNysAXICgAFqAkwAQEZIAD+jYAGyArwDb/0sAOJAPAFkYdgBipRUAYcu7AMeJuQAQQL0A0vIEAEl1JwDrtvYA2yK7AAoUqgCJJi8AZIN2AAk7MwAOlBoAUTqqAB2jwgCv7a4AXCYSAG3CTQAtepwAwFaXAAM/gwAJ8PYAK0CMAG0xmQA5tAcADCAVANjDWwD1ksQAxq1LAE7KpQCnN80A5qk2AKuSlADdQmgAGWPeAHaM7wBoi1IA/Ns3AK6hqwDfFTEAAK6hAAz72gBkTWYA7QW3ACllMABXVr8AR/86AGr5uQB1vvMAKJPfAKuAMABmjPYABMsVAPoiBgDZ5B0APbOkAFcbjwA2zQkATkLpABO+pAAzI7UA8KoaAE9lqADSwaUACz8PAFt4zQAj+XYAe4sEAIkXcgDGplMAb27iAO/rAACbSlgAxNq3AKpmugB2z88A0QIdALHxLQCMmcEAw613AIZI2gD3XaAAxoD0AKzwLwDd7JoAP1y8ANDebQCQxx8AKtu2AKMlOgAAr5oArVOTALZXBAApLbQAS4B+ANoHpwB2qg4Ae1mhABYSKgDcty0A+uX9AInb/gCJvv0A5HZsAAap/AA+gHAAhW4VAP2H/wAoPgcAYWczACoYhgBNveoAs+evAI9tbgCVZzkAMb9bAITXSAAw3xYAxy1DACVhNQDJcM4AMMu4AL9s/QCkAKIABWzkAFrdoAAhb0cAYhLSALlchABwYUkAa1bgAJlSAQBQVTcAHtW3ADPxxAATbl8AXTDkAIUuqQAdssMAoTI2AAi3pADqsdQAFvchAI9p5AAn/3cADAOAAI1ALQBPzaAAIKWZALOi0wAvXQoAtPlCABHaywB9vtAAm9vBAKsXvQDKooEACGpcAC5VFwAnAFUAfxTwAOEHhgAUC2QAlkGNAIe+3gDa/SoAayW2AHuJNAAF8/4Aub+eAGhqTwBKKqgAT8RaAC34vADXWpgA9MeVAA1NjQAgOqYApFdfABQ/sQCAOJUAzCABAHHdhgDJ3rYAv2D1AE1lEQABB2sAjLCsALLA0ABRVUgAHvsOAJVywwCjBjsAwEA1AAbcewDgRcwATin6ANbKyADo80EAfGTeAJtk2ADZvjEApJfDAHdY1ABp48UA8NoTALo6PABGGEYAVXVfANK99QBuksYArC5dAA5E7QAcPkIAYcSHACn96QDn1vMAInzKAG+RNQAI4MUA/9eNAG5q4gCw/cYAkwjBAHxddABrrbIAzW6dAD5yewDGEWoA98+pAClz3wC1yboAtwBRAOKyDQB0uiQA5X1gAHTYigANFSwAgRgMAH5mlAABKRYAn3p2AP39vgBWRe8A2X42AOzZEwCLurkAxJf8ADGoJwDxbsMAlMU2ANioVgC0qLUAz8wOABKJLQBvVzQALFaJAJnO4wDWILkAa16qAD4qnAARX8wA/QtKAOH0+wCOO20A4oYsAOnUhAD8tKkA7+7RAC41yQAvOWEAOCFEABvZyACB/AoA+0pqAC8c2ABTtIQATpmMAFQizAAqVdwAwMbWAAsZlgAacLgAaZVkACZaYAA/Uu4AfxEPAPS1EQD8y/UANLwtADS87gDoXcwA3V5gAGeOmwCSM+8AyRe4AGFYmwDhV7wAUYPGANg+EADdcUgALRzdAK8YoQAhLEYAWfPXANl6mACeVMAAT4b6AFYG/ADlea4AiSI2ADitIgBnk9wAVeiqAIImOADK55sAUQ2kAJkzsQCp1w4AaQVIAGWy8AB/iKcAiEyXAPnRNgAhkrMAe4JKAJjPIQBAn9wA3EdVAOF0OgBn60IA/p3fAF7UXwB7Z6QAuqx6AFX2ogAriCMAQbpVAFluCAAhKoYAOUeDAInj5gDlntQASftAAP9W6QAcD8oAxVmKAJT6KwDTwcUAD8XPANtargBHxYYAhUNiACGGOwAseZQAEGGHACpMewCALBoAQ78SAIgmkAB4PIkAqMTkAOXbewDEOsIAJvTqAPdnigANkr8AZaMrAD2TsQC9fAsApFHcACfdYwBp4d0AmpQZAKgplQBozigACe20AESfIABOmMoAcIJjAH58IwAPuTIAp/WOABRW5wAh8QgAtZ0qAG9+TQClGVEAtfmrAILf1gCW3WEAFjYCAMQ6nwCDoqEAcu1tADmNegCCuKkAazJcAEYnWwAANO0A0gB3APz0VQABWU0A4HGA"),n(t,36211,"QPsh+T8AAAAALUR0PgAAAICYRvg8AAAAYFHMeDsAAACAgxvwOQAAAEAgJXo4AAAAgCKC4zYAAAAAHfNpNWFzc2VydGlvbiBmYWlsZWQ6IF9rPjAAY2VsdC9jd3JzLmM="),n(t,36320,"QI4AAACRAAC8kwAAdJYAACiZAADYmwAAhJ4AAOyfAACooAAAHKEAAGihAACgoQAAwKEAANihAADkoQAAYXNzZXJ0aW9uIGZhaWxlZDogX24+PTI="),n(t,36416,"AQ=="),n(t,37124,"AQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAADAAAABQAAAAcAAAAJAAAACwAAAA0AAAAPAAAAEQAAABMAAAAVAAAAFwAAABkAAAAbAAAAHQAAAB8AAAAhAAAAIwAAACUAAAAnAAAAKQAAACsAAAAtAAAALwAAADEAAAAzAAAANQAAADcAAAA5AAAAOwAAAD0AAAA/AAAAQQAAAEMAAABFAAAARwAAAEkAAABLAAAATQAAAE8AAABRAAAAUwAAAFUAAABXAAAAWQAAAFsAAABdAAAAXwAAAGEAAABjAAAAZQAAAGcAAABpAAAAawAAAG0AAABvAAAAcQAAAHMAAAB1AAAAdwAAAHkAAAB7AAAAfQAAAH8AAACBAAAAgwAAAIUAAACHAAAAiQAAAIsAAACNAAAAjwAAAJEAAACTAAAAlQAAAJcAAACZAAAAmwAAAJ0AAACfAAAAoQAAAKMAAAClAAAApwAAAKkAAACrAAAArQAAAK8AAACxAAAAswAAALUAAAC3AAAAuQAAALsAAAC9AAAAvwAAAMEAAADDAAAAxQAAAMcAAADJAAAAywAAAM0AAADPAAAA0QAAANMAAADVAAAA1wAAANkAAADbAAAA3QAAAN8AAADhAAAA4wAAAOUAAADnAAAA6QAAAOsAAADtAAAA7wAAAPEAAADzAAAA9QAAAPcAAAD5AAAA+wAAAP0AAAD/AAAAAQEAAAMBAAAFAQAABwEAAAkBAAALAQAADQEAAA8BAAARAQAAEwEAABUBAAAXAQAAGQEAABsBAAAdAQAAHwEAACEBAAAjAQAAJQEAACcBAAApAQAAKwEAAC0BAAAvAQAAMQEAADMBAAA1AQAANwEAADkBAAA7AQAAPQEAAD8BAABBAQAAQwEAAEUBAABHAQAASQEAAEsBAABNAQAATwEAAFEBAABTAQAAVQEAAFcBAABZAQAAWwEAAF0BAABfAQAADQAAABkAAAApAAAAPQAAAFUAAABxAAAAkQAAALUAAADdAAAACQEAADkBAABtAQAApQEAAOEBAAAhAgAAZQIAAK0CAAD5AgAASQMAAJ0DAAD1AwAAUQQAALEEAAAVBQAAfQUAAOkFAABZBgAAzQYAAEUHAADBBwAAQQgAAMUIAABNCQAA2QkAAGkKAAD9CgAAlQsAADEMAADRDAAAdQ0AAB0OAADJDgAAeQ8AAC0QAADlEAAAoREAAGESAAAlEwAA7RMAALkUAACJFQAAXRYAADUXAAARGAAA8RgAANUZAAC9GgAAqRsAAJkcAACNHQAAhR4AAIEfAACBIAAAhSEAAI0iAACZIwAAqSQAAL0lAADVJgAA8ScAABEpAAA1KgAAXSsAAIksAAC5LQAA7S4AACUwAABhMQAAoTIAAOUzAAAtNQAAeTYAAMk3AAAdOQAAdToAANE7AAAxPQAAlT4AAP0/AABpQQAA2UIAAE1EAADFRQAAQUcAAMFIAABFSgAAzUsAAFlNAADpTgAAfVAAABVSAACxUwAAUVUAAPVWAACdWAAASVoAAPlbAACtXQAAZV8AACFhAADhYgAApWQAAG1mAAA5aAAACWoAAN1rAAC1bQAAkW8AAHFxAABVcwAAPXUAACl3AAAZeQAADXsAAAV9AAABfwAAAYEAAAWDAAANhQAAGYcAACmJAAA9iwAAVY0AAHGPAACRkQAAtZMAAN2VAAAJmAAAOZoAAG2cAAClngAA4aAAACGjAABlpQAAracAAPmpAABJrAAAna4AAPWwAABRswAAsbUAABW4AAB9ugAA6bwAAFm/AADNwQAARcQAAMHGAABByQAAxcsAAE3OAADZ0AAAadMAAP3VAACV2AAAMdsAANHdAAB14AAAHeMAAMnlAAB56AAALesAAOXtAACh8AAAPwAAAIEAAADnAAAAeQEAAD8CAABBAwAAhwQAABkGAAD/BwAAQQoAAOcMAAD5DwAAfxMAAIEXAAAHHAAAGSEAAL8mAAABLQAA5zMAAHk7AAC/QwAAwUwAAIdWAAAZYQAAf2wAAMF4AADnhQAA+ZMAAP+iAAABswAAB8QAABnWAAA/6QAAgf0AAOcSAQB5KQEAP0EBAEFaAQCHdAEAGZABAP+sAQBBywEA5+oBAPkLAgB/LgIAgVICAAd4AgAZnwIAv8cCAAHyAgDnHQMAeUsDAL96AwDBqwMAh94DABkTBAB/SQQAwYEEAOe7BAD59wQA/zUFAAF2BQAHuAUAGfwFAD9CBgCBigYA59QGAHkhBwA/cAcAQcEHAIcUCAAZaggA/8EIAEEcCQDneAkA+dcJAH85CgCBnQoABwQLABltCwC/2AsAAUcMAOe3DAB5Kw0Av6ENAMEaDgCHlg4AGRUPAH+WDwDBGhAA56EQAPkrEQD/uBEAAUkSAAfcEgAZchMAPwsUAIGnFADnRhUAeekVAD+PFgBBOBcAh+QXABmUGAD/RhkAQf0ZAOe2GgD5cxsAfzQcAIH4HAAHwB0AGYseAL9ZHwABLCAA5wEhAHnbIQC/uCIAwZkjAId+JAAZZyUAf1MmAMFDJwDnNygA+S8pAP8rKgABLCsABzAsABk4LQA/RC4AgVQvAOdoMAB5gTEAP54yAEG/MwCH5DQAGQ42AP87NwBBbjgA56Q5APnfOgB/HzwAgWM9AAesPgAZ+T8Av0pBAAGhQgDn+0MAeVtFAL+/RgDBKEgAh5ZJABkJSwB/gEwAwfxNAOd9TwD5A1EA/45SAAEfVAAHtFUAGU5XAD/tWACBkVoA5zpcAHnpXQA/nV8AQVZhAIcUYwAZ2GQA/6BmAEFvaADnQmoA+RtsAH/6bQBBAQAAqQIAAAkFAADBCAAAQQ4AAAkWAACpIAAAwS4AAAFBAAApWAAACXUAAIGYAACBwwAACfcAACk0AQABfAEAwc8BAKkwAgAJoAIAQR8DAMGvAwAJUwQAqQoFAEHYBQCBvQYAKbwHAAnWCAABDQoAAWMLAAnaDAApdA4AgTMQAEEaEgCpKhQACWcWAMHRGABBbRsACTweAKlAIQDBfSQAAfYnACmsKwAJoy8Agd0zAIFeOAAJKT0AKUBCAAGnRwDBYE0AqXBTAAnaWQBBoGAAwcZnAAlRbwCpQncAQZ9/AIFqiAApqJEACVybAAGKpQABNrAACWS7ACkYxwCBVtMAQSPgAKmC7QAJefsAwQoKAUE8GQEJEikBqZA5AcG8SgEBm1wBKTBvAQmBggGBkpYBgWmrAQkLwQEpfNcBAcLuAcHhBgKp4B8CCcQ5AkGRVALBTXACCf+MAqmqqgJBVskCgQfpAinECQMJkisDAXdOAwF5cgMJnpcDKey9A4Fp5QNBHA4EqQo4BAk7YwTBs48EQXu9BAmY7ASpEB0FwetOBQEwggUp5LYFCQ/tBYG3JAaB5F0GCZ2YBino1AYBzRIHwVJSB6mAkwcJXtYHQfIaCMFEYQgJXakIqULzCEH9PgmBlIwJKRDcCQl4LQoB1IAKASzWCgmILQsp8IYLgWziC0EFQAypwp8MCa0BDcHMZQ1BKswNCc40DqnAnw7BCg0PAbV8DynI7g8JTWMQgUzaEIHPUxEJ388RKYROEgHIzxLBs1MTqVDaEwmoYxRBw+8Uwat+FQlrEBapCqUWQZQ8F4ER1xcpjHQYCQ4VGQGhuBkBT18aCSIJGykkthuBX2YcQd4ZHamq0B0Jz4oewVVIH0FJCSAJtM0gqaCVIcEZYSIBKjAjKdwCJAk72SSBUbMlkwYAAEUOAAAPHAAAETMAAFtXAAANjgAAd90AADlNAQBj5gEAlbMCAB/BAwAhHQUAq9cGAN0CCQAHswsAyf4OADP/EgDlzxcAL48dADFeJAD7YCwArb41AJehQABZN00AA7FbADVDbAA/Jn8AQZaUAEvTrAB9IcgAJ8nmAOkWCQHTWy8Bhe1ZAU8miQFRZb0Bmw73AU2LNgK3SXwCeb3IAqNfHAPVrncDXy/bA2FrRwTr8rwEHVw8BUdDxgUJS1sGcxz8BiVnqQdv4WMIcUgsCTtgAwrt8+kK19XgC5nf6AxD8gIOdfYvD3/ccBCBnMYRizYyE72ytBRnIU8WKZsCGBNB0BnFPLkbj8C+HZEH4h/bVSQijfiGJPdFCye5nbIp42h+LBUacC+fLYkyoSnLNSueNzldJdA8h2OWQEkHjESzybJIZW4MTa/DmlGxol9We+9cWy2ZlGAXmghm2fe6a4PDrXG1GeN3vyJdfh0jAABxTQAAkZwAAP0mAQBlDAIA6XcDAJmiBQA11ggALXANAOHkEwAhwxwA7bcoAHWSOABZSE0AKfpnACX4iQA9x7QAUSbqALETLAHd0nwBhfLeAclSVQK5K+MCFRSMA00IVATBcT8FQS5TBs2XlAeVjAkJOXe4CklXqAwFyuAOXRNqETEnTRTRspMXvSZIG6XAdR+plSgk2ZxtKfW5Ui9tyOY1oaY5PWFBXEWtn2BOte5ZWBmOXGNpHH5v5YPVfP+9AAABqAEAj2sDAPGeBgA/IwwAwT0VAI+2IwDx/DkA/1FbAAH6iwAPddEAcb8yAT+auAHB3G0CD89fA3GOngT/ez0GAbZTCI+c/ArxYVgOP6eMEsElxRePZTQe8YEUJv/7py8BnDo7D2IiSXGGwFk/ioJtwVjjhAEOBACRIQkAESwTAEHuJQBBT0cAkUOAABH33QABRnMBAZJaAhEBuAORNbwFQY+nCEEGzgwRspsSkQ+aGgEadiUBTAc0kZ5XRxGdrGBBppGBI1EWAMWeMgAXuWsAmfbYAGuJoAENxP4CHwFQBSHZHQkzbDAP1aKkGKdnCCcp/X08e7XnWx13HYmvoC3JrY57AInmGQE5ll4CPRbYBLVjdwnhKMYRIQM0IHVIgjh9V1dgv1uvAoHYJwb3hF4N6f6tG3+L6zaBt+VoFwOcwcEM/w45aoUiGe6RS4F4K54z4QlUYXNzZXJ0aW9uIGZhaWxlZDogX24+MQAADwAAAAoAAAAFAAAAYXNzZXJ0aW9uIGZhaWxlZDogSz4wCmFsZ19xdWFudCgpIG5lZWRzIGF0IGxlYXN0IG9uZSBwdWxzZQBjZWx0L3ZxLmMAYXNzZXJ0aW9uIGZhaWxlZDogTj4xCmFsZ19xdWFudCgpIG5lZWRzIGF0IGxlYXN0IHR3byBkaW1lbnNpb25zAGFzc2VydGlvbiBmYWlsZWQ6IEs+MAphbGdfdW5xdWFudCgpIG5lZWRzIGF0IGxlYXN0IG9uZSBwdWxzZQBhc3NlcnRpb24gZmFpbGVkOiBOPjEKYWxnX3VucXVhbnQoKSBuZWVkcyBhdCBsZWFzdCB0d28gZGltZW5zaW9ucwBjZWx0L2JhbmRzLmMAYXNzZXJ0aW9uIGZhaWxlZDogZW5kPjAAYXNzZXJ0aW9uIGZhaWxlZDogbmJCYW5kcz4wAGFzc2VydGlvbiBmYWlsZWQ6IHN1bT49MABhc3NlcnRpb24gZmFpbGVkOiBOID4gMAAAAAAAAAAAAQEBAgMDAwIDAwMCAwMDAAMMDzAzPD/Aw8zP8PP8/2Fzc2VydGlvbiBmYWlsZWQ6IHN0cmlkZT4wAAAAAAAAAQAAAAAAAAADAAAAAAAAAAIAAAABAAAABwAAAAAAAAAEAAAAAwAAAAYAAAABAAAABQAAAAIAAAAPAAAAAAAAAAgAAAAHAAAADAAAAAMAAAALAAAABAAAAA4AAAABAAAACQAAAAYAAAANAAAAAgAAAAoAAAAFAAAAYXNzZXJ0aW9uIGZhaWxlZDogaXRoZXRhPj0w"),n(t,42145,"QMpFG0z/UoJas2Kia2B1YXNzZXJ0aW9uIGZhaWxlZDogcW4gPD0gMjU2AAAAAAAACA0QExUXGBobHB0eHyAgISIiIyQkJSVhc3NlcnRpb24gZmFpbGVkOiBjb2RlZEJhbmRzID4gc3RhcnQAY2VsdC9yYXRlLmMAYXNzZXJ0aW9uIGZhaWxlZDogYml0c1tqXSA+PSAwAGFzc2VydGlvbiBmYWlsZWQ6IGViaXRzW2pdID49IDAAYXNzZXJ0aW9uIGZhaWxlZDogQyplYml0c1tqXTw8QklUUkVTID09IGJpdHNbal0AYXNzZXJ0aW9uIGZhaWxlZDogZmluICE9IGZvdXQKSW4tcGxhY2UgRkZUIG5vdCBzdXBwb3J0ZWQAY2VsdC9raXNzX2ZmdC5jAGFzc2VydGlvbiBmYWlsZWQ6IG09PTQAYXNzZXJ0aW9uIGZhaWxlZDogc3QtPnNpZ25hbGxpbmc9PTAAY2VsdC9jZWx0X2VuY29kZXIuYwACAQBhc3NlcnRpb24gZmFpbGVkOiAhY2VsdF9pc25hbihmcmVxWzBdKSAmJiAoQz09MSB8fCAhY2VsdF9pc25hbihmcmVxW05dKSkAYXNzZXJ0aW9uIGZhaWxlZDogY291bnQ+MAAZFwI="),n(t,42642,"gD8AAABAAABAQAAAgEAAAKBAAADAQAAA4EAAAABBAACAQQAAwEEAABBCAAAwQgAASEIAAGBCAAB4QgAAhkIAAJBCAACeQgAAsEIAANRCAAAGQw=="),n(t,42738,"gD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAABAQAAAQEAAAIBAAACgQAAAwEAAAABBAAAAQX58d21XKRMJBAIAAP//nG5WRjszLSglIR8cGhkXFhUUExIREBAPDw4NDQwMDAwLCwsKCgoJCQkJCQkICAgICAcHBwcHBwYGBgYGBgYGBgYGBgYGBgYFBQUFBQUFBQUFBQUEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAwMDAwMDAwMDAwMDAwMDAwMCYXNzZXJ0aW9uIGZhaWxlZDogIWNlbHRfaXNuYW4odG1wWzBdKQBhc3NlcnRpb24gZmFpbGVkOiAhY2VsdF9pc25hbihub3JtKQAAAAAAAAAz8AEN+/rw+Qv6ahoc8hXjBxLu7xXv9xTn/d4wC/Ph7OL3AvQF/wgJCQjzEu/e+xH1APwKAgoP+AL/AAUN/fAB+wMH5PMGJP0TxO/kB/Xi+QLW6/0G6iH3B+IV8hj17O779AzPzs8QCdv/CSLz4eEMECzWAvcI7voJJBMLDQzrA+T0AyEZ8gsBotkS9PXx+TE0CtUJOQgV+g7xLPgH4vP+9xn+gRL1zBrlGwr2BysG6CkK7uUKEQkK7/YU+hY3I7AkGejcDwntWBNAzd0RAPkp8BsED/8S8C/ZyvgN5+xm7vssC+RHAs37BQKt9+MIFcs62/kNJgki/9cVBOjc3+sgS/4BvP8v4yAUDL+pBRD0GCgPBxPm7xEG/tvi9yCB2QDh5QTqF/qzI8Mg2+gN9f/Y/RH5DQs77QoG7gANA/rpEwvvDf+wKMtF48oA/CHn/iYjJPEuAvPw+PgM6PfJ+/cgCwcM7vaq2jYl5xLVB+Xlyg0JFkYGI/kX8dT6B76rICjt9/kM8QcCBt0LHAAaDgEBBAwSIxbu/Q7/Bw748v0E/e35/+flGeb+Ierl5wT3BxUa4gr37AsbCgXuDvwC7/v59/MPHQH28PYjJPnq1BEeFhX/FvUg+PkF9gUe7B3s3gz8+gbzCvu8/xgJE+jAHxMb5kvTKSfWCAYX4hDnHiII2v0SEOEW/PcBFAkm4ADTAPrzC+fg6h/o9fX8/BTeFhQJ5xv7HOMdBhX67jYE0hcV8uEk1+gEFgoLByTg88zvGBzb3P8YCdojMBIC/y0KJxjaDQjwCBkLB+P1BxTi2tMO7uT3QT0Wy9rwJC4U2SDD+vrc3+7kOGUtC+Tp48MU0QIwG+8BKAEDzQ8jHBYjNcPjDPrrCgPsAucB+h8L/QH2zAZ+l3p/gH9/gH9sDH8wgNyAf3+AgH9ZgH+AgIB/f4CAo64UfUGufya2UVioTzPRkeYOU6iQGCObYp3Q0y5TxLEt7NcJBDQ2XfYEDQN7Bl6Ru/LhCgw1sfXr/tS4XEHHONp/yIB/f4BWdbWAf+2dkH+Af9BydoCAde/6eYB/gFI2ln9/32TZ6RKy3uP/4n/mf4B+gBvpsYiBf0hCHQe+yIuAIKgAAECoAAAZAAAAIA=="),n(t,43904,"1hQQAGk8AZ8YPBINPhl/Ik83dn9fH/xXFQwC8hIXCBH/+AUEGCUVDSQNERIlHiEBCPD1++H9+wAGAzr5//AF8xAK/vIL/AP1AAAAAAAAAAAW//kHHeXh7/MhLPgLIRhODxMe/ugFMQUkHfL10N8V1tr0N9s2+AEkEQAzHzsH9DUEIPIwBfbw+AHwyOj6Ev4XBi769hQj1PHPJBAF+bG9DEb9scqr6C/qIRVF/wsWDvDw6uT1C9cf5t/t/BsgzgX22ur4I+EB1/H1LBzv1+kRAunm8/PvBg7h5wntJ/gEH//T9eSk0vEVduotzQvs7PEN65/j4OnWXgEX+D/90hPmINi25hr88x7s4ufy4dPVBMTQ9N4CAgMNDwsQBS73yfDHHQ4mzv7U9fg05dr5FC8RxQAvLsEj7xMhRO0CD/Ac8Jka3S/ZxB4f6czzdC/nHige6gIM5e4f9hv4vgwOBObk8wMN5s0lBQLrLwMNGdfl+PwFtN8cCgnSthMcGR82yUQm6OACBEQL/2MFEP62KBrmIR//vA76GQkdPD0H+QDoB00E/xD5DfHtHOHo8CUYDR4K4gsL9hY8HC392ML7mgng5coVD/sl1fUl7S/AgOWOFb47Lv30qfcEE4/cTjnm2rP2Bga1GZ/1IdIBDevf7BD6/fX85SYI1/7fEhPmAePq/PLJ9bD9CyJaMwsRKyR/4B1nCRsNQDhG8gP0CiUDDOr2LhwKFBroEgkHDiL7+R/yyAvu+O/59tgK3+DVBQkL/Aoy9PsuCQcBCw9b7wfOFwbinQDvDgj25+K7wh9/cull+8r66gfIJxLjAC4IsQTrEuA+9Pj0xh/gEQboGRgJ/O0tBhHyBeUQ/NcZ3AUPDDIbGRfUu/ft0PgEDPoN7eLcGiX//eLW8vbsGsrl1ARJ5logu+PwA2cP7yUY6eEh28AZDa/k4BsF3ekP6hP5CR4T6RvzKx3j+gnY39/gCQvQ+OnMLhHq1iPx1xAiH9bt9TcH2Vn13xTyFiAD7/oOIgE366b4EhsN4xUP38339QTw7hf8/DABBx3y9PARIwgA+f4JCBH6NeDrzgVjxPvLCuEM+wdQJBLhCWIkwd0E8+ToHPMSEP/u3goUBwQdCxn5JA4tGAHwHgYj+vXoDf8bJxQw9fzzHAvh7h/jFv7s8AUe9OT9XfAXEuMGytsc/f3R/dzJ/Sn2L/4XKvm55VPAB+gIGu8PDB/i2vPfyATvFBIB4vv64fLbABYK4iXvEgYFF9zgDhLzw8y7LOIQEvznDlEa+OnFNJgRd+AaEQEXLR3Ax/JJFfPzCbz5zAMY2SzxGw4T9+T1BQPe/gIW+ukEAw3q8/buHQYs8+j4Ah4OKwYRt/r5FLD5+eQPu9r7nN0PsRcd7uUVvtsI6tkwBPMB9wvjFgbPIPIv7vwszLYrHhfyBQDlBPkK/AoB8Avu/vsC9QDs/CZKOydA9hr92LwD4s0I7eXSMzQ2JFpcDg37ABDCEAvR2/r7FTbHICr6PvcQFRgJ9vwhMg3xAd3QEvXvvfMVJtQk8B0RBfYSEeACCBbI8eAoKxMu+ZygEzUYFebQm649Jqvk3v8/+/snJ9og9OQUKPgCHwzd8xTnHggD8/fsAvMYJfYhBhTw6Pr67fsWFQoL/Nn/BjEp8ccVwk278wC2Afna+AY/HAQazFI/DS3fLMy/69LPQO8gGETZ8PvmHAXD5AIYC/TfCdv95Bbb9BMA7v4OAQQI9/4r7/6+4TjYqdz+/NbT/x/V8Rs/9SD23xvtBA/m3h382b8O7Ovv3A07L9rfDdv42/n6tOH00gcY6+LyCQ/08y/l5//ZABT3BgcEAwcnMhb5DuwBRuQd1wrw++T+2yDuET717M4kFcL0yDQyEQMwLNfnAxD9ACH6Dxsi5xYJEfUkEP4MFcwt/vYuFe5D5PMeJSoQ9wtLB8DY9h056QU1swPv+y/J3dzzNMu5NJHp5uQd1TftK+029N/U2e324fYVJsfsAucI+jIMDxnnD+L6CRklE/wf6gIEAiQHA96wJPb++x/cMboU3BUYGdLNJMbQ2PY3Ry8K/wEC0rwQDQC240nM7vUH1K7guuT/2bz61wzq8Cj15zP3FQQE3geyEAba4v7UIAAWQAW4/vL28PjnDGbGJfbpDzEH+QLs4C36MBweIf8W+h5B7x1KJeb2D+gTvhb24f/u9wsl/C0FKREBARjGKQXNDggrEPb/LSDAA9/n/eW8DBf189vYBOv0IOntTCnp6NS///EBRz8FFP0V6R/gEv4bHy772fvdEu7Y9gMMAv7qKAX6PCQDHeUKGcoFGicj6NsepRz86+XZ+gUMgCbwHaHjUv4jAgwI6gpQ0QLnt7EQ4uC+MBXT9dEO5e/5D9Ty1ObgGukR+eQa+hwG5gIN8unyEy4QAt/rHO/WLNsB2RxU0g8KDdRI5hog5PStAgri1PbkNS1BAOc5JN8GHSzLCxP+5SMgMQQXJiQYCjPZBPkaJd0L0e4cEN0qEevXHA70C9MH1fES+ybYzuLrCZ4NDBdLyPn9/P/eDM8LGu7k7yEN8igYuNsKEfoWEBD69OLyCijpDA/98Q3I/OIB/e8bMvtA3O0HHRYZCfDGu9jDufIqXRoL+sb1RswTCeLfC9vR6+rYCi8E6REwKdAOCg8i6f7RF+Dz9ubm/BAm8gD0+fkULP/g5fAE+u4OBQTjHAf5D/Xs09wQVCLF4hZ+CERP7xW8JQUPPzF/plUrBxAJBtPH1TkL6fXjPOYAByroChfnCPnYE+8jBBvZpRvcIgIQ6BkH6wURCuriCe/D5iEVOs3yRdoUB1D8v/rlNfQv//EBPGax/AwJFiX4/CUC/fHw9fsT+tUU5+4K5QDk5fUK7v788BoO+gf6ATX+4xcJ4vr8+jhGAN/s7/foLvuXL9LNFBTLr//5S/vrvwzMFs70MTZMrwot18US7RkO4cv7DB9U6QIHAgrgJ/70AfcA9vUJD/j+Av8KDvvYE/n5GvwCAeUjIBXhGiv3BOAowswkFiYWJKAG9unPD9/u/QApFe0VF9np+gYvOARKAJ4d0fLcFeoWEA0MEPsNEfPxAd7mGgwgGw29GwIIChIQFO/vOcAFDhMf7tTS8ATnEYLoJwQIN+feJ/ADCUdI4ckGCucgq+sS+A8M5fkB6/77MPASAermEA7hG/rx6wTyEtwUQ50MKecx1CNRbi8ivvIOxCIdtwopI1kH3RYHG+z6OBpCBiHJNQHrDhFENzsAEvcF1wb7jvQdKukKUeUUy+LCKF8Z/AMS+PHjrgLH/cPj4zECyQW7nc/NBucMWSzfBSkBF9vb5NADBNfix93Z//PI+zIxKfz8Ier/ISISKNYMAfr+EhEnLAtBxNMKWxUJwvUIRSUY4hUa5QHkGEL4BrkiGCw6su05EcQBDP3/2BYL+xkMAUhPB84XEg0V9ewFTaIYDznNAyQ1/wQOHuEWKCD13tzFOhkVyukoLhIADDagncUFd9oyNwzwQwAiIycj/0UYG+Ld/LoC1Pn6E/c8LOv2JSvw/R7xvx/JEp5MQBkY7vm89iYbxCQhEB4i2dsfDDXKDubPgPP76vWrN/jN9d/24bTXFyzYyoGbE+nxDxs6xAgO3wEw9/WFAzUXBOQWAuO9JAwHN+tYFP/r7wMpIPby+8dDORUX/uW36HgVEt0q+QPT50zeMgvKpQOP7PsvD9ERG/3m+QoHSthA+fvoz+j99hvv+P0O5SENJxz52h0QLBM3/QnzxysrHwCj7xPIBPTnJavziiHvOEew/Ab17i/MGQkwlQEVFP0K8PwYER/D7s4Y9gxHGgv9BAEA+dgSJt4mEQjeAhV74OYrDt7/9yXwBu/CRBYRC7UhsD73tUwk1/jY9bko2T7PrxD3zDQ9EZnl9vjKxxUX8MwkEgr7CA/jBe3bCMsGE9sm7zAKAFEuRuNlCyzU/RgLAw73Cw7TDS79x0QsP2IZ5OkPIPY1+v73+hCV9fXkOznqJipTGwUd4gzr8x8m6zr29vH++wsMt+TaFgLnScz0ySDBFTMhNOY35uY54PzMwxXfpc1Fpsva1Ay07E3T+VYrk9+X2If2ALgtzbXP2v/CEv8e1PL2vSj23i7A4B3zIQPg+xzl510YRNg5F/3rxhHZ7+qnCxLSGxgufz1XH3/cL+kvf+hueh5kAGD0BjIs80kEN/XxMSr6FN06EiYqSBPrCwnbBx0fEO8NzhMF6TPw+wToTArL5Pm/Sijw4yDwz939O6DO1dXD8fjc3t/yC/3ZBI6F9c/rDsgBK8EaKBL25vLx3d31INS9AhYHA/fizeQcBuoQIufMyvj6BQgU8O/UGwMf+9D//XQLR+HRbTLq9McgQgjno8r2E7TeYTDc7uLZ5vQcDgz04SYCCgTYFBDDAkAnBQ8hKMPPXfYhHPXl7ifC+vo+C/gmvQwbJ+V77vq/U8AUE/UhGBE4TgfxNpv3c6AyMyMiGyXY9QjcKtMC6QBD+PfzMvLlBAD48h73HQ8J2iX4MtI2KfX49eYnLQ7m7+VFJidiQgAqe5vtrXXgOAoMqE/LOD9fwgkk87HwJdIj3g4RygUV+Qc/OA8btOcE5sEcvcwr0boo9Ci+2wAjJcsE780LFQ7e/BjWHRYHHAwlJ9ntQcTO/gFSJxPp1eq93d4gZlF/JEPTAb3M/CMUHEdW3fet3gwJ6QIOHOkH5y0HEdsA7R8aKOXwEQXrFxhgyTTt8voBMt5WyyYCzNzzPKuIIAf0Fkb5oia04ewP5AcGKDVYAyYS+OrpMyX3DeAZ6xsfFBL38wEV6PMnD/Xj3BIPCBsVov/qMUL/Bv3Y7gYcDCHFPjzQWv9sCRL+G02/UtDa7fV/MkIS8+o82ijy5vMmQzkeIRokJu8b5BQMwBIF3+UN5iAj+9DyXCvR8igLM0IWwfDDBOQbFN/i6+PLH9gYK/ztFUMUZPCjTvruzNv3QuH4GhIEGOoR/vMbAAju5wXr6PkSoxUHArVFMvvx7zzWNwH8AwouEPMt+fbUlDEC8cD0uCDa0wrKDfPl3MA6wptYqrnZ94AgD/w28Nnm3C4wwPYTHvMi+DI86vr14gUyIDgAGQZEC+Mt9/QEARLPANrtWh0jMwjQYP/09+DBv/kmWRyr5OnngDhP3GP62wfzu9LjGUDrEQEqvgFQGuAVDw8GBvYPfwUmG1fH5wtI6/sL875OJP0p6wjfF0kcOef7BOrRDwTHuCEBEgI1uZ3r/ZFsR/JSGT3QBQnN7Of9Dt8O/d4WDO3a8AIVEBrhSyzhEBpCEffq6hbUFhsCOvIKt9Y358NI/x7G5z8a0Nga4jwI7//u7Cvs/OR/lh1GQOUn3/uo2MwaLO8XAs8W9/hWMdXEAQotJMv8ISYwuAETFb8E+8Ib5xH6BtPZ0gQaf/cS3+79IQL7D+bqi8HvxT22B9HGgL0P8IAMAhQJ0NgrA9jw2vrq5PDF6gb7C/S+2BvC1O0m/Sf4KOgNFTLE6jXj+gEWxQAR2XOAqwAA0KsAANC0AAAgAAAAGAAAAA51"),n(t,48048,"j6gfgILDVd12gMN/gO+Af2j3gCEtfwVTVICrgNMwy4Auf+99ddeLpYG8/6ewIGoHpLsAALC7AAAYAAAAAgAAAAE="),n(t,48132,"BcEjPel9oz0llvQ94nQiPqwcSj7dJXE+NLqLPrR3nj7kv7A+rYjCPiXJ0z4YeuQ+GJX0PsgKAj8cfAk/SZ0QP8ptFz/A7R0/nx0kP1T+KT8ukS8/4Nc0P2PUOT/wiD4/0/dCP6sjRz8XD0s/2LxOP60vUj9qalU/zm9YP5pCWz+O5V0/S1tgP26mYj9kyWQ/m8ZmP2+gaD/3WGo/gPJrP99ubT8L0G4/yhdwP+BHcT/hYXI/TWdzP5ZZdD8MOnU//wl2P4rKdj+7fHc/wCF4P2K6eD+dR3k/S8p5PyRDej/ysno/Oxp7P8h5ez8g0ns/yCN8PzdvfD/ytHw/XvV8P+AwfT/sZ30/t5p9P7TJfT8G9X0/ER1+PxhCfj9OZH4/04N+P/2gfj/tu34/w9R+P7Prfj/vAH8/hxR/P40mfz9DN38/qkZ/P+NUfz8PYn8/L25/P2R5fz++g38/P41/PxiWfz84nn8/wqV/P6Osfz8Qs38/9bh/P3e+fz9yw38/Gch/P2zMfz9b0H8/BtR/P2/Xfz+D2n8/Zt1/PxXgfz+C4n8/zeR/P+bmfz/N6H8/kup/P0bsfz/I7X8/KO9/P3jwfz+m8X8/w/J/P7/zfz+69H8/lPV/P172fz8n938/z/d/P3f4fz/9+H8/lPl/Pwn6fz9/+n8/9Pp/P1n7fz+t+38/Afx/P1T8fz+Y/H8/2/x/Px79fz9Q/X8/gv1/P7X9fz/n/X8/Cf5/Pzv+fz9d/n8/fv5/P4/+fz+w/n8/0v5/P+P+fz/0/n8/Ff9/Pyb/fz83/38/R/9/P1j/fz9Y/38/af9/P3r/fz96/38/i/9/P5v/fz+b/38/m/9/P6z/fz+s/38/vf9/P73/fz+9/38/zv9/P87/fz/O/38/zv9/P87/fz/e/38/3v9/P97/fz/e/38/3v9/P97/fz/v/38/7/9/P+//fz/v/38/7/9/P+//fz/v/38/7/9/P+//fz/v/38/7/9/P+//fz/v/38/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8="),n(t,48944,"5lo0OHdOMznT2ck5kpEzOsxgjDph+8k6mX4JO8uAMzvVJWM7dy6MO6iKqTtFuMk7h6bsO+guCTyuZh089wIzPJP/STxPWGI8XhF8PC6Rizy9x5k8XKyoPPM8uDyBecg87l/ZPDnw6jxjKv08NQcIPRDMET3N5Bs9YVAmPcsOMT0AHzw9/oBHPcY0Uz0/OF89aYtrPUUueD1pkII9ezCJPeD3jz2K5ZY9e/mdPbEzpT0hk6w9UBi0PTPCuz1PkcM9EoTLPQKb0z0f1ts91zPkPa+07D0hWPU9qB3+PaGCAz7yBgg+x5sMPt1AET409hU+RbsaPhGQHz5UdCQ+y2cpPjNqLj6NezM+Ups4PsXJPT4cBkM+WVBIPnqoTT63DVM+UoBYPggAXj5UjGM+8iRpPiXKbj4ke3Q+rDd6PgAAgD6r6YI++diFPoXNiD5Qx4s+N8aOPvfJkT6z0pQ+JuCXPg/ymj5sCJ4+HCOhPv9BpD7QZKc+sYuqPhy2rT5U5LA+0xW0PrpKtz7ogro++b29Pg38wD7iPMQ+VoDHPkfGyj6VDs4++1jRPnql1D7x89c+HETbPtmV3j4I6eE+pz3lPlOT6D4M6us+r0HvPhya8j4O8/U+iEz5PiKm/D4AAAA/76wBP7xZAz95BgU/8rIGPylfCD/6Cgo/VrYLPyxhDT98Cw8/E7UQP/JdEj8IBhQ/Q60VP4JTFz+2+Bg/3JwaP9U/HD+P4R0/+YEfPwQhIT+MviI/o1okPxf1JT/WjSc/8iQpPyi6Kj+YTSw/Ad8tP3JuLz/K+zA/+YYyP+0PND+nljU/BBs3P+WcOD9YHDo/PZk7P4MTPT8qiz4/AABAPxVyQT834UI/d01EP8O2RT/rHEc//n9IP+zfST+SPEs/4ZVMP+rrTT95Pk8/j41QPyvZUT8dIVM/c2VUPw2mVT/r4lY//BtYPy9RWT9zglo/ya9bPw7ZXD9D/l0/WB9fP0s8YD/8VGE/amliP4V5Yz88hWQ/oIxlP36PZj/WjWc/uodoP/Z8aT+cbWo/illrP9FAbD9PI20/BAFuP/HZbj/zrW8/HH1wP0lHcT98DHI/tMxyP/CHcz8QPnQ/E+90P/qadT+zQXY/P+N2P41/dz+tFng/fqh4PwE1eT80vHk/GD56P526ej/CMXs/d6N7P7sPfD+fdnw/Ath8P/QzfT9lin0/RNt9P7Mmfj+PbH4/66x+P6Pnfj/aHH8/f0x/P4F2fz8Cm38/0Ll/PxzTfz/F5n8/y/R/Py/9fz8AAIA/BAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAoAAAAMAAAADgAAABAAAAAUAAAAGAAAABwAAAAiAAAAKAAAADAAAAA8A=="),n(t,49986,"gD4AAIA+AACAPgAAgD4AAIA+AACAPgAAgD4AAIA+AACAPgAAgD4AAIA+AACAPgAAgD4AAIA+AACAPgAAgD7QJbQ+lzmtPgmlnz767Ys+zaxlPvipKj40MNI9WvENPVrxDb00MNK9+Kkqvs2sZb767Yu+CaWfvpc5rb7QJbS+h4qxPhuDlj5gI0k+xEKNPcRCjb1gI0m+G4OWvoeKsb6HirG+G4OWvmAjSb7EQo29xEKNPWAjST4bg5Y+h4qxPpc5rT7NrGU+WvENPfipKr4JpZ++0CW0vvrti740MNK9NDDSPfrtiz7QJbQ+CaWfPvipKj5a8Q29zaxlvpc5rb59Pac+0osKPtKLCr59Pae+fT2nvtKLCr7Siwo+fT2nPn09pz7Siwo+0osKvn09p759Pae+0osKvtKLCj59Pac+CaWfPlrxDT367Yu+lzmtvjQw0r3NrGU+0CW0PvipKj74qSq+0CW0vs2sZb40MNI9lzmtPvrtiz5a8Q29CaWfvhuDlj7EQo29h4qxvmAjSb5gI0k+h4qxPsRCjT0bg5a+G4OWvsRCjT2HirE+YCNJPmAjSb6HirG+xEKNvRuDlj767Ys++Kkqvpc5rb5a8Q090CW0PjQw0j0JpZ++zaxlvs2sZT4JpZ8+NDDSvdAltL5a8Q29lzmtPvipKj767Yu+YXNzZXJ0aW9uIGZhaWxlZDogc3QtPm1vZGUgPT0gTU9ERV9IWUJSSUQgfHwgY3Vycl9iYW5kd2lkdGggPT0gT1BVU19CQU5EV0lEVEhfV0lERUJBTkQAc3JjL29wdXNfZW5jb2Rlci5jAGFzc2VydGlvbiBmYWlsZWQ6IHN0LT5zaWxrX21vZGUuaW50ZXJuYWxTYW1wbGVSYXRlID09IDE2MDAw"),n(t,50672,"4C4AAOgDAACwNgAA6AMAAIA+AADoAwAAIE4AAOgDAADwVQAA6AM="),n(t,50740,"4C4AABAnAAAQJwAA+CoAAPgqAACAPgAAvDQAALw0AACYOgAAmDoAACBOAACAPgAAgD4AAFBGAABQRgAAwF0AAFBGAABQRgAACFIAAAhSAAAAfQAA8FUAAPBVAABgbQAAYG0AAAD6AABwlAAAcJQAAFDDAABQwwAADQAAABEAAAARAAAAEwAAAAAAAAAIAAAABAAAAOF6VD/2KFw/nMcAABAAAAAEAAAAmplZP65HYT+cxwAAIAAAAAQAAADBymE/w/VoP5zHAAAwAAAACAAAALgeZT+DwGo/pMcAAEAAAAAIAAAAqMZrP9ejcD+kxwAAUAAAABAAAAAxCGw/16NwP6zHAABgAAAAEAAAANejcD+F63E/rMcAAIAAAAAQAAAAMzNzPzMzcz+sxwAAoAAAABAAAACPwnU/j8J1P6zHAADAAAAAIAAAANnOdz/Zznc/tMcAAAABAAAgAAAAmpl5P5qZeT+0xwAAwMcAACAAAADgyAAAIAAAAADKAAAgAAAAIMsAAEAAAAAAAAAAJZHguiDq7z8AAAAAAADwPyWR4Log6u8/3ksrz82o7z9aH/+a5jzvP1XPF7Xap+4/vqBk9qLr7T/XkG46uArtP4voz2UHCOw/td5vtOPm6j9YAHQU96rpPyJyVTQxWOg/UMWuabXy5j9Y5LYByH7lP5RFJ2y7AOQ/RytKS9184j+po+NqZPfgP6qpl6W+6N4/FsR6gkjv2z9LZsyPhQnZPz/p4VfuPdY/wmpufT+S0z+gvqdqaQvRPytyXzkIW80/J5liL5D3yD+hB8qvF/HEP8pirICMSsE/IsW+bFQKvD9hhQCFH0G2P4/ecB+5NbE/Q4TJnk7DqT8he3vfEXiiP/NHKOi855g/We0O5+l1jj8hAg6hSs1+PwAAAAAAAAAAwVNMzh7i7z8AAAAAAADwP8FTTM4e4u8/z0LImg2J7z8MbeeYf/buP4gSLXk8Le4/mk30twwx7T+1sMC6ngbsP8yZDhlms+o/3Hksx3U96T9RqyK7VqvnP5U2yU3cA+Y/davnpPdN5D93AJvei5DiPxOB6h9E0uA/xgDD0dky3j9TPgRVo9faP9kIYcE/ndc/qGoG4Z+M1D9uJH0YKa3RP1rvefZDCc4/GwBgK1cuyT9RlmsbkM7EP4vsWq3Z68A/6dYpXn4Kuz/fF/rUby61PwYNgUwAOLA/yr1E5fQvqD+mFfjtmHihP0v1U9J5Q5g/lM+f9I0BkD8Abjc9/6iDP95pGUbNmXU/4IWMy+EoYz/8qfHSTWJAPwAAAAAAAAAAuaajkCLa7z8AAAAAAADwP7mmo5Ai2u8/hQsW2ntp7z9ERs1417DuPyZTw4bAtO0/M9ouXVZ77D+pzhc5EwzrP6nqcSGHb+k/cuaRHgqv5z/W0WnEadTlP8CnpBSV6eM/OaAA5Ur44T/qgxvfzQngP1Vq1TJCTdw/Q13e+5+s2D8PWvbBhT7VPx8F28pDDdI/oGc3IxhBzj+Mi3rz4frIP/CuSIb7TMQ/dOMnH8w3wD/uYYrNIm+5PztOVcoAirM/6GEuyuhXrT8kM80qInmlP7tpbfnMgp4/Iix0b4/vlD8+Ed0W2YyLP13CX5umMoE/UAiy2AUHdD+ByCq+BBtlP9zuq5Ov21I/G8qaom1GNz8="),n(t,52e3,"yFEM0oT07z8AAAAAAADwP8hRDNKE9O8/9pUH6SnS7z/a08TxMpnvP9T9ENkPSu8/fp+7blvl7j9hwT+d2WvuPx3X8SV13u0/an9v7Dw+7T/J6jXBYIzsP3ckRQEuyus/Hrx+2gv56j860L80dxrqP/UlI4D+L+k/8kBDgz076D8OB1Pe2D3nP/fyr6N5OeY/TMjFIMkv5T/OuHiRbCLkP/+ZWhkBE+M/L5wx7RcD4j9j2QbNMvTgP01ahnKBz98/zY9k+zW+3T8VxjeQBbfbP+AHrag9vNk/YDMKk/PP1z/zHfzEAfTVP0qFZ/gFKtQ/5808FGBz0j+NyjQ3MtHQP9jRevDBiM4/ryd4Eiqbyz/ISJPeedrIP7XPWyMfR8Y/PVdCFB/hwz+1zQFAHajBP026kLvGNr8/LgwmONRzuz9mkgUKxAS4P4BUFsd55rQ/YkhOJm4Vsj+kFYSXhRuvP+yy6yCnlqo/l6hBRZOTpj8+eC/vWAmjP9XnrEfI3Z8/bM9NFzl2mj/08djo/8mVPw8LtaZ5x5E/VRds+h67jD/+pLEosveGPzy3lup+JYI/pfu1zFROfD9nH1R3n8J1PwXEfxU7dXA/dH+znJ1vaD/T8PMAksBhP/dS2/qnI1k/P8Gs7XlAUT/xQgCR+sJGP3uyzVM+gDw/JlGSIvCPMD/HVG5gehQhP32Jfzcgqws/8WjjiLX45D4="),n(t,52545,"0VAAAAAAAAU="),n(t,52564,"AQ=="),n(t,52588,"AgAAAAMAAAC40A=="),n(t,52612,"Ag=="),n(t,52627,"//////8="),n(t,52868,"4NA=");var tK=((i=[null,function(e){return 0|N(0|function(e){return e}(u[(e|=0)+60>>2]))},function(e,t,r){e|=0,t|=0,r|=0;var i=0,n=0,o=0,a=0,s=0,c=0,d=0;M=i=M-32|0,n=u[e+28>>2],u[i+16>>2]=n,o=u[e+20>>2],u[i+28>>2]=r,u[i+24>>2]=t,t=o-n|0,u[i+20>>2]=t,c=t+r|0,d=2,t=i+16|0;t:{r:{i:{if(!tU(0|P(u[e+60>>2],i+16|0,2,i+12|0)))for(;;){if((0|c)==(0|(n=u[i+12>>2])))break i;if((0|n)<=-1)break r;if(s=((o=(a=u[t+4>>2])>>>0<n>>>0)<<3)+t|0,a=n-(o?a:0)|0,u[s>>2]=a+u[s>>2],u[(s=(o?12:4)+t|0)>>2]=u[s>>2]-a,c=c-n|0,t=o?t+8|0:t,d=d-o|0,!!tU(0|P(u[e+60>>2],0|t,0|d,i+12|0)))break}if((0|c)!=-1)break r}t=u[e+44>>2],u[e+28>>2]=t,u[e+20>>2]=t,u[e+16>>2]=u[e+48>>2]+t,e=r;break t}if(u[e+28>>2]=0,u[e+16>>2]=0,u[e+20>>2]=0,u[e>>2]=32|u[e>>2],e=0,(0|d)==2)break t;e=r-u[t+4>>2]|0}return M=i+32|0,0|(n=e)},function(e,t,r,i){e|=0,t|=0,r|=0,i|=0;var n=0;return M=n=M-16|0,e=tU(function(e,t,r,i,n){return 0|L(0|e,0|t,0|r,0|i,0|n)}(u[e+60>>2],t,r,255&i,n+8|0)),M=n+16|0,r=u[n+12>>2],x=e?-1:r,t=u[n+8>>2],(e?-1:t)|0},function(e,t,r,i,n,o,a){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0,a|=0;var s=0,c=0;t:{r:{if((0|r)>=1){for(;;){if(m[(s<<2)+t>>2]=m[(E(i+s|0,a)+n<<2)+e>>2]*g(32768),(0|(s=s+1|0))==(0|r))break}if((0|o)<=-1)break r;if((0|r)<1)break t;for(s=0;;){if(m[(n=(s<<2)+t|0)>>2]=m[n>>2]+g(m[(E(i+s|0,a)+o<<2)+e>>2]*g(32768)),(0|(s=s+1|0))==(0|r))break}break t}if((0|o)>-1)break t}if((0|o)!=-2|(0|a)<2)break t;for(o=1,c=(0|r)<1;;){if(s=0,!c)for(;;){if(m[(n=(s<<2)+t|0)>>2]=m[n>>2]+g(m[(E(i+s|0,a)+o<<2)+e>>2]*g(32768)),(0|(s=s+1|0))==(0|r))break}if((0|a)==(0|(o=o+1|0)))break}}},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=0,s=0,c=0,d=0,l=0,h=0,p=0,f=0,_=0,A=0,v=0,S=0,b=0,T=0,y=0,R=0,I=0,C=0,k=0;t<<=2,v=t+u[e+64>>2]|0,d=u[v>>2],S=u[e+60>>2]+t|0,a=u[S>>2],b=u[i>>2];t:if(!((0|a)>=(0|b))){for(f=u[e+12>>2],y=u[e+40>>2],R=u[e+36>>2],I=u[e+92>>2],C=u[e+76>>2],T=(0|(i=u[o>>2]))>0?i:0,k=(0|(_=u[e+24>>2]))<1;;){if((0|s)==(0|T)){s=T;break t}A=0;n:{if(k){l=0,h=0,p=0;break n}for(i=(a<<2)+r|0,t=(E(d,_)<<2)+C|0,o=0,p=0,h=0,l=0;;){if(l+=+g(m[t+(e=o<<2)>>2]*m[e+i>>2]),A+=+g(m[(c=12|e)+t>>2]*m[i+c>>2]),p+=+g(m[(c=8|e)+t>>2]*m[i+c>>2]),e|=4,h+=+g(m[t+e>>2]*m[e+i>>2]),!((0|_)>(0|(o=o+4|0))))break}}if(m[(E(s,I)<<2)+n>>2]=l+h+p+A,d=(e=d+y|0)-(e>>>0<f>>>0?0:f)|0,s=s+1|0,!((0|b)>(0|(a=(a+R|0)+(e>>>0>=f>>>0)|0))))break}}return u[S>>2]=a,u[v>>2]=d,0|s},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=0,s=0,c=0,d=0,l=g(0),h=0,p=0,f=0,_=0,A=0,v=0,S=0,b=0,T=0,y=0;t<<=2,h=t+u[e+64>>2]|0,c=u[h>>2],p=u[e+60>>2]+t|0,a=u[p>>2],f=u[i>>2];t:if(!((0|a)>=(0|f))){for(d=u[e+12>>2],A=u[e+40>>2],v=u[e+36>>2],S=u[e+92>>2],b=u[e+76>>2],_=(0|(i=u[o>>2]))>0?i:0,T=(0|(t=u[e+24>>2]))<1;;){if((0|s)==(0|_)){s=_;break t}if(l=g(0),!T)for(o=(a<<2)+r|0,y=(E(t,c)<<2)+b|0,e=0;;){if(l=g(l+g(m[y+(i=e<<2)>>2]*m[i+o>>2])),(0|t)==(0|(e=e+1|0)))break}if(m[(E(s,S)<<2)+n>>2]=l,c=(e=c+A|0)-(e>>>0<d>>>0?0:d)|0,s=s+1|0,!((0|f)>(0|(a=(a+v|0)+(e>>>0>=d>>>0)|0))))break}}return u[p>>2]=a,u[h>>2]=c,0|s},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=g(0),s=0,c=g(0),d=0,l=0,h=0,p=0,f=0,_=0,A=0,v=0,S=0,b=0,T=0,y=0,R=0,I=g(0),C=0,k=0,w=0,O=g(0),N=0,P=0,D=0,L=0,M=0;t<<=2,S=t+u[e+64>>2]|0,f=u[S>>2],b=u[e+60>>2]+t|0,d=u[b>>2],T=u[i>>2];t:if(!((0|d)>=(0|T))){for(C=u[e+40>>2],k=u[e+36>>2],w=u[e+92>>2],y=(0|(i=u[o>>2]))>0?i:0,O=g((l=u[e+12>>2])>>>0),N=(0|(R=u[e+24>>2]))<1;;){if((0|p)==(0|y)){p=y;break t}t=i=E(f,o=u[e+48>>2]),i=(i>>>0)/(l>>>0)|0,c=g(g(t-E(l,i)>>>0)/O);n:{if(N){s=0,h=0,_=0,A=0;break n}for(P=(d<<2)+r|0,D=4-i|0,L=u[e+76>>2],i=0,A=0,_=0,h=0,s=0;;){if(a=m[(i<<2)+P>>2],_+=+g(a*m[(t=(E(o,i=i+1|0)+D<<2)+L|0)>>2]),A+=+g(a*m[t+4>>2]),h+=+g(a*m[t-4>>2]),s+=+g(a*m[t-8>>2]),(0|i)==(0|R))break}}if(a=g(c*g(.16666999459266663)),I=g(c*g(c*a)),M=s*(v=+g(I-a)),a=g(c*g(c*g(.5))),h=M+h*(s=+g(g(c+a)-g(c*a))),v=1-v-s,s=+g(g(a+g(c*g(-.3333300054073334)))-I),m[(E(p,w)<<2)+n>>2]=h+_*+g(v-s)+A*s,f=(i=f+C|0)-(i>>>0<l>>>0?0:l)|0,p=p+1|0,!((0|T)>(0|(d=(d+k|0)+(i>>>0>=l>>>0)|0))))break}}return u[b>>2]=d,u[S>>2]=f,0|p},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=g(0),s=g(0),c=g(0),d=0,l=0,h=0,p=0,f=g(0),_=g(0),A=g(0),v=0,S=0,b=0,T=0,y=0,R=g(0),I=g(0),C=0,k=0,w=0,O=g(0),N=0,P=0,D=0,L=0,M=g(0);t<<=2,v=t+u[e+64>>2]|0,p=u[v>>2],S=u[e+60>>2]+t|0,d=u[S>>2],b=u[i>>2];t:if(!((0|d)>=(0|b))){for(C=u[e+40>>2],k=u[e+36>>2],w=u[e+92>>2],T=(0|(i=u[o>>2]))>0?i:0,O=g((l=u[e+12>>2])>>>0),N=(0|(y=u[e+24>>2]))<1;;){if((0|h)==(0|T)){h=T;break t}t=i=E(p,o=u[e+48>>2]),i=(i>>>0)/(l>>>0)|0,s=g(g(t-E(l,i)>>>0)/O);n:{if(N){c=g(0),f=g(0),_=g(0),A=g(0);break n}for(P=(d<<2)+r|0,D=4-i|0,L=u[e+76>>2],i=0,A=g(0),_=g(0),f=g(0),c=g(0);;){if(a=m[(i<<2)+P>>2],_=g(_+g(a*m[(t=(E(o,i=i+1|0)+D<<2)+L|0)>>2])),A=g(A+g(a*m[t+4>>2])),f=g(f+g(a*m[t-4>>2])),c=g(c+g(a*m[t-8>>2])),(0|i)==(0|y))break}}if(a=g(s*g(.16666999459266663)),R=g(s*g(s*a)),I=g(R-a),M=g(I*c),a=g(s*g(s*g(.5))),c=g(g(s+a)-g(s*a)),a=g(g(a+g(s*g(-.3333300054073334)))-R),m[(E(h,w)<<2)+n>>2]=g(g(M+g(c*f))+g(_*g(1-+I-+c-+a)))+g(a*A),p=(i=p+C|0)-(i>>>0<l>>>0?0:l)|0,h=h+1|0,!((0|b)>(0|(d=(d+k|0)+(i>>>0>=l>>>0)|0))))break}}return u[S>>2]=d,u[v>>2]=p,0|h},function(e,t,r,i,n,o){e|=0,t|=0,r|=0,i|=0,n|=0,o|=0;var a=0,s=0,c=0,d=0,l=0,h=0,p=0;s=(r=t<<2)+u[e+64>>2]|0,a=u[s>>2],t=0,c=u[e+60>>2]+r|0,r=u[c>>2],d=u[i>>2];t:if(!((0|r)>=(0|d))){for(i=u[e+12>>2],l=u[e+40>>2],h=u[e+36>>2],p=u[e+92>>2],o=(0|(t=u[o>>2]))>0?t:0,t=0;;){if((0|t)==(0|o)){t=o;break t}if(u[(E(t,p)<<2)+n>>2]=0,a=(e=a+l|0)-(e>>>0<i>>>0?0:i)|0,t=t+1|0,!((0|d)>(0|(r=(r+h|0)+(e>>>0>=i>>>0)|0))))break}}return u[c>>2]=r,u[s>>2]=a,0|t}]).set=function(e,t){this[e]=t},i.get=function(e){return this[e]},i);return{__wasm_call_ctors:function(){},opus_encoder_create:function(e,t,r,i){e|=0,t|=0,r|=0,i|=0;var n=0,o=0;M=o=M-16|0;t:{r:{i:{n:{if((0|e)<=15999){if((0|e)==8e3|(0|e)==12e3)break n;break i}if((0|e)==16e3|(0|e)==48e3)break n;if((0|e)!=24e3)break i}if(t-1>>>0>1||(n=r-2048|0)>>>0>3)break i;if((0|n)!=2)break r}if(n=0,!i)break t;u[i>>2]=-1;break t}if(n=0,!tG(o+12|0)&&(u[o+12>>2]=u[o+12>>2]+3&-4,n=(tN(t)+u[o+12>>2]|0)+18140|0),!(n=V(n))){if(n=0,!i)break t;u[i>>2]=-7;break t}if(e=function(e,t,r,i){var n=0,o=0,a=0;M=n=M-32|0,a=-1;t:{r:{if((0|t)<=15999){if((0|t)==8e3|(0|t)==12e3)break r;break t}if((0|t)==16e3|(0|t)==48e3)break r;if((0|t)!=24e3)break t}if(r-1>>>0>1||(o=i-2048|0)>>>0>3|(0|o)==2)break t;if(o=0,!tG(n+28|0)&&(u[n+28>>2]=u[n+28>>2]+3&-4,o=(tN(r)+u[n+28>>2]|0)+18140|0),e=ex(e,0,o),tG(n+28|0))break t;if(a=u[n+28>>2]+3&-4,u[n+28>>2]=a,u[e+14192>>2]=r,u[e+112>>2]=r,u[e+4>>2]=18140,u[e+180>>2]=0,u[e+144>>2]=t,o=a+18140|0,u[e>>2]=o,a=-3,eX(e+18140|0,0,e+8|0))break t;if(u[e+8>>2]=r,u[e+12>>2]=r,u[e+76>>2]=0,u[e+56>>2]=0,u[e+60>>2]=0,u[e+44>>2]=9,u[e+48>>2]=0,u[e+36>>2]=25e3,u[e+40>>2]=0,u[e+28>>2]=16e3,u[e+32>>2]=20,u[e+20>>2]=16e3,u[e+24>>2]=8e3,u[e+16>>2]=u[e+144>>2],function(e,t,r,i){var n=0,o=0;o=-1,n=td(48e3,960,0);t:if(!(r>>>0>2)){if(o=-7,!e|!n)break t;o=0,e=ex(e,0,E(((u[n+4>>2]<<2)+(u[n+8>>2]<<4)|0)+4096|0,r)+244|0),u[e+28>>2]=1,u[e+32>>2]=0,u[e+8>>2]=r,u[e+4>>2]=r,u[e>>2]=n,r=u[n+12>>2],u[e+24>>2]=5,u[e+60>>2]=24,u[e+12>>2]=0,u[e+16>>2]=1,u[e+40>>2]=-1,u[e+44>>2]=0,u[e+72>>2]=i,u[e+48>>2]=1,u[e+52>>2]=1,u[e+36>>2]=r,H(e,4028,0),u[e+28>>2]=function(e){var t=0;t:{r:{i:{n:{if((0|e)<=15999){if((0|e)==8e3)break n;if((0|e)!=12e3)break i;return 4}if((0|e)==16e3)break r;if(t=1,(0|e)==48e3)break t;if((0|e)!=24e3)break i;return 2}return 6}tO(1659,1679,84),k()}t=3}return t}(t)}return o}(o=e+o|0,t,r,u[e+180>>2]))break t;a=0,u[n+16>>2]=0,H(o,10016,n+16|0),u[n>>2]=u[e+44>>2],H(o,4010,n),u[e+148>>2]=1,u[e+152>>2]=1,u[e+160>>2]=E(t,r)+3e3,u[e+128>>2]=-1e3,u[e+132>>2]=1105,u[e+108>>2]=i,u[e+136>>2]=-1e3,u[e+140>>2]=-1,u[e+120>>2]=-1e3,u[e+124>>2]=-1e3,u[e+164>>2]=-1e3,u[e+168>>2]=24,u[e+156>>2]=5e3,u[e+14204>>2]=0x3f800000,d[e+14196>>1]=16384,t=u[e+144>>2],u[e+172>>2]=(0|t)/100,u[e+116>>2]=(0|t)/250,t=tE(60),u[e+14252>>2]=1,u[e+14240>>2]=1105,u[e+14224>>2]=1001,u[e+14200>>2]=t<<8,function(e,t){u[e+8>>2]=t,u[e>>2]=0,ex(e+12|0,0,13992)}(e+188|0,u[e+144>>2]),u[e+192>>2]=u[e+108>>2]}return M=n+32|0,a}(n,e,t,r),i&&(u[i>>2]=e),!e)break t;X(n),n=0}return M=o+16|0,0|n},opus_encode_float:function(e,t,r,i,n){e|=0,t|=0,r|=0,i|=0,n|=0;var o=0,a=0,s=0,c=0,d=0;d=-1,s=(0|(o=u[e+144>>2]))/400|0;t:if(!((0|s)>(0|r))){if(a=r,(0|(c=u[e+156>>2]))!=5e3&&((a=c-5001|0)>>>0>8||(0|(a=(0|c)<=5005?s<<a:(0|E(c-5003|0,o))/50|0))>(0|r)))break t;o:if(!((0|E(a,100))==(0|o)|(0|E(a,400))==(0|o)|(0|E(a,200))==(0|o))&&!((0|(s=E(a,50)))==(0|E(o,6))|(0|E(o,5))==(0|s)|(o<<2==(0|s)|(0|E(o,3))==(0|s)))&&(0|o)!=(0|s)){if((0|E(a,25))!=(0|o))break t}d=a}return 0|U(e,t,d,i,n,24,t,r,0,-2,u[e+112>>2],4,1)},opus_encoder_ctl:function(e,t,r){e|=0,t|=0,r|=0;var i=0,n=0,o=0,a=0,s=0;M=i=M-208|0,u[i+204>>2]=r,n=u[e>>2]+e|0,r=-5;t:{r:{i:{n:{o:{a:{s:{c:{d:{u:{l:{h:{q:{Z:{p:{$:{ee:{f:{et:{er:{_:{en:{eo:{A:{switch(t-4e3|0){default:switch(t-10015|0){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 10:break t;case 0:break r;case 11:break n;case 9:break o;default:break}switch(t-11002|0){case 17:break eo;case 16:break A;case 0:break a;default:break t}case 0:if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(n=(t=u[t>>2])-2048|0)>>>0>3|(0|n)==2|(u[e+108>>2]!=(0|t)?!u[e+14252>>2]:0))break t;u[e+108>>2]=t,u[e+192>>2]=t,r=0;break t;case 1:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+108>>2],r=0;break t;case 2:r=u[i+204>>2],u[i+204>>2]=r+4,n=e,t=u[r>>2];ew:{if((0|t)==-1e3){o=t;break ew}if(r=-1,o=t,(0|t)==-1)break ew;if((0|t)<1)break t;if(o=500,(0|t)<501)break ew;o=(0|t)>(0|(r=E(u[e+112>>2],3e5)))?r:t}r=o,u[n+164>>2]=r,r=0;break t;case 3:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(t=u[r>>2])){r=-1;break t}!(n=u[e+14236>>2])&&(n=u[e+144>>2]/400|0),r=u[e+164>>2];ex:{if((0|r)!=-1){if((0|r)!=-1e3)break ex;r=u[e+112>>2],r=E(r,e=u[e+144>>2])+((0|E(e,60))/(0|n)|0)|0;break ex}r=(0|E(u[e+144>>2],10208))/(0|n)|0}u[t>>2]=r,r=0;break t;case 22:r=u[i+204>>2],u[i+204>>2]=r+4,t=u[r>>2];eP:{if((0|t)>=1){if(r=-1,u[e+112>>2]>=(0|t))break eP;break t}if(r=-1,(0|t)!=-1e3)break t}u[e+120>>2]=t,r=0;break t;case 23:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+120>>2],r=0;break t;case 4:if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])-1101>>>0>4)break t;if(u[e+132>>2]=t,(0|t)==1101){u[e+20>>2]=8e3,r=0;break t}if((0|t)==1102){u[e+20>>2]=12e3,r=0;break t}u[e+20>>2]=16e3,r=0;break t;case 5:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+132>>2],r=0;break t;case 8:if(r=u[i+204>>2],u[i+204>>2]=r+4,(t=u[r>>2])-1101>>>0>=5&&(r=-1,(0|t)!=-1e3))break t;if(u[e+128>>2]=t,(0|t)==1101){u[e+20>>2]=8e3,r=0;break t}if((0|t)==1102){u[e+20>>2]=12e3,r=0;break t}u[e+20>>2]=16e3,r=0;break t;case 9:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+14240>>2],r=0;break t;case 16:if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])>>>0>1)break t;u[e+184>>2]=t,r=0;break t;case 17:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+184>>2],r=0;break t;case 10:if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])>>>0>10)break t;u[e+44>>2]=t,u[i>>2]=t,H(n,4010,i),r=0;break t;case 11:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+44>>2],r=0;break t;case 12:if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])>>>0>1)break t;u[e+48>>2]=t,r=0;break t;case 13:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+48>>2],r=0;break t;case 14:if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])>>>0>100)break t;u[e+40>>2]=t,u[i+16>>2]=t,H(n,4014,i+16|0),r=0;break t;case 15:if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+40>>2],r=0;break t;case 6:if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])>>>0>1)break t;u[e+148>>2]=t,u[e+60>>2]=1-t,r=0;break t;case 18:case 19:case 26:case 30:case 32:case 33:case 34:case 35:case 38:case 39:case 44:case 45:case 48:break t;case 43:break u;case 42:break l;case 41:break h;case 40:break q;case 37:break Z;case 36:break p;case 31:break $;case 29:break ee;case 27:break f;case 25:break et;case 24:break er;case 21:break _;case 20:break en;case 7:break;case 49:break i;case 28:break s;case 47:break c;case 46:break d}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+148>>2],r=0;break t}if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])+1>>>0>101)break t;u[e+140>>2]=t,r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+140>>2],r=0;break t}if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])>>>0>1)break t;u[e+152>>2]=t,r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+152>>2],r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,(t=u[r>>2])-3001>>>0>=2&&(r=-1,(0|t)!=-1e3))break t;u[e+124>>2]=t,r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+124>>2],r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(t=u[r>>2])){r=-1;break t}if(n=u[e+144>>2]/400|0,u[t>>2]=n,r=0,2051==u[e+108>>2])break t;u[t>>2]=u[e+116>>2]+n;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+144>>2],r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+18136>>2],r=0;break t}if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])-8>>>0>16)break t;u[e+168>>2]=t,r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+168>>2],r=0;break t}if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])-5e3>>>0>9)break t;u[e+156>>2]=t,r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+156>>2],r=0;break t}if(t=u[i+204>>2],u[i+204>>2]=t+4,r=-1,(t=u[t>>2])>>>0>1)break t;u[e+76>>2]=t,r=0;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(r=u[r>>2])){r=-1;break t}u[r>>2]=u[e+76>>2],r=0;break t}if(e=u[i+204>>2],u[i+204>>2]=e+4,r=-1,(e=u[e>>2])>>>0>1)break t;u[i+32>>2]=e,H(n,4046,i+32|0),r=0;break t}if(e=u[i+204>>2],u[i+204>>2]=e+4,!(e=u[e>>2])){r=-1;break t}u[i+48>>2]=e,H(n,4047,i+48|0),r=0;break t}t=u[e+4>>2],tW(e+188|0),r=0,ex(e+14192|0,0,3948),H(n,4028,0),eX(e+t|0,u[e+180>>2],i+104|0),u[e+14252>>2]=1,u[e+14204>>2]=0x3f800000,d[e+14196>>1]=16384,u[e+14240>>2]=1105,u[e+14224>>2]=1001,u[e+14192>>2]=u[e+112>>2],u[e+14200>>2]=tE(60)<<8;break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,(t=u[r>>2])-1e3>>>0>=3&&(r=-1,(0|t)!=-1e3))break t;u[e+136>>2]=t,r=0;break t}r=u[i+204>>2],u[i+204>>2]=r+4,r=u[r>>2],u[e+176>>2]=r,u[i+64>>2]=r,r=H(n,10024,i- -64|0);break t}r=u[i+204>>2],u[i+204>>2]=r+4,r=u[r>>2],u[e+14256>>2]=r,u[i+80>>2]=r,r=H(n,10026,i+80|0);break t}if(r=u[i+204>>2],u[i+204>>2]=r+4,!(a=u[r>>2])){r=-1;break t}if(!(!u[e+56>>2]|(-2&u[e+14228>>2])!=1e3)){if(r=u[e+4>>2],u[a>>2]=1,u[e+12>>2]<1){r=0;break t}for(s=e+r|0,n=0,o=1;;){if(t=0,t=o?u[(E(n,10064)+s|0)+6084>>2]>9:t,u[a>>2]=t,r=0,o=t,!((0|(n=n+1|0))<u[e+12>>2]))break}break t}if(u[e+184>>2]){u[a>>2]=u[e+18124>>2]>9,r=0;break t}r=0,u[a>>2]=0;break t}if(e=u[i+204>>2],u[i+204>>2]=e+4,!(e=u[e>>2])){r=-1;break t}u[i+96>>2]=e,r=H(n,10015,i+96|0)}return M=i+208|0,0|r},opus_encoder_destroy:function(e){X(e|=0)},speex_resampler_init:function(e,t,r,i,n){return 0|function(e,t,r,i,n,o,a){var s=0,c=0;t:{r:if(!e|!t|!r||!(o>>>0<11)){if(!a)break t;return u[a>>2]=3,0}if(!(s=tv(96,1))){if(s=0,!a)break t;return u[a>>2]=1,0}u[s>>2]=0,u[s+4>>2]=0,u[s+44>>2]=0x3f800000,u[s+16>>2]=-1,u[s+88>>2]=1,u[s+92>>2]=1,u[s+20>>2]=e,u[s+32>>2]=160,u[s+8>>2]=0,u[s+12>>2]=0,e<<=2,c=tv(e,1),u[s+60>>2]=c;o:if(c){if(c=tv(e,1),u[s+68>>2]=c,!c)break o;if(e=tv(e,1),u[s+64>>2]=e,!e)break o;u[s+16>>2]=o,function(e,t,r,i,n){var o=0,a=0,s=0,c=0,d=0;a=3;t:if(!(!t|!r)&&(u[e>>2]!=(0|i)|u[e+4>>2]!=(0|n)|u[e+8>>2]!=(0|t)||(a=0,u[e+12>>2]!=(0|r)))){for(u[e+8>>2]=t,u[e+4>>2]=n,u[e>>2]=i,s=u[e+12>>2],u[e+12>>2]=r,o=t,i=r;;){if(n=i,i=(o>>>0)%(i>>>0)|0,o=n,!i)break}i=(r>>>0)/(n>>>0)|0,u[e+12>>2]=i,u[e+8>>2]=(t>>>0)/(n>>>0);n:if(!(!s|!u[e+20>>2])){for(d=u[e+64>>2],n=0;;){if(a=5,r=0xffffffff/(i>>>0)|0,c=o=u[(t=(n<<2)+d|0)>>2],o=(o>>>0)/(s>>>0)|0,r>>>0<(c=c-E(s,o)|0)>>>0|r>>>0<o>>>0)break t;if(o=E(i,o),o>>>0>(-1^(i=(E(i,c)>>>0)/(s>>>0)|0))>>>0)break t;if(i=i+o|0,u[t>>2]=i,(o=u[e+12>>2])>>>0<=i>>>0&&(u[t>>2]=o-1),(n=n+1|0)>>>0>=A[e+20>>2])break n;i=u[e+12>>2]}}if(!u[e+52>>2])return 0;a=z(e)};}(s,t,r,i,n),e=z(s);a:{if(!e){u[s+52>>2]=1;break a}X(u[s+72>>2]),X(u[s+76>>2]),X(u[s+60>>2]),X(u[s+68>>2]),X(u[s+64>>2]),X(s),s=0}if(!a)break t;return u[a>>2]=e,s}a&&(u[a>>2]=1),X(u[s+76>>2]),X(u[s+60>>2]),X(u[s+68>>2]),X(u[s+64>>2]),X(s),s=0}return s}(e|=0,t|=0,r|=0,t,r,i|=0,n|=0)},speex_resampler_destroy:function(e){X(u[(e|=0)+72>>2]),X(u[e+76>>2]),X(u[e+60>>2]),X(u[e+68>>2]),X(u[e+64>>2]),X(e)},speex_resampler_process_interleaved_float:function(e,t,r,i,n){e|=0,t|=0,r|=0,i|=0,n|=0;var o=0,a=0,s=0,c=0,d=0,l=0;if(s=u[e+92>>2],c=u[r>>2],d=u[n>>2],o=u[e+20>>2],u[e+92>>2]=o,l=u[e+88>>2],u[e+88>>2]=o,o)for(o=0;;){u[n>>2]=d,u[r>>2]=c;i:{if(t){a=o<<2,eh(e,o,a+t|0,r,i+a|0,n);break i}eh(e,o,0,r,(o<<2)+i|0,n)}if(!((o=o+1|0)>>>0<A[e+20>>2]))break}return u[e+92>>2]=s,u[e+88>>2]=l,9==u[e+84>>2]|0},__errno_location:tY,stackSave:function(){return 0|M},stackRestore:function(e){e|=0,M=e},stackAlloc:function(e){return e|=0,M=e=M-e&-16,0|e},malloc:V,free:X,__indirect_function_table:tK,dynCall_jiji:function(e,t,r,i,n){return e|=0,t|=0,r|=0,i|=0,n|=0,e=function(e,t,r,i,n){return i=0|tK[0|e](t,r,i,n)}(e,t,r,i,n),D(0|(r=x)),0|e}}}(e)}(eo)},instantiate:function(e,t){return{then:function(t){var r=new U.Module(e);t({instance:new U.Instance(r)})}}},RuntimeError:Error};l=[],"object"!=typeof U&&J("no native wasm support detected");var B=!1;function V(e,t){!e&&J("Assertion failed: "+t)}var F="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function j(e,t,r){for(var i=t+r,n=t;e[n]&&!(n>=i);)++n;if(n-t>16&&e.subarray&&F)return F.decode(e.subarray(t,n));for(var o="";t<n;){var a=e[t++];if(!(128&a)){o+=String.fromCharCode(a);continue}var s=63&e[t++];if((224&a)==192){o+=String.fromCharCode((31&a)<<6|s);continue}var c=63&e[t++];if((a=(240&a)==224?(15&a)<<12|s<<6|c:(7&a)<<18|s<<12|c<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var d=a-65536;o+=String.fromCharCode(55296|d>>10,56320|1023&d)}}return o}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var G=y.INITIAL_MEMORY||0x1000000;(h=y.wasmMemory?y.wasmMemory:new U.Memory({initial:G/65536,maximum:G/65536}))&&(p=h.buffer),G=p.byteLength,p=i=p,y.HEAP8=new Int8Array(i),y.HEAP16=new Int16Array(i),y.HEAP32=v=new Int32Array(i),y.HEAPU8=_=new Uint8Array(i),y.HEAPU16=new Uint16Array(i),y.HEAPU32=new Uint32Array(i),y.HEAPF32=new Float32Array(i),y.HEAPF64=new Float64Array(i);var W=[],H=[],Y=[],K=[];H.push({func:function(){es()}});var Q=0,z=null,X=null;function J(e){throw y.onAbort&&y.onAbort(e),M(e+=""),B=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new U.RuntimeError(e)}y.preloadedImages={},y.preloadedAudios={};var q="data:application/octet-stream;base64,";function Z(e){var t,r;return t=e,r=q,String.prototype.startsWith?t.startsWith(r):0===t.indexOf(r)}var $="<<< WASM_BINARY_FILE >>>";if(!Z($)){;n=$,$=y.locateFile?y.locateFile(n,D):D+n}function ee(e){for(;e.length>0;){var t=e.shift();if("function"==typeof t){t(y);continue}var r=t.func;"number"==typeof r?void 0===t.arg?b.get(r)():b.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}}var et={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=et.buffers[e];0===t||10===t?((1===e?L:M)(j(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return et.varargs+=4,v[et.varargs-4>>2]},getStr:function(e){var t,r;return(t=e)?j(_,t,void 0):""},get64:function(e,t){return e}};function er(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];i>255&&(i&=255),t.push(String.fromCharCode(i))}return t.join("")}var ei="function"==typeof atob?atob:function(e){var t,r,i,n,o,a,s,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=c.indexOf(e.charAt(u++)),o=c.indexOf(e.charAt(u++)),a=c.indexOf(e.charAt(u++)),s=c.indexOf(e.charAt(u++)),t=n<<2|o>>4,r=(15&o)<<4|a>>2,i=(3&a)<<6|s,d+=String.fromCharCode(t),64!==a&&(d+=String.fromCharCode(r)),64!==s&&(d+=String.fromCharCode(i));while(u<e.length);return d};function en(e){if(!!Z(e))return function(e){if("boolean"==typeof N&&N){var t;try{t=a.from(e,"base64")}catch(r){t=new a(e,"base64")}return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}try{for(var r=ei(e),i=new Uint8Array(r.length),n=0;n<r.length;++n)i[n]=r.charCodeAt(n);return i}catch(e){throw Error("Converting base64 string to bytes failed.")}}(e.slice(q.length))}var eo={abort:function(){J()},emscripten_memcpy_big:function(e,t,r){_.copyWithin(e,t,t+r)},emscripten_resize_heap:function(e){var t;t=0,J("OOM")},fd_close:function(e){return 0},fd_seek:function(e,t,r,i,n){},fd_write:function(e,t,r,i){for(var n=0,o=0;o<r;o++){for(var a=v[t+8*o>>2],s=v[t+(8*o+4)>>2],c=0;c<s;c++)et.printChar(e,_[a+c]);n+=s}return v[i>>2]=n,0},getTempRet0:function(){return x},memory:h,setTempRet0:function(e){x=e}},ea=function(){var e,t={env:eo,wasi_snapshot_preview1:eo};function r(e,t){var r=e.exports;y.asm=r,b=y.asm.__indirect_function_table,!function(e){if(Q--,y.monitorRunDependencies&&y.monitorRunDependencies(Q),0==Q&&(null!==z&&(clearInterval(z),z=null),X)){var t=X;X=null,t()}}(0)}if(e=0,Q++,y.monitorRunDependencies&&y.monitorRunDependencies(Q),y.instantiateWasm)try{return y.instantiateWasm(t,r)}catch(e){return M("Module.instantiateWasm callback failed with error: "+e),!1}var i=function(e,t){try{n=function(e){try{if(e==$&&l)return new Uint8Array(l);var t=en(e);if(t)return t;if(c)return c(e);throw"sync fetching of the wasm failed: you can preload it to Module['wasmBinary'] manually, or emcc.py will do that for you when generating HTML (but not JS)"}catch(e){J(e)}}(e),i=new U.Module(n),r=new U.Instance(i,t)}catch(e){var r,i,n,o=e.toString();throw M("failed to compile wasm module: "+o),(o.indexOf("imported Memory")>=0||o.indexOf("memory import")>=0)&&M("Memory size incompatibility issues may be due to changing INITIAL_MEMORY at runtime to something too large. Use ALLOW_MEMORY_GROWTH to allow any size memory (and also make sure not to set INITIAL_MEMORY at runtime to something smaller than it was at compile time)."),e}return[r,i]}($,t);return r(i[0],i[1]),y.asm}(),es=y.___wasm_call_ctors=ea.__wasm_call_ctors;function ec(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function ed(e){if(e=e||I,Q>0)return;if(!function(){if(y.preRun)for("function"==typeof y.preRun&&(y.preRun=[y.preRun]);y.preRun.length;)(function(e){W.unshift(e)})(y.preRun.shift());ee(W)}(),!(Q>0))y.setStatus?(y.setStatus("Running..."),setTimeout(function(){setTimeout(function(){y.setStatus("")},1),t()},1)):t();function t(){if(!T)T=!0,y.calledRun=!0,!B&&(ee(H),ee(Y),y.onRuntimeInitialized&&y.onRuntimeInitialized(),!function(){if(y.postRun)for("function"==typeof y.postRun&&(y.postRun=[y.postRun]);y.postRun.length;)(function(e){K.unshift(e)})(y.postRun.shift());ee(K)}())}}if(y._opus_encoder_create=ea.opus_encoder_create,y._opus_encode_float=ea.opus_encode_float,y._opus_encoder_ctl=ea.opus_encoder_ctl,y._opus_encoder_destroy=ea.opus_encoder_destroy,y._speex_resampler_init=ea.speex_resampler_init,y._speex_resampler_destroy=ea.speex_resampler_destroy,y._speex_resampler_process_interleaved_float=ea.speex_resampler_process_interleaved_float,y.___errno_location=ea.__errno_location,y.stackSave=ea.stackSave,y.stackRestore=ea.stackRestore,y.stackAlloc=ea.stackAlloc,y._malloc=ea.malloc,y._free=ea.free,y.dynCall_jiji=ea.dynCall_jiji,X=function e(){!T&&ed(),!T&&(X=e)},y.run=ed,y.preInit)for("function"==typeof y.preInit&&(y.preInit=[y.preInit]);y.preInit.length>0;)y.preInit.pop()();return ed(),y},"function"==typeof define&&define.amd?define(["require"],function(e){return o=n(i,e)}):e.exports?(o=n("undefined"!=typeof process&&process&&process.env?process.env:i,e.require),e.exports=o):(o=n(i),i.OpusEncoderLib=o)},760781:function(e,t){var r=function(e,t){if(!t)throw Error("Module with exports required to initialize a decoder instance");this.isReady=t.isReady,!this.isReady&&(t.onready=function(){this.isReady=!0,this.onready&&this.onready()}),this.config=Object.assign({decoderSampleRate:48e3,outputBufferSampleRate:48e3,resampleQuality:3},e),this.rawOpus="boolean"==typeof this.config.rawOpus?this.config.rawOpus:/^audio\/opus\b/i.test(this.config.mimeType),this._opus_decoder_create=t._opus_decoder_create,this._opus_decoder_destroy=t._opus_decoder_destroy,this._opus_decoder_ctl=t._opus_decoder_ctl,this._speex_resampler_process_interleaved_float=t._speex_resampler_process_interleaved_float,this._speex_resampler_init=t._speex_resampler_init,this._speex_resampler_destroy=t._speex_resampler_destroy,this._opus_decode_float=t._opus_decode_float,this._free=t._free,this._malloc=t._malloc,this.HEAPU8=t.HEAPU8,this.HEAP32=t.HEAP32,this.HEAPF32=t.HEAPF32,this.decodedBuffers=[],this.completed=!1,this.config.onInit&&(this.oninit=this.config.onInit),this.config.onComplete&&(this.oncomplete=this.config.onComplete),this.config.numberOfChannels>0&&(this.numberOfChannels=this.config.numberOfChannels,this.init())};r.prototype.decode=function(e,t,r){t=t||this.handleDecoded;var i=new DataView(e.buffer);this.getPageBoundaries(i).map(function(n){var o=i.getUint8(n+5,!0),a=i.getUint32(n+18,!0);if(2&o&&(this.numberOfChannels=i.getUint8(n+37,!0),this.init()),a>1){for(var s=i.getUint8(n+26,!0),c=n+27+s,d=0;d<s;d++){var u=i.getUint8(n+27+d,!0);if(this.decoderBuffer.set(e.subarray(c,c+=u),this.decoderBufferIndex),this.decoderBufferIndex+=u,u<255){var l=this._opus_decode_float(this.decoder,this.decoderBufferPointer,this.decoderBufferIndex,this.decoderOutputPointer,this.decoderOutputMaxLength,0),h=Math.ceil(l*this.config.outputBufferSampleRate/this.config.decoderSampleRate);this.HEAP32[this.decoderOutputLengthPointer>>2]=l,this.HEAP32[this.resampleOutputLengthPointer>>2]=h,this._speex_resampler_process_interleaved_float(this.resampler,this.decoderOutputPointer,this.decoderOutputLengthPointer,this.resampleOutputBufferPointer,this.resampleOutputLengthPointer),t.call(this,this.HEAPF32.subarray(this.resampleOutputBufferPointer>>2,(this.resampleOutputBufferPointer>>2)+h*this.numberOfChannels),r),this.decoderBufferIndex=0}}4&o&&(this.completed=!0,this.oncomplete&&this.oncomplete(r))}},this)},r.prototype.decodeRaw=function(e,t,r){t=t||this.handleDecoded;var i=e.length*e.BYTES_PER_ELEMENT;if(0!==i){var n=0;if(void 0===this.numberOfChannels){var o=this.decodeHeader(e,this.config.readTags);if(this.init(),o>0){if(o>=i)return;n+=o}}for(;n<i;){var a,s=Math.min(i-n,this.decoderBufferMaxLength);this.decoderBuffer.set(e.subarray(n,n+=s),this.decoderBufferIndex),this.decoderBufferIndex+=s;var c=this._opus_decode_float(this.decoder,this.decoderBufferPointer,e.length,this.decoderOutputPointer,this.decoderOutputMaxLength,0);if(this.resampler){var d=Math.ceil(c*this.config.outputBufferSampleRate/this.config.decoderSampleRate);this.HEAP32[this.decoderOutputLengthPointer>>2]=c,this.HEAP32[this.resampleOutputLengthPointer>>2]=d,this._speex_resampler_process_interleaved_float(this.resampler,this.decoderOutputPointer,this.decoderOutputLengthPointer,this.resampleOutputBufferPointer,this.resampleOutputLengthPointer),a=this.HEAPF32.subarray(this.resampleOutputBufferPointer>>2,(this.resampleOutputBufferPointer>>2)+d*this.numberOfChannels)}else a=this.HEAPF32.subarray(this.decoderOutputPointer>>2,(this.decoderOutputPointer>>2)+c*this.numberOfChannels);t.call(this,a,r),this.decoderBufferIndex=0}this.oncomplete&&this.oncomplete(r)}},r.prototype.handleDecoded=function(e){this.decodedBuffers.push(e)},r.prototype.decodeHeader=function(e,t){var r,i=!1,n=new DataView(e.buffer);if(i=(i=(i=i||0x7375704f!==n.getUint32(0,!0))||0x64616548!==n.getUint32(4,!0))||1!==n.getUint8(8))return!1;if(this.numberOfChannels=n.getUint8(9),i=i||!isFinite(this.numberOfChannels)||this.numberOfChannels<0||this.numberOfChannels>2)return this.numberOfChannels=void 0,!1;var o=n.getUint32(12,!0);if(i=i||!isFinite(o)||o<0||!this.config)return!1;this.config.decoderSampleRate=o;var a=19;n.getUint8(18)>0&&(a+=2+8*n.getUint8(19));var s=e.length*e.BYTES_PER_ELEMENT;if(s>a)for(;(r=this.decodeTags(e,a,t))&&!((a+=r)>=s););return a},r.prototype.decodeTags=function(e,t,r){t=t||0;var i,n=!1,o=r?{vendor:null,userComments:[]}:null,a=new DataView(e.buffer,t);if(n=(n=n||0x7375704f!==a.getUint32(0,!0))||0x73676154!==a.getUint32(4,!0))return!1;var s=a.getUint32(8,!0);o&&(o.vendor=new Uint8Array(a,12,s));var c=a.getUint32(12+s,!0),d=16+s;if(c>0)for(var u=0;u<c;++u)i=a.getUint32(d,!0),o&&o.userComments.push(new Uint8Array(a,d+4,i)),d+=4+i;return o&&(this.tags?this.tags.push(o):this.tags=[o]),d},r.prototype.getPageBoundaries=function(e){for(var t=[],r=0;r<e.byteLength-32;r++)0x5367674f==e.getUint32(r,!0)&&t.push(r);return t},r.prototype.getPitch=function(){return this.getOpusControl(4033)},r.prototype.getOpusControl=function(e){var t=this._malloc(4);this._opus_decoder_ctl(this.decoder,e,t);var r=this.HEAP32[t>>2];return this._free(t),r},r.prototype.init=function(){this.initCodec(),this.initResampler(),this.oninit&&this.oninit()},r.prototype.initCodec=function(){this.destroyDecoder();var e=this._malloc(4);this.decoder=this._opus_decoder_create(this.config.decoderSampleRate,this.numberOfChannels,e),this._free(e),this.decoderBufferMaxLength=4e3,this.decoderBufferPointer=this._malloc(this.decoderBufferMaxLength),this.decoderBuffer=this.HEAPU8.subarray(this.decoderBufferPointer,this.decoderBufferPointer+this.decoderBufferMaxLength),this.decoderBufferIndex=0,this.decoderOutputLengthPointer=this._malloc(4),this.decoderOutputMaxLength=this.config.decoderSampleRate*this.numberOfChannels*120/1e3,this.decoderOutputPointer=this._malloc(4*this.decoderOutputMaxLength)},r.prototype.initResampler=function(){if(this.destroyResampler(),this.config.decoderSampleRate===this.config.outputBufferSampleRate){this.resampler=null;return}var e=this._malloc(4);this.resampler=this._speex_resampler_init(this.numberOfChannels,this.config.decoderSampleRate,this.config.outputBufferSampleRate,this.config.resampleQuality,e),this._free(e),this.resampleOutputLengthPointer=this._malloc(4),this.resampleOutputMaxLength=Math.ceil(this.decoderOutputMaxLength*this.config.outputBufferSampleRate/this.config.decoderSampleRate),this.resampleOutputBufferPointer=this._malloc(4*this.resampleOutputMaxLength)},r.prototype.destroyDecoder=function(){this.decoder&&(this._opus_decoder_destroy(this.decoder),this._free(this.decoderBufferPointer),this._free(this.decoderOutputLengthPointer),this._free(this.decoderOutputPointer))},r.prototype.destroyResampler=function(){this.resampler&&(this._speex_resampler_destroy(this.resampler),this._free(this.resampleOutputLengthPointer),this._free(this.resampleOutputBufferPointer))},r.prototype.destroy=function(){this.destroyDecoder(),this.decoderBuffer=null,this.destroyResampler(),this.decodedBuffers=null};t.OggOpusDecoder=r},525825:function(e,t){var r=function(e,t){if(!t)throw Error("Module with exports required to initialize an encoder instance");this.config=Object.assign({encoderApplication:2049,encoderFrameSize:20,encoderSampleRate:48e3,maxFramesPerPage:40,numberOfChannels:1,originalSampleRate:44100,resampleQuality:3,serial:Math.floor(0x100000000*Math.random())},e),this.rawOpus="boolean"==typeof this.config.rawOpus?this.config.rawOpus:/^audio\/opus\b/i.test(this.config.mimeType);var r=!this.rawOpus;this._opus_encoder_create=t._opus_encoder_create,this._opus_encoder_destroy=t._opus_encoder_destroy,this._opus_encoder_ctl=t._opus_encoder_ctl,this._speex_resampler_process_interleaved_float=t._speex_resampler_process_interleaved_float,this._speex_resampler_init=t._speex_resampler_init,this._speex_resampler_destroy=t._speex_resampler_destroy,this._opus_encode_float=t._opus_encode_float,this._free=t._free,this._malloc=t._malloc,this.HEAPU8=t.HEAPU8,this.HEAP32=t.HEAP32,this.HEAPF32=t.HEAPF32,this.pageIndex=0,this.granulePosition=0,this.segmentData=new Uint8Array(r?65025:255),this.segmentDataIndex=0,this.segmentTable=r?new Uint8Array(255):null,this.segmentTableIndex=0,this.framesInPage=0,this.encodedData=r?void 0:[],this.encodedDataLength=0,this.isReady=t.isReady,!this.isReady&&(t.onready=function(){this.isReady=!0,this.onready&&this.onready()}),r&&this.initChecksumTable(),this.initCodec(),this.initResampler(),1===this.config.numberOfChannels&&(this.interleave=function(e){return e[0]})};r.prototype.encode=function(e){!this.bufferLength&&(this.bufferLength=e[0].length,this.interleavedBuffers=new Float32Array(this.bufferLength*this.config.numberOfChannels));for(var t=!this.rawOpus,r=this.interleave(e),i=0,n=t?[]:null,o=this.resampler?this.resampleBufferLength:this.encoderBufferLength,a=this.resampler?this.resampleBuffer:this.encoderBuffer;i<r.length;){var s=Math.min(o-this.sampleBufferIndex,r.length-i);if(a.set(r.subarray(i,i+s),this.sampleBufferIndex),i+=s,this.sampleBufferIndex+=s,this.sampleBufferIndex===o){this.resampler&&this._speex_resampler_process_interleaved_float(this.resampler,this.resampleBufferPointer,this.resampleSamplesPerChannelPointer,this.encoderBufferPointer,this.encoderSamplesPerChannelPointer);var c=this._opus_encode_float(this.encoder,this.encoderBufferPointer,this.encoderSamplesPerChannel,this.encoderOutputPointer,this.encoderOutputMaxLength);t?(n.concat(this.segmentPacket(c)),this.framesInPage++,this.framesInPage>=this.config.maxFramesPerPage&&n.push(this.generatePage())):(this.encodedData.push(new Uint8Array(this.encoderOutputBuffer.subarray(0,c))),this.encodedDataLength+=c),this.sampleBufferIndex=0}}return n},r.prototype.destroy=function(){this.encoder&&(this._free(this.encoderSamplesPerChannelPointer),delete this.encoderSamplesPerChannelPointer,this._free(this.encoderBufferPointer),delete this.encoderBufferPointer,this._free(this.encoderOutputPointer),delete this.encoderOutputPointer,this._opus_encoder_destroy(this.encoder),delete this.encoder,this.resampler&&(this._free(this.resampleSamplesPerChannelPointer),delete this.resampleSamplesPerChannelPointer,this._free(this.resampleBufferPointer),delete this.resampleBufferPointer,this._speex_resampler_destroy(this.resampler),delete this.resampler),this.encodedData&&(this.encodedData=null))},r.prototype.flush=function(){var e;return this.framesInPage&&(e=this.generatePage()),this.sampleBufferIndex=0,e},r.prototype.encodeFinalFrame=function(){var e=!this.rawOpus,t=e?[]:null;if(this.sampleBufferIndex>0){for(var r=Math.ceil((this.resampleBufferLength-this.sampleBufferIndex)/this.config.numberOfChannels/this.bufferLength),i=0;i<r;i++){for(var n=[],o=0;o<this.config.numberOfChannels;o++)n.push(new Float32Array(this.bufferLength));e?t.concat(this.encode(n)):this.encode(n)}}if(e)return this.headerType+=4,t.push(this.generatePage()),t},r.prototype.getChecksum=function(e){for(var t=0,r=0;r<e.length;r++)t=t<<8^this.checksumTable[t>>>24&255^e[r]];return t>>>0},r.prototype.generateCommentPage=function(){var e=new DataView(this.segmentData.buffer);if(e.setUint32(0,0x7375704f,!0),e.setUint32(4,0x73676154,!0),e.setUint32(8,10,!0),e.setUint32(12,0x6f636552,!0),e.setUint32(16,0x72656472,!0),e.setUint16(20,21322,!0),e.setUint32(22,0,!0),!this.rawOpus)return this.segmentTableIndex=1,this.segmentDataIndex=this.segmentTable[0]=26,this.headerType=0,this.generatePage();this.encodedData.push(new Uint8Array(this.segmentData.subarray(0,26))),this.encodedDataLength+=26},r.prototype.generateIdPage=function(){var e=new DataView(this.segmentData.buffer);if(e.setUint32(0,0x7375704f,!0),e.setUint32(4,0x64616548,!0),e.setUint8(8,1,!0),e.setUint8(9,this.config.numberOfChannels,!0),e.setUint16(10,3840,!0),e.setUint32(12,this.config.originalSampleRateOverride||this.config.originalSampleRate,!0),e.setUint16(16,0,!0),e.setUint8(18,0,!0),!this.rawOpus)return this.segmentTableIndex=1,this.segmentDataIndex=this.segmentTable[0]=19,this.headerType=2,this.generatePage();this.encodedData.push(new Uint8Array(this.segmentData.subarray(0,19))),this.encodedDataLength+=19},r.prototype.generatePage=function(){var e=this.lastPositiveGranulePosition===this.granulePosition?-1:this.granulePosition,t=new ArrayBuffer(27+this.segmentTableIndex+this.segmentDataIndex),r=new DataView(t),i=new Uint8Array(t);r.setUint32(0,0x5367674f,!0),r.setUint8(4,0,!0),r.setUint8(5,this.headerType,!0),r.setUint32(6,e,!0),e<0?r.setInt32(10,Math.ceil(e/0x100000001)-1,!0):r.setInt32(10,Math.floor(e/0x100000000),!0),r.setUint32(14,this.config.serial,!0),r.setUint32(18,this.pageIndex++,!0),r.setUint8(26,this.segmentTableIndex,!0),i.set(this.segmentTable.subarray(0,this.segmentTableIndex),27),i.set(this.segmentData.subarray(0,this.segmentDataIndex),27+this.segmentTableIndex),r.setUint32(22,this.getChecksum(i),!0);var n={message:"page",page:i,samplePosition:this.granulePosition};return this.segmentTableIndex=0,this.segmentDataIndex=0,this.framesInPage=0,e>0&&(this.lastPositiveGranulePosition=e),n},r.prototype.initChecksumTable=function(){this.checksumTable=[];for(var e=0;e<256;e++){for(var t=e<<24,r=0;r<8;r++)t=(0x80000000&t)!=0?t<<1^0x4c11db7:t<<1;this.checksumTable[e]=0xffffffff&t}},r.prototype.setOpusControl=function(e,t){var r=this._malloc(4);this.HEAP32[r>>2]=t,this._opus_encoder_ctl(this.encoder,e,r),this._free(r)},r.prototype.initCodec=function(){var e=this._malloc(4);this.encoder=this._opus_encoder_create(this.config.encoderSampleRate,this.config.numberOfChannels,this.config.encoderApplication,e),this._free(e),this.config.encoderBitRate&&this.setOpusControl(4002,this.config.encoderBitRate),this.config.encoderComplexity&&this.setOpusControl(4010,this.config.encoderComplexity),this.encoderSamplesPerChannel=this.config.encoderSampleRate*this.config.encoderFrameSize/1e3,this.encoderSamplesPerChannelPointer=this._malloc(4),this.HEAP32[this.encoderSamplesPerChannelPointer>>2]=this.encoderSamplesPerChannel,this.sampleBufferIndex=0,this.encoderBufferLength=this.encoderSamplesPerChannel*this.config.numberOfChannels,this.encoderBufferPointer=this._malloc(4*this.encoderBufferLength),this.encoderBuffer=this.HEAPF32.subarray(this.encoderBufferPointer>>2,(this.encoderBufferPointer>>2)+this.encoderBufferLength),this.encoderOutputMaxLength=4e3,this.encoderOutputPointer=this._malloc(this.encoderOutputMaxLength),this.encoderOutputBuffer=this.HEAPU8.subarray(this.encoderOutputPointer,this.encoderOutputPointer+this.encoderOutputMaxLength)},r.prototype.initResampler=function(){if(this.config.originalSampleRate===this.config.encoderSampleRate){this.resampler=null;return}var e=this._malloc(4);this.resampler=this._speex_resampler_init(this.config.numberOfChannels,this.config.originalSampleRate,this.config.encoderSampleRate,this.config.resampleQuality,e),this._free(e),this.resampleSamplesPerChannel=this.config.originalSampleRate*this.config.encoderFrameSize/1e3,this.resampleSamplesPerChannelPointer=this._malloc(4),this.HEAP32[this.resampleSamplesPerChannelPointer>>2]=this.resampleSamplesPerChannel,this.resampleBufferLength=this.resampleSamplesPerChannel*this.config.numberOfChannels,this.resampleBufferPointer=this._malloc(4*this.resampleBufferLength),this.resampleBuffer=this.HEAPF32.subarray(this.resampleBufferPointer>>2,(this.resampleBufferPointer>>2)+this.resampleBufferLength)},r.prototype.interleave=function(e){for(var t=0;t<this.bufferLength;t++)for(var r=0;r<this.config.numberOfChannels;r++)this.interleavedBuffers[t*this.config.numberOfChannels+r]=e[r][t];return this.interleavedBuffers},r.prototype.segmentPacket=function(e){for(var t=0,r=[];e>=0;){255===this.segmentTableIndex&&(r.push(this.generatePage()),this.headerType=1);var i=Math.min(e,255);this.segmentTable[this.segmentTableIndex++]=i,this.segmentData.set(this.encoderOutputBuffer.subarray(t,t+i),this.segmentDataIndex),this.segmentDataIndex+=i,t+=i,e-=255}return this.granulePosition+=48*this.config.encoderFrameSize,255===this.segmentTableIndex&&(r.push(this.generatePage()),this.headerType=0),r};t.OggOpusEncoder=r},133780:function(e){"use strict";let t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){let r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){let r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter(e=>0===e.indexOf(r))},t.parseCandidate=function(e){let t;let r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1],10);break;case"tcptype":r.tcpType=t[e+1];break;case"ufrag":r.ufrag=t[e+1],r.usernameFragment=t[e+1];break;default:void 0===r[t[e]]&&(r[t[e]]=t[e+1])}return r},t.writeCandidate=function(e){let t=[];t.push(e.foundation);let r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){let t;let r={},i=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)r[(t=i[e].trim().split("="))[0].trim()]=t[1];return r},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){let t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substring(t+1,i),r.value=e.substring(i+1)):r.attribute=e.substring(t+1),r},t.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){let r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},t.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){let i=t.matchPrefix(e+r,"a=ice-ufrag:")[0],n=t.matchPrefix(e+r,"a=ice-pwd:")[0];return i&&n?{usernameFragment:i.substring(12),password:n.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){let r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");r.profile=i[2];for(let n=3;n<i.length;n++){let o=i[n],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){let i=t.parseRtpMap(a),n=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(i.parameters=n.length?t.parseFmtp(n[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),r.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{r.headerExtensions.push(t.parseExtmap(e))});let n=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(e=>{n.forEach(t=>{!e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)&&e.rtcpFeedback.push(t)})}),r},t.writeRtpDescription=function(e,r){let i="";i+="m="+e+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let n=0;return r.codecs.forEach(e=>{e.maxptime>n&&(n=e.maxptime)}),n>0&&(i+="a=maxptime:"+n+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){let r;let i=[],n=t.parseRtpParameters(e),o=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),c=s.length>0&&s[0].ssrc,d=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(r=d[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&r&&(t.rtx={ssrc:r}),i.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},i.push(t))}}),0===i.length&&c&&i.push({ssrc:c});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?950*parseInt(u[0].substring(5),10)-16e3:void 0,i.forEach(e=>{e.maxBitrate=u})),i},t.parseRtcpParameters=function(e){let r={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);let n=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=n.length>0,r.compound=0===n.length;let o=t.matchPrefix(e,"a=rtcp-mux");return r.mux=o.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;let i=t.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(r=i[0].substring(7).split(" "))[0],track:r[1]};let n=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);if(n.length>0)return{stream:(r=n[0].value.split(" "))[0],track:r[1]}},t.parseSctpDescription=function(e){let r;let i=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");n.length>0&&(r=parseInt(n[0].substring(19),10)),isNaN(r)&&(r=65536);let o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};let a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){let e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,r,i){let n;return n=e?e:t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+n+" "+(void 0!==r?r:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){let i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){let r=t.splitLines(e)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){let r=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let r=t.splitLines(e);for(let e=0;e<r.length;e++)if(r[e].length<2||"="!==r[e].charAt(1))return!1;return!0};e.exports=t},205929:function(e,t){!function(r,i){"use strict";var n="function",o="undefined",a="object",s="string",c="major",d="model",u="name",l="type",h="vendor",p="version",f="architecture",_="console",A="mobile",m="tablet",v="smarttv",E="wearable",g="embedded",S="Amazon",b="Apple",T="ASUS",y="BlackBerry",R="Browser",I="Chrome",C="Firefox",k="Google",w="Huawei",O="Microsoft",N="Motorola",P="Opera",D="Samsung",L="Sharp",M="Sony",x="Xiaomi",U="Zebra",B="Facebook",V="Chromium OS",F="Mac OS",j=" Browser",G=function(e,t){var r={};for(var i in e)t[i]&&t[i].length%2==0?r[i]=t[i].concat(e[i]):r[i]=e[i];return r},W=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},H=function(e,t){return typeof e===s&&-1!==Y(t).indexOf(Y(e))},Y=function(e){return e.toLowerCase()},K=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},Q=function(e,t){for(var r,o,s,c,d,u,l=0;l<t.length&&!d;){var h=t[l],p=t[l+1];for(r=o=0;r<h.length&&!d&&h[r];){;if(d=h[r++].exec(e))for(s=0;s<p.length;s++)u=d[++o],typeof(c=p[s])===a&&c.length>0?2===c.length?typeof c[1]==n?this[c[0]]=c[1].call(this,u):this[c[0]]=c[1]:3===c.length?typeof c[1]!==n||c[1].exec&&c[1].test?this[c[0]]=u?u.replace(c[1],c[2]):void 0:this[c[0]]=u?c[1].call(this,u,c[2]):i:4===c.length&&(this[c[0]]=u?c[3].call(this,u.replace(c[1],c[2])):i):this[c]=u||i}l+=2}},z=function(e,t){for(var r in t)if(typeof t[r]===a&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(H(t[r][n],e))return"?"===r?i:r}else if(H(t[r],e))return"?"===r?i:r;return t.hasOwnProperty("*")?t["*"]:e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,p],[/opios[\/ ]+([\w\.]+)/i],[p,[u,P+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[p,[u,P+" GX"]],[/\bopr\/([\w\.]+)/i],[p,[u,P]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[u,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[p,[u,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,p],[/quark(?:pc)?\/([-\w\.]+)/i],[p,[u,"Quark"]],[/\bddg\/([\w\.]+)/i],[p,[u,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[u,"UC"+R]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[u,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[u,"Smart Lenovo "+R]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+R],p],[/\bfocus\/([\w\.]+)/i],[p,[u,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[u,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[u,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[u,"MIUI"+j]],[/fxios\/([\w\.-]+)/i],[p,[u,C]],[/\bqihoobrowser\/?([\w\.]*)/i],[p,[u,"360"]],[/\b(qq)\/([\w\.]+)/i],[[u,/(.+)/,"$1Browser"],p],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1"+j],p],[/samsungbrowser\/([\w\.]+)/i],[p,[u,D+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[p,[u,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[u,"Sogou Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[u,p],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[u],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[p,u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,B],p],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[u,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[u,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,I+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[u,"Android "+R]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[p,z,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],p],[/(wolvic|librewolf)\/([\w\.]+)/i],[u,p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[u,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[u,[p,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[u,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,Y]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",Y]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,Y]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[h,D],[l,m]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[d,[h,D],[l,A]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[h,b],[l,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[h,b],[l,m]],[/(macintosh);/i],[d,[h,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[h,L],[l,A]],[/(?:honor)([-\w ]+)[;\)]/i],[d,[h,"Honor"],[l,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[h,w],[l,m]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[h,w],[l,A]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[d,/_/g," "],[h,x],[l,A]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[h,x],[l,m]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[h,"OPPO"],[l,A]],[/\b(opd2\d{3}a?) bui/i],[d,[h,"OPPO"],[l,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[h,"Vivo"],[l,A]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[h,"Realme"],[l,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[h,N],[l,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[h,N],[l,m]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[h,"LG"],[l,m]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[h,"LG"],[l,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[h,"Lenovo"],[l,m]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[h,"Nokia"],[l,A]],[/(pixel c)\b/i],[d,[h,k],[l,m]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[h,k],[l,A]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[h,M],[l,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[h,M],[l,m]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[h,"OnePlus"],[l,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[h,S],[l,m]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[h,S],[l,A]],[/(playbook);[-\w\),; ]+(rim)/i],[d,h,[l,m]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[h,y],[l,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[h,T],[l,m]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[h,T],[l,A]],[/(nexus 9)/i],[d,[h,"HTC"],[l,m]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[d,/_/g," "],[l,A]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[d,[h,"TCL"],[l,m]],[/(itel) ((\w+))/i],[[h,Y],d,[l,z,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[h,"Acer"],[l,m]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[h,"Meizu"],[l,A]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[h,"Ulefone"],[l,A]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[d,[h,"Energizer"],[l,A]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[d,[h,"Cat"],[l,A]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[d,[h,"Smartfren"],[l,A]],[/droid.+; (a(?:015|06[35]|142p?))/i],[d,[h,"Nothing"],[l,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,d,[l,A]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,d,[l,m]],[/(surface duo)/i],[d,[h,O],[l,m]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[h,"Fairphone"],[l,A]],[/(u304aa)/i],[d,[h,"AT&T"],[l,A]],[/\bsie-(\w*)/i],[d,[h,"Siemens"],[l,A]],[/\b(rct\w+) b/i],[d,[h,"RCA"],[l,m]],[/\b(venue[\d ]{2,7}) b/i],[d,[h,"Dell"],[l,m]],[/\b(q(?:mv|ta)\w+) b/i],[d,[h,"Verizon"],[l,m]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[h,"Barnes & Noble"],[l,m]],[/\b(tm\d{3}\w+) b/i],[d,[h,"NuVision"],[l,m]],[/\b(k88) b/i],[d,[h,"ZTE"],[l,m]],[/\b(nx\d{3}j) b/i],[d,[h,"ZTE"],[l,A]],[/\b(gen\d{3}) b.+49h/i],[d,[h,"Swiss"],[l,A]],[/\b(zur\d{3}) b/i],[d,[h,"Swiss"],[l,m]],[/\b((zeki)?tb.*\b) b/i],[d,[h,"Zeki"],[l,m]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],d,[l,m]],[/\b(ns-?\w{0,9}) b/i],[d,[h,"Insignia"],[l,m]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[h,"NextBook"],[l,m]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],d,[l,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],d,[l,A]],[/\b(ph-1) /i],[d,[h,"Essential"],[l,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[h,"Envizen"],[l,m]],[/\b(trio[-\w\. ]+) b/i],[d,[h,"MachSpeed"],[l,m]],[/\btu_(1491) b/i],[d,[h,"Rotor"],[l,m]],[/(shield[\w ]+) b/i],[d,[h,"Nvidia"],[l,m]],[/(sprint) (\w+)/i],[h,d,[l,A]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[h,O],[l,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[h,U],[l,m]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[h,U],[l,A]],[/smart-tv.+(samsung)/i],[h,[l,v]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[h,D],[l,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,"LG"],[l,v]],[/(apple) ?tv/i],[h,[d,b+" TV"],[l,v]],[/crkey/i],[[d,I+"cast"],[h,k],[l,v]],[/droid.+aft(\w+)( bui|\))/i],[d,[h,S],[l,v]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[h,L],[l,v]],[/(bravia[\w ]+)( bui|\))/i],[d,[h,M],[l,v]],[/(mitv-\w{5}) bui/i],[d,[h,x],[l,v]],[/Hbbtv.*(technisat) (.*);/i],[h,d,[l,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,K],[d,K],[l,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,d,[l,_]],[/droid.+; (shield) bui/i],[d,[h,"Nvidia"],[l,_]],[/(playstation [345portablevi]+)/i],[d,[h,M],[l,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[h,O],[l,_]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[d,[h,D],[l,E]],[/((pebble))app/i],[h,d,[l,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[h,b],[l,E]],[/droid.+; (glass) \d/i],[d,[h,k],[l,E]],[/droid.+; (wt63?0{2,3})\)/i],[d,[h,U],[l,E]],[/droid.+; (glass) \d/i],[d,[h,k],[l,E]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,d,[l,E]],[/; (quest( \d| pro)?)/i],[d,[h,B],[l,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[l,g]],[/(aeobc)\b/i],[d,[h,S],[l,g]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[l,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[l,m]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,m]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,A]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[u,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[u,p],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,p],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[u,[p,z,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,z,X],[u,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,F],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,p],[/\(bb(10);/i],[p,[u,y]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[u,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[u,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,V],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,p],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,p]]},q=function(e,t){if(typeof e===a&&(t=e,e=i),!(this instanceof q))return new q(e,t).getResult();var _=typeof r!==o&&r.navigator?r.navigator:i,v=e||(_&&_.userAgent?_.userAgent:""),E=_&&_.userAgentData?_.userAgentData:i,g=t?G(J,t):J,S=_&&_.userAgent==v;return this.getBrowser=function(){var e,t={};return t[u]=i,t[p]=i,Q.call(t,v,g.browser),t[c]=typeof(e=t[p])===s?e.replace(/[^\d\.]/g,"").split(".")[0]:i,S&&_&&_.brave&&typeof _.brave.isBrave==n&&(t[u]="Brave"),t},this.getCPU=function(){var e={};return e[f]=i,Q.call(e,v,g.cpu),e},this.getDevice=function(){var e={};return e[h]=i,e[d]=i,e[l]=i,Q.call(e,v,g.device),S&&!e[l]&&E&&E.mobile&&(e[l]=A),S&&"Macintosh"==e[d]&&_&&typeof _.standalone!==o&&_.maxTouchPoints&&_.maxTouchPoints>2&&(e[d]="iPad",e[l]=m),e},this.getEngine=function(){var e={};return e[u]=i,e[p]=i,Q.call(e,v,g.engine),e},this.getOS=function(){var e={};return e[u]=i,e[p]=i,Q.call(e,v,g.os),S&&!e[u]&&E&&E.platform&&"Unknown"!=E.platform&&(e[u]=E.platform.replace(/chrome os/i,V).replace(/macos/i,F)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(e){return v=typeof e===s&&e.length>500?K(e,500):e,this},this.setUA(v),this};q.VERSION="0.7.40",q.BROWSER=W([u,p,c]),q.CPU=W([f]),q.DEVICE=W([d,h,l,_,A,v,m,E,g]),q.ENGINE=q.OS=W([u,p]),typeof t!==o?(e.exports&&(t=e.exports=q),t.UAParser=q):typeof define===n&&define.amd?define(function(){return q}):typeof r!==o&&(r.UAParser=q);var Z=typeof r!==o&&(r.jQuery||r.Zepto);if(Z&&!Z.ua){var $=new q;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var r in t)Z.ua[r]=t[r]}}}("object"==typeof window?window:this)},799680:function(e,t,r){"use strict";var i=r(723530),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=i.useState,a=i.useEffect,s=i.useLayoutEffect,c=i.useDebugValue;function d(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),i=o({inst:{value:r,getSnapshot:t}}),n=i[0].inst,u=i[1];return s(function(){n.value=r,n.getSnapshot=t,d(n)&&u({inst:n})},[e,r,t]),a(function(){return d(n)&&u({inst:n}),e(function(){d(n)&&u({inst:n})})},[e]),c(r),r};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:u},578993:function(e,t,r){"use strict";var i=r(723530),n=r(96406),o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=n.useSyncExternalStore,s=i.useRef,c=i.useEffect,d=i.useMemo,u=i.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,i,n){var l=s(null);if(null===l.current){var h={hasValue:!1,value:null};l.current=h}else h=l.current;var p=a(e,(l=d(function(){function e(e){if(!c){if(c=!0,a=e,e=i(e),void 0!==n&&h.hasValue){var t=h.value;if(n(t,e))return s=t}return s=e}if(t=s,o(a,e))return t;var r=i(e);return void 0!==n&&n(t,r)?(a=e,t):(a=e,s=r)}var a,s,c=!1,d=void 0===r?null:r;return[function(){return e(t())},null===d?void 0:function(){return e(d())}]},[t,r,i,n]))[0],l[1]);return c(function(){h.hasValue=!0,h.value=p},[p]),u(p),p}},96406:function(e,t,r){"use strict";e.exports=r(799680)},704062:function(e,t,r){"use strict";e.exports=r(578993)},334718:function(e,t,r){"use strict";r.d(t,{Xg:function(){return c},f3:function(){return d},mu:function(){return s},vk:function(){return u}});var i=r(312115),n=r(929188),o=r(319904);function a(e){var t;return(t={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:e}}})[n.L$]=function(){return this},t}function s(e,t,r,i){var o,s=(0,n.j)(e.src),d=null===(o=null==t?void 0:t.options.services)||void 0===o?void 0:o[s.type],u=e.data?(0,n.QX)(e.data,r,i):void 0,l=d?c(d,e.id,u):a(e.id);return l.meta=e,l}function c(e,t,r){var i=a(t);if(i.deferred=!0,(0,n.O4)(e)){var s=i.state=(0,o.J)(void 0,function(){return(r?e.withContext(r):e).initialState});i.getSnapshot=function(){return s}}return i}function d(e){return function(e){try{return"function"==typeof e.send}catch(e){return!1}}(e)&&"id"in e}function u(e){var t;return(0,i.pi)(((t={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}})[n.L$]=function(){return this},t),e)}},684031:function(e,t,r){"use strict";r.d(t,{C:()=>E});var i=r("312115"),n=r("929188"),o=r("342050"),a=r("698307"),s=r("86860"),c=r("662246"),d=r("957246"),u=r("740439"),l=r("106201"),h=r("334718");function p(e){return(0,i.pi)((0,i.pi)({type:s.dw},e),{toJSON:function(){e.onDone,e.onError;var t=(0,i._T)(e,["onDone","onError"]);return(0,i.pi)((0,i.pi)({},t),{type:s.dw,src:function(e){if("string"==typeof e){var t={type:e};return t.toString=function(){return e},t}return e}(e.src)})}})}var f={},_=function(e){return"#"===e[0]},A=function(e,t,r){var i=r.slice(0,-1).some(function(e){return!("cond"in e)&&!("in"in e)&&((0,n.HD)(e.target)||(0,n.O4)(e.target))});(0,n.ZK)(!i,"One or more transitions for ".concat(""===t?"the transient event":"event '".concat(t,"'")," on state '").concat(e.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},m=function(){function e(t,r,o,a){void 0===o&&(o="context"in t?t.context:void 0);var s,h=this;this.config=t,this._context=o,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign({actions:{},guards:{},services:{},activities:{},delays:{}},r),this.parent=null==a?void 0:a.parent,this.key=this.config.key||(null==a?void 0:a.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:u.iS),this.id=this.config.id||(0,i.ev)([this.machine.key],(0,i.CR)(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:null!==(s=this.config.schema)&&void 0!==s?s:{},this.description=this.config.description,!d.M&&(0,n.ZK)(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?(0,n.Q8)(this.config.states,function(t,r){var n,o=new e(t,{},void 0,{parent:h,key:r});return Object.assign(h.idMap,(0,i.pi)(((n={})[o.id]=o,n),o.idMap)),o}):f;var _=0;!function e(t){var r,n;t.order=_++;try{for(var o=(0,i.XA)((0,l.nI)(t)),a=o.next();!a.done;a=o.next()){var s=a.value;e(s)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}}(this),this.history=!0===this.config.history?"shallow":this.config.history||!1,this._transient=!!this.config.always||!!this.config.on&&(Array.isArray(this.config.on)?this.config.on.some(function(e){return""===e.event}):""in this.config.on),this.strict=!!this.config.strict,this.onEntry=(0,n.qo)(this.config.entry||this.config.onEntry).map(function(e){return(0,c.Q8)(e)}),this.onExit=(0,n.qo)(this.config.exit||this.config.onExit).map(function(e){return(0,c.Q8)(e)}),this.meta=this.config.meta,this.doneData="final"===this.type?this.config.data:void 0,this.invoke=(0,n.qo)(this.config.invoke).map(function(e,t){var r,o;if((0,n.O4)(e)){var a=(0,n.bx)(h.id,t);return h.machine.options.services=(0,i.pi)(((r={})[a]=e,r),h.machine.options.services),p({src:a,id:a})}if((0,n.HD)(e.src)){var a=e.id||(0,n.bx)(h.id,t);return p((0,i.pi)((0,i.pi)({},e),{id:a,src:e.src}))}if((0,n.O4)(e.src)||(0,n.mf)(e.src)){var a=e.id||(0,n.bx)(h.id,t);return h.machine.options.services=(0,i.pi)(((o={})[a]=e.src,o),h.machine.options.services),p((0,i.pi)((0,i.pi)({id:a},e),{src:a}))}else{var s=e.src;return p((0,i.pi)((0,i.pi)({id:(0,n.bx)(h.id,t)},e),{src:s}))}}),this.activities=(0,n.qo)(this.config.activities).concat(this.invoke).map(function(e){return(0,c.XA)(e)}),this.transition=this.transition.bind(this),this.tags=(0,n.qo)(this.config.tags)}return e.prototype._init=function(){if(!this.__cache.transitions)(0,l.ac)(this).forEach(function(e){return e.on})},e.prototype.withConfig=function(t,r){var n=this.options,o=n.actions,a=n.activities,s=n.guards,c=n.services,d=n.delays;return new e(this.config,{actions:(0,i.pi)((0,i.pi)({},o),t.actions),activities:(0,i.pi)((0,i.pi)({},a),t.activities),guards:(0,i.pi)((0,i.pi)({},s),t.guards),services:(0,i.pi)((0,i.pi)({},c),t.services),delays:(0,i.pi)((0,i.pi)({},d),t.delays)},null!=r?r:this.context)},e.prototype.withContext=function(t){return new e(this.config,this.options,t)},Object.defineProperty(e.prototype,"context",{get:function(){return(0,n.mf)(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:(0,n.Q8)(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return this.definition},Object.defineProperty(e.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(e,t){return e[t.eventType]=e[t.eventType]||[],e[t.eventType].push(t),e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),e.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var t=""===e,r=this.transitions.filter(function(r){var i=r.eventType===e;return t?i:i||"*"===r.eventType});return this.__cache.candidates[e]=r,r},e.prototype.getDelayedTransitions=function(){var e=this,t=this.config.after;if(!t)return[];var r=function(t,r){var i=(0,n.mf)(t)?"".concat(e.id,":delay[").concat(r,"]"):t,o=(0,c.e4)(i,e.id);return e.onEntry.push((0,c.lW)(o,{delay:t})),e.onExit.push((0,c.al)(o)),o};return((0,n.kJ)(t)?t.map(function(e,t){var n=r(e.delay,t);return(0,i.pi)((0,i.pi)({},e),{event:n})}):(0,n.xH)(Object.keys(t).map(function(e,o){var a=t[e],s=(0,n.HD)(a)?{target:a}:a,c=isNaN(+e)?e:+e,d=r(c,o);return(0,n.qo)(s).map(function(e){return(0,i.pi)((0,i.pi)({},e),{event:d,delay:c})})}))).map(function(t){var r=t.delay;return(0,i.pi)((0,i.pi)({},e.formatTransition(t)),{delay:r})})},e.prototype.getStateNodes=function(e){var t,r=this;if(!e)return[];var o=e instanceof a.ZM?e.value:(0,n.WM)(e,this.delimiter);if((0,n.HD)(o)){var s=this.getStateNode(o).initial;return void 0!==s?this.getStateNodes(((t={})[o]=s,t)):[this,this.states[o]]}var c=Object.keys(o),d=[this];return d.push.apply(d,(0,i.ev)([],(0,i.CR)((0,n.xH)(c.map(function(e){return r.getStateNode(e).getStateNodes(o[e])}))),!1)),d},e.prototype.handles=function(e){var t=(0,n.x6)(e);return this.events.includes(t)},e.prototype.resolveState=function(e){var t=e instanceof a.ZM?e:a.ZM.create(e),r=Array.from((0,l.P_)([],this.getStateNodes(t.value)));return new a.ZM((0,i.pi)((0,i.pi)({},t),{value:this.resolve(t.value),configuration:r,done:(0,l.Ij)(r,this),tags:(0,l.Oe)(r),machine:this.machine}))},e.prototype.transitionLeafNode=function(e,t,r){var i=this.getStateNode(e).next(t,r);return i&&i.transitions.length?i:this.next(t,r)},e.prototype.transitionCompoundNode=function(e,t,r){var i=Object.keys(e),n=this.getStateNode(i[0])._transition(e[i[0]],t,r);return n&&n.transitions.length?n:this.next(t,r)},e.prototype.transitionParallelNode=function(e,t,r){var o,a,s={};try{for(var c=(0,i.XA)(Object.keys(e)),d=c.next();!d.done;d=c.next()){var u=d.value,l=e[u];if(!!l){var h=this.getStateNode(u)._transition(l,t,r);h&&(s[u]=h)}}}catch(e){o={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}var p=Object.keys(s).map(function(e){return s[e]}),f=(0,n.xH)(p.map(function(e){return e.transitions}));if(!p.some(function(e){return e.transitions.length>0}))return this.next(t,r);var _=(0,n.xH)(Object.keys(s).map(function(e){return s[e].configuration}));return{transitions:f,exitSet:(0,n.xH)(p.map(function(e){return e.exitSet})),configuration:_,source:t,actions:(0,n.xH)(Object.keys(s).map(function(e){return s[e].actions}))}},e.prototype._transition=function(e,t,r){return(0,n.HD)(e)?this.transitionLeafNode(e,t,r):1===Object.keys(e).length?this.transitionCompoundNode(e,t,r):this.transitionParallelNode(e,t,r)},e.prototype.getTransitionData=function(e,t){return this._transition(e.value,e,(0,n.g5)(t))},e.prototype.next=function(e,t){var r,o,a,s=this,c=t.name,d=[],u=[];try{for(var l=(0,i.XA)(this.getCandidates(c)),h=l.next();!h.done;h=l.next()){var p=h.value,f=p.cond,A=p.in,m=e.context,v=!A||((0,n.HD)(A)&&_(A)?e.matches((0,n.WM)(this.getStateNodeById(A).path,this.delimiter)):(0,n.W)((0,n.WM)(A,this.delimiter),(0,n.ET)(this.path.slice(0,-2))(e.value))),E=!1;try{E=!f||(0,n.vx)(this.machine,f,m,t,e)}catch(e){throw Error("Unable to evaluate guard '".concat(f.name||f.type,"' in transition for event '").concat(c,"' in state node '").concat(this.id,"':\n").concat(e.message))}if(E&&v){void 0!==p.target&&(u=p.target),d.push.apply(d,(0,i.ev)([],(0,i.CR)(p.actions),!1)),a=p;break}}}catch(e){r={error:e}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}if(!!a){if(!u.length)return{transitions:[a],exitSet:[],configuration:e.value?[this]:[],source:e,actions:d};var g=(0,n.xH)(u.map(function(t){return s.getRelativeStateNodes(t,e.historyValue)})),S=!!a.internal;return{transitions:[a],exitSet:S?[]:(0,n.xH)(u.map(function(e){return s.getPotentiallyReenteringNodes(e)})),configuration:g,source:e,actions:d}}},e.prototype.getPotentiallyReenteringNodes=function(e){if(this.order<e.order)return[this];for(var t=[],r=this;r&&r!==e;)t.push(r),r=r.parent;return r!==e?[]:(t.push(e),t)},e.prototype.getActions=function(e,t,r,a,d,u,h){var p,f,_,A,m=this,v=u?(0,l.P_)([],this.getStateNodes(u.value)):[],E=new Set;try{for(var g=(0,i.XA)(Array.from(e).sort(function(e,t){return e.order-t.order})),S=g.next();!S.done;S=g.next()){var b=S.value;(!(0,l.e$)(v,b)||(0,l.e$)(r.exitSet,b)||b.parent&&E.has(b.parent))&&E.add(b)}}catch(e){p={error:e}}finally{try{S&&!S.done&&(f=g.return)&&f.call(g)}finally{if(p)throw p.error}}try{for(var T=(0,i.XA)(v),y=T.next();!y.done;y=T.next()){var b=y.value;(!(0,l.e$)(e,b)||(0,l.e$)(r.exitSet,b.parent))&&r.exitSet.push(b)}}catch(e){_={error:e}}finally{try{y&&!y.done&&(A=T.return)&&A.call(T)}finally{if(_)throw _.error}}r.exitSet.sort(function(e,t){return t.order-e.order});var R=Array.from(E).sort(function(e,t){return e.order-t.order}),I=new Set(r.exitSet),C=(0,n.xH)(R.map(function(e){var t=[];if("final"!==e.type)return t;var i=e.parent;if(!i.parent)return t;t.push((0,c.aT)(e.id,e.doneData),(0,c.aT)(i.id,e.doneData?(0,n.QX)(e.doneData,a,d):void 0));var o=i.parent;return"parallel"===o.type&&(0,l.G)(o).every(function(e){return(0,l.Ij)(r.configuration,e)})&&t.push((0,c.aT)(o.id)),t})),k=R.map(function(e){var t=e.onEntry,r=e.activities.map(function(e){return(0,c.BL)(e)});return{type:"entry",actions:(0,c.AE)(h?(0,i.ev)((0,i.ev)([],(0,i.CR)(t),!1),(0,i.CR)(r),!1):(0,i.ev)((0,i.ev)([],(0,i.CR)(r),!1),(0,i.CR)(t),!1),m.machine.options.actions)}}).concat({type:"state_done",actions:C.map(c.OU)}),w=Array.from(I).map(function(e){return{type:"exit",actions:(0,c.AE)((0,i.ev)((0,i.ev)([],(0,i.CR)(e.onExit),!1),(0,i.CR)(e.activities.map(function(e){return(0,c.sT)(e)})),!1),m.machine.options.actions)}}).concat({type:"transition",actions:(0,c.AE)(r.actions,this.machine.options.actions)}).concat(k);if(t){var O=(0,c.AE)((0,n.xH)((0,i.ev)([],(0,i.CR)(e),!1).sort(function(e,t){return t.order-e.order}).map(function(e){return e.onExit})),this.machine.options.actions).filter(function(e){return e.type!==s.OU&&(e.type!==s.lW||!!e.to&&e.to!==o.K.Internal)});return w.concat({type:"stop",actions:O})}return w},e.prototype.transition=function(e,t,r,o){void 0===e&&(e=this.initialState);var s,c=(0,n.g5)(t);if(e instanceof a.ZM)s=void 0===r?e:this.resolveState(a.ZM.from(e,r));else{var u=(0,n.HD)(e)?this.resolve((0,n.on)(this.getResolvedPath(e))):this.resolve(e),h=null!=r?r:this.machine.context;s=this.resolveState(a.ZM.from(u,h))}if(!d.M&&"*"===c.name)throw Error("An event cannot have the wildcard type ('".concat("*","')"));if(this.strict&&!this.events.includes(c.name)&&!(0,n.JQ)(c.name))throw Error("Machine '".concat(this.id,"' does not accept event '").concat(c.name,"'"));var p=this._transition(s.value,s,c)||{transitions:[],configuration:[],exitSet:[],source:s,actions:[]},f=(0,l.P_)([],this.getStateNodes(s.value)),_=p.configuration.length?(0,l.P_)(f,p.configuration):f;return p.configuration=(0,i.ev)([],(0,i.CR)(_),!1),this.resolveTransition(p,s,s.context,o,c)},e.prototype.resolveRaisedTransition=function(e,t,r,n){var o,a=e.actions;return(e=this.transition(e,t,void 0,n))._event=r,e.event=r.data,(o=e.actions).unshift.apply(o,(0,i.ev)([],(0,i.CR)(a),!1)),e},e.prototype.resolveTransition=function(e,t,r,d,u){var p,f,_,A,m=this;void 0===u&&(u=c.bf);var v=e.configuration,E=!t||e.transitions.length>0,g=E?e.configuration:t?t.configuration:[],S=(0,l.Ij)(g,this),b=E?(0,l.NA)(this.machine,v):void 0,T=t?t.historyValue?t.historyValue:e.source?this.machine.historyValue(t.value):void 0:void 0,y=this.getActions(new Set(g),S,e,r,u,t,d),R=t?(0,i.pi)({},t.activities):{};try{for(var I=(0,i.XA)(y),C=I.next();!C.done;C=I.next()){var k=C.value;try{for(var w=(_=void 0,(0,i.XA)(k.actions)),O=w.next();!O.done;O=w.next()){var N=O.value;N.type===s.BL?R[N.activity.id||N.activity.type]=N:N.type===s.sT&&(R[N.activity.id||N.activity.type]=!1)}}catch(e){_={error:e}}finally{try{O&&!O.done&&(A=w.return)&&A.call(w)}finally{if(_)throw _.error}}}}catch(e){p={error:e}}finally{try{C&&!C.done&&(f=I.return)&&f.call(I)}finally{if(p)throw p.error}}var P=(0,i.CR)((0,c.yC)(this,t,r,u,y,d,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),D=P[0],L=P[1],M=(0,i.CR)((0,n.uK)(D,function(e){return e.type===s.OU||e.type===s.lW&&e.to===o.K.Internal}),2),x=M[0],U=M[1],B=D.filter(function(e){var t;return e.type===s.BL&&(null===(t=e.activity)||void 0===t?void 0:t.type)===s.dw}).reduce(function(e,t){return e[t.activity.id]=(0,h.mu)(t.activity,m.machine,L,u),e},t?(0,i.pi)({},t.children):{}),V=new a.ZM({value:b||t.value,context:L,_event:u,_sessionid:t?t._sessionid:null,historyValue:b?T?(0,n.yv)(T,b):void 0:t?t.historyValue:void 0,history:!b||e.source?t:void 0,actions:b?U:[],activities:b?R:t?t.activities:{},events:[],configuration:g,transitions:e.transitions,children:B,done:S,tags:(0,l.Oe)(g),machine:this}),F=r!==L;V.changed=u.name===s.Vx||F;var j=V.history;j&&delete j.history;var G=!S&&(this._transient||v.some(function(e){return e._transient}));if(!E&&(!G||""===u.name))return V;var W=V;if(!S)for(G&&(W=this.resolveRaisedTransition(W,{type:s.IA},u,d));x.length;){var H=x.shift();W=this.resolveRaisedTransition(W,H._event,u,d)}var Y=W.changed||(j?!!W.actions.length||F||typeof j.value!=typeof W.value||!(0,a.j_)(W.value,j.value):void 0);return W.changed=Y,W.history=j,W},e.prototype.getStateNode=function(e){if(_(e))return this.machine.getStateNodeById(e);if(!this.states)throw Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var t=this.states[e];if(!t)throw Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return t},e.prototype.getStateNodeById=function(e){var t=_(e)?e.slice(1):e;if(t===this.id)return this;var r=this.machine.idMap[t];if(!r)throw Error("Child state node '#".concat(t,"' does not exist on machine '").concat(this.id,"'"));return r},e.prototype.getStateNodeByPath=function(e){if("string"==typeof e&&_(e))try{return this.getStateNodeById(e.slice(1))}catch(e){}for(var t=(0,n.Q9)(e,this.delimiter).slice(),r=this;t.length;){var i=t.shift();if(!i.length)break;r=r.getStateNode(i)}return r},e.prototype.resolve=function(e){var t,r=this;if(!e)return this.initialStateValue||f;switch(this.type){case"parallel":return(0,n.Q8)(this.initialStateValue,function(t,i){return t?r.getStateNode(i).resolve(e[i]||t):f});case"compound":if((0,n.HD)(e)){var i=this.getStateNode(e);if("parallel"===i.type||"compound"===i.type)return(t={})[e]=i.initialStateValue,t;return e}if(!Object.keys(e).length)return this.initialStateValue||{};return(0,n.Q8)(e,function(e,t){return e?r.getStateNode(t).resolve(e):f});default:return e||f}},e.prototype.getResolvedPath=function(e){if(_(e)){var t=this.machine.idMap[e.slice(1)];if(!t)throw Error("Unable to find state node '".concat(e,"'"));return t.path}return(0,n.Q9)(e,this.delimiter)},Object.defineProperty(e.prototype,"initialStateValue",{get:function(){var e,t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;if("parallel"===this.type)t=(0,n.ib)(this.states,function(e){return e.initialStateValue||f},function(e){return"history"!==e.type});else if(void 0!==this.initial){if(!this.states[this.initial])throw Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));t=(0,l.N9)(this.states[this.initial])?this.initial:((e={})[this.initial]=this.states[this.initial].initialStateValue,e)}else t={};return this.__cache.initialStateValue=t,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),e.prototype.getInitialState=function(e,t){this._init();var r=this.getStateNodes(e);return this.resolveTransition({configuration:r,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,null!=t?t:this.machine.context,void 0)},Object.defineProperty(e.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var e;if("history"===this.type){var t=this.config;e=(0,n.HD)(t.target)?_(t.target)?(0,n.on)(this.machine.getStateNodeById(t.target).path.slice(this.path.length-1)):t.target:t.target}return e},enumerable:!1,configurable:!0}),e.prototype.getRelativeStateNodes=function(e,t,r){return void 0===r&&(r=!0),r?"history"===e.type?e.resolveHistory(t):e.initialStateNodes:[e]},Object.defineProperty(e.prototype,"initialStateNodes",{get:function(){var e=this;if((0,l.N9)(this))return[this];if("compound"===this.type&&!this.initial)return!d.M&&(0,n.ZK)(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var t=(0,n.SA)(this.initialStateValue);return(0,n.xH)(t.map(function(t){return e.getFromRelativePath(t)}))},enumerable:!1,configurable:!0}),e.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var t=(0,i.CR)(e),r=t[0],n=t.slice(1);if(!this.states)throw Error("Cannot retrieve subPath '".concat(r,"' from node with no states"));var o=this.getStateNode(r);if("history"===o.type)return o.resolveHistory();if(!this.states[r])throw Error("Child state '".concat(r,"' does not exist on '").concat(this.id,"'"));return this.states[r].getFromRelativePath(n)},e.prototype.historyValue=function(e){if(!!Object.keys(this.states).length)return{current:e||this.initialStateValue,states:(0,n.ib)(this.states,function(t,r){if(!e)return t.historyValue();var i=(0,n.HD)(e)?void 0:e[r];return t.historyValue(i||t.initialStateValue)},function(e){return!e.history})}},e.prototype.resolveHistory=function(e){var t=this;if("history"!==this.type)return[this];var r=this.parent;if(!e){var i=this.target;return i?(0,n.xH)((0,n.SA)(i).map(function(e){return r.getFromRelativePath(e)})):r.initialStateNodes}var o=(0,n.gk)(r.path,"states")(e).current;return(0,n.HD)(o)?[r.getStateNode(o)]:(0,n.xH)((0,n.SA)(o).map(function(e){return"deep"===t.history?r.getFromRelativePath(e):[r.states[e[0]]]}))},Object.defineProperty(e.prototype,"stateIds",{get:function(){var e=this,t=(0,n.xH)(Object.keys(this.states).map(function(t){return e.states[t].stateIds}));return[this.id].concat(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){if(this.__cache.events)return this.__cache.events;var e,t,r,n,o=this.states,a=new Set(this.ownEvents);if(o)try{for(var s=(0,i.XA)(Object.keys(o)),c=s.next();!c.done;c=s.next()){var d=o[c.value];if(d.states)try{for(var u=(r=void 0,(0,i.XA)(d.events)),l=u.next();!l.done;l=u.next()){var h=l.value;a.add("".concat(h))}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(a)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownEvents",{get:function(){return Array.from(new Set(this.transitions.filter(function(e){return!(!e.target&&!e.actions.length&&e.internal)}).map(function(e){return e.eventType})))},enumerable:!1,configurable:!0}),e.prototype.resolveTarget=function(e){var t=this;if(void 0!==e)return e.map(function(e){if(!(0,n.HD)(e))return e;var r=e[0]===t.delimiter;if(r&&!t.parent)return t.getStateNodeByPath(e.slice(1));var i=r?t.key+e:e;if(!t.parent)return t.getStateNodeByPath(i);try{return t.parent.getStateNodeByPath(i)}catch(e){throw Error("Invalid transition definition for state node '".concat(t.id,"':\n").concat(e.message))}})},e.prototype.formatTransition=function(e){var t=this,r=(0,n.rg)(e.target),o="internal"in e?e.internal:!r||r.some(function(e){return(0,n.HD)(e)&&e[0]===t.delimiter}),a=this.machine.options.guards,s=this.resolveTarget(r),d=(0,i.pi)((0,i.pi)({},e),{actions:(0,c.AE)((0,n.qo)(e.actions)),cond:(0,n.Qi)(e.cond,a),target:s,source:this,internal:o,eventType:e.event,toJSON:function(){return(0,i.pi)((0,i.pi)({},d),{target:d.target?d.target.map(function(e){return"#".concat(e.id)}):void 0,source:"#".concat(t.id)})}});return d},e.prototype.formatTransitions=function(){var e,t,r,o=this;if(this.config.on){if(Array.isArray(this.config.on))r=this.config.on;else{var a=this.config.on,s=a["*"],u=(0,i._T)(a,["*"]);r=(0,n.xH)(Object.keys(u).map(function(e){!d.M&&""===e&&(0,n.ZK)(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(o.id,'".'));var t=(0,n.jh)(e,u[e]);return!d.M&&A(o,e,t),t}).concat((0,n.jh)("*",void 0===s?[]:s)))}}else r=[];var l=this.config.always?(0,n.jh)("",this.config.always):[],h=this.config.onDone?(0,n.jh)(String((0,c.aT)(this.id)),this.config.onDone):[];!d.M&&(0,n.ZK)(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var p=(0,n.xH)(this.invoke.map(function(e){var t=[];return e.onDone&&t.push.apply(t,(0,i.ev)([],(0,i.CR)((0,n.jh)(String((0,c.Sl)(e.id)),e.onDone)),!1)),e.onError&&t.push.apply(t,(0,i.ev)([],(0,i.CR)((0,n.jh)(String((0,c.vU)(e.id)),e.onError)),!1)),t})),f=this.after,_=(0,n.xH)((0,i.ev)((0,i.ev)((0,i.ev)((0,i.ev)([],(0,i.CR)(h),!1),(0,i.CR)(p),!1),(0,i.CR)(r),!1),(0,i.CR)(l),!1).map(function(e){return(0,n.qo)(e).map(function(e){return o.formatTransition(e)})}));try{for(var m=(0,i.XA)(f),v=m.next();!v.done;v=m.next()){var E=v.value;_.push(E)}}catch(t){e={error:t}}finally{try{v&&!v.done&&(t=m.return)&&t.call(m)}finally{if(e)throw e.error}}return _},e}(),v=!1;function E(e,t){return!d.M&&!("predictableActionArguments"in e)&&!v&&(v=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new m(e,t)}},698307:function(e,t,r){"use strict";r.d(t,{TL:function(){return d},ZM:function(){return l},j1:function(){return u},j_:function(){return function e(t,r){if(t===r)return!0;if(void 0===t||void 0===r)return!1;if((0,o.HD)(t)||(0,o.HD)(r))return t===r;var i=Object.keys(t),n=Object.keys(r);return i.length===n.length&&i.every(function(i){return e(t[i],r[i])})}}});var i=r(312115),n=r(740439),o=r(929188),a=r(106201),s=r(662246),c=r(957246);function d(e){return"object"==typeof e&&null!==e&&"value"in e&&"_event"in e}function u(e,t){var r=e.exec;return(0,i.pi)((0,i.pi)({},e),{exec:void 0!==r?function(){return r(t.context,t.event,{action:e,state:t,_event:t._event})}:void 0})}var l=function(){function e(e){var t,r=this;this.actions=[],this.activities=n.qP,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||n.qP,this.meta=(0,a.xZ)(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=null!==(t=Array.isArray(e.tags)?new Set(e.tags):e.tags)&&void 0!==t?t:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return(0,a.nJ)(r.configuration)}})}return e.from=function(t,r){if(t instanceof e)return t.context!==r?new e({value:t.value,context:r,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;return new e({value:t,context:r,_event:s.bf,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},e.create=function(t){return new e(t)},e.inert=function(t,r){if(t instanceof e){if(!t.actions.length)return t;var i=s.bf;return new e({value:t.value,context:r,_event:i,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return e.from(t,r)},e.prototype.toStrings=function(e,t){var r=this;if(void 0===e&&(e=this.value),void 0===t&&(t="."),(0,o.HD)(e))return[e];var n=Object.keys(e);return n.concat.apply(n,(0,i.ev)([],(0,i.CR)(n.map(function(i){return r.toStrings(e[i],t).map(function(e){return i+t+e})})),!1))},e.prototype.toJSON=function(){this.configuration,this.transitions;var e=this.tags;this.machine;var t=(0,i._T)(this,["configuration","transitions","tags","machine"]);return(0,i.pi)((0,i.pi)({},t),{tags:Array.from(e)})},e.prototype.matches=function(e){return(0,o.W)(e,this.value)},e.prototype.hasTag=function(e){return this.tags.has(e)},e.prototype.can=function(e){c.M&&(0,o.ZK)(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var t,r=null===(t=this.machine)||void 0===t?void 0:t.getTransitionData(this,e);return!!(null==r?void 0:r.transitions.length)&&r.transitions.some(function(e){return void 0!==e.target||e.actions.length})},e}()},312115:function(e,t,r){"use strict";r.d(t,{CR:function(){return a},XA:function(){return o},_T:function(){return n},ev:function(){return s},pi:function(){return i}});var i=function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r],t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function n(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a}function s(e,t,r){if(r||2==arguments.length)for(var i,n=0,o=t.length;n<o;n++)(i||!(n in t))&&(!i&&(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}},86860:function(e,t,r){"use strict";r.d(t,{BL:function(){return n},IA:function(){return d},Le:function(){return v},Mg:function(){return f},OU:function(){return a},RN:function(){return m},S1:function(){return h},Vx:function(){return A},al:function(){return c},cM:function(){return l},dw:function(){return p},f0:function(){return u},lW:function(){return s},sT:function(){return o},vU:function(){return _}});var i=r(342050),n=i.M.Start,o=i.M.Stop,a=i.M.Raise,s=i.M.Send,c=i.M.Cancel,d=i.M.NullEvent,u=i.M.Assign;i.M.After,i.M.DoneState;var l=i.M.Log,h=i.M.Init,p=i.M.Invoke;i.M.ErrorExecution;var f=i.M.ErrorPlatform,_=i.M.ErrorCustom,A=i.M.Update,m=i.M.Choose,v=i.M.Pure},662246:function(e,t,r){"use strict";r.d(t,{AE:function(){return l},BL:function(){return A},OU:function(){return p},Q8:function(){return u},Sl:function(){return g},XA:function(){return h},aT:function(){return E},al:function(){return _},bf:function(){return c},e4:function(){return v},lW:function(){return f},o$:function(){return d},sT:function(){return m},vU:function(){return S},yC:function(){return function e(t,r,c,d,h,p,f){void 0===f&&(f=!1);var _=f?[]:b(h),A=_.length?(0,a.dt)(c,d,_,r):c,m=f?[c]:void 0,v=[];return[(0,a.xH)(h.map(function(h){var _,E,g=[];try{for(var S=(0,i.XA)(h.actions),b=S.next();!b.done;b=S.next()){var T=b.value,y=function(h,_){switch(_.type){case o.OU:;return S=_,{type:o.OU,_event:(0,a.g5)(S.event)};case o.lW:var E=function(e,t,r,n){var o,s={_event:r},c=(0,a.g5)((0,a.mf)(e.event)?e.event(t,r.data,s):e.event);if((0,a.HD)(e.delay)){var d=n&&n[e.delay];o=(0,a.mf)(d)?d(t,r.data,s):d}else o=(0,a.mf)(e.delay)?e.delay(t,r.data,s):e.delay;var u=(0,a.mf)(e.to)?e.to(t,r.data,s):e.to;return(0,i.pi)((0,i.pi)({},e),{to:u,_event:c,event:c.data,delay:o})}(_,A,d,t.options.delays);return!s.M&&(0,a.ZK)(!(0,a.HD)(_.delay)||"number"==typeof E.delay,"No delay reference for delay expression '".concat(_.delay,"' was found on machine '").concat(t.id,"'")),p&&E.to!==n.K.Internal&&("entry"===h?v.push(E):null==p||p(E,A,d)),E;case o.cM:var g,S,b,T,y,R=(b=_,T=A,y=d,(0,i.pi)((0,i.pi)({},b),{value:(0,a.HD)(b.expr)?b.expr:b.expr(T,y.data,{_event:y})}));return null==p||p(R,A,d),R;case o.RN:var I=null===(g=_.conds.find(function(e){var i=(0,a.Qi)(e.cond,t.options.guards);return!i||(0,a.vx)(t,i,A,d,p?void 0:r)}))||void 0===g?void 0:g.actions;if(!I)return[];var C=(0,i.CR)(e(t,r,A,d,[{type:h,actions:l((0,a.qo)(I),t.options.actions)}],p,f),2),k=C[0];return A=C[1],null==m||m.push(A),k;case o.Le:var I=_.get(A,d.data);if(!I)return[];var w=(0,i.CR)(e(t,r,A,d,[{type:h,actions:l((0,a.qo)(I),t.options.actions)}],p,f),2),O=w[0];return A=w[1],null==m||m.push(A),O;case o.sT:var N,P,D,L,R=(N=_,P=A,D=d,L=(0,a.mf)(N.activity)?N.activity(P,D.data):N.activity,{type:n.M.Stop,activity:"string"==typeof L?{id:L}:L});return null==p||p(R,c,d),R;case o.f0:A=(0,a.dt)(A,d,[_],p?void 0:r),null==m||m.push(A);break;default:var M=u(_,t.options.actions),x=M.exec;if(p)p(M,A,d);else if(x&&m){var U=m.length-1;M=(0,i.pi)((0,i.pi)({},M),{exec:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];x.apply(void 0,(0,i.ev)([m[U]],(0,i.CR)(t),!1))}})}return M}}(h.type,T);y&&(g=g.concat(y))}}catch(e){_={error:e}}finally{try{b&&!b.done&&(E=S.return)&&E.call(S)}finally{if(_)throw _.error}}return v.forEach(function(e){p(e,A,d)}),v.length=0,g})),A]}}});var i=r(312115),n=r(342050),o=r(86860),a=r(929188),s=r(957246),c=(0,a.g5)({type:o.S1});function d(e,t){return t&&t[e]||void 0}function u(e,t){var r;if((0,a.HD)(e)||"number"==typeof e){var n=d(e,t);r=(0,a.mf)(n)?{type:e,exec:n}:n?n:{type:e,exec:void 0}}else if((0,a.mf)(e))r={type:e.name||e.toString(),exec:e};else{var n=d(e.type,t);if((0,a.mf)(n))r=(0,i.pi)((0,i.pi)({},e),{exec:n});else if(n){var o=n.type||e.type;r=(0,i.pi)((0,i.pi)((0,i.pi)({},n),e),{type:o})}else r=e}return r}var l=function(e,t){return e?((0,a.kJ)(e)?e:[e]).map(function(e){return u(e,t)}):[]};function h(e){var t=u(e);return(0,i.pi)((0,i.pi)({id:(0,a.HD)(e)?e:t.id},t),{type:t.type})}function p(e){return(0,a.HD)(e)?{type:o.OU,event:e}:f(e,{to:n.K.Internal})}function f(e,t){return{to:t?t.to:void 0,type:o.lW,event:(0,a.mf)(e)?e:(0,a._v)(e),delay:t?t.delay:void 0,id:t&&void 0!==t.id?t.id:(0,a.mf)(e)?e.name:(0,a.x6)(e)}}var _=function(e){return{type:o.al,sendId:e}};function A(e){var t=h(e);return{type:n.M.Start,activity:t,exec:void 0}}function m(e){var t=(0,a.mf)(e)?e:h(e);return{type:n.M.Stop,activity:t,exec:void 0}}function v(e,t){return"".concat(n.M.After,"(").concat(e,")").concat(t?"#".concat(t):"")}function E(e,t){var r="".concat(n.M.DoneState,".").concat(e),i={type:r,data:t};return i.toString=function(){return r},i}function g(e,t){var r="".concat(n.M.DoneInvoke,".").concat(e),i={type:r,data:t};return i.toString=function(){return r},i}function S(e,t){var r="".concat(n.M.ErrorPlatform,".").concat(e),i={type:r,data:t};return i.toString=function(){return r},i}var b=function(e){var t,r,n=[];try{for(var a=(0,i.XA)(e),s=a.next();!s.done;s=a.next()){for(var c=s.value,d=0;d<c.actions.length;){if(c.actions[d].type===o.f0){n.push(c.actions[d]),c.actions.splice(d,1);continue}d++}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n}},740439:function(e,t,r){"use strict";r.d(t,{TV:function(){return o},iS:function(){return i},qP:function(){return n},rt:function(){return a}});var i=".",n={},o="xstate.guard",a=""},957246:function(e,t,r){"use strict";r.d(t,{M:function(){return i}});var i=!0},319904:function(e,t,r){"use strict";r.d(t,{J:function(){return n}});var i=[],n=function(e,t){i.push(e);var r=t(e);return i.pop(),r}},106201:function(e,t,r){"use strict";r.d(t,{G:function(){return s},Ij:function(){return function e(t,r){return"compound"===r.type?s(r).some(function(e){return"final"===e.type&&h(t,e)}):"parallel"===r.type&&s(r).every(function(r){return e(t,r)})}},N9:function(){return o},NA:function(){return l},Oe:function(){return _},P_:function(){return d},ac:function(){return c},e$:function(){return h},nI:function(){return a},nJ:function(){return p},xZ:function(){return f}});var i=r(312115),n=r(929188),o=function(e){return"atomic"===e.type||"final"===e.type};function a(e){return Object.keys(e.states).map(function(t){return e.states[t]})}function s(e){return a(e).filter(function(e){return"history"!==e.type})}function c(e){var t=[e];return o(e)?t:t.concat((0,n.xH)(s(e).map(c)))}function d(e,t){var r,n,o,a,c,d,l,h,p=u(new Set(e)),f=new Set(t);try{for(var _=(0,i.XA)(f),A=_.next();!A.done;A=_.next()){for(var m=A.value,v=m.parent;v&&!f.has(v);)f.add(v),v=v.parent}}catch(e){r={error:e}}finally{try{A&&!A.done&&(n=_.return)&&n.call(_)}finally{if(r)throw r.error}}var E=u(f);try{for(var g=(0,i.XA)(f),S=g.next();!S.done;S=g.next()){var m=S.value;if("compound"!==m.type||E.get(m)&&E.get(m).length){if("parallel"===m.type)try{for(var b=(c=void 0,(0,i.XA)(s(m))),T=b.next();!T.done;T=b.next()){var y=T.value;!f.has(y)&&(f.add(y),p.get(y)?p.get(y).forEach(function(e){return f.add(e)}):y.initialStateNodes.forEach(function(e){return f.add(e)}))}}catch(e){c={error:e}}finally{try{T&&!T.done&&(d=b.return)&&d.call(b)}finally{if(c)throw c.error}}}else p.get(m)?p.get(m).forEach(function(e){return f.add(e)}):m.initialStateNodes.forEach(function(e){return f.add(e)})}}catch(e){o={error:e}}finally{try{S&&!S.done&&(a=g.return)&&a.call(g)}finally{if(o)throw o.error}}try{for(var R=(0,i.XA)(f),I=R.next();!I.done;I=R.next()){for(var m=I.value,v=m.parent;v&&!f.has(v);)f.add(v),v=v.parent}}catch(e){l={error:e}}finally{try{I&&!I.done&&(h=R.return)&&h.call(R)}finally{if(l)throw l.error}}return f}function u(e){var t,r,n=new Map;try{for(var o=(0,i.XA)(e),a=o.next();!a.done;a=o.next()){var s=a.value;!n.has(s)&&n.set(s,[]),s.parent&&(!n.has(s.parent)&&n.set(s.parent,[]),n.get(s.parent).push(s))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n}function l(e,t){var r=d([e],t);return function e(t,r){var i=r.get(t);if(!i)return{};if("compound"===t.type){var n=i[0];if(!n)return{};if(o(n))return n.key}var a={};return i.forEach(function(t){a[t.key]=e(t,r)}),a}(e,u(r))}function h(e,t){return Array.isArray(e)?e.some(function(e){return e===t}):e instanceof Set&&e.has(t)}function p(e){return(0,i.ev)([],(0,i.CR)(new Set((0,n.xH)((0,i.ev)([],(0,i.CR)(e.map(function(e){return e.ownEvents})),!1)))),!1)}function f(e){return void 0===e&&(e=[]),e.reduce(function(e,t){return void 0!==t.meta&&(e[t.id]=t.meta),e},{})}function _(e){return new Set((0,n.xH)(e.map(function(e){return e.tags})))}},342050:function(e,t,r){"use strict";var i,n,o,a;r.d(t,{K:function(){return n},M:function(){return i}}),(o=i||(i={})).Start="xstate.start",o.Stop="xstate.stop",o.Raise="xstate.raise",o.Send="xstate.send",o.Cancel="xstate.cancel",o.NullEvent="",o.Assign="xstate.assign",o.After="xstate.after",o.DoneState="done.state",o.DoneInvoke="done.invoke",o.Log="xstate.log",o.Init="xstate.init",o.Invoke="xstate.invoke",o.ErrorExecution="error.execution",o.ErrorCommunication="error.communication",o.ErrorPlatform="error.platform",o.ErrorCustom="xstate.error",o.Update="xstate.update",o.Pure="xstate.pure",o.Choose="xstate.choose",(a=n||(n={})).Parent="#_parent",a.Internal="#_internal"},929188:function(e,t,r){"use strict";r.d(t,{Bc:function(){return D},ET:function(){return p},HD:function(){return k},HV:function(){return S},JQ:function(){return E},L$:function(){return N},O4:function(){return P},Q8:function(){return l},Q9:function(){return c},QX:function(){return v},Qi:function(){return w},SA:function(){return function e(t){return t?k(t)?[[t]]:_(Object.keys(t).map(function(r){var i=t[r];return"string"==typeof i||i&&Object.keys(i).length?e(t[r]).map(function(e){return[r].concat(e)}):[[r]]})):[[]]}},W:function(){return function e(t,r,i){void 0===i&&(i=o.iS);var n=d(t,i),a=d(r,i);if(k(a))return!!k(n)&&a===n;return k(n)?n in a:Object.keys(n).every(function(t){return t in a&&e(n[t],a[t])})}},WM:function(){return d},ZK:function(){return R},_v:function(){return L},bi:function(){return O},bx:function(){return G},dt:function(){return y},g5:function(){return M},gk:function(){return f},ib:function(){return h},j:function(){return F},jh:function(){return x},kJ:function(){return I},mf:function(){return C},on:function(){return u},qo:function(){return m},rg:function(){return U},uK:function(){return b},v4:function(){return B},vx:function(){return V},x6:function(){return s},xH:function(){return _},y8:function(){return g},yv:function(){return T},zM:function(){return j}});var i,n=r(312115),o=r(740439),a=r(957246);function s(e){try{return k(e)||"number"==typeof e?"".concat(e):e.type}catch(e){throw Error("Events must be strings or objects with a string event.type property.")}}function c(e,t){try{if(I(e))return e;return e.toString().split(t)}catch(t){throw Error("'".concat(e,"' is not a valid state path."))}}function d(e,t){var r;return"object"==typeof(r=e)&&"value"in r&&"context"in r&&"event"in r&&"_event"in r?e.value:I(e)?u(e):"string"!=typeof e?e:u(c(e,t))}function u(e){if(1===e.length)return e[0];for(var t={},r=t,i=0;i<e.length-1;i++)i===e.length-2?r[e[i]]=e[i+1]:(r[e[i]]={},r=r[e[i]]);return t}function l(e,t){for(var r={},i=Object.keys(e),n=0;n<i.length;n++){var o=i[n];r[o]=t(e[o],o,e,n)}return r}function h(e,t,r){var i,o,a={};try{for(var s=(0,n.XA)(Object.keys(e)),c=s.next();!c.done;c=s.next()){var d=c.value,u=e[d];if(!!r(u))a[d]=t(u,d,e)}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return a}var p=function(e){return function(t){var r,i,o=t;try{for(var a=(0,n.XA)(e),s=a.next();!s.done;s=a.next())o=o[s.value]}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o}};function f(e,t){return function(r){var i,o,a=r;try{for(var s=(0,n.XA)(e),c=s.next();!c.done;c=s.next()){var d=c.value;a=a[t][d]}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return a}}function _(e){var t;return(t=[]).concat.apply(t,(0,n.ev)([],(0,n.CR)(e),!1))}function A(e){return I(e)?e:[e]}function m(e){return void 0===e?[]:A(e)}function v(e,t,r){if(C(e))return e(t,r.data);var i,o,a={};try{for(var s=(0,n.XA)(Object.keys(e)),c=s.next();!c.done;c=s.next()){var d=c.value,u=e[d];C(u)?a[d]=u(t,r.data):a[d]=u}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return a}function E(e){return/^(done|error)\./.test(e)}function g(e){return!!(e instanceof Promise||null!==e&&(C(e)||"object"==typeof e)&&C(e.then))||!1}function S(e){return null!==e&&"object"==typeof e&&"transition"in e&&"function"==typeof e.transition}function b(e,t){var r,i,o=(0,n.CR)([[],[]],2),a=o[0],s=o[1];try{for(var c=(0,n.XA)(e),d=c.next();!d.done;d=c.next()){var u=d.value;t(u)?a.push(u):s.push(u)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}return[a,s]}function T(e,t){return{current:t,states:function e(t,r){return l(t.states,function(t,i){if(!t)return;var n=(k(r)?void 0:r[i])||(t?t.current:void 0);if(!!n)return{current:n,states:e(t,n)}})}(e,t)}}function y(e,t,r,i){return!a.M&&R(!!e,"Attempting to update undefined context"),e?r.reduce(function(e,r){var o,a,s=r.assignment,c={state:i,action:r,_event:t},d={};if(C(s))d=s(e,t.data,c);else try{for(var u=(0,n.XA)(Object.keys(s)),l=u.next();!l.done;l=u.next()){var h=l.value,p=s[h];d[h]=C(p)?p(e,t.data,c):p}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}return Object.assign({},e,d)},e):e}var R=function(){};function I(e){return Array.isArray(e)}function C(e){return"function"==typeof e}function k(e){return"string"==typeof e}function w(e,t){return e?k(e)?{type:o.TV,name:e,predicate:t?t[e]:void 0}:C(e)?{type:o.TV,name:e.name,predicate:e}:e:void 0}function O(e){try{return"subscribe"in e&&C(e.subscribe)}catch(e){return!1}}!a.M&&(R=function(e,t){var r=e instanceof Error?e:void 0;if(!!r||!e){if(void 0!==console){var i=["Warning: ".concat(t)];r&&i.push(r),console.warn.apply(console,i)}}});var N="function"==typeof Symbol&&Symbol.observable||"@@observable";function P(e){return!!e&&"__xstatenode"in e}function D(e){return!!e&&"function"==typeof e.send}function L(e,t){return k(e)||"number"==typeof e?(0,n.pi)({type:e},t):e}function M(e,t){if(!k(e)&&"$$type"in e&&"scxml"===e.$$type)return e;var r=L(e);return(0,n.pi)({name:r.type,data:r,$$type:"scxml",type:"external"},t)}function x(e,t){return A(t).map(function(t){return void 0===t||"string"==typeof t||P(t)?{target:t,event:e}:(0,n.pi)((0,n.pi)({},t),{event:e})})}function U(e){if(void 0!==e&&e!==o.rt)return m(e)}function B(e,t,r){if(!a.M){var i=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";if(e===t)console.error("Missing onError handler for invocation '".concat(r,"', error was '").concat(e,"'.").concat(i));else{var n=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(r,"'. ")+"Original error: '".concat(e,"'. ").concat(i," Current error is '").concat(t,"'.").concat(n))}}}function V(e,t,r,i,n){var a=e.options.guards,s={state:n,cond:t,_event:i};if(t.type===o.TV)return((null==a?void 0:a[t.name])||t.predicate)(r,i.data,s);var c=null==a?void 0:a[t.type];if(!c)throw Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(e.id,"'."));return c(r,i.data,s)}function F(e){return"string"==typeof e?{type:e}:e}function j(e,t,r){var i=function(){},n="object"==typeof e,o=n?e:null;return{next:((n?e.next:e)||i).bind(o),error:((n?e.error:t)||i).bind(o),complete:((n?e.complete:r)||i).bind(o)}}function G(e,t){return"".concat(e,":invocation[").concat(t,"]")}(i={})[N]=function(){return this},i[Symbol.observable]=function(){return this}},685379:function(e,t,r){"use strict";r.d(t,{_0:()=>pJ});var i,n,o,a,s,c,d,u,l,h,p,f,_,A,m,v,E,g,S,b,T,y,R,I,C,k,w,O,N,P,D,L,M,x,U,B,V,F,j,G,W,H,Y,K,Q,z,X,J,q,Z,$,ee,et,er,ei,en,eo,ea,es,ec,ed,eu,el,eh,ep,ef,e_,eA,em,ev,eE,eg,eS,eb,eT,ey,eR,eI,eC,ek,ew,eO,eN,eP,eD,eL,eM,ex,eU,eB,eV,eF,ej,eG,eW,eH,eY,eK,eQ,ez,eX,eJ,eq,eZ,e$,e0,e2,e1,e4,e6,e3,e8,e5,e9,e7,te,tt,tr,ti,tn,to,ta,ts,tc,td,tu,tl,th,tp,tf,t_,tA,tm,tv,tE,tg,tS,tb,tT,ty,tR,tI,tC,tk,tw,tO,tN,tP,tD,tL,tM,tx,tU,tB,tV,tF,tj,tG,tW,tH,tY,tK,tQ,tz,tX,tJ,tq,tZ,t$,t0,t2,t1,t4,t6,t3,t8,t5,t9,t7,re,rt,rr,ri,rn,ro,ra,rs,rc,rd,ru,rl,rh,rp,rf,r_,rA,rm,rv,rE,rg,rS,rb,rT,ry,rR,rI,rC,rk,rw,rO,rN,rP,rD,rL,rM,rx,rU,rB,rV,rF,rj,rG,rW,rH,rY,rK,rQ,rz,rX,rJ,rq,rZ,r$,r0,r2,r1,r4={};r.r(r4),r.d(r4,{fixNegotiationNeeded:()=>i$,shimAddTrackRemoveTrack:()=>iq,shimAddTrackRemoveTrackWithNative:()=>iJ,shimGetDisplayMedia:()=>iH,shimGetSendersWithDtmf:()=>iQ,shimGetStats:()=>iz,shimGetUserMedia:()=>iW,shimMediaStream:()=>iY,shimOnTrack:()=>iK,shimPeerConnection:()=>iZ,shimSenderReceiverGetStats:()=>iX});var r6={};r.r(r6),r.d(r6,{shimAddTransceiver:()=>i9,shimCreateAnswer:()=>nt,shimCreateOffer:()=>ne,shimGetDisplayMedia:()=>i2,shimGetParameters:()=>i7,shimGetUserMedia:()=>i0,shimOnTrack:()=>i1,shimPeerConnection:()=>i4,shimRTCDataChannel:()=>i5,shimReceiverGetStats:()=>i3,shimRemoveStream:()=>i8,shimSenderGetStats:()=>i6});var r3={};r.r(r3),r.d(r3,{shimAudioContext:()=>nu,shimCallbacksAPI:()=>nn,shimConstraints:()=>na,shimCreateOfferLegacy:()=>nd,shimGetUserMedia:()=>no,shimLocalStreamsAPI:()=>nr,shimRTCIceServerUrls:()=>ns,shimRemoteStreamsAPI:()=>ni,shimTrackEventTransceiver:()=>nc});var r8={};r.r(r8),r.d(r8,{removeExtmapAllowMixed:()=>nv,shimAddIceCandidateNullOrEmpty:()=>nE,shimConnectionState:()=>nm,shimMaxMessageSize:()=>n_,shimParameterlessSetLocalDescription:()=>ng,shimRTCIceCandidate:()=>np,shimRTCIceCandidateRelayProtocol:()=>nf,shimSendThrowTypeError:()=>nA});var r5=r("21556"),r9=r("104710");(r7=it||(it={})).STATIONARY_NS="STATIONARY_NS",r7.NSNG="NSNG",(ie=ir||(ir={})).SOFT="SOFT",ie.AGGRESSIVE="AGGRESSIVE";var r7,ie,it,ir,ii,io={exports:{}};function ia(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((i=i.apply(e,t||[])).next())})}self,ii=()=>(()=>{var e={3536:(e,t,r)=>{var i=r(1910);e.exports=i},8171:(e,t,r)=>{r(6450);var i=r(4058).Object,n=e.exports=function(e,t,r){return i.defineProperty(e,t,r)};i.defineProperty.sham&&(n.sham=!0)},2956:(e,t,r)=>{r(7627),r(6274),r(5967),r(8881),r(4560),r(7206),r(4349),r(7971);var i=r(4058);e.exports=i.Promise},3685:(e,t,r)=>{e.exports=r(621)},621:(e,t,r)=>{var i=r(3536);e.exports=i},4883:(e,t,r)=>{var i=r(7475),n=r(9826),o=TypeError;e.exports=function(e){if(i(e))return e;throw o(n(e)+" is not a function")}},174:(e,t,r)=>{var i=r(4284),n=r(9826),o=TypeError;e.exports=function(e){if(i(e))return e;throw o(n(e)+" is not a constructor")}},1851:(e,t,r)=>{var i=r(7475),n=String,o=TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw o("Can't set "+n(e)+" as a prototype")}},8479:e=>{e.exports=function(){}},5743:(e,t,r)=>{var i=r(7046),n=TypeError;e.exports=function(e,t){if(i(t,e))return e;throw n("Incorrect invocation")}},6059:(e,t,r)=>{var i=r(941),n=String,o=TypeError;e.exports=function(e){if(i(e))return e;throw o(n(e)+" is not an object")}},1692:(e,t,r)=>{var i=r(4529),n=r(9413),o=r(623),a=function(e){return function(t,r,a){var s,c=i(t),d=o(c),u=n(a,d);if(e&&r!=r){for(;d>u;)if((s=c[u++])!=s)return!0}else for(;d>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},3765:(e,t,r)=>{var i=r(5329);e.exports=i([].slice)},1385:(e,t,r)=>{var i=r(9813)("iterator"),n=!1;try{var o=0,a={next:function(){return{done:!!o++}},return:function(){n=!0}};a[i]=function(){return this},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!n)return!1;var r=!1;try{var o={};o[i]=function(){return{next:function(){return{done:r=!0}}}},e(o)}catch(e){}return r}},2532:(e,t,r)=>{var i=r(4163),n=i({}.toString),o=i("".slice);e.exports=function(e){return o(n(e),8,-1)}},9697:(e,t,r)=>{var i=r(2885),n=r(7475),o=r(2532),a=r(9813)("toStringTag"),s=Object,c="Arguments"==o(function(){return arguments}());e.exports=i?o:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?r:c?o(t):"Object"==(i=o(t))&&n(t.callee)?"Arguments":i}},3489:(e,t,r)=>{var i=r(953),n=r(1136),o=r(9677),a=r(5988);e.exports=function(e,t,r){for(var s=n(t),c=a.f,d=o.f,u=0;u<s.length;u++){var l=s[u];i(e,l)||r&&i(r,l)||c(e,l,d(t,l))}}},4160:(e,t,r)=>{var i=r(5981);e.exports=!i(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},3538:e=>{e.exports=function(e,t){return{value:e,done:t}}},2029:(e,t,r)=>{var i=r(5746),n=r(5988),o=r(1887);e.exports=i?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},1887:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},5929:(e,t,r)=>{var i=r(2029);e.exports=function(e,t,r,n){return n&&n.enumerable?e[t]=r:i(e,t,r),e}},5609:(e,t,r)=>{var i=r(1899),n=Object.defineProperty;e.exports=function(e,t){try{n(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}},5746:(e,t,r)=>{var i=r(5981);e.exports=!i(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},6616:e=>{var t="object"==typeof document&&document.all;e.exports={all:t,IS_HTMLDDA:void 0===t&&void 0!==t}},1333:(e,t,r)=>{var i=r(1899),n=r(941),o=i.document,a=n(o)&&n(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},3281:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},3321:(e,t,r)=>{var i=r(8501),n=r(6049);e.exports=!i&&!n&&"object"==typeof window&&"object"==typeof document},8501:e=>{e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},4470:(e,t,r)=>{var i=r(2861),n=r(1899);e.exports=/ipad|iphone|ipod/i.test(i)&&void 0!==n.Pebble},2749:(e,t,r)=>{var i=r(2861);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)},6049:(e,t,r)=>{var i=r(2532),n=r(1899);e.exports="process"==i(n.process)},8045:(e,t,r)=>{var i=r(2861);e.exports=/web0s(?!.*chrome)/i.test(i)},2861:(e,t,r)=>{var i=r(626);e.exports=i("navigator","userAgent")||""},3385:(e,t,r)=>{var i,n,o=r(1899),a=r(2861),s=o.process,c=o.Deno,d=s&&s.versions||c&&c.version,u=d&&d.v8;u&&(n=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!n&&a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(n=+i[1]),e.exports=n},6759:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3995:(e,t,r)=>{var i=r(5329),n=Error,o=i("".replace),a=String(n("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,c=s.test(a);e.exports=function(e,t){if(c&&"string"==typeof e&&!n.prepareStackTrace)for(;t--;)e=o(e,s,"");return e}},8780:(e,t,r)=>{var i=r(5981),n=r(1887);e.exports=!i(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",n(1,7)),7!==e.stack)})},6887:(e,t,r)=>{var i=r(1899),n=r(9730),o=r(5329),a=r(7475),s=r(9677).f,c=r(7252),d=r(4058),u=r(6843),l=r(2029),h=r(953),p=function(e){var t=function(r,i,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,i)}return new e(r,i,o)}return n(e,this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,n,f,_,A,m,v,E,g=e.target,S=e.global,b=e.stat,T=e.proto,y=S?i:b?i[g]:(i[g]||{}).prototype,R=S?d:d[g]||l(d,g,{})[g],I=R.prototype;for(f in t)r=!c(S?f:g+(b?".":"#")+f,e.forced)&&y&&h(y,f),A=R[f],r&&(m=e.dontCallGetSet?(E=s(y,f))&&E.value:y[f]),_=r&&m?m:t[f],r&&typeof A==typeof _||(v=e.bind&&r?u(_,i):e.wrap&&r?p(_):T&&a(_)?o(_):_,(e.sham||_&&_.sham||A&&A.sham)&&l(v,"sham",!0),l(R,f,v),T&&(h(d,n=g+"Prototype")||l(d,n,{}),l(d[n],f,_),e.real&&I&&!I[f]&&l(I,f,_)))}},5981:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},9730:(e,t,r)=>{var i=r(8285),n=Function.prototype,o=n.apply,a=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(o):function(){return a.apply(o,arguments)})},6843:(e,t,r)=>{var i=r(5329),n=r(4883),o=r(8285),a=i(i.bind);e.exports=function(e,t){return n(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},8285:(e,t,r)=>{var i=r(5981);e.exports=!i(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},8834:(e,t,r)=>{var i=r(8285),n=Function.prototype.call;e.exports=i?n.bind(n):function(){return n.apply(n,arguments)}},9417:(e,t,r)=>{var i=r(5746),n=r(953),o=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,s=n(o,"name"),c=s&&(!i||i&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:s&&"something"===(function(){}).name,CONFIGURABLE:c}},4163:(e,t,r)=>{var i=r(8285),n=Function.prototype,o=n.call,a=i&&n.bind.bind(o,o);e.exports=i?a:function(e){return function(){return o.apply(e,arguments)}}},5329:(e,t,r)=>{var i=r(2532),n=r(4163);e.exports=function(e){if("Function"===i(e))return n(e)}},626:(e,t,r)=>{var i=r(4058),n=r(1899),o=r(7475),a=function(e){return o(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?a(i[e])||a(n[e]):i[e]&&i[e][t]||n[e]&&n[e][t]}},2902:(e,t,r)=>{var i=r(9697),n=r(4229),o=r(2119),a=r(2077),s=r(9813)("iterator");e.exports=function(e){if(!o(e))return n(e,s)||n(e,"@@iterator")||a[i(e)]}},3476:(e,t,r)=>{var i=r(8834),n=r(4883),o=r(6059),a=r(9826),s=r(2902),c=TypeError;e.exports=function(e,t){var r=arguments.length<2?s(e):t;if(n(r))return o(i(r,e));throw c(a(e)+" is not iterable")}},4229:(e,t,r)=>{var i=r(4883),n=r(2119);e.exports=function(e,t){var r=e[t];return n(r)?void 0:i(r)}},1899:(e,t,r)=>{var i=function(e){return e&&e.Math==Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},953:(e,t,r)=>{var i=r(5329),n=r(9678),o=i({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(n(e),t)}},7748:e=>{e.exports={}},4845:(e,t,r)=>{var i=r(1899);e.exports=function(e,t){var r=i.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}},5463:(e,t,r)=>{var i=r(626);e.exports=i("document","documentElement")},2840:(e,t,r)=>{var i=r(5746),n=r(5981),o=r(1333);e.exports=!i&&!n(function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},7026:(e,t,r)=>{var i=r(5329),n=r(5981),o=r(2532),a=Object,s=i("".split);e.exports=n(function(){return!a("z").propertyIsEnumerable(0)})?function(e){return"String"==o(e)?s(e,""):a(e)}:a},1302:(e,t,r)=>{var i=r(5329),n=r(7475),o=r(3030),a=i(Function.toString);n(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},3794:(e,t,r)=>{var i=r(941),n=r(2029);e.exports=function(e,t){i(t)&&"cause"in t&&n(e,"cause",t.cause)}},5402:(e,t,r)=>{var i,n,o,a=r(7093),s=r(1899),c=r(941),d=r(2029),u=r(953),l=r(3030),h=r(4262),p=r(7748),f="Object already initialized",_=s.TypeError,A=s.WeakMap;if(a||l.state){var m=l.state||(l.state=new A);m.get=m.get,m.has=m.has,m.set=m.set,i=function(e,t){if(m.has(e))throw _(f);return t.facade=e,m.set(e,t),t},n=function(e){return m.get(e)||{}},o=function(e){return m.has(e)}}else{var v=h("state");p[v]=!0,i=function(e,t){if(u(e,v))throw _(f);return t.facade=e,d(e,v,t),t},n=function(e){return u(e,v)?e[v]:{}},o=function(e){return u(e,v)}}e.exports={set:i,get:n,has:o,enforce:function(e){return o(e)?n(e):i(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=n(t)).type!==e)throw _("Incompatible receiver, "+e+" required");return r}}}},6782:(e,t,r)=>{var i=r(9813),n=r(2077),o=i("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[o]===e)}},7475:(e,t,r)=>{var i=r(6616),n=i.all;e.exports=i.IS_HTMLDDA?function(e){return"function"==typeof e||e===n}:function(e){return"function"==typeof e}},4284:(e,t,r)=>{var i=r(5329),n=r(5981),o=r(7475),a=r(9697),s=r(626),c=r(1302),d=function(){},u=[],l=s("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=i(h.exec),f=!h.exec(d),_=function(e){if(!o(e))return!1;try{return l(d,u,e),!0}catch(e){return!1}},A=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(h,c(e))}catch(e){return!0}};A.sham=!0,e.exports=!l||n(function(){var e;return _(_.call)||!_(Object)||!_(function(){e=!0})||e})?A:_},7252:(e,t,r)=>{var i=r(5981),n=r(7475),o=/#|\.prototype\./,a=function(e,t){var r=c[s(e)];return r==u||r!=d&&(n(t)?i(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=a.data={},d=a.NATIVE="N",u=a.POLYFILL="P";e.exports=a},2119:e=>{e.exports=function(e){return null==e}},941:(e,t,r)=>{var i=r(7475),n=r(6616),o=n.all;e.exports=n.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:i(e)||e===o}:function(e){return"object"==typeof e?null!==e:i(e)}},2529:e=>{e.exports=!0},6664:(e,t,r)=>{var i=r(626),n=r(7475),o=r(7046),a=r(2302),s=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return n(t)&&o(t.prototype,s(e))}},3091:(e,t,r)=>{var i=r(6843),n=r(8834),o=r(6059),a=r(9826),s=r(6782),c=r(623),d=r(7046),u=r(3476),l=r(2902),h=r(7609),p=TypeError,f=function(e,t){this.stopped=e,this.result=t},_=f.prototype;e.exports=function(e,t,r){var A,m,v,E,g,S,b,T=r&&r.that,y=!(!r||!r.AS_ENTRIES),R=!(!r||!r.IS_RECORD),I=!(!r||!r.IS_ITERATOR),C=!(!r||!r.INTERRUPTED),k=i(t,T),w=function(e){return A&&h(A,"normal",e),new f(!0,e)},O=function(e){return y?(o(e),C?k(e[0],e[1],w):k(e[0],e[1])):C?k(e,w):k(e)};if(R)A=e.iterator;else if(I)A=e;else{if(!(m=l(e)))throw p(a(e)+" is not iterable");if(s(m)){for(v=0,E=c(e);E>v;v++)if((g=O(e[v]))&&d(_,g))return g;return new f(!1)}A=u(e,m)}for(S=R?e.next:A.next;!(b=n(S,A)).done;){try{g=O(b.value)}catch(e){h(A,"throw",e)}if("object"==typeof g&&g&&d(_,g))return g}return new f(!1)}},7609:(e,t,r)=>{var i=r(8834),n=r(6059),o=r(4229);e.exports=function(e,t,r){var a,s;n(e);try{if(!(a=o(e,"return"))){if("throw"===t)throw r;return r}a=i(a,e)}catch(e){s=!0,a=e}if("throw"===t)throw r;if(s)throw a;return n(a),r}},3847:(e,t,r)=>{var i=r(5143).IteratorPrototype,n=r(9290),o=r(1887),a=r(904),s=r(2077),c=function(){return this};e.exports=function(e,t,r,d){var u=t+" Iterator";return e.prototype=n(i,{next:o(+!d,r)}),a(e,u,!1,!0),s[u]=c,e}},5105:(e,t,r)=>{var i=r(6887),n=r(8834),o=r(2529),a=r(9417),s=r(7475),c=r(3847),d=r(249),u=r(8929),l=r(904),h=r(2029),p=r(5929),f=r(9813),_=r(2077),A=r(5143),m=a.PROPER,v=a.CONFIGURABLE,E=A.IteratorPrototype,g=A.BUGGY_SAFARI_ITERATORS,S=f("iterator"),b="keys",T="values",y="entries",R=function(){return this};e.exports=function(e,t,r,a,f,A,I){c(r,t,a);var C,k,w,O=function(e){if(e===f&&M)return M;if(!g&&e in D)return D[e];switch(e){case b:case T:case y:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",P=!1,D=e.prototype,L=D[S]||D["@@iterator"]||f&&D[f],M=!g&&L||O(f),x="Array"==t&&D.entries||L;if(x&&(C=d(x.call(new e)))!==Object.prototype&&C.next&&(o||d(C)===E||(u?u(C,E):s(C[S])||p(C,S,R)),l(C,N,!0,!0),o&&(_[N]=R)),m&&f==T&&L&&L.name!==T&&(!o&&v?h(D,"name",T):(P=!0,M=function(){return n(L,this)})),f){if(k={values:O(T),keys:A?M:O(b),entries:O(y)},I)for(w in k)!g&&!P&&w in D||p(D,w,k[w]);else i({target:t,proto:!0,forced:g||P},k)}return o&&!I||D[S]===M||p(D,S,M,{name:f}),_[t]=M,k}},5143:(e,t,r)=>{var i,n,o,a=r(5981),s=r(7475),c=r(941),d=r(9290),u=r(249),l=r(5929),h=r(9813),p=r(2529),f=h("iterator"),_=!1;[].keys&&("next"in(o=[].keys())?(n=u(u(o)))!==Object.prototype&&(i=n):_=!0),!c(i)||a(function(){var e={};return i[f].call(e)!==e})?i={}:p&&(i=d(i)),s(i[f])||l(i,f,function(){return this}),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:_}},2077:e=>{e.exports={}},623:(e,t,r)=>{var i=r(3057);e.exports=function(e){return i(e.length)}},5331:e=>{var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var i=+e;return(i>0?r:t)(i)}},6132:(e,t,r)=>{var i,n,o,a,s,c,d,u,l=r(1899),h=r(6843),p=r(9677).f,f=r(2941).set,_=r(2749),A=r(4470),m=r(8045),v=r(6049),E=l.MutationObserver||l.WebKitMutationObserver,g=l.document,S=l.process,b=l.Promise,T=p(l,"queueMicrotask"),y=T&&T.value;y||(i=function(){var e,t;for(v&&(e=S.domain)&&e.exit();n;){t=n.fn,n=n.next;try{t()}catch(e){throw n?a():o=void 0,e}}o=void 0,e&&e.enter()},_||v||m||!E||!g?!A&&b&&b.resolve?((d=b.resolve(void 0)).constructor=b,u=h(d.then,d),a=function(){u(i)}):v?a=function(){S.nextTick(i)}:(f=h(f,l),a=function(){f(i)}):(s=!0,c=g.createTextNode(""),new E(i).observe(c,{characterData:!0}),a=function(){c.data=s=!s})),e.exports=y||function(e){var t={fn:e,next:void 0};o&&(o.next=t),n||(n=t,a()),o=t}},9520:(e,t,r)=>{var i=r(4883),n=TypeError,o=function(e){var t,r;this.promise=new e(function(e,i){if(void 0!==t||void 0!==r)throw n("Bad Promise constructor");t=e,r=i}),this.resolve=i(t),this.reject=i(r)};e.exports.f=function(e){return new o(e)}},4649:(e,t,r)=>{var i=r(5803);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:i(e)}},9290:(e,t,r)=>{var i,n=r(6059),o=r(9938),a=r(6759),s=r(7748),c=r(5463),d=r(1333),u=r(4262)("IE_PROTO"),l=function(){},h=function(e){return"<script>"+e+"<\/script>"},p=function(e){e.write(h("")),e.close();var t=e.parentWindow.Object;return e=null,t},f=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}f="undefined"!=typeof document?document.domain&&i?p(i):((t=d("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(h("document.F=Object")),e.close(),e.F):p(i);for(var e,t,r=a.length;r--;)delete f.prototype[a[r]];return f()};s[u]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(l.prototype=n(e),r=new l,l.prototype=null,r[u]=e):r=f(),void 0===t?r:o.f(r,t)}},9938:(e,t,r)=>{var i=r(5746),n=r(3937),o=r(5988),a=r(6059),s=r(4529),c=r(4771);t.f=i&&!n?Object.defineProperties:function(e,t){a(e);for(var r,i=s(t),n=c(t),d=n.length,u=0;d>u;)o.f(e,r=n[u++],i[r]);return e}},5988:(e,t,r)=>{var i=r(5746),n=r(2840),o=r(3937),a=r(6059),s=r(3894),c=TypeError,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor;t.f=i?o?function(e,t,r){if(a(e),t=s(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&"writable"in r&&!r.writable){var i=u(e,t);i&&i.writable&&(e[t]=r.value,r={configurable:"configurable"in r?r.configurable:i.configurable,enumerable:"enumerable"in r?r.enumerable:i.enumerable,writable:!1})}return d(e,t,r)}:d:function(e,t,r){if(a(e),t=s(t),a(r),n)try{return d(e,t,r)}catch(e){}if("get"in r||"set"in r)throw c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},9677:(e,t,r)=>{var i=r(5746),n=r(8834),o=r(6760),a=r(1887),s=r(4529),c=r(3894),d=r(953),u=r(2840),l=Object.getOwnPropertyDescriptor;t.f=i?l:function(e,t){if(e=s(e),t=c(t),u)try{return l(e,t)}catch(e){}if(d(e,t))return a(!n(o.f,e,t),e[t])}},946:(e,t,r)=>{var i=r(5629),n=r(6759).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,n)}},7857:(e,t)=>{t.f=Object.getOwnPropertySymbols},249:(e,t,r)=>{var i=r(953),n=r(7475),o=r(9678),a=r(4262),s=r(4160),c=a("IE_PROTO"),d=Object,u=d.prototype;e.exports=s?d.getPrototypeOf:function(e){var t=o(e);if(i(t,c))return t[c];var r=t.constructor;return n(r)&&t instanceof r?r.prototype:t instanceof d?u:null}},7046:(e,t,r)=>{var i=r(5329);e.exports=i({}.isPrototypeOf)},5629:(e,t,r)=>{var i=r(5329),n=r(953),o=r(4529),a=r(1692).indexOf,s=r(7748),c=i([].push);e.exports=function(e,t){var r,i=o(e),d=0,u=[];for(r in i)!n(s,r)&&n(i,r)&&c(u,r);for(;t.length>d;)n(i,r=t[d++])&&(~a(u,r)||c(u,r));return u}},4771:(e,t,r)=>{var i=r(5629),n=r(6759);e.exports=Object.keys||function(e){return i(e,n)}},6760:(e,t)=>{var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,n=i&&!r.call({1:2},1);t.f=n?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},8929:(e,t,r)=>{var i=r(5329),n=r(6059),o=r(1851);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=i(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return n(r),o(i),t?e(r,i):r.__proto__=i,r}}():void 0)},5623:(e,t,r)=>{var i=r(2885),n=r(9697);e.exports=i?({}).toString:function(){return"[object "+n(this)+"]"}},9811:(e,t,r)=>{var i=r(8834),n=r(7475),o=r(941),a=TypeError;e.exports=function(e,t){var r,s;if("string"===t&&n(r=e.toString)&&!o(s=i(r,e))||n(r=e.valueOf)&&!o(s=i(r,e))||"string"!==t&&n(r=e.toString)&&!o(s=i(r,e)))return s;throw a("Can't convert object to primitive value")}},1136:(e,t,r)=>{var i=r(626),n=r(5329),o=r(946),a=r(7857),s=r(6059),c=n([].concat);e.exports=i("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?c(t,r(e)):t}},4058:e=>{e.exports={}},2:e=>{e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},7742:(e,t,r)=>{var i=r(1899),n=r(6991),o=r(7475),a=r(7252),s=r(1302),c=r(9813),d=r(3321),u=r(8501),l=r(2529),h=r(3385),p=n&&n.prototype,f=c("species"),_=!1,A=o(i.PromiseRejectionEvent),m=a("Promise",function(){var e=s(n),t=e!==String(n);if(!t&&66===h||l&&(!p.catch||!p.finally))return!0;if(!h||h<51||!/native code/.test(e)){var r=new n(function(e){e(1)}),i=function(e){e(function(){},function(){})};if((r.constructor={})[f]=i,!(_=r.then(function(){})instanceof i))return!0}return!t&&(d||u)&&!A});e.exports={CONSTRUCTOR:m,REJECTION_EVENT:A,SUBCLASSING:_}},6991:(e,t,r)=>{var i=r(1899);e.exports=i.Promise},6584:(e,t,r)=>{var i=r(6059),n=r(941),o=r(9520);e.exports=function(e,t){if(i(e),n(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},1542:(e,t,r)=>{var i=r(6991),n=r(1385),o=r(7742).CONSTRUCTOR;e.exports=o||!n(function(e){i.all(e).then(void 0,function(){})})},8397:e=>{var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}},e.exports=t},8219:(e,t,r)=>{var i=r(2119),n=TypeError;e.exports=function(e){if(i(e))throw n("Can't call method on "+e);return e}},4431:(e,t,r)=>{var i=r(626),n=r(5988),o=r(9813),a=r(5746),s=o("species");e.exports=function(e){var t=i(e),r=n.f;a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}},904:(e,t,r)=>{var i=r(2885),n=r(5988).f,o=r(2029),a=r(953),s=r(5623),c=r(9813)("toStringTag");e.exports=function(e,t,r,d){if(e){var u=r?e:e.prototype;a(u,c)||n(u,c,{configurable:!0,value:t}),d&&!i&&o(u,"toString",s)}}},4262:(e,t,r)=>{var i=r(8726),n=r(9418),o=i("keys");e.exports=function(e){return o[e]||(o[e]=n(e))}},3030:(e,t,r)=>{var i=r(1899),n=r(5609),o="__core-js_shared__",a=i[o]||n(o,{});e.exports=a},8726:(e,t,r)=>{var i=r(2529),n=r(3030);(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.0",mode:i?"pure":"global",copyright:"\xa9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})},487:(e,t,r)=>{var i=r(6059),n=r(174),o=r(2119),a=r(9813)("species");e.exports=function(e,t){var r,s=i(e).constructor;return void 0===s||o(r=i(s)[a])?t:n(r)}},4620:(e,t,r)=>{var i=r(5329),n=r(2435),o=r(5803),a=r(8219),s=i("".charAt),c=i("".charCodeAt),d=i("".slice),u=function(e){return function(t,r){var i,u,l=o(a(t)),h=n(r),p=l.length;return h<0||h>=p?e?"":void 0:(i=c(l,h))<55296||i>56319||h+1===p||(u=c(l,h+1))<56320||u>57343?e?s(l,h):i:e?d(l,h,h+2):u-56320+(i-55296<<10)+65536}};e.exports={codeAt:u(!1),charAt:u(!0)}},3405:(e,t,r)=>{var i=r(3385),n=r(5981);e.exports=!!Object.getOwnPropertySymbols&&!n(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41})},2941:(e,t,r)=>{var i,n,o,a,s=r(1899),c=r(9730),d=r(6843),u=r(7475),l=r(953),h=r(5981),p=r(5463),f=r(3765),_=r(1333),A=r(8348),m=r(2749),v=r(6049),E=s.setImmediate,g=s.clearImmediate,S=s.process,b=s.Dispatch,T=s.Function,y=s.MessageChannel,R=s.String,I=0,C={};try{i=s.location}catch(e){}var k=function(e){if(l(C,e)){var t=C[e];delete C[e],t()}},w=function(e){return function(){k(e)}},O=function(e){k(e.data)},N=function(e){s.postMessage(R(e),i.protocol+"//"+i.host)};E&&g||(E=function(e){A(arguments.length,1);var t=u(e)?e:T(e),r=f(arguments,1);return C[++I]=function(){c(t,void 0,r)},n(I),I},g=function(e){delete C[e]},v?n=function(e){S.nextTick(w(e))}:b&&b.now?n=function(e){b.now(w(e))}:y&&!m?(a=(o=new y).port2,o.port1.onmessage=O,n=d(a.postMessage,a)):s.addEventListener&&u(s.postMessage)&&!s.importScripts&&i&&"file:"!==i.protocol&&!h(N)?(n=N,s.addEventListener("message",O,!1)):n="onreadystatechange"in _("script")?function(e){p.appendChild(_("script")).onreadystatechange=function(){p.removeChild(this),k(e)}}:function(e){setTimeout(w(e),0)}),e.exports={set:E,clear:g}},9413:(e,t,r)=>{var i=r(2435),n=Math.max,o=Math.min;e.exports=function(e,t){var r=i(e);return r<0?n(r+t,0):o(r,t)}},4529:(e,t,r)=>{var i=r(7026),n=r(8219);e.exports=function(e){return i(n(e))}},2435:(e,t,r)=>{var i=r(5331);e.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}},3057:(e,t,r)=>{var i=r(2435),n=Math.min;e.exports=function(e){return e>0?n(i(e),0x1fffffffffffff):0}},9678:(e,t,r)=>{var i=r(8219),n=Object;e.exports=function(e){return n(i(e))}},6935:(e,t,r)=>{var i=r(8834),n=r(941),o=r(6664),a=r(4229),s=r(9811),c=r(9813),d=TypeError,u=c("toPrimitive");e.exports=function(e,t){if(!n(e)||o(e))return e;var r,c=a(e,u);if(c){if(void 0===t&&(t="default"),!n(r=i(c,e,t))||o(r))return r;throw d("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},3894:(e,t,r)=>{var i=r(6935),n=r(6664);e.exports=function(e){var t=i(e,"string");return n(t)?t:t+""}},2885:(e,t,r)=>{var i={};i[r(9813)("toStringTag")]="z",e.exports="[object z]"===String(i)},5803:(e,t,r)=>{var i=r(9697),n=String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return n(e)}},9826:e=>{var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},9418:(e,t,r)=>{var i=r(5329),n=0,o=Math.random(),a=i(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++n+o,36)}},2302:(e,t,r)=>{var i=r(3405);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3937:(e,t,r)=>{var i=r(5746),n=r(5981);e.exports=i&&n(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},8348:e=>{var t=TypeError;e.exports=function(e,r){if(e<r)throw t("Not enough arguments");return e}},7093:(e,t,r)=>{var i=r(1899),n=r(7475),o=i.WeakMap;e.exports=n(o)&&/native code/.test(String(o))},9813:(e,t,r)=>{var i=r(1899),n=r(8726),o=r(953),a=r(9418),s=r(3405),c=r(2302),d=n("wks"),u=i.Symbol,l=u&&u.for,h=c?u:u&&u.withoutSetter||a;e.exports=function(e){if(!o(d,e)||!s&&"string"!=typeof d[e]){var t="Symbol."+e;s&&o(u,e)?d[e]=u[e]:d[e]=c&&l?l(t):h(t)}return d[e]}},9812:(e,t,r)=>{var i=r(6887),n=r(7046),o=r(249),a=r(8929),s=r(3489),c=r(9290),d=r(2029),u=r(1887),l=r(3995),h=r(3794),p=r(3091),f=r(4649),_=r(9813),A=r(8780),m=_("toStringTag"),v=Error,E=[].push,g=function(e,t){var r,i=arguments.length>2?arguments[2]:void 0,s=n(S,this);a?r=a(v(),s?o(this):S):d(r=s?this:c(S),m,"Error"),void 0!==t&&d(r,"message",f(t)),A&&d(r,"stack",l(r.stack,1)),h(r,i);var u=[];return p(e,E,{that:u}),d(r,"errors",u),r};a?a(g,v):s(g,v,{name:!0});var S=g.prototype=c(v.prototype,{constructor:u(1,g),message:u(1,""),name:u(1,"AggregateError")});i({global:!0,constructor:!0,arity:2},{AggregateError:g})},7627:(e,t,r)=>{r(9812)},6274:(e,t,r)=>{var i=r(4529),n=r(8479),o=r(2077),a=r(5402),s=r(5988).f,c=r(5105),d=r(3538),u=r(2529),l=r(5746),h="Array Iterator",p=a.set,f=a.getterFor(h);e.exports=c(Array,"Array",function(e,t){p(this,{type:h,target:i(e),index:0,kind:t})},function(){var e=f(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,d(void 0,!0)):d("keys"==r?i:"values"==r?t[i]:[i,t[i]],!1)},"values");var _=o.Arguments=o.Array;if(n("keys"),n("values"),n("entries"),!u&&l&&"values"!==_.name)try{s(_,"name",{value:"values"})}catch(e){}},6450:(e,t,r)=>{var i=r(6887),n=r(5746),o=r(5988).f;i({target:"Object",stat:!0,forced:Object.defineProperty!==o,sham:!n},{defineProperty:o})},5967:()=>{},4560:(e,t,r)=>{var i=r(6887),n=r(8834),o=r(4883),a=r(9520),s=r(2),c=r(3091);i({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=a.f(t),i=r.resolve,d=r.reject,u=s(function(){var r=o(t.resolve),a=[],s=0,d=1;c(e,function(e){var o=s++,c=!1;d++,n(r,t,e).then(function(e){c||(c=!0,a[o]={status:"fulfilled",value:e},--d||i(a))},function(e){c||(c=!0,a[o]={status:"rejected",reason:e},--d||i(a))})}),--d||i(a)});return u.error&&d(u.value),r.promise}})},6890:(e,t,r)=>{var i=r(6887),n=r(8834),o=r(4883),a=r(9520),s=r(2),c=r(3091);i({target:"Promise",stat:!0,forced:r(1542)},{all:function(e){var t=this,r=a.f(t),i=r.resolve,d=r.reject,u=s(function(){var r=o(t.resolve),a=[],s=0,u=1;c(e,function(e){var o=s++,c=!1;u++,n(r,t,e).then(function(e){c||(c=!0,a[o]=e,--u||i(a))},d)}),--u||i(a)});return u.error&&d(u.value),r.promise}})},7206:(e,t,r)=>{var i=r(6887),n=r(8834),o=r(4883),a=r(626),s=r(9520),c=r(2),d=r(3091),u="No one promise resolved";i({target:"Promise",stat:!0},{any:function(e){var t=this,r=a("AggregateError"),i=s.f(t),l=i.resolve,h=i.reject,p=c(function(){var i=o(t.resolve),a=[],s=0,c=1,p=!1;d(e,function(e){var o=s++,d=!1;c++,n(i,t,e).then(function(e){d||p||(p=!0,l(e))},function(e){d||p||(d=!0,a[o]=e,--c||h(new r(a,u)))})}),--c||h(new r(a,u))});return p.error&&h(p.value),i.promise}})},3376:(e,t,r)=>{var i=r(6887),n=r(2529),o=r(7742).CONSTRUCTOR,a=r(6991),s=r(626),c=r(7475),d=r(5929),u=a&&a.prototype;if(i({target:"Promise",proto:!0,forced:o,real:!0},{catch:function(e){return this.then(void 0,e)}}),!n&&c(a)){var l=s("Promise").prototype.catch;u.catch!==l&&d(u,"catch",l,{unsafe:!0})}},6934:(e,t,r)=>{var i,n,o,a=r(6887),s=r(2529),c=r(6049),d=r(1899),u=r(8834),l=r(5929),h=r(8929),p=r(904),f=r(4431),_=r(4883),A=r(7475),m=r(941),v=r(5743),E=r(487),g=r(2941).set,S=r(6132),b=r(4845),T=r(2),y=r(8397),R=r(5402),I=r(6991),C=r(7742),k=r(9520),w="Promise",O=C.CONSTRUCTOR,N=C.REJECTION_EVENT,P=C.SUBCLASSING,D=R.getterFor(w),L=R.set,M=I&&I.prototype,x=I,U=M,B=d.TypeError,V=d.document,F=d.process,j=k.f,G=j,W=!!(V&&V.createEvent&&d.dispatchEvent),H="unhandledrejection",Y=function(e){var t;return!(!m(e)||!A(t=e.then))&&t},K=function(e,t){var r,i,n,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,d=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&q(t),t.rejection=1),!0===s?r=o:(l&&l.enter(),r=s(o),l&&(l.exit(),n=!0)),r===e.promise?d(B("Promise-chain cycle")):(i=Y(r))?u(i,r,c,d):c(r)):d(o)}catch(e){l&&!n&&l.exit(),d(e)}},Q=function(e,t){e.notified||(e.notified=!0,S(function(){for(var r,i=e.reactions;r=i.get();)K(r,e);e.notified=!1,t&&!e.rejection&&X(e)}))},z=function(e,t,r){var i,n;W?((i=V.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),d.dispatchEvent(i)):i={promise:t,reason:r},!N&&(n=d["on"+e])?n(i):e===H&&b("Unhandled promise rejection",r)},X=function(e){u(g,d,function(){var t,r=e.facade,i=e.value;if(J(e)&&(t=T(function(){c?F.emit("unhandledRejection",i,r):z(H,r,i)}),e.rejection=c||J(e)?2:1,t.error))throw t.value})},J=function(e){return 1!==e.rejection&&!e.parent},q=function(e){u(g,d,function(){var t=e.facade;c?F.emit("rejectionHandled",t):z("rejectionhandled",t,e.value)})},Z=function(e,t,r){return function(i){e(t,i,r)}},$=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Q(e,!0))},ee=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw B("Promise can't be resolved itself");var i=Y(t);i?S(function(){var r={done:!1};try{u(i,t,Z(ee,r,e),Z($,r,e))}catch(t){$(r,t,e)}}):(e.value=t,e.state=1,Q(e,!1))}catch(t){$({done:!1},t,e)}}};if(O&&(U=(x=function(e){v(this,U),_(e),u(i,this);var t=D(this);try{e(Z(ee,t),Z($,t))}catch(e){$(t,e)}}).prototype,(i=function(e){L(this,{type:w,done:!1,notified:!1,parent:!1,reactions:new y,rejection:!1,state:0,value:void 0})}).prototype=l(U,"then",function(e,t){var r=D(this),i=j(E(this,x));return r.parent=!0,i.ok=!A(e)||e,i.fail=A(t)&&t,i.domain=c?F.domain:void 0,0==r.state?r.reactions.add(i):S(function(){K(i,r)}),i.promise}),n=function(){var e=new i,t=D(e);this.promise=e,this.resolve=Z(ee,t),this.reject=Z($,t)},k.f=j=function(e){return e===x||void 0===e?new n(e):G(e)},!s&&A(I)&&M!==Object.prototype)){o=M.then,P||l(M,"then",function(e,t){var r=this;return new x(function(e,t){u(o,r,e,t)}).then(e,t)},{unsafe:!0});try{delete M.constructor}catch(e){}h&&h(M,U)}a({global:!0,constructor:!0,wrap:!0,forced:O},{Promise:x}),p(x,w,!1,!0),f(w)},4349:(e,t,r)=>{var i=r(6887),n=r(2529),o=r(6991),a=r(5981),s=r(626),c=r(7475),d=r(487),u=r(6584),l=r(5929),h=o&&o.prototype;if(i({target:"Promise",proto:!0,real:!0,forced:!!o&&a(function(){h.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=d(this,s("Promise")),r=c(e);return this.then(r?function(r){return u(t,e()).then(function(){return r})}:e,r?function(r){return u(t,e()).then(function(){throw r})}:e)}}),!n&&c(o)){var p=s("Promise").prototype.finally;h.finally!==p&&l(h,"finally",p,{unsafe:!0})}},8881:(e,t,r)=>{r(6934),r(6890),r(3376),r(5921),r(4069),r(4482)},5921:(e,t,r)=>{var i=r(6887),n=r(8834),o=r(4883),a=r(9520),s=r(2),c=r(3091);i({target:"Promise",stat:!0,forced:r(1542)},{race:function(e){var t=this,r=a.f(t),i=r.reject,d=s(function(){var a=o(t.resolve);c(e,function(e){n(a,t,e).then(r.resolve,i)})});return d.error&&i(d.value),r.promise}})},4069:(e,t,r)=>{var i=r(6887),n=r(8834),o=r(9520);i({target:"Promise",stat:!0,forced:r(7742).CONSTRUCTOR},{reject:function(e){var t=o.f(this);return n(t.reject,void 0,e),t.promise}})},4482:(e,t,r)=>{var i=r(6887),n=r(626),o=r(2529),a=r(6991),s=r(7742).CONSTRUCTOR,c=r(6584),d=n("Promise"),u=o&&!s;i({target:"Promise",stat:!0,forced:o||s},{resolve:function(e){return c(u&&this===d?a:this,e)}})},7971:(e,t,r)=>{var i=r(4620).charAt,n=r(5803),o=r(5402),a=r(5105),s=r(3538),c="String Iterator",d=o.set,u=o.getterFor(c);a(String,"String",function(e){d(this,{type:c,string:n(e),index:0})},function(){var e,t=u(this),r=t.string,n=t.index;return n>=r.length?s(void 0,!0):(e=i(r,n),t.index+=e.length,s(e,!1))})},7634:(e,t,r)=>{r(6274);var i=r(3281),n=r(1899),o=r(9697),a=r(2029),s=r(2077),c=r(9813)("toStringTag");for(var d in i){var u=n[d],l=u&&u.prototype;l&&o(l)!==c&&a(l,c,d),s[d]=s.Array}},1910:(e,t,r)=>{var i=r(8171);e.exports=i},7460:(e,t,r)=>{var i=r(2956);r(7634),e.exports=i},9662:(e,t,r)=>{var i=r(614),n=r(6330),o=TypeError;e.exports=function(e){if(i(e))return e;throw o(n(e)+" is not a function")}},6077:(e,t,r)=>{var i=r(614),n=String,o=TypeError;e.exports=function(e){if("object"==typeof e||i(e))return e;throw o("Can't set "+n(e)+" as a prototype")}},1223:(e,t,r)=>{var i=r(5112),n=r(30),o=r(3070).f,a=i("unscopables"),s=Array.prototype;null==s[a]&&o(s,a,{configurable:!0,value:n(null)}),e.exports=function(e){s[a][e]=!0}},9670:(e,t,r)=>{var i=r(111),n=String,o=TypeError;e.exports=function(e){if(i(e))return e;throw o(n(e)+" is not an object")}},1318:(e,t,r)=>{var i=r(5656),n=r(1400),o=r(6244),a=function(e){return function(t,r,a){var s,c=i(t),d=o(c),u=n(a,d);if(e&&r!=r){for(;d>u;)if((s=c[u++])!=s)return!0}else for(;d>u;u++)if((e||u in c)&&c[u]===r)return e||u||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},4326:(e,t,r)=>{var i=r(84),n=i({}.toString),o=i("".slice);e.exports=function(e){return o(n(e),8,-1)}},648:(e,t,r)=>{var i=r(1694),n=r(614),o=r(4326),a=r(5112)("toStringTag"),s=Object,c="Arguments"==o(function(){return arguments}());e.exports=i?o:function(e){var t,r,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?r:c?o(t):"Object"==(i=o(t))&&n(t.callee)?"Arguments":i}},9920:(e,t,r)=>{var i=r(2597),n=r(3887),o=r(1236),a=r(3070);e.exports=function(e,t,r){for(var s=n(t),c=a.f,d=o.f,u=0;u<s.length;u++){var l=s[u];i(e,l)||r&&i(r,l)||c(e,l,d(t,l))}}},8544:(e,t,r)=>{var i=r(7293);e.exports=!i(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},6178:e=>{e.exports=function(e,t){return{value:e,done:t}}},8880:(e,t,r)=>{var i=r(9781),n=r(3070),o=r(9114);e.exports=i?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},9114:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},8052:(e,t,r)=>{var i=r(614),n=r(3070),o=r(6339),a=r(3072);e.exports=function(e,t,r,s){s||(s={});var c=s.enumerable,d=void 0!==s.name?s.name:t;if(i(r)&&o(r,d,s),s.global)c?e[t]=r:a(t,r);else{try{s.unsafe?e[t]&&(c=!0):delete e[t]}catch(e){}c?e[t]=r:n.f(e,t,{value:r,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return e}},3072:(e,t,r)=>{var i=r(7854),n=Object.defineProperty;e.exports=function(e,t){try{n(i,e,{value:t,configurable:!0,writable:!0})}catch(r){i[e]=t}return t}},9781:(e,t,r)=>{var i=r(7293);e.exports=!i(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},4154:e=>{var t="object"==typeof document&&document.all;e.exports={all:t,IS_HTMLDDA:void 0===t&&void 0!==t}},317:(e,t,r)=>{var i=r(7854),n=r(111),o=i.document,a=n(o)&&n(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},8324:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:(e,t,r)=>{var i=r(317)("span").classList,n=i&&i.constructor&&i.constructor.prototype;e.exports=n===Object.prototype?void 0:n},8113:(e,t,r)=>{var i=r(5005);e.exports=i("navigator","userAgent")||""},7392:(e,t,r)=>{var i,n,o=r(7854),a=r(8113),s=o.process,c=o.Deno,d=s&&s.versions||c&&c.version,u=d&&d.v8;u&&(n=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!n&&a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(n=+i[1]),e.exports=n},748:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},1060:(e,t,r)=>{var i=r(1702),n=Error,o=i("".replace),a=String(n("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,c=s.test(a);e.exports=function(e,t){if(c&&"string"==typeof e&&!n.prepareStackTrace)for(;t--;)e=o(e,s,"");return e}},2914:(e,t,r)=>{var i=r(7293),n=r(9114);e.exports=!i(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",n(1,7)),7!==e.stack)})},2109:(e,t,r)=>{var i=r(7854),n=r(1236).f,o=r(8880),a=r(8052),s=r(3072),c=r(9920),d=r(4705);e.exports=function(e,t){var r,u,l,h,p,f=e.target,_=e.global,A=e.stat;if(r=_?i:A?i[f]||s(f,{}):(i[f]||{}).prototype)for(u in t){if(h=t[u],l=e.dontCallGetSet?(p=n(r,u))&&p.value:r[u],!d(_?u:f+(A?".":"#")+u,e.forced)&&void 0!==l){if(typeof h==typeof l)continue;c(h,l)}(e.sham||l&&l.sham)&&o(h,"sham",!0),a(r,u,h,e)}}},7293:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},2104:(e,t,r)=>{var i=r(4374),n=Function.prototype,o=n.apply,a=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(i?a.bind(o):function(){return a.apply(o,arguments)})},4374:(e,t,r)=>{var i=r(7293);e.exports=!i(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},6916:(e,t,r)=>{var i=r(4374),n=Function.prototype.call;e.exports=i?n.bind(n):function(){return n.apply(n,arguments)}},6530:(e,t,r)=>{var i=r(9781),n=r(2597),o=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,s=n(o,"name"),c=s&&(!i||i&&a(o,"name").configurable);e.exports={EXISTS:s,PROPER:s&&"something"===(function(){}).name,CONFIGURABLE:c}},84:(e,t,r)=>{var i=r(4374),n=Function.prototype,o=n.call,a=i&&n.bind.bind(o,o);e.exports=i?a:function(e){return function(){return o.apply(e,arguments)}}},1702:(e,t,r)=>{var i=r(4326),n=r(84);e.exports=function(e){if("Function"===i(e))return n(e)}},5005:(e,t,r)=>{var i=r(7854),n=r(614);e.exports=function(e,t){var r;return arguments.length<2?n(r=i[e])?r:void 0:i[e]&&i[e][t]}},8173:(e,t,r)=>{var i=r(9662),n=r(8554);e.exports=function(e,t){var r=e[t];return n(r)?void 0:i(r)}},7854:(e,t,r)=>{var i=function(e){return e&&e.Math==Math&&e};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},2597:(e,t,r)=>{var i=r(1702),n=r(7908),o=i({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(n(e),t)}},3501:e=>{e.exports={}},490:(e,t,r)=>{var i=r(5005);e.exports=i("document","documentElement")},4664:(e,t,r)=>{var i=r(9781),n=r(7293),o=r(317);e.exports=!i&&!n(function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},8361:(e,t,r)=>{var i=r(1702),n=r(7293),o=r(4326),a=Object,s=i("".split);e.exports=n(function(){return!a("z").propertyIsEnumerable(0)})?function(e){return"String"==o(e)?s(e,""):a(e)}:a},9587:(e,t,r)=>{var i=r(614),n=r(111),o=r(7674);e.exports=function(e,t,r){var a,s;return o&&i(a=t.constructor)&&a!==r&&n(s=a.prototype)&&s!==r.prototype&&o(e,s),e}},2788:(e,t,r)=>{var i=r(1702),n=r(614),o=r(5465),a=i(Function.toString);n(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},8340:(e,t,r)=>{var i=r(111),n=r(8880);e.exports=function(e,t){i(t)&&"cause"in t&&n(e,"cause",t.cause)}},9909:(e,t,r)=>{var i,n,o,a=r(4811),s=r(7854),c=r(111),d=r(8880),u=r(2597),l=r(5465),h=r(6200),p=r(3501),f="Object already initialized",_=s.TypeError,A=s.WeakMap;if(a||l.state){var m=l.state||(l.state=new A);m.get=m.get,m.has=m.has,m.set=m.set,i=function(e,t){if(m.has(e))throw _(f);return t.facade=e,m.set(e,t),t},n=function(e){return m.get(e)||{}},o=function(e){return m.has(e)}}else{var v=h("state");p[v]=!0,i=function(e,t){if(u(e,v))throw _(f);return t.facade=e,d(e,v,t),t},n=function(e){return u(e,v)?e[v]:{}},o=function(e){return u(e,v)}}e.exports={set:i,get:n,has:o,enforce:function(e){return o(e)?n(e):i(e,{})},getterFor:function(e){return function(t){var r;if(!c(t)||(r=n(t)).type!==e)throw _("Incompatible receiver, "+e+" required");return r}}}},614:(e,t,r)=>{var i=r(4154),n=i.all;e.exports=i.IS_HTMLDDA?function(e){return"function"==typeof e||e===n}:function(e){return"function"==typeof e}},4705:(e,t,r)=>{var i=r(7293),n=r(614),o=/#|\.prototype\./,a=function(e,t){var r=c[s(e)];return r==u||r!=d&&(n(t)?i(t):!!t)},s=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},c=a.data={},d=a.NATIVE="N",u=a.POLYFILL="P";e.exports=a},8554:e=>{e.exports=function(e){return null==e}},111:(e,t,r)=>{var i=r(614),n=r(4154),o=n.all;e.exports=n.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:i(e)||e===o}:function(e){return"object"==typeof e?null!==e:i(e)}},1913:e=>{e.exports=!1},2190:(e,t,r)=>{var i=r(5005),n=r(614),o=r(7976),a=r(3307),s=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return n(t)&&o(t.prototype,s(e))}},3061:(e,t,r)=>{var i=r(3383).IteratorPrototype,n=r(30),o=r(9114),a=r(8003),s=r(7497),c=function(){return this};e.exports=function(e,t,r,d){var u=t+" Iterator";return e.prototype=n(i,{next:o(+!d,r)}),a(e,u,!1,!0),s[u]=c,e}},1656:(e,t,r)=>{var i=r(2109),n=r(6916),o=r(1913),a=r(6530),s=r(614),c=r(3061),d=r(9518),u=r(7674),l=r(8003),h=r(8880),p=r(8052),f=r(5112),_=r(7497),A=r(3383),m=a.PROPER,v=a.CONFIGURABLE,E=A.IteratorPrototype,g=A.BUGGY_SAFARI_ITERATORS,S=f("iterator"),b="keys",T="values",y="entries",R=function(){return this};e.exports=function(e,t,r,a,f,A,I){c(r,t,a);var C,k,w,O=function(e){if(e===f&&M)return M;if(!g&&e in D)return D[e];switch(e){case b:case T:case y:return function(){return new r(this,e)}}return function(){return new r(this)}},N=t+" Iterator",P=!1,D=e.prototype,L=D[S]||D["@@iterator"]||f&&D[f],M=!g&&L||O(f),x="Array"==t&&D.entries||L;if(x&&(C=d(x.call(new e)))!==Object.prototype&&C.next&&(o||d(C)===E||(u?u(C,E):s(C[S])||p(C,S,R)),l(C,N,!0,!0),o&&(_[N]=R)),m&&f==T&&L&&L.name!==T&&(!o&&v?h(D,"name",T):(P=!0,M=function(){return n(L,this)})),f){if(k={values:O(T),keys:A?M:O(b),entries:O(y)},I)for(w in k)!g&&!P&&w in D||p(D,w,k[w]);else i({target:t,proto:!0,forced:g||P},k)}return o&&!I||D[S]===M||p(D,S,M,{name:f}),_[t]=M,k}},3383:(e,t,r)=>{var i,n,o,a=r(7293),s=r(614),c=r(111),d=r(30),u=r(9518),l=r(8052),h=r(5112),p=r(1913),f=h("iterator"),_=!1;[].keys&&("next"in(o=[].keys())?(n=u(u(o)))!==Object.prototype&&(i=n):_=!0),!c(i)||a(function(){var e={};return i[f].call(e)!==e})?i={}:p&&(i=d(i)),s(i[f])||l(i,f,function(){return this}),e.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:_}},7497:e=>{e.exports={}},6244:(e,t,r)=>{var i=r(7466);e.exports=function(e){return i(e.length)}},6339:(e,t,r)=>{var i=r(7293),n=r(614),o=r(2597),a=r(9781),s=r(6530).CONFIGURABLE,c=r(2788),d=r(9909),u=d.enforce,l=d.get,h=Object.defineProperty,p=a&&!i(function(){return 8!==h(function(){},"length",{value:8}).length}),f=String(String).split("String"),_=e.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!o(e,"name")||s&&e.name!==t)&&(a?h(e,"name",{value:t,configurable:!0}):e.name=t),p&&r&&o(r,"arity")&&e.length!==r.arity&&h(e,"length",{value:r.arity});try{r&&o(r,"constructor")&&r.constructor?a&&h(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var i=u(e);return o(i,"source")||(i.source=f.join("string"==typeof t?t:"")),e};Function.prototype.toString=_(function(){return n(this)&&l(this).source||c(this)},"toString")},4758:e=>{var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var i=+e;return(i>0?r:t)(i)}},6277:(e,t,r)=>{var i=r(1340);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:i(e)}},30:(e,t,r)=>{var i,n=r(9670),o=r(6048),a=r(748),s=r(3501),c=r(490),d=r(317),u=r(6200)("IE_PROTO"),l=function(){},h=function(e){return"<script>"+e+"<\/script>"},p=function(e){e.write(h("")),e.close();var t=e.parentWindow.Object;return e=null,t},f=function(){try{i=new ActiveXObject("htmlfile")}catch(e){}f="undefined"!=typeof document?document.domain&&i?p(i):((t=d("iframe")).style.display="none",c.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(h("document.F=Object")),e.close(),e.F):p(i);for(var e,t,r=a.length;r--;)delete f.prototype[a[r]];return f()};s[u]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(l.prototype=n(e),r=new l,l.prototype=null,r[u]=e):r=f(),void 0===t?r:o.f(r,t)}},6048:(e,t,r)=>{var i=r(9781),n=r(3353),o=r(3070),a=r(9670),s=r(5656),c=r(1956);t.f=i&&!n?Object.defineProperties:function(e,t){a(e);for(var r,i=s(t),n=c(t),d=n.length,u=0;d>u;)o.f(e,r=n[u++],i[r]);return e}},3070:(e,t,r)=>{var i=r(9781),n=r(4664),o=r(3353),a=r(9670),s=r(4948),c=TypeError,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor;t.f=i?o?function(e,t,r){if(a(e),t=s(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&"writable"in r&&!r.writable){var i=u(e,t);i&&i.writable&&(e[t]=r.value,r={configurable:"configurable"in r?r.configurable:i.configurable,enumerable:"enumerable"in r?r.enumerable:i.enumerable,writable:!1})}return d(e,t,r)}:d:function(e,t,r){if(a(e),t=s(t),a(r),n)try{return d(e,t,r)}catch(e){}if("get"in r||"set"in r)throw c("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},1236:(e,t,r)=>{var i=r(9781),n=r(6916),o=r(5296),a=r(9114),s=r(5656),c=r(4948),d=r(2597),u=r(4664),l=Object.getOwnPropertyDescriptor;t.f=i?l:function(e,t){if(e=s(e),t=c(t),u)try{return l(e,t)}catch(e){}if(d(e,t))return a(!n(o.f,e,t),e[t])}},8006:(e,t,r)=>{var i=r(6324),n=r(748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,n)}},5181:(e,t)=>{t.f=Object.getOwnPropertySymbols},9518:(e,t,r)=>{var i=r(2597),n=r(614),o=r(7908),a=r(6200),s=r(8544),c=a("IE_PROTO"),d=Object,u=d.prototype;e.exports=s?d.getPrototypeOf:function(e){var t=o(e);if(i(t,c))return t[c];var r=t.constructor;return n(r)&&t instanceof r?r.prototype:t instanceof d?u:null}},7976:(e,t,r)=>{var i=r(1702);e.exports=i({}.isPrototypeOf)},6324:(e,t,r)=>{var i=r(1702),n=r(2597),o=r(5656),a=r(1318).indexOf,s=r(3501),c=i([].push);e.exports=function(e,t){var r,i=o(e),d=0,u=[];for(r in i)!n(s,r)&&n(i,r)&&c(u,r);for(;t.length>d;)n(i,r=t[d++])&&(~a(u,r)||c(u,r));return u}},1956:(e,t,r)=>{var i=r(6324),n=r(748);e.exports=Object.keys||function(e){return i(e,n)}},5296:(e,t)=>{var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,n=i&&!r.call({1:2},1);t.f=n?function(e){var t=i(this,e);return!!t&&t.enumerable}:r},7674:(e,t,r)=>{var i=r(1702),n=r(9670),o=r(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=i(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,i){return n(r),o(i),t?e(r,i):r.__proto__=i,r}}():void 0)},2140:(e,t,r)=>{var i=r(6916),n=r(614),o=r(111),a=TypeError;e.exports=function(e,t){var r,s;if("string"===t&&n(r=e.toString)&&!o(s=i(r,e))||n(r=e.valueOf)&&!o(s=i(r,e))||"string"!==t&&n(r=e.toString)&&!o(s=i(r,e)))return s;throw a("Can't convert object to primitive value")}},3887:(e,t,r)=>{var i=r(5005),n=r(1702),o=r(8006),a=r(5181),s=r(9670),c=n([].concat);e.exports=i("Reflect","ownKeys")||function(e){var t=o.f(s(e)),r=a.f;return r?c(t,r(e)):t}},2626:(e,t,r)=>{var i=r(3070).f;e.exports=function(e,t,r){r in e||i(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},4488:(e,t,r)=>{var i=r(8554),n=TypeError;e.exports=function(e){if(i(e))throw n("Can't call method on "+e);return e}},8003:(e,t,r)=>{var i=r(3070).f,n=r(2597),o=r(5112)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!n(e,o)&&i(e,o,{configurable:!0,value:t})}},6200:(e,t,r)=>{var i=r(2309),n=r(9711),o=i("keys");e.exports=function(e){return o[e]||(o[e]=n(e))}},5465:(e,t,r)=>{var i=r(7854),n=r(3072),o="__core-js_shared__",a=i[o]||n(o,{});e.exports=a},2309:(e,t,r)=>{var i=r(1913),n=r(5465);(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.0",mode:i?"pure":"global",copyright:"\xa9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"})},6293:(e,t,r)=>{var i=r(7392),n=r(7293);e.exports=!!Object.getOwnPropertySymbols&&!n(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41})},1400:(e,t,r)=>{var i=r(9303),n=Math.max,o=Math.min;e.exports=function(e,t){var r=i(e);return r<0?n(r+t,0):o(r,t)}},5656:(e,t,r)=>{var i=r(8361),n=r(4488);e.exports=function(e){return i(n(e))}},9303:(e,t,r)=>{var i=r(4758);e.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}},7466:(e,t,r)=>{var i=r(9303),n=Math.min;e.exports=function(e){return e>0?n(i(e),0x1fffffffffffff):0}},7908:(e,t,r)=>{var i=r(4488),n=Object;e.exports=function(e){return n(i(e))}},7593:(e,t,r)=>{var i=r(6916),n=r(111),o=r(2190),a=r(8173),s=r(2140),c=r(5112),d=TypeError,u=c("toPrimitive");e.exports=function(e,t){if(!n(e)||o(e))return e;var r,c=a(e,u);if(c){if(void 0===t&&(t="default"),!n(r=i(c,e,t))||o(r))return r;throw d("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},4948:(e,t,r)=>{var i=r(7593),n=r(2190);e.exports=function(e){var t=i(e,"string");return n(t)?t:t+""}},1694:(e,t,r)=>{var i={};i[r(5112)("toStringTag")]="z",e.exports="[object z]"===String(i)},1340:(e,t,r)=>{var i=r(648),n=String;e.exports=function(e){if("Symbol"===i(e))throw TypeError("Cannot convert a Symbol value to a string");return n(e)}},6330:e=>{var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},9711:(e,t,r)=>{var i=r(1702),n=0,o=Math.random(),a=i(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++n+o,36)}},3307:(e,t,r)=>{var i=r(6293);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:(e,t,r)=>{var i=r(9781),n=r(7293);e.exports=i&&n(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},4811:(e,t,r)=>{var i=r(7854),n=r(614),o=i.WeakMap;e.exports=n(o)&&/native code/.test(String(o))},5112:(e,t,r)=>{var i=r(7854),n=r(2309),o=r(2597),a=r(9711),s=r(6293),c=r(3307),d=n("wks"),u=i.Symbol,l=u&&u.for,h=c?u:u&&u.withoutSetter||a;e.exports=function(e){if(!o(d,e)||!s&&"string"!=typeof d[e]){var t="Symbol."+e;s&&o(u,e)?d[e]=u[e]:d[e]=c&&l?l(t):h(t)}return d[e]}},9191:(e,t,r)=>{var i=r(5005),n=r(2597),o=r(8880),a=r(7976),s=r(7674),c=r(9920),d=r(2626),u=r(9587),l=r(6277),h=r(8340),p=r(1060),f=r(2914),_=r(9781),A=r(1913);e.exports=function(e,t,r,m){var v="stackTraceLimit",E=m?2:1,g=e.split("."),S=g[g.length-1],b=i.apply(null,g);if(b){var T=b.prototype;if(!A&&n(T,"cause")&&delete T.cause,!r)return b;var y=i("Error"),R=t(function(e,t){var r=l(m?t:e,void 0),i=m?new b(e):new b;return void 0!==r&&o(i,"message",r),f&&o(i,"stack",p(i.stack,2)),this&&a(T,this)&&u(i,this,R),arguments.length>E&&h(i,arguments[E]),i});if(R.prototype=T,"Error"!==S?s?s(R,y):c(R,y,{name:!0}):_&&v in b&&(d(R,b,v),d(R,b,"prepareStackTrace")),c(R,b),!A)try{T.name!==S&&o(T,"name",S),T.constructor=R}catch(e){}return R}}},6992:(e,t,r)=>{var i=r(5656),n=r(1223),o=r(7497),a=r(9909),s=r(3070).f,c=r(1656),d=r(6178),u=r(1913),l=r(9781),h="Array Iterator",p=a.set,f=a.getterFor(h);e.exports=c(Array,"Array",function(e,t){p(this,{type:h,target:i(e),index:0,kind:t})},function(){var e=f(this),t=e.target,r=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,d(void 0,!0)):d("keys"==r?i:"values"==r?t[i]:[i,t[i]],!1)},"values");var _=o.Arguments=o.Array;if(n("keys"),n("values"),n("entries"),!u&&l&&"values"!==_.name)try{s(_,"name",{value:"values"})}catch(e){}},1703:(e,t,r)=>{var i=r(2109),n=r(7854),o=r(2104),a=r(9191),s=n.WebAssembly,c=7!==Error("e",{cause:7}).cause,d=function(e,t){var r={};r[e]=a(e,t,c),i({global:!0,constructor:!0,arity:1,forced:c},r)},u=function(e,t){if(s&&s[e]){var r={};r[e]=a("WebAssembly."+e,t,c),i({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:c},r)}};d("Error",function(e){return function(t){return o(e,this,arguments)}}),d("EvalError",function(e){return function(t){return o(e,this,arguments)}}),d("RangeError",function(e){return function(t){return o(e,this,arguments)}}),d("ReferenceError",function(e){return function(t){return o(e,this,arguments)}}),d("SyntaxError",function(e){return function(t){return o(e,this,arguments)}}),d("TypeError",function(e){return function(t){return o(e,this,arguments)}}),d("URIError",function(e){return function(t){return o(e,this,arguments)}}),u("CompileError",function(e){return function(t){return o(e,this,arguments)}}),u("LinkError",function(e){return function(t){return o(e,this,arguments)}}),u("RuntimeError",function(e){return function(t){return o(e,this,arguments)}})},3948:(e,t,r)=>{var i=r(7854),n=r(8324),o=r(8509),a=r(6992),s=r(8880),c=r(5112),d=c("iterator"),u=c("toStringTag"),l=a.values,h=function(e,t){if(e){if(e[d]!==l)try{s(e,d,l)}catch(t){e[d]=l}if(e[u]||s(e,u,t),n[t]){for(var r in a)if(e[r]!==a[r])try{s(e,r,a[r])}catch(t){e[r]=a[r]}}}};for(var p in n)h(i[p]&&i[p].prototype,p);h(o,"DOMTokenList")},6226:(e,t,r)=>{e.exports=r(7460)},7445:(e,t,r)=>{e.exports=r(3685)}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{let e;r.r(i),r.d(i,{AudioExtension:()=>S,AudioProcessor:()=>E,Extension:()=>g,PromiseMutex:()=>y,Ticker:()=>b,VideoProcessor:()=>v,logger:()=>l,reporter:()=>f});var t=r(7445);function n(e,r,i){return r in e?t(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}r(1703),r(6992),r(3948);var o=r(6226),a=r.n(o);let s=Date.now(),c={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4};function d(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let u=e=>{for(let t in c)if(Object.prototype.hasOwnProperty.call(c,t)&&c[t]===e)return t;return"DEFAULT"},l=new class{constructor(){n(this,"logLevel",c.DEBUG),n(this,"hookLog",void 0)}debug(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[c.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[c.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[c.WARNING].concat(t);this.log.apply(this,i)}error(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[c.ERROR].concat(t);this.log.apply(this,i)}log(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];if(Date.now()-s<100)return void setTimeout(()=>{this.log(...r)},Date.now()-s);let n=Math.max(0,Math.min(4,r[0]));if(r[0]=d()+" Agora-Extension [".concat(u(n),"]:"),n<this.logLevel)return;let o=d()+" %cAgora-Extension [".concat(u(n),"]:"),a=[];switch(n){case c.DEBUG:a=[o,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,a);break;case c.INFO:a=[o,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,a);break;case c.WARNING:a=[o,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,a);break;case c.ERROR:a=[o,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,a)}null===(e=this.hookLog)||void 0===e||e.call(this,n,a)}};function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let f=new class{constructor(){n(this,"apiInvokeMsgQueue",[]),n(this,"hookApiInvoke",void 0)}reportApiInvoke(e){var t;e.timeout=e.timeout||6e4,e.reportResult=void 0===e.reportResult||e.reportResult;let r=Date.now(),i=()=>({name:e.name,apiInvokeTime:r,options:e.options}),n=!1;(t=e.timeout,new(a())(e=>{window.setTimeout(e,t)})).then(()=>{n||(this.sendApiInvoke(p(p({},i()),{},{error:"API_INVOKE_TIMEOUT",success:!1})),l.debug("".concat(e.name," timeout")))});let o=Error("".concat(e.name,": this api invoke is end"));return{onSuccess:t=>{if(n)throw o;n=!0,this.sendApiInvoke(p(p({},i()),{},{success:!0},e.reportResult&&{result:t}))},onError:e=>{if(n)throw e;n=!0,this.sendApiInvoke(p(p({},i()),{},{success:!1,error:e.toString()}))}}}sendApiInvoke(e){this.hookApiInvoke?(this.hookApiInvoke([...this.apiInvokeMsgQueue,e]),this.apiInvokeMsgQueue=[]):this.apiInvokeMsgQueue.push(e)}};function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class m extends class{constructor(){n(this,"_events",{}),n(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],i=this._indexOfListener(r,t);-1!==i&&r.splice(i,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(e=>e);for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(let r=0;r<t.length;r+=1){let n=t[r];n.once&&this.off(e,n.listener),n.listener.apply(this,i||[])}}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return -1}emitAsPromise(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return 0===this.getListeners(e).length?a().reject(Error("No promise event handler.")):new(a())((t,i)=>{this.emit(e,...r,t,i)})}emitAsPromiseNoResponse(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return 0===this.getListeners(e).length?a().resolve():new(a())((t,i)=>{this.emit(e,...r,t,i)})}}{get enabled(){return this._enabled}output(e,t){if(this.outputTrack===e)return;let r=f.reportApiInvoke({name:"".concat(this.name,".output"),options:{track:null==e?void 0:e.toString()}});this.outputTrack=e,this.destination&&this.destination.updateInput({track:e,context:t}),r.onSuccess()}constructor(){super(),n(this,"inputTrack",void 0),n(this,"outputTrack",void 0),n(this,"_enabled",!0),n(this,"_source",void 0),n(this,"ID",function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,t).toLowerCase();return i.length===t?"".concat(r).concat(i):"".concat(r).concat(i)+e(t-i.length,"")}(6,"")),n(this,"destination",void 0),n(this,"context",void 0),n(this,"name",void 0)}enable(){if(this._enabled)return;let e=f.reportApiInvoke({name:"".concat(this.name,".enable"),options:!0});l.info("".concat(this.name,"-").concat(this.ID," enabled")),this._enabled=!0;try{var t;let r=null===(t=this.onEnableChange)||void 0===t?void 0:t.call(this,this._enabled);if(r instanceof a())return r.then(()=>{e.onSuccess()}).catch(t=>{throw e.onError(t),t});e.onSuccess()}catch(t){throw e.onError(t),t}}disable(){if(!this._enabled)return;let e=f.reportApiInvoke({name:"".concat(this.name,".enable"),options:!1});l.info("".concat(this.name,"-").concat(this.ID," disabled")),this._enabled=!1;try{var t;let r=null===(t=this.onEnableChange)||void 0===t?void 0:t.call(this,this._enabled);if(r instanceof a())return r.then(()=>{e.onSuccess()}).catch(t=>{throw e.onError(t),t});e.onSuccess()}catch(t){throw e.onError(t),t}}}class v extends m{get kind(){return"video"}pipe(e){let t=f.reportApiInvoke({name:"".concat(this.name,".pipe"),options:{processor:e.name}});if(this.destination===e)return t.onSuccess(),e;if(e._source){let r=Error("Processor ".concat(e.name," already being piped, please call ").concat(e._source.name,".unpipe() beforehand."));throw t.onError(r),r}return this.destination&&this.unpipe(),this.destination=e,e._source=this,this.context&&this.destination.updateInput({track:this.outputTrack,context:this.context}),t.onSuccess(),e}unpipe(){if(!this.destination)return;let e=f.reportApiInvoke({name:"".concat(this.name,".unpipe"),options:{processor:this.destination.name}});l.info("unpiping processor ".concat(this.destination.name,"-").concat(this.destination.ID));try{let e=this.destination;this.destination._source=void 0,this.destination=void 0,e.reset()}finally{e.onSuccess()}}updateInput(e){var t,r;e.context!==this.context&&(this.context=e.context,null===(t=this.onPiped)||void 0===t||t.call(this,this.context),this.destination&&this.destination.updateInput({track:this.outputTrack,context:e.context})),e.track&&this.inputTrack!==e.track&&(this.inputTrack=e.track,null===(r=this.onTrack)||void 0===r||r.call(this,e.track,this.context))}reset(){var e;this.context&&this.context.requestRevertConstraints(this),this.inputTrack=void 0,this.context=void 0,null===(e=this.onUnpiped)||void 0===e||e.call(this),this.destination&&this.destination.reset()}}class E extends m{constructor(){super(...arguments),n(this,"inputNode",void 0),n(this,"outputNode",void 0),n(this,"destination",void 0),n(this,"context",void 0)}get kind(){return"audio"}pipe(e){let t=f.reportApiInvoke({name:"".concat(this.name,".pipe"),options:{processor:e.name}});if(this.destination===e)return t.onSuccess(),e;if(e._source){let r=Error("Processor ".concat(e.name," already being piped, please call ").concat(e._source.name,".unpipe() beforehand."));throw t.onError(r),r}return this.destination&&this.unpipe(),this.destination=e,e._source=this,this.context&&this.destination.updateInput({track:this.outputTrack,node:this.outputNode,context:this.context}),t.onSuccess(),e}unpipe(){if(!this.destination)return;l.info("unpiping processor ".concat(this.destination.name,"-").concat(this.destination.ID));let e=f.reportApiInvoke({name:"".concat(this.name,".unpipe"),options:{processor:this.destination.name}});try{var t;let e=this.destination;null===(t=this.outputNode)||void 0===t||t.disconnect(),this.destination._source=void 0,this.destination=void 0,e.reset()}finally{e.onSuccess()}}output(e,t){if(e instanceof MediaStreamTrack)super.output(e,t);else if(e instanceof AudioNode){if(this.outputNode===e)return;let r=f.reportApiInvoke({name:"".concat(this.name,".output"),options:A(A({},e instanceof MediaStreamTrack&&{track:e.toString()}),e instanceof AudioNode&&{audioNode:e.toString()})});this.outputNode=e,this.destination&&this.destination.updateInput({node:e,context:t}),r.onSuccess()}}updateInput(e){var t,r,i;e.context!==this.context&&(this.context=e.context,null===(t=this.onPiped)||void 0===t||t.call(this,this.context),this.destination&&this.destination.updateInput({track:this.outputTrack,node:this.outputNode,context:e.context})),e.track&&this.inputTrack!==e.track&&(this.inputTrack=e.track,null===(r=this.onTrack)||void 0===r||r.call(this,e.track,this.context)),e.node&&this.inputNode!==e.node&&(this.inputNode=e.node,null===(i=this.onNode)||void 0===i||i.call(this,e.node,this.context))}reset(){var e;this.context&&this.context.requestRevertConstraints(this),this.inputTrack=void 0,this.inputNode=void 0,null===(e=this.onUnpiped)||void 0===e||e.call(this,this.context),this.context=void 0,this.destination&&this.destination.reset()}}class g{constructor(){n(this,"__registered__",!1),n(this,"logger",l),n(this,"reporter",f),n(this,"parameters",{})}createProcessor(){if(!this.__registered__)throw Error("Extension not registered yet!");return this._createProcessor()}}class S extends g{}class b{get running(){return this._running}constructor(e,t){if(n(this,"type",void 0),n(this,"interval",void 0),n(this,"fn",void 0),n(this,"_running",!1),n(this,"_osc",void 0),!e||t<=0)throw Error();this.type=e,this.interval=t}add(e){this.fn=e}remove(){this.fn=void 0}start(){if(!this._running)switch(this._running=!0,this.type){case"Timer":{let e=()=>{setTimeout(()=>{this.fn&&this.fn(),this._running&&e()},this.interval)};e();break}case"RAF":{let e=t=>{requestAnimationFrame(r=>{r-t<this.interval?this._running&&e(t):(this.fn&&this.fn(),this._running&&e(r))})};e(performance.now());break}case"Oscillator":{let t;e||(e=new AudioContext);let r=e.createGain();r.gain.value=0,r.connect(e.destination);let i=()=>{this.fn&&this.fn(),t&&t.disconnect(),t=e.createOscillator(),this._osc=t,t.connect(r),this._running&&(t.onended=i,t.start(0),t.stop(e.currentTime+this.interval/1e3))};i()}}}stop(){this._running=!1,this._osc&&(this._osc.onended=null,this._osc=void 0)}}let T=1;class y{constructor(e){n(this,"lockingPromise",a().resolve()),n(this,"locks",0),n(this,"name",""),n(this,"lockId",void 0),this.lockId=T++,e&&(this.name=e)}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1;let r=new(a())(e=>{t=()=>{this.locks-=1,e()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),i}}})(),i})(),io.exports=ii();let is={ADJUST_3A_FROM_PLUGINS:!0,AI_DENOISER_PARAMETERS:{}},ic={echoCancellation:!0,noiseSuppression:!1,autoGainControl:!0},id={numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[1]},iu={ains:!0,agc:!0,bufferTime:30,dumpBundleNums:3,threshold:2},il={nsRoute:0},ih={nsRoute:2},ip={lowerBound:.08,lowerMask:.05,statisticalBound:.05,finalLowerMask:.03},i_={lowerBound:.01,lowerMask:.01,statisticalBound:0,finalLowerMask:.008},iA=["remote"],im={};function iv(){return!!globalThis.AudioWorklet&&!!globalThis.AudioWorkletNode}class iE extends EventTarget{constructor(e,t){super(),this.workletNode=new AudioWorkletNode(e,"ai-denoiser-worklet-processor",Object.assign(Object.assign({},id),t)),this.workletNode.port.addEventListener("message",this.handleMessageEvent.bind(this)),this.workletNode.port.start()}static create(e,t,r,i,n,o,a,s){return ia(this,void 0,void 0,function*(){if(!iv())throw Error("does not support AudioWorklet");if("closed"===e.state)throw Error("context has been closed");if(!iE.registeredContexts.has(e)){let t=new Blob(['/**\n * AgoraExtensionAIDenoiser-1.1.0-9019a23(11/10/2022, 5:31:24 PM) Copyright AgoraInc.\n */\n\n!function(){"use strict";var e={exports:{}};!function(e,t){var n,r=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,r,a;e=e||{},"function"==typeof AudioWorkletGlobalScope&&(t=globalThis.Module),t||(t=void 0!==e?e:{}),t.ready=new Promise((function(e,t){r=e,a=t}));var i,o=Object.assign({},t),u="./this.program",s="object"==typeof window,c="function"==typeof importScripts,l="function"==typeof AudioWorkletGlobalScope,f="";s||c?(c?f=self.location.href:"undefined"!=typeof document&&document.currentScript&&(f=document.currentScript.src),n&&(f=n),f=0!==f.indexOf("blob:")?f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):"",c&&(i=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)})):l&&Object.assign(globalThis,{performance:{start:Date.now(),now:function(){return Date.now()-performance.start}}});var h,d=t.print||console.log.bind(console),p=t.printErr||console.warn.bind(console);Object.assign(t,o),o=null,t.thisProgram&&(u=t.thisProgram),t.wasmBinary&&(h=t.wasmBinary),t.noExitRuntime,"object"!=typeof WebAssembly&&$("no native wasm support detected");var m,v=!1,g="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function y(e,t,n){var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.subarray&&g)return g.decode(e.subarray(t,n));for(r="";t<n;){var a=e[t++];if(128&a){var i=63&e[t++];if(192==(224&a))r+=String.fromCharCode((31&a)<<6|i);else{var o=63&e[t++];65536>(a=224==(240&a)?(15&a)<<12|i<<6|o:(7&a)<<18|i<<12|o<<6|63&e[t++])?r+=String.fromCharCode(a):(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else r+=String.fromCharCode(a)}return r}function b(e,t,n,r){if(0<r){r=n+r-1;for(var a=0;a<e.length;++a){var i=e.charCodeAt(a);if(55296<=i&&57343>=i&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++a)),127>=i){if(n>=r)break;t[n++]=i}else{if(2047>=i){if(n+1>=r)break;t[n++]=192|i>>6}else{if(65535>=i){if(n+2>=r)break;t[n++]=224|i>>12}else{if(n+3>=r)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63}t[n++]=128|i>>6&63}t[n++]=128|63&i}}t[n]=0}}function w(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),127>=r?++t:t=2047>=r?t+2:65535>=r?t+3:t+4}return t}var A,T,C,k,_,D,P,E,O,S="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function W(e,t){for(var n=e>>1,r=n+t/2;!(n>=r)&&_[n];)++n;if(32<(n<<=1)-e&&S)return S.decode(C.subarray(e,n));for(n="",r=0;!(r>=t/2);++r){var a=k[e+2*r>>1];if(0==a)break;n+=String.fromCharCode(a)}return n}function F(e,t,n){if(void 0===n&&(n=2147483647),2>n)return 0;var r=t;n=(n-=2)<2*e.length?n/2:e.length;for(var a=0;a<n;++a)k[t>>1]=e.charCodeAt(a),t+=2;return k[t>>1]=0,t-r}function M(e){return 2*e.length}function j(e,t){for(var n=0,r="";!(n>=t/4);){var a=D[e+4*n>>2];if(0==a)break;++n,65536<=a?(a-=65536,r+=String.fromCharCode(55296|a>>10,56320|1023&a)):r+=String.fromCharCode(a)}return r}function R(e,t,n){if(void 0===n&&(n=2147483647),4>n)return 0;var r=t;n=r+n-4;for(var a=0;a<e.length;++a){var i=e.charCodeAt(a);if(55296<=i&&57343>=i&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++a)),D[t>>2]=i,(t+=4)+4>n)break}return D[t>>2]=0,t-r}function N(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&++n,t+=4}return t}function I(){var e=m.buffer;A=e,t.HEAP8=T=new Int8Array(e),t.HEAP16=k=new Int16Array(e),t.HEAP32=D=new Int32Array(e),t.HEAPU8=C=new Uint8Array(e),t.HEAPU16=_=new Uint16Array(e),t.HEAPU32=P=new Uint32Array(e),t.HEAPF32=E=new Float32Array(e),t.HEAPF64=O=new Float64Array(e)}var U,B=[],Y=[],x=[];function H(){var e=t.preRun.shift();B.unshift(e)}var V,L=0,z=null;function $(e){throw t.onAbort&&t.onAbort(e),p(e="Aborted("+e+")"),v=!0,e=new WebAssembly.RuntimeError(e+". Build with -s ASSERTIONS=1 for more info."),a(e),e}function G(){return V.startsWith("data:application/octet-stream;base64,")}if(t.preloadedImages={},t.preloadedAudios={},V="audio_denoiser.wasm",!G()){var q=V;V=t.locateFile?t.locateFile(q,f):f+q}function J(){var e=V;try{if(e==V&&h)return new Uint8Array(h);if(i)return i(e);throw"both async and sync fetching of the wasm failed"}catch(e){$(e)}}function X(e){for(;0<e.length;){var n=e.shift();if("function"==typeof n)n(t);else{var r=n.ib;"number"==typeof r?void 0===n.Ba?Z(r)():Z(r)(n.Ba):r(void 0===n.Ba?null:n.Ba)}}}var K=[];function Z(e){var t=K[e];return t||(e>=K.length&&(K.length=e+1),K[e]=t=U.get(e)),t}function Q(e){this.ea=e-16,this.Xa=function(e){D[this.ea+4>>2]=e},this.Ra=function(e){D[this.ea+8>>2]=e},this.Sa=function(){D[this.ea>>2]=0},this.Pa=function(){T[this.ea+12>>0]=0},this.Ua=function(){T[this.ea+13>>0]=0},this.Na=function(e,t){this.Xa(e),this.Ra(t),this.Sa(),this.Pa(),this.Ua()}}var ee={};function te(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function ne(e){return this.fromWireType(P[e>>2])}var re={},ae={},ie={};function oe(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return 48<=t&&57>=t?"_"+e:e}function ue(e,t){return e=oe(e),function(){return t.apply(this,arguments)}}function se(e){var t=Error,n=ue(e,(function(t){this.name=e,this.message=t,void 0!==(t=Error(t).stack)&&(this.stack=this.toString()+"\\n"+t.replace(/^Error(:[^\\n]*)?\\n/,""))}));return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var ce=void 0;function le(e){throw new ce(e)}function fe(e,t,n){function r(t){(t=n(t)).length!==e.length&&le("Mismatched type converter count");for(var r=0;r<e.length;++r)ye(e[r],t[r])}e.forEach((function(e){ie[e]=t}));var a=Array(t.length),i=[],o=0;t.forEach((function(e,t){ae.hasOwnProperty(e)?a[t]=ae[e]:(i.push(e),re.hasOwnProperty(e)||(re[e]=[]),re[e].push((function(){a[t]=ae[e],++o===i.length&&r(a)})))})),0===i.length&&r(a)}var he={};function de(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var pe=void 0;function me(e){for(var t="";C[e];)t+=pe[C[e++]];return t}var ve=void 0;function ge(e){throw new ve(e)}function ye(e,t,n={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||ge(\'type "\'+r+\'" must have a positive integer typeid pointer\'),ae.hasOwnProperty(e)){if(n.Ya)return;ge("Cannot register type \'"+r+"\' twice")}ae[e]=t,delete ie[e],re.hasOwnProperty(e)&&(t=re[e],delete re[e],t.forEach((function(e){e()})))}function be(e){ge(e.ca.fa.da.name+" instance already deleted")}var we=!1;function Ae(){}function Te(e){--e.count.value,0===e.count.value&&(e.ga?e.ka.ja(e.ga):e.fa.da.ja(e.ea))}function Ce(e,t,n){return t===n?e:void 0===n.la||null===(e=Ce(e,t,n.la))?null:n.Qa(e)}var ke={},_e=[];function De(){for(;_e.length;){var e=_e.pop();e.ca.pa=!1,e.delete()}}var Pe=void 0,Ee={};function Oe(e,t){return t.fa&&t.ea||le("makeClassHandle requires ptr and ptrType"),!!t.ka!=!!t.ga&&le("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Se(Object.create(e,{ca:{value:t}}))}function Se(e){return"undefined"==typeof FinalizationRegistry?(Se=e=>e,e):(we=new FinalizationRegistry((e=>{Te(e.ca)})),Ae=e=>{we.unregister(e)},(Se=e=>{var t=e.ca;return t.ga&&we.register(e,{ca:t},e),e})(e))}function We(){}function Fe(e,t,n){if(void 0===e[t].ma){var r=e[t];e[t]=function(){return e[t].ma.hasOwnProperty(arguments.length)||ge("Function \'"+n+"\' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].ma+")!"),e[t].ma[arguments.length].apply(this,arguments)},e[t].ma=[],e[t].ma[r.va]=r}}function Me(e,n){t.hasOwnProperty(e)?(ge("Cannot register public name \'"+e+"\' twice"),Fe(t,e,e),t.hasOwnProperty(void 0)&&ge("Cannot register multiple overloads of a function with the same number of arguments (undefined)!"),t[e].ma[void 0]=n):t[e]=n}function je(e,t,n,r,a,i,o,u){this.name=e,this.constructor=t,this.na=n,this.ja=r,this.la=a,this.Va=i,this.ua=o,this.Qa=u,this.$a=[]}function Re(e,t,n){for(;t!==n;)t.ua||ge("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.ua(e),t=t.la;return e}function Ne(e,t){return null===t?(this.Fa&&ge("null is not a valid "+this.name),0):(t.ca||ge(\'Cannot pass "\'+et(t)+\'" as a \'+this.name),t.ca.ea||ge("Cannot pass deleted object as a pointer of type "+this.name),Re(t.ca.ea,t.ca.fa.da,this.da))}function Ie(e,t){if(null===t){if(this.Fa&&ge("null is not a valid "+this.name),this.xa){var n=this.sa();return null!==e&&e.push(this.ja,n),n}return 0}if(t.ca||ge(\'Cannot pass "\'+et(t)+\'" as a \'+this.name),t.ca.ea||ge("Cannot pass deleted object as a pointer of type "+this.name),!this.wa&&t.ca.fa.wa&&ge("Cannot convert argument of type "+(t.ca.ka?t.ca.ka.name:t.ca.fa.name)+" to parameter type "+this.name),n=Re(t.ca.ea,t.ca.fa.da,this.da),this.xa)switch(void 0===t.ca.ga&&ge("Passing raw pointer to smart pointer is illegal"),this.bb){case 0:t.ca.ka===this?n=t.ca.ga:ge("Cannot convert argument of type "+(t.ca.ka?t.ca.ka.name:t.ca.fa.name)+" to parameter type "+this.name);break;case 1:n=t.ca.ga;break;case 2:if(t.ca.ka===this)n=t.ca.ga;else{var r=t.clone();n=this.ab(n,Ke((function(){r.delete()}))),null!==e&&e.push(this.ja,n)}break;default:ge("Unsupporting sharing policy")}return n}function Ue(e,t){return null===t?(this.Fa&&ge("null is not a valid "+this.name),0):(t.ca||ge(\'Cannot pass "\'+et(t)+\'" as a \'+this.name),t.ca.ea||ge("Cannot pass deleted object as a pointer of type "+this.name),t.ca.fa.wa&&ge("Cannot convert argument of type "+t.ca.fa.name+" to parameter type "+this.name),Re(t.ca.ea,t.ca.fa.da,this.da))}function Be(e,t,n,r){this.name=e,this.da=t,this.Fa=n,this.wa=r,this.xa=!1,this.ja=this.ab=this.sa=this.Ma=this.bb=this.Za=void 0,void 0!==t.la?this.toWireType=Ie:(this.toWireType=r?Ne:Ue,this.ia=null)}function Ye(e,n){var r=(e=me(e)).includes("j")?function(e,n){var r=[];return function(){if(r.length=0,Object.assign(r,arguments),e.includes("j")){var a=t["dynCall_"+e];a=r&&r.length?a.apply(null,[n].concat(r)):a.call(null,n)}else a=Z(n).apply(null,r);return a}}(e,n):Z(n);return"function"!=typeof r&&ge("unknown function pointer with signature "+e+": "+n),r}var xe=void 0;function He(e){var t=me(e=At(e));return wt(e),t}function Ve(e,t){var n=[],r={};throw t.forEach((function e(t){r[t]||ae[t]||(ie[t]?ie[t].forEach(e):(n.push(t),r[t]=!0))})),new xe(e+": "+n.map(He).join([", "]))}function Le(e,t){for(var n=[],r=0;r<e;r++)n.push(D[(t>>2)+r]);return n}function ze(e,t,n,r,a){var i=t.length;2>i&&ge("argTypes array size mismatch! Must at least get return value and \'this\' types!");var o=null!==t[1]&&null!==n,u=!1;for(n=1;n<t.length;++n)if(null!==t[n]&&void 0===t[n].ia){u=!0;break}var s="void"!==t[0].name,c=i-2,l=Array(c),f=[],h=[];return function(){if(arguments.length!==c&&ge("function "+e+" called with "+arguments.length+" arguments, expected "+c+" args!"),h.length=0,f.length=o?2:1,f[0]=a,o){var n=t[1].toWireType(h,this);f[1]=n}for(var i=0;i<c;++i)l[i]=t[i+2].toWireType(h,arguments[i]),f.push(l[i]);if(i=r.apply(null,f),u)te(h);else for(var d=o?1:2;d<t.length;d++){var p=1===d?n:l[d-2];null!==t[d].ia&&t[d].ia(p)}return n=s?t[0].fromWireType(i):void 0}}function $e(e,t,n){return e instanceof Object||ge(n+\' with invalid "this": \'+e),e instanceof t.da.constructor||ge(n+\' incompatible with "this" of type \'+e.constructor.name),e.ca.ea||ge("cannot call emscripten binding method "+n+" on deleted object"),Re(e.ca.ea,e.ca.fa.da,t.da)}var Ge=[],qe=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Je(e){4<e&&0==--qe[e].Ga&&(qe[e]=void 0,Ge.push(e))}function Xe(e){return e||ge("Cannot use deleted val. handle = "+e),qe[e].value}function Ke(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=Ge.length?Ge.pop():qe.length;return qe[t]={Ga:1,value:e},t}}function Ze(e,t,n){switch(t){case 0:return function(e){return this.fromWireType((n?T:C)[e])};case 1:return function(e){return this.fromWireType((n?k:_)[e>>1])};case 2:return function(e){return this.fromWireType((n?D:P)[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function Qe(e,t){var n=ae[e];return void 0===n&&ge(t+" has unknown type "+He(e)),n}function et(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function tt(e,t){switch(t){case 2:return function(e){return this.fromWireType(E[e>>2])};case 3:return function(e){return this.fromWireType(O[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function nt(e,t,n){switch(t){case 0:return n?function(e){return T[e]}:function(e){return C[e]};case 1:return n?function(e){return k[e>>1]}:function(e){return _[e>>1]};case 2:return n?function(e){return D[e>>2]}:function(e){return P[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var rt,at={};rt=()=>performance.now();var it={};function ot(){if(!ut){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"};for(e in it)void 0===it[e]?delete t[e]:t[e]=it[e];var n=[];for(e in t)n.push(e+"="+t[e]);ut=n}return ut}var ut,st=[null,[],[]],ct={};function lt(e){return 0==e%4&&(0!=e%100||0==e%400)}function ft(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}var ht=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function pt(e,t){for(e=new Date(e.getTime());0<t;){var n=e.getMonth(),r=(lt(e.getFullYear())?ht:dt)[n];if(!(t>r-e.getDate())){e.setDate(e.getDate()+t);break}t-=r-e.getDate()+1,e.setDate(1),11>n?e.setMonth(n+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1))}return e}function mt(e,t,n,r){function a(e,t,n){for(e="number"==typeof e?e.toString():e||"";e.length<t;)e=n[0]+e;return e}function i(e,t){return a(e,t,"0")}function o(e,t){function n(e){return 0>e?-1:0<e?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function u(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function s(e){e=pt(new Date(e.ha+1900,0,1),e.Aa);var t=new Date(e.getFullYear()+1,0,4),n=u(new Date(e.getFullYear(),0,4));return t=u(t),0>=o(n,e)?0>=o(t,e)?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var c=D[r+40>>2];for(var l in r={fb:D[r>>2],eb:D[r+4>>2],ya:D[r+8>>2],ta:D[r+12>>2],qa:D[r+16>>2],ha:D[r+20>>2],za:D[r+24>>2],Aa:D[r+28>>2],lb:D[r+32>>2],cb:D[r+36>>2],gb:c&&c?y(C,c,void 0):""},n=n?y(C,n,void 0):"",c={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"})n=n.replace(new RegExp(l,"g"),c[l]);var f="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),h="January February March April May June July August September October November December".split(" ");for(l in c={"%a":function(e){return f[e.za].substring(0,3)},"%A":function(e){return f[e.za]},"%b":function(e){return h[e.qa].substring(0,3)},"%B":function(e){return h[e.qa]},"%C":function(e){return i((e.ha+1900)/100|0,2)},"%d":function(e){return i(e.ta,2)},"%e":function(e){return a(e.ta,2," ")},"%g":function(e){return s(e).toString().substring(2)},"%G":function(e){return s(e)},"%H":function(e){return i(e.ya,2)},"%I":function(e){return 0==(e=e.ya)?e=12:12<e&&(e-=12),i(e,2)},"%j":function(e){return i(e.ta+ft(lt(e.ha+1900)?ht:dt,e.qa-1),3)},"%m":function(e){return i(e.qa+1,2)},"%M":function(e){return i(e.eb,2)},"%n":function(){return"\\n"},"%p":function(e){return 0<=e.ya&&12>e.ya?"AM":"PM"},"%S":function(e){return i(e.fb,2)},"%t":function(){return"\\t"},"%u":function(e){return e.za||7},"%U":function(e){var t=new Date(e.ha+1900,0,1),n=0===t.getDay()?t:pt(t,7-t.getDay());return 0>o(n,e=new Date(e.ha+1900,e.qa,e.ta))?i(Math.ceil((31-n.getDate()+(ft(lt(e.getFullYear())?ht:dt,e.getMonth()-1)-31)+e.getDate())/7),2):0===o(n,t)?"01":"00"},"%V":function(e){var t=new Date(e.ha+1901,0,4),n=u(new Date(e.ha+1900,0,4));t=u(t);var r=pt(new Date(e.ha+1900,0,1),e.Aa);return 0>o(r,n)?"53":0>=o(t,r)?"01":i(Math.ceil((n.getFullYear()<e.ha+1900?e.Aa+32-n.getDate():e.Aa+1-n.getDate())/7),2)},"%w":function(e){return e.za},"%W":function(e){var t=new Date(e.ha,0,1),n=1===t.getDay()?t:pt(t,0===t.getDay()?1:7-t.getDay()+1);return 0>o(n,e=new Date(e.ha+1900,e.qa,e.ta))?i(Math.ceil((31-n.getDate()+(ft(lt(e.getFullYear())?ht:dt,e.getMonth()-1)-31)+e.getDate())/7),2):0===o(n,t)?"01":"00"},"%y":function(e){return(e.ha+1900).toString().substring(2)},"%Y":function(e){return e.ha+1900},"%z":function(e){var t=0<=(e=e.cb);return e=Math.abs(e)/60,(t?"+":"-")+String("0000"+(e/60*100+e%60)).slice(-4)},"%Z":function(e){return e.gb},"%%":function(){return"%"}},n=n.replace(/%%/g,"\\0\\0"),c)n.includes(l)&&(n=n.replace(new RegExp(l,"g"),c[l](r)));return l=function(e){var t=Array(w(e)+1);return b(e,t,0,t.length),t}(n=n.replace(/\\0\\0/g,"%")),l.length>t?0:(T.set(l,e),l.length-1)}ce=t.InternalError=se("InternalError");for(var vt=Array(256),gt=0;256>gt;++gt)vt[gt]=String.fromCharCode(gt);pe=vt,ve=t.BindingError=se("BindingError"),We.prototype.isAliasOf=function(e){if(!(this instanceof We&&e instanceof We))return!1;var t=this.ca.fa.da,n=this.ca.ea,r=e.ca.fa.da;for(e=e.ca.ea;t.la;)n=t.ua(n),t=t.la;for(;r.la;)e=r.ua(e),r=r.la;return t===r&&n===e},We.prototype.clone=function(){if(this.ca.ea||be(this),this.ca.ra)return this.ca.count.value+=1,this;var e=Se,t=Object,n=t.create,r=Object.getPrototypeOf(this),a=this.ca;return(e=e(n.call(t,r,{ca:{value:{count:a.count,pa:a.pa,ra:a.ra,ea:a.ea,fa:a.fa,ga:a.ga,ka:a.ka}}}))).ca.count.value+=1,e.ca.pa=!1,e},We.prototype.delete=function(){this.ca.ea||be(this),this.ca.pa&&!this.ca.ra&&ge("Object already scheduled for deletion"),Ae(this),Te(this.ca),this.ca.ra||(this.ca.ga=void 0,this.ca.ea=void 0)},We.prototype.isDeleted=function(){return!this.ca.ea},We.prototype.deleteLater=function(){return this.ca.ea||be(this),this.ca.pa&&!this.ca.ra&&ge("Object already scheduled for deletion"),_e.push(this),1===_e.length&&Pe&&Pe(De),this.ca.pa=!0,this},t.getInheritedInstanceCount=function(){return Object.keys(Ee).length},t.getLiveInheritedInstances=function(){var e,t=[];for(e in Ee)Ee.hasOwnProperty(e)&&t.push(Ee[e]);return t},t.flushPendingDeletes=De,t.setDelayFunction=function(e){Pe=e,_e.length&&Pe&&Pe(De)},Be.prototype.Wa=function(e){return this.Ma&&(e=this.Ma(e)),e},Be.prototype.Ka=function(e){this.ja&&this.ja(e)},Be.prototype.argPackAdvance=8,Be.prototype.readValueFromPointer=ne,Be.prototype.deleteObject=function(e){null!==e&&e.delete()},Be.prototype.fromWireType=function(e){function t(){return this.xa?Oe(this.da.na,{fa:this.Za,ea:n,ka:this,ga:e}):Oe(this.da.na,{fa:this,ea:e})}var n=this.Wa(e);if(!n)return this.Ka(e),null;var r=function(e,t){for(void 0===t&&ge("ptr should not be undefined");e.la;)t=e.ua(t),e=e.la;return Ee[t]}(this.da,n);if(void 0!==r)return 0===r.ca.count.value?(r.ca.ea=n,r.ca.ga=e,r.clone()):(r=r.clone(),this.Ka(e),r);if(r=this.da.Va(n),!(r=ke[r]))return t.call(this);r=this.wa?r.Oa:r.pointerType;var a=Ce(n,this.da,r.da);return null===a?t.call(this):this.xa?Oe(r.da.na,{fa:r,ea:a,ka:this,ga:e}):Oe(r.da.na,{fa:r,ea:a})},xe=t.UnboundTypeError=se("UnboundTypeError"),t.count_emval_handles=function(){for(var e=0,t=5;t<qe.length;++t)void 0!==qe[t]&&++e;return e},t.get_first_emval=function(){for(var e=5;e<qe.length;++e)if(void 0!==qe[e])return qe[e];return null};var yt={k:function(e){return bt(e+16)+16},j:function(e,t,n){throw new Q(e).Na(t,n),e},N:function(e){var t=ee[e];delete ee[e];var n=t.elements,r=n.length,a=n.map((function(e){return e.Ea})).concat(n.map((function(e){return e.Ia}))),i=t.sa,o=t.ja;fe([e],a,(function(e){return n.forEach((function(t,n){var a=e[n],i=t.Ca,o=t.Da,u=e[n+r],s=t.Ha,c=t.Ja;t.read=e=>a.fromWireType(i(o,e)),t.write=(e,t)=>{var n=[];s(c,e,u.toWireType(n,t)),te(n)}})),[{name:t.name,fromWireType:function(e){for(var t=Array(r),a=0;a<r;++a)t[a]=n[a].read(e);return o(e),t},toWireType:function(e,a){if(r!==a.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+r+", actual="+a.length);for(var u=i(),s=0;s<r;++s)n[s].write(u,a[s]);return null!==e&&e.push(o,u),u},argPackAdvance:8,readValueFromPointer:ne,ia:o}]}))},P:function(e){var t=he[e];delete he[e];var n=t.sa,r=t.ja,a=t.La;fe([e],a.map((function(e){return e.Ea})).concat(a.map((function(e){return e.Ia}))),(function(e){var i={};return a.forEach((function(t,n){var r=e[n],o=t.Ca,u=t.Da,s=e[n+a.length],c=t.Ha,l=t.Ja;i[t.Ta]={read:function(e){return r.fromWireType(o(u,e))},write:function(e,t){var n=[];c(l,e,s.toWireType(n,t)),te(n)}}})),[{name:t.name,fromWireType:function(e){var t,n={};for(t in i)n[t]=i[t].read(e);return r(e),n},toWireType:function(e,t){for(var a in i)if(!(a in t))throw new TypeError(\'Missing field:  "\'+a+\'"\');var o=n();for(a in i)i[a].write(o,t[a]);return null!==e&&e.push(r,o),o},argPackAdvance:8,readValueFromPointer:ne,ia:r}]}))},A:function(){},K:function(e,t,n,r,a){var i=de(n);ye(e,{name:t=me(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:a},argPackAdvance:8,readValueFromPointer:function(e){if(1===n)var r=T;else if(2===n)r=k;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=D}return this.fromWireType(r[e>>i])},ia:null})},w:function(e,n,r,a,i,o,u,s,c,l,f,h,d){f=me(f),o=Ye(i,o),s&&(s=Ye(u,s)),l&&(l=Ye(c,l)),d=Ye(h,d);var p=oe(f);Me(p,(function(){Ve("Cannot construct "+f+" due to unbound types",[a])})),fe([e,n,r],a?[a]:[],(function(n){if(n=n[0],a)var r=n.da,i=r.na;else i=We.prototype;n=ue(p,(function(){if(Object.getPrototypeOf(this)!==u)throw new ve("Use \'new\' to construct "+f);if(void 0===c.oa)throw new ve(f+" has no accessible constructor");var e=c.oa[arguments.length];if(void 0===e)throw new ve("Tried to invoke ctor of "+f+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(c.oa).toString()+") parameters instead!");return e.apply(this,arguments)}));var u=Object.create(i,{constructor:{value:n}});n.prototype=u;var c=new je(f,n,u,d,r,o,s,l);r=new Be(f,c,!0,!1),i=new Be(f+"*",c,!1,!1);var h=new Be(f+" const*",c,!1,!0);return ke[e]={pointerType:i,Oa:h},function(e,n){t.hasOwnProperty(e)||le("Replacing nonexistant public symbol"),t[e]=n,t[e].va=void 0}(p,n),[r,i,h]}))},t:function(e,t,n,r,a,i){0<t||$(void 0);var o=Le(t,n);a=Ye(r,a),fe([],[e],(function(e){var n="constructor "+(e=e[0]).name;if(void 0===e.da.oa&&(e.da.oa=[]),void 0!==e.da.oa[t-1])throw new ve("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class \'"+e.name+"\'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.da.oa[t-1]=()=>{Ve("Cannot construct "+e.name+" due to unbound types",o)},fe([],o,(function(r){return r.splice(1,0,null),e.da.oa[t-1]=ze(n,r,null,a,i),[]})),[]}))},l:function(e,t,n,r,a,i,o,u){var s=Le(n,r);t=me(t),i=Ye(a,i),fe([],[e],(function(e){function r(){Ve("Cannot call "+a+" due to unbound types",s)}var a=(e=e[0]).name+"."+t;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),u&&e.da.$a.push(t);var c=e.da.na,l=c[t];return void 0===l||void 0===l.ma&&l.className!==e.name&&l.va===n-2?(r.va=n-2,r.className=e.name,c[t]=r):(Fe(c,t,a),c[t].ma[n-2]=r),fe([],s,(function(r){return r=ze(a,r,e,i,o),void 0===c[t].ma?(r.va=n-2,c[t]=r):c[t].ma[n-2]=r,[]})),[]}))},m:function(e,t,n,r,a,i,o,u,s,c){t=me(t),a=Ye(r,a),fe([],[e],(function(e){var r=(e=e[0]).name+"."+t,l={get:function(){Ve("Cannot access "+r+" due to unbound types",[n,o])},enumerable:!0,configurable:!0};return l.set=s?()=>{Ve("Cannot access "+r+" due to unbound types",[n,o])}:()=>{ge(r+" is a read-only property")},Object.defineProperty(e.da.na,t,l),fe([],s?[n,o]:[n],(function(n){var o=n[0],l={get:function(){var t=$e(this,e,r+" getter");return o.fromWireType(a(i,t))},enumerable:!0};if(s){s=Ye(u,s);var f=n[1];l.set=function(t){var n=$e(this,e,r+" setter"),a=[];s(c,n,f.toWireType(a,t)),te(a)}}return Object.defineProperty(e.da.na,t,l),[]})),[]}))},J:function(e,t){ye(e,{name:t=me(t),fromWireType:function(e){var t=Xe(e);return Je(e),t},toWireType:function(e,t){return Ke(t)},argPackAdvance:8,readValueFromPointer:ne,ia:null})},M:function(e,t,n,r){function a(){}n=de(n),t=me(t),a.values={},ye(e,{name:t,constructor:a,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:Ze(t,n,r),ia:null}),Me(t,a)},n:function(e,t,n){var r=Qe(e,"enum");t=me(t),e=r.constructor,r=Object.create(r.constructor.prototype,{value:{value:n},constructor:{value:ue(r.name+"_"+t,(function(){}))}}),e.values[n]=r,e[t]=r},u:function(e,t,n){n=de(n),ye(e,{name:t=me(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:tt(t,n),ia:null})},i:function(e,t,n,r,a){t=me(t),-1===a&&(a=4294967295),a=de(n);var i=e=>e;if(0===r){var o=32-8*n;i=e=>e<<o>>>o}n=t.includes("unsigned")?function(e,t){return t>>>0}:function(e,t){return t},ye(e,{name:t,fromWireType:i,toWireType:n,argPackAdvance:8,readValueFromPointer:nt(t,a,0!==r),ia:null})},g:function(e,t,n){function r(e){var t=P;return new a(A,t[1+(e>>=2)],t[e])}var a=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];ye(e,{name:n=me(n),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{Ya:!0})},v:function(e,t){var n="std::string"===(t=me(t));ye(e,{name:t,fromWireType:function(e){var t=P[e>>2];if(n)for(var r=e+4,a=0;a<=t;++a){var i=e+4+a;if(a==t||0==C[i]){if(r=r?y(C,r,i-r):"",void 0===o)var o=r;else o+=String.fromCharCode(0),o+=r;r=i+1}}else{for(o=Array(t),a=0;a<t;++a)o[a]=String.fromCharCode(C[e+4+a]);o=o.join("")}return wt(e),o},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ge("Cannot pass non-string to std::string");var a=(n&&r?()=>w(t):()=>t.length)(),i=bt(4+a+1);if(P[i>>2]=a,n&&r)b(t,C,i+4,a+1);else if(r)for(r=0;r<a;++r){var o=t.charCodeAt(r);255<o&&(wt(i),ge("String has UTF-16 code units that do not fit in 8 bits")),C[i+4+r]=o}else for(r=0;r<a;++r)C[i+4+r]=t[r];return null!==e&&e.push(wt,i),i},argPackAdvance:8,readValueFromPointer:ne,ia:function(e){wt(e)}})},q:function(e,t,n){if(n=me(n),2===t)var r=W,a=F,i=M,o=()=>_,u=1;else 4===t&&(r=j,a=R,i=N,o=()=>P,u=2);ye(e,{name:n,fromWireType:function(e){for(var n,a=P[e>>2],i=o(),s=e+4,c=0;c<=a;++c){var l=e+4+c*t;c!=a&&0!=i[l>>u]||(s=r(s,l-s),void 0===n?n=s:(n+=String.fromCharCode(0),n+=s),s=l+t)}return wt(e),n},toWireType:function(e,r){"string"!=typeof r&&ge("Cannot pass non-string to C++ string type "+n);var o=i(r),s=bt(4+o+t);return P[s>>2]=o>>u,a(r,s+4,o+t),null!==e&&e.push(wt,s),s},argPackAdvance:8,readValueFromPointer:ne,ia:function(e){wt(e)}})},O:function(e,t,n,r,a,i){ee[e]={name:me(t),sa:Ye(n,r),ja:Ye(a,i),elements:[]}},r:function(e,t,n,r,a,i,o,u,s){ee[e].elements.push({Ea:t,Ca:Ye(n,r),Da:a,Ia:i,Ha:Ye(o,u),Ja:s})},Q:function(e,t,n,r,a,i){he[e]={name:me(t),sa:Ye(n,r),ja:Ye(a,i),La:[]}},o:function(e,t,n,r,a,i,o,u,s,c){he[e].La.push({Ta:me(t),Ea:n,Ca:Ye(r,a),Da:i,Ia:o,Ha:Ye(u,s),Ja:c})},L:function(e,t){ye(e,{kb:!0,name:t=me(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},f:function(e,t,n){e=Xe(e),t=Qe(t,"emval::as");var r=[],a=Ke(r);return D[n>>2]=a,t.toWireType(r,e)},a:Je,d:function(e,t){return Ke((e=Xe(e))[t=Xe(t)])},x:function(e){4<e&&(qe[e].Ga+=1)},b:function(e){return"number"==typeof(e=Xe(e))},c:function(e){var t=at[e];return Ke(void 0===t?me(e):t)},e:function(e){te(Xe(e)),Je(e)},y:function(e,t){return Ke(e=(e=Qe(e,"_emval_take_value")).readValueFromPointer(t))},h:function(){$("")},G:function(e,t){if(0===e)e=Date.now();else{if(1!==e&&4!==e)return D[Ct()>>2]=28,-1;e=rt()}return D[t>>2]=e/1e3|0,D[t+4>>2]=e%1e3*1e6|0,0},I:function(e,t,n){C.copyWithin(e,t,t+n)},p:function(e){var t=C.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296);var a=Math;r=Math.max(e,r),a=a.min.call(a,2147483648,r+(65536-r%65536)%65536);e:{try{m.grow(a-A.byteLength+65535>>>16),I();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1},D:function(e,t){var n=0;return ot().forEach((function(r,a){var i=t+n;for(a=D[e+4*a>>2]=i,i=0;i<r.length;++i)T[a++>>0]=r.charCodeAt(i);T[a>>0]=0,n+=r.length+1})),0},E:function(e,t){var n=ot();D[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),D[t>>2]=r,0},H:function(){return 0},F:function(e,t,n,r){return e=ct.jb(e),t=ct.hb(e,t,n),D[r>>2]=t,0},z:function(){},s:function(e,t,n,r){for(var a=0,i=0;i<n;i++){var o=D[t>>2],u=D[t+4>>2];t+=8;for(var s=0;s<u;s++){var c=C[o+s],l=st[e];0===c||10===c?((1===e?d:p)(y(l,0)),l.length=0):l.push(c)}a+=u}return D[r>>2]=a,0},B:function(){},C:function(e,t,n,r){return mt(e,t,n,r)}};!function(){function e(e){t.asm=e.exports,m=t.asm.R,I(),U=t.asm.V,Y.unshift(t.asm.S),L--,t.monitorRunDependencies&&t.monitorRunDependencies(L),0==L&&z&&(e=z,z=null,e())}function n(t){e(t.instance)}function r(e){return(h||!s&&!c||"function"!=typeof fetch?Promise.resolve().then((function(){return J()})):fetch(V,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at \'"+V+"\'";return e.arrayBuffer()})).catch((function(){return J()}))).then((function(e){return WebAssembly.instantiate(e,i)})).then((function(e){return e})).then(e,(function(e){p("failed to asynchronously prepare wasm: "+e),$(e)}))}var i={a:yt};if(L++,t.monitorRunDependencies&&t.monitorRunDependencies(L),t.instantiateWasm)try{return t.instantiateWasm(i,e)}catch(e){return p("Module.instantiateWasm callback failed with error: "+e),!1}(h||"function"!=typeof WebAssembly.instantiateStreaming||G()||"function"!=typeof fetch?r(n):fetch(V,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,i).then(n,(function(e){return p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(a)}(),t.___wasm_call_ctors=function(){return(t.___wasm_call_ctors=t.asm.S).apply(null,arguments)};var bt=t._malloc=function(){return(bt=t._malloc=t.asm.T).apply(null,arguments)},wt=t._free=function(){return(wt=t._free=t.asm.U).apply(null,arguments)},At=t.___getTypeName=function(){return(At=t.___getTypeName=t.asm.W).apply(null,arguments)};t.___embind_register_native_and_builtin_types=function(){return(t.___embind_register_native_and_builtin_types=t.asm.X).apply(null,arguments)};var Tt,Ct=t.___errno_location=function(){return(Ct=t.___errno_location=t.asm.Y).apply(null,arguments)};function kt(){function e(){if(!Tt&&(Tt=!0,t.calledRun=!0,!v)){if(X(Y),r(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;){var e=t.postRun.shift();x.unshift(e)}X(x)}}if(!(0<L)){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)H();X(B),0<L||(t.setStatus?(t.setStatus("Running..."),setTimeout((function(){setTimeout((function(){t.setStatus("")}),1),e()}),1)):e())}}if(t.dynCall_jiji=function(){return(t.dynCall_jiji=t.asm.Z).apply(null,arguments)},t.dynCall_viijii=function(){return(t.dynCall_viijii=t.asm._).apply(null,arguments)},t.dynCall_iiiiij=function(){return(t.dynCall_iiiiij=t.asm.$).apply(null,arguments)},t.dynCall_iiiiijj=function(){return(t.dynCall_iiiiijj=t.asm.aa).apply(null,arguments)},t.dynCall_iiiiiijj=function(){return(t.dynCall_iiiiiijj=t.asm.ba).apply(null,arguments)},z=function e(){Tt||kt(),Tt||(z=e)},t.run=kt,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);0<t.preInit.length;)t.preInit.pop()();return kt(),e.ready});e.exports=r,"function"==typeof AudioWorkletGlobalScope&&(globalThis.createAudioEngine=r)}(e);var t=e.exports;const n=30,r=3,a=2;function i(e){const t=new Int16Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.round(Math.max(-32768,Math.min(32767,32768*e[n])));return t}class o extends AudioWorkletProcessor{constructor(){super(),this.enabled=!1,this.frameCount=0,this.bufferTime=n,this.dumpBundleNums=r,this.threshold=a,this.isDumping=!1,this.dumpBundleNumCount=0,this.dumpBundleFrameCount=0,this.port.onmessage=this.handleMessageEvent.bind(this)}process(e,t){const[[n]]=e;if(!n)return!0;const[[r]]=t;if(this.enabled&&this.buffer&&this.kernel)try{const e=this.buffer;e.getChannelData(0).set(n);const t=this.kernel.process(e,e);r.set(e.getChannelData(0)),t!==this.lastStatus&&(this.onStatusChange(t),this.lastStatus=t),this.isDumping&&(this.dumpBundleFrameCount+=r.length,this.dumpBundleFrameCount>=this.bufferTime*sampleRate&&(this.dumpBundleFrameCount=0,this.dump())),this.frameCount+=r.length;const a=sampleRate/2;for(;this.frameCount>=a;)this.uploadStats(),this.frameCount-=a}catch(e){r.set(n),this.log("error",`[ai-denoiser-worklet] detect error from wasm: ${e}`)}else r.set(n);return!0}log(e,t){this.port.postMessage({event:"log",level:e,message:t})}getValue(){var e;const t=this.enabled?null===(e=this.kernel)||void 0===e?void 0:e.value:1;this.port.postMessage({event:"getValue",value:t})}getLevel(){var e;const t=this.enabled?null===(e=this.kernel)||void 0===e?void 0:e.level:1;this.port.postMessage({event:"getLevel",level:t})}enable(){this.enabled||(this.enabled=!0,this.log("debug","[ai-denoiser-worklet] denoiser was enabled")),this.port.postMessage({event:"enable"})}disable(){this.enabled&&(this.enabled=!1,this.isDumping&&(this.dump(),this.endDump()),this.reset(),this.log("debug","[ai-denoiser-worklet] denoiser was disabled")),this.port.postMessage({event:"disable"})}startDump(){this.isDumping?this.log("debug","[ai-denoiser-worklet] dump has already started"):(this.isDumping=!0,this.dumpBundleNumCount=0,this.dumpBundleFrameCount=0,this.dump(),this.log("debug","[ai-denoiser-worklet] dump started"))}dump(){if(this.kernel){const e=this.kernel.dump(this.bufferTime),t=new Float32Array(e[0].numberOfFrames),n=new Float32Array(e[1].numberOfFrames),r=new Float32Array(e[2].numberOfFrames);t.set(e[0].getChannelData(0)),n.set(e[1].getChannelData(0)),r.set(e[2].getChannelData(0)),e[0].delete(),e[1].delete(),e[2].delete();const a=i(t),o=i(n),u=i(r);this.log("debug",`[ai-denoiser-worklet] dump: input ${a.length*Int16Array.BYTES_PER_ELEMENT} bytes, nsOut ${o.length*Int16Array.BYTES_PER_ELEMENT} bytes, agcOut ${u.length*Int16Array.BYTES_PER_ELEMENT} bytes`),this.port.postMessage({event:"dump",dump:{input:a,nsOut:o,agcOut:u},lts:Date.now()},[a.buffer,o.buffer,u.buffer]),this.dumpBundleNumCount+=1,this.dumpBundleNumCount>=this.dumpBundleNums&&this.endDump()}}endDump(){this.isDumping?(this.isDumping=!1,this.log("debug","[ai-denoiser-worklet] dump ended")):this.log("debug","[ai-denoiser-worklet] dump has already ended"),this.port.postMessage({evnet:"dumpend"})}setParameters(e){this.kernel&&(this.kernel.setNsParams(e),this.log("debug",`[ai-denoiser-worklet] set ns params ${JSON.stringify(e)}`)),this.port.postMessage({event:"setParameters"})}setAgcParameters(e){this.kernel&&(this.kernel.setAgcParams(e),this.log("debug",`[ai-denoiser-worklet] set agc params ${JSON.stringify(e)}`)),this.port.postMessage({event:"setAgcParameters"})}initialize(e,n,r,a,i,o){t({wasmBinary:e}).then((e=>{this.module=e,this.buffer=new e.AudioBuffer(1,128),this.kernel=new e.AudioDenoiser(sampleRate,n,r,a),this.lastStatus=e.AudioDenoiserStatus.UNCERTAIN,this.bufferTime=a,this.dumpBundleNums=i,this.threshold=o,this.log("debug",`[ai-denoiser-worklet] kernel version: ${this.kernel.version}-${this.kernel.buildInfo}, options: {sampleRate: ${sampleRate}, enabled: ${n}, agc: ${r}, bufferTime: ${a}, dumpBundleNums: ${i}, threshold: ${o}}`),this.port.postMessage({event:"initialize"})})).catch((e=>{this.port.postMessage({event:"initialize",error:e})}))}reset(){var e,t;null===(e=this.kernel)||void 0===e||e.reset(),this.lastStatus=null===(t=this.module)||void 0===t?void 0:t.AudioDenoiserStatus.UNCERTAIN}destroy(){var e,t;this.module=void 0,null===(e=this.buffer)||void 0===e||e.delete(),this.buffer=void 0,null===(t=this.kernel)||void 0===t||t.delete(),this.kernel=void 0,this.lastStatus=void 0,this.log("debug","[ai-denoiser-worklet] denoiser was destroyed"),this.port.postMessage({event:"destroy"})}uploadStats(){if(!this.kernel)return;const e=this.kernel.getStats();this.port.postMessage({event:"stats",stats:{ebn:e.energy_bf_ns,ean:e.energy_af_ns,ns:e.ns_state,vl:e.vad_loss}}),this.threshold>0&&e.elapsed_time>this.threshold&&this.port.postMessage({event:"overload",elpasedTime:e.elapsed_time})}onStatusChange(e){var t;let n="UNKNOWN",r="debug";const a=null===(t=this.module)||void 0===t?void 0:t.AudioDenoiserStatus;a&&(e===a.UNCERTAIN?n="UNCERTAIN":e===a.NORMAL?n="NORMAL":e===a.DANGLY?n="DANGLY":e===a.STRONGBAD?(n="STRONGBAD",r="warning"):e===a.NOINPUT?(n="NOINPUT",r="warning"):e===a.NOOUTPUT&&(n="NOOUTPUT",r="warning")),this.log(r,`[ai-denoiser-worklet] kernel status changed to ${n}`)}handleMessageEvent(e){const t=e.data,n=t.event;"getValue"===n?this.getValue():"getLevel"===n?this.getLevel():"enable"===n?this.enable():"disable"===n?this.disable():"dump"===n?this.startDump():"setParameters"===n?this.setParameters(t.parameters):"setAgcParameters"===n?this.setAgcParameters(t.agcParameters):"initialize"===n?this.initialize(t.wasmSource,t.enabled,t.agc,t.bufferTime,t.dumpBundleNums,t.threshold):"destroy"===n&&this.destroy()}}registerProcessor("ai-denoiser-worklet-processor",o)}();\n'],{type:"text/javascript"}),r=URL.createObjectURL(t);yield e.audioWorklet.addModule(r),setTimeout(()=>URL.revokeObjectURL(r),0),iE.registeredContexts.add(e),e.addEventListener("statechange",function t(){"closed"===e.state&&(iE.registeredContexts.delete(e),e.removeEventListener("statechange",t))})}let c=new iE(e,s);return yield c.initialize(t,r,i,n,o,a),c})}get node(){return this.workletNode}getValue(){return ia(this,void 0,void 0,function*(){return(yield this.requestResponse({event:"getValue"})).value})}getLevel(){return ia(this,void 0,void 0,function*(){return(yield this.requestResponse({event:"getLevel"})).level})}enable(){return this.requestResponse({event:"enable"})}disable(){return this.requestResponse({event:"disable"})}dump(){this.workletNode.port.postMessage({event:"dump"})}setParameters(e){return this.requestResponse({event:"setParameters",parameters:e})}setAgcParameters(e){return this.requestResponse({event:"setAgcParameters",agcParameters:e})}initialize(e,t,r,i,n,o){return this.requestResponse({event:"initialize",wasmSource:e,enabled:t,agc:r,bufferTime:i,dumpBundleNums:n,threshold:o})}destroy(){return this.requestResponse({event:"destroy"})}handleMessageEvent(e){let t=e.data,r=t.event;"stats"===r?this.dispatchEvent(new CustomEvent("stats",{detail:{stats:t.stats}})):"log"===r?io.exports.logger[t.level](t.message):"overload"===r?this.dispatchEvent(new CustomEvent("overload",{detail:{elapsedTime:t.elapsedTime}})):"dump"===r?this.dispatchEvent(new CustomEvent("dump",{detail:{dump:t.dump,lts:t.lts}})):"dumpend"===r&&this.dispatchEvent(new CustomEvent("dumpend"))}requestResponse(e,t=[]){return new Promise((r,i)=>{let n=this.workletNode.port;n.addEventListener("message",function t(o){o.data.event===e.event&&(n.removeEventListener("message",t),o.data.error?i(o.data.error):r(o.data))}),n.postMessage(e,t),n.start()})}}iE.registeredContexts=new Set;class ig extends io.exports.AudioProcessor{constructor(e){var t,r;super(),this.name="AIDenoiserProcessor",this.wasmSource=e.wasmSource,this.statsCount=0,this._enabled=!0===(null===(r=null===(t=im.parameters)||void 0===t?void 0:t.AI_DENOISER_PARAMETERS)||void 0===r?void 0:r.enabled),this.on("dump",(e,t)=>{var r;return null===(r=this.ondump)||void 0===r?void 0:r.call(this,e,t)}),this.on("dumpend",()=>{var e;return null===(e=this.ondumpend)||void 0===e?void 0:e.call(this)}),this.on("overload",e=>{var t;return null===(t=this.onoverload)||void 0===t?void 0:t.call(this,e)}),io.exports.logger.debug(`[ai-denoiser-processor] construct denoiser processor, enabled: ${this.enabled}`),io.exports.reporter.reportApiInvoke({name:`${this.name}.constructor`,options:[]}).onSuccess()}dump(){let e=io.exports.reporter.reportApiInvoke({name:`${this.name}.dump`,options:[]});if(!this.workletHandler){let t=Error("processor is not piped");throw e.onError(t),t}this.workletHandler.then(t=>{t.dump(),e.onSuccess()}).catch(t=>{io.exports.logger.error(`[ai-denoiser-processor] failed to dump: ${t}`),e.onError(t)})}setMode(e){return ia(this,void 0,void 0,function*(){let t=io.exports.reporter.reportApiInvoke({name:`${this.name}.setMode`,options:[e]});try{if(!this.workletHandler)throw Error("processor is not piped");let r=yield this.workletHandler;if(e===it.STATIONARY_NS)yield r.setParameters(il);else{if(e!==it.NSNG)throw io.exports.logger.error(`[ai-denoiser-processor] unknown mode: ${e}`),Error(`unknown mode: ${e}`);yield r.setParameters(ih)}t.onSuccess()}catch(e){throw t.onError(e),e}})}setLevel(e){return ia(this,void 0,void 0,function*(){let t=io.exports.reporter.reportApiInvoke({name:`${this.name}.setLevel`,options:[e]});try{if(!this.workletHandler)throw Error("processor is not piped");let r=yield this.workletHandler;if(e===ir.SOFT)yield r.setParameters(ip);else{if(e!==ir.AGGRESSIVE)throw io.exports.logger.error(`[ai-denoiser-processor] unknown level: ${e}`),Error(`unknown level: ${e}`);yield r.setParameters(i_)}t.onSuccess()}catch(e){throw t.onError(e),e}})}setNsParams(e){return ia(this,void 0,void 0,function*(){let t=io.exports.reporter.reportApiInvoke({name:`${this.name}.setNsParams`,options:[e]});try{if(!this.workletHandler)throw Error("processor is not piped");let r=yield this.workletHandler;yield r.setParameters(e),t.onSuccess()}catch(e){throw t.onError(e),e}})}setAgcParams(e){return ia(this,void 0,void 0,function*(){let t=io.exports.reporter.reportApiInvoke({name:`${this.name}.setAgcParams`,options:[e]});try{if(!this.workletHandler)throw Error("processor is not piped");let r=yield this.workletHandler;yield r.setAgcParameters(e),t.onSuccess()}catch(e){throw t.onError(e),e}})}onEnableChange(){var e,t,r,i;return ia(this,void 0,void 0,function*(){if(this.enabled){if((null===(e=im.parameters)||void 0===e?void 0:e.ADJUST_3A_FROM_PLUGINS)&&(yield null===(t=this.context)||void 0===t?void 0:t.requestApplyConstraints(ic,this)),this.workletHandler){let e=yield this.workletHandler;yield e.enable(),io.exports.logger.debug("[ai-denoiser-processor] denoiser node enabled")}}else if((null===(r=im.parameters)||void 0===r?void 0:r.ADJUST_3A_FROM_PLUGINS)&&(yield null===(i=this.context)||void 0===i?void 0:i.requestRevertConstraints(this)),this.workletHandler){let e=yield this.workletHandler;yield e.disable(),io.exports.logger.debug("[ai-denoiser-processor] denoiser node disabled")}})}onPiped(e){if("function"!=typeof e.getDirection)throw Error("does not support sdk <4.15.0");this.workletHandler||(this.workletHandler=this.wasmSource.then(t=>{var r,i;io.exports.logger.debug(`[ai-denoiser-processor] denosier node init ${JSON.stringify(null===(r=im.parameters)||void 0===r?void 0:r.AI_DENOISER_PARAMETERS)}`);let n=Object.assign(Object.assign({},iu),null===(i=im.parameters)||void 0===i?void 0:i.AI_DENOISER_PARAMETERS);return iE.create(e.getAudioContext(),t,n.ains,n.agc,n.bufferTime,n.dumpBundleNums,n.threshold)}).then(e=>this.setup(e))),this.workletHandler=this.workletHandler.then(t=>{var r,i,n,o;this.enabled&&(null===(r=im.parameters)||void 0===r?void 0:r.ADJUST_3A_FROM_PLUGINS)&&e.requestApplyConstraints(ic,this),e.registerStats(this,"denoiser_stats",()=>{let e=this.stats;return this.stats=void 0,e});let a=e.getDirection(),s=null!==(o=null===(n=null===(i=im.parameters)||void 0===i?void 0:i.AI_DENOISER_PARAMETERS)||void 0===n?void 0:n.excludedLinks)&&void 0!==o?o:iA,c="remote"===a?"ainsV2Downlink":"ainsV2";return s.includes(a)||e.registerUsage(this,()=>ia(this,void 0,void 0,function*(){let e=yield t.getValue(),r=yield t.getLevel();return{id:c,level:null!=r?r:1,value:null!=e?e:1}})),t})}onUnpiped(){var e,t,r,i;if(this.context){let n=this.context;this.enabled&&(null===(e=im.parameters)||void 0===e?void 0:e.ADJUST_3A_FROM_PLUGINS)&&n.requestRevertConstraints(this),n.unregisterStats(this,"denoiser_stats");let o=null!==(i=null===(r=null===(t=im.parameters)||void 0===t?void 0:t.AI_DENOISER_PARAMETERS)||void 0===r?void 0:r.excludedLinks)&&void 0!==i?i:iA,a=n.getDirection();o.includes(a)||n.unregisterUsage(this)}}onNode(e,t){var r;null===(r=this.workletHandler)||void 0===r||r.then(r=>{var i;let n=r.node;try{null===(i=this.lastInputNode)||void 0===i||i.disconnect(n)}catch(e){}e.connect(n),this.lastInputNode=e,this.output(n,t),io.exports.logger.debug("[ai-denoiser-processor] connected worklet node"),n.onprocessorerror=r=>{io.exports.logger.error(`[ai-denoiser-processor] detected error from worklet node: ${r.error}`),this.output(e,t)}}).catch(r=>{io.exports.logger.error(`[ai-denoiser-processor] failed to pipe: ${r}`),this.emitAsPromiseNoResponse("loaderror",r),this.output(e,t)})}handleStatsEvent(e){let t=e.detail.stats;(++this.statsCount>=4||!this.stats)&&(this.statsCount=0,this.stats={ebn:0,ean:0,ns:0,vl:0}),t.ebn&&(this.stats.ebn=this.stats.ebn<<8&0xffffffff|255&t.ebn),t.ean&&(this.stats.ean=this.stats.ean<<8&0xffffffff|255&t.ean),t.ns&&(this.stats.ns=this.stats.ns<<8&0xffffffff|255&t.ns),t.vl&&(this.stats.vl=this.stats.vl<<8&0xffffffff|255&t.vl)}handleDump(e,t){let r=new Blob([e],{type:"audio/pcm"});this.emitAsPromiseNoResponse("dump",r,t)}handleDumpEvent(e){var t,r,i;let n=e.detail,o=n.dump,a=n.lts;(null===(t=o.input)||void 0===t?void 0:t.length)&&this.handleDump(o.input,`input_16000hz_1ch_${a}.pcm`),(null===(r=o.nsOut)||void 0===r?void 0:r.length)&&this.handleDump(o.nsOut,`ns_out_16000hz_1ch_${a}.pcm`),(null===(i=o.agcOut)||void 0===i?void 0:i.length)&&this.handleDump(o.agcOut,`agc_out_16000hz_1ch_${a}.pcm`)}handleOverloadEvent(e){let t=e.detail.elapsedTime;io.exports.logger.warning(`[ai-denoiser-processor] denoiser overload, elapsed time: ${t}ms`),this.emitAsPromiseNoResponse("overload",t)}setup(e){var t;return ia(this,void 0,void 0,function*(){return e.addEventListener("stats",this.handleStatsEvent.bind(this)),e.addEventListener("dump",this.handleDumpEvent.bind(this)),e.addEventListener("dumpend",()=>this.emitAsPromiseNoResponse("dumpend")),e.addEventListener("overload",this.handleOverloadEvent.bind(this)),this.enabled?(yield e.enable(),io.exports.logger.debug("[ai-denoiser-processor] denoiser node enabled")):(yield e.disable(),io.exports.logger.debug("[ai-denoiser-processor] denoiser node disabled")),(null===(t=im.parameters)||void 0===t?void 0:t.AI_DENOISER_PARAMETERS)&&(im.parameters.AI_DENOISER_PARAMETERS.nsParameters&&(yield e.setParameters(im.parameters.AI_DENOISER_PARAMETERS.nsParameters)),im.parameters.AI_DENOISER_PARAMETERS.agcParameters&&(yield e.setAgcParameters(im.parameters.AI_DENOISER_PARAMETERS.agcParameters))),io.exports.logger.debug("[ai-denoiser-processor] denoiser node initialized"),e})}}class iS extends io.exports.AudioExtension{constructor(e){super(),this.parameters=is,this.VERSION="1.1.0",this.BUILD="9019a23(11/10/2022, 5:31:24 PM)",this.wasmSource=(function(e){return ia(this,void 0,void 0,function*(){let t=yield(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))(),r=`${e}/${t?"denoiser-wasm-simd.wasm":"denoiser-wasm.wasm"}`,i=yield fetch(r);if(!i.ok)throw Error(`failed to load WASM, response status: ${i.status}`);return i})})(e.assetsPath).then(e=>e.arrayBuffer()),im.parameters=this.parameters,io.exports.logger.debug(`[ai-denoiser-extension] ${this.VERSION}, ${this.BUILD} constructor ${JSON.stringify(e)}`),io.exports.reporter.reportApiInvoke({name:"AIDenoiserExtension.constructor",options:[`${this.VERSION}_${this.BUILD}`]}).onSuccess()}checkCompatibility(){try{let e=iv()&&!!globalThis.WebAssembly&&!!globalThis.WebAssembly.compile;return io.exports.logger.debug(`[ai-denoiser-extension] supported AudioWorklet and WASM: ${e}`),e}catch(e){return!1}}_createProcessor(){io.exports.logger.debug("[ai-denoiser-extension] start create processor");let e=new ig({wasmSource:this.wasmSource});return e.on("loaderror",e=>{var t;return null===(t=this.onloaderror)||void 0===t?void 0:t.call(this,e)}),e}}for(var ib={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},iT=new Uint8Array(16),iy=[],iR=0;iR<256;++iR)iy.push((iR+256).toString(16).slice(1));var iI=function(e,t,r){if(ib.randomUUID&&!t&&!e)return ib.randomUUID();var i=(e=e||{}).random||(e.rng||function(){if(!eZ&&!(eZ="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return eZ(iT)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return function(e,t=0){return(iy[e[t+0]]+iy[e[t+1]]+iy[e[t+2]]+iy[e[t+3]]+"-"+iy[e[t+4]]+iy[e[t+5]]+"-"+iy[e[t+6]]+iy[e[t+7]]+"-"+iy[e[t+8]]+iy[e[t+9]]+"-"+iy[e[t+10]]+iy[e[t+11]]+iy[e[t+12]]+iy[e[t+13]]+iy[e[t+14]]+iy[e[t+15]]).toLowerCase()}(i)},iC=r("538660"),ik=r("475123"),iw=r("625505"),iO=r("605014"),iN=r("290782"),iP=r("364173");r("77554"),r("978315");let iD=!0,iL=!0;function iM(e,t,r){let i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function ix(e,t,r){if(!e.RTCPeerConnection)return;let i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return n.apply(this,arguments);let o=e=>{let t=r(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},!this._eventMap[t]&&(this._eventMap[t]=new Map),this._eventMap[t].set(i,o),n.apply(this,[e,o])};let o=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(r))return o.apply(this,arguments);let i=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function iU(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(iD=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function iB(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(iL=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function iV(){if("object"==typeof window){if(!iD)"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function iF(e,t){if(!!iL)console.warn(e+" is deprecated, please use "+t+" instead.")}function ij(e){return"[object Object]"===Object.prototype.toString.call(e)}function iG(e,t,r){let i=r?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;let o=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(r=>{r.type===i&&r.trackId===t.id&&!function e(t,r,i){if(!(!r||i.has(r.id)))i.set(r.id,r),Object.keys(r).forEach(n=>{n.endsWith("Id")?e(t,t.get(r[n]),i):n.endsWith("Ids")&&r[n].forEach(r=>{e(t,t.get(r),i)})})}(e,r,n)})}),n}function iW(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach(r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;let i="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);let n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[n("min",r)]=i.ideal,t.optional.push(e),(e={})[n("max",r)]=i.ideal):e[n("",r)]=i.ideal,t.optional.push(e)}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",r)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});let a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:("user"===o.exact||"user"===o.ideal)&&(t=["front"]),t)return r.mediaDevices.enumerateDevices().then(r=>{let a=(r=r.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!a&&r.length&&t.includes("back")&&(a=r[r.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),iV("chrome: "+JSON.stringify(e)),n(e)})}e.video=i(e.video)}return iV("chrome: "+JSON.stringify(e)),n(e)},o=function(e){return t.version>=64?e:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(e,t,i){n(e,e=>{r.webkitGetUserMedia(e,t,e=>{i&&i(o(e))})})}).bind(r),r.mediaDevices.getUserMedia){let e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return n(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(o(e))))}}}function iH(e,t){if((!e.navigator.mediaDevices||!("getDisplayMedia"in e.navigator.mediaDevices))&&!!e.navigator.mediaDevices){if("function"!=typeof t){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(t=>{let i=r.video&&r.video.width,n=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},i&&(r.video.mandatory.maxWidth=i),n&&(r.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(r)})}}}function iY(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function iK(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)ix(e,"track",e=>(!e.transceiver&&Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return!this._ontrackpoly&&(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.track.id):{track:r.track};let n=new Event("track");n.track=r.track,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)}),t.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.id):{track:r};let n=new Event("track");n.track=r,n.receiver=i,n.transceiver={receiver:i},n.streams=[t.stream],this.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function iQ(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let n=r.apply(this,arguments);return!n&&(n=t(this,e),this._senders.push(n)),n};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{let t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function iz(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,r,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0==arguments.length||"function"!=typeof e))return t.apply(this,[]);let n=function(e){let t={};return e.result().forEach(e=>{let r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{r[t]=e.stat(t)}),t[r.id]=r}),t},o=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};return arguments.length>=2?t.apply(this,[function(e){r(o(n(e)))},e]):new Promise((e,r)=>{t.apply(this,[function(t){e(o(n(t)))},r])}).then(r,i)}}function iX(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>iG(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),ix(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>iG(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,r;let i=arguments[0];if(this.getSenders().forEach(t=>{t.track===i&&(e?r=!0:e=t)}),this.getReceivers().forEach(e=>(e.track===i&&(t?r=!0:t=e),e.track===i)),r||e&&t)return Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError"));if(e)return e.getStats();else if(t)return t.getStats();return Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function iJ(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let t=this.getSenders();r.apply(this,arguments);let i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};let n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{let r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),n.apply(this,arguments)}}function iq(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return iJ(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){let r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};let n=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let n=this._streams[r.id];if(n)n.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let i=new e.MediaStream([t]);this._streams[r.id]=i,this._reverseStreams[i.id]=r,this.addStream(i)}return this.getSenders().find(e=>e.track===t)};["createOffer","createAnswer"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){let e=arguments,t=arguments.length&&"function"==typeof arguments[0];return t?r.apply(this,[t=>{let r=o(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(e=>o(this,e))}})[t]});let a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t;let r;if(!arguments.length||!arguments[0].type)return a.apply(this,arguments);return arguments[0]=(e=this,t=arguments[0],r=t.sdp,Object.keys(e._reverseStreams||[]).forEach(t=>{let i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})),a.apply(this,arguments)};let s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){let t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(r=>{this._streams[r].getTracks().find(t=>e.track===t)&&(t=this._streams[r])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function iZ(e,t){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection)t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}})[t]})}function i$(e,t){ix(e,"negotiationneeded",e=>{let r=e.target;if(!(t.version<72)&&(!r.getConfiguration||"plan-b"!==r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e})}function i0(e,t){let r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){iF("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(e((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},i&&i.prototype.getSettings){let t=i.prototype.getSettings;i.prototype.getSettings=function(){let r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(i&&i.prototype.applyConstraints){let t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(e(r=JSON.parse(JSON.stringify(r)),"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function i2(e,t){if((!e.navigator.mediaDevices||!("getDisplayMedia"in e.navigator.mediaDevices))&&!!e.navigator.mediaDevices)e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)}}function i1(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function i4(e,t){if("object"!=typeof e||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}})[t]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,o]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!n)try{e.forEach(e=>{e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(n,o)}}function i6(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function i3(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),ix(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function i8(e){if(!!e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype))e.RTCPeerConnection.prototype.removeStream=function(e){iF("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})}}function i5(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function i9(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);let r=(e=[...e]).length>0;r&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let i=t.apply(this,arguments);if(r){let{sender:t}=i,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(r).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function i7(e){if(!("object"==typeof e&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return!("encodings"in e)&&(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ne(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function nt(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function nr(e){if("object"==typeof e&&!!e.RTCPeerConnection){if(!("getLocalStreams"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.getLocalStreams=function(){return!this._localStreams&&(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){!this._localStreams&&(this._localStreams=[]),!this._localStreams.includes(e)&&this._localStreams.push(e),e.getAudioTracks().forEach(r=>t.call(this,r,e)),e.getVideoTracks().forEach(r=>t.call(this,r,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach(e=>{this._localStreams?!this._localStreams.includes(e)&&this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){!this._localStreams&&(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let r=e.getTracks();this.getSenders().forEach(e=>{r.includes(e.track)&&this.removeTrack(e)})})}}function ni(e){if("object"==typeof e&&!!e.RTCPeerConnection){if(!("getRemoteStreams"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(!this._remoteStreams&&(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);let t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return!this._onaddstreampoly&&this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(!e._remoteStreams&&(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let r=new Event("addstream");r.stream=t,e.dispatchEvent(r)})}),t.apply(e,arguments)}}}}function nn(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){let i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){let r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};let s=function(e,t,r){let i=n.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i};t.setLocalDescription=s,s=function(e,t,r){let i=o.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.setRemoteDescription=s,s=function(e,t,r){let i=a.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.addIceCandidate=s}function no(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(na(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}).bind(t))}function na(e){return e&&void 0!==e.video?Object.assign({},e,{video:function e(t){return ij(t)?Object.keys(t).reduce(function(r,i){let n=ij(t[i]),o=n?e(t[i]):t[i],a=n&&!Object.keys(o).length;return void 0===o||a?r:Object.assign(r,{[i]:o})},{}):t}(e.video)}):e}function ns(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){let t=[];for(let r=0;r<e.iceServers.length;r++){let i=e.iceServers[r];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(iF("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function nc(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function nd(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0===e.offerToReceiveAudio&&!t&&this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let r=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0===e.offerToReceiveVideo&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function nu(e){if("object"==typeof e&&!e.AudioContext)e.AudioContext=e.webkitAudioContext}var nl=r("133780"),nh=r.n(nl);function np(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){let r=new t(e),i=Object.assign(r,nh().parseCandidate(e.candidate));return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,ix(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function nf(e){if(!!e.RTCIceCandidate&&(!e.RTCIceCandidate||!("relayProtocol"in e.RTCIceCandidate.prototype)))ix(e,"icecandidate",e=>{if(e.candidate){let t=nh().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[t.priority>>24])}return e})}function n_(e,t){if(!e.RTCPeerConnection)return;!("sctp"in e.RTCPeerConnection.prototype)&&Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let r=function(e){if(!e||!e.sdp)return!1;let t=nh().splitSections(e.sdp);return t.shift(),t.some(e=>{let t=nh().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},i=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return -1;let r=parseInt(t[1],10);return r!=r?-1:r},n=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:0x7ffffff5:t.version<60?57===t.version?65535:65536:0x7ffffff5),r},o=function(e,r){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);let n=nh().matchPrefix(e.sdp,"a=max-message-size:");return n.length>0?i=parseInt(n[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=0x7ffffff5),i},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let e;let t=i(arguments[0]),r=n(t),a=o(arguments[0],t);e=0===r&&0===a?Number.POSITIVE_INFINITY:0===r||0===a?Math.max(r,a):Math.min(r,a);let s={};Object.defineProperty(s,"maxMessageSize",{get:()=>e}),this._sctp=s}return a.apply(this,arguments)}}function nA(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let r=e.send;e.send=function(){let i=arguments[0],n=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=r.apply(this,arguments);return t(e,this),e},ix(e,"datachannel",e=>(t(e.channel,e.target),e))}function nm(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{let r=t[e];t[e]=function(){return!this._connectionstatechangepoly&&(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function nv(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let r=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function nE(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.addIceCandidate;if(!!r&&0!==r.length)e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function ng(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.setLocalDescription;if(!!r&&0!==r.length)e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(!(e={type:e.type,sdp:e.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?r.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>r.apply(this,[e]))}}!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let r=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;let{navigator:r}=e;return r.mozGetUserMedia?(t.browser="firefox",t.version=iM(r.userAgent,/Firefox\/(\d+)\./,1)):r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection?(t.browser="chrome",t.version=iM(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./)?(t.browser="safari",t.version=iM(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype):t.browser="Not a supported browser.",t}(e),i={browserDetails:r,commonShim:r8,extractVersion:iM,disableLog:iU,disableWarnings:iB,sdp:nl};switch(r.browser){case"chrome":if(!r4||!iZ||!t.shimChrome){iV("Chrome shim is not included in this adapter release.");break}if(null===r.version){iV("Chrome shim can not determine version, not shimming.");break}iV("adapter.js shimming chrome."),i.browserShim=r4,nE(e,r),ng(e,r),iW(e,r),iY(e,r),iZ(e,r),iK(e,r),iq(e,r),iQ(e,r),iz(e,r),iX(e,r),i$(e,r),np(e,r),nf(e,r),nm(e,r),n_(e,r),nA(e,r),nv(e,r);break;case"firefox":if(!r6||!i4||!t.shimFirefox){iV("Firefox shim is not included in this adapter release.");break}iV("adapter.js shimming firefox."),i.browserShim=r6,nE(e,r),ng(e,r),i0(e,r),i4(e,r),i1(e,r),i8(e,r),i6(e,r),i3(e,r),i5(e,r),i9(e,r),i7(e,r),ne(e,r),nt(e,r),np(e,r),nm(e,r),n_(e,r),nA(e,r);break;case"safari":if(!r3||!t.shimSafari){iV("Safari shim is not included in this adapter release.");break}iV("adapter.js shimming safari."),i.browserShim=r3,nE(e,r),ng(e,r),ns(e,r),nd(e,r),nn(e,r),nr(e,r),ni(e,r),nc(e,r),no(e,r),nu(e,r),np(e,r),nf(e,r),n_(e,r),nA(e,r),nv(e,r);break;default:iV("Unsupported browser!")};}({window:"undefined"==typeof window?void 0:window});var nS=r("205929"),nb=r("380135");let nT=()=>{};function ny(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:nT};return e.promise=new Promise((t,r)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(t))}}),e}let nR=new Map,nI=new Map,nC=new Map;async function nk(e,t,r){nR.get(e)||nR.set(e,[]),nI.get(e)||nI.set(e,t),nC.get(e)||nC.set(e,0);let i=nR.get(e),n=nI.get(e);if(!i||!n)throw Error("concurrent: deferQueue or maxConcurrency is null");if(nC.get(e)===n){let e=ny();i.push(e),await e.promise}nC.set(e,nC.get(e)+1);for(var o=arguments.length,a=Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];let c=await r(...a);return nC.set(e,nC.get(e)-1),nC.get(e)===n-1&&i.length>0&&(i[0].resolve(),i.shift()),0===nC.get(e)&&(nR.set(e,[]),nI.set(e,0),nC.set(e,0)),c}let nw=((i={}).WIN_10="Windows 10",i.WIN_81="Windows 8.1",i.WIN_8="Windows 8",i.WIN_7="Windows 7",i.WIN_VISTA="Windows Vista",i.WIN_SERVER_2003="Windows Server 2003",i.WIN_XP="Windows XP",i.WIN_2000="Windows 2000",i.ANDROID="Android",i.HARMONY_OS="HarmonyOS",i.OPEN_BSD="Open BSD",i.SUN_OS="Sun OS",i.LINUX="Linux",i.IOS="iOS",i.MAC_OS="Mac OS",i.CHROMIUM_OS="Chromium OS",i.QNX="QNX",i.UNIX="UNIX",i.BEOS="BeOS",i.OS_2="OS/2",i.SEARCH_BOT="Search Bot",i),nO=((n={}).CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger",n),nN=new nS,nP=nN.getResult(),nD=null;function nL(e){if(!nD){e&&nN.setUA(e);let t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return nO.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return nO.CHROME;case"Safari":case"Mobile Safari":return nO.SAFARI;case"Edge":return nO.EDGE;case"Firefox":return nO.FIREFOX;case"QQ":case"QQBrowser":return nO.QQ;case"Opera":return nO.OPERA;case"WeChat":return nO.WECHAT;default:return e.browser.name||""}}(nP=nN.getResult()),r=nM(nP),i=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(nP),n=nP.os.version,o=nM(nP,!1),a=nP.device.type;if(!(t&&r&&i&&n))return{name:t,version:r,os:i,osVersion:n,browserVersion:o,deviceType:a};nD={name:t,version:r,os:i,osVersion:n,browserVersion:o,deviceType:a}}return nD}function nM(e){let t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function nx(){return nL().os}function nU(){let e=nL();return"".concat(e.os," ").concat(e.osVersion)}function nB(){let e=nL();return!!("WebKit"===nP.engine.name&&e.os===nw.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==nO.SAFARI||nW()&&e.name!==nO.SAFARI)}function nV(){return nL().name===nO.CHROME}function nF(){return nL().name===nO.SAFARI}function nj(){return nL().name===nO.EDGE}function nG(){return nL().name===nO.FIREFOX}function nW(){return nL().os===nw.IOS}function nH(e){let t=nL();return!(t.name!==nO.CHROME||!t.osVersion)&&Number(t.version)>=e}function nY(e,t,r){let i=nL();return!(i.name!==e||!i.osVersion)&&(r?Number(i.version)>=t&&Number(i.version)<=r:Number(i.version)===t)}function nK(e){let t=nL();return!(t.name!==nO.SAFARI||!t.osVersion)&&Number(t.version)>=e}function nQ(){let e=nL();if(e.os!==nw.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 14>Number(t[0])||14===Number(t[0])&&6>=Number(t[1])}function nz(){let e=nL();return e.os===nw.IOS&&!!e.osVersion&&15===Number(e.osVersion.split(".")[0])}function nX(){let e=nL();return e.os===nw.IOS&&!!e.osVersion&&16===Number(e.osVersion.split(".")[0])}function nJ(){let e=nL();if(e.os!==nw.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function nq(){return nF()&&navigator.maxTouchPoints>0}function nZ(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function n$(){let e=nx();return function(){let{deviceType:e}=nL();return"mobile"===e||"tablet"===e}()||e===nw.ANDROID||e===nw.IOS||e===nw.HARMONY_OS}function n0(){let e=nL();return e.name!==nO.EDGE&&e.name!==nO.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function n2(){return nx()===nw.ANDROID}function n1(){let e=nL();return n2()&&(e.name===nO.CHROME||e.name===nO.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function n4(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function n3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n6(Object(r),!0).forEach(function(t){n4(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n6(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let n8=((o={}).UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_READABLE="NOT_READABLE",o.NOT_SUPPORTED="NOT_SUPPORTED",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORTED="OPERATION_ABORTED",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",o.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",o.DATACHANNEL_FAILED="DATACHANNEL_FAILED",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",o.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",o.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",o.UID_CONFLICT="UID_CONFLICT",o.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",o.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",o.TOKEN_EXPIRE="TOKEN_EXPIRE",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",o.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",o.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",o.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",o.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",o.INVALID_PLUGIN="INVALID_PLUGIN",o.DISCONNECT_P2P="DISCONNECT_P2P",o.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",o.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",o.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",o.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",o.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",o.PROHIBITED_OPERATION="PROHIBITED_OPERATION",o.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",o.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",o);class n5 extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),n4(this,"code",void 0),n4(this,"message",void 0),n4(this,"data",void 0),n4(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}}function n9(e,t){if("boolean"!=typeof e)throw new n5(n8.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function n7(e,t,r){if(!r.includes(e))throw new n5(n8.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function oe(e,t){var r;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<i||e>n||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!("number"==typeof(r=e)&&r%1==0))throw new n5(n8.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(i,", ").concat(n,"]. integer only"))}function ot(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new n5(n8.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&oe(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&oe(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&oe(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&oe(e.ideal,"".concat(t,".ideal"),1,1/0)}else oe(e,t,1,1/0)}function or(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new n5(n8.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!oo(e,r,i,n))throw new n5(n8.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(i,"].").concat(n?" ASCII characters only.":""))}function oi(e,t){if(!Array.isArray(e))throw new n5(n8.INVALID_PARAMS,"".concat(t," should be an array"))}function on(e){return null==e}function oo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=r&&e.length>=t&&(!i||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){let r=e.charCodeAt(t);if(r<0||r>255)return!1}return!0}(e))}var oa=((a=oa||{}).COVERED="COVERED",a.POSITION="POSITION",a.SIZE="SIZE",a.STYLE="STYLE",a),os=((s=os||{}).UNMOUNTED="UNMOUNTED",s.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",s);let oc=new class{constructor(){n4(this,"_clientSize",null),n4(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),n4(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),n4(this,"getStyle",e=>window.getComputedStyle(e,null)),n4(this,"checkCssVisibleProperty",e=>{let t=!0,{display:r,visibility:i,opacity:n,filter:o}=this.getStyle(e);return("none"===r||["hidden","collapse"].includes(i)||.1>Number(n))&&(t=!1),!!t&&(o&&o.split(" ").filter(e=>["brightness","blur","opacity"].includes(e.split("(")[0])).map(e=>{let[t,r]=e.split(/\(|\)/);return[t,Number(r.match(/^[0-9\.]+/))]}).forEach(e=>{let[r,i]=e;switch(r){case"brightness":(i<.1||i>3)&&(t=!1);break;case"blur":i>3&&(t=!1);break;case"opacity":i<.1&&(t=!1)}}),t)}),n4(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,i=!0,n=e=>t(e),o=e;for(;o&&i;)n(o)||(r=!1,i=!1),(o=o.parentElement)||(i=!1);return r}),n4(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),n4(this,"getSizeAboutClient",e=>{let{width:t,height:r,left:i,right:n,top:o,bottom:a}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:r,left:i,right:n,top:o,bottom:a,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}}),n4(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),n4(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),n4(this,"checkCoverForAPoint",(e,t,r)=>{let i=this.elementFromPoint(e,t);return null!==i&&i!==r}),n4(this,"getPointPositionList",()=>{let{width:e,height:t,left:r,top:i}=this._clientSize,n=e/6,o=t/6,a=[];for(let e=0;e<5;e++)for(let t=0;t<5;t++){let s=(1e6*r+(0===e?.1:4===e?(n*e*1e6-1e5)/1e6:n*e)*1e6)/1e6,c=(1e6*i+(0===t?.1:4===t?(o*t*1e6-1e5)/1e6:o*t)*1e6)/1e6;a.push({x:s,y:c})}return[...a]}),n4(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(e=>!!e).length>6),n4(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),n4(this,"checkSizeOfPartInClient",()=>{let e,t,r;let{left:i,right:n,top:o,bottom:a,clientHeight:s,clientWidth:c,clientMin:d}=this._clientSize;if(i<0)e=0;else{if(!(i<c))return!1;e=i}if(n<0)return!1;if(t=n<c?n:c,o<0)r=0;else{if(!(o<s))return!1;r=o}if(a<0)return!1;let u=t-e,l=(a<s?a:s)-r;return this.checkSizeIsVisible(u,l,d)}),n4(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),n4(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(oa.COVERED);{let e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(oa.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(oa.SIZE)}}return this.returnHiddenResult(oa.STYLE)}return this.returnHiddenResult(os.UNMOUNTED)}return this.returnHiddenResult(os.INVALID_HTML_ELEMENT)}),n4(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))}};function od(e){return(new TextEncoder).encode(e)}let ou=function(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},ol=async e=>{let t=function(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)r[e]=t.charCodeAt(e);return r}("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),r=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=od(e);return function(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}(new Uint8Array(await window.crypto.subtle.encrypt({name:"RSA-OAEP"},r,i)))},oh=async e=>{var t,r;let i;return t=await crypto.subtle.digest("SHA-256",od(e)),r=16,i="",new Uint8Array(t).forEach(e=>{i+=e.toString(16).padStart(2,"0")}),i};class op{constructor(){n4(this,"_events",{}),n4(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],i=this._indexOfListener(r,t);-1!==i&&r.splice(i,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(e=>e);for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(let r=0;r<t.length;r+=1){let n=t[r];n.once&&this.off(e,n.listener),n.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];[...this._events[e]||[]].forEach(t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,r)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return -1}}let of=null;function o_(){if(of)return of;if(window.electron)return of=window.electron;if(!window.require)return null;try{return of=window.require("electron")}catch(e){return null}}let oA=((c={}).CREATE_CLIENT="createClient",c.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",c.SET_AREA="setArea",c.PRELOAD="PRELOAD",c.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",c.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",c.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",c.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",c.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",c.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",c.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",c.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",c.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",c.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",c.START_PROXY_SERVER="Client.startProxyServer",c.STOP_PROXY_SERVER="Client.stopProxyServer",c.SET_PROXY_SERVER="Client.setProxyServer",c.SET_TURN_SERVER="Client.setTurnServer",c.SET_CLIENT_ROLE="Client.setClientRole",c.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",c.ENABLE_DUAL_STREAM="Client.enableDualStream",c.DISABLE_DUAL_STREAM="Client.disableDualStream",c.JOIN="Client.join",c.LEAVE="Client.leave",c.PUBLISH="Client.publish",c.UNPUBLISH="Client.unpublish",c.SUBSCRIBE="Client.subscribe",c.MASS_SUBSCRIBE="Client.massSubscribe",c.MASS_UNSUBSCRIBE="Client.massUnsubscribe",c.UNSUBSCRIBE="Client.unsubscribe",c.RENEW_TOKEN="Client.renewToken",c.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",c.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",c.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",c.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",c.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",c.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",c.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",c.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",c.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",c.START_LIVE_STREAMING="Client.startLiveStreaming",c.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",c.STOP_LIVE_STREAMING="Client.stopLiveStreaming",c.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",c.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",c.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",c.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",c.SET_CONFIG_DISTRIBUTE="_configDistribute",c.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",c.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",c.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",c.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",c.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",c.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",c.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",c.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",c.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",c.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",c.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",c.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",c.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",c.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",c.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",c.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",c.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",c.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",c.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",c.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",c.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",c.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",c.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",c.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",c.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",c.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",c.STREAM_TYPE_CHANGE="streamTypeChange",c.CONNECTION_STATE_CHANGE="connectionStateChange",c.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",c.IMAGE_MODERATION_UPLOAD="imageModerationUpload",c.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",c),om=((d={}).TRACER="tracer",d);(u={})[u.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",u[u.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",u[u.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY";let ov=((l={}).LEAVE="LEAVE",l.NETWORK_ERROR="NETWORK_ERROR",l.SERVER_ERROR="SERVER_ERROR",l.UID_BANNED="UID_BANNED",l.FALLBACK="FALLBACK",l.IP_BANNED="IP_BANNED",l.CHANNEL_BANNED="CHANNEL_BANNED",l.LICENSE_MISSING="LICENSE_MISSING",l.LICENSE_EXPIRED="LICENSE_EXPIRED",l.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",l.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",l.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",l.LICENSE_ILLEGAL="LICENSE_ILLEGAL",l.TOKEN_EXPIRE="TOKEN_EXPIRE",l);function oE(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(e=>{if(!e.urls)throw Error()})}catch(e){return!1}return!0}function og(e){return void 0!==e.level&&n7(e.level,"level",[1,2,3]),void 0!==e.delay&&oe(e.delay,"delay",0,3e3,!0),!0}let oS=((h={}).PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",h.AUDIO_METADATA="audio-metadata",h.CONNECTION_STATE_CHANGE="connection-state-change",h.MEDIA_RECONNECT_START="media-reconnect-start",h.MEDIA_RECONNECT_END="media-reconnect-end",h.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",h.USER_JOINED="user-joined",h.USER_LEAVED="user-left",h.USER_PUBLISHED="user-published",h.USER_UNPUBLISHED="user-unpublished",h.USER_INFO_UPDATED="user-info-updated",h.CLIENT_BANNED="client-banned",h.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",h.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",h.VOLUME_INDICATOR="volume-indicator",h.CRYPT_ERROR="crypt-error",h.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",h.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",h.NETWORK_QUALITY="network-quality",h.STREAM_TYPE_CHANGED="stream-type-changed",h.STREAM_FALLBACK="stream-fallback",h.RECEIVE_METADATA="receive-metadata",h.STREAM_MESSAGE="stream-message",h.LIVE_STREAMING_ERROR="live-streaming-error",h.LIVE_STREAMING_WARNING="live-streaming-warning",h.EXCEPTION="exception",h.ERROR="error",h.P2P_LOST="p2p_lost",h.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",h.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",h.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",h.PUBLISHED_USER_LIST="published-user-list",h.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",h.CONTENT_INSPECT_ERROR="content-inspect-error",h.CONTENT_INSPECT_RESULT="content-inspect-result",h.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",h),ob=((p={}).NETWORK_ERROR="NETWORK_ERROR",p.SERVER_ERROR="SERVER_ERROR",p.MULTI_IP="MULTI_IP",p.TIMEOUT="TIMEOUT",p.OFFLINE="OFFLINE",p.LEAVE="LEAVE",p.P2P_FAILED="P2P_FAILED",p.FALLBACK="FALLBACK",p.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",p),oT=((f={}).ONLINE="ONLINE",f.OFFLINE="OFFLINE",f),oy=((_={}).NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",_.ONLINE="ONLINE",_.OFFLINE="OFFLINE",_);function oR(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return 0===e.getListeners(t).length?Promise.reject(new n5(n8.UNEXPECTED_ERROR,"can not emit promise")):new Promise((r,n)=>{e.emit(t,...i,r,n)})}function oI(e,t){if(0===e.getListeners(t).length)return Promise.resolve();for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return oR(e,t,...i)}function oC(e,t){if(0===e.getListeners(t).length)return null;for(var r=arguments.length,i=Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return ok(e,t,...i)}function ok(e,t){let r=null,i=null;for(var n=arguments.length,o=Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];if(e.emit(t,...o,e=>{r=e},e=>{i=e}),null!==i)throw i;if(null===r)throw new n5(n8.UNEXPECTED_ERROR,"handler is not sync");return r}let ow=new class extends op{set networkState(e){this.emit(oy.NETWORK_STATE_CHANGE,e,this._networkState),e===oT.ONLINE?this.emit(oy.ONLINE):e===oT.OFFLINE&&(this.onlineWaiter=new Promise(e=>{this.once(oy.ONLINE,()=>{this.onlineWaiter=void 0,e(oT.ONLINE)})}),this.emit(oy.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===oT.ONLINE}constructor(){super(),n4(this,"_moduleName","network-indicator"),n4(this,"_networkState",oT.ONLINE),n4(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=oT.ONLINE}),window.addEventListener("offline",()=>{this.networkState=oT.OFFLINE})}};function oO(e,t){let r=e.indexOf(t);-1!==r&&e.splice(r,1)}function oN(e){let t=[];return e.forEach(e=>{-1===t.indexOf(e)&&t.push(e)}),t}function oP(e){"undefined"!=typeof Promise?Promise.resolve().then(e):setTimeout(e,0)}function oD(e){return JSON.parse(JSON.stringify(e))}function oL(e){try{return oD(e)}catch(t){return e}}let oM={};function ox(e,t){oM[t]||(oM[t]=!0,e())}function oU(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)r[e]=t.charCodeAt(e);return r}function oB(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function oV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,r=(new TextEncoder).encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){let e=new Uint8Array(t);e.set(r),r=e}return r}function oF(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=new Uint8Array(new ArrayBuffer(t.reduce((e,t)=>e+t.length,0))),n=0;return t.forEach(e=>{i.set(e,n),n+=e.length}),i}function oj(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function oG(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(e=>{t+="string"==typeof e?oj(e):e.size}),t+138}function oW(e){return new Promise(t=>{window.setTimeout(t,e)})}function oH(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+oH(e-r.length,"")}function oY(){return oH(32,"").toUpperCase()}let oK=()=>{},oQ=new class{constructor(){n4(this,"fnMap",new Map)}throttleByKey(e,t,r,i){for(var n=arguments.length,o=Array(n>4?n-4:0),a=4;a<n;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){let n=this.fnMap.get(t);if(n.threshold!==r){n.fn(...n.args),clearTimeout(n.timer);let a=window.setTimeout(()=>{let e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:a,args:o,skipFn:i})}else n.skipFn&&n.skipFn(...n.args),this.fnMap.set(t,n3(n3({},n),{},{fn:e,args:o,skipFn:i}))}else{let n=window.setTimeout(()=>{let e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:n,args:o,skipFn:i})}}},oz=oQ.throttleByKey.bind(oQ);function oX(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function oJ(e,t){let r=[0];if(t&&(r=Array(t).fill(0)),0===e)return r;let i=0;for(;e>0&&(r[i]=255&e,e>>=8,i++,!t||i!==t););return r}function oq(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}let oZ=1,o$=console;class o0{static setLogger(e){o$=e}constructor(e,t){n4(this,"id",void 0),n4(this,"lockingPromise",Promise.resolve()),n4(this,"locks",0),n4(this,"name",""),n4(this,"lockId",void 0),this.lockId=oZ++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");o$.debug("".concat(r," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let r=new Promise(r=>{t=()=>{this.locks-=1,this.logger("unlocked",e),r()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),i}}function o2(e,t){return function(r,i,n){let o=n.value;if("function"!=typeof o)throw Error("Cannot use mutex on object property.");return n.value=async function(){let r=this[t];if(!r)throw Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let n=await r.lock("From ".concat(e,".").concat(i));try{for(var a=arguments.length,s=Array(a),c=0;c<a;c++)s[c]=arguments[c];return await o.apply(this,s)}finally{n()}},n}}let o1={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function o4(e,t){let r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function o6(e,t,r,i){let n=Object.assign({},o1,i),o=n.timeout,a=async()=>{var e;await (e=o,new Promise(t=>{window.setTimeout(t,e)})),o*=n.timeoutFactor,o=Math.min(n.maxRetryTimeout,o)},s=!1,c=new Promise(async(i,o)=>{t=t||(()=>!1),r=r||(()=>!0);for(let c=0;c<n.maxRetryCount;c+=1){if(s)return o(new n5(n8.OPERATION_ABORTED));try{let r=await e();if(!t(r,c)||c+1===n.maxRetryCount)return i(r);await a()}catch(e){if(!r(e,c)||c+1===n.maxRetryCount)return o(e);await a()}}});return c.cancel=()=>s=!0,c}let o3,o8=class{constructor(e){n4(this,"input",[]),n4(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){return 0===this.input.length?0:this.input.reduce((e,t)=>e+t)/this.input.length}},o5=0,o9=0;function o7(e,t,r,i){return new Promise((n,o)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),o5+=oj(t.data)):r&&(t.data.size?o5+=t.data.size:t.data instanceof FormData?o5+=oG(t.data):o5+=oj(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,nb.Z.request(t).then(e=>{"string"==typeof e.data?o9+=oj(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?o9+=e.data.byteLength:o9+=oj(JSON.stringify(e.data)),i&&n({data:e.data,headers:e.headers}),n(e.data)}).catch(e=>{nb.Z.isCancel(e)?o(new n5(n8.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new n5(n8.NETWORK_TIMEOUT,e.message)):e.response?o(new n5(n8.NETWORK_RESPONSE_ERROR,e.response.status)):o(new n5(n8.NETWORK_ERROR,e.message))})})}async function ae(e,t){let r=new Blob([t.data],{type:"buffer"});return await o7(e,n3(n3({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}let at=()=>"HTTPS"===(o3||o3||(o3=(window.location.protocol.split(":")[0]||"").toUpperCase())),ar=()=>void 0!==window.isSecureContext;function ai(e){if(Array.isArray(e))return e.map(e=>e);if(!an(e))return e;let t={};for(let r in e){let i=e[r];an(i)||Array.isArray(i)?t[r]=ai(i):t[r]=i}return t}function an(e){return!("object"!=typeof e||Array.isArray(e)||!e)}class ao{constructor(e){n4(this,"input",[]),n4(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}let aa={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},as={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:aa,remoteCandidate:aa},updateInterval:0},ac={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},ad={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},au={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},al={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};class ah{constructor(e,t){n4(this,"onFirstVideoReceived",void 0),n4(this,"onFirstVideoDecoded",void 0),n4(this,"onFirstAudioReceived",void 0),n4(this,"onFirstVideoDecodedTimeout",void 0),n4(this,"onFirstAudioDecoded",void 0),n4(this,"onSelectedLocalCandidateChanged",void 0),n4(this,"onSelectedRemoteCandidateChanged",void 0),n4(this,"videoIsReady",!1),n4(this,"videoIsReady2",{}),n4(this,"pc",void 0),n4(this,"options",void 0),n4(this,"intervalTimer",void 0),n4(this,"stats",ai(as)),n4(this,"isFirstVideoReceived",{}),n4(this,"isFirstVideoDecoded",{}),n4(this,"isFirstAudioReceived",{}),n4(this,"isFirstAudioDecoded",{}),n4(this,"isFirstVideoDecodedTimeout",{}),n4(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Promise(e=>{e({local:n3({},aa),remote:n3({},aa)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,r=0,i=0,n=0,o=0;for(let a of["videoSend","audioSend","videoRecv","audioRecv"])e[a].forEach((e,s)=>{if(!this.lossRateWindowStats[t-1][a][s]||!this.lossRateWindowStats[0][a][s])return;let c=this.lossRateWindowStats[t-1][a][s].packets-this.lossRateWindowStats[0][a][s].packets,d=this.lossRateWindowStats[t-1][a][s].packetsLost-this.lossRateWindowStats[0][a][s].packetsLost;"videoSend"===a||"audioSend"===a?(r+=c,n+=d):(i+=c,o+=d),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||d<=0?0:d/(c+d)});e.sendPacketLossRate=r<=0||n<=0?0:n/(r+n),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}}class ap extends ah{constructor(){super(...arguments),n4(this,"_stats",as),n4(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=ai(as);let r=t.filter(e=>"ssrc"===e.type);this.processSSRCStats(r);let i=t.find(e=>"VideoBwe"===e.type);i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(e=>{let t=e.id.includes("send");switch("".concat(e.mediaType,"_").concat(t?"send":"recv")){case"video_send":{let t=ai(ad);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{let t=ai(ac),r=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),r){let i=r.stats,n=Date.now()-r.lts;t.framesDecodeFreezeTime=i.framesDecodeFreezeTime,t.framesDecodeInterval=i.framesDecodeInterval,t.framesDecodeCount>i.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=n,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:n3({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{let t=ai(al);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{let t=ai(au);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t)}}})}_getStats(){return new Promise((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(e=>{let r={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(t=>{r[t]=e.stat(t)}),t.push(r)}),t}}let af=((A={}).BANDWIDTH="bandwidth",A.CPU="cpu",A.NONE="none",A.OTHER="other",A),a_=((m={}).L1T1="L1T1",m.L1T2="L1T2",m.L1T3="L1T3",m.L1T3_KEY="L1T3_KEY",m.L2T1_KEY="L2T1_KEY",m.L2T2_KEY="L2T2_KEY",m.L2T3_KEY="L2T3_KEY",m.L3T1_KEY="L3T1_KEY",m.L3T2_KEY="L3T2_KEY",m.L3T3_KEY="L3T3_KEY",m),aA=((v={})[v.new=0]="new",v[v.connecting=1]="connecting",v[v.connected=2]="connected",v[v.disconnected=3]="disconnected",v[v.failed=4]="failed",v[v.closed=5]="closed",v),am=((E={}).CERTIFICATE="certificate",E.CODEC="codec",E.CANDIDATE_PAIR="candidate-pair",E.LOCAL_CANDIDATE="local-candidate",E.REMOTE_CANDIDATE="remote-candidate",E.INBOUND="inbound-rtp",E.TRACK="track",E.OUTBOUND="outbound-rtp",E.PC="peer-connection",E.REMOTE_INBOUND="remote-inbound-rtp",E.REMOTE_OUTBOUND="remote-outbound-rtp",E.TRANSPORT="transport",E.CSRC="csrc",E.DATA_CHANNEL="data-channel",E.STREAM="stream",E.SENDER="sender",E.RECEIVER="receiver",E);var av=((g=av||{})[g.kNone=1]="kNone",g[g.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",g[g.kBytesToBits=8]="kBytesToBits",g);function aE(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:av.kNone;if(!t)return;let o=Number(t[r]);if("number"!=typeof o)return;let a=Number(t[i]);if("number"!=typeof a)return;if(!e)return a?o/a*n:void 0;let s=Number(e[r]);if("number"!=typeof s)return;let c=Number(e[i]);if("number"!=typeof c)return;let d=a-c;return d?(o-s)/d*n:void 0}class ag extends ah{constructor(){super(...arguments),n4(this,"_stats",as),n4(this,"report",void 0),n4(this,"lastDecodeVideoReceiverStats",new Map),n4(this,"lastVideoFramesRecv",new Map),n4(this,"lastVideoFramesSent",new Map),n4(this,"lastVideoFramesDecode",new Map),n4(this,"lastVideoFramesOutput",new Map),n4(this,"lastVideoJBDelay",new Map),n4(this,"lastAudioJBDelay",new Map),n4(this,"mediaBytesSent",new Map),n4(this,"mediaBytesRetransmit",new Map),n4(this,"mediaBytesTargetEncode",new Map),n4(this,"lastDecodeAudioReceiverStats",new Map),n4(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ai(as),this.report.forEach(e=>{switch(e.type){case am.OUTBOUND:case am.INBOUND:{let t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===am.OUTBOUND?"audio"===t||i?this.processAudioOutboundStats(e):("video"===t||r)&&this.processVideoOutboundStats(e):e.type===am.INBOUND&&("audio"===t||i?this.processAudioInboundStats(e):("video"===t||r)&&this.processVideoInboundStats(e));break}case am.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case am.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:n3({},aa),remote:n3({},aa)};return e.forEach(r=>{let i;if(r.type===am.TRANSPORT&&(i=e.get(r.selectedCandidatePairId)),r.type===am.CANDIDATE_PAIR&&r.selected&&(i=r),i){let r=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(i.localCandidateId){let n=e.get(i.localCandidateId);n&&r(t.local,n)}if(i.remoteCandidateId){let n=e.get(i.remoteCandidateId);n&&r(t.remote,n)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===am.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===am.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===am.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(n3({},t),n3({},this.stats.selectedCandidatePair.localCandidate)),e.type===am.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(n3({},t),n3({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(t=>t.ssrc===e.ssrc);t||(t=ai(al),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=aE(r,t,"totalProcessingDelay","jitterBufferEmittedCount",av.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,n3({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find(t=>t.ssrc===e.ssrc);t||(t=ai(ac),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let r=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),n=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let e=t.decodedFrame?t.decodedFrame.width:0,r=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,r),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){let i=r.stats,n=o-r.lts;t.framesDecodeFreezeTime=i.framesDecodeFreezeTime,t.framesDecodeInterval=i.framesDecodeInterval,this.isFirstVideoDecoded[t.ssrc]||!(n>this.options.firstVideoDecodedTimeout)||this.isFirstVideoDecodedTimeout[t.ssrc]||(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>i.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=n,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<i.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=aE(null==r?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=aE(null==r?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",av.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=aE(null==r?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",av.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=aE(null==r?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",av.kMillisecondsFromSeconds),i&&o-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(n&&o-n.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-n.count)/((o-n.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):n?t.outputFrameRate=n.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:n3({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(t=>t.ssrc===e.ssrc);t||(t=ai(ad),this._stats.videoSend.push(t));let r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{let t=new ao(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){let t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{let t=new ao(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){let t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{let t=new ao(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){let r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let i=e.framesEncoded-r.lastFrameCount,n=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*n/i}}if(e.framesEncoded&&e.qpSum){let r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,am.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(t=>t.ssrc===e.ssrc);if(t||(t=ai(au),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,am.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){let r=Array.from(this.report.values()).find(r=>r.type===t&&r.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){let r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){let r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var i,n,o,a;let s=t?this.report.get(t):void 0,c=null!==(i=null==s?void 0:s.framesSent)&&void 0!==i?i:e.framesSent;if("number"!=typeof c)return;let d=null!==(n=null==s?void 0:s.frameWidth)&&void 0!==n?n:e.frameWidth,u=null!==(o=null==s?void 0:s.frameHeight)&&void 0!==o?o:e.frameHeight,l=null!==(a=null==s?void 0:s.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof d&&"number"==typeof u||(d=0,u=0),null==l){let e=Date.now(),t=this.lastVideoFramesSent.get(r.ssrc);t&&e-t.lts>=800?(l=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:e,rate:l})):t?l=t.rate:this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:e,rate:0})}r.sentFrame={width:d,height:u,frameRate:Math.max(0,l)}}processVideoTrackReceiverStats(e,t,r){var i,n,o,a,s;let c=t?this.report.get(t):void 0,d=null!==(i=null==c?void 0:c.framesReceived)&&void 0!==i?i:e.framesReceived,u=null!==(n=null==c?void 0:c.frameWidth)&&void 0!==n?n:e.frameWidth,l=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,h=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof d){let e=this.lastVideoFramesRecv.get(r.ssrc),t=Date.now();r.framesReceivedCount=d;let i=0;e&&t-e.lts>=800?(i=Math.round((d-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:t,rate:i})):e?i=e.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:t,rate:0}),r.receivedFrame={width:u||0,height:l||0,frameRate:i||0},r.decodedFrame={width:u||0,height:l||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:u||0,height:l||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(h&&p){let e=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},t=e.jitterBufferMs,i=p-e.jitterBufferEmittedCount;i>0&&(t=1e3*(h-e.jitterBufferDelay)/i),r.jitterBufferMs=t,r.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var i,n,o,a;let s=t?this.report.get(t):void 0,c=null!==(i=null!==(n=null==s?void 0:s.echoReturnLoss)&&void 0!==n?n:e.echoReturnLoss)&&void 0!==i?i:0,d=null!==(o=null!==(a=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==o?o:0;r.aecReturnLoss=c,r.aecReturnLossEnhancement=d}processAudioTrackReceiverStats(e,t,r){var i,n,o,a,s,c,d;let u=t?this.report.get(t):void 0,l=null!==(i=null==u?void 0:u.removedSamplesForAcceleration)&&void 0!==i?i:e.removedSamplesForAcceleration,h=null!==(n=null==u?void 0:u.totalSamplesReceived)&&void 0!==n?n:e.totalSamplesReceived,p=null!==(o=null==u?void 0:u.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,f=null!==(a=null==u?void 0:u.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,_=null!==(s=null==u?void 0:u.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,A=null!==(c=null==u?void 0:u.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,m=null!==(d=null==u?void 0:u.concealedSamples)&&void 0!==d?d:e.concealedSamples;if("number"==typeof h&&(r.totalSamplesReceived=h),l&&h&&(r.accelerateRate=l/h),p&&f){let e=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},t=e.jitterBufferMs,i=f-e.jitterBufferEmittedCount;i>0&&(t=1e3*(p-e.jitterBufferDelay)/i),r.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:f,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=_;let v=1920;A&&h&&(v=h/A/50,r.receivedFrames=Math.round(h/v)),m&&(r.droppedFrames=Math.round(m/v))}processRemoteInboundStats(e,t){let r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(t=>{e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(e=>{t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(e=>{r=null===r?e.diffMean():r+e.diffMean()});let i=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==r&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class aS extends ah{updateStats(){return Promise.resolve()}}let ab="websdk_ng_install_id";function aT(){try{if(function(e){return aP[e]}("INSTALL_ID"))return function(e){return aP[e]}("INSTALL_ID");let e=window.localStorage.getItem(ab);return e||(e=oY(),window.localStorage.setItem(ab,e)),aD("INSTALL_ID",e),e}catch(e){return}}let ay=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let e=t[1],r=t[2];return"".concat(e,".").concat(r)}return"4.0.0.999"}("4.23.2-1"),aR=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let aI=((S={}).Default="default",S.Auto="auto",S.Relay="relay",S.SdRtn="sd-rtn",S),aC=function(){let e=["t","s","t"];e.splice(1,0,"e");let t=e.join(""),r=[];for(let e=0;e<6;e++)r.push("1");let i=r.join(""),n={};return n["us".concat("erna","me")]=t,n["pa".concat("sswo","rd")]=i,Object.assign(n,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=aC;let ak={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},aw={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},aO="v4.23.2-1-0-g7fdaa39d-dirty(3/20/2025, 3:17:24 PM)",aN={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},aP=n3(n3(n3({},aN),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:aw,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},ak),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function aD(e,t,r){var i;Object.keys(aP).includes(e)&&(!r&&Object.keys(ax).includes(e)||(aP[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS_METADATA"!==e||!0!==t||(aP.ENABLE_ENCODED_TRANSFORM=!0,"ENABLE_AUDIO_PTS_METADATA"===e&&(aP.ENABLE_AUDIO_METADATA=!0)),"USE_NEW_NETWORK_CONFIG"===e&&t&&(i=!!t,aP.USE_NEW_NETWORK_CONFIG=i,i&&(aP.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],aP.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],aP.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],aP.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],aP.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",aP.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",aP.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(aP.ENABLE_INSTANT_VIDEO=!0,aP.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(aP.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(aP.NEW_TURN_MODE||(aP.NEW_TURN_MODE=4))))}function aL(e){return aP[e]}aR||(aP.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],aP.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],aP.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],aP.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],aP.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],aP.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],aP.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",aP.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",aP.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",aP.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",aP.AREAS=["NORTH_AMERICA","OVERSEA"]);let aM=((b={})[b.REALTIME=1]="REALTIME",b),ax={};var aU=((T=aU||{}).SET_SESSION_ID="SET_SESSION_ID",T.SET_P2P_ID="SET_P2P_id",T.SET_DC_ID="SET_DC_id",T.SET_UID="SET_UID",T.SET_INT_UID="SET_INT_UID",T.SET_PUB_ID="SET_PUB_ID",T.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",T.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",T.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",T.AVOID_JOIN_START="AVOID_JOIN_START",T.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",T.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",T.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",T.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",T.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",T.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",T.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",T.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",T.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",T.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",T.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",T.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",T.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",T.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",T.RESET_KEY_METRICS="RESET_KEY_METRICS",T.SET_USE_P2P="SET_USE_P2P",T.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",T);class aB{constructor(e,t,r,i){n4(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:aI.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case aU.SET_SESSION_ID:return n3(n3({},e),{},{sessionId:t.sessionId});case aU.SET_P2P_ID:return n3(n3({},e),{},{p2pId:t.p2pId});case aU.SET_UID:return n3(n3({},e),{},{uid:t.uid});case aU.SET_INT_UID:return n3(n3({},e),{},{intUid:t.intUid});case aU.SET_PUB_ID:return n3(n3({},e),{},{pubId:t.pubId});case aU.KEY_METRIC_CLIENT_CREATED:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{clientCreated:t.metric})});case aU.KEY_METRIC_JOIN_START:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{joinStart:t.metric})});case aU.AVOID_JOIN_START:return n3(n3({},e),{},{avoidJoinStart:t.avoidJoinStart});case aU.KEY_METRIC_JOIN_END:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{joinEnd:t.metric})});case aU.KEY_METRIC_REQUEST_AP_START:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{requestAPStart:t.metric})});case aU.KEY_METRIC_REQUEST_AP_END:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{requestAPEnd:t.metric})});case aU.KEY_METRIC_JOIN_GATEWAY_START:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case aU.KEY_METRIC_JOIN_GATEWAY_END:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case aU.KEY_METRIC_PEER_CONNECTION_START:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case aU.KEY_METRIC_PEER_CONNECTION_END:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case aU.KEY_METRIC_DESCRIPTION_START:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{descriptionStart:t.metric})});case aU.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case aU.KEY_METRIC_ICE_CONNECTION_END:return n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case aU.KEY_METRIC_PUBLISH:{let r=e.keyMetrics.publish,i=r.findIndex(e=>e.trackId===t.metric.trackId);return -1!==i?(r[i]=n3(n3({},r[i]),t.metric),n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{publish:[...r]})})):n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case aU.KEY_METRIC_SUBSCRIBE:{let r=e.keyMetrics.subscribe,i=r.findIndex(e=>e.userId===t.metric.userId&&e.type===t.metric.type);return -1!==i?(r[i]=n3(n3({},r[i]),t.metric),n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{subscribe:[...r]})})):n3(n3({},e),{},{keyMetrics:n3(n3({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case aU.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case aU.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=n3(n3({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case aU.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case aU.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case aU.SET_USE_P2P:return n3(n3({},e),{},{useP2P:t.val});case aU.SET_TRANSPORT_TYPE:return n3(n3({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:aU.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:aU.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:aU.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:aU.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:aU.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:aU.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:aU.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:aU.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:aU.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:aU.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:aU.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:aU.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:aU.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:aU.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:aU.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:aU.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:aU.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:aU.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:aU.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:aU.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:aU.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,r,i){this.dispatch({type:aU.KEY_METRIC_PUBLISH,metric:n3(n3({trackId:e,type:t},r&&{publishStart:r}),i&&{publishEnd:i})})}subscribe(e,t,r,i,n,o,a){this.dispatch({type:aU.KEY_METRIC_SUBSCRIBE,metric:n3(n3(n3(n3(n3({userId:e,type:t},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),n&&{firstFrame:n}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,t,r,i){e.forEach(e=>{this.dispatch({type:aU.KEY_METRIC_SUBSCRIBE,metric:n3(n3(n3({userId:e.userId,type:e.type},t&&{subscribeStart:t}),r&&{subscribeEnd:r}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map(e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof t?(this.dispatch({type:aU.RECORD_JOIN_CHANNEL_SERVICE,record:n3(n3({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:aU.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:aU.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:aU.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:aU.AVOID_JOIN_START,avoidJoinStart:e})}}let aV=((y={}).h264="h264",y.h265="h265",y.vp8="vp8",y.vp9="vp9",y.av1="av1",y);(R={}).opus="opus",R.pcma="pcma",R.pcmu="pcmu",R.g722="g722";let aF=0;async function aj(e,t,r){let i=Array.from(r).reduce((e,t)=>e+t,0),n={serverTs:0,seq:aF++,length:r.length,checkSum:i},o=new Uint8Array(oJ(i,2)),a=new ArrayBuffer(10),s=new DataView(a);s.setUint32(0,n.serverTs),s.setUint16(4,n.seq),s.setUint16(6,n.length),s.setUint16(8,n.checkSum);let c=16-r.length%16;r=oF(r,new Uint8Array(c));let d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:128,additionalData:o},t,r);return oF(new Uint8Array(a),new Uint8Array(d))}async function aG(e,t,r){let i=r.subarray(0,10),n=i.slice(8,10),o=(n[0]<<8)+n[1],a=(i[6]<<8)+i[7],s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:128,additionalData:new Uint8Array(oJ(o,2))},t,r.subarray(10));return r=new Uint8Array(s).subarray(0,a)}async function aW(e,t,r){let i=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),n="aes-128-gcm2"===e?128:256;return new Uint8Array(await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:r},i,n+96)).subarray(n/8)}async function aH(e,t,r){let i=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]);return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:r},i,{name:"AES-GCM",length:"aes-128-gcm2"===e?128:256},!0,["encrypt","decrypt"])}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var aY={exports:{}}.exports=(()=>{var e={8:(e,t,r)=>{var i;let n;r.r(t),r.d(t,{Parser:()=>S,Printer:()=>I,parse:()=>O,print:()=>N});let o="".concat("\r").concat("\n");function a(e){return e>="0"&&e<="9"}function s(e){return e>="!"&&e<="~"}function c(e){return s(e)||e>="\x80"&&e<="\xff"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function l(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function h(e){return"d"===e||"h"===e||"m"===e||"s"===e}function p(e){return e>"\x01"&&e<"	"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function f(e){return l(e)||a(e)||"+"===e||"/"===e}function _(e){return a(e)||l(e)||"+"===e||"/"===e||"-"===e||"_"===e}function A(e){return l(e)||a(e)||"+"===e||"/"===e}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach(function(t){E(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}(i=n||(n={})).VERSION="v",i.ORIGIN="o",i.SESSION_NAME="s",i.INFORMATION="i",i.URI="u",i.EMAIL="e",i.PHONE="p",i.CONNECTION="c",i.BANDWIDTH="b",i.TIME="t",i.REPEAT="r",i.ZONE_ADJUSTMENTS="z",i.KEY="k",i.ATTRIBUTE="a",i.MEDIA="m";class g{consumeText(e,t){let r=t;for(;r<e.length;){let t=e[r];if("\0"===t||"\r"===t||"\n"===t)break;r+=1}if(r-t==0)throw Error("Invalid text, at ".concat(e));return r}consumeUnicastAddress(e,t,r){return this.consumeTill(e,t," ")}consumeOneOrMore(e,t,r){let i=t;for(;r(e[i]);)i++;if(i-t==0)throw Error("Invalid rule at ".concat(t,"."));return i}consumeSpace(e,t){if(" "===e[t])return t+1;throw Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let r=t;for(let t=0;t<4;t++)if(r=this.consumeDecimalUChar(e,r),3!==t){if("."!==e[r])throw Error("Invalid IP4 address.");r++}return r}consumeDecimalUChar(e,t){let r=t;for(let t=0;t<3&&a(e[r]);t++,r++);if(r-t==0)throw Error("Invalid decimal uchar.");let i=parseInt(e.slice(t,r));if(i>=0&&i<=255)return r;throw Error("Invalid decimal uchar")}consumeIP6Address(e,t){let r=this.consumeHexpart(e,t);return":"===e[r]?(r+=1,r=this.consumeIP4Address(e,r)):r}consumeHexpart(e,t){let r=t;if(":"===e[r]&&":"===e[r+1]){r+=2;try{r=this.consumeHexseq(e,r)}catch(e){}return r}if(r=this.consumeHexseq(e,r),":"===e[r]&&":"===e[r+1]){r+=2;try{r=this.consumeHexseq(e,r)}catch(e){}}return r}consumeHexseq(e,t){let r=t;for(;r=this.consumeHex4(e,r),":"===e[r]&&":"!==e[r+1];)r+=1;return r}consumeHex4(e,t){var r;let i=0;for(;i<4;i++)if(!((r=e[t+i])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===i)throw Error("Invalid hex 4");break}return t+i}consumeFQDN(e,t){let r=t;for(;a(e[r])||l(e[r])||"-"===e[r]||"."===e[r];)r+=1;if(r-t<4)throw Error("Invalid FQDN");return r}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,c)}consumeMulticastAddress(e,t,r){switch(r){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(r){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){let r=this.consumeHexpart(e,t);return"/"===e[r]?this.consumeInteger(e,r+1):r}consumeIP4MulticastAddress(e,t){let r=t+3,i=parseInt(e.slice(t,r));if(i<224||i>239)throw Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let t=0;t<3;t++){if("."!==e[r])throw Error("Invalid IP4 multicast address.");r+=1,r=this.consumeDecimalUChar(e,r)}return"/"===e[r]&&(r+=1),r=this.consumeTTL(e,r),"/"===e[r]&&(r=this.consumeInteger(e,r)),r}consumeInteger(e,t){if(!u(e[t]))throw Error("Invalid integer.");for(t+=1;a(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw Error("Invalid TTL.");t+=1;for(let r=0;r<2&&a(e[t]);r++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let r=t;if("0"===e[r])return r+1;for(u(e[r])&&(r+=1);a(e[r]);)r++;if(r-t<10)throw Error("Invalid time");return r}consumeAddress(e,t){return this.consumeTill(e,t," ")}consumeTypedTime(e,t){let r=t;return r=this.consumeOneOrMore(e,r,a),h(e[r])?r+1:r}consumeRepeatInterval(e,t){if(!u(e[t]))throw Error("Invalid repeat interval");for(t+=1;a(e[t]);)t+=1;return h(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,a)}consume(e,t,r){for(let i=0;i<r.length;i++){if(t+i>=e.length)throw Error("consume exceeding value length");if(e[t+i]!==r[i])throw Error("consume ".concat(r," failed at ").concat(i))}return t+r.length}consumeTill(e,t,r){let i=t;for(;i<e.length&&("string"!=typeof r||e[i]!==r)&&("function"!=typeof r||!r(e[i]));)i++;return i}}class S extends g{constructor(){super(),E(this,"records",[]),E(this,"currentLine",0)}parse(e){let t=this.probeEOL(e);this.records=e.split(t).filter(e=>!!e.trim()).map(this.parseLine),this.currentLine=0;let r=this.parseVersion(),i=this.parseOrigin(),n=this.parseSessionName(),o=this.parseInformation(),a=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),d=this.parseConnection(),u=this.parseBandWidth(),l=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw Error("parsing failed, non exhaustive sdp lines.");return{version:r,origin:i,sessionName:n,information:o,uri:a,emails:s,phones:c,connection:d,bandwidths:u,timeFields:l,key:h,attributes:p,mediaDescriptions:f}}getCurrentRecord(){let e=this.records[this.currentLine];if(!e)throw Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if("\n"===e[t])return"\r"===e[t-1]?o:"\n";throw Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let r=e[0];if("="!==e[1])throw Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:r,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){let e=new T;for(;this.currentLine<this.records.length;){let t=this.getCurrentRecord();if(t.type!==n.ATTRIBUTE)break;let r={attField:this.extractOneOrMore(t,e=>d(e)&&":"!==e),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,r.attValue=this.extractOneOrMore(t,p)),e.parse(r),this.currentLine++}return e.digest()}parseMediaAttributes(e){let t=new y(e);for(;this.currentLine<this.records.length;){let e=this.getCurrentRecord();if(e.type!==n.ATTRIBUTE)break;let r={attField:this.extractOneOrMore(e,e=>d(e)&&":"!==e),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,r.attValue=this.extractOneOrMore(e,p)),t.parse(r),this.currentLine++}return t.digest()}parseKey(){let e=this.getCurrentRecord();if(e.type===n.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,Error("Invalid key.")}}parseZone(){let e=this.getCurrentRecord();if(e.type===n.ZONE_ADJUSTMENTS){let t=[];for(;;)try{let r=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let i=!1;"-"===e.value[e.cur]&&(i=!0,e.cur+=1);let n=this.extract(e,this.consumeTypedTime);t.push({time:r,typedTime:n,back:i})}catch(e){break}if(0===t.length)throw Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==n.REPEAT)break;{let r=this.extract(t,this.consumeRepeatInterval),i=this.parseTypedTime(t);e.push({repeatInterval:r,typedTimes:i}),this.currentLine++}}return e}parseTypedTime(e){let t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw Error("Invalid typed time.");return t}parseTime(){let e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:r}}parseBandWidth(){let e=[];for(;this.currentLine<this.records.length;){let t=this.getCurrentRecord();if(t.type!==n.BANDWIDTH)break;{let r=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw Error("Invalid bandwidth field.");t.cur++;let i=this.extractOneOrMore(t,a);e.push({bwtype:r,bandwidth:i}),this.currentLine++}}return e}parseVersion(){let e=this.getCurrentRecord();if(e.type!==n.VERSION)throw Error("first sdp record must be version");let t=e.value.slice(0,this.consumeOneOrMore(e.value,0,a));if(t.length!==e.value.length)throw Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){let e=this.getCurrentRecord();if(e.type!==n.ORIGIN)throw Error("second line of sdp must be origin");let t=this.extractOneOrMore(e,c);this.consumeSpaceForRecord(e);let r=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);let i=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);let o=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let s=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let u=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:r,sessVersion:i,nettype:o,addrtype:s,unicastAddress:u}}parseSessionName(){let e=this.getCurrentRecord();if(e.type===n.SESSION_NAME){let t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){let e=this.getCurrentRecord();if(e.type!==n.INFORMATION)return;let t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){let e=this.getCurrentRecord();if(e.type===n.URI)return this.currentLine++,e.value}parseEmail(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==n.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==n.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){let e=this.getCurrentRecord();if(e.type===n.CONNECTION){let t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let r=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let i=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:r,address:i}}}parseMedia(){let e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let r=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,r+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);let i=[];for(i.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,i.push(this.extract(e,this.consumeToken));if(0===i.length)throw Error("Invalid proto");let n=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:r,protos:i,fmts:n}}parseTimeFields(){let e=[];for(;this.getCurrentRecord().type===n.TIME;){let t=this.parseTime(),r=this.parseRepeat(),i=this.parseZone();e.push({time:t,repeats:r,zones:i})}return e}parseMediaDescription(){let e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===n.MEDIA;){let t=this.parseMedia(),r=this.parseInformation(),i=this.parseConnections(),n=this.parseBandWidth(),o=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:r,connections:i,bandwidths:n,key:o,attributes:a})}return e}parseConnections(){let e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===n.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){let t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw Error("Invalid fmts");return t}extract(e,t,...r){let i=t.call(this,e.value,e.cur,...r),n=e.value.slice(e.cur,i);return e.cur=i,n}extractOneOrMore(e,t){let r=this.consumeOneOrMore(e.value,e.cur,t),i=e.value.slice(e.cur,r);return e.cur=r,i}consumeSpaceForRecord(e){if(" "!==e.value[e.cur])throw Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class b extends g{constructor(...e){super(...e),E(this,"attributes",void 0),E(this,"digested",!1)}extractOneOrMore(e,t,r){let i=this.consumeOneOrMore(e.attValue,e._cur,t),n=e.attValue.slice(e._cur,i),[o,a]=r||[];if("number"==typeof o&&n.length<o)throw Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof a&&n.length>a)throw Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=i,n}consumeAttributeSpace(e){if(" "!==e.attValue[e._cur])throw Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t,...r){if(!e.attValue)throw Error("Nothing to extract from attValue.");let i=t.call(this,e.attValue,e._cur,...r),n=e.attValue.slice(e._cur,i);return e._cur=i,n}atEnd(e){if(!e.attValue)throw Error();return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw Error();return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw Error();for(let r=0;r<t.length;r++)if(t[r]!==e.attValue[e._cur+r])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,f,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,f,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw Error("Invalid ice-options, should be only one 'ice-options' line");let t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,f));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:r})}parseExtmap(e){let t;let r=this.extractOneOrMore(e,a);"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),t=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeTill," "),n=v(v({entry:parseInt(r,10)},t&&{direction:t}),{},{extensionName:i});" "===this.peekChar(e)&&(this.consumeAttributeSpace(e),n.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(n)}parseSetup(e){if(this.attributes.setup)throw Error("must only be one single 'a=setup' line.");let t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class T extends b{constructor(...e){super(...e),E(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){let t=this.extract(e,this.consumeToken),r=[];for(;!this.atEnd(e)&&" "===this.peekChar(e);)this.consumeAttributeSpace(e),r.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:r})}parseIceLite(){if(this.attributes.iceLite)throw Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,_)}parseIdentity(e){let t=this.extractOneOrMore(e,A),r=[];for(;!this.atEnd(e)&&" "===this.peekChar(e);){this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");let i=this.extractOneOrMore(e,e=>" "!==e&&p(e));r.push({name:t,value:i})}this.attributes.identities.push({assertionValue:t,extensions:r})}parseMsidSemantic(e){" "===this.peekChar(e)&&this.consumeAttributeSpace(e);let t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{let r=this.extract(e,this.consumeTill," ");t.identifierList.push(r)}}this.attributes.msidSemantic=t}}class y extends b{constructor(e){super(),E(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw Error("attribute parsing error")}parseCandidate(e){let t=this.extractOneOrMore(e,f,[1,32]);this.consumeAttributeSpace(e);let r=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let n=this.extractOneOrMore(e,a,[1,10]);this.consumeAttributeSpace(e);let o=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);let c=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);let d={foundation:t,componentId:r,transport:i,priority:n,connectionAddress:o,port:c,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));" "===this.peekChar(e);){this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,s)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){let t=[];for(;;){let r=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);let n=this.extract(e,this.consumePort);t.push({componentId:r,connectionAddress:i,port:n});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");let i={encodingName:r,clockRate:this.extractOneOrMore(e,a)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),i.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));let n=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));n?n.rtpMap=i:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:i,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){let t;let r=this.extractOneOrMore(e,a);this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeTill,":");":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),t=this.extract(e,this.consumeTill));let n=this.attributes.ssrcs.find(e=>e.ssrcId===parseInt(r,10));n?n.attributes[i]=t:this.attributes.ssrcs.push({ssrcId:parseInt(r,10),attributes:{[i]:t}})}parseFmtp(e){let t=this.extract(e,this.consumeTill," ");this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeTill),i={};r.split(";").forEach(e=>{let[t,r]=e.split("=");t=t.trim();let n="string"==typeof r?r.trim():null;"string"==typeof t&&t.length>0&&(i[t]=n)});let n=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));n?n.fmtp={parameters:i}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:i}})}parseFmtParameters(e){let t={},r=this.extract(e,this.consumeTill,"=");e._cur++;let i=this.extract(e,this.consumeTill,";");for(t[r]=i;";"===e.attValue[e._cur];){let r=this.extract(e,this.consumeTill,"=");e._cur++;let i=this.extract(e,this.consumeTill,";");t[r]=i}return t}parseRtcpFb(e){let t,r="";r="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill," "),this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeTill," ");if("trr-int"===i)t={type:i,interval:this.extract(e,this.consumeTill)};else{let r={type:i};" "===this.peekChar(e)&&(this.consumeAttributeSpace(e),r.parameter=this.extract(e,this.consumeToken)," "===this.peekChar(e)&&(r.additional=this.extract(e,this.consumeTill))),t=r}if("*"===r)this.attributes.rtcpFeedbackWildcards.push(t);else{let e=this.attributes.payloads.find(e=>e.payloadType===parseInt(r,10));e?e.rtcpFeedbacks.push(t):this.attributes.payloads.push({payloadType:parseInt(r,10),rtcpFeedbacks:[t]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw Error("must be single line of rtcp");let t={port:this.extract(e,this.consumePort)};" "===this.peekChar(e)&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){let t={id:this.extractOneOrMore(e,d,[1,64])};" "===this.peekChar(e)&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){let t=this.extractOneOrMore(e,e=>l(e)||a(e)||"_"===e||"-"===e);this.consumeAttributeSpace(e);let r={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(" "===this.peekChar(e)){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");let t=[];for(;;){let r=this.extract(e,this.consumeToken);t.push(r);try{this.extract(e,this.consume,",")}catch(e){break}}r.payloads=t," "===this.peekChar(e)&&this.extract(e,this.consume," ")}for(;;){let t=this.extract(e,this.consumeToken);if("depend"===t){let i={type:t,rids:this.extract(e,this.consume,"=").split(",")};r.params.push(i)}else{let i={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),i.val=this.extract(e,this.consumeTill,";")),r.params.push(i)}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(r)}parseSimulcast(e){if(this.attributes.simulcast)throw Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,a,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){let t=this.extract(e,this.consumeToken),r=[];for(;;)try{this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeInteger);r.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:r})}}function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class I{constructor(){R(this,"eol",o)}print(e,t){let r="";return t&&(this.eol=t),r+=this.printVersion(e.version),r+=this.printOrigin(e.origin),r+=this.printSessionName(e.sessionName),r+=this.printInformation(e.information),r+=this.printUri(e.uri),r+=this.printEmail(e.emails),r+=this.printPhone(e.phones),r+=this.printConnection(e.connection),r+=this.printBandwidth(e.bandwidths),r+=this.printTimeFields(e.timeFields),r+=this.printKey(e.key),r+=this.printSessionAttributes(e.attributes),r+=this.printMediaDescription(e.mediaDescriptions)}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(let r of e)t+="e=".concat(r).concat(this.eol);return t}printPhone(e){let t="";for(let r of e)t+="e=".concat(r).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(let r of e)t+="b=".concat(r.bwtype,":").concat(r.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(let r of e){for(let e of(t+="t=".concat(r.time.startTime," ").concat(r.time.startTime).concat(this.eol),r.repeats))t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);r.zoneAdjustments&&(t+="z=",t+="z=".concat(r.zoneAdjustments.map(e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(let r of e)t+="a=".concat(r.attField).concat(r.attValue?":".concat(r.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(let r of e)t+=this.printMedia(r.media),t+=this.printInformation(r.information),t+=this.printConnections(r.connections),t+=this.printBandwidth(r.bandwidths),t+=this.printKey(r.key),t+=this.printMediaAttributes(r);return t}printConnections(e){let t="";for(let r of e)t+=this.printConnection(r);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new k(this.eol).print(e)}printMediaAttributes(e){return new w(this.eol).print(e)}}class C{constructor(e){R(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(" ")).concat(this.eol)}printFingerprints(e){return e.length>0?e.map(e=>"a=fingerprint:".concat(e.hashFunction).concat(" ").concat(e.fingerprint)).join(this.eol)+this.eol:""}printExtmap(e){return e.map(e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(" ").concat(e.extensionName).concat(e.extensionAttributes?"".concat(" ").concat(e.extensionAttributes):"").concat(this.eol)).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map(e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol)).join("")}}class k extends C{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized)}printGroups(e){let t="";return e.length>0&&(t+=e.map(e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map(e=>"".concat(" ").concat(e)).join("")).concat(this.eol)).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map(e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map(e=>"".concat(" ").concat(e.name).concat(e.value?"=".concat(e.value):"")))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(" ","*"):e.identifierList.length>0&&(t+=e.identifierList.map(e=>"".concat(" ").concat(e))),t+this.eol}}class w extends C{print(e){let t=e.attributes,r="";return r+=this.printRTCP(t.rtcp),r+=this.printIceUfrag(t.iceUfrag),r+=this.printIcePwd(t.icePwd),r+=this.printIceOptions(t.iceOptions),r+=this.printCandidates(t.candidates),r+=this.printRemoteCandidatesList(t.remoteCandidatesList),r+=this.printEndOfCandidates(t.endOfCandidates),r+=this.printFingerprints(t.fingerprints),r+=this.printSetup(t.setup),r+=this.printMid(t.mid),r+=this.printExtmap(t.extmaps),r+=this.printRTPRelated(t),r+=this.printPtime(t.ptime),r+=this.printMaxPtime(t.maxPtime),r+=this.printDirection(t.direction),r+=this.printSSRCGroups(t.ssrcGroups),r+=this.printSSRC(t.ssrcs),r+=this.printRTCPMux(t.rtcpMux),r+=this.printRTCPMuxOnly(t.rtcpMuxOnly),r+=this.printRTCPRsize(t.rtcpRsize),r+=this.printMSId(t.msids),r+=this.printImageattr(t.imageattr),r+=this.printRid(t.rids),r+=this.printSimulcast(t.simulcast),r+=this.printSCTPPort(t.sctpPort),r+=this.printMaxMessageSize(t.maxMessageSize),r+=this.printUnrecognized(t.unrecognized)}printCandidates(e){return e.map(e=>"a=candidate:".concat(e.foundation).concat(" ").concat(e.componentId).concat(" ").concat(e.transport).concat(" ").concat(e.priority).concat(" ").concat(e.connectionAddress).concat(" ").concat(e.port).concat(" ","typ").concat(" ").concat(e.type).concat(e.relAddr?"".concat(" ","raddr").concat(" ").concat(e.relAddr):"").concat(e.relPort?"".concat(" ","rport").concat(" ").concat(e.relPort):"").concat(Object.keys(e.extension).map(t=>"".concat(" ").concat(t).concat(" ").concat(e.extension[t])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(e){return e.map(e=>"a=remote-candidates:".concat(e.join(" ")).concat(this.eol)).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";let t=e.payloads,r="";for(let i of(r+=e.rtcpFeedbackWildcards.map(e=>this.printRTCPFeedback("*",e)).join(""),t))r+=this.printRtpMap(i.payloadType,i.rtpMap),r+=this.printFmtp(i.payloadType,i.fmtp),r+=i.rtcpFeedbacks.map(e=>this.printRTCPFeedback(i.payloadType,e)).join("");return r}printFmtp(e,t){if(!t)return"";let r=Object.keys(t.parameters);return 1===r.length&&null===t.parameters[r[0]]?"a=fmtp:".concat(e).concat(" ").concat(r[0]).concat(this.eol):"a=fmtp:".concat(e).concat(" ").concat(Object.keys(t.parameters).map(e=>"".concat(e,"=").concat(t.parameters[e])).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(" ").concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let r="a=rtcp-fb:".concat(e).concat(" ");return"trr-int"===t.type?r+="ttr-int".concat(" ").concat(t.interval):(r+="".concat(t.type),t.parameter&&(r+="".concat(" ").concat(t.parameter),t.additional&&(r+="".concat(" ").concat(t.additional)))),r+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map(e=>Object.keys(e.attributes).map(t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(" ").concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol)).join("")).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(" ").concat(e.netType)),e.addressType&&(t+="".concat(" ").concat(e.addressType)),e.address&&(t+="".concat(" ").concat(e.address)),t+this.eol}printMSId(e){return e.map(e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(" ").concat(e.appdata):"").concat(this.eol)).join("")}printImageattr(e){return e.map(e=>"a=imageattr:".concat(e).concat(this.eol)).join("")}printRid(e){return e.map(e=>{let t="a=rid:".concat(e.id).concat(" ").concat(e.direction);return e.payloads&&(t+="".concat(" ","pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(" ").concat(e.params.map(e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)).join(";"))),t+this.eol}).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map(e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map(e=>"".concat(" ").concat(e.toString(10))).join("")).concat(this.eol)).join("")}}function O(e){return(new S).parse(e)}function N(e,t){return(new I).print(e,t)}}},t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}return r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(8)})();function aK(e){return aY.parse(e)}function aQ(e,t){return aY.print(e,t)}function az(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function aJ(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?aX(Object(r),!0).forEach(function(t){az(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aX(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let aq=new class extends op{constructor(){super(...arguments),az(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class aZ{constructor(e){az(this,"logger",void 0),az(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function a$(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function a0(){let e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let a2={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},a1=Date.now(),a4=e=>{for(let t in a2)if(Object.prototype.hasOwnProperty.call(a2,t)&&a2[t]===e)return t;return"DEFAULT"},a6=new class e{constructor(){az(this,"proxyServerURL",void 0),az(this,"logLevel",a2.DEBUG),az(this,"uploadState","collecting"),az(this,"uploadLogWaitingList",[]),az(this,"uploadLogUploadingList",[]),az(this,"uploadErrorCount",0),az(this,"currentLogID",0),az(this,"url",void 0),az(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[a2.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[a2.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[a2.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[a2.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=[a2.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){aD("UPLOAD_LOG",!0)}disableLogUpload(){aD("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new aZ(this).prefix(e)}log(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-a1<100)return void setTimeout(()=>{this.log(...t)},Date.now()-a1);let i=Math.max(0,Math.min(4,t[0]));if(t[0]=a$()+" Agora-SDK [".concat(a4(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;let n=a$()+" %cAgora-SDK [".concat(a4(i),"]:"),o=[];if(!aP.USE_NEW_LOG)switch(i){case a2.DEBUG:o=[n,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case a2.INFO:o=[n,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case a2.WARNING:o=[n,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case a2.ERROR:o=[n,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-a1<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-a1);let i=Math.max(0,Math.min(4,t[0]));t[0]=a$()+" Agora-SDK [".concat(a4(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!aP.UPLOAD_LOG)return;for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];Array.isArray(r[0])?r[0][0]=a0()+" Agora-SDK [".concat(a4(e),"]:"):r[0]=a0()+" Agora-SDK [".concat(a4(e),"]:");let n="";r.forEach(e=>{"object"==typeof e&&(e=JSON.stringify(e)),n+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:ay,process_id:aP.PROCESS_ID,payload:JSON.stringify(e)};return o6(async()=>{let e=await nb.Z.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(aP.LOG_UPLOAD_SERVER,"&p=443&d=upload/v1"):"https://".concat(aP.LOG_UPLOAD_SERVER,"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){let t=Error("unexpected upload log response");throw t.response=e,t}},()=>(this.uploadLogUploadingList=[],!1),t=>{let r={status:-1,message:t.message,errorRange:e.map(e=>e.log_item_id)};return t.response?(r.status=t.response.status,r.data=t.response.data,r.headers=t.response.headers):t.request&&(r.status=t.request.status),aq.reportLogUploadError(r),!0},{timeout:aP.UPLOAD_LOG_REQUEST_RETRY_INTERVAL,maxRetryTimeout:aP.UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,aP.UPLOAD_LOG_LENGTH_EACH_TIME)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),aP.UPLOAD_LOG_INTERVAL)}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),aP.UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1):window.setTimeout(()=>this.uploadLogInterval(),aP.UPLOAD_LOG_RETRY_INTERVAL_V1)}))}};function a3(e){return or(e.reportId,"params.reportId",0,100,!1),or(e.category,"params.category",0,100,!1),or(e.event,"params.event",0,100,!1),or(e.label,"params.label",0,100,!1),oe(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(I={}).FREE="free",I.UPLOADING="uploading",(C={})[C.MISC=0]="MISC",C[C.INTERNAL_EVENT=1]="INTERNAL_EVENT",C[C.PUBLIC_EVENT=2]="PUBLIC_EVENT",C[C.WEB_EVENT=3]="WEB_EVENT",C[C.INTERNAL_API=4]="INTERNAL_API",C[C.WEB_API=5]="WEB_API",C[C.PUBLIC_API=6]="PUBLIC_API";let a8={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let a5=((k={}).PUBLISH="publish",k.SUBSCRIBE="subscribe",k.WS_COMPRESSOR_INIT="ws_compressor_init",k.SESSION_INIT="session_init",k.JOIN_CHOOSE_SERVER="join_choose_server",k.REQ_USER_ACCOUNT="req_user_account",k.JOIN_GATEWAY="join_gateway",k.REJOIN_GATEWAY="rejoin_gateway",k.STREAM_SWITCH="stream_switch",k.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",k.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",k.FIRST_VIDEO_RECEIVED="first_video_received",k.FIRST_AUDIO_RECEIVED="first_audio_received",k.FIRST_VIDEO_DECODE="first_video_decode",k.FIRST_AUDIO_DECODE="first_audio_decode",k.ON_ADD_AUDIO_STREAM="on_add_audio_stream",k.ON_ADD_VIDEO_STREAM="on_add_video_stream",k.ON_UPDATE_STREAM="on_update_stream",k.ON_REMOVE_STREAM="on_remove_stream",k.USER_ANALYTICS="req_user_analytics",k.PC_STATS="pc_stats",k.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",k.AB_TEST="ab_test",k),a9=((w={}).SESSION="io.agora.pb.Wrtc.Session",w.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",w.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",w.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",w.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",w.PUBLISH="io.agora.pb.Wrtc.Publish",w.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",w.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",w.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",w.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",w.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",w.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",w.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",w.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",w.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",w.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",w.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",w.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",w.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",w.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",w.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",w.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",w.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",w.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",w.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",w.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",w.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",w.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",w.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",w.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",w.PC_STATS="io.agora.pb.Wrtc.PCStats",w.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",w.AB_TEST="io.agora.pb.Wrtc.ABTest",w),a7=((O={})[O.WORKER_EVENT=156]="WORKER_EVENT",O[O.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",(N={})[N.SESSION=26]="SESSION",N[N.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",N[N.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",N[N.JOIN_GATEWAY=28]="JOIN_GATEWAY",N[N.PUBLISH=30]="PUBLISH",N[N.SUBSCRIBE=29]="SUBSCRIBE",N[N.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",N[N.STREAM_SWITCH=32]="STREAM_SWITCH",N[N.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",N[N.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",N[N.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",N[N.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",N[N.API_INVOKE=41]="API_INVOKE",N[N.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",N[N.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",N[N.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",N[N.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",N[N.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",N[N.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",N[N.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",N[N.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",N[N.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",N[N.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",N[N.WORKER_EVENT=156]="WORKER_EVENT",N[N.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",N[N.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",N[N.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",N[N.USER_ANALYTICS=1e4]="USER_ANALYTICS",N[N.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",N);function se(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r,i){let n=i.value;if("function"==typeof n){let o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);i.value=function(){for(var t,i=arguments.length,a=Array(i),s=0;s<i;s++)a[s]=arguments[s];let c=a;if(e.argsMap)try{c=e.argsMap(this,...a)}catch(e){a6.warning(e),c=[]}try{JSON.stringify(c)}catch(e){a6.warning("arguments for method ".concat(o,".").concat(String(r)," not serializable for apiInvoke.")),c=[]}let d=(e.report||st).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(o,".").concat(String(r)),options:c,tag:om.TRACER,reportResult:e.reportResult},e.throttleTime);try{let t=n.apply(this,a);return t instanceof Promise?t.then(t=>(d.onSuccess(e.reportResult&&t),t)).catch(e=>{throw d.onError(e),e}):(d.onSuccess(e.reportResult&&t),t)}catch(e){throw d.onError(e),e}}}return i}}let st=new class e{constructor(){az(this,"baseInfoMap",new Map),az(this,"proxyServer",void 0),az(this,"eventUploadTimer",void 0),az(this,"setSessionIdTimer",void 0),az(this,"url",void 0),az(this,"sids",new Set),az(this,"backupUrl",void 0),az(this,"_appId",void 0),az(this,"_aid",0),az(this,"keyEventUploadPendingItems",[]),az(this,"normalEventUploadPendingItems",[]),az(this,"apiInvokeUploadPendingItems",[]),az(this,"apiInvokeCount",0),az(this,"apiInvokeLoggedCount",0),az(this,"ltsList",[]),az(this,"lastSendNormalEventTime",Date.now()),az(this,"customReportCounterTimer",void 0),az(this,"customReportCount",0),az(this,"extApiInvoke",async e=>{for(let t of e){let e=aJ(aJ({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:om.TRACER});this.sendApiInvoke(e)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),aP.EVENT_REPORT_SEND_INTERVAL),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),aP.EVENT_REPORT_SEND_INTERVAL)}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,e=>{let[t,r]=e;return t+r}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;let i=Date.now();this.apiInvokeCount+=1;let n=this.apiInvokeCount,o=!!aP.SHOW_REPORT_INVOKER_LOG,a=!!aP.SHOW_REPORT_USER_INVOKER_LOG,s=o||a&&t.id;s&&(this.apiInvokeLoggedCount+=1);let c=this.apiInvokeLoggedCount;function d(e,r){if(s){let i="[apiInvoke-".concat(c,"]");t.id&&(i+="[".concat(t.id,"]")),t.name&&(i+="[".concat(t.name,"]")),a6.info("".concat(i," ").concat(e),"start"===e?t.options:r||"")}}let u=()=>({tag:t.tag,invokeId:n,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});d("start");let l=!1;oW(t.timeout).then(()=>{l||(this.sendApiInvoke(aJ(aJ({},u()),{},{error:n8.API_INVOKE_TIMEOUT,success:!1})),d("timeout"))});let h=new n5(n8.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{let i=()=>{if(l)throw h;return l=!0,this.sendApiInvoke(aJ(aJ({},u()),{},{success:!0},t.reportResult&&{result:e})),d("onSuccess"),e};return r?oz(i,t.name+"Success",r,()=>l=!0):i()},onError:e=>{let i=()=>{if(l)throw e;l=!0,this.sendApiInvoke(aJ(aJ({},u()),{},{success:!1,error:e})),d("onFailure",e.toString())};return r?oz(i,t.name+"Error",r,()=>l=!0):i()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let r=Date.now(),i=this.createBaseInfo(e,r);i.cname=t.cname;let n=Object.assign({},{willUploadConsoleLog:aP.UPLOAD_LOG,maxTouchPoints:navigator.maxTouchPoints,areaVersion:aR?"global":"oversea",areas:aP.AREAS&&aP.AREAS.join(",")},t.extend),{stringUid:o,channelProfile:a,channelMode:s,isABTestSuccess:c,lsid:d,clientRole:u}=t,l=Date.now(),h=aJ(aJ({},i),{},{eventType:a5.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:aO,lts:l,elapse:l-r,extend:JSON.stringify(n),mode:t.mode,process:aP.PROCESS_ID,appType:aP.APP_TYPE,success:!0,version:ay,stringUid:o,channelProfile:a,channelMode:s,isABTestSuccess:c,lsid:d,clientType:window.navigator.userAgent.includes("AgoraWebView")?42:20,clientRole:u,serviceId:aP.PROCESS_ID,extensionID:aP.PLUGIN_INFO.join(",")||""});this.send({type:a9.SESSION,data:h},!0)}joinChooseServer(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ({},i),{},{role:t.role,eventType:a5.JOIN_CHOOSE_SERVER,lts:n,eventElapse:t.elapse||n-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:n-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:a9.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ({},i),{},{eventType:a5.REQ_USER_ACCOUNT,lts:n,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||n-r.startTime,eventElapse:n-t.lts,extend:JSON.stringify(t.extend)});this.send({type:a9.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;let n=Date.now(),{firstSuccess:o,avoidJoinStartTime:a,addr:s,isProxy:c}=t,d=n-(o&&a?a:r.startTime),u=aJ(aJ({},i),{},{eventType:a5.JOIN_GATEWAY,lts:n,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:d,eventElapse:n-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:aT(),isABTestSuccess:t.isABTestSuccess?1:0}),l=u.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=n),o)this.send({type:a9.JOIN_GATEWAY,data:u},!0);else{let e;if(s){if(c){let t=s.match(/h=(\d{1,3}-){3}\d{1,3}/g),r=s.match(/p=[0-9]{1,6}/g);e={isSuccess:l,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:r&&r.length?r[0].split("=")[1]:"",isProxy:c?1:0}}else{let t=s.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),r=s.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:l,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:r&&r.length?r[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}}else e={isSuccess:l,gatewayIp:"",port:"",isProxy:c?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);let t=Object.assign({},u,e,{eventType:a5.REJOIN_GATEWAY});this.send({type:a9.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=Date.now(),n=aJ(aJ({},r.info),{},{lts:i,timeout:t,elapse:i-r.startTime});this.send({type:a9.JOIN_CHANNEL_TIMEOUT,data:n},!0)}publish(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ({},i),{},{eventType:a5.PUBLISH,lts:n,eventElapse:t.eventElapse,elapse:n-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:a9.PUBLISH,data:o},!0)}subscribe(e,t,r){let i=this.baseInfoMap.get(e);if(!i)return;let n=i.info,o=Date.now(),a=aJ(aJ({},n),{},{eventType:a5.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:a9.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){let t=[...this.baseInfoMap.keys()],r=t.length?t[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;let n=i.info,o=Date.now(),a=aJ(aJ({},n),{},{eventType:a5.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:a9.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(e,t,r,i){let n=this.baseInfoMap.get(e);if(!n)return;let o=n.info,a=Date.now(),s=aJ(aJ(aJ({},o),i),{},{elapse:a-n.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((i.firstFrame||a)-n.startTime,0),apEnd:Math.max(i.apEnd-n.startTime,0),apStart:Math.max(i.apStart-n.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-n.startTime,0),joinGwStart:Math.max(i.joinGwStart-n.startTime,0),pcEnd:Math.max(i.pcEnd-n.startTime,0),pcStart:Math.max(i.pcStart-n.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-n.startTime,0),subscriberStart:Math.max(i.subscriberStart-n.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-n.startTime,0)});this.send({type:r,data:s},!0)}firstRemoteFrame(e,t,r,i){let n=this.baseInfoMap.get(e);if(!n)return;let o=n.info,a=Date.now(),s=aJ(aJ(aJ({},o),i),{},{elapse:a-n.startTime,eventType:t,lts:a});this.send({type:r,data:s},!0)}abTest(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ(aJ({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),elapse:n-r.startTime,eventType:a5.AB_TEST,lts:n});this.send({type:a9.AB_TEST,data:o},!0)}pcStats(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ(aJ({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),elapse:n-r.startTime,eventType:a5.PC_STATS,lts:n,preallocation:t.preallocation?1:0});this.send({type:a9.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ(aJ({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),eventType:a5.UPDATE_REMOTE_RTPCAPABILITIES,lts:n});this.send({type:a9.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,r,i){let n=this.baseInfoMap.get(e);if(!n)return;let o=n.info,a=Date.now(),s=aJ(aJ(aJ({},o),i),{},{eventType:t,lts:a});this.send({type:r,data:s},!0)}streamSwitch(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ({},i),{},{eventType:a5.STREAM_SWITCH,lts:n,isDual:t.isdual,elapse:n-r.startTime,success:t.succ});this.send({type:a9.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ({},i),{},{eventType:a5.REQUEST_PROXY_APPCENTER,lts:n,eventElapse:n-t.lts,elapse:n-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:a9.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ({},i),{},{eventType:a5.REQUEST_PROXY_WORKER_MANAGER,lts:n,eventElapse:n-t.lts,elapse:n-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:a9.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?a6.debug("reportProxyServerurl: ".concat(e)):a6.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:n,elapse:n-r.startTime,joinChannelSuccessElapse:n-(r.lastJoinSuccessTime||n),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:a9.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now();(function(e,t,r){let i=e[t];if(!i||"string"!=typeof i)return[e];e[t]="";let n=oj(JSON.stringify(e)),o=0,a=[],s=0;for(let r=0;r<i.length;r++)(s+=127>=i.charCodeAt(r)?1:3)<=1300-n||(a[a.length]=n3(n3({},e),{},{[t]:i.substring(o,r)}),o=r,s=127>=i.charCodeAt(r)?1:3);return o!==i.length-1&&(a[a.length]=n3(n3({},e),{},{[t]:i.substring(o)})),a})(aJ(aJ(aJ({},i),t),{},{elapse:n-r.startTime,lts:n,productType:"WebRTC"}),"payload",1300).forEach(e=>this.send({type:a9.WORKER_EVENT,data:e},!0))}apworkerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ(aJ({},i),t),{},{elapse:n-r.startTime,lts:n});this.send({type:a9.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ(aJ({},i),t),{},{elapse:n-r.startTime,lts:n,extend:t.extend||void 0});this.send({type:a9.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,n=Date.now(),o=aJ(aJ(aJ({},i),t),{},{elapse:n-r.startTime,lts:n});this.send({type:a9.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>aP.CUSTOM_REPORT_LIMIT)throw new n5(n8.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let r=Date.now(),i=t.map(t=>({type:a9.USER_ANALYTICS,data:aJ(aJ({sid:e},t),{},{lts:r})}));try{aP.NEW_REPORT_SERVER?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(e){throw a6.error("send custom report message failed",e.toString()),new n5(n8.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){let t;let r=aP.NOT_REPORT_EVENT;if(e.tag&&r.includes&&r.includes(e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;let i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:n,uid:o,cid:a}=i.info;if(e.lts=e.lts||Date.now(),e.error){if(e.error instanceof n5){let{code:r,message:i}=e.error;t=r||i||e.error.toString()}else t=e.error.toString()}let s={invokeId:e.invokeId,sid:e.sid,cname:n,cid:a,uid:o,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?t:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:a9.API_INVOKE,data:s},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(0===e.length)return;let t=Array.from(this.sids).find(e=>null!==e);t&&e.forEach(e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>aP.NORMAL_EVENT_QUEUE_CAPACITY&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let r,i=[],n=[];for(;e.length;){let t=e.shift();i.length<20?i.push(t):n.push(t)}for(let t of(e.push(...n),[...i]))-1!==this.ltsList.indexOf(t.data.lts)?(t.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(t.data.lts)):(this.ltsList.push(t.data.lts),this.ltsList.sort((e,t)=>e-t));t||(this.lastSendNormalEventTime=Date.now());return aP.ENABLE_EVENT_REPORT&&i.length&&(aP.NEW_REPORT_SERVER?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((r=i,e=>{aP.EVENT_REPORT_RETRY&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(r):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(r),this.normalEventUploadPendingItems.length>aP.NORMAL_EVENT_QUEUE_CAPACITY&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-aP.NORMAL_EVENT_QUEUE_CAPACITY),a6.warning("report: drop normal events"))))})),e}async postDataToStatsCollector2(e){ow.networkState===oT.OFFLINE&&await Promise.race([ow.onlineWaiter,oW(2*o1.maxRetryTimeout)]);let t=e=>{let t=new Uint8Array;return e.forEach(e=>{var r;let i;let n=od(JSON.stringify(e.data)),o=new ArrayBuffer(5),a=(r=e,i=0,Object.entries(a9).forEach(e=>{let[t,n]=e;n===r.type&&(i=a7[t])}),i),s=new DataView(o);s.setUint16(0,n.byteLength,!0),s.setUint8(2,255&a),s.setUint8(3,a>>>8&255),s.setUint8(4,a>>>16&255),t=ou(t,new Uint8Array(o)),t=ou(t,n)}),t},r="event",i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(aP.NEW_REPORT_SERVER_DOMAINS[0],"&p=443&d=").concat(r):"https://".concat(aP.NEW_REPORT_SERVER_DOMAINS[0],"/").concat(r);for(let n=0;n<2;n+=1){1===n&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(aP.NEW_REPORT_SERVER_DOMAINS[1],"&p=443&d=").concat(r):"https://".concat(aP.NEW_REPORT_SERVER_DOMAINS[1],"/").concat(r));try{await o7(i,{timeout:1e4,data:t(e),headers:aJ(aJ({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===n)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(e=>{let t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),i=r?void 0:this._aid,n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(e=>JSON.stringify(e)),vid:r,aid:i};ow.networkState===oT.OFFLINE&&await Promise.race([ow.onlineWaiter,oW(2*o1.maxRetryTimeout)]);let o=t?"/events/proto-raws":"/events/messages",a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(aP.EVENT_REPORT_DOMAIN,"&p=").concat(aP.STATS_COLLECTOR_PORT,"&d=").concat(o):"https://".concat(aP.EVENT_REPORT_DOMAIN,":").concat(aP.STATS_COLLECTOR_PORT).concat(o));for(let e=0;e<2;e+=1){1===e&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(aP.EVENT_REPORT_BACKUP_DOMAIN,"&p=").concat(aP.STATS_COLLECTOR_PORT,"&d=").concat(o):"https://".concat(aP.EVENT_REPORT_BACKUP_DOMAIN,":").concat(aP.STATS_COLLECTOR_PORT).concat(o)));try{t?await ae(a,{timeout:1e4,data:n}):await o7(a,{timeout:1e4,data:n})}catch(t){if(1===e)throw t;continue}return}}createBaseInfo(e,t){let r=Object.assign({},a8);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){let r=performance.getEntriesByName(e),i=r[r.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:om.TRACER}).onSuccess()}};aq.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ow.networkState,st.reportApiInvoke(null,{name:"logUploadError",options:e,tag:om.TRACER}).onSuccess("logUploadError")});class sr extends n5{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),az(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,a6)}throw(){super.throw(a6)}}let si={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function sn(){return si}function so(){return"setSinkId"in HTMLAudioElement.prototype&&(!aP.RESTRICTION_SET_PLAYBACK_DEVICE||(nV()||nj())&&!n$())}function sa(){return!si.supportUnifiedPlan||aP.CHROME_FORCE_PLAN_B&&n0()}let ss=((P={}).IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",P.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",P.IOS_INTERRUPTION_START="ios-interruption-start",P.IOS_INTERRUPTION_END="ios-interruption-end",P.STATE_CHANGE="state-change",P);function sc(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function sd(e,t,r,i,n){return{width:e,height:t,frameRate:r,bitrateMin:i,bitrateMax:n}}function su(e,t,r,i,n){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:i,bitrateMax:n}}function sl(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let sh={"90p":sd(160,90),"90p_1":sd(160,90),"120p":sd(160,120,15,30,65),"120p_1":sd(160,120,15,30,65),"120p_3":sd(120,120,15,30,50),"120p_4":sd(212,120),"180p":sd(320,180,15,30,140),"180p_1":sd(320,180,15,30,140),"180p_3":sd(180,180,15,30,100),"180p_4":sd(240,180,15,30,120),"240p":sd(320,240,15,40,200),"240p_1":sd(320,240,15,40,200),"240p_3":sd(240,240,15,40,140),"240p_4":sd(424,240,15,40,220),"360p":sd(640,360,15,80,400),"360p_1":sd(640,360,15,80,400),"360p_3":sd(360,360,15,80,260),"360p_4":sd(640,360,30,80,600),"360p_6":sd(360,360,30,80,400),"360p_7":sd(480,360,15,80,320),"360p_8":sd(480,360,30,80,490),"360p_9":sd(640,360,15,80,800),"360p_10":sd(640,360,24,80,800),"360p_11":sd(640,360,24,80,1e3),"480p":sd(640,480,15,100,500),"480p_1":sd(640,480,15,100,500),"480p_2":sd(640,480,30,100,1e3),"480p_3":sd(480,480,15,100,400),"480p_4":sd(640,480,30,100,750),"480p_6":sd(480,480,30,100,600),"480p_8":sd(848,480,15,100,610),"480p_9":sd(848,480,30,100,930),"480p_10":sd(640,480,10,100,400),"720p":sd(1280,720,15,120,1130),"720p_auto":sd(1280,720,30,900,3e3),"720p_1":sd(1280,720,15,120,1130),"720p_2":sd(1280,720,30,120,2e3),"720p_3":sd(1280,720,30,120,1710),"720p_5":sd(960,720,15,120,910),"720p_6":sd(960,720,30,120,1380),"1080p":sd(1920,1080,15,120,2080),"1080p_1":sd(1920,1080,15,120,2080),"1080p_2":sd(1920,1080,30,120,3e3),"1080p_3":sd(1920,1080,30,120,3150),"1080p_5":sd(1920,1080,60,120,4780),"1440p":sd(2560,1440,30,120,4850),"1440p_1":sd(2560,1440,30,120,4850),"1440p_2":sd(2560,1440,60,120,7350),"4k":sd(3840,2160,30,120,8910),"4k_1":sd(3840,2160,30,120,8910),"4k_3":sd(3840,2160,60,120,13500)};function sp(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},sh[e]):e}su(640,480,5),su(640,480,5),su(640,480,30),su(640,480,15),su(1280,720,5),sd(1280,720,30,900,3e3),su(1280,720,5),su(1280,720,30),su(1280,720,15),su(1920,1080,5),su(1920,1080,5),su(1920,1080,30),su(1920,1080,15),sl(1,1),sl(3,3),sl(2,3);let sf={speech_low_quality:sc(16e3,!1),speech_standard:sc(32e3,!1,18),music_standard:sc(48e3,!1),standard_stereo:sc(48e3,!0,56),high_quality:sc(48e3,!1,128),high_quality_stereo:sc(48e3,!0,192)};function s_(e){return"string"==typeof e?Object.assign({},sf[e]):e}let sA=[];function sm(e){return n7(e,"mediaSource",["screen","window","application"]),!0}let sv=((D={}).NEED_RENEGOTIATE="@need_renegotiate",D.NEED_REPLACE_TRACK="@need_replace_track",D.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",D.NEED_CLOSE="@need_close",D.NEED_ENABLE_TRACK="@need_enable_track",D.NEED_DISABLE_TRACK="@need_disable_track",D.NEED_SESSION_ID="@need_sid",D.SET_OPTIMIZATION_MODE="@set_optimization_mode",D.GET_STATS="@get_stats",D.GET_RTC_STATS="@get_rtc_stats",D.GET_LOW_VIDEO_TRACK="@get_low_video_track",D.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",D.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",D.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",D.NEED_MUTE_TRACK="@need_mute_track",D.NEED_UNMUTE_TRACK="@need_unmute_track",D),sE=((L={}).SCREEN_TRACK="screen_track",L.CUSTOM_TRACK="custome_track",L.LOW_STREAM="low_stream",L.SCREEN_LOW_TRACK="screen_low_track",L);let sg=((M={})[M.HIGH_STREAM=0]="HIGH_STREAM",M[M.LOW_STREAM=1]="LOW_STREAM",M),sS=((x={})[x.HIGH_STREAM=0]="HIGH_STREAM",x[x.LOW_STREAM=1]="LOW_STREAM",x[x.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",x[x.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",x[x.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",x[x.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",x[x.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",x[x.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",(U={})[U.DISABLE=0]="DISABLE",U[U.LOW_STREAM=1]="LOW_STREAM",U[U.AUDIO_ONLY=2]="AUDIO_ONLY",U[U.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",U[U.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",U[U.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",U[U.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",U[U.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",U[U.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",(B={}).TRANSCEIVER_UPDATED="transceiver-updated",B.SEI_TO_SEND="sei-to-send",B.SEI_RECEIVED="sei-received",B.TRACK_UPDATED="track-updated",B),sb=((V={}).SOURCE_STATE_CHANGE="source-state-change",V.TRACK_ENDED="track-ended",V.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",V.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",V.CLOSED="closed",V),sT=((F={}).FIRST_FRAME_DECODED="first-frame-decoded",F.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",F.VIDEO_STATE_CHANGED="video-state-changed",F),sy=((j={}).AUDIO="audio",j.VIDEO="video",j.DATA="data",j),sR=((G={}).AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",G.RECEIVE_TRACK_BUFFER="receive_track_buffer",G.ON_AUDIO_BUFFER="on_audio_buffer",G.UPDATE_SOURCE="update_source",G);(W={}).UPDATE_TRACK_SOURCE="update-track-source";let sI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},sC={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},sk={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},sw={uplinkNetworkQuality:0,downlinkNetworkQuality:0},sO={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let sN=((H={}).ON_TRACK="on_track",H.ON_NODE="on_node",H),sP=((Y={}).REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",Y.REQUEST_CONSTRAINTS="request_constraints",Y),sD=((K={}).IDLE="IDLE",K.INITING="INITING",K.INITEND="INITEND",K),sL=((Q={}).STATE_CHANGE="state_change",Q.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",Q.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",Q.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",Q);let sM=((z={}).NONE="none",z.INIT="init",z.CANPLAY="canplay",z.PLAYING="playing",z.PAUSED="paused",z.SUSPEND="suspend",z.STALLED="stalled",z.WAITING="waiting",z.ERROR="error",z.DESTROYED="destroyed",z.ABORT="abort",z.ENDED="ended",z.EMPTIED="emptied",z.LOADEDDATA="loadeddata",z),sx=((X={})[X.VideoStateStopped=0]="VideoStateStopped",X[X.VideoStateStarting=1]="VideoStateStarting",X[X.VideoStateDecoding=2]="VideoStateDecoding",X[X.VideoStateFrozen=3]="VideoStateFrozen",X),sU={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function sB(e,t,r,i,n){var o={};return Object.keys(i).forEach(function(e){o[e]=i[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},o),n&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(n):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function sV(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function sj(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?sF(Object(r),!0).forEach(function(t){sV(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(J={}).OPEN="open",J.MESSAGE="message",J.CLOSE="close",J.CLOSING="closing",J.ERROR="error";class sG extends op{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(sS.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){var r;super(),sV(this,"trackMediaType",void 0),sV(this,"_ID",void 0),sV(this,"_rtpTransceiver",void 0),sV(this,"_lowRtpTransceiver",void 0),sV(this,"_hints",[]),sV(this,"_isClosed",!1),sV(this,"_originMediaStreamTrack",void 0),sV(this,"mediaStreamTrack",void 0),sV(this,"_external",{}),this._ID=t||oH(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,r=this,sA.includes(r)||sA.push(r)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||ox(()=>{var e;st.reportApiInvoke(null,{name:oA.GET_MEDIA_STREAM_TRACK,options:[],tag:om.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===sg.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){let t=sA.indexOf(e);-1!==t&&sA.splice(t,1)}(this),this.emit(sb.CLOSED),this.removeAllListeners(sS.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===sg.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(sS.TRANSCEIVER_UPDATED,e,t)}}class sW extends sG{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),sV(this,"_enabled",!0),sV(this,"_muted",!1),sV(this,"_isExternalTrack",!1),sV(this,"_isClosed",!1),sV(this,"_enabledMutex",void 0),sV(this,"processor",void 0),sV(this,"_processorContext",void 0),sV(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new o0("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,a6.debug("[".concat(this.getTrackId(),"] close")),this.emit(sv.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=r,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oI(this,sv.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){a6.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(sb.TRACK_ENDED)}stateCheck(e,t){if(a6.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),n9(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new n5(n8.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",a6);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new n5(n8.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",a6)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Promise.resolve([])}}let sH=window.AudioContext||window.webkitAudioContext,sY=null,sK=new class extends op{constructor(){super(...arguments),sV(this,"prevState",void 0),sV(this,"curState",void 0),sV(this,"currentTime",void 0),sV(this,"currentTimeStuckAt",void 0),sV(this,"interruptDetectorTrack",void 0),sV(this,"onLocalAudioTrackMute",()=>{a6.info("ios15-interruption-start"),this.emit(ss.IOS_15_16_INTERRUPTION_START)}),sV(this,"onLocalAudioTrackUnmute",async()=>{a6.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?a6.info("ios15-interruption-end-canceled"):(sY&&await sY.suspend(),this.emit(ss.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){a6.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){a6.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function sQ(){if(!sY&&(function(){if(!sH)return void a6.error("your browser is not support web audio");a6.info("create audio context");let e=sj({},aP.WEBAUDIO_INIT_OPTIONS);a6.debug("audio context init option:",JSON.stringify(e)),sY=new sH(e),sK.curState=sY.state,sY.onstatechange=()=>{sK.prevState=sK.curState,sK.curState=sY?sY.state:void 0;let{prevState:e,curState:t}=sK,r="running"===t,i="interrupted"===t,n="running"===e,o="suspended"===e,a="interrupted"===e,s=nL().osVersion;(nW()||nq())&&n&&i&&(a6.info("ios".concat(s,"-interruption-start")),sK.emit(ss.IOS_INTERRUPTION_START)),(nW()||nq())&&(o||a)&&r&&(a6.info("ios".concat(s,"-interruption-end")),sK.emit(ss.IOS_INTERRUPTION_END)),e!==t&&sK.emit(ss.STATE_CHANGE,t,e)},setInterval(()=>{var e;let t=null===(e=sY)||void 0===e?void 0:e.currentTime;sK.currentTime!==t?(sK.currentTimeStuckAt&&(a6.debug("AudioContext current time resume at ".concat(t)),sK.currentTimeStuckAt=void 0),sK.currentTime=t):(t!==sK.currentTimeStuckAt&&(st.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:om.TRACER}).onSuccess(),a6.warning("AudioContext current time stuck at ".concat(t))),sK.currentTimeStuckAt=t)},5e3),async function(e){let t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r,i=!1,n=!1,o=!1;function a(t){"running"===e.state?s(!1):nW()||nq()?"suspended"===e.state&&(s(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(s(!0),t&&e.resume().then(c,c))}function s(e){if(i!==e){i=e;for(let r=0;r<t.length;r+=1){let i=t[r];e?window.addEventListener(i,d,{capture:!0,passive:!0}):window.removeEventListener(i,d,{capture:!0,passive:!0})}}}function c(){a(!1)}function d(){a(!0)}function u(e){if(!o){if(r.paused){if(e){let e;l(!1),o=!0;try{(e=r.play())?e.then(h,h):(r.addEventListener("playing",h),r.addEventListener("abort",h),r.addEventListener("error",h))}catch(e){h()}}else l(!0)}else l(!1)}}function l(e){if(n!==e){n=e;for(let r=0;r<t.length;r++){let i=t[r];e?window.addEventListener(i,p,{capture:!0,passive:!0}):window.removeEventListener(i,p,{capture:!0,passive:!0})}}}function h(){r.removeEventListener("playing",h),r.removeEventListener("abort",h),r.removeEventListener("error",h),o=!1,u(!1)}function p(){u(!0)}if(nW()){let t=e.createMediaStreamDestination(),i=document.createElement("div");i.innerHTML="<audio x-webkit-airplay='deny'></audio>",(r=i.children.item(0)).controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=t.stream,u(!0)}sK.on(ss.STATE_CHANGE,function(){a(!0)}),a(!1)}(sY)}(),!sY))throw new n5(n8.NOT_SUPPORTED,"can not create audio context");return sY}function sz(e){if(function(){if(null!==sX)return sX;let e=sQ(),t=e.createBufferSource(),r=e.createGain(),i=e.createGain();t.connect(r),t.connect(i),t.disconnect(r);let n=!1;try{t.disconnect(r)}catch(e){n=!0}return t.disconnect(),sX=n,n}())return;let t=e.connect,r=e.disconnect;e.connect=(r,i,n)=>(e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,i,n)):t.call(e,r,i)),e),e.disconnect=(i,n,o)=>{for(let n of(r.call(e),i?oO(e._inputNodes,i):e._inputNodes=[],e._inputNodes))t.call(e,n)}}let sX=null;function sJ(e,t){let r=!1,i=1/t;if(aP.DISABLE_WEBAUDIO){let t=window.setInterval(()=>{r?window.clearInterval(t):e(performance.now()/1e3)},1e3*i)}else{let t=sQ(),n=t.createGain();n.gain.value=0,n.connect(t.destination);let o=()=>{if(r)return void(n=null);let a=t.createOscillator();a.onended=o,a.connect(n),a.start(0),a.stop(t.currentTime+i),e(t.currentTime)};o()}return()=>{r=!0}}class sq{constructor(){sV(this,"context",void 0),sV(this,"analyserNode",void 0),sV(this,"sourceNode",void 0),this.context=sQ(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||nW()||nq()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let r=0;r<e.length;++r)e[r]=t[r]/128-1}return Math.max(10*Math.log10(e.reduce((e,t)=>e+t*t,0)/e.length)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){a6.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class sZ extends op{get processSourceNode(){return this.sourceNode}set processedNode(e){var t,r;if(!this.isDestroyed&&this._processedNode!==e){try{null===(r=this.sourceNode)||void 0===r||r.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),sV(this,"outputNode",void 0),sV(this,"outputTrack",void 0),sV(this,"isPlayed",!1),sV(this,"sourceNode",void 0),sV(this,"context",void 0),sV(this,"audioBufferNode",void 0),sV(this,"destNode",void 0),sV(this,"audioOutputLevel",0),sV(this,"volumeLevelAnalyser",void 0),sV(this,"_processedNode",void 0),sV(this,"playNode",void 0),sV(this,"isDestroyed",!1),sV(this,"onNoAudioInput",void 0),sV(this,"isNoAudioInput",!1),sV(this,"_noAudioInputCount",0),this.context=sQ(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),sz(this.outputNode),this.volumeLevelAnalyser=new sq}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(sR.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){let r=e.outputBuffer.getChannelData(t);for(let e=0;e<r.length;e+=1)r[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!si.webAudioMediaStreamDest)throw new n5(n8.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&oP(()=>{sK.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;nW()||nq()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();let r=this.volumeLevelAnalyser.getAnalyserNode();r.getFloatTimeDomainData?(e=new Float32Array(r.fftSize),r.getFloatTimeDomainData(e)):(e=new Uint8Array(r.fftSize),r.getByteTimeDomainData(e));let i=!1;for(let t=0;t<e.length;t++)0!==e[t]&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await oW(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class s$ extends sZ{get isFreeze(){return!1}constructor(e,t,r){var i;if(super(),sV(this,"sourceNode",void 0),sV(this,"track",void 0),sV(this,"clonedTrack",void 0),sV(this,"audioElement",void 0),sV(this,"isCurrentTrackCloned",!1),sV(this,"isRemoteTrack",!1),sV(this,"originVolumeLevelAnalyser",void 0),sV(this,"rebuildWebAudio",async()=>{if(a6.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void a6.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>a6.info("resume success")),a6.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;let t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),sz(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let r=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(r,this.context.currentTime),sz(this.outputNode),this.emit(sR.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),"audio"!==e.kind)throw new n5(n8.UNEXPECTED_ERROR);this.track=e;let n=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(n),sz(this.sourceNode),r){let e=r.clone();e.enabled=!0,this.clonedTrack=e,a6.debug("create an unmuted track ".concat(e.id," from the original track ").concat(r.id," to get the volume"));let t=this.context.createMediaStreamSource(new MediaStream([e]));sz(t),this.originVolumeLevelAnalyser=new sq,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=n;let o=nL();t&&o.os===nw.IOS&&15>Number(null===(i=o.osVersion)||void 0===i?void 0:i.split(".")[0])&&(sK.on(ss.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),sz(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(sR.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),sK.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),a6.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let r=this.context.createMediaStreamSource(new MediaStream([t]));sz(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function s0(e,t,r){let i=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,n={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(n.video.mandatory.maxFrameRate=t.frameRate.max,n.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(n.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(n)}async function s2(e,t){let r=await s1(e.mediaSource),{sourceId:i,audio:n}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((r,i)=>{let n=document.createElement("div");n.innerText="share screen",n.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");let s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let d=document.createElement("button");d.innerHTML="cancel",d.setAttribute("style","width: 85px;"),d.onclick=()=>{document.body.removeChild(h);let e=Error("NotAllowedError");e.name="NotAllowedError",i(e)};let u=t,l=document.createElement("div");if(t){let e=document.createElement("input");e.setAttribute("type","checkbox");let t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=u,e.onchange=()=>{u=e.checked},l.appendChild(e),l.appendChild(t)}c.appendChild(l),c.appendChild(d),o.appendChild(a),o.appendChild(s),o.appendChild(c);let h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(n),h.appendChild(o),document.body.appendChild(h),e.map(e=>{if(e.id){let t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let i=e.thumbnail;try{let{width:e}=i.getSize();e>1920&&(i=i.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+i.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",t.onclick=()=>{document.body.removeChild(h),r({sourceId:e.id,audio:u})},s.appendChild(t)}})})}(r,t);return await s0(i,e,n)}async function s1(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);let r=o_();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new n5(n8.ELECTRON_IS_NULL);let i=null;try{var n;i=(null===(n=r.desktopCapturer)||void 0===n?void 0:n.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){i=null}i&&i.then||(i=new Promise((e,i)=>{r.desktopCapturer.getSources({types:t},(t,r)=>{t?i(t):e(r)})}));try{return await i}catch(e){throw new n5(n8.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}let s4=new o0("safari"),s6=!1,s3=!1;async function s8(e,t){let r=0,i=null;for(;r<2;)try{i=await s5(e,t,r>0);break}catch(i){if(i instanceof n5)throw a6.error("[".concat(t,"] ").concat(i.toString())),i;let e=s9(i.name||i.code||i,i.message);if(e.code===n8.MEDIA_OPTION_INVALID){a6.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await oW(500);continue}throw a6.error("[".concat(t,"] ").concat(e.toString())),e}if(!i)throw new n5(n8.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function s5(e,t,r){var i,n;if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new n5(n8.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return a6.debug("Using Video Source/ Audio Source"),o;if(e.screen){if(!o_()){if(nV()&&e.screen.extensionId&&e.screen.mandatory){if(!si.getStreamFromExtension)throw new n5(n8.NOT_SUPPORTED,"This browser does not support screen sharing");a6.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let r=await (n=e.screen.extensionId,new Promise((e,r)=>{try{chrome.runtime.sendMessage(n,{getStream:!0},i=>{if(!i||!i.streamId)return a6.error("[".concat(t,"] No response from Chrome Plugin. Plugin not installed properly"),i),void r(new n5(n8.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(i.streamId)})}catch(e){a6.error("[".concat(t,"] AgoraRTC screensharing plugin is not accessible(").concat(n,")"),e.toString()),r(new n5(n8.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=r,s7(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(si.getDisplayMedia){e.screen.mediaSource&&sm(e.screen.mediaSource);let r={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(i=e.screen.displaySurface)&&void 0!==i?i:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:n,surfaceSwitching:a,systemAudio:s,preferCurrentTab:c}=e.screen,d={selfBrowserSurface:n,surfaceSwitching:a,systemAudio:s,preferCurrentTab:c};n||delete d.selfBrowserSurface,a||delete d.surfaceSwitching,s||delete d.systemAudio,c||delete d.preferCurrentTab,a6.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:r,audio:e.screenAudio,controls:d})),s7(o,await navigator.mediaDevices.getDisplayMedia(sj({video:r,audio:e.screenAudio},d)))}else{if(!nG())throw a6.error("[".concat(t,"] This browser does not support screenSharing")),new n5(n8.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&sm(e.screen.mediaSource);let r={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};a6.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(r))),s7(o,await navigator.mediaDevices.getUserMedia(r))}}}else e.screen.sourceId?s7(o,await s0(e.screen.sourceId,e.screen,!!e.screenAudio)):s7(o,await s2(e.screen,!!e.screenAudio))}if(!e.video&&!e.audio)return o;let a={video:e.video,audio:e.audio},s=aP.MEDIA_DEVICE_CONSTRAINTS;if(s)try{"string"==typeof s&&(s=JSON.parse(s)),a=function e(t,r){if(!oX(t)||!oX(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){let i=[...t];for(let n=0;n<r.length;n++)i[n]=e(t[n],r[n]);return i}{let i=n3({},t);for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(Object.prototype.hasOwnProperty.call(t,n)?i[n]=e(t[n],r[n]):i[n]=r[n]);return i}}(a,s)}catch(e){}a6.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(a)),nL();let c,d=null;(nF()||nW()||nB())&&(d=await s4.lock());try{c=await navigator.mediaDevices.getUserMedia(a)}catch(e){throw d&&d(),e}return a.audio&&(s6=!0),a.video&&(s3=!0),s7(o,c),d&&d(),o}function s9(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new n5(n8.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new n5(n8.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new n5(n8.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new n5(n8.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new n5(n8.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new n5(n8.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return a6.error("getUserMedia unexpected error",e),new n5(n8.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function s7(e,t){let r=e.getVideoTracks()[0],i=e.getAudioTracks()[0],n=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(i&&e.removeTrack(i),e.addTrack(o)),n&&(r&&e.removeTrack(r),e.addTrack(n))}let ce=new class e extends op{get state(){return this._state}set state(e){e!==this._state&&(this.emit(sL.STATE_CHANGE,e),this._state=e)}constructor(){super(),sV(this,"_state",sD.IDLE),sV(this,"isAccessMicrophonePermission",!1),sV(this,"isAccessCameraPermission",!1),sV(this,"lastAccessMicrophonePermission",!1),sV(this,"lastAccessCameraPermission",!1),sV(this,"checkdeviceMatched",!1),sV(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(aP.ENUMERATE_DEVICES_INTERVAL||(n2()||nx()===nw.HARMONY_OS)&&n0())&&this.updateDevicesInfo()},aP.ENUMERATE_DEVICES_INTERVAL_TIME)}).catch(e=>a6.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new n5(n8.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let i=await navigator.mediaDevices.enumerateDevices(),n=this.checkMediaDeviceInfoIsOk(i),o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;n.audio&&(o=!1),n.video&&(a=!1);let s=null,c=null,d=null;if(!r&&(o||a)){if(s4.isLocked&&(a6.debug("[device manager] wait GUM lock"),(await s4.lock())(),a6.debug("[device manager] GUM unlock")),s6&&(o=!1,this.isAccessMicrophonePermission=!0),s3&&(a=!1,this.isAccessCameraPermission=!0),a6.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{d=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(t){let e=s9(t.name||t.code||t,t.message);if(e.code===n8.PERMISSION_DENIED)throw e;a6.warning("getUserMedia failed in getDevices",e)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(t){let e=s9(t.name||t.code||t,t.message);if(e.code===n8.PERMISSION_DENIED)throw e;a6.warning("getUserMedia failed in getDevices",e)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(t){let e=s9(t.name||t.code||t,t.message);if(e.code===n8.PERMISSION_DENIED)throw e;a6.warning("getUserMedia failed in getDevices",e)}this.isAccessCameraPermission=!0}a6.debug("[device manager] mic permission",e,"cam permission",t)}try{let e=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),d&&d.getTracks().forEach(e=>e.stop()),s=null,c=null,d=null,e}catch(e){return s&&s.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),d&&d.getTracks().forEach(e=>e.stop()),s=null,c=null,d=null,new n5(n8.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audioinput"===e.kind)}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(e=>"videoinput"===e.kind)}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audiooutput"===e.kind)}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===e);if(!t)throw new n5(n8.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=sD.INITING;try{await this.updateDevicesInfo(),this.state=sD.INITEND}catch(e){throw a6.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=sD.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new n5(n8.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;let t=e.find(e=>"audioinput"===e.kind&&"default"===e.deviceId),r=e.find(e=>"audiooutput"===e.kind&&"default"===e.deviceId);t&&r?r.groupId===t.groupId?a6.debug("[device-check] default input ".concat(t.label," and output ").concat(r.label," is the same group")):a6.debug("[device-check] default input ".concat(t.label," and output ").concat(r.label," is not the same group")):a6.debug("[device-check] default input or output not found")}let i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(e=>{if(!e.deviceId)return;let i=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(i?i.state:"INACTIVE")){let i={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),i),r.push(i)}i&&(i.updateAt=t)}),this.deviceInfoMap.forEach((e,i)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",r.push(e))}),this.state!==sD.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(sL.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(sL.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(sL.PLAYOUT_DEVICE_CHANGED,e)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(e=>"audioinput"===e.kind),r=e.filter(e=>"videoinput"===e.kind),i={audio:!1,video:!1};for(let e of t)if(e.label&&e.deviceId){i.audio=!0;break}for(let e of r)if(e.label&&e.deviceId){i.video=!0;break}return i}},ct=!1,cr=new class extends op{constructor(){super(...arguments),sV(this,"onAutoplayFailed",void 0),sV(this,"onAudioAutoplayFailed",void 0)}};function ci(){if(nL(),!ct){let e=t=>{t.preventDefault(),ct=!1,n1()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};ct=!0,n1()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),a6.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),cr.onAutoplayFailed?cr.onAutoplayFailed():cr.onAudioAutoplayFailed?a6.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):a6.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),cr.emit("autoplay-failed")}}function cn(e,t,r,i){if(!e)return;let n=st.getBaseInfoBySessionId(e);if(!n)return;let o=n.info,a=Date.now(),s=sj(sj({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:a,elapse:a-n.startTime,cbRegistered:cr.onAutoplayFailed||cr.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:i,extend:void 0});st.send({type:a9.AUTOPLAY_FAILED,data:s},!0)}let co=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ca=new class{constructor(){sV(this,"onAutoplayFailed",void 0),sV(this,"elementMap",new Map),sV(this,"elementStateMap",new Map),sV(this,"elementsNeedToResume",[]),sV(this,"sinkIdMap",new Map),sV(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,i]=t,n=this.elementStateMap.get(r),o=i.srcObject.getAudioTracks()[0],a=o&&o.readyState;if(a6.debug("resume after interrupted, ele: ".concat(n," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return i.pause(),void i.play();if("running"===sK.curState)return nz()?(i.pause(),void i.play()):void(n&&"paused"===n&&i.play())}})}),sV(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e,i=r.srcObject.getAudioTracks()[0];i&&"live"===i.readyState&&(a6.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),sK.on(ss.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sK.on(ss.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),sK.on(ss.STATE_CHANGE,()=>{nW()&&"suspended"===sK.prevState&&"running"===sK.curState&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(e){throw new n5(n8.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,r,i){if(this.elementMap.has(t))return;let n=document.createElement("audio");n.autoplay=!0,n.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,n),this.elementMap.set(t,n),this.elementStateMap.set(t,sM.INIT),this.setVolume(t,r);let o=this.sinkIdMap.get(t);if(o)try{n.setSinkId(o).catch(e=>{a6.warning("[".concat(t,"] set sink id failed"),e.toString())})}catch(e){a6.warning("[".concat(t,"] set sink id failed"),e.toString())}let a=n.play();a&&a.then&&a.catch(e=>{i&&cn(i,"audio",e.message,t),a6.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(a6.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(n),oP(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),ci()}))})}updateTrack(e,t){let r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){let r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){co.forEach(r=>{t.addEventListener(r,r=>{let i=this.elementStateMap.get(e),n="pause"===r.type?"paused":r.type;if(a6.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(n)),"error"===r.type){let r=null==t?void 0:t.error;r&&a6.error("[".concat(e,"] media error, code: ").concat(r.code,", message: ").concat(r.message))}this.elementStateMap.set(e,n)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(e=>{a6.debug("Auto resume audio element success")}).catch(e=>{a6.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new Promise(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{n1()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function cs(){return function(e,t,r){let i=r.value;return"function"==typeof i&&(r.value=function(){this._isClosed&&new n5(n8.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",a6);for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=i.apply(this,t);return n instanceof Promise?new Promise((e,t)=>{n.then(e).catch(t)}):n}),r}}class cc extends op{constructor(e){super(),sV(this,"name","VideoProcessorDestination"),sV(this,"ID","0"),sV(this,"_source",void 0),sV(this,"videoContext",void 0),sV(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new n5(n8.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new n5(n8.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(sN.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(sN.ON_TRACK,void 0)}}class cd extends op{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),sV(this,"constraintsMap",new Map),sV(this,"statsRegistry",[]),sV(this,"usageRegistry",[]),sV(this,"trackId",void 0),sV(this,"direction",void 0),sV(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await oR(this,sP.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){return a6.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),oI(this,sP.REQUEST_UPDATE_CONSTRAINTS,Array.from(this.constraintsMap.values()))}async requestRevertConstraints(e){if(this.constraintsMap.has(e))return a6.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),oI(this,sP.REQUEST_UPDATE_CONSTRAINTS,Array.from(this.constraintsMap.values()))}registerStats(e,t,r){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:r})}unregisterStats(e,t){let r=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t);-1!==r&&this.statsRegistry.splice(r,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:r,type:i,cb:n}of this.statsRegistry)try{let o=n();e.push({processorID:t,processorName:r,type:i,stats:o})}catch(e){a6.error(new n5(n8.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let r=t();r instanceof Promise&&(r=await r),e.push(sj(sj({},r),{},{direction:this.direction}))}catch(e){a6.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class cu extends op{constructor(e){super(),sV(this,"name","AudioProcessorDestination"),sV(this,"ID","0"),sV(this,"inputTrack",void 0),sV(this,"inputNode",void 0),sV(this,"audioProcessorContext",void 0),sV(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new n5(n8.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new n5(n8.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(sN.ON_TRACK,void 0),this.emit(sN.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(sN.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(sN.ON_NODE,this.inputNode))}}class cl extends op{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,r){super(),sV(this,"constraintsMap",new Map),sV(this,"statsRegistry",[]),sV(this,"audioContext",void 0),sV(this,"trackId",void 0),sV(this,"direction",void 0),sV(this,"usageRegistry",[]),sV(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=r}async getConstraints(){return oR(this,sP.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){return a6.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),oI(this,sP.REQUEST_UPDATE_CONSTRAINTS,Array.from(this.constraintsMap.values()))}async requestRevertConstraints(e){if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),oI(this,sP.REQUEST_UPDATE_CONSTRAINTS,Array.from(this.constraintsMap.values()))}registerStats(e,t,r){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:r})}unregisterStats(e,t){let r=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===t);-1!==r&&this.statsRegistry.splice(r,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:r,type:i,cb:n}of this.statsRegistry)try{let o=n();e.push({processorID:t,processorName:r,type:i,stats:o})}catch(e){a6.error(new n5(n8.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let r=t();r instanceof Promise&&(r=await r),e.push(sj(sj({},r),{},{direction:this.direction}))}catch(e){a6.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class ch extends op{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),sV(this,"context",void 0),sV(this,"processSourceNode",void 0),sV(this,"outputTrack",void 0),sV(this,"processedNode",void 0),sV(this,"clonedTrack",void 0),sV(this,"outputNode",void 0),this.outputNode=new cp}setVolume(){}createOutputTrack(){throw new n5(n8.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class cp{disconnect(){}connect(){}}function cf(e){return new Promise((t,r)=>{let i=!1,n=document.createElement("video");n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.muted=!0,n.autoplay=!0,n.setAttribute("playsinline",""),n.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(n);let o=nW()?"canplay":"playing";n.addEventListener(o,()=>{let e=n.videoWidth,r=n.videoHeight;!e&&nG()||(i=!0,n.srcObject=null,n.remove(),t([e,r]))}),n.srcObject=new MediaStream([e]),n.play().catch(oK),setTimeout(()=>{i||(n.srcObject=null,n.remove(),t([n.videoWidth,n.videoHeight]))},4e3)})}function c_(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let r=sp(e.encoderConfig);return null!=r.width&&(t.width=r.width),null!=r.height&&(t.height=r.height),!nZ()&&r.frameRate&&(t.frameRate=r.frameRate),nj()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),nG()&&(t.frameRate={ideal:30,max:30}),t}let cA=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:r,width:i,height:n}=e.getMediaStreamTrackSettings(),{frameRate:o=r,width:a=i,height:s=n}=t;if(!o||!a||!s)return;a=oq(a),s=oq(s);let{max:c,min:d}=function(e,t,r){let i=200*Math.pow(r/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(i),max:Math.floor(4*i)}}(a,s,o=oq(o)),{bitrateMax:u,bitrateMin:l}=t||{};u||a6.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(u,", brMin: ").concat(l,"]"));let{maxFramerate:h}=aP.ENCODER_CONFIG_LIMIT;return h&&"number"==typeof h&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:u||c,bitrateMin:l||d,scaleResolutionDownBy:1,scale:0}},cm=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new Promise((r,i)=>{t.toBlob(async e=>{(t.remove(),e)?r({buffer:await cv(e),width:t.width,height:t.height}):i(new n5(n8.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},cv=async e=>new Uint8Array(await e.arrayBuffer()),cE=(e$=se({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),e0=se({argsMap:(e,t)=>[e.getTrackId(),t]}),e2=cs(),e1=o2("LocalAudioTrack","_enabledMutex"),e4=se({argsMap:(e,t)=>[e.getTrackId(),t]}),e6=cs(),e3=o2("LocalAudioTrack","_enabledMutex"),e8=se({argsMap:(e,t)=>[e.getTrackId(),t]}),e5=cs(),e9=cs(),e7=cs(),te=se({argsMap:e=>[e.getTrackId()]}),tt=cs(),tr=se({argsMap:e=>[e.getTrackId()]}),ti=cs(),tn=se({argsMap:e=>[e.getTrackId()]}),to=se({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ta=se({argsMap:e=>[e.getTrackId()]}),sB((ts=class extends sW{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ca.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,i){super(e,r),sV(this,"trackMediaType",sy.AUDIO),sV(this,"_encoderConfig",void 0),sV(this,"_trackSource",void 0),sV(this,"metadata",[]),sV(this,"_enabled",!0),sV(this,"_volume",100),sV(this,"_useAudioElement",!0),sV(this,"_bypassWebAudio",!1),sV(this,"processor",void 0),sV(this,"_processorContext",void 0),sV(this,"_processorDestination",void 0),sV(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new ch,aP.DISABLE_WEBAUDIO&&(this._bypassWebAudio=!0),aP.LOCAL_AUDIO_TRACK_USES_WEB_AUDIO&&(this._useAudioElement=!1),nF()&&!sY?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){oe(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ca.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void a6.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,oI(this,sv.NEED_REPLACE_TRACK,this).then(()=>{a6.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{a6.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!so())throw new n5(n8.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ca.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(a6.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await oI(this,sv.NEED_ENABLE_TRACK,this),a6.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw r||(this._enabled=!1),a6.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await oI(this,sv.NEED_DISABLE_TRACK,this)}catch(e){throw r||(this._enabled=!0),a6.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,a6.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await oI(this,sv.NEED_MUTE_TRACK,this):await oI(this,sv.NEED_UNMUTE_TRACK,this))}getStats(){return ox(()=>{a6.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),oC(this,sv.GET_STATS)||sj({},sI)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(sR.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(sR.ON_AUDIO_BUFFER),this._source.on(sR.ON_AUDIO_BUFFER,t=>e(t))}play(){a6.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(a6.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ca.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){a6.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ca.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a6.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ca.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oI(this,sv.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Promise.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new n5(n8.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new n5(n8.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(sN.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await oI(this,sv.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oI(this,sv.NEED_REPLACE_TRACK,this))}),e.on(sN.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(e){e.removeAllListeners(sN.ON_TRACK),e.removeAllListeners(sN.ON_NODE)}bindProcessorContextEvents(e){e.on(sP.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(sP.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof ch&&(this._trackSource=new s$(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new cl(this._source.context,this.getTrackId(),"local"),t=new cu(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(sR.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ca.stop(this.getTrackId()),this._source.play()),oI(this,sv.NEED_REPLACE_MIXING_TRACK,this).then(()=>{a6.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(e=>{a6.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[e$],Object.getOwnPropertyDescriptor(ts.prototype,"setVolume"),ts.prototype),sB(ts.prototype,"setPlaybackDevice",[e0,e2],Object.getOwnPropertyDescriptor(ts.prototype,"setPlaybackDevice"),ts.prototype),sB(ts.prototype,"setEnabled",[e1,e4,e6],Object.getOwnPropertyDescriptor(ts.prototype,"setEnabled"),ts.prototype),sB(ts.prototype,"setMuted",[e3,e8,e5],Object.getOwnPropertyDescriptor(ts.prototype,"setMuted"),ts.prototype),sB(ts.prototype,"getStats",[e9],Object.getOwnPropertyDescriptor(ts.prototype,"getStats"),ts.prototype),sB(ts.prototype,"setAudioFrameCallback",[e7],Object.getOwnPropertyDescriptor(ts.prototype,"setAudioFrameCallback"),ts.prototype),sB(ts.prototype,"play",[te,tt],Object.getOwnPropertyDescriptor(ts.prototype,"play"),ts.prototype),sB(ts.prototype,"stop",[tr,ti],Object.getOwnPropertyDescriptor(ts.prototype,"stop"),ts.prototype),sB(ts.prototype,"close",[tn],Object.getOwnPropertyDescriptor(ts.prototype,"close"),ts.prototype),sB(ts.prototype,"pipe",[to],Object.getOwnPropertyDescriptor(ts.prototype,"pipe"),ts.prototype),sB(ts.prototype,"unpipe",[ta],Object.getOwnPropertyDescriptor(ts.prototype,"unpipe"),ts.prototype),ts),cg=(tc=se({argsMap:(e,t)=>[e.getTrackId(),t]}),td=cs(),tu=o2("MicrophoneAudioTrack","_enabledMutex"),tl=se({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),th=cs(),tp=se({argsMap:e=>[e.getTrackId()]}),sB((tf=class extends cE{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,i){super(e,t.encoderConfig?s_(t.encoderConfig):{},i,aP.GET_VOLUME_OF_MUTED_AUDIO_TRACK),sV(this,"_config",void 0),sV(this,"_deviceName","default"),sV(this,"_constraints",void 0),sV(this,"_originalConstraints",void 0),sV(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(nz()||nX())&&sK.bindInterruptDetectorTrack(this)}async setDevice(e){if(a6.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await ce.getDeviceById(e),r={};r.audio=sj({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await s8(r,this.getTrackId())}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),i=await s8({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{let t=await ce.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}a6.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return a6.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(a6.info("[".concat(this.getTrackId(),"] start setEnabled"),e),aP.AUTO_RESET_AUDIO_ROUTE&&(nW()||nq())){let t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(i=this._source.clonedTrack)||void 0===i||i.stop(),r||(this._enabled=!1);try{await oI(this,sv.NEED_DISABLE_TRACK,this)}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}let n=sj({},this._constraints),o=ce.searchDeviceIdByName(this._deviceName);o&&!n.deviceId&&(n.deviceId=o);try{r||(this._enabled=!0);let e=await s8({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await oI(this,sv.NEED_ENABLE_TRACK,this)}catch(e){throw r||(this._enabled=!1),a6.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}a6.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(nz()||nX())&&sK.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((nW()||nq())&&this._enabled&&!this._isClosed&&sK.duringInterruption){let e=async()=>{sK.off(ss.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(a6.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};sK.on(ss.IOS_INTERRUPTION_END,e)}else a6.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(sb.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=ce.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let e=await s8({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(sP.REQUEST_UPDATE_CONSTRAINTS,async(e,t,r)=>{try{let r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(e){r(e)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(sP.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[tc,td],Object.getOwnPropertyDescriptor(tf.prototype,"setDevice"),tf.prototype),sB(tf.prototype,"setEnabled",[tu,tl,th],Object.getOwnPropertyDescriptor(tf.prototype,"setEnabled"),tf.prototype),sB(tf.prototype,"close",[tp],Object.getOwnPropertyDescriptor(tf.prototype,"close"),tf.prototype),tf);t_=se({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),tA=cs(),tm=se({argsMap:e=>[e.getTrackId()]}),tv=cs(),tE=se({argsMap:e=>[e.getTrackId()]}),tg=cs(),tS=se({argsMap:e=>[e.getTrackId()]}),tb=cs(),tT=se({argsMap:e=>[e.getTrackId()]}),ty=cs(),tR=se({argsMap:e=>[e.getTrackId()]}),tI=se({argsMap:e=>[e.getTrackId()]}),tC=cs(),sB((tk=class extends cE{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,i){super(t.createOutputTrack(),r,i),sV(this,"source",void 0),sV(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(sR.AUDIO_SOURCE_STATE_CHANGE,e=>{this.safeEmit(sb.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){oe(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[t_,tA],Object.getOwnPropertyDescriptor(tk.prototype,"startProcessAudioBuffer"),tk.prototype),sB(tk.prototype,"pauseProcessAudioBuffer",[tm,tv],Object.getOwnPropertyDescriptor(tk.prototype,"pauseProcessAudioBuffer"),tk.prototype),sB(tk.prototype,"seekAudioBuffer",[tE,tg],Object.getOwnPropertyDescriptor(tk.prototype,"seekAudioBuffer"),tk.prototype),sB(tk.prototype,"resumeProcessAudioBuffer",[tS,tb],Object.getOwnPropertyDescriptor(tk.prototype,"resumeProcessAudioBuffer"),tk.prototype),sB(tk.prototype,"stopProcessAudioBuffer",[tT,ty],Object.getOwnPropertyDescriptor(tk.prototype,"stopProcessAudioBuffer"),tk.prototype),sB(tk.prototype,"close",[tR],Object.getOwnPropertyDescriptor(tk.prototype,"close"),tk.prototype),sB(tk.prototype,"setAudioBufferPlaybackSpeed",[tI,tC],Object.getOwnPropertyDescriptor(tk.prototype,"setAudioBufferPlaybackSpeed"),tk.prototype);class cS extends cE{get __className__(){return"MixingAudioTrack"}get isActive(){for(let e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){let e=sQ().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,oH(8,"track-mix-")),sV(this,"trackList",void 0),sV(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return -1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(a6.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):a6.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){a6.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}oO(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){let e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof cS?t.emit(sS.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class cb{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(a6.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){sV(this,"trackId",void 0),sV(this,"config",void 0),sV(this,"onFirstVideoFrameDecoded",void 0),sV(this,"onVideoStateChanged",void 0),sV(this,"freezeTimeCounterList",[]),sV(this,"renderFreezeAccTime",0),sV(this,"isKeepLastFrame",!1),sV(this,"timeUpdatedCount",0),sV(this,"freezeTime",0),sV(this,"playbackTime",0),sV(this,"lastTimeUpdatedTime",0),sV(this,"autoplayFailed",!1),sV(this,"videoTrack",void 0),sV(this,"videoElement",void 0),sV(this,"cacheVideoElement",void 0),sV(this,"renderStats",void 0),sV(this,"_videoState",sx.VideoStateStopped),sV(this,"videoElementCheckInterval",void 0),sV(this,"videoElementFreezeTimeout",void 0),sV(this,"_videoElementStatus",sM.NONE),sV(this,"isGettingVideoDimensions",!1),sV(this,"startGetVideoDimensions",()=>{let e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return a6.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};this.isGettingVideoDimensions||e()}),sV(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===sK.curState&&(a6.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(nU())),nJ()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack])):this.videoElement.pause(),this.videoElement.play())}),sV(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=sM.PLAYING;break;case"loadeddata":if(this.videoState=sx.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=sM.CANPLAY;break;case"stalled":this.videoElementStatus=sM.STALLED;break;case"suspend":this.videoElementStatus=sM.SUSPEND;break;case"pause":this.videoElementStatus=sM.PAUSED,nW()||nq()||nF()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(a6.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=sM.WAITING;break;case"abort":this.videoElementStatus=sM.ABORT;break;case"ended":this.videoElementStatus=sM.ENDED;break;case"emptied":this.videoElementStatus=sM.EMPTIED;break;case"error":{let e=this.videoElement.error;e&&(this.videoElementStatus=sM.ERROR,a6.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{let e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);let t=e-this.lastTimeUpdatedTime,r=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,cP.lastVisibleTime<cP.lastHiddenTime||r<cP.lastHiddenTime||r<cP.lastVisibleTime)return;for(t>aP.VIDEO_FREEZE_DURATION&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;let e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}}}}),sV(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(a6.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(nU())),nJ()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack])):this.videoElement.pause(),this.videoElement.play())}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),sK.on(ss.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sK.on(ss.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch(t=>{e&&cn(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(a6.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):a6.warning("[".concat(this.trackId,"] play warning: "),t)});let r=nL();if(("Safari"===r.name&&15===Number(r.version)||nz())&&t&&t.then){let e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return a6.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let r=t.getImageData(0,0,e.width,e.height);return e.remove(),r}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;let i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new Promise((i,n)=>{r.toBlob(async e=>{(r.remove(),e)?i({buffer:await cv(e),width:r.width,height:r.height}):n(new n5(n8.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await cm(e)}destroy(){this.renderStats=void 0,sK.off(ss.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),sK.off(ss.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=sx.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=sM.INIT,!this.videoElementCheckInterval&&(cT.forEach(e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var e;(e=this.videoElement)!==document.body&&document.body.contains(e)||(this.videoElementStatus=sM.DESTROYED)},1e3),aP.ENABLE_VIDEO_FRAME_CALLBACK)){var e,t;let r;let i=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",i),this.videoElementFreezeTimeout=window.setTimeout(n,aP.VIDEO_FREEZE_DURATION))},n=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===sx.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=sx.VideoStateFrozen:document.addEventListener("visibilitychange",i))},o=(e,t)=>{var i,a;if(this.videoElementStatus===sM.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=t.mediaTime):this.renderStats={lastTs:t.mediaTime,curTs:t.mediaTime,lastRenderNum:0,renderNum:0},r){let e=t.presentationTime-r.presentationTime;this.videoState===sx.VideoStateStarting&&(this.videoState=sx.VideoStateDecoding),this.videoState===sx.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(n,aP.VIDEO_FREEZE_DURATION)),e<aP.VIDEO_FREEZE_DURATION&&this.videoState===sx.VideoStateFrozen&&(this.videoState=sx.VideoStateDecoding),e>aP.VIDEO_FREEZE_DURATION&&cP.lastVisibleTime>=cP.lastHiddenTime&&r.timestamp>cP.lastVisibleTime&&r.timestamp>cP.lastHiddenTime&&(this.renderFreezeAccTime+=e)}r=sj(sj({},t),{},{timestamp:e})}aP.ENABLE_VIDEO_FRAME_CALLBACK&&(null===(i=(a=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(a,o))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,o)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),n2()&&!aP.HIDE_NO_POSTER&&(this.videoElement.poster="noposter");let r=nL();("Safari"===r.name&&15===Number(r.version)||nz()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream)?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nG()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nG()&&this.videoElement.load());let i=this.videoElement.play();void 0!==i&&i.catch(e=>{a6.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}resetVideoElement(){cT.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=sM.NONE}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{a6.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(e=>{a6.error(e)}),this.autoplayFailed=!1,n1()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};n1()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),ci()}}let cT=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class cy extends cb{constructor(e){super(e),sV(this,"container",void 0),sV(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,r):await cm(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",aP.KEEP_LAST_FRAME&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}let cR=(tw=se({argsMap:(e,t,r)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),tO=cs(),tN=se({argsMap:e=>[e.getTrackId()]}),tP=o2("LocalVideoTrack","_enabledMutex"),tD=se({argsMap:(e,t)=>[e.getTrackId(),t]}),tL=cs(),tM=o2("LocalVideoTrack","_enabledMutex"),tx=se({argsMap:(e,t)=>[e.getTrackId(),t]}),tU=cs(),tB=se({argsMap:(e,t)=>[e.getTrackId(),t]}),tV=cs(),tF=cs(),tj=se({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),tG=cs(),tW=cs(),tH=cs(),tY=cs(),tK=cs(),tQ=cs(),tz=cs(),tX=se({argsMap:(e,t)=>[e.getTrackId(),t.name]}),tJ=se({argsMap:e=>[e.getTrackId()]}),tq=se({argsMap:e=>[e.getTrackId()]}),tZ=se({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),sB((t$=class e extends sW{get videoHeight(){if(nF()){let{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(nF()){let{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==sM.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,r,i,n,o){if(super(e,n),sV(this,"trackMediaType",sy.VIDEO),sV(this,"_player",void 0),sV(this,"isUseScaleResolutionDownBy",!1),sV(this,"_videoVisibleTimer",null),sV(this,"_previousVideoVisibleStatus",void 0),sV(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),sV(this,"_encoderConfig",void 0),sV(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),sV(this,"_optimizationMode",void 0),sV(this,"_videoHeight",void 0),sV(this,"_videoWidth",void 0),sV(this,"_forceBitrateLimit",void 0),sV(this,"_enabled",!0),sV(this,"_processorDestination",void 0),sV(this,"_processorContext",void 0),nF()){let{width:t,height:r}=e.getSettings();this._videoWidth=t,this._videoHeight=r}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],-1===this._hints.indexOf(sE.SCREEN_TRACK))this.updateBitrateFromProfile();else if(nY(nO.CHROME,115)&&-1!==nx().indexOf("Windows")){let t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&si.supportWebRTCInsertableStream){let r=new MediaStreamTrackProcessor(e),i=new MediaStreamTrackGenerator({kind:"video"}),n,o,a=Date.now(),s=()=>{c&&(clearInterval(c),c=void 0),n&&(n.close(),n=void 0),e.stop(),o=void 0,i.removeEventListener("ended",s)},c=window.setInterval(()=>{if(o&&n&&Date.now()-a>1e3)try{"live"===i.readyState?o.enqueue(n.clone()):s()}catch(e){s()}},null!=t?t:1e3),d=new TransformStream({transform:(e,t)=>{"live"===i.readyState?(o=t,a=Date.now(),void 0===n?(n=e,t.enqueue(e.clone())):(t.enqueue(n),n=e)):e.close()}});return i.addEventListener("ended",s),r.readable.pipeThrough(d).pipeTo(i.writable),i}}(e);t&&(a6.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(sE.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new cd(this.getTrackId(),"local"),this._processorDestination=new cc(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let t=document.getElementById(e);t?e=t:(a6.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}a6.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=sj(sj(sj({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new cb(r):this._player=new cy(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let e=this.getVideoElementVisibleStatus();this.safeEmit(sb.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},aP.CHECK_VIDEO_VISIBLE_INTERVAL)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,a6.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(a6.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await oI(this,sv.NEED_DISABLE_TRACK,this)}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void a6.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await oI(this,sv.NEED_ENABLE_TRACK,this)}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}a6.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,a6.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await oI(this,sv.NEED_MUTE_TRACK,this):await oI(this,sv.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new n5(n8.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=sp(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){let t=c_({encoderConfig:e});(nF()||nW()||nq())&&(t.deviceId=void 0),a6.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(t){let e=new n5(n8.UNEXPECTED_ERROR,t.toString());throw a6.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}}this._encoderConfig=e,-1===this._hints.indexOf(sE.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await oI(this,sv.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(a6)}}getStats(){return ox(()=>{a6.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),oC(this,sv.GET_STATS)||sj({},sC)}async setBeautyEffect(e){a6.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await cm(e)}async setBitrateLimit(e){a6.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void a6.error(n8.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let t=this._optimizationMode;try{this._optimizationMode=e,await oI(this,sv.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,a6.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}a6.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return a6.error(n8.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,a6.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){cf(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(oK)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new n5(n8.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");a6.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=sp(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(sE.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await oI(this,sv.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(a6)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:e,height:t,frameRate:r}=this.getMediaStreamTrackSettings();if(!e||!t||!r)return;let{bitrateMax:i,bitrateMin:n}=this._encoderConfig;if(null==n||null==i){let{max:o,min:a}=function(e,t,r,i,n){var o,a;let s=aP.BITRATE_ADAPTER_TYPE;if("DEFAULT_BITRATE"===s)return{min:i,max:n};if(void 0===n){let a=Math.floor(200*Math.pow(r/15,.6)*Math.pow(e*t/640/360,.75));n="STANDARD_BITRATE"===s?4*a:2*a,i=null!==(o=i)&&void 0!==o?o:a}else i=null!==(a=i)&&void 0!==a?a:Math.floor(n/10);return{min:i,max:n}}(e,t,r,n,i);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,a6.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var e,t;let r=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),{element:i,slot:n}={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==r?void 0:r.parentElement};if(this.isPlaying&&i instanceof HTMLVideoElement&&n instanceof HTMLElement){let e=oc.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;let e=st.reportApiInvoke(null,{tag:om.TRACER,name:oA.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new n5(n8.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new n5(n8.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._encoderConfig;t&&(i=sj(sj({},i),sp(t))),i=oL(i);let n=oH(8,"track-video-cloned-"),o=new e(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,oL(this._scalabilityMode),this._optimizationMode,n,oL(this._hints));return t&&i&&o.setEncoderConfiguration(i),a6.debug("clone video track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(r)),o}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new n5(n8.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new n5(n8.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(ox(()=>{st.reportApiInvoke(null,{name:oA.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:om.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!aP.ENABLE_VIDEO_SEI||!aP.ENABLE_ENCODED_TRANSFORM)return void a6.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==!1)return new n5(n8.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let t=this.getRTCRtpTransceiver();if(!t)return void a6.warning("Video track is not published, SEI can not be send");let r=t.sender.getParameters();if(0===r.codecs.length)return;let i=r.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===i?this.safeEmit("sei-to-send",e):a6.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(sN.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await oI(this,sv.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oI(this,sv.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sN.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(sP.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(sP.REQUEST_CONSTRAINTS)}}).prototype,"play",[tw,tO],Object.getOwnPropertyDescriptor(t$.prototype,"play"),t$.prototype),sB(t$.prototype,"stop",[tN],Object.getOwnPropertyDescriptor(t$.prototype,"stop"),t$.prototype),sB(t$.prototype,"setEnabled",[tP,tD,tL],Object.getOwnPropertyDescriptor(t$.prototype,"setEnabled"),t$.prototype),sB(t$.prototype,"setMuted",[tM,tx,tU],Object.getOwnPropertyDescriptor(t$.prototype,"setMuted"),t$.prototype),sB(t$.prototype,"setEncoderConfiguration",[tB,tV],Object.getOwnPropertyDescriptor(t$.prototype,"setEncoderConfiguration"),t$.prototype),sB(t$.prototype,"getStats",[tF],Object.getOwnPropertyDescriptor(t$.prototype,"getStats"),t$.prototype),sB(t$.prototype,"setBeautyEffect",[tj,tG],Object.getOwnPropertyDescriptor(t$.prototype,"setBeautyEffect"),t$.prototype),sB(t$.prototype,"getCurrentFrameData",[tW],Object.getOwnPropertyDescriptor(t$.prototype,"getCurrentFrameData"),t$.prototype),sB(t$.prototype,"getCurrentFrameImage",[tH],Object.getOwnPropertyDescriptor(t$.prototype,"getCurrentFrameImage"),t$.prototype),sB(t$.prototype,"setBitrateLimit",[tY],Object.getOwnPropertyDescriptor(t$.prototype,"setBitrateLimit"),t$.prototype),sB(t$.prototype,"setOptimizationMode",[tK],Object.getOwnPropertyDescriptor(t$.prototype,"setOptimizationMode"),t$.prototype),sB(t$.prototype,"setScalabiltyMode",[tQ],Object.getOwnPropertyDescriptor(t$.prototype,"setScalabiltyMode"),t$.prototype),sB(t$.prototype,"updateMediaStreamTrackResolution",[tz],Object.getOwnPropertyDescriptor(t$.prototype,"updateMediaStreamTrackResolution"),t$.prototype),sB(t$.prototype,"pipe",[tX],Object.getOwnPropertyDescriptor(t$.prototype,"pipe"),t$.prototype),sB(t$.prototype,"unpipe",[tJ],Object.getOwnPropertyDescriptor(t$.prototype,"unpipe"),t$.prototype),sB(t$.prototype,"close",[tq],Object.getOwnPropertyDescriptor(t$.prototype,"close"),t$.prototype),sB(t$.prototype,"replaceTrack",[tZ],Object.getOwnPropertyDescriptor(t$.prototype,"replaceTrack"),t$.prototype),t$),cI=(t0=se({argsMap:(e,t)=>[e.getTrackId(),t]}),t2=cs(),t1=o2("CameraVideoTrack","_enabledMutex"),t4=se({argsMap:(e,t)=>[e.getTrackId(),t]}),t6=cs(),t3=se({argsMap:(e,t)=>[e.getTrackId(),t]}),t8=cs(),t5=se({argsMap:e=>[e.getTrackId()]}),sB((t9=class e extends cR{get __className__(){return"CameraVideoTrack"}constructor(e,t,r,i,n,o){super(e,sp(t.encoderConfig),i,n,o),sV(this,"_config",void 0),sV(this,"_originalConstraints",void 0),sV(this,"_constraints",void 0),sV(this,"_enabled",!0),sV(this,"_deviceName","default"),sV(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(nz()||nX())&&!function(){let e=nL();if(e.os!==nw.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&nL().name===nO.WECHAT&&this._enabled&&!this._isClosed&&(a6.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=r,this._constraints=r,this._deviceName=e.label,this._encoderConfig=sp(this._config.encoderConfig),sK.on(ss.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),sK.on(ss.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(a6.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{let t=await ce.getDeviceById(e),r={};r.video=sj({},this._constraints),r.video.deviceId={exact:e},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await s8(r,this.getTrackId())}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),i=await s8({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{let t=await ce.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}a6.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){a6.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));let t={video:sj(sj({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await s8(t,this.getTrackId())}catch(t){throw a6.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await s8({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=sj({},t.video),a6.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(a6.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let e=await s8({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await oI(this,sv.NEED_ENABLE_TRACK,this)}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),a6.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await oI(this,sv.NEED_DISABLE_TRACK,this)}catch(e){throw a6.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}a6.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new n5(n8.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=sp(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);let r=oD(this._config);r.encoderConfig=e;let i=c_(r);(nF()||nW()||nq())&&(i.deviceId=void 0),a6.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(t){let e=new n5(n8.UNEXPECTED_ERROR,t.toString());throw a6.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,-1===this._hints.indexOf(sE.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await oI(this,sv.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(a6)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((nW()||nq())&&this._enabled&&!this._isClosed&&sK.duringInterruption){let e=async()=>{sK.off(ss.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(a6.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};sK.on(ss.IOS_INTERRUPTION_END,e)}else a6.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(sb.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=ce.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId={exact:r}),this._enabled){let e=await s8({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),sK.off(ss.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),sK.off(ss.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._encoderConfig;t&&(i=sj(sj({},i),sp(t))),i=oL(i);let n=oH(8,"track-cam-cloned-"),o=new e(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,oL(sj(sj({},this._config),{},{encoderConfig:i})),oL(this._constraints),oL(this._scalabilityMode),this._optimizationMode,n);return t&&i&&o.setEncoderConfiguration(i),a6.debug("clone track from ".concat(this.getTrackId()," to ").concat(n,", clone ").concat(r)),o}bindProcessorContextEvents(){this.processorContext.on(sP.REQUEST_UPDATE_CONSTRAINTS,async(e,t,r)=>{try{let r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(e){r(e)}}),this.processorContext.on(sP.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[t0,t2],Object.getOwnPropertyDescriptor(t9.prototype,"setDevice"),t9.prototype),sB(t9.prototype,"setEnabled",[t1,t4,t6],Object.getOwnPropertyDescriptor(t9.prototype,"setEnabled"),t9.prototype),sB(t9.prototype,"setEncoderConfiguration",[t3,t8],Object.getOwnPropertyDescriptor(t9.prototype,"setEncoderConfiguration"),t9.prototype),sB(t9.prototype,"close",[t5],Object.getOwnPropertyDescriptor(t9.prototype,"close"),t9.prototype),t9);function cC(e){let t=oH(8,"track-cus-"),r=st.reportApiInvoke(null,{id:t,tag:om.TRACER,name:oA.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new cE(e.mediaStreamTrack,e.encoderConfig?s_(e.encoderConfig):{},t,!1);return a6.info("create custom audio track success with config",e,"trackId",i.getTrackId()),r.onSuccess(i.getTrackId()),i}async function ck(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=oH(8,"track-mic-"),r=st.reportApiInvoke(null,{id:t,tag:om.TRACER,name:oA.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=function(e){let t=function(e){let t={};return nZ()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,nV()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}(e);if(e.encoderConfig){let r=s_(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),n2()&&(t.sampleRate=void 0),t}(e),n=null;a6.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{n=(await s8({audio:i},t)).getAudioTracks()[0]||null}catch(e){throw r.onError(e),e}if(!n){let e=new n5(n8.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(e),e.throw(a6)}let o=new cg(n,e,i,t);return r.onSuccess(o.getTrackId()),a6.info("create microphone audio track success, trackId:",t),o}class cw extends sG{getUserId(){return this._userId}constructor(e,t,r,i){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(i.clientId,"_").concat(oH(5,""))),sV(this,"_userId",void 0),sV(this,"_uintId",void 0),sV(this,"_isDestroyed",!1),sV(this,"store",void 0),sV(this,"processor",void 0),sV(this,"processorContext",void 0),this._userId=t,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,a6.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let cO=(t7=se({argsMap:(e,t,r)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),re=se({argsMap:e=>[e.getTrackId()]}),rt=se({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rr=se({argsMap:e=>[e.getTrackId()]}),sB((ri=class extends cw{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==sM.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,i){super(e,t,r,i),sV(this,"_videoVisibleTimer",null),sV(this,"_previousVideoVisibleStatus",void 0),sV(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),sV(this,"trackMediaType",sy.VIDEO),sV(this,"_videoWidth",void 0),sV(this,"_videoHeight",void 0),sV(this,"_player",void 0),sV(this,"processorDestination",void 0),sV(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new cd(this.getTrackId(),"remote"),this.processorDestination=new cc(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ox(()=>{a6.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),oC(this,sv.GET_STATS)||sj({},sO)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let t=document.getElementById(e);t?e=t:(a6.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}a6.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=sj(sj({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new cb(r):this._player=new cy(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(sT.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=e=>{this.safeEmit(sT.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let e=this.getVideoElementVisibleStatus();this.safeEmit(sT.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},aP.CHECK_VIDEO_VISIBLE_INTERVAL)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,a6.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){cf(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(oK)}_updatePlayerSource(){a6.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let r=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),{element:i,slot:n}={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==r?void 0:r.parentElement};if(this.isPlaying&&i instanceof HTMLVideoElement&&n instanceof HTMLElement){let e=oc.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;let e=st.reportApiInvoke(null,{tag:om.TRACER,name:oA.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new n5(n8.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new n5(n8.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(sN.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sN.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(sS.SEI_RECEIVED,e)}}).prototype,"play",[t7],Object.getOwnPropertyDescriptor(ri.prototype,"play"),ri.prototype),sB(ri.prototype,"stop",[re],Object.getOwnPropertyDescriptor(ri.prototype,"stop"),ri.prototype),sB(ri.prototype,"pipe",[rt],Object.getOwnPropertyDescriptor(ri.prototype,"pipe"),ri.prototype),sB(ri.prototype,"unpipe",[rr],Object.getOwnPropertyDescriptor(ri.prototype,"unpipe"),ri.prototype),ri),cN=(rn=se({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),ro=se({argsMap:(e,t)=>[e.getTrackId(),t]}),ra=se({argsMap:e=>[e.getTrackId()]}),rs=se({argsMap:e=>[e.getTrackId()]}),rc=se({argsMap:(e,t)=>[e.getTrackId(),t.name]}),rd=se({argsMap:e=>[e.getTrackId()]}),sB((ru=class extends cw{get isPlaying(){return this._useAudioElement?ca.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,i){super(e,t,r,i),sV(this,"trackMediaType",sy.AUDIO),sV(this,"_source",void 0),sV(this,"_useAudioElement",!0),sV(this,"_volume",100),sV(this,"processorContext",void 0),sV(this,"processorDestination",void 0),sV(this,"_played",!1),sV(this,"_bypassWebAudio",!1),aP.DISABLE_WEBAUDIO?(this._source=new ch,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new s$(e,!0),aP.REMOTE_AUDIO_TRACK_USES_WEB_AUDIO&&(this._useAudioElement=!1)),this._source.once(sR.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(sT.FIRST_FRAME_DECODED)}),this.processorContext=new cl(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new cu(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(sR.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(sR.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(sR.ON_AUDIO_BUFFER),this._source.on(sR.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){this._volume=e,this._useAudioElement?ca.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!so())throw new n5(n8.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ca.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ox(()=>{a6.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),oC(this,sv.GET_STATS)||sj({},sk)}play(){a6.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(a6.debug("[".concat(this.getTrackId(),"] use audio element to play")),ca.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){a6.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ca.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a6.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ca.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new n5(n8.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new n5(n8.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new n5(n8.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(sN.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(sN.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sN.ON_TRACK),this.processorDestination.removeAllListeners(sN.ON_NODE)}}).prototype,"setVolume",[rn],Object.getOwnPropertyDescriptor(ru.prototype,"setVolume"),ru.prototype),sB(ru.prototype,"setPlaybackDevice",[ro],Object.getOwnPropertyDescriptor(ru.prototype,"setPlaybackDevice"),ru.prototype),sB(ru.prototype,"play",[ra],Object.getOwnPropertyDescriptor(ru.prototype,"play"),ru.prototype),sB(ru.prototype,"stop",[rs],Object.getOwnPropertyDescriptor(ru.prototype,"stop"),ru.prototype),sB(ru.prototype,"pipe",[rc],Object.getOwnPropertyDescriptor(ru.prototype,"pipe"),ru.prototype),sB(ru.prototype,"unpipe",[rd],Object.getOwnPropertyDescriptor(ru.prototype,"unpipe"),ru.prototype),ru),cP=new class extends op{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),sV(this,"_lastHiddenTime",0),sV(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),a6.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};var cD=((q=cD||{})[q.AUDIO_LEVEL=1]="AUDIO_LEVEL",q[q.METADATA=2]="METADATA",q[q.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",q);let cL=new Map;window.cache=cL,!function(){var e;let t=nL();si.getDisplayMedia=!!navigator.mediaDevices&&!!navigator.mediaDevices.getDisplayMedia||!1,si.getStreamFromExtension=t.name===nO.CHROME&&Number(t.version)>34,si.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),si.supportMinBitrate=t.name===nO.CHROME||t.name===nO.EDGE,si.supportSetRtpSenderParameters=function(){let e=nL();return!!window.RTCRtpSender&&!!window.RTCRtpSender.prototype.setParameters&&!!window.RTCRtpSender.prototype.getParameters&&(!!n0()||!(!nF()&&!nB())||e.name===nO.FIREFOX&&Number(e.version)>=64)}(),t.name===nO.SAFARI&&(Number(t.version)>=14?si.supportDualStream=!0:si.supportDualStream=!1),si.webAudioMediaStreamDest=function(){let e=nL();return!(e.name===nO.SAFARI&&12>Number(e.version))&&!0}(),si.supportReplaceTrack=!!window.RTCRtpSender&&("function"==typeof RTCRtpSender.prototype.replaceTrack||!1),si.supportWebGL="undefined"!=typeof WebGLRenderingContext,si.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,n0()||(si.webAudioWithAEC=!0),si.supportShareAudio=function(){let e=nL();return!!((e.os===nw.WIN_10||e.os===nw.WIN_81||e.os===nw.WIN_7||e.os===nw.LINUX||e.os===nw.MAC_OS||e.os===nw.CHROMIUM_OS)&&e.name===nO.CHROME&&Number(e.version)>=74)||!1}(),si.supportDataChannel=!!(nH(76)||function(e){let t=nL();return!(t.name!==nO.FIREFOX||!t.osVersion)&&Number(t.version)>=68}(68)||nK(14))||!1,si.supportPCSetConfiguration=function(){let e=window.RTCPeerConnection;return!nG()&&!!e&&e.prototype.setConfiguration instanceof Function}(),si.supportWebRTCEncodedTransform=function(){let e=nL();return"Chrome"===e.name&&Number(e.version)>=87||"Safari"===e.name&&Number(e.version)>=15}(),si.supportWebRTCInsertableStream=function(){let e=nL();return(e.name===nO.CHROME||e.name===nO.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),si.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype||!1,si.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,oP(()=>{si.supportDualStreamEncoding=function(){let e=nL();return!!aP.DISABLE_WEBAUDIO||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&aP.CHROME_DUAL_STREAM_USE_ENCODING)}(),a6.debug("browser ua: ",navigator.userAgent),a6.info("browser info: ",t),a6.info("browser compatibility: ",si)})}(),!function(){function e(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var t,r,i,n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){return e==Array.prototype||e==Object.prototype?e:(e[t]=r.value,e)},o=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function a(e,t){if(t)t3:{var r=o;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in r))break t3;r=r[a]}(t=t(i=r[e=e[e.length-1]]))!=i&&null!=t&&n(r,e,{configurable:!0,writable:!0,value:t})}}a("Symbol",function(e){function t(e,t){this.A=e,n(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(n){if(this instanceof e)throw TypeError("Symbol is not a constructor");return new t(r+(n||"")+"_"+i++,n)}}),a("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var r="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<r.length;i++){var a=o[r[i]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&n(a.prototype,t,{configurable:!0,writable:!0,value:function(){return function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}(e(this))}})}return t});function s(t){var r="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return r?r.call(t):{next:e(t)}}if("function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{t3:{var c={};try{c.__proto__={a:!0},i=c.a;break t3}catch(e){}i=!1}r=i?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw TypeError(e+" is not extensible");return e}:null}var d=r;function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function l(e){if(e.m)throw TypeError("Generator is already running");e.m=!0}function h(e,t){return e.h=3,{value:t}}function p(e){this.g=new u,this.G=e}u.prototype.o=function(e){this.v=e},u.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},u.prototype.return=function(e){this.l={return:e},this.h=this.u},p.prototype.o=function(e){return(l(this.g),this.g.j)?f(this,this.g.j.next,e,this.g.o):(this.g.o(e),_(this))};function f(e,t,r,i){try{var n=t.call(e.g.j,r);if(!(n instanceof Object))throw TypeError("Iterator result "+n+" is not an object");if(!n.done)return e.g.m=!1,n;var o=n.value}catch(t){return e.g.j=null,e.g.s(t),_(e)}return e.g.j=null,i.call(e.g,o),_(e)}function _(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function A(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){var r,i,n;return r=e,i=t,l(r.g),(n=r.g.j)?f(r,"return"in n?n.return:function(e){return{value:e,done:!0}},i,r.g.return):(r.g.return(i),_(r))},this[Symbol.iterator]=function(){return this}}function m(e,t){return t=new A(new p(t)),d&&e.prototype&&d(t,e.prototype),t}p.prototype.s=function(e){return(l(this.g),this.g.j)?f(this,this.g.j.throw,e,this.g.o):(this.g.s(e),_(this))};if(a("Array.prototype.entries",function(e){return e||function(){var e,t,r,i,n;return e=this,t=function(e,t){return[e,t]},e instanceof String&&(e+=""),r=0,i=!1,(n={next:function(){if(!i&&r<e.length){var n=r++;return{value:t(n,e[n]),done:!1}}return i=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return n},n}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var v=function(e,t){for(var r=0;r<e.length;r++)t(e[r])},E=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},g=function(e,t,r){return t instanceof Blob?(r=void 0!==r?String(r+""):"string"==typeof t.name?t.name:"blob",(t.name!==r||"[object Blob]"===Object.prototype.toString.call(t))&&(t=new File([t],r)),[String(e),t]):[String(e),String(t)]},S=function(e,t){if(e.length<t)throw TypeError(t+" argument required, but only "+e.length+" present.")},b="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,T=b.FormData,y=b.XMLHttpRequest&&b.XMLHttpRequest.prototype.send,R=b.Request&&b.fetch,I=b.navigator&&b.navigator.sendBeacon,C=b.Element&&b.Element.prototype,k=b.Symbol&&Symbol.toStringTag;k&&(Blob.prototype[k]||(Blob.prototype[k]="Blob"),"File"in b&&!File.prototype[k]&&(File.prototype[k]="File"));try{new File([],"")}catch(e){b.File=function(e,t,r){return Object.defineProperties(e=new Blob(e,r||{}),{name:{value:t},lastModified:{value:+(r&&void 0!==r.lastModified?new Date(r.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),k&&Object.defineProperty(e,k,{value:"File"}),e}}var w=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},O=function(e){this.i=[];var t=this;e&&v(e.elements,function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *")){if("file"===e.type){var r=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];v(r,function(r){t.append(e.name,r)})}else"select-multiple"===e.type||"select-one"===e.type?v(e.options,function(r){!r.disabled&&r.selected&&t.append(e.name,r.value)}):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(r="textarea"===e.type?E(e.value):e.value,t.append(e.name,r))}})};if((t=O.prototype).append=function(e,t,r){S(arguments,2),this.i.push(g(e,t,r))},t.delete=function(e){S(arguments,1);var t=[];e=String(e),v(this.i,function(r){r[0]!==e&&t.push(r)}),this.i=t},t.entries=function e(){var t,r=this;return m(e,function(e){if(1==e.h&&(t=0),3!=e.h)return t<r.i.length?e=h(e,r.i[t]):(e.h=0,e=void 0),e;t++,e.h=2})},t.forEach=function(e,t){S(arguments,1);for(var r=s(this),i=r.next();!i.done;i=r.next()){var n=s(i.value);i=n.next().value,n=n.next().value,e.call(t,n,i,this)}},t.get=function(e){S(arguments,1);var t=this.i;e=String(e);for(var r=0;r<t.length;r++)if(t[r][0]===e)return t[r][1];return null},t.getAll=function(e){S(arguments,1);var t=[];return e=String(e),v(this.i,function(r){r[0]===e&&t.push(r[1])}),t},t.has=function(e){S(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},t.keys=function e(){var t,r,i=this;return m(e,function(e){if(1==e.h&&(r=(t=s(i)).next()),3!=e.h){if(r.done){e.h=0;return}return h(e,s(r.value).next().value)}r=t.next(),e.h=2})},t.set=function(e,t,r){S(arguments,2),e=String(e);var i=[],n=g(e,t,r),o=!0;v(this.i,function(t){t[0]===e?o&&(o=!i.push(n)):i.push(t)}),o&&i.push(n),this.i=i},t.values=function e(){var t,r,i,n=this;return m(e,function(e){if(1==e.h&&(r=(t=s(n)).next()),3!=e.h){if(r.done){e.h=0;return}return(i=s(r.value)).next(),h(e,i.next().value)}r=t.next(),e.h=2})},O.prototype._asNative=function(){for(var e=new T,t=s(this),r=t.next();!r.done;r=t.next()){var i=s(r.value);r=i.next().value,i=i.next().value,e.append(r,i)}return e},O.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],r="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(e,i){return"string"==typeof e?t.push(r+w(E(i))+('"\r\n\r\n'+E(e))+"\r\n"):t.push(r+w(E(i))+('"; filename="'+w(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream"))+"\r\n\r\n",e,"\r\n")}),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},O.prototype[Symbol.iterator]=function(){return this.entries()},O.prototype.toString=function(){return"[object FormData]"},C&&!C.matches&&(C.matches=C.matchesSelector||C.mozMatchesSelector||C.msMatchesSelector||C.oMatchesSelector||C.webkitMatchesSelector||function(e){e=(this.document||this.ownerDocument).querySelectorAll(e);for(var t=e.length;0<=--t&&e.item(t)!==this;);return -1<t}),k&&(O.prototype[k]="FormData"),y){var N=b.XMLHttpRequest.prototype.setRequestHeader;b.XMLHttpRequest.prototype.setRequestHeader=function(e,t){N.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},b.XMLHttpRequest.prototype.send=function(e){e instanceof O&&(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type)),y.call(this,e)}}R&&(b.fetch=function(e,t){return t&&t.body&&t.body instanceof O&&(t.body=t.body._blob()),R.call(this,e,t)}),I&&(b.navigator.sendBeacon=function(e,t){return t instanceof O&&(t=t._asNative()),I.call(this,e,t)}),b.FormData=O}}();let cM=["CHINA","GLOBAL"],cx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],cU=[],cB=[];function cV(e,t){return!!t&&cU.some(r=>r.uid===e&&r.channelName===t)}function cF(){return cB.length>0}function cj(e,t){this.v=e,this.k=t}function cG(e,t,r,i,n){var o={};return Object.keys(i).forEach(function(e){o[e]=i[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},o),n&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(n):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function cW(e){var t={},r=!1;function i(t,i){return r=!0,{done:!1,value:new cj(i=new Promise(function(r){r(e[t](i))}),1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):i("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return i("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):i("return",e)}),t}function cH(e){var t,r,i,n=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,i=Symbol.iterator);n--;){if(r&&null!=(t=e[r]))return t.call(e);if(i&&null!=(t=e[i]))return new cY(t.call(e));r="@@asyncIterator",i="@@iterator"}throw TypeError("Object is not async iterable")}function cY(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(cY=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new cY(e)}function cK(e){return new cj(e,0)}function cQ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function cz(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cQ(Object(r),!0).forEach(function(t){!function(e,t,r){var i;(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cQ(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function cX(e){return function(){return new cJ(e.apply(this,arguments))}}function cJ(e){var t,r;function i(t,r){try{var o=e[t](r),a=o.value,s=a instanceof cj;Promise.resolve(s?a.v:a).then(function(r){if(s){var c="return"===t?"return":"next";if(!a.k||r.done)return i(c,r);r=e[c](r).value}n(o.done?"return":"normal",r)},function(e){i("throw",e)})}catch(e){n("throw",e)}}function n(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?i(t.key,t.arg):r=null}this._invoke=function(e,n){return new Promise(function(o,a){var s={key:e,arg:n,resolve:o,reject:a,next:null};r?r=r.next=s:(t=r=s,i(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}cJ.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},cJ.prototype.next=function(e){return this._invoke("next",e)},cJ.prototype.throw=function(e){return this._invoke("throw",e)},cJ.prototype.return=function(e){return this._invoke("return",e)};let cq=((Z={})[Z.ACCESS_POINT=101]="ACCESS_POINT",Z[Z.UNILBS=201]="UNILBS",Z[Z.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",Z),cZ=(($={})[$.IIIEGAL_APPID=1]="IIIEGAL_APPID",$[$.IIIEGAL_UID=2]="IIIEGAL_UID",$[$.INTERNAL_ERROR=3]="INTERNAL_ERROR",$),c$=((ee={})[ee.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",ee[ee.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",ee[ee.INTERNAL_ERROR=8]="INTERNAL_ERROR",ee[ee.NO_AUTHORIZED=9]="NO_AUTHORIZED",ee[ee.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",ee[ee.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",ee[ee.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",ee[ee.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",ee[ee.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",ee[ee.USER_OVERLOAD=16]="USER_OVERLOAD",ee[ee.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",ee[ee.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",ee),c0=((et={})[et.NO_FLAG_SET=100]="NO_FLAG_SET",et[et.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",et[et.INVALID_FALG_SET=102]="INVALID_FALG_SET",et[et.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",et[et.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",et[et.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",et[et.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",et[et.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",et[et.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",et[et.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",et[et.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",et[et.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",et[et.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",et[et.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",et[et.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",et[et.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",et[et.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",et[et.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",et[et.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",et),c2=((er={})[er.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",er[er.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",er[er.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",er[er.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",er[er.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",er[er.K_TICKET_INVALID=7]="K_TICKET_INVALID",er[er.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",er[er.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",er[er.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",er[er.K_UID_BANNED=14]="K_UID_BANNED",er[er.K_IP_BANNED=15]="K_IP_BANNED",er[er.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",er[er.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",er[er.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",er[er.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",er[er.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",er[er.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",er[er.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",er[er.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",er[er.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",er[er.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",er[er.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",er[er.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",er[er.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",er[er.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",er[er.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",er[er.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",er[er.ERR_INVALID_UID=117]="ERR_INVALID_UID",er[er.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",er[er.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",er[er.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",er[er.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",er[er.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",er[er.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",er[er.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",er[er.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",er[er.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",er[er.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",er[er.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",er[er.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",er[er.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",er[er.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",er[er.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",er[er.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",er[er.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",er[er.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",er[er.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",er[er.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",er[er.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",er[er.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",er[er.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",er[er.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",er[er.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",er[er.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",er[er.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",er[er.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",er[er.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",er[er.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",er[er.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",er[er.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",er[er.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",er[er.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",er[er.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",er[er.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",er[er.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",er),c1=((ei={}).CONNECTING="connecting",ei.CONNECTED="connected",ei.RECONNECTING="reconnecting",ei.CLOSED="closed",ei),c4=((en={}).WS_CONNECTED="ws_connected",en.WS_RECONNECTING="ws_reconnecting",en.WS_CLOSED="ws_closed",en.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",en.ON_BINARY_DATA="on_binary_data",en.REQUEST_RECOVER="request_recover",en.REQUEST_JOIN_INFO="request_join_info",en.REQUEST_REJOIN_INFO="req_rejoin_info",en.IS_P2P_DISCONNECTED="is_p2p_dis",en.DISCONNECT_P2P="dis_p2p",en.ABORT_P2P_EXECUTION="abort_p2p_execution",en.NEED_RENEW_SESSION="need-sid",en.REPORT_JOIN_GATEWAY="report_join_gateway",en.REQUEST_TIMEOUT="request_timeout",en.REQUEST_SUCCESS="request_success",en.JOIN_RESPONSE="join_response",en.PRE_CONNECT_PC="pre_connect_pc",en.P2P_CONNECTION="p2p_connection",en.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",en.P2P_SUBSCRIBE="p2p_subscribe",en.P2P_UNSUBSCRIBE="p2p_unsubscribe",en.P2P_EXCHANGE_SDP="p2p_exchange_sdp",en.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",en.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",en.RECOVER_NOTIFICATION="recover_notification",en),c6=((eo={}).PING="ping",eo.PING_BACK="ping_back",eo.JOIN="join_v3",eo.REJOIN="rejoin_v3",eo.LEAVE="leave",eo.SET_CLIENT_ROLE="set_client_role",eo.PUBLISH="publish",eo.PUBLISH_DATASTREAM="publish_datastream",eo.UNPUBLISH="unpublish",eo.UNPUBLISH_DATASTREAM="unpublish_datastream",eo.SUBSCRIBE="subscribe",eo.PRE_SUBSCRIBE="pre_subscribe",eo.SUBSCRIBE_DATASTREAM="subscribe_datastream",eo.SUBSCRIBE_STREAMS="subscribe_streams",eo.UNSUBSCRIBE="unsubscribe",eo.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",eo.UNSUBSCRIBE_STREAMS="unsubscribe_streams",eo.SUBSCRIBE_CHANGE="subscribe_change",eo.TRAFFIC_STATS="traffic_stats",eo.RENEW_TOKEN="renew_token",eo.SWITCH_VIDEO_STREAM="switch_video_stream",eo.DEFAULT_VIDEO_STREAM="default_video_stream",eo.SET_FALLBACK_OPTION="set_fallback_option",eo.GATEWAY_INFO="gateway_info",eo.CONTROL="control",eo.SEND_METADATA="send_metadata",eo.DATA_STREAM="data_stream",eo.PICK_SVC_LAYER="pick_svc_layer",eo.RESTART_ICE="restart_ice",eo.CONNECT_PC="connect_pc",eo.SET_VIDEO_PROFILE="set_video_profile",eo.SET_PARAMETER="set_parameter",eo.SET_RTM2_FLAG="set_rtm2_flag",eo),c3=((ea={}).WRTC_STATS="wrtc_stats",ea.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",ea.DENOISER_STATS="denoiser_stats",ea.EXTENSION_USAGE_STATS="extension_usage_stats",ea),c8=((es={}).ON_USER_ONLINE="on_user_online",es.ON_USER_OFFLINE="on_user_offline",es.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",es.ON_PUBLISH_STREAM="on_publish_stream",es.ON_UPLINK_STATS="on_uplink_stats",es.ON_P2P_LOST="on_p2p_lost",es.ON_REMOVE_STREAM="on_remove_stream",es.ON_ADD_AUDIO_STREAM="on_add_audio_stream",es.ON_ADD_VIDEO_STREAM="on_add_video_stream",es.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",es.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",es.ON_USER_BANNED="on_user_banned",es.ON_USER_LICENSE_BANNED="on_user_license_banned",es.ON_NOTIFICATION="on_notification",es.ON_CRYPT_ERROR="on_crypt_error",es.MUTE_AUDIO="mute_audio",es.MUTE_VIDEO="mute_video",es.UNMUTE_AUDIO="unmute_audio",es.UNMUTE_VIDEO="unmute_video",es.ON_P2P_OK="on_p2p_ok",es.RECEIVE_METADATA="receive_metadata",es.ON_DATA_STREAM="on_data_stream",es.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",es.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",es.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",es.ENABLE_LOCAL_VIDEO="enable_local_video",es.DISABLE_LOCAL_VIDEO="disable_local_video",es.ENABLE_LOCAL_AUDIO="enable_local_audio",es.DISABLE_LOCAL_AUDIO="disable_local_audio",es.ON_PUBLISHED_USER_LIST="on_published_user_list",es),c5=((ec={}).SEND_ONLY="SEND_ONLY",ec.RECEIVE_ONLY="RECEIVE_ONLY",ec),c9=((ed={}).CONNECTED="websocket:connected",ed.RECONNECTING="websocket:reconnecting",ed.WILL_RECONNECT="websocket:will_reconnect",ed.CLOSED="websocket:closed",ed.FAILED="websocket:failed",ed.ON_MESSAGE="websocket:on_message",ed.REQUEST_NEW_URLS="websocket:request_new_urls",ed.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",ed.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",ed);function c7(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw a6.error("Invalid Channel Name ".concat(e)),new sr(n8.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function de(e){if(!("number"==typeof e&&Math.floor(e)===e&&0<=e&&e<=0xffffffff||oo(e,1,255)))throw new sr(n8.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");"string"==typeof e&&a6.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let dt=((eu={}).TRANSCODE="mix_streaming",eu.RAW="raw_streaming",eu),dr=((el={}).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",el);function di(e){if(!e.channelName)throw new sr(n8.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new sr(n8.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&or(e.token,"info.token",1,2047),de(e.uid),c7(e.channelName),!0}(eh={}).NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",eh.NETWORK_CONNECTED="NETWORK_CONNECTED",eh.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",eh.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",eh.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",eh.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",eh.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",eh.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",eh.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",eh.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE";let dn=((ep={}).RELAY_STATE_IDLE="RELAY_STATE_IDLE",ep.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",ep.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",ep.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",ep),da=((ef={}).RELAY_OK="RELAY_OK",ef.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",ef.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",ef.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",(e_={}).High="high",e_.Low="low",e_.Audio="audio",e_.Screen="screen",e_.ScreenLow="screen_low",e_),ds=((eA={}).DISCONNECT="disconnect",eA.CONNECTION_STATE_CHANGE="connection-state-change",eA.NETWORK_QUALITY="network-quality",eA.STREAM_TYPE_CHANGE="stream-type-change",eA.IS_P2P_DISCONNECTED="is-p2p-dis",eA.DISCONNECT_P2P="dis-p2p",eA.REQUEST_NEW_GATEWAY_LIST="req-gate-url",eA.NEED_RENEW_SESSION="need-sid",eA.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",eA.JOIN_RESPONSE="join-response",eA.RESET_CONNECTION_EVENTS="reset-connection-events",eA.PRE_CONNECT_PC="pre-connect_pc",eA.UPDATE_GATEWAY_CONFIG="update-gateway-config",eA),dc=((em={}).P2P_DISCONNECTED="P2P_DISCONNECTED",em.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",em.TIMEOUT="TIMEOUT",em.UNKNOWN_REASON="UNKNOWN_REASON",em),dd=((ev={})[ev.Nothing=0]="Nothing",ev[ev.Audio=1]="Audio",ev[ev.LwoVideo=2]="LwoVideo",ev[ev.Video=4]="Video",ev[ev.Data=8]="Data",ev[ev.DataStream0=256]="DataStream0",ev[ev.DataStream1=512]="DataStream1",ev[ev.DataStream2=1024]="DataStream2",ev[ev.DataStream3=2048]="DataStream3",ev[ev.DataStream4=4096]="DataStream4",ev[ev.DataStream5=8192]="DataStream5",ev[ev.DataStream6=16384]="DataStream6",ev[ev.DataStream7=32768]="DataStream7",ev),du=((eE={}).CHINA="CHINA",eE.ASIA="ASIA",eE.NORTH_AMERICA="NORTH_AMERICA",eE.EUROPE="EUROPE",eE.JAPAN="JAPAN",eE.INDIA="INDIA",eE.KOREA="KOREA",eE.HKMC="HKMC",eE.US="US",eE.OCEANIA="OCEANIA",eE.SOUTH_AMERICA="SOUTH_AMERICA",eE.AFRICA="AFRICA",eE.OVERSEA="OVERSEA",eE.GLOBAL="GLOBAL",eE.EXTENSIONS="EXTENSIONS",eE),dl=[du.AFRICA,du.ASIA,du.CHINA,du.EUROPE,du.GLOBAL,du.INDIA,du.JAPAN,du.NORTH_AMERICA,du.OCEANIA,du.OVERSEA,du.SOUTH_AMERICA];let dh=((eg={}).CHINA="CN",eg.ASIA="AS",eg.NORTH_AMERICA="NA",eg.EUROPE="EU",eg.JAPAN="JP",eg.INDIA="IN",eg.KOREA="KR",eg.HKMC="HK",eg.US="US",eg.OCEANIA="OC",eg.SOUTH_AMERICA="SA",eg.AFRICA="AF",eg.OVERSEA="OVERSEA",eg.GLOBAL="GLOBAL",eg.EXTENSIONS="GLOBAL",eg),dp={CHINA:{},ASIA:{CODE:dh.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:dh.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:dh.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:dh.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:dh.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:dh.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:dh.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:dh.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:dh.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:dh.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:dh.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:dh.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:dh.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};aR&&(dp.CHINA={CODE:dh.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let df=((eS={}).UPDATE_BITRATE_LIMIT="update_bitrate_limit",eS.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",eS);function d_(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class dA extends op{constructor(e,t){super(),this.onICEConnectionStateChange=void 0,this.onConnectionStateChange=void 0,this.onDTLSTransportStateChange=void 0,this.onDTLSTransportError=void 0,this.onICETransportStateChange=void 0,this.onFirstAudioReceived=void 0,this.onFirstVideoReceived=void 0,this.onFirstAudioDecoded=void 0,this.onFirstVideoDecoded=void 0,this.onFirstVideoDecodedTimeout=void 0,this.onSelectedLocalCandidateChanged=void 0,this.onSelectedRemoteCandidateChanged=void 0,this.onICECandidateError=void 0,this.getLocalVideoStats=void 0}}class dm extends dA{constructor(e,t){super(e,t),this.establishPromise=void 0}}let dv=((eb={}).VIDEO="video",eb.AUDIO="audio",eb),dE=((eT={}).UDP_RELAY="udp_relay",eT.UDP_TCP_RELAY="udp_tcp_relay",eT.TCP_RELAY="tcp_relay",eT.RELAY="relay",eT),dg=((ey={})[ey.FIRST_CONNECTION=0]="FIRST_CONNECTION",ey[ey.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",ey[ey.RELAY_RESTART=2]="RELAY_RESTART",ey[ey.TCP_RESTART=3]="TCP_RESTART",ey[ey.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",ey[ey.OLD_RESTART=11]="OLD_RESTART",ey[ey.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",ey),dS=["disconnected","failed"];let db=((eR={}).LocalVideoTrack="videoTrack",eR.LocalAudioTrack="audioTrack",eR.LocalVideoLowTrack="videoLowTrack",eR),dT=((eI={}).New="new",eI.Connected="connected",eI.Reconnecting="reconnecting",eI.Disconnected="disconnected",eI),dy=((eC={}).AudioMetadata="audioMetadata",eC.StateChange="stateChange",eC.IceConnectionStateChange="iceConnectionStateChange",eC.RequestMuteLocal="requestMuteLocal",eC.RequestUnmuteLocal="requestUnmuteLocal",eC.RequestRePublish="requestRePublish",eC.RequestRePublishDataChannel="requestRePublishDataChannel",eC.RequestReSubscribe="requestReSubscribe",eC.RequestUploadStats="requestUploadStats",eC.RequestUpload="requestUpload",eC.MediaReconnectStart="MediaReconnectStart",eC.MediaReconnectEnd="MediaReconnectEnd",eC.NeedSignalRTT="NeedSignalRTT",eC.RequestRestartICE="RequestRestartIce",eC.PeerConnectionStateChange="PeerConnectionStateChange",eC.RequestReconnect="RequestReconnect",eC.RequestReconnectPC="RequestReconnectPC",eC.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",eC.P2PLost="P2PLost",eC.UpdateVideoEncoder="UpdateVideoEncoder",eC.ConnectionTypeChange="ConnectionTypeChange",eC.RequestLowStreamParameter="RequestLowStreamParameter",eC.QueryClientConnectionState="QueryClientConnectionState",eC.LocalCandidate="LocalCandidate",eC.RequestP2PMuteLocal="requestP2PMuteLocal",eC.RequestP2PUnPublish="RequestP2PUnPublish",eC.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",eC.RequestP2PMuteRemote="RequestP2PMuteRemote",eC.RequestP2PRestartICE="RequestP2PRestartICE",eC),dR=((ek={}).CONNECTING="CONNECTING",ek.RECONNECTING="RECONNECTING",ek.CONNECTED="CONNECTED",ek.CLOSED="CLOSED",ek),dI=((ew={}).CONNECTION_STATE_CHANGE="connection-state-change",ew.STATE_CHANGE="state-change",ew.INSPECT_RESULT="inspect-result",ew.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",ew.REQUEST_NEW_WORKER_URL="request-new-worker-url",ew),dC=((eO={}).CONNECTED="transmitter:connected",eO.RECONNECTING="transmitter:reconnecting",eO.WILL_RECONNECT="transmitter:will_reconnect",eO.CLOSED="transmitter:closed",eO.FAILED="transmitter:failed",eO.ON_MESSAGE="transmitter:on_message",eO.REQUEST_NEW_URLS="transmitter:request_new_urls",eO.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",eO.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",eO.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",eO.FAILBACK="transmitter:failback",eO.PRE_CONNECT_PC="transmitter:pre_connect_pc",eO),dk=((eN={}).CAMERA_CHANGED="camera-changed",eN.MICROPHONE_CHANGED="microphone-changed",eN.PLAYBACK_DEVICE_CHANGED="playback-device-changed",eN.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",eN.AUTOPLAY_FAILED="autoplay-failed",eN.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",eN.SECURITY_POLICY_VIOLATION="security-policy-violation",eN),dw=((eP={}).CONNECTING="CONNECTING",eP.RECONNECTING="RECONNECTING",eP.CONNECTED="CONNECTED",eP.CLOSED="CLOSED",eP),dO=((eD={}).CONNECTION_STATE_CHANGE="connection-state-change",eD.STATE_CHANGE="state-change",eD.INSPECT_RESULT="inspect-result",eD.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",eD.REQUEST_NEW_WORKER_URL="request-new-worker-url",eD),dN=((eL={}).CALL="call",eL.CANDIDATE="candidate",eL.PUBLISH="publish",eL.UNPUBLISH="unpublish",eL.CONTROL="control",eL.RESTART_ICE="restart_ice",eL.ACK="ack",eL.RESPONSE="response",eL.JOIN="join",eL.CHECK="check",eL),dP=((eM={}).MUTE_LOCAL_AUDIO="mute_local_audio",eM.MUTE_LOCAL_VIDEO="mute_local_video",eM.UNMUTE_LOCAL_AUDIO="unmute_local_audio",eM.UNMUTE_LOCAL_VIDEO="unmute_local_video",eM),dD={[cq.ACCESS_POINT]:{[c0.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[c0.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[c0.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[c0.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[c0.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[c0.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[c0.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[cq.UNILBS]:{[c$.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[c$.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[c$.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[c$.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[c$.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[c$.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[c$.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[c$.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[c$.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[c$.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[c$.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[c$.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[cq.STRING_UID_ALLOCATOR]:{[cZ.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[cZ.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[cZ.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function dL(e){let t=dD[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===cq.ACCESS_POINT){let t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}let dM={[c2.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[c2.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[c2.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[c2.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[c2.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[c2.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[c2.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[c2.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[c2.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[c2.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[c2.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[c2.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[c2.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[c2.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[c2.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[c2.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[c2.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[c2.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[c2.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[c2.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[c2.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[c2.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[c2.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[c2.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[c2.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[c2.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[c2.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[c2.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[c2.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[c2.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[c2.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[c2.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[c2.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[c2.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[c2.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[c2.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[c2.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[c2.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[c2.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[c2.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[c2.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[c2.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[c2.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[c2.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[c2.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[c2.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[c2.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[c2.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[c2.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[c2.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[c2.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[c2.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[c2.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[c2.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[c2.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[c2.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[c2.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[c2.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[c2.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[c2.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[c2.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[c2.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[c2.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[c2.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function dx(e){return dM[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function dU(e,t){if("string"==typeof e)return e;let{proxy:r,host:i,port:n}=e;if(t){let e=aP.JOIN_GATEWAY_FALLBACK_PORT||443;return 443===e?"wss://".concat(i,"/ws/?p=").concat(Number(n)+150):"wss://".concat(i,":").concat(e,"/ws/?p=").concat(Number(n)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(i,"&p=").concat(n):"wss://".concat(i,":").concat(n)}let dB=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,dV=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,dF=/wss:\/\/(.+):([0-9]+)\/?/,dj=/wss:\/\/(.[^\/]+)\/?/,dG=0;class dW{constructor(e,t){this.id=0,this.store=void 0,this.recordIndex=void 0,this.websockets=[],this.try443PortDuration=2e3,this.forceCloseWSDuration=5e3,this.try443PortTimeout=null,this.forceCloseTimeout=null,this.isTry443PortFailed=!1,this.isNormalPortFailed=!1,this.useDoubleDomain=!1,this.useProxy=!1,this.startTime=Date.now(),this.id=++dG,this.try443PortDuration=aP.JOIN_GATEWAY_TRY_443PORT_DURATION||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;let t=Date.now()-this.startTime;for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];a6.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...i)}createWebSocket(e,t,r){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:r});let i=aP.GATEWAY_DOMAINS,n=Date.now(),o=[],a=i.find(t=>e.host.includes(t));a||(this.useDoubleDomain=!1);let s=[];if(this.useDoubleDomain)i.forEach(r=>{s.push(dU(cz(cz({},e),{},{host:e.host.replace(a,r)}),t))});else{let r=cz({},e);if(t&&a){let e=i.find(e=>e!==a);e&&(r.host=r.host.replace(a,e))}s.push(dU(r,t))}try{s.forEach(e=>{let t=new WebSocket(e);t.binaryType="arraybuffer",o.push(t),this.logger("ws is connecting:",t.url)})}catch(i){if(this.logger("ws create failed"),o.forEach(e=>e.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,r);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,r);throw new sr(n8.WS_ERR,"init websocket failed! Error: ".concat(i.toString()))}let c=ny();this.store&&this.store.recordJoinChannelService({urls:o.map(e=>e.url),service:"gateway"},this.recordIndex),o.forEach(e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-n,"ms")),this.websockets.forEach(t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))}),this.websockets.length=0,c.resolve(e)},e.onclose=r=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-n,"ms state: ").concat(e.readyState));let i=o.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING);this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(i)),i&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(r.reason)),c.reject({code:r.code,reason:dc.A_ROUND_WS_FAILED})):!t&&i&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),u()),t?this.isTry443PortFailed=i:this.isNormalPortFailed=i},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))}),this.websockets.push(...o);let d=()=>{this.websockets.forEach(e=>e.readyState!==WebSocket.OPEN&&e.close())},u=()=>{if(c.isResolved)return d();nL().os===nw.MAC_OS&&nG()&&d(),this.createWebSocket(e,!0,!0).then(e=>{c.resolve(e)}).catch(e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,d()},this.forceCloseWSDuration)};return r||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,d()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,u()},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,r,i){var n;let o,a,s;return this.useDoubleDomain=!!t,"string"==typeof e&&(n=e,[,o,a,s]=n.match(dB)||[],o||([,a,s]=n.match(dV)||[]),a&&s||([,a,s]=n.match(dF)||[]),a&&s||([,a]=n.match(dj)||[]),a||a6.warning("un-destructible url: ",n),e={proxy:o,host:a,port:s||"443"}),this.recordIndex=i,this.useProxy=!!e.proxy,r&&this.useProxy&&(a6.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(e,!!r,!1).finally(()=>this.clearTimeout())}}class dH extends op{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){["tryNext","recover"].includes(e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(c9.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(c9.CONNECTED):"closed"===this._state?this.emit(c9.CLOSED):"failed"===this._state&&this.emit(c9.FAILED))}resetReconnectCount(e){a6.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),this.connectionID=0,this.currentURLIndex=0,this.urls=[],this._reconnectMode="tryNext",this.reconnectReason=void 0,this._initMutex=void 0,this.name=void 0,this._state="closed",this.reconnectInterrupter=void 0,this.websocket=void 0,this.retryConfig=void 0,this.reconnectCount=0,this.forceCloseTimeout=5e3,this.onlineReconnectListener=void 0,this.useCompress=void 0,this.tryDoubleDomain=!1,this.use443PortOnly=!1,this.wsInflateLength=0,this.wsDeflateLength=0,this.closeEstablishingWs=()=>{},this.store=void 0,this.joinGatewayRecordIndex=void 0,this.store=o,this.name=e,this.retryConfig=cz({},t),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=n,this._initMutex=new o0("websocket",o?o.clientId:void 0);let{timeout:a,timeoutFactor:s}=t,c=Math.max(300,Math.floor(3*a/5)),d=Math.max(1.2,Math.floor(8*s)/10);oT.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=d),ow.on(oy.NETWORK_STATE_CHANGE,(e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===oT.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=d):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=s))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{let e=ny(),t=this.urls[this.currentURLIndex];aP.ENABLE_PREALLOC_PC&&this.emit(dC.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(c9.CLOSED,()=>{e.reject(new n5(n8.WS_DISCONNECT))}),this.once(c9.CONNECTED,e.resolve),await e.promise}catch(e){}finally{r()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let e=this.websocket;t?setTimeout(()=>e.close(),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void a6.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),a6.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[Error(t)]},this.joinGatewayRecordIndex);let r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new n5(n8.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new n5(n8.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t,r;let i=ny();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let n=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),a6.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},o=async e=>{var t;if(a6.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new n5(n8.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");let t=oC(this,c9.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void a6.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return i.reject(new n5(n8.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);i.resolve()}};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),aP.GATEWAY_WSS_ADDRESS&&this.name.startsWith("gateway")&&(e=aP.GATEWAY_WSS_ADDRESS),a6.debug("[".concat(this.name,"] start connect, url:"),e);let a=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{let t=await this.chooseBestWebsocketConnection(e);this.websocket=t,n&&n(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=e=>{this.emit(c9.ON_MESSAGE,e)},this.websocket.onerror=e=>{a6.warn("[".concat(this.connectionID,"] ws open error ").concat(e))},null===(r=this.store)||void 0===r||r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this.joinGatewayRecordIndex=a}catch(c){let e="closed"===this.state,t=c instanceof n5,r=t&&c.code===n8.WS_ABORT,n=t&&c.code===n8.WS_ERR,s=t?c.message:c&&(c.reason||c.toString());a6.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(s)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:r?"aborted":"error",errors:[c]},a),e||n?(i.reject(e?new n5(n8.WS_DISCONNECT,"websocket is closed: ".concat(s)):new n5(n8.WS_ERR,"init websocket failed: ".concat(s))),n&&a6.error("[".concat(this.name,"] init websocket failed: ").concat(s))):o&&o(c)}return i.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||0===this.urls.length||"closed"===this.state)return!1;a6.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||ow.isOnline||!ow.onlineWaiter||(this.onlineReconnectListener=ow.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,t){let t=o4(this.reconnectCount,this.retryConfig);a6.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await Promise.race([oW(t),this.onlineReconnectListener||new Promise(()=>{})])}if("closed"===this._state||!r)return!1;this.reconnectCount+=1;let i=async(e,t)=>{this.emit(c9.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await i(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);a6.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],e)}else"recover"===e&&(a6.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await oR(this,c9.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(i){var n;a6.error("[".concat(this.name,"] reconnect failed ").concat(i&&i.toString()));let r=null==i||null===(n=i.data)||void 0===n?void 0:n.desc;return Array.isArray(r)&&r.includes("dynamic key expired")?(this.emit(c9.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class dY extends dH{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){var r;let i=ny(),n=(r=this.forceCloseTimeout,new dW(r,this.store));this.closeEstablishingWs=()=>{a6.debug("[choose-best-ws] close establishing websockets"),n.closeAllWebsockets(),i.reject(new n5(n8.WS_ABORT,"choose best websocket aborted"))};let o=aP.GATEWAY_DOMAINS;return a6.debug("[choose-best-ws] currentDomain: ",e,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),n.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class dK extends op{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===c1.CONNECTED?this.emit(c4.WS_CONNECTED):e===c1.RECONNECTING?this.emit(c4.WS_RECONNECTING,this._websocketReconnectReason):e===c1.CLOSED&&this.emit(c4.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),this._disconnectedReason=void 0,this._websocketReconnectReason=void 0,this._connectionState=c1.CLOSED,this.reconnectToken=void 0,this.websocket=void 0,this.openConnectionTime=void 0,this.clientId=void 0,this.lastMsgTime=Date.now(),this.uploadCache=[],this.uploadCacheInterval=void 0,this.rttRolling=new o8(5),this.pingpongTimer=void 0,this.wsInflateDataTimer=void 0,this.pingpongTimeoutCount=0,this.joinResponse=void 0,this.multiIpOption=void 0,this.initError=void 0,this.spec=void 0,this.store=void 0,this.onWebsocketMessage=e=>{if(e.data instanceof ArrayBuffer)return void this.emit(c4.ON_BINARY_DATA,e.data);let t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){let e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===c8.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===c8.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(ov.UID_BANNED);break;case 15:this.close(ov.IP_BANNED);break;case 16:this.close(ov.CHANNEL_BANNED)}if(t._type===c8.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case c2.ERR_LICENSE_MISSING:this.close(ov.LICENSE_MISSING);break;case c2.ERR_LICENSE_EXPIRED:this.close(ov.LICENSE_EXPIRED);break;case c2.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ov.LICENSE_MINUTES_EXCEEDED);break;case c2.ERR_LICENSE_PERIOD_INVALID:this.close(ov.LICENSE_PERIOD_INVALID);break;case c2.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ov.LICENSE_MULTIPLE_SDK_SERVICE);break;case c2.ERR_LICENSE_ILLEGAL:this.close(ov.LICENSE_ILLEGAL);break;default:this.close()}}},this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new dY("gateway-".concat(this.clientId),this.spec.retryConfig,!0,aP.JOIN_GATEWAY_USE_DUAL_DOMAIN,aP.JOIN_GATEWAY_USE_443PORT_ONLY,t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===c1.CONNECTED&&this.reconnect("retry",ob.OFFLINE)})}async request(e,t,r,i){let n=oH(6,""),o=this.websocket.connectionID,a=()=>new Promise((t,r)=>{if(this.connectionState===c1.CONNECTED)return t();let i=()=>{this.off(c4.WS_CLOSED,n),t()},n=()=>{this.off(c4.WS_CONNECTED,i),r(new sr(n8.WS_ABORT))};this.once(c4.WS_CONNECTED,i),this.once(c4.WS_CLOSED,n),e!==c6.PUBLISH&&e!==c6.PUBLISH_DATASTREAM&&e!==c6.SUBSCRIBE&&e!==c6.SUBSCRIBE_DATASTREAM&&e!==c6.UNSUBSCRIBE&&e!==c6.UNSUBSCRIBE_DATASTREAM&&e!==c6.UNPUBLISH&&e!==c6.UNPUBLISH_DATASTREAM&&e!==c6.CONTROL&&e!==c6.RESTART_ICE||this.once(c4.DISCONNECT_P2P,()=>{r(new sr(n8.DISCONNECT_P2P))}),e!==c6.PUBLISH&&e!==c6.RESTART_ICE||this.once(c4.ABORT_P2P_EXECUTION,()=>{r(new sr(n8.DISCONNECT_P2P))})});if(this.connectionState!==c1.CONNECTING&&this.connectionState!==c1.RECONNECTING||e===c6.JOIN||e===c6.REJOIN||await a(),this.websocket.sendMessage({_id:n,_type:e,_message:t},!0),i)return;let s=new Promise((r,i)=>{let a=!1,s=(i,n)=>{a=!0,r({isSuccess:"success"===i,message:n||{}}),this.off(c4.WS_CLOSED,c),this.off(c4.WS_RECONNECTING,c),this.emit(c4.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(n),s);let c=()=>{i(new sr(n8.WS_ABORT,"type: ".concat(e))),this.off(c4.WS_CLOSED,c),this.off(c4.WS_RECONNECTING,c),this.off("res-@".concat(n),s)};this.once(c4.WS_CLOSED,c),this.once(c4.WS_RECONNECTING,c),oW(aP.SIGNAL_REQUEST_TIMEOUT).then(()=>{this.websocket.connectionID!==o||a||(a6.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(c4.REQUEST_TIMEOUT,e,t))})}),c=null;try{c=await s}catch(i){if(this.connectionState===c1.CLOSED||e===c6.LEAVE)throw new sr(n8.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?i.throw():e===c6.JOIN||e===c6.REJOIN?null:(await a(),await this.request(e,t))}if(c.isSuccess)return c.message;let d=Number(c.message.error_code||c.message.code),u=dx(d),l=new sr(n8.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(c.message.error_str),{code:d,data:c.message,desc:u.desc});return"success"===u.action?c.message:(a6.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===c2.ERR_TOO_MANY_BROADCASTERS?((e===c6.JOIN||e===c6.REJOIN)&&(this.initError=l,this.close()),l.throw()):"failed"===u.action?l.throw():"quit"===u.action?(this.initError=l,this.close(),l.throw()):(d===c2.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=c.message.option,a6.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ob.MULTI_IP)):this.reconnect(u.action,ob.SERVER_ERROR),e===c6.JOIN||e===c6.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Promise(r=>{let i=n=>{(!t||t(n))&&(this.off(e,i),r(n))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void a6.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(c3.WRTC_STATS,t)}upload(e,t){let r={_type:e,_message:t};try{this.websocket.sendMessage(r)}catch(t){let e=aP.MAX_UPLOAD_CACHE||50;this.uploadCache.push(r),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==c1.CONNECTED)return;let e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},aP.UPLOAD_CACHE_INTERVAL||2e3))}}send(e,t){this.websocket.sendMessage({_type:e,_message:t})}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Promise((t,r)=>{this.once(c4.WS_CONNECTED,()=>t(this.joinResponse)),this.once(c4.WS_CLOSED,e=>r(this.initError||new sr(n8.WS_ABORT,e))),this.connectionState=c1.CONNECTING,this.websocket.init(e).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||ov.LEAVE,this.connectionState=c1.CLOSED,a6.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(c4.ABORT_P2P_EXECUTION);let e=await oR(this,c4.REQUEST_JOIN_INFO),t=await this.request(c6.JOIN,e);if(!t)return this.emit(c4.REPORT_JOIN_GATEWAY,dc.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(c4.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=c1.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new sr(n8.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=ok(this,c4.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(c6.REJOIN,e);return!!t&&(this.connectionState=c1.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(e=>{this.emit(c8.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(c8.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(c8.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(c8.MUTE_AUDIO,{uid:e.uid}):this.emit(c8.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(c8.MUTE_VIDEO,{uid:e.uid}):this.emit(c8.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(c8.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(c8.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(c8.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(c8.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(c8.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){a6.debug("[".concat(this.clientId,"] receive notification: "),e);let t=dx(e.code);if(28===e.code&&"detail"in e&&(a6.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(c4.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(ov.UID_BANNED),void this.close()):void this.reconnect(t.action,ob.SERVER_ERROR);a6.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=aP.PING_PONG_TIME_OUT,t=Date.now();this.pingpongTimeoutCount>=e&&(a6.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>aP.WEBSOCKET_TIMEOUT_MIN)?this.reconnect("retry",ob.TIMEOUT):this.request(c6.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let e=Date.now()-t;this.rttRolling.add(e),aP.REPORT_STATS&&this.send(c6.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(c3.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(c9.RECONNECT_CREATE_CONNECTION,e=>{this.emit(c4.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(c9.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(c9.CLOSED,()=>{this.connectionState=c1.CLOSED}),this.websocket.on(c9.FAILED,()=>{this._disconnectedReason=ov.NETWORK_ERROR,this.connectionState=c1.CLOSED}),this.websocket.on(c9.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===c1.CONNECTED?this.connectionState=c1.RECONNECTING:this.connectionState=c1.CONNECTING}),this.websocket.on(c9.WILL_RECONNECT,(e,t,r)=>{let i=ok(this,c4.IS_P2P_DISCONNECTED),n=i||"retry"!==e;i&&"retry"===e&&(a6.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=dc.P2P_DISCONNECTED),n&&(a6.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(c4.REPORT_JOIN_GATEWAY,t||dc.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(c4.DISCONNECT_P2P)),r(e)}),this.websocket.on(c9.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{a6.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",ob.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(c4.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof sr){if(e.code===n8.UNEXPECTED_RESPONSE&&e.data.code===c2.ERR_NO_AUTHORIZED)return this.initError=new sr(n8.TOKEN_EXPIRE,"dynamic key expired"),void this.close(ov.TOKEN_EXPIRE);a6.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ob.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(c9.REQUEST_NEW_URLS,(e,t)=>{oR(this,c4.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(c9.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(c8.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(dC.PRE_CONNECT_PC,()=>{this.emit(c4.PRE_CONNECT_PC)})}}let dQ=((ex={}).NATIVE_RTC="native_rtc",ex.NATIVE_RTM="native_rtm",ex.WEB_RTC="web_rtc",ex.WEB_RTM="web_rtm",ex),dz=((eU={})[eU.CHOOSE_SERVER=11]="CHOOSE_SERVER",eU[eU.CLOUD_PROXY=18]="CLOUD_PROXY",eU[eU.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",eU[eU.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",eU);function dX(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(aP.TURN_DOMAIN):(a6.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function dJ(e,t){let r;e.addresses||(e.addresses=[]);let i=function(e,t){if(aP.CONNECT_GATEWAY_WITHOUT_DOMAIN)return e.map(e=>{let{ip:t,port:r}=e;return{address:"".concat(t,":").concat(r)}});let r=aP.GATEWAY_DOMAINS,i=r[1]&&t.includes(r[1])?1:0;return e.map(e=>{let{domain_prefix:t,port:n,ip:o}=e;if(t)return{address:"".concat(t,".").concat(r[i++%r.length],":").concat(n)};let a=/^[\.\:\d]+$/.test(o),s=a?"".concat(o.replace(/[^\d]/g,"-"),".").concat(r[i++%r.length],":").concat(n):"".concat(o,":").concat(n);return a||a6.debug("Cannot recognized as ip address: ".concat(o,", use as host")),{ip:o,port:n,address:s}})}(e.addresses,t),n=Array.isArray(e.detail)&&e.detail[18];if(n&&"string"==typeof n){let e=n.split(";");for(let t=0;t<e.length;t++){let r=e[t].trim();i[t]&&r&&(i[t].ip6=r)}}let o=e.detail&&e.detail.candidate;if(o){let[e,t]=o.split(":");e&&t&&(r={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:i,apGatewayAddress:r,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function dq(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function dZ(e){let t=e._encoderConfig;if(!t)return{};let r={resolution:t.width&&t.height?"".concat(dq(t.width),"x").concat(dq(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function d$(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function d0(e,t){let r,i,n;switch(t){case dz.CHOOSE_SERVER:i=4096,n="choose server";break;case dz.CLOUD_PROXY:i=1048576,n="proxy";break;case dz.CLOUD_PROXY_5:i=4194304,n="proxy5";break;case dz.CLOUD_PROXY_FALLBACK:i=4194310,n="proxy fallback";break;default:throw new sr(n8.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(t=>{t.buffer&&t.buffer.flag===i&&(r={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map(e=>cz(cz({},e),{},{ticket:t.buffer.cert})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:cz(cz({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})}),!r)throw new sr(n8.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(n," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function d2(e,t){return await Promise.all(e.addresses.map(async e=>({address:aP.USE_TURN_IP?e.ip:dX(e.ip),tcpport:e.port,udpport:e.port,username:t&&aP.ENCRYPT_PROXY_USERNAME_AND_PSW&&window.isSecureContext?t.toString():aC.username,password:t&&aP.ENCRYPT_PROXY_USERNAME_AND_PSW&&window.isSecureContext?await oh(t.toString()):aC.password})))}function d1(e,t){let r=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||r.height,n=t.videoWidth||r.width;return i&&n?Math.max(Math.min(i,n)/Math.min(dq(e.height),dq(e.width)),1):(a6.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function d4(e){let{candidateType:t,relayProtocol:r,type:i,address:n,port:o,protocol:a}=e,s={candidateType:t,relayProtocol:r,protocol:a};if("local-candidate"!==i){let e=n.split(".");e.length>=4&&(e[1]="*",e[2]="*"),s.address=e.join("."),s.port=o}return s}function d6(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:aP.SVC_MODE;if(aP.ENABLE_SVC)return e in a_?e:a_.L1T3}let d3={[dv.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[dv.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function d8(e,t,r){t.forEach(t=>{let i=d3[e].find(e=>{let{key:r}=e;return t.extensionName.includes(r)});if(!i)return;let n=r.find(e=>{let{extensionName:t}=e;return t.includes(i.key)});n&&n.extensionName.includes("gdpr_forbidden")&&(t.extensionName=n.extensionName)})}function d5(e,t){t.forEach(t=>{let r=d3[e].find(e=>{let{key:r}=e;return t.extensionName.includes(r)});t.extensionName.includes("gdpr_forbidden")&&r&&(t.extensionName=r.extensionName)})}function d9(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||e.includes("abs-send-time")}function d7(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||e.includes("draft-holmer-rmcat-transport-wide-cc-extensions-01")}function ue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,{filterRTX:n,filterVideoFec:o,filterAudioFec:a,filterAudioCodec:s,filterVideoCodec:c}=t,{useXR:d}=r,u=[],l=[],h=[],p=[],f=!1,_=!1;if(aK(e).mediaDescriptions.forEach(e=>{i&&i!==e.attributes.direction||("video"!==e.media.mediaType||f||(l=e.attributes.payloads,p=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||_||(u=e.attributes.payloads,h=e.attributes.extmaps,_=!0))}),!p||0===l.length)throw Error("Cannot get video capabilities from SDP.");if(!h||0===u.length)throw Error("Cannot get audio capabilities from SDP.");if(l.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),d&&e.rtcpFeedbacks.push({type:"rrtr"})}),u.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),d&&e.rtcpFeedbacks.push({type:"rrtr"})}),n&&(u=u.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}),l=l.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),o&&(l=l.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),a&&(u=u.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),s&&(null==s?void 0:s.length)>0&&(u=u.filter(e=>{var t;return s.includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")})),c&&(null==c?void 0:c.length)>0){let e=l.filter(e=>{var t;return c.includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")});l=e.concat(n?[]:uh(e,l))}let A=aP.UNSUPPORTED_VIDEO_CODEC;return A&&A.length>0&&(l=l.filter(e=>!(e.rtpMap&&A.includes(e.rtpMap.encodingName.toLowerCase())))),{audioCodecs:u,videoCodecs:l,audioExtensions:h,videoExtensions:p}}function ut(e){let t,r;let i=aK(e);for(let e of i.mediaDescriptions){if(!t){let r=e.attributes.iceUfrag,i=e.attributes.icePwd;if(!r||!i)throw Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:r,icePwd:i}}if(!r){let t=e.attributes.fingerprints;t.length>0&&(r={fingerprints:t})}}if(!r&&i.attributes.fingerprints.length>0&&(r={fingerprints:i.attributes.fingerprints}),!r||!t)throw Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:r}}function ur(e,t,r){let i;let{cname:n}=e,o=[];t&&(o=ui(t)),0===o.length&&(o=e.iceParameters.candidates.map(e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})),a6.debug("Using candidates from gateway."));let a={fingerprints:e.dtlsParameters.fingerprints.map(e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint}))},s={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};switch(e.dtlsParameters.role){case"server":i="passive";break;case"client":i="active";break;case"auto":i="actpass"}let c=ud(e.rtpCapabilities),d=[];return Array.isArray(r)&&r.length>0&&r.forEach(e=>{d.push({kind:dv.VIDEO,ssrcId:e.v,rtx:e.v_rtx,mslabel:"".concat(e.v,"_").concat(e.a)},{kind:dv.AUDIO,ssrcId:e.a,mslabel:"".concat(e.v,"_").concat(e.a)})}),{dtlsParameters:a,iceParameters:s,candidates:o,rtpCapabilities:c,setup:i,cname:n,preSSRCs:d}}function ui(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],a6.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),a6.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function un(e,t,r){let i=[],n=[];return e.forEach(e=>{let{ssrcId:o,rtx:a}=e,s=oH(8,"track-"),c={ssrcId:o,attributes:cz({label:s,mslabel:r=r||oH(10,""),msid:"".concat(r," ").concat(s)},t&&{cname:t})};if(i.push(c),void 0!==a){let e={ssrcId:a,attributes:cz({label:s,mslabel:r,msid:"".concat(r," ").concat(s)},t&&{cname:t})};i.push(e),n.push({semantic:"FID",ssrcIds:[o,a]})}}),e.length>1&&n.push({semantic:"SIM",ssrcIds:e.map(e=>{let{ssrcId:t}=e;return t})}),{ssrcs:i,ssrcGroups:n}}function uo(e,t){t instanceof cE&&e.attributes.payloads.forEach(e=>{var r;let i=null===(r=e.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase();if(!i||-1===["opus","pcmu","pcma","g722"].indexOf(i))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";let n=t._encoderConfig;n&&"pcmu"!==i&&"pcma"!==i&&"g722"!==i&&(n.bitrate&&!nG()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*n.bitrate))),n.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(n.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(n.sampleRate)),n.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))})}function ua(e,t,r){let i,n;if(t){var o,a;if("video"===e.media.mediaType?(i=r.videoExtensions,n=r.videoCodecs):(i=r.audioExtensions,n=r.audioCodecs),!0===t.twcc){let t=i.find(e=>d7(e.extensionName));if(t){;let r=t.extensionName;e.attributes.extmaps.find(e=>d7(e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:r}),(o=n,e.attributes.payloads.filter(e=>!!o.find(t=>t.payloadType===e.payloadType&&!!t.rtcpFeedbacks.find(e=>"transport-cc"===e.type)))).forEach(e=>{e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)||e.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===t.twcc){let t=e.attributes.extmaps.findIndex(e=>d7(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{let t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}if(!0===t.remb){let t=i.find(e=>d9(e.extensionName));if(t){;let r=t.extensionName;e.attributes.extmaps.find(e=>e.extensionName===r)||e.attributes.extmaps.push({entry:t.entry,extensionName:r}),(a=n,e.attributes.payloads.filter(e=>!!a.find(t=>t.payloadType===e.payloadType&&!!t.rtcpFeedbacks.find(e=>"goog-remb"===e.type)))).forEach(e=>{e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)||e.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===t.remb){let t=e.attributes.extmaps.findIndex(e=>d9(e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{let t=e.rtcpFeedbacks.findIndex(e=>"goog-remb"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}}}async function us(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});let{send:i,recv:n,sendrecv:o}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=ue(r,e,t,"sendonly"),n=ue(r,e,t,"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(uc(i,n,"videoExtensions",o,a,s),uc(i,n,"videoCodecs",o,a,s),uc(i,n,"audioExtensions",o,a,s),uc(i,n,"audioCodecs",o,a,s),aP.RAISE_H264_BASELINE_PRIORITY){let e=[],t=[];s.videoCodecs.forEach((r,i)=>{var n,o,a;if("h264"===(null===(n=r.rtpMap)||void 0===n?void 0:n.encodingName.toLocaleLowerCase())){let n=s.videoCodecs[i+1],c=n&&uA(r,n),d=null===(o=r.fmtp)||void 0===o?void 0:o.parameters["profile-level-id"],u=null===(a=r.fmtp)||void 0===a?void 0:a.parameters["packetization-mode"];!d||d!==aP.FIRST_H264_PROFILE_LEVEL_ID||aP.FIRST_PACKETIZATION_MODE&&u!==aP.FIRST_PACKETIZATION_MODE?c?t.push([r,n]):t.push([r]):c?e.push([r,n]):e.push([r])}}),e.length>0&&t.length>0&&(a6.debug("raising H264 baseline profile priority"),s.videoCodecs.forEach((r,i)=>{var n;if("h264"===(null===(n=r.rtpMap)||void 0===n?void 0:n.encodingName.toLocaleLowerCase())){let n=uA(r,s.videoCodecs[i+1]),o=e.shift()||t.shift()||[];o.length>0&&(n?s.videoCodecs.splice(i,2,...o):s.videoCodecs.splice(i,1,...o))}}),a.videoCodecs=a.videoCodecs.filter(e=>{var t,r;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(r=e.fmtp)||void 0===r?void 0:r.parameters["profile-level-id"])!==aP.FIRST_H264_PROFILE_LEVEL_ID)}),aP.FILTER_SEND_H264_BASELINE&&(o.videoCodecs=o.videoCodecs.filter(e=>{var t,r;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(r=e.fmtp)||void 0===r?void 0:r.parameters["profile-level-id"])!==aP.FIRST_H264_PROFILE_LEVEL_ID)})))}return{send:o,recv:a,sendrecv:s}}(e,t,(await r.createOffer()).sdp);try{r.close()}catch(e){}return{send:i,recv:n,sendrecv:o}}function uc(e,t,r,i,n,o){if("videoExtensions"===r||"audioExtensions"===r){let a=[];return e[r].forEach(e=>{t[r].some((t,r)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(r),!0})?o[r].push(e):i[r].push(e)}),void t[r].forEach((e,t)=>{-1===a.indexOf(t)&&n[r].push(e)})}if("videoCodecs"===r||"audioCodecs"===r){let a=[];return e[r].forEach(e=>{t[r].some((t,r)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(r),!0})?o[r].push(e):i[r].push(e)}),void t[r].forEach((e,t)=>{-1===a.indexOf(t)&&n[r].push(e)})}}function ud(e){let t,r;let{send:i,recv:n,sendrecv:o}=e;if(!o){if(!i||!n)throw Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:n}}return i?((t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[...i.audioCodecs,...o.audioCodecs],t.videoCodecs=[...i.videoCodecs,...o.videoCodecs],t.audioExtensions=[...i.audioExtensions,...o.audioExtensions],t.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):t=o,n?((r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]}).audioCodecs=[...n.audioCodecs,...o.audioCodecs],r.videoCodecs=[...n.videoCodecs,...o.videoCodecs],r.audioExtensions=[...n.audioExtensions,...o.audioExtensions],r.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):r=o,{send:t,recv:r}}function uu(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter(e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function ul(e,t,r,i){let n=[];if(e===dv.VIDEO){if(aP.H264_PROFILE_LEVEL_ID&&"h264"===i&&(n=t.videoCodecs.filter(e=>(e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").includes(i)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===aP.H264_PROFILE_LEVEL_ID)),!Array.isArray(n)||0===n.length){let e=[],o=[],a=[],s=[];if(r.videoCodecs.forEach(t=>{let r=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";r.includes(i)?e.push(t):r.includes("vp9")?o.push(t):r.includes("vp8")?a.push(t):r.includes("h264")&&s.push(t)}),0===e.length){let t="";0!==o.length?(e=o,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==s.length&&(e=s,t="h264"),a6.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(n=t.videoCodecs.filter(t=>e.some(e=>e.payloadType===t.payloadType)))}if(0===n.length&&(a6.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),n=t.videoCodecs),aP.USE_PUB_RTX||aP.USE_SUB_RTX){let e=uh(n,t.videoCodecs);n=[...n,...e]}}else 0===(n=t.audioCodecs.filter(e=>(e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").includes(i))).length&&(a6.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),n=t.audioCodecs.filter(e=>(e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").includes("opus")));return n}function uh(e,t){let r=e.map(e=>e.payloadType.toString());return t.filter(e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&r.includes(e.fmtp&&e.fmtp.parameters.apt))}async function up(e,t,r){let i=t.toString(),n=function e(t,r,i,n){if(aP.SDP_LOGGING)return a6.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(n,"\n"),t),"offer"===r?t=>{e(t,"answer","local"===i?"remote":"local",n)}:void 0}(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});let o=await e.createAnswer();if(!o.sdp)throw Error("cannot get answer sdp");let a=o.sdp;a=uf(a,r||{}),null==n||n(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function uf(e,t,r){let i=aK(e),{useXR:n}=t;return i.mediaDescriptions.forEach(e=>{e.attributes.mid&&(Array.isArray(r)&&!r.includes(e.attributes.mid)||("audio"===e.media.mediaType&&uu(e),n&&["audio","video"].includes(e.media.mediaType)&&e.attributes.payloads.forEach(e=>{-1===e.rtcpFeedbacks.findIndex(e=>"rrtr"===e.type)&&e.rtcpFeedbacks.push({type:"rrtr"})})))}),aQ(i)}function u_(e){let t=aP.COMPATIBLE_SDP_EXTENSION;return!!(Array.isArray(t)&&t.length>0)&&t.some(t=>e.includes(t))}function uA(e,t){try{var r;return(null===(r=e.fmtp)||void 0===r?void 0:r.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function um(e,t){return typeof aP[e]===t?aP[e]:void 0}let uv={};function uE(e){let t=uv[e];if(!t)throw new n5(n8.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function ug(e,t){return uE("DataStream").create(e,t)}function uS(){return uE("InterceptFrame").create()}let ub=new Map;class uT extends op{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(ds.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(ds.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){a6.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var r,i,n;super(),this.store=void 0,this.joinInfo=void 0,this.key=void 0,this.ntpOffset=0,this.signal=void 0,this.role=void 0,this.inChannelInfo={joinAt:null,duration:0},this.spec=void 0,this._state="DISCONNECTED",this._statsCollector=void 0,this._disconnectedReason=void 0,this.isSignalRecover=!1,this.hasChangeBGPAddress=!1,this.trafficStatsInterval=void 0,this.networkQualityInterval=void 0,this._joinGatewayStartTime=0,this._signalTimeout=!1,this._clientRoleOptions=void 0,this._isProactiveJoin=!1,this.store=e,this.spec=t,this.signal=this.store.useP2P?(r={spec:cz(cz({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(i=(n=uE("P2PChannel")).createSubmodule)||void 0===i?void 0:i.call(n,r)):new dK(cz(cz({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,r){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);let i=Date.now(),n=ub.get(e.cname);if(n||(n=new Map,ub.set(e.cname,n)),this._isProactiveJoin=!0,n.has(e.uid)){let t=new sr(n8.UID_CONFLICT);throw st.joinGateway(e.sid,{lts:i,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}n.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=i;let a=e.proxyServer;try{a6.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));let t=e.gatewayAddrs.map(t=>{let{address:r}=t,[i,n]=r.split(":"),o={host:i,port:n};return e.proxyServer&&(o.proxy=e.proxyServer),o});o=(await this.signal.init(t)).uid,a6.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var s;throw a6.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),st.joinGateway(e.sid,{lts:i,succ:!1,ec:(null===(s=t.data)||void 0===s?void 0:s.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:e.preload}),n.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),a6.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{a6.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(ds.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ds.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(ds.NETWORK_QUALITY,{uplinkNetworkQuality:d$(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:d$(this._statsCollector.trafficStats.B_dnq)}):this.emit(ds.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==ov.FALLBACK&&(this.state="DISCONNECTING");try{var r,i;e||this.signal.connectionState!==c1.CONNECTED||await (r=this.signal.request(c6.LEAVE,void 0,!0),i=3e3,3e3==1/0?r:Promise.race([r,function(e){let t=new n5(n8.TIMEOUT,"timeout");return new Promise((r,i)=>{window.setTimeout(()=>i(t),e)})}(i)]))}catch(e){a6.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==ov.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,r){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:aP.PUB_EXTEND,twcc:!!aP.PUBLISH_TWCC,rtx:!!aP.USE_PUB_RTX};try{return(await this.signal.request(c6.PUBLISH,i,!0))._message}catch(i){if(r&&i.data&&i.data.code===c2.ERR_PUBLISH_REQUEST_INVALID)return a6.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),i.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw i}}async publishDataChannel(e,t,r){var i;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let n={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(i=t.maxRetransmits)&&void 0!==i?i:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(c6.PUBLISH_DATASTREAM,n,!0)}catch(i){if(r&&i.data&&i.data.code===c2.ERR_PUBLISH_REQUEST_INVALID)return a6.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),i.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw i}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(c6.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){a6.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Promise.all(e.map(e=>this.signal.request(c6.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){a6.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,r){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let i={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!aP.SUBSCRIBE_TWCC,rtx:!!aP.USE_SUB_RTX||void 0,extend:aP.SUB_EXTEND,svc:Array.isArray(aP.SVC)&&0!==aP.SVC.length?aP.SVC:void 0};try{return await this.signal.request(c6.PRE_SUBSCRIBE,i,!0)}catch(i){if(r&&i.data&&i.data.code===c2.ERR_SUBSCRIBE_REQUEST_INVALID)return a6.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),i.toString()),this.presubscribe(e,t,!1);throw i}}async subscribe(e,t,r){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let i={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!aP.SUBSCRIBE_TWCC,rtx:!!aP.USE_SUB_RTX,extend:aP.SUB_EXTEND,ssrcId:t.ssrcId,svc:Array.isArray(aP.SVC)&&0!==aP.SVC.length?aP.SVC:void 0};try{return(await this.signal.request(c6.SUBSCRIBE,i,!0))._message}catch(i){if(r&&i.data&&i.data.code===c2.ERR_SUBSCRIBE_REQUEST_INVALID)return a6.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),i.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw i}}async subscribeDataChannel(e,t,r){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let i={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(c6.SUBSCRIBE_DATASTREAM,i,!0)}catch(i){if(r&&i.data&&i.data.code===c2.ERR_SUBSCRIBE_REQUEST_INVALID)return a6.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),i.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw i}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!aP.USE_SUB_RTX,twcc:!!aP.SUBSCRIBE_TWCC,svc:Array.isArray(aP.SVC)&&0!==aP.SVC.length?aP.SVC:void 0};try{return await this.signal.request(c6.SUBSCRIBE_STREAMS,r,!0)}catch(r){if(t&&r.data&&r.data.code===c2.ERR_SUBSCRIBE_REQUEST_INVALID)return a6.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){let t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,r=e.width,i=e.height,n=!0;return"number"!=typeof t&&((t=t.exact||t.ideal||t.max||t.min||0)||(n=!1)),"number"!=typeof r&&((r=r.exact||r.ideal||r.max||r.min||0)||(n=!1)),"number"!=typeof i&&(i=i.exact||i.ideal||i.max||i.min||0,t||(n=!1)),n?{stream_type:0,width:r,height:i,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(c6.SET_VIDEO_PROFILE,t);a6.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(c6.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){a6.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new sr(n8.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Promise.all(e.map(e=>this.signal.request(c6.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0)))}catch(e){a6.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(c6.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){a6.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(c6.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(c6.GATEWAY_INFO)}async renewToken(e){await this.signal.request(c6.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),aP.CLIENT_ROLE_OPTIONS&&(a6.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(aP.CLIENT_ROLE_OPTIONS)," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},aP.CLIENT_ROLE_OPTIONS)),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),aP.CLIENT_ROLE_OPTIONS&&(this._clientRoleOptions=Object.assign({},aP.CLIENT_ROLE_OPTIONS),a6.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(aP.CLIENT_ROLE_OPTIONS)," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let r,i=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(c6.SET_CLIENT_ROLE,{role:e,level:i,delay:r,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(c6.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(c6.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(c6.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(c6.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(c6.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,r){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),cz({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(c6.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=ub.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){var e;let t;if(!this.joinInfo)return;let r=(t=(e=("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"").startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/))?{username:aC.username,password:aC.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null;this.joinInfo.turnServer.serversFromGateway=[],r&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(cz(cz({},aC),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;let e=await this.signal.request(c6.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(e=>{let t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(t=>t.peer_uid===e.peer_uid);t&&t.B_st!==e.B_st&&oP(()=>{this.emit(ds.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t;if(!this.joinInfo||!this.key)throw new sr(n8.UNEXPECTED_ERROR,"can not generate join message, no join info");let r=Object.assign({},this.joinInfo.apResponse),i=aP.REPORT_APP_SCENARIO;if("string"!=typeof i)try{i=JSON.stringify(i)}catch(e){i=void 0}i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ds.UPDATE_GATEWAY_CONFIG),t=this.store.clientId,cB.includes(t)||cB.push(t);let n=!(nG()||function(e){let t=nL();return!(t.name!==nO.CHROME||!t.osVersion)&&87>Number(t.version)}(87)||sa())&&"boolean"==typeof aP.ENABLE_PRE_SUB&&aP.ENABLE_PRE_SUB,o=!sa()&&um("ENABLE_PREALLOC_PC","boolean"),a=function(){try{let e=aP.EXPERIMENTS||{};return"string"==typeof e||Array.isArray(e)?{}:cz({},e)}catch(e){return a6.debug("handle gateway attributes failed: ",e),{}}}(),s=nH(87)||function(){let e=nL();if(e.name!==nO.SAFARI||!e.browserVersion)return!1;let t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}(),c=cz({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ay,browser:navigator.userAgent,process_id:aP.PROCESS_ID,mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:aP.JOIN_EXTEND,details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:cz({enableEncodedTransform:!!aP.ENABLE_AUDIO_METADATA&&s||!!aP.ENABLE_AUDIO_TOPN&&nY(nO.CHROME,87,116)||void 0,enableAudioMetadata:!!aP.ENABLE_AUDIO_METADATA&&s,enableAudioPts:!!aP.ENABLE_AUDIO_PTS_METADATA&&s,topnSmoothLevel:aP.TOPN_SMOOTH_LEVEL,topnNewSpeakerDelay:aP.TOPN_NEW_SPEAKER_DELAY,topnSwitchHoldMs:aP.TOPN_SWITCH_HOLD_MS,topnAudioGain:aP.TOPN_AUDIO_GAIN,enablePublishedUserList:aP.ENABLE_PUBLISHED_USER_LIST,maxSubscription:aP.MAX_SUBSCRIPTION,subscribeAudioFilterTopN:um("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:um("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:um("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===aP.USE_PUB_RTX||!0===aP.USE_SUB_RTX||void 0,disableFEC:aP.DISABLE_FEC,enableNTPReport:!!aP.ENABLE_NTP_REPORT||void 0,enableInstantVideo:!!aP.ENABLE_INSTANT_VIDEO||void 0,enableFulllinkAvSync:!!aP.ENABLE_FULL_LINK_AV_SYNC||void 0,enableDataStream2:um("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!aP.ENABLE_AUT_FEEDBACK||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!aP.ENABLE_USER_AUTO_REBALANCE_CHECK,enableXR:um("USE_XR","boolean"),enableLossbasedBwe:um("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!aP.ENABLE_AUT_CC||void 0,enableCCFallback:um("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:n?um("PRE_SUB_NUM","number"):void 0,enablePubTWCC:um("PUBLISH_TWCC","boolean"),enableSubTWCC:um("SUBSCRIBE_TWCC","boolean"),enablePubRTX:um("USE_PUB_RTX","boolean"),enableSubRTX:um("USE_SUB_RTX","boolean"),enableSubSVC:aP.ENABLE_SVC?aP.ENABLE_SVC_DEFAULT_CODECS:Array.isArray(aP.SVC)&&0!==aP.SVC.length?aP.SVC:void 0,enableSvcExtended:aP.ENABLE_SVC&&Array.isArray(aP.SVC_EXTENDED)&&0!==aP.SVC_EXTENDED.length?aP.SVC_EXTENDED:void 0},a)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(c.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(c.aes_mode=this.joinInfo.aesmode,aP.ENCRYPT_AES?(c.aes_secret=this.joinInfo.aespassword,c.aes_encrypt=!0):c.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(c.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(c.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(c.default_video_stream=this.joinInfo.defaultVideoStream),c}getRejoinMessage(){if(!this.joinInfo)throw new sr(n8.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(c4.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(c4.WS_RECONNECTING,e=>{this.joinInfo&&st.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||ob.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",st.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:3}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(c4.WS_CLOSED,e=>{let t;switch(e){case ov.LEAVE:t=ob.LEAVE;break;case ov.UID_BANNED:case ov.IP_BANNED:case ov.CHANNEL_BANNED:case ov.SERVER_ERROR:t=ob.SERVER_ERROR;break;case ov.FALLBACK:t=ob.FALLBACK;break;case ov.LICENSE_MISSING:case ov.LICENSE_EXPIRED:case ov.LICENSE_MINUTES_EXCEEDED:case ov.LICENSE_PERIOD_INVALID:case ov.LICENSE_MULTIPLE_SDK_SERVICE:case ov.LICENSE_ILLEGAL:case ov.TOKEN_EXPIRE:t=e;break;default:t=ob.NETWORK_ERROR}a6.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+ob.NETWORK_ERROR)),this.joinInfo&&st.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===ov.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==ov.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(c4.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){let e=aP.CLIENT_ROLE_OPTIONS||this._clientRoleOptions;e&&(e.level||e.delay)&&(a6.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(st.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void a6.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));aD("EVENT_REPORT_DOMAIN",e[1]),aD("EVENT_REPORT_BACKUP_DOMAIN",e[1]),aD("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(c8.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(c4.REQUEST_RECOVER,(e,t,r)=>{if(!this.joinInfo)return r(new sr(n8.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,oR(this,ds.REQUEST_NEW_GATEWAY_LIST).then(t).catch(r)}),this.signal.on(c4.REQUEST_JOIN_INFO,async(e,t,r)=>{var i;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let n=oD(null===(i=this.joinInfo)||void 0===i?void 0:i.turnServer);if(aP.NEW_TURN_MODE&&n){let e=n.servers,t=n.serversFromGateway,r=this.signal.currentURLIndex;e.length>0&&(e=[e[r%e.length]],n.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],n.serversFromGateway=t),a6.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(r))}let{iceParameters:o,dtlsParameters:a,rtpCapabilities:s}=await oR(this,ds.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:n});try{e(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:a,rtpCapabilities:s,version:"2"}}))}catch(e){t(e)}}),this.signal.on(c4.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(c4.REPORT_JOIN_GATEWAY,(e,t)=>{var r;if(!this.joinInfo)return;let i,n="";e instanceof sr?(i=(null===(r=e.data)||void 0===r?void 0:r.desc)||e.code,n=e.message):i=e,st.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:n,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(c4.IS_P2P_DISCONNECTED,e=>{e(ok(this,ds.IS_P2P_DISCONNECTED))}),this.signal.on(c4.DISCONNECT_P2P,()=>{this.emit(ds.DISCONNECT_P2P)}),this.signal.on(c4.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(c4.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(c4.JOIN_RESPONSE,e=>{let t=this.getCurrentGatewayAddress();this.emit(ds.JOIN_RESPONSE,e,t)}),this.signal.on(c4.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let e=this.getCurrentGatewayAddress(),t=aP.FINGERPRINT||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){let r=ui(e);this.emit(ds.PRE_CONNECT_PC,{candidates:r,fingerprint:t})}}}),this.signal.on(c4.RECOVER_NOTIFICATION,e=>{this.joinInfo&&"string"==typeof aP.AP_REQUEST_DETAIL&&(this.joinInfo.apRequestDetail="".concat(aP.AP_REQUEST_DETAIL,";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(c6.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw a6.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(c6.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw a6.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(c6.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw a6.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(c6.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw a6.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){let t={users:e.map(e=>({stream_id:e.stream_id,stream_type:e.stream_type}))};try{await this.signal.request(c6.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw a6.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){let r={action:e.find(e=>e.stream_type===da.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(c6.CONTROL,r,!0,!0)}catch(e){throw a6.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){let r={action:e.find(e=>e.stream_type===da.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(c6.CONTROL,r,!0,!0)}catch(e){throw a6.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){let r={action:e===dv.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(c6.CONTROL,r,!0,!0)}catch(e){throw a6.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){let r={action:e===dv.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(c6.CONTROL,r,!0,!0)}catch(e){throw a6.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(c6.RESTART_ICE,t,!0)}catch(e){throw a6.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||ob.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!aP.GATEWAY_WSS_ADDRESS)return aP.USE_CANDIDATE_FROM_AP_DETAIL&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(a6.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(c6.SET_PARAMETER,{enablePublishAudioFilter:e})}}let uy=0,uR=0;function uI(e,t,r,i){return new Promise((n,o)=>{t.timeout=t.timeout||aP.HTTP_CONNECT_TIMEOUT,t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),uy+=oj(t.data)):r&&(t.data.size?uy+=t.data.size:t.data instanceof FormData?uy+=oG(t.data):uy+=oj(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,nb.Z.request(t).then(e=>{"string"==typeof e.data?uR+=oj(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?uR+=e.data.byteLength:uR+=oj(JSON.stringify(e.data)),i&&n({data:e.data,headers:e.headers}),n(e.data)}).catch(e=>{nb.Z.isCancel(e)?o(new sr(n8.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new sr(n8.NETWORK_TIMEOUT,e.message)):e.response?o(new sr(n8.NETWORK_RESPONSE_ERROR,e.response.status)):o(new sr(n8.NETWORK_ERROR,e.message))})})}let uC=()=>{let e=aP.AREAS;return 0===e.length&&e.push(du.GLOBAL),e.reduce((e,t,r)=>{let i=uk(t);return i?0===r?i:"".concat(e,",").concat(i):e},"")},uk=e=>e===du.OVERSEA?"".concat(dh.ASIA,",").concat(dh.EUROPE,",").concat(dh.AFRICA,",").concat(dh.NORTH_AMERICA,",").concat(dh.SOUTH_AMERICA,",").concat(dh.OCEANIA):dh[e],uw=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(e=>{let r=dp[e],i=Object.keys(r);i&&i.map(e=>{"CODE"!==e&&(t[e]=t[e].concat(r[e]))})}),t},uO={GLOBAL:{ASIA:[du.CHINA,du.JAPAN,du.INDIA,du.KOREA,du.HKMC],EUROPE:[],NORTH_AMERICA:[du.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},uN=Object.keys(uO[du.GLOBAL]),uP=[du.CHINA,du.NORTH_AMERICA,du.EUROPE,du.ASIA,du.JAPAN,du.INDIA,du.OCEANIA,du.SOUTH_AMERICA,du.AFRICA,du.KOREA,du.HKMC,du.US],uD=function(e,t){let r=[];if(e.includes(du.GLOBAL)){let o=[du.GLOBAL,du.OVERSEA],a=Object.keys(dp);if(t===du.GLOBAL)throw new sr(n8.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===du.CHINA)r=[du.OVERSEA];else if(uN.includes(t)){let e=uO[du.GLOBAL][t]||[],i=[...o,t,...e];r=a.filter(e=>!i.includes(e))}else{var i,n;let s;if(i=t,s=!1,uN.forEach(e=>{uO[du.GLOBAL][e].includes(i)&&(s=!0)}),s){;let e;let i=[...o,(n=t,uN.forEach(t=>{uO[du.GLOBAL][t].includes(n)&&(e=t)}),e),t];r=a.filter(e=>!i.includes(e))}else r=e}r=function(e){let t=[];return uP.forEach(r=>{e.includes(r)&&t.push(r)}),t.concat(e.filter(e=>!uP.includes(e)))}(r)}else r=e;return r};function uL(e){if(!e&&aP.AREAS.includes(du.EXTENSIONS))return a6.debug("update area from ap : reset"),void uM(cM,!0);if(!aP.AREAS.includes(du.GLOBAL)||!e)return;let t=dp.EXTENSIONS;t&&(t={CODE:uk(du.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},a6.debug("update area from ap success: ".concat(e,",config is "),t),aD("AREAS",[du.EXTENSIONS],!0),Object.keys(t).map(e=>{if("LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e){let r=t[e];aD(e,r[0])}else aD(e,t[e])}))}function uM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=st.reportApiInvoke(null,{name:oA.SET_AREA,options:e,tag:om.TRACER});try{let i=[];if("string"==typeof e&&(i=[e]),Array.isArray(e)&&(e.forEach(e=>{if(!dl.includes(e))throw new sr(n8.INVALID_PARAMS,"invalid area code")}),i=e),"[object Object]"===Object.prototype.toString.call(e)){let{areaCode:t,excludedArea:r}=e;if(!t)throw new sr(n8.INVALID_PARAMS,"area code is needed");let n=t;"string"==typeof t&&(n=[t]),i=r?uD(n,r):n}if(!t){if(ax.AREAS){let e=new sr(n8.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(e),void a6.warning("setArea is prohibited because of config-distribute")}if(i.includes(du.GLOBAL)&&aP.AREAS===du.EXTENSIONS){let e=new sr(n8.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(e),void a6.warning("setArea is prohibited because of ap extensions")}}aD("AREAS",i,t);let n=uw(i);Object.keys(n).map(e=>{if("LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e){let t=n[e];aD(e,t[0])}else aD(e,n[e])}),a6.debug("set area success:",i.join(","))}catch(e){throw r.onError(e),e}r.onSuccess()}let ux=1;function uU(e,t,r,i){let n,{url:o,areaCode:a}=e,{clientId:s,sid:c}=t,d=Date.now(),u=t.role,[l,h]=uG(t,a,[dz.CHOOSE_SERVER]),p=ow.networkState;return o6(async()=>{p&&ow.networkState===oT.OFFLINE&&ow.onlineWaiter&&await Promise.race([ow.onlineWaiter,oW(i&&i.maxRetryTimeout||o1.maxRetryTimeout)]),p=ow.networkState;let{data:e,headers:a}=await uI(o,{data:l,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);n="1"===a.http3?1:-1,st.reportResourceTiming(o,c),uV(e,o,t,d,[dz.CHOOSE_SERVER],n);let s=d0(e,dz.CHOOSE_SERVER);return uF(s),dJ(s,o)},e=>(e&&st.joinChooseServer(c,{role:u,lts:d,succ:!0,csAddr:o,opid:h,serverList:e.gatewayAddrs.map(e=>e.address),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[dz.CHOOSE_SERVER].toString(),isHttp3:n,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1),e=>e.code!==n8.OPERATION_ABORTED&&(e.code===n8.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(st.joinChooseServer(c,{role:u,lts:d,succ:!1,csAddr:o,serverList:null,opid:h,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[dz.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:n,corssRegionTagReq:t.apRequestDetail}),a6.warning("[".concat(s||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),e),!0)),i)}function uB(e,t,r,i){let n,o,{url:a,areaCode:s,serviceIds:c}=e,d=Date.now(),u=t.role,[l,h]=uG(t,s,c);return o6(async()=>{n&&ow.networkState===oT.OFFLINE&&ow.onlineWaiter&&await Promise.race([ow.onlineWaiter,oW(i&&i.maxRetryTimeout||o1.maxRetryTimeout)]),n=ow.networkState;let{data:e,headers:s}=await uI(a,{data:l,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o="1"===s.http3?1:-1,st.reportResourceTiming(a,t.sid),uV(e,a,t,d,c,o);let u=d0(e,dz.CHOOSE_SERVER),h=d0(e,"proxy5"===t.cloudProxyServer?dz.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?dz.CLOUD_PROXY:dz.CLOUD_PROXY_FALLBACK);return uF(u),{gatewayInfo:dJ(u,a),proxyInfo:h,url:a}},e=>(e.gatewayInfo&&st.joinChooseServer(t.sid,{role:u,lts:d,succ:!0,csAddr:a,serverList:e.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,opid:h,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38]}),e.proxyInfo&&st.joinWebProxyAP(t.sid,{lts:d,sucess:1,apServerAddr:a,turnServerAddrList:e.proxyInfo.addresses.map(e=>e.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1),e=>e.code!==n8.OPERATION_ABORTED&&(e.code===n8.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(st.joinWebProxyAP(t.sid,{lts:d,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:n})}),a6.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0)),i)}let uV=(e,t,r,i,n,o)=>{let{sid:a,clientId:s,cloudProxyServer:c}=r,d=[],u=s=>{4096===s.flag?st.joinChooseServer(a,{role:r.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:s.error.message,csIp:s.error.data&&s.error.data.csIp,unilbsServerIds:n.toString(),isHttp3:o,corssRegionTagReq:r.apRequestDetail}):1048576!==s.flag&&4194304!==s.flag&&4194310!==s.flag||st.joinWebProxyAP(a,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:s.error.code,eventType:c,unilbsServerIds:n.toString()})};if(e.response_body.forEach(t=>{let r=t.buffer.code;if(23===t.uri&&0===r&&!t.buffer.edges_services){if(4194310===t.buffer.flag)a6.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{let r={error:new sr(n8.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};d.push(r),u(r)}}if(0!==r){let i=dL(r),n={error:new sr(n8.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?a6.warning(n.error.toString()):d.push(n),u(n)}}),d.length)throw a6.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(d.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)).join(" | "))),new sr(n8.CAN_NOT_GET_GATEWAY_SERVER,d.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!d.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(d.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})},uF=e=>{var t,r,i,n;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new sr(n8.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(aP.AP_AREA&&(null!==(i=e.detail)&&void 0!==i&&i[23]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[23])?uL(e.detail[23].toLowerCase()):uL()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[19])){let t=e.detail[19],r=null==t?void 0:t.split(";");for(let t=0;t<r.length;t++){let i=r[t].trim();e.addresses[t]&&r&&(e.addresses[t].fingerprint=i)}}if(aP.GATEWAY_ADDRESS&&aP.GATEWAY_ADDRESS.length>0){a6.debug("assign gateway address to",aP.GATEWAY_ADDRESS);let t=aP.GATEWAY_ADDRESS.map(t=>{var r,i;let n=null!==(r=null===(i=e.addresses.find(e=>e.ip===t.ip&&e.port===t.port))||void 0===i?void 0:i.fingerprint)&&void 0!==r?r:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:n}});e.addresses=t}},uj=(e,t)=>{if(e.response_body&&e.response_body.length){let t=e.response_body[0];if(0!==t.buffer.code){let e=dL(t.buffer.code);throw new sr(n8.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw a6.debug("update ticket request received ap response without response body:",t),new sr(n8.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},uG=(e,t,r)=>{let i=Math.floor(1e12*Math.random()),n="host"===e.role?"1":"audience"===e.role?"2":void 0,o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:cz(cz(cz({6:e.stringUid,11:t,12:aP.USE_NEW_TOKEN?"1":void 0},n?{17:n}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};o.request_bodies.forEach(t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let a=new FormData;return a.append("request",JSON.stringify(o)),[a,i]},uW=(e,t)=>{let r=Math.floor(1e12*Math.random()),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(e=>({ip:e.ip,port:e.port}))}}]},n=new FormData;return n.append("request",JSON.stringify(i)),[n,r]};function uH(e){return Promise.all(e.map(e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}let uY=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:i,allFailedhandler:n,promisesCollector:o}=e,a=0,s,c=0,d=async()=>{let e=(()=>{let e=a*t;return r.slice(e,e+t).map(i)})();o&&o.push(...e);try{s=await uH(e)}catch(e){if(c+=t,a++,!(c>=r.length))return void await d();n(e)}e.forEach(e=>e.cancel())};return await d(),s},uK=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:i}=e,n=t.length,o=0,a=async()=>{let e=r(t.shift());try{return await e}catch(e){if(++o>=n||null!=i&&i(e))throw e;return a()}};return a()};async function uQ(e,t,r,i){let n=async function(e,t,r,i){let n=null,o=[],a=async()=>{let n=aP.WEBCS_DOMAIN.slice(0,aP.AJAX_REQUEST_CONCURRENT).map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:uC()})),a=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:n.map(e=>e.url)}),s=await uY({fragementLength:aP.FRAGEMENT_LENGTH,referenceList:n,asyncMapHandler:i=>(a6.debug("[".concat(e.clientId,"] Connect to choose_server:"),i.url),uU(i,e,t,r)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},a),s},s=async()=>{if(await oW(1e3),null!==n)return n;let a=aP.WEBCS_DOMAIN_BACKUP_LIST.map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:uC()})),s=i.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map(e=>e.url)}),c=await uY({fragementLength:aP.FRAGEMENT_LENGTH,referenceList:a,asyncMapHandler:i=>(a6.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),i.url),uU(i,e,t,r)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c};try{return n=await uH([a(),s()]),o.length&&o.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),n}catch(e){throw e[0]}}(e,t,r,i);return{gatewayInfo:await n}}async function uz(e,t,r,i,n){var o,a;let s=e.cloudProxyServer;if("disabled"===s){if(!i)return;if(e.useLocalAccessPoint)return await uQ(e,t,r,n);if(aP.JOIN_WITH_FALLBACK_MEDIA_PROXY){let{gatewayInfo:i,proxyInfo:a}=await u$(e,t,r,n);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:i};let s=a.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||aC.tcpport,udpport:e.udpport||aC.udpport,username:e.username||aC.username,password:e.password||aC.password,forceturn:!1,security:!0}));if(n.useP2P){let t=null!==(o=e.uid)&&void 0!==o?o:i.uid,r="glb:".concat(t.toString()),n=await oh(r),c=a.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||aC.tcpport,udpport:e.udpport||aC.udpport,username:r,password:n,forceturn:!1,security:!0}));s.push(...c)}return e.turnServer={mode:"manual",servers:s},{gatewayInfo:i}}return await uQ(e,t,r,n)}let{proxyInfo:c,gatewayInfo:d}=await u$(e,t,r,n),u=c.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===s?void 0:e.tcpport?e.tcpport:aC.tcpport,udpport:"proxy4"===s?void 0:e.udpport?e.udpport:aC.udpport,username:e.username||aC.username,password:e.password||aC.password,forceturn:"proxy4"!==s,security:"proxy5"===s}));if(n.useP2P){let t=null!==(a=e.uid)&&void 0!==a?a:d.uid,r="glb:".concat(t.toString()),i=await oh(r),n=c.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===s?void 0:e.tcpport||aC.tcpport,udpport:"proxy4"===s?void 0:e.udpport||aC.udpport,username:r,password:i,forceturn:"proxy4"!==s,security:"proxy5"===s}));u.push(...n)}return e.turnServer={mode:"manual",servers:u},a6.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(s)),{gatewayInfo:d}}async function uX(e,t,r,i,n){let o=aP.ACCOUNT_REGISTER.slice(0,aP.AJAX_REQUEST_CONCURRENT),a=[];a=t.proxyServer?o.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):o.map(e=>"https://".concat(e,"/api/v1"));let s=null==n?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:a});try{let o=await async function(e,t,r,i,n){let o=Date.now(),a={sid:r.sid,opid:10,appid:r.appId,string_uid:t},s=e[0],c=await o6(()=>uI(s+"".concat(-1===s.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(r,i)=>{if(0===r.code){if(r.uid<=0||r.uid>=0x100000000)throw a6.error("Invalid Uint Uid ".concat(t," => ").concat(r.uid),r),st.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:r.uid,errorCode:n8.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new sr(n8.INVALID_UINT_UID_FROM_STRING_UID);return st.reqUserAccount(a.sid,{lts:o,success:!0,serverAddr:s,stringUid:a.string_uid,uid:r.uid,errorCode:null,extend:a}),!1}let n=dL(r.code);return n.retry&&(s=e[(i+1)%e.length]),st.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:r.uid,errorCode:n.desc,extend:a}),n.retry},(t,r)=>t.code!==n8.OPERATION_ABORTED&&(st.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),s=e[(r+1)%e.length],!0),n);if(0!==c.code){let e=dL(c.code);throw new sr(n8.UNEXPECTED_RESPONSE,e.desc)}return c}(a,e,t,r,i);return null==n||n.recordJoinChannelService({status:"success",endTs:Date.now()},s),o.uid}catch(e){throw null==n||n.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},s),e}}async function uJ(e,t,r){let i=aP.ACCOUNT_REGISTER,n=[];n=t.proxyServer?i.map(e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1")):i.map(e=>"https://".concat(e,"/api/v1"));try{return await uK({referenceList:n,asyncMapHandler:i=>(async function(e,t,r,i){let n=Date.now(),o={sid:r.sid,opid:10,appid:r.appId,string_uid:t};try{let t=await uI(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){let e=dL(t.code);throw new sr(n8.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=0x100000000)throw new sr(n8.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:n,url:e,req:o,uid:t.uid,elapse:Date.now()-n}}catch(e){throw e}})(i,e,t,r),closeFn:e=>e.code===n8.OPERATION_ABORTED||e.code===n8.UNEXPECTED_RESPONSE&&!e.data.retry})}catch(e){throw e}}async function uq(e,t,r){let i=aP.CDS_AP.slice(0,aP.AJAX_REQUEST_CONCURRENT).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")).map(i=>(function(e,t,r,i){let n=nL(),o={flag:64,cipher_method:0,features:cz(cz(cz(cz(cz({install_id:aT(),device:n.name,system:n.os,system_general:navigator.userAgent,vendor:t.appId,version:ay,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:dQ.WEB_RTC,browser_name:n.name,browser_version:n.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),n.os&&{os_name:n.os}),n.osVersion&&{os_version:n.osVersion}),{},{detail:""})};return o6(()=>uI(e,{data:o,timeout:1e3,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==n8.OPERATION_ABORTED,i)})(i,e,t,r)),n=null,o=null,a={};try{n=await uH(i)}catch(e){if(e.code===n8.OPERATION_ABORTED)throw e;o=e}if(i.forEach(e=>e.cancel()),st.reportApiInvoke(e.sid,{name:oA.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:n}}).onSuccess(),n&&n.test_tags)try{a=function(e){if(!e.test_tags)return{};let t=e.test_tags,r=Object.keys(t),i={};return r.forEach(e=>{let r=e.slice(4).trim(),n=JSON.parse(t[e]),o=n[1];i[r]={tag:n[0]||"",value:o}}),i}(n)}catch(e){}return a}async function uZ(e,t){let r=aP.WEBCS_DOMAIN.concat(aP.WEBCS_DOMAIN_BACKUP_LIST).map(e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:uC(),serviceIds:[dz.CHOOSE_SERVER,dz.CLOUD_PROXY_FALLBACK]}));try{return await uK({referenceList:r,asyncMapHandler:r=>(async function(e,t,r){let i,{url:n,areaCode:o,serviceIds:a}=e,s=Date.now(),[c,d]=uG(t,o,a),u=ow.networkState;try{u&&ow.networkState===oT.OFFLINE&&ow.onlineWaiter&&await Promise.race([ow.onlineWaiter,oW(o1.maxRetryTimeout)]),u=ow.networkState;let{data:e,headers:t}=await uI(n,{data:c,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===t.http3?1:-1,(e=>{let t=[];if(e.response_body.forEach(r=>{let i=r.buffer.code;if(23===r.uri&&0===i&&!r.buffer.edges_services){if(4194310===r.buffer.flag)r.buffer.edges_services=[];else{let i={error:new sr(n8.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:r.buffer.flag};t.push(i)}}if(0!==i){let n=dL(i),o={error:new sr(n8.CAN_NOT_GET_GATEWAY_SERVER,n.desc,{desc:n.desc,retry:n.retry,csIp:e.detail[502]}),flag:r.buffer.flag};4194310===r.buffer.flag?a6.warning(o.error.toString()):t.push(o)}}),t.length)throw new sr(n8.CAN_NOT_GET_GATEWAY_SERVER,t.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!t.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(t.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})})(e);let o=d0(e,dz.CHOOSE_SERVER),a=d0(e,dz.CLOUD_PROXY_FALLBACK);return uF(o),{gatewayInfo:dJ(o,n),proxyInfo:a,opid:d,requestTime:s,url:n,isHttp3:i,elapse:Date.now()-s}}catch(e){throw e}})(r,e,t),closeFn:e=>e.code===n8.OPERATION_ABORTED||e.code===n8.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry})}catch(e){throw e}}async function u$(e,t,r,i){let n,o,a;let s=aP.PROXY_SERVER_TYPE3,c=(e,t,r)=>{let i=r||s;return Array.isArray(i)&&(i=t%2==0?s[1]:s[0]),"https://".concat(i,"/ap/?url=").concat(e)},d=null,u=[],l=async()=>{let n=aP.WEBCS_DOMAIN.slice(0,aP.AJAX_REQUEST_CONCURRENT).map((t,r)=>({url:"disabled"===e.cloudProxyServer&&e.proxyServer?c("".concat(t,"/api/v2/transpond/webrtc?v=2"),r,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):c("".concat(t,"/api/v2/transpond/webrtc?v=2"),r),areaCode:uC(),serviceIds:[dz.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?dz.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?dz.CLOUD_PROXY:dz.CLOUD_PROXY_FALLBACK]})),o=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:n.map(e=>e.url)}),a=await uY({fragementLength:aP.FRAGEMENT_LENGTH,referenceList:n,asyncMapHandler:i=>(a6.debug("[".concat(e.clientId,"] Connect to choose_server:"),i.url),uB(i,e,t,r)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},o),a},h=async()=>{if(await oW(1e3),null!==d)return d;let n=aP.WEBCS_DOMAIN_BACKUP_LIST.map((t,r)=>({url:"disabled"===e.cloudProxyServer&&e.proxyServer?c("".concat(t,"/api/v2/transpond/webrtc?v=2"),r,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):c("".concat(t,"/api/v2/transpond/webrtc?v=2"),r),areaCode:uC(),serviceIds:[dz.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?dz.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?dz.CLOUD_PROXY:dz.CLOUD_PROXY_FALLBACK]})),o=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:n.map(e=>e.url)}),a=await uY({fragementLength:aP.FRAGEMENT_LENGTH,referenceList:n,asyncMapHandler:i=>(a6.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),i.url),uB(i,e,t,r)),allFailedhandler:e=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},o),a};try{({gatewayInfo:n,proxyInfo:o,url:a}=await uH([l(),h()]))}catch(e){throw e[0]}if(u.length&&u.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),!n||!o)throw new sr(n8.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=a,"disabled"!==e.cloudProxyServer&&Array.isArray(s)&&a){let t=/^https?:\/\/(.+?)(\/.*)?$/.exec(a)[1];s.includes(t)&&(e.proxyServer=t,a6.setProxyServer(t),st.setProxyServer(t))}return d={gatewayInfo:n,proxyInfo:await d2(o,n.uid)}}async function u0(e,t,r){let i=null,n=[],o=async o=>{let a=aP[o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN"].map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"));return o&&(await oW(1e3),null!==i)?i:await uY({fragementLength:aP.FRAGEMENT_LENGTH,referenceList:a,asyncMapHandler:i=>(a6.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),i),function(e,t,r,i){let[n]=uW(t,[dz.CHOOSE_SERVER]),o=ow.networkState;return o6(async()=>(o&&ow.networkState===oT.OFFLINE&&ow.onlineWaiter&&await Promise.race([ow.onlineWaiter,oW(i&&i.maxRetryTimeout||o1.maxRetryTimeout)]),o=ow.networkState,uj(await uI(e,{data:n,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0),e)),()=>!1,e=>e.code!==n8.OPERATION_ABORTED&&(e.code===n8.UPDATE_TICKET_FAILED?e.data.retry:(a6.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0)),i)}(i,e,t,r)),allFailedhandler:e=>{throw e[0]},promisesCollector:n})};try{return i=await uH([o(!1),o(!0)]),n.length&&n.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),i}catch(e){throw e[0]}}class u2 extends op{get isSuccess(){return!!this.configs}constructor(e,t){super(),this.configs=void 0,this.store=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.interval=void 0,this.mutex=void 0,this.mutableParamsRead=!1,this.configCache={},this.limit_bitrate=void 0,this.mutex=new o0("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),aP.ENABLE_CONFIG_DISTRIBUTE&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},aP.CONFIG_DISTRIBUTE_INTERVAL))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){let e;if(!this.mutableParamsRead&&(this.mutableParamsRead=!0,st.reportApiInvoke(null,{options:void 0,name:oA.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:om.TRACER}).onSuccess(JSON.stringify(ax))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void a6.debug("[config-distribute] get config distribute interrupted have no joininfo");let t=await this.mutex.lock();try{e=await uq(this.joinInfo,this.cancelToken,this.retryConfig),a6.debug("[config-distribute] get config distribute",JSON.stringify(e));let t=function(e){let t=Object.keys(e).filter(e=>/^webrtc_ng_global_parameter/.test(e)).sort();for(let r=0;r<t.length;r++)for(let i=t.length-1;i>r;i--){let r=t[i],n=e[r].value;if("number"==typeof n.__priority){let o=n.__priority,a=e[t[i-1]].value;if("number"==typeof a.__priority){if(!(o>a.__priority))continue;t[i]=t[i-1],t[i-1]=r}else t[i]=t[i-1],t[i-1]=r}}let r=Date.now(),i={};return t.forEach(t=>{let n=e[t].value.__expires;n&&n<=r||(i[t]=e[t])}),i}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(t){let e=new sr(n8.NETWORK_RESPONSE_ERROR,t);a6.warning("[config-distribute] ".concat(e.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){d_(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(df.UPDATE_BITRATE_LIMIT,e):this.emit(df.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&cz({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{let t={},r=Object.keys(e),i=[];r.forEach(r=>{let n=e[r].value;t[r]=n;let o=n.__id;if(o&&this.configCache[r]&&this.configCache[r].__id===o)return;let a=n.__type,s=e[r].value,c=e[r].tag,d=0;a?a===aM.REALTIME&&(d=1):Object.keys(s).some(e=>Object.prototype.hasOwnProperty.call(aN,e)||!cF()&&Object.prototype.hasOwnProperty.call(ak,e)?(d=1,!0):void 0),i.push({tag:c,isApplied:d,feature:r,params:JSON.stringify(n)})}),i.forEach(e=>{let{tag:t,feature:r,params:i,isApplied:n}=e;this.store.sessionId&&st.abTest(this.store.sessionId,{intSucc:1,isApplied:n,tag:t,feature:r,params:i,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=t}catch(e){a6.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){let t=function(e){let t={};return Object.keys(e).forEach(r=>{let i=e[r].value,n=i.__expires,o=i.__type;Object.keys(i).forEach(e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=cz(cz({value:i[e]},n&&{expires:n}),o&&{type:o}))})}),t}(e);try{var r;let i=null===(r=t.LIMIT_BITRATE)||void 0===r?void 0:r.value;delete t.LIMIT_BITRATE,i&&d_(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{let t=Date.now();Object.keys(e).forEach(r=>{let{value:i,type:n,expires:o}=e[r];o&&o<=t||((n===aM.REALTIME||Object.prototype.hasOwnProperty.call(aN,r))&&(ax[r]=i,aP[r]=i,a6.debug("Update realtime parameters from config distribute",r,i)),n||cF()||!Object.prototype.hasOwnProperty.call(ak,r)||(ax[r]=i,aP[r]=i,a6.debug("Update gateway parameters from config distribute",r,i)))})}catch(t){a6.error("Error update config immediately: ".concat(e),t.message)}}(t);let n=JSON.stringify(t),o=window.btoa(n);window.localStorage.setItem("websdk_ng_global_parameter",o),a6.debug("Caching global parameters ".concat(n))}catch(e){a6.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{let t=Date.now();Object.keys(e).forEach(r=>{if("CLIENT_ROLE_OPTIONS"===r&&Object.prototype.hasOwnProperty.call(aP,r)){let{value:i,expires:n}=e[r];(!n||!(n<=t))&&(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}}(aP[r],i)||(ax[r]=i,aP[r]=i,this.emit(df.UPDATE_CLIENT_ROLE_OPTIONS,i),a6.debug("Updating client role options: ".concat(JSON.stringify(i)))))}})}catch(e){a6.error("Error handling global parameter config:",e.message)}}}class u1 extends op{constructor(){super(...arguments),this.resultStorage=new Map}setLocalAudioStats(e,t,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(r,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(r,t))}setLocalVideoStats(e,t,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(r,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(r,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(r))}setRemoteAudioStats(e,t){let r=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let r=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(t))}record(e,t,r){if(aP.STATS_UPDATE_INTERVAL>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let i=this.resultStorage.get(e);if(i&&(i.result.push(r),i.result.length>=5)){let r=i.result.includes(!0);i.isPrevNormal&&!r&&this.emit("exception",u4[e],e,t),!i.isPrevNormal&&r&&this.emit("exception",u4[e]+2e3,e+"_RECOVER",t),i.isPrevNormal=r,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof cS&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let r=null;t._encoderConfig&&t._encoderConfig.frameRate&&(r=dq(t._encoderConfig.frameRate));let i=e.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof cS&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}let u4={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},u6=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){let e=r[r.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){let e=r[r.length-1];return Math.round(performance.now()-e.startTime)}return 0}};class u3{constructor(e){this.store=void 0,this.onStatsException=void 0,this.onUploadPublishDuration=void 0,this.onStatsChanged=void 0,this.localStats=new Map,this.remoteStats=new Map,this.updateStatsInterval=void 0,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0,this.exceptionMonitor=void 0,this.p2pChannel=void 0,this.scalabilityMode=a_.L1T1,this.updateStats=()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))},this.store=e,this.exceptionMonitor=new u1,this.exceptionMonitor.on("exception",(e,t,r)=>{this.onStatsException&&this.onStatsException(e,t,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(db.LocalAudioTrack)||cz({},sI)}getLocalVideoTrackStats(){return this.localStats.get(db.LocalVideoTrack)||cz({},sC)}getRemoteAudioTrackStats(e){let t=(e,t)=>{if(!this.trafficStats)return t;let r=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return r&&(t.publishDuration=r.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},r={};if(e){var i;let n=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.audioStats;n&&(r[e]=t(e,n))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{audioStats:n}]=e;n&&(r[i]=t(i,n))});return r}getRemoteNetworkQualityStats(e){let t={};if(e){var r;let i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.networkStats;i&&(t[e]=i)}else Array.from(this.remoteStats.entries()).forEach(e=>{let[r,{networkStats:i}]=e;i&&(t[r]=i)});return t}getRemoteVideoTrackStats(e){let t=(e,t)=>{if(!this.trafficStats)return t;let r=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return r&&(t.publishDuration=r.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},r={};if(e){var i;let n=null===(i=this.remoteStats.get(e))||void 0===i?void 0:i.videoStats;n&&(r[e]=t(e,n))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{videoStats:n}]=e;n&&(r[i]=t(i,n))});return r}getRTCStats(){let e=0,t=0,r=0,i=0,n=this.localStats.get(db.LocalAudioTrack);n&&(e+=n.sendBytes,t+=n.sendBitrate);let o=this.localStats.get(db.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);let a=this.localStats.get(db.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach(e=>{let{audioStats:t,videoStats:n}=e;t&&(r+=t.receiveBytes,i+=t.receiveBitrate),n&&(r+=n.receiveBytes,i+=n.receiveBitrate)});let s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(e=>void 0!==e.B_ppad||void 0!==e.B_ppvd),e.peer_delay.filter(e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid)).forEach(e=>{var t;let r=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),i=null!=r&&r.videoSSRC?u6.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,n=null!=r&&r.audioSSRC?u6.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,i>n?i:n),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&a6.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,r){if(!e)return!1;let i=!!r&&t.framesDecodeFreezeTime>r.framesDecodeFreezeTime,n=!r||t.framesDecodeCount>r.framesDecodeCount;return i||!n}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[r,i]=t;switch(r){case db.LocalVideoTrack:case db.LocalVideoLowTrack:{var n;let t=cz({},sC),o=e.getStats(),a=e.getLocalMedia(r);if(o){let r=o.videoSend.find(e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId));if(r){let n=e.getLocalVideoSize(),o=e.getEncoderConfig(db.LocalVideoTrack);"H264"!==r.codec&&"H265"!==r.codec&&"VP8"!==r.codec&&"VP9"!==r.codec&&"AV1X"!==r.codec&&"AV1"!==r.codec||(t.codecType=r.codec),t.sendBytes=r.bytes,t.sendBitrate=i?8*Math.max(0,t.sendBytes-i.sendBytes):0,r.inputFrame?(t.captureFrameRate=r.inputFrame.frameRate,t.captureResolutionHeight=r.inputFrame.height,t.captureResolutionWidth=r.inputFrame.width):n&&(t.captureResolutionWidth=n.width,t.captureResolutionHeight=n.height),r.sentFrame?(t.sendFrameRate=r.sentFrame.frameRate,t.sendResolutionHeight=r.sentFrame.height,t.sendResolutionWidth=r.sentFrame.width):n&&(t.sendResolutionWidth=n.width,t.sendResolutionHeight=n.height),r.avgEncodeMs&&(t.encodeDelay=r.avgEncodeMs),o&&o.bitrateMax&&(t.targetSendBitrate=1e3*o.bitrateMax),t.sendPackets=r.packets,t.sendPacketsLost=r.packetsLost,t.sendJitterMs=r.jitterMs,t.sendRttMs=r.rttMs,t.totalDuration=i?i.totalDuration+1:1,t.totalFreezeTime=i?i.totalFreezeTime:0,this.isLocalVideoFreeze(r)&&(t.totalFreezeTime+=1),r.scalabilityMode&&this.scalabilityMode!==r.scalabilityMode&&(a6.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(r.scalabilityMode)),this.scalabilityMode=r.scalabilityMode)}this.trafficStats&&(t.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}this.localStats.set(r,t),((null==i?void 0:i.sendResolutionWidth)!==t.sendResolutionWidth||(null==i?void 0:i.sendResolutionHeight)!==t.sendResolutionHeight)&&(null===(n=this.onStatsChanged)||void 0===n||n.call(this,"resolution",{width:t.sendResolutionWidth,height:t.sendResolutionHeight})),t&&a&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,a.track,t);break}case db.LocalAudioTrack:{let t=cz({},sI),n=e.getStats(),o=e.getLocalMedia(r);if(n){let r=n.audioSend.find(e=>e.ssrc===(null==o?void 0:o.ssrcs[0].ssrcId));if(r){if("opus"!==r.codec&&"aac"!==r.codec&&"PCMU"!==r.codec&&"PCMA"!==r.codec&&"G722"!==r.codec||(t.codecType=r.codec),r.inputLevel)t.sendVolumeLevel=Math.round(32767*r.inputLevel);else{let r=e.getLocalAudioVolume();r&&(t.sendVolumeLevel=Math.round(32767*r))}t.sendBytes=r.bytes,t.sendPackets=r.packets,t.sendPacketsLost=r.packetsLost,t.sendJitterMs=r.jitterMs,t.sendRttMs=r.rttMs,t.sendBitrate=i?8*Math.max(0,t.sendBytes-i.sendBytes):0}}this.trafficStats&&(t.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(db.LocalAudioTrack,t),t&&o&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,o.track,t)}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var r;let i;let[n,{videoStats:o,audioStats:a,videoPcStats:s}]=t,c=cz({},sk),d=cz({},sO),u=cz({},sw),{audioTrack:l,videoTrack:h,audioSSRC:p,videoSSRC:f}=e.getRemoteMedia(n),_=null==(i=this.store.useP2P?e.getStats(!0):e.getStats())?void 0:i.audioRecv.find(e=>e.ssrc===p),A=null==i?void 0:i.videoRecv.find(e=>e.ssrc===f),m=this.trafficStats&&this.trafficStats.peer_delay.find(e=>e.peer_uid===n);if(_&&("opus"!==_.codec&&"aac"!==_.codec&&"PCMU"!==_.codec&&"PCMA"!==_.codec&&"G722"!==_.codec||(c.codecType=_.codec),_.outputLevel?c.receiveLevel=Math.round(32767*_.outputLevel):l&&(c.receiveLevel=Math.round(32767*l.getVolumeLevel())),c.receiveBytes=_.bytes,c.receivePackets=_.packets,c.receivePacketsLost=_.packetsLost,c.receivePacketsDiscarded=_.packetsDiscarded,c.packetLossRate=c.receivePacketsLost/(c.receivePackets+c.receivePacketsLost),c.receiveBitrate=a?8*Math.max(0,c.receiveBytes-a.receiveBytes):0,c.totalDuration=a?a.totalDuration+1:1,c.totalFreezeTime=a?a.totalFreezeTime:0,c.freezeRate=c.totalFreezeTime/c.totalDuration,c.receiveDelay=_.jitterBufferMs,c.totalDuration>10&&u3.isRemoteAudioFreeze(l)&&(c.totalFreezeTime+=1)),A){"H264"!==A.codec&&"H265"!==A.codec&&"VP8"!==A.codec&&"VP9"!==A.codec&&"AV1X"!==A.codec&&"AV1"!==A.codec||(d.codecType=A.codec),d.receiveBytes=A.bytes,d.receiveBitrate=o?8*Math.max(0,d.receiveBytes-o.receiveBytes):0,d.decodeFrameRate=A.decodeFrameRate<0?0:A.decodeFrameRate,d.renderFrameRate=A.decodeFrameRate<0?0:A.decodeFrameRate,A.outputFrame&&(d.renderFrameRate=A.outputFrame.frameRate),A.receivedFrame?(d.receiveFrameRate=A.receivedFrame.frameRate,d.receiveResolutionHeight=A.receivedFrame.height,d.receiveResolutionWidth=A.receivedFrame.width):h&&(d.receiveResolutionHeight=h._videoHeight||0,d.receiveResolutionWidth=h._videoWidth||0),void 0!==A.framesRateFirefox&&(d.receiveFrameRate=Math.round(A.framesRateFirefox)),d.receivePackets=A.packets,d.receivePacketsLost=A.packetsLost,d.packetLossRate=d.receivePacketsLost/(d.receivePackets+d.receivePacketsLost);let t=o?o.totalFreezeTime:0,i=o?o.totalDuration:0;d.totalDuration=o?o.totalDuration+1:1,d.totalFreezeTime=null!==(r=A.totalFreezesDuration)&&void 0!==r?r:t||0,d.receiveDelay=A.jitterBufferMs||0;let n=!!f&&e.getRemoteVideoIsReady(f);void 0===A.totalFreezesDuration&&h&&n&&u3.isRemoteVideoFreeze(h,A,s)&&(d.totalFreezeTime+=1),d.freezeRate=Math.max(0,Math.min((d.totalFreezeTime-t)/(d.totalDuration-i),1))}m&&(c.end2EndDelay=m.B_ad,d.end2EndDelay=m.B_vd,c.transportDelay=m.B_ed,d.transportDelay=m.B_ed,c.currentPacketLossRate=m.B_ealr4/100,d.currentPacketLossRate=m.B_evlr4/100,u.uplinkNetworkQuality=m.B_punq?m.B_punq:0,u.downlinkNetworkQuality=m.B_pdnq?m.B_pdnq:0),this.remoteStats.set(n,{audioStats:c,videoStats:d,videoPcStats:A,networkStats:u}),l&&this.exceptionMonitor.setRemoteAudioStats(l,c),h&&this.exceptionMonitor.setRemoteVideoStats(h,d)})}}class u8{constructor(){this.destChannelMediaInfos=new Map,this.srcChannelMediaInfo=void 0}setSrcChannelInfo(e){di(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){di(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){c7(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function u5(e){if(!(e instanceof u8))return new sr(n8.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();return t?0===r.size?new sr(n8.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new sr(n8.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class u9{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){this.uid=void 0,this._uintid=void 0,this._trust_in_room_=!0,this._trust_audio_enabled_state_=!0,this._trust_video_enabled_state_=!0,this._trust_audio_mute_state_=!0,this._trust_video_mute_state_=!0,this._audio_muted_=!1,this._video_muted_=!1,this._audio_enabled_=!0,this._video_enabled_=!0,this._audio_added_=!1,this._video_added_=!1,this._is_pre_created=!1,this._video_pre_subscribed=!1,this._audio_pre_subscribed=!1,this._trust_video_stream_added_state_=!0,this._trust_audio_stream_added_state_=!0,this._audioTrack=void 0,this._videoTrack=void 0,this._dataChannels=[],this._audioSSRC=void 0,this._videoSSRC=void 0,this._audioOrtc=void 0,this._videoOrtc=void 0,this._cname=void 0,this._rtxSsrcId=void 0,this._videoMid=void 0,this._audioMid=void 0,this.uid=e,this._uintid=t}}class u7{get localCapabilities(){return oD(this._localCapabilities)}get rtpCapabilities(){return oD(this._rtpCapabilities)}get candidates(){return oD(this._candidates)}get iceParameters(){return oD(this._iceParameters)}get dtlsParameters(){return oD(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.sessionDesc=void 0,this._localCapabilities=void 0,this._rtpCapabilities=void 0,this._candidates=void 0,this._originCandidates=void 0,this._iceParameters=void 0,this._isUseExtmapAllowMixed=void 0,this._dtlsParameters=void 0,this.setup=void 0,this.currentMidIndex=void 0,this.cname=void 0,this.firefoxSsrcMidMap=new Map,this._isUseExtmapAllowMixed=t;let{iceParameters:r,dtlsParameters:i,candidates:n,rtpCapabilities:o,setup:a,localCapabilities:s,cname:c}=e=oD(e);this._rtpCapabilities=o,this._candidates=n,this._originCandidates=oD(n),this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=s,this.setup=a,this.cname=c,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){let t=this.candidates,r=this.dtlsParameters,i=this.iceParameters,n=this.rtpCapabilities.send,o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){let e=2*a+2e4,s=2*a+4e4,{ssrcs:c,ssrcGroups:d}=un([{ssrcId:e}],this.cname),{ssrcs:u,ssrcGroups:l}=un([{ssrcId:s,rtx:aP.USE_SUB_RTX?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:n.videoCodecs.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:t,extmaps:n.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:n.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:n.audioCodecs.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:t,extmaps:n.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:n.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return aQ(this.sessionDesc)}send(e,t,r,i){let{ssrcs:n,ssrcGroups:o}=un(t,this.cname,aP.SYNC_GROUP?r:void 0),a=this.findPreloadMediaDesc(n);if(a){if(nG()&&this.firefoxSsrcMidMap.set(n[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){let e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{let t;let r=this.findAvailableMediaIndex(e,n);return -1===r||1===r&&(nF()||function(){let e=nL();return!(e.name!==nO.CHROME||!e.osVersion)&&90>=Number(e.version)}()||aP.ENABLE_ENCODED_TRANSFORM&&nV())||0===r&&aP.USE_SUB_RTX||nQ()?(t=this.createOrRecycleSendMedia(e,n,o,"sendonly",i),this.updateBundleMids()):((t=oD(this.sessionDesc.mediaDescriptions[r])).attributes.direction="sendonly",t.attributes.ssrcs=n,t.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[r]=this.mungSendMediaDesc(t,i)),nG()&&this.firefoxSsrcMidMap.set(n[0].ssrcId,t.attributes.mid),{mid:t.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(e=>{let{kind:t,ssrcMsg:r,mslabel:i}=e;return this.send(t,r,i)}),r=[],i=!1;return t.forEach(e=>{let{mid:t,needExchangeSDP:n}=e;n&&(i=!0),r.push(t)}),{mids:r,needExchangeSDP:i}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{"0"===e.attributes.mid||nG()||nQ()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>e.includes(t.attributes.mid||""));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>e.includes(t.attributes.mid||""));if(t.length!==e.length)throw Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}receive(e,t,r,i){e.forEach((e,n)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,r,i[n])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){var t;let r=this.sessionDesc||aK((t=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(t?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));this._rtpCapabilities=e;let i=this.rtpCapabilities.send,n=this.localCapabilities.send;for(let e of r.mediaDescriptions){if(e.attributes.iceUfrag=this._iceParameters.iceUfrag,e.attributes.icePwd=this._iceParameters.icePwd,e.attributes.fingerprints=this._dtlsParameters.fingerprints,e.attributes.candidates=this._candidates,e.attributes.setup=this.setup,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType){if(0===i.videoCodecs.length){let t=n.videoCodecs.filter(e=>{var t;return null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase().includes("vp8")})||[n.videoCodecs[0]];e.media.fmts=t.map(e=>e.payloadType.toString(10)),e.attributes.payloads=t,e.attributes.extmaps=[]}else if(e.media.fmts=i.videoCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=i.videoCodecs,e.attributes.extmaps=i.videoExtensions,aP.PRELOAD_MEDIA_COUNT>0){let{ssrcs:t,ssrcGroups:r}=un([{ssrcId:4e4,rtx:aP.USE_SUB_RTX?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=r}}if("audio"===e.media.mediaType){if(0===i.audioCodecs.length){let t=n.audioCodecs.filter(e=>{var t;return null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase().includes("opus")})||[n.audioCodecs[0]];e.media.fmts=t.map(e=>e.payloadType.toString(10)),e.attributes.payloads=t,e.attributes.extmaps=[]}else if(e.media.fmts=i.audioCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions,uu(e),aP.PRELOAD_MEDIA_COUNT>0){let{ssrcs:t,ssrcGroups:r}=un([{ssrcId:2e4}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=r}}}return this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){let t=this._originCandidates.filter(e=>"udp"===e.transport),r=[];if(t.forEach(e=>{r.push(cz(cz({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}),0!==t.length){switch(e){case dE.TCP_RELAY:this._candidates=r;break;case dE.UDP_TCP_RELAY:case dE.RELAY:this._candidates=[...t,...r];break;default:this._candidates=t}for(let e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=oD(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(nG()){if(i){let e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(let e of this.sessionDesc.mediaDescriptions)if("application"===e.media.mediaType)return{mediaDesc:e,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,r,i,n,o){let a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=ul(a,s,this.localCapabilities.send,a===dv.VIDEO?i:n),d=a===dv.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;let u="".concat(this.currentMidIndex),l={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};l=this.mungRecvMediaDsec(l,e,o);let h=this.findFirstClosedMedia(a);if(h){let e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateRemoteCodec(e,t,r){let i;let n=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>Object.keys(aV).includes(e)))],o=new Set(t);if(n.every(e=>o.has(e)))return a6.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let a=this._rtpCapabilities.recv.videoCodecs.filter(e=>t.some(t=>(e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").includes(t)));if(0===a.length)return a6.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(n," codecs: ").concat(t)),!1;let s=[...new Set(a.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""))];if(a6.debug("updateRemoteCodec, from ".concat(n," to ").concat(s)),0===e.length)i=this.sessionDesc.mediaDescriptions.filter(e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction);else if((i=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&e.includes(t.attributes.mid)&&"recvonly"===t.attributes.direction)).length!==e.length)return a6.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(aP.USE_PUB_RTX||aP.USE_SUB_RTX){let e=uh(a,this.rtpCapabilities.recv.videoCodecs);a.push(...e)}this._rtpCapabilities.recv.videoCodecs=a;let c=this.localCapabilities.send,d=this.rtpCapabilities.recv,u=ul(dv.VIDEO,d,c,r);return i.forEach(e=>{let t=u.map(e=>e.payloadType.toString(10));a6.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",u),e.attributes.payloads=u,e.media.fmts=t}),!0}createOrRecycleSendMedia(e,t,r,i,n){let o=this.rtpCapabilities.send,a=e===dv.VIDEO?o.videoCodecs:o.audioCodecs,s=e===dv.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;let c="".concat(this.currentMidIndex),d={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};d=this.mungSendMediaDesc(d,n);let u=this.findFirstClosedMedia(e);if(u){let e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,r){let i=oD(e);return function(e){let t=e.attributes.unrecognized.findIndex(e=>"x-google-flag"===e.attField&&"conference"===e.attValue);-1!==t&&e.attributes.unrecognized.splice(t,1)}(i),uo(i,t),function(e,t){if(!(t instanceof cR&&t._encoderConfig&&-1===t._hints.indexOf(sE.SCREEN_TRACK)))return;let r=t._encoderConfig;si.supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(e=>{var t;["h264","h265","vp8","vp9","av1"].includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),si.supportMinBitrate&&!t._hints.includes(sE.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(e=>{var t;["h264","h265","vp8","vp9","av1"].includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(aP.X_GOOGLE_START_BITRATE||Math.floor(r.bitrateMax)))})}(i,t),function(e){if("video"!==e.media.mediaType)return;let t=nL();if(t.name!==nO.SAFARI&&t.os!==nw.IOS)return;let r=e.attributes.extmaps.findIndex(e=>/video-orientation/g.test(e.extensionName));-1!==r&&e.attributes.extmaps.splice(r,1)}(i),ua(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,t){let r=oD(e);return ua(r,t,this.localCapabilities.recv),uu(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==r){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>nG()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return(null===(r=t.attributes)||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===t?void 0:t.attributes.ssrcs}}var le=((eB=le||{})[eB.DOWN=0]="DOWN",eB[eB.UP=1]="UP",eB);let lt=new Map;function lr(e,t,r,i){let{scale:n}=e;if(0===n&&i===le.UP||n>=t.length-1&&i===le.DOWN)return e;let o=cz(cz({},e),{},{scale:i===le.DOWN?++n:--n});switch(r){case"maintain-framerate":o=cz(cz({},o),t[n].motion);break;case"maintain-resolution":o=cz(cz({},o),t[n].detail);break;case"balanced":o=cz(cz({},o),t[n].balanced)}return o}function li(e,t){if(t){let r={overUse:0,underUse:0,adaptationList:ln(t)};lt.set(e,r)}else lt.delete(e)}function ln(e){let t=cz({},e),{bitrateMax:r,frameRate:i,scaleResolutionDownBy:n,bitrateMin:o}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:d,BITRATE_MAX_THRESHOLD:u,BWE_SCALE_UP_THRESHOLD:l,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:f,BALANCE_BITRATE_FACTOR:_,BALANCE_FRAMERATE_FACTOR:A,BALANCE_RESOLUTION_FACTOR:m,MOTION_RESOLUTION_FACTOR:v,MOTION_BITRATE_FACTOR:E,DETAIL_FRAMERATE_FACTOR:g,DETAIL_BITRATE_FACTOR:S}=aw,b=Math.min(t.frameRate,s),T=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(p,1)*b),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:r,bitrateMin:o}}];for(let e=1;e<=c;e++){let t={bwe_up:Math.round(Math.pow(l,e)*r),bwe_down:Math.round(Math.pow(h,e+1)*r),fps_up:Math.round(Math.pow(f,e)*b),fps_down:Math.round(Math.pow(p,e+1)*b)},s={scaleResolutionDownBy:n/Math.pow(m,e),frameRate:Math.max(Math.round(Math.pow(A,e)*i),a),bitrateMax:Math.max(Math.round(Math.pow(_,e)*r),u),bitrateMin:Math.max(Math.round(Math.pow(_,e)*o),d)},c={scaleResolutionDownBy:n/Math.pow(v,e),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(E,e)*r),u),bitrateMin:Math.max(Math.round(Math.pow(E,e)*o),d)},y={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(g,e)*i),a),bitrateMax:Math.max(Math.round(Math.pow(S,e)*r),u),bitrateMin:Math.max(Math.round(Math.pow(S,e)*o),d)};T.push({scale:e,threshold:t,balanced:s,motion:c,detail:y})}return T}let lo=new Map;function la(e,t){let r=lo.get(e);if(r){let{timer:t}=r;window.clearTimeout(t),lo.delete(e)}t.qualityLimitationReason=af.NONE,li(e)}function ls(e){if(e.some(e=>e._bypassWebAudio))throw new n5(n8.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!si.webAudioMediaStreamDest)throw new n5(n8.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function lc(e,t){ls(e);let r=t||new cS;return e.forEach(e=>r.addAudioTrack(e)),r}let ld=!si.supportUnifiedPlan||aP.CHROME_FORCE_PLAN_B&&n0();function lu(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ld?(t={spec:r,store:e},uE("PlanBConnection").create(t)):new lp(r,e)}function ll(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function lh(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(oE(e.turnServer.servers))return!1;if(aP.FORCE_TURN_TCP||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch(e){return!1}}let lp=(cG((rl=class e extends dm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>Object.keys(aV).includes(e)))]}constructor(t,r){super(t,r),this.id=oH(5,"connection-"),this.store=void 0,this.peerConnection=void 0,this.forceTurn=!1,this.remoteSDP=void 0,this.initialOffer=void 0,this.transportEventReceiver=void 0,this.statsFilter=void 0,this.extension={useXR:aP.USE_XR},this.localCapabilities=void 0,this.remoteCodecs=void 0,this.localCandidateCount=0,this.allCandidatesReceived=!1,this.isPreallocation=!1,this.preSSRCMap=new Map,this.dataStreamChannelMap=new Map,this.establishPromise=void 0,this.recoveredDataChannelIds=[],this.currentDataChannelId=1,this.supportAV1RtpSpec=!1,this.mutex=void 0,this.qualityLimitationReason=af.NONE,this.isFirstConnected=!1,this.store=r,this.forceTurn=lh(t),this.mutex=new o0("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,o=function(){let e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return o?o<76?new ap(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):new ag(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):!function(e){var t;if(!window.RTCStatsReport)return!1;let r=e.getStats();return!!(r instanceof Promise||(t=r)&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then)}(e)?new aS(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n}):new ag(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:i,firstVideoDecodedTimeout:n})}(this.peerConnection,aP.STATS_UPDATE_INTERVAL,void 0,nG()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){let t=this.preSSRCMap.get(e);if(void 0!==t){let e=this.peerConnection.getTransceivers().find(e=>e.mid===t);if(e)return{transceiver:e,track:e.receiver.track,id:t}}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,!this.remoteSDP)return void a6.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t));if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){let e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);let r=this.remoteSDP.toString();null==t||t(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}else a6.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){var e,t;try{let r;this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let i=await this.peerConnection.createOffer();if(!i.sdp)throw Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=ut(i.sdp),o=await us({filterRTX:!aP.USE_PUB_RTX&&!aP.USE_SUB_RTX,filterVideoFec:aP.FILTER_VIDEO_FEC,filterAudioFec:aP.FILTER_AUDIO_FEC,filterVideoCodec:aP.FILTER_VIDEO_CODEC},this.extension);if(this.localCapabilities=ud(o),this.initialOffer=i,aP.ENABLE_SVC&&"av1"==this.store.codec){let t=await async function(){try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:a_.L1T3}]});let t=await e.createOffer();if(!t.sdp)return void e.close();let r=aK(t.sdp).mediaDescriptions[0];if(!r)return;let i=r.attributes.extmaps.find(e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName);return e.close(),i}catch(e){return}}();t&&(this.supportAV1RtpSpec=!0,null===(e=o.send)||void 0===e||e.videoExtensions.push(t))}return i.sdp&&u_(i.sdp)&&((t=r=oD(o)).send&&(d5(dv.VIDEO,t.send.videoExtensions),d5(dv.AUDIO,t.send.audioExtensions)),t.recv&&(d5(dv.VIDEO,t.recv.videoExtensions),d5(dv.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(d5(dv.VIDEO,t.sendrecv.videoExtensions),d5(dv.AUDIO,t.sendrecv.audioExtensions))),cz(cz({},n),{},{rtpCapabilities:r||o,offerSDP:i.sdp})}catch(e){throw new n5(n8.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){var t,r;try{if(!this.initialOffer)throw Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&u_(this.initialOffer.sdp)&&(t=e.rtpCapabilities,r=this.localCapabilities,t.send&&(d8(dv.VIDEO,t.send.videoExtensions,r.send.videoExtensions),d8(dv.AUDIO,t.send.audioExtensions,r.send.audioExtensions)),t.recv&&(d8(dv.VIDEO,t.recv.videoExtensions,r.recv.videoExtensions),d8(dv.AUDIO,t.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new u7(cz(cz({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let i=this.remoteSDP.toString(),n=uf(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(n||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});let a=this.peerConnection.getTransceivers()[0];if(null!=a&&a.receiver&&this.tryBindTransportEvents(a.receiver),aP.PRELOAD_MEDIA_COUNT>0){this.remoteSDP.preloadRemoteMedia(aP.PRELOAD_MEDIA_COUNT);let e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}let{preSSRCs:s}=e;if(Array.isArray(s)&&s.length>0){let{mids:e}=this.remoteSDP.batchSend(s.map(e=>({kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel})));e.forEach((e,t)=>{this.preSSRCMap.set(s[t].ssrcId,e)}),await up(this.peerConnection,this.remoteSDP,this.extension),a6.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:t}=e;this.remoteSDP.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:r}=e;if(Array.isArray(r)&&r.length>0){let{mids:e}=this.remoteSDP.batchSend(r.map(e=>Object.assign({},{kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel})));e.forEach((e,t)=>{this.preSSRCMap.set(r[t].ssrcId,e)})}await up(this.peerConnection,this.remoteSDP,this.extension),a6.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,r){var i=this;return cX(function*(){let n=yield cK(i.mutex.lock("From P2PConnection.send"));try{let n;if(!i.remoteSDP)throw Error("Cannot call P2PConnection.send before remote SDP created");let o=[],a=d6();e.forEach(e=>{let t=i.peerConnection.addTransceiver(e._mediaStreamTrack,cz({direction:"sendonly"},"video"===e.trackMediaType&&i.supportAV1RtpSpec&&a?{sendEncodings:[{scalabilityMode:a}]}:{}));o.push(t),e._updateRtpTransceiver(t)}),nG()&&!0===aP.SIMULCAST&&(yield cK(i.applySimulcastForFirefox(o,e)));let s=yield cK(i.peerConnection.createOffer()),c=i.remoteSDP.predictReceivingMids(e.length),d=i.mungSendOfferSDP(s.sdp,e,c),u=aK(d),l=c.map(e=>{let t=u.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw Error("Cannot extract ssrc from mediaDescription.");return function(e,t){let r=[],i=e.attributes.ssrcGroups.filter(e=>"FID"===e.semantic),n=e.attributes.ssrcGroups.find(e=>"SIM"===e.semantic),o=e.attributes.ssrcs;if(n)n.ssrcIds.forEach(e=>{var n;let o=null===(n=i.find(t=>t.ssrcIds[0]===e))||void 0===n?void 0:n.ssrcIds[1];r.push({ssrcId:e,rtx:t?o:void 0})});else if(i.length>0){let e=i[0].ssrcIds[0],n=i[0].ssrcIds[1];r.push({ssrcId:e,rtx:t?n:void 0})}else{if(0===o.length)throw Error("No ssrcs found on local media description.");r.push({ssrcId:o[0].ssrcId})}return r}(t,aP.USE_PUB_RTX)});try{n=yield l}catch(a){n=[],i.remoteSDP.receive(e,t,r,n);let o=i.remoteSDP.toString();throw yield cK(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield cK(i.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield cK(i.stopSending(c,!0)),a}i.remoteSDP.receive(e,t,r,n);let h=i.remoteSDP.toString(),p=i.logSDPExchange(d,"offer","local","send");return yield cK(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield cK(i.applySimulcastEncodings(o,e)),yield cK(i.applySendEncodings(o,e)),null==p||p(h),yield cK(i.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map((e,t)=>{let r=c[t];return{localSSRC:l[t],id:r,transceiver:e}})}catch(e){throw e instanceof n5?e:new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{n()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(e);if(r&&"open"===r.readyState)a6.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw Error("create DataChannel error, because cannot get dc id");(r=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:aP.DATASTREAM_MAX_RETRANSMITS})).binaryType="arraybuffer",this.dataStreamChannelMap.set(e,r)}t.forEach(e=>{e._updateOriginDataChannel(r)});let{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){let e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),a6.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else a6.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof n5?e:new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{let t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof n5?e:new n5(n8.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){let r=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{var t;la(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);let n=this.remoteSDP.toString();null==i||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{r&&r()}}async receive(e,t,r,i){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:n,needExchangeSDP:o}=this.remoteSDP.send(e,t,r,i);o&&(await up(this.peerConnection,this.remoteSDP,this.extension),a6.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));let a=this.peerConnection.getTransceivers().find(e=>e.mid===n);if(!a)throw Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:n,transceiver:a}}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:t,needExchangeSDP:r}=this.remoteSDP.batchSend(e);return r&&(await up(this.peerConnection,this.remoteSDP,this.extension),a6.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(e=>{let t=this.peerConnection.getTransceivers().find(t=>t.mid===e);if(!t)throw Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(e=>{Array.from(this.preSSRCMap.entries()).some(t=>{let[r,i]=t;if(i===e)return this.preSSRCMap.delete(r),!0})}),this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();null==r||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();null==r||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);let t=this.remoteSDP.toString(),r=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();null==r||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);let n=this.remoteSDP.toString();null==i||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw Error("Transceivers' length doesn't match mids' length.");t.map(async(e,t)=>{e.direction="sendonly"});let r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);let n=this.remoteSDP.toString();null==i||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return cX(function*(){let r=yield cK(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw Error("Cannot restartICE before remoteSDP created.");let r=si.supportPCSetConfiguration,i=aP.FORCE_TURN_TCP||t.forceTurn;if(e===dE.RELAY&&!r)return;if(r&&!i){let r=e===dE.RELAY?"relay":"all",i=t.peerConnection.getConfiguration();i.iceTransportPolicy!==r&&(a6.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(i.iceTransportPolicy,"] to [").concat(r,"]")),i.iceTransportPolicy=r,t.peerConnection.setConfiguration(i))}t.remoteSDP.updateCandidates(e);let n=yield cK(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw Error("Cannot restartICE because restart offer SDP does not exist.");let o=ut(n.sdp),{remoteIceParameters:a}=yield o.iceParameters;t.remoteSDP.restartICE(a);let s=t.remoteSDP.toString(),c=t.logSDPExchange(n.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield cK(t.peerConnection.setLocalDescription(n)),null==c||c(s),yield cK(t.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(e){a6.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{r()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(dE.TCP_RELAY),await up(this.peerConnection,this.remoteSDP,this.extension)}catch(e){a6.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(e=>{la(this.id+e.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return cz(cz({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let n=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==o||o(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(e){throw new n5(n8.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){let r=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===r.length&&(this.isVP8Simulcast(t)?nG()||await this.applySimulcastEncodings(r,[t]):await this.applySendEncodings(r,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let r=this.peerConnection.getTransceivers().find(e=>e.mid===t);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let{local:t,remote:r}=e[0].transport.iceTransport.getSelectedCandidatePair();return{local:cz(cz({},aa),{},{candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port}),remote:cz(cz({},aa),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;let r="code: ".concat(e.errorCode,", message: ").concat(e.errorText),i=e.port?"local: ".concat(e.port):"";a6.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(e.url||"",", host_candidate:").concat(i)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,r)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&a6.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,a6.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,a6.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},aP.CANDIDATE_TIMEOUT)}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(oE(t.turnServer.servers)?r.iceServers=t.turnServer.servers:aP.NEW_TURN_MODE&&r.iceServers?(aP.USE_TURN_SERVER_OF_GATEWAY?t.turnServer.serversFromGateway&&r.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),aP.NEW_FORCE_TURN&&(r.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(r.iceServers&&r.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),aP.USE_TURN_SERVER_OF_GATEWAY&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),aP.FORCE_TURN_TCP?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(r.iceTransportPolicy="relay")}))),aP.ENABLE_ENCODED_TRANSFORM&&si.supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(e){let t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(dX(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!aP.FORCE_TURN_TCP&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}static newTurnServerConfigToIceServers(e){let t=[];return e.forEach(e=>{let r=aP.NEW_TURN_MODE;1===r?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===r?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===r?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(dX(e.turnServerURL),":443?transport=tcp")}):4===r&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(dX(e.turnServerURL),":443?transport=tcp")}))}),t}tryBindTransportEvents(e){let t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};let r=t.iceTransport;r&&(r.onstatechange=()=>{var e;let r=null==t?void 0:t.iceTransport.state;r&&(null===(e=this.onICETransportStateChange)||void 0===e||e.call(this,r))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:e,remote:t}=r.getSelectedCandidatePair();a6.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var r,i,n,o;if(!t&&(t=this.peerConnection.getSenders().find(t=>t.track===e._mediaStreamTrack)),!t)return a6.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return a6.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!si.supportSetRtpSenderParameters)return a6.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let a={},s={};switch(e._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;case"balanced":a.degradationPreference="balanced"}let c=(i=this.peerConnection,n=e._mediaStreamTrack,i.getTransceivers().find(e=>e.sender.track===n||e.receiver.track===n)),d=cA(e);if(o=e,!(!aP.ENABLE_AG_ADAPTATION||!(o instanceof cI||o._hints.includes(sE.CUSTOM_TRACK))||!aP.FORCE_SUPPORT_AG_ADAPTATION&&!(function(e){let t=nL();return t.os===nw.IOS&&!!t.osVersion&&Number(t.osVersion.split(".")[0])>=14}(14)&&function(e,t,r){let i=nL();if(i.os!==nw.IOS||!i.osVersion)return!1;let n=i.osVersion.split(".");return r?17===Number(n[0])&&Number(n[1])<t||Number(n[0])<e:t?Number(n[0])===e&&Number(n[1])<=t||Number(n[0])<e:Number(n[0])<=e}(17,4,!0)||nK(14)&&function(e,t,r){let i=nL();if(i.name!==nO.SAFARI||!i.osVersion||!i.browserVersion)return!1;let n=i.browserVersion.split(".");return r?17===Number(n[0])&&Number(n[1])<t||Number(n[0])<e:t?Number(n[0])===e&&Number(n[1])<=t||Number(n[0])<e:Number(n[0])<=e}(17,4,!0)))&&c&&t&&d&&this.getLocalVideoStats&&["vp8","vp9"].includes(this.store.codec)){let r=a.degradationPreference||(e._hints.includes(sE.CUSTOM_TRACK)?aP.CUSTOM_ADAPTATION_DEFAULT_MODE:"maintain-framerate");!function(e,t,r,i,n,o){if(la(e,r),n(t),"balanced"!==i&&"maintain-framerate"!==i&&"maintain-resolution"!==i)return;let a=-1;li(e,t);let s=window.setInterval(()=>{let s=lo.get(e);if(!aP.ENABLE_AG_ADAPTATION||!s)return la(e,r),void n(t);let c=o();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;let o=c.sendFrameRate,d=c.OutgoingAvailableBandwidth,[u,l]=function(e,t,r,i,n,o){let a,s;let c=lt.get(e)||{overUse:0,underUse:0,adaptationList:ln(n)},{adaptationList:d}=c;lt.set(e,c);let{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:l}=aw,{scale:h}=i;return"number"==typeof t&&t>0&&function(e,t,r,i){if(t>=r.length)return!1;let{threshold:{fps_down:n}}=r[t];return aP.FORCE_AG_HIGH_FRAMERATE&&"maintain-framerate"===i&&(n=r[0].threshold.fps_down),e<n}(t,h,d,o)&&(c.overUse++,s=af.CPU,c.overUse>u)||"number"==typeof r&&r>0&&function(e,t,r){if(t>=r.length)return!1;let{threshold:{bwe_down:i}}=r[t];return e<i}(r,h,d)&&(c.overUse++,s=af.BANDWIDTH,c.overUse>u)?(c.overUse=0,c.underUse=0,[a=lr(i,d,o,le.DOWN),s]):("number"==typeof t&&t>0&&"number"==typeof r&&r>0&&function(e,t,r,i){if(0===t)return;let{threshold:{fps_up:n}}=r[t];return aP.FORCE_AG_HIGH_FRAMERATE&&"maintain-framerate"===i&&(n=r[1].threshold.fps_up),e>n}(t,h,d,o)&&function(e,t,r){if(0===t)return;let{threshold:{bwe_up:i}}=r[t];return e>i}(r,h,d)&&(c.underUse++,c.underUse>l&&(c.overUse=0,c.underUse=0,0===(a=lr(i,d,o,le.UP)).scale&&(s=af.NONE))),[a,s])}(e,o,d,s.adaptationConfig,t,i);l&&(r.qualityLimitationReason=l),u&&s.adaptationConfig.scale!==u.scale&&(a6.debug("[".concat(e,"] applyAdaptation: ").concat(r.qualityLimitationReason,"\n           sendFps ").concat(o,", bwe ").concat(d,", switch from ").concat(s.adaptationConfig.scale," to ").concat(u.scale," ")),s.adaptationConfig=cz(cz({},s.adaptationConfig),u),n(u))}},aP.CHECK_LOCAL_STATS_INTERVAL),c=cz({},t);lo.set(e,{timer:s,adaptationConfig:c,originConfig:t,adaptationFunc:n}),a6.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(i))}(this.id+c.mid,d,this,r,e=>{t&&this.updateAdaptation(t,e)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){let{bitrateMax:t,frameRate:r,scaleResolutionDownBy:i}=e._encoderConfig;t&&(s.maxBitrate=1e3*t),(e._hints.includes(sE.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(r&&(s.maxFramerate=dq(r)),i&&i>=1&&(s.scaleResolutionDownBy=i))}let{maxFramerate:u}=aP.ENCODER_CONFIG_LIMIT;if(u&&"number"==typeof u&&(s.maxFramerate=s.maxFramerate?Math.min(s.maxFramerate,u):u),aP.DSCP_TYPE&&n0()){let e=aP.DSCP_TYPE;["very-low","low","medium","high"].includes(e)&&(s.networkPriority=e)}let l=t.getParameters(),h=null===(r=l.encodings)||void 0===r?void 0:r[0];nG()&&!h&&(a.encodings=[s]),h&&Object.assign(h,s),Object.assign(l,a),a6.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await t.setParameters(l),await async function(e,t,r){try{var i,n;if(!si.supportSetRtpSenderParameters)return;if(n=e,"vp9"!==n&&"av1"!==n||!aP.ENABLE_SVC)return;let o={},a=t.getParameters(),s=null===(i=a.encodings)||void 0===i?void 0:i[0];o.scalabilityMode=d6(r),s&&Object.assign(s,o),Object.assign(a,{}),await t.setParameters(a),a6.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(e){a6.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,aP.SVC_MODE)}async updateAdaptation(e,t){var r;if(!e)return a6.debug("[updateAdaptation] no rtpSender found");if(!si.supportSetRtpSenderParameters)return a6.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let i={},{bitrateMax:n,frameRate:o,scaleResolutionDownBy:a}=t;n&&(i.maxBitrate=1e3*n),o&&(i.maxFramerate=dq(o)),a&&a>=1&&["vp8","vp9"].includes(this.store.codec)&&(i.scaleResolutionDownBy=a);let s=e.getParameters(),c=null===(r=s.encodings)||void 0===r?void 0:r[0];c&&Object.assign(c,i),Object.assign(s,{});try{await e.setParameters(s),a6.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(s.encodings)))}catch(t){"transport"in e&&(!e.transport||"connected"!==e.transport.state)?a6.debug("[updateAdaptation] rtpSender transport not connected}"):"connected"!==this.peerConnectionState?a6.debug("[updateAdaptation] peerConnection not connected}"):a6.debug("[updateAdaptation] updateRtpSenderEncodings failed",t)}}async applySendEncodings(e,t){try{if(!si.supportSetRtpSenderParameters||e.length!==t.length)return;for(let r=0;r<e.length;r++){let i=e[r],n=t[r];n instanceof cR&&!this.isVP8Simulcast(n)&&await this.updateRtpSenderEncodings(n,i.sender)}}catch(e){a6.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,r){let i=aK(e);return t.forEach((e,t)=>{let n=r[t],o=i.mediaDescriptions.find(e=>e.attributes.mid===n);o&&(uo(o,e),function(e,t,r){if(nG()||"video"!==e.media.mediaType||!(t instanceof cR)||"vp9"!==r&&"vp8"!==r||"vp8"===r&&!aP.SIMULCAST||"vp9"===r&&aP.ENABLE_SVC||void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;let i="vp8"===r?2:t._scalabilityMode.numSpatialLayers,n=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(e=>"FID"===e.semantic&&e.ssrcIds[0]===n.ssrcId),a={semantic:"SIM",ssrcIds:[n.ssrcId]};for(let t=1;t<i;t++)e.attributes.ssrcs.push({ssrcId:n.ssrcId+t,attributes:oD(n.attributes)}),a.ssrcIds.push(n.ssrcId+t),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+t,attributes:oD(n.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[n.ssrcId+t,o.ssrcIds[1]+t]}));e.attributes.ssrcGroups.unshift(a)}(o,e,this.store.codec))}),aQ(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,r)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,e,t,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var r;null===(r=this.onSelectedLocalCandidateChanged)||void 0===r||r.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var r;null===(r=this.onSelectedRemoteCandidateChanged)||void 0===r||r.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var r,i,n,o;let s=e[a],c=t[a];if(c instanceof cR&&!c._hints.includes(sE.LOW_STREAM)&&null!==(r=c._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=c._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(n=c._scalabilityMode)&&void 0!==n&&n.numSpatialLayers&&(null===(o=c._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){let e={},t={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];let r=s.sender.getParameters();await s.sender.setParameters(Object.assign(r,e))}}}async applySimulcastEncodings(e,t){if(!nG()&&e.length===t.length)for(let r=0;r<e.length;r++){let i=t[r];if(i instanceof cR&&this.isVP8Simulcast(i)){let t=e[r],n={},o={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};n.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];let a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,n))}}}isVP8Simulcast(e){var t,r,i,n;return!!(e instanceof cR&&aP.SIMULCAST&&"vp8"===this.store.codec&&!e._hints.includes(sE.LOW_STREAM)&&null!==(t=e._encoderConfig)&&void 0!==t&&t.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(n=e._scalabilityMode)||void 0===n?void 0:n.numSpatialLayers)>1)}logSDPExchange(e,t,r,i){if(aP.SDP_LOGGING)return a6.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(t," SDP during P2PConnection.").concat(i,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===r?"remote":"local",i)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(si.supportPCSetConfiguration){let r=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}}).prototype,"updateRemoteRTPCapabilities",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"updateRemoteRTPCapabilities"),rl.prototype),cG(rl.prototype,"connect",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"connect"),rl.prototype),cG(rl.prototype,"updateRemoteConnect",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"updateRemoteConnect"),rl.prototype),cG(rl.prototype,"createDataChannels",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"createDataChannels"),rl.prototype),cG(rl.prototype,"receive",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"receive"),rl.prototype),cG(rl.prototype,"batchReceive",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"batchReceive"),rl.prototype),cG(rl.prototype,"stopReceiving",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"stopReceiving"),rl.prototype),cG(rl.prototype,"muteRemote",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"muteRemote"),rl.prototype),cG(rl.prototype,"unmuteRemote",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"unmuteRemote"),rl.prototype),cG(rl.prototype,"muteLocal",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"muteLocal"),rl.prototype),cG(rl.prototype,"unmuteLocal",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"unmuteLocal"),rl.prototype),cG(rl.prototype,"close",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"close"),rl.prototype),cG(rl.prototype,"updateEncoderConfig",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"updateEncoderConfig"),rl.prototype),cG(rl.prototype,"updateSendParameters",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"updateSendParameters"),rl.prototype),cG(rl.prototype,"replaceTrack",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"replaceTrack"),rl.prototype),cG(rl.prototype,"updateAdaptation",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"updateAdaptation"),rl.prototype),cG(rl.prototype,"getRemoteSSRC",[lf],Object.getOwnPropertyDescriptor(rl.prototype,"getRemoteSSRC"),rl.prototype),rl);function lf(e,t,r){let i=e[t];if("function"!=typeof i)throw Error("Cannot use mutex on object property.");return r.value=async function(){let e=this.mutex,r=await e.lock("From P2PConnection.".concat(t));try{for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return await i.apply(this,o)}finally{r()}},r}function l_(e,t){let r=document.createElement("video"),i=document.createElement("canvas");r.setAttribute("style","display:none"),i.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),i.width=dq(t.width),i.height=dq(t.height);let n=dq(t.framerate||15);document.body.append(r),document.body.append(i);let o=e._mediaStreamTrack;r.srcObject=new MediaStream([o]),r.play();let a=i.getContext("2d");if(!a)throw new sr(n8.UNEXPECTED_ERROR,"can not get canvas context");let s=i.captureStream(si.supportRequestFrame?0:n).getVideoTracks()[0];s.canvas||(s.canvas=i),i.startCapture=()=>{if(!r)return i.stopCapture&&i.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){let e=r.videoWidth,t=r.videoHeight/e,n=i.width*t;Math.abs(n-i.height)>=2&&(a6.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(n)),i.height=n)}a.drawImage(r,0,0,i.width,i.height),s.requestFrame&&s.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,r.srcObject=new MediaStream([o]))},i.stopCapture=sJ(()=>i.startCapture&&i.startCapture(),n);let c=s.stop;return s.stop=()=>{c.call(s),r&&(r.remove(),r.srcObject=null,r=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),a6.debug("clean low stream renderer")},s}var lA=((eV=lA||{})[eV.HEIGHT=2033]="HEIGHT",eV[eV.FRAME_RATE=2034]="FRAME_RATE",eV[eV.WIDTH=2035]="WIDTH",eV),lm=((eF=lm||{})[eF.FRAME_RATE=2002]="FRAME_RATE",eF[eF.WIDTH=2003]="WIDTH",eF[eF.HEIGHT=2004]="HEIGHT",eF[eF.PACKAGE_LOST=2005]="PACKAGE_LOST",eF[eF.AVG_ENCODE=2007]="AVG_ENCODE",eF[eF.NACKS=2009]="NACKS",eF[eF.PLIS=2010]="PLIS",eF[eF.FIRS=2011]="FIRS",eF[eF.BITRATE=2012]="BITRATE",eF[eF.PACKAGE_RATE=2031]="PACKAGE_RATE",eF[eF.ADAPTATION=2032]="ADAPTATION",eF[eF.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",eF[eF.BANDWIDTH=2061]="BANDWIDTH",eF[eF.RETRANSMIT=2062]="RETRANSMIT",eF[eF.TARGET_ENCODED=2064]="TARGET_ENCODED",eF[eF.TRANSMIT=2066]="TRANSMIT",eF[eF.FREEZE=2082]="FREEZE",eF[eF.DISABLED=2095]="DISABLED",eF[eF.PLAYER_STATUS=2128]="PLAYER_STATUS",eF[eF.QP_SUM=2143]="QP_SUM",eF[eF.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",eF[eF.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",eF[eF.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",eF[eF.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",eF),lv=((ej=lv||{})[ej.BITRATE=2069]="BITRATE",ej[ej.PACKAGE_LOST=2070]="PACKAGE_LOST",ej[ej.PACKAGE_RATE=2071]="PACKAGE_RATE",ej[ej.HEIGHT=2073]="HEIGHT",ej[ej.FRAME_RATE=2075]="FRAME_RATE",ej[ej.WIDTH=2077]="WIDTH",ej),lE=((eG=lE||{})[eG.JITTER=-1]="JITTER",eG[eG.PACKAGE_LOST=2014]="PACKAGE_LOST",eG[eG.WIDTH=2018]="WIDTH",eG[eG.HEIGHT=2019]="HEIGHT",eG[eG.FRAME_RATE=2020]="FRAME_RATE",eG[eG.JITTER_BUFFER=2023]="JITTER_BUFFER",eG[eG.CURRENT_DELAY=2024]="CURRENT_DELAY",eG[eG.NACKS=2026]="NACKS",eG[eG.PLIS=2027]="PLIS",eG[eG.FIRS=2028]="FIRS",eG[eG.BITRATE=2029]="BITRATE",eG[eG.PACKAGE_RATE=2078]="PACKAGE_RATE",eG[eG.FREEZE=2084]="FREEZE",eG[eG.DISABLED=2101]="DISABLED",eG[eG.PLAYER_STATUS=2129]="PLAYER_STATUS",eG[eG.QP_SUM=2144]="QP_SUM",eG[eG.I_FRAME_DELAY=2149]="I_FRAME_DELAY",eG[eG.FRAMES_DROPPED=2181]="FRAMES_DROPPED",eG[eG.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",eG[eG.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",eG[eG.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",eG[eG.AVG_DECODE=2200]="AVG_DECODE",eG[eG.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",eG[eG.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",eG[eG.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",eG[eG.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",eG),lg=((eW=lg||{})[eW.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",eW[eW.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",eW[eW.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",eW[eW.FREEZE_TIME=2109]="FREEZE_TIME",eW[eW.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",eW[eW.FREEZE_DURATION=2156]="FREEZE_DURATION",eW),lS=((eH=lS||{})[eH.PCM_LEVEL=2104]="PCM_LEVEL",eH),lb=((eY=lb||{})[eY.PACKAGE_LOST=-1]="PACKAGE_LOST",eY[eY.LEVEL=2038]="LEVEL",eY[eY.BITRATE=2039]="BITRATE",eY[eY.PACKAGE_RATE=2040]="PACKAGE_RATE",eY[eY.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",eY[eY.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",eY[eY.FREEZE=2081]="FREEZE",eY[eY.DISABLED=2096]="DISABLED",eY[eY.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",eY[eY.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",eY),lT=((eK=lT||{})[eK.BITRATE=2044]="BITRATE",eK[eK.PACKAGE_LOST=2045]="PACKAGE_LOST",eK[eK.PACKAGE_RATE=2046]="PACKAGE_RATE",eK[eK.CURRENT_DELAY=2047]="CURRENT_DELAY",eK[eK.JITTER_BUFFER=2054]="JITTER_BUFFER",eK[eK.JITTER=2055]="JITTER",eK[eK.FREEZE=2083]="FREEZE",eK[eK.DISABLED=2102]="DISABLED",eK[eK.PCM_LEVEL=2105]="PCM_LEVEL",eK[eK.PLAYER_STATUS=2130]="PLAYER_STATUS",eK[eK.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",eK[eK.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",eK[eK.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",eK[eK.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",eK[eK.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",eK[eK.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",eK),ly=((eQ=ly||{})[eQ.FREEZE_TIME=-1]="FREEZE_TIME",eQ[eQ.LEVEL=2043]="LEVEL",eQ),lR=((ez=lR||{})[ez.RTT=2006]="RTT",ez[ez.CONN_TYPE=801]="CONN_TYPE",ez[ez.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",ez),lI=((eX=lI||{})[eX.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",eX);function lC(e,t,r){null!=r&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function lk(e){let t={[lR.CONN_TYPE]:0,[lR.RTT]:e.rtt,[lR.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(t[lR.CONN_TYPE]=1),"tcp"===r&&(t[lR.CONN_TYPE]=3),"tls"===r&&(t[lR.CONN_TYPE]=4);break}case"srflx":t[lR.CONN_TYPE]=2;break;case"unknown":t[lR.CONN_TYPE]=5;break;default:t[lR.CONN_TYPE]=0}return t}function lw(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class lO extends op{constructor(e){super(),this.store=void 0,this.uploadWRTCStatsTimer=void 0,this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer=void 0,this.uploadExtUsageStatsTimer=void 0,this.uploadInboundExtStatsTimer=void 0,this.requestStats=void 0,this.requestTransportStats=void 0,this.requestLocalMedia=void 0,this.requestRemoteMedia=void 0,this.requestAllTracks=void 0,this.requestVideoIsReady=void 0,this.requestUploadStats=void 0,this.requestUpload=void 0,this.uploadOutboundStarted=!1,this.uploadInboundStarted=!1,this.uploadTransportStarted=!1,this.uploadBaseStatsStarted=!1,this.uploadExtensionUsageStarted=!1,this.lastRecvStats=void 0,this.lastSendStats=void 0,this.lastRefRecvStats=void 0,this.lastRefSendStats=void 0,this.lastFullRecvStats=void 0,this.lastFullSendStats=void 0,this.needUploadRenderFreezeTime=!0,this.store=e}uploadWRTCStats(e){let t,r;if(!this.requestStats||!this.requestUploadStats)return;let i=e%3==0,n=e%6==0;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),t||r){var o;let e={};if(this.uploadTransportStarted&&t){let n=this.getTransportStats(t,r,i);n&&(e.misc=[n])}if(this.uploadOutboundStarted&&t){let r=this.getOutboundStats(t,n?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,n);r&&(e.outbound=[r])}if(this.uploadInboundStarted&&r){let t=this.getInboundStats(r,n?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,n);t&&(e.inbound=t)}let a=null===(o=this.requestTransportStats)||void 0===o?void 0:o.call(this).connectState;a&&(Array.isArray(e.misc)?e.misc[0]&&e.misc[0].addition&&(e.misc[0].addition[lI.RTC_PEER_CONNECTION_STATE]=aA[a]):e.misc=[{addition:{[lI.RTC_PEER_CONNECTION_STATE]:aA[a]}}]),this.requestUploadStats(e)}this.lastRecvStats=r,this.lastSendStats=t,n&&(this.lastFullRecvStats=r,this.lastFullSendStats=t),i&&(this.lastRefRecvStats=r,this.lastRefSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,r;let e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(r=this.requestUploadStats)||void 0===r||r.call(this,{misc:[{addition:{[lI.RTC_PEER_CONNECTION_STATE]:aA[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),7==++e&&(e=1)},1e3)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,r){if(!this.requestStats)return;if(!r)return null==e.rtt?void 0:{addition:{[lR.RTT]:e.rtt,[lR.CONN_TYPE]:void 0,[lR.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};let i=lk(e);if(this.store.useP2P){if(t){let e=lk(t);i[lR.CONN_TYPE]+=e[lR.CONN_TYPE]<<3}i[lR.CONN_TYPE]+=110}else i[lR.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,t,r,i){let n,o,a;if(!this.requestUploadStats||!this.requestLocalMedia)return;let s=this.requestLocalMedia();if(s&&0!==s.length)return s.forEach(s=>{let[c,{track:d,ssrcs:u}]=s;switch(c){case db.LocalVideoLowTrack:case db.LocalVideoTrack:if(c===db.LocalVideoTrack){let n=function(e,t,r,i,n,o){let a=t.videoSend.find(t=>t.ssrc===e);if(!a)return;let s={},{sentFrame:c,inputFrame:d}=a;if(o&&(lC(s,lm.QP_SUM,a.qpSumPerFrame),d&&c)){var u,l;let e,t=d.frameRate,r=c.frameRate;u=t,l=r,e=!0,s[lm.FREEZE]=!(u<=5)&&(u<=10?l<3:u<=20?l<4:l<5)?1:0}if(n){switch(c&&(lC(s,lm.HEIGHT,c.height),lC(s,lm.WIDTH,c.width),lC(s,lm.FRAME_RATE,c.frameRate)),s[lm.DISABLED]=i._originMediaStreamTrack&&!i._originMediaStreamTrack.enabled||i._mediaStreamTrack&&!i._mediaStreamTrack.enabled?1:0,a.adaptionChangeReason){case"none":s[lm.ADAPTATION]=0;break;case"cpu":s[lm.ADAPTATION]=1;break;case"bandwidth":s[lm.ADAPTATION]=2;break;case"other":s[lm.ADAPTATION]=3}let o=0;a.adaptionChangeReason&&(o+=lw(a.adaptionChangeReason)),t.qualityLimitationReason&&(o+=lw(t.qualityLimitationReason)<<3),s[lm.ADAPTATION]=o,s[lm.PLAYER_STATUS]=sU[i._player?i._player.videoElementStatus:"uninit"],lC(s,lm.NACKS,a.nacksCount),lC(s,lm.PLIS,a.plisCount),lC(s,lm.FIRS,a.firsCount),lC(s,lm.AVG_ENCODE,a.avgEncodeMs),lC(s,lm.HUGE_FRAME_SENT,a.hugeFramesSent),lC(s,lm.BYTES_RETRANSMIT,a.retransmittedBytesSent),lC(s,lm.PACKAGES_RETRANSMIT,a.retransmittedPacketsSent),lC(s,lm.KEY_FRAMES_ENCODED,a.keyFramesEncoded);let d=r&&r.videoSend.find(t=>t.ssrc===e);if(d){let e=n?1e3:6e3;d.timestamp&&a.timestamp&&(e=a.timestamp-d.timestamp),null!=d.packets&&null!=a.packets&&lC(s,lm.PACKAGE_RATE,1e3*(a.packets-d.packets)/e),null!=a.packetsLost&&null!=d.packetsLost&&lC(s,lm.PACKAGE_LOST,a.packetsLost-d.packetsLost),null!=d.bytes&&null!=a.bytes&&lC(s,lm.BITRATE,8*(a.bytes-d.bytes)/e)}}return s}(u[0].ssrcId,e,t,d,r,i),a=d&&function(e,t,r,i){let n=t.videoSend.find(t=>t.ssrc===e);if(!n)return null;let o={};if(i){let e=n.inputFrame,t=e&&e.height||r.videoHeight||0,i=e&&e.width||r.videoWidth||0,a=e&&e.frameRate||0;lC(o,lA.HEIGHT,t),lC(o,lA.WIDTH,i),lC(o,lA.FRAME_RATE,a)}return o}(u[0].ssrcId,e,d,r);o=Object.assign({},n,a,function(e,t){let r={};return t&&(lC(r,lm.RETRANSMIT,e.bitrate.retransmit),lC(r,lm.TARGET_ENCODED,e.bitrate.targetEncoded),lC(r,lm.ACTUAL_ENCODED,e.bitrate.actualEncoded),lC(r,lm.TRANSMIT,e.bitrate.transmit),lC(r,lm.BANDWIDTH,e.sendBandwidth)),r}(e,r))}else a=function(e,t,r,i){let n=t.videoSend.find(t=>t.ssrc===e);if(!n)return;let o={};if(i){let t=n.sentFrame;if(t&&(lC(o,lv.HEIGHT,t.height),lC(o,lv.WIDTH,t.width),lC(o,lv.FRAME_RATE,t.frameRate)),r){let t=r.videoSend.find(t=>t.ssrc===e);if(t){let e=6e3;t.timestamp&&n.timestamp&&(e=n.timestamp-t.timestamp),null!=t.packets&&null!=n.packets&&lC(o,lv.PACKAGE_RATE,1e3*(n.packets-t.packets)/e),null!=n.packetsLost&&null!=t.packetsLost&&lC(o,lv.PACKAGE_LOST,n.packetsLost-t.packetsLost),null!=t.bytes&&null!=n.bytes&&lC(o,lv.BITRATE,8*(n.bytes-t.bytes)/e)}}}return o}(u[0].ssrcId,e,t,r);break;case db.LocalAudioTrack:n=d&&function(e,t,r,i,n){let o=t.audioSend.find(t=>t.ssrc===e);if(!o)return;let a={};if(n){a[lb.DISABLED]=i._originMediaStreamTrack&&!i._originMediaStreamTrack.enabled||i._mediaStreamTrack&&!i._mediaStreamTrack.enabled?1:0;let t=100*i._source.getAccurateVolumeLevel(),n=o.inputLevel;if(null!=n){let e=Math.ceil(50*Math.log10(100*n+1));lC(a,lb.LEVEL,e)}lC(a,lS.PCM_LEVEL,t),lC(a,lb.AEC_RETURN_LOSS,o.aecReturnLoss),lC(a,lb.AEC_RETURN_LOSS_ENH,o.aecReturnLossEnhancement),lC(a,lb.BYTES_RETRANSMIT,o.retransmittedBytesSent),lC(a,lb.PACKAGES_RETRANSMIT,o.retransmittedPacketsSent),a[lb.FREEZE]=0;let s=r&&r.audioSend.find(t=>t.ssrc===e);if(s){let e=6e3;s.timestamp&&o.timestamp&&(e=o.timestamp-s.timestamp),null!=s.bytes&&null!=o.bytes&&lC(a,lb.BITRATE,8*(o.bytes-s.bytes)/e),null!=s.packets&&null!=o.packets&&lC(a,lb.PACKAGE_RATE,1e3*(o.packets-s.packets)/e)}}return a}(u[0].ssrcId,e,t,d,r)}}),{high:o,low:a,audio:n}}getInboundStats(e,t,r,i){if(!this.requestRemoteMedia)return;let n=this.requestRemoteMedia()||[],o=[];return n.forEach(n=>{let[a,s]=n,c={peer:a.uid};if(s.has(dv.VIDEO)&&a.videoTrack){let n=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,o=a.videoTrack?function(e,t,r,i,n,o,a,s){let c=t.videoRecv.find(t=>t.ssrc===e);if(!c)return;let d={},{receivedFrame:u,outputFrame:l,decodeFrameRate:h}=c,p=r&&r.videoRecv.find(t=>t.ssrc===e);if(lC(d,lg.FRAME_RATE_DECODE,h),c.framesRateFirefox&&lC(d,lE.FRAME_RATE,c.framesRateFirefox),u&&lC(d,lE.FRAME_RATE,u.frameRate),lC(d,lE.FRAMES_DROPPED,c.framesDroppedCount),lC(d,lE.BYTES_RETRANSMIT,c.retransmittedBytesReceived),lC(d,lE.PACKAGES_RETRANSMIT,c.retransmittedPacketsReceived),lC(d,lE.PACKAGES_DISCARDED,c.packetsDiscarded),lC(d,lE.AVG_DECODE,c.avgDecodeMs),lC(d,lE.AVG_PROCESSING_DELAY,c.avgProcessingDelayMs),lC(d,lE.AVG_ASSEMBLY_TIME,c.avgFramesAssembledFromMultiplePacketsMs),lC(d,lE.AVG_INTER_FRAME_DELAY,c.avgInterFrameDelayMs),lC(d,lE.KEY_FRAMES_DECODED,c.keyFramesDecoded),p){let e=t.timestamp-r.timestamp||1e3*(s?6:a?3:1);null!=c.packetsLost&&null!=p.packetsLost&&lC(d,lE.PACKAGE_LOST,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&lC(d,lE.BITRATE,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&lC(d,lE.PACKAGE_RATE,1e3*(c.packets-p.packets)/e)}if(s&&(lC(d,lE.QP_SUM,c.qpSumPerFrame),d[lE.FREEZE]=n&&u3.isRemoteVideoFreeze(i,c,p)?1:0),a){var f;u?(lC(d,lE.HEIGHT,u.height),lC(d,lE.WIDTH,u.width)):i&&(lC(d,lE.HEIGHT,i._videoHeight||0),lC(d,lE.WIDTH,i._videoWidth||0)),l&&lC(d,lg.FRAME_RATE_OUTPUT,l.frameRate);let e=null===(f=i._player)||void 0===f?void 0:f.rendFrameRate.toFixed(0);if(e&&lC(d,lg.FRAME_RATE_RENDER,+e),lC(d,lE.JITTER_BUFFER,c.jitterBufferMs),lC(d,lE.CURRENT_DELAY,c.currentDelayMs),lC(d,lE.FIRS,c.firsCount),lC(d,lE.NACKS,c.nacksCount),lC(d,lE.PLIS,c.plisCount),i){d[lE.DISABLED]=i._originMediaStreamTrack.enabled&&i._mediaStreamTrack.enabled?0:1;let e=i._player;if(e){let{freezeTimeCounterList:t,renderFreezeAccTime:r,videoElementStatus:i}=e;if(t&&t.length>0&&lC(d,lg.FREEZE_TIME,t.splice(0,1)[0]),o&&"visible"===cP.visibility&&i===sM.PLAYING&&si.supportRequestVideoFrameCallback){let t=Math.min(6e3,r);e.renderFreezeAccTime=Math.max(0,r-t),lC(d,lg.FREEZE_TIME_RENDER,t)}if("number"==typeof c.totalFreezesDuration){let e=p&&p.totalFreezesDuration?c.totalFreezesDuration-p.totalFreezesDuration:c.totalFreezesDuration;lC(d,lg.FREEZE_DURATION,1e3*e)}}}if(d[lE.PLAYER_STATUS]=sU[i._player?i._player.videoElementStatus:"uninit"],p&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==p.totalInterFrameDelay&&void 0!==p.totalSquaredInterFrameDelay){let e=c.totalInterFrameDelay-p.totalInterFrameDelay,t=c.totalSquaredInterFrameDelay-p.totalSquaredInterFrameDelay,r=c.framesDecodeCount-p.framesDecodeCount,i=e/r*1e3,n=Math.round(1e3*Math.sqrt((t-Math.pow(e,2)/r)/r));!isNaN(n)&&i+n>Math.max(3*i,i+150)&&(d[lE.I_FRAME_DELAY]=n)}}return d}(a._videoSSRC,e,t,a.videoTrack,!0===n,this.needUploadRenderFreezeTime,r,i):void 0;o&&(c.video=o)}if(s.has(dv.AUDIO)&&a.audioTrack){let n=a.audioTrack?function(e,t,r,i,n,o){let a=t.audioRecv.find(t=>t.ssrc===e);if(!a)return;let s={},c=r&&r.audioRecv.find(t=>t.ssrc===e);if(lC(s,lT.JITTER,a.jitterMs),lC(s,lT.BYTES_RETRANSMIT,a.retransmittedBytesReceived),lC(s,lT.PACKAGES_RETRANSMIT,a.retransmittedPacketsReceived),lC(s,lT.PACKAGES_DISCARDED,a.packetsDiscarded),lC(s,lT.AVG_PROCESSING_DELAY,a.avgProcessingDelayMs),c){let e=t.timestamp-r.timestamp||1e3*(o?6:n?3:1);null!=a.packets&&null!=c.packets&&lC(s,lT.PACKAGE_RATE,1e3*(a.packets-c.packets)/e),n&&null!=c.bytes&&null!=a.bytes&&lC(s,lT.BITRATE,8*(a.bytes-c.bytes)/e),null!=a.packetsLost&&null!=c.packetsLost&&lC(s,lT.PACKAGE_LOST,a.packetsLost-c.packetsLost)}if(o){let{receivedFrames:e,droppedFrames:t}=a;null!=e&&null!=t&&(s[lT.FREEZE]=0===e||100*t/e>20?1:0)}if(n){let e=100*i._source.getAccurateVolumeLevel(),t=a.outputLevel;if(null!=t){let e=Math.ceil(50*Math.log10(100*t+1));lC(s,ly.LEVEL,e)}if(lC(s,lT.PCM_LEVEL,e),i&&(s[lT.DISABLED]=i._originMediaStreamTrack.enabled&&i._mediaStreamTrack.enabled?0:1),lC(s,lT.JITTER_BUFFER,a.jitterBufferMs),lC(s,lT.CURRENT_DELAY,a.jitterBufferMs),s[lT.PLAYER_STATUS]=sU[ca.getPlayerState(i.getTrackId())],c){let e=a.concealedSamples-c.concealedSamples;e>0&&lC(s,lT.CONCEALED_SAMPLES,e);let t=a.totalSamplesReceived-c.totalSamplesReceived;t>0&&lC(s,lT.TOTAL_SAMPLES_RECEIVED,t)}}return s}(a._audioSSRC,e,t,a.audioTrack,r,i):void 0;n&&(c.audio=n)}(c.video||c.audio)&&o.push(c)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find(e=>e instanceof cg);if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(c3.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach(e=>{let[t,r]=e;r.has(dv.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}),r.has(dv.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let t=Date.now(),r={connectionInterval:aP.EXTENSION_USAGE_UPLOAD_INTERVAL/1e3,details:[],lts:t},i=[];for(let e of this.requestAllTracks&&this.requestAllTracks()||[])!e.muted&&e.enabled&&(i=i.concat(await e.getProcessorUsage()));for(let[e,t]of this.requestRemoteMedia&&this.requestRemoteMedia()||[])t.has(dv.VIDEO)&&e.videoTrack&&(i=i.concat(await e.videoTrack.getProcessorUsage())),t.has(dv.AUDIO)&&e.audioTrack&&(i=i.concat(await e.audioTrack.getProcessorUsage()));if(0===i.length)return;r.details=function(e,t){let r={};for(let{id:a,value:s,level:c,direction:d}of e){var i,n,o;let e=null!==(i=t.get(a))&&void 0!==i?i:0,u=2===s?e+aP.EXTENSION_USAGE_UPLOAD_INTERVAL/1e3:e;t.set(a,u),r[a]?(2===s&&(r[a].value=s),c>r[a].level&&(r[a].level=c),"remote"===d&&(r[a].remoteUidCount+=1),r[a].totalTs=null!==(n=t.get(a))&&void 0!==n?n:0):r[a]={value:s,level:c,remoteUidCount:"local"===d?0:1,totalTs:null!==(o=t.get(a))&&void 0!==o?o:0}}return Object.keys(r).map(e=>{let{level:t,value:i,totalTs:n}=r[e];return{id:e,level:t,value:i,totalTs:n}})}(i,e);let n=Date.now(),o=n>t?n:t+1;this.requestUpload&&this.requestUpload(c3.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:o})},aP.EXTENSION_USAGE_UPLOAD_INTERVAL)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let lN=aP.ICE_RESTART_INTERVAL,lP=new Map,lD=new Map,lL=[dE.UDP_TCP_RELAY,dE.TCP_RELAY,dE.RELAY],lM=aP.JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE&&si.supportPCSetConfiguration;function lx(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=lP.get(e.id);r&&(window.clearTimeout(r),lP.delete(e.id));let i=lD.get(e.id);t&&i&&i.index===lL.length-1&&(a6.debug("[".concat(e.id,"] reset ICE restart policy")),lD.delete(e.id))}let lU=(cG((rh=class extends op{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(dy.StateChange,t,this._state)}constructor(e,t){super(),this.isPlanB=void 0,this.store=void 0,this.statsUploader=void 0,this.connection=void 0,this.localTrackMap=new Map,this.remoteUserMap=new Map,this.localDataChannels=[],this.remoteDataChannelMap=new Map,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.statsCollector=void 0,this.shouldForwardP2PCreation=void 0,this.iceFailedCount=0,this.dtlsFailedCount=0,this.mutex=void 0,this._state=dT.Disconnected,this._pcStatsUploadType=aP.NEW_ICE_RESTART?dg.FIRST_CONNECTION:dg.OLD_FIRST_CONNECTION,this._isStartRestartIce=!1,this._restartTimer=void 0,this._isTryConnecting=!1,this._iceError=null,this._forceTurn=!1,this._isWaitPcToRePub=!1,this.handleMuteLocalTrack=async(e,t,r)=>{let i=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==dT.Connected)return void r(new n5(n8.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let i=this.filterTobeMutedTracks(e);if(0===i.length)return void t();let n=i.find(e=>"videoLowTrack"===e[0]);n&&n[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(i.map(e=>{let[,{id:t}]=e;return t}));let o=this.createMuteMessage(i);await oI(this,dy.RequestMuteLocal,o),t()}catch(e){r(e)}finally{i()}},this.handleUnmuteLocalTrack=async(e,t,r)=>{let i=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==dT.Connected)return void r(new n5(n8.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let i=this.filterTobeUnmutedTracks(e);if(0===i.length)return void t();let n=i.find(e=>"videoLowTrack"===e[0]);if(n){let t=n[1];if(t.track._originMediaStreamTrack.stop(),!aP.DISABLE_DUAL_STREAM_USE_ENCODING&&si.supportDualStreamEncoding){let r=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r}else{let r=l_(e,ok(this,dy.RequestLowStreamParameter));t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r}await new Promise((e,r)=>{this.handleReplaceTrack(t.track,e,r,!0)})}await this.connection.unmuteLocal(i.map(e=>{let[,{id:t}]=e;return t}));let o=this.createUnmuteMessage(i);await oI(this,dy.RequestUnmuteLocal,o),t()}catch(e){r(e)}finally{i()}},this.handleUpdateVideoEncoder=async(e,t,r,i)=>{let n;i||(n=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let r=this.localTrackMap.get(db.LocalVideoTrack);if(!this.connection||!r||r.track!==e||this.state!==dT.Connected)return void t();let{id:i,track:n}=r;await this.connection.updateSendParameters(i,n),await this.connection.updateEncoderConfig(i,n),this.emit(dy.UpdateVideoEncoder,n),t()}catch(e){r(e)}finally{var o;null===(o=n)||void 0===o||o()}},this.handleUpdateVideoSendParameters=async(e,t,r)=>{let i=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let r=this.localTrackMap.get(db.LocalVideoTrack);if(!this.connection||!r||r.track!==e||this.state!==dT.Connected)return void t();let{id:i,track:n}=r;await this.connection.updateSendParameters(i,n),t()}catch(e){r(e)}finally{i()}},this.handleReplaceMixingTrack=async(e,t,r,i)=>{let n;if(!this.connection||this.state!==dT.Connected)return void t();let o=lc([e]);a6.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),"boolean"==typeof i&&i||(n=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,o),t()}catch(e){r(e)}finally{var a;null===(a=n)||void 0===a||a()}},this.handleReplaceTrack=async(e,t,r,i)=>{var n,o;let a;a6.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof i&&i||(a=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{let r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(!this.connection||!r||this.state!==dT.Connected)return void t();if(await (null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(e,r[1].id)),this.isPlanB){let t=r[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(r[0],t)}if(r[0]===db.LocalVideoTrack&&!aP.DISABLE_DUAL_STREAM_USE_ENCODING&&si.supportDualStreamEncoding){let t=this.localTrackMap.get(db.LocalVideoLowTrack);if(t){let r=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r,await new Promise((e,r)=>{this.handleReplaceTrack(t.track,e,r,!0)})}}t()}catch(e){r(e)}finally{null===(o=a)||void 0===o||o()}},this.handleGetRTCStats=e=>{e(this.statsCollector.getRTCStats())},this.handleGetLocalVideoStats=e=>{e(this.statsCollector.getLocalVideoTrackStats())},this.handleGetLocalAudioStats=e=>{e(this.statsCollector.getLocalAudioTrackStats())},this.handleGetRemoteVideoStats=e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid],this.handleGetRemoteAudioStats=e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid],this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new lO(this.store),this.bindStatsUploaderEvents(),this.mutex=new o0("P2PChannel-mutex",this.store.clientId),this.isPlanB=!si.supportUnifiedPlan||aP.CHROME_FORCE_PLAN_B&&n0(),this.shouldForwardP2PCreation=aP.FORWARD_P2P_CREATION&&si.supportPCSetConfiguration&&n$(),this.shouldForwardP2PCreation&&(this.connection=lu(this.store),this.emit(dy.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=dT.New,this._forceTurn=lh(e),a6.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let r=this.shouldForwardP2PCreation&&"closed"===(null===(t=this.connection)||void 0===t?void 0:t.peerConnectionState);if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(a6.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=lu(this.store,e),this.emit(dy.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new n5(n8.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=aP.NEW_ICE_RESTART?dg.FIRST_CONNECTION:dg.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new n5(n8.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");aP.ENABLE_PREALLOC_PC&&this.state===dT.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=dT.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return[db.LocalVideoLowTrack,db.LocalVideoTrack].includes(t)}),r=t.map(e=>{let[,{id:t}]=e;return t}),i=t.map(e=>{let[t]=e;return t});if(this.connection instanceof lp){if(st.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!e.includes(this.store.codec)){let t=["vp9","vp8","h264"].find(t=>e.includes(t));t&&(this.store.codec=t,a6.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){if(this.connection instanceof lp&&"closed"!==this.connection.peerConnectionState&&[dT.New,dT.Connected].includes(this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==dT.Connected){if(this.state===dT.Disconnected)throw new n5(n8.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(e=>{this.pendingLocalDataChannels.includes(e)||this.pendingLocalDataChannels.push(e)}),[]}let t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach(e=>{let t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(e=>{this.localDataChannels.push(e);let t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)}),e.map(e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId})))}publish(e,t,r){var i=this;return cX(function*(){let n=yield cK(i.mutex.lock("From P2PChannel.publish"));try{let n=i.connection&&["disconnected","failed"].includes(i.connection.peerConnectionState);if(!i.connection||i.state!==dT.Connected||n){if(i.state===dT.Disconnected)throw new n5(n8.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);let t=e.filter(e=>-1===i.pendingLocalTracks.indexOf(e));return i.pendingLocalTracks=i.pendingLocalTracks.concat(t),void(n&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,u6.markPublishStart(i.store.clientId,i.store.pubId);let o=i.filterTobePublishedTracks(e,t,r);if(0===o.length)return void(yield cK(i.tryToUnmuteAudio(e)));yield*cW(cH(i.doPublish(i.connection,o)))}finally{n()}})()}doPublish(e,t){var r=this;return cX(function*(){let i;t.forEach(e=>{let{track:t,type:i}=e,n=Date.now();r.store.publish(t.getTrackId(),i===db.LocalAudioTrack?"audio":"video",n)}),r.bindLocalTrackEvents(t);let n=t.map(e=>{let{track:t}=e;return t}),o=yield cK(e.send(n,r.store.codec,r.store.audioCodec)),a=(yield cK(o.next())).value,s=r.createGatewayPublishMessage(t,a);try{i=yield s}catch(e){throw o.throw(e),(null==e?void 0:e.code)===n8.WS_ABORT&&t.forEach(e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)}),r.unbindLocalTrackEvents(t),e}let c=r.mapPubResToRemoteConfig(s,i,n),d=(yield cK(o.next(c))).value;if(r.state===dT.Disconnected)throw new n5(n8.UNEXPECTED_ERROR,"PeerConnection already disconnected.");aP.ENABLE_VIDEO_SEI;let u=aP.ENABLE_ENCODED_TRANSFORM,l=aP.ENABLE_AUDIO_METADATA;n.forEach(async e=>{let t=e.getRTCRtpTransceiver();if(!t||!u)return;let{interceptLocalVideoFrame:r,interceptLocalAudioFrame:i}=uS();e.trackMediaType===dv.VIDEO?await r(t.sender,e):e.trackMediaType===dv.AUDIO&&await i(t.sender,{metadata:l?()=>{let t=e.metadata.shift();return t&&t.value}:void 0})}),t.forEach(e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)}),r.assignLocalTracks(t,d),r.statsUploader.startUploadOutboundStats(),t.forEach(e=>{let{track:t,type:i}=e,n=Date.now();r.store.publish(t.getTrackId(),i===db.LocalAudioTrack?"audio":"video",void 0,n)})})()}async updateVideoStreamParameter(e,t){let r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof cR))return a6.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:i}=r,n=function(e,t){let r={};return e.height&&e.width&&(r.scaleResolutionDownBy=d1(e,t)),r.maxFramerate=e.framerate?dq(e.framerate):void 0,r.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,r}(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==db.LocalVideoLowTrack||!aP.DISABLE_DUAL_STREAM_USE_ENCODING&&si.supportDualStreamEncoding)null!=n.scaleResolutionDownBy&&(i._encoderConfig.scaleResolutionDownBy=n.scaleResolutionDownBy);else{let t=i._originMediaStreamTrack;if(!t.canvas)return a6.warn("[".concat(i.getTrackId(),"] no canvas on track"));!function(e,t){let r=e.canvas;t.width&&(r.width=dq(t.width)),t.height&&(r.height=dq(t.height)),t.framerate&&(r.stopCapture&&r.stopCapture(),r.stopCapture=sJ(()=>{!r.startCapture&&r.stopCapture&&r.stopCapture(),r.startCapture&&r.startCapture()},dq(t.framerate)))}(t,e)}null!=n.maxBitrate&&(i._encoderConfig.bitrateMax=n.maxBitrate/1e3),null!=n.maxFramerate&&(i._encoderConfig.frameRate&&"object"==typeof i._encoderConfig.frameRate?i._encoderConfig.frameRate.max=n.maxFramerate:i._encoderConfig.frameRate={max:n.maxFramerate}),a6.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return cX(function*(){if(!t.connection||t.state!==dT.Connected)return;let r=yield cK(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let r=t.localTrackMap.get(db.LocalVideoTrack);if(!r)throw new n5(n8.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(db.LocalVideoLowTrack))throw new n5(n8.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let n=[{track:t.getLowVideoTrack(r.track,e),type:db.LocalVideoLowTrack}];if(yield*cW(cH(t.doPublish(t.connection,n))),r.track.muted||!r.track.enabled){var i;let e=null===(i=t.localTrackMap.get(db.LocalVideoLowTrack))||void 0===i?void 0:i.id;void 0!==e&&(yield cK(t.connection.muteLocal([e])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(a6.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await oR(this,dy.RequestRePublish,this.pendingLocalTracks),this.emit(dy.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(a6.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await oR(this,dy.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){let{user:t,kind:r}=this.pendingRemoteTracks[e];(r!==dv.AUDIO||t._audio_added_&&t._audioSSRC)&&(r!==dv.VIDEO||t._video_added_&&t._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(e)await oR(this,dy.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:e,kind:t}of this.pendingRemoteTracks)await this.subscribe(e,t,t===dv.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(dy.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==dT.Connected)return void e.forEach(e=>{let t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)});let t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;let r=t.find(e=>"videoLowTrack"===e[0]);return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==dT.Connected)return void e.forEach(e=>{let t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)});let t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach(e=>{let t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)}),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map(e=>e.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==dT.Connected)return;let e=this.localTrackMap.get(db.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[db.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:r}]=e;return{type:t,track:r}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==dT.Connected)throw new n5(n8.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r=t.filter(t=>{var r;return!(null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.get(t.id))});if(0!==r.length)return await this.connection.createDataChannels(e.uid,r),r.forEach(t=>{var r;this.remoteDataChannelMap.has(e)?null===(r=this.remoteDataChannelMap.get(e))||void 0===r||r.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));let i=this.pendingRemoteDataChannels.findIndex(r=>{let{user:i,id:n}=r;return i.uid===e.uid&&n===t.id});-1!==i&&this.pendingRemoteDataChannels.splice(i,1)}),r.map(e=>e.id)}async subscribe(e,t,r,i,n){var o;let a,s,c;if(!this.connection||this.state!==dT.Connected)throw new n5(n8.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let d=this.connection.getPreMedia(r);if(d)a6.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),c=d.transceiver,a=d.track,s=d.id;else if(n){let r=n.find(e=>{let{stream_type:r}=e;return r===t});if(!r)throw new n5(n8.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let i=await this.connection.receive(t,r.ssrcs,String(e._uintid),r.attributes);this.connection instanceof lp&&(c=i.transceiver),a=i.track,s=i.id}else{let n=await this.connection.receive(t,[{ssrcId:r,rtx:i}],String(e._uintid),void 0);this.connection instanceof lp&&(c=n.transceiver),a=n.track,s=n.id}if(t===dv.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new cN(a,e.uid,e._uintid,this.store),a6.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new cO(a,e.uid,e._uintid,this.store),a6.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&aP.ENABLE_ENCODED_TRANSFORM){let{interceptRemoteVideoFrame:r,interceptRemoteAudioFrame:i}=uS();t==dv.VIDEO?await r(c.receiver,{onSei:aP.ENABLE_VIDEO_SEI&&(t=>{var r;return null===(r=e._videoTrack)||void 0===r?void 0:r._onSei(t)})}):t==dv.AUDIO&&await i(c.receiver,{enableTopn:!!aP.ENABLE_AUDIO_TOPN,enableMetadata:!!aP.ENABLE_AUDIO_METADATA,onMetadata:e=>{this.safeEmit(dy.AudioMetadata,e)}})}let u=this.remoteUserMap.get(e);u?u.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let l=this.pendingRemoteTracks.findIndex(r=>{let{user:i,kind:n}=r;return i.uid===e.uid&&t===n});-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(dy.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==dT.Connected)throw new n5(n8.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(e=>{var t;let{user:r,mediaType:i}=e;return!(null!==(t=this.remoteUserMap.get(r))&&void 0!==t&&t.has(i))});let t=[],r=new Map;e.forEach(e=>{if(!this.connection)return;let i=this.connection.getPreMedia(e.ssrcId);i?r.set(e.ssrcId,i):t.push(e)});let i=await this.connection.batchReceive(t.map(e=>{let{user:t,mediaType:r,ssrcId:i,rtxSsrcId:n}=e;return{kind:r,ssrcMsg:[{ssrcId:i,rtx:n}],mslabel:String(t._uintid)}}));for(let{user:n,mediaType:o,ssrcId:a}of(t.forEach((e,t)=>{r.set(e.ssrcId,i[t])}),e)){let e=r.get(a);if(!e)return void a6.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(n.uid," subscribe data,").concat(o,", ").concat(a));let{track:t,id:i,transceiver:s}=e;if(s&&aP.ENABLE_ENCODED_TRANSFORM){let{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=uS();o==dv.VIDEO?await e(s.receiver,{onSei:aP.ENABLE_VIDEO_SEI&&(e=>{var t;return null===(t=n._videoTrack)||void 0===t?void 0:t._onSei(e)})}):o==dv.AUDIO&&await t(s.receiver,{enableTopn:!!aP.ENABLE_AUDIO_TOPN,enableMetadata:!!aP.ENABLE_AUDIO_METADATA,onMetadata:e=>{this.safeEmit(dy.AudioMetadata,e)}})}if(o===dv.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(t):(n._audioTrack=new cN(t,n.uid,n._uintid,this.store),a6.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),s&&n._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(t):(n._videoTrack=new cO(t,n.uid,n._uintid,this.store),a6.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),s&&n._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(n,n._videoTrack)),aP.ENABLE_VIDEO_SEI&&s){let{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=uS();o==dv.VIDEO?await e(s.receiver,{onSei:e=>{var t;null===(t=n._videoTrack)||void 0===t||t._onSei(e)}}):o==dv.AUDIO&&await t(s.receiver)}let c=this.remoteUserMap.get(n);c?c.set(o,i):this.remoteUserMap.set(n,new Map([[o,i]])),this.statsCollector.addRemoteStats(n.uid),this.statsUploader.startUploadInboundStats();let d=this.pendingRemoteTracks.findIndex(e=>{let{user:t,kind:r}=e;return t.uid===n.uid&&o===r});-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(dy.MediaReconnectEnd,n.uid))}}async unsubscribe(e,t,r){let i=this.pendingRemoteTracks.filter(r=>{let{user:i,kind:n}=r;return void 0!==t?i.uid===e.uid&&t===n:i.uid===e.uid});if(i.forEach(e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.connection&&this.state===dT.Connected||r||i.forEach(t=>{var r,i;let{kind:n}=t;n===dv.AUDIO?(null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0):n===dv.VIDEO&&(null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0)}),!this.connection||this.state!==dT.Connected)return;let n=this.filterTobeUnSubscribedTracks(e,t);if(0===n.length)return;await this.connection.stopReceiving(n.map(e=>{let[,{id:t}]=e;return t}));let o=this.createUnsubscribeMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach(e=>{var t,i,n;let[o,{kind:a}]=e;a===dv.VIDEO&&o._videoSSRC&&(null===(t=this.connection)||void 0===t||t.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===dv.VIDEO?(this.unbindRemoteTrackEvents(o._videoTrack),r||(null===(i=o._videoTrack)||void 0===i||i._destroy(),o._videoTrack=void 0)):a===dv.AUDIO&&(this.unbindRemoteTrackEvents(o._audioTrack),!r&&(null===(n=o._audioTrack)||void 0===n||n._destroy(),o._audioTrack=void 0))}),o}async unsubscribeDataChannel(e,t){if(t.forEach(e=>{let t=this.pendingRemoteDataChannels.findIndex(t=>t.id===e.id);-1!==t&&this.pendingRemoteDataChannels.splice(t,1)}),!this.connection)return;let r=this.filterTobeUnSubscribedDataChannels(e,t);if(0===r.length)return;t.forEach(e=>{e._close()});let i=this.remoteDataChannelMap.get(e);return r.forEach(e=>{i&&i.delete(e.id)}),i&&0===i.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(e=>e.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:r,mediaType:i}of e){let e=this.pendingRemoteTracks.filter(e=>{let{user:t,kind:n}=e;return void 0!==i?t.uid===r.uid&&i===n:t.uid===r.uid});e.forEach(e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),t=t.concat(e)}if(!this.connection||this.state!==dT.Connected)return void t.forEach(e=>{var t,r;let{user:i,kind:n}=e;n===dv.AUDIO?(null===(t=i._audioTrack)||void 0===t||t._destroy(),i._audioTrack=void 0):n===dv.VIDEO&&(null===(r=i._videoTrack)||void 0===r||r._destroy(),i._videoTrack=void 0)});let r=e.reduce((e,t)=>{let{user:r,mediaType:i}=t,n=this.filterTobeUnSubscribedTracks(r,i);return e.concat(n)},[]);if(0===r.length)return;await this.connection.stopReceiving(r.map(e=>{let[,{id:t}]=e;return t}));let i=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),r.forEach(e=>{var t,r,i;let[n,{kind:o}]=e;o===dv.VIDEO&&n._videoSSRC&&(null===(t=this.connection)||void 0===t||t.setStatsRemoteVideoIsReady(n._videoSSRC,!1)),o===dv.VIDEO?(this.unbindRemoteTrackEvents(n._videoTrack),null===(r=n._videoTrack)||void 0===r||r._destroy(),n._videoTrack=void 0):o===dv.AUDIO&&(this.unbindRemoteTrackEvents(n._audioTrack),null===(i=n._audioTrack)||void 0===i||i._destroy(),n._audioTrack=void 0)}),i}isPreSubScribe(e){return!!this.connection&&this.state===dT.Connected&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void a6.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void a6.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let i=t===dv.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==i&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void a6.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||a6.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(db.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(db.LocalAudioTrack);if((null==t?void 0:t.track)instanceof cS){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==db.LocalAudioTrack}).filter(t=>{let[r]=t;return!(e&&r===db.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[r]=t;return!(e&&r===db.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,i,n){if(e){let r=this.localTrackMap.get(db.LocalAudioTrack),o=i?this.localTrackMap.get(db.LocalVideoLowTrack):this.localTrackMap.get(db.LocalVideoTrack);st.publish(this.store.sessionId,{eventElapse:u6.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==r?void 0:r.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(sE.SCREEN_TRACK)),audio:!!r,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}else{var o;r||(r=[]);let a=r.find(e=>e instanceof cE),s=i?null===(o=this.localTrackMap.get(db.LocalVideoTrack))||void 0===o?void 0:o.track:r.find(e=>e instanceof cR);st.publish(this.store.sessionId,{eventElapse:u6.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(sE.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:n})}}reportSubscribeEvent(e,t,r,i){let n=i===dv.VIDEO?r._videoSSRC:r._audioSSRC;n&&st.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===dv.VIDEO,audio:i===dv.AUDIO,peerid:r.uid,subscribeRequestid:n,p2pid:this.store.p2pId,eventElapse:u6.measureFromSubscribeStart(this.store.clientId,n),preSsrc:this.isPreSubScribe(n)})}reset(){a6.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new o0("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=lu(this.store),this.emit(dy.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(db.LocalAudioTrack);if((null==e?void 0:e.track)instanceof cS){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=dT.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(db.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(db.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof cR||t&&t.track instanceof cE?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){let t=Array.from(this.remoteUserMap.keys()).find(t=>t.uid===e);return t?{audioTrack:t.audioTrack,audioSSRC:t._audioSSRC,videoTrack:t.videoTrack,videoSSRC:t._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(db.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=e.sort((e,t)=>e.level-t.level)}async disconnectForReconnect(){this.connection&&(a6.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=dT.Reconnecting,aP.KEEP_LAST_FRAME&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{var t;let[r]=e;r._videoTrack&&r._videoTrack._player&&(null===(t=r._videoTrack._player.getVideoElement())||void 0===t||t.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=lu(this.store),this.emit(dy.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;switch(t){case db.LocalVideoTrack:r._hints.includes(sE.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case db.LocalAudioTrack:r instanceof cS?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case db.LocalVideoLowTrack:}}),this.emit(dy.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(r.keys()).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(dy.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(r.keys()).forEach(e=>{this.setPendingRemoteDataChannel(t,e)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),a6.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let r of this.pendingRemoteDataChannels){let{user:i,id:n}=r;if((e instanceof u9?e.uid:e)===i.uid&&n===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:i,kind:n}=r;if((e instanceof u9?e.uid:e)===i.uid&&t===n)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return cX(function*(){let r;if(!t.connection||t.state!==dT.Connected)return;let i=yield cK(t.mutex.lock("From P2PChannel.restartICE"));try{r=yield cK(t.connection.restartICE(e));let i=yield cK(r.next());if(i.done)return;let n=i.value,o=yield n;switch(ll(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case dE.UDP_TCP_RELAY:t._pcStatsUploadType=dg.UDP_TCP_RESTART;break;case dE.TCP_RELAY:t._pcStatsUploadType=dg.TCP_RESTART;break;case dE.RELAY:t._pcStatsUploadType=dg.RELAY_RESTART;break;default:t._pcStatsUploadType=dg.OLD_RESTART}t._isTryConnecting=!0,r.next(o)}catch(e){var n;null===(n=r)||void 0===n||n.throw(e)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(db.LocalVideoTrack),r=this.localTrackMap.get(db.LocalAudioTrack),i=e.videoSend.find(e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)),n=e.audioSend.find(e=>e.ssrc===(null==r?void 0:r.ssrcs[0].ssrcId));if(!i||!n)return 1;let o=oC(this,dy.NeedSignalRTT),a=i?i.rttMs:void 0,s=n?n.rttMs:void 0,c=a&&s?(a+s)/2:a||s,d=100*e.sendPacketLossRate*.7/50+.3*((c&&o?(c+o)/2:c||o)||0)/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,l=null==t?void 0:t.track;if(l&&l._encoderConfig&&-1===l._hints.indexOf(sE.SCREEN_TRACK)){let t=l._encoderConfig.bitrateMax,r=e.bitrate.actualEncoded;if(t&&r){let e=(1e3*t-r)/(1e3*t);return cx[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r,n=i._audioSSRC,o=i._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===n),s=e.videoRecv.find(e=>e.ssrc===o);if(!a&&!s)return void(t+=1);let c=oC(this,dy.NeedSignalRTT),d=e.rtt,u=(d&&c?(d+c)/2:d||c)||0,l=a?a.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*u/1500;l&&(p=.6*h*100/50+.2*u/1500+.2*l/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Promise((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(a6.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==dT.Connected)return;let i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(!i)return;let n=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:n}]),this.bindLocalTrackEvents([{track:t,type:n}]),i[1].track=t),await (null===(r=this.connection)||void 0===r?void 0:r.replaceTrack(t,i[1].id)),this.isPlanB){let e=i[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(n,e)}if(n===db.LocalVideoTrack&&!aP.DISABLE_DUAL_STREAM_USE_ENCODING&&si.supportDualStreamEncoding){let t=this.localTrackMap.get(db.LocalVideoLowTrack);if(t){let r=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=r,t.track._originMediaStreamTrack=r,await new Promise((e,r)=>{this.handleReplaceTrack(t.track,e,r,!0)})}}}filterTobePublishedTracks(e,t,r){let i=[],n=this.getAllTracks();e=oN(e=e.filter(e=>-1===n.indexOf(e)));let o,a=!1,s=this.localTrackMap.get(db.LocalAudioTrack);for(let n of e){if(n instanceof cR&&(this.localTrackMap.has(db.LocalVideoTrack)||a?new n5(n8.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:n,type:db.LocalVideoTrack}),a=!0),t)){let e=this.getLowVideoTrack(n,r);i.push({track:e,type:db.LocalVideoLowTrack})}if(n instanceof cE){if(s){let e=s.track;if(e instanceof cS)ls([n]),e.addAudioTrack(n),this.bindLocalAudioTrackEvents(n,!0);else{let t=lc([e,n]);a6.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else o instanceof cS?(ls([n]),o.addAudioTrack(n)):o=o||!n._useAudioElement&&si.webAudioMediaStreamDest&&!n._bypassWebAudio?lc(o?[n,o]:[n]):n}}return o&&(a6.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),i.push({track:o,type:db.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();for(let i of e=oN(e=e.filter(e=>-1!==r.indexOf(e)))){if(i instanceof cE){let e=this.localTrackMap.get(db.LocalAudioTrack);if(!e)continue;e.track instanceof cS?(e.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),0===e.track.trackList.length&&(t.push([db.LocalAudioTrack,e]),e.track.close())):t.push([db.LocalAudioTrack,e])}if(i instanceof cR){let e=this.localTrackMap.get(db.LocalVideoTrack);if(!e)continue;t.push([db.LocalVideoTrack,e]);let r=this.localTrackMap.get(db.LocalVideoLowTrack);r&&t.push([db.LocalVideoLowTrack,r])}}return t}filterTobePublishedDataChannels(e){return e=(e=oN(e)).filter(e=>-1===this.localDataChannels.findIndex(t=>t.id===e.id))}filterTobeUnpublishedDataChannels(e){return e=(e=(e=oN(e)).filter(e=>-1!==this.localDataChannels.indexOf(e))).filter(e=>e._originDataChannel)}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:r}=e;switch(r){case db.LocalVideoTrack:t.addListener(sv.GET_STATS,this.handleGetLocalVideoStats),t.addListener(sv.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(sv.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(sv.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(sv.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(sv.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(sv.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(sv.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(sv.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case db.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case db.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof cS?e.trackList.forEach(e=>{e.addListener(sv.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(sv.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(sv.GET_STATS,this.handleGetLocalAudioStats),e.addListener(sv.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(sv.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(sv.GET_STATS,this.handleGetLocalAudioStats),e.addListener(sv.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(sv.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(sv.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(sv.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(sv.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(sv.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:r}]=e;return{track:r,type:t}})),e.forEach(e=>{let{track:t,type:r}=e;switch(r){case db.LocalVideoTrack:t.off(sv.GET_STATS,this.handleGetLocalVideoStats),t.off(sv.GET_RTC_STATS,this.handleGetRTCStats),t.off(sv.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(sv.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(sv.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(sv.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(sv.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(sv.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(sv.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case db.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case db.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof cS?e.trackList.forEach(e=>{e.off(sv.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(sv.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(sv.GET_STATS,this.handleGetLocalAudioStats),e.off(sv.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(sv.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(sv.GET_STATS,this.handleGetLocalAudioStats),e.off(sv.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(sv.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(sv.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(sv.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(sv.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(sv.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof cO&&t.addListener(sv.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof cN&&t.addListener(sv.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(sv.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(dv.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(dv.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,r)=>{let i,n,{track:o,type:a}=e;switch(a){case db.LocalAudioTrack:i=da.Audio,n={dtx:o instanceof cg&&o._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case db.LocalVideoTrack:i=o._hints.includes(sE.SCREEN_TRACK)?da.Screen:da.High,n=cz(cz({},dZ(o)),{},{codec:this.store.codec,svc_mode:d6()});break;case db.LocalVideoLowTrack:i=da.Low,n=cz(cz({},dZ(o)),{},{codec:this.store.codec,svc_mode:d6()})}return{stream_type:i,attributes:n,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(e=>{let t,[r,{track:i,ssrcs:n,id:o}]=e;switch(r){case db.LocalVideoTrack:t=i._hints.includes(sE.SCREEN_TRACK)?da.Screen:da.High;break;case db.LocalAudioTrack:t=da.Audio;break;case db.LocalVideoLowTrack:t=da.Low}return{stream_type:t,ssrcs:n,mid:o}})}assignLocalTracks(e,t){e.forEach((e,r)=>{let{track:i,type:n}=e;this.localTrackMap.set(n,{track:i,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(a6.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(dy.PeerConnectionStateChange,t),"connecting"===t&&e instanceof lp&&!nG()&&aP.FIRST_TCP_CANDIDATE&&window.setTimeout(()=>{"connecting"===t&&e.extendCandidate()},aP.FIRST_TCP_CANDIDATE_INTERVAL),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof lp&&lx(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=dg.DISCONNECTED_OR_FAILED,"CONNECTED"===oC(this,dy.QueryClientConnectionState)&&this._isWaitPcToRePub)){let e=this.pendingLocalTracks.map(e=>e.getTrackId()),t=this.pendingLocalDataChannels.map(e=>"dc_".concat(e.id));st.reportApiInvoke(this.store.sessionId,{name:oA.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:om.TRACER}).onSuccess(),this.republish()}if(aP.NEW_ICE_RESTART&&e instanceof lp&&!nG()&&!this._forceTurn){if(dS.includes(t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let t=t=>{ll(e)&&(a6.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===oC(this,dy.QueryClientConnectionState)&&this.emit(dy.RequestRestartICE,t))},r=()=>{ll(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),a6.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(dy.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{(function e(t,r,i){if(0===lP.size&&0===lD.size&&(Array.isArray(aP.RESTART_SEQUENCE)&&aP.RESTART_SEQUENCE.length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1){let i=e[r];if(e.filter(e=>e===i).length!==t.filter(e=>e===i).length)return!1}return!0}(lL,aP.RESTART_SEQUENCE)&&(lL=aP.RESTART_SEQUENCE.filter(e=>{if(Object.values(dE).includes(e))return!0}),a6.debug("use reconnection policy from config distribution, queues: ".concat(lL.join(" => ")))),lM=aP.JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE&&si.supportPCSetConfiguration),0===lL.length)return void i();let n,{index:o=0,type:a}=lD.get(t.id)||{};if(lM&&a===dE.RELAY)return void i();let s=a&&o>=lL.length-1;if(lM)a=dE.RELAY;else{if(s)return void i();a?a=lL[++o]:(a=lL[0],o=0)}a6.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(a,", index: ").concat(o)),r(a),lD.set(t.id,{index:o,type:a}),n=window.setTimeout(()=>e(t,r,i),lN),lP.set(t.id,n)})(e,t,r)},800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout(()=>{"disconnected"===e.iceConnectionState&&aP.ICE_RESTART&&"CONNECTED"===oC(this,dy.QueryClientConnectionState)&&this.emit(dy.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===e.peerConnectionState&&(a6.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(dy.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);"failed"===t&&(a6.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(dy.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),a6.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),st.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:om.TRACER}).onSuccess(),this.emit(dy.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{a6.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{a6.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{a6.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;let r=Array.from(this.remoteUserMap.keys()).find(t=>t._audioSSRC===e);r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),null===(t=r.audioTrack)||void 0===t||t.emit(sT.FIRST_FRAME_DECODED),st.firstRemoteFrame(this.store.sessionId,a5.FIRST_AUDIO_DECODE,a9.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:u6.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{let t=Array.from(this.remoteUserMap.keys()).find(t=>t._audioSSRC===e);t&&st.firstRemoteFrame(this.store.sessionId,a5.FIRST_AUDIO_RECEIVED,a9.FIRST_AUDIO_RECEIVED,{peer:t._uintid,subscribeElapse:u6.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,r)=>{this.reportVideoFirstFrameDecoded(e,t,r)},e.onFirstVideoReceived=e=>{let t=Array.from(this.remoteUserMap.keys()).find(t=>t._videoSSRC===e);t&&st.firstRemoteFrame(this.store.sessionId,a5.FIRST_VIDEO_RECEIVED,a9.FIRST_VIDEO_RECEIVED,{peer:t._uintid,subscribeElapse:u6.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{let r="relay"===e.candidateType,i="relay"===t.candidateType;"unknown"!==t.candidateType&&r===i||this.emit(dy.ConnectionTypeChange,r),a6.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(d4(t))," -> ").concat(JSON.stringify(d4(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{a6.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(d4(t))," -> ").concat(JSON.stringify(d4(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return cz(cz({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){var t,r;e instanceof lp&&(t=e,lD.delete(t.id),lx(t)),e.close(),this.emit(dy.PeerConnectionStateChange,"closed"),(r=e).onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0,this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(-1===this.getAllTracks().indexOf(e))return t;let r=this.localTrackMap.get(db.LocalAudioTrack);if(e instanceof cE&&(null==r?void 0:r.track)instanceof cS)return r.track.isActive||t.push([db.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(i&&(t.push(i),i[0]===db.LocalVideoTrack)){let e=this.localTrackMap.get(db.LocalVideoLowTrack);e&&t.push([db.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(db.LocalAudioTrack);if(e instanceof cE&&(null==r?void 0:r.track)instanceof cS)return r.track.isActive&&t.push([db.LocalAudioTrack,r]),t;let i=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:r}]=t;return e===r});if(i){if(i[0]===db.LocalVideoTrack){t.push(i);let e=this.localTrackMap.get(db.LocalVideoLowTrack);e&&t.push([db.LocalVideoLowTrack,e])}else t.push(i)}return t}createMuteMessage(e){return e.map(e=>{let t,[r,{track:i,ssrcs:n,id:o}]=e;switch(r){case db.LocalAudioTrack:t=da.Audio;break;case db.LocalVideoTrack:t=i._hints.includes(sE.SCREEN_TRACK)?da.Screen:da.High;break;case db.LocalVideoLowTrack:t=da.Low}return{stream_type:t,ssrcs:n,mid:o}})}createUnmuteMessage(e){return e.map(e=>{let t,[r,{track:i,ssrcs:n,id:o}]=e;switch(r){case db.LocalAudioTrack:t=da.Audio;break;case db.LocalVideoTrack:t=i._hints.includes(sE.SCREEN_TRACK)?da.Screen:da.High;break;case db.LocalVideoLowTrack:t=da.Low}return{stream_type:t,ssrcs:n,mid:o}})}filterTobeUnSubscribedTracks(e,t){let r=[],i=this.remoteUserMap.get(e);if(!i)return r;if(t){let n=i.get(t);if(!n)return r;r.push([e,{kind:t,id:n}])}else Array.from(i.entries()).forEach(t=>{let[i,n]=t;r.push([e,{kind:i,id:n}])});return r}filterTobeUnSubscribedDataChannels(e,t){let r=[];return t.forEach(t=>{var i;null!==(i=this.remoteDataChannelMap.get(e))&&void 0!==i&&i.has(t.id)&&r.push(t)}),r}createUnsubscribeMessage(e){let t=[];return e.forEach(e=>{let[r,{kind:i,id:n}]=e;switch(i){case dv.VIDEO:return void(r._videoSSRC&&t.push({stream_type:dv.VIDEO,ssrcId:r._videoSSRC}));case dv.AUDIO:return void(r._audioSSRC&&t.push({stream_type:dv.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(e=>{let[r,{kind:i}]=e;if(t.has(r)){let e=t.get(r);i===dv.VIDEO?e|=dd.Video:e|=dd.Audio,t.set(r,e)}else i===dv.VIDEO?t.set(r,dd.Video):t.set(r,dd.Audio)}),{users:Array.from(t.entries()).map(e=>{let[t,r]=e;return{stream_id:t.uid,stream_type:r}})}}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:r}]=e,i=this.remoteUserMap.get(t);i&&(i.delete(r),0===Array.from(i.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(db.LocalVideoTrack),r=this.localTrackMap.get(db.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new Promise((e,r)=>{this.handleUpdateVideoEncoder(t.track,e,r,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new Promise((e,t)=>{this.handleUpdateVideoEncoder(r.track,e,t,!0)}))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t,r){return e.map((e,i)=>{var n;let{stream_type:o}=e,a=null===(n=t.find(e=>{let{stream_type:t}=e;return o===t}))||void 0===n?void 0:n.attributes;if(a&&aP.DISABLE_SCREEN_SHARE_REMB){let e=r[i]._hints;(e.includes(sE.SCREEN_TRACK)||e.includes(sE.SCREEN_LOW_TRACK))&&(a.remb=!1,a6.debug("disable remb for screen share, hints:",e))}return a})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof cE){var t;let i=this.filterTobeUnmutedTracks(e[r]);if(0===i.length)continue;await (null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(i.map(e=>{let[,{id:t}]=e;return t})));let n=this.createUnmuteMessage(i);return void await oI(this,dy.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(dy.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(dy.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await oW(o4(this.dtlsFailedCount,o1)),this.emit(dy.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await oR(this,dy.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(dy.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(db.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof cR)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof cR).length>1)throw new n5(n8.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof cE).length>1&&(e.some(e=>e instanceof cE&&e._bypassWebAudio)||!si.webAudioMediaStreamDest))throw new n5(n8.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof cR&&this.pendingLocalTracks.some(e=>e instanceof cR))throw new n5(n8.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof cE&&this.pendingLocalTracks.some(e=>e instanceof cE)&&(!si.webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof cE&&e._bypassWebAudio)))throw new n5(n8.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r;let i=!aP.DISABLE_DUAL_STREAM_USE_ENCODING&&si.supportDualStreamEncoding,n=cz(cz({},{width:160,height:120,framerate:15,bitrate:50}),t);r=i?e._mediaStreamTrack.clone():l_(e,n);let o=oH(8,"track-low-"),a=new cR(r,cz(cz({},i&&{scaleResolutionDownBy:d1(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,o);return a.on(sS.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,sg.LOW_STREAM)}),a._hints.push(sE.LOW_STREAM),e._hints.includes(sE.SCREEN_TRACK)&&a._hints.push(sE.SCREEN_LOW_TRACK),e.on("sei-to-send",e=>{a.emit("sei-to-send",e)}),e.addListener(sv.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof lp){var n,o,a,s;let c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:d,dtlsTransportState:u,peerConnectionState:l}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();st.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:d,dtlsstate:u,connectionstate:l,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:null!==(n=null==h?void 0:h.protocol)&&void 0!==n?n:"",selectedLocalCandidateType:null!==(o=h.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(a=p.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(s=p.candidateType)&&void 0!==s?s:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,r,i){let n=Array.from(this.remoteUserMap.keys()).find(t=>t._videoSSRC===e);if(n){i||this.store.subscribe(n.uid,"video",void 0,void 0,void 0,void 0,Date.now());let o=this.store.keyMetrics,a=o.subscribe.find(e=>e.userId===n.uid&&"video"===e.type);st.firstRemoteVideoDecode(this.store.sessionId,a5.FIRST_VIDEO_DECODE,a9.FIRST_VIDEO_DECODE,{peer:n._uintid,videowidth:t,videoheight:r,subscribeElapse:u6.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:i?1:0,firstFrame:(null==a?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;let i=this.remoteUserMap.get(e);if(!i)return!1;let n=i.get(t);if(!n)return!1;let o=await this.connection.getRemoteSSRC(n);return void 0!==o&&o!==r}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===db.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,sg.LOW_STREAM):r._updateRtpTransceiver(void 0)})}}).prototype,"startP2PConnection",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"startP2PConnection"),rh.prototype),cG(rh.prototype,"connect",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"connect"),rh.prototype),cG(rh.prototype,"updateRemoteRTPCapabilities",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"updateRemoteRTPCapabilities"),rh.prototype),cG(rh.prototype,"publishDataChannel",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"publishDataChannel"),rh.prototype),cG(rh.prototype,"unpublish",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"unpublish"),rh.prototype),cG(rh.prototype,"unpublishDataChannel",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"unpublishDataChannel"),rh.prototype),cG(rh.prototype,"unpublishLowStream",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"unpublishLowStream"),rh.prototype),cG(rh.prototype,"subscribeDataChannel",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"subscribeDataChannel"),rh.prototype),cG(rh.prototype,"subscribe",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"subscribe"),rh.prototype),cG(rh.prototype,"massSubscribe",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"massSubscribe"),rh.prototype),cG(rh.prototype,"unsubscribe",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"unsubscribe"),rh.prototype),cG(rh.prototype,"unsubscribeDataChannel",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"unsubscribeDataChannel"),rh.prototype),cG(rh.prototype,"massUnsubscribe",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"massUnsubscribe"),rh.prototype),cG(rh.prototype,"muteRemote",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"muteRemote"),rh.prototype),cG(rh.prototype,"unmuteRemote",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"unmuteRemote"),rh.prototype),cG(rh.prototype,"hasRemoteMediaWithLock",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"hasRemoteMediaWithLock"),rh.prototype),cG(rh.prototype,"disconnectForReconnect",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"disconnectForReconnect"),rh.prototype),cG(rh.prototype,"updateBitrateLimit",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"updateBitrateLimit"),rh.prototype),cG(rh.prototype,"remoteMediaSsrcChanged",[lB],Object.getOwnPropertyDescriptor(rh.prototype,"remoteMediaSsrcChanged"),rh.prototype),rh);function lB(e,t,r){let i=e[t];if("function"!=typeof i)throw Error("Cannot use mutex on object property.");return r.value=async function(){let e=this.mutex,r=await e.lock("From P2PChannel.".concat(t));try{for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return await i.apply(this,o)}finally{r()}},r}let lV=Date.now(),lF=new Map,lj=new Map;async function lG(e){let t=lF.get(e),r=Array.isArray(t)&&t[t.length-1],i=lj.get(e);if(!r)return void(i.isSyncing=!1);let n={uid:r.uid,payload:r.payload};0===i.firstRecvTs&&(i.firstRecvTs=r.recvTs,i.firstSendTs=r.sendTs);let o=r.sendTs-i.firstSendTs,a=o-(Date.now()-i.firstRecvTs);a>0&&(i.firstRecvTs=Date.now()-o);let s=r.mediaDelay+a;s<=0?(t.pop(),lW(r.context,n),s=0):s=Math.min(s,20),setTimeout(()=>t.length&&lG(e),s)}function lW(e,t){e.safeEmit(oS.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}nL().name;let lH="websdk_ng_cache_parameter",lY=aP.MAX_PRELOAD_ASYNC_LENGTH,lK=new Map,lQ=[],lz=null,lX=0,lJ=0,lq=new Map,lZ=function(e,t){let r=[],i=0,n=async()=>{let e=r.shift();e&&await e(),r.length>0&&i<t?n():i--};return async function(){for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return new Promise(async(o,s)=>{r.push(async()=>{try{let t=await e(...a);o(t)}catch(e){s(e)}}),i<t&&(i++,n())})}}(l0,lY),l$=nb.Z.CancelToken.source();async function l0(e,t,r,i,n,o){try{let a,s;if(!aP.ENABLE_PRELOAD)return;if(!si.supportWebCrypto)return void ox(()=>{a6.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&null!==r)throw new n5(n8.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&or(r,"token",1,2047),or(e,"appid",1,2047),c7(t),i&&de(i);let c=oY();a6.debug("preload channel ".concat(t,", uid is ").concat(i));let d={appId:e,cname:t,token:r||e,uid:"string"!=typeof i?i:null,sid:c,proxyServer:n};"string"==typeof i?(d.stringUid=i,[s,a]=await Promise.all([uJ(i,{sid:c,appId:e},l$.token),uZ(cz(cz({},d),{},{token:r||e,uid:0}),l$.token)]),d.uid=s.uid,a.gatewayInfo.uid=d.uid,a.gatewayInfo.res.uid=d.uid):(o&&(d.stringUid=o),a=await uZ(d,l$.token));let u={sid:c,appId:e,cname:t,token:r||e,uid:d.stringUid||i,intUid:d.uid||a.gatewayInfo.uid,stringUid:d.stringUid,ts:Date.now(),sua:s,ap:a};await async function(e){let t;try{e.uid&&l1({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});let r=l9(e),i=await async function(e,t){try{let r=await window.crypto.subtle.importKey("raw",oV(t),"AES-GCM",!1,["encrypt"]),i=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},r,oU(window.btoa(JSON.stringify(e))));return oB(new Uint8Array(i))}catch(e){return}}(e,e.token||e.appId);if(!i)return;let n=(t=l8(lH))?JSON.parse(t):[];n.push({[r]:i}),n.length>aP.AP_CACHE_NUM&&n.shift(),l5(lH,JSON.stringify(n))}catch(e){a6.warn("Error caching server parameters:",e.message),l5(lH,"")}}(u),lX++}catch(e){throw lJ++,function(e){lz||(lz=window.setTimeout(()=>{let t="";lq.forEach((e,r)=>{t+="".concat(r,": ").concat(e," ;")}),st.reportApiInvoke(null,{name:oA.PRELOAD,options:{success:lX,failed:lJ,err:t}}).onError(e),lX=0,lJ=0,lq.clear(),lz=null},1e4));let t=lq.get(e.code)||0;lq.set(e.code,t+1)}(e),e}}async function l2(e){try{var t,r;if(aP.AP_REQUEST_DETAIL||aP.ENABLE_ROLE_SELECT_EDGE)return;let i=l1(e);if(!i||"disabled"!==e.cloudProxyServer)return;let n=await async function(e,t){try{let r=await window.crypto.subtle.importKey("raw",oV(t),"AES-GCM",!1,["decrypt"]),i=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},r,oU(e));return JSON.parse(window.atob(oB(new Uint8Array(i))))}catch(e){return}}(i,e.token||e.appId);if(!n)return;if(t=n,r=e,t.cname!==r.cname||t.appId!==r.appId||t.token!==r.token||(r.stringUid?t.stringUid!==r.stringUid:"number"==typeof r.uid?t.uid!==r.uid:t.uid!=r.uid))return;if(n&&Date.now()-n.ts<aP.AP_CACHE_LIFETIME)return n}catch(e){a6.warn("Error get preloadInfo",e.message)}}function l1(e){let t;try{if(!(t=l8(lH)))return;let r=JSON.parse(t),i=l9(e),n=function(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1}(r,e=>i in e);if(-1===n)return;let o=r.splice(n,1)[0];return l5(lH,JSON.stringify(r)),o[i]}catch(e){a6.warn("Error delete preload info: ".concat(t),e.message),l5(lH,"")}}function l4(e){if(e){let t=lK.get(e);t&&(window.clearTimeout(t),t=null,lK.delete(e)),lQ.includes(e)||"disabled"!==e.cloudProxyServer||lQ.push(e)}if(lK.size<aP.AP_CACHE_NUM&&lQ.length>0){let e=lQ.shift();lK.set(e,window.setTimeout(async()=>{let{appId:t,cname:r,token:i,stringUid:n,uid:o,proxyServer:a}=e;try{await lZ(t,r,i,o,a,n),lK.has(e)&&l4(e)}catch(t){a6.warn("update preload failed",t.message),l6(e)}},aP.AP_UPDATE_INTERVAL))}}function l6(e){let t=lQ.indexOf(e);-1!==t&&lQ.splice(t,1);let r=lK.get(e);r&&(window.clearTimeout(r),r=null,lK.delete(e),l4())}function l3(e,t){let r=e.sua,i=e.ap;t&&r&&st.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),st.reportResourceTiming(e.ap.url,e.sid),st.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(e=>e.ip).join(","),eventType:"disabled",unilbsServerIds:[dz.CHOOSE_SERVER,dz.CLOUD_PROXY_FALLBACK].toString()}),st.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[dz.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function l8(e){return window.atob(window.localStorage.getItem(e)||"")}function l5(e,t){window.localStorage.setItem(e,window.btoa(t))}function l9(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),function(e){let t="0123456789abcdef";function r(e){let r,i="";for(r=0;r<=3;r++)i+=t.charAt(e>>8*r+4&15)+t.charAt(e>>8*r&15);return i}function i(e,t){let r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,t,r,n,o,a){var s,c;return i((s=i(i(t,e),i(n,a)),s<<(c=o)|s>>>32-c),r)}function o(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function s(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function c(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}let d=function(e){let t;let r=1+(e.length+8>>6),i=Array(16*r);for(t=0;t<16*r;t++)i[t]=0;for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<t%4*8;return i[t>>2]|=128<<t%4*8,i[16*r-2]=8*e.length,i}(e),u,l,h,p,f,_=0x67452301,A=-0x10325477,m=-0x67452302,v=0x10325476;for(u=0;u<d.length;u+=16)l=_,h=A,p=m,f=v,_=o(_,A,m,v,d[u+0],7,-0x28955b88),v=o(v,_,A,m,d[u+1],12,-0x173848aa),m=o(m,v,_,A,d[u+2],17,0x242070db),A=o(A,m,v,_,d[u+3],22,-0x3e423112),_=o(_,A,m,v,d[u+4],7,-0xa83f051),v=o(v,_,A,m,d[u+5],12,0x4787c62a),m=o(m,v,_,A,d[u+6],17,-0x57cfb9ed),A=o(A,m,v,_,d[u+7],22,-0x2b96aff),_=o(_,A,m,v,d[u+8],7,0x698098d8),v=o(v,_,A,m,d[u+9],12,-0x74bb0851),m=o(m,v,_,A,d[u+10],17,-42063),A=o(A,m,v,_,d[u+11],22,-0x76a32842),_=o(_,A,m,v,d[u+12],7,0x6b901122),v=o(v,_,A,m,d[u+13],12,-0x2678e6d),m=o(m,v,_,A,d[u+14],17,-0x5986bc72),A=o(A,m,v,_,d[u+15],22,0x49b40821),_=a(_,A,m,v,d[u+1],5,-0x9e1da9e),v=a(v,_,A,m,d[u+6],9,-0x3fbf4cc0),m=a(m,v,_,A,d[u+11],14,0x265e5a51),A=a(A,m,v,_,d[u+0],20,-0x16493856),_=a(_,A,m,v,d[u+5],5,-0x29d0efa3),v=a(v,_,A,m,d[u+10],9,0x2441453),m=a(m,v,_,A,d[u+15],14,-0x275e197f),A=a(A,m,v,_,d[u+4],20,-0x182c0438),_=a(_,A,m,v,d[u+9],5,0x21e1cde6),v=a(v,_,A,m,d[u+14],9,-0x3cc8f82a),m=a(m,v,_,A,d[u+3],14,-0xb2af279),A=a(A,m,v,_,d[u+8],20,0x455a14ed),_=a(_,A,m,v,d[u+13],5,-0x561c16fb),v=a(v,_,A,m,d[u+2],9,-0x3105c08),m=a(m,v,_,A,d[u+7],14,0x676f02d9),A=a(A,m,v,_,d[u+12],20,-0x72d5b376),_=s(_,A,m,v,d[u+5],4,-378558),v=s(v,_,A,m,d[u+8],11,-0x788e097f),m=s(m,v,_,A,d[u+11],16,0x6d9d6122),A=s(A,m,v,_,d[u+14],23,-0x21ac7f4),_=s(_,A,m,v,d[u+1],4,-0x5b4115bc),v=s(v,_,A,m,d[u+4],11,0x4bdecfa9),m=s(m,v,_,A,d[u+7],16,-0x944b4a0),A=s(A,m,v,_,d[u+10],23,-0x41404390),_=s(_,A,m,v,d[u+13],4,0x289b7ec6),v=s(v,_,A,m,d[u+0],11,-0x155ed806),m=s(m,v,_,A,d[u+3],16,-0x2b10cf7b),A=s(A,m,v,_,d[u+6],23,0x4881d05),_=s(_,A,m,v,d[u+9],4,-0x262b2fc7),v=s(v,_,A,m,d[u+12],11,-0x1924661b),m=s(m,v,_,A,d[u+15],16,0x1fa27cf8),A=s(A,m,v,_,d[u+2],23,-0x3b53a99b),_=c(_,A,m,v,d[u+0],6,-0xbd6ddbc),v=c(v,_,A,m,d[u+7],10,0x432aff97),m=c(m,v,_,A,d[u+14],15,-0x546bdc59),A=c(A,m,v,_,d[u+5],21,-0x36c5fc7),_=c(_,A,m,v,d[u+12],6,0x655b59c3),v=c(v,_,A,m,d[u+3],10,-0x70f3336e),m=c(m,v,_,A,d[u+10],15,-1051523),A=c(A,m,v,_,d[u+1],21,-0x7a7ba22f),_=c(_,A,m,v,d[u+8],6,0x6fa87e4f),v=c(v,_,A,m,d[u+15],10,-0x1d31920),m=c(m,v,_,A,d[u+6],15,-0x5cfebcec),A=c(A,m,v,_,d[u+13],21,0x4e0811a1),_=c(_,A,m,v,d[u+4],6,-0x8ac817e),v=c(v,_,A,m,d[u+11],10,-0x42c50dcb),m=c(m,v,_,A,d[u+2],15,0x2ad7d2bb),A=c(A,m,v,_,d[u+9],21,-0x14792c6f),_=i(_,l),A=i(A,h),m=i(m,p),v=i(v,f);return r(_)+r(A)+r(m)+r(v)}(t)}let l7={},he={};function ht(e,t){let r,i,n;return t?(n=0<=(e>>>=0)&&e<256)&&(i=he[e])?i:(r=hr(e,0,!0),n&&(he[e]=r),r):(n=-128<=(e|=0)&&e<128)&&(i=l7[e])?i:(r=hr(e,e<0?-1:0,!1),n&&(l7[e]=r),r)}function hr(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}ht(0,!0),ht(0),o0.setLogger(a6),rp=se(),rf=se({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof sW))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),r_=se({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==sy.DATA?(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())):[t.getChannelId()])}),rA=se({argsMap:(e,t,r,i)=>["object"==typeof t?t.uid:t,r,i]}),rm=se({argsMap:(e,t,r)=>[t,r]}),rv=se({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:r}=e;return[null==t?void 0:t.uid,r]})}),rE=se({argsMap:(e,t,r,i)=>["object"==typeof t?t.uid:t,r,i]}),rg=se({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:r}=e;return{uid:null==t?void 0:t.uid,mediaType:r}})}),rS=se(),rb=se(),rT=se(),ry=se(),rR=se(),rI=se(),rC=se(),rk=se(),rw=se(),rO=se(),rN=se(),rP=se(),rD=se(),rL=se(),rM=se(),rx=se({argsMap:(e,t)=>[t]}),rU=se(),rB=se(),rV=se(),rF=se(),rj=se(),rG=se(),rW=se(),rH=se(),rY=se({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),rK=se(),rQ=se(),rz=se(),rX=se(),rJ=se(),rq=se(),rZ=se({reportResult:!0}),r$=se(),cG((r0=class extends op{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){var r;let i;if(super(),this.store=void 0,this._uid=void 0,this._channelName=void 0,this._uintUid=void 0,this._users=[],this._config=void 0,this._clientId=void 0,this._appId=void 0,this._sessionId=null,this._key=void 0,this._rtmConfig={},this._joinInfo=void 0,this._gateway=void 0,this._statsCollector=void 0,this._configDistribute=void 0,this._leaveMutex=void 0,this._publishMutex=void 0,this._renewTokenMutex=void 0,this._subscribeMutex=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStream=!1,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._proxyServer=void 0,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._defaultStreamFallbackType=void 0,this._lowStreamParameter=void 0,this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._axiosCancelSource=nb.Z.CancelToken.source(),this._audioVolumeIndicationInterval=void 0,this._networkQualityInterval=void 0,this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0,this._liveTranscodeStreamingClient=void 0,this._liveRawStreamingClient=void 0,this._channelMediaRelayClient=void 0,this._networkQualitySensitivity="normal",this._p2pChannel=void 0,this._useLocalAccessPoint=!1,this._setLocalAPVersion=void 0,this._joinAndNotLeaveYet=!1,this._numberOfJoinCount=0,this._remoteDefaultVideoStreamType=void 0,this._inspect=void 0,this._moderation=void 0,this._license=void 0,this._pendingPublishedUsers=[],this.ntpAlignErrorCount=0,this.remoteInboundOffset=0,this._peerConnectionState=void 0,this._handleLocalTrackEnable=(e,t,r)=>{this.publish(e,!1).then(t).catch(r)},this._handleLocalTrackDisable=(e,t,r)=>{this.unpublish(e).then(t).catch(r)},this._handleUserOnline=e=>{if(aP.BLOCK_LOCAL_CLIENT&&cV(e.uid,this.channelName))return void a6.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&a6.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let t=this._users.find(t=>t.uid===e.uid);if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(oS.USER_JOINED,t));else{let t=new u9(e.uid,e.uint_id||e.uid);this._users.push(t),a6.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(oS.USER_JOINED,t)}},this._handleUserOffline=e=>{if(aP.BLOCK_LOCAL_CLIENT&&cV(e.uid,this.channelName))return;let t=this._users.find(t=>t.uid===e.uid);t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:oO(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),a6.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(oS.USER_LEAVED,t,e.reason))},this._handleAddAudioOrVideoStream=(e,t,r,i,n,o,a)=>{if(aP.BLOCK_LOCAL_CLIENT&&cV(t,this.channelName))return;let s=this._users.find(e=>e.uid===t);if(!s)return void a6.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));a6.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(s.uid,e,void 0,void 0,void 0,Date.now());let c="audio"===e?s.hasAudio:s.hasVideo;s._uintid||(s._uintid=n||t),"audio"===e?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,"audio"===e?(s._audio_added_=!0,void 0!==r&&(s._audioSSRC=r),void 0!==i&&(s._cname=i),o&&(s._audioOrtc=o)):(s._video_added_=!0,void 0!==r&&(s._videoSSRC=r),void 0!==i&&(s._cname=i),void 0!==a&&(s._rtxSsrcId=a),o&&(s._videoOrtc=o)),("audio"===e?s.hasAudio:s.hasVideo)&&!c&&(a6.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(e)),this.safeEmit(oS.USER_PUBLISHED,s,e)),"video"===e?st.onGatewayStream(this._sessionId,a5.ON_ADD_VIDEO_STREAM,a9.ON_ADD_VIDEO_STREAM,{peer:n||t,ssrc:s._videoSSRC}):st.onGatewayStream(this._sessionId,a5.ON_ADD_AUDIO_STREAM,a9.ON_ADD_AUDIO_STREAM,{peer:n||t,ssrc:s._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(s,e,r).then(t=>{if(t&&(a6.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof lU))return this._p2pChannel.unsubscribe(s,e,!0).then(()=>this._subscribe(s,e,!0).catch(e=>{a6.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(s,e)&&(a6.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,e,!0).catch(e=>{a6.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))},this._handleRemoveStream=e=>{if(aP.BLOCK_LOCAL_CLIENT&&cV(e.uid,this.channelName))return;let t=this._users.find(t=>t.uid===e.uid);if(!t)return void a6.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));a6.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let r=()=>{};t.hasAudio&&t.hasVideo?r=()=>{a6.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(oS.USER_UNPUBLISHED,t,"audio"),a6.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(oS.USER_UNPUBLISHED,t,"video")}:t.hasVideo?r=()=>{a6.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(oS.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(r=()=>{a6.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(oS.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof lU&&this._p2pChannel.unsubscribe(t).then(e=>{if(e)return this._gateway.unsubscribe(e,t.uid)}),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),st.onGatewayStream(this._sessionId,a5.ON_REMOVE_STREAM,a9.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),r()},this._handleSetStreamLocalEnable=(e,t,r)=>{if(aP.BLOCK_LOCAL_CLIENT&&cV(t,this.channelName))return;let i=this._users.find(e=>e.uid===t);if(!i)return void a6.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));a6.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(r?"enabled":"disabled"," with uid ").concat(t));let n="audio"===e?i.hasAudio:i.hasVideo;if("audio"===e){i._trust_audio_enabled_state_=!0;let e=i._audio_enabled_;if(i._audio_enabled_=r,i._audio_enabled_===e)return;{let e=i._audio_enabled_?"enable-local-audio":"disable-local-audio";a6.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(oS.USER_INFO_UPDATED,t,e)}}else{i._trust_video_enabled_state_=!0;let e=i._video_enabled_;if(i._video_enabled_=r,i._video_enabled_===e)return;{let e=i._video_enabled_?"enable-local-video":"disable-local-video";a6.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(oS.USER_INFO_UPDATED,t,e)}}let o="audio"===e?i.hasAudio:i.hasVideo;return n!==o?!n&&o?(a6.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(oS.USER_PUBLISHED,i,e)):("video"===e&&i._videoTrack&&i._videoTrack._destroy(),"audio"===e&&i._audioTrack,this._p2pChannel.muteRemote(i,e),a6.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(oS.USER_UNPUBLISHED,i,e)):void 0},this._handleMuteStream=(e,t,r)=>{if(aP.BLOCK_LOCAL_CLIENT&&cV(e,this.channelName))return;a6.debug("[".concat(this._clientId,"] receive mute message"),e,t,r);let i=this._users.find(t=>t.uid===e);if(!i)return void a6.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));let n="audio"===t?i.hasAudio:i.hasVideo;if("audio"===t){i._trust_audio_mute_state_=!0;let t=i._audio_muted_;if(i._audio_muted_=r,i._audio_muted_===t)return;{let t=i._audio_muted_?"mute-audio":"unmute-audio";a6.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(oS.USER_INFO_UPDATED,e,t)}}else{i._trust_video_mute_state_=!0;let t=i._video_muted_;if(i._video_muted_=r,i._video_muted_===t)return;{let t=i._video_muted_?"mute-video":"unmute-video";a6.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(oS.USER_INFO_UPDATED,e,t)}}let o="audio"===t?i.hasAudio:i.hasVideo;if(n!==o){if(!n&&o)return("audio"===t?i._audioSSRC:i._videoSSRC)?(a6.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(oS.USER_PUBLISHED,i,t)):void a6.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&i._videoTrack&&!i._video_pre_subscribed&&i._videoTrack._destroy(),"audio"===t&&i._audioTrack,this._p2pChannel.muteRemote(i,t),a6.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(oS.USER_UNPUBLISHED,i,t)}},this._handleP2PLost=async e=>{a6.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():a6.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)},this._handleTokenWillExpire=()=>{a6.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(oS.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),a6.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))},this._handleUpdateNetworkQuality=()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(oS.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(oS.NETWORK_QUALITY,e)},this._handleP2PAddAudioOrVideoStream=(e,t,r,i)=>{let n=this._users.find(e=>e.uid===t);if(!n)return void a6.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));a6.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(n.uid,e,void 0,void 0,void 0,Date.now());let o="audio"===e?n.hasAudio:n.hasVideo;"audio"===e?n._trust_audio_stream_added_state_=!0:n._trust_video_stream_added_state_=!0,"audio"===e?(n._audio_added_=!0,void 0!==r&&(n._audioSSRC=r),void 0!==i&&(n._audioMid=i)):(n._video_added_=!0,void 0!==r&&(n._videoSSRC=r),void 0!==i&&(n._videoMid=i)),("audio"===e?n.hasAudio:n.hasVideo)&&!o&&(a6.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published ").concat(e)),this.safeEmit(oS.USER_PUBLISHED,n,e)),this._p2pChannel.hasPendingRemoteMedia(n,e)&&(a6.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(n.uid," after reconnect.")),this._subscribe(n,e,!0).catch(e=>{a6.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))},this._config=e,this._clientId=t||oH(5,"client-"),this.store=new aB(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new o0("client-leave",this._clientId),this._publishMutex=new o0("client-publish",this._clientId),this._renewTokenMutex=new o0("client-renewtoken",this._clientId),this._subscribeMutex=new o0("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),a6.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ay," build: ").concat(aO,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{og(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(e){a6.warning("[".concat(this._clientId,"] ").concat(e.toString()))}this._statsCollector=new u3(this.store),this._statsCollector.onStatsException=(e,t,r)=>{a6.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(r)),this.safeEmit(oS.EXCEPTION,{code:e,msg:t,uid:r})},this._statsCollector.onUploadPublishDuration=(e,t,r,i)=>{let n=this._users.find(t=>t.uid===e);n&&st.peerPublishStatus(this._sessionId,{subscribeElapse:i,audioPublishDuration:t,videoPublishDuration:r,peer:n._uintid})},this.store.useP2P="p2p"===e.mode,this._gateway=new uT(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||o1,httpRetryConfig:e.httpRetryConfig||o1,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new u2(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},uE("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new lU(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,i,n){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];aD("JOIN_GATEWAY_USE_443PORT_ONLY",o),aD("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);let s=this._gateway.signal.websocket;return s instanceof dY&&(s.use443PortOnly=o,s.tryDoubleDomain=a),nk("client.join",aP.JOIN_MAX_CONCURRENCY,this.join.bind(this),e,t,r,i,n)}async join(e,t,r,i,n){let o=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);let a=at(),s=ar()?window.isSecureContext:"Browser Not Support";(!ar()&&!a||!window.isSecureContext)&&a6.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),a6.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),st.setAppId(e);try{if(!r&&null!==r)throw new sr(n8.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&or(r,"token",1,2047),or(e,"appid",1,2047),c7(t),i&&de(i),n&&or(n,"optionalInfo",1,2047)}catch(n){throw st.reportApiInvoke(oY(),{name:oA.JOIN,options:[e,t,r,i],states:{isHttps:a,isSecureContext:s},tag:om.TRACER}).onError(n),n}if(this._leaveMutex.isLocked&&(a6.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),a6.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){let n=new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw st.reportApiInvoke(oY(),{name:oA.JOIN,options:[e,t,r,i],states:{isHttps:a,isSecureContext:s},tag:om.TRACER}).onError(n),n}this._gateway.state="CONNECTING";let c=await l2({appId:e,cname:t,uid:i,stringUid:"string"==typeof i?i:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let d=(null==c?void 0:c.sid)||oY();a6.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId);let u=st.reportApiInvoke(d,{id:this._clientId,name:oA.JOIN,options:[e,t,r,i],states:{isHttps:a,isSecureContext:s},tag:om.TRACER}),l=cz(cz(cz({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof i?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:n,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:aP.AP_REQUEST_DETAIL||void 0});if(this._useLocalAccessPoint&&(l.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof i&&(l.stringUid=i,this._uintUid?(l.uid=this._uintUid,this._uintUid=void 0):l.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(l.aesmode=this._encryptionMode,l.aespassword=await ol(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(l.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode)){if(this._encryptionSalt&&this._encryptionSecret){if(window.crypto.subtle){let e=new TextEncoder,t=aP.USE_PURE_ENCRYPTION_MASTER_KEY?e.encode(l.appId+this._encryptionSecret+this._encryptionSecret):e.encode(l.appId+l.cname+this._encryptionSecret);this._encryptDataStreamIv=await aW(this._encryptionMode,t,oU(this._encryptionSalt)),this._encryptDataStreamKey=await aH(this._encryptionMode,t,oU(this._encryptionSalt))}else s?a6.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):a6.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1}else this._encryptDataStream=!1,a6.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"))}this._startSession(this._sessionId,{channel:t,appId:e,stringUid:l.stringUid});let h=this._sessionId;setTimeout(()=>{"CONNECTING"===this.connectionState&&h===this._sessionId&&st.joinChannelTimeout(this._sessionId,5)},5e3);try{let i;let n=l.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(n)){let e=aP.PROXY_SERVER_TYPE3;Array.isArray(e)?l.proxyServer=e[0]:l.proxyServer=e}if(st.setProxyServer(l.proxyServer),a6.setProxyServer(l.proxyServer),this.store.requestAPStart(),c){if(a6.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(l.stringUid?", ".concat(l.stringUid," => ").concat(c.intUid):""," ")),l.stringUid&&!l.uid&&(l.uid=c.intUid),i={gatewayInfo:c.ap.gatewayInfo},aP.JOIN_WITH_FALLBACK_MEDIA_PROXY&&"auto"===l.turnServer.mode){if(0===c.ap.proxyInfo.addresses.length)a6.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let e=(await d2(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map(e=>({turnServerURL:e.address,tcpport:e.tcpport||aC.tcpport,udpport:e.udpport||aC.udpport,username:e.username||aC.username,password:e.password||aC.password,forceturn:!1,security:!0}));l.turnServer={mode:"manual",servers:e}}}l3(c,l.stringUid)}else{if(l.stringUid&&!l.uid){let e;[e,i]=await Promise.all([uX(l.stringUid,l,this._axiosCancelSource.token,this._config.httpRetryConfig||o1,this.store),uz(l,this._axiosCancelSource.token,this._config.httpRetryConfig||o1,!0,this.store)]),a6.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(l.stringUid," => ").concat(e)),l.uid=e,i.gatewayInfo.uid=e,i.gatewayInfo.res.uid=e}else i=await uz(l,this._axiosCancelSource.token,this._config.httpRetryConfig||o1,!0,this.store);if(!this._joinAndNotLeaveYet)throw new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(l,this._axiosCancelSource.token),this._configDistribute.on(df.UPDATE_BITRATE_LIMIT,e=>{this._p2pChannel.updateBitrateLimit(e)}),this._configDistribute.on(df.UPDATE_CLIENT_ROLE_OPTIONS,e=>{this._setClientRoleOptions(e)})},0),this._key=r||e;let o=i.gatewayInfo,a=l.uid?l.uid:o.uid;this._joinInfo=cz(cz({},l),{},{cid:o.cid,uid:a,vid:o.vid,apResponse:o.res,apGatewayAddress:o.apGatewayAddress,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs}),this.store.intUid=a,this.store.cid=o.cid;let s=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));u.onSuccess(s),this._appId=e,this._channelName=l.cname,this._uid=s,this.store.uid=s,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(nF()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let d=l.stringUid?"string uid: ".concat(l.stringUid,",uid: ").concat(l.uid):"uid: ".concat(this._uid);return a6.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(d)),setTimeout(()=>{a6.startUpload()},5e3),this.store.joinEnd(),cU.includes(this)||cU.push(this),"disabled"===this._cloudProxyServerMode&&si.supportWebCrypto&&aP.ENABLE_PRELOAD&&l4(this._joinInfo),s}catch(t){let e=Array.isArray(t)?t[0]:t;throw e&&e.code===n8.OPERATION_ABORTED?a6.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),e):a6.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),e),e.code!==n8.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),u.onError(e),e}}_joinGateway(){if(!this._joinInfo||!this._key)throw new sr(n8.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!aP.JOIN_WITH_FALLBACK_SIGNAL_PROXY))}async leave(){a6.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(nF()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){let t=cU.indexOf(e);-1!==t&&cU.splice(t,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return a6.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,ov.LEAVE),a6.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof sW))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new sr(n8.INVALID_PARAMS,"param list is empty");let r=e;if("audience"===this._gateway.role)throw new sr(n8.INVALID_OPERATION,"audience can not publish stream");for(let e of r){if(!(e instanceof sW))throw new sr(n8.INVALID_PARAMS,"parameter is not local track");if(!e._enabled&&t)throw new sr(n8.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(e.getTrackId()))}a6.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(e=>"".concat(e.getTrackId()," "))));let i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(e=>{let t=this._configDistribute.getBitrateLimit();e instanceof cR&&t&&e.setBitrateLimit(t.uplink)});try{await this._publishHighStream(r),a6.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(e=>"".concat(e.getTrackId()," "))))}catch(e){throw a6.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{i()}}async _publishDataChannel(e){oe(e.id,"id",0,65535,!0),n9(e.ordered,"ordered"),or(e.metadata,"metadata",0,512),a6.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{var r;if(-1!==this._p2pChannel.getAllDataChannels().findIndex(t=>t.id===e.id))throw new sr(n8.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new sr(n8.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&aP.FORCE_TURN&&!aP.TURN_ENABLE_TCP&&!aP.TURN_ENABLE_UDP)throw new sr(n8.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let t=(r=e,ug(r,!1)),i=await this._p2pChannel.publishDataChannel([t]);if(i.length>0){if("number"!=typeof t._originDataChannelId)throw a6.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new sr(n8.CREATE_DATACHANNEL_ERROR);try{await Promise.all(i.map(e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0))),await t._waitTillOpen()}catch(e){if(e.code!==n8.DISCONNECT_P2P)throw e}}return a6.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw a6.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new sr(n8.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e){if(Array.isArray(e))t=e;else{if(!(e instanceof sW))return this._unpublishDataChannel([e]);t=[e]}}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);a6.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(e=>"".concat(e.getTrackId()," "))," "));let r=await this._publishMutex.lock();try{if(this.store.useP2P){let e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(dN.UNPUBLISH,{unpubMsg:e},!0)}else{let e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),a6.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(e=>"".concat(e.getTrackId()))))}}catch(e){throw a6.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{r&&r()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),a6.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(e=>"".concat(e.id," "))," "));let t=await this._publishMutex.lock();try{let t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),a6.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(e=>"".concat(e.id))))}catch(e){throw a6.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof u9)){let t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new sr(n8.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(n7(t,"mediaType",["audio","video"]),this.store.useP2P)throw new sr(n8.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r=t===dv.AUDIO,i=t===dv.VIDEO,n=await this._subscribeMutex.lock();try{let{ssrcId:n,ortc:o,rtxSsrcId:a,cname:s,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==n)throw new sr(n8.UNEXPECTED_RESPONSE,"no ssrc id");let d=this._users.find(t=>t.uid===e);d||((d=new u9(e,c||e))._is_pre_created=!0,this._users.push(d)),s&&(d._cname=s),d._uintid||(d._uintid=c||e),r&&(d._audioSSRC=n,d._audio_pre_subscribed=!0,o&&(d._audioOrtc=o)),i&&(d._videoSSRC=n,d._video_pre_subscribed=!0,o&&(d._videoOrtc=o),null!=a&&(d._rtxSsrcId=a)),a6.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(n)),await this._p2pChannel.subscribe(d,t,n,a,o);let u=r?d._audioTrack:d._videoTrack;if(!u)throw new sr(n8.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(d._trust_audio_stream_added_state_=!0,d._audio_added_=!0),i&&(d._trust_video_stream_added_state_=!0,d._video_added_=!0),u}catch(t){throw a6.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{n()}}async _subscribeDataChannel(e,t){var r,i;if(oe(t,"channelId",0,65535,!0),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(t=>t===e))throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new sr(n8.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new sr(n8.INVALID_REMOTE_USER,"user is not published");let n=null===(r=e._dataChannels)||void 0===r?void 0:r.find(e=>e.id===t);if(!n)throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new sr(n8.REMOTE_USER_IS_NOT_PUBLISHED);let o=await this._subscribeMutex.lock();a6.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let t=await this._p2pChannel.subscribeDataChannel(e,[n]);if(t&&t.includes(n.id))try{if("number"!=typeof n._originDataChannelId)throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new sr(n8.CREATE_DATACHANNEL_ERROR);let t={id:n.id,datachannelId:n._originDataChannelId,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:null!==(i=n.metadata)&&void 0!==i?i:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await n._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==n8.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[n]),t;await this._p2pChannel.unsubscribeDataChannel(e,[n]),this._p2pChannel.setPendingRemoteDataChannel(e,n.id)}return a6.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),n}finally{o()}}async _p2pSubscribe(e,t,r){if(n7(t,"mediaType",["audio","video"]),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(t=>t===e)){let t=new sr(n8.INVALID_REMOTE_USER,"user is not in the channel");throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){let t=new sr(n8.INVALID_REMOTE_USER,"user is not published");throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!r&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){let r=new sr(n8.REMOTE_USER_IS_NOT_PUBLISHED);throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),r}let i=await this._subscribeMutex.lock();a6.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let r="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,r,i)}catch(e){throw e}a6.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{a6.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});let r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new sr(n8.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(t){throw a6.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(n7(t,"mediaType",["audio","video"]),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(t=>t===e)){let t=new sr(n8.INVALID_REMOTE_USER,"user is not in the channel");throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){let t=new sr(n8.INVALID_REMOTE_USER,"user is not published");throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(r||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){let r=new sr(n8.REMOTE_USER_IS_NOT_PUBLISHED);throw a6.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),r}let i="audio"===t?e._audioSSRC:e._videoSSRC,n="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?dv.AUDIO:dv.VIDEO,ssrcId:i},s=await this._subscribeMutex.lock();a6.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let r="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==r&&r!==i&&(i=r,n="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?dv.AUDIO:dv.VIDEO,ssrcId:i}),u6.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,n);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,a,!0)}catch(r){if((null==r?void 0:r.code)!==n8.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),r;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(r){throw this._p2pChannel.reportSubscribeEvent(!1,null==r?void 0:r.code,e,t),r}a6.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{a6.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});let r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new sr(n8.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(t){throw a6.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{s()}}async massSubscribe(e){if(oi(e,"subscribeList"),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),r=new Map,i=await this._subscribeMutex.lock();a6.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(e=>{let{user:t,mediaType:r}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(r)}).join("; ")));let n=(e=[...e]).map(e=>{let{user:t,mediaType:r}=e;return{user:t,mediaType:r}}),o=await this._p2pChannel.globalLock();try{for(let t=e.length-1;t>=0;t--){let{user:i,mediaType:o}=e[t];if(n7(o,"mediaType",["audio","video"]),!i){let e=new sr(n8.INVALID_PARAMS,"user property does not exist in subscribeList item");throw a6.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}if(!this._users.find(e=>e===i)){let r=new sr(n8.INVALID_REMOTE_USER,"user is not in the channel");a6.error("[".concat(this._clientId,"] can not massSubscribe ").concat(i.uid,", this user is not in the channel")),n[t].error=r,e.splice(t,1);continue}if("audio"===o&&(!i.hasAudio||void 0===i._audioSSRC)||"video"===o&&(!i.hasVideo||void 0===i._videoSSRC)){let r=new sr(n8.REMOTE_USER_IS_NOT_PUBLISHED);a6.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(o,", remote user is not published")),n[t].error=r,e.splice(t,1);continue}let a=dd.Video|dd.LwoVideo,s=r.get(i);if(s){if("video"===o?s&a:s&dd.Audio){e.splice(t,1),a6.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(i.uid,", mediaType:").concat(o," twice"));continue}r.set(i,s|("video"===o?a:dd.Audio))}else r.set(i,"video"===o?a:dd.Audio)}for(let t=e.length-1;t>=0;t--){let{user:i,mediaType:n}=e[t],o=dd.Video|dd.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,n)){await this._p2pChannel.unmuteRemoteNoLock(i,n);let a=r.get(i);r.set(i,"video"===n?a^o:a^dd.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map(e=>({userId:e.user.uid,type:e.mediaType})),t);let i=Array.from(r.entries()).reduce((e,t)=>{let[r,i]=t;if(0===i)return e;let n={stream_id:r.uid,stream_type:i};return i&dd.Audio&&(n.audio_ssrc=r._audioSSRC),i&dd.Video&&(n.video_ssrc=r._videoSSRC),e.push(n),e},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(e=>{let{user:t,mediaType:r}=e;return{user:t,mediaType:r,ssrcId:r===dv.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:r===dv.VIDEO?t._rtxSsrcId:void 0}}));let r=new Map;if((i=i.filter(e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc)).length>0){let e=await this._gateway.subscribeAll(i,!0);((null==e?void 0:e.users)||[]).forEach(e=>{let{stream_id:t,video_error_code:i,audio_error_code:n,error_code:o}=e;(i||n||o)&&r.set(t,{video_error_code:i,audio_error_code:n,error_code:o})})}if(Array.from(r.entries()).length>0){let e=[];Array.from(r.entries()).forEach(t=>{let[r,i]=t,n=this.remoteUsers.find(e=>e.uid===r);if(n){let t;i.error_code||i.video_error_code&&i.audio_error_code?t=void 0:i.video_error_code?t=dv.VIDEO:i.audio_error_code&&(t=dv.AUDIO),e.push({user:n,mediaType:t})}}),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(let e of n){let t=r.get(e.user.uid);if(t){let r=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(r){let t=dx(r);a6.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new sr(n8.SUBSCRIBE_FAILED,"code ".concat(r,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(n.filter(e=>!e.error).map(e=>({userId:e.user.uid,type:e.mediaType})),void 0,Date.now()),n.forEach(e=>{var r;st.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(r=e.error)||void 0===r?void 0:r.code)||null,video:e.mediaType===dv.VIDEO,audio:e.mediaType===dv.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===dv.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)}),a6.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(e=>{let{user:t,mediaType:r}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(r)}).join("; "))),n}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),i()}}async unsubscribe(e,t,r){if(!(e instanceof u9)){let t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new sr(n8.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&n7(t,"mediaType",["audio","video"]),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(t=>t===e)){let t=new sr(n8.INVALID_REMOTE_USER,"user is not in the channel");throw a6.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}a6.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let r=await this._p2pChannel.unsubscribe(e,t);r&&await this._gateway.unsubscribe(r,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&oO(this._users,e),a6.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===n8.DISCONNECT_P2P)return void a6.warning("disconnecting p2p, abort unsubscribe request.");throw a6.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){let r;if(t&&oe(t,"id",0,65535,!0),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(t=>t===e)){let t=new sr(n8.INVALID_REMOTE_USER,"user is not in the channel");throw a6.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}if("number"==typeof t){let i=e._dataChannels.find(e=>e.id===t);i&&(r=[i])}else r=e._dataChannels;if(void 0===r){let r=new sr(n8.REMOTE_USER_IS_NOT_PUBLISHED);throw a6.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),r}a6.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(e=>e.id)));try{let t=await this._p2pChannel.unsubscribeDataChannel(e,r);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),a6.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===n8.DISCONNECT_P2P)return void a6.warning("disconnecting p2p, abort unsubscribe request.");throw a6.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(oi(e,"unsubscribeList"),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");a6.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(e=>{let{user:t,mediaType:r}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(r,";")}).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:i,mediaType:n}=e[r];if(!i){let e=new sr(n8.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw a6.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}if(n7(n,"mediaType",["video","audio",void 0]),!this._users.find(e=>e===i)){a6.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(r,1);continue}let o=dd.Video|dd.LwoVideo;if(t.has(i)){let a;let s=t.get(i);switch(n){case"video":a=s&o;break;case"audio":a=s&dd.Audio;break;default:a=s&(dd.Audio|o)}if(a){a6.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(n," twice.")),e.splice(r,1);continue}n?"audio"===n?t.set(i,s|dd.Audio):"video"===n&&t.set(i,s|o):t.set(i,s|dd.Audio|o)}else n?"audio"===n?t.set(i,dd.Audio):"video"===n&&t.set(i,o):t.set(i,dd.Audio|o)}try{let t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),a6.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(e=>{let{user:t,mediaType:r}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(r,";")}).join()))}catch(e){if(e.code===n8.DISCONNECT_P2P)return void a6.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw a6.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){(function(e){if(!e)throw new n5(n8.INVALID_PARAMS);null==e.width||ot(e.width,"streamParameter.width"),null==e.height||ot(e.height,"streamParameter.height"),null==e.framerate||ot(e.framerate,"streamParameter.framerate"),null==e.bitrate||oe(e.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&a6.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),a6.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,db.LocalVideoLowTrack)}async enableDualStream(){if(!si.supportDualStream)throw st.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new sr(n8.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new sr(n8.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw st.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,st.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),a6.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(db.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw st.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,st.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),a6.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(n7(e,"role",["audience","host"]),t&&og(t),"rtc"===this.mode||"p2p"===this.mode)throw a6.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new sr(n8.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new sr(n8.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new sr(n8.INVALID_OPERATION,"can not set client role to audience when publishing stream");let r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&aP.ENABLE_ROLE_SELECT_EDGE?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",ob.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),a6.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode||"audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&og(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{a6.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(or(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new sr(n8.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,st.setProxyServer(this._proxyServer),a6.setProxyServer(this._proxyServer),a6.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new sr(n8.INVALID_OPERATION,"You have already set the proxy")}if(oE(e))return this._turnServer={servers:e,mode:"original-manual"},void a6.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(e=>e.urls).join(","),"."));e.forEach(e=>{var t;return or((t=e).turnServerURL,"turnServerURL"),or(t.username,"username"),or(t.password,"password"),t.udpport&&oe(t.udpport,"udpport",1,99999,!0),t.forceturn&&n9(t.forceturn,"forceturn"),t.security&&n9(t.security,"security"),t.tcpport&&oe(t.tcpport,"tcpport",1,99999,!0),!0}),this._turnServer={servers:e,mode:"manual"},a6.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"you should set license before join channel");if(or(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new sr(n8.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,a6.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){let t;if("DISCONNECTED"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new sr(n8.INVALID_OPERATION,"You have already set the proxy");switch(void 0===e&&(e=3),e){case 1:case 2:throw new sr(n8.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new sr(n8.INVALID_PARAMS,"proxy server mode must be ".concat("3|4|5"))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,a6.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"Stop proxy server after leave channel");st.setProxyServer(),a6.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",a6.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new sr(n8.INVALID_PARAMS,"accessPoints is required.");oi(e.accessPoints.serverList,"accessPoints.serverList"),or(e.accessPoints.domain,"accessPoints.domain");let t=(e,t)=>{oe(e,t,0,65535,!0)},r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new sr(n8.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");aP.CLOSE_AFB_FOR_LOCAL_AP&&(aD("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),aD("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,n=e.accessPoints.domain,o=e.accessPoints.serverList.map(e=>i.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(n):e),a=o.map(e=>"".concat(e,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,aD("WEBCS_DOMAIN",a),aD("WEBCS_DOMAIN_BACKUP_LIST",a),aD("GATEWAY_DOMAINS",[n]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(oi(e.report.hostname,"report.hostname"),aD("EVENT_REPORT_DOMAIN",e.report.hostname[0]),aD("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(aD("EVENT_REPORT_DOMAIN",o[0]),aD("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),aD("STATS_COLLECTOR_PORT",s),e.report?aD("ENABLE_EVENT_REPORT",!0):aD("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(oi(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let d=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),d=e.log.port),aD("LOG_UPLOAD_SERVER","".concat(c,":").concat(d));let u=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(oi(e.cds.hostname,"cds.hostname"),u=e.cds.hostname):u=o;let l=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),l=e.cds.port),aD("CDS_AP",u.map(e=>"".concat(e,":").concat(l))),e.cds?aD("ENABLE_CONFIG_DISTRIBUTE",!0):aD("ENABLE_CONFIG_DISTRIBUTE",!1),a6.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(oi(e,"serverList"),or(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new sr(n8.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,aD("WEBCS_DOMAIN",e),aD("WEBCS_DOMAIN_BACKUP_LIST",e),aD("GATEWAY_DOMAINS",[t]),aD("EVENT_REPORT_DOMAIN",e[0]),aD("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),aD("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),a6.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(n7(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw a6.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else a6.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){n7(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let t=this._users.find(t=>t.uid===e);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(e){throw a6.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}a6.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){n7(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw a6.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}a6.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,i){n7(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),or(t,"secret");let n=["aes-128-gcm2","aes-256-gcm2"];if(n.includes(e)){if(!r||!(r instanceof Uint8Array&&32===r.length))throw new sr(n8.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new sr(n8.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(n9(i,"encryptDataStream"),!n.includes(e))throw new sr(n8.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||a6.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=oB(r))}async renewToken(e){if(or(e,"token",1,2047),!this._key||!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let r=await this._renewTokenMutex.lock();try{if(aP.USE_NEW_TOKEN){a6.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let t=await u0(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||o1);a6.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else a6.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});a6.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,a6.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?a6.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(oS.VOLUME_INDICATOR,e)},aP.AUDIO_VOLUME_INDICATION_INTERVAL||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new sr(n8.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new sr(n8.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new sr(n8.LIVE_STREAMING_TASK_CONFLICT);let r=t?dt.TRANSCODE:dt.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(dt.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(e));if(!t.length)throw new sr(n8.INVALID_PARAMS,"can not find live streaming url to stop");await Promise.all(t.map(t=>t&&t.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){u5(e);let t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){u5(e);let t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){let e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof lU&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){let t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&["aes-128-gcm2","aes-256-gcm2"].includes(this._encryptionMode)&&(r=!0,e.payload=await aj(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new sr(n8.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(c6.DATA_STREAM,{payload:oB(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-lV},!t)}sendMetadata(e){if(!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new sr(n8.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(c6.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:oB(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(a3),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"can not send custom report, not joined");await st.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){n7(t.spatialLayer,"spatialLayer",[0,1,2,3]),n7(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw a6.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:r}=e;if(n9(t,"apRTM"),oe(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,a6.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(a6.debug("[".concat(this._clientId,"] reset client")),function(e){let t=cB.indexOf(e);-1!==t&&cB.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=nb.Z.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&l6(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&st.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(e=>e._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new o0("client-publish",this._clientId),this._subscribeMutex=new o0("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var r;let i=e||oY();e?a6.debug("[".concat(this._clientId,"] new Session ").concat(i)):a6.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));let n=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,st.addSid(i);let o={lts:(new Date).getTime(),mode:this.mode,buildFormat:3,stringUid:(null==t?void 0:t.stringUid)||(null===(r=this._joinInfo)||void 0===r?void 0:r.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:n,clientRole:"audience"===this.role?2:1};st.sessionInit(this._sessionId,cz({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new sr(n8.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&aP.FORCE_TURN&&!aP.TURN_ENABLE_TCP&&!aP.TURN_ENABLE_UDP)throw new sr(n8.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");a6.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let e=(await r.next()).value;if(e){try{await this._gateway.sendExtensionMessage(dN.PUBLISH,e,!0)}catch(e){throw r.throw(e),e}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let i=(await r.next()).value;if(i){var t;let e;try{e=await this._gateway.publish(this._uid,i,!0)}catch(e){if(e.code!==n8.DISCONNECT_P2P)throw r.throw(e),e}await r.next((null===(t=e)||void 0===t?void 0:t.ortc)||[])}for(let t of(this._p2pChannel.reportPublishEvent(!0,null),e))t instanceof cR&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch(e=>{a6.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===n8.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new sr(n8.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));a6.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await e.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(t){if(t.code!==n8.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=i)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===n8.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){let t=()=>{var e;if(!this._joinInfo||!this._appId)return new sr(n8.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=(e={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},uE("LiveStreaming").create(e));return t.onLiveStreamError=(e,t)=>{st.reportApiInvoke(this._sessionId,{name:oA.ON_LIVE_STREAM_ERROR,options:[e,t],tag:om.TRACER}).onSuccess(),this.safeEmit(oS.LIVE_STREAMING_ERROR,e,t)},t.onLiveStreamWarning=(e,t)=>{st.reportApiInvoke(this._sessionId,{name:oA.ON_LIVE_STREAM_WARNING,options:[e,t],tag:om.TRACER}).onSuccess(),this.safeEmit(oS.LIVE_STREAMING_WARNING,e,t)},t.on(dr.REQUEST_WORKER_MANAGER_LIST,(e,t,r)=>{if(!this._joinInfo)return r(new sr(n8.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,r,i){let n=aP.UAP_AP.slice(0,aP.AJAX_REQUEST_CONCURRENT).map(e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap"));return await function(e,t,r,i,n){ux+=1;let o={service_name:t,json_body:JSON.stringify({sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:ux,requestId:ux,version:ay,cname:r.cname})},a,s,c=e[0];return o6(async()=>{var e,r;a=Date.now();let n=await uI(c,{data:o,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(s=Date.now()-a,0!==n.code){let e=new sr(n8.UNEXPECTED_RESPONSE,"live streaming ap error, code"+n.code,{retry:!0,responseTime:s});throw a6.error(e.toString()),e}let d=JSON.parse(n.json_body);if(200!==d.code){let e=new sr(n8.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(d.code,", reason: ").concat(d.reason),{code:d.code,responseTime:s});throw a6.error(e.toString()),e}if(!d.servers||0===d.servers.length){let e=new sr(n8.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:d.code,responseTime:s});throw a6.error(e.toString()),e}let u=(e=d,r=t,{addressList:e.servers.map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(aP.WORKER_DOMAIN,":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(r))),workerToken:e.workerToken,vid:e.vid});return aP.LIVE_STREAMING_ADDRESS&&(u.addressList=aP.LIVE_STREAMING_ADDRESS instanceof Array?aP.LIVE_STREAMING_ADDRESS:[aP.LIVE_STREAMING_ADDRESS]),cz(cz({},u),{},{responseTime:s})},(i,n)=>(st.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(i.addressList),firstSuccess:0===n,responseTime:s,serverIp:e[n%e.length]}),!1),(i,n)=>(st.apworkerEvent(r.sid,{success:!1,sc:i.data&&i.data.code||200,serviceName:t,responseTime:s,serverIp:e[n%e.length]}),!!(i.code!==n8.OPERATION_ABORTED&&i.code!==n8.UNEXPECTED_RESPONSE||i.data&&i.data.retry)&&(c=e[(n+1)%e.length],!0)),n)}(n,e,t,r,i)})(e,this._joinInfo,this._axiosCancelSource.token,o1).then(t).catch(r)}),t};return e===dt.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){var e;if(!this._joinInfo)return new sr(n8.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},uE("ChannelMediaRelay").create(e));i.on("state",e=>{e===dn.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(oS.CHANNEL_MEDIA_RELAY_STATE,e)}),i.on("event",e=>{this.safeEmit(oS.CHANNEL_MEDIA_RELAY_EVENT,e)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(e,t)=>{var r;"resolution"===e&&(null===(r=this._channelMediaRelayClient)||void 0===r||r.setVideoProfile(t))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:r,deleted:i}=e;if(t){let e=[];this._users.forEach(t=>{t._dataChannels.forEach(i=>{r.every(e=>e.uid!==t._uintid||e.stream_id!==i.id)&&e.push({uid:t._uintid,stream_id:i.id,ordered:i.ordered,max_retrans_times:i.maxRetransmits,metadata:i.metadata})})}),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(r)&&r.length>0&&r.forEach(e=>{let{uid:r,stream_id:i,ordered:n,max_retrans_times:o,metadata:a}=e,s=this._users.find(e=>e._uintid===r);if(!s)return void a6.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(a6.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(r)),s._uintid||(s._uintid=r),!(-1!==s._dataChannels.findIndex(t=>t.id===e.stream_id))){let e={id:i,ordered:!!n,maxRetransmits:o,metadata:a},r=ug(e,!0);s._dataChannels.push(r),a6.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published datachannel")),t||this.safeEmit(oS.USER_PUBLISHED,s,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(s,e.stream_id)&&(a6.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(s.uid," after reconnect.")),this._subscribeDataChannel(s,e.stream_id).catch(e=>{a6.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())}))}),t&&(this.safeEmit(oS.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(e=>{let{uid:t,stream_id:r}=e,i=this._users.find(e=>e._uintid===t);if(!i)return void a6.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let n=i._dataChannels.find(t=>t.id===e.stream_id);n&&(a6.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(i,[n]).then(e=>{if(i._dataChannels=i._dataChannels.filter(e=>e!==n),e)return this._gateway.unsubscribeDataChannel(e,i.uid)}),a6.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(n.id)),this.safeEmit(oS.USER_UNPUBLISHED,i,"datachannel",n._config))})}_handleRemoveDataChannels(e){let t=this._users.find(t=>t.uid===e.uid);if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){a6.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)}),(()=>{a6.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(e=>{this.safeEmit(oS.USER_UNPUBLISHED,t,"datachannel",e._config)})})()}}else a6.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ds.UPDATE_GATEWAY_CONFIG,()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void a6.error("Error loading sdk config",e.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(e=>{let{value:i,type:n,expires:o}=t[e];o&&o<=r||n||cF()||!Object.prototype.hasOwnProperty.call(ak,e)||(ax[e]=i,aP[e]=i,a6.debug("Update gateway parameters from config distribute",e,i))})}catch(e){a6.error("Error update config from local cache",e.message)}}()}),this._gateway.on(ds.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ds.CONNECTION_STATE_CHANGE,(e,t,r)=>{var i,n;if(r===ov.FALLBACK)return;let o=()=>{this.safeEmit(oS.CONNECTION_STATE_CHANGE,e,t,r)};if(st.reportApiInvoke(this._sessionId||(null===(i=this._gateway.joinInfo)||void 0===i?void 0:i.sid)||null,{name:oA.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:om.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),a6.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void o();"RECONNECTING"===e?(this._users.forEach(e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0):"CONNECTED"===e&&(this._streamFallbackTypeCacheMap.forEach((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>{a6.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)})}),this._remoteStreamTypeCacheMap.forEach((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>{a6.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(n=this._joinInfo)||void 0===n?void 0:n.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{a6.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(e=>{a6.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(e=>!e._trust_in_room_).forEach(e=>{a6.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(e=>{e._trust_audio_mute_state_||(a6.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,dv.AUDIO,!1)),e._trust_video_mute_state_||(a6.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,dv.VIDEO,!1)),e._trust_audio_enabled_state_||(a6.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(a6.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(a6.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(a6.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(a6.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3))),o()}),this._gateway.on(ds.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new sr(n8.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;let r=await l2(cz(cz({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(t=r.ap,l3(r),this._joinInfo.preload=!0):(t=await uQ(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||o1,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);let i=[];t.gatewayInfo.gatewayAddrs.forEach(e=>{let{address:t}=e,[r,n]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:r,port:n}):i.push({host:r,port:n})}),e(i)}catch(e){t(e)}}),this._gateway.on(ds.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(oS.NETWORK_QUALITY,e)}),this._gateway.on(ds.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(oS.STREAM_TYPE_CHANGED,e,t),st.reportApiInvoke(this._sessionId,{name:oA.STREAM_TYPE_CHANGE,options:[e,t],tag:om.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(ds.IS_P2P_DISCONNECTED,e=>{e(!!this._p2pChannel.isP2PDisconnected()||!(this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia())&&!0)}),this._gateway.on(ds.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let r=await this._p2pChannel.getEstablishParams();aP.ENABLE_PREALLOC_PC&&r||(r=await this._p2pChannel.startP2PConnection(e)),t(r)}catch(e){r(e)}}),this._gateway.on(ds.JOIN_RESPONSE,(e,t)=>{let r;if(this.store.useP2P)return;e.attributes?r=e.attributes.userAttributes.preSubSsrcs:a6.debug("no attributes in joinResponse");let i=ur(e.ortc,t,r);this._p2pChannel.connect(i)}),this._gateway.on(ds.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:e,cid:n}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(n,"_").concat(e),icePwd:"".concat(n,"_").concat(e)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(i=aP.FINGERPRINT)&&void 0!==i?i:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(c8.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(c8.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(c8.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(c8.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(c8.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(c8.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(c8.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(c8.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(c8.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,dv.AUDIO,!0)),this._gateway.signal.on(c8.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,dv.AUDIO,!1)),this._gateway.signal.on(c8.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,dv.VIDEO,!0)),this._gateway.signal.on(c8.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,dv.VIDEO,!1)),this._gateway.signal.on(c8.RECEIVE_METADATA,e=>{let t=oU(e.metadata);this.safeEmit(oS.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(c8.ON_DATA_STREAM,async e=>{if(!e)return;let t=oU(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&["aes-128-gcm2","aes-256-gcm2"].includes(this._encryptionMode)){if(e.payload.length<10)throw new sr(n8.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(10));t=await aG(this._encryptDataStreamIv,this._encryptDataStreamKey,t)}let r=0;if(e.ordered||e.syncWithAudio){let t=this._p2pChannel.getStats(),i=this.remoteUsers.find(t=>t.uid===e.uid),n=null==t?void 0:t.audioRecv.find(e=>e.ssrc===(null==i?void 0:i._audioSSRC));r=null==n?void 0:n.jitterBufferMs}(null==r||Number.isNaN(r))&&(r=0),function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return lW(i,{uid:e.uid,payload:e.payload});let n="".concat(i.id,"-").concat(e.uid),o=lF.get(n)||[],a=o.findIndex(t=>e.sendTs>=t.sendTs),s=cz(cz({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});-1===a?o.push(s):o.splice(a,0,s),lF.set(n,o);let c=!1;lj.has(n)?c=!(null===(t=lj.get(n))||void 0===t||!t.isSyncing):lj.set(n,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||lG(n)}(cz(cz({},e),{},{payload:t}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(c8.ON_CRYPT_ERROR,()=>{ox(()=>{a6.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(oS.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(c8.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(c8.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{a6.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,ov.TOKEN_EXPIRE),this.safeEmit(oS.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(c8.ON_STREAM_FALLBACK_UPDATE,e=>{a6.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(oS.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(c8.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),a6.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(c8.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(c8.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(c4.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case c6.PUBLISH:{if(!t)return;let e=t.ortc;if(e){var r,i;let n=e.some(e=>{let{stream_type:t}=e;return t===da.Audio}),o=e.some(e=>{let{stream_type:t}=e;return t!==da.Audio}),a=e.some(e=>{let{stream_type:t}=e;return t===da.Screen||t===da.ScreenLow});"offer"===t.state&&st.publish(this._joinInfo.sid,{eventElapse:u6.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:n8.TIMEOUT,audio:n,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:n?null===(r=e.find(e=>{let{stream_type:t}=e;return t===da.Audio}))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0,videoName:o?null===(i=e.find(e=>{let{stream_type:t}=e;return t!==da.Audio}))||void 0===i||null===(i=i.ssrcs[0])||void 0===i?void 0:i.ssrcId.toString():void 0})}break}case c6.SUBSCRIBE:t&&st.subscribe(this._joinInfo.sid,{succ:!1,ec:n8.TIMEOUT,audio:t.stream_type===dv.AUDIO,video:t.stream_type===dv.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:u6.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(c8.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(c8.ON_PUBLISHED_USER_LIST,e=>{if(null==e||!e.users)return;aP.BLOCK_LOCAL_CLIENT&&(e.users=e.users.filter(e=>!cV(e.string_id||e.stream_id,this.channelName)));let t=[],r=[];for(let i of e.users){let e=this._users.find(e=>e._uintid===i.stream_id);e?e._trust_in_room_=!0:(e=new u9(i.string_id||i.stream_id,i.stream_id),this._users.push(e),0===this.getListeners(oS.PUBLISHED_USER_LIST).length&&(a6.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(oS.USER_JOINED,e)));let n=dd.Audio&i.stream_type,o=(dd.Video|dd.LwoVideo)&i.stream_type,a=0!=(65280&i.stream_type),s=n&&e.hasAudio,c=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=i.video_ssrc,e._rtxSsrcId=i.video_rtx),n&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=i.audio_ssrc),n&&!s&&0===this.getListeners(oS.PUBLISHED_USER_LIST).length&&(a6.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(oS.USER_PUBLISHED,e,"audio")),o&&!c&&0===this.getListeners(oS.PUBLISHED_USER_LIST).length&&(a6.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(oS.USER_PUBLISHED,e,"video")),(n&&!s||o&&!c||a)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&r.push({user:e,mediaType:"video"}),n&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&r.push({user:e,mediaType:"audio"})}r.length>0&&(a6.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(e=>{a6.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())})),this.getListeners(oS.PUBLISHED_USER_LIST).length>0?aP.ENABLE_DATASTREAM_2?this._pendingPublishedUsers=t:(a6.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(e=>e.uid).join(", "))),this.safeEmit(oS.PUBLISHED_USER_LIST,t)):a6.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(e=>e.uid).join(", ")))}),this._gateway.signal.on(c8.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof lU&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(e=>e.toLowerCase()).filter(e=>Object.keys(aV).includes(e)))})}_handleP2PEvents(){this._gateway.signal.on(c8.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(dN.PUBLISH,(e,t,r)=>{let{uid:i}=e;e.forEach(e=>{let{kind:n,ssrcs:o,mid:a,isMuted:s}=e;this._handleP2PAddAudioOrVideoStream(n,i,o[0].ssrcId,a);let c=this._users.find(e=>e.uid===i);return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,n,o[0].ssrcId,a).then(()=>{t()}).catch(r):t(),this._handleMuteStream(i,n,!!s)})}),this._gateway.signal.on(dN.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:null===(i=this._joinInfo)||void 0===i?void 0:i.turnServer},e))}catch(e){r(e)}}),this._gateway.signal.on(c4.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(dN.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){let{unpubMsg:i,uid:n}=e,o=this._users.find(e=>e.uid===n);if(!o)return a6.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n)),void t();try{i.forEach(async e=>{let{stream_type:t}=e,r=t===da.Audio?dv.AUDIO:dv.VIDEO;await this._p2pChannel.unsubscribe(o,r),this._handleMuteStream(n,r,!0)}),t()}catch(e){r(e)}}}),this._gateway.signal.on(dN.CONTROL,async(e,t)=>{let{action:r}=e;switch(r){case dP.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,dv.VIDEO,!0);break;case dP.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,dv.AUDIO,!0);break;case dP.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,dv.VIDEO,!1);break;case dP.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,dv.AUDIO,!1)}}),this._gateway.signal.on(dN.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{let{direction:r,iceParameter:i}=e;r!==c5.SEND_ONLY||i?t(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),t())}catch(e){r(e)}}),this._gateway.signal.on(dN.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(dy.RequestP2PRestartICE,async(e,t,r)=>{try{let{direction:r}=e;t(await this._gateway.sendExtensionMessage(dN.RESTART_ICE,e,r===c5.SEND_ONLY))}catch(e){r(e)}}),this._p2pChannel.on(dy.LocalCandidate,e=>{this._gateway.sendExtensionMessage(dN.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(dy.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(dN.CONTROL,e,!0),t()}catch(e){r(e)}}),this._p2pChannel.on(dy.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===n8.DISCONNECT_P2P?t():r(e)}else t()}),this._p2pChannel.on(dy.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===n8.DISCONNECT_P2P?t():r(e)}else t()}),this._p2pChannel.on(dy.StateChange,(e,t)=>{t===dT.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(dy.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(oS.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(dy.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===n8.DISCONNECT_P2P?t():r(e)}else t()}),this._p2pChannel.on(dy.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===n8.DISCONNECT_P2P?t():r(e)}else t()}),this._p2pChannel.on(dy.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(dy.RequestRePublishDataChannel,(e,t,r)=>{Promise.all(e.map(async e=>{let t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach(e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)})}catch(e){if(e.code!==n8.DISCONNECT_P2P)throw e}})).then(t).catch(r)}),this._p2pChannel.on(dy.RequestReSubscribe,async(e,t,r)=>{try{for(let{user:t,kind:r}of e)r===dv.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){r(e)}}),this._p2pChannel.on(dy.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(dy.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(dy.MediaReconnectStart,e=>{this.safeEmit(oS.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(dy.MediaReconnectEnd,e=>{this.safeEmit(oS.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(dy.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(dy.RequestRestartICE,async e=>{let t;if(this.store.useP2P)return;let r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;let n=i.value;try{t=await this._gateway.restartICE({iceParameters:n})}catch(e){return void r.throw(e)}let{iceParameters:o}=function(e){let t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(t);await r.next({remoteIceParameters:o})}),this._p2pChannel.on(dy.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(dy.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:r,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:n,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:i}),a=ur(n,o);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(dy.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(dy.P2PLost,()=>{this.safeEmit(oS.P2P_LOST,this.store.uid)}),this._p2pChannel.on(dy.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(dy.ConnectionTypeChange,e=>{this.safeEmit(oS.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(dy.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(dy.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(dy.AudioMetadata,e=>{this.safeEmit(oS.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){var t;if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let r=(t={config:e},uE("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);let{appId:i,cname:n,sid:o,token:a,uid:s,cid:c,vid:d}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:n,sid:o,token:a,uid:s,cid:c,vid:d?Number(d):0},o1)}catch(e){throw Array.isArray(e)?e[0]:e}}handleVideoInspectEvents(e){e.on(dI.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(oS.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===dR.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(oS.CONTENT_INSPECT_ERROR,new sr(n8.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(dI.INSPECT_RESULT,(e,t)=>{var r;if((null==t?void 0:t.code)===n8.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return a6.debug("Stop inspect content because that has left channel"),null==this||null===(r=this._inspect)||void 0===r||r.close(),void(this._inspect=void 0);this.safeEmit(oS.CONTENT_INSPECT_RESULT,e,t)}),e.on(dI.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}async disableContentInspect(){if(!this._inspect)throw new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(n9(e,"enabled"),e){if(!t)throw new sr(n8.INVALID_PARAMS,"config is required");if(function(e){if(oe(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new sr(n8.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new sr(n8.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}(t),!this._joinInfo)throw new sr(n8.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let e=(r={config:t},uE("ImageModeration").create(r));this._moderation=e,this.handleImageModerationEvents(e);let{appId:i,cname:n,sid:o,token:a,uid:s,cid:c,vid:d}=this._joinInfo;await e.init({appId:i,areaCode:"",cname:n,sid:o,token:a,uid:s,cid:c,vid:d?Number(d):0},o1)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var r;if(!this._moderation)throw new sr(n8.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(dO.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(oS.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===dw.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new sr(n8.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(dO.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}setP2PTransport(e){if(n7(e,"transport",["default","auto","relay","sd-rtn"]),"p2p"!==this.mode)throw new sr(n8.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,a6.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return a6.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){n9(e,"enabled"),aD("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[rp],Object.getOwnPropertyDescriptor(r0.prototype,"leave"),r0.prototype),cG(r0.prototype,"publish",[rf],Object.getOwnPropertyDescriptor(r0.prototype,"publish"),r0.prototype),cG(r0.prototype,"unpublish",[r_],Object.getOwnPropertyDescriptor(r0.prototype,"unpublish"),r0.prototype),cG(r0.prototype,"subscribe",[rA],Object.getOwnPropertyDescriptor(r0.prototype,"subscribe"),r0.prototype),cG(r0.prototype,"presubscribe",[rm],Object.getOwnPropertyDescriptor(r0.prototype,"presubscribe"),r0.prototype),cG(r0.prototype,"massSubscribe",[rv],Object.getOwnPropertyDescriptor(r0.prototype,"massSubscribe"),r0.prototype),cG(r0.prototype,"unsubscribe",[rE],Object.getOwnPropertyDescriptor(r0.prototype,"unsubscribe"),r0.prototype),cG(r0.prototype,"massUnsubscribe",[rg],Object.getOwnPropertyDescriptor(r0.prototype,"massUnsubscribe"),r0.prototype),cG(r0.prototype,"setLowStreamParameter",[rS],Object.getOwnPropertyDescriptor(r0.prototype,"setLowStreamParameter"),r0.prototype),cG(r0.prototype,"enableDualStream",[rb],Object.getOwnPropertyDescriptor(r0.prototype,"enableDualStream"),r0.prototype),cG(r0.prototype,"disableDualStream",[rT],Object.getOwnPropertyDescriptor(r0.prototype,"disableDualStream"),r0.prototype),cG(r0.prototype,"setClientRole",[ry],Object.getOwnPropertyDescriptor(r0.prototype,"setClientRole"),r0.prototype),cG(r0.prototype,"_setClientRoleOptions",[rR],Object.getOwnPropertyDescriptor(r0.prototype,"_setClientRoleOptions"),r0.prototype),cG(r0.prototype,"setProxyServer",[rI],Object.getOwnPropertyDescriptor(r0.prototype,"setProxyServer"),r0.prototype),cG(r0.prototype,"setTurnServer",[rC],Object.getOwnPropertyDescriptor(r0.prototype,"setTurnServer"),r0.prototype),cG(r0.prototype,"setLicense",[rk],Object.getOwnPropertyDescriptor(r0.prototype,"setLicense"),r0.prototype),cG(r0.prototype,"startProxyServer",[rw],Object.getOwnPropertyDescriptor(r0.prototype,"startProxyServer"),r0.prototype),cG(r0.prototype,"stopProxyServer",[rO],Object.getOwnPropertyDescriptor(r0.prototype,"stopProxyServer"),r0.prototype),cG(r0.prototype,"setLocalAccessPointsV2",[rN],Object.getOwnPropertyDescriptor(r0.prototype,"setLocalAccessPointsV2"),r0.prototype),cG(r0.prototype,"setLocalAccessPoints",[rP],Object.getOwnPropertyDescriptor(r0.prototype,"setLocalAccessPoints"),r0.prototype),cG(r0.prototype,"setRemoteDefaultVideoStreamType",[rD],Object.getOwnPropertyDescriptor(r0.prototype,"setRemoteDefaultVideoStreamType"),r0.prototype),cG(r0.prototype,"setRemoteVideoStreamType",[rL],Object.getOwnPropertyDescriptor(r0.prototype,"setRemoteVideoStreamType"),r0.prototype),cG(r0.prototype,"setStreamFallbackOption",[rM],Object.getOwnPropertyDescriptor(r0.prototype,"setStreamFallbackOption"),r0.prototype),cG(r0.prototype,"setEncryptionConfig",[rx],Object.getOwnPropertyDescriptor(r0.prototype,"setEncryptionConfig"),r0.prototype),cG(r0.prototype,"renewToken",[rU],Object.getOwnPropertyDescriptor(r0.prototype,"renewToken"),r0.prototype),cG(r0.prototype,"enableAudioVolumeIndicator",[rB],Object.getOwnPropertyDescriptor(r0.prototype,"enableAudioVolumeIndicator"),r0.prototype),cG(r0.prototype,"startLiveStreaming",[rV],Object.getOwnPropertyDescriptor(r0.prototype,"startLiveStreaming"),r0.prototype),cG(r0.prototype,"setLiveTranscoding",[rF],Object.getOwnPropertyDescriptor(r0.prototype,"setLiveTranscoding"),r0.prototype),cG(r0.prototype,"stopLiveStreaming",[rj],Object.getOwnPropertyDescriptor(r0.prototype,"stopLiveStreaming"),r0.prototype),cG(r0.prototype,"startChannelMediaRelay",[rG],Object.getOwnPropertyDescriptor(r0.prototype,"startChannelMediaRelay"),r0.prototype),cG(r0.prototype,"updateChannelMediaRelay",[rW],Object.getOwnPropertyDescriptor(r0.prototype,"updateChannelMediaRelay"),r0.prototype),cG(r0.prototype,"stopChannelMediaRelay",[rH],Object.getOwnPropertyDescriptor(r0.prototype,"stopChannelMediaRelay"),r0.prototype),cG(r0.prototype,"sendCustomReportMessage",[rY],Object.getOwnPropertyDescriptor(r0.prototype,"sendCustomReportMessage"),r0.prototype),cG(r0.prototype,"pickSVCLayer",[rK],Object.getOwnPropertyDescriptor(r0.prototype,"pickSVCLayer"),r0.prototype),cG(r0.prototype,"setRTMConfig",[rQ],Object.getOwnPropertyDescriptor(r0.prototype,"setRTMConfig"),r0.prototype),cG(r0.prototype,"enableContentInspect",[rz],Object.getOwnPropertyDescriptor(r0.prototype,"enableContentInspect"),r0.prototype),cG(r0.prototype,"disableContentInspect",[rX],Object.getOwnPropertyDescriptor(r0.prototype,"disableContentInspect"),r0.prototype),cG(r0.prototype,"setImageModeration",[rJ],Object.getOwnPropertyDescriptor(r0.prototype,"setImageModeration"),r0.prototype),cG(r0.prototype,"setP2PTransport",[rq],Object.getOwnPropertyDescriptor(r0.prototype,"setP2PTransport"),r0.prototype),cG(r0.prototype,"getJoinChannelServiceRecords",[rZ],Object.getOwnPropertyDescriptor(r0.prototype,"getJoinChannelServiceRecords"),r0.prototype),cG(r0.prototype,"setPublishAudioFilterEnabled",[r$],Object.getOwnPropertyDescriptor(r0.prototype,"setPublishAudioFilterEnabled"),r0.prototype);class hi{constructor(e,t){this.id=0,this.element=void 0,this.peerPair=void 0,this.context=void 0,this.audioPlayerElement=void 0,this.audioTrack=void 0,hi.count+=1,this.id=hi.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{let t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;let e=async(e,t)=>{let r="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(r),"complete"===e.iceGatheringState?e.localDescription:new Promise(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})},t=async(e,t)=>await e.setRemoteDescription(t);try{let r=await e(this.peerPair[0],"offer");await t(this.peerPair[1],r);let i=await e(this.peerPair[1],"answer");await t(this.peerPair[0],i)}catch(e){throw new sr(n8.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){let t;if(this.audioTrack)return this.audioTrack;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new sr(n8.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new sr(n8.LOCAL_AEC_ERROR,"no dest node when local aec").print();let r=t.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){a6.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}hi.count=0;let hn=window.AudioContext||window.webkitAudioContext;new(r2=se({report:st}),cG((r1=class{constructor(){this.units=[],this.context=void 0}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return a6.debug("the system does not need to process local aec"),-1;this.context||(this.context=new hn);let t=this.units.find(t=>t&&t.getElement()===e);return t||(t=new hi(e,this.context),this.units.push(t)),t.startEchoCancellation(),a6.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return nL().name!==nO.SAFARI}}).prototype,"processExternalMediaAEC",[r2],Object.getOwnPropertyDescriptor(r1.prototype,"processExternalMediaAEC"),r1.prototype),r1);let ho=window||document;function ha(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!ho)return;let r=hs._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);let i=e=>{if(!(e&&e.blockedURI&&(hs.onSecurityPolicyViolation||hs.getListeners(dk.SECURITY_POLICY_VIOLATION).length>0)))return;let t=e.blockedURI;aP.CSP_DETECTED_HOSTNAME_LIST.some(e=>t.includes(e))&&(hs.onSecurityPolicyViolation&&"function"==typeof hs.onSecurityPolicyViolation&&hs.onSecurityPolicyViolation(e),hs.getListeners(dk.SECURITY_POLICY_VIOLATION).length>0&&hs.safeEmit(dk.SECURITY_POLICY_VIOLATION,e))};r&&ho.removeEventListener("securitypolicyviolation",r),(t||e&&"function"==typeof e||hs.getListeners(dk.SECURITY_POLICY_VIOLATION).length>0)&&ho.addEventListener("securitypolicyviolation",i),hs._cspEventHandlerPointer=i}aT(),aD("PROCESS_ID","process-".concat(oH(8,""),"-").concat(oH(4,""),"-").concat(oH(4,""),"-").concat(oH(4,""),"-").concat(oH(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void a6.error("Error loading sdk config",e.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();a6.debug("Loading global parameters from cache",t),Object.keys(t).forEach(e=>{if(Object.prototype.hasOwnProperty.call(aP,e)){let{value:i,expires:n}=t[e];(!n||!(n<=r))&&(ax[e]=i,aP[e]=i)}})}catch(t){a6.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ax.AREAS)&&ax.AREAS.length>0&&uM(ax.AREAS,!0);let hs=function(e){let t=new op,r={getListeners:t.getListeners.bind(t),on:(e,r)=>{var i,n;return i=e,n=r,i===dk.SECURITY_POLICY_VIOLATION&&ha(n,!0),t.on.bind(t)(e,r)},addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return cz(cz({},e),r)}({});Object.defineProperties(hs,{onAudioAutoplayFailed:{get:()=>cr.onAudioAutoplayFailed,set:function(e){cr.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>cr.onAutoplayFailed,set:function(e){cr.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>hs._onSecurityPolicyViolation,set(e){hs._onSecurityPolicyViolation=e,ha(e)}},__CLIENT_LIST__:{get:()=>aP.SHOW_GLOBAL_CLIENT_LIST?cU:[]}}),hs.use=e=>((function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&a6.debug("install service ".concat(e.name)),uv[e.name]=e})(e),hs),ce.on(sL.CAMERA_DEVICE_CHANGED,e=>{a6.info("camera device changed",JSON.stringify(e)),hs.onCameraChanged&&hs.onCameraChanged(e),hs.safeEmit(dk.CAMERA_CHANGED,e)}),ce.on(sL.RECORDING_DEVICE_CHANGED,e=>{a6.info("microphone device changed",JSON.stringify(e)),hs.onMicrophoneChanged&&hs.onMicrophoneChanged(e),hs.safeEmit(dk.MICROPHONE_CHANGED,e)}),ce.on(sL.PLAYOUT_DEVICE_CHANGED,e=>{a6.debug("playout device changed",JSON.stringify(e)),hs.onPlaybackDeviceChanged&&hs.onPlaybackDeviceChanged(e),hs.safeEmit(dk.PLAYBACK_DEVICE_CHANGED,e)}),ca.onAutoplayFailed=()=>{a6.info("detect audio element autoplay failed"),cr.onAudioAutoplayFailed&&cr.onAudioAutoplayFailed()},sK.on("autoplay-failed",()=>{a6.info("detect webaudio autoplay failed"),cr.onAudioAutoplayFailed&&cr.onAudioAutoplayFailed(),hs.safeEmit(dk.AUTOPLAY_FAILED)}),sK.on(ss.STATE_CHANGE,(e,t)=>{a6.info("audio context state changed: ".concat(t," => ").concat(e)),hs.onAudioContextStateChanged&&hs.onAudioContextStateChanged(e,t),hs.safeEmit(dk.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),window&&(window.__ARTC__={ESM_BUNDLER:!0,ESM:!1,UMD:!1,DEV:!1,AgoraRTC:hs,__TRACK_LIST__:sA}),ow.on(oy.NETWORK_STATE_CHANGE,(e,t)=>{a6.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))});var hc=r("525825"),hd=r("299570");r("760781"),r("66811");var hu={};hu.d=function(e,t){for(var r in t)hu.o(t,r)&&!hu.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},hu.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},hu.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var hl={};hu.r(hl),hu.d(hl,{checkDenoiserSupport:()=>hE,checkDevicePermission:()=>hh,downsampleTo8000:()=>hA,encodeG711A:()=>hS,encodeG711U:()=>hb,float32ToInt16Array:()=>h_,floatTo16BitPCM:()=>hf,getAudioDevices:()=>hp,isBrowserExtension:()=>hg,isHarmonOS:()=>hv,isMobile:()=>hm,setValueByPath:()=>hT}),r9.disableLogUpload(),r9.setLogLevel(3),r5.logger.setLogLevel(3);let hh=async()=>{let e={audio:!0};try{var t;(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)&&(console.error("Browser does not support mediaDevices API"),e.audio=!1);let r=await (null===(t=navigator.permissions)||void 0===t?void 0:t.query({name:"microphone"}))||{state:"prompt"};if("denied"===r.state&&(console.error("Microphone permission denied"),e.audio=!1),"prompt"===r.state||"granted"===r.state){let e=await navigator.mediaDevices.getUserMedia({audio:!0});e&&e.getTracks().forEach(e=>e.stop())}}catch(t){console.error("Failed to get audio permission:",t),e.audio=!1}return e},hp=async()=>{try{let{audio:e}=await hh();if(!e)throw Error("Microphone permission denied");let t=await navigator.mediaDevices.enumerateDevices();if(!(null==t?void 0:t.length))return{audioInputs:[],audioOutputs:[]};return{audioInputs:t.filter(e=>e.deviceId&&"audioinput"===e.kind),audioOutputs:t.filter(e=>e.deviceId&&"audiooutput"===e.kind)}}catch(e){return console.error("Failed to get audio devices:",e),{audioInputs:[],audioOutputs:[]}}},hf=e=>{let t=new ArrayBuffer(2*e.length),r=new DataView(t),i=0;for(let t=0;t<e.length;t++,i+=2){let n=Math.max(-1,Math.min(1,e[t]));r.setInt16(i,n<0?32768*n:32767*n,!0)}return t};function h_(e){let t=new Int16Array(e.length);for(let r=0;r<e.length;r++){let i=Math.max(-1,Math.min(1,e[r]));t[r]=i<0?32768*i:32767*i}return t}function hA(e){let t=Math.floor(e.length/6),r=new Float32Array(t);for(let i=0;i<t;i++)r[i]=e[Math.floor(6*i)];return r}let hm=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),hv=()=>/harmony|hmos|huawei/i.test(navigator.userAgent),hE=e=>{if(void 0!==window.__denoiserSupported)return window.__denoiserSupported;let t=window.__denoiser||new iS({assetsPath:null!=e?e:"https://lf3-static.bytednsdoc.com/obj/eden-cn/613eh7lpqvhpeuloz/websocket"});return(window.__denoiser=t,t.onloaderror=e=>{console.error("Denoiser load error",e),window.__denoiserSupported=!1},t.checkCompatibility())?(r9.registerExtensions([t]),window.__denoiserSupported=!0,!0):(console.error("Does not support AI Denoiser!"),window.__denoiserSupported=!1,!1)},hg=()=>"undefined"!=typeof chrome&&!!chrome.runtime&&!!chrome.runtime.id;function hS(e){let t=new Uint8Array(e.length),r=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];for(let i=0;i<e.length;i++){let n,o=e[i],a=o<0?0:128;if(0===a&&(o=-o),o>32767&&(o=32767),o<256)n=o>>4;else{let e=r[o>>8&127],t=o>>e+3&15;n=e<<4|t}t[i]=(a|n)^85}return t}function hb(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){let i=e[r],n=i>>8&128;0!==n&&(i=-i),i>32635&&(i=32635),i+=132;let o=7;for(let e=16384;(i&e)==0&&o>0;e>>=1)o--;let a=i>>o+3&15,s=~(n|o<<4|a);t[r]=s}return t}function hT(e,t,r){if(!e||"object"!=typeof e)throw Error("Target must be an object");if(!t)throw Error("Path cannot be empty");let i=t.split("."),n=e;for(let e=0;e<i.length-1;e++){let t=i[e];if("__proto__"===t||"constructor"===t)throw Error(`Invalid key detected: ${t}`);(!n[t]||"object"!=typeof n[t])&&(n[t]={}),n=n[t]}let o=i[i.length-1];if("__proto__"===o||"constructor"===o)throw Error(`Invalid key detected: ${o}`);return n[o]=r,e}let hy=`
class StreamProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.hasStarted = false;
    this.hasInterrupted = false;
    this.outputBuffers = [];
    this.bufferLength = 128;
    this.write = { buffer: new Float32Array(this.bufferLength), trackId: null };
    this.writeOffset = 0;
    this.trackSampleOffsets = {};
    this.volume = 1.0;
    this.port.onmessage = (event) => {
      if (event.data) {
        const payload = event.data;
        if (payload.event === 'write') {
          const int16Array = payload.buffer;
          const float32Array = new Float32Array(int16Array.length);
          for (let i = 0; i < int16Array.length; i++) {
            float32Array[i] = int16Array[i] / 0x8000; // Convert Int16 to Float32
          }
          this.writeData(float32Array, payload.trackId);
        } else if (payload.event === 'volume') {
          this.volume = payload.volume;
        } else if (
          payload.event === 'offset' ||
          payload.event === 'interrupt'
        ) {
          const requestId = payload.requestId;
          const trackId = this.write.trackId;
          const offset = this.trackSampleOffsets[trackId] || 0;
          this.port.postMessage({
            event: 'offset',
            requestId,
            trackId,
            offset,
          });
          if (payload.event === 'interrupt') {
            this.hasInterrupted = true;
          }
        } else {
          throw new Error(\`Unhandled event "\${payload.event}"\`);
        }
      }
    };
  }

  writeData(float32Array, trackId = null) {
    let { buffer } = this.write;
    let offset = this.writeOffset;
    for (let i = 0; i < float32Array.length; i++) {
      buffer[offset++] = float32Array[i];
      if (offset >= buffer.length) {
        this.outputBuffers.push(this.write);
        this.write = { buffer: new Float32Array(this.bufferLength), trackId };
        buffer = this.write.buffer;
        offset = 0;
      }
    }
    this.writeOffset = offset;
    return true;
  }

  process(inputs, outputs, parameters) {
    const output = outputs[0];
    const outputChannelData = output[0];
    const outputBuffers = this.outputBuffers;
    if (this.hasInterrupted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else if (outputBuffers.length) {
      if(!this.hasStarted){
        this.hasStarted = true;
        this.port.postMessage({ event: 'first_frame' });
      }
      const { buffer, trackId } = outputBuffers.shift();
      for (let i = 0; i < outputChannelData.length; i++) {
        outputChannelData[i] = (buffer[i] || 0) * this.volume;
      }
      if (trackId) {
        this.trackSampleOffsets[trackId] =
          this.trackSampleOffsets[trackId] || 0;
        this.trackSampleOffsets[trackId] += buffer.length;
      }
      return true;
    } else if (this.hasStarted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else {
      return true;
    }
  }
}

registerProcessor('stream-processor', StreamProcessor);
`,hR="";if(hg())hR=chrome.runtime.getURL("stream-processor.js");else{let e=new Blob([hy],{type:"application/javascript"});hR=URL.createObjectURL(e)}let hI=hR,hC=class e{async connect(e,t){let r={iceServers:[],iceCandidatePoolSize:1};this.mediaStream=t;let i=new RTCPeerConnection(r);i.onicecandidate=e=>this.onIceCandidate(i,e),i.oniceconnectionstatechange=e=>this.onIceStateChange(i,e),this._debug("Created local peer connection object pc1");let n=new RTCPeerConnection(r);n.onicecandidate=e=>this.onIceCandidate(n,e),n.oniceconnectionstatechange=e=>this.onIceStateChange(n,e),n.ontrack=this.gotRemoteStream,this._debug("Created remote peer connection object pc2");let o=this.applyFilter(e);if(!o){i.close(),n.close();return}o.getTracks().forEach(e=>i.addTrack(e,o)),i.createOffer({iceRestart:!0}).then(this.gotDescription1).catch(e=>console.log(`createOffer failed: ${e}`)),this.pc1=i,this.pc2=n}async checkForReady(){var e,t,r;if(["connected","completed"].includes(null!==(t=null===(e=this.pc1)||void 0===e?void 0:e.iceConnectionState)&&void 0!==t?t:""))return!0;this._debug(`WebRTC connection not ready, current state: ${null===(r=this.pc1)||void 0===r?void 0:r.iceConnectionState}`),await this.sleep(300),await new Promise((e,t)=>{if(!this.pc1||!this.pc2){this._error("WebRTC peer connections not initialized"),t(Error("WebRTC peer connections not initialized"));return}let r=0,i=async()=>{if(++r>=5){this._error("WebRTC connection not ready"),t(Error("WebRTC connection not ready"));return}await this.reconnect()?(this._debug("WebRTC connection reestablished"),e(!0)):setTimeout(()=>{i()},2e3)};setTimeout(()=>{i()},500)})}start(e){if(!this.context||!this.peer){this._error("No audio context or peer found");return}if("running"!==this.context.state){this._error("Audio context is not running");return}if(!this.pc1||!this.pc2){this._error("WebRTC peer connections not initialized");return}this.currentStreamNode=e,e.connect(this.peer),this._debug("local loopback start")}stop(){if(!this.currentStreamNode){this._debug("No active stream to stop");return}try{this.peer&&this.currentStreamNode.disconnect(this.peer),this.currentStreamNode=void 0,this._debug("local loopback stopped")}catch(e){this._error("Error stopping local loopback:",e)}}async reconnect(){this._debug("Reconnecting WebRTC peer connections");let e=this.context,t=this.mediaStream,r=this.currentStreamNode;if(this.pc1&&(this.pc1.onicecandidate=null,this.pc1.oniceconnectionstatechange=null,this.pc1.close(),this.pc1=void 0),this.pc2&&(this.pc2.onicecandidate=null,this.pc2.oniceconnectionstatechange=null,this.pc2.ontrack=null,this.pc2.close(),this.pc2=void 0),await this.sleep(500),e){if(await this.connect(e,t),r&&this.peer){this._debug("Reestablishing audio connection");let e=0;for(;e<10;){if(this.pc1){let e=this.pc1.iceConnectionState;if("connected"===e||"completed"===e)break}await this.sleep(500),e++,this._debug(`Waiting for ICE connection (${e}/10)`)}if(this.pc1){let e=this.pc1.iceConnectionState;if("connected"===e||"completed"===e)return r.connect(this.peer),this.currentStreamNode=r,this._debug("Audio connection reestablished"),!0}return this._warn("Failed to establish ICE connection after multiple attempts"),!1}return!0}return this._error("Cannot reconnect - no audio context available"),!1}sleep(e){return new Promise(t=>setTimeout(t,e))}applyFilter(e){if(!this.mediaStream){this._error("No media stream found");return}return this.context=e,this.mic=this.context.createMediaStreamSource(this.mediaStream),this.peer=this.context.createMediaStreamDestination(),this.mic.connect(this.peer),this.peer.stream}gotRemoteStream(e){if(this._debug("pc2 received remote stream",e.streams[0]),this.remoteAudio.srcObject!==e.streams[0]){this.remoteAudio.srcObject=e.streams[0],this.remoteAudio.muted=!1,this.remoteAudio.volume=.5;let t=this.remoteAudio.play();t&&t.catch(e=>{this._error("Failed to play audio:",e),this._unlockAudioContext()})}}async gotDescription1(e){var t,r,i;this._debug(`Offer from pc1
${e.sdp}`),await (null===(t=this.pc1)||void 0===t?void 0:t.setLocalDescription(e)),await (null===(r=this.pc2)||void 0===r?void 0:r.setRemoteDescription(e)),null===(i=this.pc2)||void 0===i||i.createAnswer().then(this.gotDescription2).catch(e=>console.error(`createAnswer failed: ${e}`))}async gotDescription2(e){var t,r;this._debug(`Answer from pc2
${e.sdp}`),await (null===(t=this.pc2)||void 0===t?void 0:t.setLocalDescription(e)),await (null===(r=this.pc1)||void 0===r?void 0:r.setRemoteDescription(e))}onIceCandidate(e,t){var r;null===(r=this.getOtherPc(e))||void 0===r||r.addIceCandidate(t.candidate).then(()=>this.onAddIceCandidateSuccess(e),t=>this.onAddIceCandidateError(e,t)),this._debug(`${this.getName(e)} ICE candidate:
${t.candidate?t.candidate.candidate:"(null)"}`)}getOtherPc(e){return e===this.pc1?this.pc2:this.pc1}getName(e){return e===this.pc1?"pc1":"pc2"}onAddIceCandidateSuccess(e){this._debug(`${this.getName(e)} addIceCandidate success`)}onAddIceCandidateError(e,t){this._error(`${this.getName(e)} addIceCandidate failed: ${t}`)}onIceStateChange(e,t){e&&(this._debug(`${this.getName(e)} ICE state: ${e.iceConnectionState}`),this._debug("ICE state change event: ",t))}_debug(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.isDebug&&console.log(...t)}_error(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error(...t)}_warn(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];console.warn(...t)}_unlockAudioContext(){let e=document.createElement("audio");e.setAttribute("src","data:audio/mp3;base64,//MkxAAHiAICWABElBeKPL/RANb2w+yiT1g/gTok//lP/W/l3h8QO/OCdCqCW2Cw//MkxAQHkAIWUAhEmAQXWUOFW2dxPu//9mr60ElY5sseQ+xxesmHKtZr7bsqqX2L//MkxAgFwAYiQAhEAC2hq22d3///9FTV6tA36JdgBJoOGgc+7qvqej5EPomQ+RMn/QmSACAv7mcADf//MkxBQHAAYi8AhEAO193vt9KGOq+6qcT7hhfN5FTInmwk8RkqKImTM55pRQHQSq//MkxBsGkgoIAABHhTACIJLf99nVI///yuW1uBqWfEu7CgNPWGpUadBmZ////4sL//MkxCMHMAH9iABEmAsKioqKigsLCwtVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVV//MkxCkECAUYCAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),e.volume=.001;let t=["touchstart","touchend","mousedown","keydown"],r=()=>{this._debug("User interaction detected, trying to unlock audio");let i=e.play();i&&i.catch(()=>{}).then(()=>{let e=this.remoteAudio.play();e&&e.catch(()=>{}),t.forEach(e=>{document.removeEventListener(e,r)}),this._debug("Audio context unlocked")})};t.forEach(e=>{document.addEventListener(e,r),this.eventListeners.push({element:document,event:e,handler:r})}),setTimeout(()=>{this._debug("Attempting initial audio unlock"),r()},100)}cleanup(){if(this._debug("Cleaning up LocalLoopback resources"),this.pc1&&(this.pc1.getSenders().forEach(e=>{e.track&&e.track.stop()}),this.pc1.onicecandidate=null,this.pc1.oniceconnectionstatechange=null,this.pc1.close(),this.pc1=void 0),this.pc2&&(this.pc2.getSenders().forEach(e=>{e.track&&e.track.stop()}),this.pc2.onicecandidate=null,this.pc2.oniceconnectionstatechange=null,this.pc2.close(),this.pc2=void 0),this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{e.stop()}),this.mediaStream=void 0),this.currentStreamNode){try{this.currentStreamNode.disconnect()}catch(e){}this.currentStreamNode=void 0}this.mic&&(this.mic.disconnect(),this.mic=void 0),this.peer&&(this.peer.disconnect(),this.peer=void 0),this.remoteAudio&&(this.remoteAudio.pause(),this.remoteAudio.srcObject=null,this.remoteAudio.parentNode&&this.remoteAudio.parentNode.removeChild(this.remoteAudio)),this.eventListeners.forEach(e=>{let{element:t,event:r,handler:i}=e;t.removeEventListener(r,i)}),this.eventListeners=[],this._debug("LocalLoopback cleanup complete")}constructor(e=!1){this.eventListeners=[],this.remoteAudio=document.createElement("audio"),this.remoteAudio.setAttribute("autoplay","true"),this.remoteAudio.setAttribute("muted","true"),this.remoteAudio.setAttribute("style","display: none"),document.body.appendChild(this.remoteAudio),this.isDebug=e,this._unlockAudioContext(),this.gotDescription1=this.gotDescription1.bind(this),this.gotDescription2=this.gotDescription2.bind(this),this.gotRemoteStream=this.gotRemoteStream.bind(this)}},hk=new Int16Array(256),hw=new Int16Array(256);function hO(e){let t=new Int16Array(e.length);for(let r=0;r<e.length;r++)t[r]=hk[e[r]];return t}function hN(e){let t=new Int16Array(e.length);for(let r=0;r<e.length;r++)t[r]=hw[e[r]];return t}!function(){for(let e=0;e<256;e++){let t=85^e,r=(15&t)<<4,i=(112&t)>>4;i?r=r+264<<i-1:r+=8,hk[e]=128&t?r:-r}for(let e=0;e<256;e++){let t=~e,r=((15&t)<<3)+132;r<<=(112&t)>>4,hw[e]=128&t?132-r:r-132}}();class hP{async connect(){if(this.context=new AudioContext({sampleRate:this.sampleRate}),this.enableLocalLoopback){var e;await (null===(e=this.localLoopback)||void 0===e?void 0:e.connect(this.context,this.localLoopbackStream))}"suspended"===this.context.state&&await this.context.resume();try{await this.context.audioWorklet.addModule(this.scriptSrc)}catch(e){throw console.error(e),Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}return!0}setLocalLoopbackEnable(e){this.enableLocalLoopback=e,this.enableLocalLoopback?(this.localLoopback&&this.localLoopback.cleanup(),this.localLoopback=new hC(!0)):this.localLoopback&&(this.localLoopback.cleanup(),this.localLoopback=void 0)}async pause(){this.context&&!this.isPaused&&(await this.context.suspend(),this.isPaused=!0)}async resume(){this.context&&this.isPaused&&(await this.context.resume(),this.isPaused=!1)}async togglePlay(){this.isPaused?await this.resume():await this.pause()}isPlaying(){return!!(this.context&&this.streamNode&&!this.isPaused&&"running"===this.context.state)}async checkForReady(){this.localLoopback&&!this.context&&(await this._start(),await this.localLoopback.checkForReady())}async _start(){!this.context&&await this.connect();let e=new AudioWorkletNode(this.context,"stream-processor");if(e.port.onmessage=t=>{let{event:r}=t.data;if("stop"===r)this.localLoopback?this.localLoopback.stop():e.disconnect(),this.streamNode=null;else if("offset"===r){let{requestId:e,trackId:r,offset:i}=t.data,n=i/this.sampleRate;this.trackSampleOffsets[e]={trackId:r,offset:i,currentTime:n}}},this.enableLocalLoopback){var t;null===(t=this.localLoopback)||void 0===t||t.start(e)}else e.connect(this.context.destination);return this.streamNode=e,!0}async add16BitPCM(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",i=arguments.length>2?arguments[2]:void 0;if("string"!=typeof r)throw Error("trackId must be a string");this.interruptedTrackIds[r],!this.streamNode&&await this._start();let n=i||this.defaultFormat;if(e instanceof Int16Array)t=e;else if(e instanceof Uint8Array)t="g711a"===n?hO(e):"g711u"===n?hN(e):new Int16Array(e.buffer);else if(e instanceof ArrayBuffer)t="g711a"===n?hO(new Uint8Array(e)):"g711u"===n?hN(new Uint8Array(e)):new Int16Array(e);else throw Error("argument must be Int16Array, Uint8Array, or ArrayBuffer");let o=t.buffer;this.streamNode.port.postMessage({event:"write",buffer:t,trackId:r},[o])}async getTrackSampleOffset(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.streamNode)return null;let r=crypto.randomUUID();for(this.streamNode.port.postMessage({event:t?"interrupt":"offset",requestId:r});!e;)e=this.trackSampleOffsets[r],await new Promise(e=>setTimeout(e,1));let{trackId:i}=e;return t&&i&&(this.interruptedTrackIds[i]=!0),e}async interrupt(){return this.getTrackSampleOffset(!0)}setMediaStream(e){this.localLoopbackStream=e}async addG711a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";await this.add16BitPCM(e,t,"g711a")}async addG711u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";await this.add16BitPCM(e,t,"g711u")}setSampleRate(e){this.sampleRate=e}setDefaultFormat(e){this.defaultFormat=e}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.streamNode&&this.streamNode.port.postMessage({event:"volume",volume:this.volume})}getVolume(){return this.volume}async destroy(){this.streamNode&&(this.streamNode.disconnect(),this.streamNode=null),this.localLoopback&&(this.localLoopback.cleanup(),this.localLoopback=void 0),this.context&&(await this.context.close(),this.context=null),this.trackSampleOffsets={},this.interruptedTrackIds={},this.isPaused=!1}constructor({sampleRate:e=44100,enableLocalLoopback:t=!1,defaultFormat:r="pcm",volume:i=1}={}){this.volume=1,this.scriptSrc=hI,this.sampleRate=e,this.context=null,this.streamNode=null,this.trackSampleOffsets={},this.interruptedTrackIds={},this.isPaused=!1,this.enableLocalLoopback=t,this.defaultFormat=r,this.enableLocalLoopback&&(this.localLoopback=new hC(!0)),this.volume=i}}let hD=`
class AudioProcessor extends AudioWorkletProcessor {

  constructor() {
    super();
    this.port.onmessage = this.receive.bind(this);
    this.initialize();
  }

  initialize() {
    this.foundAudio = false;
    this.recording = false;
    this.chunks = [];
  }

  /**
   * Concatenates sampled chunks into channels
   * Format is chunk[Left[], Right[]]
   */
  readChannelData(chunks, channel = -1, maxChannels = 9) {
    let channelLimit;
    if (channel !== -1) {
      if (chunks[0] && chunks[0].length - 1 < channel) {
        throw new Error(
          \`Channel \${channel} out of range: max \${chunks[0].length}\`
        );
      }
      channelLimit = channel + 1;
    } else {
      channel = 0;
      channelLimit = Math.min(chunks[0] ? chunks[0].length : 1, maxChannels);
    }
    const channels = [];
    for (let n = channel; n < channelLimit; n++) {
      const length = chunks.reduce((sum, chunk) => {
        return sum + chunk[n].length;
      }, 0);
      const buffers = chunks.map((chunk) => chunk[n]);
      const result = new Float32Array(length);
      let offset = 0;
      for (let i = 0; i < buffers.length; i++) {
        result.set(buffers[i], offset);
        offset += buffers[i].length;
      }
      channels[n] = result;
    }
    return channels;
  }

  /**
   * Combines parallel audio data into correct format,
   * channels[Left[], Right[]] to float32Array[LRLRLRLR...]
   */
  formatAudioData(channels) {
    if (channels.length === 1) {
      // Simple case is only one channel
      const float32Array = channels[0].slice();
      const meanValues = channels[0].slice();
      return { float32Array, meanValues };
    } else {
      const float32Array = new Float32Array(
        channels[0].length * channels.length
      );
      const meanValues = new Float32Array(channels[0].length);
      for (let i = 0; i < channels[0].length; i++) {
        const offset = i * channels.length;
        let meanValue = 0;
        for (let n = 0; n < channels.length; n++) {
          float32Array[offset + n] = channels[n][i];
          meanValue += channels[n][i];
        }
        meanValues[i] = meanValue / channels.length;
      }
      return { float32Array, meanValues };
    }
  }

  /**
   * Converts 32-bit float data to 16-bit integers
   */
  floatTo16BitPCM(float32Array) {
    const buffer = new ArrayBuffer(float32Array.length * 2);
    const view = new DataView(buffer);
    let offset = 0;
    for (let i = 0; i < float32Array.length; i++, offset += 2) {
      let s = Math.max(-1, Math.min(1, float32Array[i]));
      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
    }
    return buffer;
  }

  /**
   * Retrieves the most recent amplitude values from the audio stream
   * @param {number} channel
   */
  getValues(channel = -1) {
    const channels = this.readChannelData(this.chunks, channel);
    const { meanValues } = this.formatAudioData(channels);
    return { meanValues, channels };
  }

  /**
   * Exports chunks as an audio/wav file
   */
  export() {
    const channels = this.readChannelData(this.chunks);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const audioData = this.floatTo16BitPCM(float32Array);
    return {
      meanValues: meanValues,
      audio: {
        bitsPerSample: 16,
        channels: channels,
        data: audioData,
      },
    };
  }

  receive(e) {
    const { event, id } = e.data;
    let receiptData = {};
    switch (event) {
      case 'start':
        this.recording = true;
        break;
      case 'stop':
        this.recording = false;
        break;
      case 'clear':
        this.initialize();
        break;
      case 'export':
        receiptData = this.export();
        break;
      case 'read':
        receiptData = this.getValues();
        break;
      default:
        break;
    }
    // Always send back receipt
    this.port.postMessage({ event: 'receipt', id, data: receiptData });
  }

  sendChunk(chunk) {
    const channels = this.readChannelData([chunk]);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const rawAudioData = this.floatTo16BitPCM(float32Array);
    const monoAudioData = this.floatTo16BitPCM(meanValues);
    this.port.postMessage({
      event: 'chunk',
      data: {
        mono: monoAudioData,
        raw: rawAudioData,
      },
    });
  }

  process(inputList, outputList, parameters) {
    // Copy input to output (e.g. speakers)
    // Note that this creates choppy sounds with Mac products
    const sourceLimit = Math.min(inputList.length, outputList.length);
    for (let inputNum = 0; inputNum < sourceLimit; inputNum++) {
      const input = inputList[inputNum];
      const output = outputList[inputNum];
      const channelCount = Math.min(input.length, output.length);
      for (let channelNum = 0; channelNum < channelCount; channelNum++) {
        input[channelNum].forEach((sample, i) => {
          output[channelNum][i] = sample;
        });
      }
    }
    const inputs = inputList[0];
    // There's latency at the beginning of a stream before recording starts
    // Make sure we actually receive audio data before we start storing chunks
    let sliceIndex = 0;
    if (!this.foundAudio) {
      for (const channel of inputs) {
        sliceIndex = 0; // reset for each channel
        if (this.foundAudio) {
          break;
        }
        if (channel) {
          for (const value of channel) {
            if (value !== 0) {
              // find only one non-zero entry in any channel
              this.foundAudio = true;
              break;
            } else {
              sliceIndex++;
            }
          }
        }
      }
    }
    if (inputs && inputs[0] && this.foundAudio && this.recording) {
      // We need to copy the TypedArray, because the \`process\`
      // internals will reuse the same buffer to hold each input
      const chunk = inputs.map((input) => input.slice(sliceIndex));
      this.chunks.push(chunk);
      this.sendChunk(chunk);
    }
    return true;
  }
}

registerProcessor('audio_processor', AudioProcessor);
`;if(hg())chrome.runtime.getURL("audio_processor.js");else{let e=new Blob([hD],{type:"application/javascript"});URL.createObjectURL(e)}let hL=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],hM=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],hx=[],hU=[];for(let e=1;e<=8;e++)for(let t=0;t<hL.length;t++){let r=hL[t];hx.push(r/Math.pow(2,8-e)),hU.push(hM[t]+e)}let hB=[32,2e3];hx.filter((e,t)=>hx[t]>32&&hx[t]<2e3),hU.filter((e,t)=>hx[t]>32&&hx[t]<2e3);class hV{constructor(e){this._client=e}}class hF extends hV{async create(e,t){return(await this._client.post("/v1/bot/create",e,!1,t)).data}async update(e,t){return(await this._client.post("/v1/bot/update",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/space/published_bots_list",e,!1,t)).data}async listNew(e,t){return(await this._client.get("/v1/bots",e,!1,t)).data}async publish(e,t){return(await this._client.post("/v1/bot/publish",e,!1,t)).data}async retrieve(e,t){return(await this._client.get("/v1/bot/get_online_info",e,!1,t)).data}async retrieveNew(e,t,r){let i=`/v1/bots/${e}`;return(await this._client.get(i,t,!1,r)).data}}function hj(){return"undefined"!=typeof uni}function hG(){return"undefined"!=typeof window}function hW(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((e,t)=>{if(void 0===t)return e||{};for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(function(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);if(null===t)return!0;let r=t;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return t===r}(t[r])&&!Array.isArray(t[r])?e[r]=hW(e[r]||{},t[r]):e[r]=t[r]);return e},{})}function hH(e,t){let r=Object.entries(t||{}).filter(e=>{let[t,r]=e;return null!=r&&""!==r}).map(e=>{let[t,r]=e;return`${t}=${r}`}).join("&");return`${e}${r?`?${r}`:""}`}let hY=()=>"undefined"!=typeof chrome&&!!chrome.runtime&&!!chrome.runtime.id;class hK extends Error{}class hQ extends hK{static makeMessage(e,t,r,i){if(!t&&r)return r;if(t){let e=[],{code:r,msg:n,error:o}=t;r&&e.push(`code: ${r}`),n&&e.push(`msg: ${n}`),(null==o?void 0:o.detail)&&n!==o.detail&&e.push(`detail: ${o.detail}`);let a=(null==o?void 0:o.logid)||(null==i?void 0:i["x-tt-logid"]);return a&&e.push(`logid: ${a}`),e.join(", ")}return e?`http status code: ${e} (no body)`:"(no status code or body)"}static generate(e,t,r,i){return e?400===e||(null==t?void 0:t.code)===4e3?new hJ(e,t,r,i):401===e||(null==t?void 0:t.code)===4100?new hq(e,t,r,i):403===e||(null==t?void 0:t.code)===4101?new hZ(e,t,r,i):404===e||(null==t?void 0:t.code)===4200?new h$(e,t,r,i):429===e||(null==t?void 0:t.code)===4013?new h2(e,t,r,i):408===e?new h0(e,t,r,i):502===e?new h4(e,t,r,i):e>=500?new h1(e,t,r,i):new hQ(e,t,r,i):new hz({cause:h6(t)})}constructor(e,t,r,i){var n,o;super(`${hQ.makeMessage(e,t,r,i)}`),this.status=e,this.headers=i,this.logid=(null==t?void 0:null===(n=t.detail)||void 0===n?void 0:n.logid)||(null==i?void 0:i["x-tt-logid"]),this.code=null==t?void 0:t.code,this.msg=null==t?void 0:t.msg,this.detail=null==t?void 0:null===(o=t.error)||void 0===o?void 0:o.detail,this.rawError=t}}class hz extends hQ{constructor({message:e}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0}}class hX extends hQ{constructor(e){super(void 0,void 0,e||"Request was aborted.",void 0),this.name="UserAbortError",this.status=void 0}}class hJ extends hQ{constructor(...e){super(...e),this.name="BadRequestError",this.status=400}}class hq extends hQ{constructor(...e){super(...e),this.name="AuthenticationError",this.status=401}}class hZ extends hQ{constructor(...e){super(...e),this.name="PermissionDeniedError",this.status=403}}class h$ extends hQ{constructor(...e){super(...e),this.name="NotFoundError",this.status=404}}class h0 extends hQ{constructor(...e){super(...e),this.name="TimeoutError",this.status=408}}class h2 extends hQ{constructor(...e){super(...e),this.name="RateLimitError",this.status=429}}class h1 extends hQ{constructor(...e){super(...e),this.name="InternalServerError",this.status=500}}class h4 extends hQ{constructor(...e){super(...e),this.name="GatewayError",this.status=502}}let h6=e=>e instanceof Error?e:Error(e);class h3 extends hV{async list(e,t,r){let i=`/v3/chat/message/list?conversation_id=${e}&chat_id=${t}`;return(await this._client.get(i,void 0,!1,r)).data}}let h8=()=>(Math.random()*new Date().getTime()).toString(),h5=e=>null==e?void 0:e.map(e=>({...e,content:"object"==typeof e.content?JSON.stringify(e.content):e.content})),h9=e=>{if(e)for(let[t,r]of Object.entries(e))"object"==typeof r&&(e[t]=JSON.stringify(r));return e};class h7 extends hV{async create(e,t){!e.user_id&&(e.user_id=h8());let{conversation_id:r,...i}=e,n=`/v3/chat${r?`?conversation_id=${r}`:""}`,o={...i,additional_messages:h5(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:h9(e.shortcut_command.parameters)}:void 0,stream:!1};return(await this._client.post(n,o,!1,t)).data}async createAndPoll(e,t){let r;!e.user_id&&(e.user_id=h8());let{conversation_id:i,...n}=e,o=`/v3/chat${i?`?conversation_id=${i}`:""}`,a={...n,additional_messages:h5(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:h9(e.shortcut_command.parameters)}:void 0,stream:!1},s=await this._client.post(o,a,!1,t),c=s.data.id,d=s.data.conversation_id;for(;await new Promise(e=>{setTimeout(e,100)}),"completed"!==(r=await this.retrieve(d,c)).status&&"failed"!==r.status&&"requires_action"!==r.status;);return{chat:r,messages:await this.messages.list(d,c)}}async *stream(e,t){!e.user_id&&(e.user_id=h8());let{conversation_id:r,...i}=e,n=`/v3/chat${r?`?conversation_id=${r}`:""}`,o={...i,additional_messages:h5(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:h9(e.shortcut_command.parameters)}:void 0,stream:!0};for await(let e of(await this._client.post(n,o,!0,t)))if("done"===e.event){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new hK(`Could not parse message into JSON:${e.data}`)}}async retrieve(e,t,r){let i=`/v3/chat/retrieve?conversation_id=${e}&chat_id=${t}`;return(await this._client.post(i,void 0,!1,r)).data}async cancel(e,t,r){return(await this._client.post("/v3/chat/cancel",{conversation_id:e,chat_id:t},!1,r)).data}async *submitToolOutputs(e,t){let{conversation_id:r,chat_id:i,...n}=e,o=`/v3/chat/submit_tool_outputs?conversation_id=${e.conversation_id}&chat_id=${e.chat_id}`,a={...n};if(!1===e.stream)return(await this._client.post(o,a,!1,t)).data;for await(let e of(await this._client.post(o,a,!0,t)))if("done"===e.event){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new hK(`Could not parse message into JSON:${e.data}`)}}constructor(...e){super(...e),this.messages=new h3(this._client)}}var pe=((eJ={}).CONVERSATION_CHAT_CREATED="conversation.chat.created",eJ.CONVERSATION_CHAT_IN_PROGRESS="conversation.chat.in_progress",eJ.CONVERSATION_CHAT_COMPLETED="conversation.chat.completed",eJ.CONVERSATION_CHAT_FAILED="conversation.chat.failed",eJ.CONVERSATION_CHAT_REQUIRES_ACTION="conversation.chat.requires_action",eJ.CONVERSATION_MESSAGE_DELTA="conversation.message.delta",eJ.CONVERSATION_MESSAGE_COMPLETED="conversation.message.completed",eJ.CONVERSATION_AUDIO_DELTA="conversation.audio.delta",eJ.DONE="done",eJ.ERROR="error",eJ);class pt extends hV{async create(e,t,r){let i=`/v1/conversation/message/create?conversation_id=${e}`;return(await this._client.post(i,t,!1,r)).data}async update(e,t,r,i){let n=`/v1/conversation/message/modify?conversation_id=${e}&message_id=${t}`;return(await this._client.post(n,r,!1,i)).message}async retrieve(e,t,r){let i=`/v1/conversation/message/retrieve?conversation_id=${e}&message_id=${t}`;return(await this._client.get(i,null,!1,r)).data}async list(e,t,r){let i=`/v1/conversation/message/list?conversation_id=${e}`;return await this._client.post(i,t,!1,r)}async delete(e,t,r){let i=`/v1/conversation/message/delete?conversation_id=${e}&message_id=${t}`;return(await this._client.post(i,void 0,!1,r)).data}}class pr extends hV{async create(e,t){return(await this._client.post("/v1/conversation/create",e,!1,t)).data}async retrieve(e,t){let r=`/v1/conversation/retrieve?conversation_id=${e}`;return(await this._client.get(r,null,!1,t)).data}async list(e,t){return(await this._client.get("/v1/conversations",e,!1,t)).data}async clear(e,t){let r=`/v1/conversations/${e}/clear`;return(await this._client.post(r,null,!1,t)).data}constructor(...e){super(...e),this.messages=new pt(this._client)}}class pi extends hV{async upload(e,t){return(await this._client.post("/v1/files/upload",(0,iC.k5)(e),!1,t)).data}async retrieve(e,t){let r=`/v1/files/retrieve?file_id=${e}`;return(await this._client.get(r,null,!1,t)).data}}class pn extends hV{async create(e,t){return await this._client.post("/v1/workflow/run",e,!1,t)}async *stream(e,t){for await(let r of(await this._client.post("/v1/workflow/stream_run",e,!0,t)))try{"Done"===r.event?yield new po(Number(r.id),"Done"):yield new po(Number(r.id),r.event,JSON.parse(r.data))}catch(e){throw new hK(`Could not parse message into JSON:${r.data}`)}}async *resume(e,t){for await(let r of(await this._client.post("/v1/workflow/stream_resume",e,!0,t)))try{"Done"===r.event?yield new po(Number(r.id),"Done"):yield new po(Number(r.id),r.event,JSON.parse(r.data))}catch(e){throw new hK(`Could not parse message into JSON:${r.data}`)}}async history(e,t,r){let i=`/v1/workflows/${e}/run_histories/${t}`;return(await this._client.get(i,void 0,!1,r)).data}}class po{constructor(e,t,r){this.id=e,this.event=t,this.data=r}}class pa extends hV{async *stream(e,t){let r={...e,additional_messages:h5(e.additional_messages)};for await(let e of(await this._client.post("/v1/workflows/chat",r,!0,t)))if(e.event===pe.DONE){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new hK(`Could not parse message into JSON:${e.data}`)}}}class ps extends hV{constructor(...e){super(...e),this.runs=new pn(this._client),this.chat=new pa(this._client)}}class pc extends hV{async list(e,t){let r=await this._client.get("/v1/workspaces",e,!1,t);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{return JSON.parse(e)}catch(e){return t}}(r,r).data}}let pd={"agw-js-conv":"str"};class pu extends hV{list(e,t){return this._client.get("/open_api/knowledge/document/list",e,!1,hW(t,{headers:pd}))}async create(e,t){return(await this._client.post("/open_api/knowledge/document/create",e,!1,hW(t,{headers:pd}))).document_infos}async delete(e,t){await this._client.post("/open_api/knowledge/document/delete",e,!1,hW(t,{headers:pd}))}async update(e,t){await this._client.post("/open_api/knowledge/document/update",e,!1,hW(t,{headers:pd}))}}class pl extends hV{constructor(...e){super(...e),this.documents=new pu(this._client)}}let ph={"agw-js-conv":"str"};class pp extends hV{async list(e,t){return await this._client.post("/open_api/knowledge/document/list",e,!1,hW(t,{headers:ph}))}async create(e,t){return(await this._client.post("/open_api/knowledge/document/create",e,!1,hW(t,{headers:ph}))).document_infos}async delete(e,t){await this._client.post("/open_api/knowledge/document/delete",e,!1,hW(t,{headers:ph}))}async update(e,t){await this._client.post("/open_api/knowledge/document/update",e,!1,hW(t,{headers:ph}))}}class pf extends hV{async update(e,t,r,i){let n=`/v1/datasets/${e}/images/${t}`;await this._client.put(n,r,!1,i)}async list(e,t,r){let i=`/v1/datasets/${e}/images`;return(await this._client.get(i,t,!1,r)).data}}class p_ extends hV{async create(e,t){return(await this._client.post("/v1/datasets",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/datasets",e,!1,t)).data}async update(e,t,r){let i=`/v1/datasets/${e}`;await this._client.put(i,t,!1,r)}async delete(e,t){let r=`/v1/datasets/${e}`;await this._client.delete(r,!1,t)}async process(e,t,r){let i=`/v1/datasets/${e}/process`;return(await this._client.post(i,t,!1,r)).data}constructor(...e){super(...e),this.documents=new pp(this._client),this.images=new pf(this._client)}}class pA extends hV{async clone(e,t){return(await this._client.post("/v1/audio/voices/clone",(0,iC.k5)(e),!1,t)).data}async list(e,t){return(await this._client.get("/v1/audio/voices",e,!1,t)).data}}class pm extends hV{async create(e,t){return(await this._client.post("/v1/audio/transcriptions",(0,iC.k5)(e),!1,t)).data}}class pv extends hV{async create(e,t){return await this._client.post("/v1/audio/speech",{...e,sample_rate:e.sample_rate||24e3},!1,hW(t,{responseType:"arraybuffer"}))}}class pE extends hV{async create(e,t){return(await this._client.post("/v1/audio/rooms",e,!1,t)).data}}class pg extends hV{async create(e,t,r){let i=`/v1/audio/voiceprint_groups/${e}/features`;return(await this._client.post(i,(0,iC.k5)(t),!1,r)).data}async update(e,t,r,i){let n=`/v1/audio/voiceprint_groups/${e}/features/${t}`;return(await this._client.put(n,(0,iC.k5)(r),!1,i)).data}async delete(e,t,r){let i=`/v1/audio/voiceprint_groups/${e}/features/${t}`;return(await this._client.delete(i,!1,r)).data}async list(e,t,r){let i=`/v1/audio/voiceprint_groups/${e}/features`;return(await this._client.get(i,t,!1,r)).data}async speakerIdentify(e,t,r){let i=`/v1/audio/voiceprint_groups/${e}/speaker_identify`;return(await this._client.post(i,(0,iC.k5)(t),!1,r)).data}}class pS extends hV{async create(e,t){return(await this._client.post("/v1/audio/voiceprint_groups",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/audio/voiceprint_groups",e,!1,t)).data}async update(e,t,r){let i=`/v1/audio/voiceprint_groups/${e}`;return(await this._client.put(i,t,!1,r)).data}async delete(e,t){let r=`/v1/audio/voiceprint_groups/${e}`;return(await this._client.delete(r,!1,t)).data}constructor(...e){super(...e),this.features=new pg(this._client)}}class pb extends hV{async retrieve(e,t){let r=`/v1/audio/live/${e}`;return(await this._client.get(r,void 0,!1,t)).data}}class pT extends hV{constructor(...e){super(...e),this.rooms=new pE(this._client),this.live=new pb(this._client),this.voices=new pA(this._client),this.speech=new pv(this._client),this.transcriptions=new pm(this._client),this.voiceprintGroups=new pS(this._client)}}class py extends hV{async duplicate(e,t,r){let i=`/v1/templates/${e}/duplicate`;return(await this._client.post(i,t,!1,r)).data}}class pR extends hV{async create(e,t){let r=hH("/v1/chat",e);return await this._client.makeWebsocket(r,t)}}class pI extends hV{async create(e,t){let r=hH("/v1/audio/transcriptions",e);return await this._client.makeWebsocket(r,t)}}class pC extends hV{async create(e,t){let r=hH("/v1/audio/speech",e);return await this._client.makeWebsocket(r,t)}}class pk extends hV{async create(e){return await this._client.makeWebsocket("/v1/audio/simult_interpretation",e)}}class pw extends hV{constructor(...e){super(...e),this.speech=new pC(this._client),this.transcriptions=new pI(this._client),this.simultInterpretation=new pk(this._client)}}var pO=((eq={}).CLIENT_ERROR="client_error",eq.CLOSED="closed",eq.ALL="all",eq.ERROR="error",eq.INPUT_TEXT_BUFFER_APPEND="input_text_buffer.append",eq.INPUT_TEXT_BUFFER_COMPLETE="input_text_buffer.complete",eq.SPEECH_UPDATE="speech.update",eq.SPEECH_UPDATED="speech.updated",eq.SPEECH_CREATED="speech.created",eq.INPUT_TEXT_BUFFER_COMPLETED="input_text_buffer.completed",eq.SPEECH_AUDIO_UPDATE="speech.audio.update",eq.SPEECH_AUDIO_COMPLETED="speech.audio.completed",eq.INPUT_AUDIO_BUFFER_APPEND="input_audio_buffer.append",eq.INPUT_AUDIO_BUFFER_COMPLETE="input_audio_buffer.complete",eq.TRANSCRIPTIONS_UPDATE="transcriptions.update",eq.INPUT_AUDIO_BUFFER_CLEAR="input_audio_buffer.clear",eq.TRANSCRIPTIONS_CREATED="transcriptions.created",eq.INPUT_AUDIO_BUFFER_COMPLETED="input_audio_buffer.completed",eq.TRANSCRIPTIONS_MESSAGE_UPDATE="transcriptions.message.update",eq.TRANSCRIPTIONS_MESSAGE_COMPLETED="transcriptions.message.completed",eq.INPUT_AUDIO_BUFFER_CLEARED="input_audio_buffer.cleared",eq.TRANSCRIPTIONS_UPDATED="transcriptions.updated",eq.CHAT_UPDATE="chat.update",eq.CONVERSATION_CHAT_SUBMIT_TOOL_OUTPUTS="conversation.chat.submit_tool_outputs",eq.CHAT_CREATED="chat.created",eq.CHAT_UPDATED="chat.updated",eq.CONVERSATION_CHAT_CREATED="conversation.chat.created",eq.CONVERSATION_MESSAGE_CREATE="conversation.message.create",eq.CONVERSATION_CLEAR="conversation.clear",eq.CONVERSATION_CHAT_IN_PROGRESS="conversation.chat.in_progress",eq.CONVERSATION_MESSAGE_DELTA="conversation.message.delta",eq.CONVERSATION_CHAT_REQUIRES_ACTION="conversation.chat.requires_action",eq.CONVERSATION_MESSAGE_COMPLETED="conversation.message.completed",eq.CONVERSATION_AUDIO_DELTA="conversation.audio.delta",eq.CONVERSATION_AUDIO_COMPLETED="conversation.audio.completed",eq.CONVERSATION_CHAT_COMPLETED="conversation.chat.completed",eq.CONVERSATION_CHAT_FAILED="conversation.chat.failed",eq.CONVERSATION_CLEARED="conversation.cleared",eq.INPUT_AUDIO_BUFFER_SPEECH_STARTED="input_audio_buffer.speech_started",eq.INPUT_AUDIO_BUFFER_SPEECH_STOPPED="input_audio_buffer.speech_stopped",eq.CONVERSATION_CHAT_CANCEL="conversation.chat.cancel",eq.CONVERSATION_CHAT_CANCELED="conversation.chat.canceled",eq.CONVERSATION_AUDIO_TRANSCRIPT_UPDATE="conversation.audio_transcript.update",eq.CONVERSATION_AUDIO_TRANSCRIPT_COMPLETED="conversation.audio_transcript.completed",eq.CONVERSATION_AUDIO_SENTENCE_START="conversation.audio.sentence_start",eq.DUMP_AUDIO="dump.audio",eq.SIMULT_INTERPRETATION_UPDATE="simult_interpretation.update",eq.SIMULT_INTERPRETATION_CREATED="simult_interpretation.created",eq.SIMULT_INTERPRETATION_UPDATED="simult_interpretation.updated",eq.SIMULT_INTERPRETATION_AUDIO_DELTA="simult_interpretation.audio.delta",eq.SIMULT_INTERPRETATION_TRANSCRIPTION_DELTA="simult_interpretation.transcription.delta",eq.SIMULT_INTERPRETATION_TRANSLATION_DELTA="simult_interpretation.translation.delta",eq.SIMULT_INTERPRETATION_MESSAGE_COMPLETED="simult_interpretation.message.completed",eq);class pN extends hV{constructor(...e){super(...e),this.audio=new pw(this._client),this.chat=new pR(this._client)}}class pP extends hV{async update(e,t){await this._client.put("/v1/variables",e,!1,t)}async retrieve(e,t){return(await this._client.get("/v1/variables",e,!1,t)).data}}class pD extends hV{async me(e){return(await this._client.get("/v1/users/me",void 0,!1,e)).data}}class pL{get readyState(){return this.rws.readyState}send(e){return this.rws.send(JSON.stringify(e))}close(e,t){return this.rws.close(e,t)}reconnect(e,t){return this.rws.reconnect(e,t)}addEventListener(e,t){this.rws.addEventListener(e,t)}removeEventListener(e,t){this.rws.removeEventListener(e,t)}constructor(e,t={}){let r;this.onmessage=null,this.onopen=null,this.onclose=null,this.onerror=null;let i=e.includes("?")?"&":"?",{authorization:n}=t.headers||{};if(hj()){let e="function"==typeof getMiniAppWebSocketFactory?getMiniAppWebSocketFactory():null;r=e?e.getWebSocketImplementation():window.WebSocket}else r=hG()?window.WebSocket:class extends iw{constructor(e,r){super(e,r,{headers:t.headers})}};this.rws=new iO.Z(`${e}${i}authorization=${n}`,[],{WebSocket:r,...t}),this.rws.addEventListener("message",e=>{try{var t;let r=JSON.parse(e.data);null===(t=this.onmessage)||void 0===t||t.call(this,r,e)}catch(e){console.error("WebSocketAPI onmessage error",e)}}),this.rws.addEventListener("open",e=>{var t;null===(t=this.onopen)||void 0===t||t.call(this,e)}),this.rws.addEventListener("close",e=>{var t;null===(t=this.onclose)||void 0===t||t.call(this,e)}),this.rws.addEventListener("error",e=>{var t,r,i,n,o,a,s,c;let{readyState:d}=this.rws;if(3===d)return;let u=null===(i=e.target)||void 0===i?void 0:null===(r=i._req)||void 0===r?void 0:null===(t=r.res)||void 0===t?void 0:t.statusCode,l=(null===(a=e.target)||void 0===a?void 0:null===(o=a._req)||void 0===o?void 0:null===(n=o.res)||void 0===n?void 0:n.rawHeaders)||[],h=l.findIndex(e=>"X-Tt-Logid"===e),p=-1!==h?l[h+1]:void 0,f={id:"0",event_type:pO.ERROR,data:{code:-1,msg:"WebSocket error"},detail:{logid:p}};401===u?(f.data.code=401,f.data.msg="Unauthorized"):403===u?(f.data.code=403,f.data.msg="Forbidden"):(f.data.code=500,f.data.msg=String(null!==(c=null==e?void 0:e.error)&&void 0!==c?c:"")||"WebSocket error"),null===(s=this.onerror)||void 0===s||s.call(this,f,e)})}}let{version:pM}=JSON.parse('{"name":"@coze/api","version":"1.3.6-alpha.2","description":"Official Coze Node.js SDK for seamless AI integration into your applications | \u6263\u5B50\u5B98\u65B9 Node.js SDK\uFF0C\u52A9\u60A8\u8F7B\u677E\u96C6\u6210 AI \u80FD\u529B\u5230\u5E94\u7528\u4E2D","keywords":["coze","ai","nodejs","sdk","chatbot","typescript"],"homepage":"https://github.com/coze-dev/coze-js/tree/main/packages/coze-js","bugs":{"url":"https://github.com/coze-dev/coze-js/issues"},"repository":{"type":"git","url":"https://github.com/coze-dev/coze-js.git","directory":"packages/coze-js"},"license":"MIT","author":"Leeight <leeight@gmail.com>","exports":{".":{"require":"./dist/cjs/index.js","import":"./dist/esm/index.mjs","types":"./dist/types/index.d.ts"},"./ws-tools":{"require":"./dist/cjs/ws-tools/index.js","import":"./dist/esm/ws-tools/index.mjs","types":"./dist/types/ws-tools/ws-tools/index.d.ts"}},"main":"dist/cjs/index.js","unpkg":"dist/umd/index.js","module":"dist/esm/index.mjs","browser":{"crypto":false,"os":false,"jsonwebtoken":false,"node-fetch":false,"ws":false},"typesVersions":{"*":{".":["dist/types/index.d.ts"],"ws-tools":["dist/types/ws-tools/ws-tools/index.d.ts"]}},"files":["dist","LICENSE","README.md","README.zh-CN.md"],"scripts":{"build":"rslib build","format":"prettier --write .","lint":"eslint ./ --cache --quiet","start":"rslib build -w","test":"vitest","test:cov":"vitest --coverage --run"},"dependencies":{"agora-extension-ai-denoiser":"^1.0.0","agora-rtc-sdk-ng":"4.23.2-1","agora-rte-extension":"^1.2.4","jsonwebtoken":"^9.0.2","node-fetch":"^2.x","opus-encdec":"^0.1.1","reconnecting-websocket":"^4.4.0","uuid":"^10.0.0","ws":"^8.11.0"},"devDependencies":{"@coze-infra/eslint-config":"workspace:*","@coze-infra/ts-config":"workspace:*","@coze-infra/vitest-config":"workspace:*","@rslib/core":"0.0.18","@swc/core":"^1.3.14","@types/jsonwebtoken":"^9.0.0","@types/node":"^20","@types/node-fetch":"^2.x","@types/uuid":"^9.0.1","@types/whatwg-fetch":"^0.0.33","@types/ws":"^8.5.1","@vitest/coverage-v8":"~2.1.9","axios":"^1.7.7","typescript":"^5.5.3","vitest":"~2.1.9"},"peerDependencies":{"axios":"^1.7.1"},"publishConfig":{"access":"public","registry":"https://registry.npmjs.org"},"cozePublishConfig":{"exports":{".":{"require":"./dist/cjs/index.js","import":"./dist/esm/index.mjs","types":"./dist/types/index.d.ts"},"./ws-tools":{"require":"./dist/cjs/ws-tools/index.js","import":"./dist/esm/ws-tools/index.mjs","types":"./dist/types/ws-tools/ws-tools/index.d.ts"}},"main":"dist/cjs/index.js","module":"dist/esm/index.mjs","types":"dist/types/index.d.ts"},"overrides":{"agora-extension-ai-denoiser":{"agora-rtc-sdk-ng":"$agora-rtc-sdk-ng"}}}'),px=()=>{let e=process.version.slice(1),{platform:t}=process,r=t.toLowerCase(),i=iN.release();if("darwin"===t){r="macos";try{let e=iN.release().split(".");if(e.length>=2){let t=parseInt(e[0],10);!isNaN(t)&&t>=9&&(i=`10.${t-9}.${e[1]}`)}}catch(e){}}else"win32"===t?(r="windows",i=iN.release()):"linux"===t&&(r="linux",i=iN.release());return{osName:r,osVersion:i,nodeVersion:e}},pU=()=>{let{nodeVersion:e,osName:t,osVersion:r}=px();return`coze-js/${pM} node/${e} ${t}/${r}`.toLowerCase()},pB=()=>{let{osVersion:e,nodeVersion:t,osName:r}=px();return JSON.stringify({version:pM,lang:"node",lang_version:t,os_name:r,os_version:e})},pV=()=>{let e={name:"unknown",version:"unknown"},t={name:"unknown",version:"unknown"},{userAgent:r}=navigator;if(r){var i,n,o,a,s,c;if(r.indexOf("Windows")>-1){t.name="windows";let e=(null===(i=r.match(/Windows NT ([0-9.]+)/))||void 0===i?void 0:i[1])||"unknown";t.version=e}else r.indexOf("Mac OS X")>-1?(t.name="macos",t.version=((null===(n=r.match(/Mac OS X ([0-9_]+)/))||void 0===n?void 0:n[1])||"unknown").replace(/_/g,".")):r.indexOf("Linux")>-1&&(t.name="linux",t.version=(null===(o=r.match(/Linux ([0-9.]+)/))||void 0===o?void 0:o[1])||"unknown");r.indexOf("Chrome")>-1?(e.name="chrome",e.version=(null===(a=r.match(/Chrome\/([0-9.]+)/))||void 0===a?void 0:a[1])||"unknown"):r.indexOf("Firefox")>-1?(e.name="firefox",e.version=(null===(s=r.match(/Firefox\/([0-9.]+)/))||void 0===s?void 0:s[1])||"unknown"):r.indexOf("Safari")>-1&&(e.name="safari",e.version=(null===(c=r.match(/Version\/([0-9.]+)/))||void 0===c?void 0:c[1])||"unknown")}return JSON.stringify({version:pM,browser:e.name,browser_version:e.version,os_name:t.name,os_version:t.version})},pF=()=>{if(!(null==uni?void 0:uni.getSystemInfoSync))return JSON.stringify({});let e=uni.getSystemInfoSync(),t={name:"unknown",version:"unknown"},r={name:"unknown",version:"unknown"};if("android"===e.platform?r.name="android":"ios"===e.platform?r.name="ios":"windows"===e.platform?r.name="windows":"mac"===e.platform?r.name="macos":r.name=e.platform,r.version=e.system||"unknown",e.AppPlatform)t.name=e.AppPlatform.toLowerCase(),t.version=e.appVersion||"unknown";else if(e.uniPlatform)t.name=e.uniPlatform,t.version=e.SDKVersion||"unknown";else{let{appName:r,appVersion:i}=e;r&&(t.name=r.toLowerCase(),t.version=i||"unknown")}return JSON.stringify({version:pM,framework:"uniapp",platform:t.name,platform_version:t.version,os_name:r.name,os_version:r.version,screen_width:e.screenWidth,screen_height:e.screenHeight,device_model:e.model,device_brand:e.brand})},pj="https://api.coze.com",pG="wss://ws.coze.cn",pW=e=>{var t,r,i,n;return e.isAxiosError||e.code&&e.message?"ECONNABORTED"===e.code&&e.message.includes("timeout")||"ETIMEDOUT"===e.code?new h0(408,void 0,`Request timed out: ${e.message}`,null===(t=e.response)||void 0===t?void 0:t.headers):"ERR_CANCELED"===e.code?new hX(e.message):hQ.generate((null===(r=e.response)||void 0===r?void 0:r.status)||500,null===(i=e.response)||void 0===i?void 0:i.data,e.message,null===(n=e.response)||void 0===n?void 0:n.headers):hQ.generate(500,void 0,`Unexpected error: ${e.message}`,void 0)},pH=async e=>{let t=await iP(e.url,{body:e.data,...e});return{data:t.body,...t}},pY=()=>!!(hG()||hY()||hj())||pQ(process.version.slice(1),"18.0.0")>=0;async function pK(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.axiosInstance||ik.Z;if(t.isStreaming&&function(e){return!!(null==e?void 0:e.Axios)}(r)){let e=r.VERSION||ik.Z.VERSION;if(!e||0>pQ(e,"1.7.1"))throw new hK("Streaming requests require axios version 1.7.1 or higher. Please upgrade your axios version.")}let i=()=>{e.startsWith(pj)&&console.warn(`
\u{9274}\u{6743}\u{5931}\u{8D25}\u{FF0C}\u{5982}\u{679C}\u{60A8}\u{662F}\u{56FD}\u{5185}\u{7528}\u{6237}\u{FF0C}\u{8BF7}\u{5C06} baseURL \u{8BBE}\u{7F6E}\u{4E3A} https://api.coze.cn \u{793A}\u{4F8B}\u{FF1A}
new CozeAPI({
  // ...
  baseURL: COZE_CN_BASE_URL
})`)},n=await r({url:e,responseType:t.isStreaming?"stream":"json",adapter:t.isStreaming?pY()?"fetch":pH:void 0,...t}).catch(e=>{throw(null==e?void 0:e.status)===401&&i(),pW(e)});return{async *stream(){try{let e=n.data,t=e[Symbol.asyncIterator]?e[Symbol.asyncIterator]():e.getReader(),r=new TextDecoder,o={},a="";for(;;){let{done:e,value:n}=await (t.next?t.next():t.read());if(e){if(a){o.event="error",o.data=a;try{let e=JSON.parse(a);(null==e?void 0:e.code)===4101&&i()}catch(e){}yield o}break}let s=(a+=r.decode(n,{stream:!0})).split("\n");for(let e=0;e<s.length-1;e++){let t=s[e],r=t.indexOf(":");if(-1!==r){let e=t.substring(0,r).trim(),i=t.substring(r+1).trim();o[e]=i,"data"===e&&(yield o)}}a=s[s.length-1]}}catch(e){pW(e)}},json:()=>n.data,response:n}}function pQ(e,t){let r=e.split(".").map(Number),i=t.split(".").map(Number);for(let e=0;e<3;e++){let t=r[e]||0,n=i[e]||0;if(t>n)return 1;if(t<n)return -1}return 0}class pz{async getToken(){return"function"==typeof this.token?await this.token():this.token}async buildOptions(e,t,r){let i=await this.getToken(),n={authorization:`Bearer ${i}`};hj()?n["X-Coze-Client-User-Agent"]=pF():hG()||hY()?n["X-Coze-Client-User-Agent"]=pV():(n["User-Agent"]=pU(),n["X-Coze-Client-User-Agent"]=pB());let o=hW(this.axiosOptions,r,{headers:n},{headers:this.headers||{}});return o.method=e,o.data=t,o}async buildWebsocketOptions(e){var t;let r=await this.getToken(),i={authorization:`Bearer ${r}`};return hj()?i["X-Coze-Client-User-Agent"]=pF():hG()?i["X-Coze-Client-User-Agent"]=pV():(i["User-Agent"]=pU(),i["X-Coze-Client-User-Agent"]=pB()),hW({debug:null!==(t=this._config.debug)&&void 0!==t&&t},this._config.websocketOptions,e,{headers:i},{headers:this.headers||{}})}async makeRequest(e,t,r,i,n){var o,a;let s=`${this.baseURL}${e}`;try{let e=await this.buildOptions(t,r,n);e.isStreaming=i,e.axiosInstance=this.axiosInstance,this.debugLog(null==n?void 0:n.debug,`--- request url: ${s}`),this.debugLog(null==n?void 0:n.debug,"--- request options:",e);let{response:a,stream:c,json:d}=await pK(s,e);this.debugLog(null==n?void 0:n.debug,`--- response status: ${a.status}`),this.debugLog(null==n?void 0:n.debug,"--- response headers: ",a.headers);let u=(null!==(o=a.headers)&&void 0!==o?o:a.header)["content-type"];if(i){if(u&&u.includes("application/json")){let e=await d(),{code:t,msg:r}=e;if(0!==t&&void 0!==t)throw hQ.generate(a.status,e,r,a.headers)}return c()}if(!(u&&u.includes("application/json")))return await a.data;{let e=await d(),{code:t,msg:r}=e;if(0!==t&&void 0!==t)throw hQ.generate(a.status,e,r,a.headers);return e}}catch(t){let e=(null==n?void 0:n.onApiError)||(null===(a=this._config)||void 0===a?void 0:a.onApiError);throw e&&e(t),t}}async post(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;return this.makeRequest(e,"POST",t,r,i)}async get(e,t,r,i){let n=Object.entries(t||{}).filter(e=>{let[t,r]=e;return null!=r}).map(e=>{let[t,r]=e;return`${t}=${r}`}).join("&");return this.makeRequest(n?`${e}${e.includes("?")?"&":"?"}${n}`:e,"GET",void 0,r,i)}async put(e,t,r,i){return this.makeRequest(e,"PUT",t,r,i)}async delete(e,t,r){return this.makeRequest(e,"DELETE",void 0,t,r)}async makeWebsocket(e,t){let r=`${this.baseWsURL}${e}`,i=await this.buildWebsocketOptions(t);return this.debugLog(null==t?void 0:t.debug,`--- websocket url: ${r}`),this.debugLog(null==t?void 0:t.debug,"--- websocket options:",i),new pL(r,i)}getConfig(){return this._config}debugLog(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];(this.debug||e)&&console.debug(...r)}constructor(e){var t;if(this._config=e,this.baseURL=e.baseURL||pj,this.baseWsURL=e.baseWsURL||pG,this.token=e.token,this.axiosOptions=e.axiosOptions||{},this.axiosInstance=e.axiosInstance,this.debug=e.debug||!1,this.allowPersonalAccessTokenInBrowser=e.allowPersonalAccessTokenInBrowser||!1,this.headers=e.headers,hG()&&"function"!=typeof this.token&&(null==(t=this.token)?void 0:t.startsWith("pat_"))&&!this.allowPersonalAccessTokenInBrowser)throw new hK("Browser environments do not support authentication using Personal Access Token (PAT) by default.\nas it may expose secret API keys. \n\nPlease use OAuth2.0 authentication mechanism. see:\nhttps://www.coze.com/docs/developer_guides/oauth_apps?_lang=en \n\nIf you need to force use, please set the `allowPersonalAccessTokenInBrowser` option to `true`. \n\ne.g new CozeAPI({ token, allowPersonalAccessTokenInBrowser: true });\n\n")}}pz.APIError=hQ,pz.BadRequestError=hJ,pz.AuthenticationError=hq,pz.PermissionDeniedError=hZ,pz.NotFoundError=h$,pz.RateLimitError=h2,pz.InternalServerError=h1,pz.GatewayError=h4,pz.TimeoutError=h0,pz.UserAbortError=hX;class pX extends pz{constructor(...e){super(...e),this.bots=new hF(this),this.chat=new h7(this),this.conversations=new pr(this),this.files=new pi(this),this.knowledge=new pl(this),this.datasets=new p_(this),this.workflows=new ps(this),this.workspaces=new pc(this),this.audio=new pT(this),this.templates=new py(this),this.websockets=new pN(this),this.variables=new pP(this),this.users=new pD(this)}}let pJ=class e{async init(){if(this.ws)return this.ws;let e=await this.api.websockets.audio.speech.create({entity_type:this.config.entityType,entity_id:this.config.entityId},this.config.websocketOptions);this.ws=e;let t=!1;return this.trackId=`my-track-id-${iI()}`,this.totalDuration=0,this.playbackTimeout&&(clearTimeout(this.playbackTimeout),this.playbackTimeout=null),this.playbackStartTime=null,new Promise((r,i)=>{e.onopen=()=>{console.debug("[speech] ws open")},e.onmessage=n=>{if(this.emit("data",n),this.emit(n.event_type,n),n.event_type===pO.ERROR){if(this.closeWs(),t)return;t=!0,i(new hQ(n.data.code,{code:n.data.code,msg:n.data.msg,detail:n.detail},n.data.msg,void 0));return}if(n.event_type===pO.SPEECH_CREATED)r(e),t=!0;else if(n.event_type===pO.SPEECH_AUDIO_UPDATE)this.audioDeltaList.push(n.data.delta),1===this.audioDeltaList.length&&this.handleAudioMessage();else if(n.event_type===pO.SPEECH_AUDIO_COMPLETED){if(console.debug("[speech] totalDuration",this.totalDuration),this.playbackStartTime){let e=new Date().getTime(),t=this.totalDuration-(e-this.playbackStartTime)/1e3-this.elapsedBeforePause;this.playbackTimeout=setTimeout(()=>{this.emit("completed",void 0),this.playbackStartTime=null,this.elapsedBeforePause=0},1e3*t)}this.closeWs()}},e.onerror=(e,r)=>{console.error("[speech] WebSocket error",e,r),this.emit("data",e),this.emit(pO.ERROR,e),this.closeWs(),!t&&(t=!0,i(new hQ(e.data.code,e,e.data.msg,void 0)))},e.onclose=()=>{console.debug("[speech] ws close")}})}async connect(){var e;let{voiceId:t,speechRate:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await this.init(),null===(e=this.ws)||void 0===e||e.send({id:iI(),event_type:pO.SPEECH_UPDATE,data:{output_audio:{codec:"pcm",voice_id:t||void 0,speech_rate:r||void 0}}})}async disconnect(){this.playbackTimeout&&clearTimeout(this.playbackTimeout),this.audioDeltaList.length=0,await this.wavStreamPlayer.interrupt(),this.closeWs()}append(e){var t;null===(t=this.ws)||void 0===t||t.send({id:iI(),event_type:pO.INPUT_TEXT_BUFFER_APPEND,data:{delta:e}})}complete(){var e;null===(e=this.ws)||void 0===e||e.send({id:iI(),event_type:pO.INPUT_TEXT_BUFFER_COMPLETE})}appendAndComplete(e){this.append(e),this.complete()}async interrupt(){await this.disconnect(),this.emit("completed",void 0),console.debug("[speech] playback completed",this.totalDuration)}async pause(){this.playbackTimeout&&(clearTimeout(this.playbackTimeout),this.playbackTimeout=null),this.playbackStartTime&&!this.playbackPauseTime&&(this.playbackPauseTime=Date.now(),this.elapsedBeforePause+=(this.playbackPauseTime-this.playbackStartTime)/1e3),await this.wavStreamPlayer.pause()}async resume(){if(this.playbackPauseTime){this.playbackStartTime=Date.now(),this.playbackPauseTime=null,this.playbackTimeout&&clearTimeout(this.playbackTimeout);let e=this.totalDuration-this.elapsedBeforePause;this.playbackTimeout=setTimeout(()=>{this.emit("completed",void 0),console.debug("[speech] playback completed",this.totalDuration),this.playbackStartTime=null,this.elapsedBeforePause=0},1e3*e)}await this.wavStreamPlayer.resume()}async togglePlay(){this.isPlaying()?await this.pause():await this.resume()}isPlaying(){return this.wavStreamPlayer.isPlaying()}on(e,t){var r;!this.listeners.has(e)&&this.listeners.set(e,new Set),null===(r=this.listeners.get(e))||void 0===r||r.add(t)}off(e,t){var r;null===(r=this.listeners.get(e))||void 0===r||r.delete(t)}closeWs(){var e,t;(null===(e=this.ws)||void 0===e?void 0:e.readyState)===1&&(null===(t=this.ws)||void 0===t||t.close()),this.ws=null}emit(e,t){var r;null===(r=this.listeners.get(e))||void 0===r||r.forEach(e=>e(t))}constructor(e){this.ws=null,this.listeners=new Map,this.trackId="default",this.totalDuration=0,this.playbackStartTime=null,this.playbackPauseTime=null,this.playbackTimeout=null,this.elapsedBeforePause=0,this.audioDeltaList=[],this.handleAudioMessage=async()=>{let e=atob(this.audioDeltaList[0]),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);let i=t.byteLength/48e3;this.totalDuration+=i;try{await this.wavStreamPlayer.add16BitPCM(t,this.trackId),!this.playbackStartTime&&!this.playbackPauseTime&&(this.playbackStartTime=Date.now(),this.elapsedBeforePause=0),this.audioDeltaList.shift(),this.audioDeltaList.length>0&&this.handleAudioMessage()}catch(e){console.warn(`[speech] wavStreamPlayer error ${null==e?void 0:e.message}`,e)}},this.api=new pX({baseWsURL:pG,...e}),this.wavStreamPlayer=new hP({sampleRate:24e3}),this.config=e}},pq=`
class WavProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.port.onmessage = this.handleMessage.bind(this);
    this.initialize();
  }

  initialize() {
    this.chunks = [];
    this.isRecording = false;
  }

  handleMessage(event) {
    const { type } = event.data;

    switch (type) {
      case 'start':
        this.isRecording = true;
        break;
      case 'stop':
        if (this.isRecording) {
          this.isRecording = false;
          const audioData = this.processChunks();
          this.port.postMessage({
            type: 'audio',
            audioData,
            sampleRate: sampleRate,
            numChannels: this.chunks[0]?.length || 1,
          });
          this.initialize();
        }
        break;
    }
  }

  processChunks() {
    // Combine all channels
    const channels = [];
    const firstChunk = this.chunks[0] || [];
    const numChannels = firstChunk.length || 1;

    for (let channel = 0; channel < numChannels; channel++) {
      const length = this.chunks.reduce((sum, chunk) => sum + chunk[channel].length, 0);
      const channelData = new Float32Array(length);
      let offset = 0;

      for (const chunk of this.chunks) {
        channelData.set(chunk[channel], offset);
        offset += chunk[channel].length;
      }

      channels.push(channelData);
    }

    // Interleave channels
    const interleaved = new Float32Array(channels[0].length * channels.length);
    for (let i = 0; i < channels[0].length; i++) {
      for (let channel = 0; channel < channels.length; channel++) {
        interleaved[i * channels.length + channel] = channels[channel][i];
      }
    }

    return interleaved;
  }

  process(inputs) {
    const input = inputs[0];
    if (input && input[0] && this.isRecording) {
      // Clone the input data
      const chunk = input.map(channel => channel.slice());
      this.chunks.push(chunk);
    }
    return true;
  }
}

registerProcessor('wav-processor', WavProcessor);
`,pZ="";if(hg())pZ=chrome.runtime.getURL("wav-worklet-processor.js");else{let e=new Blob([pq],{type:"application/javascript"});pZ=URL.createObjectURL(e)}let p$=pZ;class p0 extends r5.AudioProcessor{async onNode(e,t){let r=t.getAudioContext();await r.audioWorklet.addModule(p$),this.workletNode=new window.AudioWorkletNode(r,"wav-processor"),null==e||e.connect(this.workletNode),this.workletNode.port.onmessage=e=>{if("audio"===e.data.type){var t;let{audioData:r,sampleRate:i,numChannels:n}=e.data,o=this.createWavFile(r,i,n);console.log("[wav-audio-processor] onAudioData",e.data),null===(t=this.onAudioData)||void 0===t||t.call(this,{wav:o})}},this.startRecording(),this.output(e,t)}startRecording(){var e;null===(e=this.workletNode)||void 0===e||e.port.postMessage({type:"start"})}stopRecording(){var e;null===(e=this.workletNode)||void 0===e||e.port.postMessage({type:"stop"})}createWavFile(e,t,r){let i=hf(e),n=new ArrayBuffer(44+i.byteLength),o=new DataView(n),a=(e,t,r)=>{for(let i=0;i<r.length;i++)e.setUint8(t+i,r.charCodeAt(i))};a(o,0,"RIFF"),o.setUint32(4,36+i.byteLength,!0),a(o,8,"WAVE"),a(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,r,!0),o.setUint32(24,t,!0),o.setUint32(28,t*r*2,!0),o.setUint16(32,2*r,!0),o.setUint16(34,16,!0),a(o,36,"data"),o.setUint32(40,i.byteLength,!0);let s=new Uint8Array(i);return new Uint8Array(n).set(s,44),new Blob([n],{type:"audio/wav"})}destroy(){var e;this.stopRecording(),(null===(e=this.workletNode)||void 0===e?void 0:e.port)&&(this.workletNode.port.onmessage=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=void 0),p$&&URL.revokeObjectURL(p$),this.onAudioData=void 0}constructor(e){super(),this.name="WavAudioProcessor",this.onAudioData=e}}let p2=`
class PCMProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.port.onmessage = this.handleMessage.bind(this);
    this.initialize();
  }

  initialize() {
    this.buffer = [];
    this.bufferSize = 1024;
    this.isRecording = false;
  }

  handleMessage(event) {
    const { type } = event.data;

    switch (type) {
      case 'start':
        this.isRecording = true;
        break;
      case 'stop':
        this.isRecording = false;
        break;
    }
  }

  process(inputs) {
    const input = inputs[0];
    if (input.length > 0 && this.isRecording) {
      // \u{5C06}\u{5F53}\u{524D}\u{8F93}\u{5165}\u{6DFB}\u{52A0}\u{5230}\u{7F13}\u{51B2}\u{533A}
      this.buffer = this.buffer.concat(Array.from(input[0]));

      // \u{5F53}\u{7F13}\u{51B2}\u{533A}\u{8FBE}\u{5230}\u{6216}\u{8D85}\u{8FC7}\u{76EE}\u{6807}\u{5927}\u{5C0F}\u{65F6}\u{53D1}\u{9001}\u{6570}\u{636E}
      if (this.buffer.length >= this.bufferSize) {
        // \u{53D1}\u{9001}1024\u{4E2A}\u{5B57}\u{8282}\u{7684}\u{6570}\u{636E}
        this.port.postMessage({
          audioData: new Float32Array(this.buffer),
        });

        // \u{6E05}\u{7A7A}\u{7F13}\u{51B2}\u{533A}
        this.buffer = [];
      }
    }
    return true;
  }
}

registerProcessor('pcm-processor', PCMProcessor);
`,p1="";if(hg())p1=chrome.runtime.getURL("pcm-worklet-processor.js");else{let e=new Blob([p2],{type:"application/javascript"});p1=URL.createObjectURL(e)}let p4=p1;class p6 extends r5.AudioProcessor{}let p3=p6,p8=class e extends p3{async onNode(e,t){let r=t.getAudioContext();await r.audioWorklet.addModule(p4),this.workletNode=new AudioWorkletNode(r,"pcm-processor"),null==e||e.connect(this.workletNode),this.workletNode.port.onmessage=e=>{var t;let r;let i=e.data.audioData;switch(this.encoding){case"g711a":r=hS(h_(hA(i))).buffer;break;case"g711u":r=hb(h_(hA(i))).buffer;break;default:r=hf(i)}null===(t=this.chunkProcessor)||void 0===t||t.call(this,r)},this.startRecording(),this.output(e,t)}startRecording(){var e;null===(e=this.workletNode)||void 0===e||e.port.postMessage({type:"start"})}stopRecording(){var e;null===(e=this.workletNode)||void 0===e||e.port.postMessage({type:"stop"})}destroy(){var e;this.stopRecording(),(null===(e=this.workletNode)||void 0===e?void 0:e.port)&&(this.workletNode.port.onmessage=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=void 0),p4&&URL.revokeObjectURL(p4),this.chunkProcessor=void 0}constructor(e,t="pcm"){super(),this.name="PcmAudioProcessor",this.chunkProcessor=e,this.encoding=t}},p5=class e extends p3{async onNode(e,t){let r=t.getAudioContext();await r.audioWorklet.addModule(p4),this.workletNode=new AudioWorkletNode(r,"pcm-processor"),e.connect(this.workletNode);let i={encoderApplication:2049,encoderFrameSize:20,encoderSampleRate:r.sampleRate,numberOfChannels:1,rawOpus:!0,originalSampleRate:r.sampleRate};this.encoder=new hc.OggOpusEncoder(i,hd),!1===this.encoder.isReady&&this.encoder.onready&&await new Promise(e=>{this.encoder.onready=e}),this.encoderReady=!0,this.workletNode.port.onmessage=e=>{if(!this.encoderReady)return;let t=e.data.audioData;this.encoder.encode([t]);let r=this.encoder.encodedData||[];if(this.encoder.encodedData=[],r&&r.length)for(let e of r){var i;null===(i=this.chunkProcessor)||void 0===i||i.call(this,e.buffer)}},this.startRecording(),this.output(e,t)}startRecording(){var e;null===(e=this.workletNode)||void 0===e||e.port.postMessage({type:"start"})}stopRecording(){var e;null===(e=this.workletNode)||void 0===e||e.port.postMessage({type:"stop"})}destroy(){var e;this.stopRecording(),(null===(e=this.workletNode)||void 0===e?void 0:e.port)&&(this.workletNode.port.onmessage=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=void 0),p4&&URL.revokeObjectURL(p4),this.chunkProcessor=void 0,this.encoder&&(this.encoder.destroy(),this.encoder=void 0),this.encoderReady=!1}constructor(e){super(),this.encoderReady=!1,this.name="OpusAudioProcessor",this.chunkProcessor=e}};class p9{async start(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"pcm",{deviceId:r,mediaStreamTrack:i,audioCaptureConfig:n,wavRecordConfig:o,debug:a}=this.config;if(i)"function"==typeof i?this.audioTrack=await cC({mediaStreamTrack:await i()}):this.audioTrack=await cC({mediaStreamTrack:i});else{var s,c,d;this.audioTrack=await ck({AEC:null===(s=null==n?void 0:n.echoCancellation)||void 0===s||s,ANS:null===(c=null==n?void 0:n.noiseSuppression)||void 0===c||c,AGC:null===(d=null==n?void 0:n.autoGainControl)||void 0===d||d,microphoneId:r,encoderConfig:{sampleRate:this.getSampleRate()}})}if(a&&(null==o?void 0:o.enableSourceRecord)&&(this.wavAudioProcessor=new p0(e=>{var t;null===(t=this.wavAudioCallback)||void 0===t||t.call(this,e.wav,"source")})),a&&(null==o?void 0:o.enableDenoiseRecord)&&(this.wavAudioProcessor2=new p0(e=>{var t;null===(t=this.wavAudioCallback)||void 0===t||t.call(this,e.wav,"denoise")})),"opus"===t?this.audioProcessor=new p5(e=>{var t;null===(t=this.pcmAudioCallback)||void 0===t||t.call(this,{raw:e})}):this.audioProcessor=new p8(e=>{var t;null===(t=this.pcmAudioCallback)||void 0===t||t.call(this,{raw:e})},t),this.isSupportAIDenoiser()){if(!p9.denoiser)return;this.log("support ai denoiser"),this.processor=p9.denoiser.createProcessor(),e=(e=this.wavAudioProcessor?this.audioTrack.pipe(this.wavAudioProcessor).pipe(this.processor):this.audioTrack.pipe(this.processor)).pipe(this.audioProcessor),this.wavAudioProcessor2&&(e=e.pipe(this.wavAudioProcessor2)),e.pipe(this.audioTrack.processorDestination),this.handleProcessor()}else e=this.audioTrack.pipe(this.audioProcessor),this.wavAudioProcessor&&(e=e.pipe(this.wavAudioProcessor)),e.pipe(this.audioTrack.processorDestination)}record(){let{pcmAudioCallback:e,wavAudioCallback:t,dumpAudioCallback:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.audioTrack)throw Error("audioTrack is not initialized");if(this.isSupportAIDenoiser()&&!this.processor)throw Error("processor is not initialized");this.pcmAudioCallback=e,this.wavAudioCallback=t,this.dumpAudioCallback=r,this.recording=!0}async handleProcessor(){this.processor&&(await this.processor.enable(),this.processor.on("overload",async()=>{var e;console.warn("denoiser processor overload"),await (null===(e=this.processor)||void 0===e?void 0:e.setMode("STATIONARY_NS"))}),this.processor.on("dump",(e,t)=>{var r;null===(r=this.dumpAudioCallback)||void 0===r||r.call(this,e,t)}),this.processor.on("dumpend",()=>{this.log("dump ended!!")}))}pause(){if(this.recording){var e,t,r;this.audioTrack&&(this.audioTrack.getMediaStreamTrack().enabled=!1),null===(e=this.wavAudioProcessor)||void 0===e||e.stopRecording(),null===(t=this.wavAudioProcessor2)||void 0===t||t.stopRecording(),null===(r=this.audioProcessor)||void 0===r||r.stopRecording(),this.recording=!1}else this.warn("error: recorder is not recording")}resume(){if(!this.recording&&this.audioTrack){var e,t,r;this.audioTrack.getMediaStreamTrack().enabled=!0,null===(e=this.wavAudioProcessor)||void 0===e||e.startRecording(),null===(t=this.wavAudioProcessor2)||void 0===t||t.startRecording(),null===(r=this.audioProcessor)||void 0===r||r.startRecording(),this.recording=!0}else this.warn("recorder is recording")}destroy(){var e,t,r;null===(e=this.wavAudioProcessor)||void 0===e||e.destroy(),null===(t=this.wavAudioProcessor2)||void 0===t||t.destroy(),null===(r=this.audioProcessor)||void 0===r||r.destroy(),this.audioTrack&&(this.audioTrack.close(),this.audioTrack=void 0),this.processor&&(this.processor.removeAllListeners(),this.processor.disable(),this.processor=void 0),this.pcmAudioCallback=void 0,this.wavAudioCallback=void 0,this.dumpAudioCallback=void 0,this.recording=!1}getStatus(){return this.recording?"recording":"ended"}getDenoiserEnabled(){var e;return null===(e=this.processor)||void 0===e?void 0:e.enabled}async setDenoiserEnabled(e){if(this.checkProcessor()){var t,r;e?await (null===(t=this.processor)||void 0===t?void 0:t.enable()):await (null===(r=this.processor)||void 0===r?void 0:r.disable())}}async setDenoiserMode(e){if(this.checkProcessor()){var t;await (null===(t=this.processor)||void 0===t?void 0:t.setMode(e))}}async setDenoiserLevel(e){if(this.checkProcessor()){var t;await (null===(t=this.processor)||void 0===t?void 0:t.setLevel(e))}}dump(){if(this.checkProcessor()){var e;null===(e=this.processor)||void 0===e||e.dump()}}getSampleRate(){return 48e3}getRawMediaStream(){if(!!this.audioTrack)return new MediaStream([this.audioTrack.getMediaStreamTrack()])}log(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.config.debug&&console.log(...t),!0}warn(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.config.debug&&console.warn(...t),!0}checkProcessor(){return!!this.processor||(this.log("processor is not initialized"),!1)}isSupportAIDenoiser(){var e;return(null===(e=this.config.aiDenoisingConfig)||void 0===e?void 0:e.mode)&&void 0!==p9.denoiser}constructor(e){var t,r,i;this.recording=!1,e.audioCaptureConfig=null!==(r=e.audioCaptureConfig)&&void 0!==r?r:{},e.aiDenoisingConfig=null!==(i=e.aiDenoisingConfig)&&void 0!==i?i:{},this.config=e;let{audioCaptureConfig:n,aiDenoisingConfig:o}=e;hE(null===(t=e.aiDenoisingConfig)||void 0===t?void 0:t.assetsPath)&&(p9.aiDenoiserSupport=!0,p9.denoiser=window.__denoiser),(null==o?void 0:o.mode)&&p9.aiDenoiserSupport&&(n.autoGainControl=!0,n.noiseSuppression=!1)}}p9.aiDenoiserSupport=!1},892423:function(e,t){"use strict";t.Z=function(e,t,r){if("function"!=typeof e)throw TypeError("Expected a function");return setTimeout(function(){e.apply(void 0,r)},t)}},314640:function(e,t,r){"use strict";var i=r(892423),n=(0,r(491011).Z)(function(e,t){return(0,i.Z)(e,1,t)});t.Z=n},239254:function(e,t,r){"use strict";var i=r(892423),n=r(491011),o=r(437293),a=(0,n.Z)(function(e,t,r){return(0,i.Z)(e,(0,o.Z)(t)||0,r)});t.Z=a},968734:function(e,t,r){"use strict";var i=r(639367),n=r(602639),o=r(491011),a=r(584903),s=r(829319),c=r(897524),d=(0,o.Z)(function(e){var t=(0,c.Z)(e);return(0,s.Z)(t)&&(t=void 0),(0,a.Z)((0,i.Z)(e,1,s.Z,!0),(0,n.Z)(t,2))});t.Z=d}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2129/50860.331f59bb.js.map