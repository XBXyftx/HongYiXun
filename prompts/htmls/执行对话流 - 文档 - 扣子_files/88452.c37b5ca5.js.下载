"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["88452"],{730770:function(e,t,s){s.d(t,{A$:function(){return eA},Hx:function(){return E},Io:function(){return eI},Jl:function(){return ek},S2:function(){return eh}});var n,i,a=s(538660),r=s(475123),o=s(613504),c=s(605014),d=s(259808),l=s(288508);s(461870),s(71107);class u{constructor(e){this._client=e}}class h extends u{async create(e,t){return(await this._client.post("/v1/bot/create",e,!1,t)).data}async update(e,t){return(await this._client.post("/v1/bot/update",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/space/published_bots_list",e,!1,t)).data}async listNew(e,t){return(await this._client.get("/v1/bots",e,!1,t)).data}async publish(e,t){return(await this._client.post("/v1/bot/publish",e,!1,t)).data}async retrieve(e,t){return(await this._client.get("/v1/bot/get_online_info",e,!1,t)).data}async retrieveNew(e,t,s){let n=`/v1/bots/${e}`;return(await this._client.get(n,t,!1,s)).data}}function p(){return"undefined"!=typeof uni}function _(){return"undefined"!=typeof window}function v(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.reduce((e,t)=>{if(void 0===t)return e||{};for(let s in t)Object.prototype.hasOwnProperty.call(t,s)&&(function(e){if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);if(null===t)return!0;let s=t;for(;null!==Object.getPrototypeOf(s);)s=Object.getPrototypeOf(s);return t===s}(t[s])&&!Array.isArray(t[s])?e[s]=v(e[s]||{},t[s]):e[s]=t[s]);return e},{})}function m(e,t){let s=Object.entries(t||{}).filter(e=>{let[t,s]=e;return null!=s&&""!==s}).map(e=>{let[t,s]=e;return`${t}=${s}`}).join("&");return`${e}${s?`?${s}`:""}`}let w=()=>"undefined"!=typeof chrome&&!!chrome.runtime&&!!chrome.runtime.id;class g extends Error{}class E extends g{static makeMessage(e,t,s,n){if(!t&&s)return s;if(t){let e=[],{code:s,msg:i,error:a}=t;s&&e.push(`code: ${s}`),i&&e.push(`msg: ${i}`),(null==a?void 0:a.detail)&&i!==a.detail&&e.push(`detail: ${a.detail}`);let r=(null==a?void 0:a.logid)||(null==n?void 0:n["x-tt-logid"]);return r&&e.push(`logid: ${r}`),e.join(", ")}return e?`http status code: ${e} (no body)`:"(no status code or body)"}static generate(e,t,s,n){return e?400===e||(null==t?void 0:t.code)===4e3?new T(e,t,s,n):401===e||(null==t?void 0:t.code)===4100?new O(e,t,s,n):403===e||(null==t?void 0:t.code)===4101?new A(e,t,s,n):404===e||(null==t?void 0:t.code)===4200?new N(e,t,s,n):429===e||(null==t?void 0:t.code)===4013?new b(e,t,s,n):408===e?new S(e,t,s,n):502===e?new C(e,t,s,n):e>=500?new I(e,t,s,n):new E(e,t,s,n):new f({cause:R(t)})}constructor(e,t,s,n){var i,a;super(`${E.makeMessage(e,t,s,n)}`),this.status=e,this.headers=n,this.logid=(null==t?void 0:null===(i=t.detail)||void 0===i?void 0:i.logid)||(null==n?void 0:n["x-tt-logid"]),this.code=null==t?void 0:t.code,this.msg=null==t?void 0:t.msg,this.detail=null==t?void 0:null===(a=t.error)||void 0===a?void 0:a.detail,this.rawError=t}}class f extends E{constructor({message:e}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0}}class y extends E{constructor(e){super(void 0,void 0,e||"Request was aborted.",void 0),this.name="UserAbortError",this.status=void 0}}class T extends E{constructor(...e){super(...e),this.name="BadRequestError",this.status=400}}class O extends E{constructor(...e){super(...e),this.name="AuthenticationError",this.status=401}}class A extends E{constructor(...e){super(...e),this.name="PermissionDeniedError",this.status=403}}class N extends E{constructor(...e){super(...e),this.name="NotFoundError",this.status=404}}class S extends E{constructor(...e){super(...e),this.name="TimeoutError",this.status=408}}class b extends E{constructor(...e){super(...e),this.name="RateLimitError",this.status=429}}class I extends E{constructor(...e){super(...e),this.name="InternalServerError",this.status=500}}class C extends E{constructor(...e){super(...e),this.name="GatewayError",this.status=502}}let R=e=>e instanceof Error?e:Error(e);class k extends u{async list(e,t,s){let n=`/v3/chat/message/list?conversation_id=${e}&chat_id=${t}`;return(await this._client.get(n,void 0,!1,s)).data}}let x=()=>(Math.random()*new Date().getTime()).toString(),P=e=>null==e?void 0:e.map(e=>({...e,content:"object"==typeof e.content?JSON.stringify(e.content):e.content})),D=e=>{if(e)for(let[t,s]of Object.entries(e))"object"==typeof s&&(e[t]=JSON.stringify(s));return e};class $ extends u{async create(e,t){!e.user_id&&(e.user_id=x());let{conversation_id:s,...n}=e,i=`/v3/chat${s?`?conversation_id=${s}`:""}`,a={...n,additional_messages:P(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:D(e.shortcut_command.parameters)}:void 0,stream:!1};return(await this._client.post(i,a,!1,t)).data}async createAndPoll(e,t){let s;!e.user_id&&(e.user_id=x());let{conversation_id:n,...i}=e,a=`/v3/chat${n?`?conversation_id=${n}`:""}`,r={...i,additional_messages:P(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:D(e.shortcut_command.parameters)}:void 0,stream:!1},o=await this._client.post(a,r,!1,t),c=o.data.id,d=o.data.conversation_id;for(;await new Promise(e=>{setTimeout(e,100)}),"completed"!==(s=await this.retrieve(d,c)).status&&"failed"!==s.status&&"requires_action"!==s.status;);return{chat:s,messages:await this.messages.list(d,c)}}async *stream(e,t){!e.user_id&&(e.user_id=x());let{conversation_id:s,...n}=e,i=`/v3/chat${s?`?conversation_id=${s}`:""}`,a={...n,additional_messages:P(e.additional_messages),shortcut_command:e.shortcut_command?{...e.shortcut_command,parameters:D(e.shortcut_command.parameters)}:void 0,stream:!0};for await(let e of(await this._client.post(i,a,!0,t)))if("done"===e.event){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new g(`Could not parse message into JSON:${e.data}`)}}async retrieve(e,t,s){let n=`/v3/chat/retrieve?conversation_id=${e}&chat_id=${t}`;return(await this._client.post(n,void 0,!1,s)).data}async cancel(e,t,s){return(await this._client.post("/v3/chat/cancel",{conversation_id:e,chat_id:t},!1,s)).data}async *submitToolOutputs(e,t){let{conversation_id:s,chat_id:n,...i}=e,a=`/v3/chat/submit_tool_outputs?conversation_id=${e.conversation_id}&chat_id=${e.chat_id}`,r={...i};if(!1===e.stream)return(await this._client.post(a,r,!1,t)).data;for await(let e of(await this._client.post(a,r,!0,t)))if("done"===e.event){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new g(`Could not parse message into JSON:${e.data}`)}}constructor(...e){super(...e),this.messages=new k(this._client)}}var U=((n={}).CONVERSATION_CHAT_CREATED="conversation.chat.created",n.CONVERSATION_CHAT_IN_PROGRESS="conversation.chat.in_progress",n.CONVERSATION_CHAT_COMPLETED="conversation.chat.completed",n.CONVERSATION_CHAT_FAILED="conversation.chat.failed",n.CONVERSATION_CHAT_REQUIRES_ACTION="conversation.chat.requires_action",n.CONVERSATION_MESSAGE_DELTA="conversation.message.delta",n.CONVERSATION_MESSAGE_COMPLETED="conversation.message.completed",n.CONVERSATION_AUDIO_DELTA="conversation.audio.delta",n.DONE="done",n.ERROR="error",n);class L extends u{async create(e,t,s){let n=`/v1/conversation/message/create?conversation_id=${e}`;return(await this._client.post(n,t,!1,s)).data}async update(e,t,s,n){let i=`/v1/conversation/message/modify?conversation_id=${e}&message_id=${t}`;return(await this._client.post(i,s,!1,n)).message}async retrieve(e,t,s){let n=`/v1/conversation/message/retrieve?conversation_id=${e}&message_id=${t}`;return(await this._client.get(n,null,!1,s)).data}async list(e,t,s){let n=`/v1/conversation/message/list?conversation_id=${e}`;return await this._client.post(n,t,!1,s)}async delete(e,t,s){let n=`/v1/conversation/message/delete?conversation_id=${e}&message_id=${t}`;return(await this._client.post(n,void 0,!1,s)).data}}class j extends u{async create(e,t){return(await this._client.post("/v1/conversation/create",e,!1,t)).data}async retrieve(e,t){let s=`/v1/conversation/retrieve?conversation_id=${e}`;return(await this._client.get(s,null,!1,t)).data}async list(e,t){return(await this._client.get("/v1/conversations",e,!1,t)).data}async clear(e,t){let s=`/v1/conversations/${e}/clear`;return(await this._client.post(s,null,!1,t)).data}constructor(...e){super(...e),this.messages=new L(this._client)}}class M extends u{async upload(e,t){return(await this._client.post("/v1/files/upload",(0,a.k5)(e),!1,t)).data}async retrieve(e,t){let s=`/v1/files/retrieve?file_id=${e}`;return(await this._client.get(s,null,!1,t)).data}}class z extends u{async create(e,t){return await this._client.post("/v1/workflow/run",e,!1,t)}async *stream(e,t){for await(let s of(await this._client.post("/v1/workflow/stream_run",e,!0,t)))try{"Done"===s.event?yield new V(Number(s.id),"Done"):yield new V(Number(s.id),s.event,JSON.parse(s.data))}catch(e){throw new g(`Could not parse message into JSON:${s.data}`)}}async *resume(e,t){for await(let s of(await this._client.post("/v1/workflow/stream_resume",e,!0,t)))try{"Done"===s.event?yield new V(Number(s.id),"Done"):yield new V(Number(s.id),s.event,JSON.parse(s.data))}catch(e){throw new g(`Could not parse message into JSON:${s.data}`)}}async history(e,t,s){let n=`/v1/workflows/${e}/run_histories/${t}`;return(await this._client.get(n,void 0,!1,s)).data}}class V{constructor(e,t,s){this.id=e,this.event=t,this.data=s}}class F extends u{async *stream(e,t){let s={...e,additional_messages:P(e.additional_messages)};for await(let e of(await this._client.post("/v1/workflows/chat",s,!0,t)))if(e.event===U.DONE){let t={event:e.event,data:"[DONE]"};yield t}else try{let t={event:e.event,data:JSON.parse(e.data)};yield t}catch(t){throw new g(`Could not parse message into JSON:${e.data}`)}}}class H extends u{constructor(...e){super(...e),this.runs=new z(this._client),this.chat=new F(this._client)}}class W extends u{async list(e,t){let s=await this._client.get("/v1/workspaces",e,!1,t);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{return JSON.parse(e)}catch(e){return t}}(s,s).data}}let q={"agw-js-conv":"str"};class B extends u{list(e,t){return this._client.get("/open_api/knowledge/document/list",e,!1,v(t,{headers:q}))}async create(e,t){return(await this._client.post("/open_api/knowledge/document/create",e,!1,v(t,{headers:q}))).document_infos}async delete(e,t){await this._client.post("/open_api/knowledge/document/delete",e,!1,v(t,{headers:q}))}async update(e,t){await this._client.post("/open_api/knowledge/document/update",e,!1,v(t,{headers:q}))}}class J extends u{constructor(...e){super(...e),this.documents=new B(this._client)}}let G={"agw-js-conv":"str"};class X extends u{async list(e,t){return await this._client.post("/open_api/knowledge/document/list",e,!1,v(t,{headers:G}))}async create(e,t){return(await this._client.post("/open_api/knowledge/document/create",e,!1,v(t,{headers:G}))).document_infos}async delete(e,t){await this._client.post("/open_api/knowledge/document/delete",e,!1,v(t,{headers:G}))}async update(e,t){await this._client.post("/open_api/knowledge/document/update",e,!1,v(t,{headers:G}))}}class Z extends u{async update(e,t,s,n){let i=`/v1/datasets/${e}/images/${t}`;await this._client.put(i,s,!1,n)}async list(e,t,s){let n=`/v1/datasets/${e}/images`;return(await this._client.get(n,t,!1,s)).data}}class K extends u{async create(e,t){return(await this._client.post("/v1/datasets",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/datasets",e,!1,t)).data}async update(e,t,s){let n=`/v1/datasets/${e}`;await this._client.put(n,t,!1,s)}async delete(e,t){let s=`/v1/datasets/${e}`;await this._client.delete(s,!1,t)}async process(e,t,s){let n=`/v1/datasets/${e}/process`;return(await this._client.post(n,t,!1,s)).data}constructor(...e){super(...e),this.documents=new X(this._client),this.images=new Z(this._client)}}class Q extends u{async clone(e,t){return(await this._client.post("/v1/audio/voices/clone",(0,a.k5)(e),!1,t)).data}async list(e,t){return(await this._client.get("/v1/audio/voices",e,!1,t)).data}}class Y extends u{async create(e,t){return(await this._client.post("/v1/audio/transcriptions",(0,a.k5)(e),!1,t)).data}}class ee extends u{async create(e,t){return await this._client.post("/v1/audio/speech",{...e,sample_rate:e.sample_rate||24e3},!1,v(t,{responseType:"arraybuffer"}))}}class et extends u{async create(e,t){return(await this._client.post("/v1/audio/rooms",e,!1,t)).data}}class es extends u{async create(e,t,s){let n=`/v1/audio/voiceprint_groups/${e}/features`;return(await this._client.post(n,(0,a.k5)(t),!1,s)).data}async update(e,t,s,n){let i=`/v1/audio/voiceprint_groups/${e}/features/${t}`;return(await this._client.put(i,(0,a.k5)(s),!1,n)).data}async delete(e,t,s){let n=`/v1/audio/voiceprint_groups/${e}/features/${t}`;return(await this._client.delete(n,!1,s)).data}async list(e,t,s){let n=`/v1/audio/voiceprint_groups/${e}/features`;return(await this._client.get(n,t,!1,s)).data}async speakerIdentify(e,t,s){let n=`/v1/audio/voiceprint_groups/${e}/speaker_identify`;return(await this._client.post(n,(0,a.k5)(t),!1,s)).data}}class en extends u{async create(e,t){return(await this._client.post("/v1/audio/voiceprint_groups",e,!1,t)).data}async list(e,t){return(await this._client.get("/v1/audio/voiceprint_groups",e,!1,t)).data}async update(e,t,s){let n=`/v1/audio/voiceprint_groups/${e}`;return(await this._client.put(n,t,!1,s)).data}async delete(e,t){let s=`/v1/audio/voiceprint_groups/${e}`;return(await this._client.delete(s,!1,t)).data}constructor(...e){super(...e),this.features=new es(this._client)}}class ei extends u{async retrieve(e,t){let s=`/v1/audio/live/${e}`;return(await this._client.get(s,void 0,!1,t)).data}}class ea extends u{constructor(...e){super(...e),this.rooms=new et(this._client),this.live=new ei(this._client),this.voices=new Q(this._client),this.speech=new ee(this._client),this.transcriptions=new Y(this._client),this.voiceprintGroups=new en(this._client)}}class er extends u{async duplicate(e,t,s){let n=`/v1/templates/${e}/duplicate`;return(await this._client.post(n,t,!1,s)).data}}class eo extends u{async create(e,t){let s=m("/v1/chat",e);return await this._client.makeWebsocket(s,t)}}class ec extends u{async create(e,t){let s=m("/v1/audio/transcriptions",e);return await this._client.makeWebsocket(s,t)}}class ed extends u{async create(e,t){let s=m("/v1/audio/speech",e);return await this._client.makeWebsocket(s,t)}}class el extends u{async create(e){return await this._client.makeWebsocket("/v1/audio/simult_interpretation",e)}}class eu extends u{constructor(...e){super(...e),this.speech=new ed(this._client),this.transcriptions=new ec(this._client),this.simultInterpretation=new el(this._client)}}var eh=((i={}).CLIENT_ERROR="client_error",i.CLOSED="closed",i.ALL="all",i.ERROR="error",i.INPUT_TEXT_BUFFER_APPEND="input_text_buffer.append",i.INPUT_TEXT_BUFFER_COMPLETE="input_text_buffer.complete",i.SPEECH_UPDATE="speech.update",i.SPEECH_UPDATED="speech.updated",i.SPEECH_CREATED="speech.created",i.INPUT_TEXT_BUFFER_COMPLETED="input_text_buffer.completed",i.SPEECH_AUDIO_UPDATE="speech.audio.update",i.SPEECH_AUDIO_COMPLETED="speech.audio.completed",i.INPUT_AUDIO_BUFFER_APPEND="input_audio_buffer.append",i.INPUT_AUDIO_BUFFER_COMPLETE="input_audio_buffer.complete",i.TRANSCRIPTIONS_UPDATE="transcriptions.update",i.INPUT_AUDIO_BUFFER_CLEAR="input_audio_buffer.clear",i.TRANSCRIPTIONS_CREATED="transcriptions.created",i.INPUT_AUDIO_BUFFER_COMPLETED="input_audio_buffer.completed",i.TRANSCRIPTIONS_MESSAGE_UPDATE="transcriptions.message.update",i.TRANSCRIPTIONS_MESSAGE_COMPLETED="transcriptions.message.completed",i.INPUT_AUDIO_BUFFER_CLEARED="input_audio_buffer.cleared",i.TRANSCRIPTIONS_UPDATED="transcriptions.updated",i.CHAT_UPDATE="chat.update",i.CONVERSATION_CHAT_SUBMIT_TOOL_OUTPUTS="conversation.chat.submit_tool_outputs",i.CHAT_CREATED="chat.created",i.CHAT_UPDATED="chat.updated",i.CONVERSATION_CHAT_CREATED="conversation.chat.created",i.CONVERSATION_MESSAGE_CREATE="conversation.message.create",i.CONVERSATION_CLEAR="conversation.clear",i.CONVERSATION_CHAT_IN_PROGRESS="conversation.chat.in_progress",i.CONVERSATION_MESSAGE_DELTA="conversation.message.delta",i.CONVERSATION_CHAT_REQUIRES_ACTION="conversation.chat.requires_action",i.CONVERSATION_MESSAGE_COMPLETED="conversation.message.completed",i.CONVERSATION_AUDIO_DELTA="conversation.audio.delta",i.CONVERSATION_AUDIO_COMPLETED="conversation.audio.completed",i.CONVERSATION_CHAT_COMPLETED="conversation.chat.completed",i.CONVERSATION_CHAT_FAILED="conversation.chat.failed",i.CONVERSATION_CLEARED="conversation.cleared",i.INPUT_AUDIO_BUFFER_SPEECH_STARTED="input_audio_buffer.speech_started",i.INPUT_AUDIO_BUFFER_SPEECH_STOPPED="input_audio_buffer.speech_stopped",i.CONVERSATION_CHAT_CANCEL="conversation.chat.cancel",i.CONVERSATION_CHAT_CANCELED="conversation.chat.canceled",i.CONVERSATION_AUDIO_TRANSCRIPT_UPDATE="conversation.audio_transcript.update",i.CONVERSATION_AUDIO_TRANSCRIPT_COMPLETED="conversation.audio_transcript.completed",i.CONVERSATION_AUDIO_SENTENCE_START="conversation.audio.sentence_start",i.DUMP_AUDIO="dump.audio",i.SIMULT_INTERPRETATION_UPDATE="simult_interpretation.update",i.SIMULT_INTERPRETATION_CREATED="simult_interpretation.created",i.SIMULT_INTERPRETATION_UPDATED="simult_interpretation.updated",i.SIMULT_INTERPRETATION_AUDIO_DELTA="simult_interpretation.audio.delta",i.SIMULT_INTERPRETATION_TRANSCRIPTION_DELTA="simult_interpretation.transcription.delta",i.SIMULT_INTERPRETATION_TRANSLATION_DELTA="simult_interpretation.translation.delta",i.SIMULT_INTERPRETATION_MESSAGE_COMPLETED="simult_interpretation.message.completed",i);class ep extends u{constructor(...e){super(...e),this.audio=new eu(this._client),this.chat=new eo(this._client)}}class e_ extends u{async update(e,t){await this._client.put("/v1/variables",e,!1,t)}async retrieve(e,t){return(await this._client.get("/v1/variables",e,!1,t)).data}}class ev extends u{async me(e){return(await this._client.get("/v1/users/me",void 0,!1,e)).data}}class em{get readyState(){return this.rws.readyState}send(e){return this.rws.send(JSON.stringify(e))}close(e,t){return this.rws.close(e,t)}reconnect(e,t){return this.rws.reconnect(e,t)}addEventListener(e,t){this.rws.addEventListener(e,t)}removeEventListener(e,t){this.rws.removeEventListener(e,t)}constructor(e,t={}){let s;this.onmessage=null,this.onopen=null,this.onclose=null,this.onerror=null;let n=e.includes("?")?"&":"?",{authorization:i}=t.headers||{};if(p()){let e="function"==typeof getMiniAppWebSocketFactory?getMiniAppWebSocketFactory():null;s=e?e.getWebSocketImplementation():window.WebSocket}else s=_()?window.WebSocket:class extends o{constructor(e,s){super(e,s,{headers:t.headers})}};this.rws=new c.Z(`${e}${n}authorization=${i}`,[],{WebSocket:s,...t}),this.rws.addEventListener("message",e=>{try{var t;let s=JSON.parse(e.data);null===(t=this.onmessage)||void 0===t||t.call(this,s,e)}catch(e){console.error("WebSocketAPI onmessage error",e)}}),this.rws.addEventListener("open",e=>{var t;null===(t=this.onopen)||void 0===t||t.call(this,e)}),this.rws.addEventListener("close",e=>{var t;null===(t=this.onclose)||void 0===t||t.call(this,e)}),this.rws.addEventListener("error",e=>{var t,s,n,i,a,r,o,c;let{readyState:d}=this.rws;if(3===d)return;let l=null===(n=e.target)||void 0===n?void 0:null===(s=n._req)||void 0===s?void 0:null===(t=s.res)||void 0===t?void 0:t.statusCode,u=(null===(r=e.target)||void 0===r?void 0:null===(a=r._req)||void 0===a?void 0:null===(i=a.res)||void 0===i?void 0:i.rawHeaders)||[],h=u.findIndex(e=>"X-Tt-Logid"===e),p=-1!==h?u[h+1]:void 0,_={id:"0",event_type:eh.ERROR,data:{code:-1,msg:"WebSocket error"},detail:{logid:p}};401===l?(_.data.code=401,_.data.msg="Unauthorized"):403===l?(_.data.code=403,_.data.msg="Forbidden"):(_.data.code=500,_.data.msg=String(null!==(c=null==e?void 0:e.error)&&void 0!==c?c:"")||"WebSocket error"),null===(o=this.onerror)||void 0===o||o.call(this,_,e)})}}let{version:ew}=JSON.parse('{"name":"@coze/api","version":"1.3.6-alpha.2","description":"Official Coze Node.js SDK for seamless AI integration into your applications | \u6263\u5B50\u5B98\u65B9 Node.js SDK\uFF0C\u52A9\u60A8\u8F7B\u677E\u96C6\u6210 AI \u80FD\u529B\u5230\u5E94\u7528\u4E2D","keywords":["coze","ai","nodejs","sdk","chatbot","typescript"],"homepage":"https://github.com/coze-dev/coze-js/tree/main/packages/coze-js","bugs":{"url":"https://github.com/coze-dev/coze-js/issues"},"repository":{"type":"git","url":"https://github.com/coze-dev/coze-js.git","directory":"packages/coze-js"},"license":"MIT","author":"Leeight <leeight@gmail.com>","exports":{".":{"require":"./dist/cjs/index.js","import":"./dist/esm/index.mjs","types":"./dist/types/index.d.ts"},"./ws-tools":{"require":"./dist/cjs/ws-tools/index.js","import":"./dist/esm/ws-tools/index.mjs","types":"./dist/types/ws-tools/ws-tools/index.d.ts"}},"main":"dist/cjs/index.js","unpkg":"dist/umd/index.js","module":"dist/esm/index.mjs","browser":{"crypto":false,"os":false,"jsonwebtoken":false,"node-fetch":false,"ws":false},"typesVersions":{"*":{".":["dist/types/index.d.ts"],"ws-tools":["dist/types/ws-tools/ws-tools/index.d.ts"]}},"files":["dist","LICENSE","README.md","README.zh-CN.md"],"scripts":{"build":"rslib build","format":"prettier --write .","lint":"eslint ./ --cache --quiet","start":"rslib build -w","test":"vitest","test:cov":"vitest --coverage --run"},"dependencies":{"agora-extension-ai-denoiser":"^1.0.0","agora-rtc-sdk-ng":"4.23.2-1","agora-rte-extension":"^1.2.4","jsonwebtoken":"^9.0.2","node-fetch":"^2.x","opus-encdec":"^0.1.1","reconnecting-websocket":"^4.4.0","uuid":"^10.0.0","ws":"^8.11.0"},"devDependencies":{"@coze-infra/eslint-config":"workspace:*","@coze-infra/ts-config":"workspace:*","@coze-infra/vitest-config":"workspace:*","@rslib/core":"0.0.18","@swc/core":"^1.3.14","@types/jsonwebtoken":"^9.0.0","@types/node":"^20","@types/node-fetch":"^2.x","@types/uuid":"^9.0.1","@types/whatwg-fetch":"^0.0.33","@types/ws":"^8.5.1","@vitest/coverage-v8":"~2.1.9","axios":"^1.7.7","typescript":"^5.5.3","vitest":"~2.1.9"},"peerDependencies":{"axios":"^1.7.1"},"publishConfig":{"access":"public","registry":"https://registry.npmjs.org"},"cozePublishConfig":{"exports":{".":{"require":"./dist/cjs/index.js","import":"./dist/esm/index.mjs","types":"./dist/types/index.d.ts"},"./ws-tools":{"require":"./dist/cjs/ws-tools/index.js","import":"./dist/esm/ws-tools/index.mjs","types":"./dist/types/ws-tools/ws-tools/index.d.ts"}},"main":"dist/cjs/index.js","module":"dist/esm/index.mjs","types":"dist/types/index.d.ts"},"overrides":{"agora-extension-ai-denoiser":{"agora-rtc-sdk-ng":"$agora-rtc-sdk-ng"}}}'),eg=()=>{let e=process.version.slice(1),{platform:t}=process,s=t.toLowerCase(),n=d.release();if("darwin"===t){s="macos";try{let e=d.release().split(".");if(e.length>=2){let t=parseInt(e[0],10);!isNaN(t)&&t>=9&&(n=`10.${t-9}.${e[1]}`)}}catch(e){}}else"win32"===t?(s="windows",n=d.release()):"linux"===t&&(s="linux",n=d.release());return{osName:s,osVersion:n,nodeVersion:e}},eE=()=>{let{nodeVersion:e,osName:t,osVersion:s}=eg();return`coze-js/${ew} node/${e} ${t}/${s}`.toLowerCase()},ef=()=>{let{osVersion:e,nodeVersion:t,osName:s}=eg();return JSON.stringify({version:ew,lang:"node",lang_version:t,os_name:s,os_version:e})},ey=()=>{let e={name:"unknown",version:"unknown"},t={name:"unknown",version:"unknown"},{userAgent:s}=navigator;if(s){var n,i,a,r,o,c;if(s.indexOf("Windows")>-1){t.name="windows";let e=(null===(n=s.match(/Windows NT ([0-9.]+)/))||void 0===n?void 0:n[1])||"unknown";t.version=e}else s.indexOf("Mac OS X")>-1?(t.name="macos",t.version=((null===(i=s.match(/Mac OS X ([0-9_]+)/))||void 0===i?void 0:i[1])||"unknown").replace(/_/g,".")):s.indexOf("Linux")>-1&&(t.name="linux",t.version=(null===(a=s.match(/Linux ([0-9.]+)/))||void 0===a?void 0:a[1])||"unknown");s.indexOf("Chrome")>-1?(e.name="chrome",e.version=(null===(r=s.match(/Chrome\/([0-9.]+)/))||void 0===r?void 0:r[1])||"unknown"):s.indexOf("Firefox")>-1?(e.name="firefox",e.version=(null===(o=s.match(/Firefox\/([0-9.]+)/))||void 0===o?void 0:o[1])||"unknown"):s.indexOf("Safari")>-1&&(e.name="safari",e.version=(null===(c=s.match(/Version\/([0-9.]+)/))||void 0===c?void 0:c[1])||"unknown")}return JSON.stringify({version:ew,browser:e.name,browser_version:e.version,os_name:t.name,os_version:t.version})},eT=()=>{if(!(null==uni?void 0:uni.getSystemInfoSync))return JSON.stringify({});let e=uni.getSystemInfoSync(),t={name:"unknown",version:"unknown"},s={name:"unknown",version:"unknown"};if("android"===e.platform?s.name="android":"ios"===e.platform?s.name="ios":"windows"===e.platform?s.name="windows":"mac"===e.platform?s.name="macos":s.name=e.platform,s.version=e.system||"unknown",e.AppPlatform)t.name=e.AppPlatform.toLowerCase(),t.version=e.appVersion||"unknown";else if(e.uniPlatform)t.name=e.uniPlatform,t.version=e.SDKVersion||"unknown";else{let{appName:s,appVersion:n}=e;s&&(t.name=s.toLowerCase(),t.version=n||"unknown")}return JSON.stringify({version:ew,framework:"uniapp",platform:t.name,platform_version:t.version,os_name:s.name,os_version:s.version,screen_width:e.screenWidth,screen_height:e.screenHeight,device_model:e.model,device_brand:e.brand})},eO="https://api.coze.com",eA="https://api.coze.cn",eN=e=>{var t,s,n,i;return e.isAxiosError||e.code&&e.message?"ECONNABORTED"===e.code&&e.message.includes("timeout")||"ETIMEDOUT"===e.code?new S(408,void 0,`Request timed out: ${e.message}`,null===(t=e.response)||void 0===t?void 0:t.headers):"ERR_CANCELED"===e.code?new y(e.message):E.generate((null===(s=e.response)||void 0===s?void 0:s.status)||500,null===(n=e.response)||void 0===n?void 0:n.data,e.message,null===(i=e.response)||void 0===i?void 0:i.headers):E.generate(500,void 0,`Unexpected error: ${e.message}`,void 0)},eS=async e=>{let t=await l(e.url,{body:e.data,...e});return{data:t.body,...t}},eb=()=>!!(_()||w()||p())||eC(process.version.slice(1),"18.0.0")>=0;async function eI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=t.axiosInstance||r.Z;if(t.isStreaming&&function(e){return!!(null==e?void 0:e.Axios)}(s)){let e=s.VERSION||r.Z.VERSION;if(!e||0>eC(e,"1.7.1"))throw new g("Streaming requests require axios version 1.7.1 or higher. Please upgrade your axios version.")}let n=()=>{e.startsWith(eO)&&console.warn(`
\u{9274}\u{6743}\u{5931}\u{8D25}\u{FF0C}\u{5982}\u{679C}\u{60A8}\u{662F}\u{56FD}\u{5185}\u{7528}\u{6237}\u{FF0C}\u{8BF7}\u{5C06} baseURL \u{8BBE}\u{7F6E}\u{4E3A} ${eA} \u{793A}\u{4F8B}\u{FF1A}
new CozeAPI({
  // ...
  baseURL: COZE_CN_BASE_URL
})`)},i=await s({url:e,responseType:t.isStreaming?"stream":"json",adapter:t.isStreaming?eb()?"fetch":eS:void 0,...t}).catch(e=>{throw(null==e?void 0:e.status)===401&&n(),eN(e)});return{async *stream(){try{let e=i.data,t=e[Symbol.asyncIterator]?e[Symbol.asyncIterator]():e.getReader(),s=new TextDecoder,a={},r="";for(;;){let{done:e,value:i}=await (t.next?t.next():t.read());if(e){if(r){a.event="error",a.data=r;try{let e=JSON.parse(r);(null==e?void 0:e.code)===4101&&n()}catch(e){}yield a}break}let o=(r+=s.decode(i,{stream:!0})).split("\n");for(let e=0;e<o.length-1;e++){let t=o[e],s=t.indexOf(":");if(-1!==s){let e=t.substring(0,s).trim(),n=t.substring(s+1).trim();a[e]=n,"data"===e&&(yield a)}}r=o[o.length-1]}}catch(e){eN(e)}},json:()=>i.data,response:i}}function eC(e,t){let s=e.split(".").map(Number),n=t.split(".").map(Number);for(let e=0;e<3;e++){let t=s[e]||0,i=n[e]||0;if(t>i)return 1;if(t<i)return -1}return 0}class eR{async getToken(){return"function"==typeof this.token?await this.token():this.token}async buildOptions(e,t,s){let n=await this.getToken(),i={authorization:`Bearer ${n}`};p()?i["X-Coze-Client-User-Agent"]=eT():_()||w()?i["X-Coze-Client-User-Agent"]=ey():(i["User-Agent"]=eE(),i["X-Coze-Client-User-Agent"]=ef());let a=v(this.axiosOptions,s,{headers:i},{headers:this.headers||{}});return a.method=e,a.data=t,a}async buildWebsocketOptions(e){var t;let s=await this.getToken(),n={authorization:`Bearer ${s}`};return p()?n["X-Coze-Client-User-Agent"]=eT():_()?n["X-Coze-Client-User-Agent"]=ey():(n["User-Agent"]=eE(),n["X-Coze-Client-User-Agent"]=ef()),v({debug:null!==(t=this._config.debug)&&void 0!==t&&t},this._config.websocketOptions,e,{headers:n},{headers:this.headers||{}})}async makeRequest(e,t,s,n,i){var a,r;let o=`${this.baseURL}${e}`;try{let e=await this.buildOptions(t,s,i);e.isStreaming=n,e.axiosInstance=this.axiosInstance,this.debugLog(null==i?void 0:i.debug,`--- request url: ${o}`),this.debugLog(null==i?void 0:i.debug,"--- request options:",e);let{response:r,stream:c,json:d}=await eI(o,e);this.debugLog(null==i?void 0:i.debug,`--- response status: ${r.status}`),this.debugLog(null==i?void 0:i.debug,"--- response headers: ",r.headers);let l=(null!==(a=r.headers)&&void 0!==a?a:r.header)["content-type"];if(n){if(l&&l.includes("application/json")){let e=await d(),{code:t,msg:s}=e;if(0!==t&&void 0!==t)throw E.generate(r.status,e,s,r.headers)}return c()}if(!(l&&l.includes("application/json")))return await r.data;{let e=await d(),{code:t,msg:s}=e;if(0!==t&&void 0!==t)throw E.generate(r.status,e,s,r.headers);return e}}catch(t){let e=(null==i?void 0:i.onApiError)||(null===(r=this._config)||void 0===r?void 0:r.onApiError);throw e&&e(t),t}}async post(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;return this.makeRequest(e,"POST",t,s,n)}async get(e,t,s,n){let i=Object.entries(t||{}).filter(e=>{let[t,s]=e;return null!=s}).map(e=>{let[t,s]=e;return`${t}=${s}`}).join("&");return this.makeRequest(i?`${e}${e.includes("?")?"&":"?"}${i}`:e,"GET",void 0,s,n)}async put(e,t,s,n){return this.makeRequest(e,"PUT",t,s,n)}async delete(e,t,s){return this.makeRequest(e,"DELETE",void 0,t,s)}async makeWebsocket(e,t){let s=`${this.baseWsURL}${e}`,n=await this.buildWebsocketOptions(t);return this.debugLog(null==t?void 0:t.debug,`--- websocket url: ${s}`),this.debugLog(null==t?void 0:t.debug,"--- websocket options:",n),new em(s,n)}getConfig(){return this._config}debugLog(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var t=arguments.length,s=Array(t>1?t-1:0),n=1;n<t;n++)s[n-1]=arguments[n];(this.debug||e)&&console.debug(...s)}constructor(e){var t;if(this._config=e,this.baseURL=e.baseURL||eO,this.baseWsURL=e.baseWsURL||"wss://ws.coze.cn",this.token=e.token,this.axiosOptions=e.axiosOptions||{},this.axiosInstance=e.axiosInstance,this.debug=e.debug||!1,this.allowPersonalAccessTokenInBrowser=e.allowPersonalAccessTokenInBrowser||!1,this.headers=e.headers,_()&&"function"!=typeof this.token&&(null==(t=this.token)?void 0:t.startsWith("pat_"))&&!this.allowPersonalAccessTokenInBrowser)throw new g("Browser environments do not support authentication using Personal Access Token (PAT) by default.\nas it may expose secret API keys. \n\nPlease use OAuth2.0 authentication mechanism. see:\nhttps://www.coze.com/docs/developer_guides/oauth_apps?_lang=en \n\nIf you need to force use, please set the `allowPersonalAccessTokenInBrowser` option to `true`. \n\ne.g new CozeAPI({ token, allowPersonalAccessTokenInBrowser: true });\n\n")}}eR.APIError=E,eR.BadRequestError=T,eR.AuthenticationError=O,eR.PermissionDeniedError=A,eR.NotFoundError=N,eR.RateLimitError=b,eR.InternalServerError=I,eR.GatewayError=C,eR.TimeoutError=S,eR.UserAbortError=y;class ek extends eR{constructor(...e){super(...e),this.bots=new h(this),this.chat=new $(this),this.conversations=new j(this),this.files=new M(this),this.knowledge=new J(this),this.datasets=new K(this),this.workflows=new H(this),this.workspaces=new W(this),this.audio=new ea(this),this.templates=new er(this),this.websockets=new ep(this),this.variables=new e_(this),this.users=new ev(this)}}}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2264/88452.c37b5ca5.js.map