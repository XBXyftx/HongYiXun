"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["13717"],{193066:function(e,t,n){n.d(t,{Q:function(){return o}});var r=n(235347),a=n(308729),o=e=>(0,r.wX)()===a.Ar.MOBILE?"custom":e},138510:function(e,t,n){n.d(t,{dc:()=>en,qz:()=>Y,Ep:()=>K,qO:()=>w,VH:()=>eh,nj:()=>S,QL:()=>et,Ii:()=>ed,r5:()=>T,p4:()=>ef,qR:()=>es,dG:()=>eT,Vw:()=>q,t8:()=>Q,pD:()=>eu,Pw:()=>J,Iz:()=>ei,ME:()=>ec});var r,a=n("938809"),o=n("866466"),i=n.n(o),s=n("462669"),l=n.n(s),c=n("318249"),d=n.n(c),u=n("294754"),g=n.n(u),p=n("13355"),f=n.n(p),m=n("876846"),x=n.n(m),h=n("668890"),v={};v.styleTagTransform=x(),v.setAttributes=g(),v.insert=d().bind(null,"head"),v.domAPI=l(),v.insertStyleElement=f(),i()(h.Z,v);var b=h.Z&&h.Z.locals?h.Z.locals:void 0,w=e=>{var{leftContent:t,rightContent:n,children:r}=e;return(0,a.jsxs)("div",{className:b.container,children:[(0,a.jsxs)("div",{className:b["icon-container"],children:[(0,a.jsx)("div",{"data-testid":"chat-area.answer-action.left-content",className:b["left-content"],children:t}),(0,a.jsx)("div",{"data-testid":"chat-area.answer-action.right-content",className:b["right-content"],children:n})]}),r]})};w.displayName="ActionBarContainer";var y=n("723530"),C=n("856306"),M=n.n(C),_=n("351686"),k={};k.styleTagTransform=x(),k.setAttributes=g(),k.insert=d().bind(null,"head"),k.domAPI=l(),k.insertStyleElement=f(),i()(_.Z,k);var j=_.Z&&_.Z.locals?_.Z.locals:void 0,T=(0,y.forwardRef)((e,t)=>{var{children:n,style:r}=e;return(0,a.jsx)("div",{"data-testid":"chat-area.answer-action.hover-action-bar",className:M()(j.container,["coz-stroke-primary","coz-bg-max"]),style:r,ref:t,children:n})}),N=n("967370"),P=n("273094"),U=n("396842"),B=n("16242"),F=n("988726"),E=n("182956"),I=n("308729"),Z=e=>(0,U.eg)(e)||(0,U.vk)(e)||(0,U.mJ)(e),D=e=>{var{message:t,meta:n,latestSectionId:r}=e;return!Z(t)&&n.isGroupLastAnswerMessage&&n.isFromLatestGroup&&n.sectionId===r},z=n("255721"),L=n("341333"),A=n("678841"),X=n("882979");var Y=((r={}).TtsVoiceWs="chat_answer_action_start_TTS",r.ReportMessage="chat_answer_action_message_feedback",r.CopyTextMessage="chat_answer_action_copy_text_message",r),O=n("559293"),H=(0,y.createContext)(null),S=e=>{var{children:t,reportMessageFeedback:n}=e,{runAsync:r}=(0,O.Z)(n,{manual:!0});return(0,a.jsx)(H.Provider,{value:r,children:t})},Q=()=>{var e=(0,y.useContext)(H);if(!e)throw Error("reportMessageFeedbackFn not provided");return e},R=()=>{var e,{reporter:t}=(0,U.rj)(),n=Q(),{message:r}=(0,U.dH)(),{message_id:a}=r;return e=(0,z._)(function*(e){if(!(0,U.o)(r))try{yield n((0,L._)({message_id:a,action:P.Xo.Feedback},e)),t.successEvent({eventName:Y.ReportMessage})}catch(e){t.errorEvent((0,L._)({eventName:Y.ReportMessage},(0,X.aH)(e)))}}),function(t){return e.apply(this,arguments)}},K=()=>{var[e,{toggle:t}]=(0,A.Z)(!1),[n,{toggle:r}]=(0,A.Z)(!1),[a,{setLeft:o,setRight:i}]=(0,A.Z)(!1);return{isThumbsUpSuccessful:e,isFrownUponSuccessful:n,isFrownUponPanelVisible:a,thumbsUpOnClick:()=>{t(),!e&&n&&(r(),o())},frownUponOnClick:()=>{r(),!n&&e&&t(),n?o():i()},frownUponPanelonCancel:()=>{o()},frownUponPanelonSubmit:()=>{o(),e&&t(),!n&&r()}}},G=(e,t)=>{(0,y.useEffect)(()=>{var t;null===(t=e.current)||void 0===t||t.dispatchEvent(new MouseEvent("mouseleave",{view:window,bubbles:!0,cancelable:!0}))},[t,e.current])},q=e=>{var{isThumbsUpSuccessful:t=!1,onClick:n,isFrownUponPanelVisible:r}=e,o=(0,U.wX)()===I.Ar.MOBILE,i=R(),{message:s,meta:l}=(0,U.dH)(),c=(0,U.WB)();return D({message:s,meta:l,latestSectionId:c})?(0,a.jsx)(J,{isMobile:o,onClick:()=>{i({message_feedback:{feedback_type:t?P.ig.Default:P.ig.Like}}).then(()=>{null==n||n()})},isThumbsUpSuccessful:t,isFrownUponPanelVisible:r}):null},J=e=>{var{onClick:t,isFrownUponPanelVisible:n,isMobile:r,isThumbsUpSuccessful:o}=e,i=(0,y.useRef)(null),s=(0,N.Z)(i);return G(i,n),(0,a.jsx)("div",{ref:i,children:(0,a.jsx)(E.Tooltip,{trigger:"custom",visible:!r&&s,content:B.o.t("like"),children:(0,a.jsx)(E.IconButton,{"data-testid":"chat-area.answer-action.thumb-up-button",size:"small",icon:o?(0,a.jsx)(F.zqY,{className:"w-[14px] h-[14px] coz-fg-color-brand"}):(0,a.jsx)(F.piD,{className:"w-[14px] h-[14px]"}),color:"secondary",onClick:t})})})},V=n("556923"),W=e=>{var{meta:{isFromLatestGroup:t,sectionId:n},latestSectionId:r}=e;return t&&n===r},$=e=>{var{message:t,meta:n,latestSectionId:r,isMessageGroupComplete:a}=e;return!Z(t)&&a&&W({meta:n,latestSectionId:r})},ee=n("193066"),et=e=>{var{className:t}=e,n=(0,V._)(e,["className"]),{message:r,meta:o,regenerateMessage:i,isMessageGroupComplete:s}=(0,U.dH)(),l=(0,U.WB)(),c=(0,ee.Q)("hover");return $({message:r,meta:o,latestSectionId:l,isMessageGroupComplete:s})?(0,a.jsx)(E.Tooltip,{trigger:c,content:B.o.t("message_tool_regenerate"),children:(0,a.jsx)(E.IconButton,(0,L._)({"data-testid":"chat-area.answer-action.regenerate-message-button",size:"small",color:"secondary",icon:(0,a.jsx)(F.mxP,{className:M()(t,"w-[14px] h-[14px]")}),onClick:()=>{i()}},n))}):null},en=e=>{var{className:t}=e,{groupId:n}=(0,U.dH)(),r=(0,U.Nd)(n),o=(0,U.YI)();return(0,a.jsx)(E.Dropdown,{render:(0,a.jsx)(E.Dropdown.Menu,{mode:"menu",children:(0,a.jsx)(E.Dropdown.Item,{disabled:r,icon:(0,a.jsx)(F.dVD,{className:"coz-fg-hglt-red"}),onClick:()=>{o(n)},type:"danger",children:B.o.t("Delete")})}),children:(0,a.jsx)(E.IconButton,{"data-testid":"chat-area.answer-action.more-operation-button",size:"small",color:"secondary",icon:(0,a.jsx)(F.NsR,{className:M()(t,"w-[14px] h-[14px]")})})})},er=n("321658"),ea={};ea.styleTagTransform=x(),ea.setAttributes=g(),ea.insert=d().bind(null,"head"),ea.domAPI=l(),ea.insertStyleElement=f(),i()(er.Z,ea);var eo=er.Z&&er.Z.locals?er.Z.locals:void 0,ei=e=>{var{onClick:t,isFrownUponPanelVisible:n,isFrownUponSuccessful:r}=e,o=(0,U.wX)()===I.Ar.MOBILE,i=R(),{message:s,meta:l}=(0,U.dH)(),c=(0,U.WB)();return D({message:s,meta:l,latestSectionId:c})?(0,a.jsx)(es,{onClick:()=>{i({message_feedback:{feedback_type:r?P.ig.Default:P.ig.Unlike,detail_types:r?[]:[P.mn.UnlikeDefault]}}).then(()=>{null==t||t()})},isMobile:o,isFrownUponPanelVisible:n,isFrownUponSuccessful:r}):null},es=e=>{var{onClick:t,isFrownUponPanelVisible:n,isFrownUponSuccessful:r,isMobile:o}=e,i=(0,y.useRef)(null),s=(0,N.Z)(i);return G(i,n),(0,a.jsx)("div",{style:{position:"relative"},ref:i,children:(0,a.jsx)(E.Tooltip,{content:B.o.t("dislike"),getPopupContainer:()=>{var e;return null!==(e=i.current)&&void 0!==e?e:document.body},trigger:"custom",visible:!o&&s,children:(0,a.jsx)(E.IconButton,{"data-testid":"chat-area.answer-action.frown-upon-buton",size:"small",icon:r?(0,a.jsx)(F.vgK,{className:"w-[14px] h-[14px]"}):(0,a.jsx)(F.Oad,{className:"w-[14px] h-[14px]"}),color:"secondary",onClick:t})})})},el=()=>[{label:B.o.t("dislike_feedback_tag_harm"),value:P.mn.UnlikeHarmful},{label:B.o.t("dislike_feedback_tag_mislead"),value:P.mn.UnlikeIncorrect},{label:B.o.t("dislike_feedback_tag_unfollow_instruction"),value:P.mn.UnlikeNotFollowInstructions},{label:B.o.t("dislike_feedback_tag_unfollow_others"),value:P.mn.UnlikeOthers}],ec=e=>{var{containerStyle:t,onCancel:n,onSubmit:r,wrapReasons:o}=e,i=R();return(0,a.jsx)(ed,{wrapReasons:o,onSubmit:e=>{var{reasons:t,detailContent:n}=e;i({message_feedback:{feedback_type:P.ig.Unlike,detail_types:t.length>0?t:[P.mn.UnlikeDefault],detail_content:t.includes(P.mn.UnlikeOthers)?n:void 0}}).then(()=>{null==r||r()})},onCancel:n,style:t})},ed=e=>{var{onSubmit:t,onCancel:n,style:r,wrapReasons:o}=e,[i,s]=(0,y.useState)([]),[l,c]=(0,y.useState)(""),d=e=>{s(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,a.jsxs)("div",{className:M()(eo["frown-upon-container"],["bg-[var(--coz-mg-card)]","rounded-normal"]),style:r,children:[(0,a.jsxs)("div",{className:eo.header,children:[(0,a.jsx)("div",{className:eo.title,children:B.o.t("dislike_feedback_title")}),(0,a.jsx)(E.IconButton,{size:"small",color:"secondary",icon:(0,a.jsx)(F.rmE,{}),onClick:n})]}),(0,a.jsx)("div",{className:M()(eo.reasons,o&&"flex-wrap"),children:el().map(e=>(0,a.jsx)("span",{className:M()(eo.item,{["".concat(eo.selected)]:i.includes(e.value)}),onClick:()=>{d(e.value)},children:e.label}))}),(0,a.jsx)("div",{className:eo.textarea,children:i.includes(P.mn.UnlikeOthers)&&(0,a.jsx)(E.TextArea,{placeholder:B.o.t("dislike_feedback_placeholder"),maxCount:500,showClear:!0,rows:2,value:l,onChange:e=>{c(e)}})}),(0,a.jsx)("div",{className:eo.footer,children:(0,a.jsx)(E.Button,{theme:"solid",onClick:()=>t({reasons:i,detailContent:l}),children:B.o.t("feedback_submit")})})]})},eu=e=>{var{className:t}=e,n=(0,V._)(e,["className"]),{groupId:r}=(0,U.dH)(),o=(0,ee.Q)("hover"),i=(0,U.Nd)(r),s=(0,U.YI)();return(0,a.jsx)(E.Tooltip,{trigger:o,content:B.o.t("Delete"),children:(0,a.jsx)(E.IconButton,(0,L._)({"data-testid":"chat-area.answer-action.delete-message-button",disabled:i,size:"small",icon:(0,a.jsx)(F.dVD,{className:M()("coz-fg-hglt-red",t,"w-[14px] h-[14px]")}),onClick:()=>{s(r)},color:"secondary"},n))})},eg=n("384149"),ep=n.n(eg),ef=e=>{var{className:t,isMustGroupLastAnswerMessage:n=!0,isUseExternalContent:r=!1,externalContent:o}=e,i=(0,V._)(e,["className","isMustGroupLastAnswerMessage","isUseExternalContent","externalContent"]),{reporter:s}=(0,U.rj)(),{message:l,meta:c}=(0,U.dH)(),d=r?o||"":l.content,[u,g]=(0,y.useState)(!1),p=(0,ee.Q)("hover");if(!(r?!!d:(0,U.pZ)(l))||!c.isGroupLastAnswerMessage&&n)return null;var f=M()(t,"w-[14px] h-[14px]");return(0,a.jsx)(E.Tooltip,{content:u?B.o.t("copied"):B.o.t("copy"),trigger:p,children:(0,a.jsx)(E.IconButton,(0,L._)({"data-testid":"chat-area.answer-action.copy-button",size:"small",icon:u?(0,a.jsx)(F.maW,{className:f}):(0,a.jsx)(F.UtC,{className:f}),color:"secondary",onClick:()=>{ep()(d)?(g(!0),setTimeout(()=>g(!1),3e3),E.Toast.success({content:B.o.t("copy_success"),showClose:!1,duration:3}),s.successEvent({eventName:Y.CopyTextMessage})):(E.Toast.warning({content:B.o.t("copy_failed"),showClose:!1,duration:3}),s.errorEvent((0,L._)({eventName:Y.CopyTextMessage},(0,X.aH)("copy_text_message_error","copy_text_message_error"))))}},i))})},em=n("780499"),ex=()=>{try{return(0,U.FL)(U.p7.MessageGrab)}catch(e){return null}},eh=e=>{var t=ex(),{message:n}=(0,U.dH)();return t&&n.source!==P.mZ.Notice?(0,a.jsx)(ev,(0,L._)({},e)):null},ev=e=>{var{className:t}=e,n=(0,V._)(e,["className"]),r=ex(),{chatAreaPluginContext:o,pluginBizContext:i}=r,{useDeleteFile:s}=r.chatAreaPluginContext.writeableHook.file,{getFileStoreInstantValues:l}=o.readonlyAPI.batchFile,{useQuoteStore:c}=i.storeSet,{onQuote:d}=i.eventCallbacks,{updateQuoteContent:u,updateQuoteVisible:g}=c.getState(),{message:p,meta:f}=(0,U.dH)(),{content:m,content_type:x}=p,h=(0,ee.Q)("hover"),v=s(),b=()=>{var{fileIdList:e}=l();e.forEach(e=>v(e))},w=(0,U.pZ)(p),y=(0,U.hI)(p);return(w||y)&&f.isGroupLastAnswerMessage&&r?(0,a.jsx)(E.Tooltip,{content:B.o.t("quote_ask_in_chat"),trigger:h,children:(0,a.jsx)(E.IconButton,(0,L._)({"data-testid":"chat-area.answer-action.quote-message",size:"small",icon:(0,a.jsx)(F.Z57,{className:M()(t,"w-[14px] h-[14px]")}),onClick:()=>{if(b(),x===U.zc.Image){var e,t,n=(0,X.w8)({str:m,verifyStruct:e=>e instanceof Object&&"image_list"in e,onParseError:e=>{(0,X.Cj)(e.message)},onVerifyError:e=>{(0,X.Cj)(e.message)}});u(null!==(t=null==n?void 0:n.image_list.map(e=>({type:em.y1.IMAGE,src:e.image_ori.url,children:[]})))&&void 0!==t?t:[])}else u((0,em.hl)(m));null==d||d({botId:null!==(e=p.sender_id)&&void 0!==e?e:"",source:p.source}),g(!0)},color:"secondary"},n))}):null};eh.displayName="QuoteMessage";var eb=(0,y.createContext)(null),ew=(0,y.createContext)({enableBotTriggerControl:!1}),ey=n("416611"),eC=n("888953"),eM=n("922321"),e_=n("468745"),ek=()=>(0,eM.Ue)()((0,eC.mW)((e,t)=>({favoriteBotTriggerConfigMap:{},updateFavoriteBotTriggerConfigMap:n=>{e({favoriteBotTriggerConfigMap:Object.assign({},t().favoriteBotTriggerConfigMap,n)},!1,"updateFavoriteBotTriggerConfigMap")},updateMapByConfigList:n=>{var r=Object.fromEntries(n.map(e=>[e.botId,e]));e({favoriteBotTriggerConfigMap:Object.assign({},t().favoriteBotTriggerConfigMap,r)},!1,"updateMapByConfigList")},updateFavoriteBotTriggerConfigMapByImmer:n=>{e({favoriteBotTriggerConfigMap:(0,e_.Uy)(t().favoriteBotTriggerConfigMap,n)},!1,"updateFavoriteBotTriggerConfigMapByImmer")},deleteConfigById:n=>{e({favoriteBotTriggerConfigMap:(0,e_.Uy)(t().favoriteBotTriggerConfigMap,e=>{delete e[n]})},!1,"deleteConfigById")},getFavoriteBotConfigIdList:()=>Object.entries(t().favoriteBotTriggerConfigMap).map(e=>{var[t]=e;return t})}),{enabled:!1,name:"botStudio.ChatAnswerActionBotTrigger"})),ej=()=>({useFavoriteBotTriggerConfigStore:(0,ey.Z)(()=>ek(),[])}),eT=e=>{var{children:t,enableBotTriggerControl:n}=e,r=ej();return(0,a.jsx)(eb.Provider,{value:r,children:(0,a.jsx)(ew.Provider,{value:{enableBotTriggerControl:n},children:t})})};n("449001");var eN=n("321877"),eP={};eP.styleTagTransform=x(),eP.setAttributes=g(),eP.insert=d().bind(null,"head"),eP.domAPI=l(),eP.insertStyleElement=f(),i()(eN.Z,eP),eN.Z&&eN.Z.locals&&eN.Z.locals},668890:function(e,t,n){var r=n(160052),a=n.n(r),o=n(570717),i=n.n(o)()(a());i.push([e.id,".container--ajJLYeuhqDY7CpMU{display:flex;flex-direction:column}.container--ajJLYeuhqDY7CpMU .icon-container--b6MLdxubsKrPHCYK{align-items:center;display:flex;justify-content:space-between;padding:4px;width:100%}.container--ajJLYeuhqDY7CpMU .icon-container--b6MLdxubsKrPHCYK .left-content--JUZabarHCYETcNDD{align-items:center;display:flex;flex-shrink:0;gap:4px}.container--ajJLYeuhqDY7CpMU .icon-container--b6MLdxubsKrPHCYK .right-content--kQG1yhTqxTEvFn65{align-items:center;display:flex;gap:4px;margin-left:8px}",""]),i.locals={container:"container--ajJLYeuhqDY7CpMU","icon-container":"icon-container--b6MLdxubsKrPHCYK",iconContainer:"icon-container--b6MLdxubsKrPHCYK","left-content":"left-content--JUZabarHCYETcNDD",leftContent:"left-content--JUZabarHCYETcNDD","right-content":"right-content--kQG1yhTqxTEvFn65",rightContent:"right-content--kQG1yhTqxTEvFn65"},t.Z=i},351686:function(e,t,n){var r=n(160052),a=n.n(r),o=n(570717),i=n.n(o)()(a());i.push([e.id,".container--igQDpVBtsSMbCdpE{align-items:center;border-radius:8px;border-style:solid;border-width:1px;box-shadow:0 2px 8px 0 rgba(0,0,0,.1);display:flex;gap:4px;height:32px;padding:4px;width:100%}",""]),i.locals={container:"container--igQDpVBtsSMbCdpE"},t.Z=i},321877:function(e,t,n){var r=n(160052),a=n.n(r),o=n(570717),i=n.n(o)()(a());i.push([e.id,"@keyframes trigger-config-button-slider-in--LAFngewgDXkfMFT7{0%{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}.slide-in--ai47oTXwwDQF79al{animation:trigger-config-button-slider-in--LAFngewgDXkfMFT7 .5s linear}",""]),i.locals={"slide-in":"slide-in--ai47oTXwwDQF79al",slideIn:"slide-in--ai47oTXwwDQF79al","trigger-config-button-slider-in":"trigger-config-button-slider-in--LAFngewgDXkfMFT7",triggerConfigButtonSliderIn:"trigger-config-button-slider-in--LAFngewgDXkfMFT7"},t.Z=i},321658:function(e,t,n){var r=n(160052),a=n.n(r),o=n(570717),i=n.n(o)()(a());i.push([e.id,".frown-upon-container--MteiX7UpPzgRyFMP{border:1px solid rgba(10,17,61,.06);display:flex;flex-direction:column;margin-top:12px;padding:12px;width:100%}.frown-upon-container--MteiX7UpPzgRyFMP .header--JnyNb4HM44YuCoOG{display:flex;justify-content:space-between;line-height:20px;margin-bottom:12px;width:100%}.frown-upon-container--MteiX7UpPzgRyFMP .header--JnyNb4HM44YuCoOG .title--_mNlLtYLsF_I7zna{color:rgba(6,7,9,.96);font-size:14px;font-style:normal;font-weight:600}.frown-upon-container--MteiX7UpPzgRyFMP .reasons--e17lE7CrEssddXxc{display:flex;gap:8px;margin-bottom:8px}.frown-upon-container--MteiX7UpPzgRyFMP .reasons--e17lE7CrEssddXxc .item--bOSM686vfDA6rOsK{background-color:rgba(6,7,9,.05);border-radius:6px;cursor:pointer;font-size:14px;font-style:normal;font-weight:400;padding:8px 16px}.frown-upon-container--MteiX7UpPzgRyFMP .reasons--e17lE7CrEssddXxc .item--bOSM686vfDA6rOsK:hover{background-color:rgba(128,138,255,.2)}.frown-upon-container--MteiX7UpPzgRyFMP .reasons--e17lE7CrEssddXxc .item--bOSM686vfDA6rOsK.selected--knkPx7zmzoUKIxKI{background-color:rgba(128,138,255,.4)}.frown-upon-container--MteiX7UpPzgRyFMP .textarea--m8r8YkpGs7461pwZ{margin-bottom:12px}.frown-upon-container--MteiX7UpPzgRyFMP .footer--QXQtQTudcDYZm5MZ{text-align:right}",""]),i.locals={"frown-upon-container":"frown-upon-container--MteiX7UpPzgRyFMP",frownUponContainer:"frown-upon-container--MteiX7UpPzgRyFMP",header:"header--JnyNb4HM44YuCoOG",title:"title--_mNlLtYLsF_I7zna",reasons:"reasons--e17lE7CrEssddXxc",item:"item--bOSM686vfDA6rOsK",selected:"selected--knkPx7zmzoUKIxKI",textarea:"textarea--m8r8YkpGs7461pwZ",footer:"footer--QXQtQTudcDYZm5MZ"},t.Z=i}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2232/13717.ccc08818.js.map