"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["73098"],{87891:function(e,o,n){n.d(o,{G:function(){return s},H:function(){return u}});var i=n(341333),t=n(938809),a=n(723530),r=(0,a.lazy)(()=>Promise.all([n.e("75776"),n.e("90784")]).then(n.bind(n,939388)).then(e=>({default:e.IntegrationViewer}))),l=(0,a.lazy)(()=>Promise.all([n.e("75776"),n.e("90784")]).then(n.bind(n,939388)).then(e=>({default:e.CollapseViewerButton}))),s=e=>(0,t.jsx)(a.Suspense,{children:(0,t.jsx)(r,(0,i._)({},e))}),u=()=>(0,t.jsx)(a.Suspense,{children:(0,t.jsx)(l,{})})},298255:function(e,o,n){n.d(o,{w:()=>e_,G:()=>U});var i,t,a,r=n("938809"),l=n("723530"),s=n("856306"),u=n.n(s),d=n("696591"),c=n("728971"),v=n("396842"),g=n("412788"),p=n("866466"),f=n.n(p),_=n("462669"),h=n.n(_),m=n("318249"),C=n.n(m),I=n("294754"),b=n.n(I),M=n("13355"),E=n.n(M),y=n("876846"),S=n.n(y),k=n("947309"),x={};x.styleTagTransform=S(),x.setAttributes=b(),x.insert=C().bind(null,"head"),x.domAPI=h(),x.insertStyleElement=E(),f()(k.Z,x);var B=k.Z&&k.Z.locals?k.Z.locals:void 0,U=e=>{var o,n,i,t,a,s,p,{coreAreaClassName:f,className:_,showInputArea:h=!0,inputPlaceholder:m,inputNativeCallbacks:C,messageGroupListClassName:I,isShowClearContextDivider:b,headerNode:M,messageMaxWidth:E,isMiniScreen:y,enableMultimodalUpload:S=!1}=e,k=(0,v.w5)(),{layout:x,onInitStateChange:U,chatConfig:w,autoBilling:N}=(0,c.HE)(),P=(0,c.Ul)(e=>e.isNeedStopRespond),{readonly:A}=(0,c.HE)();if((0,l.useEffect)(()=>{switch(k){case"initSuccess":case"initFail":null==U||U(k)}},[k,U]),"initSuccess"!==k)return null;var j=null===(p=null==w?void 0:null===(n=w.ui)||void 0===n?void 0:null===(o=n.chatBot)||void 0===o?void 0:o.uploadable)||void 0===p||p,R=!S&&j,F=S&&j;return(0,r.jsx)(v.hU,{classname:u()(B.area,f,_),layout:x===d.Ar.PC?void 0:x,showInputArea:h,newMessageInterruptScenario:"never",messageGroupListClassName:I,showClearContextDivider:b||(null==w?void 0:null===(t=w.ui)||void 0===t?void 0:null===(i=t.chatBot)||void 0===i?void 0:i.isNeedClearContext),messageMaxWidth:E,showStopRespond:P||!1,enableLegacyUpload:R,enableMultimodalUpload:F,fileLimit:F?6:void 0,textareaPlaceholder:m||g.oc.t("chatInputPlaceholder"),audioButtonTooltipContent:N?"":g.oc.t("chat_input_hover_tip_voice_input_button"),enableMessageBoxActionBar:!0,chatInputProps:{wrapperClassName:B.chatInput,inputNativeCallbacks:C,safeAreaClassName:(null==w?void 0:null===(s=w.ui)||void 0===s?void 0:null===(a=s.footer)||void 0===a?void 0:a.isShow)!==!1?B["safe-area"]:""},readonly:A,uiKitChatInputButtonConfig:{isClearContextButtonVisible:!1,isClearHistoryButtonVisible:!1},isCoze:!1,isMiniScreen:y,headerNode:M})},w=n("255721"),N=n("345305"),P=n("384149"),A=n.n(P),j=n("415692"),R=n("172378"),F=n("385678"),L=n("106038"),H=n("30319"),T=n("87353"),O=n("273268"),Z=n("710626"),V=n("273094"),q=n("106472"),G=n("259844"),D=n("16242"),z=n("168074"),W=n("436665"),K=n("999061"),Q=e=>{var{children:o}=e,{isEmpty:n}=(0,v.lM)(),i=(0,c.Ul)(e=>e.backgroundInfo),t=(0,c.Ul)(e=>e.voiceInfoList),a=(0,c.Ul)(e=>e.setHasRefusedCallByUser),s=(0,l.useRef)(!1),{chatConfig:u}=(0,c.HE)(),g=(0,v.RF)(),p=(0,v.wW)(),f=(0,v.ag)(),{useOnboardingStore:_,useSenderInfoStore:h}=(0,v.NN)(),{prologue:m,avatar:C,name:I}=_(e=>({prologue:e.prologue,suggestions:e.suggestions,avatar:e.avatar,name:e.name})),b=h(e=>e.userInfo);return(0,r.jsx)(W.MultimediaChatProvider,{scene:K.xs.BotStore,botInfo:{botId:u.bot_id||"",botName:I||"",avatar:C||"",userId:(null==b?void 0:b.id)||"",userName:(null==b?void 0:b.nickname)||"",userAvatar:(null==b?void 0:b.url)||"",prologue:m,backgroundImageInfo:i,voiceList:null==t?void 0:t.map(e=>({id:e.voice_id,style_id:e.voice_id,language_code:e.language_code}))},isUseOpenApiMedial:!0,reporter:d.v1,messageInfo:{isMessageEmpty:n,conversationId:f||""},eventCallback:{onBeforeBotCalled:()=>{g()},onBeforeUserCalled:()=>{g()},onAfterHangUp:()=>{p(),s.current&&a(!0)},onAfterBotCalled:()=>{s.current=!0,a(!1)},onAfterUserAnswered:()=>{s.current=!1}},children:(0,r.jsxs)($,{children:[o,(0,r.jsx)(W.MultimediaChatWidget,{layout:d.Ar.MOBILE,theme:W.Theme.STORE,isUseOpenApiMedial:!0})]})})},$=e=>{var{children:o}=e,{chatActions:n,enableVoiceChat:i}=(0,W.useChatInstance)(),t=(0,c.Ir)(),a=(0,c.Ul)(e=>e.isStartBotVoiceCall),s=(0,c.Ul)(e=>e.hasRefusedCallByUser);return(0,l.useEffect)(()=>{t&&a&&i&&!s&&n.botCall(W.MultimediaMode.Audio)},[t,a,i]),(0,r.jsx)(r.Fragment,{children:o})},J=n("341333"),X=n("265489"),Y=n("623698"),ee=n("707350");var eo=(i=(0,w._)(function*(e){var o,n,i,t,a,r,{botId:l,openApiService:s}=e,u=yield s.GetBotInfo({bot_id:l}),c=null==u?void 0:u.data,v=c.background_image_info||{};return(null==v?void 0:null===(o=v.web_background_image)||void 0===o?void 0:o.image_url)&&(v.web_background_image.origin_image_url=v.web_background_image.origin_image_url||v.web_background_image.image_url),(null==v?void 0:null===(n=v.mobile_background_image)||void 0===n?void 0:n.image_url)&&(v.mobile_background_image.origin_image_url=v.mobile_background_image.origin_image_url||v.mobile_background_image.image_url),{prologue:c.onboarding_info.prologue,onboardingSuggestions:(null===(t=c.onboarding_info)||void 0===t?void 0:null===(i=t.suggested_questions)||void 0===i?void 0:i.map((e,o)=>({id:"".concat(o),content:e})))||[],botVersion:c.version,botInfoMap:{[c.bot_id]:{url:c.icon_url,nickname:c.name,id:c.bot_id,allowMention:!1}},voiceInfoList:c.voice_info_list,backgroundInfo:v,defaultInputMode:"voice"===c.default_user_input_type?d.Ti.Voice:"call"===c.default_user_input_type?d.Ti.VoiceCall:d.Ti.Text,shortcuts:(0,d.ww)(c.shortcut_commands,{id:l,name:c.name,iconUrl:c.icon_url})||[],voiceCallClose:null===(r=null===(a=c.media_config)||void 0===a?void 0:a.is_voice_call_closed)||void 0===r||r}}),function(e){return i.apply(this,arguments)});var en=(t=(0,w._)(function*(e){var o,n,i,{botId:t,openApiService:a,conversationId:r,sectionId:l,connectorId:s,onDefaultHistoryClear:u,chatConfig:d}=e,c=r||"",v=l||"";if(!c){var g=yield(0,ee.P)({botId:t,connectorId:s,api:a,createConversationCallBack:u});c=g.id,v=g.last_section_id}var p=yield a.GetMessageList({conversation_id:c,limit:10,include_middle_message:null===(i=null===(n=d.ui)||void 0===n?void 0:null===(o=n.chatBot)||void 0===o?void 0:o.isNeedFunctionCallMessage)||void 0===i||i}),{message_list:f,hasmore:_,cursor:h,next_cursor:m}=V.iK.convertMessageList(p);return{lastSectionId:v,conversationId:c,messageList:f,hasMore:_,cursor:h,next_cursor:m}}),function(e){return t.apply(this,arguments)});var ei=(a=(0,w._)(function*(e){var o,n,{openApiService:i,openRequestInit:t}=e;return t?{botOnlineInfo:{prologue:(o="function"==typeof t?yield t(i):t).prologue,onboardingSuggestions:o.onboardingSuggestions,botInfoMap:{[o.botInfo.id]:o.botInfo},backgroundInfo:o.backgroundInfo,voiceInfoList:o.voiceInfoList,defaultInputMode:o.defaultInputMode,shortcuts:[],isCustomBackground:o.isCustomBackground,voiceCallClose:null===(n=o.voiceCallClose)||void 0===n||n},conversationId:o.conversationId,sectionId:o.sectionId}:null}),function(e){return a.apply(this,arguments)}),et=()=>{var{chatConfig:e,openRequestInit:o,onDefaultHistoryClear:n}=(0,c.HE)(),{openApiService:i}=(0,c.ph)(),t=(0,c.Ul)(e=>e.setInitError),a=(0,c.Ul)(e=>e.setVoiceInfoList),r=(0,c.Ul)(e=>e.setDefaultInputMode),s=(0,c.Ul)(e=>e.updateShortcuts),u=(0,c.Ul)(e=>e.setIsStartBotVoiceCall),v=(0,c.Ul)(e=>e.updateBackgroundInfo),g=(0,c.Ul)(e=>e.setVoiceCallClose),{connectorId:p}=e.auth,{bot_id:f=""}=e,_=(0,c.Pc)();return(0,l.useCallback)((0,w._)(function*(){if(!i||!p)return{};try{var l,{conversationId:c,sectionId:h,botOnlineInfo:m}=(yield ei({openApiService:i,openRequestInit:o}))||{},[C,I]=yield Promise.all([m||eo({botId:f,openApiService:i}),en({botId:f,openApiService:i,conversationId:c,sectionId:h,connectorId:p,onDefaultHistoryClear:n,chatConfig:e})]),b=(C.prologue||"").replaceAll("{{user_name}}",(null==_?void 0:_.nickname)||"");return u(C.defaultInputMode===d.Ti.VoiceCall),a(C.voiceInfoList||[]),r(C.defaultInputMode||d.Ti.Text),s(C.shortcuts||[]),g(null===(l=C.voiceCallClose)||void 0===l||l),v(C.backgroundInfo),C.isCustomBackground&&(C.backgroundInfo=void 0),Y.c.init({openapiService:i}),(0,X._)((0,J._)({},C,I),{prologue:b,userInfoMap:(null==_?void 0:_.id)?{[null==_?void 0:_.id]:_}:void 0,apiSource:"openapi",enableReconnect:!0,streamMode:"extended"})}catch(e){console.error("useRequestInit error",e);var{code:M}=e||{};M?t({code:M,msg:""}):t({code:-1,msg:""})}}),[f,i,n])},ea=n("87891"),er=n("893452"),el={};el.styleTagTransform=S(),el.setAttributes=b(),el.insert=C().bind(null,"head"),el.domAPI=h(),el.insertStyleElement=E(),f()(er.Z,el);var es=er.Z&&er.Z.locals?er.Z.locals:void 0,eu=()=>{var{chatConfig:e,layout:o}=(0,c.HE)(),{conversationsModalInfo:n}=(0,c.Ul)((0,N.N)(e=>({conversationsModalInfo:e.conversationsModalInfo}))),i=e.type!==d.z_.APP&&o===d.Ar.PC,t=(0,l.useMemo)(()=>{var o,n,i,t;return(null===(n=e.ui)||void 0===n?void 0:null===(o=n.header)||void 0===o?void 0:o.isShow)||(null===(t=e.ui)||void 0===t?void 0:null===(i=t.header)||void 0===i?void 0:i.isNeedClose)},[e]);return i?(0,r.jsx)(ea.G,{className:u()({[es["has-header"]]:t},n.isLargeWidth&&n.conversationListVisible?"w-[30%]":"w-[50%]")}):null},ed=n("918477"),ec=n("661150"),ev=n("102414"),eg=()=>{var{spaceId:e,autoBilling:o}=(0,c.HE)(),n=(0,l.useRef)(e),i=(0,l.useRef)(o);return(0,l.useMemo)(()=>({url:"/v1/audio/transcriptions",method:"POST",hooks:{onBeforeRequest:[e=>{if(e.data instanceof FormData){var o;n.current&&e.data.append("space_id",n.current),(null===(o=i.current)||void 0===o?void 0:o.entityId)&&(e.data.append("entity_type",null==i?void 0:i.current.entityType),e.data.append("entity_id",null==i?void 0:i.current.entityId))}return e}],onErrorResponse:[e=>{var o=e.response;if(4027===o.data.code)throw new V.MS("".concat(ev.Nt.COZE_PRO_TOKEN_INSUFFICIENT_VOICE),o.data.msg,o);if(4028===o.data.code)throw new V.MS("".concat(ev.Nt.COZE_TOKEN_INSUFFICIENT_VOICE),o.data.msg,o);return Promise.reject(o)}]}}),[e])},ep=()=>{var{chatConfig:e,requestManagerOptions:o}=(0,c.HE)(),{openApiTokenManager:n}=(0,c.ph)(),i=(0,c.Zi)(),t=(0,c.JF)(),a=(0,c.GL)(),r=(0,c.b$)(),s=eg();return(0,l.useMemo)(()=>({env:"thirdPart",biz:"third_part",deployVersion:"inhouse",requestManagerOptions:(0,ed.Z)({scenes:{[V.NX.SendMessage]:i,[V.NX.ChatASR]:s},hooks:{onBeforeRequest:t,onAfterResponse:a,onErrorResponse:r}},o,(e,o)=>{if((0,ec.Z)(e))return e.concat(o)}),tokenManager:n}),[e,n,o,i,t,a,r,s])},ef=(0,l.forwardRef)((e,o)=>{var{children:n}=e,{chatConfig:i}=(0,c.HE)(),{updateConversations:t}=(0,c.Ul)((0,N.N)(e=>({updateConversations:e.updateConversations}))),{useGlobalInitStore:a}=(0,v.NN)(),{ttsTokenManagerClient:r}=(0,c.ph)(),s=a((0,N.N)(e=>e.chatCore)),{handleUpdateConversationNameByMessage:u}=(0,R.lt)(),g=(0,j.Z)(e=>{var o,n,{conversationId:a,sectionId:r}=e;if((null===(n=i.ui)||void 0===n?void 0:null===(o=n.conversations)||void 0===o?void 0:o.isNeed)&&i.type!==d.z_.APP){var l=Math.floor(Date.now()/1e3);t([{id:a,last_section_id:r,updated_at:l,created_at:l,meta_data:{}}],"add")}}),p=(0,v.EL)();(0,l.useImperativeHandle)(o,()=>({regenerateMessageByUserMessageId:p,addConversation:g,handleUpdateConversationNameByMessage:u}),[p,g,u]),(0,l.useEffect)(()=>{r.setGetConversationIdFn(()=>(null==s?void 0:s.conversation_id)||"")},[s]);var f=(0,v.e6)(v.p7.MessageGrab);return(0,l.useEffect)(()=>{if(!!f)f.updateEnableGrab(!0)},[]),n}),e_=e=>{var o,n,i,{children:t,plugins:a}=e,s=(0,l.useRef)(!1),{openApiTokenManager:u,openApiService:g}=(0,c.ph)(),{refreshToken:p}=u,{initError:f,setInitError:_}=(0,c.Ul)((0,N.N)(e=>({initError:e.initError,setInitError:e.setInitError}))),h=(0,l.useRef)(),{chatConfig:m,autoBilling:C,onImageClick:I,initErrorFallbackFC:b,onThemeChange:M,layout:E}=(0,c.HE)(),y=(0,c.Pc)(),S=et(),k=ep(),{GrabPlugin:x}=(0,G.vy)({scene:"store",getPopContainer:()=>document.querySelector(".coze-chat-sdk")}),B=(0,c.VJ)(),{ChatBackgroundPlugin:U}=(0,c.R$)(),P=(0,R.O4)({refreshToken:p,refChatFunc:h,onImageClick:I,setInitError:_}),j=(0,l.useMemo)(()=>(0,Z.g)({openapiService:g}),[g]),W=(0,c.iy)();if((0,l.useEffect)(()=>{null==M||M(W)},[W]),(0,l.useEffect)(()=>{if(!!f&&!s.current)(0,w._)(function*(){try{(0,d.f1)(f.code)&&(yield null==p?void 0:p(),_(!1))}catch(e){console.error(e)}s.current=!0})()},[f]),f)return b?(0,r.jsx)(b,{error:!0===f?null:f,refresh:(0,w._)(function*(){(0,d.f1)(f.code)?(yield null==p?void 0:p(),_(!1)):location.reload()})}):null;return(0,r.jsxs)(v.jD,{botId:m.bot_id,userInfo:y,scene:V.xs.OpenAipSdk,connector:m.auth.connectorId,reporter:d.v1,requestToInit:S,enableChatActionLock:!0,createChatCoreOverrideConfig:k,eventCallback:{onImageClick:E===d.Ar.MOBILE?void 0:()=>void 0,onInitSuccess:()=>{s.current=!1},onCopyUpload:e=>{var o,n,i,{message:t,extra:{fileIndex:a}}=e;(0,O.zE)(t.content_obj)&&(A()(null!==(n=null===(o=t.content_obj.file_list[null!=a?a:0])||void 0===o?void 0:o.file_key)&&void 0!==n?n:""),z.O$.success({content:null!==(i=D.o.t("copy_success"))&&void 0!==i?i:"Copy Successfully"}))}},configs:{showFunctionCallDetail:!0,uploadPlugin:j,ignoreMessageConfigList:v.QC,isShowFunctionCallBox:null===(i=null==m?void 0:null===(n=m.ui)||void 0===n?void 0:null===(o=n.chatBot)||void 0===o?void 0:o.isNeedFunctionCallMessage)||void 0===i||i},pluginRegistryList:[P,F.Y,q.n,U,x,L.F,H.h,...a||[]],showBackground:B,enableDragUpload:!1,audioBilling:C,children:[(0,r.jsx)(R.c4,{}),(0,r.jsx)(Q,{children:(0,r.jsx)(ef,{ref:h,children:t})}),(0,r.jsx)(eu,{}),(0,r.jsx)(T.s,{getPopupContainer:()=>document.querySelector(".coze-chat-sdk")})]})}},947309:function(e,o,n){var i=n(160052),t=n.n(i),a=n(570717),r=n.n(a)()(t());r.push([e.id,".chat-input--spaESZgItgCg8uF4{padding:10px 0}.area--ED9HU4MCojsSFkgq{display:flex;flex:1 1 auto;flex-direction:column;height:100%;min-height:0}.area--ED9HU4MCojsSFkgq *{box-sizing:border-box}.area--ED9HU4MCojsSFkgq .chat-uikit-on-boarding-pc>div{padding-left:14px;padding-right:14px}.area--ED9HU4MCojsSFkgq .safe-area--Wo5MG3DgtQEomBBI{height:24px}",""]),r.locals={"chat-input":"chat-input--spaESZgItgCg8uF4",chatInput:"chat-input--spaESZgItgCg8uF4",area:"area--ED9HU4MCojsSFkgq","safe-area":"safe-area--Wo5MG3DgtQEomBBI",safeArea:"safe-area--Wo5MG3DgtQEomBBI"},o.Z=r},893452:function(e,o,n){var i=n(160052),t=n.n(i),a=n(570717),r=n.n(a)()(t());r.push([e.id,".has-header--M7H4GSquL1ERsBPW{padding:56px 0 0}",""]),r.locals={"has-header":"has-header--M7H4GSquL1ERsBPW",hasHeader:"has-header--M7H4GSquL1ERsBPW"},o.Z=r}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2239/73098.568cebf0.js.map