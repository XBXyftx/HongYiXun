"use strict";(self.webpackChunkapp_botstudio_main=self.webpackChunkapp_botstudio_main||[]).push([["49447"],{30319:function(e,t,n){n.d(t,{h:()=>d});var r=n("396842"),i=n("353472"),o=()=>({onFileClick:e=>{var{name:t,url:n,uri:r}=e;i.h.openFilePreview({file_name:t,file_url:n,file_uri:r})}}),l=e=>({}),s=e=>({}),a=e=>({});class c extends r.x1{constructor(...e){super(...e),this.pluginMode=r.tf.Writeable,this.pluginName="chat_area_preview_file",this.lifeCycleServices={commandLifeCycleService:o(this),appLifeCycleService:l(this),messageLifeCycleService:s(this),renderLifeCycleService:a(this)}}}var d={createPluginBizContext:()=>({}),Plugin:c}},106038:function(e,t,n){n.d(t,{F:()=>er});var r=n("396842"),i=n("341333"),o=n("265489"),l=n("938809"),s=n("926805"),a=n("353472"),c=n("273094"),d=n("988726"),u=n("182956"),p=e=>{var t=e.at(-1);return(null==t?void 0:t.content_type)===r.zc.ActionInfo||!1},m=e=>{var{functionCallMessage:t,verboseMessage:n,toolResponseMessage:r}=e;return t?(0,s.eY)({functionCallMessage:t,toolResponseMessage:r}):n?{subTimeNode:null,totalTime:(0,s.fs)(n)}:{subTimeNode:null,totalTime:"0"}},v=n("723530"),g=n("316198"),f=e=>{var{functionCallMessageStructList:t,isMessageFromOngoingChat:n,groupId:r}=e,i=t.at(-1);(0,v.useEffect)(()=>{if(!i||!n)return;var{stepsProps:t,setStepsProps:o}=g.q.getState();if(!!t&&t.groupId===r)o(e)},[i,n,r])},h=n("16242"),x=e=>{var t=e.filter(e=>e.content_type===r.zc.Text||e.content_type===r.zc.ActionInfo);return{timelineItems:t.map(e=>{if(e.content_type===r.zc.Text)return{key:e.message_id,content:e.content};if(e.content_type===r.zc.ActionInfo){var{actions:t}=e.content_obj;if(null==t?void 0:t.find(e=>e.type===c.xK.WebAuthorization))return{key:e.message_id,content:h.o.t("\u8BF7\u5148\u5B8C\u6210\u6388\u6743\u767B\u5F55\u540E\u7EE7\u7EED"),breaking:!0}}return null}).filter(e=>null!==e),filteredMessages:t}},b=n("856306"),y=n.n(b),_=n("444601"),k=n("866466"),w=n.n(k),j=n("462669"),C=n.n(j),N=n("318249"),z=n.n(N),S=n("294754"),L=n.n(S),E=n("13355"),T=n.n(E),R=n("876846"),W=n.n(R),P=n("923899"),U={};U.styleTagTransform=W(),U.setAttributes=L(),U.insert=z().bind(null,"head"),U.domAPI=C(),U.insertStyleElement=T(),w()(P.Z,U);var I=P.Z&&P.Z.locals?P.Z.locals:void 0,F=e=>{var{items:t,className:n,style:r,selectedKey:i,onItemClick:o}=e;return(0,l.jsx)("ul",{className:y()(I.timeline,n),style:r,children:t.map(e=>(0,l.jsx)("li",{onClick:()=>null==o?void 0:o(e.key),className:I.item,children:(0,l.jsx)("div",{className:y()(I.content,{[I.selected]:!e.breaking&&e.key===i,[I.breaking]:e.breaking&&e.key===i}),children:(0,l.jsx)(_.LJ,{markDown:e.content,className:"!text-current"})})},e.content))})},A=n("453873"),G={};G.styleTagTransform=W(),G.setAttributes=L(),G.insert=z().bind(null,"head"),G.domAPI=C(),G.insertStyleElement=T(),w()(A.Z,G);var M=A.Z&&A.Z.locals?A.Z.locals:void 0,Y=e=>{var{title:t,linkText:n=h.o.t("agent_ide_action_view_history"),loading:r,icon:o,className:s,style:a,onLinkClick:c,children:p,subTitle:m,highlight:v,meta:g}=e;return(0,l.jsxs)("div",{className:y()(s,"border border-solid border-[var(--coz-stroke-primary)] bg-white rounded-[12px] p-4 flex flex-col gap-3"),style:(0,i._)({},a,v?{borderColor:"var(--coz-stroke-color-orange)",boxShadow:"0 8px 30px 0 rgba(255, 115, 0, 0.18)"}:{}),children:[(0,l.jsxs)("div",{className:"flex items-center",children:[r?(0,l.jsx)(d.j2n,{fontSize:20,className:M.spin}):o,(0,l.jsx)(u.Typography.Text,{ellipsis:{showTooltip:!0},className:"!coz-fg-primary !text-[16px] !font-medium ml-2",children:t}),m?(0,l.jsx)(u.Typography.Text,{ellipsis:{showTooltip:!0},className:"!coz-fg-dim text-[14px] font-normal ml-2 shrink-0",children:m}):null,(0,l.jsxs)("div",{"data-testid":null==g?void 0:g.linkDataTestid,className:"shrink-0 ml-auto text-[14px] font-medium flex items-center gap-1 coz-fg-secondary cursor-pointer pl-[32px]",onClick:()=>null==c?void 0:c(),children:[n,(0,l.jsx)(d.x5d,{fontSize:20})]})]}),p]})},O=e=>{var{children:t,maxHeight:n,className:r,style:i}=e,[o,s]=(0,v.useState)(0),a=(0,v.useRef)(null);return(0,v.useEffect)(()=>{var e,t=null===(e=a.current)||void 0===e?void 0:e.parentElement;t&&t.scrollTo({top:t.scrollHeight})},[]),(0,l.jsxs)("div",{className:y()(M.container,r),style:i,children:[(0,l.jsx)("div",{className:M.shadow,style:{opacity:o}}),(0,l.jsx)("div",{style:{maxHeight:n},className:M.content,onScroll:e=>{s(Math.min(e.currentTarget.scrollTop,32)/32)},children:(0,l.jsx)("div",{ref:a,children:t})})]})},V=e=>{var t,{messages:n}=e,{filteredMessages:r,timelineItems:i}=x(n);return 0===i.length?null:(0,l.jsx)(O,{maxHeight:125,children:(0,l.jsx)(F,{className:"overflow-y-auto",selectedKey:null===(t=r[r.length-1])||void 0===t?void 0:t.message_id,items:i})})},D=e=>{var t=e.latestPlugin.toolVerboseMessageList;return(0,l.jsx)(V,{messages:t})},Z=n("609709"),B=e=>((0,v.useEffect)(()=>{var t=()=>{var t,n=window.getSelection(),r=null==n?void 0:n.toString().trim();r&&(null===(t=e.current)||void 0===t||t.clipboardPaste(r))};return document.addEventListener("copy",t),()=>{document.removeEventListener("copy",t)}},[]),{vncClipboardSync:e=>{var{text:t}=e.detail;if(!!t)try{window.focus(),navigator.clipboard.writeText(t)}catch(e){console.error(e)}}}),q=e=>{var t,n,r,i,{message:o,latestPlugin:s,onCancel:a}=e,c=(0,v.useRef)(null),d=null===(n=o.content_obj)||void 0===n?void 0:null===(t=n.items[0])||void 0===t?void 0:t.ws_url,p=s.status,{timelineItems:m,filteredMessages:g}=x(s.toolVerboseMessageList);(0,v.useEffect)(()=>{var e,t;if("running"===p&&d){null===(e=c.current)||void 0===e||e.connect();return}return("completed"===p||"failed"===p)&&(null===(t=c.current)||void 0===t||t.disconnect()),()=>{var e;null===(e=c.current)||void 0===e||e.disconnect()}},[p,d]);var{vncClipboardSync:f}=B(c);return(0,l.jsx)(u.Modal,{title:null===(r=s.functionCallMessage)||void 0===r?void 0:r.extra_info.plugin,visible:!0,width:1200,onCancel:a,children:(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)("div",{className:"flex-1 rounded-[16px] border border-solid coz-stroke-primary min-w-[864px] h-[640px]",children:(0,l.jsx)(Z.T,{ref:c,url:null!=d?d:"",autoConnect:!1,background:"#000000",viewOnly:!1,scaleViewport:!0,onClipboard:f,className:y()("w-full h-full rounded-[16px]","[&_div]:!rounded-[16px]")})}),m.length>0&&(0,l.jsx)("div",{className:"w-[266px]",children:(0,l.jsx)(O,{maxHeight:640,children:(0,l.jsx)(F,{items:m,selectedKey:null===(i=g[g.length-1])||void 0===i?void 0:i.message_id})})})]})})},H=e=>{var[t,n]=(0,v.useState)(!1);return{open:()=>n(!0),close:()=>n(!1),node:t?(0,l.jsx)(q,(0,o._)((0,i._)({},e),{onCancel:()=>n(!1)})):null}};function J(e){var t,{message:n,latestPlugin:i,className:o}=e,{actions:s}=n.content_obj,a=null==s?void 0:s.find(e=>e.type===c.xK.WebAuthorization),d=i.toolVerboseMessageList.find(e=>e.content_type===r.zc.WebsocketInfo),p=(null===(t=i.toolVerboseMessageList.at(-1))||void 0===t?void 0:t.message_id)===n.message_id,{open:m,node:v}=H({message:d,latestPlugin:i});return a&&p?(0,l.jsxs)("div",{className:y()("action-footer","space-y-4",o),children:[v,(0,l.jsx)(u.Button,{color:"yellow",onClick:m,className:"!rounded-[100px] ml-[26px]",children:"\u53BB\u6388\u6743"})]}):null}var K=e=>{var{message:t,latestPlugin:n}=e;return t.content_type===r.zc.ActionInfo?(0,l.jsx)(J,{message:t,latestPlugin:n}):null},X=n("273268"),Q=e=>{var t,n,r,i,{message:o,latestPlugin:s}=e,a=(0,v.useRef)(null),c=s.status,{open:p,node:m}=H({message:o,latestPlugin:s}),g=null===(n=o.content_obj)||void 0===n?void 0:null===(t=n.items[0])||void 0===t?void 0:t.ws_url,{vncClipboardSync:f}=B(a),{messageWrapperRef:h}=(0,X.kb)();return((0,v.useEffect)(()=>{var e,t;if("running"===c&&g){null===(e=a.current)||void 0===e||e.connect();return}return("completed"===c||"failed"===c)&&(null===(t=a.current)||void 0===t||t.disconnect()),()=>{var e;null===(e=a.current)||void 0===e||e.disconnect()}},[c,g]),g&&"running"===c)?(0,l.jsxs)(l.Fragment,{children:[m,(0,l.jsxs)("div",{style:{width:(null==h?void 0:null===(r=h.current)||void 0===r?void 0:r.offsetWidth)?"".concat((null==h?void 0:null===(i=h.current)||void 0===i?void 0:i.offsetWidth)-32,"px"):"100%",maxWidth:"800px"},"data-testid":"function-call-vnc-render",className:y()("relative w-full max-w-full aspect-[546/308] rounded-[12px] border border-solid coz-stroke-primary"),children:[(0,l.jsx)(Z.T,{ref:a,url:null!=g?g:"",autoConnect:!1,background:"#000000",scaleViewport:!0,viewOnly:!1,className:y()("w-full h-full rounded-[12px]","[&_canvas]:!rounded-[12px]","[&_div]:!rounded-[12px]"),onClipboard:f}),(0,l.jsx)("div",{className:"absolute top-2 right-2 z-99999999",children:(0,l.jsx)(u.IconButton,{icon:(0,l.jsx)(d.ltt,{}),className:"!rounded-full border border-solid !coz-stroke-primary",style:{boxShadow:"0 2px 16px 0 rgba(0, 0, 0, 0.39)",backdropFilter:"blur(2px)",background:"rgba(255, 255, 255, 0.75)"},size:"small",onClick:p})})]})]}):null},$=e=>{var{message:t,latestPlugin:n}=e;return(0,l.jsx)(l.Fragment,{children:t.content_type===r.zc.WebsocketInfo?(0,l.jsx)(Q,{message:t,latestPlugin:n}):null})},ee=e=>{var{className:t,containerClassName:n,style:r,onClick:i}=e;return(0,l.jsx)("div",{className:n,children:(0,l.jsxs)("div",{className:y()("p-4 border border-solid coz-stroke-primary rounded-[8px] flex items-center coz-fg-primary cursor-pointer hover:coz-mg-secondary-hovered",t),style:r,onClick:i,"data-testid":"chat-area.plugin-function-call.view-all",children:[(0,l.jsx)(d.NR2,{fontSize:20}),(0,l.jsx)("span",{className:"text-sm font-medium ml-2",children:h.o.t("agent_ide_action_view_history_all")}),(0,l.jsx)(d.x5d,{fontSize:20,className:"ml-auto"})]})})},et=e=>{var t,n=e.functionCallMessageStructList.at(0);f(e);var c=(0,r.rz)(),v=()=>{a.h.openFunctionCallSteps(e)};if(!n)return null;if(!e.isMessageFromOngoingChat)return(0,l.jsx)(ee,{onClick:v,containerClassName:c?"coz-bg-image-bots":"coz-bg-max"});var{subTimeNode:g,totalTime:h}=m(n);return(0,l.jsx)("div",{className:"coz-bg-max",children:(0,l.jsxs)(Y,(0,o._)((0,i._)({},e),{title:(()=>{var{functionCallMessage:e,verboseMessageType:t}=n;return e?e.extra_info.plugin:t?(0,s.Mi)(t):""})(),subTitle:(0,l.jsxs)("div",{className:"flex items-center gap-x-2px",children:[(0,l.jsxs)("div",{className:"text-base font-normal leading-16px",children:[h,"s"]}),(0,l.jsx)(u.Tooltip,{disabled:!g,content:g,position:"top",children:(0,l.jsx)(d.L03,{className:"text-base font-normal leading-16px"})})]}),icon:(null===(t=n.functionCallMessage)||void 0===t?void 0:t.extra_info.plugin_icon)?(0,l.jsx)("img",{src:n.functionCallMessage.extra_info.plugin_icon,className:"w-4 h-4 rounded-[6px]"}):null,highlight:p(n.toolVerboseMessageList),loading:"running"===n.status,onLinkClick:v,meta:{linkDataTestid:"chat-area.plugin-function-call.view-history"},children:[n.toolVerboseMessageList.map(e=>(0,l.jsx)($,{message:e,latestPlugin:n},e.message_id)),(0,l.jsx)(D,{latestPlugin:n}),n.toolVerboseMessageList.map(e=>(0,l.jsx)(K,{message:e,latestPlugin:n},e.message_id))]}))})};class en extends r.x1{constructor(...e){super(...e),this.pluginMode=r.tf.Writeable,this.pluginName=r.p7.FunctionCallContentPlugin,this.customComponents={FunctionCallMessageContent:et}}}var er={createPluginBizContext:()=>null,Plugin:en}},926805:function(e,t,n){n.d(t,{Mi:()=>a,eY:()=>l,fs:()=>o});var r=n("938809"),i=n("16242"),o=e=>{var t;return Number(null!==(t=null==e?void 0:e.extra_info.time_cost)&&void 0!==t?t:0).toFixed(1)},l=e=>{var{functionCallMessage:t,toolResponseMessage:n}=e,l=o(t),s=o(n),a=(Number(l)+Number(s)).toFixed(1),c=[{label:i.o.t("debug_area_time_label_model"),value:l},{label:i.o.t("debug_area_time_label_tool"),value:s}].filter(e=>e.value),d=(0,r.jsx)(r.Fragment,{children:c.map(e=>"".concat(e.label).concat(e.value,"s")).join("\uFF5C")}),u=(0,r.jsxs)(r.Fragment,{children:[a,"s : ",d]});return{totalTime:a,modelTime:l,apiTime:s,subTimeNode:d,totalTimeNode:u}},s=n("396842"),a=e=>{switch(e){case s.kc.LONG_TERM_MEMORY:return i.o.t("ltm_240227_01");case s.kc.KNOWLEDGE_RECALL:return i.o.t("bot_preview_searched_dataset");default:return""}}},710626:function(e,t,n){n.d(t,{g:()=>s});var r=n("255721"),i=n("707567"),o=e=>e.type.startsWith("image/"),l=e=>o(e)?new Promise(t=>{var n=new Image,r=URL.createObjectURL(e);n.onload=()=>{URL.revokeObjectURL(r),t({width:n.naturalWidth||n.width,height:n.naturalHeight||n.height})},n.onerror=()=>{URL.revokeObjectURL(r),t(null)},n.src=r}):Promise.resolve(null),s=e=>{var{openapiService:t}=e;return class e{start(){if(!this.isUploading&&!this.isCancelled)this.isUploading=!0,this.uploadPromise=this.uploadAsync()}on(e,t){this.eventBus.on(e,t)}pause(){}cancel(){if(!this.isCancelled)this.isCancelled=!0,this.abortController.abort()}upload(){var e=this;return(0,r._)(function*(){e.eventBus.emit("ready",!0);try{return yield e.performUpload()}catch(t){if(e.abortController.signal.aborted)throw Error("Upload cancelled");throw t}})()}uploadAsync(){var e=this;return(0,r._)(function*(){try{var t=yield e.upload();if(e.isUploading=!1,!e.isCancelled){var n=yield l(e.file),r={uploadResult:{Uri:t.uri,Url:t.url,ImageWidth:null==n?void 0:n.width,ImageHeight:null==n?void 0:n.height},extra:{message:"Upload completed successfully"},type:"success"};e.eventBus.emit("complete",r)}return t}catch(t){if(e.isUploading=!1,!e.isCancelled&&t instanceof Error){if("AbortError"===t.name){var i={type:"error",extra:{message:"Upload cancelled by user",error:Error("Upload cancelled by user")}};e.eventBus.emit("error",i)}else{var o={type:"error",extra:{message:t.message,error:t}};e.eventBus.emit("error",o)}}throw t}})()}performUpload(){var e=this;return(0,r._)(function*(){var{signal:n}=e.abortController;if(n.aborted)throw Error("Upload already cancelled");new FormData().append("file",e.file);if(!e.conversationId)throw Error("Upload failed: conversationId must be string value");var r=yield t.UploadFileV2({file:e.file,conversation_id:e.conversationId},{signal:n,onUploadProgress:t=>{if(!e.isCancelled){var{loaded:n,total:r}=t,i=Math.round(n/(null!=r?r:n)*100);e.eventBus.emit("progress",{percent:i,type:"success",extra:{message:"progress"}})}}});if(!r.data)throw Error("Upload failed: No data returned");return{uri:r.data.file.uri,url:r.data.file.url}})()}constructor(e){this.eventBus=new i.v,this.isUploading=!1,this.isCancelled=!1,this.uploadPromise=null,this.file=e.file,this.fileType=e.type,this.userId=e.userId,this.abortController=new AbortController,this.conversationId=e.conversationId,this.start()}}}},453873:function(e,t,n){var r=n(160052),i=n.n(r),o=n(570717),l=n.n(o)()(i());l.push([e.id,".shadow--kkGxGgCvN8sIV9rs{background:linear-gradient(0deg,hsla(0,0%,100%,0) -17.74%,#fff 61.29%);height:31px;left:0;position:absolute;top:0;width:100%;z-index:1}.container--ryPikTTf73wTBAve{position:relative}.content--f2DV6jdzbEUrL2gN{overflow-y:auto}.content--f2DV6jdzbEUrL2gN::-webkit-scrollbar{display:none}.spin--_PpZYm_S6FgCF_Gv{animation:spin--_PpZYm_S6FgCF_Gv 1s linear infinite;flex-shrink:0}@keyframes spin--_PpZYm_S6FgCF_Gv{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}",""]),l.locals={shadow:"shadow--kkGxGgCvN8sIV9rs",container:"container--ryPikTTf73wTBAve",content:"content--f2DV6jdzbEUrL2gN",spin:"spin--_PpZYm_S6FgCF_Gv"},t.Z=l},923899:function(e,t,n){var r=n(160052),i=n.n(r),o=n(570717),l=n.n(o)()(i());l.push([e.id,'.timeline--cFDiENDSvow7SYWG{list-style:none;margin:0;padding:0;width:100%}.item--bzi6SNLWgeEY6q90,.timeline--cFDiENDSvow7SYWG{position:relative}.item--bzi6SNLWgeEY6q90{color:var(--coz-fg-secondary);font-size:14px;line-height:20px;padding-bottom:12px;padding-left:26px}.item--bzi6SNLWgeEY6q90:after{border-left:2px dashed var(--coz-fg-dim);content:"";height:100%;left:7px;position:absolute;top:12px;transform:scaleX(.5);width:0}.item--bzi6SNLWgeEY6q90:last-child:after{display:none}.item--bzi6SNLWgeEY6q90:last-child{padding-bottom:0}.content--k3S0LWl2RwAGdjk0{border-radius:8px;padding:4px 6px}.content--k3S0LWl2RwAGdjk0:before{background-color:#fff;background-image:linear-gradient(to bottom,var(--coz-fg-dim),var(--coz-fg-dim));border-radius:50%;content:"";display:block;height:8px;left:4px;position:absolute;top:11px;width:8px;z-index:1}.content--k3S0LWl2RwAGdjk0.breaking--U1GzeOmOeo0yynCw{color:var(--coz-fg-hglt-yellow);font-weight:500}.content--k3S0LWl2RwAGdjk0.breaking--U1GzeOmOeo0yynCw:before{background-image:linear-gradient(180deg,currentcolor,currentcolor)}.content--k3S0LWl2RwAGdjk0.selected--feJtb5oPRIlEdRYc,.content--k3S0LWl2RwAGdjk0:hover{background-color:var(--coz-mg-secondary-hovered)}.content--k3S0LWl2RwAGdjk0.selected--feJtb5oPRIlEdRYc{color:var(--coz-fg-plus);font-weight:500}.content--k3S0LWl2RwAGdjk0.selected--feJtb5oPRIlEdRYc:before{background-image:linear-gradient(180deg,currentcolor,currentcolor)}',""]),l.locals={timeline:"timeline--cFDiENDSvow7SYWG",item:"item--bzi6SNLWgeEY6q90",content:"content--k3S0LWl2RwAGdjk0",breaking:"breaking--U1GzeOmOeo0yynCw",selected:"selected--feJtb5oPRIlEdRYc"},t.Z=l}}]);
//# sourceMappingURL=https://sourcemap-redirect.coze.cn/obj/coze-sourcemap/ol-sourcemap/bot/1.0.2.2388/49447.b03f45ad.js.map